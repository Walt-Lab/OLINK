"use strict";(self.webpackChunkaurelia=self.webpackChunkaurelia||[]).push([[81],{211231:(e,t,s)=>{s.d(t,{Z:()=>ve})
var i=s(512902),n=s(250965),r=s.n(n),o=s(531041),a=s(764403),l=s.n(a),d=s(989526),p=s(615439),c=s.n(p),u=s(273870),m=s.n(u),h=s(767807),f=s.n(h),g=s(178570),S=s(331933),E=s(630606),y=s(848640),b=s(232606),I=s(675649),T=s(252130),C=s(352734),R=s(929006),x=s(909410),v=s(122174),k=s(592083),w=s(121160),_=s(851422),P=s(379346)
function _isDedicatedLookupColumn(e){return e.columnType===_.TableColumnType.DEDICATED_LOOKUP}function convertStructuredTableForPaste(e,t,s){const n=(0,i.ZP)(e,(i=>{let n=e.item.name
if(Array.from(t).includes(n)){n=w.Z.util.uniqueTableName(t,w.Z.util.extractTableNamePrefix(i.item.name))
i.item.name=n}i.item.provenanceUuid=(0,g.Z)()
i.item.cid=o.default.uniqueId("st")
i.item.apiId=void 0
if(s){i.item.fileId=s
i.item.isConfig=P.ZP.isEntryOrSubOrWorkflowTemplate(s)}const r=[]
for(const e of i.item.rows)r.push({...e,rowId:(0,g.Z)()})
i.item.rows=r
const a=[]
for(const e of i.item.columns){const t={...e,cid:o.default.uniqueId("dtcol"),provenanceUuid:(0,g.Z)()}
a.push(t)}for(const[e,t]of i.item.columns.entries())if(_isDedicatedLookupColumn(t)){const{inputColumnProvenanceUuid:s}=t,n=i.item.columns.findIndex((e=>e.provenanceUuid===s));(0,b.hu)(-1!==n,"Found a dedicated lookup column whose inputColumnProvenanceUuid refers to a column that is not present in the table.")
const r=a[e];(0,b.hu)(_isDedicatedLookupColumn(r),"Columns during table copy & paste were pasted in incorrect order. Found a non-lookup column in pasted table in the same position as a lookup column in the original table.")
r.inputColumnProvenanceUuid=a[n].provenanceUuid}i.item.columns=a}))
return{item:n,name:n.item.name}}var M=s(445881),A=s(390909),N=s(943794),O=s(212300),L=s(926025),H=s(348920),F=s(111770),D=s(459561),q=s(886911),Z=s(272853),B=s(537141)
function deburrString(e){return e.normalize("NFKD").replace(/[\u0300-\u036f]/g,"")}var U=s(726763)
class TextMatcher{constructor(e){this.regExpLockId=null
e=deburrString(e)
this.query=e
this.regExp=new RegExp((0,U.Z)(e),"igu")}acquireRegExpLock(e){(0,b.hu)(!this.regExpLockId,`${e} cannot lock on regExp - already held by ${this.regExpLockId}`)
this.regExpLockId=e}releaseRegexpLock(){this.regExpLockId=null}*findAllMatches(e){const t=deburrString(e)
if(t!==e){F.QX("bnch.notebook.search.deburredHaystack.items")
t.length!==e.length&&F.QX("bnch.notebook.search.deburredHaystack.lengthMismatch")}let s
this.acquireRegExpLock("findAllMatches")
try{this.regExp.lastIndex=0
for(;s=this.regExp.exec(t);)yield s}finally{this.releaseRegexpLock()}}hasMatch(e){this.acquireRegExpLock("hasMatch")
try{this.regExp.lastIndex=0
return this.regExp.test(e)}finally{this.releaseRegexpLock()}}}function getSearchResultIndex(e){return e.index}const j={selectedIndex:-1,searchResults:[],searchResultsTree:null,selectedSearchResultTree:null,isTruncated:!1,isLoading:!1},$={...j,isLoading:!0}
function useDebouncedSearch(e,t,s,i){const n=(0,Z.Z)()
return(0,d.useMemo)((()=>(0,L.D)(((s,r,o,a)=>{var l
if(!n.current||!o)return
const d=o.length
let p=-1
const c=P.ZP.apiIdToType(e.props.fileId),u=null!==(l=q.BL("notebook_doc_search",{enabled:!0,getMetadata:()=>({queryLength:d,resultCount:p,fileType:c})}))&&void 0!==l?l:""
q.hY(u)
const m=function*getSearchResults(e,t,s,i,n,r){var o,a,l
const d=new TextMatcher(i)
for(const i of s){const s=e.props.getCid(i),p=e.props.getType(i),c=e.getPluginByType(p)
if(null===(a=null===(o=c.component)||void 0===o?void 0:o.getIsInaccessible)||void 0===a?void 0:a.call(o,i))continue
const u=null===(l=c.getSearchResults)||void 0===l?void 0:l.call(c,i,d,n,e.getComputedTables(t),r[s])
for(const e of null!=u?u:[])yield e}}(e,s,r,o,i,a),{results:h,isTruncated:f}=function getSearchResultsWithTruncation(e){if(H.ZP.ELN_VIRTUALIZED_SEARCH_MAX_RESULTS<=-1)return{results:Array.from(e),isTruncated:!1}
const t=[]
for(const s of e){if(t.length===H.ZP.ELN_VIRTUALIZED_SEARCH_MAX_RESULTS)return{results:t,isTruncated:!0}
t.push(s)}return{results:t,isTruncated:!1}}(m)
p=h.length
F.tb("bnch.notebook.search.numResults",p,{isTruncated:f})
q.Eb(u)
q.sT(u)
const g=function getSearchStateFromNewResults(e,t){return{selectedIndex:-1,searchResults:e,searchResultsTree:(0,B.QM)(e,getSearchResultIndex),selectedSearchResultTree:null,isTruncated:t,isLoading:!1}}(h,f)
t.current(g)}),s)),[e,t,s,n,i])}function useCtrlF(e,t,s=j,i,n){const[r,o]=(0,d.useState)(!1),[a,l]=(0,d.useState)(""),{searchResults:p,isLoading:u,isTruncated:m,selectedIndex:h}=s,{showFormulas:f}=D.q.useContext(),g=(0,d.useRef)(null),S=(0,d.useCallback)((e=>{var t
o(!0)
e&&l(e)
null===(t=g.current)||void 0===t||t.focusAndSelect()}),[]),E=(0,d.useCallback)((()=>{o(!1)
i(j)}),[i]),y=function useLastValueRef(e){const t=(0,d.useRef)(e)
t.current=e
return t}(i),b=useDebouncedSearch(e,y,n,f),I=(0,d.useCallback)((s=>{const i=s.ui.collapsedTables.tableEditableCollapsedStateByCollapseId
return r?e.props.getItems(t).reduce(((t,s)=>{var n,r
const o=e.props.getType(s),a=e.getPluginByType(o)
return{...t,[e.props.getCid(s)]:null===(r=(n=a.component).getIsCollapsed)||void 0===r?void 0:r.call(n,s,e.state.editorProps,i)}}),{}):{}}),[e,t,r]),T=e.getSearchableItems(t),C=(0,O.v9)(I,c()),R=(0,d.useRef)({});(0,d.useEffect)((()=>{const e=R.current,s={doc:t,query:a,isTableCollapsedById:C,isOpen:r,items:T,setSearchStateRef:y,doDebouncedSearch:b}
if(!c()(e,s)){R.current=s
if(r){y.current(a?$:j)
b(t,T,a,C)}}}),[t,a,C,r,T,y,b])
const x=(0,d.useCallback)((e=>{if(0===p.length)return
const t=p.length,i=(e%t+t)%t,n=p[i],r=(0,B.QM)([n],getSearchResultIndex)
y.current({...s,selectedIndex:i,selectedSearchResultTree:r})
setTimeout((()=>{(0,A.BD)(n)}),0)}),[p,s,y]),v=(0,d.useCallback)((e=>{var t
if(r)x(e?h-1:h+1)
else{o(!0)
null===(t=g.current)||void 0===t||t.focusAndSelect()}}),[r,o,h,x]);(0,A.Iy)(S,v,E)
return{ref:g,isOpen:r,query:a,setQuery:l,isLoading:u,isTruncated:m,selectedIndex:h,setSelectedIdx:x,searchResults:p,doClose:E}}function CtrlFInput({docRoot:e,editor:t,searchState:s,setSearchState:i,requestSelection:n}){const{ref:r,isOpen:o,doClose:a,query:l,setQuery:p,isLoading:c,isTruncated:u,searchResults:m,selectedIndex:h,setSelectedIdx:f}=useCtrlF(t,e,s,i,N.Cz)
return o?d.createElement("div",{...A.D5},d.createElement(M.Z,{ref:r,onClose:()=>{a()
const e=m[h];(null==e?void 0:e.selection)&&n(e.selection)},onQueryChange:e=>{p(e)},query:l,onViewNextResult:()=>{f(h+1)},onViewPreviousResult:()=>{f(h-1)},selectedIndex:h,numSearchResults:m.length,isTruncated:u,isLoading:c,placeholder:N.QT})):null}var V=s(459830),W=s(922633),K=s(744391),G=s(483528),z=s(64558),Y=s(494327),Q=s(428171),X=s(298663),J=s(989566)
const ee={},te=(0,J.Z)((()=>s.g.ResizeObserver?X.Z:()=>({ref:z.ZT})))
const se=(0,Y.x)((()=>null),"InitialRenderContext")
function _useInitialRenderRef(e){const t=(0,d.useRef)(!0),s=(0,d.useRef)(e)
if(s.current!==e&&e){t.current=!0
s.current=e}(0,d.useEffect)((()=>{t.current=!1}))
return t}function _useShouldVirtualize(e){const t=ie.useContext(),s=function _useIsNewlyInserted(){const e=se.useContext(),t=_useInitialRenderRef()
return null!=e&&!e.current&&t.current}(),{ref:i,hasBeenInView:n}=(0,Q.Z)(e),r=void 0!==n&&t,{forceVirtualization:o,ref:a}=function _useVirtualizationDebugger(e){const t=(0,d.useRef)()
if(!H.ZP.ELN_ENABLE_VIRTUALIZATION_DEBUGGER)return{forceVirtualization:!1,ref:t}
const[s,i]=(0,d.useState)(!0),n=(0,d.useCallback)((e=>{if(!t.current)return
const{top:n,bottom:r}=t.current.getBoundingClientRect(),o=e.clientY<n||e.clientY>r
o!==s&&i(o)}),[s]);(0,d.useEffect)((()=>{e&&window.addEventListener("mousemove",n)
return()=>{window.removeEventListener("mousemove",n)}}),[e,n])
return{forceVirtualization:s,ref:t}}(r),l=function _useNeverRevirtualize(e){const t=(0,d.useRef)(!1)
e||(t.current=!0)
return!t.current}(r&&!n&&!s)||r&&o
return{ref:(0,d.useCallback)((e=>{i(e)
a.current=e}),[i,a]),shouldVirtualize:l}}const ie=(0,Y.x)((()=>!1),"VirtualizationEnabledContext")
function VirtualizedList(e){const t=_useInitialRenderRef(e.documentVersionCid)
return d.createElement(ie.Provider,{value:e.isVirtualizationEnabled},d.createElement(se.Provider,{value:t},e.children))}function useVirtualizeItem(e,t,s,i){const{ref:n,shouldVirtualize:r}=_useShouldVirtualize(s),{ref:o,actualHeight:a}=function _useActualHeight({shouldVirtualize:e,itemId:t}){const s=(0,d.useRef)(null);(0,d.useEffect)((()=>{if(!e&&s.current){const{height:e}=s.current.getBoundingClientRect()
ee[t]=e}}),[t,e])
const i=(0,d.useCallback)((({height:s})=>{e||void 0===s||(ee[t]=s)}),[e,t]),{ref:n}=te()({onResize:i})
return{ref:(0,d.useCallback)((e=>{n(e)
s.current=e}),[n,s]),actualHeight:ee[t]}}({shouldVirtualize:r,itemId:t}),l=r?null!=a?a:i():void 0
return{ref:(0,d.useCallback)((e=>{n(e)
o(e)}),[n,o]),height:l,shouldVirtualize:r}}var ne=s(974913),re=s(793900),oe=s(602652),ae=s.n(oe),le=s(414975),de=s(616447),pe=s(932628),ce=s(426076),ue=s(451716),me=s(938417),he=s(636878),fe=s(10584)
class Timestamp extends d.PureComponent{render(){const e=this.props.isodate
return d.createElement("div",{className:"mediocre-row-timestamp"},this.props.creator?d.createElement("div",{className:"text-right"},d.createElement("a",{className:"mediocre-row-timestamp-author u-ellipsis-text",href:`/${this.props.creator.url_identifier}/`,rel:"noopener noreferrer",target:"_blank",title:`${this.props.creator.name} <${this.props.creator.email}>`},this.props.creator.handle),d.createElement("p",{className:"mediocre-row-timestamp-time",title:fe.UT(e,{showYear:!0,showTime:!0,showWeekday:!0})},fe.UT(e))):null)}}Timestamp.propTypes={creator:ae().shape({name:ae().string.isRequired,email:ae().string.isRequired,handle:ae().string.isRequired,url_identifier:ae().string.isRequired}),isodate:ae().string}
const ge=Timestamp
function DefaultSkeleton({height:e}){return d.createElement("div",{style:{height:e}})}function MediocreItemComponent(e){var t,s,i,n,r,o,a,l
const p=e.editorProps.getType(e.item),c=e.editor.getPluginByType(p),u=null!==(i=null===(s=(t=c.component).skipVirtualizationDueToPerformantRender)||void 0===s?void 0:s.call(t,e.item))&&void 0!==i&&i,m=!e.viewer&&!u&&(0,B.w2)(e.selectedSearchResultTree),h=c.component.getVirtualizationId?`${e.editorProps.fileId}_${p}_${null===(r=(n=c.component).getVirtualizationId)||void 0===r?void 0:r.call(n,e.item)}`:e.editorProps.getCid(e.item),{ref:f,height:g,shouldVirtualize:S}=useVirtualizeItem(e.item,h,m,(()=>{var t,s,i
if(!c.component.getVirtualizedHeight)return 300
const n=null!==(i=null===(s=(t=c.component).getIsCollapsed)||void 0===s?void 0:s.call(t,e.item,e.editorProps,{}))&&void 0!==i&&i
return c.component.getVirtualizedHeight(e.item,n)}))
return d.createElement("div",{ref:f},S?null!==(l=null===(a=(o=c.component).renderVirtualizedSkeleton)||void 0===a?void 0:a.call(o,e.item,g))&&void 0!==l?l:d.createElement(DefaultSkeleton,{height:g}):c.component.make.call(e.editor,e.item,e.index,e.editorProps,e.itemProps,(0,R.JU)(e)))}function _defineProperty(e,t,s){(t=function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}class MediocreItem extends d.Component{constructor(...e){super(...e)
_defineProperty(this,"_handleMouseDown",(e=>{this.props.editor.itemMouseDownHandler(this.props.index,e)}))
_defineProperty(this,"_handleMouseOver",(e=>{this.props.editor.itemMouseOverHandler(this.props.index,e)}))
_defineProperty(this,"_handleMouseMove",(e=>{this.props.editor.itemMouseMoveHandler(this.props.index,e)}))}static havePropsChanged(e,t){return e.item!==t.item||e.index!==t.index||e.isHighlighted!==t.isHighlighted||e.isSelected!==t.isSelected||e.isBeforeInsert!==t.isBeforeInsert||e.selectedSubIndex!==t.selectedSubIndex||e.editor!==t.editor||e.editorProps!==t.editorProps||e.searchResultsTree!==t.searchResultsTree||e.selectedSearchResultTree!==t.selectedSearchResultTree||!c()(e.itemProps,t.itemProps)}componentDidMount(){}shouldComponentUpdate(e){return MediocreItem.havePropsChanged(this.props,e)}render(){const e=this.props.editorProps.getType(this.props.item),t=this.props.editor.getPluginByType(e),s=d.createElement(MediocreItemComponent,this.props)
return d.createElement("div",{"data-scroll-id":this.props.item.cid,"data-selected-subindex":this.props.selectedSubIndex,className:l()("mediocre-item",t.typeClass,{selected:this.props.isSelected,"is-highlighted":this.props.isHighlighted,"is-before-insert":this.props.isBeforeInsert,"is-important":this.props.item.important,"mediocre-item--withTimestamp":this.props.editorProps.showTimestamps}),onMouseDown:this._handleMouseDown,onMouseOver:this._handleMouseOver,onMouseMove:this._handleMouseMove},this.props.editorProps.showTimestamps?d.createElement("div",{className:"mediocre-row"},d.createElement(ge,{creator:this.props.editor.getCreator(this.props.item),isodate:this.props.editor.getModifiedAt(this.props.item)}),d.createElement("div",{className:"mediocre-row-item"},s)):s)}}_defineProperty(MediocreItem,"propTypes",{item:ae().object.isRequired,index:ae().number.isRequired,isHighlighted:ae().bool.isRequired,isSelected:ae().bool.isRequired,isBeforeInsert:ae().bool.isRequired,selectedSubIndex:ae().string,editor:ae().object,itemProps:ae().object,searchResultsTree:ae().object,selectedSearchResultTree:ae().object,editorProps:ae().shape({showTimestamps:ae().bool,getType:ae().func}).isRequired})
const Se=MediocreItem
var Ee=s(518709),ye=s(260929),be=s(704890),Ie=s(301141)
function _extends(){_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]
for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}
return _extends.apply(this,arguments)}function ownKeys(e,t){var s=Object.keys(e)
if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e)
t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{}
t%2?ownKeys(Object(s),!0).forEach((function(t){Editor_defineProperty(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function Editor_defineProperty(e,t,s){(t=function Editor_toPropertyKey(e){var t=function Editor_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}const{TYPING_PERF_INTERVAL:Te}=C,Ce={start:-1/0,end:1/0},Re={previousIndex(e){return Math.max(e-1,this.firstIndex())},nextIndex(e){return Math.min(e+1,this.lastIndex())},firstIndex:()=>0,lastIndex(){return this.props.getItems(this.props.getRoot()).length-1},getIndex(e){return this.props.getItems(this.props.getRoot()).findIndex((t=>t.cid===e))},atIndex(e){return this.props.getItems(this.props.getRoot())[e]},subList(e,t){return this.props.getItems(this.props.getRoot()).slice(e,t+1)},compareIndex:(e,t)=>e-t,multiGetHTMLForCopy(){const{start:e,end:t}=this.sortedMultiRange()
return this.processItemsForHTMLClipboard(this.subList(e,t))},multiGetTextForCopy(){const{start:e,end:t}=this.sortedMultiRange()
return this.processItemsForTextClipboard(this.subList(e,t))}},xe={propTypes:{editorKey:ae().string.isRequired,fileId:ae().string.isRequired,getItems:ae().func.isRequired,getRoot:ae().func.isRequired,updateRoot:ae().func.isRequired,itemsAccessor:ae().func.isRequired},setText(e,{text:t,formats:s}){return this.getPluginByType(e).setText.call(this,{text:t,formats:s})},getText(e){const t=this.props.getType(e)
return this.getPluginByType(t).getText.call(this,e)},getPluginByType(e){if(!(e in this.registeredPlugins))throw new Error(`Unexpected plugin type: ${e}`)
return this.registeredPlugins[e]},getPluginByItem(e){return this.getPluginByType(this.props.getType(e))},getItemProps(e,t){const s=this.getPluginByItem(e)
return null!=s.component.getItemProps?s.component.getItemProps.call(this,e,t):void 0},itemFromHTML(e,t){const s=JSON.parse(e.attr("data-mediocre-item"))
s.cid=o.default.uniqueId("item")
const i=this.getPluginByItem(s),n=e.attr("data-origin")
if(!i.canPasteFromOtherTenant&&n&&n!==(0,I.Dp)()){ne.ZP.warn(`Some items could not be pasted from ${n} and were skipped.`,{id:"mediocre-cross-tenant-paste"})
ye.um("User tried to paste content from a different Benchling tenant",{extra:{pluginType:i.type,itemOrigin:n,currentOrigin:(0,I.Dp)()}})
return null}return i.itemFromHTML.call(this,e,s,t)},itemToHTML(e){const t=this.getPluginByItem(e),s=r()("<div></div>").attr("data-mediocre-item",JSON.stringify(o.default.omit(e,"cid","taskId","task")))
s.attr("data-origin",(0,I.Dp)())
return t.itemToHTML.call(this,s,e)},withUpdatedText(e,{text:t,formats:s}){const i=this.props.getType(e)
return f()(e,this.setText(i,{text:t,formats:s}))},updateItemText(e,{text:t,formats:s}){const i=this.props.getType(this.atIndex(e)),n=f()(this.props.getRoot(),this.props.itemsAccessor((0,I.kv)(e,this.setText(i,{text:t,formats:s}))))
this.props.updateRoot(n,{performTableEvaluation:!1})},replaceItemsDefault(e,t,...s){if(!this.isReplaceItemsAllowedOrWarn(e,t,...s))return!1
const i=f()(this.props.getRoot(),this.props.itemsAccessor({$splice:[[e,t,...Array.from(s)]]}))
this.props.updateRoot(i)
return!0},getSelectors(){return this.props.getRoot().selectors},async _resolveSelectorsFromPastedItems(e,t){const s=e.filter((e=>e.type===this.tableType)).map((e=>e.table.table)),i=o.default.chain(Array.from(t)).filter((e=>r()(e).is("[data-selectors]"))).map((e=>JSON.parse(r()(e).attr("data-selectors")))).flatten().uniq((e=>e.staticId)).value()
return await(0,v.L)({pastedTables:s,pastedSelectors:i,existingSelectors:this.getSelectors()})},async parseItemsFromClipboard(e,t){if(ce.Z.typesContains(e.clipboardData.types,"text/html")){const s=ce.Z.getHTMLData(e.clipboardData),i=ce.Z.jQuerySafeParseHTML(s),n=`[data-mediocre-editor='${this.editorName()}']`,a=i.find(n).addBack(n)
if(a.length){e.preventDefault()
const s=o.default.compact(Array.from(a).map((e=>this.itemFromHTML(r()(e),t)))),i=await this._resolveSelectorsFromPastedItems(s,a),n=this.props.usedTableNames(),{items:l,names:d}=this.convertItemsForPaste(s,n,this.getInitialState().editorProps.fileId)
n.push(...d)
return{items:l,selectors:i}}}const s=ce.Z.extractImageFromPaste(e)
if(!s){e.preventDefault()
return await this.convertWyciwypPartsToItems(e.clipboardData)}const i=await s
return i?this.parseItemsFromFile(i):{}},processItemsForHTMLClipboard(e){const t=e.map((e=>{const t=this.itemToHTML(e)
t.attr("data-mediocre-editor",this.editorName())
this.props.getType(e)===this.tableType&&t.attr("data-selectors",JSON.stringify(this.getSelectors()))
return t.get(0)}))
return r()("<div>").append(t).html()},processItemsForTextClipboard(e){return e.map((e=>function __guard__(e,t){return null!=e?t(e):void 0}(this.getPluginByItem(e).itemToText,(t=>t.call(this,e))))).filter((e=>null!=e)).join("\n")},makeEditorPropsBase:e=>({fileId:e.fileId,locked:e.locked,storeState:e.storeState,restoreState:e.restoreState,requestSelection:e.requestSelection,getCid:e.getCid,getContent:e.getContent,deleteTableRows:e.deleteTableRows,deleteTableColumns:e.deleteTableColumns,insertTableRowsAbove:e.insertTableRowsAbove,insertTableRowsBelow:e.insertTableRowsBelow,insertTableColumnsLeft:e.insertTableColumnsLeft,insertTableColumnsRight:e.insertTableColumnsRight,renameTable:e.renameTable,performTableOp:e.performTableOp,isTableNameUsed:e.isTableNameUsed,mergeTableRegion:e.mergeTableRegion,unmergeTableRegion:e.unmergeTableRegion,lookUpTableNameWithActiveEdit:e.lookUpTableNameWithActiveEdit,tryInsert:e.tryInsert,canInsert:e.canInsert,setContent:e.setContent,extraUsedTableNames:e.extraUsedTableNames,setMultiEditingForTable:e.setMultiEditingForTable,updateSelectors:e.updateSelectors,usedTableNames:e.usedTableNames,getType:e.getType,viewer:e.viewer,spreadsheetTypes:e.spreadsheetTypes}),getInitialState(){return{editorProps:this.makeEditorProps(this.props),maximizedTableCid:null}},UNSAFE_componentWillMount(){const e=["multiSelectKey","makeItem","isItemTextual","itemHasText","insertItemHandler","editorName","getDocumentVersionCid","tableType","textType","headerType","descType","defaultInsertType","parseItemsFromFile","replaceItems","deleteRangeHandler","getHeaderType","canItemHaveHeader","headerTypeAccessor","getExtraTypingPerfMetadata","getComputedTables","isVirtualizationSupported","makeEditorProps"]
for(var t of Array.from(e))if(null==this[t])throw new Error(`${this.constructor.displayName} requires method '${t}'.`)
for(const e in this.registeredPlugins){const s=this.registeredPlugins[e]
for(t of Array.from(s.component.required))if(null==this[t])throw new Error(`${this.constructor.displayName}'s plugin '${e}' requires method '${t}'.`)}this.typingPerfId=q.BL(`${P.ZP.apiIdToType(this.props.fileId)}_editor_input`,{enabled:!0,getMetadata:this._getTypingPerfMetadata},{interval:Te,aggregations:[q.Pe.MEDIAN,q.Pe.MAX]})},componentDidMount(){this._isMounted=!0},UNSAFE_componentWillReceiveProps(e){const t=this.makeEditorProps(e)
c()(t,this.state.editorProps)||this.setState({editorProps:t})
null!=this.state.maximizedTableCid&&-1===this.getIndex(this.state.maximizedTableCid)&&this.setMaximizedTable(null)},componentWillUnmount(){q.sT(this.typingPerfId)
this._isMounted=!1},renderMaximizedTable(){const e=this.getIndex(this.state.maximizedTableCid),t=this.props.getItems(this.props.getRoot())[e],s=this.props.getType(t),i=this.getPluginByType(s)
let n
if(s===x.ZP.TABLE){const s=G.Z.getTableItemProps.call(this,t)
n=G.Z.makeTable.call(this,t,e,this.state.editorProps,_objectSpread(_objectSpread({},s),{},{isMaximized:!0}),R.xH)}else{const s=this.getItemProps(t,e)
n=i.component.make.call(this,t,e,this.state.editorProps,_objectSpread(_objectSpread({},s),{},{isMaximized:!0}),R.xH)}return d.createElement("div",{className:"tableEditable-maximizedWrapper"},n)},setMaximizedTable(e){this.setState({maximizedTableCid:e})
"function"==typeof this.onSetMaximizedTable&&this.onSetMaximizedTable(e)},shouldRenderMaximizedTable(){return null!=this.state.maximizedTableCid&&-1!==this.getIndex(this.state.maximizedTableCid)},_getTypingPerfMetadata(){return o.default.extend({file_id:this.props.fileId},this.getExtraTypingPerfMetadata())},isReplaceItemsAllowedOrWarn(e,t,...s){const i=s.map((e=>this.props.getCid(e))),n=this.props.getItems(this.props.getRoot()).slice(e,e+t).filter((e=>!i.includes(this.props.getCid(e))))
for(const e of n){const t=this.getReasonForDisallowedAction(e,ue.p.DELETE)
if(t){this.props.undoStoreState()
ne.ZP.warn(t,{id:"mediocre-replace-items-blocked"})
return!1}}return!0},getReasonForDisallowedAction(e,t){var s,i
return null==(s=(i=this.getPluginByItem(e)).getReasonForDisallowedAction)?void 0:s.call(i,e,t)},selectionInit(e){return this.getPluginByItem(e).component.selectionInit.call(this,e)},selectionAtStart(e){return this.getPluginByItem(e).component.selectionAtStart.call(this,e)},selectionAtEnd(e){return this.getPluginByItem(e).component.selectionAtEnd.call(this,e)},selectionAtItem(e){const t=this.props.getItems(this.props.getRoot()).indexOf(e)
return this.computeState({multiStartIndex:t,multiEndIndex:t,multiSelIndex:t})},selectionAll(e){return this.getPluginByItem(e).component.selectionAll.call(this,e)},hasSelectionAll(e){return null!=this.getPluginByItem(e).component.selectionAll},setSelectionAbove(e){if(0===e)return
const t=this.atIndex(e-1)
this.props.requestSelection(this.selectionAtEnd(t))},setSelectionBelow(e){if(e===this.lastIndex())return
const t=this.atIndex(e+1)
this.props.requestSelection(this.selectionAtStart(t))},createDefaultableItem(e,t=null){const{component:s}=this.getPluginByType(e)
null==t&&(t=s.default.call(this))
let i=this.makeItem(e)
i=f()(i,this.props.setContent(e,t))
return i},getItemWithUpdatedContent(e,t){const s=this.props.getType(e)
return f()(e,this.props.setContent(s,t))},insertDefaultableItemHandler(e,t,s=null){const i=this.createDefaultableItem(t,s)
this.itemInsertHandler(e,i)},itemInsertHandler(e,...t){t=t.map((t=>_objectSpread(_objectSpread({},t),{},{indentation:this._getIndentationOfItemFromBase(this.atIndex(e),t)})))
if(!this.replaceItems(e+1,0,...t))return
this.clearMultiSelect()
const s=t[t.length-1]
this.props.requestSelection(this.selectionInit(s))
let i
if(-1===e)i=this.selectionAtStart(this.atIndex(0))
else{const t=this.atIndex(e);(0,b.hu)(null!=t,"[BNCH-6442] Item not found - is the index out of bounds?",{index:e})
i=this.selectionAtEnd(t)}this.props.storeState(i)},copyItemWithoutText(e,t){const s=this.atIndex(e)
let i=s
this.itemHasText(s)&&(i=this.withUpdatedText(s,{text:"",formats:he.Z.defaultFormats()}))
t.clipboardData.setData("text/html",this.processItemsForHTMLClipboard([i]))
t.clipboardData.setData("text/plain",this.processItemsForTextClipboard([i]))},copyItem(e,t){const s=this.atIndex(e)
t.clipboardData.setData("text/html",this.processItemsForHTMLClipboard([s]))
t.clipboardData.setData("text/plain",this.processItemsForTextClipboard([s]))},itemDeleteHandler(e){let t,s,i
this.props.storeState({selection:me.xH()})
if(e>0){t=this.atIndex(e-1)
i=this.selectionAtEnd(t)
s=[]}else if(this.lastIndex()>=1){t=this.atIndex(1)
i=this.selectionAtStart(t)
s=[]}else{t=this.createDefaultableItem(this.defaultInsertType)
i=this.selectionInit(t)
s=[t]}this.replaceItems(e,1,...s)&&this.props.requestSelection(i)},_itemUpdateHelper(e,t){const s=this.props.getType(this.atIndex(e))
return f()(this.props.getRoot(),this.props.itemsAccessor((0,I.kv)(e,this.props.setContent(s,t))))},itemUpdateHandler(e,t){const s=this._itemUpdateHelper(e,t),i=null==this.requiresTableEvaluationOnUpdate||this.requiresTableEvaluationOnUpdate(this.atIndex(e))
this.props.updateRoot(s,{performTableEvaluation:i})},tableUpdateHandler(e,t,s){y.OZ(W.ZP.MODULES.ENTRY,W.ZP.CREATE_EDIT_TABLE)
let i=this._itemUpdateHelper(e,t)
null!=s&&(i=f()(i,{$merge:{selectors:s}}))
this.props.updateRoot(i)},itemMouseOverHandler(e,t){this.multiEditableMouseOverHandler(e,t)},itemMouseMoveHandler(e,t){this.multiEditableMouseMoveHandler(e,t)},itemMouseDownHandler(e,t){const s="1"===r()(t.target).closest("[data-mediocre-item-select]").attr("data-mediocre-item-select"),i="1"===r()(t.target).closest("[data-mediocre-item-buffered-select]").attr("data-mediocre-item-buffered-select"),n=this.isItemTextual(this.atIndex(e))||i
this.multiEditableMouseDownHandler({start:e,active:!0,allowSingleOverride:s,isMultiExpandBuffered:n},t)},textItemUpdateHandler(e,t){q.L8(this.typingPerfId)
const{text:s,formats:i}=t
this.updateItemText(e,{text:s,formats:i})
this.props.requestSelection({selection:t.selection||me.xH()})},textItemMergeUpHandler(e,t){let s
const{anchor:i}=t,n=this.atIndex(e)
if(n.indentation>0&&!i){s=f()(n,{$merge:{indentation:n.indentation-1,listType:null}})
!this.replaceItems(e,1,s)
return}const mergeItems=e=>{let t,i,n
const r=this.atIndex(e),o=this.atIndex(e+1),a=this.itemHasText(r),l=this.isItemTextual(o)
a&&(t=this.getText(r))
l&&(i=this.getText(o))
if(a&&l){const o=t.text.length,a=r.text.length,l=he.Z.joinFormats(t.formats,i.formats,o)
n=t.text+i.text
s=this.withUpdatedText(r,{text:n,formats:l})
if(!this.replaceItems(e,2,s))return
const{start:d,end:p}=he.Z.getSelectionIndicesFromFormatIndices(l,a,a)
this.props.requestSelection({selection:{cid:this.props.getCid(s),start:d,end:p}})}else if(a&&!t.text.length){if(!this.replaceItems(e,1))return
this.props.requestSelection(this.selectionAtStart(o))}else if(!a&&this.hasSelectionAll(r))this.props.requestSelection(this.selectionAll(r))
else if(!l&&this.hasSelectionAll(o))this.props.requestSelection(this.selectionAll(o))
else if(l&&!i.text.length){if(!this.replaceItems(e+1,1))return
this.props.requestSelection(this.selectionAtEnd(r))}}
i?e+1<this.props.getItems(this.props.getRoot()).length&&mergeItems(e):e-1>=0&&mergeItems(e-1)},pasteHandler(e,t,s){const{before:i,selected:n,after:r,originalEvent:o}=t,a=this.atIndex(e),l=he.Z.splitFormats(a.formats,i.length).before.internalLink.length+i.length<me.xH().start,d=he.Z.splitFormats(this.getText(a).formats,i.length,l).before,p=he.Z.splitFormats(this.getText(a).formats,i.length+n.length,l).after,c=this.props.getType(a),u=f()(a,this.setText(c,{text:i,formats:d}))
this.pasteRangeHandler({start:e,end:e,replacement:u,after:{text:r,formats:p},originalEvent:o},s)},formatRangeHandler({start:e,end:t,format:s,data:i}){(0,b.hu)(e<=t)
if([T.Z.DAY,T.Z.CYCLE_HEADER].includes(s))return
const n=this.subList(e,t),r=n.filter((e=>this.itemHasText(e))),a=r.map((e=>this.getText(e))),l=he.Z.formatTexts(a,{format:s,data:i}),d=o.default.object(r.map((e=>this.props.getCid(e))),l),p=n.map((e=>{const t=d[this.props.getCid(e)]
return null!=t?f()(e,this.setText(this.props.getType(e),t)):e}))
this.replaceItems(e,t-e+1,...p)},deleteRangeHandlerDefault({start:e,end:t}){let s,i,n
if(e>0){s=this.atIndex(e-1)
n=this.selectionAtEnd(s)
i=[]}else if(this.lastIndex()>t){s=this.atIndex(t+1)
n=this.selectionAtStart(s)
i=[]}else{s=this.createDefaultableItem(this.defaultInsertType)
n=this.selectionInit(s)
i=[s]}if(this.replaceItems(e,t-e+1,...i)){this.clearMultiSelect()
this.props.requestSelection(n)}},inputRangeHandler({start:e,end:t,text:s}){const i=this.atIndex(e),n=this.isItemTextual(i)?this.props.getType(i):this.textType,r=this.withUpdatedText(this.makeItem(n),{text:s,formats:he.Z.defaultFormats()})
this.replaceItems(e,t-e+1,r)&&this.props.requestSelection(this.selectionAtEnd(r))},async convertWyciwypPartsToItems(e){let t,s,i,n=0
const r=this.props.usedTableNames(),o=[]
let a=null
const l=ce.Z.processClipboard(e,{allowTables:null!=this.tableType,allowHeaders:this.headerType!==this.textType,parseHTML:!this.state.atSignState}),setIndentation=({indentation:e,listType:t})=>{const s="function"==typeof this.withUpdatedListStyle?this.withUpdatedListStyle(a,{indentation:e,listType:t}):void 0
a=null!=s?s:a
o[o.length-1]=a},addPart=e=>{if(null!=this.makeItemFromWyciwypPart)({item:a}=this.makeItemFromWyciwypPart(e,r))
else{({text:s,formats:t,type:i}=e)
a=(()=>{switch(i){case ce.Z.TABLE:{const e=w.Z.util.uniqueTableName(r)
r.push(e)
const t=f()(s,{$merge:{name:e,table:s.table.map(((e,t)=>e.map(((e,s)=>(0,K.Z)(e,{row:t,column:s})))))}})
return f()(this.makeItem(this.tableType),this.props.setContent(this.tableType,{table:t}))}case ce.Z.HEADER:return this.withUpdatedText(this.makeItem(this.headerType),{text:s,formats:t})
case ce.Z.DESC:return this.withUpdatedText(this.makeItem(this.descType),{text:s,formats:t})
default:return this.withUpdatedText(this.makeItem(this.textType),{text:s,formats:t})}})()}o.push(a)}
l.some((e=>null!=e.listType&&0===e.indentation))&&ye.ZK("T6698: MediocreEditor.convertWyciwypPartsToItems generated bad indentation",{extra:e.getData("text/html")})
const d=await(0,v.O)({pastedTables:l.filter((e=>e.type===ce.Z.TABLE)).map((e=>e.text.table)),existingSelectors:this.getSelectors(),selectorsEnabled:!0})
for(const e of Array.from(l)){var p,c;({text:s,formats:t,type:i,indentation:p,listType:c}=e)
addPart(e)
if(null!=p){n=Math.max(n,p)
setIndentation({indentation:p=Math.max(Math.min(p,pe.uv),0),listType:c})}}n>pe.uv&&ye.um(`${pe.uv} levels of indentation exceeded: ${n}`)
return{items:o,selectors:d}},convertItemForPaste(e,t,s=[],n){let r=null,a=null,l=null
n&&(l=P.ZP.isEntryOrSubOrWorkflowTemplate(n))
if(null!=this.tableType&&this.props.getType(e)===this.tableType){({name:r}=e.table)
a=r
if(Array.from(t).includes(r)){r=w.Z.util.uniqueTableName(t,w.Z.util.extractTableNamePrefix(e.table.name))
e.table.name=r}}else if(this.props.getType(e)===V.DATA_TABLE&&null!=e.item){({name:r}=e.item.config)
a=r
if(Array.from(t).includes(r)){r=w.Z.util.uniqueTableName(t,w.Z.util.extractTableNamePrefix(e.item.config.name))
e.item.config.name=r}}else if(this.props.getType(e)===V.DATA_TABLE_CONFIG&&null!=e.item){({name:r}=e.item)
a=r
if(Array.from(t).includes(r)){r=w.Z.util.uniqueTableName(t,w.Z.util.extractTableNamePrefix(e.item.name))
e.item.name=r}if(!l){const t=(0,be.m_)(x.ZP.NOTE_LINKED_OBJECT)
t.item=Ie.Ai(e.item)
e=t}}else if([V.REGISTRATION_TABLE,V.REGISTRATION_TABLE_CONFIG,V.TRANSFER_TABLE,V.TRANSFER_TABLE_CONFIG].includes(this.props.getType(e))&&null!=e.item){({name:r}=e.item)
a=r
if(Array.from(t).includes(r)){r=w.Z.util.uniqueTableName(t,w.Z.util.extractTableNamePrefix(e.item.name))
e.item.name=r}}else if(this.props.getType(e)===k.KE.STRUCTURED_TABLE){a=e.item.name;({item:e,name:r}=convertStructuredTableForPaste(e,t,n))}else if(this.props.getType(e)===k.KE.NOTE_LINKED_GROUP){({name:r}=e.item)
a=r
if(Array.from(t).includes(r)){r=w.Z.util.uniqueTableName(t,w.Z.util.extractTableNamePrefix(e.item.name))
e.item.name=r}for(let s=0;s<e.item.containedNoteParts.length;s++)if(this.props.getType(e.item.containedNoteParts[s].item)===k.KE.STRUCTURED_TABLE){const i=convertStructuredTableForPaste(e.item.containedNoteParts[s],t,n)
e.item.containedNoteParts[s]=i.item
"MIXTURE_METADATA"===e.item.containedNoteParts[s].item.kind?e.item.containedNoteParts[s].item.name=`${r} mixture`:"MIXTURE_INGREDIENTS"===e.item.containedNoteParts[s].item.kind&&(e.item.containedNoteParts[s].item.name=`${r} ingredients`)}e=(0,i.ZP)(e,(e=>{e.item.provenanceUuid=(0,g.Z)()
e.item.cid=o.default.uniqueId("nlg")
n&&(e.item.isConfig=l)}))}else if(this.props.getType(e)===x.ZP.NOTE_FILL_IN_TEXT_BOX){a=e.item.name
s.includes(a)&&(r=(0,S.W)(s,a,{allowNoSuffix:!0,addSpaceAfterPrefix:!0}))
e=(0,i.ZP)(e,(e=>{e.item.provenanceUuid=(0,g.Z)()
e.item.name=r||e.item.name
e.item.cid=o.default.uniqueId("note-fill-in-text-box")}))}else this.props.getType(e)===k.KE.NOTE_LINKED_ASSAY_DATA&&(e=(0,i.ZP)(e,(t=>{t.item=Ee.BF(e.item)})))
return{addedItem:e,newName:r,oldName:a}},getTextBoxNames(){var e
return(null==(e=this.props.getRoot().noteParts)?void 0:e.filter((e=>(0,k.YE)(e)&&(0,E.TO)(e.item))).map((e=>e.item.name)))||[]},convertItemsForPaste(e,t,s){const i={},n=[],r=this.getTextBoxNames()
for(const o of e){const{addedItem:e,newName:a,oldName:l}=this.convertItemForPaste(o,t,r,s)
if(this.props.getType(o)===x.ZP.NOTE_FILL_IN_TEXT_BOX)r.push(a)
else{t.push(a)
i[l]=a}n.push(e)}n.forEach((e=>{if(null!=this.tableType&&this.props.getType(e)===this.tableType){const t=e.table.table
for(const e of t)for(const t of e)t.text=re.ZP.updateCellReferencesForPaste(t.text,i)}else if(this.props.getType(e)===k.KE.STRUCTURED_TABLE){const t=e.item
for(const e of t.rows)for(const t of e.cells){const e=re.ZP.updateCellReferencesForPaste(t.text,i)
t.text=e}for(const e of t.columns){const t=re.ZP.updateCellReferencesForPaste(e.defaultValue.text,i)
e.defaultValue.text=t}}else if(null!=e.item&&this.props.getType(e)===V.DATA_TABLE_CONFIG)for(const t of e.item.columns){const e=re.ZP.updateCellReferencesForPaste(t.defaultValue.text,i)
t.defaultValue.text=e}}))
return{items:n,names:Object.values(i)}},pasteRangeHandler({start:e,end:t,replacement:s,after:i,originalEvent:n},r){let o,a,l,d,p,c,u,m
this.saveMultiSelect()
if(null!=s){l=s
o=[l]}else{l=null
o=[]}const addText=(e,t,s)=>{null==s&&(s={});({newHeaderType:d,newListType:c,newIndentation:p,isNewText:u}=s)
if(""===l.text){null!=d&&this.canItemHaveHeader(l)&&(l=f()(l,this.headerTypeAccessor({$set:d})))
null!=c&&null!=p&&null!=this.withUpdatedListStyle&&(l=this.withUpdatedListStyle(l,{indentation:p,listType:c}))}({text:m,formats:a}=this.getText(l))
if(u&&he.Z.isUnformatted(t))({text:m,formats:a}=he.Z.replaceText(a,{before:m,selected:"",after:""},e))
else{a=he.Z.joinFormats(a,t,m.length)
m+=e}l=this.withUpdatedText(l,{text:m,formats:a})
o[o.length-1]=l}
this.parseItemsFromClipboard(n,r).then((({items:s,selectors:n})=>{let r
if(!this._isMounted)return
if(null==s||0===s.length){ce.Z.warnForNoData()
return}const a=l
for(let e=0;e<s.length;e++){var d
r=s[e]
if((null==a||null==(d=a.item)?void 0:d.type)!==x.ZP.NOTE_FILL_IN_TEXT_BOX)if(0===e&&null!=l&&this.isItemTextual(r))if(this.isItemTextual(l))addText(r.text,r.formats,{isNewText:!0,newHeaderType:this.getHeaderType(r),newListType:"function"==typeof this.getListType?this.getListType(r):void 0,newIndentation:"function"==typeof this.getIndentation?this.getIndentation(r):void 0})
else if(1===s.length)addText(r.text,r.formats,{isNewText:!0})
else{r.indentation=this._getIndentationOfItemFromBase(a,r)
l=r
o.push(r)}else{r.indentation=this._getIndentationOfItemFromBase(a,r)
l=r
o.push(r)}else{if(!this.isItemTextual(r)){ne.ZP.warn("Destination does not support paste of non-text items",{id:"textbox-non-text-paste",duration:10})
continue}e===s.length-1?addText(r.text,r.formats,{isNewText:!0}):addText(`${r.text}\n`,r.formats,{isNewText:!0})}}const p=this.selectionAtEnd(l)
if(null!=i&&i.text.length)if(this.itemHasText(l))addText(i.text,i.formats)
else{r=this.withUpdatedText(this.makeItem(this.textType),i)
l=r
o.push(r)}this.props.storeState({selection:me.xH()})
n&&this.props.updateSelectors(n)
this.replaceItems(e,t-e+1,...o)&&this.props.requestSelection(p)}))},_getIndentationOfItemFromBase(e,t){let s=0
null!=e&&null!=e.indentation&&(s=e.indentation)
return null==t.indentation?s:Math.min(s+t.indentation,pe.uv)},renderEditable(e,t){const s=this.props.getType(e)
if(null==this.getPluginByType(s))throw new Error(`Unexpected plugin type: ${s}`)
const i=this.props.getCid(e)
return d.createElement(Se,_extends({key:i,editor:this,index:t,item:e,showTimestamp:this.props.showTimestamps,isHighlighted:t===this.state.highlightIndex,selectedSubIndex:(null!=this.state.selected?this.state.selected.index:void 0)===t?this.state.selected.subIndex:void 0,isSelected:this.isSelected(t),isBeforeInsert:t===this.state.insertIndex,editorProps:this.state.editorProps,itemProps:this.getItemProps(e,t),permissions:this.props.permissions},(0,R.sK)(this.state.searchState,i)))},_getRenderedItems(e,t){const s=t.slice(e.start,e.end).map(((t,s)=>this.renderEditable(t,Math.max(e.start,0)+s)))
return"function"==typeof this.postProcessRenderedItems?this.postProcessRenderedItems(e,s):s},setSearchState(e){this.setSelection(me.xH())
this.setState({searchState:e})},isVirtualizationEnabled(){return this.isVirtualizationSupported()&&!this.props.viewer},renderEditor(e){null==e&&(e=Ce)
const t=this.props.getRoot(),s=this.props.getItems(t)
return d.createElement("div",{className:l()({editor:!0,"show-placeholders":1===s.length&&this.props.getType(s[0])===this.textType}),"data-editor":this.props.editorKey,ref:"editor"},this.renderFocusBearer(),this.isVirtualizationEnabled()&&d.createElement(CtrlFInput,{key:"ctrl-f",docRoot:t,editor:this,searchState:this.state.searchState,setSearchState:this.setSearchState,requestSelection:this.props.requestSelection}),d.createElement(VirtualizedList,{documentVersionCid:this.getDocumentVersionCid(),isVirtualizationEnabled:this.isVirtualizationEnabled()},this._getRenderedItems(e,s)))}},ve={createClass(e){o.default.defaults(e,{mixins:[]})
const t=[xe,le.Z,de.Z,Re]
e.mixins.push(...Array.from(t||[]))
e.registeredPlugins={}
for(const t of Array.from(e.plugins))e.registeredPlugins[t.type]=t
return m()(e)}}},616447:(e,t,s)=>{s.d(t,{Z:()=>m})
var i=s(531041),n=s(927517),r=s(636878),o=s(252130),a=s(602652),l=s.n(a),d=s(573961),p=s(989526),c=s(261280)
const u={propTypes:{storeState:l().func,restoreState:l().func,metadataForRestore:l().object,multiEditing:l().bool},getInitialState:()=>({multiStartIndex:null,multiEndIndex:null,multiActive:null,multiSelIndex:null,multiActualIndex:null,multiExtra:{}}),UNSAFE_componentWillMount(){const e=["previousIndex","nextIndex","firstIndex","lastIndex","compareIndex","multiSelectKey","isIndexBetween","multiKeyDownHandler","multiInputHandler","multiPasteHandler","multiGetHTMLForCopy","isLockedWithEditWarn"]
for(const t of Array.from(e))if(null==this[t])throw new Error(`${this.constructor.displayName} must implement ${t}.`)
c.l5(this.props.metadataForRestore,this.multiSelectKey(),this.setState.bind(this))},componentDidMount(){c._4(this._multiWindowMouseDownHandler,this._multiWindowMouseUpHandler)},componentWillUnmount(){c.dk(this._multiWindowMouseDownHandler,this._multiWindowMouseUpHandler)},_multiWindowMouseDownHandler(e){const t={multiEditing:this.props.multiEditing,multiCanInsert:this.multiCanInsert,multiNamespace:this.multiNamespace?this.multiNamespace():void 0,multiFinalizeEditHandler:this.multiFinalizeEditHandler,domNode:d.findDOMNode(this),multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,setMultiEditing:this.setMultiEditing,setState:this.setState.bind(this),multiActive:this.state.multiActive,multiCrossEditing:!!this.multiCrossEditing&&this.multiCrossEditing()}
c.tb(e,t)},_multiWindowMouseUpHandler(e){const t={multiEditing:this.props.multiEditing,multiCanInsert:this.multiCanInsert,multiNamespace:this.multiNamespace?this.multiNamespace():void 0,multiFinalizeEditHandler:this.multiFinalizeEditHandler,domNode:d.findDOMNode(this),multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,setMultiEditing:this.setMultiEditing,setState:this.setState.bind(this),multiActive:this.state.multiActive,multiCrossEditing:!!this.multiCrossEditing&&this.multiCrossEditing()}
c.WU(e,t)},UNSAFE_componentWillReceiveProps(e){c.SO(this.props,e,this.multiSelectKey(),this.setState.bind(this))},focusBearerRef:(0,p.createRef)(),componentDidUpdate(){const e={domNode:d.findDOMNode(this),multiEditing:this.props.multiEditing,improperFocusHook:this.improperFocusHook,multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,focusBearerNode:d.findDOMNode(this.focusBearerRef.current)}
c.y0(e)},sortedMultiRange(){return c.qq(this.state.multiStartIndex,this.state.multiEndIndex,this.compareIndex)},getSelectedRange(e){return c.dP(e,{multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,compareIndex:this.compareIndex})},saveMultiSelect(e){null==e&&({state:e}=this)
c.Ju(e,this.props.storeState,this.multiSelectKey())},clearMultiSelect(){c.ye(this.setState.bind(this))},setMultiExtra(e){c.Yi(e,this.setState.bind(this),this.state.multiExtra)},multiSelectSingle(e,t){const s={setState:this.setState.bind(this),multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,setMultiEditing:this.setMultiEditing,getMultiEditingText:this.getMultiEditingText,getMultiEditingTypedValue:this.getMultiEditingTypedValue,focusBearerNode:d.findDOMNode(this.focusBearerRef.current)}
c.t9(e,t,s)},multiCancelEdit(e){const t={setMultiEditing:this.setMultiEditing,getMultiEditingText:this.getMultiEditingText,getMultiEditingTypedValue:this.getMultiEditingTypedValue,focusBearerNode:d.findDOMNode(this.focusBearerRef.current)}
c.MW(e,t)},setMultiIndices({start:e,end:t,text:s}){const i={setState:this.setState.bind(this),setMultiEditing:this.setMultiEditing,getMultiEditingText:this.getMultiEditingText,getMultiEditingTypedValue:this.getMultiEditingTypedValue,focusBearerNode:d.findDOMNode(this.focusBearerRef.current)}
c.Vc({start:e,end:t,text:s},i)},isSelected(e){return c.VL(e,this.state.multiStartIndex,this.state.multiEndIndex,this.isIndexBetween)},hasMultiSelection(){return c.oO(this.state.multiStartIndex,this.state.multiEndIndex)},multiEditableMouseDownHandler(e,t){const s={multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,multiSelIndex:this.state.multiSelIndex,setState:this.setState.bind(this),allowSingleMultiSelect:this.allowSingleMultiSelect(),multiTryInsert:this.multiTryInsert,multiCrossEditing:!!this.multiCrossEditing&&this.multiCrossEditing(),multiFinalizeEditHandler:this.multiFinalizeEditHandler,isIndexBetween:this.isIndexBetween,compareIndex:this.compareIndex,setMultiEditing:this.setMultiEditing,getMultiEditingText:this.getMultiEditingText,getMultiEditingTypedValue:this.getMultiEditingTypedValue,focusBearerNode:d.findDOMNode(this.focusBearerRef.current),disallowShiftExpand:!1}
c.R$(e,t,s)},multiEditableMouseOverHandler(e){const t={setState:this.setState.bind(this),multiActive:this.state.multiActive,multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,multiExtra:this.state.multiExtra,disallowMultiExpand:!!this.props.disallowMultiExpand&&this.props.disallowMultiExpand(),multiCrossEditing:!!this.multiCrossEditing&&this.multiCrossEditing(),allowSingleMultiSelect:this.allowSingleMultiSelect,multiTryInsert:this.multiTryInsert,compareIndex:this.compareIndex,focusBearerNode:d.findDOMNode(this.focusBearerRef.current)}
c.f6(e,t)},multiEditableMouseMoveHandler(e,t){const s={setState:this.setState.bind(this),multiActive:this.state.multiActive,multiStartIndex:this.state.multiStartIndex,multiEndIndex:this.state.multiEndIndex,multiExtra:this.state.multiExtra,compareIndex:this.compareIndex}
c.Ow(e,t,s)},computeState(e){return c.uG(e,this.multiSelectKey())},renderFocusBearer(){const e={state:this.state,isLockedWithEditWarn:()=>this.isLockedWithEditWarn(),restoreState:this.props.restoreState,setState:(...e)=>this.setState(...e),setMultiEditing:this.setMultiEditing,getMultiEditingText:this.getMultiEditingText,getMultiEditingTypedValue:this.getMultiEditingTypedValue,firstIndex:this.firstIndex(),lastIndex:this.lastIndex(),multiSelectable:this,multiSelectKey:this.multiSelectKey(),multiSelIndex:this.state.multiSelIndex,multiKeyDownHandler:this.multiKeyDownHandler,multiInputHandler:this.multiInputHandler,multiPasteHandler:this.multiPasteHandler,multiGetHTMLForCopy:this.multiGetHTMLForCopy,multiGetTextForCopy:this.multiGetTextForCopy,ref:this.focusBearerRef}
return c.AQ(e)}},m=i.default.extend({},u,{isIndexBetween(e,t,s){this.compareIndex(e,t)>0&&([e,t]=Array.from([t,e]))
return this.compareIndex(e,s)<=0&&this.compareIndex(s,t)<=0},allowSingleMultiSelect:()=>!1,multiInputHandler({index:e,text:t}){const s=this.sortedMultiRange()
if(null==this.inputRangeHandler||null==s)return
this.saveMultiSelect()
const{start:i,end:n}=s
i===n&&""!==t||this.inputRangeHandler({start:i,end:n,text:t})},multiPasteHandler(e){const t=this.sortedMultiRange()
if(null==this.pasteRangeHandler||null==t){e.preventDefault()
return}this.saveMultiSelect()
const{start:s,end:i}=t
this.pasteRangeHandler({start:s,end:i,originalEvent:e})},multiArrowSelectHandler(e,t){const{up:s}=t
s?this.setMultiIndices({start:e,end:this.previousIndex(e)}):this.setMultiIndices({start:e,end:this.nextIndex(e)})
this.setSelection(null)},multiKeyDownHandler(e){let t,s,i
if(n.isTabKey(e)){e.preventDefault()
if(null!=this.tabRangeHandler&&!this.isLockedWithEditWarn()){this.saveMultiSelect();({start:s,end:t}=this.sortedMultiRange())
this.tabRangeHandler({start:s,end:t,shiftKey:e.shiftKey})}}else if(n.isADeleteKey(e)){e.preventDefault()
if(null!=this.deleteRangeHandler&&!this.isLockedWithEditWarn()){this.saveMultiSelect();({start:s,end:t}=this.sortedMultiRange())
this.deleteRangeHandler({start:s,end:t})}}else if(n.isUpKey(e)){e.preventDefault()
i=this.previousIndex(this.state.multiEndIndex)
e.shiftKey?this.setState({multiEndIndex:i}):this.setMultiIndices({start:i,end:i})}else if(n.isDownKey(e)){e.preventDefault()
i=this.nextIndex(this.state.multiEndIndex)
e.shiftKey?this.setState({multiEndIndex:i}):this.setMultiIndices({start:i,end:i})}else if(n.isCtrlA(e)){e.preventDefault()
this.setMultiIndices({start:this.firstIndex(),end:this.lastIndex()})}else if(n.isEnterKey(e)){({start:s,end:t}=this.sortedMultiRange())
if(s===t&&!this.isLockedWithEditWarn()){e.preventDefault()
this.insertItemHandler(s-1)}}else{const i=r.Z.formatTypeFromKeydown(e,{allowLink:!1})
if(i===o.Z.SYMBOL)return
if(null!=i){e.preventDefault()
if(null!=this.formatRangeHandler&&!this.isLockedWithEditWarn()){this.saveMultiSelect();({start:s,end:t}=this.sortedMultiRange())
this.formatRangeHandler({start:s,end:t,format:i})}}}}})},8237:(e,t,s)=>{s.d(t,{Z:()=>T})
var i=s(764403),n=s.n(i),r=s(250965),o=s.n(r),a=s(602652),l=s.n(a),d=s(989526),p=s(573961),c=s(531041),u=s(692013),m=s(938417),h=s(389528),f=s(263137),g=s(459561),S=s(36424),E=s(868710),y=s(334148),b=s(927517),I=s(808844)
function _extends(){_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]
for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}
return _extends.apply(this,arguments)}function _defineProperty(e,t,s){(t=function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}function _stopPropagationForMultiSelect(e){e.stopPropagation()}class FormatButton extends d.PureComponent{constructor(...e){super(...e)
_defineProperty(this,"clickHandler",(()=>{o()(p.findDOMNode(this.refs.btn)).tooltip("hide")
"function"==typeof this.props.clickHandler&&this.props.clickHandler(this.props.format)}))
_defineProperty(this,"mouseOverHandler",(()=>"function"==typeof this.props.mouseOverHandler?this.props.mouseOverHandler(this.props.format):void 0))
_defineProperty(this,"mouseOutHandler",(()=>"function"==typeof this.props.mouseOutHandler?this.props.mouseOutHandler(this.props.format):void 0))
_defineProperty(this,"mouseDownHandler",(e=>e.preventDefault()))}render(){return d.createElement(E.ZP,{title:this.props.tooltip,placement:E.TQ.BOTTOM,key:this.props.format,container:"body",delay:{show:300}},d.createElement(y.Co,{buttonStyle:y.ZJ.TERTIARY_GRAY,className:n()({hidden:!this.props.visible,"is-active":this.props.active}),disabled:!this.props.enabled,icon:this.props.icon,onClick:this.clickHandler,onMouseDown:this.mouseDownHandler,onMouseOut:this.mouseOutHandler,onMouseOver:this.mouseOverHandler,size:y.qE.MINI,text:this.props.text}))}}_defineProperty(FormatButton,"propTypes",{active:l().bool.isRequired,clickHandler:l().func,enabled:l().bool.isRequired,format:l().string.isRequired,mouseOutHandler:l().func,mouseOverHandler:l().func,icon:l().string,text:l().node,tooltip:l().string.isRequired,visible:l().bool.isRequired})
class FormatOption extends d.PureComponent{constructor(...e){super(...e)
_defineProperty(this,"clickHandler",(e=>"function"==typeof this.props.clickHandler?this.props.clickHandler(this.props.format,void 0,e):void 0))
_defineProperty(this,"mouseOverHandler",(()=>"function"==typeof this.props.mouseOverHandler?this.props.mouseOverHandler(this.props.format):void 0))
_defineProperty(this,"mouseOutHandler",(()=>"function"==typeof this.props.mouseOutHandler?this.props.mouseOutHandler(this.props.format):void 0))
_defineProperty(this,"mouseDownHandler",(e=>{e.preventDefault()
_stopPropagationForMultiSelect(e)}))}render(){return d.createElement(g.q.Consumer,null,(({rootFolderId:e,fileId:t,templateCollectionId:s})=>{const i={projectId:e,fileId:t,templateCollectionId:s}
return d.createElement("li",_extends({disabled:!this.props.enabled,className:n()({disabled:!this.props.enabled,hidden:!this.props.visible,active:this.props.active,"dropdown-submenu":null!=this.props.submenu}),onMouseEnter:this.props.enabled?this.mouseOverHandler:void 0,onMouseLeave:this.props.enabled?this.mouseOutHandler:void 0},(0,f.Z)(this.props.dataTestAttrs)),d.createElement("a",{onClick:this.props.enabled?()=>this.clickHandler(i):void 0,onMouseDown:this.mouseDownHandler},null!=this.props.icon?d.createElement(S.Z,{className:(0,u.iv)(C.toolbarOptionIcon),icon:this.props.icon}):void 0,this.props.text),this.props.enabled?this.props.submenu:null)}))}}_defineProperty(FormatOption,"propTypes",{format:l().string.isRequired,text:l().node.isRequired,icon:l().string,active:l().bool.isRequired,enabled:l().bool.isRequired,visible:l().bool.isRequired,clickHandler:l().func,mouseOverHandler:l().func,mouseOutHandler:l().func,submenu:l().node,dataTestAttrs:h.C})
function ToolbarSection({section:e,enabled:t,isFinalSection:s,formatHandler:i,mouseOverHandler:n,mouseOutHandler:r}){const o=e.filter((e=>e.visible))
return d.createElement(d.Fragment,null,o.map((e=>d.createElement(FormatOption,{key:e.format,format:e.format,icon:e.icon,text:e.text,active:!1,enabled:t&&e.enabled,visible:e.visible,clickHandler:i,mouseOverHandler:n,mouseOutHandler:r,submenu:e.submenu,dataTestAttrs:e.dataTestAttrs}))),s||0===o.length?null:d.createElement("li",{className:"divider"}))}class StaticFormatToolbar extends d.Component{constructor(...e){super(...e)
_defineProperty(this,"tooltips",{bold:["Bold","B"],italic:["Italic","I"],monospace:["Code","Shift + K","Select text to toggle first."],underline:["Underline","U"],strikethrough:["Strikethrough","Shift + X"],subscript:["Subscript","Shift + ."],superscript:["Superscript","."],color:["Color"],link:["Link","K"],attach:["Attach Item"],table:["Insert Table"],text:["Insert Text"],left:["Align Left"],center:["Align Center"],important:["Toggle Important"],right:["Align Right"],HEADER:["Header"],STEP:["Step"],DESC:["Description"],AGGREGATE_TIME:["Aggregate Time"],CRITICAL:["Critical Point"],PAUSE:["Pause Point"],bullet:["Bullet"],number:["Number"],"checkbox-unchecked":["Checkbox"],print:["Print"],delete:["Remove Item"],selector:["View Selectors"]})
_defineProperty(this,"getBtnTitle",(e=>{const{format:t,tooltip:s,enabled:i}=e,[n,r,o]=Array.from(s||this.tooltips[t]),a=n+(null!=r?` (${b.ctrl} + ${r})`:"")
return i||!o?a:`${a}\n${o}`}))
_defineProperty(this,"renderDropdown",((e,t)=>{if(!t.visible)return null
const s=t.enabled&&t.dropdown.some((e=>e.some((({enabled:e})=>e))))
return d.createElement("div",{className:"buttonGroup",key:e},d.createElement(E.pf,{tooltipTitle:null!=t.tooltip?this.getBtnTitle(t):null},d.createElement(y.Co,{buttonStyle:y.ZJ.TERTIARY_GRAY,disabled:!s,icon:t.icon,isDropdown:!0,onMouseDown:_stopPropagationForMultiSelect,preventDropdownFocus:!0,size:y.qE.MINI,text:t.text,dataTestAttrs:t.dataTestAttrs})),d.createElement("ul",_extends({className:"dropdown-menu"},(0,f.Z)({component:"StaticFormatToolbar",element:"dropdownMenu"})),t.dropdown.map(((e,i)=>d.createElement(ToolbarSection,{key:i,section:e,enabled:s,isFinalSection:i===t.dropdown.length-1,formatHandler:this.props.formatHandler,mouseOverHandler:this.props.mouseOverHandler,mouseOutHandler:this.props.mouseOutHandler})))))}))
_defineProperty(this,"renderSingleComponentDropdown",((e,t)=>d.createElement("div",{className:"dropdown buttonGroup",key:e},d.createElement(E.ZP,{container:"body",delay:{show:300},key:t.format,placement:E.TQ.TOP,title:this.getBtnTitle(t)},d.createElement(y.Co,{buttonStyle:y.ZJ.TERTIARY_GRAY,className:"mediocre-toolbar-dropdownBtn",disabled:!t.enabled,icon:t.icon,isDropdown:!0,onMouseDown:_stopPropagationForMultiSelect,preventDropdownFocus:!0,size:y.qE.MINI,text:t.text})),t.enabled?d.createElement("div",{className:"dropdown-menu"},t.submenu):null)))
_defineProperty(this,"renderBtnGroup",((e,t,s)=>{let i,r
return c.default.any((()=>{const t=[]
for({visible:i,moreKey:r}of Array.from(e))t.push(i&&!r)
return t})())?d.createElement("div",{className:n()("u-display-inline-block",{buttonGroup:e.length>1,"u-tiny-spacing-left":s}),key:t},(()=>{const t=[]
for(let s=0;s<e.length;s++){const i=e[s]
i.moreKey||(null!=i.dropdown?t.push(this.renderDropdown(s,i)):null!=i.submenu?t.push(this.renderSingleComponentDropdown(s,i)):t.push(d.createElement(FormatButton,{active:i.active,clickHandler:this.props.formatHandler,enabled:i.enabled,format:i.format,icon:i.icon,key:i.format,mouseOutHandler:this.props.mouseOutHandler,mouseOverHandler:this.props.mouseOverHandler,text:i.text,tooltip:this.getBtnTitle(i),visible:i.visible})))}return t})()):null}))
_defineProperty(this,"renderInsert",(()=>{let e
return c.default.any((()=>{const t=[]
for({visible:e}of Array.from(this.props.inserts))t.push(e)
return t})())?d.createElement("div",{className:"buttonGroup u-tiny-spacing-left",onMouseEnter:this.props.insertMouseOverHandler,onMouseLeave:this.props.insertMouseOutHandler},d.createElement(y.Co,{buttonStyle:y.ZJ.TERTIARY_GRAY,isDropdown:!0,onMouseDown:_stopPropagationForMultiSelect,size:y.qE.MINI,text:"Insert"}),d.createElement("ul",{className:"dropdown-menu",role:"menu"},Array.from(this.props.inserts).map((e=>d.createElement(FormatOption,{key:e.key,format:e.key,icon:e.icon,text:e.text,active:!1,enabled:e.enabled,visible:e.visible,clickHandler:this.props.insertHandler,submenu:e.submenu}))))):null}))
_defineProperty(this,"renderPrint",(()=>{let e,t
return 0===this.props.printOptions.length?null:1===this.props.printOptions.length?d.createElement("div",{className:"buttonGroup",key:"btn-group-print"},d.createElement(FormatButton,{active:!1,clickHandler:this.props.printHandler,enabled:this.props.printOptions[0].enabled,format:this.props.printOptions[0].type,icon:"format-print",tooltip:"Print",visible:!0})):d.createElement("div",{className:"buttonGroup",key:"btn-group-print"},d.createElement(y.Co,{buttonStyle:y.ZJ.TERTIARY_GRAY,icon:"format-print",isDropdown:!0,onMouseDown:e=>e.stopPropagation(),size:y.qE.MINI}),d.createElement("ul",{className:"dropdown-menu",role:"menu"},(()=>{const s=[]
for({type:e,enabled:t}of Array.from(this.props.printOptions))s.push(d.createElement("li",{key:e,className:n()({disabled:!t})},d.createElement("a",{onMouseDown:function(e){return e.preventDefault()},onClick:t?this.props.printHandler.bind(null,e):void 0},`Print ${(0,I.co)(e.toLowerCase())}`)))
return s})()))}))
_defineProperty(this,"renderMore",(()=>{const e=c.default.flatten(this.props.groups,!0),t=c.default.filter(e,(({format:e,visible:t,moreKey:s})=>s&&t))
if(0===t.length)return null
const s=c.default.groupBy(t,(({moreKey:e})=>e)),i=c.default.keys(s).sort()
return d.createElement("div",{className:"buttonGroup u-tiny-spacing-left",key:"btn-group-more"},d.createElement(y.Co,{buttonStyle:y.ZJ.TERTIARY_GRAY,isDropdown:!0,onMouseDown:e=>e.preventDefault(),preventDropdownFocus:!0,size:y.qE.MINI,text:"More"}),d.createElement("ul",{className:"dropdown-menu",role:"menu"},Array.from(i).map(((e,t)=>d.createElement(d.Fragment,{key:e},s[e].map((e=>d.createElement(FormatOption,{key:e.format,format:e.format,text:this.getBtnTitle(e),icon:null,enabled:e.enabled,active:e.active,visible:e.visible,mouseOverHandler:this.props.mouseOverHandler,mouseOutHandler:this.props.mouseOutHandler,clickHandler:this.props.formatHandler}))),t!==i.length-1?d.createElement("li",{className:"divider"}):void 0)))))}))}static getPartition(e,{editorKey:t,index:s,subIndex:i}){const n=o()(e).find(`[data-editor='${t}']`).addBack(`[data-editor='${t}']`).find(`div[data-index='${s}']`).filter((function(){return o()(this).data("subindex")===i}))[0]
return null==n?null:m.ZT({target:n})}render(){const e=this.renderPrint(),t=this.renderInsert(),s=e||t
return d.createElement("div",{className:"mediocre-toolbar"},e,t,Array.from(this.props.groups).map(((e,t)=>this.renderBtnGroup(e,t,s||t>0))),this.renderMore())}}_defineProperty(StaticFormatToolbar,"propTypes",{formatHandler:l().func.isRequired,insertHandler:l().func.isRequired,insertMouseOverHandler:l().func,insertMouseOutHandler:l().func,mouseOverHandler:l().func.isRequired,mouseOutHandler:l().func.isRequired,groups:l().arrayOf(l().arrayOf(l().shape({active:l().bool.isRequired,dropdown:(e,t,...s)=>null==e.format?l().array.isRequired(e,t,...Array.from(s)):null!=e[t]?new Error('Did not expect "dropdown" prop if "format" passed.'):null,enabled:l().bool.isRequired,format:(e,t,...s)=>null==e.dropdown?l().string.isRequired(e,t,...Array.from(s)):null!=e[t]?new Error('Did not expect "format" prop if "dropdown" passed.'):null,moreKey:l().string,text:l().node,tooltip:l().arrayOf(l().string),visible:l().bool.isRequired}))).isRequired,inserts:l().array.isRequired,printOptions:l().arrayOf(l().shape({type:l().string.isRequired,enabled:l().bool.isRequired})).isRequired})
_defineProperty(StaticFormatToolbar,"defaultProps",{groups:[],inserts:[],printOptions:[]})
StaticFormatToolbar.__FormatOption=FormatOption
const T=StaticFormatToolbar,C=u.mM.create({toolbarOptionIcon:{marginRight:8}})},596999:(e,t,s)=>{s.d(t,{Z:()=>ft})
var i=s(764403),n=s.n(i),r=s(767807),o=s.n(r),a=s(250965),l=s.n(a),d=s(989526),p=s(573961),c=s(531041),u=s(468943),m=s(581197),h=s(669327),f=s(252130),g=s(385130),S=s(145007),E=s(270960),y=s(602652),b=s.n(y),I=s(6025),T=s(99312),C=s(561887),R=s(851422),x=s(40108),v=s(516164),k=s(636878),w=s(453772),_=s(390697),P=s(659443),M=s(8237),A=s(721911),N=s(974913),O=s(273870),L=s.n(O),H=s(232606),F=s(139788),D=s(414975),q=s(938417),Z=s(426076)
const{EditorKey:B}=E
class IntroEditable extends d.Component{render(){return d.createElement(F.Z,c.default.extend({},this.props,{allowRichText:!0,allowMultiline:!0,spellCheck:this.props.spellCheck}))}}!function _defineProperty(e,t,s){(t=function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}(IntroEditable,"propTypes",{cid:b().string.isRequired,text:b().string.isRequired,index:b().number.isRequired,locked:b().bool,spellCheck:b().bool.isRequired})
const U=L()({displayName:"IntroEditor",propTypes:{protocol:b().object.isRequired,jumpTo:b().func.isRequired,updateProtocol:b().func,spellCheck:b().bool.isRequired},mixins:[D.Z],getIntro(){return this.props.protocol.description},setIntro(e,t){(0,H.hu)(null!=e&&null!=t,"You must set intro and formats together")
this.props.updateProtocol({description:e,descriptionFormats:t})},moveHandler(e){const{up:t,beginning:s}=e
this.clearSelection()
const i=s?"start":"end",n=t?"last":"first",r=t?B.TITLE:B.MATERIALS
this.props.jumpTo({section:r,location:i,row:n})},updateHandler(e){const{text:t,formats:s,target:i}=e
this.setIntro(t,s)
this.props.requestSelection({selection:q.xH(e)})},pasteHandler(e){let t
const{before:s,selected:i,after:n,originalEvent:r}=e,o=Z.Z.processClipboard(r.clipboardData),a=this.props.protocol.descriptionFormats,l=k.Z.splitFormats(a,s.length).before,d=k.Z.splitFormats(a,s.length+i.length).after,p=s+(()=>{const e=[]
for(t of Array.from(o))e.push(t.text)
return e})().join("\n")+n
let c=s.length,u=l
for(let e=0;e<o.length;e++){t=o[e]
u=k.Z.joinFormats(u,t.formats,c)
c+=t.text.length
e!==o.length-1&&(c+=1)}u=k.Z.joinFormats(u,d,c)
const m=p.length-n.length
this.setIntro(p,u)
this.props.requestSelection({selection:{cid:this.props.cid,start:m,end:m}})},splitHandler(e){const{before:t,selected:s,after:i,cursor:n}=e,r=this.props.protocol.descriptionFormats,o=k.Z.splitFormats(r,t.length).before,a=k.Z.splitFormats(r,t.length+s.length).after,l=`${t}\n${i}`,d=k.Z.joinFormats(o,a,t.length+1),p=t.length+1
this.setIntro(l,d)
this.props.requestSelection({selection:{cid:this.props.cid,start:p,end:p}})},getInitialState:()=>({index:0}),render(){return d.createElement("div",{className:"intro-editor","data-editor":this.props.editorKey},d.createElement(IntroEditable,{cid:this.props.cid,text:this.props.protocol.description,index:this.state.index,formats:this.props.protocol.descriptionFormats,formatHandler:this.props.formatHandler.bind(null,this.state.index),moveHandler:this.moveHandler,updateHandler:this.updateHandler,pasteHandler:this.pasteHandler,splitHandler:this.splitHandler,storeState:this.props.storeState,restoreState:this.props.restoreState,locked:this.props.locked,spellCheck:this.props.spellCheck}))}})
var j=s(976771),$=s.n(j),V=s(616447),W=s(395282)
function MaterialsEditor_defineProperty(e,t,s){(t=function MaterialsEditor_toPropertyKey(e){var t=function MaterialsEditor_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}const{LEVEL_MATERIAL:K,LEVEL_COMPONENT:G}=g,{EditorKey:z}=E
function makeComponent(){return W.Z.makeComponent(...arguments)}function makeMaterial(){return W.Z.makeMaterial(...arguments)}class ComponentEditable extends d.Component{render(){return d.createElement(F.Z,c.default.extend({},this.props,{className:n()(this.props.className,"component-editable","multi-editable"),allowRichText:!0,cid:this.props.component.cid,text:this.props.component.raw_text,formats:this.props.component.formats,spellCheck:this.props.spellCheck}))}}MaterialsEditor_defineProperty(ComponentEditable,"propTypes",{component:b().shape({cid:b().string.isRequired,raw_text:b().string.isRequired,formats:b().object.isRequired}),index:b().arrayOf(b().number).isRequired,locked:b().bool,spellCheck:b().bool.isRequired})
class MaterialEditable extends d.Component{render(){return d.createElement(F.Z,c.default.extend({},this.props,{className:n()(this.props.className,"material-editable","multi-editable"),allowRichText:!0,cid:this.props.material.cid,text:this.props.material.name,formats:this.props.material.formats,spellCheck:this.props.spellCheck}))}}MaterialsEditor_defineProperty(MaterialEditable,"propTypes",{material:b().shape({cid:b().string.isRequired,name:b().string.isRequired,formats:b().object.isRequired}),index:b().arrayOf(b().number).isRequired,locked:b().bool,spellCheck:b().bool.isRequired})
const Y=L()({displayName:"MaterialsEditor",mixins:[D.Z,V.Z,$()],multiSelectKey:()=>"materials",propTypes:{protocol:b().object.isRequired,storeState:b().func.isRequired,restoreState:b().func.isRequired,jumpTo:b().func.isRequired,formatHandler:b().func.isRequired,updateProtocol:b().func,spellCheck:b().bool.isRequired,isLockedWithEditWarn:b().func.isRequired},isLockedWithEditWarn(){return this.props.isLockedWithEditWarn()},getMaterials(){return this.props.protocol.materials},setMaterials(e){this.props.updateProtocol({materials:e})},get(e){return W.Z.getMaterialByIndex(this.props.protocol,e)},materialTabHandler(e,t){const{shiftKey:s}=t,i=this.getMaterials(),[n]=Array.from(e),{material:r}=this.get(e)
if(1===(s?-1:1)&&n>0){const e=makeComponent(r.name,r.formats),s=[e].concat(r.components),a=o()(i,{$splice:[[n,1]]})
a[n-1]=o()(a[n-1],{components:{$push:s}})
this.setMaterials(a)
const l=q.xH(t)
l.cid=e.cid
this.props.requestSelection({selection:l})}},componentTabHandler(e,t){const{shiftKey:s}=t,i=this.getMaterials(),[n,r]=Array.from(e),{material:a,component:l}=this.get(e)
if(-1===(s?-1:1)){const e=o()(a,{components:{$splice:[[r,a.components.length-r]]}}),s=i[n].components.slice(r+1),d=makeMaterial(l.raw_text,l.formats,s),p=o()(i,{$splice:[[n,1,e,d]]})
this.setMaterials(p)
const c=q.xH(t)
c.cid=d.cid
this.props.requestSelection({selection:c})}},_moveHelper(e,t,s){const{up:i,beginning:n}=e
if(null!=t){const e=s===K?t.name:t.raw_text,i=n?0:e.length
this.props.requestSelection({selection:{cid:t.cid,start:i,end:i}})}else{this.clearSelection()
const e=n?"start":"end",t=i?z.INTRO:z.STEPS,s=i?"last":"first"
this.props.jumpTo({section:t,location:e,row:s})}},componentMoveHandler(e,t){const{up:s}=t,i=this.getMaterials(),[n,r]=Array.from(e),{material:o}=this.get(e),[a,l]=Array.from(s?r>0?[o.components[r-1],G]:[o,K]:r+1<o.components.length?[o.components[r+1],G]:[i[n+1]||null,K])
this._moveHelper(t,a,l)},materialMoveHandler(e,t){const{up:s}=t,i=this.getMaterials(),[n]=Array.from(e),{material:r}=this.get(e),[o,a]=Array.from((()=>{if(s){if(n>0){const e=i[n-1]
return e.components.length?[e.components[e.components.length-1],G]:[e,K]}return[null,null]}return r.components.length?[r.components[0],G]:[i[n+1]||null,K]})())
this._moveHelper(t,o,a)},materialUpdateHandler(e,t){const{text:s,formats:i}=t,n=this.getMaterials(),{material:r}=this.get(e),a=o()(r,{$merge:{name:s,formats:i}}),l=o()(n,{$splice:[[e,1,a]]})
this.setMaterials(l)
this.props.requestSelection({selection:q.xH(t)})},componentUpdateHandler(e,t){const{text:s,formats:i}=t,n=this.getMaterials(),[r,a]=Array.from(e),{material:l,component:d}=this.get(e),p=o()(d,{$merge:{raw_text:s,formats:i}}),c=o()(l,{components:{$splice:[[a,1,p]]}}),u=o()(n,{$splice:[[r,1,c]]})
this.setMaterials(u)
this.props.requestSelection({selection:q.xH(t)})},multiGetTextForCopy(){let e,t
const{start:s,end:i}=this.sortedMultiRange(),n=this.getMaterials()
let[r]=Array.from(this._splitAfter(n,i));[r,t,e]=Array.from(this._splitBefore(r,s))
const o=[]
for(var a of Array.from(t))o.push(`  - ${a.raw_text}`)
for(const t of Array.from(e)){o.push(t.name)
for(a of Array.from(t.components))o.push(`  - ${a.raw_text}`)}return o.join("\n")},multiGetHTMLForCopy(){let e,t
const{start:s,end:i}=this.sortedMultiRange(),n=this.getMaterials()
let[r]=Array.from(this._splitAfter(n,i));[r,t,e]=Array.from(this._splitBefore(r,s))
const o=[...Array.from(e)]
if(t.length){const e=makeMaterial("",k.Z.defaultFormats(),t)
o.unshift(e)}const a=l()("<ul></ul>")
for(const e of Array.from(o)){const t=l()("<li></li>")
t.html(k.Z.renderHTML(e.name,e.formats))
if(e.components.length){const s=l()("<ul></ul>")
for(const t of Array.from(e.components))s.append(l()("<li></li>").html(k.Z.renderHTML(t.raw_text,t.formats)))
t.append(s)}a.append(t)}return a[0].outerHTML},pasteHandler(e,t){let s,i,n,r,a,l
const{before:d,selected:p,after:c,originalEvent:u}=t,{material:m,component:h}=this.get(e),f=this.getMaterials(),g=Z.Z.processClipboard(u.clipboardData),S=null!=h?h:m,E=k.Z.splitFormats(S.formats,d.length).before,y=k.Z.splitFormats(S.formats,p.length+d.length).after
let[b,I,T]=Array.from(this._splitAfter(f,e));[b,l,r]=Array.from(this._splitBefore(b,e))
const C=[],R=[]
if(null!=h){const e=o()(h,{$merge:{raw_text:d,formats:E}})
C.push(e)
i=e
s=e}else{const e=o()(m,{$merge:{name:d,formats:E,components:[]}})
R.push(e)
i=e
n=e}function addComponent(e,t){const r=makeComponent(e,t)
null!=n?n.components.push(r):C.push(r)
i=r
s=r}function addText(e,t){if(i===n){n.formats=k.Z.joinFormats(n.formats,t,n.name.length)
n.name+=e
return{cid:n.cid,pos:n.name.length}}s.formats=k.Z.joinFormats(s.formats,t,s.raw_text.length)
s.raw_text+=e
return{cid:s.cid,pos:s.raw_text.length}}function addMaterial(e,t){const s=makeMaterial(e,t)
R.push(s)
i=s
n=s}for(let e=0;e<g.length;e++){const t=g[e],{type:s,formats:i,text:n}=t
0===e?addText(n,i):s===Z.Z.DESC?addComponent(n,i):addMaterial(n,i)}const x=addText(c,y),v=x.pos-c.length,w={cid:x.cid,start:v,end:v}
let[_,P]=Array.from(this._merge(b,C,R));[a,P]=Array.from(this._merge(_,I,T))
this.setMaterials(a)
this.props.requestSelection({selection:w})},splitHandler(e,t){let s,i,n,r
const{before:a,selected:l,after:d}=t,{material:p,component:u,model:m,level:h}=this.get(e),f=k.Z.splitFormats(m.formats,a.length).before,g=k.Z.splitFormats(m.formats,l.length+a.length).after
let S=[a,d],E={index:1,offset:0}
if(t.shiftKey){s=[f,g]
i=h===K?[K,G]:[G,K]}else if(S[0].length===S[1].length&&0===S[1].length){s=[f]
i=[K]
S=[""]
E={index:0,offset:0}}else{s=[f,g]
i=[h,h]}const y=this.getMaterials(),[b,I]=Array.from(e)
let T=c.default.clone(p)
T.components=[]
const C=[]
C.push(T)
let R=E.index
if(u){T.components=p.components.slice(0,I)
n=p.components.slice(I+1)}else{T.name=S[0]
T.formats=s[0]
if(i[0]!==K)throw new Error("Unsupported scenario.")
S.shift()
i.shift()
s.shift()
R--
r=T
n=p.components.slice()}for(const[e,t,n]of Array.from(c.default.zip(S,i,s))){var x,v
switch(t){case K:T=makeMaterial(e,n)
x=T
C.push(T)
break
case G:x=v=makeComponent(e,n)
C[C.length-1].components.push(v)}0===R&&(r=x)
R--}C[C.length-1].components.push(...Array.from(n||[]))
const w=o()(y,{$splice:[[b,1,...Array.from(C)]]})
this.setMaterials(w)
this.props.requestSelection({selection:{cid:r.cid,start:E.offset,end:E.offset}})},mergeHelper(e,t){let s
const i=this.getMaterials(),n=this.get(e),r=this.get(t)
switch(n.level){case K:{let[t]=Array.from(e),{material:a}=n
switch(r.level){case K:{const e=r.material,n=e.components,l=o()(a,{components:{$push:n},$merge:{name:a.name+e.name,formats:k.Z.joinFormats(a.formats,e.formats,a.name.length)}})
s=o()(i,{$splice:[[t,2,l]]})
break}case G:{const{component:e}=r,n=o()(a,{components:{$splice:[[0,1]]},$merge:{name:a.name+e.raw_text,formats:k.Z.joinFormats(a.formats,e.formats,a.name.length)}})
s=o()(i,{$splice:[[t,1,n]]})
break}}break}case G:{const[t,a]=Array.from(e),{material:l,component:d}=n
switch(r.level){case K:{const e=r.material,n=e.components
let p=o()(d,{$merge:{raw_text:d.raw_text+e.name,formats:k.Z.joinFormats(d.formats,e.formats,d.raw_text.length)}})
const c=o()(l,{components:{$splice:[[a,1,p,...Array.from(n)]]}})
s=o()(i,{$splice:[[t,2,c]]})
break}case G:{const e=r.component,n=o()(d,{$merge:{raw_text:d.raw_text+e.raw_text,formats:k.Z.joinFormats(d.formats,e.formats,d.raw_text.length)}}),p=o()(l,{components:{$splice:[[a,2,n]]}})
s=o()(i,{$splice:[[t,1,p]]})
break}}break}}const a=n.level===K?n.model.name.length:n.model.raw_text.length
this.props.requestSelection({selection:{cid:n.model.cid,start:a,end:a}})
this.setMaterials(s)},componentMergeUpHandler(e,t){const{anchor:s}=t,i=this.getMaterials(),{material:n}=this.get(e),[r,o]=Array.from(e)
s?o+1<n.components.length?this.mergeHelper(e,[r,o+1]):r+1<i.length&&this.mergeHelper(e,[r+1]):o>0?this.mergeHelper([r,o-1],e):this.mergeHelper([r],e)},materialMergeUpHandler(e,t){const{anchor:s}=t,i=this.getMaterials(),{material:n}=this.get(e),[r]=Array.from(e)
if(s)n.components.length?this.mergeHelper(e,[r,0]):r+1<i.length&&this.mergeHelper(e,[r+1])
else if(r>0){const t=i[r-1]
t.components.length?this.mergeHelper([r-1,t.components.length-1],e):this.mergeHelper([r-1],e)}},_splitAfter(e,t){let s,i,n,r
if(1===t.length){n=t[0]
const a=e[n]
r=a.components
const l=o()(a,{components:{$set:[]}})
i=o()(e,{$splice:[[n,e.length-n,l]]})
s=e.slice(n+1)
return[i,r,s]}{let a;[n,a]=Array.from(t)
i=e.slice(0,n+1)
s=e.slice(n+1)
const l=i[n],d=l.components.slice(0,a+1)
r=l.components.slice(a+1)
i[n]=o()(l,{components:{$set:d}})
return[i,r,s]}},_splitBefore(e,t){let s,i
if(1===t.length){[i]=Array.from(t)
if(0===i)return[[],[],e]
s=e[i-1].components.length-1
return this._splitAfter(e,[i-1,s])}[i,s]=Array.from(t)
return 0===s?this._splitAfter(e,[i]):this._splitAfter(e,[i,s-1])},_merge(e,t,s){let i=null
if(t.length>0){const s=(e=0===e.length?[makeMaterial("",k.Z.defaultFormats())]:e.slice()).length-1
i=[s,e[s].components.length]
e[s]=o()(e[s],{components:{$push:t}})}return[e.concat(s),i]},previousIndex(e){const{materials:t}=this.props.protocol,{model:s,component:i}=this.get(e),[n,r]=Array.from(e)
if(s===i)return 0===r?[n]:[n,r-1]
if(0===n)return[0]
{const e=t[n-1].components.length
return e?[n-1,e-1]:[n-1]}},nextIndex(e){const{model:t,material:s}=this.get(e),[i,n]=Array.from(e)
return t===s?s.components.length?[i,0]:[Math.min(i+1,this.props.protocol.materials.length-1)]:n+1<s.components.length?[i,n+1]:i+1>this.props.protocol.materials.length-1?[i,n]:[Math.min(i+1,this.props.protocol.materials.length-1)]},firstIndex:()=>[0],lastIndex(){const{materials:e}=this.props.protocol,t=this.props.protocol.materials.length-1,s=e[t]
return s&&s.components.length?[t,s.components.length-1]:[t]},compareIndex(e,t){1===e.length&&(e=[e[0],-1])
1===t.length&&(t=[t[0],-1])
return e[0]<t[0]?-1:e[0]>t[0]?1:e[1]<t[1]?-1:e[1]>t[1]?1:0},tabRangeHandler(e){let t,s,i,n,r,a,l,d
const{start:p,end:c}=e,u=this.getMaterials()
let[m,h,f]=Array.from(this._splitAfter(u,c));[m,d,i]=Array.from(this._splitBefore(m,p))
if(e.shiftKey){const e=[]
for(var g of Array.from(d))e.push(makeMaterial(g.raw_text,g.formats))
for(s of Array.from(i)){const t=o()(s,{components:{$set:[]}})
e.push(t)
for(g of Array.from(s.components))e.push(makeMaterial(g.raw_text,g.formats))}m=m.concat(e);[r,l]=Array.from(this._merge(m,h,f))
a=[m.length-e.length]
n=[m.length-1]}else{t=[]
t.push(...Array.from(d||[]))
for(s of Array.from(i)){t.push(makeComponent(s.name,s.formats))
t.push(...Array.from(s.components||[]))}const e=t.length
t.push(...Array.from(h||[]));[r,l]=Array.from(this._merge(m,t,f))
a=l
n=[l[0],l[1]+e-1]}this.setMaterials(r)
this.setMultiIndices({start:a,end:n})},formatRangeHandler({start:e,end:t,format:s}){let i,n,r,a
const l=this.getMaterials()
let[d,p,u]=Array.from(this._splitAfter(l,t));[d,a,i]=Array.from(this._splitBefore(d,e))
const m=a.concat(...Array.from(i.map((e=>e.components))||[])),h=m.concat(i).map((e=>e.cid)),f=m.map((e=>({text:e.raw_text,formats:e.formats}))).concat(i.map((e=>({text:e.name,formats:e.formats})))),g=k.Z.formatTexts(f,{format:s}),S=c.default.object(h,g)
function formattedComponent(e){const{text:t,formats:s}=S[e.cid]
return o()(e,{$merge:{raw_text:t,formats:s}})}const E=a.map((e=>formattedComponent(e))),y=i.map((e=>function formattedMaterial(e){const{text:t,formats:s}=S[e.cid]
return o()(e,{$merge:{name:t,formats:s,components:e.components.map((e=>formattedComponent(e)))}})}(e)));[d,r]=Array.from(this._merge(d,E,y));[n,r]=Array.from(this._merge(d,p,u))
this.setMaterials(n)},inputRangeHandler({start:e,end:t,text:s}){const{level:i}=this.get(e),n=i===K?makeMaterial(s,k.Z.defaultFormats()):makeComponent(s,k.Z.defaultFormats())
this.deleteRangeHelper({start:e,end:t,replacement:{item:n,level:i}})},deleteRangeHandler({start:e,end:t}){this.deleteRangeHelper({start:e,end:t})},deleteRangeHelper({start:e,end:t,replacement:s}){let i,n,r,a,l
const d=this.getMaterials()
let[p,c,u]=Array.from(this._splitAfter(d,t));[p,l,n]=Array.from(this._splitBefore(p,e))
if(null!=s){if(s.level===K){p=o()(p,{$push:[s.item]})
r=s.item.name.length}else{c=o()(c,{$unshift:[s.item]})
r=s.item.raw_text.length}a={cid:s.item.cid,start:r,end:r}}let[m,h]=Array.from(this._merge(p,c,u))
0===m.length&&(m=[makeMaterial("",k.Z.defaultFormats())])
if(null!=s);else if(p.length){const e=p[p.length-1]
if(e.components.length){const t=e.components[e.components.length-1];({cid:i}=t)
r=t.raw_text.length}else{({cid:i}=e)
r=e.name.length}a={cid:i,start:r,end:r}}else a={cid:m[0].cid,start:0,end:0}
this.setMaterials(m)
this.props.requestSelection({selection:a})},render(){return d.createElement("div",{className:"materials-editor","data-editor":this.props.editorKey},this.renderFocusBearer(),d.createElement("ul",{key:"materials",className:"materials"},(()=>{const e=[],t=this.getMaterials()
for(var s=0;s<t.length;s++){var i=t[s]
let n="material"
this.isSelected([s])&&(n+=" selected")
const r=[s]
e.push(d.createElement("li",{key:i.cid,className:n},d.createElement(MaterialEditable,{key:"editable",material:i,index:r,tabHandler:this.materialTabHandler.bind(this,r),formatHandler:this.props.formatHandler.bind(null,r),moveHandler:this.materialMoveHandler.bind(this,r),updateHandler:this.materialUpdateHandler.bind(this,r),pasteHandler:this.pasteHandler.bind(this,r),mergeUpHandler:this.materialMergeUpHandler.bind(this,r),splitHandler:this.splitHandler.bind(this,r),multiSelectHandler:this.multiArrowSelectHandler.bind(this,r),mouseDownHandler:this.multiEditableMouseDownHandler.bind(this,{start:r,active:!0}),mouseOverHandler:this.multiEditableMouseOverHandler.bind(this,r),storeState:this.props.storeState,restoreState:this.props.restoreState,locked:this.props.locked,spellCheck:this.props.spellCheck}),d.createElement("ul",{key:"components",className:"components"},(()=>{const e=[]
for(let t=0;t<i.components.length;t++){const n=i.components[t]
let r="component"
this.isSelected([s,t])&&(r+=" selected")
const o=[s,t]
e.push(d.createElement("li",{key:n.cid,className:r},d.createElement(ComponentEditable,{component:n,index:o,tabHandler:this.componentTabHandler.bind(this,o),formatHandler:this.props.formatHandler.bind(null,o),moveHandler:this.componentMoveHandler.bind(this,o),updateHandler:this.componentUpdateHandler.bind(this,o),pasteHandler:this.pasteHandler.bind(this,o),mergeUpHandler:this.componentMergeUpHandler.bind(this,o),splitHandler:this.splitHandler.bind(this,o),multiSelectHandler:this.multiArrowSelectHandler.bind(this,o),mouseDownHandler:this.multiEditableMouseDownHandler.bind(this,{start:o,active:!0}),mouseOverHandler:this.multiEditableMouseOverHandler.bind(this,o),storeState:this.props.storeState,restoreState:this.props.restoreState,locked:this.props.locked,spellCheck:this.props.spellCheck})))}return e})())))}return e})()))}})
var Q=s(211231),X=s(261207),J=s(583310),ee=s(567202),te=s(36424),se=s(359366),ie=s(771398)
const ne=["image/jpeg","image/png","image/gif"],re=(0,ee.ZP)(null)
function ImageEditable({cid:e,image:t,pasteHandler:s,updateHandler:i,deleteHandler:r,mouseDownHandler:a,mouseOverHandler:p,locked:c,owningEntityApiId:u}){const[m,h]=(0,d.useState)(void 0),[f,g]=re.useGlobalClientState(e),[S,E]=(0,d.useState)(void 0),[y,b]=(0,d.useState)(0),I=n()({"image-editable":!0,loading:m,"no-image-uploaded":!t.url}),T=(0,d.useRef)(null),C=(0,d.useRef)(null),R=(0,d.useRef)(null);(0,d.useEffect)((()=>{const e=se.Z.getManager(T.current),t=R.current,s=T.current
e.push(T.current)
l()(t).on("filedrop",attachFile)
return()=>{l()(t).off("filedrop",attachFile)
se.Z.getManager(s).pop(s)}}),[])
function attachFile(e,t){addFile(t[0])}function resetState(){E(!0)
h(!1)
g(null)
b(0)}function loadHandler(e){h(!1)
g(null)}function errorHandler(e){resetState()}function addFile(e){if(null!=e)if(ne.includes(e.type)){g(window.URL.createObjectURL(e))
E(!0)
b(0)
h(!0);(function uploadFile(e){const t=l().Deferred()
ie.cd({url:"/1/api/protocols/upload-image-request",file:e,progress(e){e.lengthComputable&&t.notify(e.loaded/e.total)}}).fail((e=>t.reject(e))).done((e=>t.resolve(e)))
return t})(e).progress((e=>{b(100*e)})).fail((e=>{resetState()
N.ZP.notifyError(e)})).done((e=>{E(!1)
const s=o()(t,{$merge:{url:e}})
i(s)
b(0)}))}else N.ZP.error("Only GIF, JPG, and PNG files are supported at this time.")}return d.createElement("div",{className:I,onMouseOver:p,onMouseDown:a,ref:R},d.createElement("form",{className:"add-image-form"},d.createElement("input",{ref:C,type:"file",className:"image-input hidden",accept:"image/*",multiple:!1,onChange:function addFromChooser(e){addFile(e.target.files[0])}}),d.createElement("div",{className:"upload-wrapper multi-editable",ref:T},c?void 0:d.createElement("a",{className:"big-btn del-btn round-btn",onClick:r},"×"),f?d.createElement("img",{src:f}):t.url&&t.key&&!S?d.createElement(J.Z,{url:t.url,externalFileId:t.key,renderWithSignedURL:e=>void 0===e?d.createElement("p",{className:"u-spacing-top faded text-center"},"Loading..."):null==e?d.createElement("p",{className:"u-spacing-top faded text-center"},"Error loading file"):d.createElement("img",{src:e,onError:errorHandler,onLoad:loadHandler,className:"img"}),owningEntityApiId:u}):d.createElement("div",{className:"glyphicon-wrapper"},d.createElement(te.Z,{icon:"image"})),c?void 0:d.createElement("div",{className:"instructions"},d.createElement("span",null,"Drag and drop"),d.createElement("button",{className:"button button--small button--primary",onClick:function fileChoose(e){var t
null===(t=C.current)||void 0===t||t.click()
e.preventDefault()},type:"button"},"or choose a file")),d.createElement("div",{className:"progress-bar",style:{width:`${y}%`}}))))}var oe=s(315441),ae=s(483528),le=s(459830),de=s(874654)
class TimeEditableWrapper extends d.Component{constructor(){super(...arguments)
this.timeEditableRef=d.createRef()}componentDidMount(){const e=this.props.showSeconds?"HH:MM:SS":"HH:MM"
l()(p.findDOMNode(this.timeEditableRef.current)).tooltip({title:`Aggregate Time - ${e}`,placement:"bottom",container:"body",delay:{show:300}})}componentWillUnmount(){l()(p.findDOMNode(this.timeEditableRef.current)).tooltip("destroy")}render(){let e={...this.props,placeholderZeros:!1,time_seconds:this.props.step.time_seconds,cid:this.props.step.cid,ref:this.timeEditableRef}
e=c.default.omit(e,"step")
return d.createElement("div",{className:"time-editable-wrapper"},d.createElement(de.Z,{...e}),d.createElement(te.Z,{className:"time-editable-wrapper-icon",icon:"clock"}))}}const pe=TimeEditableWrapper
var ce=s(600371)
class TimerEditableWrapper extends d.Component{render(){var e,t
return d.createElement("div",{className:"timer-editable-wrapper"},this.props.locked?void 0:d.createElement("a",{className:"del-timer-btn big-btn del-btn round-btn",onClick:this.props.deleteHandler},"×"),d.createElement(ce.Z,{inline:!0,originalMS:null===(t=null===(e=this.props.step)||void 0===e?void 0:e.timer)||void 0===t?void 0:t.milliseconds,allowEdits:!this.props.locked,editHelpers:{cid:this.props.step.cid,updateTimeHandler:this.props.updateTimeHandler,setSelection:this.props.setSelection,storeState:this.props.storeState,restoreState:this.props.restoreState}}))}}var ue=s(337652)
const StepsEditorEditables_TimeEditable=e=>d.createElement(pe,{step:e.step,index:e.index,isMultiEditable:!1,updateTimeHandler:e.updateTimeHandler,setSelection:e.setSelection,storeState:e.storeState,restoreState:e.restoreState,showSeconds:!1,locked:e.locked})
class GenericStepEditable extends d.PureComponent{render(){return d.createElement("div",{className:"step-editable-wrapper"},null!=this.props.step.type?d.createElement("span",{className:n()({"step-type":!0,"step-type-critical":this.props.step.type===E.TYPE_CRITICAL,"step-type-pause":this.props.step.type===E.TYPE_PAUSE})},this.props.step.type):void 0,d.createElement(F.Z,{...c.default.extend({},this.props,{className:n()(this.props.className,"step-editable","multi-editable"),allowRichText:!0,allowDefaultPaste:!0,cid:this.props.cid,text:this.props.text,formats:this.props.formats,index:this.props.index,spellCheck:this.props.spellCheck})}),this.props.locked?void 0:d.createElement("span",{className:"step-placeholder"},null))}}GenericStepEditable.propTypes={cid:y.string.isRequired,index:y.number.isRequired,locked:y.bool,spellCheck:y.bool.isRequired}
class HeaderEditable extends d.PureComponent{render(){return d.createElement("ul",{className:"headers"},d.createElement("li",null,d.createElement(GenericStepEditable,{...this.props}),d.createElement(StepsEditorEditables_TimeEditable,{...this.props})))}}class StepEditable extends d.PureComponent{constructor(){super(...arguments)
this.toggleComplete=()=>{const{step:e}=this.props
this.props.itemUpdateHandler({text:e.text,formats:e.formats,completed:!e.completed})}}render(){return d.createElement("ol",{className:"steps"},d.createElement("li",{value:this.props.step.stepCount},this.props.inEntry?d.createElement(ue.Z,{checked:this.props.step.completed,onClick:this.props.locked?void 0:this.toggleComplete}):void 0,d.createElement(GenericStepEditable,{...this.props}),d.createElement(StepsEditorEditables_TimeEditable,{...this.props})))}}StepEditable.propTypes={step:y.shape({stepCount:y.number.isRequired}).isRequired}
class DescriptionEditable extends d.PureComponent{render(){return d.createElement("ul",{className:"descriptions"},d.createElement("li",null,d.createElement(GenericStepEditable,{...this.props})))}}class StepTimerEditable extends d.PureComponent{render(){return d.createElement("div",{className:"timer-outer"},d.createElement("div",null,d.createElement(TimerEditableWrapper,{step:this.props.step,index:this.props.index,locked:this.props.locked,isMultiEditable:!0,updateTimeHandler:this.props.updateTimerHandler,setSelection:this.props.setSelection,deleteHandler:this.props.deleteHandler,storeState:this.props.storeState,restoreState:this.props.restoreState})))}}var me=s(211038),he=s(379346)
function buildStepComponent(e,t){return c.default.defaults({default:()=>t,required:["tabHandler","moveHandler","textItemUpdateHandler","itemUpdateHandler","pasteHandler","stepMergeUpHandler","stepSplitHandler","multiArrowSelectHandler","itemUpdateHandler","updateTimeHandler","formatHandler"],make(t,s,i,n){const r=this.props.getCid(t),{text:o,formats:a}=this.getText(t)
return d.createElement(me.Z,{key:r,boundArg:s,tabHandler:this.tabHandler,pasteHandler:this.pasteHandler,updateHandler:this.textItemUpdateHandler,formatHandler:this.formatHandler,moveHandler:this.moveHandler,multiSelectHandler:this.multiArrowSelectHandler,splitHandler:this.stepSplitHandler,mergeUpHandler:this.stepMergeUpHandler,itemUpdateHandler:this.itemUpdateHandler,updateTimeHandler:this.updateTimeHandler},(n=>d.createElement(e,{...c.default.extend({text:o,formats:a,cid:r,index:s,storeState:i.storeState,restoreState:i.restoreState,inEntry:he.ZP.apiIdToType(i.fileId)===le.ENTRY,locked:i.locked,spellCheck:i.spellCheck,step:t,setSelection:this.setSelection},n)})))}},ae.N)}const fe={text:"",formats:k.Z.defaultFormats()},ge=buildStepComponent(HeaderEditable,fe),Se=buildStepComponent(StepEditable,c.default.extend({completed:!1},fe)),Ee=buildStepComponent(DescriptionEditable,fe),ye={default:()=>60,required:["itemDeleteHandler","itemUpdateHandler","setSelection"],make(e,t,s,i){const n=this.props.getCid(e)
return d.createElement(StepTimerEditable,{key:n,step:e,index:t,deleteHandler:this.itemDeleteHandler.bind(this,t),updateTimerHandler:this.itemUpdateHandler.bind(this,t),setSelection:this.setSelection,storeState:s.storeState,restoreState:s.restoreState,locked:s.locked})},selectionAtStart(e){return{selection:{cid:`time-${this.props.getCid(e)}`,start:0,end:0}}},selectionAtEnd(e){return{selection:{cid:`time-${this.props.getCid(e)}`,start:6,end:6}}},selectionInit(e){return{selection:{cid:`time-${this.props.getCid(e)}`,start:6,end:6}}}}
var be=s(681284),Ie=s(259470),Te=s(709321)
function typeTagHTML(e){const t=l()("<span></span>")
switch(e.type){case E.TYPE_CRITICAL:t.append(l()("<b>[CRITICAL] </b>").css("color","#3498db"))
break
case E.TYPE_PAUSE:t.append(l()("<b>[PAUSE] </b>").css("color","#2ecc71"))}return t}const Ce={itemFromHTML:(e,t)=>t,getContent:({text:e,formats:t})=>({text:e,formats:t}),setContent:({text:e,formats:t})=>({$merge:{text:e,formats:t}}),getText:({text:e,formats:t})=>({text:e,formats:t}),setText:({text:e,formats:t})=>({$merge:{text:e,formats:t}})},Re={...ae.Z.blockPluginBase,title:"Image",default:()=>({}),required:["itemUpdateHandler","itemDeleteHandler","itemMouseDownHandler","itemMouseOverHandler"],make(e,t,s,i){const n=s.getCid(e),r=s.getContent(e)
return d.createElement(ImageEditable,{cid:n,image:r,pasteHandler:this.pasteHandler.bind(this,t),updateHandler:this.itemUpdateHandler.bind(this,t),deleteHandler:this.itemDeleteHandler.bind(this,t),mouseDownHandler:this.itemMouseDownHandler.bind(this,t),mouseOverHandler:this.itemMouseOverHandler.bind(this,t),locked:s.locked,owningEntityApiId:this.props.fileId})}},xe=[c.default.defaults({type:E.StepLevel.HEADER,typeClass:"is-header",title:"Header",icon:"protocol-header",canPasteFromOtherTenant:!0,component:ge,textual:!0,itemFromHTML:(e,t)=>t,itemToHTML(e,t){const s=l()("<h1></h1>").html(k.Z.renderHTML(t.text,t.formats,{forceNonEmpty:!0})).prepend(typeTagHTML(t))
null!=t.time_seconds&&s.append(l()(`<em> (${be.Z.formattedTime(t.time_seconds)})</em>`))
e.append(s)
return e}},Ce),c.default.defaults({type:E.StepLevel.STEP,typeClass:"is-step",title:"Step",icon:"protocol-step",canPasteFromOtherTenant:!0,component:Se,textual:!0,itemFromHTML:(e,t)=>t,itemToHTML(e,t){const s=l()("<p></p>").html(k.Z.renderHTML(t.text,t.formats,{forceNonEmpty:!0})).prepend(typeTagHTML(t))
null!=t.time_seconds&&s.append(l()(`<em> (${be.Z.formattedTime(t.time_seconds)})</em>`))
e.append(s)
return e},setContent:({text:e,formats:t,completed:s})=>({$merge:{text:e,formats:t,completed:s}}),getContent:({text:e,formats:t,completed:s})=>({text:e,formats:t,completed:s})},Ce),c.default.defaults({type:E.StepLevel.DESC,typeClass:"is-description",title:"Description",icon:"protocol-desc",canPasteFromOtherTenant:!0,component:Ee,textual:!0,itemFromHTML:(e,t)=>t,itemToHTML(e,t){const s=l()("<p></p>").html(k.Z.renderHTML(t.text,t.formats,{forceNonEmpty:!0})).prepend(typeTagHTML(t))
e.append(s)
return e}},Ce),c.default.defaults({type:E.StepLevel.TABLE,typeClass:"is-table",title:"Table",icon:"protocol-table",canPasteFromOtherTenant:!0,component:ae.Z.table,textual:!1,setContent:({table:e})=>({$merge:{table:e}}),getContent:({table:e})=>({table:e}),itemFromHTML:(e,t)=>t,itemToHTML(e,t){const[s,i]=Te.Z.getDimensions(t.table)
e.append((0,Ie.Z)(t.table,this.props.computedTables[t.table.name],{minI:0,minJ:0,maxI:s-1,maxJ:i-1}))
return e},getStoreDependenciesForSpreadsheetEval:e=>({})},Ce),c.default.defaults({type:E.StepLevel.IMAGE,typeClass:"is-image",title:"Image",icon:"protocol-image",canPasteFromOtherTenant:!1,component:Re,textual:!1,itemToHTML(e,t){e.append(l()("<img>").attr("src",t.image.url))
return e},setContent:e=>({$merge:{image:e}}),getContent:({image:e})=>e},Ce),c.default.defaults({type:E.StepLevel.TIMER,typeClass:"is-timer",title:"Timer",icon:"protocol-timer",canPasteFromOtherTenant:!0,component:ye,itemToHTML(e,t){const s=t.timer.milliseconds/1e3
e.append(l()("<b>").text("Timer")).append(l()("<span>: </span>")).append(l()("<span>").text(be.Z.formattedTime(s)))
return e},setContent:e=>({$merge:{timer:{milliseconds:1e3*e}}}),getContent:({timer:e})=>e},Ce)]
for(const e of xe)if(!("canPasteFromOtherTenant"in e))throw new Error("Steps editor plugins must define canPasteFromOtherTenant")
const ve=xe,ke=[E.StepLevel.HEADER,E.StepLevel.STEP,E.StepLevel.DESC]
function levelTab(e){switch(e){case E.StepLevel.HEADER:return E.StepLevel.STEP
case E.StepLevel.STEP:return E.StepLevel.DESC
default:return e}}function levelUntab(e){switch(e){case E.StepLevel.STEP:return E.StepLevel.HEADER
case E.StepLevel.DESC:return E.StepLevel.STEP
default:return e}}const we=W.Z.makeStep.bind(W.Z),_e=W.Z.makeTable.bind(W.Z),Pe=W.Z.makeImage.bind(W.Z),Me=W.Z.makeTimer.bind(W.Z),Ae=Q.Z.createClass({mixins:[X.Z,$()],propTypes:{fileId:b().string.isRequired,protocol:b().object.isRequired,storeState:b().func.isRequired,restoreState:b().func.isRequired,jumpTo:b().func.isRequired,updateProtocol:b().func,spellCheck:b().bool.isRequired,editorMargin:b().number.isRequired,isLockedWithEditWarn:b().func.isRequired},plugins:ve,displayName:"StepsEditor",UNSAFE_componentWillReceiveProps(e){(0,oe.R)(this.props,e,this.setMultiEditingForTable)
this.setState({highlightIndex:e.highlightIndex,insertIndex:e.insertIndex})},editorMarginOffset(){return null!=this.state.maximizedTableCid?0:this.props.editorMargin},getComputedTables:e=>null,isVirtualizationSupported:()=>!1,editorName:()=>"steps",getDocumentVersionCid(){return this.props.protocol.cid},multiSelectKey:()=>"steps",defaultInsertType:E.StepLevel.HEADER,textType:E.StepLevel.STEP,tableType:E.StepLevel.TABLE,headerType:E.StepLevel.HEADER,descType:E.StepLevel.DESC,getExtraTypingPerfMetadata(){const e=this.props.getItems(this.props.getRoot()),t=c.default.countBy(e,(e=>`num_${e.level.toLowerCase()}`))
return c.default.extend({num_items:e.length},t)},makeEditorProps(e){return c.default.extend(this.makeEditorPropsBase(e),{spellCheck:e.spellCheck})},isLockedWithEditWarn(){return this.props.isLockedWithEditWarn()},getHeaderType:e=>null,canItemHaveHeader:e=>!1,headerTypeAccessor(){throw new Error("Unexpected call to headerTypeAccessor.")},getFormats:e=>e.formats,makeItem(e){switch(e){case E.StepLevel.HEADER:case E.StepLevel.STEP:case E.StepLevel.DESC:return we("",k.Z.defaultFormats(),e)
case E.StepLevel.TIMER:return Me()
case E.StepLevel.IMAGE:return Pe()
case E.StepLevel.TABLE:return _e(null,null,2,2)
default:throw new Error(`Unexpected level: ${e}`)}},replaceItems(){return this.replaceItemsDefault(...arguments)},deleteRangeHandler(){return this.deleteRangeHandlerDefault(...arguments)},isItemTextual(e){return this.getPluginByItem(e).textual},itemHasText(e){return this.isItemTextual(e)},insertItemHandler(e,t=null){null==t&&(t=this.defaultItemType())
this.insertDefaultableItemHandler(e,t)},parseItemsFromFile(e){if(!Array.from(ImageEditable.SUPPORTED_TYPES).includes(e.type))return Promise.resolve({})
const t=ImageEditable.uploadFile(e).then((e=>({items:[o()(Pe(),{image:{$merge:{url:e}}})]})))
return Promise.resolve(t)},render(){return d.createElement("div",{className:"stepsEditor mediocre"},this.shouldRenderMaximizedTable()?this.renderMaximizedTable():this.renderEditor())},defaultItemType:()=>E.StepLevel.STEP,getSteps(){return this.props.getItems(this.props.getRoot())},setSteps(e){const t=o()(this.props.getRoot(),this.props.itemsAccessor({$set:e}))
this.props.updateRoot(t)},stepMergeUpHandler(e,t){let s,i
const{anchor:n}=t,r=this.getSteps(),mergeSteps=e=>{let t
const n=r[e],a=r[e+1]
if(Array.from(ke).includes(n.level)&&Array.from(ke).includes(a.level)){const l=this.getText(n),d=this.getText(a),p=l.text.length
t=l.text+d.text
const c=k.Z.joinFormats(l.formats,d.formats,p)
s=this.withUpdatedText(n,{text:t,formats:c})
i=o()(r,{$splice:[[e,1,s],[e+1,1]]})
this.setSteps(i)
this.props.requestSelection({selection:{cid:s.cid,start:p,end:p}})}else if(Array.from(ke).includes(n.level)&&!n.text.length){i=o()(r,{$splice:[[e,1]]})
this.setSteps(i)
this.props.requestSelection(this.selectionAtStart(a))}else if(Array.from(ke).includes(a.level)&&!a.text.length){i=o()(r,{$splice:[[e+1,1]]})
this.setSteps(i)
this.props.requestSelection(this.selectionAtEnd(n))}}
if(n)e+1<r.length&&mergeSteps(e)
else if(e-1>=0)mergeSteps(e-1)
else{s=o()(r[0],{$merge:{level:levelUntab(r[0].level)}})
i=o()(r,{$splice:[[0,1,s]]})
this.setSteps(i)
this.props.requestSelection({selection:{cid:r[0].cid,start:0,end:0}})}},formatHandler(e,t){this.props.formatHandler(e,t)},updateTimeHandler(e,t){const s=this.getSteps(),i=o()(s[e],{time_seconds:{$set:t}}),n=o()(s,{$splice:[[e,1,i]]})
this.setSteps(n)},stepSplitHandler(e,t){let s,{before:i,selected:n,after:r,cursor:a}=t
const l=this.getSteps(),d=l[e]
let{text:p,formats:u}=this.getText(d)
const m=k.Z.splitFormats(u,i.length).before,h=k.Z.splitFormats(u,n.length+i.length).after
let f=[i,r]
a={index:1,offset:0}
u=[m,h]
if(d.level===E.StepLevel.HEADER)s=[E.StepLevel.HEADER,E.StepLevel.STEP]
else if(t.shiftKey)s=d.level===E.StepLevel.STEP?[E.StepLevel.STEP,E.StepLevel.DESC]:[E.StepLevel.DESC,E.StepLevel.STEP]
else if(f[0].length===f[1].length&&0===f[1].length){s=[levelUntab(d.level)]
u=[k.Z.defaultFormats()]
f=[""]
a={index:0,offset:0}}else s=[d.level,d.level]
const g=s.shift(),S=f[0],y=u.shift(),b=f.slice(1),I=o()(d,{$merge:{text:S,formats:y,level:g}}),T=(()=>{const e=[]
for(const[t,i,n]of Array.from(c.default.zip(b,s,u)))e.push(we(t,n,i))
return e})(),C=o()(l,{$splice:[[e,1,I,...Array.from(T)]]})
this.setSteps(C)
this.setState({insertIndex:a.index+e})
const R=C[a.index+e].cid
this.props.requestSelection({selection:{cid:R,start:a.offset,end:a.offset}})},moveHandler(e,t){const{up:s,beginning:i}=t,n=this.getSteps(),r=n[e],o=n[e+(s?-1:1)]
if(null!=o)i?this.props.requestSelection(this.selectionAtStart(o)):this.props.requestSelection(this.selectionAtEnd(o))
else if(s){this.clearSelection()
const e=i?"start":"end"
this.props.jumpTo({section:E.EditorKey.MATERIALS,location:e})}else this.props.getType(r)!==E.StepLevel.TABLE||this.props.locked||this.insertItemHandler(e,E.StepLevel.STEP)},tabHandler(e,t){const{shiftKey:s,target:i}=t,n=this.getSteps(),r=n[e]
if(!Array.from(ke).includes(r.level))return
const a=s?levelUntab(r.level):levelTab(r.level),l=[[e,1,o()(r,{$merge:{level:a}})]],d=o()(n,{$splice:l})
this.setSteps(d)
this.props.requestSelection({selection:q.xH(t)})},tabRangeHandler({start:e,end:t,shiftKey:s}){let i
const n=this.getSteps(),r=s?(()=>{const s=[]
for(i of Array.from(n.slice(e,Number(t)+1||void 0)))Array.from(ke).includes(i.level)?s.push(o()(i,{$merge:{level:levelUntab(i.level)}})):s.push(i)
return s})():(()=>{const s=[]
for(i of Array.from(n.slice(e,Number(t)+1||void 0)))Array.from(ke).includes(i.level)?s.push(o()(i,{$merge:{level:levelTab(i.level)}})):s.push(i)
return s})(),a=o()(n,{$splice:[[e,t-e+1,...Array.from(r)]]})
this.setSteps(a)},openManageSelectorsModal(e){return this.props.openManageSelectorsModal(e)}})
const Ne=(0,s(62790).Z)(Ae)
class StepsEditorContainer extends d.Component{constructor(){super(...arguments)
this.spreadsheetTypes=[E.StepLevel.TABLE]
this.makeFullTableMap=e=>{const t=c.default.where(this.spreadsheetRoot(e),{level:E.StepLevel.TABLE}),s={}
for(const e of Array.from(t))s[e.table.name]=e.table
return s}
this.selectorsFromProps=e=>e.protocol.selectors
this.getRoot=e=>(e||this.props).protocol
this.getItems=e=>e.steps
this.getContent=e=>{const t=this.getType(e)
return this.getPluginByType(t).getContent.call(this,e)}
this.setContent=(e,t)=>this.getPluginByType(e).setContent.call(this,t)
this.getType=e=>e.level
this.updateRoot=e=>{this.props.updateProtocol(e)}
this.itemsAccessor=e=>({steps:e})
this.spreadsheetRoot=e=>e.protocol.steps
this.getCid=e=>e.cid
this.getNoteRuntimeSnapshot=()=>null}getPluginByType(e){for(const t of ve)if(t.type===e)return t
return null}render(){return d.createElement(Ne,{...this.props,setRef:this.props.setRef,getCid:this.getCid,getContent:this.getContent,getItems:this.getItems,getRoot:this.getRoot,getType:this.getType,itemsAccessor:this.itemsAccessor,makeFullTableMap:this.makeFullTableMap,selectorsFromProps:this.selectorsFromProps,setContent:this.setContent,spreadsheetRoot:this.spreadsheetRoot,spreadsheetTypes:this.spreadsheetTypes,updateRoot:this.updateRoot,getNoteRuntimeSnapshot:this.getNoteRuntimeSnapshot})}}StepsEditorContainer.propTypes={fileId:y.string.isRequired,protocol:y.object.isRequired,storeState:y.func.isRequired,restoreState:y.func.isRequired,jumpTo:y.func.isRequired,updateProtocol:y.func,spellCheck:y.bool.isRequired,editorMargin:y.number.isRequired,isLockedWithEditWarn:y.func.isRequired,stepsEditorRef:y.string,requestSelection:y.func.isRequired}
const Oe=StepsEditorContainer,{EditorKey:Le}=E,He=L()({displayName:"TitleEditor",propTypes:{cid:b().string.isRequired,protocol:b().object.isRequired,jumpTo:b().func.isRequired,updateProtocol:b().func,spellCheck:b().bool.isRequired},mixins:[D.Z],getInitialState:()=>({index:0}),updateHandler(e){const{text:t}=e
if(t.length<=255){this.props.updateProtocol({name:t})
return this.props.requestSelection({selection:q.xH()})}if(null!=this._origSelection){this.refs.contentEditable.forceContentEditableUpdate()
return this.props.requestSelection({selection:this._origSelection})}},pasteHandler(e){const{before:t,after:s,originalEvent:i}=e,n=Z.Z.processClipboard(i.clipboardData),r=255-t.length-s.length,o=t+n.map((e=>e.text)).join(" ").slice(0,r)+s,a=o.length-s.length
this.props.updateProtocol({name:o})
this.props.requestSelection({selection:{cid:this.props.cid,start:a,end:a}})},moveHandler(e){const{up:t,beginning:s}=e
if(!t){this.clearSelection()
const e=s?"start":"end"
this.props.jumpTo({section:Le.INTRO,location:e,row:"first"})}},keyDownHook(){this._origSelection=q.xH()},render(){return d.createElement("h1",{className:n()({"mediocre-titleEditor":!0,"is-locked":this.props.locked})},d.createElement(F.Z,{ref:"contentEditable",cid:this.props.cid,text:this.props.protocol.name,index:this.state.index,moveHandler:this.moveHandler,updateHandler:this.updateHandler,pasteHandler:this.pasteHandler,storeState:this.props.storeState,restoreState:this.props.restoreState,keyDownHook:this.keyDownHook,locked:this.props.locked,spellCheck:this.props.spellCheck,allowRichText:!1,allowMultiline:!1}))}})
var Fe=s(195300),De=s(430801),qe=s(181483),Ze=s(43987),Be=s(643477),Ue=s(935847),je=s(901113)
const{BOLD:$e,LINK:Ve,ITALIC:We,UNDERLINE:Ke,STRIKETHROUGH:Ge,SUBSCRIPT:ze,SUPERSCRIPT:Ye,FOREGROUND_COLOR:Qe,BACKGROUND_COLOR:Xe,MONOSPACE:Je}=f.Z
function and_(...e){return t=>e.every((e=>e(t)))}function isNotLocked(e){return!e.locked}function inText(e){switch(e.editorKey){case E.EditorKey.STEPS:return null!=e.stepLevel&&![E.StepLevel.IMAGE,E.StepLevel.TABLE,E.StepLevel.TIMER].includes(e.stepLevel)
case E.EditorKey.MATERIALS:case E.EditorKey.INTRO:return!0
default:return!1}}function inStepEditor(e){return e.editorKey===E.EditorKey.STEPS}function formatMap(e){null==e.enabled&&(e={...e,enabled:and_(isNotLocked,inText)})
return e}function checkFormat(e,t){return t.formatState[e]}function getRequestChangeForColor(e,t){return s=>{t.formatHandler(e,{color:s})}}const et=[[{format:$e,icon:"format-bold",active:checkFormat.bind(null,$e)},{format:We,icon:"format-italic",active:checkFormat.bind(null,We)},{format:Ke,icon:"format-underline",active:checkFormat.bind(null,Ke)},{format:Ge,icon:"format-strikethrough",active:checkFormat.bind(null,Ge)},{format:Ve,icon:"format-link"},{format:Je,icon:"note-code",active:checkFormat.bind(null,Je),enabled:and_(isNotLocked,inText,(e=>e.hasNonEmptyTextSelection))}].map((e=>formatMap(e))),[{format:"color",icon(e){const t=and_(isNotLocked,inText)(e)
return d.createElement(Ue.Z,{foregroundColor:t?checkFormat(Qe,e):null,backgroundColor:t?checkFormat(Xe,e):null})},submenu:e=>d.createElement(Be.Z,{foregroundColorLink:{value:checkFormat(Qe,e),requestChange:getRequestChangeForColor(Qe,e)},backgroundColorLink:{value:checkFormat(Xe,e),requestChange:getRequestChangeForColor(Xe,e)}})}].map((e=>formatMap(e))),[{format:ze,icon:"format-subscript",active:checkFormat.bind(null,ze)},{format:Ye,icon:"format-superscript",active:checkFormat.bind(null,Ye)}].map((e=>formatMap(e))),[{format:E.StepLevel.HEADER,icon:"protocol-header"},{format:E.StepLevel.STEP,icon:"protocol-step"},{format:E.StepLevel.DESC,icon:"protocol-desc"}].map((e=>{e.active=t=>e.format===t.stepLevel
e.enabled=and_(isNotLocked,inText)
e.visible=inStepEditor
return e})),[{format:E.TYPE_CRITICAL,icon:"protocol-critical-step",moreKey:"basic-step"},{format:E.TYPE_PAUSE,icon:"protocol-pause-point",moreKey:"basic-step"}].map((e=>{e.active=t=>e.format===t.stepType
e.enabled=and_(isNotLocked,inText)
e.visible=inStepEditor
return e})),[{format:E.AGGREGATE_TIME,icon:"protocol-aggregate-time",moreKey:"basic-step",active:e=>e.stepHasTime,enabled:and_(isNotLocked,(e=>null!=e.stepLevel&&[E.StepLevel.HEADER,E.StepLevel.STEP].includes(e.stepLevel))),visible:inStepEditor}],[{format:"delete",icon:"format-delete",moreKey:"basic-step",enabled:isNotLocked,visible:inStepEditor}]],tt=[{key:E.StepLevel.HEADER,icon:"protocol-header",text:"Header"},{key:E.StepLevel.STEP,icon:"protocol-step",text:"Step"},{key:E.StepLevel.DESC,icon:"protocol-desc",text:"Description"},{key:E.StepLevel.IMAGE,icon:"protocol-image",text:"Image"},{key:E.StepLevel.TABLE,icon:"protocol-table",text:"Table",submenu:e=>d.createElement("ul",{className:"dropdown-menu dropdown-menu--noMinWidth"},d.createElement(qe.Z,{insertTableWithDimensions:e.insertTableWithDimensions}))},{key:E.INSERT_WELL_PLATE,icon:"well-plate",text:"Well Plate",visible:inStepEditor,submenu:({insertWellPlateWithDimensions:e})=>d.createElement(Ze.Z,{insertWellPlateWithDimensions:e})},{key:E.StepLevel.TIMER,icon:"protocol-timer",text:"Timer"},{key:E.INSERT_SYMBOL,icon:"note-symbol",text:"Symbol",enabled:isNotLocked,visible:inText}].map((e=>{null==e.visible&&(e.visible=inStepEditor)
return e}))
class ProtocolToolbar extends d.PureComponent{getGroups(){return(function isHiddenForLocked(e){return e.locked}(this.props)?[]:et).concat([this.props.moreFormats]).map((e=>{let t
return e.map((e=>({active:!(null==e.active||!(0,je.mf)(e.active))&&e.active(this.props),enabled:null==e.enabled||!(0,je.mf)(e.enabled)||e.enabled(this.props),icon:"string"==typeof e.icon?e.icon:(0,je.mf)(e.icon)?e.icon(this.props):void 0,format:e.format,moreKey:e.moreKey,onClick:null!=e.onClick?e.onClick:null,submenu:(0,je.mf)(e.submenu)?e.submenu(this.props):void 0,text:null!=(t=(0,je.mf)(e.text)?e.text(this.props):void 0)?t:e.text,tooltip:null!=e.tooltip?e.tooltip:null,visible:null==e.visible||!(0,je.mf)(e.visible)||e.visible(this.props)})))}))}getInserts(){return tt.map((e=>({key:e.key,icon:e.icon,text:e.text,enabled:null==e.enabled||!(0,je.mf)(e.enabled)||e.enabled(this.props),visible:null==e.visible||!(0,je.mf)(e.visible)||e.visible(this.props),submenu:(0,je.mf)(e.submenu)?e.submenu(this.props):void 0})))}getMappedPrintOptions(e){return e.map((e=>({type:e,enabled:!0})))}render(){return d.createElement(M.Z,{groups:this.getGroups(),formatHandler:this.props.formatHandler,insertHandler:this.props.insertHandler,insertTableWithDimensions:this.props.insertTableWithDimensions,insertMouseOverHandler:this.props.insertMouseOverHandler,insertMouseOutHandler:this.props.insertMouseOutHandler,mouseOverHandler:this.props.mouseOverHandler,mouseOutHandler:this.props.mouseOutHandler,printOptions:this.getMappedPrintOptions(this.props.printOptions),printHandler:this.props.printHandler,inserts:this.getInserts()})}}ProtocolToolbar.propTypes={locked:b().bool.isRequired,editorKey:b().string,stepLevel:b().oneOf(Object.values(E.StepLevel)),stepType:b().oneOf(E.STEP_TYPES),stepHasTime:b().bool.isRequired,formatState:v.Z.propType.isRequired,formatHandler:b().func.isRequired,insertHandler:b().func.isRequired,insertTableWithDimensions:b().func.isRequired,insertWellPlateWithDimensions:b().func.isRequired,mouseOverHandler:b().func.isRequired,mouseOutHandler:b().func.isRequired,moreFormats:b().array.isRequired,hasNonEmptyTextSelection:b().bool.isRequired}
ProtocolToolbar.defaultProps={moreFormats:[]}
const st=ProtocolToolbar
function Editor_defineProperty(e,t,s){(t=function Editor_toPropertyKey(e){var t=function Editor_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}const{LEVEL_MATERIAL:it}=g,{TABLE_NAME_WELL_PREFIX:nt,DEFAULT_TABLE_SIZE:rt,DEFAULT_PLATE_SIZE:ot}=R,{AGGREGATE_TIME:at,StepLevel:lt,TYPE_CRITICAL:dt,TYPE_PAUSE:pt,INSERT_SYMBOL:ct,INSERT_WELL_PLATE:ut,EditorKey:mt}=E,ht=[lt.HEADER,lt.STEP,lt.DESC,at,dt,pt]
class ProtocolEditor extends d.Component{constructor(...e){super(...e)
Editor_defineProperty(this,"state",{selected:{},atSignState:null,hyperlinkState:null,formatState:v.Z.readFormats(),editorMargin:0,editorWidth:700,showInsertLinkModal:!1,insertingSymbolState:null})
Editor_defineProperty(this,"_editorMarginThrottledResizeHandler",(0,S.Z)((()=>this._editorMarginResizeHandler()),250))
Editor_defineProperty(this,"_editorMarginResizeHandler",(()=>{let e
if(this._isMounted){e=(0,x.Z)(p.findDOMNode(this.refs.editor))
e<0&&(e=0)
e!==this.state.editorMargin&&this.setState({editorMargin:e})
window.addEventListener("resize",this._editorSizerThrottledHandleResize)}}))
Editor_defineProperty(this,"_editorSizerThrottledHandleResize",(0,S.Z)((()=>this._editorSizerHandleResize()),250))
Editor_defineProperty(this,"_editorSizerHandleResize",(()=>{if(this._isMounted&&T.isBrowser){const e=l()(p.findDOMNode(this.refs.container)),t=e.width(),s=e.height(),i=l()(p.findDOMNode(this.refs.editor)).width()
i===this.state.editorWidth&&t===this.state.containerWidth&&s===this.state.containerHeight||this.setState({editorWidth:i,containerWidth:t,containerHeight:s})}}))
Editor_defineProperty(this,"openInsertLinkModal",((e,t,s)=>{this.setState({showInsertLinkModal:!0,editingLinkState:(0,w.Fv)(e,t,s)})}))
Editor_defineProperty(this,"closeInsertLinkModal",(()=>{this.setState({editingLinkState:null,showInsertLinkModal:!1})}))
Editor_defineProperty(this,"openInsertSymbolModal",((e,t,s)=>{this.setState({insertingSymbolState:{index:e,partition:t,formats:s}})}))
Editor_defineProperty(this,"_closeSymbolModal",(()=>{this.setState({insertingSymbolState:null})}))
Editor_defineProperty(this,"_insertSymbol",(e=>{const{formats:t,partition:s,index:i}=this.state.insertingSymbolState,{formats:n,text:r,start:o,end:a}=k.Z.replaceText(t,s,e)
this.updateFormattedText({text:r,start:a,end:a,formats:n},i)
u.j("editor","inserted_symbol",{symbol:e})}))
Editor_defineProperty(this,"renderInsertSymbolModal",(()=>d.createElement(Fe.Z,{open:null!=this.state.insertingSymbolState},d.createElement(_.Z,{onRequestClose:this._closeSymbolModal,onRequestSubmit:this._insertSymbol}))))
Editor_defineProperty(this,"nestedStoreState",((e,t)=>{this.props.storeState(C.Z.keyData(e,t))}))
Editor_defineProperty(this,"nestedRestoreState",((e,t,s)=>this.props.restoreState(t,C.Z.keyData(e,s))))
Editor_defineProperty(this,"nestedRequestSelection",((e,t)=>{this.props.requestSelection(C.Z.keyData(e,t))}))
Editor_defineProperty(this,"isLockedWithEditWarn",(()=>{this.props.locked&&N.ZP.warn(null!=this.props.banner?this.props.banner:"Editing is disabled.",{id:"ProtocolEditor.isLockedWithEditWarn"})
return this.props.locked}))
Editor_defineProperty(this,"renderEditor",((e,t,s,i)=>{null==i&&(i={})
return d.createElement(me.Z,{ref:t,boundArg:e,storeState:this.nestedStoreState,restoreState:this.nestedRestoreState,requestSelection:this.nestedRequestSelection,formatHandler:this._formatHandler},(t=>d.createElement(s,c.default.extend({highlightIndex:e===this.state.highlightEditorKey?this.state.highlightIndex:void 0,insertIndex:e===this.state.insertEditorKey?this.state.insertIndex:void 0,protocol:this.props.protocol,locked:this.props.locked,spellCheck:this.props.spellCheck,updateProtocol:this.props.updateProtocol,metadataForRestore:C.Z.unkeyData(e,this.props.metadataForRestore),jumpTo:this.jumpTo,editorKey:e,isLockedWithEditWarn:this.isLockedWithEditWarn,viewer:this.props.viewer},t,i))))}))
Editor_defineProperty(this,"setStepsEditorRef",(e=>{this.stepsEditorRef=e}))
Editor_defineProperty(this,"getStepsEditor",(()=>this.stepsEditorRef))
Editor_defineProperty(this,"jumpTo",(({section:e,row:t,location:s})=>{let i,n,r
function selectionFor(e,t){const i="start"===s?0:t.length
return{selection:{cid:e,start:i,end:i}}}switch(e){case mt.TITLE:i=selectionFor(this.getTitleCid(),this.props.protocol.name)
break
case mt.INTRO:i=selectionFor(this.getIntroCid(),this.props.protocol.description)
break
case mt.STEPS:{const e=this.props.protocol.steps[0],n=this.props.protocol.steps[this.props.protocol.steps.length-1],r="first"===t?e:n
i="start"===s?this.getStepsEditor().selectionAtStart(r):this.getStepsEditor().selectionAtEnd(r)
break}case mt.MATERIALS:if("first"===t){[n]=Array.from(this.props.protocol.materials)
r=n.name}else{n=this.props.protocol.materials[this.props.protocol.materials.length-1]
r=n.name
if(n.components.length){n=n.components[n.components.length-1]
r=n.raw_text}}i=selectionFor(n.cid,r)
break
default:console.warn("Invalid section for ProtocolEditor.jumpTo:",e)
return}this.nestedRequestSelection(e,i)}))
Editor_defineProperty(this,"_handleOpenInsertSymbolModalForProtocolSection",((e,t)=>{const s=(()=>{switch(e){case mt.STEPS:return this.atIndex(e,t).formats
case mt.MATERIALS:{const s=this.atIndex(e,t)
return s.level===it?s.material.formats:s.component.formats}case mt.INTRO:return this.props.protocol.descriptionFormats
default:throw new Error(`Unexpected editor key: ${e}`)}})(),i=M.Z.getPartition(this.getEditor(),this.state.selected)
this.openInsertSymbolModal({editorKey:e,index:t},i,s)}))
Editor_defineProperty(this,"_formatHandler",((e,t,s)=>{if(s.format===f.Z.SYMBOL){this._handleOpenInsertSymbolModalForProtocolSection(e,t)
return}const i=c.default.findWhere(this.props.moreFormats,{format:s.format})
if(null==i){this.nestedStoreState(e,{selection:q.xH()})
switch(e){case mt.MATERIALS:return this._formatHandlerMaterials(t,s)
case mt.INTRO:return this._formatHandlerIntro(t,s)
case mt.STEPS:return this._formatHandlerSteps(t,s)
default:throw new Error(`Unexpected editor key: ${e}`)}}else i.onClick()}))
Editor_defineProperty(this,"_toolbarFormatHandler",((e,t)=>{const{editorKey:s,index:i}=this.state.selected,n=M.Z.getPartition(this.getEditor(),this.state.selected)
this._formatHandler(s,i,{format:e,data:t,partition:n})}))
Editor_defineProperty(this,"processIndexStr",((e,t)=>e===mt.MATERIALS?Array.from(t.split(",")).map((e=>parseInt(e))):parseInt(t)))
Editor_defineProperty(this,"getIntroCid",(()=>`${this.props.protocol.cid}-intro`))
Editor_defineProperty(this,"getTitleCid",(()=>`${this.props.protocol.cid}-title`))
Editor_defineProperty(this,"atIndex",((e,t)=>{switch(e){case mt.STEPS:return this.props.protocol.steps[t]
case mt.MATERIALS:return W.Z.getMaterialByIndex(this.props.protocol,t)
default:throw new Error(`Unexpected editor key: ${e}`)}}))
Editor_defineProperty(this,"_toolbarInsertItemHandler",(e=>{const{editorKey:t,index:s}=this.state.selected
if(e!==ct){if(t!==mt.STEPS)throw new Error(`Unexpected type ${e} for editor key ${t}`)
{const t=(()=>{switch(e){case lt.HEADER:case lt.STEP:case lt.DESC:return W.Z.makeStep("",k.Z.defaultFormats(),e)
case lt.IMAGE:return W.Z.makeImage()
case lt.TIMER:return W.Z.makeTimer()
case lt.TABLE:return this._makeTableItem(rt[0],rt[1])
case ut:return this._makeTableItem(ot[0],ot[1],{isWellPlate:!0})}})(),i=o()(this.props.protocol.steps,{$splice:[[s+1,0,t]]})
this.props.updateProtocol({steps:i})}}else this._handleOpenInsertSymbolModalForProtocolSection(t,s)}))
Editor_defineProperty(this,"_insertTableOrWellPlate",((e,t,s)=>{const i=this._makeTableItem(e,t,{isWellPlate:s}),n=o()(this.props.protocol.steps,{$splice:[[this.state.selected.index+1,0,i]]})
this.props.updateProtocol({steps:n})}))
Editor_defineProperty(this,"insertTableWithDimensions",((e,t)=>{this._insertTableOrWellPlate(e,t,!1)}))
Editor_defineProperty(this,"insertWellPlateWithDimensions",((e,t)=>{this._insertTableOrWellPlate(e,t,!0)}))
Editor_defineProperty(this,"_makeTableItem",((e,t,s)=>{null==s&&(s={})
const{isWellPlate:i}=s,n=Array.from(this.props.protocol.steps).filter((e=>e.level===lt.TABLE)).map((e=>e.table.name)),r=I.uniqueTableName(n,i?nt:void 0)
return W.Z.makeTable(r,null,e,t,{isWellPlate:i})}))
Editor_defineProperty(this,"updateFormattedText",(({formats:e,text:t,start:s,end:i},{editorKey:n,index:r})=>{let a
switch(n){case mt.INTRO:this.props.updateProtocol({descriptionFormats:e,description:t})
this.nestedRequestSelection(mt.INTRO,{selection:{start:s,end:i,cid:this.getIntroCid()}})
break
case mt.MATERIALS:{const l=this.atIndex(n,r)
if(l.level===it)a=o()(l.material,{$merge:{formats:e,name:t}})
else{const s=o()(l.component,{$merge:{formats:e,raw_text:t}})
a=o()(l.material,{components:{$merge:c.default.object([[r[1],s]])}})}const{materials:d}=this.props.protocol,p=o()(d,{$merge:c.default.object([[r[0],a]])})
this.props.updateProtocol({materials:p})
this.nestedRequestSelection(mt.MATERIALS,{selection:{cid:l.model.cid,start:s,end:i}})
return}case mt.STEPS:{const o={start:s,end:i,cid:this.atIndex(n,r).cid},a={formats:e,text:t}
this.updateSteps(r,a,o)
break}default:throw new Error(`Unexpected error key: ${n}`)}}))
Editor_defineProperty(this,"_formatHandlerMaterials",((e,t)=>{const s=this.atIndex(mt.MATERIALS,e),{cid:i}=s.model;(0,w.RZ)(s.model.formats,t,{editorKey:mt.MATERIALS,index:e},this.openInsertLinkModal,this.updateFormattedText)}))
Editor_defineProperty(this,"_formatHandlerIntro",((e,t)=>{this.getIntroCid();(0,w.RZ)(this.props.protocol.descriptionFormats,t,{editorKey:mt.INTRO,index:e},this.openInsertLinkModal,this.updateFormattedText)}))
Editor_defineProperty(this,"updateSteps",((e,t,s)=>{const i=o()(this.props.protocol.steps,c.default.object([[e,{$merge:t}]]))
this.props.updateProtocol({steps:i})
this.nestedRequestSelection(mt.STEPS,{selection:s})}))
Editor_defineProperty(this,"_formatHandlerSteps",((e,t)=>{const{format:s,partition:i}=t
let n=this.atIndex(mt.STEPS,e)
if("delete"!==s)switch(s){case at:{const t={time_seconds:n.time_seconds?null:600}
this.updateSteps(e,t,q.xH())
break}case dt:case pt:{const t=n.type===s?null:s
this.updateSteps(e,{type:t},q.xH())
break}case lt.HEADER:case lt.STEP:case lt.DESC:this.updateSteps(e,{level:s},q.xH())
break
default:(0,w.RZ)(n.formats,t,{editorKey:mt.STEPS,index:e},this.openInsertLinkModal,this.updateFormattedText)}else{this.nestedStoreState(mt.STEPS,{selection:{cid:n.cid,start:0,end:0}})
let t=null
if(e>0){n=this.atIndex(mt.STEPS,e-1)
null!=n.text&&(t={cid:n.cid,start:n.text.length,end:n.text.length})}else if(this.props.protocol.steps.length>1){n=this.atIndex(mt.STEPS,1)
null!=n.text&&(t={cid:n.cid,start:0,end:0})}const s=o()(this.props.protocol.steps,{$splice:[[e,1]]})
this.props.updateProtocol({steps:s})
null!=t&&this.nestedRequestSelection(mt.STEPS,{selection:t})}}))
Editor_defineProperty(this,"_toolbarMouseOverHandler",(e=>{const{editorKey:t,index:s}=this.state.selected;(Array.from(ht).includes(e)&&t===mt.STEPS||"delete"===e)&&this.setState({highlightEditorKey:t,highlightIndex:s})}))
Editor_defineProperty(this,"_toolbarInsertMouseOverHandler",(()=>{const{editorKey:e,index:t}=this.state.selected
this.setState({insertIndex:t,insertEditorKey:e})}))
Editor_defineProperty(this,"_toolbarInsertMouseOutHandler",(()=>{const{editorKey:e,index:t}=this.state.selected
this.setState({insertIndex:null,insertEditorKey:null})}))
Editor_defineProperty(this,"_toolbarMouseOutHandler",(()=>{this.setState({highlightIndex:null,highlightEditorKey:null})}))
Editor_defineProperty(this,"getEditor",(()=>p.findDOMNode(this.refs.editor)))
Editor_defineProperty(this,"onMouseDownCatcher",(e=>{if(this.props.locked)return
if(![p.findDOMNode(this.refs.editor),p.findDOMNode(this.getStepsEditor())].includes(e.target))return
e.preventDefault()
const t=l()(p.findDOMNode(this.getStepsEditor())).find(".mediocre-item"),s=c.default.max(t.map((function(){return l()(this).offset().top+l()(this).height()})))
if(e.pageY<=s)return
const i=this.props.protocol.steps[this.props.protocol.steps.length-1]
if(null!=i&&this.getStepsEditor().isItemTextual(i)){this.nestedRequestSelection(mt.STEPS,this.getStepsEditor().selectionAtEnd(i))
return}const n=W.Z.makeStep("",k.Z.defaultFormats(),lt.STEP),r=o()(this.props.protocol.steps,{$push:[n]})
this.props.updateProtocol({steps:r})
this.nestedRequestSelection(mt.STEPS,this.getStepsEditor().selectionInit(n))}))
Editor_defineProperty(this,"handleChangeSelected",(e=>{this.setState({selected:e})}))
Editor_defineProperty(this,"handleChangeFormatState",(e=>{this.setState({formatState:e})}))
Editor_defineProperty(this,"handleChangeAtSignState",(e=>{this.setState({atSignState:e})}))
Editor_defineProperty(this,"handleChangeSlashSignState",(e=>{this.setState({slashSignState:e})}))
Editor_defineProperty(this,"handleChangeHyperlinkState",(e=>{this.setState({hyperlinkState:e})}))
Editor_defineProperty(this,"handleChangeNonEmptySelectionState",(e=>{this.setState({nonEmptySelectionState:e})}))}componentDidMount(){this._isMounted=!0
window.addEventListener("resize",this._editorMarginThrottledResizeHandler)
c.default.defer((()=>{this._editorMarginResizeHandler()}))}componentWillUnmount(){window.removeEventListener("resize",this._editorMarginThrottledResizeHandler)
window.removeEventListener("resize",this._editorSizerThrottledHandleResize)
this._isMounted=!1}componentDidUpdate(e,t){this._editorMarginResizeHandler()
this._editorSizerHandleResize()}render(){const{editorKey:e,index:t,hasNonEmptyTextSelection:s}=this.state.selected,i=e===mt.STEPS?this.atIndex(e,t):void 0
return d.createElement("div",{className:"protocolEditor"},d.createElement("div",null,d.createElement(w.Mo,{fileId:this.props.fileId,showInsertLinkModal:this.state.showInsertLinkModal,editingLinkState:this.state.editingLinkState,closeInsertLinkModal:this.closeInsertLinkModal,updateFormattedText:this.updateFormattedText}),this.renderInsertSymbolModal()),this.props.showToolbar?d.createElement(m.Z,{leftChildren:d.createElement(h.Z,{key:"toolbar"},d.createElement(st,{formatState:this.state.formatState,mouseOverHandler:this._toolbarMouseOverHandler,mouseOutHandler:this._toolbarMouseOutHandler,insertMouseOverHandler:this._toolbarInsertMouseOverHandler,insertMouseOutHandler:this._toolbarInsertMouseOutHandler,insertHandler:this._toolbarInsertItemHandler,insertTableWithDimensions:this.insertTableWithDimensions,insertWellPlateWithDimensions:this.insertWellPlateWithDimensions,formatHandler:this._toolbarFormatHandler,locked:this.props.locked,stepLevel:null!=i?i.level:void 0,stepType:null!=i?i.type:void 0,stepHasTime:null!=i&&i.time_seconds>0,editorKey:e,printOptions:this.props.printOptions,printHandler:this.props.printHandler,moreFormats:this.props.moreFormats,hasNonEmptyTextSelection:s||!1})),banner:this.props.banner,rightChildren:[!this.props.protocol.inEntry&&(null!=this.props.protocol.permissions?this.props.protocol.permissions.readable:void 0)?d.createElement(h.Z,{key:"protocol-link"},d.createElement("a",{className:"u-no-text-decoration u-bold-font-weight",href:this.props.protocol.url,rel:"noopener noreferrer",target:"_blank"},"Discuss ",d.createElement(te.Z,{icon:"arrow-up-right-from-square"}))):void 0,null!=this.props.displayOptions?d.createElement(h.Z,{className:"u-vertical-center-items",key:"display-options"},d.createElement(P.Z,{options:this.props.displayOptions})):void 0]}):void 0,d.createElement("div",{ref:"container",className:n()("protocolEditor-pageContainer",{"is-printLayout":this.props.printLayout})},d.createElement("div",{className:"protocolEditor-page"},d.createElement("div",{ref:"editor",className:"protocolEditor-contentWrapper",onMouseDown:this.onMouseDownCatcher},this.renderEditor(mt.TITLE,null,He,{cid:this.getTitleCid()}),null!=this.state.hyperlinkState?d.createElement(De.Z,{box:this.state.hyperlinkState.box,link:this.state.hyperlinkState.link,onChange:()=>{this._toolbarFormatHandler(f.Z.LINK)},onRemove:e=>{this._toolbarFormatHandler(f.Z.SET_LINK,{url:null})},containerWidth:this.state.containerWidth}):void 0,d.createElement(A.Z,{selected:this.state.selected,onChangeSelected:this.handleChangeSelected,formatState:this.state.formatState,onChangeFormatState:this.handleChangeFormatState,atSignState:this.state.atSignState,onChangeAtSignState:this.handleChangeAtSignState,hyperlinkState:this.state.hyperlinkState,onChangeHyperlinkState:this.handleChangeHyperlinkState,processIndex:this.processIndexStr,scrollableParentSelector:".protocolEditor-pageContainer",slashSignState:this.state.slashSignState,onChangeSlashSignState:this.handleChangeSlashSignState,nonEmptySelectionState:this.state.nonEmptySelectionState,onChangeNonEmptySelectionState:this.handleChangeNonEmptySelectionState},d.createElement("div",null,d.createElement("h2",null,"Introduction"),this.renderEditor(mt.INTRO,null,U,{cid:this.getIntroCid()}),d.createElement("h2",null,"Materials"),this.renderEditor(mt.MATERIALS,null,Y),d.createElement("h2",null,"Procedure"),this.renderEditor(mt.STEPS,"stepsEditorBinder",Oe,{setRef:this.setStepsEditorRef,fileId:this.props.fileId,openManageSelectorsModal:this.props.openManageSelectorsModal,printLayout:this.props.printLayout,editorMargin:this.state.editorMargin}))),this.props.showPrintMargins?d.createElement("div",null,d.createElement("div",{className:"mediocre-pageMargin mediocre-pageMargin--left"}),d.createElement("div",{className:"mediocre-pageMargin mediocre-pageMargin--right"})):void 0))))}}Editor_defineProperty(ProtocolEditor,"propTypes",{fileId:b().string.isRequired,protocol:b().shape({inEntry:b().bool,permissions:b().shape({readable:b().bool.isRequired})}).isRequired,optionsChildren:b().node,storeState:b().func.isRequired,restoreState:b().func.isRequired,requestSelection:b().func.isRequired,moreFormats:b().arrayOf(b().shape({format:b().string.isRequired,onClick:b().func.isRequired,tooltip:b().arrayOf(b().string),moreKey:b().string})).isRequired,displayOptions:b().object,banner:b().string,spellCheck:b().bool.isRequired,showPrintMargins:b().bool.isRequired,printLayout:b().bool.isRequired,viewer:b().bool.isRequired})
Editor_defineProperty(ProtocolEditor,"defaultProps",{moreFormats:[],spellCheck:!1,printLayout:!1,viewer:!1})
const ft=ProtocolEditor},659443:(e,t,s)=>{s.d(t,{Z:()=>g})
var i=s(764403),n=s.n(i),r=s(250965),o=s.n(r),a=s(602652),l=s.n(a),d=s(989526),p=s(573961),c=s(615439),u=s.n(c),m=s(266981),h=s(334148),f=s(691012)
class DisplayOptions extends d.Component{constructor(){super(...arguments)
this.optionsView=void 0}componentDidMount(){this.optionsView=new m.Z({el:o()(p.findDOMNode(this)).find("ul.dropdown-menu"),model:this.props.options,featureCounts:this.props.featureCounts})
this.optionsView.render()}componentWillUnmount(){this.optionsView.stopListening()}componentDidUpdate(){this.optionsView.updateFeatureCounts(this.props.featureCounts)}render(){return d.createElement(f.Z,null,d.createElement(h.Co,{buttonStyle:h.ZJ.TERTIARY_GRAY,className:"display-options",icon:"settings",isDropdown:!0,size:h.qE.MINI}),d.createElement("ul",{className:n()("dropdown-menu","pull-right","select ","visibility-options",{"wide-width":this.props.isWide})}))}}DisplayOptions.propTypes={options:l().object.isRequired,featureCounts:l().object,isWide:l().bool}
const g=d.memo(DisplayOptions,(function areEqual(e,t){return u()(e.options,t.options)&&e.featureCounts===t.featureCounts}))},266981:(e,t,s)=>{s.d(t,{Z:()=>h})
var i=s(440281),n=s.n(i),r=s(250965),o=s.n(r),a=s(989526),l=s(468943),d=s(2186),p=s(847054)
const c=(0,s(659680).Z)((function VisibilityOption({option:e}){return a.createElement("li",{className:"visibility-option"},"check-option"===e.get("display")?a.createElement("label",{className:"checkbox check-option"},a.createElement("input",{type:"checkbox",className:e.get("name")}),a.createElement("span",null,e.get("displayName")),a.createElement("span",{className:"visibility-option-icons pull-right"},e.get("cssWarning")&&a.createElement("span",{"data-toggle":"tooltip","data-placement":"top",title:e.get("cssWarning"),className:"u-warning-color visibility-option-css-warning glyphicon glyphicon-exclamation-sign"}),e.get("settings").length>0&&a.createElement("span",{className:"settings glyphicon glyphicon-wrench"}))):a.createElement("label",{className:"checkbox toggle-option"},a.createElement("input",{type:"checkbox",className:e.get("name")}),a.createElement("span",{className:"unchecked-label"},e.get("displayOff")),a.createElement("span",{className:"checked-label"},e.get("displayOn")),a.createElement("span",{className:"visibility-option-icons pull-right"},e.get("cssWarning")&&a.createElement("span",{"data-toggle":"tooltip","data-placement":"top",title:e.get("cssWarning"),className:"u-warning-color visibility-option-css-warning glyphicon glyphicon-exclamation-sign"}),e.get("settings").length>0&&a.createElement("span",{className:"settings glyphicon glyphicon-wrench"}))))}))
var u=s(629656)
const m={annotations:{className:d.jB.name,displayName:d.jB.displayName},sequencePrimers:{className:d.gY.name,displayName:d.gY.displayName},parts:{className:d.qh.name,displayName:d.iX.displayName},translations:{className:d.KL.name,displayName:d.KL.displayName}}
class VisibilityOptionsDropdownView extends n().View{static initClass(){this.prototype.template=c}constructor(e){super(e)}initialize(e){super.initialize(e)
this.featureCounts=e.featureCounts}events(){return{"change input":"saveSetting","click .settings":"openSettingsModal","click .checkbox":"handleDropdownClick"}}handleDropdownClick(e){o()(e.currentTarget).hasClass("check-option")&&e.stopPropagation()}saveSetting(e){if(o()(e.target).hasClass(".settings"))return
const t=o()(e.target),s=t.data("data-option"),i=t.prop("checked")
s.set("visible",i)
l.j("editor","toggled_visibility",{option:s.get("name"),visible:i})}openSettingsModal(e){e.stopPropagation()
e.preventDefault()
const t=o()(e.currentTarget).data("data-option")
u.bA(p.V,a.createElement(p.Z,{settings:t.get("settings"),Description:t.get("descriptionComponent")}))}updateFeatureCounts(e){this.featureCounts=e
this.render()}render(){const e=this.model.getOption(d.lA.name)
function updateCheckbox(t,s){const i=s.get("disabled")||null!=e&&s!==e&&!e.get("visible")
t.prop("checked",s.get("visible"))
t.prop("indeterminate",s.get("indeterminate"))
t.prop("disabled",i)
return t.parent().toggleClass("disabled",i)}this.$el.empty()
this.$el.addClass("form-inline")
this.model.getEditableOptions().forEach((t=>{const s=o()(this.template({option:t})),i=s.find("input")
i.data("data-option",t)
s.find(".settings").data("data-option",t)
this.listenTo(t,"change:visible change:indeterminate change:disabled",(()=>{updateCheckbox(i,t)}))
null!=e&&this.listenTo(e,"change:visible",(()=>{updateCheckbox(i,t)}))
updateCheckbox(i,t)
this.$el.append(s)}))
if(this.featureCounts)for(const[e,t]of Object.entries(this.featureCounts)){const{className:s,displayName:i}=m[e]
this.$el.find(`.${s} + span`).text(`${i} `).append(o()("<span>").addClass("badge pull-right u-mini-spacing-left").text(t))}this.$('[data-toggle="tooltip"]').tooltip({container:"body"})
return this}stopListening(){this.$('[data-toggle="tooltip"]').tooltip("destroy")
return super.stopListening()}}VisibilityOptionsDropdownView.initClass()
const h=VisibilityOptionsDropdownView},847054:(e,t,s)=>{s.d(t,{V:()=>a,Z:()=>l})
var i=s(989526),n=s(531041),r=s(629656),o=s(205986)
const a="SETTINGS_MODAL_KEY"
function close(){r.xv(a)}function reduce(e,t){return{...e,[t.name]:t.value}}function SettingInput({setting:e,dispatch:t,autoFocus:s}){return"number-option"===e.get("display")?i.createElement("input",{type:"text",onChange:s=>{t({name:e.get("name"),value:e.get("parseStringValue")(s.target.value)})},defaultValue:e.get("value"),className:"value",autoFocus:s}):"select-option"===e.get("display")?i.createElement("select",{className:"value",onChange:s=>{t({name:e.get("name"),value:e.get("parseStringValue")(s.target.value)})},defaultValue:e.get("value"),autoFocus:s},e.get("options").map((({value:e,display:t})=>i.createElement("option",{key:e,value:e},t)))):i.createElement("input",{type:"checkbox",className:"value",defaultChecked:e.get("value"),onChange:s=>{t({name:e.get("name"),value:s.target.checked})}})}const l=function SettingsModal({Description:e,settings:t}){const[s,r]=(0,i.useReducer)(reduce,function getStateFromSettings(e){const t={}
e.forEach((e=>{t[e.get("name")]=e.get("value")}))
return t}(t.models)),a=n.default.findIndex(t.models,(e=>"number-option"===e.get("display")||"select-option"===e.get("display")))
return i.createElement(o.ZP,{title:"Settings",buttons:[{text:"Save",submit:!0},{text:"Cancel",cancel:!0}],onRequestSubmit:()=>{t.models.forEach((e=>{const t=s[e.get("name")]
e.set({value:t})}))
close()},onRequestClose:close},i.createElement("div",{className:"visibility-option-settings-modal"},t.models.map(((e,t)=>i.createElement("div",{key:e.get("name"),"data-name":e.get("name"),className:"row setting"},i.createElement("div",{className:"col col-md-6"},i.createElement("span",null,e.get("displayName"))),i.createElement("div",{className:"col col-md-6"},i.createElement(SettingInput,{autoFocus:t===a,setting:e,dispatch:r}))))),e&&i.createElement("div",{style:{marginTop:15}},i.createElement(e,null))))}},384727:(e,t,s)=>{s.d(t,{I:()=>ResultsTablePreview})
var i=s(989526),n=s(605604),r=s(453580),o=s(102176),a=s(929123)
function ResultsTablePreview(e){const t={...{...e.adapter.createTable({name:e.schemaAndColumnGroup.name,schemas:[e.schemaAndColumnGroup],entryId:"etr_123",metadata:{supportsManualEntry:!0,numResults:0},selectorsById:e.selectorsById}),cid:"123"},kind:r.sl.RESULTS},s=e.adapter.toTable(t)
return i.createElement(o.Z,{className:"u-spacing-top"},i.createElement(a.Z,null,"Preview"),i.createElement("div",{className:"modal-mediocre-tableWrapper"},i.createElement(n.ZP,{...n.W9,table:s,cid:"123",locked:!0,hideFormulaBox:!0,viewer:!0,icon:"table",enableFormulas:!1,hasPlaceholderRows:!0,storeState:()=>{},tableLabel:e.adapter.getDisplayName(t),isLeftAlignColumnHeader:!0})))}},40108:(e,t,s)=>{s.d(t,{Z:()=>getEditorMargin})
var i=s(250965),n=s.n(i)
function getEditorMargin(e){return null!=e&&n().contains(document.documentElement,e)?(n()(e).parent().innerWidth()-n()(e).outerWidth())/2:0}},516164:(e,t,s)=>{s.d(t,{Z:()=>A})
var i=s(250965),n=s.n(i),r=s(602652),o=s.n(r),a=s(531041),l=s(232606),d=s(99312),p=s(426076),c=s(252130),u=s(938417),m=s(128716),h=s(260929),f=s(636878)
const{BOLD:g,ITALIC:S,UNDERLINE:E,STRIKETHROUGH:y,FOREGROUND_COLOR:b,BACKGROUND_COLOR:I,MONOSPACE:T,SUBSCRIPT:C,SUPERSCRIPT:R}=c.Z
let x=!1
const v={}
v[g]="bold"
v[S]="italic"
v[E]="underline"
v[y]="strikethrough"
v[C]="subscript"
v[R]="superscript"
const k=[T],w={}
w[b]={domStyle:"foreColor",parseDOMValue:p.Z.parseDOMColor,extractValueFromData:e=>e.color===m.DM.NO_STYLE?"inherit":e.color}
w[I]={domStyle:"backColor",parseDOMValue(e){const t=p.Z.parseDOMColor(e)
return t===m.DM.WHITE?null:t},extractValueFromData:e=>e.color===m.DM.NO_STYLE?"inherit":e.color}
const _={_getFormatsFromRange:()=>{const e=u.rx()
if(!e)return null
const t=n()(u.Oc(e))
if(0===t.length)return null
const s=t.data("formats")
return s||null},__testing__reset:function(){x=!1},supports:e=>e in v||e in w,toggleFormat:function(e,t){if(e in v)document.execCommand(v[e])
else if((0,l.Gp)(e in w,`toggleFormat: unexpected format '${e}'`)){const{domStyle:s,extractValueFromData:i}=w[e]
document.execCommand(s,!1,i(t))}}}
function _queryCommandWrapper(e,t){if(d.isBrowser)try{return e()}catch(e){if(!x&&"NS_ERROR_FAILURE"!==e.name){x=!0
h.vU(e,{extra:{message:"Silently ignoring queryCommand future errors for session"}})}}return t}_.readFormats=function(){const e={}
for(const t of Object.keys(v)){const s=v[t]
e[t]=_queryCommandWrapper((()=>document.queryCommandState(s)),!1)}for(const t of Object.keys(w)){const{domStyle:s,parseDOMValue:i}=w[t]
e[t]=_queryCommandWrapper((()=>i(document.queryCommandValue(s))),null)}const t=u.xH(),s=_._getFormatsFromRange()
for(const i of k)e[i]=!!s&&f.Z.isSelectionFormatted(t,s,i)
return e}
_.__defaultFormats=function(){const e={}
for(const t of Object.keys(v))e[t]=!1
for(const t of Object.keys(w))e[t]=null
for(const t of k)e[t]=!1
return e}
const P=Object.keys(v).map((e=>[e,o().bool.isRequired])),M=Object.keys(w).map((e=>[e,o().string]))
_.propType=o().shape(a.default.object(a.default.extend(P,M)))
const A=_},453772:(e,t,s)=>{s.d(t,{Fv:()=>getEditingLinkState,Mo:()=>EditLinkModal,RZ:()=>formatText})
var i=s(602652),n=s.n(i),r=s(989526),o=s(171471),a=s(516164),l=s(636878),d=s(252130),p=s(959871),c=s(9834),u=s(195300)
function setLink(e,t,s){let i,n,r
const{before:o,after:a,selected:p,editingFormatIndex:c}=t
let u=t.formats
u=l.Z.removeRange(u,d.Z.FOREGROUND_COLOR,{start:o.length,end:o.length+p.length})
null!=(null!=e&&"name"in e?e.name:void 0)?({formats:n,text:r,end:i}=l.Z.replaceWithInternalLink(u,{before:o,after:a,selected:p},e)):({formats:n,text:r,end:i}=l.Z.replaceWithLink(u,{before:o,after:a,selected:p},e))
s({start:i,end:i,formats:n,text:r},c)}function EditLinkModal(e){return r.createElement(u.Z,{open:e.showInsertLinkModal},r.createElement(p.Z,{open:e.showInsertLinkModal,initialText:null!=e.editingLinkState?e.editingLinkState.selected:void 0,initialUrl:null!=e.editingLinkState?e.editingLinkState.url:void 0,setLinkAndClose:(t,s)=>{!function _setLinkAndClose(e,t,s,i,n,r){t&&e&&"id"in e&&e.id&&(0,c.Z)(r,e.id,t,o.D2.NOTEBOOK)
setLink(e,i,n)
s()}(t,s,e.closeInsertLinkModal,e.editingLinkState,e.updateFormattedText,e.fileId)},fileId:e.fileId}))}EditLinkModal.propTypes={showInsertLinkModal:n().bool.isRequired,editingLinkState:n().object,closeInsertLinkModal:n().func.isRequired,fileId:n().string.isRequired,updateFormattedText:n().func.isRequired}
function getEditingLinkState(e,t,s){const{before:i,selected:n,after:r,url:o}=l.Z.getSelectionForAddLink(e,{partition:t})
return{url:o,before:i,selected:n,after:r,formats:e,editingFormatIndex:s}}function formatText(e,{format:t,data:s,partition:i},n,r,o){if(null!=i)if(0===i.selected.length&&a.Z.supports(t))a.Z.toggleFormat(t,s)
else if(t===d.Z.LINK)r(e,i,n)
else if(t===d.Z.SET_LINK){const t=getEditingLinkState(e,i,n)
setLink({text:t.selected,url:s.url},t,o)}else if(t in e){let r,a,d;({formats:e,text:d,start:a,end:r}=l.Z.formatText(e,{format:t,data:s,partition:i}))
o({formats:e,text:d,start:a,end:r},n)}}},430801:(e,t,s)=>{s.d(t,{Z:()=>p})
var i=s(602652),n=s.n(i),r=s(989526),o=s(573961),a=s(675649),l=s(123594),d=s(285355)
class PositionedLinkPopover extends r.Component{constructor(){super(...arguments)
this.urlMap={}
this._handleClick=e=>{if(a.Gn(e)){e.preventDefault();(0,l.nG)(this.props.link.url)}}}componentDidMount(){this.urlMap=(0,l.ql)(o.findDOMNode(this))}componentDidUpdate(){this.urlMap=(0,l.Jb)(o.findDOMNode(this),this.urlMap)}componentWillUnmount(){(0,l.Zv)(o.findDOMNode(this))}_renderLink(){return r.createElement("a",{className:"positionedLinkPopover-link u-ellipsis-text",rel:"noopener",href:this.props.link.url,onClick:this._handleClick},this.props.link.url)}render(){const e=this.props.containerWidth-PositionedLinkPopover.WIDTH-PositionedLinkPopover.MARGIN
return r.createElement(d.Z,{className:"u-position-absolute",top:this.props.box.top,left:Math.min(this.props.box.left,e),width:PositionedLinkPopover.WIDTH,showArrow:!1},r.createElement("div",{className:"positionedLinkPopover-content"},this._renderLink(),r.createElement("span",{className:"positionedLinkPopover-buttons"},r.createElement("button",{className:"button button--tertiaryGray button--mini",onClick:this.props.onRemove,type:"button"},"Remove"),r.createElement("button",{className:"button button--secondary button--mini u-mini-spacing-left",onClick:this.props.onChange,type:"button"},"Change"))))}}PositionedLinkPopover.propTypes={box:n().shape({top:n().number.isRequired,left:n().number.isRequired}).isRequired,link:n().shape({text:n().string.isRequired,url:n().string.isRequired}).isRequired,onChange:n().func.isRequired,onRemove:n().func.isRequired,containerWidth:n().number.isRequired}
PositionedLinkPopover.WIDTH=336
PositionedLinkPopover.MARGIN=20
PositionedLinkPopover.MAX_LENGTH_URL=50
const p=PositionedLinkPopover},721911:(e,t,s)=>{s.d(t,{Z:()=>f})
var i=s(250965),n=s.n(i),r=s(602652),o=s.n(r),a=s(989526),l=s(573961),d=s(615439),p=s.n(d),c=s(348920),u=s(99312),m=s(516164),h=s(938417)
function indexOfRegExp(e,t,s){null==s&&(s=0)
const i=new RegExp(e,"g")
i.lastIndex=s
const n=i.exec(t)
return null==n?-1:n.index}class SelectionReader extends a.Component{constructor(){super(...arguments)
this._isMounted=!1
this.updateFromRange=()=>{let e,t
if(!this._isMounted)return
setTimeout((()=>{requestAnimationFrame(this.updateFromRange)}),250)
const s=h.rx()
if(null!=s&&n()(s.startContainer).closest(l.findDOMNode(this)).length>0){e=n()(s.startContainer).closest("[data-index][data-formattable]")
t=e.length>0}else t=!1
if(!t){this.setSelected({})
this.setAtSignState(null)
c.ZP.ENABLE_SLASH_MACRO_FOR_NOTEBOOK&&this.setSlashSignState(null)
c.ZP.ENABLE_HOVERING_FORMAT_TOOLBAR&&this.setNonEmptySelectionState(null)
this.setHyperlinkState(null)
return}const i=e.parents("[data-editor]").data("editor"),r=this.props.processIndex(i,e.attr("data-index")),o={index:r,subIndex:e.attr("data-subindex"),editorKey:i,hasNonEmptyTextSelection:!s.collapsed}
this.setAtSignState(this.readAtSignState(s,r,e[0]))
c.ZP.ENABLE_SLASH_MACRO_FOR_NOTEBOOK&&this.setSlashSignState(this.readSlashSignState(s,r,e[0]))
c.ZP.ENABLE_HOVERING_FORMAT_TOOLBAR&&this.setNonEmptySelectionState(this.readNonEmptySelectionState(s,r,e[0]))
this.setHyperlinkState(this.readHyperlinkState(s,r,e[0]))
this.setSelected(o)
this.setFormats(m.Z.readFormats())}}componentDidMount(){this._isMounted=!0
u.isBrowser&&this.updateFromRange()}componentWillUnmount(){this._isMounted=!1}setSelected(e){p()(this.props.selected,e)||this.props.onChangeSelected(e)}setFormats(e){p()(this.props.formatState,e)||this.props.onChangeFormatState(e)}_calculateBox(e,t,s){null==s&&(s=!0)
const i=document.createRange()
i.setStart(e,t)
i.setEnd(e,t+1)
const r=i.getBoundingClientRect()
let{top:o,left:a}=r
const{bottom:d,height:p}=r,c=n()(l.findDOMNode(this)).closest(this.props.scrollableParentSelector),u=c.offset()
o=(s?o:d)-u.top+c.scrollTop()
a=a-u.left+c.scrollLeft()
return{top:o,left:a,bottom:o+p}}readSlashSignState(e,t,s){let i=this.props.slashSignState;(null==i?void 0:i.index)!==t&&(i=null)
if(e.startContainer!==e.endContainer)return null
const n=e.startContainer.textContent
if(0===e.startOffset)return null
const r=n.lastIndexOf("/",e.startOffset-1)
if(-1===r)return null
if(r>0&&!/\s/.test(n.charAt(r-1)))return null
if(null==i){const t=indexOfRegExp("\\s",n,r)
if(-1!==t&&t<=e.startOffset-1)return null}let o=indexOfRegExp("\\s",n,e.startOffset-1);-1===o&&(o=n.length)
const a=n.slice(r+1,o)
if(0===a.length&&r!==e.startOffset-1)return null
if(null==i&&0!==a.length)return null
const l=this._calculateBox(e.startContainer,r),d=h.IT(e.startContainer,0,s,!0),p={text:a,start:d+r,end:d+o}
return{query:p,box:l,hidden:null!=i&&(i.hidden&&i.query.start===p.start),index:t}}readAtSignState(e,t,s){if(!n()(s).is("[data-allow-at-search]"))return null
let i=this.props.atSignState;(null!=i?i.index:void 0)!==t&&(i=null)
if(e.startContainer!==e.endContainer)return null
const r=e.startContainer.textContent
if(0===e.startOffset)return null
const o=r.lastIndexOf("@",e.startOffset-1)
if(-1===o)return null
if(o>0&&!/[\s(\[{]/.test(r.charAt(o-1)))return null
if(null==i){const t=indexOfRegExp("\\s",r,o)
if(-1!==t&&t<=e.startOffset-1)return null}let a=indexOfRegExp("[\\s)\\]}]",r,e.startOffset-1);-1===a&&(a=r.length)
const l=r.slice(o+1,a)
if(0===l.length&&o!==e.startOffset-1)return null
if(null==i&&0!==l.length)return null
const d=this._calculateBox(e.startContainer,o),p=h.IT(e.startContainer,0,s,!0),c={text:l,start:p+o,end:p+a}
return{query:c,box:d,hidden:null!=i&&(i.hidden&&i.query.start===c.start),index:t}}setAtSignState(e){p()(this.props.atSignState,e)||this.props.onChangeAtSignState(e)}setSlashSignState(e){p()(this.props.slashSignState,e)||this.props.onChangeSlashSignState(e)}readHyperlinkState(e,t,s){let i
if(h.oq(s,".internalLink"))return null
let n=h.oq(s,"a")
if(null!=n){if(h.J_({target:n}))return null}else{i=e.startContainer
if("A"!==(null!=i.nextSibling?i.nextSibling.nodeName:void 0)||!h.J_({target:i}))return null
n=i.nextSibling}if(!n.attributes.href)return null
const r={url:n.attributes.href.value,text:n.textContent}
return{box:this._calculateBox(n,0,!1),link:r,node:n}}setHyperlinkState(e){p()(this.props.hyperlinkState,e)||this.props.onChangeHyperlinkState(e)}readNonEmptySelectionState(e,t,s){if(e.collapsed||null==e.startContainer.textContent)return null
const i=e.startOffset>0?e.startOffset-1:0
return{box:this._calculateBox(e.startContainer,i,!1)}}setNonEmptySelectionState(e){p()(this.props.nonEmptySelectionState,e)||this.props.onChangeNonEmptySelectionState(e)}render(){return this.props.children}}SelectionReader.propTypes={selected:o().object,onChangeSelected:o().func.isRequired,formatState:o().object,onChangeFormatState:o().func.isRequired,atSignState:o().object,onChangeAtSignState:o().func.isRequired,hyperlinkState:o().object,onChangeHyperlinkState:o().func.isRequired,scrollableParentSelector:o().string.isRequired,processIndex:o().func.isRequired,slashSignState:o().object,onChangeSlashSignState:o().func.isRequired,nonEmptySelectionState:o().object,onChangeNonEmptySelectionState:o().func.isRequired}
SelectionReader.defaultProps={processIndex:(e,t)=>parseInt(t,10)}
const f=SelectionReader},390697:(e,t,s)=>{s.d(t,{Z:()=>_})
var i=s(602652),n=s.n(i),r=s(989526),o=s(514076),a=s.n(o),l=s(573961),d=s(531041),p=s(974913),c=s(103593),u=s(59860),m=s(263137)
class CharPreview extends r.PureComponent{constructor(){super(...arguments)
this.onClick=()=>{this.props.selectChar({char:this.props.char,insert:!1})}
this.onDoubleClick=()=>{this.props.selectChar({char:this.props.char,insert:!0})}}static previewableChar(e){return" "===e?" ":e}render(){return r.createElement("div",{className:"charPreview pull-left u-pointer",onClick:this.onClick,onDoubleClick:this.onDoubleClick,...(0,m.Z)({component:"CharPreview",element:"root",key:this.props.char})},CharPreview.previewableChar(this.props.char))}}CharPreview.propTypes={char:n().string.isRequired,selectChar:n().func.isRequired}
const h=CharPreview,f=["࿕","࿖","࿗","࿘"]
function isCharBlocked(e){return f.includes(e)}const g=["°","†","‡","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"]
class CharListing extends r.PureComponent{getChars(){if(this.props.searchQuery.length)return this.props.searchResults
if(this.props.subCategory===CharListing.COMMON_SYMBOLS_SUBCATEGORY)return g
const e=this.props.charPickerData.charList[this.props.category][this.props.subCategory]
return a().helpers.toCharList(e)}render(){return r.createElement("div",{className:"charListing u-small-spacing-top",...(0,m.Z)({component:"CharListing",element:"root"})},Array.from(this.getChars()).filter((e=>!isCharBlocked(e))).map(((e,t)=>r.createElement(h,{key:t,char:e,selectChar:this.props.selectChar}))))}}CharListing.propTypes={charPickerData:n().instanceOf(a()).isRequired,searchQuery:n().string.isRequired,searchResults:n().array.isRequired,category:n().number.isRequired,subCategory:n().number.isRequired}
CharListing.COMMON_SYMBOLS_SUBCATEGORY=-1
const S=CharListing
var E=s(250965),y=s.n(E),b=s(260929),I=s(771398),T=s(64558)
function _defineProperty(e,t,s){(t=function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}function notifyUnicloudError(e,t,s){notifyUnicloudError=T.ZT
b.vU(`UniCloud: request to endpoint ${t}?${y().param(s)} failed with error code ${e.status}`)}class UniCloud extends r.PureComponent{constructor(...e){super(...e)
_defineProperty(this,"state",{name:void 0})
_defineProperty(this,"fetchName",(e=>{this.setState({name:void 0})
const t=a().helpers.toCharCode(e).toString(16)
UniCloud._queryEndpoint("/1/api/uni-cloud/cproperties",{p:"name",c:t}).then((e=>{for(const t in e){return e[t].name}})).catch((()=>" ")).then((t=>{this._isMounted&&this.props.char===e&&this.setState({name:t})}))}))}static _queryEndpoint(e,t){return I.UJ(e,t).catch((s=>{notifyUnicloudError(s,e,t)
throw s}))}static searchChars(e){return UniCloud._queryEndpoint("/1/api/uni-cloud/csearch",{p:"name",q:e}).then((e=>{const t=[]
for(const s in e)t.push(a().helpers.fromCharCode(parseInt(s,16)))
return t}))}componentDidMount(){this.fetchName(this.props.char)
this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}UNSAFE_componentWillReceiveProps(e){e.char!==this.props.char&&this.fetchName(e.char)}render(){const e=a().helpers.toHexString(this.props.char)
return this.props.children({name:this.state.name,codePoint:e})}}_defineProperty(UniCloud,"propTypes",{char:n().string.isRequired,children:n().func.isRequired})
const C=UniCloud
var R=s(926025)
function UnicodeCharacterChooser_defineProperty(e,t,s){(t=function UnicodeCharacterChooser_toPropertyKey(e){var t=function UnicodeCharacterChooser_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var s=e[Symbol.toPrimitive]
if(void 0!==s){var i=s.call(e,t||"default")
if("object"!=typeof i)return i
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s
return e}const x=new(a()),v=S.COMMON_SYMBOLS_SUBCATEGORY
class FullCharPreview extends r.PureComponent{render(){return r.createElement(C,{char:this.props.char},(({name:e,codePoint:t})=>r.createElement("div",{className:"fullCharPreview u-small-spacing-top u-small-padding"},r.createElement("div",{className:"fullCharPreview-char selectable"},h.previewableChar(this.props.char)),r.createElement("div",null,e||" "),r.createElement("div",{className:"u-small-text faded"},t))))}}UnicodeCharacterChooser_defineProperty(FullCharPreview,"propTypes",{char:n().string.isRequired})
class UnicodeCharacterChooser extends r.PureComponent{constructor(...e){super(...e)
UnicodeCharacterChooser_defineProperty(this,"state",{searchQuery:"",searchResults:[],category:0,subCategory:v})
UnicodeCharacterChooser_defineProperty(this,"performSearch",(0,R.D)((e=>{this._isMounted&&0===e.length?this.clearSearch():C.searchChars(e).catch((()=>{p.ZP.error("An error occurred while searching.",{id:"unicode-character-chooser"})
return[]})).then((t=>{if(this._isMounted&&this.state.searchQuery===e){const e=function sortSearchResults(e){return d.default.sortBy(e,(e=>g.includes(e)?-1:1))}(t)
this.setState({searchResults:e},(()=>{if(0===e.length)return
const t=e[0]
this.props.selectChar({char:t,insert:!1})}))}}))}),100))
UnicodeCharacterChooser_defineProperty(this,"handleQueryChange",(e=>{const t=e.target.value
this.setState({searchQuery:t})
this.performSearch(t)}))
UnicodeCharacterChooser_defineProperty(this,"handleCategoryChange",(e=>{const t=parseInt(e.target.value,10),s=0===t?S.COMMON_SYMBOLS_SUBCATEGORY:0
this.setState({category:t,subCategory:s})}))
UnicodeCharacterChooser_defineProperty(this,"handleSubCategoryChange",(e=>{const t=parseInt(e.target.value,10)
this.setState({subCategory:t})}))
UnicodeCharacterChooser_defineProperty(this,"clearSearch",(()=>{this.setState({searchQuery:"",searchResults:[]})}))}componentDidMount(){this._isMounted=!0
return d.default.defer((()=>{this._isMounted&&l.findDOMNode(this.refs.searchInput).focus()}))}componentWillUnmount(){this._isMounted=!1}render(){let e,t
return r.createElement("div",null,r.createElement(u.Z,null,r.createElement(c.Z,{sm:7},r.createElement("div",null,this.state.searchQuery.length?r.createElement("a",{onClick:this.clearSearch,className:"u-input-line-height"},"Clear search"):[r.createElement("select",{key:"select-category",className:"u-inline-form-input-sm",value:this.state.category,onChange:this.handleCategoryChange},(()=>{const t=[]
for(e=0;e<x.categories.length;e++){const s=x.categories[e]
t.push(r.createElement("option",{key:e,value:e},s))}return t})()),r.createElement("select",{key:"select-subcategory",className:"u-inline-form-input u-small-spacing-left",value:this.state.subCategory,onChange:this.handleSubCategoryChange},0===this.state.category?r.createElement("option",{key:S.COMMON_SYMBOLS_SUBCATEGORY,value:S.COMMON_SYMBOLS_SUBCATEGORY},"Common Symbols"):void 0,(()=>{const e=[]
for(t=0;t<x.subcategories[this.state.category].length;t++){const s=x.subcategories[this.state.category][t]
e.push(r.createElement("option",{key:t,value:t},s))}return e})())]),r.createElement(S,{charPickerData:x,searchQuery:this.state.searchQuery,searchResults:this.state.searchResults,category:this.state.category,subCategory:this.state.subCategory,selectChar:this.props.selectChar})),r.createElement(c.Z,{sm:5},r.createElement("input",{type:"text",ref:"searchInput",placeholder:"Search for a symbol, e.g. omega",value:this.state.searchQuery,onChange:this.handleQueryChange}),null!=this.props.char?r.createElement(FullCharPreview,{char:this.props.char}):void 0)))}}UnicodeCharacterChooser_defineProperty(UnicodeCharacterChooser,"propTypes",{char:n().string,selectChar:n().func.isRequired})
const k=UnicodeCharacterChooser
var w=s(205986)
class InsertSymbolModal extends r.PureComponent{constructor(){super(...arguments)
this.state={symbol:null}
this.onRequestSubmit=()=>{null!=this.state.symbol&&this.insertSymbol(this.state.symbol)}
this.selectSymbol=({char:e,insert:t})=>{isCharBlocked(e)||(t?this.insertSymbol(e):this.setState({symbol:e}))}}insertSymbol(e){this.props.onRequestSubmit(e)
this.props.onRequestClose()}render(){return r.createElement(w.ZP,{title:"Insert symbol",onRequestClose:this.props.onRequestClose,onRequestSubmit:this.onRequestSubmit,buttons:[{text:"Insert",submit:!0,disabled:null==this.state.symbol}]},r.createElement(k,{char:this.state.symbol,selectChar:this.selectSymbol}))}}InsertSymbolModal.propTypes={onRequestClose:n().func.isRequired,onRequestSubmit:n().func.isRequired}
const _=InsertSymbolModal},860811:(e,t,s)=>{s.d(t,{Ns:()=>NoteLinkedFileTabState,b7:()=>NoteLinkedFileTabView,q9:()=>NoteLinkedFileOptionsView})
var i=s(440281),n=s.n(i),r=s(989526),o=s(573961),a=s(531041),l=s(984152),d=s(977774),p=s(342459),c=s(911525),u=s(699418),m=s(766455),h=s(676276),f=s(873335)
class NoteLinkedFileTabState extends m.Xh{constructor({noteLinkedFileId:e,fileName:t,previewFile:s,externalFile:i,isPreviewTransformed:n,owningEntityApiId:r}){super(...arguments);(null==i?void 0:i.availablePreviewTypes.includes(l.g.NOT_PREVIEWABLE))&&(i.availablePreviewTypes=[])
const o={},a={}
null==s||s.availablePreviewTypes.forEach((e=>{o[e]=s.url
a[e]=s.id}))
null==i||i.availablePreviewTypes.forEach((e=>{o[e]=i.url
a[e]=i.id}))
const d=t.includes(".")?t.split(".").pop():"",p=d?d.toLowerCase():""
if("tif"===p||"tiff"===p){o.image=(null==s?void 0:s.url)||i.url
a.image=(null==s?void 0:s.id)||i.id}const c=(null==i?void 0:i.availablePreviewTypes[0])||(null==s?void 0:s.availablePreviewTypes[0])||""
this.set({title:t,previewType:c,previewTypeUrlMapping:o,previewTypeIdMapping:a,noteLinkedFileId:e,owningEntityApiId:r,isPreviewTransformed:n})}previewTypeUrlMapping(){return this.get("previewTypeUrlMapping")}previewTypeIdMapping(){return this.get("previewTypeIdMapping")}previewType(){return this.get("previewType")}isPreviewTransformed(){return this.get("isPreviewTransformed")}defaults(){return a.default.extend(super.defaults(),{title:"Preview File",closeable:!0,previewUrlMapping:{},previewType:"",printOptions:[]})}noteLinkedFileId(){return this.get("noteLinkedFileId")}owningEntityApiId(){return this.get("owningEntityApiId")}static open(e,t,s,i,n,r){const o=u.ZP.get().get(e),a=o.findTab(NoteLinkedFileTabState,(e=>e.noteLinkedFileId()===t))
if(null!=a){a.set({active:!0})
return}const l=new NoteLinkedFileTabState({owningEntityApiId:e,noteLinkedFileId:t,fileName:s,previewFile:i,externalFile:n,isPreviewTransformed:r})
o.buffers().addTab(l)}}class NoteLinkedFileTabView extends n().View{static initClass(){this.prototype.className="external-file-wrapper buffer-tab buffer-tab--no-padding"}initialize(){this.listenTo(this.model,"change",(()=>this.render()))}render(){const e=this.model.previewType(),t=e?this.model.previewTypeUrlMapping()[e]:"",s=e?this.model.previewTypeIdMapping()[e]:"",i=this.model.owningEntityApiId();(0,h.A9)(r.createElement(p.Z,{url:t,externalFileId:s,previewType:e,owningEntityApiId:i}),this.el)
return this}remove(){o.unmountComponentAtNode(this.el)
super.remove()
return this}}NoteLinkedFileTabView.initClass()
class NoteLinkedFileOptionsView extends n().View{constructor(){super(...arguments)
this.updatePreviewType=e=>{this.model.set("previewType",e)}}initialize(){this.listenTo(this.model,"change",(()=>this.render()))}render(){(0,h.A9)(r.createElement(d.Z,{availablePreviewTypes:Object.keys(this.model.previewTypeUrlMapping()),previewType:this.model.previewType(),updatePreviewType:this.updatePreviewType,printOptions:[],generateDownloadUrl:async e=>e?await(0,c.V)(this.model.previewType()?this.model.previewTypeIdMapping()[this.model.previewType()]:"",this.model.previewType()?this.model.previewTypeUrlMapping()[this.model.previewType()]:"",this.model.owningEntityApiId()):f.Jt({uuid:this.model.noteLinkedFileId(),name:this.model.get("title")}),isPreviewTransformed:this.model.isPreviewTransformed()}),this.el)
return this}remove(){o.unmountComponentAtNode(this.el)
return super.remove()}}},181483:(e,t,s)=>{s.d(t,{Z:()=>S})
var i=s(64558),n=s(764403),r=s.n(n),o=s(250965),a=s.n(o),l=s(989526),d=s(573961)
const p={CELL_SIZE:19,CELL_PADDING:2,MAX_ROWS:20,MAX_COLS:20}
var c=s(851422)
const{DEFAULT_TABLE_SIZE:u}=c,{CELL_SIZE:m,CELL_PADDING:h,MAX_ROWS:f,MAX_COLS:g}=p
class InsertTableComponent extends l.Component{constructor(){super(...arguments)
this.state={numRows:u[0],numCols:u[1]}
this.cellGridRef=l.createRef()
this.insertTable=()=>{this.props.insertTableWithDimensions(this.state.numRows,this.state.numCols)}
this.setDimensions=(e,t)=>{this.setState({numRows:(0,i.uZ)(1,f,e),numCols:(0,i.uZ)(1,g,t)})}
this.mouseMoveHandler=e=>{const{top:t,left:s}=a()(d.findDOMNode(this.cellGridRef.current)).offset(),i=e.pageX-Math.round(s),n=e.pageY-Math.round(t),r=Math.ceil(n/(m+2*h)),o=Math.ceil(i/(m+2*h))
this.setDimensions(r,o)}
this.renderCell=(e,t)=>l.createElement("span",{key:t,className:r()("insertTable-cell",{"is-highlighted":e<this.state.numRows&&t<this.state.numCols}),style:{height:m,width:m,margin:h}})
this.renderRow=e=>{const t=(0,i.uZ)(5,g,this.state.numCols+1)
return l.createElement("div",{key:e,className:"insertTable-row"},__range__(0,t,!1).map((t=>this.renderCell(e,t))))}
this.renderGrid=()=>{const e=(0,i.uZ)(5,f,this.state.numRows+1)
return l.createElement("div",{className:"insertTable-visibleCells",onMouseMove:this.mouseMoveHandler},l.createElement("div",{className:"insertTable-dimensionCaption text-center"},`${this.state.numRows} x ${this.state.numCols}`),l.createElement("div",{ref:this.cellGridRef,onClick:this.insertTable},__range__(0,e,!1).map((e=>this.renderRow(e)))))}}render(){return l.createElement("div",{className:"insertTable"},l.createElement("div",{className:"insertTable-mouseTracker",onMouseMove:this.mouseMoveHandler,style:{width:g*(m+2*h)+100,marginLeft:-50,marginTop:-50,height:f*(m+2*h)+100,position:"absolute"}}),this.renderGrid())}}const S=InsertTableComponent
function __range__(e,t,s){const i=[],n=e<t,r=s?n?t+1:t-1:t
for(let t=e;n?t<r:t>r;n?t++:t--)i.push(t)
return i}},43987:(e,t,s)=>{s.d(t,{Z:()=>InsertWellPlateMenu})
var i=s(764403),n=s.n(i),r=s(989526),o=s(851422)
function InsertWellPlateMenu({insertWellPlateWithDimensions:e}){return r.createElement("ul",{className:"dropdown-menu"},o.PLATE_SIZE_OPTIONS.map((([t,s],i)=>r.createElement("li",{key:i,className:n()({"dropdown-menu-default":t===o.DEFAULT_PLATE_SIZE[0]&&s===o.DEFAULT_PLATE_SIZE[1]})},r.createElement("a",{onClick:e.bind(null,t,s)},`${s*t}-well plate (${t} x ${s})`)))))}},462836:(e,t,s)=>{s.d(t,{Z:()=>TFIAccountIcon})
var i=s(153686),n=s(989526),r=s(733754)
function TFIAccountIcon({accountType:e,className:t}){const s=r.J$[e]
return n.createElement(i.TR,{className:t,name:s})}},629947:(e,t,s)=>{s.d(t,{Z:()=>a})
var i=s(531041),n=s(348920),r=s(733754),o=s(901113)
function readableAccountType(e){switch(e){case r.Qm.BOX:return"Box"
case r.Qm.DROPBOX:return"Dropbox"
case r.Qm.EGNYTE:return"Egnyte"
case r.Qm.GDRIVE:return"Google Drive"
case r.Qm.ONEDRIVE:return"OneDrive"
case r.Qm.HOSTED_S3:throw new Error("TFI Error: Unexpected TFI account type")
default:throw new Error(`TFI Error: ${(0,o.vE)(e)} is not a valid TFI account type`)}}function getAllowedAccountTypes(){return i.default.compact([n.ZP.TFI_ENABLE_EGNYTE?r.Qm.EGNYTE:void 0,n.ZP.TFI_ENABLE_ONEDRIVE?r.Qm.ONEDRIVE:void 0,n.ZP.TFI_ENABLE_BOX?r.Qm.BOX:void 0,n.ZP.TFI_ENABLE_DROPBOX?r.Qm.DROPBOX:void 0,n.ZP.TFI_ENABLE_GDRIVE?r.Qm.GDRIVE:void 0])}const a={isTFIFile:function isTFIFile(e){return!e.isFolder&&e.hasOwnProperty("modifiedAt")},readableAccountType,overwriteMessage:function overwriteMessage(e){return`Overwrite Benchling file with ${readableAccountType(e)} file`},getAllowedAccountTypes,getAllowedAccountsString:function getAllowedAccountsString(){let e
const t=getAllowedAccountTypes().map((e=>readableAccountType(e)))
if(1===t.length)e=t[0]
else if(2===t.length)e=`${t[0]} or ${t[1]}`
else{e=t.slice(0,-1).join(", ")
e+=`, or ${t[t.length-1]}`}return e}}},672116:(e,t,s)=>{s.d(t,{Z:()=>ChecklistItemListing})
var i=s(692013),n=s(764403),r=s.n(n),o=s(989526),a=s(848640),l=s(232606),d=s(129270),p=s(271359),c=s(723635),u=s(36424)
function Emoji(e){var t
return o.createElement("span",{className:"emoji",role:"img","aria-label":null!==(t=e.label)&&void 0!==t?t:"","aria-hidden":null!=e.label},e.symbol)}function ChecklistCircle(e){return o.createElement(o.Fragment,null,e.completed?o.createElement("span",{className:(0,i.iv)(m.circle,m.completeCircle)},o.createElement(u.Z,{icon:"check",style:{marginBottom:"0px",verticalAlign:"0px"}})):e.isLast?o.createElement("span",{className:(0,i.iv)(m.circle,m.lastCircle)},o.createElement(Emoji,{label:"party-popper",symbol:"🎉"})):o.createElement("span",{className:(0,i.iv)(m.circle,m.incompleteCircle)}))}function AdditionalInformation(e){(0,l.hu)(null!=e.description||null!=e.steps,"One of description or steps must be non-null.")
return o.createElement("div",{className:(0,i.iv)(m.bodyText)},e.description?o.createElement("div",{style:{marginLeft:"42px"}},e.description):o.createElement("ol",{style:{paddingLeft:"52px"}},e.steps.map(((e,t)=>o.createElement("li",{className:"u-mini-spacing-bottom",key:t},e)))))}function ChecklistItem(e){const[t,s]=(0,c.Z)()
return o.createElement("div",{className:r()((0,i.iv)(m.container),!e.isOpen&&"u-pointer"),style:e.isOpen?{backgroundColor:"#F5F5F6"}:void 0,onClick:e.isOpen?()=>{}:e.onClick,...e.isLast?{}:s},o.createElement(ChecklistCircle,{completed:e.completed,isLast:e.isLast}),o.createElement("span",{className:r()((0,i.iv)(m.titleText),e.completed&&"u-faded u-strike-through")},e.title),t&&!e.isOpen&&o.createElement(u.Z,{icon:"chevron-right",className:"pull-right",style:{fontSize:"16px",marginTop:"3px"}}),e.isOpen&&o.createElement(o.Fragment,null,o.createElement(u.Z,{icon:"chevron-down",className:"pull-right u-pointer",style:{fontSize:"16px",marginBottom:"0px"},onClick:e.onClick}),o.createElement(AdditionalInformation,{description:e.description,steps:e.steps})))}const m=i.mM.create({container:{paddingTop:"13px",paddingBottom:"13px",paddingRight:"11px",":hover":{backgroundColor:"#F5F5F6"},color:p.Rl},circle:{display:"inline-block",height:"20px",width:"20px",borderRadius:"100px",marginLeft:"11px",verticalAlign:"middle",position:"relative"},completeCircle:{padding:"4px",backgroundColor:p.t0,color:p.Cj},incompleteCircle:{border:`2px solid ${p.pF}`,backgroundColor:p.Cj},lastCircle:{paddingLeft:"4px",paddingTop:"3px",fontSize:"10px",backgroundColor:`${p.tN}`},titleText:{fontFamily:d.I3,fontSize:"14px",lineHeight:"16px",paddingLeft:"10px",verticalAlign:"middle"},bodyText:{paddingTop:"12px",fontSize:"12px",lineHeight:"14px"}})
var h=s(645968),f=s(619693),g=s(13055)
function CollapsedChecklistButton(e){return o.createElement("div",{className:r()((0,i.iv)(S.minimizedChecklist),"u-pointer")},o.createElement(u.Z,{icon:"checklist",className:"u-mini-spacing-right",onClick:e.onClick}),o.createElement("div",{onClick:e.onClick},e.title),o.createElement(u.Z,{icon:"close",className:(0,i.iv)(S.dismissIcon),onClick:()=>{a.k4(e.module)}}))}function ChecklistHeader(e){return o.createElement("div",{className:(0,i.iv)(S.header)},o.createElement("div",{className:(0,i.iv)(S.headerText)},e.titleText,o.createElement("span",{className:r()("pull-right u-pointer",(0,i.iv)(S.toggleIcon)),onClick:e.onClickCollapse},o.createElement(u.Z,{icon:"chevron-down"}))),o.createElement("div",{className:(0,i.iv)(S.progressContainer)},o.createElement(f.Z,{className:(0,i.iv)(S.progressBar),value:e.percentageComplete,type:"onboarding"}),o.createElement("div",{className:(0,i.iv)(S.percentText)}," ",e.percentageComplete,"% ")))}function ChecklistItemListing(e){var t
const{completed:s,module:n}=e;(0,o.useEffect)((()=>{s&&a.PW(n)}),[s,n])
const handleChangeCollapsed=()=>{e.onChangeCollapsed(!e.collapsed)
a.LW(e.module,!e.collapsed)},handleClickModuleItem=t=>{const s=e.listItems[t]
if(s.description||s.steps||s.onClick){s.onClick&&s.onClick();(0,g.e_)(t+1,s.title,e.openIndex!==t,h.y$[n].key,h.y$[n].title,s.resultForTracking);(t=>{a.t5(e.module,e.openIndex!==t||e.collapsed?t:null)})(t)}},r=null!==(t=e.collapsedNode)&&void 0!==t?t:o.createElement(CollapsedChecklistButton,{module:e.module,title:e.title,onClick:handleChangeCollapsed})
return o.createElement(o.Fragment,null,e.collapsed?r:o.createElement("div",{className:(0,i.iv)(S.checklist,e.fixedSize&&S.fixedSizeChecklist)},o.createElement(ChecklistHeader,{titleText:e.title,onClickCollapse:handleChangeCollapsed,percentageComplete:(()=>{const t=e.listItems.filter((e=>e.countTowardCompletion))
return Math.ceil(t.filter((e=>e.completed)).length/t.length*100)})()}),!e.collapsed&&o.createElement("div",{className:(0,i.iv)(S.verticalConnector)}),e.listItems.map(((t,s)=>{const i=s===e.listItems.length-1
return o.createElement(ChecklistItem,{key:t.key,title:t.title,completed:t.completed,description:t.description,steps:t.steps,isOpen:s===e.openIndex,onClick:()=>{handleClickModuleItem(s)},isLast:i})}))))}const S=i.mM.create({minimizedChecklist:{height:"32px",width:"max-content",borderRadius:"100px",padding:"8px 10px 8px 10px",backgroundColor:p.t0,color:p.Cj,fontSize:"12px",lineHeight:"18px",display:"flex",alignItems:"center"},dismissIcon:{width:".75em",height:".75em",marginLeft:"6px"},checklist:{borderRadius:"4px",border:`2px solid ${p.t0}`,boxShadow:"0px 0px 6px 3px rgba(52, 64, 67, 0.2)",backgroundColor:p.Cj,paddingBottom:"4px"},fixedSizeChecklist:{minHeight:"360px",width:"270px"},header:{height:"66px",padding:"9px, 11px, 9px, 11px",backgroundColor:p.t0},headerText:{color:p.Cj,fontFamily:d.I3,fontSize:"16px",lineHeight:"24px",paddingTop:"10px",paddingLeft:"10px"},toggleIcon:{paddingRight:"13px"},progressContainer:{display:"flex",justifyContent:"space-between"},progressBar:{height:"8px",width:"80%",marginTop:"13px",marginLeft:"10px"},percentText:{marginRight:"10px",marginTop:"8px",color:p.Cj},verticalConnector:{height:"calc(100% - 110px)",position:"absolute",left:"22px",top:"85px",borderLeft:`2px solid ${p.pF}`}})},13055:(e,t,s)=>{s.d(t,{F8:()=>trackChecklistCollapsed,GN:()=>makeGettingStartedItems,O8:()=>trackChecklistOpened,Rw:()=>shouldShowOnboardingChecklistsIcon,ab:()=>makeEntryListItems,e_:()=>trackClickTask,lx:()=>makeSequenceListItems})
var i=s(531041),n=s(468943),r=s(232606),o=s(922633),a=s(781995),l=s(645968),d=s(808844)
const p=(0,d.td)(o.ZP.SPACE_ADDITION_SIZES.ONBOARDING[o.ZP.MODULES.ENTRY]),c=(0,d.td)(o.ZP.SPACE_ADDITION_SIZES.ONBOARDING[o.ZP.MODULES.SEQUENCE]),u=(0,d.td)(o.ZP.SPACE_ADDITION_SIZES.ONBOARDING[o.ZP.MODULES.GETTING_STARTED])
function makeDummyListItem(e,t){return{completed:!0,key:"dummy-list-item",description:t,title:e,countTowardCompletion:!0}}function makeCompletionListItem(e,t){return{completed:e,key:"finish-space",title:t,countTowardCompletion:!1}}function makeEntryListItems(e,t,s,i){const n=Object.keys(l.TV),o=e.filter((e=>n.includes(e.key))).map((e=>({key:e.key,completed:e.completed,title:l.TV[e.key].title,description:l.TV[e.key].description(t),countTowardCompletion:!0})));(0,r.Gp)(o.length===n.length,"Unexpected task keys")
o.unshift(makeDummyListItem("Open a Notebook entry",'Navigate to "Example Project" and open "Example Entry".'))
i?o.push(makeCompletionListItem(s,`Earn ${p} of extra space!`)):o.push(makeCompletionListItem(s,"Celebrate!"))
return o}function makeSequenceListItems(e,t,s){const i=Object.keys(l.kQ),n=e.filter((e=>i.includes(e.key))).map((e=>({key:e.key,completed:e.completed,steps:l.kQ[e.key].steps,title:l.kQ[e.key].title,tutorialLink:l.kQ[e.key].tutorialLink,countTowardCompletion:!0})));(0,r.Gp)(n.length===i.length,"Unexpected task keys")
n.unshift(makeDummyListItem("Open a sequence",'Navigate to "Example Project" and open "pBR322_EGFR".'))
s?n.push(makeCompletionListItem(t,`Earn ${c} of extra space!`)):n.push(makeCompletionListItem(t,"Celebrate!"))
return n}function makeGettingStartedItems(e,t,s){const n=i.indexBy(e,"key"),o=Array.from(l.t_).filter((([e,t])=>n[e])).map((([e,t])=>({key:e,completed:n[e].completed,title:t.title,onClick:t.onClick,resultForTracking:t.resultForTracking,countTowardCompletion:!0})));(0,r.Gp)(o.length===e.length,"Unexpected task keys")
s?o.push(makeCompletionListItem(t,`Earn ${u} of extra space!`)):o.push(makeCompletionListItem(t,"Celebrate!"))
return o}function trackChecklistOpened(e,t){n.j("onboarding_checklist","opened",{checklist:e,source:t})}function trackChecklistCollapsed(e,t,s){const i=e?"minimized":"expanded"
n.j("onboarding_checklist",i,{checklist:t,checklistTitle:s,checklistReward:"1GB_earned",numberOfTasks:5,eventLastModified:"FY21_Q1a2"})}function trackClickTask(e,t,s,i,r,o){n.j("onboarding_task","clicked",{checklist:i,checklistTitle:r,checklistReward:"1GB_earned",numberOfTasks:5,taskNumber:e,taskInstructions:t,result:(null!=o?o:s)?"detailed_instructions_expanded":"detailed_instructions_hidden",eventLastModified:"FY21_Q1a2"})}function shouldShowOnboardingChecklistsIcon(){const e=a.Z.getNUEModuleState(o.ZP.MODULES.GETTING_STARTED),t=a.Z.getNUEModuleState(o.ZP.MODULES.ENTRY),s=a.Z.getNUEModuleState(o.ZP.MODULES.SEQUENCE)
return Boolean(e&&t&&s&&!(e.completed&&t.completed&&s.completed))}},298991:(e,t,s)=>{s.d(t,{V:()=>getParentLinkMixtureTag,v:()=>getParentLinkMixtureField})
var i=s(232606),n=s(459830),r=s(227887),o=s(497790),a=s(251808)
function _isParentLinkMixtureField(e){if(e.isParentLink){const t=(0,o.getRequiredLinkTagSchema)(e);(0,i.Gp)(Boolean(t),"Expected parent link schema field to have required link tag schema")
return Boolean(t)&&t.folderItemType===n.MIXTURE}return!1}function getParentLinkMixtureTag(e){return(0,a.EF)(e).find((e=>(0,r.Yx)(e)&&_isParentLinkMixtureField(e.tagSchemaField)))}function getParentLinkMixtureField(e){return e.find((e=>_isParentLinkMixtureField(e)))}},41529:(e,t,s)=>{s.d(t,{Z:()=>q})
var i=s(64558),n=s(602652),r=s.n(n),o=s(989526),a=s(531041),l=s(438089),d=s(306325),p=s(780188),c=s(328907),u=s(109296),m=s(946795),h=s(682208),f=s(911593),g=s(232606),S=s(764403),E=s.n(S),y=s(305466),b=s(868710),I=s(334148),T=s(356873)
class LegacyColumnFilterDropdown extends o.Component{constructor(){super(...arguments)
this.state={isOpen:!1}
this.closeIfOpen=()=>{this.setState({isOpen:!1})}
this.toggleOpen=e=>{this.setState({isOpen:!this.state.isOpen})
this.handleStopPropagation(e)}
this.handleStopPropagation=e=>{e.stopPropagation()}}renderMenu(){return o.createElement("div",{className:"dropdown-menu columnFilterDropdown-menu",onClick:this.handleStopPropagation},o.createElement("label",{className:"columnFilterDropdown-item"},o.createElement("div",{className:"columnFilterDropdown-checkbox"},o.createElement(T.Z,{items:this.props.columns,selectedMap:e=>!e.hidden,onChange:this.props.onToggleAllFilters})),o.createElement("div",null,"Show All Columns")),o.createElement("div",{className:"columnFilterDropdown-border"}),(()=>this.props.columns.map(((e,t)=>o.createElement("label",{className:"columnFilterDropdown-item",key:`filter-${e.header}`},o.createElement("div",{className:"columnFilterDropdown-checkbox"},o.createElement("input",{type:"checkbox",checked:!e.hidden,onChange:()=>{this.props.onToggleFilter(t)}})),o.createElement("div",null,e.header)))))())}render(){return o.createElement(b.ZP,{container:"body",placement:b.TQ.TOP,title:"Filter Fields..."},o.createElement("div",{className:"columnFilterDropdown"},o.createElement(y.ZP,{menu:this.renderMenu(),onRequestClose:this.closeIfOpen,open:this.state.isOpen},o.createElement(I.Co,{buttonStyle:I.ZJ.CIRCLE_ICON,className:E()({"is-active":this.state.isOpen}),icon:"filter",onClick:this.toggleOpen,size:this.props.buttonSize}))))}}const C=a.default.object((0,f.ch)().map((({isHiddenKey:e})=>[e,!1]))),R=a.default.object((0,f.ch)().map((({isHiddenKey:e})=>[e,!0])))
class DisplayConfigDropdown extends o.Component{constructor(){super(...arguments)
this._handleToggleAllFilters=()=>{0===this.props.displayConfig.hiddenFields.length&&a.default.isMatch(this.props.displayConfig,C)?this.props.updateDisplayConfigHandler(this.props.schema.id,{...this.props.displayConfig,...R,hiddenFields:this._getConfigurableFields().map((e=>e.name))}):this.props.updateDisplayConfigHandler(this.props.schema.id,{...this.props.displayConfig,...C,hiddenFields:[]})}
this._handleToggleFilter=e=>{const{field:t,specialColumn:s}=this._getColumnFilters()[e]
if(s)this._toggleSpecialColumnDisplayConfig(s)
else{(0,g.hu)(null!=t,"Column filter must be for a special column or a schema field")
this._toggleSchemaFieldVisibility(t)}}}_getConfigurableFields(){const e=(0,m.HA)(this.props.schema)
return this.props.schema.fields.filter((t=>t!==e))}_toggleSpecialColumnDisplayConfig(e){const{isHiddenKey:t}=e
this.props.updateDisplayConfigHandler(this.props.schema.id,{...this.props.displayConfig,[t]:!this.props.displayConfig[t]})}_toggleSchemaFieldVisibility(e){this.props.displayConfig.hiddenFields.includes(e.name)?this.props.updateDisplayConfigHandler(this.props.schema.id,{...this.props.displayConfig,hiddenFields:a.default.without(this.props.displayConfig.hiddenFields,e.name)}):this.props.updateDisplayConfigHandler(this.props.schema.id,{...this.props.displayConfig,hiddenFields:this.props.displayConfig.hiddenFields.concat(e.name)})}_getColumnFilters(){const e=[]
for(const t of(0,f.ch)())e.push({specialColumn:t,header:t.name,hidden:this.props.displayConfig[t.isHiddenKey]})
for(const t of this._getConfigurableFields())e.push({field:t,header:t.displayName,hidden:this.props.displayConfig.hiddenFields.includes(t.name)})
return e}render(){return o.createElement(LegacyColumnFilterDropdown,{buttonSize:I.qE.MINI,onToggleAllFilters:this._handleToggleAllFilters,onToggleFilter:this._handleToggleFilter,columns:this._getColumnFilters().map((({header:e,hidden:t})=>({header:e,hidden:t})))})}}const x=DisplayConfigDropdown
var v=s(634489),k=s(497790),w=s(605604),_=s(337917),P=s(851422),M=s(737961),A=s(80507),N=s(956289),O=s(592083)
class FixedColumnAssayResultTable extends o.Component{_getTableRows(){return 0===this.props.results.length?[new Array(this.props.columns.length).fill(P.PLACEHOLDER_CELL)]:this.props.results.map((e=>this.props.columns.map((t=>t.render(e)))))}_getAffixedColumnCount(){let e=0
for(const t of this.props.columns){if(!t.shouldAffix)break
e++}(0,g.Gp)(this.props.columns.slice(e).every((e=>!e.shouldAffix)),"Unable to affix column after a non-affixed column")
return e}_getColumnConstraints(){return this.props.columns.map((e=>{const t={renderedLabel:e.label}
e.schemaField&&(t.columnDefinition={...(0,_.qX)(e.schemaField),skipSchemaValidation:!0})
return t}))}render(){return o.createElement(w.ZP,{...w.W9,...a.default.pick(this.props,Object.keys(O.eE)),autoCollapseLimit:this.props.autoCollapseLimit,locked:!0,table:(0,A.Z)({widths:a.default.pluck(this.props.columns,"width"),table:this._getTableRows(),allowColumnEdits:!1,headerCol:!1,headerRow:!1,lockedDims:!0,name:"",columnLabels:[],nameTooltip:this.props.isOversized?c.VY:null,columnConstraints:this._getColumnConstraints(),rowData:this.props.results.map((e=>{var t
return{euid:e.id,uiData:{archivePurpose:null===(t=e.archiveRecord)||void 0===t?void 0:t.purpose}}})),affixedColumnCount:this._getAffixedColumnCount(),_hideRename:!this.props.canRename},{assayValidationByResultId:this.props.assayValidationByResultId,fieldHasValueDictByResultId:this.props.fieldHasValueDictByResultId,assayResultIdsByRow:this.props.results.map((e=>e.id)),assaySchema:this.props.schema,dataTableErrorsByRecordId:{}}),collapsedHeaderControls:this.props.collapsedHeaderControls,forceCollapsed:this.props.isOversized,forceRowCount:this.props.forceRowCount,headerControls:this.props.headerControls,isCollapsible:!0,leftHeaderControls:this.props.leftHeaderControls,hideFormulaBox:!0,editWhileTableLockedWarning:null,getEditWhileCellLockedWarning:null,tableLabel:this.props.tableName,dataTestAttrs:this.props.dataTestAttrs})}}FixedColumnAssayResultTable.propTypes={autoCollapseLimit:r().number,columns:r().arrayOf(r().shape({label:r().node.isRequired,width:r().number.isRequired,render:r().func.isRequired,shouldAffix:r().bool,schemaField:k.SCHEMA_FIELD_SHAPE}).isRequired).isRequired,results:r().arrayOf(c.Ij.isRequired).isRequired,schema:p.Gd,tableName:r().string.isRequired,collapsedHeaderControls:r().node,isOversized:r().bool,forceRowCount:r().number,headerControls:r().node,leftHeaderControls:r().node,...a.default.omit(O.eE,"locked"),assayValidationByResultId:r().objectOf(N.Lt),fieldHasValueDictByResultId:r().objectOf(r().objectOf(r().bool))}
class FixedColumnAssayResultTableConnector extends v.C{enhanceProps(){return(0,M.Z)(this,this.props.results.map((e=>e.id)))}}const L=FixedColumnAssayResultTableConnector.connect(FixedColumnAssayResultTable)
var H=s(272453),F=s(251808),D=s(544192)
function getHiddenColumnsFromSchema(e){const t=e.publishedDataTableColumns
return!(0,H.$)()&&t?e.fields.filter((e=>!t.some((t=>t.tagSchemaFieldId===e.id)))).map((e=>e.name)):[]}class AssayResultsTable extends o.Component{_getDisplayConfig(){return this.props.displayConfig?function adaptDisplayConfigToExcludeReviewed(e){const t={...e}
delete t.hideReviewed
return t}(this.props.displayConfig):{hideId:!0,hideCreator:!1,hideCreatedAt:!1,hiddenFields:getHiddenColumnsFromSchema(this.props.schema)}}_getSpecialColumns(e){return(0,f.ch)().filter((({metadataType:t})=>t===e)).map((t=>({hidden:this._getDisplayConfig()[t.isHiddenKey],label:t.name,width:t.width,render:e=>({formattedValue:o.createElement(u.pc,null,t.renderResult(e)),text:t.resultToText(e),align:"left"}),shouldAffix:e===f.Px})))}_getColumnFromField(e,t){return{hidden:!t&&this._getDisplayConfig().hiddenFields.includes(e.name),shouldAffix:t,label:t?D.nK:(0,f.dK)(e),width:t?150:this._getNonPrimaryColumnWidth(e),render:t=>(0,u.QC)(t,e),schemaField:e.apiId?a.default.indexBy(this.props.schema.fields,"apiId")[e.apiId]:null}}_getNonPrimaryColumnWidth(e){const t=this.props.schema.publishedDataTableColumns,s=t?t.find((t=>t.tagSchemaFieldId===e.id)):null
return s?s.width:(0,f.B7)(e)}_getPrimaryColumns(){if((0,H.$)())return[]
const e=(0,m.HA)(this.props.schema)
return e?[this._getColumnFromField(e,!0)]:[]}_getFieldColumns(){let e=this.props.schema.fields
if(!(0,H.$)()){const t=(0,m.HA)(this.props.schema)
e=e.filter((e=>e!==t))}return e.map((e=>this._getColumnFromField(e,!1)))}_getPlaceholderColumn(){return{label:"No columns selected",width:200,render:()=>({text:"",align:"center"})}}_getSortedResults(){if((0,H.$)())return this.props.results
const e=(0,m.HA)(this.props.schema)
return e?(0,i.MZ)(this.props.results,(t=>{var s
const i=(0,F.EF)(t.tags).find((t=>t.tagSchemaField.id===e.id))
return null!==(s=null==i?void 0:i.value)&&void 0!==s?s:""})):this.props.results}_getMetadataColumns(e){return[...this._getSpecialColumns(e),...this.props.additionalColumns.filter((({metadataType:t})=>t===e)).map((e=>({hidden:!1,...e})))]}render(){const e=[...this._getPrimaryColumns(),...this._getMetadataColumns(f.Px),...this._getFieldColumns(),...this._getMetadataColumns(f.dD)].filter((e=>!e.hidden))
0===e.length&&e.push(this._getPlaceholderColumn())
const t=this.props.onDownloadAsCSV&&!this.props.viewer&&o.createElement(d.e,{onDownloadAsCSV:this.props.onDownloadAsCSV,key:"download-as-csv-button"}),s=null!=this.props.headerControls?[t,this.props.headerControls]:t
return o.createElement("div",null,o.createElement(L,{autoCollapseLimit:this.props.autoCollapseLimit,columns:e,results:this._getSortedResults(),schema:this.props.schema,tableName:this.props.schema.name,collapsedHeaderControls:s,isOversized:this.props.isOversized,forceRowCount:this.props.forceRowCount,headerControls:s,canRename:this.props.canRename,leftHeaderControls:!this.props.locked&&!this.props.viewer&&o.createElement(x,{displayConfig:this._getDisplayConfig(),schema:this.props.schema,updateDisplayConfigHandler:this.props.updateDisplayConfigHandler}),dataTestAttrs:{component:"AssayResultsTable",element:"root"},...a.default.pick(this.props,Object.keys(O.eE))}))}}AssayResultsTable.propTypes={additionalColumns:r().arrayOf(r().shape({metadataType:r().oneOf([f.Px,f.dD]).isRequired,label:r().node.isRequired,width:r().number.isRequired,hidden:r().bool,render:r().func.isRequired}).isRequired).isRequired,attachedForReview:r().bool.isRequired,autoCollapseLimit:r().number,results:r().arrayOf(c.Ij.isRequired).isRequired,schema:p.Gd.isRequired,headerControls:r().arrayOf(r().node),canRename:r().bool,displayConfig:h.ae,forceRowCount:r().number,isOversized:r().bool,onDownloadAsCSV:r().func,review:l.r8,updateDisplayConfigHandler:r().func,...O.eE}
AssayResultsTable.defaultProps={attachedForReview:!1,selectTable:()=>{},additionalColumns:[]}
const q=AssayResultsTable},682208:(e,t,s)=>{s.d(t,{ae:()=>r})
var i=s(602652)
const n=i.arrayOf(i.string.isRequired),r=i.shape({hideId:i.bool.isRequired,hideCreator:i.bool.isRequired,hideCreatedAt:i.bool.isRequired,hideReviewed:i.bool.isRequired,hiddenFields:n.isRequired})
i.shape({hideId:i.bool.isRequired,hideCreator:i.bool.isRequired,hideCreatedAt:i.bool.isRequired,hiddenFields:n.isRequired})},445881:(e,t,s)=>{s.d(t,{Z:()=>S})
var i=s(692013),n=s(250965),r=s.n(n),o=s(989526),a=s(573961),l=s(736957),d=s(263137),p=s(334148),c=s(691012),u=s(271359),m=s(36424),h=s(575891),f=s(927517)
function handleButtonClickPreventDefault(e){e.preventDefault()}class CtrlFView extends o.Component{constructor(){super(...arguments)
this.searchInputRef=o.createRef()
this._handleQueryChange=e=>{this.props.onQueryChange(e.target.value)}
this._handleKeyDown=e=>{f.isEscapeKey(e)&&this.props.onClose()
f.isEnterKey(e)&&(e.shiftKey?this.props.onViewPreviousResult():this.props.onViewNextResult())}
this.focusAndSelect=()=>{r()(a.findDOMNode(this.searchInputRef.current)).focus().select()}}componentDidMount(){this.focusAndSelect()}renderSearchResult(){return this.props.isLoading?o.createElement(h.Z,null):this.props.query?o.createElement("span",null,`${this.props.selectedIndex+1} of ${this.props.isTruncated?"many":this.props.numSearchResults}`):null}render(){return o.createElement("div",{className:(0,i.iv)(g.container),...(0,d.Z)({component:"CtrlFView",element:"root"})},o.createElement(c.Z,{isFullWidth:!0},o.createElement(c.n,null,o.createElement("input",{ref:this.searchInputRef,className:(0,i.iv)(g.input),autoComplete:"off",type:"search",tabIndex:-1,value:this.props.query,onChange:this._handleQueryChange,onKeyDown:this._handleKeyDown,placeholder:this.props.placeholder,...(0,d.Z)({component:"CtrlFView",element:"searchInput"})}),o.createElement("div",{...(0,d.Z)({component:"CtrlFView",element:"searchCount"}),className:(0,i.iv)(g.inputOverlay)},this.renderSearchResult())),o.createElement(p.Co,{className:(0,i.iv)(g.button),buttonStyle:p.ZJ.TERTIARY_WHITE,size:p.qE.SMALL,onClick:this.props.onViewPreviousResult,onMouseDown:handleButtonClickPreventDefault,icon:"chevron-up",flexWidth:!1}),o.createElement(p.Co,{className:(0,i.iv)(g.button),buttonStyle:p.ZJ.TERTIARY_WHITE,size:p.qE.SMALL,onClick:this.props.onViewNextResult,onMouseDown:handleButtonClickPreventDefault,icon:"chevron-down",flexWidth:!1})),o.createElement("button",{...(0,d.Z)({component:"CtrlFView",element:"closeButton"}),className:(0,i.iv)(g.closeButton),onClick:this.props.onClose,type:"button"},o.createElement("span",{className:(0,i.iv)(g.closeButtonIcon)},o.createElement(m.Z,{icon:"xmark-large"}))))}}const g=i.mM.create({container:{background:u.tN,border:`1px solid ${u.TG}`,borderRadius:"0px 0px 4px 4px",borderTop:"none",display:"flex",padding:"3px 5px",paddingBottom:5,position:"fixed",right:50,top:0,width:400,zIndex:l._u},inputOverlay:{alignItems:"center",color:u.TG,display:"flex",height:"100%",justifyContent:"center",paddingRight:10,position:"absolute",right:0,top:0,zIndex:2},input:{zIndex:1},button:{flex:"none"},closeButton:{background:"none",border:"none",outline:"none",":hover":{color:u.pp}},closeButtonIcon:{fontSize:14,lineHeight:"24px",verticalAlign:"middle"}}),S=CtrlFView},285355:(e,t,s)=>{s.d(t,{Z:()=>o})
var i=s(764403),n=s.n(i),r=s(989526)
class PositionedPopover extends r.Component{constructor(){super(...arguments)
this.handleMouseDown=e=>{e.preventDefault()}}static mouseDownInPopover(e){return e.isDefaultPrevented()}render(){return r.createElement("div",{className:n()("positionedPopover",this.props.className,{"positionedPopover--noArrow":!this.props.showArrow}),style:{top:this.props.top,left:this.props.left,width:this.props.width},onMouseDown:this.handleMouseDown},this.props.showArrow&&r.createElement("div",{className:"positionedPopover-arrow"}),this.props.children)}}PositionedPopover.defaultProps={width:250,showArrow:!0}
const o=PositionedPopover},142893:(e,t,s)=>{s.d(t,{Z:()=>ft})
var i=s(602652),n=s.n(i),r=s(989526),o=s(232606),a=s(56063),l=s(909410),d=s(344984),p=s(680259),c=s(990658),u=s(102385),m=s(901113),h=s(128676),f=s(615439),g=s.n(f),S=s(212300),E=s(531041),y=s(468943),b=s(348920),I=s(675649),T=s(171471),C=s(237584),R=s(851436),x=s(167018),v=s(306325),k=s(327372),w=s(619075),_=s(868710),P=s(334148),M=s(198964),A=s(476604),N=s(865486),O=s(924982),L=s(195300),H=s(862059),F=s(63573),D=s(894278),q=s(978047),Z=s(717235),B=s(191122),U=s(251658),j=s(336489),$=s(378045),V=s(113505),W=s(661978),K=s(372721),G=s(749278),z=s(939092),Y=s(629656),Q=s(87209),X=s(593113),J=s(38209),ee=s(8747)
function InputTableImportActions_validateNewSamplesForInputTableImport(e){(0,W.qe)((t=>function validateNewSamplesForInputTableImport(e,t){return ee.ty({url:"/1/api/workflows/input-tables:validate-new-samples-for-import",data:{...e,stageEntryId:t}})}(t,e)))}function InputTableImportActions_addNewSamplesForInputTableImport(e){Q.$Z("Importing...");(0,W.Jp)((t=>function addNewSamplesForInputTableImport(e,t){return ee.ty({url:"/1/api/workflows/input-tables:add-new-samples-for-import",data:{...e,stageEntryId:t}})}(t,e).done((({stageEntryDetails:e,entryVersion:t,stageRunSamples:s})=>{(0,J.RC)({stageRunSamples:s})
X.dispatchStageEntryDetailsChange(e)
X.dispatchStageEntryVersionChange(t,e.stageEntry)})).always((()=>{Q.Cp()}))))}class BulkAddSamplesToInputTableFlow extends r.Component{constructor(){super(...arguments)
this._handleImportFromSpreadsheet=()=>{InputTableImportActions_addNewSamplesForInputTableImport(this.props.stageEntryId)}}static open(e){Y.bA(K.qF,r.createElement(BulkAddSamplesToInputTableFlow,{...e,onRequestClose:W.Mr}))}_getPanes(){return[{paneKey:K.y$.UPLOAD_SPREADSHEET,configuration:V.Z.configure({})},{paneKey:K.y$.MAP_COLUMN_NAMES,configuration:j.Z.configure({getValidColumnTypes:()=>[K.BA.STAGE_RUN_NAME,K.BA.BATCH_NAME,K.BA.FILENAME,K.BA.IGNORE],getRequiredColumnsError:(e,{selectedSchemaIds:t})=>function getInputTableFlowRequiredColumnsError(e,{selectedSchemaIds:t}){const s=z.lx([K.BA.STAGE_RUN_NAME],e,t,!1)
if(s)return s
const i=e.filter((({type:e})=>e===K.BA.BATCH_NAME)).length,n=e.filter((({type:e})=>e===K.BA.FILENAME)).length,r=K.zw[K.BA.BATCH_NAME],o=K.zw[K.BA.FILENAME]
return 0===i&&0===n?`Either a "${r}" or a "${o}" field is required.`:i>0&&n>0?`A "${r}" and a "${o}" field cannot both be provided.`:i>1?`There must be exactly one "${r}" field.`:n>1?`There must be exactly one "${o}" field.`:null}(e,{selectedSchemaIds:t}),onValidateSpreadsheet:()=>{InputTableImportActions_validateNewSamplesForInputTableImport(this.props.stageEntryId)}})},{paneKey:K.y$.SHOW_ERRORS,configuration:$.Z.configure({enableReplaceLinkWithText:!0,enableSkipErrors:!1})}]}render(){return r.createElement(G.Z,{importItemWord:"input sample",importType:K.pt.INPUT_TABLE,onImportFromSpreadsheet:this._handleImportFromSpreadsheet,onRequestClose:this.props.onRequestClose,panes:this._getPanes(),title:"Import into input table"})}}BulkAddSamplesToInputTableFlow.propTypes={onRequestClose:n().func.isRequired,stageEntryId:n().string.isRequired}
const te=BulkAddSamplesToInputTableFlow
var se=s(584651),ie=s(820292),ne=s(620080),re=s(764677),oe=s(282974),ae=s(382857),le=s(133832),de=s(726139),pe=s(377249),ce=s(593732),ue=s(795110)
class TableContainerActionButtons extends r.Component{componentDidMount(){this.props.containerIds.forEach((e=>{(0,ce.z)(pe.V.CONTAINER,e)}))}componentDidUpdate(){this.props.containerIds.forEach((e=>{(0,ce.z)(pe.V.CONTAINER,e)}))}render(){const{containers:e,shouldShowArchiveButton:t}=this.props,s=!e.length,i=!e.length||e.some((e=>(0,ae.ZP)(e)||!e.permissions.archivable)),n=e.length?"Select unarchived containers to archive":"No containers selected to archive"
return r.createElement("div",null,r.createElement(_.ZP,{title:"No containers selected for printing labels",disabled:!s},r.createElement("span",null,r.createElement(de.Z,{buttonStyle:P.ZJ.TERTIARY_BLUE,className:"u-mini-spacing-right",disabled:s,itemIds:e.map((e=>e.id))}))),t&&r.createElement(_.ZP,{title:n,disabled:!i},r.createElement("span",null,r.createElement(oe.Z,{disabled:i,initialPurpose:re.Ue,items:e,onArchive:ne.At,tooltipTitle:"Archive containers"}))))}}TableContainerActionButtons.propTypes={containerIds:n().arrayOf(n().string).isRequired,containers:n().arrayOf(le._L),shouldShowArchiveButton:n().bool}
const me=ue.Z.connect((function mapStorableStoreToProps(e,{containerIds:t}){return{containers:t.map((t=>e.getContainer(t))).filter((e=>Boolean(e)))}}))(TableContainerActionButtons)
var he=s(390189),fe=s(866648),ge=s(886150),Se=s(544192),Ee=s(866219),ye=s(801455),be=s(50585),Ie=s(205986),Te=s(883026),Ce=s(997461),Re=s(837677)
class AddInputSampleModal extends r.Component{constructor(e){super(e)
this._handleSubmit=async()=>{if(this._isInputValid()&&this.state.stageRun){if(this.state.sample)J.cI(this.state.stageRun.id,{sampleIdToAdd:this.state.sample.id})
else if(this.state.externalInputSpecifier){const e=(0,Re.fF)(this.state.externalInputSpecifier)
await(0,Te.jI)(J.Lv(this.state.stageRun.id,{samplesToAdd:e}))}else(0,o.Gp)(!1,"Expected either sample or externalInputSpecifier to be set when submitting.")
this.props.onRequestClose()}}
this._handleSelectStageRun=e=>{const t=e.val,s=this.props.stageRuns.find((e=>e.id===t))||null
this.setState(this._resolveDefaults({...this.state,stageRun:s,parentStageRun:null,isExternalSelected:!1,externalInputSpecifier:null,sample:null}))}
this._handleSetExternalSelected=()=>{this.setState(this._resolveDefaults({...this.state,parentStageRun:null,isExternalSelected:!0,externalInputSpecifier:null,sample:null}))};(0,o.hu)(this.props.stageRuns.length>0,"The stageRuns prop must be non-empty.")
let t
t=this.props.initialExternalState?{stageRun:E.default.findWhere(this.props.stageRuns,{id:this.props.initialExternalState.stageRunId})||null,parentStageRun:null,isExternalSelected:!0,externalInputSpecifier:null,sample:null}:{stageRun:null,parentStageRun:null,isExternalSelected:!1,externalInputSpecifier:null,sample:null}
this.state=this._resolveDefaults(t)}_resolveDefaults(e){e.stageRun||(e={...e,stageRun:this.props.stageRuns[0]})
if(!e.parentStageRun&&!e.isExternalSelected){const t=this._getParentStageRuns(e.stageRun)
e=t.length>0?{...e,parentStageRun:t[0]}:{...e,isExternalSelected:!0}}if(e.parentStageRun&&!e.sample){const t=(0,Ce.up)(e.stageRun,{parentStageRun:e.parentStageRun,stageRunSampleById:this.props.stageRunSampleById})
t.length>0&&(e={...e,sample:t[0]})}return e}_getParentStageRuns(e){if(!this.props.parentIdsByStageRunId||!this.props.stageRunsById)return[]
return this.props.parentIdsByStageRunId[e.id].map((e=>this.props.stageRunsById[e]))}_isInputValid(){return!!this.state.sample||!!this.state.externalInputSpecifier&&(0,Re.fF)(this.state.externalInputSpecifier).length>0}_getButtons(){return[{text:"Add",submit:!0,style:P.ZJ.PRIMARY,disabled:!this._isInputValid(),key:"add"}]}_handleSelectParentStageRun(e){this.setState(this._resolveDefaults({...this.state,parentStageRun:e,isExternalSelected:!1,externalInputSpecifier:null,sample:null}))}_renderStageRunSelector(){return r.createElement(be.Z,{placeholder:"Select stage run",options:this.props.stageRuns.map((e=>({id:e.id,text:e.name}))),value:this.state.stageRun?this.state.stageRun.id:null,onChange:this._handleSelectStageRun})}_renderInputSourceSelector(){const{stageRun:e,parentStageRun:t}=this.state,s=e?this._getParentStageRuns(e):[]
return r.createElement(Ee.Z,{displayName:t?t.name:"External",items:[[...s.map((e=>({name:e.name,handleOnClick:()=>{this._handleSelectParentStageRun(e)}}))),{name:"External",handleOnClick:this._handleSetExternalSelected}]]})}_renderInputSelector(){if(this.state.parentStageRun&&this.state.stageRun){(0,o.Gp)(!this.state.isExternalSelected,"Exactly one of parentStageRun or isExternalSelected should be specified.")
const e=(0,Ce.up)(this.state.stageRun,{parentStageRun:this.state.parentStageRun,stageRunSampleById:this.props.stageRunSampleById}).map((e=>({name:e.name,handleOnClick:()=>{this.setState({sample:e})}})))
if(0===e.length)return r.createElement(Ee.Z,{displayName:"No available samples",items:[[]],disabled:!0});(0,o.Gp)(Boolean(this.state.sample),"Sample should be auto-filled from _resolveDefaults.")
return r.createElement(Ee.Z,{displayName:this.state.sample?this.state.sample.name:"",items:[e]})}(0,o.Gp)(this.state.isExternalSelected,"Exactly one of parentStageRun or isExternalSelected should be specified.")
return r.createElement(Re.ZP,{externalInputSpecifier:this.state.externalInputSpecifier,onSetExternalInputSpecifier:e=>{this.setState({externalInputSpecifier:e})},allowContainers:!0,initialInputType:null==this.props.initialExternalState?null:this.props.initialExternalState.inputType})}render(){return r.createElement(Ie.ZP,{title:"Add input sample",onRequestClose:this.props.onRequestClose,onRequestSubmit:this._handleSubmit,buttons:this._getButtons()},r.createElement("div",{className:"u-spacing-bottom"},r.createElement(ye.Z,{label:"Stage run"}),this._renderStageRunSelector()),r.createElement("div",{className:"u-spacing-bottom"},r.createElement(ye.Z,{label:"Source"}),this._renderInputSourceSelector()),r.createElement("div",null,r.createElement(ye.Z,{label:"Input"}),this._renderInputSelector()))}}AddInputSampleModal.propTypes={stageRuns:n().arrayOf(Se.Sd.isRequired).isRequired,stageRunSampleById:n().objectOf(Se.Lv).isRequired,onRequestClose:n().func.isRequired,initialExternalState:n().shape({stageRunId:n().string.isRequired,inputType:n().oneOf([Re.n$.BATCH,Re.n$.FILE,Re.n$.CONTAINER])}),stageRunsById:n().objectOf(Se.Sd.isRequired),parentIdsByStageRunId:n().objectOf(n().arrayOf(n().string.isRequired).isRequired)}
const xe=(0,S.$j)((function mapStateToProps(e,t){const{stageRuns:s}=t,i=new se.xT(e.models.workflows),n=i.getParentIdsByStageRunId(s.map((e=>e.id)))
if(!n)return{parentIdsByStageRunId:null,stageRunsById:null}
const r=[...Object.keys(n),...E.default.flatten(Object.values(n))]
return{parentIdsByStageRunId:n,stageRunsById:i.getStageRunsById(r)}}))(AddInputSampleModal)
var ve=s(36424)
const ActionCell=({children:e,icon:t,onClick:s,isIconVisible:i})=>r.createElement("div",{className:"u-vertical-center-items"},r.createElement("div",{className:"u-flex-grow u-word-break-word"},e),r.createElement("div",{className:"u-flex-none"},i&&r.createElement(ve.Z,{className:"stageEntry-actionCellIcon",onClick:s,icon:t})))
ActionCell.propTypes={children:n().oneOfType([n().node,n().arrayOf(n().node)]),icon:n().string.isRequired,onClick:n().func.isRequired,isIconVisible:n().bool.isRequired}
ActionCell.defaultProps={isIconVisible:!0}
const ke=ActionCell
function SharedInputTableRow(e){let t,s
t="sampleCellContents"in e?r.createElement(H.bL,{primary:!0},e.sampleCellContents):e.sampleCellFullElement
s="containerCellContents"in e?r.createElement(H.bL,{primary:!0},e.containerCellContents):e.containerCellFullElement
return r.createElement(H.X2,null,r.createElement(H.bL,{primary:!0},e.checkboxCell),t,s,r.createElement(H.bL,null,e.stageRun.name),e.experimentalConditionValueNames.map((t=>{const s=e.stageRun.stageFlowNode.experimentalConditionValues.filter((e=>e.name===t))
return r.createElement(H.bL,{key:t},s.length>0?(0,ge.yZ)(s):r.createElement("span",{className:"u-faded"},"None"))})))}SharedInputTableRow.propTypes={experimentalConditionValueNames:n().arrayOf(n().string.isRequired).isRequired,sampleCellContents:n().node,sampleCellFullElement:n().node,containerCellContents:n().node,containerCellFullElement:n().node,checkboxCell:n().node.isRequired,stageRun:Se.Sd.isRequired}
class EmptyInputTableRow extends r.Component{_renderSampleCell(){const{stageRun:e,locked:t}=this.props
return t?r.createElement("div",{className:"workflowDetailsTable-missingCellValue"},"None"):r.createElement(ke,{icon:"search",onClick:()=>{this.props.onOpenAddInputSampleModal(e.id,null)}},r.createElement("div",{className:"workflowDetailsTable-missingCellValue"},"None"))}_renderContainerCell(){const{stageRun:e,locked:t}=this.props
return t?r.createElement("span",{className:"workflowDetailsTable-missingCellValue"},"None"):r.createElement(ke,{icon:"search",onClick:()=>{this.props.onOpenAddInputSampleModal(e.id,Re.n$.CONTAINER)}},r.createElement("span",{className:"workflowDetailsTable-missingCellValue"},"None"))}render(){return r.createElement(SharedInputTableRow,{checkboxCell:this.props.checkboxCell,experimentalConditionValueNames:this.props.experimentalConditionValueNames,sampleCellContents:this._renderSampleCell(),containerCellContents:this._renderContainerCell(),stageRun:this.props.stageRun})}}EmptyInputTableRow.propTypes={checkboxCell:n().node.isRequired,experimentalConditionValueNames:n().arrayOf(n().string.isRequired).isRequired,stageRun:Se.Sd.isRequired,locked:n().bool.isRequired,onOpenAddInputSampleModal:n().func.isRequired}
const we=EmptyInputTableRow
var _e=s(793326),Pe=s(227887),Me=s(865636),Ae=s(259234),Ne=s(459830),Oe=s(617436),Le=s(938454),He=s(532275),Fe=s(525999),De=s(62315),qe=s(459947),Ze=s(974913),Be=s(305466),Ue=s(839027),je=s(927517)
class SearchCell extends r.Component{constructor(){super(...arguments)
this.searchInputRef=r.createRef()
this.dropdownRef=r.createRef()
this._handleClickOut=()=>{this.props.onCancel()}
this._handleSearch=(e,t)=>{this.props.onCreateSearchPromise(e).then((s=>{t({query:e,results:s,errorMessage:null})})).catch((s=>{const i=Ze.ZP.getFriendlyError(s)||"An error occurred."
t({query:e,results:[],errorMessage:i})}))}
this._handleSelect=(e,t,s,i)=>{this.props.onSelectItem(i)}
this._handleKeyDown=e=>{if(je.isEscapeKey(e)){this.props.onCancel()
e.preventDefault()
return!0}if(this.dropdownRef.current){return this.dropdownRef.current.queryKeydownHandler(e)}return!1}
this._renderSearchDropdown=()=>r.createElement(Ue.Z,{ref:this.dropdownRef,profilerTrackingParams:{url:this.props.searchEndpoint,searchType:De.xL.ENTITY_LINK},query:this.props.queryText,allowEmptyQuery:this.props.allowEmptyQuery,doSearch:this._handleSearch,selectAttachment:this._handleSelect,width:"100%"})}componentDidMount(){this.searchInputRef.current&&this.searchInputRef.current.focus()}componentDidUpdate(){this.searchInputRef.current&&this.searchInputRef.current.focus()}render(){return r.createElement(Be.ZP,{canDropUnder:!0,menu:this._renderSearchDropdown(),onRequestClose:this._handleClickOut,open:!0},r.createElement("input",{className:"stageEntry-searchCell",type:"text",onKeyDown:this._handleKeyDown,onChange:e=>{this.props.onSetQueryText(e.target.value)},value:this.props.queryText,ref:this.searchInputRef}))}}const $e=SearchCell
function OptionalContainerLink(e){return e.containerId?r.createElement(Oe.Z,{containerId:e.containerId}):r.createElement("span",{className:"u-italic"},"Not selected")}OptionalContainerLink.propTypes={containerId:n().string}
class SelectContainerFromContainableCell extends r.Component{constructor(){super(...arguments)
this.state={queryText:"",isSearching:!1}
this._createSearchPromise=async e=>{const t={key:De.Vm.TYPES,operator:De.EF.IS_ONE_OF,value:[Ne.CONTAINER]},{batch:s,fileId:i}=this.props.sample,n=s?s.id:i,r=null!=n?{key:De.Vm.CONTAINER_CONTENTS,operator:De.EF.EQ,value:n}:void 0,o=E.default.compact([t,r]),a=await(0,He.kp)({query:e,filters:o,offset:0,sorts:[{key:De.bo.SORT_RELEVANCE_KEY,reverse:!1}],limit:qe.T})
return a.storables.map((e=>({name:e.name,item_id:e.id,item:e,type:Ne.CONTAINER,extra:{ancestralStorables:a.storableSummaryExtras.ancestralStorablesById[e.id],gridCell:a.storableSummaryExtras.gridCellsByContainerId[e.id]}})))}}componentDidUpdate(e){this.props.sample.containerId&&e.sample.containerId!==this.props.sample.containerId&&!ue.Z.getContainer(this.props.sample.containerId)&&Le.fetchContainer(this.props.sample.containerId,!0)}render(){return this.props.isSaving?r.createElement(H.bL,{primary:!0},r.createElement(H.wK,null,this.props.sample.containerId?r.createElement(OptionalContainerLink,{containerId:this.props.sample.containerId}):r.createElement(OptionalContainerLink,null))):this.props.sample.containerId||this.state.isSearching?this.props.sample.containerId?r.createElement(H.bL,null,r.createElement(ke,{icon:"delete",onClick:()=>this.props.onSelectContainer(null)},r.createElement(Oe.Z,{containerId:this.props.sample.containerId}),r.createElement("br",null),r.createElement(Fe.ZP,{className:"richObjectTable-detailText",noLocationText:"No location",storableId:this.props.sample.containerId,showGridCell:!0,truncate:!0}))):r.createElement(H.bL,null,r.createElement($e,{allowEmptyQuery:!0,onCancel:()=>{this.setState({isSearching:!1,queryText:""})},onCreateSearchPromise:this._createSearchPromise,searchEndpoint:He.R9,onSelectItem:this.props.onSelectContainer,onSetQueryText:e=>{this.setState({queryText:e})},queryText:this.state.queryText})):r.createElement(H.bL,null,r.createElement("div",{className:"u-vertical-center-items"},r.createElement("div",{className:"u-flex-grow u-word-break-word",onClick:()=>{this.setState({isSearching:!0})}},r.createElement("span",{className:"u-faded"},"Search container..."))))}}const Ve=SelectContainerFromContainableCell
function propsToBioentityId({inputSampleId:e,stageRunSampleById:t}){const s=t[e]
return s&&s.fileId?s.fileId:null}class InputTableContainerCell extends r.Component{constructor(){super(...arguments)
this.state={isContainerSaving:!1,optimisticContainerId:null}
this._handleSelectContainer=async e=>{const{inputSampleId:t,stageRun:s,stageRunSampleById:i}=this.props,n=i[t],r=e?e.id:null
if(n.containerId!==r){this.setState({isContainerSaving:!0,optimisticContainerId:r})
try{await J.cI(s.id,{sampleIdToRemove:t,batchIdToAdd:n.batch?n.batch.id:null,bioentityIdToAdd:n.fileId,containerIdToAdd:r})}finally{this.setState({isContainerSaving:!1,optimisticContainerId:null})}}}}componentDidMount(){const e=propsToBioentityId(this.props)
e&&(0,ce.z)(pe.V.BIOENTITY_SUMMARY,e)}componentDidUpdate(){const e=propsToBioentityId(this.props)
e&&(0,ce.z)(pe.V.BIOENTITY_SUMMARY,e)}render(){const e=this.props.stageRunSampleById[this.props.inputSampleId]
return this.props.isLoading?r.createElement(H.bL,{primary:!0},r.createElement("span",{className:"u-faded u-italic"},"Loading")):!(0,Me.P)(e,this.props.bioentitySummary)||this.props.locked||this.props.viewer?r.createElement(H.bL,{primary:!0},r.createElement(Ae.Z,{containerId:e.containerId,truncateLocation:!this.props.viewer})):r.createElement(Ve,{sample:e,isSaving:this.state.isContainerSaving,optimisticContainerId:this.state.optimisticContainerId,onSelectContainer:this._handleSelectContainer})}}InputTableContainerCell.propTypes={stageRun:Se.Sd.isRequired,inputSampleId:n().string.isRequired,stageRunSampleById:n().objectOf(Se.Lv).isRequired,locked:n().bool.isRequired,viewer:n().bool,bioentitySummary:Pe.i2,isLoading:n().bool.isRequired}
const We=(0,S.$j)((function InputTableContainerCell_mapStateToProps(e,{inputSampleId:t,stageRunSampleById:s}){const i=s[t],n=propsToBioentityId({inputSampleId:t,stageRunSampleById:s}),r=n?e.models.fileSummariesById[n]:null
return{bioentitySummary:r,isLoading:Boolean(!i||n&&!r)}}))(InputTableContainerCell)
class ExternalSampleInputTableRow extends r.Component{_renderSampleCell(){const{inputSampleId:e,stageRunSampleById:t}=this.props
return r.createElement(_e.Z,{sample:t[e]})}_renderContainerCell(){return r.createElement(We,{stageRun:this.props.stageRun,inputSampleId:this.props.inputSampleId,stageRunSampleById:this.props.stageRunSampleById,locked:this.props.locked,viewer:this.props.viewer})}render(){return r.createElement(SharedInputTableRow,{checkboxCell:this.props.checkboxCell,experimentalConditionValueNames:this.props.experimentalConditionValueNames,sampleCellContents:this._renderSampleCell(),containerCellFullElement:this._renderContainerCell(),stageRun:this.props.stageRun})}}ExternalSampleInputTableRow.propTypes={checkboxCell:n().node.isRequired,experimentalConditionValueNames:n().arrayOf(n().string.isRequired).isRequired,inputSampleId:n().string.isRequired,stageRun:Se.Sd.isRequired,stageRunSampleById:n().objectOf(Se.Lv).isRequired,locked:n().bool.isRequired,viewer:n().bool}
const Ke=ExternalSampleInputTableRow
class ParentSampleInputTableRow extends r.Component{_renderSampleCell(){return r.createElement(_e.Z,{sample:this.props.stageRunSampleById[this.props.inputSampleId]})}_renderContainerCell(){return r.createElement(We,{stageRun:this.props.stageRun,inputSampleId:this.props.inputSampleId,stageRunSampleById:this.props.stageRunSampleById,locked:this.props.locked,viewer:this.props.viewer})}render(){return r.createElement(SharedInputTableRow,{checkboxCell:this.props.checkboxCell,experimentalConditionValueNames:this.props.experimentalConditionValueNames,sampleCellContents:this._renderSampleCell(),containerCellFullElement:this._renderContainerCell(),stageRun:this.props.stageRun})}}ParentSampleInputTableRow.propTypes={checkboxCell:n().node.isRequired,experimentalConditionValueNames:n().arrayOf(n().string.isRequired).isRequired,inputSampleId:n().string.isRequired,stageRun:Se.Sd.isRequired,stageRunSampleById:n().objectOf(Se.Lv).isRequired,locked:n().bool.isRequired,viewer:n().bool}
const Ge=ParentSampleInputTableRow
var ze=s(300707)
function SelectParentStageRunSampleCell(e){const{children:t,stageRun:s,parentStageRuns:i,stageRunSampleById:n,locked:o,isDropdownOpen:a,onOpenDropdown:l,onCloseDropdown:d}=e
if(o)return r.createElement(H.bL,{primary:!0},t)
const p=E.default.flatten(i.map((e=>(0,Ce.up)(s,{parentStageRun:e,stageRunSampleById:n}))))
return r.createElement(Be.ZP,{menu:r.createElement(ze.Z,{items:[p.map((e=>({name:e.name,handleOnClick:()=>{J.cI(s.id,{sampleIdToAdd:e.id})}})))]}),onRequestClose:d,open:a,shouldCloseOnInsideClick:!0},r.createElement(H.bL,{primary:!0},r.createElement(ke,{icon:"chevron-down",onClick:l,isIconVisible:p.length>0},t)))}SelectParentStageRunSampleCell.propTypes={eligibleParentStageRunIds:n().arrayOf(n().string.isRequired).isRequired,children:n().node.isRequired,stageRun:Se.Sd.isRequired,stageRunSampleById:n().objectOf(Se.Lv).isRequired,locked:n().bool.isRequired,isDropdownOpen:n().bool.isRequired,onOpenDropdown:n().func.isRequired,onCloseDropdown:n().func.isRequired,parentStageRuns:n().arrayOf(Se.Sd.isRequired).isRequired}
const Ye=(0,S.$j)((function SelectParentStageRunSampleCell_mapStateToProps(e,{eligibleParentStageRunIds:t}){return{parentStageRuns:t.map((t=>new se.xT(e.models.workflows).getStageRun(t))).filter((e=>e))}}))(SelectParentStageRunSampleCell)
class PendingInputTableRow extends r.Component{constructor(){super(...arguments)
this.state={isSampleDropdownOpen:!1}
this._handleOpenSampleDropdown=()=>{this.setState({isSampleDropdownOpen:!0})}
this._handleCloseSampleDropdown=()=>{this.setState({isSampleDropdownOpen:!1})}}_renderSampleCell(){return r.createElement(Ye,{stageRun:this.props.stageRun,eligibleParentStageRunIds:E.default.pluck(this.props.pendingParentStageRuns,"id"),stageRunSampleById:this.props.stageRunSampleById,locked:this.props.locked,isDropdownOpen:this.state.isSampleDropdownOpen,onOpenDropdown:this._handleOpenSampleDropdown,onCloseDropdown:this._handleCloseSampleDropdown},r.createElement("div",{className:"workflowDetailsTable-missingCellValue"},"Pending"))}_renderContainerCell(){return r.createElement("span",null)}render(){return r.createElement(SharedInputTableRow,{checkboxCell:this.props.checkboxCell,experimentalConditionValueNames:this.props.experimentalConditionValueNames,sampleCellFullElement:this._renderSampleCell(),containerCellContents:this._renderContainerCell(),stageRun:this.props.stageRun})}}PendingInputTableRow.propTypes={checkboxCell:n().node.isRequired,experimentalConditionValueNames:n().arrayOf(n().string.isRequired).isRequired,stageRun:Se.Sd.isRequired,pendingParentStageRuns:n().arrayOf(Se.Sd.isRequired).isRequired,stageRunSampleById:n().objectOf(Se.Lv).isRequired,locked:n().bool.isRequired}
const Qe=PendingInputTableRow
var Xe=s(692013),Je=s(764403),et=s.n(Je),tt=s(271359)
const st=Xe.mM.create({container:{borderRadius:"4px",fontSize:"13px",color:tt.Rl},header:{background:"transparent"},rightSide:{fontWeight:"normal",color:tt.pp},iconStyle:{marginRight:"0.4em"}})
function UnversionedTable(e){return r.createElement("div",{className:"richObjectTable-container-wrapper richObjectTable-minimalMargin"},r.createElement("div",{className:et()("richObjectTable-container",(0,Xe.iv)(st.container))},r.createElement("div",{className:et()("richObjectTable-header",(0,Xe.iv)(st.header))},r.createElement("div",{className:"u-flex-grow"},r.createElement(ve.Z,{icon:"input",className:(0,Xe.iv)(st.iconStyle)}),e.title),r.createElement("div",{className:et()("u-flex-none",(0,Xe.iv)(st.rightSide))},r.createElement(ve.Z,{icon:"info-circle",className:(0,Xe.iv)(st.iconStyle)}),"Version history not tracked"))))}function _getSampleRowId(e){return`${e.stageRunId}:${e.stageRunSampleId}`}function getSelectedSamples(e,t){const s=[]
for(const i of e)t[_getSampleRowId(i)]&&s.push(i)
return s}function getSelectedSampleIds(e,t,s){return(0,E.compact)(getSelectedSamples(e,s).map((e=>t[e.stageRunSampleId])).map((e=>{var t
return e?e.containerId||e.fileId||(null===(t=e.batch)||void 0===t?void 0:t.id):null})))}const it=[F.Ii,F.B3,null]
class InputTable extends r.Component{constructor(){super(...arguments)
this.state={isAddInputSampleModalOpen:!1,addInputSampleModalInitialExternalState:null,headerCheckBoxSelected:!1,selectedRowIds:{},...(0,he.eE)(this.props.stageRuns,this.props.inputTableConfig)}
this._isMounted=!1
this._toggleTableCollapsed=()=>{C.mS(this.props.stageEntryId)}
this._handleOpenAddInputSampleModal=(e,t)=>{this.setState({isAddInputSampleModalOpen:!0,addInputSampleModalInitialExternalState:{stageRunId:e,inputType:t}})}
this._handleCloseAddInputSampleModal=()=>{this.setState({isAddInputSampleModalOpen:!1,addInputSampleModalInitialExternalState:null})}
this._toggleHeaderCheckbox=()=>{if(this.state.headerCheckBoxSelected)this.setState({headerCheckBoxSelected:!1,selectedRowIds:{}})
else{const e={},t=(0,he.LQ)(this.props.orderedInputSamples,this.props.parentIdsByStageRunId||{},this.props.stageRunsById||{},this.props.stageRuns)
for(const s of t)e[this._getRowId(s)]=!0
this.setState({headerCheckBoxSelected:!0,selectedRowIds:e})}}
this._handleClickAutoselectContainersButton=async e=>{e.stopPropagation()
await J.jA(this.props.stageEntryId,getSelectedSamples(this.props.orderedInputSamples,this.state.selectedRowIds))
this._isMounted&&this.setState({selectedRowIds:{}})}
this._handleClickRemoveButton=e=>{e.stopPropagation()
J.O0(this.props.stageEntryId,getSelectedSamples(this.props.orderedInputSamples,this.state.selectedRowIds),{onSuccess:()=>{this.setState({selectedRowIds:{}})}})}
this._handleInsertFromSpreadsheet=()=>{te.open({stageEntryId:this.props.stageEntryId})}}shouldComponentUpdate(e,t){return!g()(this.props,e)||!g()(this.state,t)}componentDidMount(){this._isMounted=!0
C.i6(this.props.stageEntryId,this.props.isCollapsed?R.Z.COLLAPSED:R.Z.EXPANDED)}componentWillUnmount(){this._isMounted=!1}_toggleSelection(e){this.state.selectedRowIds[e]?this.setState({selectedRowIds:{...this.state.selectedRowIds,[e]:!1}}):this.setState({selectedRowIds:{...this.state.selectedRowIds,[e]:!0}})}_renderCheckbox(e){return r.createElement(H.wn,{checked:Boolean(this.state.selectedRowIds[e]),onChange:()=>{this._toggleSelection(e)},disabled:this.props.locked})}_renderHeaderCheckbox(){return this.props.locked?null:r.createElement(H.wn,{checked:this.state.headerCheckBoxSelected,onChange:this._toggleHeaderCheckbox})}_getRowId(e){return null!=e.sampleId?`${e.stageRun.id}:${e.sampleId}`:e.unfulfilledParents&&e.unfulfilledParents.length>0?`${e.stageRun.id}:pending`:`${e.stageRun.id}:empty`}_renderDownloadAsCSVButton(){return r.createElement(ie.Z,{stageEntryId:this.props.stageEntryId},(e=>r.createElement(v.e,{buttonStyle:P.ZJ.TERTIARY_BLUE,size:P.qE.SMALL,disabled:null==e,onDownloadAsCSV:()=>{(0,o.hu)(null!=e,"Should block the UI if input table is not yet loaded.")
const t=e.columnLabels,s=e.table,i=(0,k.Z)(s,t);(0,U.Px)(Z.VB(i,","),`${e.name}.csv`);(0,y.KK)(T.G$.DOWNLOADED_INPUT_TABLE_AS_CSV)}})))}_renderCreateRequestButton(){const e=(0,E.compact)(getSelectedSampleIds(this.props.orderedInputSamples,this.props.stageRunSampleById,this.state.selectedRowIds)).map((e=>({idForLookup:e})))
return r.createElement(w.Z,{buttonStyle:P.ZJ.TERTIARY_BLUE,className:"u-mini-spacing-right",sampleInfos:e,size:P.qE.SMALL})}_renderRightHeader(){if(this.props.viewer)return null
const e=getSelectedSamples(this.props.orderedInputSamples,this.state.selectedRowIds),t=E.default.uniq(e.map((e=>this.props.stageRunSampleById[e.stageRunSampleId])).filter((e=>e&&e.containerId)).map((e=>e.containerId)))
return r.createElement("div",{className:"u-flex-display"},r.createElement("div",null,r.createElement(_.ZP,{title:e.length?"Auto-select next available container":"Select rows to auto-select containers"},r.createElement("span",null,r.createElement(P.Co,{buttonStyle:P.ZJ.TERTIARY_BLUE,className:"u-mini-spacing-right",disabled:!e.length,icon:"bulk-select-next-container",onClick:this._handleClickAutoselectContainersButton,size:P.qE.SMALL})))),b.ZP.ENABLE_REQUESTS&&this._renderCreateRequestButton(),r.createElement(me,{containerIds:t,shouldShowArchiveButton:!0}),this._renderDownloadAsCSVButton(),r.createElement("div",null,r.createElement(_.ZP,{title:e.length?"Remove":"Select rows to remove"},r.createElement("span",null,r.createElement(P.Co,{buttonStyle:P.ZJ.TERTIARY_BLUE,className:"u-mini-spacing-left",disabled:!e.length,icon:"delete",onClick:this._handleClickRemoveButton,size:P.qE.SMALL})))))}_renderRow(e){const{stageRun:t,sampleId:s,parent:i,unfulfilledParents:n}=e,o=E.default.pluck((0,ge.Rn)(this.props.stageRuns),"name"),a=this._getRowId(e)
return null!=s?null!=i?r.createElement(Ge,{key:a,checkboxCell:this._renderCheckbox(a),experimentalConditionValueNames:o,stageRun:t,inputSampleId:s,stageRunSampleById:this.props.stageRunSampleById,locked:this.props.locked,viewer:this.props.viewer}):r.createElement(Ke,{key:a,checkboxCell:this._renderCheckbox(a),experimentalConditionValueNames:o,stageRun:t,inputSampleId:s,stageRunSampleById:this.props.stageRunSampleById,locked:this.props.locked,viewer:this.props.viewer}):n&&n.length>0?r.createElement(Qe,{key:a,checkboxCell:this._renderCheckbox(a),experimentalConditionValueNames:o,stageRun:t,pendingParentStageRuns:n,stageRunSampleById:this.props.stageRunSampleById,locked:this.props.locked}):r.createElement(we,{key:a,checkboxCell:this._renderCheckbox(a),experimentalConditionValueNames:o,stageRun:t,locked:this.props.locked,onOpenAddInputSampleModal:this._handleOpenAddInputSampleModal})}_getSortDirection(e){return this.state.sortColumnId===e?this.state.sortDirection:null}_getSortedRows(){const e=(0,he.LQ)(this.props.orderedInputSamples,this.props.parentIdsByStageRunId||{},this.props.stageRunsById||{},this.props.stageRuns),{sortColumnId:t,sortDirection:s}=this.state
return(0,he.ye)(e,this.props.stageRunSampleById,{sortColumnId:t,sortDirection:s})}_getInputTableConfigParameters(e,t){let s=Se.wI.DEFAULT,i=null,n=null
if(null!=e&&null!=t){switch(e){case he.Gg:s=Se.wI.SAMPLE
break
case he.i1:s=Se.wI.CONTAINER
break
case he.XZ:s=Se.wI.STAGE_RUN
break
default:{const t=E.default.findWhere((0,ge.Rn)(this.props.stageRuns),{id:e})
if(null!=t){s=Se.wI.EXPERIMENTAL_CONDITION_VALUE
i=t.id}break}}s!==Se.wI.DEFAULT&&(n=t===F.B3)}return{sortByType:s,sortByExperimentalConditionId:i,isSortReversed:n}}_sortColumn(e){let t
t=this.state.sortColumnId===e?it[(it.indexOf(this.state.sortDirection)+1)%it.length]:F.Ii
this.setState({sortColumnId:e,sortDirection:t})
X.updateInputTableConfig(this.props.stageEntryId,this._getInputTableConfigParameters(e,t))}_renderColumnHeader({columnId:e,text:t,isSortable:s}){return r.createElement(D.Z,{column:{isSortable:s,sortKey:e,accessorKey:null!=e?e:t,sortDirection:this._getSortDirection(e),header:t},handleSort:()=>{this._sortColumn(e)},isPrimary:!0,isCollapsed:!1})}_getHeaderCells(){return[this._renderHeaderCheckbox(),this._renderColumnHeader({columnId:he.Gg,text:Se.nK,isSortable:!0}),this._renderColumnHeader({columnId:he.i1,text:Se._I,isSortable:!1}),this._renderColumnHeader({columnId:he.XZ,text:Se.tl,isSortable:!0}),...(0,ge.Rn)(this.props.stageRuns).map((e=>this._renderColumnHeader({columnId:e.id,text:e.name,isSortable:!0})))]}_renderLeftHeader(){const e=0===this.props.stageRuns.length
return r.createElement("div",{className:"u-vertical-center-items"},r.createElement("div",null,"Input Samples"),!this.props.locked&&r.createElement(M.ZP,{className:"workflowTable-addDropdown",menu:r.createElement(N.ZP,{width:N.ZP.WIDTHS.LARGE,height:N.ZP.HEIGHTS.MEDIUM},r.createElement(O.Z,{icon:"compose",onSelect:()=>{this._handleOpenAddInputSampleModal(this.props.stageRuns[0].id,null)}},"Add input sample"),r.createElement(O.Z,{icon:"upload",onSelect:this._handleInsertFromSpreadsheet},"Import from spreadsheet"))},r.createElement(H.HS,{className:"u-mini-spacing-left",disabled:e})))}render(){if(!this.props.parentIdsByStageRunId||!this.props.stageRunsById){(0,o.Gp)(!1,"InputTable should never be rendered in a loading state.")
return r.createElement("div",{className:"text-center"},r.createElement(A.Z,null))}if(!fe.Z.getEditorState(this.props.stageEntryId).isLatest)return r.createElement(UnversionedTable,{title:"Input Samples"})
const e=this._getSortedRows()
return r.createElement("div",null,r.createElement(L.Z,{open:this.state.isAddInputSampleModalOpen},this.state.isAddInputSampleModalOpen&&r.createElement(xe,{stageRuns:this.props.stageRuns,stageRunSampleById:this.props.stageRunSampleById,onRequestClose:this._handleCloseAddInputSampleModal,initialExternalState:this.state.addInputSampleModalInitialExternalState})),r.createElement(q.E.Provider,{value:{isTableInitiallyCollapsed:this.props.isInitiallyCollapsed}},r.createElement(H.iA,{className:"noteEditor-richObjectTable",collapsedHeaderText:`${e.length} ${(0,I._6)(e.length,"row")}`,columns:[r.createElement(H.rW,{key:"firstCol"}),...E.default.range(this._getHeaderCells().length-1).map((e=>r.createElement("col",{key:e,width:H.Q0})))],headerCells:this._getHeaderCells(),isCollapsed:this.props.isCollapsed,isCollapsible:!0,leftHeader:this._renderLeftHeader(),rightHeader:this._renderRightHeader(),onToggleCollapsed:this._toggleTableCollapsed},e.map((e=>this._renderRow(e))))))}}InputTable.propTypes={stageEntryId:n().string.isRequired,locked:n().bool.isRequired,viewer:n().bool,stageRuns:n().array,stageRunSampleById:n().objectOf(Se.Lv).isRequired,stageRunsById:n().objectOf(Se.Sd.isRequired),parentIdsByStageRunId:n().objectOf(n().arrayOf(n().string.isRequired).isRequired),inputTableConfig:Se.Zp,orderedInputSamples:n().arrayOf(n().shape({stageRunId:n().string.isRequired,stageRunSampleId:n().string.isRequired})),isCollapsed:n().bool.isRequired}
const nt=(0,S.$j)((function makeMapStateToProps(){const e=(0,B.Z)(((e,t,s,i)=>{const n=new se.xT(e),r=n.getOrderedInputSampleKeys(s),a=n.getStageEntry(s),l=null==a?null:a.inputTableConfig,d=n.getOrderedStageRunsForEntry(s),p=n.getStageRunSampleById(),c=n.getParentIdsByStageRunId(d.map((e=>e.id)))
if(!c)return{parentIdsByStageRunId:null,stageRunsById:null,stageRunSampleById:p,stageRuns:d,inputTableConfig:l,orderedInputSamples:r,isCollapsed:!1,isInitiallyCollapsed:!1}
const u=[...Object.keys(c),...E.default.flatten(Object.values(c))],m=n.getStageRunsById(u),{isCollapsed:h,isInitiallyCollapsed:f}=function getIsCollapsed(e,t,s,i,n,r){const a=(0,x.Z)(function getNumRows({orderedInputSamples:e,parentIdsByStageRunId:t,stageRunsById:s,stageRuns:i}){return(0,he.LQ)(e,t,s,i).length}({orderedInputSamples:s,parentIdsByStageRunId:i,stageRunsById:n,stageRuns:r}))
let l
t&&(l=!1)
switch(e){case R.Z.COLLAPSED:l=!0
break
case R.Z.EXPANDED:l=!1
break
default:(0,o.hu)(null==e,"Unexpected collapsed state in Input Table")
l=a}return{isCollapsed:l,isInitiallyCollapsed:a}}(t,i,r,c,m,d)
return{parentIdsByStageRunId:c,stageRunsById:m,stageRunSampleById:p,stageRuns:d,inputTableConfig:l,orderedInputSamples:r,isCollapsed:h,isInitiallyCollapsed:f}}))
return(t,s)=>e(t.models.workflows,t.ui.collapsedTables.inputTableCollapsedStateByEntryId[s.stageEntryId],s.stageEntryId,s.viewer)}))(InputTable)
var rt=s(537076),ot=s(467704),at=s(762104),lt=s(591256),dt=s(697679),pt=s(75804)
function getRowId(e,t){return`${e}:${t}`}var ct=s(263137)
class OutputRichObjectTable extends r.Component{constructor(){super(...arguments)
this._isCollapsedInitially=()=>(0,x.Z)(this._getNumRows())
this._toggleTableCollapsed=()=>{C.C2(this.props.stageEntryId)}}shouldComponentUpdate(e){return!g()(this.props,e)}componentDidMount(){const e=this._isCollapsedInitially()?R.Z.COLLAPSED:R.Z.EXPANDED
C.LU(this.props.stageEntryId,e)}_renderHeaderCheckbox(){return this.props.locked?null:r.createElement(H.wn,{checked:this.props.headerCheckBoxSelected,onChange:this.props.onToggleHeaderCheckbox})}_getHeaderCells(){return[this._renderHeaderCheckbox(),Se.nK,"Container","Stage Run"]}_renderCheckbox(e){return r.createElement(H.wn,{checked:Boolean(this.props.selectedRowIds[e]),onChange:()=>{this.props.onToggleSelection(e)},disabled:this.props.locked})}_getValueCells(){const e=E.default.indexBy(this.props.stageRuns,"id"),t=[]
for(const{stageRunId:s,stageRunSampleId:i}of this.props.orderedOutputSamples){const n=e[s]
if(null==n){(0,o.Gp)(!1,"No stage run with the id was found",{stageRunId:s})
continue}const a=getRowId(n.id,i),l=this.props.stageRunSampleById[i]
t.push(r.createElement(H.X2,{key:a},r.createElement(H.bL,{primary:!0},this._renderCheckbox(a)),r.createElement(H.bL,{primary:!0},r.createElement(_e.Z,{sample:l})),l?r.createElement(H.bL,{primary:!0},r.createElement(Ae.Z,{containerId:l.containerId})):r.createElement(H.bL,null,r.createElement("span",{className:"u-faded u-italic"},"Loading")),r.createElement(H.bL,null,n.name)))}0===t.length&&t.push(r.createElement(H.X2,{key:"empty-row"},r.createElement(H.qN,null),r.createElement(H.bL,null,r.createElement("div",{className:"u-faded",...(0,ct.Z)({component:"OutputRichObjectTable",element:"noSamplesText"})},"No samples")),r.createElement(H.bL,null),r.createElement(H.bL,null)))
return t}_getNumRows(){return this._getValueCells().length}_renderCreateRequestButton(){const e=(0,E.compact)(getSelectedSampleIds(this.props.orderedOutputSamples,this.props.stageRunSampleById,this.props.selectedRowIds)).map((e=>({idForLookup:e})))
return r.createElement(w.Z,{buttonStyle:P.ZJ.TERTIARY_BLUE,className:"u-mini-spacing-right",sampleInfos:e,size:P.qE.SMALL})}_renderRightHeader(){return r.createElement("div",{className:"u-flex-display"},!this.props.locked&&b.ZP.ENABLE_REQUESTS&&this._renderCreateRequestButton(),!this.props.locked&&r.createElement(P.Co,{buttonStyle:P.ZJ.TERTIARY_BLUE,size:P.qE.SMALL,onClick:this.props.onRemoveOutputSamples,text:"Remove",disabled:!Object.values(this.props.selectedRowIds).some((e=>e))}))}render(){const e=this._getValueCells()
return r.createElement(q.E.Provider,{value:{isTableInitiallyCollapsed:this._isCollapsedInitially()}},r.createElement(H.iA,{className:"noteEditor-richObjectTable",collapsedHeaderText:`${e.length} ${(0,I._6)(e.length,"row")}`,isCollapsed:this.props.isCollapsed,isCollapsible:!0,leftHeader:r.createElement("div",{className:"u-vertical-center-items"},r.createElement("div",null,"Output Samples"),!this.props.locked&&r.createElement(H.HS,{className:"u-mini-spacing-left",onClick:this.props.onOpenAddSampleModal,tooltipProps:{container:!1}})),rightHeader:this._renderRightHeader(),headerCells:this._getHeaderCells(),columns:[r.createElement(H.rW,{key:"firstCol"}),...E.default.range(3).map((e=>r.createElement("col",{key:e,width:H.Q0})))],onToggleCollapsed:this._toggleTableCollapsed,dataTestAttrs:{component:"OutputRichObjectTable",element:"root"}},e))}}OutputRichObjectTable.propTypes={locked:n().bool.isRequired,viewer:n().bool.isRequired,stageEntryId:n().string.isRequired,headerCheckBoxSelected:n().bool.isRequired,selectedRowIds:n().objectOf(n().bool.isRequired).isRequired,orderedOutputSamples:n().arrayOf(n().shape({stageRunId:n().string.isRequired,stageRunSampleId:n().string.isRequired})),stageRuns:n().arrayOf(Se.Sd.isRequired).isRequired,stageRunSampleById:n().objectOf(Se.Lv.isRequired).isRequired,onOpenAddSampleModal:n().func.isRequired,onRemoveOutputSamples:n().func.isRequired,onToggleHeaderCheckbox:n().func.isRequired,onToggleSelection:n().func.isRequired,isCollapsed:n().bool.isRequired}
const ut=(0,S.$j)((function OutputRichObjectTable_mapStateToProps(e,t){if(t.viewer)return{isCollapsed:!1}
let s
const i=e.ui.collapsedTables.outputTableCollapsedStateByEntryId[t.stageEntryId]
switch(i){case R.Z.COLLAPSED:s=!0
break
case R.Z.EXPANDED:s=!1
break
default:(0,o.hu)(null==i,"Unexpected collapsed state")
s=!0}return{isCollapsed:s}}))(OutputRichObjectTable)
class OutputTable extends r.Component{constructor(){super(...arguments)
this.state={selectedRowIds:{},headerCheckBoxSelected:!1,isAddSamplesModalOpen:!1}
this._addOutputSamples=e=>{J.dX(e.map((({stageRun:e,stageRunSample:t})=>({stageRunId:e.id,stageRunSampleId:t.id}))))}
this._removeOutputSamples=e=>{e.stopPropagation()
const t=[]
for(const e of this.props.stageRuns)for(const s of e.outputSampleIds){const i=getRowId(e.id,s)
this.state.selectedRowIds[i]&&t.push({stageRunId:e.id,stageRunSampleId:s})}J.sS(t,{onSuccess:()=>{this.setState({selectedRowIds:{}})}})}
this._toggleSelection=e=>{this.state.selectedRowIds[e]?this.setState({selectedRowIds:{...this.state.selectedRowIds,[e]:!1}}):this.setState({selectedRowIds:{...this.state.selectedRowIds,[e]:!0}})}
this._toggleHeaderCheckbox=()=>{if(this.state.headerCheckBoxSelected)this.setState({headerCheckBoxSelected:!1,selectedRowIds:{}})
else{const e={}
for(const t of this.props.stageRuns)for(const s of t.outputSampleIds)e[getRowId(t.id,s)]=!0
this.setState({headerCheckBoxSelected:!0,selectedRowIds:e})}}
this._handleOpenAddSampleModal=e=>{e.stopPropagation()
this.setState({isAddSamplesModalOpen:!0})}
this._handleCloseAddSampleModal=()=>{this.setState({isAddSamplesModalOpen:!1})}}_getAvailableStageRunSampleDetailsByTableName(){const e=Ce.xy({stageRuns:this.props.stageRuns,registrationTables:ot.yF(this.props.note),registrationRecordListsById:this.props.registrationRecordListsById,tagSchemasById:this.props.tagSchemasById,transferTables:dt.getTransferTablesInNote(this.props.note),transferOperationListsById:this.props.transferOperationListsById,transferOperationsById:this.props.transferOperationsById}),t=Ce.Kk(this.props.stageRuns)
for(const s of Object.keys(e))e[s]=Ce.dl(e[s],t)
return Ce.aZ(e,this.props.stageRuns,this.props.stageRunSampleById)}_renderSamplesModal(){if(!this.state.isAddSamplesModalOpen)return!1
const e=this._getAvailableStageRunSampleDetailsByTableName(),t=Ce.WS({registrationTables:ot.yF(this.props.note),transferTables:dt.getTransferTablesInNote(this.props.note)})
return r.createElement(L.Z,{open:!0},r.createElement(at.Z,{enableRowCounts:!1,title:"Add output samples",dropdownIconByTableName:t,stageRunSampleDetailsByTableName:e,onStageRunSamplesSelected:this._addOutputSamples,onRequestClose:this._handleCloseAddSampleModal}))}render(){return fe.Z.getEditorState(this.props.stageEntryId).isLatest?r.createElement("div",null,this._renderSamplesModal(),r.createElement(ut,{stageEntryId:this.props.stageEntryId,locked:this.props.locked,viewer:this.props.viewer,headerCheckBoxSelected:this.state.headerCheckBoxSelected,selectedRowIds:this.state.selectedRowIds,orderedOutputSamples:this.props.orderedOutputSamples,stageRuns:this.props.stageRuns,stageRunSampleById:this.props.stageRunSampleById,onOpenAddSampleModal:this._handleOpenAddSampleModal,onRemoveOutputSamples:this._removeOutputSamples,onToggleHeaderCheckbox:this._toggleHeaderCheckbox,onToggleSelection:this._toggleSelection})):r.createElement(UnversionedTable,{title:"Output Samples"})}}OutputTable.propTypes={note:n().object.isRequired,stageEntryId:n().string.isRequired,stageRuns:n().arrayOf(Se.Sd.isRequired).isRequired,stageRunSampleById:n().objectOf(Se.Lv.isRequired).isRequired,locked:n().bool.isRequired,viewer:n().bool.isRequired,registrationRecordListsById:n().objectOf(Se.CJ).isRequired,transferOperationListsById:n().objectOf(lt.Nl).isRequired,transferOperationsById:n().objectOf(lt.HH).isRequired,orderedOutputSamples:n().arrayOf(n().shape({stageRunId:n().string.isRequired,stageRunSampleId:n().string.isRequired})),tagSchemasById:n().objectOf(rt.TAG_SCHEMA_SHAPE).isRequired}
const mt=pt.Z.connect((function mapTagSchemaStoreToProps(e,t){return{tagSchemasById:e.getTagSchemasById()}}))((0,S.$j)((function OutputTable_mapStateToProps(e,t){const s=new se.xT(e.models.workflows).getOrderedOutputSampleKeys(t.stageEntryId);(0,o.Gp)(null!=s,"orderedOutputSamples are expected to be loaded")
return{registrationRecordListsById:e.models.registrationRecordListsById,transferOperationListsById:e.models.transferTables.transferOperationListsById,transferOperationsById:e.models.transferTables.transferOperationsById,orderedOutputSamples:s||[]}}))(OutputTable))
var ht=s(41936)
class StageEntryNoteView extends r.PureComponent{constructor(){super(...arguments)
this.state={historyManager:new c.Z}
this.getIdFromCid=e=>fe.Z.getIdFromCid(this.props.fileId,e)
this.printHandler=(e,t)=>{switch(e){case l.dF.ENTRY:X.print(this.props.fileId,{})
break
case l.dF.NOTE:X.print(this.props.fileId,{protocolCids:[]})
break
case l.dF.SELECTION:X.print(this.props.fileId,{protocolCids:[],indexSlice:t})
break
case l.dF.TEMPLATE:(0,o.hu)(e!==l.dF.TEMPLATE,"Stage Entries do not have template print options")
break
default:throw new Error(`Unexpected print handler type ${(0,m.vE)(e)}`)}}
this.restoreStateAndSelection=({note:e,title:t},s)=>{X.revert(this.props.fileId,{name:{$set:t},...ht.f2({$merge:{note:e}})},s)}
this.updateNote=e=>{X.updateNote(this.props.fileId,e)}
this.registerObjects=e=>{X.registerObjects(this.props.fileId,e)}
this.updateTitle=e=>{X.setName(this.props.fileId,e)}}isLocked(){return!this.props.isLatest||!this.props.allowEdits}_getTitleBadge(){return u.Z.hasEnterprisePlan()?r.createElement(p.C8,{className:"noteEditor-reviewBadge",review:this.props.review}):null}render(){const e=this.props.indexSlice&&(this.props.indexSlice.start>0||this.props.indexSlice.end<1/0)
return r.createElement(d.WP,{...this.props,beforeEntry:r.createElement(r.Fragment,null,this.props.beforeEntry,e?null:r.createElement(nt,{stageEntryId:this.props.fileId,locked:this.isLocked(),viewer:this.props.viewer})),afterEntry:e?null:r.createElement(h.Z,{entryId:this.props.fileId},((e,t)=>r.createElement(mt,{note:this.props.note,stageEntryId:this.props.fileId,stageRuns:e,stageRunSampleById:t,locked:this.isLocked(),viewer:this.props.viewer}))),getIdFromCid:this.getIdFromCid,printHandler:this.printHandler,registerObjects:this.registerObjects,updateNote:this.updateNote,updateTitle:this.updateTitle,historyManager:this.state.historyManager,locked:this.isLocked(),restoreStateAndSelection:this.restoreStateAndSelection,titleBadge:this._getTitleBadge(),humanId:this.props.humanId})}}StageEntryNoteView.propTypes={beforeEntry:n().node,fileId:n().string.isRequired,humanId:n().string,isLatest:n().bool.isRequired,lockedFromExternalChange:n().bool,allowEdits:n().bool.isRequired,note:n().object.isRequired,review:n().object,viewer:n().bool.isRequired,indexSlice:n().shape({start:n().number.isRequired,end:n().number.isRequired}),permissions:a.OD.isRequired}
StageEntryNoteView.defaultProps={viewer:!1}
const ft=StageEntryNoteView},837677:(e,t,s)=>{s.d(t,{ZP:()=>ExternalInputPicker,fF:()=>getInputSamplesFromSpecifier,n$:()=>i})
var i,n=s(989526),r=s(232606),o=s(348920),a=s(459830),l=s(65301),d=s(255796),p=s(432128),c=s(488423),u=s(592383),m=s(993391),h=s(263137),f=s(946948),g=s(379346),S=s(544192),E=s(14498)
!function(e){e.BATCH="BATCH"
e.CONTAINER="CONTAINER"
e.FILE="FILE"}(i||(i={}))
function getInputSamplesFromSpecifier(e){return null==e?[]:e.batchInfo?[{batchId:e.batchInfo.id,containerId:null,fileId:null}]:e.containerInfo&&e.containedItemsForContainer?e.containedItemsForContainer.map((t=>{let s=null,i=null
if(null!=t.id&&g.ZP.isBiologicalEntity(t.id))i=t.id
else{(0,r.hu)(null!=t.id&&g.ZP.apiIdToType(t.id)===a.BATCH,"Expected batch")
s=t.id}return{batchId:s,containerId:e.containerInfo.id,fileId:i}})):e.bioentityInfo?[{batchId:null,containerId:null,fileId:e.bioentityInfo.id}]:[]}class ExternalInputPicker extends n.Component{constructor(e){super(e)
this._handleSetSelectedInputType=e=>{this.setState({selectedInputType:e})
this._updateSpecifier({...(0,d.Z)(),isContainable:null,containedItemsForContainer:null})
p.Z.set(S.zH.EXTERNAL_INPUT_PICKER_INPUT_TYPE,e)}
this._handleSetBatch=e=>{const t=e.length?e[0]:null,s=null==t?null:{id:t.id,name:t.name,fileId:t.file.id,iconId:t.file.iconId}
this._updateSpecifier({batchInfo:s,isContainable:!0,containedItemsForContainer:null})}
this._handleSetContainer=e=>{this._updateSpecifier({containerInfo:e.length?e[0]:null})}
this._handleSetFile=e=>{const t=e.length?e[0]:null,s=t&&(0,u.M)(t)
this._updateSpecifier({bioentityInfo:t?{id:t.id,name:t.name}:null,isContainable:s})}
this._handleSetContainedItemsForContainer=e=>{this._updateSpecifier({containedItemsForContainer:e.map((e=>({id:e.id,name:e.name,fileId:"file"in e&&e.file&&e.file.id,iconId:"file"in e&&e.file&&e.file.iconId})))})}
this.state={selectedInputType:e.initialInputType||null}}_updateSpecifier(e){const t={...(0,d.Z)(),isContainable:null,containedItemsForContainer:null,...this.props.externalInputSpecifier||{},...e}
this.props.onSetExternalInputSpecifier(t)}_getSelectedInputType(){const e=this.state.selectedInputType||p.Z.get(S.zH.EXTERNAL_INPUT_PICKER_INPUT_TYPE)||i.FILE
return(e!==i.BATCH||o.ZP.ENABLE_BATCHES)&&(e!==i.CONTAINER||this.props.allowContainers)?e:i.FILE}_renderSearchInput(){let e=null,t=null,s=null
if(this.props.externalInputSpecifier){e=this.props.externalInputSpecifier.batchInfo
t=this.props.externalInputSpecifier.containerInfo
s=this.props.externalInputSpecifier.bioentityInfo}const r=this._getSelectedInputType()
return r===i.BATCH?n.createElement(c.Z,{onChange:this._handleSetBatch,selectedBatches:e?[e]:[],autoFocus:!1}):r===i.CONTAINER?n.createElement(m.Z,{onChange:this._handleSetContainer,registryId:null,selectedStorables:t?[t]:[],storableTypes:[a.CONTAINER],autoFocus:!1}):n.createElement(l.Z,{autoFocus:!1,onChange:this._handleSetFile,selectedItems:s?[s]:[]})}getRadioButtonOptions(){const e=[{label:"Entity",value:i.FILE,dataTestAttrs:{component:"ExternalInputPicker",key:i.FILE}}]
o.ZP.ENABLE_BATCHES&&e.push({label:"Batch",value:i.BATCH,dataTestAttrs:{component:"ExternalInputPicker",key:i.BATCH}})
this.props.allowContainers&&e.push({label:"Container",value:i.CONTAINER,dataTestAttrs:{component:"ExternalInputPicker",key:i.CONTAINER}})
return e}render(){let e=null,t=null
if(null!=this.props.externalInputSpecifier){e=this.props.externalInputSpecifier.containerInfo
if(this.props.externalInputSpecifier.containedItemsForContainer){t=[]
for(const e of this.props.externalInputSpecifier.containedItemsForContainer)null!=e.id&&t.push(e.id)}}const s=this._getSelectedInputType()
return n.createElement("div",{...(0,h.Z)({component:"ExternalInputPicker",element:"root"})},n.createElement(f.t,{selectedValue:s,options:this.getRadioButtonOptions(),onChange:this._handleSetSelectedInputType}),n.createElement("div",{className:"u-small-spacing-top"},this._renderSearchInput()),e&&n.createElement(E.ZP,{containerId:e.id,selectedContainedItemIds:t,onSelectContainedItems:this._handleSetContainedItemsForContainer}))}}}}])

//# sourceMappingURL=81.6f2426bc33cc1b7a5637a50ddf0fceb3.js.map