(self.webpackChunkaurelia=self.webpackChunkaurelia||[]).push([[189],{646127:(e,t,n)=>{"use strict"
n.r(t)
n.d(t,{default:()=>m4})
var a={}
n.r(a)
n.d(a,{getSitesInsideFragmentWarning:()=>getSitesInsideFragmentWarning,siteInsideFragment:()=>siteInsideFragment})
var i=n(440281),s=n.n(i),r=n(250965),o=n.n(r),l=n(531041),c=n(770188),d=n(989526),u=n(573961),m=n(468943),p=n(103593),h=n(59860),g=n(692013),E=n(764403),f=n.n(E),S=n(232606),y=n(48047),b=n(47984),T=n(132814),v=n(974913),C=n(334148),I=n(198964),w=n(865486),N=n(924982),A=n(80558)
function siteInsideFragment(e,t,{start:n,end:a,cutsites:i}){(0,S.hu)(0!==t.get("cut"),`enzyme=${t.get("id")} cuts at its recognition site`);(0,S.hu)(null!=n||null!=a,`Both start=${n} and end=${a} are not defined`)
const s=null!=n?n:null!=a?a:void 0;(0,S.hu)(null!=l.default.findWhere(i,{position:s}),`enzyme=${t.get("id")} cutsites=${JSON.stringify(i)} don't include start=${n} or end=${a}`)
const r=null!=n?t.get("cut")>0?-1:1:null!=a?t.get("cut")>0?1:-1:void 0
return null!=l.default.findWhere(i,{position:s,strand:r})}function getSitesInsideFragmentWarning(e,t,{start:n,end:a,cutsites:i}){const s=null!=n?siteInsideFragment(0,t,{start:n,cutsites:i}):void 0,r=null!=a?siteInsideFragment(0,t,{end:a,cutsites:i}):void 0
if(s&&r){let t="Recognition sites are inside fragment."
e.circular()&&(t+=" Flip start and end.")
return t}return s?"Start recognition site is inside fragment.":r?"End recognition site is inside fragment.":null}var R=n(955836),P=n(868710)
const{getSitesInsideFragmentWarning:O}=a,{ASSEMBLY_TYPE:x}=b,_="left-side",D="right-side",L="site-preview-active",k="site-preview-inactive",M="site-preview-inactive-primer",F="current-fragment-info-preview"
class SitePreview extends d.Component{constructor(){super(...arguments)
this._fragmentBasesWithCutSite=e=>{const t=e.getSequence(),n=(()=>{if(null==e.enzymeIDs())return t.residueSlice(e.start(),e.end())
{const[{offset:n},{offset:a}]=Array.from(e.getEnzymes()),i=T.mod(e.start()+Math.min(0,n),t.length()),s=T.mod(e.end()+Math.max(0,a),t.length())
return t.residueSlice(i,s)}})()
return e.reverse()?y.revcomp(n,R.jb):n}
this._bothPrimers=()=>{const e=this.props.leftSlot.isEmpty()||null==this.props.leftSlot.singleFragment().enzymeIDs(),t=this.props.rightSlot.isEmpty()||null==this.props.rightSlot.singleFragment().enzymeIDs()
return e&&t}
this._filler=(e,t)=>{null==t&&(t="-")
return function __range__(e,t,n){const a=[],i=e<t,s=n?i?t+1:t-1:t
for(let t=e;i?t<s:t>s;i?t++:t--)a.push(t)
return a}(0,e,!1).map((e=>t)).join("")}
this._getRightEnzyme=e=>{const t=e.reverse()?1:0
return e.getEnzymes()[t]}
this._getLeftEnzyme=e=>{const t=e.reverse()?0:1
return e.getEnzymes()[t]}
this.renderLeft=()=>{let e
const leftConstruct=(e,t)=>{let n
n=this.props.activeSide===_?L:k
return d.createElement("div",{className:F},d.createElement("div",{className:n},e),d.createElement("div",{className:n},t))},t=this.props.leftSlot.spacer()
if(t){const e=t.slice(-3)
return leftConstruct(e,y.complement(e,R.jb))}if(this.props.leftSlot.isEmpty())return leftConstruct(this._filler(3),this._filler(3))
const n=this.props.leftSlot.singleFragment(),a=this._fragmentBasesWithCutSite(n)
if(this._bothPrimers())e=a.slice(-5)
else{let t
null!=n.enzymeIDs()?({offset:t}=this._getLeftEnzyme(n)):t=0
const i=-(3+Math.abs(t))
let s=-Math.abs(t)
0===s&&(s=void 0)
e=a.slice(i,s)}return leftConstruct(e,y.complement(e,R.jb))}
this.renderMid=()=>{let e,t,n,a,i,s,r,o,c,u,m,p,h,g,E
if(this._bothPrimers())return null
const midConstruct=(e,t,n,a)=>d.createElement("div",{className:F},d.createElement("div",{className:n},e),d.createElement("div",{className:a},t))
if(this.props.leftSlot.isEmpty()){p=this.props.rightSlot.singleFragment()
m=this._fragmentBasesWithCutSite(p);({offset:o}=this._getRightEnzyme(p))
if(this.props.leftSlot.spacer()){c=e=>y.complement(e,R.jb)
u=M}else{c=e=>this._filler(e.length)
u=k}if(o>=0){h=m.slice(0,o)
e=c(h)
i=this.props.activeSide===D?L:k
a=u}else{e=y.complement(m.slice(0,-o),R.jb)
h=c(e)
a=this.props.activeSide===D?L:k
i=u}return midConstruct(h,e,i,a)}if(this.props.rightSlot.isEmpty()){r=this.props.leftSlot.singleFragment()
s=this._fragmentBasesWithCutSite(r);({offset:o}=this._getLeftEnzyme(r))
if(this.props.rightSlot.spacer()){c=e=>y.complement(e,R.jb)
u=M}else{c=e=>this._filler(e.length)
u=k}if(o>0){e=y.complement(s.slice(-o),R.jb)
h=c(e)
a=this.props.activeSide===_?L:k
i=u}else if(0===o){h=""
e=""
i=k
a=k}else{h=s.slice(o)
e=c(h)
i=this.props.activeSide===_?L:k
a=u}return midConstruct(h,e,i,a)}r=this.props.leftSlot.singleFragment()
p=this.props.rightSlot.singleFragment()
s=this._fragmentBasesWithCutSite(r)
m=this._fragmentBasesWithCutSite(p)
if(null!=r.enzymeIDs()){({offset:o}=this._getLeftEnzyme(r))
if(null!=p.enzymeIDs()){const{offset:e}=this._getRightEnzyme(p);(0,S.hu)(e===o,"SitePreview only supports same offsets!")}}else({offset:o}=this._getRightEnzyme(p))
if(null!=r.enzymeIDs())if(o>0){g=""
t=s.slice(-o)}else if(0===o){g=""
t=""}else{g=s.slice(o)
t=""}else if(o>=0){g=""
t=m.slice(0,o)}else{g=m.slice(0,-o)
t=""}if(null!=p.enzymeIDs())if(o>=0){E=m.slice(0,o)
n=""}else{E=""
n=m.slice(0,-o)}else if(o>0){E=s.slice(-o)
n=""}else if(0===o){E=""
n=""}else{E=""
n=s.slice(o)}const f=(g+E).length,b=(t+n).length;(0,S.hu)(f===b,"Missing padding on top or bottom bases!")
const getClassName=(e,t,n)=>this.props.activeSide===e?n?"site-preview-mismatch":null!=t.enzymeIDs()?L:"site-preview-primer":null!=t.enzymeIDs()?k:M
h=g+E
e=t+n
return d.createElement("div",{className:F},d.createElement("div",null,l.default.map(h,((t,n)=>{const a=t!==e[n],i=n<g.length?_:D,s=n<g.length?r:p
return d.createElement("span",{key:n,className:getClassName(i,s,a)},t)}))),d.createElement("div",null,l.default.map(e,((e,n)=>{const a=e!==h[n],i=n<t.length?_:D,s=n<t.length?r:p
return d.createElement("span",{key:n,className:getClassName(i,s,a)},y.revcomp(e,R.jb))}))))}
this.renderRight=()=>{let e
const rightConstruct=(e,t)=>{let n
n=this.props.activeSide===D?L:k
return d.createElement("div",{className:F},d.createElement("div",{className:n},e),d.createElement("div",{className:n},t))},t=this.props.rightSlot.spacer()
if(t){const e=t.slice(0,3)
return rightConstruct(e,y.complement(e,R.jb))}if(this.props.rightSlot.isEmpty())return rightConstruct(this._filler(3),this._filler(3))
const n=this.props.rightSlot.singleFragment(),a=this._fragmentBasesWithCutSite(n)
if(this._bothPrimers())e=a.slice(0,5)
else{let t
null!=n.enzymeIDs()?({offset:t}=this._getRightEnzyme(n)):t=0
const i=Math.abs(t),s=Math.abs(t)+3
e=a.slice(i,s)}return rightConstruct(e,y.complement(e,R.jb))}}render(){return d.createElement("div",{className:F},this.renderLeft(),this.renderMid(),this.renderRight())}}class ShowFragmentComponent extends d.Component{constructor(){super(...arguments)
this.getPrevSlot=()=>{const e=this.props.activeSlot.index()
return this._getSlotAt(e,-1)}
this.getNextSlot=()=>{const e=this.props.activeSlot.index()
return this._getSlotAt(e,1)}
this._getSlotAt=(e,t)=>{const n=this.props.assembly.slots().length,a=(e+t+n)%n
return this.props.assembly.slots().at(a)}
this.clearFragment=()=>{this.props.activeSlot.singleFragment().destroy()}
this.reverseFragment=()=>{this.props.activeSlot.setSingleFragment({reverse:!this.props.activeSlot.singleFragment().reverse()})}
this.openFragment=()=>{this.props.activeSlot.singleFragment().open()}
this.renderSitesInsideFragmentWarning=e=>{if(this.props.assembly.method()!==x.GOLDEN_GATE||null==e.enzymeIDs())return null
if(!(null!=l.default.findWhere(this.props.cutsites,{position:e.start()})&&null!=l.default.findWhere(this.props.cutsites,{position:e.end()})))return null
const t=O(e.getSequence(),this.props.assembly.enzyme(),{start:e.start(),end:e.end(),cutsites:this.props.cutsites})
return null==t?null:d.createElement("span",{className:"u-warning-color"},d.createElement(A.Z,{icon:"warning",renderContent:()=>t}))}
this.renderSitePreviewType=(e,t)=>{let n,a
if(t.isSpacer()){n="a spacer (added through a primer)"
a="Spacer"}else if(t.isEmpty()){n="not set yet"
a="Unset"}else if(null!=t.singleFragment().enzymeIDs()){n="linearized by digestion"
a="Digest"}else{n="linearized by PCR"
a="Primer"}return d.createElement(P.ZP,{title:`The ${e} fragment is ${n}.`,placement:P.TQ.BOTTOM,container:"body",delay:{show:500}},d.createElement("span",null,a))}}render(){const e=this.props.activeSlot.singleFragment(),t=e.getSequence().length(),n=e.getSequence().startIndex(),a=T.length(e.start(),e.end(),t),[i,s]=Array.from(T.modelRangeToDisplay(e.start(),e.end(),t,n))
return d.createElement("div",{className:"u-small-spacing-top"},d.createElement("div",{className:"pull-right"},d.createElement("div",{className:"buttonGroup u-tiny-spacing-bottom u-small-spacing-left"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,onClick:this.clearFragment,text:"Change"}),d.createElement(P.ZP,{title:"Reverse Fragment",container:"body"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.reverseFragment,icon:"swap"})),d.createElement(P.ZP,{title:"Open Fragment",container:"body"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.openFragment,icon:"share-alt"}))),d.createElement("div",{className:"text-center faded"},`${y.formatBaseCount(a)} · ${i} to ${s}`,e.reverse()?" · reversed":void 0," ",this.renderSitesInsideFragmentWarning(e))),d.createElement("div",{className:"u-display-inline-block"},d.createElement("div",{className:"selectable"},d.createElement(SitePreview,{leftSlot:this.getPrevSlot(),rightSlot:this.props.activeSlot,activeSide:D}),d.createElement("div",{className:"current-fragment-info-preview u-small-spacing-left u-small-spacing-right"},d.createElement("div",{className:`${L} u-small-text text-center`},`(~${y.formatBaseCount(e.length())})`),d.createElement("div",{className:L},"......")),d.createElement(SitePreview,{leftSlot:this.props.activeSlot,rightSlot:this.getNextSlot(),activeSide:_})),d.createElement("div",{className:"site-preview-types text-center"},d.createElement("div",{className:"pull-left faded"},this.renderSitePreviewType("upstream",this.getPrevSlot())),d.createElement("div",{className:"pull-right faded"},this.renderSitePreviewType("downstream",this.getNextSlot())),this.renderSitePreviewType("current",this.props.activeSlot))))}}const Z=ShowFragmentComponent
class SpacerEditor extends d.Component{constructor(){super(...arguments)
this.stateFromProps=e=>({name:e.slot.name(),bases:e.slot.spacer()})
this.updateName=e=>{const t=e.target.value.trimLeft()
this.setState({name:t})}
this.updateBases=e=>{const t=y.sanitize(e.target.value,y.NucleotideType.DNA)
this.setState({bases:t})}
this.saveChanges=e=>{e.preventDefault()
this.props.slot.set({name:this.state.name,spacer:this.state.bases}).save(null,{patch:!0}).fail(v.ZP.notifyError).done((()=>{v.ZP.success("Spacer successfully updated.")}))
this.forceUpdate()}
this.changesMade=()=>this.state.name!==this.props.slot.name()||this.state.bases!==this.props.slot.spacer()
this.state=this.stateFromProps(this.props)}UNSAFE_componentWillReceiveProps(e){e.slot!==this.props.slot&&this.setState(this.stateFromProps(e))}render(){const e=!this.changesMade()
return d.createElement("form",{className:"form-inline u-spacing-top",onSubmit:this.saveChanges},d.createElement("input",{type:"text",placeholder:"Name",value:this.state.name,onChange:this.updateName,className:"u-inline-form-input"})," ",d.createElement("input",{type:"text",placeholder:"Bases",value:this.state.bases,onChange:this.updateBases,className:"u-inline-form-input-lg"})," ",d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,type:"submit",disabled:e,text:"Save"}))}}const B=SpacerEditor,{formatBaseCount:q}=y,{ASSEMBLY_TYPE:V}=b,{getSitesInsideFragmentWarning:U,siteInsideFragment:G}=a,z="selection",$="cut-sites"
class FragmentActions extends d.Component{constructor(){super(...arguments)
this.setFragment=()=>{let e,t,n,a,i
const s=this.props.selection
if(this.props.setFrom===$){a=this.props.selectedStartSite
e=this.props.selectedEndSite
i=this.props.enzyme.id
t=this.props.enzyme.id
if(e>a)n=!1
else if(this.props.sequence.circular())n=!1
else{n=!0;[a,e]=Array.from([e,a])}}else{({start:a}=s);({end:e}=s)
if(this.props.readEnzymeFromSelection&&null!=s.cutStart&&null!=s.cutEnd){i=s.cutStart.get("enzyme").id
t=s.cutEnd.get("enzyme").id}else{i=null
t=null}n=!1}this.props.activeSlot.setSingleFragment({sequenceID:this.props.sequence.id,sequenceMetadata:{name:this.props.sequence.name()},name:this.props.sequence.name(),start:a,end:T.mod(e,this.props.sequence.length()),startEnzymeID:i,endEnzymeID:t,reverse:n}).fail(v.ZP.notifyError)}
this.willUseEnzymes=()=>this.props.setFrom===$||!!this.props.readEnzymeFromSelection&&(null!=(null!=this.props.selection?this.props.selection.cutStart:void 0)&&null!=(null!=this.props.selection?this.props.selection.cutEnd:void 0))}render(){const e=(()=>{switch(this.props.setFrom){case z:return null!=(null!=this.props.selection?this.props.selection.start:void 0)&&null!=(null!=this.props.selection?this.props.selection.end:void 0)
case $:return null!=this.props.selectedStartSite&&null!=this.props.selectedEndSite
default:return!0}})()
return d.createElement("div",{className:"text-center"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,className:"u-tiny-spacing-bottom",disabled:!e,onClick:this.setFragment,text:"Set Fragment",dataTestAttrs:{component:"CurrentFragmentInfo",element:"setFragmentButton"}}),d.createElement("div",{className:"faded"},this.willUseEnzymes()?"Use existing sites.":"Design a primer pair."))}}class GoldenGateSetFragmentComponent extends d.Component{constructor(e){super(e)
this._sitesFromSelection=e=>{let t,n
const a=null!=e.selection?e.selection.start:void 0,i=null!=e.selection?e.selection.end:void 0,s=l.default.pluck(e.cutsites,"position")
n=Array.from(s).includes(a)?a:null
t=Array.from(s).includes(i)?i:null
return[n,t]}
this._setDefaultCuts=(e,t,n,a,i)=>{if(null==a){const s=l.default.find(n,(a=>a.position!==i&&!G(e,t,{start:a.position,cutsites:n})))
if(null!=s){a=s.position
this.setStartSite(a)}}if(null==i){const s=l.default.find(n,(i=>i.position!==a&&!G(e,t,{end:i.position,cutsites:n})))
if(null!=s){i=s.position
this.setEndSite(i)}}2===n.length&&this.setState({setFrom:$})}
this.setSetFrom=e=>{this.setState({setFrom:e.target.value})}
this.setStartSite=e=>{this.setState({selectedStartSite:e})
e===this.state.selectedEndSite&&this.setState({selectedEndSite:null})}
this.setEndSite=e=>{this.setState({selectedEndSite:e})
e===this.state.selectedStartSite&&this.setState({selectedStartSite:null})}
this.handleStartSiteChange=e=>{this.props.sequence.trigger("jump",e)
this.setStartSite(e)}
this.handleEndSiteChange=e=>{this.props.sequence.trigger("jump",e)
this.setEndSite(e)}
this.renderSitesInsideFragmentWarning=()=>{if(null==this.props.sequence||this.state.setFrom!==$)return null
const e=U(this.props.sequence,this.props.enzyme,{start:this.state.selectedStartSite,end:this.state.selectedEndSite,cutsites:this.props.cutsites})
return null==e?null:d.createElement("span",{className:"u-warning-color"},d.createElement(A.Z,{icon:"warning",renderContent:()=>e}))}
const[t,n]=Array.from(this._sitesFromSelection(e))
this.state={setFrom:z,selectedStartSite:t,selectedEndSite:n}}UNSAFE_componentWillMount(){this._setDefaultCuts(this.props.sequence,this.props.enzyme,this.props.cutsites,this.state.selectedStartSite,this.state.selectedEndSite)}UNSAFE_componentWillReceiveProps(e){let t=__guard__(l.default.findWhere(e.cutsites,{position:this.state.selectedStartSite}),(e=>e.position)),n=__guard__(l.default.findWhere(e.cutsites,{position:this.state.selectedEndSite}),(e=>e.position)),a=!1,i=!1
if(this.props.enzyme.id!==e.enzyme.id){this.setState({selectedStartSite:null,selectedEndSite:null})
t=null
n=null}if(null!=this.state.selectedStartSite&&null==t){this.setState({selectedStartSite:null})
t=null}if(null!=this.state.selectedEndSite&&null==n){this.setState({selectedEndSite:null})
n=null}const[s,r]=Array.from(this._sitesFromSelection(e))
if(null!=s){this.setStartSite(s)
a=!0
t=s}if(null!=r){this.setEndSite(r)
i=!0
n=r}if(a&&i){this.setState({setFrom:$})
return}this.props.sequence===e.sequence&&this.props.enzyme.id===e.enzyme.id||this._setDefaultCuts(e.sequence,e.enzyme,e.cutsites,t,n)
const o=(null!=this.props.selection?this.props.selection.start:void 0)!==(null!=e.selection?e.selection.start:void 0),c=(null!=this.props.selection?this.props.selection.end:void 0)!==(null!=e.selection?e.selection.end:void 0);(o||c)&&this.setState({setFrom:z})}render(){const e=this.props.cutsites.length<2,t=null!=this.props.sequence?this.props.sequence.startIndex():void 0
return d.createElement("div",{className:"u-small-spacing-top"},d.createElement("div",{className:"pull-right"},d.createElement(FragmentActions,{activeSlot:this.props.activeSlot,enzyme:this.props.enzyme,readEnzymeFromSelection:!1,selectedStartSite:this.state.selectedStartSite,selectedEndSite:this.state.selectedEndSite,selection:this.props.selection,sequence:this.props.sequence,setFrom:this.state.setFrom})),d.createElement("div",null,d.createElement("label",{className:"radio-inline"},d.createElement("input",{type:"radio",name:"set-from-option",value:z,checked:this.state.setFrom===z,onChange:this.setSetFrom})," ",d.createElement("div",null,d.createElement("div",{className:"u-tiny-spacing-bottom"},"Selection"),d.createElement("div",{className:f()("faded",(0,g.iv)(H.assemblyFragmentSelection))},(()=>{if(null==this.props.selection)return"None"
if(null!=this.props.selection.start&&null==this.props.selection.end)return`${T.modelStartToDisplay(this.props.selection.start,t)} to -`;(0,S.hu)(null!=this.props.selection.start&&null!=this.props.selection.end,"expected selection to have start and end")
return`${T.modelStartToDisplay(this.props.selection.start,t)} to       ${T.modelEndToDisplay(this.props.selection.end,this.props.sequence.length(),t)}`})()))),d.createElement("label",{className:"radio-inline"},d.createElement("input",{type:"radio",name:"set-from-option",value:$,checked:this.state.setFrom===$,onChange:this.setSetFrom})," ",d.createElement("div",null,d.createElement("div",{className:"u-tiny-spacing-bottom"},d.createElement("a",{onClick:this.props.toggleParameters},this.props.assembly.enzyme().get("name"))," Cut Sites ",this.renderSitesInsideFragmentWarning()),(()=>{if(e)return d.createElement("div",{className:f()("faded",(0,g.iv)(H.assemblyFragmentSelection))},0===this.props.cutsites.length?"No Cut Sites":"Requires 2 Cut Sites")
{let e,n
this.props.sequence.length()
n=null!=this.state.selectedStartSite?T.modelStartToDisplay(this.state.selectedStartSite,t):"Start"
e=null!=this.state.selectedEndSite?T.modelStartToDisplay(this.state.selectedEndSite,t):"End"
return d.createElement("div",null,d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.SMALL},this.props.cutsites.map(((e,n)=>d.createElement(N.Z,{key:n,onSelect:()=>{this.handleStartSiteChange(e.position)}},T.modelStartToDisplay(e.position,t)))))},d.createElement(C.Co,{isDropdown:!0,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:n}))," to ",d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.SMALL},this.props.cutsites.map(((e,n)=>d.createElement(N.Z,{key:n,onSelect:()=>{this.handleEndSiteChange(e.position)}},T.modelStartToDisplay(e.position,t)))))},d.createElement(C.Co,{isDropdown:!0,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:e})))}})()))))}}class GibsonSetFragmentComponent extends d.Component{render(){const e=0===this.props.activeSlot.index(),{selection:t}=this.props
return d.createElement("div",{className:"u-small-spacing-top"},d.createElement("div",{className:"pull-right"},d.createElement(FragmentActions,{activeSlot:this.props.activeSlot,readEnzymeFromSelection:e,selection:this.props.selection,sequence:this.props.sequence,setFrom:z})),d.createElement("div",{className:"faded"},(()=>{if(null==t||null==t.start||null==t.end)return"Select bases on a sequence to set this fragment."
{const n=this.props.sequence.startIndex(),a=this.props.sequence.length(),i=T.length(t.start,t.end,a)
return[d.createElement("div",{key:"selection-info"},"Selected ",d.createElement("strong",null,q(i))," from ",d.createElement("strong",null,T.modelStartToDisplay(t.start,n))," to ",d.createElement("strong",null,T.modelEndToDisplay(t.end,a,n)),"."),(()=>{if(e&&null!=t.cutStart&&null!=t.cutEnd){const{cutStart:e}=t,{cutEnd:n}=t
return d.createElement("div",{key:"enzyme-info"},"Using sticky ends cut by ",d.createElement("span",{style:{backgroundColor:e.color()||void 0,color:"black"}},e.name())," and ",d.createElement("span",{style:{backgroundColor:n.color()||void 0,color:"black"}},n.name()),".")}return null})()]}})()))}}const W=function CurrentFragmentInfo(e){return e.assembly.method()===V.DIGEST?d.createElement("div",null):d.createElement("div",{className:f()({"current-fragment-info":!0,"u-small-spacing-top":e.activeSlot.isEmpty()})},d.createElement("h4",null,e.activeSlot.isSpacer()?"Edit Spacer":(null!=e.activeSlot?e.activeSlot.isEmpty():void 0)?"Set Fragment":"Current Fragment: Assembled Preview"),(()=>{if(e.activeSlot.isSpacer())return d.createElement(B,{slot:e.activeSlot})
if(!e.activeSlot.isEmpty())return d.createElement(Z,{activeSlot:e.activeSlot,assembly:e.assembly,cutsites:e.cutsites})
switch(e.assembly.method()){case V.GOLDEN_GATE:return d.createElement(GoldenGateSetFragmentComponent,{...e})
case V.GIBSON:return d.createElement(GibsonSetFragmentComponent,{...e})
default:throw new Error(`Unexpected assembly type: ${e.assembly.method()}`)}})())}
function __guard__(e,t){return null!=e?t(e):void 0}const H=g.mM.create({assemblyFragmentSelection:{paddingTop:"3px",paddingBottom:"4px"}})
var j=n(171471),Y=n(767807),Q=n.n(Y),K=n(602652),J=n.n(K),X=n(146238),ee=n(263137),te=n(973606),ne=n(361974)
function ownKeys(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e)
t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _extends(){_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]
for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}
return _extends.apply(this,arguments)}function _defineProperty(e,t,n){(t=function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}const{ASSEMBLY_TYPE:ae}=b,{TYPE_IIS_ENZYME_IDS:ie}=te.ZP,se=X.ZP.getCommonEnzymes(),re={model:J().object.isRequired,showParameters:J().bool.isRequired,updateParameters:J().func.isRequired,toggleParameters:J().func.isRequired}
class UpdateParameterComponent extends d.Component{constructor(...e){super(...e)
_defineProperty(this,"state",{localParameters:this.props.model.parameters()})
_defineProperty(this,"renderInput",(({key:e,onChange:t})=>{const n=this.state.localParameters[e],a=this.serverValid([e,n])
return d.createElement("span",{className:f()({"has-error":!a})},d.createElement("input",{type:"text",onChange:t,value:n,className:"form-control"}))}))
_defineProperty(this,"serverValid",((...e)=>{const[t,n]=Array.from(e[0]),{number:a,nullable:i}=this.props.parameters[t]
return null==n?i:!a||n.toString().length>0}))
_defineProperty(this,"parameterUpdater",((e,t)=>n=>this.updateParameterByValue(e,t,n.target.value)))
_defineProperty(this,"updateParameterByValue",((e,t,n,a)=>{null==a&&(a={})
l.default.defaults(a,{save:!0,existingParams:null})
let{save:i,existingParams:s}=a
null==s&&(s=this.state.localParameters)
if(n.length&&(t===parseInt||t===parseFloat)&&Number.isNaN(t(Number(n))))return null
n.length&&t===parseInt&&(n=t(Number(n)))
const r=Q()(s,{$merge:l.default.object([[e,n]])})
this.setState({localParameters:r})
i&&l.default.all(l.default.pairs(r),this.serverValid)&&this.props.updateParameters(r)
return r}))
_defineProperty(this,"render",(()=>d.createElement(FinalizeWrapper,this.props,this.renderParameters())))}UNSAFE_componentWillReceiveProps(e){this.setState({localParameters:e.model.parameters()})}renderParameters(){return this.props.showParameters?d.createElement("div",{className:"assembly-settings"},this.props.renderParametersForm({renderInput:this.renderInput,parameterUpdater:this.parameterUpdater,updateParameterByValue:this.updateParameterByValue,localParameters:this.state.localParameters})):null}}_defineProperty(UpdateParameterComponent,"propTypes",_objectSpread(_objectSpread({},re),{},{parameters:J().object.isRequired,renderParametersForm:J().func.isRequired}))
class FinalizeWrapper extends d.Component{constructor(...e){super(...e)
_defineProperty(this,"handleClickAssemble",(()=>{m.j("assembly","assemble_click",{product:j.XC.MOLBIO,assemblyMethod:this.props.model.method()})
this.props.createAssembly()}))
_defineProperty(this,"setName",(e=>{let t=e.target.value
if(t.length>128){t=t.slice(0,128)
v.ZP.warn("Assembly names can't be more than 128 characters.",{id:"assembly-name"})}this.props.model.set({name:t})}))}render(){return d.createElement("div",{className:"assembly-finalize u-small-spacing-left"},d.createElement("div",null,d.createElement("div",{className:"input-group u-small-spacing-bottom"},d.createElement("input",_extends({type:"text",placeholder:"Assembly Name",value:this.props.model.name(),onChange:this.setName,className:"u-small-spacing-bottom"},(0,ee.Z)({component:"FinalizeWrapper",element:"input"}))),d.createElement("div",{className:f()({buttonGroup:null!=this.props.toggleParameters})},d.createElement(P.ZP,{title:"Delete Assembly",container:".assembly-finalize"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.props.deleteAssembly,icon:"format-delete"})),d.createElement(P.ZP,{title:"Enzyme / Primer Settings",container:".assembly-finalize"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.props.toggleParameters,className:f()({"is-active":this.props.showParameters,invisible:null==this.props.toggleParameters}),icon:"settings"})),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,disabled:!this.props.model.canCreate()||0===this.props.model.name().length,onClick:this.handleClickAssemble,text:"Assemble",dataTestAttrs:{component:"FinalizeWrapper",element:"assembleButton"}})))),this.props.children)}}_defineProperty(FinalizeWrapper,"propTypes",{toggleParameters:J().func,showParameters:J().bool.isRequired,model:J().object.isRequired,createAssembly:J().func.isRequired,deleteAssembly:J().func.isRequired,children:J().node})
const DigestFinalize=e=>d.createElement(FinalizeWrapper,l.default.extend({},e,{toggleParameters:null})),oe={tmAnneal:{number:!0,nullable:!1},tmWhole:{number:!0,nullable:!1},tmDiff:{number:!0,nullable:!1},minOverlap:{number:!0,nullable:!1},maxOverlap:{number:!0,nullable:!1}},renderGibsonForm=({renderInput:e,parameterUpdater:t})=>d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(h.Z,null,d.createElement(p.Z,{sm:8},"Min T",d.createElement("sub",null,"m")," for primer's binding bases"),d.createElement(p.Z,{sm:4},e({key:"tmAnneal",onChange:t("tmAnneal",parseFloat)})," °C")),d.createElement(h.Z,null,d.createElement(p.Z,{sm:8},"Min T",d.createElement("sub",null,"m")," for whole primer"),d.createElement(p.Z,{sm:4},e({key:"tmWhole",onChange:t("tmWhole",parseFloat)})," °C"))),d.createElement(p.Z,{sm:6},d.createElement(h.Z,null,d.createElement(p.Z,{sm:8},"Max T",d.createElement("sub",null,"m")," diff for primer pairs"),d.createElement(p.Z,{sm:4},e({key:"tmDiff",onChange:t("tmDiff",parseFloat)})," °C")),d.createElement(h.Z,null,d.createElement(p.Z,{sm:8},"Length of homology/binding regions"),d.createElement(p.Z,{sm:4},e({key:"minOverlap",onChange:t("minOverlap",parseInt)})," - ",e({key:"maxOverlap",onChange:t("maxOverlap",parseInt)})," bp")))),GibsonFinalize=e=>d.createElement(UpdateParameterComponent,_extends({},e,{parameters:oe,renderParametersForm:renderGibsonForm}))
GibsonFinalize.propTypes=re
const le={preRecognitionSiteLength:{number:!0,nullable:!1},preRecognitionSiteBases:{number:!1,nullable:!0},bindingRegionMinTM:{number:!0,nullable:!1},bindingRegionMinLength:{number:!0,nullable:!1},primerPairMaxTMDiff:{number:!0,nullable:!1},enzymeID:{number:!0,nullable:!1}}
function GoldenGateFinalize(e){return d.createElement(UpdateParameterComponent,_extends({},e,{parameters:le,renderParametersForm:({renderInput:t,parameterUpdater:n,updateParameterByValue:a,localParameters:i})=>{let s
return d.createElement(h.Z,null,d.createElement(p.Z,{sm:4},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},"Pre-recognition site length"),d.createElement(p.Z,{sm:6},t({key:"preRecognitionSiteLength",onChange:t=>{const n=a("preRecognitionSiteLength",parseInt,t.target.value,{save:!1}),i=e.model.parameters().preRecognitionSiteBases
n&&0!==t.target.value.length&&n.preRecognitionSiteLength!==(null!=i?i.length:void 0)&&a("preRecognitionSiteBases",l.default.identity,"",{existingParams:n})}})," bp")),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},"Pre-recognition site bases ",d.createElement(A.Z,{renderContent:()=>"These bases will be included before the enzyme recognition site in each primer's overhang. If they are not specified, a random string of bases will be used.",placement:ne.ZH.TOP,icon:"circle-question"})),d.createElement(p.Z,{sm:6},t({key:"preRecognitionSiteBases",onChange:e=>{const t=y.sanitize(e.target.value,y.NucleotideType.DNA).toUpperCase(),n=a("preRecognitionSiteBases",l.default.identity,t,{save:!1})
n&&0!==t.length&&a("preRecognitionSiteLength",parseInt,t.length,{existingParams:n})}})))),d.createElement(p.Z,{sm:4},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},"Min T",d.createElement("sub",null,"m")," for binding region"),d.createElement(p.Z,{sm:6},t({key:"bindingRegionMinTM",onChange:n("bindingRegionMinTM",parseFloat)})," °C")),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},"Min length for binding region"),d.createElement(p.Z,{sm:6},t({key:"bindingRegionMinLength",onChange:n("bindingRegionMinLength",parseInt)})," bp"))),d.createElement(p.Z,{sm:4},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},"Max T",d.createElement("sub",null,"m")," diff for primer pairs"),d.createElement(p.Z,{sm:6},t({key:"primerPairMaxTMDiff",onChange:n("primerPairMaxTMDiff",parseFloat)})," °C")),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},"Type IIS Enzyme"),d.createElement(p.Z,{sm:6},d.createElement("select",{onChange:n("enzymeID",parseInt),value:i.enzymeID},(()=>{const e=[]
for(s of Array.from(ie))e.push(d.createElement("option",{value:s,key:`enzyme-choice-${s}`},se.get(s).get("name")))
return e})())))))}}))}GoldenGateFinalize.propTypes=_objectSpread(_objectSpread({},re),{},{model:J().object.isRequired})
const ce={for:function for_(e,t){const n=(()=>{switch(e.method()){case ae.DIGEST:return DigestFinalize
case ae.GIBSON:return GibsonFinalize
case ae.GOLDEN_GATE:return GoldenGateFinalize
default:throw new Error(`Unexpected assembly method: ${e.method()}`)}})()
return d.createElement(n,l.default.extend({model:e},t))}}
var de=n(675649),ue=n(755383),me=n(757389),pe=n(36424),he=n(317275)
const ge=function AssemblyErrorIndicator(e){const t=f()("assembly-error-indicator","assembly-check",{warning:e.warnings.length>0&&0===e.errors.length,error:e.errors.length>0,success:e.warnings.length+e.errors.length===0})
return d.createElement("div",{className:t},e.children)},{ASSEMBLY_TYPE:Ee}=b
function Message(e){return d.createElement("div",{...(0,ee.Z)({component:"AssemblyErrorsWarnings",element:"message"})},d.createElement("span",{className:"icon"},(()=>{switch(e.type){case"warning":return d.createElement("img",{src:(0,me.Z)("/static/img/warning.png")})
case"success":return d.createElement(pe.Z,{icon:"check"})
case"error":return d.createElement(pe.Z,{icon:"ban"})
default:return null}})())," ",e.message)}function Messages(e){return d.createElement("div",{className:"messages selectable"},Array.from(e.errors).map((e=>d.createElement(Message,{type:"error",message:e,key:l.default.uniqueId("error_")}))),Array.from(e.warnings).map((e=>d.createElement(Message,{type:"warning",message:e,key:l.default.uniqueId("warning_")}))),e.errors.length+e.warnings.length===0?d.createElement(Message,{type:"success",message:"Looks like everything checks out"}):void 0)}const fe=function AssemblyErrorsWarnings(e){let t
null==e.title?t=`${e.errors.length} ${(0,de._6)(e.errors.length,"error")} and ${e.warnings.length} ${(0,de._6)(e.warnings.length,"warning")}`:({title:t}=e)
return d.createElement(ge,{...(0,he.Z)(e,"warnings","errors")},d.createElement("h4",null,t,e.method===Ee.GOLDEN_GATE?d.createElement("a",{className:"glyphicon glyphicon-question-sign u-no-text-decoration u-small-text     u-tiny-spacing-left",onClick:ue.Dm}):void 0),d.createElement(Messages,{warnings:e.warnings,errors:e.errors}),e.children)}
class ActionZone extends d.Component{constructor(){super(...arguments)
this.state={showParameters:!1}
this.toggleParameters=()=>{this.setState({showParameters:!this.state.showParameters})}}render(){return d.createElement(h.Z,null,d.createElement(p.Z,{sm:5,className:"js-fragment-info-wrapper u-small-spacing-bottom"},null!=this.props.activeSlot?d.createElement(W,{activeSlot:this.props.activeSlot,assembly:this.props.assembly,cutsites:this.props.cutsites,enzyme:this.props.assembly.enzyme(),selection:this.props.selection,sequence:this.props.sequence,toggleParameters:this.toggleParameters}):d.createElement("div",null,d.createElement("h4",null,"Set Fragment"),d.createElement("div",{className:"faded u-small-spacing-top"},"Select an assembly fragment below."))),d.createElement(p.Z,{sm:7,className:"assembly-settings-col"},d.createElement("div",{className:"pull-right"},ce.for(this.props.assembly,{updateParameters:this.props.updateParameters,createAssembly:this.props.createAssembly,deleteAssembly:this.props.deleteAssembly,showParameters:this.state.showParameters,toggleParameters:this.toggleParameters})),d.createElement(fe,{title:"Overall Assembly",errors:this.props.errors,warnings:this.props.warnings,method:this.props.assembly.method()})))}}const Se=ActionZone
var ye=n(901369),be=n(659680)
const Te=(0,be.Z)((function SimpleSlot({empty:e,end:t,enzymes:n,index:a,length:i,name:s,reverse:r,seqLength:o,slotName:l,spacer:c,start:u,startIndex:m}){return d.createElement("div",{className:"assembly-slot assembly-slot-single",...(0,ee.Z)({component:"SimpleSlot",element:"root",index:`${a}`})},e?c?d.createElement("div",{className:"step-container slot-activator has-spacer"},d.createElement("div",{className:"name"},l),d.createElement("div",{className:"supplementary"},c.length," bp")):d.createElement("div",{className:"step-container slot-activator"},d.createElement("div",{className:"name"},l)):d.createElement("div",{className:"step-container slot-activator sequence-set"},d.createElement("div",{title:s,className:"name"},d.createElement("span",{className:"type all-caps"},0===a?"backbone":"insert"),s),null==n?d.createElement("div",{className:"supplementary"},y.formatBaseCount(i)," ⋅ ",T.modelStartToDisplay(u,m)," to ",T.modelEndToDisplay(t,o,m),r&&" (rev)"):r?d.createElement("div",{className:"supplementary"},y.formatBaseCount(i)," ⋅"," ",d.createElement("span",{style:{color:n[1].color}},n[1].name),","," ",d.createElement("span",{style:{color:n[0].color}},n[0].name)):d.createElement("div",{className:"supplementary"},y.formatBaseCount(i)," ⋅"," ",d.createElement("span",{style:{color:n[0].color}},n[0].name),","," ",d.createElement("span",{style:{color:n[1].color}},n[1].name))),d.createElement("div",{className:"assembly-slot-options"},d.createElement("div",{className:"buttonGroup dropup"},d.createElement("button",{type:"button","data-toggle":"tooltip","data-placement":"top",title:"Move Left",className:"button button--small button--tertiaryGray js-shift-left"},d.createElement("span",{className:"glyphicon glyphicon-chevron-left"})),d.createElement("button",{type:"button","data-toggle":"tooltip","data-placement":"top",title:"Move Right",className:"button button--small button--tertiaryGray js-shift-right"},d.createElement("span",{className:"glyphicon glyphicon-chevron-right"})),d.createElement("div",{"data-toggle":"tooltip",title:"Remove",className:"buttonGroup"},d.createElement("button",{type:"button",className:"button button--small button--tertiaryGray js-delete u-danger-color"},d.createElement("span",{className:"glyphicon glyphicon-ban-circle"}))),d.createElement("button",{type:"button","data-toggle":"tooltip",title:"Add Spacer After",className:"button button--small button--tertiaryGray js-insert-spacer"},d.createElement("span",{className:"glyphicon glyphicon-sound-stereo"})))))}))
var ve=n(699418)
class SingleFragmentSlotView extends s().View{static initClass(){this.prototype.tagName="li"
this.prototype.fileStates=ve.ZP.get()}events(){return{"click .js-delete":"deleteSlot","click .js-shift-left":"shiftLeft","click .js-shift-right":"shiftRight","click .js-insert-spacer":"insertSpacer"}}initialize(e){this.isRemoved=!1
this.listeningSequences=[]
this.listenTo(this.model,"change:active slotChange",this.render)
this.listenTo(this.fileStates,"reset add remove",this.listenToSequences)
this.listenTo(this.model.fragments(),"add remove change:sequenceID",this.listenToSequences)
this.listenToSequences()}listenToSequences(){if(!this.isRemoved){for(var e of Array.from(this.listeningSequences))this.stopListening(e)
this.listeningSequences=l.default.compact(this.model.fragments().map((t=>{if(null==(e=function SingleFragmentSlotView_guard_(e,t){return null!=e?t(e):void 0}(t.getSequence(),(e=>e.get("_sequence")))))return null
this.listenTo(e,"change:bases change:circular",(()=>{t.stopListening()
t.destroy({error(){(0,S.Gp)(!1,"fragment.destroy() failed")}})}))
return e})))}}shiftLeft(){this.model.shiftLeft()}shiftRight(){this.model.shiftRight()}insertSpacer(){const e=this.model.index()+1
this.model.collection.addSlot({name:"",spacer:""},e)}deleteSlot(){this.$(".js-delete").hasClass("is-disabled")||this.model.destroy()}toggleDelete(){const e=!this.model.isSpacer()&&0===this.model.index()
this.$(".js-delete").toggleClass("is-disabled",e)}updateSequence(e){null!=this.selection&&this.stopListening(this.selection)
this.sequence=e
this.selection=null!=e?e.get("selection"):void 0}remove(){this.isRemoved=!0
this.$('[data-toggle="tooltip"]').tooltip("destroy")
return super.remove()}}SingleFragmentSlotView.initClass()
const Ce=SingleFragmentSlotView
class SimpleSlotView extends Ce{static initClass(){this.prototype.template=Te}updateSequence(e){super.updateSequence(e)
null!=this.selection&&this.listenTo(this.selection,"change",this.updateToolbar)
this.updateToolbar()}toggleActive(){this.$el.toggleClass("active",this.model.active())
this.$(".assembly-slot-options").toggleClass("options-visible",this.model.active())}updateToolbar(){this.$(".js-shift-left, .js-shift-right").toggleClass("hidden",0===this.model.index())
const e=1===this.model.index()
this.$(".js-shift-left").toggleClass("disabled",e).attr({disabled:e})
const t=this.model.index()===this.model.collection.length-1
this.$(".js-shift-right").toggleClass("disabled",t).attr({disabled:t})
this.$('[data-toggle="tooltip"]').tooltip({container:"body"})}render(){this.$('[data-toggle="tooltip"]').tooltip("destroy")
const e=this.model.isEmpty()?null:this.model.singleFragment()
let t={index:this.model.index(),active:this.model.active(),empty:this.model.isEmpty(),slotName:this.model.displayName(),spacer:this.model.spacer()}
if(!this.model.isEmpty()){const n=e.getSequence().length()
t=l.default.extend(t,{name:e.sequenceMetadata().name,start:e.start(),end:e.end(),reverse:e.reverse(),seqLength:n,startIndex:e.getSequence().startIndex(),length:T.length(e.start(),e.end(),n),sequtil:T,util:y,enzymes:e.getEnzymes()})}this.$el.html(this.template(t))
this.toggleActive()
this.updateToolbar()
this.toggleDelete()
return this}}SimpleSlotView.initClass()
const Ie=SimpleSlotView
const we=class GibsonSlotView extends Ie{}
const Ne=class GoldenGateSlotView extends Ie{}
var Ae=n(85758),Re=n.n(Ae)
const Pe=(0,be.Z)((function Slot({active:e,empty:t,enzymes:n,length:a,name:i,reverse:s,slotName:r}){return t?d.createElement(d.Fragment,null,d.createElement("div",{className:"assembly-slot assembly-slot-single"},d.createElement("div",{className:"slot-activator step-container"},d.createElement("div",{className:"name"},r))),e&&d.createElement("div",{className:"assembly-step u-overflow-x-hidden"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-4 preview-container"},d.createElement("h4",null,"Preview"),d.createElement("div",{className:"preview"})),d.createElement("div",{className:"col col-lg-6 col-sm-5 text-center"},d.createElement("div",{className:"blank-msg"},d.createElement("div",{className:"blank-msg-inner"},"Shift select two enzymes on the sequence map or run a digest and select a fragment."))),d.createElement("div",{className:"col col-lg-2 col-sm-3"},d.createElement("div",{className:"buttonGroup pull-right u-small-spacing-right"},d.createElement("div",{className:"blank-msg"},d.createElement("div",{className:"blank-msg-inner"},d.createElement("button",{type:"button",className:"button button--mini button--secondary set"},"Set from Selection"),d.createElement("button",{type:"button",className:"button button--mini button--tertiaryGray js-delete"},d.createElement("span",{className:"glyphicon glyphicon-trash"}))))))))):d.createElement(d.Fragment,null,d.createElement("div",{className:"assembly-slot assembly-slot-single"},d.createElement("div",{className:"slot-activator step-container sequence-set"},d.createElement("div",{className:"name"},i),s?d.createElement("div",{className:"supplementary"},y.formatBaseCount(a)," ⋅"," ",d.createElement("span",{style:{color:n[1].color}},n[1].name),","," ",d.createElement("span",{style:{color:n[0].color}},n[0].name)):d.createElement("div",{className:"supplementary"},y.formatBaseCount(a)," ⋅"," ",d.createElement("span",{style:{color:n[0].color}},n[0].name),","," ",d.createElement("span",{style:{color:n[1].color}},n[1].name)))),e&&d.createElement("div",{className:"assembly-step sequence-set u-overflow-x-hidden"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-5 preview-container"},d.createElement("h4",null,"Preview"),d.createElement("div",{className:"preview"})),d.createElement("div",{className:"col col-sm-4 assembly-check-mount"}),d.createElement("div",{className:"col col-sm-3 step-controls u-lr-split"},d.createElement("div",{className:"links"},d.createElement("div",null,d.createElement("a",{className:"js-flip"},"Reverse Orientation")),d.createElement("div",null,d.createElement("a",{className:"js-jump"},"Jump to Selection")),d.createElement("div",{className:"buffers"})),d.createElement("div",{className:"buttonGroup buttonGroup--vertical step-options clear-offset"},d.createElement("button",{type:"button","data-toggle":"tooltip","data-placement":"left",title:"Done",className:"button button--small button--primary js-done"},d.createElement("span",{className:"fa fa-check"})),d.createElement("button",{type:"button","data-toggle":"tooltip","data-placement":"left",title:"Reset",className:"button button--small button--tertiaryGray js-reset"},d.createElement("span",{className:"glyphicon glyphicon-ban-circle"})),d.createElement("button",{type:"button","data-toggle":"tooltip","data-placement":"left",title:"Delete",className:"button button--small button--tertiaryGray js-delete"},d.createElement("span",{className:"glyphicon glyphicon-trash"})))))))}))
var Oe=n(686836),xe=n(279785)
class EnzymeActivityTable extends d.Component{render(){let e
const{provider:t,small:n,enzymes:a}=this.props,i=t.buffers.filter((e=>a.some((n=>null!=(null!=n.providedEnzymes[t.name]?n.providedEnzymes[t.name].activities[e]:void 0))))),s=xe.yX(a.map((e=>e.id)),t.name)
return d.createElement("table",{className:"table table-condensed enzymes-table"},d.createElement("colgroup",null,d.createElement("col",null),n?void 0:[d.createElement("col",{key:"cuts-col"}),d.createElement("col",{key:"temp-col"})],(()=>{const t=[]
for(e of Array.from(i))t.push(d.createElement("col",{key:`${e}-col`,className:f()({success:Array.from(s).includes(e)})}))
return t})()),d.createElement("thead",{className:f()({"u-small-text":this.props.small})},d.createElement("tr",null,d.createElement("th",null,"Enzymes"),n?void 0:[d.createElement("th",{key:"cuts-th"},"Cuts"),d.createElement("th",{key:"temp-th"},"Temp.")],(()=>{const t=[]
for(e of Array.from(i))t.push(d.createElement("th",{key:`${e}-th`},xe.Dc(e)))
return t})())),d.createElement("tbody",null,a.map((e=>{const a=e.providedEnzymes[t.name]
return d.createElement("tr",{key:e.id,className:f()({faded:!(t.name in e.providedEnzymes)})},d.createElement("td",null,e.name),n?void 0:[d.createElement("td",{key:"cuts-td"},e.cutPositions.length),d.createElement("td",{key:"temp-td"},null!=(null!=a?a.incubationTemperature:void 0)?`${a.incubationTemperature}°C`:"—")],null!=a?i.map((e=>d.createElement("td",{key:e},null!=a.activities[e]?a.activities[e]:"—"))):d.createElement("td",{colSpan:i.length},"Not available for this vendor"))}))))}}EnzymeActivityTable.defaultProps={small:!1}
const _e=EnzymeActivityTable
var De=n(666571)
class EnzymeProviderSelector extends d.Component{constructor(){super(...arguments)
this.providerSelectHandler=e=>{(0,S.hu)(null!=this.props.onChange,"must provide onChange")
let t=xe.fW(e.target.value)
if(!Array.from(this.props.providers).includes(t)){(0,S.hu)(null!=t.subProvider&&Array.from(this.props.providers).includes(t.subProvider),`${t.name} does not have a subProvider in [${this.props.providers.map((e=>e.name))}]`)
t=t.subProvider}this.props.onChange(t)}
this.subproviderToggleHandler=e=>{(0,S.hu)(null!=this.props.onChange,"must provide onChange")
const t=xe.fW(this.props.value.name),n=e.target.checked?t.subProvider:t;(0,S.hu)(null!=n,"expected provider to exist")
this.props.onChange(n)}
this.renderSubProviderChooser=()=>{let e
const t=this.props.value,n=xe.fW(t.name),a=null==this.props.onChange,i=n.subProvider
if(null==i)return null
let s=!1
Array.from(this.props.providers).includes(i)?Array.from(this.props.providers).includes(n)?a?e="read-only":s=!0:e=`Only ${i.shortName} version of the enzyme exists`:e=`No ${i.shortName} version of the enzyme exists`
const r=d.createElement("label",{className:f()({"u-tiny-spacing-top":!this.props.inline,"u-small-spacing-left":this.props.inline&&!this.props.small,"u-tiny-spacing-left":this.props.inline&&this.props.small,"u-no-spacing-bottom":!this.props.small,"u-tiny-spacing-bottom":this.props.small})},d.createElement("input",{type:"checkbox",className:"u-valign-text-bottom",checked:i===t,disabled:!s,onChange:this.subproviderToggleHandler}),d.createElement("span",{className:f()("u-valign-middle",{faded:!s})},`Use ${i.shortName} `),d.createElement("a",{className:"faded u-valign-middle",href:i.infoLink,target:"_blank",rel:"noopener noreferrer"},d.createElement(De.Z,null)))
return s?r:d.createElement(P.ZP,{title:e,placement:P.TQ.BOTTOM,container:"body",delay:{show:500}},r)}}render(){const e=l.default.groupBy(this.props.providers,(e=>xe.fW(e.name).name)),t=null==this.props.onChange,n=xe.fW(this.props.value.name)
return d.createElement("div",{className:f()({"u-small-text":this.props.small})},d.createElement("select",{className:f()({"u-width-auto":this.props.inline}),style:this.props.small?{height:20}:void 0,value:n.name,onChange:this.providerSelectHandler,disabled:t},te.ZP.baseProviders.filter((t=>t.name in e)).map((({name:e})=>d.createElement("option",{value:e,key:e},e)))),this.renderSubProviderChooser())}}EnzymeProviderSelector.defaultProps={inline:!1,small:!1}
const Le=EnzymeProviderSelector
class EnzymeActivityTableWithProviderSelector extends d.Component{render(){return d.createElement("div",{className:"u-tiny-spacing-top u-small-text"},d.createElement("div",{className:f()({"pull-right":this.props.pullSelectorRight})},d.createElement(Le,{providers:this.props.providers,value:this.props.provider,onChange:this.props.onChangeProvider,small:this.props.small,inline:!0})),d.createElement(_e,{enzymes:this.props.enzymes,provider:this.props.provider,small:this.props.small}))}}EnzymeActivityTableWithProviderSelector.defaultProps={pullSelectorRight:!1}
const ke=EnzymeActivityTableWithProviderSelector
function EnzymeActivityPopoverLink(e){return d.createElement(Oe.Z,{renderContent:()=>d.createElement(ke,{provider:e.provider,onChangeProvider:e.onChangeProvider,providers:e.providers,enzymes:e.enzymes,pullSelectorRight:!0,small:!0}),placement:ne.ZH.LEFT,interaction:ne.x2.CLICK},d.createElement("a",null,"View Enzyme Activity"))}var Me=n(676276),Fe=n(260929)
const{ASSEMBLY_TYPE:Ze}=b
class RestrictionSlotView extends Ce{static initClass(){this.prototype.template=Pe}events(){return l.default.extend(super.events(),{"click .js-done":"done","click .js-reset":"reset","click .set":"set","click .js-jump":"jump","click .js-flip":"flip"})}initialize(e){this.setProvider=this.setProvider.bind(this)
super.initialize(...arguments)
this.assembly=e.assembly
this.listenTo(this.model,"change:errors change:warnings",this.updateWarnings)
this.listenTo(this.model.fragments(),"add remove change",this.updatePreview)
this.listenTo(this.assembly,"change:provider",this.updateBuffers)}done(){this.model.set({active:!1})}jump(){const e=this.model.singleFragment()
this.fileStates.selectFragment(e.getSequence(),this.model.get("sequenceFragment"))}flip(){this.model.setSingleFragment({reverse:!this.model.singleFragment().reverse()})}reset(){this.model.singleFragment().destroy()}shouldSetFromSelectionBeDisabled(){const e=null!=this.cutsites?this.cutsites.where({selected:!0}):[],t=null!=this.selection&&this.selection.start()===this.selection.end()?1:2
return null==this.selection||!this.selection.canDigest()||e.length<t}set(){if(this.shouldSetFromSelectionBeDisabled())return
const e=this.selection.getStartState("cutsite"),t=this.selection.getEndState("cutsite")
if(null==e||null==t){v.ZP.warn("Please recreate your selection by shift-selecting cut sites.")
Fe.ZK("Restriction assembly wizard had invalid selection.")
this.selection.reset(this.selection.start())
return}const n=this.selection.getStartState("cutsite").get("enzyme"),a=this.selection.getEndState("cutsite").get("enzyme")
n.set({active:!0})
a.set({active:!0})
const i=this.selection.start(),s=T.mod(this.selection.end(),this.sequence.length())
this.model.setSingleFragment({sequenceID:this.sequence.id,sequenceMetadata:{name:this.sequence.name()},name:this.sequence.name(),start:i,end:s,startEnzymeID:n.id,endEnzymeID:a.id,reverse:!1}).fail(v.ZP.notifyError)}updatePreview(){let e,t,n,a
const i=[[{fragment:this.model.get("prevFragment"),side:"right",className:".prev-preview",matched:this.model.get("prevMatched")},{fragment:this.model.get("thisFragment"),side:"left",className:".this-left-preview",matched:this.model.get("prevMatched")}],[{fragment:this.model.get("thisFragment"),side:"right",className:".this-right-preview",matched:this.model.get("nextMatched")},{fragment:this.model.get("nextFragment"),side:"left",className:".next-preview",matched:this.model.get("nextMatched")}]],s=[]
let r=0
function getBases(e){let t,n,a
if(null==e.fragment)return null
const i=e.fragment.bases(),{length:s}=i,spaces=e=>function RestrictionSlotView_range_(e,t,n){const a=[],i=e<t,s=n?i?t+1:t-1:t
for(let t=e;i?t<s:t>s;i?t++:t--)a.push(t)
return a}(0,e,!1).map((e=>" ")).join("")
if("right"===e.side){n=e.fragment.get("offset3")
a=i.slice(s-3-Math.abs(n))
t=y.complement(a,R.jb)
n<=0?t=t.slice(0,3)+spaces(Math.abs(n)):a=a.slice(0,3)+spaces(n)}else{n=e.fragment.get("offset5")
a=i.slice(0,3+Math.abs(n))
t=y.complement(a,R.jb)
n>=0?t=spaces(n)+t.slice(n):a=spaces(n)+a.slice(Math.abs(n))}return[a,t]}for(let l=0;l<i.length;l++){var o
const c=i[l];[n,e]=Array.from(c)
const d=getBases(n),u=getBases(e);({matched:t}=n)
const m=0
a=0
if(null!=d&&null!=u){const t=n.fragment.get("offset3"),i=(n.fragment.get("offset5"),e.fragment.get("offset3"),e.fragment.get("offset5"))
if(t>0&&i>0){a=d[0].trim().length
t>i&&(a+=t-i)}else if(t<0&&i<0){a=d[1].trim().length
t<i&&(a-=t+i)}else a=Math.max(d[0].trim().length,d[1].trim().length)}o=null!=d&&null!=u?a+Math.max(u[1].trim().length,u[0].trim().length):null!=d?Math.max(d[0].length,d[1].length):null!=u?Math.max(u[0].length,u[1].length):0
const p={right:d,left:u,x1:m,x2:a,matched:t,width:o}
r+=o
s.push(p)}if(s.length>0){s[0].dx=0
s[1].dx=s[0].width}this.$(".preview").empty()
let l=23
l=22
const c=(392-11*r-22)/2
let d=Re().select(this.el).select("div.preview").append("svg:svg").attr("xmlns","http://www.w3.org/2000/svg").append("svg:g").attr("transform",`translate(${c}, 15)`).classed("mono",!0)
d=d.selectAll("g").data(s)
d.enter().append("svg:g").attr("transform",((e,t)=>e.dx>0?`translate(${11*e.dx+22})`:"translate(0,0)")).each((function(t,a){if(null!=t.right){n=Re().select(this).append("svg:g")
n=n.append("svg:text").classed("side",0===a).classed("mismatch",!t.matched&&1===a)
n.append("svg:tspan").attr("xml:space","preserve").text(t.right[0])
n.append("svg:tspan").attr("xml:space","preserve").text(t.right[1]).attr("x",0).attr("y",22)}if(null!=t.left){e=Re().select(this).append("svg:g").attr("transform",`translate(${11*t.x2})`)
e=e.append("svg:text").classed("side",1===a).classed("mismatch",!t.matched&&0===a)
e.append("svg:tspan").attr("xml:space","preserve").text(t.left[0])
e.append("svg:tspan").attr("xml:space","preserve").text(t.left[1]).attr("x",0).attr("dy",22)}}))
d.exit().remove()}updateWarnings(){const e=this.$(".assembly-check-mount")
if(0===e.length)return
const t=d.createElement(fe,{warnings:this.model.warnings(),errors:this.model.errors(),method:Ze.DIGEST});(0,Me.A9)(t,e[0])}setProvider(e){this.assembly.set({provider:e.name})}updateBuffers(){if(this.model.isEmpty()||!this.model.active())return
const e=this.model.singleFragment(),t=e.getSequence().get("enzymes"),n=e.enzymeIDs(),a=xe.Aq(n),i=xe.p_(n,this.assembly.get("provider"));(0,Me.A9)(d.createElement(EnzymeActivityPopoverLink,{provider:i,onChangeProvider:this.setProvider,providers:a,enzymes:t.getEnzymesJSON(n)}),this.$(".buffers")[0])}updateSequence(e){super.updateSequence(e)
null!=this.cutsites&&this.stopListening(this.cutsites)
this.cutsites=null!=e?e.get("cutsites"):void 0
null!=this.cutsites&&this.listenTo(this.cutsites,"change:selected",this.updateToolbar)
this.updateToolbar()}updateToolbar(){this.$(".set").toggleClass("is-disabled",this.shouldSetFromSelectionBeDisabled())
this.$(".js-jump, .js-flip").toggleClass("hidden",null==this.model.get("thisFragment"))
this.$('[data-toggle="tooltip"]').tooltip({container:"body"})}cleanUpOverlays(){this.$('[data-toggle="tooltip"]').tooltip("destroy")
null!=this.$(".buffers")[0]&&u.unmountComponentAtNode(this.$(".buffers")[0])}remove(){this.cleanUpOverlays()
super.remove()}render(){this.cleanUpOverlays()
const e=this.model.isEmpty()?null:this.model.singleFragment()
let t={sequtil:T,util:y,active:this.model.active(),index:this.model.index(),empty:this.model.isEmpty(),slotName:this.model.displayName()}
this.model.isEmpty()||(t=l.default.extend(t,{reverse:e.reverse(),start:e.start(),end:e.end(),name:e.sequenceMetadata().name,length:e.length(),enzymes:e.getEnzymes()}))
this.$el.html(this.template(t))
this.$el.toggleClass("active",this.model.active())
this.updateToolbar()
this.updateWarnings()
this.updatePreview()
this.updateBuffers()
this.toggleDelete()
return this}}RestrictionSlotView.initClass()
const Be=RestrictionSlotView
const qe=class SpacerSlotView extends Ie{render(){super.render()
this.$(".assembly-slot-options .set").remove()
this.$(".assembly-slot").addClass("assembly-slot-spacer")
return this}}
const Ve=(0,be.Z)((function SingleFragmentAssembly(){return d.createElement(d.Fragment,null,d.createElement("div",{className:"assembly-navbar navbar"},d.createElement("button",{type:"button",className:"button button--small button--tertiaryGray pull-right u-small-spacing-left show-preview"},"Hide Preview"),d.createElement("div",{className:"add-fragment pull-right"},d.createElement("button",{type:"button",className:"button button--small button--tertiaryGray js-add"},d.createElement("span",{className:"glyphicon glyphicon-plus"}))),d.createElement("ul",{className:"nav navbar-nav"})),d.createElement("div",{className:"construct"},d.createElement("div",{className:"info active"},d.createElement("div",{className:"assembly-step sequence-set"},d.createElement("div",{className:"action-zone-mount"})))))}))
var Ue=n(812651),Ge=n(773055),ze=n(518352),$e=n(87209),We=n(432128),He=n(20835),je=n(685370),Ye=n(204026),Qe=n(390462),Ke=n(102176),Je=n(929123),Xe=n(629656),et=n(205986)
const tt="AssemblyFolderModal"
class AssemblyFolderModal extends d.Component{constructor(){super(...arguments)
this.state={sequenceFolderId:Qe.Z.get(Qe.O.INVENTORY),oligoFolderId:Qe.Z.get(Qe.O.OLIGO),creating:!1}
this._handleChangeSequenceFolder=e=>{this.setState({sequenceFolderId:e.target.value})}
this._handleChangeOligoFolder=e=>{this.setState({oligoFolderId:e.target.value})}
this.handleSubmit=()=>{this.setState({creating:!0})
this.props.createSequence(this.state.sequenceFolderId,this.state.oligoFolderId).done((()=>{Qe.Z.set(Qe.O.INVENTORY,this.state.sequenceFolderId)
Qe.Z.set(Qe.O.OLIGO,this.state.oligoFolderId)
this.props.onRequestClose()})).fail((e=>{v.ZP.notifyError(e)
this.setState({creating:!1})}))}}static open(e){Xe.bA(tt,d.createElement(AssemblyFolderModal,{...l.default.extend(e,{onRequestClose(){Xe.xv(tt)}})}))}render(){const e=null==this.state.sequenceFolderId||null==this.state.oligoFolderId||this.state.creating
return d.createElement(et.ZP,{enableRedesign:!1,title:"Select Folders for Assembly",onRequestClose:this.props.onRequestClose,onRequestSubmit:this.handleSubmit,buttons:[{text:"Create",submit:!0,style:"success",disabled:e,dataTestAttrs:{component:"AssemblyFolderModal",element:"createButton"}},{text:"Cancel",cancel:!0,disabled:this.state.creating}],dataTestAttrs:{component:"AssemblyFolderModal",element:"root"}},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Sequence Folder"),d.createElement(Ye.Z,{showInventory:!0,value:this.state.sequenceFolderId,onChange:this._handleChangeSequenceFolder,dataTestAttrs:{component:"AssemblyFolderModal",element:"sequenceFolderSelector"},unsetOnFetchFail:!0}))),d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Primer Folder"),d.createElement(Ye.Z,{showInventory:!0,value:this.state.oligoFolderId,onChange:this._handleChangeOligoFolder,dataTestAttrs:{component:"AssemblyFolderModal",element:"primerFolderSelector"},unsetOnFetchFail:!0})))))}}const nt=AssemblyFolderModal,{ASSEMBLY_TYPE:at}=b
class SingleFragmentWizard extends s().View{static initClass(){this.prototype.template=Ve
this.prototype.className="assembly-wizard"
this.prototype.events={"click .js-add":"add","click .show-preview":"activateInfo","click .js-adjust-params":"adjustParams","click .slot-activator":"activate"}
this.prototype.slotTypes=l.default.object([[at.DIGEST,Be],[at.GIBSON,we],[at.GOLDEN_GATE,Ne]])}initialize(e){this.listenTo(this.model,"resize",this.toggle)
this.slotViews=[]
this.sequences=ve.ZP.get()
this.sequence=e.sequence
this.slots=this.model.slots()
this.listenTo(this.slots,"remove",this.updateSlots)
this.listenTo(this.slots,"add",(function(){this.updateSlots()
this.scrollSlotsRight()}))
this.listenTo(this.model,"change:name change:errors change:warnings",this.renderActionZone)
this.listenTo(this.slots,"change:active slotChange",this.renderActionZone)}activate(e){const t=o()(e.currentTarget).closest("li"),n=this.slots.at(t.parent().children("li").index(t))
if(n.active())n.set({active:!1})
else{this.slots.each((e=>{e.set({active:e===n})}))
if(this.model.method()===at.DIGEST){this.$(".show-preview").html("Hide Preview")
this.$(".info").addClass("active")}}this.toggle()}activateInfo(e){const t=o()(e.currentTarget),n=this.$(".info")
if(n.hasClass("active")){t.html("Show Preview")
n.removeClass("active")
this.model.method()===at.DIGEST&&this.slots.each((e=>e.set({active:!1})))}else{t.html("Hide Preview")
n.addClass("active")}this.toggle()}add(){m.j("assembly","add_insert",{product:j.XC.MOLBIO,assemblyMethod:this.model.method()})
const e=this.$(".js-add")
e.prop("disabled",!0)
this.model.slots().addSlot({}).always((()=>{e.prop("disabled",!1)}))}scrollSlotsRight(){const e=this.$(".navbar-nav")
e.scrollLeft(e[0].scrollWidth)}updateSequence(e){null!=this.sequence&&this.stopListening(this.sequence._sequence())
null!=this.selection&&this.stopListening(this.selection)
null!=this.cutsites&&this.stopListening(this.cutsites)
this.sequence=e
for(const e of Array.from(this.slotViews))e.updateSequence(this.sequence)
if(null!=this.sequence){this.selection=this.sequence.selection()
this.listenTo(this.sequence._sequence(),"change:startIndex",this.renderActionZone)
this.listenTo(this.selection,"change:start change:end change:startState change:endState",this.renderActionZone)
this.cutsites=this.sequence.get("cutsites")
this.listenTo(this.cutsites,"cutsitesChanged",this.renderActionZone)}else{this.selection=null
this.cutsites=null}this.renderActionZone()}renderActionZone(){let e,t
t=null!=(null!=this.selection?this.selection.start():void 0)||null!=(null!=this.selection?this.selection.end():void 0)?{start:this.selection.start(),end:this.selection.end(),cutStart:this.selection.getStartState("cutsite"),cutEnd:this.selection.getEndState("cutsite")}:null
e=null==this.sequence||this.model.method()!==at.GOLDEN_GATE?[]:this.sequence._sequence().getCuts(this.model.enzyme().toJSON())
const n=d.createElement(Se,{activeSlot:this.slots.findWhere({active:!0}),assembly:this.model,cutsites:e,createAssembly:this.create.bind(this),deleteAssembly:this.deleteAssembly.bind(this),errors:this.model.errors(),selection:t,sequence:this.sequence,updateParameters:this.updateParameters.bind(this),warnings:this.model.warnings()});(0,Me.A9)(n,this.$(".action-zone-mount")[0])}updateParameters(e){this.model.set({parameters:e})
We.Z.set(this.model.method(),e)
this.renderActionZone()}deleteAssembly(){if(this.model.get("slots").any((e=>!e.isEmpty()))){const e="Are you sure you want to delete the assembly? It cannot be recovered."
je.iG("Delete Assembly",e,"danger").done((()=>this.model.destroy()))}else this.model.destroy()}updateSlots(){const e=this.slotTypes[this.model.method()]
for(const e of Array.from(this.slotViews))e.remove()
this.slotViews=this.slots.map((t=>t.isSpacer()?new qe({model:t,assembly:this.model}):new e({model:t,assembly:this.model})))
null!=this.sequence&&this.updateSequence(this.sequence)
this.$(".navbar-nav").html(l.default.map(this.slotViews,(e=>e.render().el)))}toggle(){o()("#editor").addClass("has-assemblyWizard").toggleClass("has-assemblyWizard-info",this.$(".info").hasClass("active"))
o()(window).trigger("buffersResize")}trackCreateAssemblyFail(e){m.j("assembly","create_fail",{product:j.XC.MOLBIO,assemblyMethod:this.model.method(),error:e})}create(){let e,t,n,a,i
if(this.model.method()===at.GIBSON){({tmAnneal:n,tmWhole:i,tmDiff:a,minOverlap:t,maxOverlap:e}=this.model.parameters())
if(Number.isNaN(n)||Number.isNaN(i)||Number.isNaN(a)||Number.isNaN(t)||Number.isNaN(e)){const e="Please enter valid Gibson primer settings."
v.ZP.warn(e)
this.trackCreateAssemblyFail(e)
return}}$e.$Z()
l.default.delay((()=>{let s,r,o,c
const d={annotations:!0,notcontained:!0},rollbackAssembly=e=>{this.trackCreateAssemblyFail(e)
$e.Cp()
v.ZP.warn(e)},completeAssembly=(e,t)=>{e.set({name:this.model.name(),fragmentResults:new Ue.FragmentResultCollection(t)})
if(e.get("sequencePrimers").filter((e=>!e.get("skip"))).length){$e.Cp()
nt.open({createSequence:function createSequence(t,n){e.set({folder:t})
e.get("sequencePrimers").each((e=>{e.set({folder:n})}))
return e.save().then((()=>{ze.Z.invalidateFolderContents(t)
ze.Z.invalidateFolderContents(n)
return ve.ZP.get().openFolderItem(e.get("id"))}))}})}else{$e.Cp()
Ge.Sequence.saveAndOpenSequence(e)}m.j("assembly","create_success",{product:j.XC.MOLBIO,assemblyMethod:this.model.method()})
this.model.collection.remove(this.model)}
if(this.model.method()===at.GIBSON){o=l.default.map(this.slots.withoutSpacers(),(e=>{let t
const n=e.singleFragment(),a=n.getSequence()
if(null!=n.enzymeIDs())t=n.getSelectedFragmentFromSequence(a)
else{const e=n.start(),i=n.end()
t=a.get("_sequence").createFromIndices(e,i,d)}n.reverse()&&(t=t.cloneReverseComplement())
t.set({name:a.name()})
return t}))
s=ye.Z.gibson.designGibson(o,this.slots.getSpacers(),{tmAnneal:n,tmWhole:i,tmDiff:a,minOverlap:t,maxOverlap:e})
if(null==s){rollbackAssembly("No Gibson primers could be generated. Try **increasing the max TM diff** allowed between primer pairs or **lowering the min TM** required of primers.")
return}c=s.get("junctions")
r=l.default.map(this.slots.withoutSpacers(),((e,t)=>{const n=e.singleFragment(),[a,i]=Array.from(c[t])
return new Ue.FragmentResult({fragmentID:n.id,versionID:n.getSequence().getActiveVersionId(),pairIndex:null!=n.enzymeIDs()?void 0:t,start:a,end:i,originalBases:o[t].bases()})}))}else if(this.model.method()===at.GOLDEN_GATE){let e;[o,e]=Array.from(ye.Z.goldenGate.slotsToFragments(this.slots.withoutSpacers()))
ye.Z.goldenGate.designGoldenGate(o,e,this.slots.getSpacers(),l.default.clone(this.model.parameters())).progress((e=>{$e.t8(`designing... ${Math.round(e)}%`)})).done((e=>{$e.t8("loading...")
c=e.get("junctions")
r=l.default.map(this.slots.withoutSpacers(),((e,t)=>{const n=e.singleFragment(),[a,i]=Array.from(c[t])
return new Ue.FragmentResult({fragmentID:n.id,versionID:n.getSequence().getActiveVersionId(),start:a,end:i,pairIndex:null!=n.enzymeIDs()?void 0:t,originalBases:o[t].bases()})}))
completeAssembly(e,r)})).fail(rollbackAssembly)}else{if(this.model.method()!==at.DIGEST){const e=`Unexpected assembly type: ${this.model.method()}`
this.trackCreateAssemblyFail(e)
throw new Error(e)}{let e,t
s=null
let n=[]
for(const a of Array.from(this.slots.withoutSpacers())){var u,p
e=a.get("thisFragment")
const i=e.length()-Math.abs(e.get("offset3")),r=e.createFromIndices(0,i,d),o=null!=(u=null==(p=s)?void 0:p.length())?u:0
if(null!=s)s=s.concat(r)
else{t=e.get("offset5")
s=r}const l=s.length()
n.push([o,l])}s.set({circular:!0,offset5:0})
const a=this.slots.at(0).singleFragment()
let i=a.start()
t<0&&(i+=t)
i+=s.length()-a.getSequence().length()
if(0<=i&&i<s.length()){s.opReindex({current:0,desired:i})
const e=s.length()-i
n=n.map((([t,n])=>[(0,T.getReindexedPosition)(t,e,s.length()),(0,T.getReindexedPosition)(n,e,s.length())]))}r=l.default.map(this.slots.withoutSpacers(),((t,a)=>{e=t.singleFragment()
const i=e.getSequence()
return new Ue.FragmentResult({start:n[a][0],end:n[a][1],fragmentID:e.id,versionID:e.getSequence().getActiveVersionId(),originalBases:i.get("_sequence").residueSlice(e.start(),e.end())})}))}}this.model.method()!==at.GOLDEN_GATE&&completeAssembly(s,r)}),100)}render(){this.$el.html(this.template())
this.$(".info").addClass("active")
this.$(".show-preview").html("Hide Preview")
this.$('[data-toggle="tooltip"]').tooltip("destroy");(0,He.Z)(this.$el,{component:"SingleFragmentWizard",element:"root"})
this.updateSlots()
this.renderActionZone()
this.toggle()
return this}remove(){u.unmountComponentAtNode(this.$(".action-zone-mount")[0])
for(const e of Array.from(this.slotViews))e.remove()
return super.remove()}}SingleFragmentWizard.initClass()
const it=SingleFragmentWizard
var st=n(459830)
const{ASSEMBLY_TYPE:rt}=b,ot=ve.ZP.get(),{assemblies:lt}=c
class WizardContainer extends s().View{static initClass(){this.prototype.el="#assembly-wizard-container"
this.prototype.WIZARD_TYPES=l.default.object([[rt.DIGEST,it],[rt.GIBSON,it],[rt.GOLDEN_GATE,it]])}initialize(){this.view=null
this.listenTo(lt,"change:active change:slots add remove",this.updateAssembly)
this.listenTo(ot,"change:active add remove reset",this.updateAssembly)}hideWizard(){o()("#editor").removeClass("has-assemblyWizard").removeClass("has-assemblyWizard-info")
o()(window).trigger("buffersResize")
this.$el.addClass("hidden")}updateAssembly(){if(null!=this.view){this.view.remove()
this.view=null}const e=lt.findWhere({active:!0}),t=null!=ot.find((e=>e.active()&&e.fileType()===st.SEQUENCE))
if(null==e||!t){this.hideWizard()
return}const n=this.WIZARD_TYPES[e.method()]
this.view=new n({model:e,sequence:this.sequence})
this.$el.append(this.view.render().el)
this.$el.removeClass("hidden")
e.trigger("opened")}update(e){(null!=e?e.fileType():void 0)===st.SEQUENCE&&"oligo"!==e.model().type()?this.sequence=e.model():this.sequence=null
null!=this.view&&this.view.updateSequence(this.sequence)}}WizardContainer.initClass()
const ct=WizardContainer
var dt=n(348920),ut=n(298663)
class BufferViewLayout extends s().Model{defaults(){return{disableResize:!1,el:null,width:0,height:0,menu:!1}}resize(){if(!this.get("disableResize")){this.get("el").find(".buffer-tab-wrapper").width()!==this.get("width")&&this.set({width:this.get("el").find(".buffer-tab-wrapper").width()})
this.get("el").height()!==this.get("height")&&this.set({height:this.get("el").height()})}}}class BufferContentView extends s().View{static initClass(){this.prototype.className="hide"}initialize(e){this.model=new BufferViewLayout({el:this.$el,width:this.$el.find(".buffer-tab-wrapper").width(),height:this.$el.height()})
o()(window).on("resize",(0,de.Vx)((()=>{this.model.resize()})))
o()(window).on("buffersResize",(()=>{this.model.resize()}))}update(e,t){if(null!=this.tabView){this.tabView.remove()
this.tabView=null}if(null!=e){e.set({bufferViewLayout:this.model})
if(null==t)throw new Error("Instantiated TabState object has no associated TabView to show")
this.tabView=new t({model:e})
this.$el.toggleClass("buffer-options-align",e.get("options"))
this.$el.toggleClass("buffer-content--grey",e.get("greyTab"))
this.$el.find(".buffer-tab-wrapper").html(this.tabView.render().el)
"function"==typeof this.tabView.afterAttach&&this.tabView.afterAttach()
return this.model.resize()}}}BufferContentView.initClass()
function TabOptions({tabState:e,TabOptionsViewCls:t}){const n=(0,d.useRef)(null),a=(0,d.useRef)(null);(0,d.useLayoutEffect)((()=>{if(e&&t&&n.current){const i=new t({model:e})
o()(n.current).html(i.render().el)
a.current=i}return()=>{var e
null===(e=a.current)||void 0===e||e.remove()
a.current=null}}))
return d.createElement("div",{ref:n,className:"buffer-options buffer-options--builtin"})}function TabContent({tabState:e,TabContentViewCls:t}){const n=(0,d.useRef)(null),a=(0,d.useRef)(null),i=(0,d.useRef)(null),s=function useBufferViewLayout(e){const t=(0,d.useRef)(new BufferViewLayout),{height:n,width:a}=(0,ut.Z)({ref:e}),i=(0,d.useCallback)((()=>{(0,de.Vx)((()=>{t.current.resize()}))()}),[t]);(0,d.useLayoutEffect)((()=>{if(e.current){t.current.set({el:o()(e.current)})
t.current.resize()}}),[e]);(0,d.useLayoutEffect)((()=>{i()}),[i,n,a])
return t.current}(a);(0,d.useLayoutEffect)((()=>{if(e&&t&&n.current){e.set({bufferViewLayout:s})
const a=new t({model:e})
o()(n.current).html(a.render().el)
"function"==typeof a.afterAttach&&a.afterAttach()
i.current=a
s.resize()}return()=>{var e
null===(e=i.current)||void 0===e||e.remove()
i.current=null}}))
return d.createElement("div",{ref:a,className:f()("buffer-content",{"buffer-options-align":null==e?void 0:e.get("options"),"buffer-content-grey":null==e?void 0:e.get("greyTab")})},d.createElement("div",{className:"buffer"},d.createElement("div",{ref:n,className:"buffer-tab-wrapper"})))}const mt=d.memo((function BufferContentComponent({tabState:e,TabOptionsViewCls:t,TabContentViewCls:n}){return d.createElement("div",{className:"buffer-contentWrapper-reset"},d.createElement(TabOptions,{tabState:e,TabOptionsViewCls:t}),d.createElement(TabContent,{tabState:e,TabContentViewCls:n}))}))
var pt=n(446407)
const ht=(0,be.Z)((function BufferNavItem({closeable:e,title:t,inBeta:n}){return d.createElement("div",null,d.createElement("div",{className:"sectionTabs-navItem-title"},d.createElement("span",{className:"sectionTabs-navItem-title-inner"},t||"-")),n&&d.createElement("span",{className:"sectionTabs-navItem-title u-tiny-spacing-left"},d.createElement(pt.Z,{color:pt.J.GREEN},"beta")),e&&d.createElement("div",{className:"sectionTabs-navItem-closeBtn js-sectionTabs-close"}))}))
var gt=n(178570),Et=n(804921),ft=n(62955),St=n(659443),yt=n(882321),bt=n(709691),Tt=n(251658),vt=n(605998)
function AlignmentExport(e){const{alignmentApiId:t,analysisName:n,attachedFileCount:a,getClustalFormatData:i,getFastaFormatData:s,loaded:r,openPDFFormattedPreview:o,openPDFSnapshotPreview:l,selectionLength:c,sequenceEditURL:u}=e,p=`${window.location.origin}${u}?alignment=${t}`,h=(0,Tt.$y)(i()),g=(0,Tt.$y)(s())
return d.createElement("div",{className:"buttonGroup",...(0,ee.Z)({component:"AlignmentExport",element:"root"})},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,isDropdown:!0,className:"export",text:"Export",disabled:!r,dataTestAttrs:{component:"AlignmentExport",element:"exportButton"}}),d.createElement("ul",{className:"dropdown-menu export-menu pull-right"},d.createElement("li",null,d.createElement("a",{href:h,download:`${n}.clustal`,className:"clustal"},"Clustal")),d.createElement("li",null,d.createElement("a",{href:g,download:`${n}.fasta`,className:"fasta"},"FASTA")),d.createElement("li",{className:"divider"}),d.createElement("li",null,d.createElement("a",{...(0,ee.Z)({component:"AlignmentExport",element:"exportPDFSnapshotButton"}),onClick:()=>{l()},className:"pdf-snapshot"},"PDF - screen capture",c>0&&d.createElement("span",{className:"js-export-subregion"}," (selection)"))),d.createElement("li",null,d.createElement("a",{onClick:()=>{o()},className:"pdf-formatted"},"PDF - formatted")),a>0&&d.createElement(d.Fragment,null,d.createElement("li",{className:"divider"}),d.createElement("li",null,d.createElement("a",{onClick:()=>{(0,vt.exportSourceFiles)([t])}},"Source Files"))),d.createElement("li",{className:"divider"}),d.createElement("li",null,d.createElement("a",null,d.createElement(bt.Z,{notification:`Copied to clipboard: ${p}`,value:p,onClick:()=>{m.KK(j.Jg.COPIED_ALIGNMENT_URL,{residueType:yt.Q6.DNA})}},d.createElement("div",null,"Copy Link"))))))}function NameInput(e){const{allowFeatureEdits:t,analysisName:n,loaded:a,updateName:i}=e,[s,r]=(0,d.useState)(""),[o,l]=(0,d.useState)(!1);(0,d.useEffect)((()=>{n&&!o&&r(n)}),[n,o])
return d.createElement("form",{action:"#",className:"rename-form",onSubmit:e=>{e.preventDefault()
i(s)}},d.createElement("span",{className:"input-group"},d.createElement("input",{type:"text",className:"tab-name form-control",value:s,onChange:e=>{l(!0)
r(e.target.value)},disabled:!a||!t}),d.createElement("span",{className:"input-group-btn u-small-padding-left"},d.createElement("button",{type:"submit",className:"button button--tertiaryGray button--mini save",disabled:!t},"Rename"))))}function RealignButton({alignmentType:e,allowFeatureEdits:t,allowResidueEdits:n,loaded:a,openRealignModal:i,shouldRealign:s}){let r=!1
a&&(r=e===yt.Fl.CONSENSUS?n:t)
const o={buttonStyle:C.ZJ.SECONDARY,size:C.qE.MINI,className:"realign",onClick:()=>{i()},disabled:!r,text:"Realign",dataTestAttrs:{component:"AlignmentTabMenu",element:"realignButton"}}
if(s){const e=d.createElement("div",{style:{width:250,lineHeight:"18px"}},"Changes have been made to sequences that may warrant a realign.")
return d.createElement(Oe.Z,{placement:ne.ZH.BOTTOM,renderContent:()=>e},d.createElement(C.Co,{...o,icon:"star"}))}return d.createElement(C.Co,{...o})}var Ct,It=n(926025)
!function(e){e.IN_SYNC="IN_SYNC"
e.AHEAD="AHEAD"
e.FORKED="FORKED"}(Ct||(Ct={}))
function PopoverContent(e){const{alignmentType:t,onVersionClick:n,alignmentVersionName:a,status:i}=e
switch(i){case Ct.IN_SYNC:return d.createElement("span",null,"Changes made to the ",t," sequence will be reflected in the corresponding Benchling sequence. The alignment will stay in sync with the sequence as long as the alignment is open.")
case Ct.AHEAD:return d.createElement("span",null,"Changes to the ",t," sequence were made without the alignment analysis open. To continue editing the alignment, revert the sequence to"," ",d.createElement("a",{onClick:n,className:"sync-version-name"},a),".")
case Ct.FORKED:return d.createElement("span",null,"The version of the ",t," sequence that corresponds to this alignment no longer exists.")}}const wt={[Ct.IN_SYNC]:"label-primary",[Ct.AHEAD]:"label-warning",[Ct.FORKED]:"label-danger"},Nt={[Ct.IN_SYNC]:"in sync",[Ct.AHEAD]:"out of sync (ahead)",[Ct.FORKED]:"out of sync (forked)"}
function SyncCheck(e){const{alignmentType:t,alignmentVersionExists:n,alignmentVersionName:a,inSync:i,openAlignmentVersion:s,triggerInSync:r}=e,o=i?Ct.IN_SYNC:n?Ct.AHEAD:Ct.FORKED,[l,c]=(0,d.useState)(!1);(0,d.useEffect)((()=>{r(o===Ct.IN_SYNC)}),[o,r])
const u=(0,It.D)((e=>{c(e)
e&&m.j("alignment","viewed_sync_message",{sync_status:Nt[o]})}),200),p=d.createElement("div",{style:{width:250,lineHeight:"18px"},onMouseEnter:()=>{u(!0)},onMouseLeave:()=>{u(!1)}},d.createElement(PopoverContent,{alignmentType:t,onVersionClick:e=>{e.preventDefault()
s()
c(!1)},alignmentVersionName:a,status:o}))
return d.createElement(Oe.Z,{isOpen:l,interaction:ne.x2.CONTROLLED,placement:ne.ZH.BOTTOM,renderContent:()=>p},d.createElement("span",{className:`label ${wt[o]}`,onMouseEnter:()=>{u(!0)},onMouseLeave:()=>{u(!1)}},o===Ct.IN_SYNC?"In Sync":"Out of Sync",d.createElement(pe.Z,{icon:"circle-question"})))}function AlignmentTabMenu(e){const{addComment:t,alignmentApiId:n,alignmentType:a,alignmentVersionExists:i,alignmentVersionName:s,allowFeatureEdits:r,allowResidueEdits:o,analysisName:l,attachedFileCount:c,getClustalFormatData:u,getFastaFormatData:m,goToMismatch:p,inSync:h,loaded:E,openAlignmentVersion:f,openPDFFormattedPreview:S,openPDFSnapshotPreview:y,openRealignModal:b,selectionLength:T,sequenceEditURL:v,shouldRealign:I,sortRows:w,triggerInSync:N,updateName:A,visibilityOptions:R}=e
return d.createElement("ul",{className:"nav navbar-nav form-inline sequence-alignment-menu",...(0,ee.Z)({component:"AlignmentTabMenu",element:"root"})},d.createElement("div",{className:"popover-container"}),d.createElement("li",null,d.createElement(NameInput,{allowFeatureEdits:r,analysisName:l,loaded:E,updateName:A})),d.createElement("li",null,d.createElement(RealignButton,{alignmentType:a,allowFeatureEdits:r,allowResidueEdits:o,loaded:E,openRealignModal:b,shouldRealign:I})),E?d.createElement("li",{className:"sync-msg"},d.createElement(SyncCheck,{alignmentType:a,inSync:h,openAlignmentVersion:f,alignmentVersionExists:i,alignmentVersionName:s,triggerInSync:N})):null,d.createElement("li",null,d.createElement("span",{className:(0,g.iv)(At.mismatchLabel)},"Find Mismatches"),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,className:"alignment-previous-mismatch",icon:"chevron-left",onClick:()=>{p("previous")},disabled:!E}),d.createElement("span",{className:(0,g.iv)(At.mismatchSpacer)}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,className:"alignment-next-mismatch",icon:"chevron",onClick:()=>{p("next")},disabled:!E})),d.createElement("li",{className:"pull-right"},d.createElement("div",{className:"buttonGroup"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,className:"add-alignment-comment",text:"Add Comment",disabled:!E,onClick:()=>{t()}})),d.createElement("div",{className:"buttonGroup"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,isDropdown:!0,text:"Sort By",disabled:!E}),d.createElement("ul",{className:"dropdown-menu sort-by-menu pull-left"},d.createElement("li",null,d.createElement("a",{onClick:()=>{w(!1)},className:"sort-by-name"},"Name")),d.createElement("li",null,d.createElement("a",{onClick:()=>{w(!0)},className:"sort-by-position"},"Position")))),d.createElement(AlignmentExport,{selectionLength:T,openPDFSnapshotPreview:y,openPDFFormattedPreview:S,getClustalFormatData:u,getFastaFormatData:m,analysisName:l,loaded:E,alignmentApiId:n,attachedFileCount:c,sequenceEditURL:v}),d.createElement(St.Z,{options:R,isWide:!0})))}const At=g.mM.create({mismatchLabel:{marginRight:"5px"},mismatchSpacer:{marginRight:"2px"}})
var Rt=n(763661)
const Pt=(0,be.Z)((function PreviewModal({landscape:e}){return d.createElement("div",{className:"pdf-preview-modal"},d.createElement("p",{className:"status"}),d.createElement("div",{className:"preview-wrapper"},e?d.createElement("svg",{width:"388.235",height:"300",viewBox:"0, 0, 1100, 850",style:{backgroundColor:"white",boxShadow:"0px 0px 2px",verticalAlign:"middle"},className:"preview-container"}):d.createElement("svg",{width:"300",height:"388.235",viewBox:"0, 0, 850, 1100",style:{backgroundColor:"white",boxShadow:"0px 0px 2px",verticalAlign:"middle"},className:"preview-container"})),d.createElement("div",{className:"row pagination-row"},d.createElement("div",{className:"col-md-4"},d.createElement("div",{className:"btn-group"},d.createElement("button",{type:"button",className:"first-btn btn btn-af-default"},d.createElement("span",{className:"glyphicon glyphicon-fast-backward"})),d.createElement("button",{type:"button",className:"prev-btn btn btn-af-default"},d.createElement("span",{className:"glyphicon glyphicon-step-backward"})))),d.createElement("div",{className:"page-count col-md-4"},"Page 1 of 1"),d.createElement("div",{className:"col-md-4"},d.createElement("div",{className:"btn-group"},d.createElement("button",{type:"button",className:"next-btn btn btn-af-default"},d.createElement("span",{className:"glyphicon glyphicon-step-forward"})),d.createElement("button",{type:"button",className:"last-btn btn btn-af-default"},d.createElement("span",{className:"glyphicon glyphicon-fast-forward"}))))))}))
var Ot=n(614392)
class PreviewModalView extends s().View{static initClass(){this.prototype.template=Pt
this.prototype.events={"click .prev-btn":function(){return this.gotoPage(this.currentPage-1)},"click .next-btn":function(){return this.gotoPage(this.currentPage+1)},"click .first-btn":function(){return this.gotoPage(0)},"click .last-btn":function(){return this.gotoPage(this.pagination.pages.length-1)}}}readyDownload(e){this.popup.$(".js-submit").removeClass("disabled").button("reset").attr("target","_blank").attr("href",e).click((()=>{m.j("editor","downloaded_pdf",this.trackMetadata)}))}gotoPage(e){this.currentPage=e
const t=0===e,n=e===this.pagination.pages.length-1
this.$(".prev-btn").prop("disabled",t)
this.$(".first-btn").prop("disabled",t)
this.$(".next-btn").prop("disabled",n)
this.$(".last-btn").prop("disabled",n)
this.$(".page-count").text(`Page ${e+1} of ${this.pagination.pages.length}`)
this.$("svg.preview-container").empty()
return this.$("svg.preview-container").append(this.pagination.pages[this.currentPage].svg)}initialize(e){this.paginate=e.paginate
this.trackMetadata=e.trackMetadata||{}
this.landscape=e.landscape||!1
return this.filename=e.filename}showPreview(e){this.pagination=e
return this.gotoPage(0)}initiate(){this.$(".status").text("Retrieving formatting...")
return o().get("/static/build/svg.css").then((e=>{e=e.split("\n").join("").split("\r").join("")
this.$(".status").text("Creating pages...")
const t=this.paginate(e)
let n="Generating PDF..."
t.truncated()&&(n+=`<br/>Note: For performance reasons, only the first ${t.pages.length} pages of\n          the PDF will be generated. To see more of your alignment, consider adjusting the visibility settings\n          or exporting multiple selections.`)
this.$(".status").html(n)
this.showPreview(t)
return this.pagination.toPDF(this.filename)})).fail(v.ZP.notifyError).done((e=>{const t=this.$(".status")
t.html("Done.")
setTimeout((()=>t.slideUp()),2e3)
this.readyDownload(e)}))}render(){this.$el.html(this.template({landscape:this.landscape}))
this.$(".prev-btn").prop("disabled",!0)
this.$(".first-btn").prop("disabled",!0)
this.$(".next-btn").prop("disabled",!0)
this.$(".last-btn").prop("disabled",!0)
this.popup=new Ot.I4({title:"PDF Preview",msg:this.el}).linkChoice("Download","btn-af-success js-submit disabled").choice("Cancel","btn-af-default js-cancel")
this.popup.show()
this.popup.$(".js-submit").data({loadingText:"Preparing PDF..."}).button("loading")
this.popup.$(".js-submit").attr("data-test-component","PreviewModelView")
this.popup.$(".js-submit").attr("data-test-element","downloadButton")
this.initiate()
return this}}PreviewModalView.initClass()
const xt=PreviewModalView
var _t=n(88941),Dt=n(678150),Lt=n(575891),kt=n(198210),Mt=n(808844),Ft=n(605806),Zt=n(722836),Bt=n.n(Zt),qt=n(99312),Vt=n(271359)
function getDefaultResiduesPerLine(e){return e.charactersPerLine-1-12}function generateRowFromSequence(e,t,n,a){return{sequenceName:(i=e.sequenceName,s=t,i.length>s?(0,Mt.fk)(i,s):i.length<s?i+" ".repeat(s-i.length):i),residues:e.residues.slice(n,a),cdrAnnotations:e.cdrAnnotations?e.cdrAnnotations.filter((e=>e.range.start<a||e.range.end>n)):[]}
var i,s}const Ut={[Ft.V2.MUTATION]:"#ee7f7b",[Ft.V2.UNKNOWN]:"#ffd635"},Gt={[Ft.p4.FRAMEWORK]:Vt.Yb,[Ft.p4.CDR]:Vt.G$}
function findNextIndex(e,t,n){for(let a=t;a<e.length;a++)if(n(e[a]))return a
return-1}function generateMismatchHighlights(e,t){const n=e.residues.map((e=>e.format?Ut[e.format]:null)),a=[]
let i=0
for(;i<n.length;){const e=n[i]
if(!e){i++
continue}const s={color:e,index:i+t},r=findNextIndex(n,i+1,(t=>t!==e))
if(-1===r){s.length=n.length-i
a.push(s)
break}s.length=r-i
a.push(s)
i=r}return a}function generateCDRAnnotationUnderlines(e,t,n){if(!e.cdrAnnotations)return[]
return l.default.compact(e.cdrAnnotations.map((e=>{if(e.range.start>=n.end||e.range.end<n.start)return null
const a=Math.max(e.range.start,n.start),i=Math.min(e.range.end,n.end)-a
return{color:Gt[e.name],index:t+a-n.start,length:i}})))}function convertBlockToLines(e,{charactersPerLine:t,includeBlockSeparationLines:n,showMismatches:a,nameLength:i,zeroIndexedRange:s,selectionStart:r}){const o=function generateIndexLine(e,t){const n=e.start+1,a=e.inclusiveEnd+1,i=a-n+1-(n.toString().length+a.toString().length)
let s=" ".repeat(t)+n.toString()
i>=0&&(s+=" ".repeat(i)+a.toString())
return{text:s,highlights:[],underlines:[]}}({start:s.start+r,inclusiveEnd:s.inclusiveEnd+r},i+1),l=i+1,c=[o,...e.rows.map((e=>({text:`${e.sequenceName} ${e.residues.map((e=>e.letter)).join("")}`,highlights:a?generateMismatchHighlights(e,l):[],underlines:generateCDRAnnotationUnderlines(e,l,{start:s.start,end:s.inclusiveEnd+1})})))]
if(n){c.push({text:" ",highlights:[],underlines:[]})
c.push({text:"·".repeat(t),highlights:[],underlines:[]})
c.push({text:" ",highlights:[],underlines:[]})}return c}function getTitleLines(e,t,n,a){const i=`Page ${e} ${t}${n?`, CDR Definition: ${(0,Mt.kC)(n)}`:""}`
return[{text:i.length>a.charactersPerLine?(0,Mt.fk)(i,a.charactersPerLine):i,highlights:[],underlines:[]},{text:" ",highlights:[],underlines:[]}]}const zt={pageSize:Ft.rS,showMismatches:!0,residuesPerLine:getDefaultResiduesPerLine(Ft.rS),selectionStart:0,selectionEnd:null}
function adjustedCDRAnnotations(e,t){return e.cdrAnnotations?e.cdrAnnotations.map((e=>({...e,range:{start:e.range.start-t,end:e.range.end-t}}))):[]}function alignmentToPages(e,t,n,a){const i={...zt,...a};(0,S.hu)(1===l.default.uniq(e.map((e=>e.residues.length))).length,"Cannot generate PDF for alignment with different length sequences")
const s=function getSelection(e,t,n){const a=null==n||0===n?e[0].residues.length:n
return e.map((e=>({...e,residues:e.residues.slice(t,a),cdrAnnotations:adjustedCDRAnnotations(e,t)})))}(e,i.selectionStart,i.selectionEnd),r=s[0].residues.length,o=function getNameLength(e,t,n){(0,S.hu)(n<t,"Cannot specify more residues than characters")
const a=Math.max(...e.map((e=>e.sequenceName.length))),i=t-1-n
return Math.min(i,a)}(s,i.pageSize.charactersPerLine,i.residuesPerLine),c=Math.ceil(r/i.residuesPerLine),d=i.pageSize.linesPerPage-2-1
return s.length>d?function getPagesForBigSegments(e,t,n,a,i,s,r,o){const c=Math.ceil(e.length/i),d=[]
for(const u of l.default.range(n)){const n=u*t.residuesPerLine,m=Math.min(n+t.residuesPerLine,a)
for(const a of l.default.range(c)){const l=a*i,c=(a+1)*i,u={rows:e.slice(l,c).map((e=>generateRowFromSequence(e,s,n,m)))}
d.push({lines:[...getTitleLines(d.length+1,r,o,t.pageSize),...convertBlockToLines(u,{charactersPerLine:t.pageSize.charactersPerLine,includeBlockSeparationLines:!1,showMismatches:t.showMismatches,nameLength:s,zeroIndexedRange:{start:n,inclusiveEnd:m-1},selectionStart:t.selectionStart})]})}}return{pages:d}}(s,i,c,r,d,o,t,n):function getPagesForSmallSegments(e,t,n,a,i,s,r){const o=e.length+3+1,c=Math.max(Math.floor((t.pageSize.linesPerPage-2)/o),1),d=Math.ceil(n/c)
return{pages:l.default.range(d).map((n=>{const o=getTitleLines(n+1,s,r,t.pageSize)
for(const s of l.default.range(c)){const r=(n*c+s)*t.residuesPerLine,l=Math.min(r+t.residuesPerLine,a)
if(r>=a)continue
const d={rows:e.map((e=>generateRowFromSequence(e,i,r,l)))}
o.push(...convertBlockToLines(d,{charactersPerLine:t.pageSize.charactersPerLine,includeBlockSeparationLines:!0,showMismatches:t.showMismatches,nameLength:i,zeroIndexedRange:{start:r,inclusiveEnd:l-1},selectionStart:t.selectionStart}))}return{lines:o}}))}}(s,i,c,r,o,t,n)}const $t=(0,It.D)((function generateAlignmentPDF(e,t,a,i,s){!function renderPagesToPDF(e,t,a){n.e(207).then(n.t.bind(n,845555,23)).then((({default:n})=>{const i=new n({autoFirstPage:!1}),s=i.pipe(Bt()())
i.fontSize(10)
i.font("Courier")
const r=i.widthOfString(" "),o=i.currentLineHeight()
e.pages.forEach((e=>{i.addPage({margin:20,layout:t===Ft.rS?"portrait":"landscape"})
e.lines.forEach((e=>{for(const t of e.highlights)i.highlight(i.x+r*t.index,i.y,r*(t.length||1),.8*o,{color:t.color})
for(const t of e.underlines)i.underline(i.x+r*t.index,i.y,r*(t.length||1),o,{color:t.color})
i.text(e.text)}))}))
i.end()
s.on("finish",(()=>{qt.isNodeTesting||a(s.toBlobURL("application/pdf"))}))}))}(alignmentToPages(e,t,a,i),i.pageSize||zt.pageSize,s)}),250),molbio_AlignmentPDFDownloadModal=e=>{const[t,n]=(0,d.useState)(""),[a,i]=(0,d.useState)(!1),[s,r]=(0,d.useState)(Ft.rS),[o,l]=(0,d.useState)(getDefaultResiduesPerLine(s)),[c,u]=(0,d.useState)(null),[p,h]=(0,d.useState)(!1),E=e.rawAlignmentData.some((e=>{var t
return Boolean(null===(t=e.cdrAnnotations)||void 0===t?void 0:t.length)})),[S,y]=(0,d.useState)(E),b=(0,de._6)(2,yt.OL[e.alignmentPolymerType]),T=(0,Mt.kC)(b),v=getDefaultResiduesPerLine(s);(0,d.useEffect)((()=>{l(getDefaultResiduesPerLine(s))}),[s]);(0,d.useEffect)((()=>{var t
if(!c){n("")
$t(S?e.rawAlignmentData:e.rawAlignmentData.map((e=>({...e,cdrAnnotations:void 0}))),e.alignmentName,null!==(t=e.cdrDefinition)&&void 0!==t?t:null,{showMismatches:a,residuesPerLine:o,pageSize:s,selectionStart:p?e.selection.start:0,selectionEnd:p?e.selection.end:null},(e=>{n(e)}))}}),[e.rawAlignmentData,a,o,c,s,p,e.selection,e.alignmentName,S,e.cdrDefinition])
return d.createElement(et.ZP,{buttons:[{text:t?"Download":"Generating PDF...",submit:!0,disabled:!t,dataTestAttrs:{component:"AlignmentPDFDownloadModal",element:"downloadButton"}}],onRequestSubmit:function onSubmit(){m.KK(j.Jg.DOWNLOADED_FORMATTED_ALIGNMENT_PDF,{residueType:e.alignmentPolymerType,showMismatches:a,residuesPerLine:o,pageFormat:s,useSelection:p,useCDRAnnotations:S})
window.open(t,"_blank")
e.onRequestSubmit()},onRequestClose:e.onRequestClose,title:"Export Alignment as PDF",dataTestAttrs:{component:"AlignmentPDFDownloadModal",element:"root"}},d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(Wt.form)},d.createElement("div",{className:(0,g.iv)(Wt.formRow)},d.createElement(Ke.Z,{className:(0,g.iv)(Wt.formGroup)},d.createElement(Je.Z,null,"Page Layout"),d.createElement(kt.Z,{selection:s===Ft.rS?"letter":"landscape",size:C.qE.SMALL,onChangeSelection:e=>{r("letter"===e?Ft.rS:Ft.oz)},options:[{id:"letter",buttonProps:{text:"Letter"}},{id:"landscape",buttonProps:{text:"Landscape"}}]})),d.createElement(Ke.Z,{className:(0,g.iv)(Wt.formGroup,Wt.rightColumn)},d.createElement(Je.Z,null,"Highlight mismatches and unknown ",b),d.createElement(_t.Z,{type:"checkbox",name:"showMismatches",className:(0,g.iv)(Wt.checkbox),checked:a,onChange:e=>{i(e.target.checked)}}))),d.createElement("div",{className:(0,g.iv)(Wt.formRow)},d.createElement(Ke.Z,{className:(0,g.iv)(Wt.formGroup)},d.createElement(Je.Z,null,(0,Mt.kC)(b)," per line"),d.createElement(_t.Z,{type:"number",className:(0,g.iv)(Wt.residuesInput),name:`${T} per line`,focusOnMount:!1,value:o.toString(),onChange:e=>{const t=parseInt(e.target.value,10)
l(t)
u(t>=10&&t<=v?null:`${T} must be a number between 10 and ${v}`)}}),d.createElement(Dt.Z,{message:c})),d.createElement(Ke.Z,{className:(0,g.iv)(Wt.formGroup,Wt.rightColumn)},d.createElement(Je.Z,null,"Use selected ",b),d.createElement(_t.Z,{type:"checkbox",name:"useSelection",className:(0,g.iv)(Wt.checkbox),checked:p,onChange:e=>{h(e.target.checked)}})),E&&d.createElement(Ke.Z,{className:(0,g.iv)(Wt.formGroup,Wt.rightColumn)},d.createElement(Je.Z,null,"Use CDR Annotations"),d.createElement(_t.Z,{type:"checkbox",name:"useCDRAnnotations",className:(0,g.iv)(Wt.checkbox),checked:S,onChange:e=>{y(e.target.checked)}}))),d.createElement("div",{className:(0,g.iv)(Wt.formRow)},d.createElement("p",null,`By default, we show up to 12 characters of sequence names. If names are ellipsized and you want to see more name characters, adjust '${b} per line' down.`)),d.createElement("div",{className:(0,g.iv)(Wt.formRow)},d.createElement("p",null,d.createElement(pe.Z,{icon:"warning",className:"u-warning-color u-tiny-spacing-right"}),"If you are having trouble downloading, please check if any browser extensions prevent popups."))),d.createElement("div",{className:f()((0,g.iv)(Wt.wrapper),(0,g.iv)(Wt.centered))},t?d.createElement("iframe",{className:(0,g.iv)(Wt.iframe),title:"Alignment PDF Preview",src:t}):d.createElement("div",{className:(0,g.iv)(Wt.centered)},"Generating PDF preview; please do not refresh the page.",d.createElement(Lt.Z,null)))))},Wt=g.mM.create({centered:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},wrapper:{height:"470px"},iframe:{height:"500px",width:"460px"},formGroup:{display:"flex",flexDirection:"column",alignItems:"flex-start"},formRow:{marginLeft:"40px",display:"flex",alignItems:"center"},rightColumn:{marginLeft:"50px"},residuesInput:{width:"50%"},checkbox:{width:"inherit",margin:0,height:"20px"},dropdown:{overflow:"scroll"},form:{marginBottom:"20px"}})
var Ht=n(293630),jt=n(637420),Yt=n(2186)
function shouldShowCDRs(e){var t
return dt.ZP.MOLBIO_ENABLE_ANTIBODY_ENGINEERING_TOOLS&&Boolean(null===(t=e.getOption(Yt.W3.name))||void 0===t?void 0:t.get("visible"))}function shouldShowAntibodyTools(e){return function shouldShowNumbering(e){var t
return dt.ZP.MOLBIO_ENABLE_ANTIBODY_ENGINEERING_TOOLS&&Boolean(null===(t=e.getOption(Yt.XH.name))||void 0===t?void 0:t.get("visible"))}(e)||shouldShowCDRs(e)}function getAntibodyVisibilitySettings(e){var t,n
if(!shouldShowAntibodyTools(e))return[void 0,void 0]
let a,i;(null===(t=e.getOption(Yt.XH.name))||void 0===t?void 0:t.get("visible"))&&(a=e.getOption(Yt.XH.name).getSetting("numberingScheme").get("value").toLowerCase());(null===(n=e.getOption(Yt.W3.name))||void 0===n?void 0:n.get("visible"))&&(i=e.getOption(Yt.W3.name).getSetting("CDRDefinition").get("value").toLowerCase())
return[a,i]}function listenToAntibodyVisibilitySettings(e,t,n){t.listenTo(e.getOption(Yt.XH.name),"change:visible",n)
t.listenTo(e.getOption(Yt.W3.name),"change:visible",n)
t.listenTo(e.getOption(Yt.XH.name).getSetting("numberingScheme"),"change:value",n)
t.listenTo(e.getOption(Yt.W3.name).getSetting("CDRDefinition"),"change:value",n)}function getRealToGapMap(e){const t=e.split("")
if(!e.includes(R.P8))return t.map(((e,t)=>t))
const n=[]
for(let a=0;a<e.length;a++)t[a]!==R.P8&&n.push(a)
n.push(n[n.length-1]+1)
return n}var Qt=n(117484),Kt=n(436208),Jt=n(64558),Xt=n(782279)
function isAssemblyPrimer(e,t,a){return n(901369).Z.of(e).isFlankingPrimer(e,t)&&(null==a||e.assemblyType()===a)}function basesHTML(e,t,n){let a=0,i=0,s=0,r=0
const o=n.isAssemblyPrimer?e.assemblyType()===b.ASSEMBLY_TYPE.GOLDEN_GATE:isAssemblyPrimer(e,t,b.ASSEMBLY_TYPE.GOLDEN_GATE)
if(o){const n=e.assembly().enzyme()
s=t.bases().indexOf(n.get("seq"))
i=s+n.recognitionSiteLength()
r=i+n.postRecognitionSiteLength()
a=r+n.stickyEndLength()}const l=t.overhangLength(),c=t.baseMatchingStatuses(e)
return Xt.renderToStaticMarkup(d.createElement(d.Fragment,null,Array.from(t.bases()).map(((e,t)=>{const n=t<l,u=c[t],m=o&&t>=s&&t<i,p=o&&t>=r&&t<a
return d.createElement("span",{key:t,className:f()({"primer-base-overhang":n&&!m&&!p,"primer-base-recognition-site":n&&m,"primer-base-sticky-end":n&&p,"primer-base-match":!n&&u,"primer-base-no-match":!n&&!u})},e)}))))}var en=n(407161),tn=n(650858),nn=n(766455),an=n(8747)
class EditPrimerTabState extends nn.Xh{initialize(){this._sequence=this.get("sequence").get("_sequence")
this.get("primer").set("sequenceID",this.get("sequence").id)
this.listenTo(this._sequence,"change:annotations",((e,t)=>{this.get("sequence").get("currentVersion")&&this.addValidPrimers()}))
this.listenToPrimer("primer","originalPrimer")
this.listenToPrimer("primer2","originalPrimer2")
this.on("change:checking",((e,t)=>{t&&this.checkSecondary()}))
const e=We.Z.get(tn.gq.SECONDARY_TEMP)
null==e||Number.isNaN(parseInt(e,10))||this.set({temperature:parseInt(e,10)})
this.on("change:temperature",((e,t)=>{null!=t?We.Z.set(tn.gq.SECONDARY_TEMP,t):We.Z.unset(tn.gq.SECONDARY_TEMP)}))
this.listenTo(We.Z,`change:${tn.gq.SECONDARY_TEMP}`,((e,t)=>{var n
const a=parseInt(null!==(n=null==t?void 0:t.toString())&&void 0!==n?n:"",10)
Number.isNaN(a)||this.set({temperature:a})}))}listenToPrimer(e,t){const setAndListenToPrimer=()=>{const n=this.previous(e)
null!=n&&this.stopListening(n)
const a=this.get(e)
null!=a&&this.listenTo(this.get(e),"remove",(()=>{this.close()}))
this[t]=l.default.clone(null==a?void 0:a.attributes)}
this.on(`change:${e}`,setAndListenToPrimer)
setAndListenToPrimer()}getAssemblyEnzyme(){var e
return null===(e=this._sequence.assembly())||void 0===e?void 0:e.enzyme()}checkSecondary(){var e,t
const n=new FormData
let a=!1
const i=this.get("primer"),s=this.get("primer2")
if(0!==i.bases().length){n.append("primer",i.bases())
n.append("nucleotideType",i.nucleotideType())
null!=s&&0!==s.bases().length&&n.append("primer2",s.bases())}else{a=!0
n.append("primer",s.bases())
n.append("nucleotideType",s.nucleotideType())}n.append("temperature",null!==(t=null===(e=this.get("temperature"))||void 0===e?void 0:e.toString())&&void 0!==t?t:"37")
return an.by({url:"/1/api/oligo-secondary-structure",data:n,dataType:"json",processData:!1,contentType:!1,type:"PUT"}).fail((e=>{v.ZP.notifyError(e)})).done((e=>{a&&(e={monomer2:e.monomer,homodimer2:e.homodimer})
return this.set({secondary:e})}))}static createFromSelection(e,t=1){const n=e.get("selection").assertNotEmpty()
let a=e.residueSlice(n.start(),n.end());-1===t&&(a=(0,y.revcomp)(a,e.get("_sequence").baseTable()))
const i=new en.Hn({bases:a,strand:t,nucleotideType:e.nucleotideType()})
i.setBindPosition(e.get("_sequence"),1===t?n.end()-1:n.start(),0)
return new EditPrimerTabState({primer:i,sequence:e})}static edit(e,t,n=!1){const a=t.fileState().buffers().getTab((t=>{var n
return null!=e.id&&t instanceof EditPrimerTabState&&(t.get("primer").id===e.id||(null===(n=t.get("primer2"))||void 0===n?void 0:n.id)===e.id)}))
if(null!=a)a.set({active:!0,analyzeSecondary:n})
else{const a=new EditPrimerTabState({primer:e,sequence:t,analyzeSecondary:n})
t.fileState().buffers().addTab(a)}}static editPair(e,t,n,a=!1){const i=n.fileState().buffers().getTab((n=>{var a
return null!=e.id&&null!=t.id&&n instanceof EditPrimerTabState&&(n.get("primer").id===e.id&&(null===(a=n.get("primer2"))||void 0===a?void 0:a.id)===t.id)}))
if(null!=i)i.set({active:!0,analyzeSecondary:a})
else{const i=new EditPrimerTabState({primer:e,primer2:t,sequence:n,analyzeSecondary:a})
n.fileState().buffers().addTab(i)}}removePrimers(e,t){[e,t].forEach((e=>{(null==e?void 0:e.isNew())&&this._sequence.sequencePrimers().remove(e)}))}addValidPrimers(){this._sequence.isEmpty()||[this.get("primer"),this.get("primer2")].forEach((e=>e&&this._sequence.sequencePrimers().add(e)))}close(e=!0){e&&[{primer:this.get("primer"),original:this.originalPrimer},{primer:this.get("primer2"),original:this.originalPrimer2}].forEach((({primer:e,original:t})=>{(null==e?void 0:e.has("id"))&&(isAssemblyPrimer(this._sequence,e)?e.set({name:null==t?void 0:t.name}):e.set(t))}))
this.stopListening(this._sequence)
this.stopListening(this.get("primer"))
null!=this.get("primer2")&&this.stopListening(this.get("primer2"))
this.removePrimers(this.get("primer"),this.get("primer2"))
super.close()}isSaving(e){return this.get("saving")[e]}saving(e,t){const n=[...this.get("saving")]
n[e]=t
this.set({saving:n})}defaults(){return{...super.defaults(),title:"Design Primer",primer:new en.Hn,primer2:null,saving:[!1,!1],checking:!1}}}const sn=EditPrimerTabState
var rn=n(41706),on=n(814099),ln=n(323539)
function setTrimFromSelection(e,t,n){const a=e.get("selection"),i=a.start(),s=a.end()
switch(n){case yt.Eg.START:t.setStart(i)
break
case yt.Eg.END:t.setEnd(null!=s?s:i)
break
case yt.Eg.BOTH:(0,S.hu)(null!=s,"Cannot set trim from selection if selection does not have an end index")
t.setBoth(i,s)
break
default:(0,S.hu)(!1,"Unexpected trim side")}t.renderLineRanges()}function setAllTrimsFromSelection(e,t,n){t.get("mapstates").map((e=>e.get("sequence").get("trim"))).forEach((t=>{t&&setTrimFromSelection(e,t,n)}))}function InsertPart({nucleotideType:e}){return d.createElement("div",{className:"insert-part-modal"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12 search"})),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("div",{className:"selected-sequence"}))),e===R.Wy.DNA&&d.createElement("label",{className:"checkbox"},d.createElement("input",{type:"checkbox",className:"reverse-complement"}),"Use Reverse Complement"),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("span",{className:"warning"}))))}const cn=(0,be.Z)((function InsertPartSequence({getPath:e,sequence:t}){return d.createElement("div",{className:"part-sequence-preview"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("span",{className:"name"},t.get("name")),d.createElement("span",{className:"folder faded"}," ",e(t)),d.createElement("span",{className:"pull-right"},t.get("length"),"bp ·"," ",d.createElement("span",{className:"topology"},t.get("circular")?"circular":"linear")))))}))
const dn=(0,be.Z)((function SequenceSearchView({searchLibrary:e}){return d.createElement("div",{className:"sequence-search-component"},d.createElement("div",{className:"sequence-search-wrapper"},e?d.createElement("input",{type:"text",placeholder:"Search for a sequence or folder",className:"search-input"}):d.createElement("input",{type:"text",placeholder:"Search for a sequence",className:"search-input",...(0,ee.Z)({component:"SequenceSearch",element:"sequenceSearchInput"})}),d.createElement("div",{className:"spinner hidden"})),d.createElement("div",{className:"sequence-search-results-wrapper"},d.createElement("div",{className:"search-results list-group",...(0,ee.Z)({component:"SequenceSearch",element:"searchResults"})})))}))
const un=(0,be.Z)((function SearchResultRow({name:e,path:t}){return d.createElement("a",{className:"list-group-item clearfix"},e,d.createElement("span",{className:"pull-right faded"},t))}))
const mn=(0,be.Z)((function SequenceSearchMessageRow({message:e}){return d.createElement("div",{className:"list-group-item"},d.createElement("div",{className:"faded"},e))}))
var pn=n(927517)
function SequenceSearchView_defineProperty(e,t,n){(t=function SequenceSearchView_toPropertyKey(e){var t=function SequenceSearchView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class SequenceSearchResult extends s().Model{folder(){return this.get("folder")}permissions(){return this.get("permissions")}}class SequenceSearchResults extends s().Collection{constructor(...e){super(...e)
SequenceSearchView_defineProperty(this,"url","/1/api/all/search?filter=long_sequence")}static initClass(){this.prototype.model=SequenceSearchResult}parse(e){return e.data.map((e=>l.default.extend({writable:e.permissions.writable},e)))}}SequenceSearchResults.initClass()
class DnaSequenceSearchResults extends SequenceSearchResults{constructor(...e){super(...e)
SequenceSearchView_defineProperty(this,"url","/1/api/all/search?filter=sequence")}}DnaSequenceSearchResults.initClass()
class RnaSequenceSearchResults extends SequenceSearchResults{constructor(...e){super(...e)
SequenceSearchView_defineProperty(this,"url","/1/api/all/search?filter=rna_sequence")}}RnaSequenceSearchResults.initClass()
class RnaSequenceWithoutModsSearchResults extends SequenceSearchResults{constructor(...e){super(...e)
SequenceSearchView_defineProperty(this,"url","/1/api/all/search?filter=rna_sequence_no_mods")}}RnaSequenceWithoutModsSearchResults.initClass()
class SequenceSearchView_SequenceSearchView extends s().View{static initClass(){this.prototype.template=dn
this.prototype.resultRowTemplate=un
this.prototype.messageRowTemplate=mn
this.prototype.events={"input .search-input":"handleSearchInput","click .search-results a.list-group-item":"selectResultOnClick","keydown .search-input":"selectResultOnEnter","keyup .search-input":"escapeSearch"}
this.prototype.performSearch=(0,It.D)((function(e){null!=this._inflightXHRs&&this._inflightXHRs.forEach((e=>e.abort()))
if(e.length>0){this._inflightXHRs=this.fetchResults(e)
o().when(...Array.from(this._inflightXHRs||[])).done((()=>this.updateSearchResults()))}else{this.hideSpinner()
this.clearSearch()
this._inflightXHRs=null}}),250)}initialize(e){l.default.defaults(e,{clearSearchAfterClick:!0,alwaysDisplayResults:!1});({selectSequence:this.selectSequence,clearSearchAfterClick:this.clearSearchAfterClick,alwaysDisplayResults:this.alwaysDisplayResults}=e)
e.nucleotideType?e.nucleotideType===R.Wy.DNA?this.sequenceResults=new DnaSequenceSearchResults:e.nucleotideType===R.Wy.RNA&&e.excludeModified?this.sequenceResults=new RnaSequenceWithoutModsSearchResults:e.nucleotideType===R.Wy.RNA&&(this.sequenceResults=new RnaSequenceSearchResults):this.sequenceResults=new SequenceSearchResults
this._inflightXHRs=null}showSpinner(){this.$(".sequence-search-wrapper .spinner").removeClass("hidden")}hideSpinner(){this.$(".sequence-search-wrapper .spinner").addClass("hidden")}showNoResultsMessage(){this.$(".search-input").val()
const e=[o()(this.messageRowTemplate({message:"No matches found"}))]
this.$(".search-results").empty().append(e)
this.$(".search-results").show()}updateSearchResults(){this.hideSpinner()
if(0===this.sequenceResults.length){this.showNoResultsMessage()
return}const e=this.sequenceResults.map((e=>o()(this.resultRowTemplate({searchLibrary:!1,name:e.get("name"),path:this._getSequencePath(e)})).data("result",e)))
this.$(".search-results").empty().append(e)
this.$(".search-results").show()}_getSequencePath(e){return`${e.get("owner")}/${e.folder().name}`}handleSearchInput(e){this.showSpinner()
this.performSearch(o()(e.target).val())}fetchResults(e){return[this.sequenceResults.fetch({data:{q:e}})]}displaySearchResults(e){this.$(".search-results").toggle(this.$(e.target).length>0)}focus(){this.$(".search-input").focus()}setInputValue(e){this.$(".search-input").val(e)}clearSearch(){this.$(".search-input").val("")
this.$(".search-results").empty()
this.alwaysDisplayResults&&this.showNoResultsMessage()}selectResult(e){const t=e.data("result")
this.clearSearchAfterClick&&this.clearSearch()
this.selectSequence(t)}selectResultOnClick(e){const t=o()(e.currentTarget)
this.selectResult(t)}selectResultOnEnter(e){if(13!==e.which)return
e.preventDefault()
const t=this.$(".search-results a.list-group-item").first()
0!==t.length&&this.selectResult(t)}escapeSearch(e){if(pn.isEscapeKey(e)&&this.$(".search-input").val()){e.stopPropagation()
this.clearSearch()}}render(){this.$el.html(this.template({searchLibrary:!1}))
this.alwaysDisplayResults&&this.showNoResultsMessage()
return this}}SequenceSearchView_SequenceSearchView.initClass()
const hn=SequenceSearchView_SequenceSearchView
class InsertPartModalView extends Ot.GI{static initClass(){this.prototype.template=InsertPart
this.prototype.sequenceTemplate=cn
this.prototype.title="Choose Part"}form(){(0,Me.A9)(d.createElement(InsertPart,{nucleotideType:this.sequence.nucleotideType()}),this.$body[0])
this.choice({type:"submit",text:"Choose Part"})
this.choice({type:"cancel",text:"Cancel"})
this.searchView.setElement(this.$body.find(".search"))
return this.searchView.render()}_getPath(e){const t=/\/([^\/]+)\//.exec(e.get("editURL")),n=e.folder().name
return null!=t?`${t[1]}/${n}`:n}initialize({sequence:e,oldPart:t}){this.sequence=e
this.oldPart=t
this.selectSequence=this.selectSequence.bind(this)
return this.searchView=new hn({selectSequence:this.selectSequence,nucleotideType:this.sequence.nucleotideType(),excludeModified:!0})}selectSequence(e){this.$(".selected-sequence").empty().data("sequence",e).append(this.sequenceTemplate({sequence:e,getPath:this._getPath}))
e.get("circular")?this.$(".warning").html("<b>Note:</b> The selected sequence is <b>circular</b>, but will be inserted as a <b>linear</b> sequence."):this.$(".warning").text("")
this.check()}focus(){return this.searchView.focus()}validate(){const e=o()(".selected-sequence").data("sequence"),t=this.$(".reverse-complement").is(":checked")
return null!=e&&[e,t]}submit(){let e
const[t,n]=Array.from(this.validate())
let a={reverse:!1,complement:!1}
n&&(a={reverse:!0,complement:!0})
const i=this.sequence.selection()
if(null==this.oldPart&&i.isEmpty())this.sequence.insertPart(i.start(),t,a).fail(v.ZP.notifyError)
else{e=this.oldPart?this.oldPart.start():i.start()
const n=this.oldPart?this.oldPart.end():i.end()
this.sequence.replaceWithPart(e,n,t.id,a).fail(v.ZP.notifyError)}this.close()}}InsertPartModalView.initClass()
const gn=InsertPartModalView
function isCreateNewPartFromSelectionDisabled(e){return dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS?!e.allowFeatureEdits()||!e.canInsertPart():!e.allowResidueEdits()||!e.isSelectionDeletable()||!e.canInsertPart()}var En=n(674607),fn=n(467607),Sn=n(256605),yn=n(900306),bn=n(219579)
const Tn=new bn.Z(13)
function getSingleModificationHeight(e){return.3333333333333333*e.height()}function getModificationMarginHeight(e){return.5*getSingleModificationHeight(e)}function getTotalModificationHeight(e){return getSingleModificationHeight(e)+2*getModificationMarginHeight(e)}function getSinglePrimerInnerHeight(e,t,n){const a=n?.5833333333333334:.6666666666666666,i=e.height()/a
return dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES&&t?i+getTotalModificationHeight(e):i}function getSinglePrimerHeight(e,t,n){return 2+getSinglePrimerInnerHeight(e,t,n)+2}var vn=n(818382),Cn=n(771398)
function serialize(e,t,n){e=e.cloneNode(!0)
o()(e).find("[data-original-title]").removeAttr("data-original-title")
o()(e).find("[title]").removeAttr("title")
const a=Re().select(e).insert("svg:defs",":first-child")
null!=t&&a.append("svg:style").text(t)
null!=n&&o()(a.node()).append(n)
return(new XMLSerializer).serializeToString(e).replace(/[\u0000-\u001f]+/g,"")}async function getPNGFileForSVG(e,t){const n=await(0,Cn.sM)("/static/fonts/inconsolata-400.svg"),a=o()(n).find("font")
a.find("font-face").attr("font-family","Inconsolata").attr("font-weight",400)
a.find("glyph:not([d])").remove()
const i=(await(0,Cn.sM)(`/static/build/svg.css?r=${window.REVISION}`)).split("\n").join("").split("\r").join("")
return(0,an.s0)({url:"/1/api/svg-to-png",data:{filename:t,svg:serialize(e,i,a.get(0))}})}function getSVGHeight(e){return parseInt(Re().select(e).attr("height"),10)}function appendSVGToSVG({parentSVG:e,childSVG:t,transform:n}){const a=document.createElementNS("http://www.w3.org/2000/svg","g")
Re().select(a).attr("class",Re().select(t).attr("class"))
o()(a).append(o()(t).children())
Re().select(a).attr("transform",n)
o()(e).append(a)}function fixAxis(e){Re().select(e).selectAll(".tick").selectAll("text").each((function fixAxisText(){const e=11*parseFloat(Re().select(this).attr("dy"))
Re().select(this).attr("dy",e)}))}function canCreatePrimerPair(e){const t=e.selection(),n=t.canPCR(),a=[t.getStartState("primer"),t.getEndState("primer")]
return n&&!existingPrimerPairSelected(e)&&a.every((e=>!e.fromSubPart()))}function createPrimerPair(e,t){(0,S.hu)(canCreatePrimerPair(e),"Selected primers cannot be linked")
const n=e.selection().getStartState("primer"),a=e.selection().getEndState("primer"),i={primer_fwd_id:n.id,primer_rev_id:a.id}
e.primerPairs().betterCreate(i).fail(v.ZP.notifyError).done((()=>{e.updateVersions()
e.get("selection").trigger("showLinks")
v.ZP.success("Primers successfully linked.")
m.j("primer","linked_primers",{sequence_id:e.get("id")})})).always((()=>{t&&t()}))}function existingPrimerPairSelected(e){let t
if(e.selection().canPCR()){const n=e.selection().getStartState("primer"),a=e.selection().getEndState("primer")
t=Boolean(e.primerPairs().findPair(n,a))}else t=!1
return t}function getModificationsForPrimerDisplay(e,t){if(!dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES||0===e.length)return[]
const n=t===y.NucleotideType.DNA?(0,vn.qT)(Sn.TF.D_LOWER):(0,vn.qT)(Sn.TF.R_LOWER),a=(0,vn.qT)(Sn.TF.P_LOWER),i=t===y.NucleotideType.DNA?Sn.TF.U:Sn.TF.T,s=Object.entries(dt.ZP.MODBIO_NATURAL_MONOMER_IDS_BY_NATURAL_ANALOGUE).filter((([e,t])=>(0,yn.JG)()||e!==i)).map((([e,t])=>t))
return e.filter((e=>!(e.sugarMonomerId===n&&s.includes(e.baseMonomerId)&&(null==e.phosphateMonomerId||e.phosphateMonomerId===a))))}const In=(0,be.Z)((function ReindexModal({currentLocation:e}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("p",{className:"help-block"},"Enter the desired location for the current base (e.g. enter 100 for the current base to become the 100",d.createElement("sup",null,"th")," base)."))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-6"},d.createElement("div",{className:"form-horizontal"},d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-6 control-label"},"Current Location"),d.createElement("div",{className:"col-md-6"},d.createElement("p",{className:"form-control-static current-location"},e))),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-6 control-label"},"New Location"),d.createElement("div",{className:"col-md-6"},d.createElement("input",{type:"text",className:"new-location form-control",defaultValue:"1"})))))))}))
class ReindexModal_ReindexModal extends Ot.GI{static initClass(){this.prototype.template=In
this.prototype.title="Re-index"}initialize(e){this.sequence=e.sequence
return(0,S.hu)(1===this.sequence.startIndex(),"ReindexModal rendering with startIndex != 1")}events(){return{"input input":"check"}}form(){this.$body.append(this.template({currentLocation:T.modelToDisplay(this.sequence.get("selection").start(),this.sequence.startIndex())}))
this.choice({type:"submit",text:"Re-index"})
return this.choice({type:"cancel",text:"Cancel"})}focus(){return this.$body.find("input").focus()}validate(){const e=this.sequence.startIndex(),t=T.displayToModel(parseInt(this.$body.find(".current-location").text()),e),n=T.displayToModel(parseInt(this.$body.find(".new-location").val()),e)
return!l.default.isNaN(t)&&!l.default.isNaN(n)&&(0<=t&&t<this.sequence.length()&&0<=n&&n<this.sequence.length()?[t,n]:void 0)}submit(){const[e,t]=Array.from(this.validate())
this.sequence.reindex(e,t).fail(v.ZP.notifyError)
return this.close()}}ReindexModal_ReindexModal.initClass()
const wn=ReindexModal_ReindexModal
function trackChoice(e,t={}){m.j("editor",e,l.default.extend({source:"contextmenu"},t))}function trackCreatePrimer(e,t){m.j("primer","open_edit_primer_tab",{product:j.XC.MOLBIO,createdFrom:"context_menu",direction:t,sequence_id:e.get("id")})}function trackOpenAnnotationPanel(e,t){m.j("annotation","open_annotation_panel",{product:j.XC.MOLBIO,openedFrom:t,sequence_id:e.get("id")})}function trackOpenTranslationPanel(e,t){m.j("translation","open_translation_panel",{product:j.XC.MOLBIO,openedFrom:"context_menu",strand:t,sequence_id:e.get("id")})}function canOpenPartAtSelectionStart(e,t){if(null!=t)return!t.isDeleted()
{const t=e.getSequencePartsAtSelectionStart()
return 1===t.length&&null!=t[0]&&!t[0].isDeleted()}}function canDeleteOrReplacePartAtSelectionStart(e){const t=e.getSequencePartsAtSelectionStart()
return canOpenPartAtSelectionStart(e)&&e.allowResidueEdits()&&!e.partHasOverlaps(t[0])}function shouldShowPartMenu(e,t){return(null!=t||1===e.getSequencePartsInSelection().length)&&e.selectionContainedInPart()&&(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})}function getSinglePart(e){const t=e.getSequencePartsAtSelectionStart();(0,S.hu)(1===t.length,"Expected to find exactly one part")
return t[0]}function toggleCaseHandler(e,t){const n=e.get("selection").assertNotEmpty(),a=n.start(),i=n.end()
e.toggleCase(a,i,t)}function getTranslationMenuActionName(e,t){var n
return(null!==(n=null==t?void 0:t.groupTranslations().length)&&void 0!==n?n:1)>1?`${e} all translation regions`:`${e} translation`}var Nn=n(502703),An=n(294538)
function blastBases(e,t){(0,S.Gp)(dt.ZP.MOLBIO_ENABLE_EXTERNAL_BLAST,"Cannot blast without MOLBIO_ENABLE_EXTERNAL_BLAST flag on")
function doBlast(){const n=o().param({PAGE_TYPE:"BlastSearch",USER_FORMAT_DEFAULTS:"on",PAGE:"MegaBlast",PROGRAM:"blastn",QUERY:e,JOB_TITLE:`Benchling Query: ${t}`,GAPCOSTS:"0%200",MATCH_SCORES:"1,-2",DATABASE:"nr",BLAST_PROGRAMS:"megaBlast",MAX_NUM_SEQ:"100",SHORT_QUERY_ADJUST:"on",EXPECT:"10",WORD_SIZE:"28",REPEATS:"repeat_9606",TEMPLATE_TYPE:"0",TEMPLATE_LENGTH:"0",FILTER:"m",SHOW_OVERVIEW:"on",SHOW_LINKOUT:"on",ALIGNMENT_VIEW:"Pairwise",MASK_CHAR:"2",MASK_COLOR:"1",GET_SEQUENCE:"on",NUM_OVERVIEW:"100",DESCRIPTIONS:"100",ALIGNMENTS:"100",FORMAT_OBJECT:"Alignment",FORMAT_TYPE:"HTML",OLD_BLAST:"false"})
return window.open(`http://blast.ncbi.nlm.nih.gov/Blast.cgi?${n}`,"_blank")}if(window.MOLBIO_ENABLE_EXTERNAL_BLAST_CONFIRMATION_MODAL){const e="blast.ncbi.nlm.nih.gov"
return new Ot.I4({title:"NCBI Blast",msg:`This will send the selected sequence to <a href='http://${e}'>${e}</a>. Do you want to continue?`}).choice("Yes","btn-af-primary",doBlast).choice("Cancel","btn-af-default").show()}return doBlast()}function blastSequence(e){const t=e.get("selection"),n=t.start(),a=t.end()
return blastBases(e.get("dna").slice(n,a)[0].bases,e.name())}const blastPrimer=e=>blastBases(e.bases(),e.name())
var Rn=n(776065),Pn=n(45717),On=n(780365),xn=n(291535),_n=n(129270),Dn=n(736957),Ln=n(854185),kn=n(510847)
function groupArray(e,t){const n=[]
for(const[a,i]of e.entries()){const e=Math.floor(a/t)
n[e]=n[e]||[]
n[e].push(i)}return n}function CodonCell({codon:e,selectCodon:t,current:n,abbreviationFormat:a}){const[i,s]=(0,d.useState)(!1)
return d.createElement("tr",{key:e.bases,className:f()(`codon-bases-${e.bases}`,(0,g.iv)(Mn.codonRow)),style:{backgroundColor:n||i?e.color:"transparent"},onClick:()=>{t(e.bases)},onMouseOver:()=>{s(!0)},onMouseLeave:()=>{s(!1)}},d.createElement("td",{className:f()("bases",(0,g.iv)(Mn.codonBases,Mn.monospaced))},e.bases),d.createElement("td",{className:f()("abbreviation",(0,g.iv)(Mn.abbreviation))},e[a]),d.createElement("td",{className:f()("fraction",(0,g.iv)(Mn.frequencyNumber,Mn.monospaced))},e.fraction||"-"),d.createElement("td",{className:f()("frequency",(0,g.iv)(Mn.frequencyNumber,Mn.monospaced))},e.frequency||"-"))}function CodonTable(e){const[t,n]=(0,Ln.Z)(On.Qv.MODAL_ORGANISM),[a,i]=(0,Ln.Z)(Pn.AMINO_ACID_ABBREVIATION_PREF_KEY),setFormat=e=>{const t=e.target.value
i(t)},s=groupArray(groupArray((0,kn.Gp)(t,e.colorScheme),4),4),r=t&&(0,kn.ET)(t)
return d.createElement("div",{className:(0,g.iv)(Mn.mainContainer)},d.createElement("div",{className:"u-lr-split u-small-spacing-bottom"},d.createElement("label",{className:"u-vertical-center-items"},d.createElement("span",{className:"u-mini-spacing-right"},"Organism"),d.createElement(xn.Z,{className:(0,g.iv)(Mn.organismDropdown),selected:t,onChange:n})),d.createElement("div",null,d.createElement("label",{className:"radio-inline radio-inline--labelAligned"},d.createElement("input",{type:"radio",name:"amino-acid-abbreviation",checked:a===Pn.AbbreviationFormat.TRIPLE_LETTER,value:Pn.AbbreviationFormat.TRIPLE_LETTER,onChange:setFormat}),"Three-letter"),d.createElement("label",{className:"radio-inline radio-inline--labelAligned"},d.createElement("input",{type:"radio",name:"amino-acid-abbreviation",checked:a===Pn.AbbreviationFormat.SINGLE_LETTER,value:Pn.AbbreviationFormat.SINGLE_LETTER,onChange:setFormat}),"Single-letter"))),d.createElement("table",{className:f()("table-condensed",(0,g.iv)(Mn.outerTable))},d.createElement("tbody",null,s.map(((t,n)=>d.createElement("tr",{key:n},t.map(((t,i)=>d.createElement("td",{className:(0,g.iv)(Mn.innerTableCell,3===n&&Mn.noBorderBottom,3===i&&Mn.noBorderRight),key:i},d.createElement("table",{className:f()("table-condensed",(0,g.iv)(Mn.innerTable))},0===n&&d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",{className:(0,g.iv)(Mn.codonBases)},"Codon"),d.createElement("th",{className:(0,g.iv)(Mn.abbreviation)},"AA"),d.createElement("th",{className:(0,g.iv)(Mn.frequencyNumber)},"Frac."),d.createElement("th",{className:(0,g.iv)(Mn.frequencyNumber)},"Freq."))),d.createElement("tbody",null,t.map((t=>d.createElement(CodonCell,{key:t.bases,codon:t,current:e.selectedCodon===t.bases,selectCodon:e.selectCodon,abbreviationFormat:a}))))))))))))),d.createElement("aside",{className:"u-small-spacing-top"},d.createElement("span",null,d.createElement("b",null,"Frac.")," = the abundance of this codon relative to all codons for this amino acid"),d.createElement("br",null),d.createElement("span",null,d.createElement("b",null,"Freq.")," = the average frequency of this codon's appearance per 1000 codons in the organism"),d.createElement("br",null),r&&d.createElement("span",null,d.createElement("b",null,"Source:")," ",d.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:r},r))))}function CodonTableModal(e){return d.createElement(et.ZP,{large:!0,title:"Change Amino Acid",onRequestClose:e.onRequestClose,buttons:[{text:"Cancel",cancel:!0}]},d.createElement(CodonTable,{selectedCodon:e.codon,selectCodon:e.onRequestSubmit,colorScheme:e.colorScheme}))}const Mn=g.mM.create({mainContainer:{width:"700px",margin:"auto"},organismDropdown:{width:"300px"},outerTable:{tableLayout:"fixed"},innerTableCell:{borderRight:`1px solid ${Dn.Pg}`,borderBottom:`1px solid ${Dn.Pg}`,margin:0,padding:0},innerTable:{width:"175px",tableLayout:"fixed"},codonRow:{cursor:"pointer",".selected":{fontWeight:_n.KB}},codonBases:{width:"30%",textAlign:"center"},abbreviation:{width:"20%"},frequencyNumber:{width:"25%"},monospaced:{fontFamily:_n.HG},noBorderBottom:{borderBottom:0},noBorderRight:{borderRight:0}})
var Fn=n(171705),Zn=n(530302),Bn=n(749183),qn=n(240870),Vn=n(166459),Un=n(256039),Gn=n(204300),zn=n(961199)
var $n=n(473287),Wn=n(773364),Hn=n(497790),jn=n(365699),Yn=n(555315),Qn=n(617886),Kn=n(62315),Jn=n(788836),Xn=n(502633),ea=n(379346),ta=n(88823)
function openOrCreateBiochemicalPropertiesTab(e,t,n=1){const a=ve.ZP.get().get(e.id),i=a.findTab($n.N)
i?i.set({active:!0,strand:n,codonTranslationTable:t}):a.buffers().addTab(new $n.N({polymer:e,closeable:!0,strand:n,codonTranslationTable:t}))
m.L9(j.Jg.OPENED_BIOCHEMICAL_PROPERTIES_TAB_ON_DNA,{polymerId:e.id,direction:(0,An.FC)(n).toLowerCase(),codonTranslationTable:t})}function getOpenPartMenuOption(e,t){return{name:"Open part",click(){(0,S.hu)(e.selectionContainedInPart(),`Expected selection with endpoints ${e.selection().start()}, ${e.selection().end()} to be contained in a part.`)
let n=(t||getSinglePart(e)).sequence().get("id")
const a=`${ea.ZP.typeToApiPrefix(st.SEQUENCE)}_`
n.startsWith(a)||(n=`${a}${n}`)
ve.ZP.get().openFolderItem(n)},disabled:()=>!canOpenPartAtSelectionStart(e,t),hide:()=>!shouldShowPartMenu(e,t)}}function getUnlinkPartMenuOption(e,t){return{name:"Unlink part",click(){(0,S.hu)(e.selectionContainedInPart(),`Expected selection with endpoints ${e.selection().start()}, ${e.selection().end()} to be contained in a part.`)
const n=t||getSinglePart(e)
e.unlinkPart(n).fail((e=>{v.ZP.notifyError(e)}))},disabled:()=>!function canUnlinkPartAtSelectionStart(e,t){const n=dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS?e.allowFeatureEdits():e.allowResidueEdits()
return canOpenPartAtSelectionStart(e,t)&&n}(e,t),hide:()=>!shouldShowPartMenu(e,t)}}function getSelectPartMenuOption(e,t){return{name:"Select part",click(){e.selection().setEndpoints(t.start(),t.end())}}}function buildCollapsibleMenu(e,t,n,a){const i=n.isSingleStranded()
const s={createRNAFromSelection:function generateRNACreationChoice(e,t){return{click(){n.handleCreateFromSelectionClick(fn.uS.SINGLE_STRANDED,e)},disabled:()=>null==Jn.Z.currentUser(),hide:()=>!(0,ln.cr)({feature:rn.N7.CREATE,itemType:st.SEQUENCE}),dataTestAttrs:{component:"ContextMenu",element:1===e?"createForwardRNASequence":"createReverseRNASequence"}}},createTranslation:function generateTranslationCreationChoice(e,t){return{async click(){t||trackOpenTranslationPanel(n,e)
await n.createTranslation(e)},disabled:()=>!n.allowFeatureEdits(),dataTestAttrs:{component:"ContextMenu",element:1===e?"createForwardTranslation":"createReverseTranslation"}}},createProtein:function generateProteinCreationChoice(e,t){return{click(){n.handleCreateProteinFromSelectionClick(e)},disabled:()=>null==Jn.Z.currentUser(),hide:()=>!(0,ln.cr)({feature:rn.N7.CREATE,itemType:st.PROTEIN}),dataTestAttrs:{component:"ContextMenu",element:1===e?"createForwardProtein":"createReverseProtein"}}}}
let r={createRNAFromSelection:{name:"Create RNA sequence",disabled:()=>null==Jn.Z.currentUser(),hide:()=>!(0,ln.cr)({feature:rn.N7.CREATE,itemType:st.SEQUENCE})||n.isOligo(),dataTestAttrs:{component:"ContextMenu",element:"createRNAFromSelection"}},createTranslation:{name:"Create translation...",hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})||!n.supportsTranslations(),dataTestAttrs:{component:"ContextMenu",element:"createTranslation"}},createProtein:{name:"Create AA sequence...",hide:()=>!(0,ln.cr)({feature:rn.N7.CREATE,itemType:st.PROTEIN})||n.isOligo(),dataTestAttrs:{component:"ContextMenu",element:"createProtein"}}}[e]
const o=s[e]
if(i&&!("createTranslation"===e&&t))r={...o(1,t),...r,name:r.name.replace("...","")}
else{let e=[{...o(1,t),name:"Forward"},{...o(-1,t),name:"Reverse",hide:()=>i}]
a&&(e=e.concat(a))
r={...r,menu:e}}return r}function menuChoices(e,t){var n
const a=e.selection().length(),i=a%3==0&&0!==a,s=e.isRNASequence(),r=function hasAlignmentModel(e){var t
return Boolean(null===(t=e.model)||void 0===t?void 0:t.has("alignment"))}(t),showingBaseQualityCasing=()=>{if(t.model){const e=t.model.get("visibilityOptions").getOption(Yt.bK.name)
return e&&e.get("visible")}return!1}
return{reindex:{name:"Re-index",click:()=>new wn({sequence:e}).show(),disabled:()=>!e.allowResidueEdits()||e.selectionContainedInPart(),hide:()=>!t.circular||Boolean(t.alignment)||!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},addToFeatureLibrary:{name:"Add to Feature Library",click(){(0,S.hu)(null!=t.annotation,"Expected annotation to be provided in menu options.")
!async function addToFeatureLibraryHandler(e,t){let n=y.slice(e.get("dna").forward(),t.start(),t.end(),e.circular());-1===t.strand()&&(n=y.revcomp(n,e.get("_sequence").baseTable()))
const a=await(0,Xn.Z)(Zn.Z,{annotationResidues:n})
null!=a&&await(0,Bn.FR)(t,e,a).done((()=>{v.ZP.success("Feature successfully added to library.")})).fail((e=>{v.ZP.notifyError(e)}))}(e,t.annotation)},disabled:()=>null==Jn.Z.currentUser(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_ADMIN})},changeAminoAcid:{name:"Change amino acid",async click(){const{translation:n,mapstate:a}=t;(0,S.hu)(null!=n,"Expected to receive translation when changing amino acid.")
let i=Wn.yy.RASMOL
a?i=a.get("visibilityOptions").getOption(Yt.KL.name).getSetting(Yt.gl.name).get("value"):(0,S.hu)(!1,"Unexpectedly got null mapstate when checking translation color scheme setting")
const s=function translateCodon(e,t){let n
const[a,i]=e.get("selection").getEndpoints();(0,S.hu)(null!=i,"Expected selection end to be non-null when translating codon.")
1===t.strand()?({bases:n}=e.get("dna").forwardSlice(a,i)):n=e.get("dna").reverseSlice(a,i).bases.split("").reverse().join("")
return n.toUpperCase()}(e,n),r=await(0,Xn.Z)(CodonTableModal,{codon:s,colorScheme:i})
if(!r)return
const o=e.selection(),l=e._sequence(),c=-1===n.strand()?Ue.util.revcomp(r,R.jb):r,[d,u]=o.getEndpoints();(0,S.hu)(null!=u,"Expected to receive non-null selection end when changing amino acid.")
if(!ye.Z.of(l).canReplace(l,o,c,(e=>{v.ZP.warn(e)})))return
m.j("editor","replaced_bases",{source:"change-amino-acid-modal",bases:c})
const p=e.replace(d,u,c)
p.fail((e=>{v.ZP.notifyError(e)}))
p.client.done((()=>{o.setEndpoints(d,u)}))
null!=ye.Z.of(l).assemblyType&&Promise.resolve(p).then((()=>{o.setEndpoints(d,u)
ye.Z.of(l).didReplace(l,o,c,(e=>{v.ZP.success(e)}),(e=>{v.ZP.error(e)}))}))},disabled(){var n,a
return!e.allowResidueEdits()||!e.isSelectionEditable()||e.selection().isEmpty()||e.selection().length()>3||!(null===(n=t.translation)||void 0===n?void 0:n.selected())||(null===(a=t.translation)||void 0===a?void 0:a.codonTranslationTable(e))!==R.hR.STANDARD},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},insertBases:{name:"Insert bases",click(){qn.ZP.showInputBubble(t.polymerMapTabView)},disabled:()=>!e.allowResidueEdits()||!e.canInsertAt(e.selection().start()),hide(){if(t.polymerMapTabView)return!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT});(0,S.Gp)(!1,"No polymerMapTabView passed to selectioncontextmenu options for insert bases")
return!0}},deleteBases:{name:"Delete bases",click(){e.deleteSelection()},disabled:()=>!e.allowResidueEdits()||!e.isSelectionDeletable(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},createAnnotation:{name:"Create annotation",click(){trackOpenAnnotationPanel(e,"context_menu_create")
e.selection().trigger("annotation")},disabled:()=>!e.allowFeatureEdits(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT}),dataTestAttrs:{component:"ContextMenu",element:"createAnnotation"}},deleteAnnotation:{name:"Delete annotation",async click(){(0,S.hu)(null!=t.annotation,"Expected to receive annotation in menu options.")
trackChoice("deleted_annotation")
await e.deleteFeature(t.annotation)},disabled(){var n
return!e.allowFeatureEdits()||!(null===(n=t.annotation)||void 0===n?void 0:n.editable())},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},editAnnotation:{name:"Edit annotation",click(){trackOpenAnnotationPanel(e,"context_menu_edit")
e.selection().trigger("annotation",t.annotation)},disabled(){var n,a
return!e.allowFeatureEdits()||!(null===(n=t.annotation)||void 0===n?void 0:n.editable())||(null===(a=t.annotation)||void 0===a?void 0:a.isNew())},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},invertSelection:{name:"Invert selection",click(){e.selection().invert()},disabled:()=>!e.selection().canInvert(),close(e){o()(e).focus()},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},copyTranslationGroup:{name:getTranslationMenuActionName("Copy",t.translation),copy(){const{translation:n}=t;(0,S.hu)(null!=n,"Expected to receive a translation in options.")
const a=n.getTranslationRegionGroup(e);(0,S.hu)(null!=a,"Expected translation region group to be found")
const i=a.translations.map((t=>e.residueSlice(t.start,t.end))).join("")
trackChoice("copied_translation_group")
return y.translateOnStrand(i,n.strand(),e.nucleotideType(),n.codonTranslationTable(e),!0)}},analyzeTranslation:{name:"Analyze translation",click(){(0,S.hu)(null!=t.translation,"Translation to analyze was not provided in options.")
const n=t.translation.start(),a=t.translation.end()
e.selection().setEndpoints(n,a)
openOrCreateBiochemicalPropertiesTab(e,t.translation.codonTranslationTable(e),t.translation.strand())},hide:()=>t.mapstate instanceof En.CE||!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},analyzeSelectionAsTranslation:{name:"Analyze as translation",click(){openOrCreateBiochemicalPropertiesTab(e,R.hR.STANDARD)},hide:()=>Boolean(t.alignment)||!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})||e.isOligo()},deleteTranslation:{name:"Delete this translation region",async click(){(0,S.hu)(null!=t.translation,"Translation to delete was not provided in options.")
trackChoice("deleted_translation")
await e.deleteFeature(t.translation)
v.ZP.success("Successfully deleted translation region.")},disabled(){var n
return!e.allowFeatureEdits()||!(null===(n=t.translation)||void 0===n?void 0:n.editable())},hide(){var n
const a=null===(n=t.translation)||void 0===n?void 0:n.getTranslationRegionGroup(e)
return!a||1===a.translations.length||!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})}},deleteTranslationGroup:{name:getTranslationMenuActionName("Delete",t.translation),async click(){(0,S.hu)(null!=t.translation,"Translation with group to delete was not provided in options.")
const n=t.translation.translationGroupId()
if(null==n){await e.deleteFeature(t.translation)
v.ZP.success("Successfully deleted translation.")
return}const a=e.tagSchema()
if(await(0,Nn.am)(a,!1,t.translation.codonTranslationTable(e)!==R.hR.STANDARD,1)){e.deleteTranslationGroup(n).done((()=>{v.ZP.success("Successfully deleted translation group.")})).fail((e=>{v.ZP.notifyError(e)}))
trackChoice("deleted_translation_group")}},disabled(){var n
return!e.allowFeatureEdits()||!t.translation||!(null===(n=t.translation.getTranslationRegionGroup(e))||void 0===n?void 0:n.editable)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},toggleTranslationAA:{name:"Toggle AA positions",click(){(0,S.hu)(null!=t.mapstate,"options.mapstate must be provided to toggle AA positions.")
const e=t.mapstate.get("visibilityOptions").getOption(Yt.tO.name)
e.set({visible:!e.get("visible")})
trackChoice("toggled_aa_indices")},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},insertPart:{name:"Insert part",click(){new gn({sequence:e}).show()},disabled:()=>!e.allowResidueEdits()||!e.canInsertAt(e.selection().start())||!e.canInsertPart(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},replacePart:{name:"Replace part",click(){const t=getSinglePart(e)
new gn({sequence:e,oldPart:t}).show()},disabled:()=>!canDeleteOrReplacePartAtSelectionStart(e),hide:()=>!shouldShowPartMenu(e)},openPart:getOpenPartMenuOption(e,null),flipPart:{name:"Flip part",click(){(0,S.hu)(e.selectionContainedInPart(),`Expected selection with endpoints ${e.selection().start()}, ${e.selection().end()} to be contained in a part.`)
const t=getSinglePart(e),n=!t.reversed(),a=!t.complemented()
e.editPart(t,{reverse:n,complement:a})},disabled:()=>!function canEditPartAtSelectionStart(e){const t=e.getSequencePartsAtSelectionStart()
return canOpenPartAtSelectionStart(e)&&e.allowResidueEdits()&&t[0].isInSync(e._sequence())&&!e.partHasOverlaps(t[0])}(e),hide:()=>!shouldShowPartMenu(e)||e.isSingleStranded()},deletePart:{name:"Delete part",click(){(0,S.hu)(e.selectionContainedInPart(),`Expected selection with endpoints ${e.selection().start()}, ${e.selection().end()} to be contained in a part.`)
const t=getSinglePart(e)
e.deletePart(t).fail((e=>{v.ZP.notifyError(e)}))},disabled:()=>!canDeleteOrReplacePartAtSelectionStart(e),hide:()=>!shouldShowPartMenu(e)},unlinkPart:getUnlinkPartMenuOption(e,null),setTrim:{name:"Trim...",dataTestAttrs:{component:"ContextMenu",element:"trim"},menu:[{name:"To Start",click(){setTrimFromSelection(e,e.get("trim"),yt.Eg.START)},disabled:()=>!e.allowResidueEdits()},{name:"To End",click(){setTrimFromSelection(e,e.get("trim"),yt.Eg.END)},disabled:()=>!e.allowResidueEdits(),dataTestAttrs:{component:"ContextMenu",element:"trim",key:"toEnd"}},{name:"To selection",click(){setTrimFromSelection(e,e.get("trim"),yt.Eg.BOTH)},disabled:()=>!e.allowResidueEdits()||e.selection().isEmpty()},{name:"To start (all sequences)",click(){(0,S.hu)(null!=t.tabstate,"Expected tabstate option to be passed for setting trim on all sequences")
setAllTrimsFromSelection(e,t.tabstate,yt.Eg.START)},disabled:()=>!e.allowResidueEdits()},{name:"To end (all sequences)",click(){(0,S.hu)(null!=t.tabstate,"Expected tabstate option to be passed for setting trim on all sequences")
setAllTrimsFromSelection(e,t.tabstate,yt.Eg.END)},disabled:()=>!e.allowResidueEdits()},{name:"To selection (all sequences)",click(){(0,S.hu)(null!=t.tabstate,"Expected tabstate option to be passed for setting trim on all sequences")
setAllTrimsFromSelection(e,t.tabstate,yt.Eg.BOTH)},disabled:()=>!e.allowResidueEdits()||e.selection().isEmpty()}],hide:()=>!t.hasTrim||!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},createAlignmentComment:{name:"Create comment",click(){(0,S.hu)(null!=t.tabstate,"Expected tabstate option to be passed for adding alignment comment")
const n=new Rt.A({start:e.selection().start(),end:e.selection().end()})
t.tabstate.get("analysis").get("alignmentComments").add(n)
n.trigger("open",n)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},editAlignmentComment:{name:"Edit comment",click(){(0,S.hu)(null!=t.comment,"Comment to edit was not provided in options.")
t.comment.trigger("open",t.comment)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},deleteAlignmentComment:{name:"Delete comment",click(){(0,S.hu)(null!=t.comment,"Comment to delete was not provided in options.")
t.comment.destroy()},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},createTranslation:buildCollapsibleMenu("createTranslation",r,e,[{name:"Forward (all sequences)",click(){t.tabstate.createAllTranslation(1)},disabled:()=>!e.allowFeatureEdits(),hide:()=>!r},{name:`Reverse (all ${r&&(null===(n=t.tabstate)||void 0===n?void 0:n.containsRnaSequence())?"DNA ":""}sequences)`,click(){t.tabstate.createAllTranslation(-1)},disabled:()=>!e.allowFeatureEdits(),hide:()=>e.isSingleStranded()||!r,dataTestAttrs:{component:"ContextMenu",element:"createTranslation",key:"reverseAllSequences"}}]),createProtein:buildCollapsibleMenu("createProtein",r,e),createProteinFromTranslation:{name:"Create AA sequence...",menu:[{name:"All translation regions",click(){(0,S.hu)(null!=t.translation,"Expected to receive a translation in options.")
e.handleCreateProteinFromTranslationClick(t.translation)},disabled:()=>null==Jn.Z.currentUser()}],disabled:()=>null==Jn.Z.currentUser(),hide:()=>!(0,ln.cr)({feature:rn.N7.CREATE,itemType:st.PROTEIN})},toggleCase:{name:"Change case...",menu:[{name:"To UPPERCASE",click(){toggleCaseHandler(e,"upper")},disabled:()=>!e.allowResidueEdits()||!e.isSelectionEditable()||showingBaseQualityCasing()},{name:"To lowercase",click(){toggleCaseHandler(e,"lower")},disabled:()=>!e.allowResidueEdits()||!e.isSelectionEditable()||showingBaseQualityCasing()}],hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},showPrimer:{name:"Show primer",click:()=>e.selection().trigger("primer",t.primer),disabled(){var e
return null==(null===(e=t.primer)||void 0===e?void 0:e.id)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},openPrimer:{name:"Open primer",click(){(0,S.hu)(null!=t.primer,"Primer was not provided in options.")
Rn.Z.openFile(t.primer.get("_primer").get("primer_api_id"))},disabled(){var e
return null==(null===(e=t.primer)||void 0===e?void 0:e.id)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},editPrimer:{name:"Edit primer",click(){(0,S.hu)(null!=t.primer,"Primer was not provided in options.")
sn.edit(t.primer.get("_primer"),e)},disabled(){var n
return!e.allowFeatureEdits()||!(null===(n=t.primer)||void 0===n?void 0:n.editable())},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},deletePrimer:{name:"Detach primer",click(){(0,S.hu)(null!=t.primer,"Primer was not provided in options.")
const n=t.primer.name()
t.primer.destroy().done((()=>{e.updateVersions()})).fail((e=>{v.ZP.notifyError(e)}))
trackChoice("detached_primer",{name:n})},disabled(){var n
const a=e._sequence()
return!e.allowFeatureEdits()||!(null===(n=t.primer)||void 0===n?void 0:n.editable())||ye.Z.of(a).isFlankingPrimer(a,t.primer)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},primerStructure:{name:"Check primer structure",click(){const n=e.selection()
if(n.canPCR()){const t=n.getStartState("primer").get("_primer"),a=n.getEndState("primer").get("_primer")
sn.editPair(t,a,e,!0)}else{(0,S.hu)(null!=t.primer,"Primer was not provided in options.")
sn.edit(t.primer.get("_primer"),e,!0)}},disabled:()=>null==e.fileState()||null==(null!=t.primer?t.primer.id:void 0)&&!e.selection().canPCR(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},showEnzyme:{name:"Show enzyme",click(){e.selection().trigger("cutsite",t.cutsite)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},createFromSelection:{name:"Create DNA sequence",id:"createSequenceContextMenuOption",click(){e.handleCreateFromSelectionClick(fn.uS.DOUBLE_STRANDED)},disabled:()=>null==Jn.Z.currentUser(),hide:()=>!(0,ln.cr)({feature:rn.N7.CREATE,itemType:st.SEQUENCE})||e.isOligo()},createRNAFromSelection:buildCollapsibleMenu("createRNAFromSelection",r,e),optimizeCodons:{name:"Optimize codons",menu:[{name:i?"Forward":"Forward (selection isn't a multiple of 3)",click(){e.handleOptimizeCodonsFromSelectionClick(1)},disabled:()=>!i||!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE}),dataTestAttrs:{component:"ContextMenu",element:"optimizeCodons",key:"forward"}},{name:i?"Reverse":"Reverse (selection isn't a multiple of 3)",click(){e.handleOptimizeCodonsFromSelectionClick(-1)},disabled:()=>!i||!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})}],hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})||s,dataTestAttrs:{component:"ContextMenu",element:"optimizeCodons",key:"submenu"}},createPartFromSelection:function(){let t
t=(null!=e?e.tagSchema():void 0)?e.tagSchema().fields.filter((e=>e.fieldType===Hn.FIELD_TYPES.PART_LINK.type)):[]
return t.length>0?{name:"Create new part...",menu:[...t.map((t=>!t.isMulti&&e.tags().some((e=>e.name===t.name&&e.targetFiles&&e.targetFiles.length>0))?{name:`${t.name} (already specified)`,disabled:()=>!0}:{name:t.name,click(){e.handleCreatePartFromSelectionClick(t.id)},disabled:()=>isCreateNewPartFromSelectionDisabled(e)})),"-",{name:"No schema",click(){e.handleCreatePartFromSelectionClick(null)},disabled:()=>isCreateNewPartFromSelectionDisabled(e)}],disabled:()=>isCreateNewPartFromSelectionDisabled(e),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})}:{name:"Create new part",id:"createPartContextMenuOption",click(){e.handleCreatePartFromSelectionClick(null)},disabled:()=>isCreateNewPartFromSelectionDisabled(e),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})||!e.supportsParts()}}(),createPrimer:{name:"Create primer...",menu:[{name:"Forward",click(){trackCreatePrimer(e,"forward")
const t=sn.createFromSelection(e,1)
e.fileState().buffers().addTab(t)},disabled:()=>!e.allowFeatureEdits(),dataTestAttrs:{component:"ContextMenu",element:"createPrimer",key:"forward"}},{name:"Reverse",click(){trackCreatePrimer(e,"reverse")
const t=sn.createFromSelection(e,-1)
e.fileState().buffers().addTab(t)},disabled:()=>!e.allowFeatureEdits()}],hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})||Boolean(t.alignment)||!e.supportsPrimers(),dataTestAttrs:{component:"ContextMenu",element:"createPrimer"}},linkPrimers:{name:"Link primers",click(){createPrimerPair(e)},disabled:()=>!e.allowFeatureEdits(),hide:()=>!canCreatePrimerPair(e)},showPair:{name:"Show primer pair",click:()=>e.selection().trigger("showLinks"),hide:()=>!existingPrimerPairSelected(e)},editPair:{name:"Edit primer pair",click(){const t=e.selection().getStartState("primer").get("_primer"),n=e.selection().getEndState("primer").get("_primer")
sn.editPair(t,n,e)},disabled:()=>!e.allowFeatureEdits(),hide:()=>!existingPrimerPairSelected(e)},findFlankingPrimers:{name:"Run Primer3",click(){e.handlePrimer3FromSelectionClick()},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT}),disabled:()=>!e.allowFeatureEdits()},copy:{name:"Copy",click(){e.handleCopy((0,Fn.Cd)(e))},disabled:()=>!e.selection().isCopyable()},copySpecial:{name:"Copy special...",menu:[{name:"Reverse complement",click(){e.handleCopy(e.nucleotideType()===y.NucleotideType.DNA?Fn.nx.DNA_REVERSE_COMPLEMENT:Fn.nx.RNA_REVERSE_COMPLEMENT)},disabled:()=>!e.selection().isCopyable()},"-",{name:"Translation",click(){e.handleCopy(Fn.nx.TRANSLATION)},disabled:()=>!e.selection().isCopyable()},{name:"Reverse translation",click(){e.handleCopy(Fn.nx.REVERSE_COMPLEMENT_TRANSLATION)},disabled:()=>!e.selection().isCopyable()},{name:e.nucleotideType()===y.NucleotideType.DNA?"RNA sequence":"DNA sequence",click(){e.handleCopy(e.nucleotideType()===y.NucleotideType.DNA?Fn.nx.RNA:Fn.nx.DNA)},disabled:()=>!e.selection().isCopyable()},{name:e.nucleotideType()===y.NucleotideType.DNA?"RNA reverse complement":"DNA reverse complement",click(){e.handleCopy(e.nucleotideType()===y.NucleotideType.DNA?Fn.nx.RNA_REVERSE_COMPLEMENT:Fn.nx.DNA_REVERSE_COMPLEMENT)},disabled:()=>!e.selection().isCopyable()},{name:"HELM",click(){e.handleCopy(Fn.nx.HELM)},disabled:()=>!e.selection().isCopyable()||e.selection().getSelectionResidues().includes("-"),hide:()=>!e.supportsChemicalMods(),dataTestAttrs:{component:"ContextMenu",element:"copySpecialHELM"}}],dataTestAttrs:{component:"ContextMenu",element:"copySpecial"}},"-":"-",benchlingBlast:{name:jn.Y6,async click(){await(0,Yn.ld)(e.selection())},disabled:()=>null==Jn.Z.currentUser()||!(0,Qn.H_)(e.selection().getSelectionResidues(),Kn.EF.BLASTN).isValid,hide:()=>e.selection().isEmpty()||!dt.ZP.ENABLE_BLAST_SEARCH},ncbiBlast:{name:jn.wL,click:()=>null!=t.primer?blastPrimer(t.primer):blastSequence(e),disabled:()=>!e.selection().isBlastable(),hide:()=>!dt.ZP.MOLBIO_ENABLE_EXTERNAL_BLAST||!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},addChemicalModifications:{name:"Add modifications",click(){!function handleEditFromSelection(e,t){const n=(0,Jt.w6)(t.start(),t.end()-1);(0,Vn.getStore)().dispatch((0,zn.z4)(e.id));(0,Vn.getStore)().dispatch((0,zn.xj)(e.id,e.selection().start()));(0,Vn.getStore)().dispatch((0,zn.wM)(e.id,n))
Xe.bA(Gn.Z,d.createElement(Gn.W,{initialSugarId:Un.q_.CHOOSING,initialBaseId:Un.q_.CHOOSING,initialPhosphateId:Un.q_.CHOOSING,positions:new Set(n),nucleotideType:e.nucleotideType(),onSubmit:t=>{e.bulkSetMods({rules:[t]});(0,Vn.getStore)().dispatch((0,zn.z4)(e.id))},onClose:()=>{(0,Vn.getStore)().dispatch((0,zn.z4)(e.id))},sequenceId:e.get("id")}))}(e,e.selection())},disabled:()=>!e.allowResidueEdits(),hide:()=>!e.supportsChemicalMods()},editTranslation:{name:"Edit translation",click(){trackOpenTranslationPanel(e,null)
e.selection().trigger("translation-panel",null,t.translation)},disabled:()=>!e.allowFeatureEdits()||null==t.translation||!t.translation.editable()||t.translation.isNew(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})}}}const na=["editAnnotation","deleteAnnotation","addToFeatureLibrary","-","copy","copySpecial","toggleCase","deleteBases","-","createPartFromSelection","createPrimer","createFromSelection","createRNAFromSelection","createTranslation","createProtein","-","benchlingBlast","ncbiBlast","analyzeSelectionAsTranslation"],aa=["copy","copySpecial"],ia=["showEnzyme"],sa=["insertBases"],ra=["openPart","flipPart","deletePart","replacePart","unlinkPart","-","reindex","insertBases","insertPart","-","setTrim"],oa=["showPrimer","openPrimer","editPrimer","deletePrimer","primerStructure","-","copy","copySpecial","toggleCase","deleteBases","-","createPartFromSelection","createFromSelection","createRNAFromSelection","createTranslation","createProtein","-","benchlingBlast","ncbiBlast"],la=["copy","copySpecial","toggleCase","deleteBases","-","createAnnotation","addChemicalModifications"]
function getSelectionMenu(e={alignment:!1}){let t=["openPart","flipPart","deletePart","replacePart","unlinkPart","-","copy","copySpecial","toggleCase","deleteBases","invertSelection","-","createAlignmentComment","createAnnotation","createPrimer","linkPrimers","showPair","editPair","createPartFromSelection","createFromSelection","createRNAFromSelection","createTranslation","createProtein","addChemicalModifications","-","setTrim","-","findFlankingPrimers","benchlingBlast","ncbiBlast","analyzeSelectionAsTranslation","-","optimizeCodons"]
t=e.alignment?l.default.without(t,"createAnnotation","createPrimer","findFlankingPrimers"):l.default.without(t,"createAlignmentComment","setTrim")
return t}const ca=["editAlignmentComment","deleteAlignmentComment"],da=["copyTranslationGroup","analyzeTranslation","editTranslation","deleteTranslation","deleteTranslationGroup","createProteinFromTranslation","-","copy","copySpecial","deleteBases","toggleCase","-","benchlingBlast","ncbiBlast"],ua=["changeAminoAcid","toggleTranslationAA",...da]
function SelectionContextMenu_open(e,t,n,a={}){function closeMenu(){ta.e.close()}function listenerBind(e){l.default.chain(a).values().filter((e=>e instanceof s().Model)).uniq().each((t=>{e?t.on("destroy remove",closeMenu):t.off("destroy remove",closeMenu)}))
e?t.selection().on("change:start change:end",closeMenu):t.selection().off("change:start change:end",closeMenu)}if(t._sequence().canOpenSelectionContextMenu()){listenerBind(!0)
const i=function getMenuChoicesWithPartsSubmenus(e,t,n){const a=menuChoices(t,n),i=Array.from(e).map((e=>a[e]))
if(e.includes("openPart")){const e=t.parts().map((e=>({name:e.name(),menu:[getSelectPartMenuOption(t,e),getOpenPartMenuOption(t,e),getUnlinkPartMenuOption(t,e)],hide:()=>!function shouldShowMultiPartMenu(e,t){const n=e.getSequencePartsInSelection()
return n.length>1&&e.selectionContainedInPart()&&n.includes(t)}(t,e)})))
return[...e,...i]}return i}(n,t,a)
ta.e.once("close",(()=>{listenerBind(!1)}))
return ta.e.open(e,i)}e.stopPropagation()
e.preventDefault()
return!1}class TooltipBar extends d.Component{constructor(){super(...arguments)
this.proteinBarRef=d.createRef()
this._tooltipOptions=()=>({title:this.props.title,placement:"top",container:"body",trigger:"hover"})}componentDidMount(){this.props.disableTooltip||o()(this.proteinBarRef.current).tooltip(this._tooltipOptions())}componentDidUpdate(e,t){if(!this.props.disableTooltip&&e.title!==this.props.title){o()(this.proteinBarRef.current).attr("data-original-title",this.props.title)
o()(this.proteinBarRef.current).tooltip("fixTitle")}}componentWillUnmount(){this.props.disableTooltip||o()(this.proteinBarRef.current).tooltip("destroy")}render(){return d.createElement("rect",{ref:this.proteinBarRef,className:this.props.className,x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height})}}const components_TooltipBarGraph=e=>{const t=`M ${e.xFunc(0)} ${e.maxHeight}`,n=`L ${e.xFunc(e.values.length)} ${e.maxHeight}`
return d.createElement("g",null,e.values.map(((t,n)=>{const a=t||0,i=null==t?"N/A":t.toFixed(2)
return d.createElement(TooltipBar,{key:n,title:`${e.propertyName}: ${i}`,x:e.xFunc(n),y:e.maxHeight*(1-a),width:e.xFunc(1)-e.xFunc(0),height:e.maxHeight*a,className:e.className,disableTooltip:e.disableTooltips})})),d.createElement("path",{d:`${t} ${n}`,stroke:"black"}))}
var ma=n(17086)
function EditAlignmentCommentInput({end:e,start:t,text:n}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"close-wrapper"},d.createElement("span",{className:"badge-close pull-right close"},"×")),d.createElement("textarea",{placeholder:"Comment",className:"message",defaultValue:null===n?void 0:n}),d.createElement("div",{className:"info-wrapper"},d.createElement("div",{className:"info"},d.createElement("div",{className:"u-lr-split"},d.createElement("div",{className:"u-vertical-center-items"},d.createElement("input",{type:"number",placeholder:"Start",min:"1",step:"1",className:"start",defaultValue:null===t?void 0:t}),d.createElement("span",{className:"dash"},"–"),d.createElement("input",{type:"number",placeholder:"End",min:"1",step:"1",className:"end",defaultValue:null===e?void 0:e}),d.createElement("div",{className:"buttonGroup"},d.createElement("button",{type:"button",className:"button button--small button--primary save"},"Save"))),d.createElement("div",null,d.createElement("span",{className:"glyphicon glyphicon-trash pull-right delete"}))))))}class EditAlignmentComment extends s().View{static initClass(){this.prototype.className="edit-alignment-comment"}events(){return{"click .save":"save","click .close":"close","click .delete":"delete"}}initialize({slice:e,layout:t,selection:n,analysis:a}){this.slice=e
this.layout=t
this.selection=n
this.analysis=a
this.listenTo(this.selection,"change:start change:end",(()=>{this.updateRange()}))}updateRange(){if(this.selection.length()>0){const e=this.selection.get("sequence").length(),t=this.selection.get("sequence").startIndex()
this.$el.find(".start").val(T.displayStartToModel(this.selection.start(),t))
this.$el.find(".end").val(T.displayEndToModel(this.selection.end(),e,t))}}save(){const e=parseInt(this.$el.find(".start").val(),10),t=parseInt(this.$el.find(".end").val(),10),n=this.selection.get("sequence").length(),a=this.selection.get("sequence").startIndex(),i=this.$el.find(".message").val()
if(Number.isNaN(e)||Number.isNaN(t))v.ZP.error("Please enter a valid start and end.")
else{const s=T.displayStartToModel(e,a),r=T.displayEndToModel(t,n,a)
if(0<=s&&s<r&&r<n){this.comment.save({start:s,end:r,text:i,link_id:this.analysis.id})
this.close()}else v.ZP.error("Please enter a valid start and end.")}}delete(){var e
null===(e=this.comment)||void 0===e||e.destroy()
this.close()}handle(e){if(e===this.comment){this.close()
return}this.comment=e
const t=this.selection.get("sequence").length(),n=this.selection.get("sequence").startIndex()
this.$el.find(".start").val(T.modelStartToDisplay(this.comment.start(),n))
this.$el.find(".end").val(T.modelEndToDisplay(this.comment.end(),t,n))
this.$el.find(".message").val(this.comment.text())
const a=Math.min(this.slice.get("width")-this.$el.width(),this.slice.x()(e.layerEnd()))
this.$el.removeClass("hidden")
this.$el.css("left",a)
this.listenTo(e,"remove",(()=>{this.close()}))
l.default.defer((()=>{this.$(".message").focus().select()}))}render(){(0,Me.A9)(d.createElement(EditAlignmentCommentInput,{start:null,end:null,text:null}),this.el,(()=>{this.$el.css("bottom",this.layout.Axis.boxHeight())
this.close()}))
return this}close(){this.comment=null
this.$el.addClass("hidden")}}EditAlignmentComment.initClass()
class SelectableView extends s().View{shouldCaptureLeftClick(){return!0}shouldCaptureDoubleClick(){return!0}pieceClickHandler(e){ma.gW({isLinear:this.isLinear,mapId:this.model.cid},this,(()=>{this.clickAction(e)}))}pieceDblClickHandler(e){ma.gW({isLinear:this.isLinear,mapId:this.model.cid},this,(()=>{this.dblClickAction(e)}))}}const pa=SelectableView
class Component extends pa{constructor(){super(...arguments)
this.isLinear=!0}static initClass(){this.prototype.tagName="g"
this.prototype.setting=null}clickAction(e){}dblClickAction(e){}setupComponentWrapper(){null==Re().select(this.el).selectAll(".component-wrapper").node()&&Re().select(this.el).append("svg:g").classed("component-wrapper",!0).attr("transform",`translate(0,${this.layout.vMargin()})`)
this.listenTo(this.layout,"change:vMargin",this.translateMargin.bind(this))}translateMargin(){Re().select(this.el).select("g").attr("transform",`translate(0,${this.layout.vMargin()})`)}boxHeight(){return this.shouldShow()?this.layout.boxHeight():0}prepareHeight(){}initialize(e){super.initialize(e)
null!=(null==e?void 0:e.setting)&&(this.setting=e.setting)
this.hasRendered=!1
const t=null!=(null==e?void 0:e.visibilityOptions)?e.visibilityOptions:this.model.get("visibilityOptions")
this.option=t.getOption(this.setting)
this.maximiseOption=t.getOption(Yt.lA.name)
this._isHidden=!1}registerListeners(){this.stopListening()
if(null!=this.option){this.listenTo(this.option,"change:visible",this.showHandler.bind(this))
this.listenTo(this.option.get("settings"),"change:value",this.update.bind(this))}null!=this.maximiseOption&&this.listenTo(this.maximiseOption,"change:visible",this.showHandler.bind(this))}hideHandler(){}updateIfShown(e){if(this.shouldShow()){this.update(e)
if(this._isHidden){this._isHidden=!1
this.$el.css("display","")}}else if(!this._isHidden){this._isHidden=!0
this.$el.css("display","none")
this.hideHandler()
e&&this.trigger("redraw")}}showHandler(){this.updateIfShown(!0)}setup(){Re().select(this.el).classed(this.className,!0)
this.registerListeners()
this.setupComponentWrapper()}render(e){null==e&&(e=!0)
this.hasRendered=!0
this.setup()
this.updateIfShown(e)
return this}die(){this.stopListening()}shouldShow(){return(null==this.maximiseOption||this.maximiseOption.get("visible"))&&(null==this.option||this.option.get("visible"))}}Component.initClass()
const ha=Component
var ga=n(231017),Ea=n(55873),fa=n(787004),Sa=n(947730),ya=n(869022),ba=n(469573),Ta=n(503080)
const va={newAnnotation(e){Sa.Z.dispatch({actionType:fa.Pu7,proteinId:e})},setName(e,t){Sa.Z.dispatch({actionType:fa.vEN,proteinId:e,name:t})},setType(e,t){Sa.Z.dispatch({actionType:fa.PWB,proteinId:e,annotationType:t})},setDisplayStart(e,t){Sa.Z.dispatch({actionType:fa.PYQ,proteinId:e,displayStart:t})},setDisplayEnd(e,t){Sa.Z.dispatch({actionType:fa.WLN,proteinId:e,displayEnd:t})},setColor(e,t){Sa.Z.dispatch({actionType:fa.GNH,proteinId:e,color:t})},save(e){const t=ba.Z.getLatestVersionId(e),{name:n,type:a,displayStart:i,displayEnd:s,color:r}=ba.Z.getAnnotationEditorData(e),o=ba.Z.getProteinById(e).version.aminoAcids.length,l=T.displayStartToModel(Number(i),1),c=T.displayEndToModel(Number(s),o,1)
Sa.Z.dispatch({actionType:fa.lwH,proteinId:e})
const d=ba.Z.getSelectedAnnotationId(e)
let u
if(null==d){m.j("protein","created_annotation",{product:j.XC.MOLBIO,actionCategory:j.Jw.WRITE,protein_id:e})
u=ya.Z.createAnnotation(e,n,a,l,c,r,t)}else u=ya.Z.updateAnnotation(e,d,{name:n,type:a,start:l,end:c,color:r,expectedVersionId:t})
u.done((t=>{Sa.Z.dispatch({actionType:fa.CY9,proteinId:e,newProtein:t})
Ea.Z.fetchVersions(e)})).fail(Ta.Z)},cancel(e){Sa.Z.dispatch({actionType:fa.zS_,proteinId:e})},delete(e,t){const n=ba.Z.getLatestVersionId(e)
Sa.Z.dispatch({actionType:fa.yxd,proteinId:e,annotationId:t})
ya.Z.deleteAnnotation(e,t,n).done((t=>{Sa.Z.dispatch({actionType:fa.CY9,proteinId:e,newProtein:t})
Ea.Z.fetchVersions(e)})).fail(Ta.Z)},pendingFocusCompleted(e){Sa.Z.dispatch({actionType:fa.Y6M,proteinId:e})}},Ca=va,openSelectionContextMenu=(e,t)=>{const n=t.residueSlice(t.selection().start(),t.selection().end()),a=y.containsNonStandardAminoAcids(n)
ta.e.open(e,[{name:"Delete residues",click(){t.deleteSelection()},disabled:()=>!t.allowResidueEdits()||!t.isSelectionDeletable(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},{name:"Create annotation",click(){m.j("protein","open_annotation_panel",{product:j.XC.MOLBIO,openedFrom:"context_menu",protein_id:t.get("id")})
Ca.newAnnotation(t.id)
t.fileState().get("toolbar").trigger("openProteinAnnotationsPanel")},disabled:()=>!t.allowFeatureEdits(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT}),dataTestAttrs:{component:"ContextMenu",element:"createAnnotation"}},{name:"Copy",copy:()=>n},{name:a?"Back translate (cannot back-translate non-standard AAs)":"Back translate",click(){t.handleBackTranslate()},disabled:()=>a,hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})},{name:jn.Y6,async click(){await(0,Yn.ld)(t.selection())},disabled:()=>t.selection().isEmpty()||!(0,Qn.H_)(t.selection().getSelectionResidues(),Kn.EF.BLASTP),hide:()=>t.selection().isEmpty()||!dt.ZP.ENABLE_BLAST_SEARCH}])}
function badWraps(e,t,n,a){return e<a&&a<=n&&n<t}function timesPerSlice(e,t,n,a,i){return badWraps(t,n,a,i)?[e,e]:[e]}function whichDisplay(e,t,n,a,i,s){0===a&&(a=s)
const r=e<=n&&n<t,o=e<=a&&a<t||a===t,l=badWraps(e,t,n,a),c=1===i
return r&&o&&!l?c?null:{start:n,end:a}:r&&(!o||l&&!c)?{start:n,end:t+1}:o&&(!r||l&&c)?{start:e-1,end:a}:{start:e-1,end:t+1}}function span(e,t,n,a,i){return badWraps(e,t,n,a)?{start:e-1,end:t+1}:whichDisplay(e,t,n,a,0,i)}function getLayersDict(e,t){const n=e.map((e=>e.get(t))),a=[...new Set(n)].sort(((e,t)=>e-t)),i=function range(e,t,n){const a=[],i=e<t,s=n?i?t+1:t-1:t
for(let t=e;i?t<s:t>s;i?t++:t--)a.push(t)
return a}(0,a.length,!1)
return Object.fromEntries(a.map(((e,t)=>[e,i[t]])))}function LayeredView_ownKeys(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e)
t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function LayeredView_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?LayeredView_ownKeys(Object(n),!0).forEach((function(t){LayeredView_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LayeredView_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function LayeredView_defineProperty(e,t,n){(t=function LayeredView_toPropertyKey(e){var t=function LayeredView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class LayeredView extends ha{getData(){return[]}singleName(){return"layer"}getLayout(){return null}layeringMode(){return Kt.LINEAR_LAYER_FULL}isShown(){return null}initialize(e){super.initialize(e)
this.slice=e.slice
this.parent=e.parent
this.sequence=this.model.get("sequence")
this.max=0}getPolymerLength(){return this.sequence.length()}layerFill(e){return e.color()}layerFillOpacity(e){return e.get("hover")||e.selected()?1:.7}outlineColor(e){return e.selected()?"#111":Re().rgb(e.color()).darker().toString()}handleHoverSelect(e,t){const n=e.uid(),a=Re().select(this.el).select("g").selectAll("g").filter(`[id='${n}-0'],[id='${n}-1']`)
a.select("text").attr("font-weight",(e=>e.selected()?"bold":"normal"))
a.selectAll(".layer-fill").attr("fill-opacity",this.layerFillOpacity).attr("fill",this.layerFill)
return a.selectAll(".stroked").attr("stroke",(e=>this.outlineColor(e)))}die(){super.die()
this.killTooltips()}killTooltips(){Re().select(this.el).select("g").selectAll("g").on(".layeredview",null).each((function(){return o()(this).tooltip("destroy")}))}boxHeight(){return this.isShown()?this.getLayout().boxHeight(LayeredView_objectSpread({overlap:this.max},this.getAdditionalHeightOptions())):0}maxOverlap(e,t){let n=[]
for(const a of Array.from(this.data)){const i=span(e,t,a.drawStart(this.sequence),a.drawEnd(this.sequence),this.getPolymerLength())
n.push([Math.max(i.start,e)-e,1])
n.push([Math.min(i.end,t)-e-1,-1])}n=l.default.sortBy(l.default.sortBy(n,(e=>-1*e[1])),(e=>e[0]))
let a=0,i=0
for(t of Array.from(n)){i+=t[1]
i>a&&(a=i)}return a}updateLayerPiece(e,t,n){const{sequence:a}=this,{layersDict:i}=this,s=this.layeringMode(),r=this.getPolymerLength()
return function(o,c,d){e.on("mousedown.layeredview",l.default.bind((function(e,t){Re().event.stopPropagation()
return this.pieceClickHandler(e)}),o)).on("dblclick.layeredview",l.default.bind((function(e){Re().event.stopPropagation()
return this.pieceDblClickHandler(e)}),o)).on("mouseover.layeredview",(e=>e.set({hover:!0}))).on("mouseout.layeredview",(e=>e.set({hover:!1}))).attr("id",((e,t)=>`${e.uid()}-${t}`)).on("contextmenu.layeredview",(e=>{let t
o.pieceClickHandler(e)
if(a instanceof ga.Z){t=o.contextMenuData(e)
null!=t.annotation?((e,t,n)=>{S.Gp(ba.Z.getSelectedAnnotationId(t.id)===n.id,"Expected ProteinStore to be up to date before the context menu code runs.")
ta.e.open(e,[{name:"Delete annotation",click(){Ca.delete(t.id,n.id)},disabled:()=>!t.allowFeatureEdits(),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})},{name:"Add to feature library",click(){Ea.Z.promptAddAnnotationToFeatureLibrary(t.id,n.id)},hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_ADMIN})}])})(Re().event,a,t.annotation):openSelectionContextMenu(Re().event,a)}else a&&SelectionContextMenu_open(Re().event,a,o.contextMenuOptions(),o.contextMenuData(e))}))
e.each((function(e,l){const{start:u,end:m}=whichDisplay(d.start(),d.end(),e.drawStart(a),e.drawEnd(a),l,r),p=t(u),h=n(i[e.get(s)]),g=t(m)-t(u),E=c.singleHeight(o.getAdditionalHeightOptions())
Re().select(this).attr("transform",`translate(${p}, ${h})`)
return o.rerenderSingle(this,u,m,g,E,e,p,h,t,n,l)}))}(this,this.getLayout(),this.slice)}setLayersDict(){this.layersDict=getLayersDict(this.data,this.layeringMode())
this.max=Object.keys(this.layersDict).length
return this.layersDict}prepareHeight(){this.setData()
return this.setLayersDict()}setData(e,t){this.data=this.getData(e,t)}getAdditionalHeightOptions(){return{}}update(e){null==e&&(e=!0)
if(!this.isShown())return
const t=this.slice.start(),n=this.slice.end()
this.setData(t,n)
this.setLayersDict()
const a=this.slice.x(),i=Re().scale.linear().domain([0,this.max-1]).range([0,this.getLayout().height(LayeredView_objectSpread({overlap:this.max-1},this.getAdditionalHeightOptions()))]),s=Re().select(this.el).selectAll(".component-wrapper").selectAll(".layer-group").data(this.data)
s.enter().append("g").classed("layer-group",!0)
s.exit().each((function(){return Re().select(this).selectAll(".layer").each((function(){return o()(this).tooltip("destroy")}))})).remove()
const r=s.selectAll(".layer").data((e=>timesPerSlice(e,t,n,e.drawStart(this.sequence),e.drawEnd(this.sequence))))
this.makeLayerPiece(r.enter().append("g"))
r.exit().each((function(e){return o()(this).tooltip("destroy")})).remove()
this.updateLayerPiece(r,a,i)
e&&this.trigger("redraw")}contextMenuOptions(){return[]}contextMenuData(){return{}}}var Ia=n(703764)
class AlignmentCommentsView extends LayeredView{static initClass(){this.prototype.className="alignmentComments"
this.prototype.setting=Yt.nq.name}getData(){var e,t
return null!==(t=null===(e=this.model.get("alignmentComments"))||void 0===e?void 0:e.models)&&void 0!==t?t:[]}getLayout(){return this.model.get("layout").AlignmentComments}isShown(){return this.shouldShow()}contextMenuOptions(){return ca}contextMenuData(e){return{comment:e}}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.layout=this.model.get("layout").AlignmentComments
this.mapType=e.mapType
this.sequence=this.tabstate.get("mapstates").models[0].get("sequence")
this.selection=this.sequence.get("selection")
const t={model:this.model,layout:this.model.get("layout"),selection:this.selection,slice:this.slice,analysis:this.tabstate.get("analysis")}
this.editAlignmentView=new EditAlignmentComment(t)
this.editAlignmentView.render()}registerListeners(){super.registerListeners()
const e=this.model.get("alignmentComments")
this.listenTo(e,"change:hover change:selected",(e=>{this.handleHoverSelect(e,null)}))
this.listenTo(e,"add remove change:start change:end change:visible reset",(()=>{this.update()}))
"summary"===this.mapType&&this.listenTo(e,"open",(e=>{this.open(e)}))}setLayers(){const e=this.getData(),t=this.getLayout().get("type").width(1.5),n=Math.round(this.slice.xInv()(t)-this.slice.xInv()(0))
l.default.each(e,(e=>{const t=Math.round(n/2),a=n-(e.end()-e.start())
a>0?e.start()<this.slice.start()+t?e.set({layerStart:0,layerEnd:n}):e.end()>this.slice.end()-n/2?e.set({layerStart:this.slice.end()-n,layerEnd:this.slice.end()}):e.set({layerStart:e.start()-a/2,layerEnd:e.end()+a/2}):e.set({layerStart:e.start(),layerEnd:e.end()})}))
const a=e.filter((e=>e.get("visible"))),i=Ia.eo(a,{top:!1})
for(const{model:e,layer:t}of i)e.set(Kt.LINEAR_LAYER_FULL,t,{silent:!0})
this.model.get("alignmentComments").trigger("layerChange")}clickAction(e){e.click(this.tabstate.get("mapstates").models[0].get("sequence"))}dblClickAction(e){e.dblClick(this.tabstate.get("mapstates").models[0].get("sequence"))}makeLayerPiece(e){e.classed("layer",!0)
e.append("svg:path").classed("layer-fill",!0).classed("stroked",!0)
e.append("svg:text")}update(e=!0){this.setLayers()
super.update(e)}rerenderSingle(e,t,n,a,i,s){Re().select(e).select("path.layer-fill").attr("d",`M 0 0 L 0 ${i} L ${a} ${i} L ${a} 0 Z`).attr("fill",(e=>Re().rgb(e.color().toString()))).attr("fill-opacity",(e=>e.get("hover")||e.get("selected")?1:.7))
Re().select(e).selectAll("path.stroked").attr("stroke",(e=>e.get("selected")?"#111":Re().rgb(e.color()).darker().toString())).attr("stroke-opacity",.7)
const r=this.getLayout().get("type").numChars(a)
Re().select(e).select("text").attr("x",0).attr("y",this.getLayout().get("single").height()-2).attr("font-size",this.getLayout().get("type").fontSize).attr("color","black").text(s.text().slice(0,r))}open(e){this.selection.setEndpoints(e.start(),e.end())
this.editAlignmentView.handle(e)
this.$el.closest(".summary-map").append(this.editAlignmentView.el)}}AlignmentCommentsView.initClass()
var wa=n(959415)
const Na=class SearchResultsView extends LayeredView{shouldShow(){return this.option.get("visible")}layerFill(e){return e.get("selected")?"orange":"yellow"}layerFillOpacity(e){return.4}boxHeight(){return 0}isShown(){return!0}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.mapType=e.mapType
this.layout=this.getLayout()}setLayers(){for(const e of Array.from(this.data))e.set("linearLayer",0)}makeLayerPiece(e){e.classed("layer",!0)
e.append("svg:rect").classed("layer-fill",!0)}clickAction(e){e.click(this.model.get("sequence"))}dblClickAction(e){e.dblClick(this.model.get("sequence"))}}
class AminoAcidsSearchResult extends wa.sd{defaults(){return(0,l.default)(super.defaults()).extend({start:null,end:null,hover:!1,sequence:null})}start(){return this.get("start")}end(){return this.get("end")}layerStart(){return this.start()}layerEnd(){return this.end()}uid(){return this.cid}type(){return"search-result"}hover(){return this.get("hover")}strand(){return 1}sequence(){return this.get("sequence")}click(e,t){null==t&&(t=!1)
e.get("selection").select(this)}dblClick(e,t){null==t&&(t=!1)
this.click(e,t)}}class AminoAcidsSearchResultsView extends Na{static initClass(){this.prototype.className="aminoAcidsSearch"
this.prototype.setting=Yt.RS.name}getData(e,t){const n=this.model.get("sequence"),a=ba.Z.getSearchResults(n.id)
return null!=a&&n.length()?a.map((({index:e,aminoAcids:t,isSelected:a})=>new AminoAcidsSearchResult({start:e,end:T.mod(e+t.length,n.length()),selected:a}))).filter((n=>T.isRangeOverlap(e,t,n.start(),n.end()))):[]}getLayout(){return this.model.get("layout").AminoAcidsSearchResult}contextMenuOptions(){return[]}contextMenuData(e){return{tabstate:this.tabstate}}registerListeners(){super.registerListeners()
ba.Z.addChangeListener((()=>this.update()))}rerenderSingle(e,t,n,a,i,s){let r=i
r=i
Re().select(e).select(".layer-fill").attr("x",0).attr("y",0).attr("width",a).attr("height",r).attr("fill",this.layerFill).attr("fill-opacity",this.layerFillOpacity).attr("stroke","black").attr("stroke-width",1)}}AminoAcidsSearchResultsView.initClass()
const Aa=AminoAcidsSearchResultsView
var Ra=n(590385)
function getMetadataSummary(e){return e.organism&&e.chainType?`${(0,Mt.kC)(e.organism)} ${Ra.v9[e.chainType]}`:""}function useAntibodyMetadata(e,t,n){const[a,i]=(0,d.useState)(void 0),[s,r]=(0,d.useState)(void 0);(0,d.useEffect)((()=>{e&&async function fetchAndSetData(e,t,n,a,i){let s,r
if(n){await jt.Z.getCDRAnnotations([e],n)
s=jt.Z.getCachedCDRMessage(e,n)}if(t){await jt.Z.getNumbering([e],t)
r=jt.Z.getCachedNumberingMessage(e,t)}a(r||s)
const o=jt.Z.getCachedMetadata(e)
let l
o&&(l=o.map((e=>getMetadataSummary(e))).join(" | "))
i(l)}(e,t,n,i,r)}),[e,t,n])
return[a,s]}var Pa=n(22584)
function AntibodyNumber(e){const{value:t,gappedIndex:n,xFn:a,layout:i}=e,s=a(n),r=new bn.Z(i.type.fontSize),o=(a(n+1)-s-r.width(t.length))/2
return d.createElement("text",{transform:`translate(${s+o} 6)`},t)}function AntibodyChain(e){const{setSelection:t,xFn:n,numbering:a,sliceStart:i,sliceEnd:s,realToGapped:r,onAlignment:o,layout:l}=e,{indices:c,numberingStart:u,numberingEnd:m,numberingEndForSlice:p,numberingStartForSlice:h}=o?function getSlicedAntibodyNumbersForAlignments(e,t,n,a){const i=e.start,s=e.start+e.indices.length,r=a[i],o=a[s]||a[a.length-1]+1
return{indices:e.indices,numberingStart:r,numberingEnd:o,numberingStartForSlice:r,numberingEndForSlice:o}}(a,0,0,r):function getSlicedAntibodyNumbersForProteinMap(e,t,n){const a=e.start,i=e.start+e.indices.length
if(i<t||a>=n)return{indices:[],numberingStart:0,numberingEnd:0,numberingStartForSlice:0,numberingEndForSlice:0}
const s=Math.max(t,a),r=Math.min(n,i),o=Math.max(s-a,0),l=Math.max(r-a,0)
return{indices:e.indices.slice(o,l),numberingStart:a,numberingEnd:i,numberingStartForSlice:s,numberingEndForSlice:r}}(a,i,s),E=n(h+1)-n(h)>21,f=E?getMetadataSummary(a):o?"Zoom in using the minimap to see antibody numbering":"Zoom in to see antibody numbering"
return d.createElement(d.Fragment,null,d.createElement(P.pf,{tooltipTitle:f},d.createElement("rect",{onClick:()=>{t(u,m)},className:`layer-fill ${(0,g.iv)(Oa.noFocus)}`,fill:Vt.DM,fillOpacity:.7,x:n(h),y:E?-5:0,width:n(p)-n(h),height:E?15:5})),E&&c.map(((e,t)=>{return d.createElement(AntibodyNumber,{key:e,gappedIndex:o?(i=a.start,s=t,c=r,c[s+i]):h+t,value:e,xFn:n,layout:l})
var i,s,c})))}function AntibodyNumberingSlice({layout:e,onAlignment:t,redraw:n,residues:a,scheme:i,setSelection:s,sliceStart:r,sliceEnd:o,xFn:l}){(0,S.hu)(!t||0===r,"Alignments only have one slice, so slice must start at 0")
const c=bn.Z.heights[e.type.fontSize]+e.vMargin,u=(0,y.removeGaps)(a),m=getRealToGapMap(a),[p,h]=(0,d.useState)(null);(0,d.useEffect)((()=>{(async()=>{const[e]=await jt.Z.getNumbering([u],i.toLowerCase())
h(e)
n(e?c:0)})()}),[c,u,i,n])
return p?d.createElement(Pa.Z,{layout:e,shouldStopMouseDownPropagation:!1},d.createElement("g",{fontSize:e.type.fontSize,className:(0,g.iv)(Oa.noFocus)},p.map((n=>d.createElement(AntibodyChain,{key:n.start,setSelection:s,xFn:l,numbering:n,sliceStart:r,sliceEnd:o,realToGapped:m,onAlignment:t,layout:e}))))):null}const Oa=g.mM.create({noFocus:{":focus":{outline:"none"}}})
var xa=n(769784),_a=n(212300),Da=n(751512),La=n(91092),ka=n(697134),Ma=n(445251),Fa=n(280539),Za=n(778223)
const Ba=Vt.pF,qa=xa.ZP`
  query AttachedMoleculesQuery($complexPolymerId: StrictString!, $versionId: StrictString!)
  @skipAudit
  @engComponent(name: MODIFIED_BIOLOGICS) {
    complexPolymer(id: $complexPolymerId, versionId: $versionId) {
      ... on OligoConjugateNode {
        id
        conjugates {
          id
          entity {
            ... on MoleculeNode {
              id
            }
            ...InaccessibleInfoGraphQL
          }
          residueIndex
          linkedMolecules {
            id
            entity {
              ... on MoleculeNode {
                id
              }
              ...InaccessibleInfoGraphQL
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function QueryingAttachedMolecules(e){const t=(0,_a.v9)((t=>t.ui.modbio.complexPolymerVersionUIs[e.complexPolymerId].complexPolymerVersionId))
return d.createElement(Da.ZP,{query:qa,variables:{complexPolymerId:e.complexPolymerId,versionId:t},renderLoading:()=>null},(t=>{(0,S.hu)(!(0,ka.CZ)(t.complexPolymer),"Expected complex polymer to be accessible");(0,S.hu)(function isOligoConjugate(e){return"OligoConjugateNode"===e.__typename}(t.complexPolymer),"Expected oligo conjugate")
return d.createElement(AttachedMolecules,{...e,conjugates:t.complexPolymer.conjugates})}))}function AttachedMolecules({xFn:e,redraw:t,sliceStart:n,sliceEnd:a,layout:i,conjugates:s}){const r=s.filter((e=>null!=e.residueIndex&&(0,T.baseInRange)(e.residueIndex,n,a))),o=Math.max(...r.map((e=>e.linkedMolecules.length+1)));(0,d.useEffect)((()=>{(null==i?void 0:i.visible)&&0!==r.length?t(32*o):t(0)}),[i,t,r,o])
return d.createElement("svg",null,d.createElement(Pa.Z,{layout:i,shouldStopMouseDownPropagation:!1},d.createElement("g",null,r.map(((t,a)=>d.createElement(MoleculeAttachment,{key:a,conjugate:t,sliceStart:n,xFn:e,maxNumMoleculesInSlice:o}))))))}function calculateAttachedMoleculeYCoordinates(e,t){const n=32*(t+e),a=n+24
return{moleculeYPosition:n,lineStartY:a,lineEndY:a+8}}function MoleculeAttachment(e){const t=e.conjugate.residueIndex,n=e.conjugate.linkedMolecules.length,a=e.maxNumMoleculesInSlice-n-1,i=(0,Ma.AT)(e.xFn,e.sliceStart,t),s=(0,Ma.N2)(e.xFn,e.sliceStart,t),{moleculeYPosition:r,lineStartY:o,lineEndY:l}=calculateAttachedMoleculeYCoordinates(n,a)
return d.createElement(d.Fragment,null,d.createElement(MoleculeChipAndConnector,{moleculeEntity:e.conjugate.entity,lineX:s,lineStartY:o,lineEndY:l,chipX:i,chipY:r}),e.conjugate.linkedMolecules.map(((e,t)=>{const{moleculeYPosition:r,lineStartY:o,lineEndY:l}=calculateAttachedMoleculeYCoordinates(n-t-1,a)
return d.createElement(MoleculeChipAndConnector,{key:t,moleculeEntity:e.entity,lineX:s,lineStartY:o,lineEndY:l,chipX:i,chipY:r})})))}function MoleculeChipAndConnector({moleculeEntity:e,lineX:t,lineStartY:n,lineEndY:a,chipX:i,chipY:s}){return d.createElement("svg",null,d.createElement("g",{className:(0,g.iv)(Va.moleculeChip)},d.createElement(MoleculeConnectorLine,{xPos:t,yPos:n,y2Pos:a}),d.createElement("foreignObject",{x:i,y:s,width:150,height:150},d.createElement(Fa.default,{id:(0,ka.CZ)(e)?null:e.id,size:Za.TK.MINI}))))}function MoleculeConnectorLine({xPos:e,yPos:t,y2Pos:n}){return d.createElement("line",{x1:e,y1:t,x2:e,y2:n,stroke:Ba,strokeWidth:2})}const Va=g.mM.create({moleculeChip:{fontFamily:_n.I3}})
var Ua=n(437810)
class CodonOptimizationSelection extends wa.sd{defaults(){return(0,l.default)(super.defaults()).extend({start:null,end:null,sequence:null})}start(){return this.get("start")}end(){return this.get("end")}layerStart(){return this.start()}layerEnd(){return this.end()}uid(){return this.cid}type(){return"selection"}strand(){return this.get("strand")}sequence(){return this.get("sequence")}click(e,t){null==t&&(t=!1)
e.get("selection").select(this)}dblClick(e,t){null==t&&(t=!1)
this.click(e,t)}}class CodonOptimizationSelectionView extends LayeredView{constructor(){super(...arguments)
this.data=[]}static initClass(){this.prototype.className="codonOptimization"}shouldShow(){return!0}layerFill(e){return"#d2e3ff"}layerFillOpacity(e){return.4}boxHeight(){return 0}isShown(){return!0}contextMenuOptions(){return getSelectionMenu()}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.mapType=e.mapType
this.layout=this.getLayout()}setLayers(){for(const e of Array.from(this.data))e.set("linearLayer",0)}makeLayerPiece(e){e.classed("layer",!0)
e.append("svg:rect").classed("layer-fill",!0)}clickAction(e){e.click(this.model.get("sequence"))}dblClickAction(e){e.dblClick(this.model.get("sequence"))}getData(e,t){const n=this.model.sequence().fileState().findTab(Ua.Z,(e=>e.get("active")))
if(null===n)return[]
const{optimizationStart:a,optimizationEnd:i,strand:s}=(0,Vn.getStore)().getState().ui.codonOptimizationTab[n.cid],r=this.layout.get("DNA").get("complement")
if(null!==a&&null!==i)return(r||-1!==s)&&T.isRangeOverlap(e,t,a,i)?[new CodonOptimizationSelection({start:a,end:i,selected:!1,strand:s})]:[];(0,S.Gp)(!1,"Expected optimization boundaries to be set.")
return[]}getLayout(){return this.model.get("layout").CodonOptimizationSelection}registerListeners(){super.registerListeners()
this.model.sequence().fileState().buffers().forEach((e=>{this.listenTo(e.tabs(),"add remove reset change:active",(()=>{this.update()}))}))
this.listenTo(this.layout.get("DNA"),"change:complement",(()=>{this.update()}))}rerenderSingle(e,t,n,a,i,s){let r
const o=this.layout.get("DNA").get("complement"),l=s.strand()
let c=i
if(o&&0!==l)if(1===l){r=0
c=i/2}else{r=i/2
c=i/2}else{r=0
c=i}Re().select(e).select(".layer-fill").attr("x",0).attr("y",r).attr("width",a).attr("height",c).attr("fill",(e=>this.layerFill(e))).attr("fill-opacity",(e=>this.layerFillOpacity(e))).attr("stroke","black").attr("stroke-width",1)}}CodonOptimizationSelectionView.initClass()
const Ga=CodonOptimizationSelectionView
class CutSitesView extends ha{static initClass(){this.prototype.className="cutSites"
this.prototype.setting=Yt.gO.name}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.mapType=e.mapType
this.slice=e.slice
this.layout=this.model.get("layout").CutSites
this._layout=this.model.get("layout")
this.debouncedUpdate=(0,It.D)(this.update,1)
return this.parent=e.parent}die(){super.die()
return Re().select(this.el).selectAll(".cutsite").selectAll("text").on(".cutsite",null)}overhangsOption(){return this.model.get("visibilityOptions").getOption(Yt.VZ.name)}primersOption(){return this.model.get("visibilityOptions").getOption(Yt.gY.name)}registerListeners(){super.registerListeners()
this.listenTo(this._layout.DNA,"change:complement",this.update)
this.listenTo(this.slice,"change:cutData",(function(){return this.debouncedUpdate()}))
this.listenTo(this.model.get("sequence").get("cutsites"),"change:color",(function(){return this.debouncedUpdate()}))
this.listenTo(this.model.get("sequence").get("_sequence"),"change:type",this.showHandler)
this.listenTo(this.overhangsOption(),"change:visible",(function(e,t){const n=this
return Re().select(this.el).selectAll(".cutsite").each((function(e){return n.renderHover(this,e)}))}))}boxHeight(){return this.shouldShow()?this.layout.boxHeight({overlap:this.max}):0}maxOverlap(e,t,n){const{slice:a}=this,i=l.default.chain(n).filter((n=>{let a
return e<=(a=n.start())&&a<t})).map((e=>[[e.sliceData(a.cid,"start"),1],[e.sliceData(a.cid,"end"),-1]])).flatten(!0).sortBy((e=>-1*e[1])).sortBy((e=>e[0])).value()
let s=0,r=0
for(const e of Array.from(i)){s+=e[1]
r=Math.max(s,r)}return r}shouldShowCutLine(e){return this._layout.DNA.get("visible")&&(this.overhangsOption().get("visible")||e.get("hover"))}shouldShowRecognitionSite(e){let t,n
const a=this._layout.DNA,i=this.slice.start(),s=this.slice.end(),r=i<=(t=e.sliceData(this.slice.cid,"matchStart"))&&t<s||i<=(n=e.sliceData(this.slice.cid,"matchEnd"))&&n<s,o=a.get("visible")&&e.get("hover")
return r&&o}handleHoverSelect(e,t){t.classed("selected-cut",e.get("hover")||e.get("selected"))
this.renderHover(t.node(),e)}setLayers(e){const{slice:t}=this,n=function CutSitesView_range_(e,t,n){const a=[],i=e<t,s=n?i?t+1:t-1:t
for(let t=e;i?t<s:t>s;i?t++:t--)a.push(t)
return a}(0,this.max,!1).map((e=>-1)),a=Re().scale.linear().domain([0,this.max]).range([this.layout.height({overlap:0}),this.layout.height({overlap:this.max})])
return l.default.chain(e).map((e=>[[e.sliceData(t.cid,"start"),1,e],[e.sliceData(t.cid,"end"),-1,e]])).flatten(!0).sortBy((e=>-1*e[1])).sortBy((e=>e[0])).each((e=>{let i
if(t.start()<=(i=e[2].start())&&i<t.end()){let i
if(1===e[1]){i=n.lastIndexOf(-1)
e[2].sliceData(t.cid,"layer",a(i))
return n[i]=e[2]}i=n.lastIndexOf(e[2])
return n[i]=-1}return e[2].sliceData(t.cid,"layer",a(0))}))}augmentCut(e){let t,n
const{slice:a}=this,{layout:i}=this,{_layout:s}=this,r=this.model.get("sequence"),o=a.start(),l=a.end(),c=e.name(),d=i.get("cutSite").get("type").width(c.length+1)
let u=s.DNA.get("type").numChars(d)
e.sliceData(a.cid,"start",Math.min(e.start(),l-u))
e.sliceData(a.cid,"end",Math.min(e.start()+u,l))
const m=e.get("position"),p=e.get("enzyme").get("cut"),h=e.get("enzyme").get("seq")
if(e.strand()>=0){n=m-p
t=n+h.length}else{t=m+e.get("enzyme").get("offset")+p
n=t-h.length}u=r.length()
if(t>u&&n>l){n=0
t%=u}if(n<0&&t<o){n+=u
t=u}e.sliceData(a.cid,"matchStart",n)
return e.sliceData(a.cid,"matchEnd",t)}renderHover(e,t){if("minimap"===this.mapType)return
const n=this._layout.DNA,a=this.slice.start(),i=this.slice.end(),s=n.get("type"),r=this.layout.get("cutSite").get("type"),{max:o}=this,l=this.slice.x(),c=t.sliceData(this.slice.cid,"layer")+r.height()+r.verticalOffset,d=this.layout.boxHeight({overlap:o})+this.parent.boxHeightToDNA(this.className),u=s.verticalOffset+2*n.height()+n.get("spacer"),m=d+u/2,p=m+u/2,hoverLineData=(e,s,r)=>{null==r&&(r=!0)
if(this.shouldShowCutLine(t)){const o=[]
if(a<=e&&e<i){r&&o.push([l(e)-l(t.sliceData(this.slice.cid,"start")),c])
o.push([l(e)-l(t.sliceData(this.slice.cid,"start")),d])
o.push([l(e)-l(t.sliceData(this.slice.cid,"start")),m])}if(n.get("complement")){0===o.length&&o.push([l(e)-l(t.sliceData(this.slice.cid,"start")),m])
o.push([l(s)-l(t.sliceData(this.slice.cid,"start")),m]);(a<s&&s<=i||a===s&&t.get("enzyme").get("offset")<0)&&o.push([l(s)-l(t.sliceData(this.slice.cid,"start")),p])}return[o]}return[]},h=this.model.get("sequence"),g=hoverLineData(t.start(),t.end(),!0)
if(t.get("enzyme").doubleCutter()){const e=t.get("enzyme"),n=t.doubleCutterStart(),a=n+e.get("offset2")
n<h.length()&&a<h.length()&&g.push(...Array.from(hoverLineData(n,a,!1)||[]))}const E=Re().svg.line().x((e=>e[0])).y((e=>e[1])).interpolate("linear"),f=Re().select(e).selectAll(".hover-cut-line").data(g)
f.enter().insert("svg:path",":first-child").classed("hover-cut-line",!0).attr("fill","none")
f.exit().remove()
f.attr("d",(e=>E(e)))
const S=this.shouldShowRecognitionSite(t)?[{x:l(t.sliceData(this.slice.cid,"matchStart"))-l(t.sliceData(this.slice.cid,"start")),y:d,height:n.get("complement")?p-d:p-m,width:l(t.sliceData(this.slice.cid,"matchEnd"))-l(Math.max(a,t.sliceData(this.slice.cid,"matchStart")))}]:[],y=Re().select(e).selectAll(".recognition-site").data(S)
y.enter().insert("svg:rect",":first-child").classed("recognition-site",!0)
y.exit().remove()
return y.attr("x",(e=>e.x)).attr("y",(e=>e.y)).attr("width",(e=>e.width)).attr("height",(e=>e.height))}renderCutsite(e,t){let n,a,i
const s=this._layout.DNA,{layout:r}=this,{_layout:o}=this,c=this.model.get("sequence"),{slice:d}=this,u=this.slice.start(),m=this.slice.end(),{max:p}=this,h=this.slice.x(),g=r.get("cutSite").get("type"),E=t.sliceData(this.slice.cid,"layer")+this.y(1),f=function(){let e=g._width/-2
t.end()-1===t.get("position")&&(e*=-1)
return h(t.sliceData(d.cid,"start"))>Math.abs(e)?e:0}(),S=u<=(n=t.start())&&n<m&&null!=t.color()?[t.color()]:[],y=Re().select(e).selectAll(".cutsite-rect").data(S)
y.exit().remove()
y.enter().insert("svg:rect","text").classed("cutsite-rect",!0)
y.attr("x",f-2).attr("y",E-g.height()+1).attr("height",g.height()+4).attr("width",t.name().length*g.charWidth()+2).attr("fill",t.color())
const b=u<=(a=t.start())&&a<m?[t.name()]:[],T=Re().select(e).selectAll("text").data(b)
T.exit().on(".cutsite",null).remove()
T.enter().append("svg:text")
T.text(t.name()).attr("font-size",g.fontSize).attr("x",f).attr("y",E).attr("fill",t.get("fontColor")).attr("data-test-component","CutSite").attr("data-test-element","text").on("mousedown.cutsite",l.default.bind((function(){this.pieceClickHandler(t)
return Re().event.stopPropagation()}),this)).on("dblclick.cutsite",l.default.bind((function(){this.pieceDblClickHandler(t)
return Re().event.stopPropagation()}),this)).on("mouseenter.cutsite",(()=>t.set({hover:!0}))).on("mouseleave.cutsite",(()=>t.set({hover:!1}))).on("contextmenu.cutsite",(()=>{if(SelectionContextMenu_open(Re().event,c,ia,{cutsite:t})){c.get("selection").reset(t.start())}}))
const v=u<=(i=t.start())&&i<m?[t]:[],C=Re().select(e).selectAll(".mainLine").data(v)
C.exit().remove()
C.enter().insert("svg:line",":first-child").classed("mainLine",!0)
let I=r.boxHeight({overlap:p})+this.parent.boxHeightToDNA(this.className)
s.get("visible")?I+=s.vMargin()+g.verticalOffset:"minimap"===this.mapType&&(I+=o.Axis.get("vMargin"))
C.attr("x1",h(t.start())-h(t.sliceData(this.slice.cid,"start"))).attr("x2",h(t.start())-h(t.sliceData(this.slice.cid,"start"))).attr("y1",t.sliceData(this.slice.cid,"layer")+g.height()+g.verticalOffset).attr("y2",I)
return this.renderHover(e,t)}clickAction(e){return e.click(this.model.get("sequence"),Re().event.shiftKey)}dblClickAction(e){return e.dblClick(this.model.get("sequence"),Re().event.shiftKey)}updateForAdjust(){this.update(!1)}update(e){null==e&&(e=!0)
if(!this.shouldShow())return
const{slice:t}=this,n=this.slice.start(),a=this.slice.end(),i=this.slice.x(),s=this,r=this.slice.get("cutData")
for(const e of Array.from(r))this.augmentCut(e)
this.max=this.maxOverlap(n,a,r)
this.y=Re().scale.linear().domain([0,this.max]).range([this.layout.height({overlap:0}),this.layout.height({overlap:this.max})])
this.setLayers(r)
this.stopListening(null,"change:hover")
this.stopListening(null,"change:selection")
const o=Re().select(this.el).selectAll(".cutsite").data(r)
o.enter().append("svg:g").classed("cutsite",!0)
o.exit().remove()
o.attr("transform",(e=>`translate(${i(e.sliceData(t.cid,"start"))},0)`)).attr("class","cutsite").each((function(e){const t=Re().select(this)
s.handleHoverSelect(e,t)
s.listenTo(e,"change:hover",(()=>s.handleHoverSelect(e,t)))
s.listenTo(e,"change:selected",(()=>s.handleHoverSelect(e,t)))
return s.renderCutsite(this,e)}))
return e?this.trigger("redraw"):void 0}}CutSitesView.initClass()
const za=CutSitesView
var $a=n(685766)
class DNASearchResultsView extends Na{static initClass(){this.prototype.className="dnaSearch"
this.prototype.setting=Yt.B$.name}getData(e,t){return $a.C.get().get("results").slice(e,t,this.model.get("sequence"),$a.C.get().get("onlyShowSelected"))}getLayout(){return this.model.get("layout").DNASearchResult}contextMenuOptions(){return getSelectionMenu({alignment:"alignment"===this.mapType})}contextMenuData(e){return{tabstate:this.tabstate}}registerListeners(){super.registerListeners()
const e=$a.C.get().get("results")
this.listenTo(e,"change:selected",(function(e,t,n){$a.C.get().get("onlyShowSelected")&&t?this.update():this.handleHoverSelect(e,t)}))
this.listenTo(e,"reset",(function(){return this.update()}))
this.listenTo(this.layout.get("DNA"),"change:complement",(function(){return this.update()}))}rerenderSingle(e,t,n,a,i,s){let r
const o=this.layout.get("DNA").get("complement"),l=s.strand()
let c=i
if(o&&0!==l)if(1===l){r=0
c=i/2}else{r=i/2
c=i/2}else{r=0
c=i}Re().select(e).select(".layer-fill").attr("x",0).attr("y",r).attr("width",a).attr("height",c).attr("fill",this.layerFill).attr("fill-opacity",this.layerFillOpacity).attr("stroke","black").attr("stroke-width",1)}}DNASearchResultsView.initClass()
const Wa=DNASearchResultsView
var Ha=n(726092),ja=n(806326)
const Ya=class ResiduesView extends ha{initialize(e){super.initialize(e)
this.svgSupportsForeignObject=e.svgSupportsForeignObject
this.tabstate=e.tabstate
this.parent=e.parent
this.slice=e.slice
this.selection=this.model.get("polymer").get("selection")}registerListeners(){super.registerListeners()
this.listenTo(Ha.Rj.get(),"change:areFontsReady",(()=>{this.update(!0)}))}splitResidues(e){const t=[]
for(let n=0;n<e.length;n+=6e4)t.push(e.slice(n,n+6e4))
return t}appendTextRows(e,t){let n,a,i,s,r
if(this.svgSupportsForeignObject){n="foreignObject"
a=0
i="span"
s="xhtml:span"
r=this.layout.innerHeight()}else{n="text"
a=this.layout.height()
i="tspan"
s="svg:tspan"
r=0}const o=e.selectAll(".text-container").data(t)
o.exit().remove()
o.enter().append(n).classed("text-container",!0)
We.Z.get(ja.QZ.ALIGNMENTS_BASES_TEXT_USE_GEOMETRIC_PRECISION)&&o.style("text-rendering","geometricPrecision")
const l=o.selectAll(i).data((e=>this.splitResidues(this.layout.get("visible")?this.getText(e):"")))
l.enter().append(s)
l.exit().remove()
l.text((e=>e))
const c=this.layout.get("type").fontSize
let d=this.layout.get("type").letterSpacing
Ha.Rj.get().get("areFontsReady")&&(d+=(0,Ha.uh)(c))
o.attr("width",this.slice.get("maxWidth")).attr("height",this.layout.innerHeight()+r).attr("font-size",c).attr("letter-spacing",d).attr("transform",((e,t)=>{const n=this.layout.get("type").letterSpacing/2
return`translate(${this.getStartOffset(e)+n}, ${a+t*(this.layout.height()+this.layout.get("spacer"))})`}))}}
function addTestAttrsToDOMElement(e,t){for(const[n,a]of Object.entries((0,ee.Z)(t)))e.setAttribute(n,a)}class DNAView extends Ya{constructor(){super(...arguments)
this.showComplement=()=>{this.layout.set({complement:this.shouldShowComplement()})
this.update(!0)}}static initClass(){this.prototype.className="dna residues"
this.prototype.setting=Yt.Jv.name}bottomMarginBleed(){return 4}initialize(e){super.initialize(e)
this.layout=this.model.get("layout").DNA
this.sequence=this.model.get("sequence")
this.traceData=e.traceData
this.layout.set({complement:this.shouldShowComplement()})
const t=this.sequence.isRNASequence()&&this.model.get("zoom")===Kt.DETAILED_NUCLEOTIDE_SEQUENCE_STATIC_ZOOM
this.layout.set({detailedView:this.sequence.isOligo()||t})}complementOption(){return this.model.get("visibilityOptions").getOption(Yt.dq.name)}baseQualityCasingOption(){return this.model.get("visibilityOptions").getOption(Yt.bK.name)}shouldShow(){return this.option.get("visible")}shouldShowComplement(){const e=this.complementOption()
return null!=e&&e.get("visible")}registerListeners(){super.registerListeners()
this.listenTo(this.complementOption(),"change:visible",this.showComplement)
this.listenTo(this.model.get("sequence").get("_sequence"),"change:type",this.showComplement)
const e=this.baseQualityCasingOption()
null!=e&&this.listenTo(e,"change:visible",(()=>{this.update(!0)}))}die(){super.die()
Re().select(this.el).select("g").selectAll("rect").on(".dnaview",null)
Re().select(this.el).select("g").selectAll("text").on(".dnaview",null)}getText(e){return e.visible?e.bases:""}getStartOffset(e){return 0}getBasesData(){var e,t
const basesCasedByQuality=(e,t)=>t.map(((t,n)=>t&&t>=dt.ZP.MOLBIO_ALIGNMENT_CAPITALIZATION_QUALITY_THRESHOLD?e[n].toUpperCase():e[n].toLowerCase())).join(""),[n,a]=this.sequence.get("dna").slice(this.slice.start(),this.slice.end()),i=[{...n,visible:!0},{...a,visible:this.shouldShowComplement()}],s=null===(e=this.baseQualityCasingOption())||void 0===e?void 0:e.get("visible")
if(s&&(null===(t=this.traceData)||void 0===t?void 0:t.get("qualityScores").length)>0){const e=this.traceData.get("qualityScores").slice(this.slice.start(),this.slice.end())
return[{...i[0],bases:basesCasedByQuality(i[0].bases,e)},{...i[1],bases:basesCasedByQuality(i[1].bases,e)}]}return s?[{...i[0],bases:i[0].bases.toUpperCase()},{...i[1],bases:i[1].bases.toUpperCase()}]:i}update(e){if(!this.shouldShow())return
const t=this.layout.get("type").manual?[]:this.getBasesData(),n=Re().select(this.el).select("g").selectAll("rect").data(["test"])
n.exit().remove()
n.enter().append("svg:rect")
let a=this.slice.x()
const i=a(this.slice.end())-a(0)
n.attr("x",0).attr("y",0).attr("width",i).attr("height",this.layout.innerHeight()).classed("container-hidden",!0)
const s=Re().select(this.el).select("g")
s.on("contextmenu.dnaview",l.default.bind((()=>{if(Re().event.altKey&&window.debug)return
const e=Re().event.pageX-this.$el.offset().left
a=Math.round(this.slice.xInv()(e))
this.model.get("sequence").get("selection").reset(a)}),this))
this.layout.get("detailedView")&&Re().select(this.el).style("pointer-events","none")
this.appendTextRows(s,t)
e&&this.trigger("redraw")
addTestAttrsToDOMElement(this.el,{component:"SliceView",element:"dna"})}}DNAView.initClass()
const Qa=DNAView
class EmptyPlaceholderView extends ha{static initClass(){this.prototype.className="emptyPlaceholder"
this.prototype.setting=null}initialize(e){super.initialize(e)
this.slice=e.slice
this.layout=this.model.get("layout").EmptyPlaceholder}registerListeners(){super.registerListeners()
this.listenTo(this.model.get("sequence")._sequence(),"change:locked",this.showHandler)
this.listenTo(this.slice,"change:visibleWidth change:start change:end",this.showHandler)}shouldShow(){return!this.model.get("sequence")._sequence().get("locked")&&0===this.slice.start()&&0===this.slice.end()}update(){if(!this.shouldShow())return
const e="Type or paste bases here",t=Re().select(this.el).select(".component-wrapper").selectAll("text").data([e])
t.enter().append("text").attr("font-size",15).attr("text-anchor","middle").text(e)
t.exit().remove()
t.attr("x",this.slice.get("visibleWidth")/2).attr("y",this.slice.get("height")/2)}}EmptyPlaceholderView.initClass()
const Ka=EmptyPlaceholderView
var Ja=n(145007)
const Xa=class PolymerAxisView extends ha{initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.mapType=e.mapType
this.parent=e.parent
this.range=e.range
this.slice=e.slice
this.layout=this.model.get("layout").Axis
this.axis=Re().svg.axis().tickSize(...Array.from(this.layout.get("tickSize")||[]))
Re().select(this.el).select("g").call(this.axis)}getStartIndex(){return this.model.get("sequence").startIndex()}getPolymerLength(){return this.model.get("sequence").length()}registerListeners(){super.registerListeners()
this.range&&this.listenTo(this.range,"rangeChange",(0,Ja.Z)(((e,t)=>{(e||t)&&this.update(!1)}),50))}setTicks(){let e
const t=this.getStartIndex()
e="minimap"===this.mapType&&T.modelToDisplay(this.slice.get("rightBP"),t)>1e6||"linear"===this.mapType&&T.modelToDisplay(this.slice.end(),t)>1e7?4:8
let n=Math.ceil(e*this.slice.get("width")/this.slice.get("visibleWidth"))
n=Math.min(this.getPolymerLength(),n)
this.axis.ticks(n)}tickFunction(e,t){const[n,a]=function scaleExtent(e){const t=e[0],n=e[e.length-1]
return t<n?[t,n]:[n,t]}(e),i=a-n
let s=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10))
const r=t/i*s
r<=.15?s*=10:r<=.35?s*=5:r<=.75&&(s*=2)
const o=Math.ceil(n/s)*s,l=Math.floor(a/s)*s+.5*s
let c={leftBP:this.slice.get("leftBP"),rightBP:this.slice.get("rightBP")}
null!=this.range&&(c={leftBP:Math.floor(this.range.start()),rightBP:Math.floor(this.range.end())})
c.leftBP+=this.getStartIndex()-1
c.rightBP+=this.getStartIndex()-1
const d=o+Math.max(0,Math.floor((c.leftBP-o)/s)-2)*s,u=l-Math.max(0,Math.ceil((l-c.rightBP)/s)-2)*s
return Re().range(d,u,s)}getScale(){const e=this.slice.x().copy()
let t=e.domain().map((e=>T.modelToDisplay(e,this.getStartIndex())))
e.domain(t)
const n=e.ticks,a=this,{mapType:i}=this
e.ticks=function(){let e
e="minimap"===i||null!=a.range?a.tickFunction(this.domain(),...arguments):n.apply(this,arguments)
t=this.domain()
e.length>0&&e[e.length-1]===t[t.length-1]&&e.pop()
0===e.length&&e.push(a.getPolymerLength())
return e}
const s=e.copy
e.copy=function(){const e=s.apply(this,arguments)
e.ticks=this.ticks
return e}
return e}setScale(){this.axis.scale(this.getScale())}_performAdditionalUpdates(){}getTypeOffset(){return this.getBasesType().charWidth()/2}getAxisRoot(){return Re().select(this.el).select("g")}update(e){let t,n,a
null==e&&(e=!0)
if(!this.shouldShow())return
if(0===this.getPolymerLength()){this.$el.hide()
return}this.$el.show()
this.setScale()
this.setTicks()
const i=this.getAxisRoot()
i.call(this.axis)
const s=i.selectAll("g").data(),r=l.default.min(s),o=l.default.max(s),c=i.selectAll("g").filter((e=>e===r)),d=i.selectAll("g").filter((e=>e===o)),u=this.getTypeOffset()
i.attr("transform",`translate(${u},${this.layout.vMargin()})`)
i.select("path").attr("transform",`translate(${-u},0)`)
i.selectAll(".linear-axis-piece").remove()
const m=/[0-9]+/,p=d.node()
if(null!=p){n=70
const e=d.attr("transform").match(m),i=this.slice.get("width")-parseInt(e[0],10)
a=this.layout.get("type").width(p.textContent.length/2+1)
t=a-i
if(t>=0){d.select("text").attr("style","")
d.select("text").attr("text-anchor","end")
n<2*a+t+3&&d.select("text").text("")}}const h=c.node()
if(null!=h){const e=c.attr("transform").match(m),i=parseInt(e[0],10)
a=this.layout.get("type").width(h.textContent.length/2+1)
if(a>=i){const e=/translate\((.+)[\s,)]/.exec(c.attr("transform"))
if(null!=e){const t=e[1],n=-parseFloat(t)
c.select("text").attr("style","")
c.select("text").attr("text-anchor","start")
c.select("text").attr("x",n)
c.select("text").attr("font-size",10)}}t=a-i
n<2*a+t+3&&c.select("text").text("")}Re().select(this.el).selectAll(".axis .tick line").style("stroke-width",1).style("stroke","black")
this._performAdditionalUpdates()
e&&this.trigger("redraw")}}
var ei=n(64717)
class GapToReal extends Xa{static initClass(){this.prototype.className="gapToRealAxis"
this.prototype.setting=Yt.p4.name}initialize(e){super.initialize(e)
return(0,S.hu)(this.model.get("sequence")instanceof ei.Z,"Expected a gap sequence wrapper!")}getBasesType(){return this.model.get("layout").DNA.get("type")}getStartIndex(){return this.model.get("sequence").startIndex()}setScale(){let e,t=this.slice.x().copy(),[n,a]=Array.from(t.domain())
null!=this.range&&([n,a]=Array.from([Math.floor(this.range.start()),Math.floor(this.range.end())]))
const i=this.model.get("sequence").get("_sequence"),s=(()=>{let t,s,r
const o=[]
for(r=i.gapToReal(n),e=r,s=i.gapToReal(a),t=r<=s;t?e<s:e>s;t?e++:e--)o.push(e)
return o})(),r=(()=>{const n=[]
for(e of Array.from(s))n.push(t(i.realToGap(e)))
return n})()
s.unshift(0)
r.unshift(0)
s.push(t.domain()[1])
r.push(t.range()[1])
const o=this.getStartIndex()
t=Re().scale.linear().domain(Array.from(s).map((e=>T.modelToDisplay(e,o)))).range(r)
return this.axis.scale(t)}setTicks(){let e
const t=this.model.get("sequence").get("_sequence"),n=this.getStartIndex()
let a=this.slice.start(),i=this.slice.end()
if(null!=this.range){a=Math.floor(this.range.start())
i=Math.floor(this.range.end())}const s=[]
let r=-1e3
const o=this.slice.x(),l=t.bases().slice(a,i),c=new RegExp(`[^\\${R.P8}]+`,"g")
for(;null!=(e=c.exec(l));){const i=this.getBasesType().numChars(this.slice.get("visibleWidth")/8)
var d=Math.min(i,e[0].length),u=[1,2,5],m=1
const l=function(){let e
m=1
u=[1,2,5]
for(;;){for(e of Array.from(u)){if(e>d)return m
m=e}u=(()=>{const t=[]
for(e of Array.from(u))t.push(10*e)
return t})()}}(),c=a+e.index+1,p=c+e[0].length
let h=t.gapToReal(c),g=t.gapToReal(p-1)+1
h+=n-1
g+=n-1
const E=h
h=Math.ceil(h/l)*l
g%l!=0&&(g=Math.floor(g/l)*l+1)
if(h===g){h=E
g=E+1}for(let e=h;e<g;e+=l){const n=this.layout.get("type").width(String(e).length),a=o(t.realToGap(e))-n/2
if(!(a<r)){r=a+n
s.push(e)}}}return this.axis.tickValues(s)}}GapToReal.initClass()
const ti=GapToReal
class GoldenGateCutSiteView extends LayeredView{static initClass(){this.prototype.className="goldenGateCutSites"}initialize(e){super.initialize(e)
this.layout=this.model.get("layout").GoldenGateCutSite}registerListeners(){super.registerListeners()
this.listenTo(this.layout.get("DNA"),"change:complement",(function(){return this.update()}))
this.listenTo(this.sequence.goldenGateCutSites(),"reset",(function(){return this.update()}))}shouldShow(){return!0}getData(e,t){return this.sequence.goldenGateCutSites().slice(e,t)}layerFill(e){return"#666"}layerFillOpacity(e){return.2}getLayout(){return this.layout}boxHeight(){return 0}isShown(){return!0}contextMenuOptions(){return getSelectionMenu()}contextMenuData(e){return{}}setLayers(){for(const e of Array.from(this.data))e.set("linearLayer",0)}makeLayerPiece(e){e.classed("layer",!0)
e.append("svg:line").classed("layer-cut-fwd",!0)
e.append("svg:line").classed("layer-cut-mid",!0)
e.append("svg:line").classed("layer-cut-rev",!0)
e.append("svg:rect").classed("layer-fill",!0)}rerenderSingle(e,t,n,a,i,s,r,o,l,c){Re().select(e).select(".layer-fill").attr("x",0).attr("y",0).attr("width",a).attr("height",i).attr("fill",this.layerFill).attr("fill-opacity",this.layerFillOpacity)
const d=this.layout.get("DNA").get("complement")
Re().select(e).select(".layer-cut-mid").attr("x1",0).attr("y1",d?i/2:i).attr("x2",a).attr("y2",d?i/2:i).attr("stroke-width",2).attr("stroke","#3498db")
const u=t>=this.slice.start(),m=d&&n<=this.slice.end()
Re().select(e).select(".layer-cut-fwd").classed("hidden",!u)
Re().select(e).select(".layer-cut-rev").classed("hidden",!m)
const p=s.cutSiteOffset()>=0
u&&Re().select(e).select(".layer-cut-fwd").attr("x1",p?0:a).attr("y1",0).attr("x2",p?0:a).attr("y2",d?i/2:i).attr("stroke-width",2).attr("stroke","#3498db")
m&&Re().select(e).select(".layer-cut-rev").attr("x1",p?a:0).attr("y1",i/2).attr("x2",p?a:0).attr("y2",i).attr("stroke-width",2).attr("stroke","#3498db")}clickAction(e){return e.click(this.model.get("sequence"))}}GoldenGateCutSiteView.initClass()
const ni=GoldenGateCutSiteView
class SequenceAxisView extends Xa{static initClass(){this.prototype.className="sequenceAxis"
this.prototype.setting=Yt.Cz.name}getBasesType(){return this.model.get("layout").DNA.get("type")}registerListeners(){super.registerListeners()
this.listenTo(this.slice,"change:leftBP change:rightBP",(0,Ja.Z)((()=>{this.update(!1)}),50))
const e=this.model.get("sequence")._sequence()
this.listenTo(e,"change:startIndex",(()=>{this.update(!1)}))}_drawAssemblyFragments(){const e=this.model.get("sequence")._sequence(),t=ye.Z.of(e).getFragmentResultPieces(e),n=T.length(this.slice.start(),this.slice.end(),e.length())
for(const[a,i,s]of t){const t=T.getRangeOverlap(i,s,this.slice.start(),this.slice.end())
if(t.length>0)for(const i of Array.from(t)){let t
const[s,r]=Array.from(i),o=T.length(s,r,e.length())/n
t=this.slice.start()===s?0:T.length(this.slice.start(),s,e.length())
const l=t/n,c=this.slice.get("width")*o,d=this.slice.get("width")*l-this.getTypeOffset()
this.getAxisRoot().append("path").attr("d",`M 0,0 L ${c},0`).style("stroke",a).style("stroke-width",2).attr("transform",`translate(${d}, 0)`).classed("linear-axis-piece",!0)}}const a=e.startIndex(),getPiece=e=>{for(const n of t){const[t,i,s]=n
if(T.baseInRange(T.displayToModel(e,a),i,s))return n}}
Re().select(this.el).selectAll(".axis .tick line").style("stroke-width",(e=>null!=getPiece(e)?2:1)).style("stroke",(e=>{const t=getPiece(e)
return null!=t?t[0]:"black"}))}_performAdditionalUpdates(){this.model.get("sequence").finalized()?Re().select(this.el).selectAll(".axis .tick line").style("stroke-width",1).style("stroke","black"):this._drawAssemblyFragments()}}SequenceAxisView.initClass()
const ai=SequenceAxisView
var ii=n(992815)
class HomologyRegionAxisView extends ai{static initClass(){this.prototype.className="homologyRegionAxis"
this.prototype.setting=Yt.xs.name}initialize(e){super.initialize(e)
this.layout=this.model.get("layout").AssemblyConstructAxis}_drawAssemblyFragments(){const e=this.getAxisRoot(),t=this.model.get("sequence"),n=t._sequence()
e.append("g").attr("id","nonHomology")
e.append("g").attr("id","homology")
const a=n.fragmentResults().map((e=>({start:e.start(),end:e.end(),color:e.color(),homologyRegionOtherColor:e.homologyRegionOtherColor()})))
for(const{start:i,end:s,color:r,homologyRegionOtherColor:o}of a){const a=T.length(this.slice.start(),this.slice.end(),n.length()),l=T.getRangeOverlap(i,s,this.slice.start(),this.slice.end())
if(l.length>0)for(const[c,d]of l){const l=T.length(c,d,n.length())/a,u=this.slice.get("width")*l,basePairToTranslateX=e=>{let t
t=this.slice.start()===e?0:T.length(this.slice.start(),e,n.length())
const i=t/a
return this.slice.get("width")*i-this.getTypeOffset()}
e.selectAll(".tick").attr("transform",(function(){return`translate(${Re().transform(Re().select(this).attr("transform")).translate[0]},${Kt.ASSEMBLY_CONSTRUCT_AXIS_ADDITIONAL_HEIGHT})`}))
e.selectAll(".tick line").style("stroke-width",1).style("stroke","black")
if(null==o)e.select("#nonHomology").append("rect").attr("x",0).attr("y",0).attr("z",0).attr("width",u).attr("height",12).style("fill",r).attr("transform",`translate(${basePairToTranslateX(c)}, 0)`).classed("linear-axis-piece",!0)
else{const n=(0,ii.j_)({start:c,end:d,color:r,homologyRegionOtherColor:o},basePairToTranslateX)
for(const{startPoint:a,endPoint:r,color:o}of n)e.select("#homology").append("rect").attr("x",0).attr("y",0).attr("z",1).attr("width",r-a).attr("height",12).style("fill",o).attr("transform",`translate(${a}, 0)`).classed("linear-axis-piece",!0).on("dblclick",(()=>{t.get("selection").set({start:i,end:s})
Re().event.stopPropagation()}))}}}}}HomologyRegionAxisView.initClass()
class BaseReactWrapperView extends ha{initialize(e){var t,n,a
super.initialize(e)
this.polymerLayoutName=e.polymerLayoutName
this.className=e.className
e.disableMinimize&&(this.maximiseOption=null)
const i=null!==(t=e.visibilityOptions)&&void 0!==t?t:this.model.get("visibilityOptions")
this.secondaryOptionNames=e.secondarySettings||[]
this.secondaryOptions=(0,Jt.oA)(this.secondaryOptionNames.map((e=>i.getOption(e))))
this.bottomMarginBleed=e.bottomMarginBleed
this.shouldUpdateForAdjust=null!==(n=e.shouldUpdateForAdjust)&&void 0!==n&&n
this.redraw=this.redraw.bind(this)
this.additionalListeners=null!==(a=e.additionalListeners)&&void 0!==a?a:[]}registerListeners(){super.registerListeners()
this.secondaryOptions.forEach((e=>{this.listenTo(e,"change:visible",this.update)
this.listenTo(e.get("settings"),"change:value",this.update)}))
this.listenTo(this.model,"change:polymerLayout",(()=>{this.model.previous("polymerLayout")[this.polymerLayoutName]!==this.model.get("polymerLayout")[this.polymerLayoutName]&&this.update()}))
for(const{other:e,event:t}of this.additionalListeners)this.listenTo(e,t,(()=>{this.update()}))}getLayout(){return this.model.get("polymerLayout")[this.polymerLayoutName]}setupComponentWrapper(){this._renderComponentWrapper()}update(e=!0){this._renderComponentWrapper()
e&&this.trigger("redraw")}updateForAdjust(){this.shouldUpdateForAdjust&&this.update(!1)}remove(){this.die()
return super.remove()}die(){super.die()
u.unmountComponentAtNode(this.el)}}class LayeredReactWrapperView extends BaseReactWrapperView{initialize(e){super.initialize(e)
this.layeringMode=e.layeringMode
this.singleHeight=e.singleHeight
this.getSliceModels=e.getSliceModels
this.renderReact=e.renderReact}getLayersDict(){return getLayersDict(this.getSliceModels(),this.layeringMode)}numLayers(){return Object.keys(this.getLayersDict()).length}getYFn(){const e=this.numLayers()
return Re().scale.linear().domain([0,e]).range([0,e*this.singleHeight()])}boxHeight(){const e=this.numLayers()
return this.shouldShow()&&0!==e?e*this.singleHeight()+this.getLayout().vMargin:0}redraw(){this.trigger("redraw")}_renderComponentWrapper(){this.shouldShow()&&(0,Me.A9)(this.renderReact(this.getLayout(),this.redraw,this.getSliceModels(),this.getLayersDict(),this.layeringMode,this.getYFn()),this.el)}}class LineView extends ha{static initClass(){this.prototype.className="line"
this.prototype.setting=Yt.fq.name}initialize(e){this.tabstate=e.tabstate
this.slice=e.slice
this.layout=e.lineLayout
this.behind=e.behind
this.behind&&this.layout.setBehind()
super.initialize(e)}registerListeners(){super.registerListeners();(this.model instanceof En.v_||this.model instanceof En.CE)&&this.listenTo(this.model.get("sequence").get("_sequence"),"renderLineRanges",(()=>{this.update(!1)}))}getPath(e,t){const n=this.tabstate.getLineRanges(this.model)
return{correctPath:this._getDataString(n.correct,e,t),mutationPath:this._getDataString(n.mutation,e,t),unknownPath:this._getDataString(n.unknown,e,t)}}_getDataString(e,t,n){let a=""
for(const i of e){a+=`M${t(i[0][0])},${n(i[0][1])} `
let e=-1,s=-1
for(const r of i.slice(1)){const i=Math.max(s+1,t(r[0])),o=n(r[1])
o!==e&&(s=t(r[0]))
a+=`L${i},${o} `
e=o}}return a}shouldShow(){return this.option.get("visible")}update(e=!0){const t=this.slice.x(),n=this.behind?this.tabstate.getType().height():this.layout.height(),a=Re().scale.linear().domain([0,1]).range([n,0]),i=l.default.filter(l.default.pairs(this.getPath(t,a)),(e=>e[1].length>0)),s=Re().select(this.el).select("g").selectAll("path").data(i),r=this.layout.get("correctFillColor"),o=this.layout.get("mutationFillColor"),c=this.layout.get("unknownValueFillColor")
s.exit().remove()
s.enter().append("svg:path")
s.attr("d",(e=>e[1])).attr("fill",(e=>"correctPath"===e[0]?r:"unknownPath"===e[0]?c:o)).attr("fill-opacity",this.layout.get("fillOpacity")).attr("data-test-component","LineView").attr("data-test-element","path")
e&&this.trigger("redraw")}}LineView.initClass()
const si=LineView
var ri=n(647863),oi=n(634489),li=n(860280)
class NucleotidePositionHighlightConnector extends oi.C{enhanceProps(){var e
const t=this.reduxState().ui.molbio.nucleotidesUI[this.props.sequenceId]
return{editingNucleotideIndices:null!==(e=null==t?void 0:t.editingNucleotideIndices)&&void 0!==e?e:[],onCompleteEditAnimation:e=>{this.dispatch((0,zn.oB)(this.props.sequenceId,e))}}}}const ci=g.mM.create({editingIndex:{animationFillMode:"forwards",animationName:[{"0%":{fill:"rgba(235, 135, 21, 0.15)"},"67%":{fill:"rgba(235, 135, 21, 0.15)"},"100%":{fill:"rgba(235, 135, 21, 0)"}}],animationDuration:"3s"},emptyIndex:{fillOpacity:0}}),di=NucleotidePositionHighlightConnector.connect((function NucleotidePositionHighlight({height:e,editingNucleotideIndices:t,layout:n,onCompleteEditAnimation:a,sliceStart:i,sliceEnd:s,xFn:r}){const o=[]
for(let e=i;e<s;e++)o.push(e)
return d.createElement("svg",null,d.createElement(Pa.Z,{layout:n,shouldStopMouseDownPropagation:!1},d.createElement("g",{fill:"none"},o.map((n=>d.createElement("g",{key:n},d.createElement("rect",{onAnimationEnd:()=>{a(n)},className:t.includes(n)?(0,g.iv)(ci.editingIndex):(0,g.iv)(ci.emptyIndex),x:r(n),y:0,width:(0,li.M)(r,i),height:e})))))))}))
var ui=n(690774),mi=n(250965)
const pi=class TranslationLayeredView extends LayeredView{initialize(e){super.initialize(e)
this.tabstate=e.tabstate
const t=this.model
this.translationLayout=t.get("layout").Translations
this.opacityFactor=1
this.fontOpacityFactor=1
this.enableMousedown=!0}indexShown(){return!1}makeLayerPiece(e){e.classed("layer",!0)
e.each((function(){return mi(this).tooltip({delay:100,trigger:"hover",placement:"top",container:"body"})}))}getRenderStart(){return this.slice.start()}getRenderEnd(){return this.slice.end()}aminoAcidFillColor(e,t){return e.color}_clickHandler(e,t,n,a){const i=this.model.get("sequence").translations()
if(this.enableMousedown){if(Re().event.shiftKey){e.expandRange(n,a)
t.set({selected:!0})}else{e.reset(n)
e.setEndpoints(n,a)
i.each((e=>e.set({selected:e.uid()===t.uid()})))
e.addHandlers({reset:()=>t.set({selected:!1}),linearExtend:()=>t.set({selected:!1}),circularExtend:()=>t.set({selected:!1})})}Re().event.stopPropagation()}}_dblClickHandler(e,t){if(this.enableMousedown){const n=t.start(),a=t.end()
e.reset(n)
t.set({selected:!0})
e.setEndpoints(n,a)
e.addHandlers({reset:()=>t.set({selected:!1}),linearExtend:()=>t.set({selected:!1}),circularExtend:()=>t.set({selected:!1})})
Re().event.stopPropagation()}}rerenderSingle(e,t,n,a,i,s,r,o){let l,c=i
const d=this.translationLayout.get("single").get("type"),u=this.translationLayout.get("colorScheme"),m=d._width+d.letterSpacing,p=this.slice.start(),h=this.slice.end(),g=this.model.get("sequence")
l=this.translationLayout.get("visible")?s.getAminoAcids(g,Math.max(t,this.getRenderStart()),Math.min(n,this.getRenderEnd()),u):[]
const E=l.map((e=>{e.startPos=e.indexStart>h?p:Math.max(e.indexStart,p)
e.endPos=e.indexEnd<p?h:Math.min(h,e.indexEnd)
e.bp=T.length(e.startPos,e.endPos,g.length())%g.length()
const t=String(e.aaIndex).length,n=this.translationLayout.get("indexType")
e.indexType=t<=3?n:new bn.Z(n.fontSize-2)
return e}))
Re().select(e).attr("transform",`translate(0, ${o})`)
const f=Re().select(e).selectAll("g.amino-acid-group").data(E),S=f.enter().append("svg:g").classed("amino-acid-group",!0),y=this.slice.x()
f.attr("transform",(e=>`translate(${y(e.startPos)}, 0)`))
S.append("svg:path")
S.append("svg:text").classed("amino-acid",!0)
S.append("svg:text").classed("amino-acid-index",!0)
const b=g.get("selection"),v=this.translationLayout.indexHeight(this.indexShown()),getBaseWidth=e=>e.bp*m,C=m/2
f.select("path").attr("d",(e=>{const t=getBaseWidth(e),n=t+C
c=d.height()
return`M 0 0 L ${t} 0 L ${n} ${c/2} L ${t} ${c} L 0 ${c} L ${n-t} ${c/2} L 0 0`})).attr("shape-rendering","geometricPrecision").attr("transform",(e=>{const t=getBaseWidth(e),n=`translate(0, ${v})`
return-1===s.strand()?`rotate(180 ${t/2} ${c/2+v}) ${n}`:n})).attr("stroke",(()=>this.strokeColor())).attr("fill",(e=>this.aminoAcidFillColor(e,s))).attr("fill-opacity",s.selected()&&this.enableMousedown?.75:.5*this.opacityFactor).classed(`translation-${s.uid()}`,!0).on("mousedown",(e=>{this._clickHandler(b,s,e.indexStart,e.indexEnd)})).on("dblclick",(()=>{this._dblClickHandler(b,s)}))
f.select(".amino-acid").text((e=>e.bp>1?e.b:"")).attr("font-size",d.fontSize).attr("fill-opacity",this.fontOpacityFactor).attr("x",(e=>e.bp>=3?(e.bp*m-d._width)/2:2===e.bp?m+d.letterSpacing:0)).attr("y",v+d.height()-3).attr("pointer-events","none")
f.select(".amino-acid-index").text((e=>e.bp>1&&this.indexShown()&&(s.totalGroupLength(g)<300||e.aaIndex%2==0)?e.aaIndex:"")).attr("font-size",(e=>e.indexType.fontSize)).attr("x",(e=>e.bp>=2?(e.bp*m-e.indexType._width*String(e.aaIndex).length)/2:0)).attr("y",(e=>e.indexType.height()-3)).attr("pointer-events","none")
f.exit().remove()
addTestAttrsToDOMElement(this.el,{component:"SliceView",element:"translations"})}strokeColor(){return null}}
class ORFsView extends pi{static initClass(){this.prototype.className="orfs"
this.prototype.setting=Yt.D1.name}getData(e,t){const n=this.model.get("sequence"),a={minLength:this.visibilityOption.getSetting("minimum-orf-length").get("value"),frame:this.visibilityOption.getSetting("orf-frame").get("value"),sequence:n,startCodon:this.visibilityOption.getSetting("orf-start-codon").get("value")}
return n.get("orfs").slice(e,t,a)}getLayout(){return this.showAAs()?this.model.get("layout").Translations:this.model.get("layout").ORFs}isShown(){return this.shouldShow()}contextMenuOptions(){return getSelectionMenu()}contextMenuData(e){return{orf:e,feature:e}}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.layout=this.model.get("layout").ORFs
this.layerFill=l.default.partial(this.layerFill,this.layout)
this.visibilityOption=this.tabstate.get("visibilityOptions").getOption("orfs")
this.opacityFactor=.65
this.fontOpacityFactor=.7
return this.enableMousedown=!1}strokeColor(){return"#00AA00"}showAAs(){return"linear"===this.parent.mapType&&Boolean(function ORFsView_guard_(e,t){return null!=e?t(e):void 0}(this.visibilityOption.getSetting("show-orf-amino-acids"),(e=>e.get("value"))))}layerFillOpacity(e){return 1}layerFill(e,t){return t.get("hover")||t.selected()?Re().rgb(t.color()).darker().toString():t.color()}registerListeners(){super.registerListeners()
const e=this.model.get("sequence").get("orfs")
this.listenTo(e,"change:hover change:selected",((e,t)=>{if(!this.showAAs())return this.handleHoverSelect(e,t)}))
return this.listenTo(e,"click",this.pieceClickHandler)}clickAction(e){return e.click(this.model.get("sequence"),Re().event.shiftKey)}dblClickAction(e){return e.dblClick(this.model.get("sequence"),Re().event.shiftKey)}pieceClickHandler(e){const t=this.slice.xInv(),n=Math.floor(t(Re().mouse(this.parent.el)[0]))
return ma.gW({isLinear:this.isLinear,mapId:this.model.cid,index:n},this,(function(){return this.clickAction(e)}))}pieceDblClickHandler(e){const t=this.slice.xInv(),n=Math.floor(t(Re().mouse(this.parent.el)[0]))
return ma.gW({isLinear:this.isLinear,mapId:this.model.cid,index:n},this,(function(){return this.dblClickAction(e)}))}rerenderSingle(e,t,n,a,i,s,r,o){let c
if(this.showAAs()){Re().select(e).selectAll(".layer-fill").remove()
Re().select(e).selectAll(".hidden-background").remove()
Re().select(e).selectAll(".start-positions").remove()
Re().select(e).selectAll(".end-positions").remove()
return super.rerenderSingle(e,t,n,a,i,s,r,o)}{let i
Re().select(e).selectAll(".amino-acid-group").remove()
const r=Re().select(e).data([s])
r.append("svg:path").classed("layer-fill",!0).classed("line",!0)
r.append("svg:path").classed("hidden-background",!0)
r.append("svg:g").classed("start-positions",!0)
r.append("svg:g").classed("end-positions",!0)
const o=this.slice.start(),d=this.slice.end()
t=(0,Jt.uZ)(o,d,t)
n=(0,Jt.uZ)(o,d,n)
const u=s.strand(),m=a,p=this.getLayout().get("single").get("lineHeight"),h=this.getLayout().get("single").get("height"),g=this.slice.x(),shouldShow=e=>l.default.some(function ORFsView_range_(e,t,n){const a=[],i=e<t,s=n?i?t+1:t-1:t
for(let t=e;i?t<s:t>s;i?t++:t--)a.push(t)
return a}(e,e+3*u,!1),(e=>T.baseInRange(e,o,d))),E=l.default.filter(s.startPositions(),(e=>shouldShow(e))),f=(l.default.filter([s.endPosition()],(e=>null!=e&&shouldShow(e))),-1===u?1:0),S=t-o,y=g(o+3)-g(o)
i=y>3?function(e){const t=E[e],n=(0,Jt.uZ)(o,d,t+f),a=(0,Jt.uZ)(o,d,t+2*u+f),i=(0,Jt.uZ)(o,d,t+3*u+f),s=g(n-S),r=g(a-S)
return`M ${s} 0 L ${r} 0 L ${g(i-S)} ${h/2} L ${r} ${h} L ${s} ${h} Z`}:function(e){const t=E[e],n=g(t-S)
return`M ${n} 0 L ${n} ${h}`}
const b=(()=>{let e,t
const n=[]
for(c=0,t=E.length,e=0<=t;e?c<t:c>t;e?c++:c--)n.push(s)
return n})(),v=Re().select(e).select("g.start-positions").selectAll("path.start-position").data(b)
v.enter().append("svg:path").classed("start-position",!0).classed("layer-fill",!0)
v.attr("d",((e,t)=>i(t))).attr("fill",this.layerFill).attr("fill-opacity",this.layerFillOpacity).attr("shape-rendering","geometricPrecision").attr("stroke-width",1).attr("stroke",this.layerFill)
v.exit().remove()
const C=`M 0 ${h/2} L ${m} ${h/2} L ${m} ${h/2+p} L 0 ${h/2+p} Z`,I=`M 0 ${h/2-3} L ${m} ${h/2-3} L ${m} ${h/2+p+3} L 0 ${h/2+p+3} Z`
Re().select(e).select("path.line").attr("d",C).attr("fill",this.layerFill).attr("fill-opacity",this.layerFillOpacity)
return Re().select(e).select("path.hidden-background").attr("d",I).attr("fill","white").attr("fill-opacity",0)}}}ORFsView.initClass()
const hi=ORFsView
var gi=n(659009),Ei=n(463369),fi=n(205001),Si=n(297377)
const{doenchScore:yi}=Si.Z
class PAMSite extends s().Model{strand(){return this.guide().strand}pos(){return this.analysis().isLeftPam?1===this.guide().strand?this.start()+gi.LEFT_PAM_TO_CUT_DISTANCE:this.end()-gi.LEFT_PAM_TO_CUT_DISTANCE:1===this.guide().strand?this.end()-gi.PAM_TO_CUT_DISTANCE:this.start()+gi.PAM_TO_CUT_DISTANCE}onTargetScore(){return null!=this.guide().onTargetScore?Math.floor(this.guide().onTargetScore):null}offTargetScore(){if(null!=this.guide().offTargetScore)return Math.floor(this.guide().offTargetScore)}guide(){return this.get("guide")}sequence(){return this.get("sequence")}analysis(){return this.get("analysis")}start(){return fi.guideStart(this.guide(),this.sequence().length(),this.analysis().isLeftPam)}end(){return fi.guideEnd(this.guide(),this.sequence().length(),this.analysis().isLeftPam)}}class PAMSites extends s().Collection{static initClass(){this.prototype.model=PAMSite}}PAMSites.initClass()
class PAMSitesView extends ha{static initClass(){this.prototype.className="pamSites"}initialize(e){({tabstate:this.tabstate,slice:this.slice,strand:this.strand,parent:this.parent,componentClassName:this.componentClassName}=e)
this._renderPamSite=this._renderPamSite.bind(this)
this.className+=` ${this.componentClassName}`
this._layout=this.model.get("layout")
this.layout=this._layout.PAMSites
this.sites=new PAMSites
this.search=new $a.C
const t=this.model.get("sequence")
this.search.addSequences([t])
this.search.set({sequence:t})
super.initialize(e)}registerListeners(){super.registerListeners()
this.listenTo(this.layout,"change:analysis",(function(){return this.update()}))
this.listenTo(this.slice,"change:start change:end",(function(){return this.update()}))
const e=Ei.Z.KEYS.SHOW_CUTS_OUTSIDE_REGIONS
this.listenTo(We.Z,`change:${Ei.Z.getKey(e)}`,(function(){return this.update()}))}boxHeight(){return this.shouldShow()?this.layout.boxHeight({overlap:this.max+1}):0}_computeSites(){const e=this.model.get("sequence"),t=this.layout.get("analysis"),n=t.guideLength+t.pam.length,a=Math.max(this.slice.start()-n,0),i=Math.min(this.slice.end()+n,e.length())
let s=fi.findGuidesInRange(e,this.search,t,a,i,this.strand)
s=fi.filterGuides(e,t,s,{skipTypeFilter:!0,skipCutsOutsideRegions:!Ei.Z.get(Ei.Z.KEYS.SHOW_CUTS_OUTSIDE_REGIONS)})
s=s.filter((e=>T.baseInRange(e.position,this.slice.start(),this.slice.end())))
this.sites.reset(s.map((n=>{let a
for(const i of Array.from(t.regions)){a=l.default.findWhere(i.guides,(0,he.Z)(n,"position","strand"))
if(null!=a)return{guide:a,sequence:e,analysis:t}}return{guide:n,sequence:e,analysis:t}})))}_renderPamSite(e){const t=this.slice.x(),n=this.layout.get("scoreToColor"),a=this.layout.get("type"),i=this.layout.get("analysis"),s=this.layout.get("lineHeight"),r=this.layout.height({overlap:this.max+1}),o=this.parent.yIndexMap[this.componentClassName]<this.parent.yIndexMap.dna,l=Re().scale.linear().domain([0,this.max])
o?l.range([0,this.layout.height({overlap:this.max})]):l.range([this.layout.height({overlap:this.max})+s,s])
const c=this._layout.DNA
let d=this.parent.boxHeightToDNA(this.componentClassName)
c.get("visible")&&(d+=c.vMargin()+c.get("type").verticalOffset)
const u=o?a.height():0
e.attr("transform",(({range:e,layer:t})=>`translate(0, ${l(t)})`))
e.select(".pamSite-line").attr("d",(({model:e,layer:n})=>{const a=t(e.pos())
return`M ${a} ${function yAtDNA(e){return o?-l(e)+r+d+s:-l(e)-d}(n)} L ${a} ${u}`})).attr("fill","none").attr("visibility",(({range:e})=>e.showGuide?"visible":"hidden"))
const scoreToBorderColor=e=>Re().rgb(n(e)).darker(.6)
e.selectAll(".pamSite-score-rect").attr("height",a.height()).attr("stroke-width",1).attr("stroke","black")
const m=e.select(".pamSite-score--on").attr("visibility",(({range:e})=>e.showGuide&&e.showOnTarget?"visible":"hidden")).attr("transform",(({range:e})=>`translate(${e.start}, 0)`))
m.select(".pamSite-score-rect").attr("width",(({model:e})=>this.layout.scoreWidth())).attr("stroke",(({model:e})=>scoreToBorderColor(e.onTargetScore()))).attr("fill",(({model:e})=>n(e.onTargetScore())))
const p=e.select(".pamSite-score--off").attr("visibility",(({range:e})=>e.showOffTarget&&e.showGuide?"visible":"hidden")).attr("transform",(({range:e})=>e.showOnTarget?`translate(${e.start+this.layout.scoreWidth()}, 0)`:`translate(${e.start}, 0)`))
p.select(".pamSite-score-rect").attr("width",(({model:e})=>i.isLeftPam&&null==e.offTargetScore()?this.layout.leftPamBoxWidth():this.layout.scoreWidth())).attr("stroke",(({model:e})=>i.isLeftPam&&null==e.offTargetScore()?this.layout.get("grayColor"):scoreToBorderColor(e.offTargetScore()))).attr("fill",(({model:e})=>i.isLeftPam&&null==e.offTargetScore()?this.layout.get("grayColor"):null!=e.offTargetScore()?n(e.offTargetScore()):this.layout.get("loadingColor")))
const updateScores=e=>{e.attr("text-anchor","middle").attr("font-size",a.fontSize).attr("dy",a.height()-3).attr("x",(({model:e})=>i.isLeftPam&&null==e.offTargetScore()?this.layout.leftPamTextOffset():this.layout.textOffset()))}
m.select(".pamSite-score-label").call(updateScores).text((({model:e})=>i.isLeftPam?"Cpf1":null!=e.onTargetScore()?e.onTargetScore():""))
p.select(".pamSite-score-label").call(updateScores).text((({model:e})=>null!=e.offTargetScore()?e.offTargetScore():i.isLeftPam?"Cpf1":""))}_siteRange(e){let t,n,a
const i=this.slice.x(),s=this.slice.get("maxWidth"),r=this.layout.get("hMargin")
if(this.layout.get("analysis").isLeftPam){a=!1
n=!0
t=!0}else{a=null==this.layout.pamSiteOnTargetMin()||e.onTargetScore()>this.layout.pamSiteOnTargetMin()
n=null!=e.offTargetScore()&&(null==this.layout.pamSiteOffTargetMin()||e.offTargetScore()>this.layout.pamSiteOffTargetMin())
t=a&&(null==e.offTargetScore()||n)}const o=this.layout.scoreWidth()*l.default.compact([a,n]).length
let c=i(e.pos())-o/2
c<=0?c=0:c+o>s&&(c=s-o)
return{start:c,end:c+o+r,showOnTarget:a,showOffTarget:n,showGuide:t}}die(){Re().select(this.el).selectAll(".pamSite-score").each((function(){return o()(this).tooltip("destroy")}))
super.die()}updateForAdjust(){this.update(!1,!1)}update(e,t){let n
null==e&&(e=!0)
null==t&&(t=!0)
if(!this.shouldShow()||!t&&0===this.model.get("sequence").length()||"base_edit"===function PAMSitesView_guard_(e,t){return null!=e?t(e):void 0}(this.layout.get("analysis"),(e=>e.designType)))return
if(t)if(null!=this.layout.pamSiteOnTargetMin()||null!=this.layout.pamSiteOffTargetMin())this._computeSites()
else{if(0===this.sites.length)return
this.sites.reset()}const a={}
this.sites.forEach((e=>a[e.cid]=this._siteRange(e)))
const i=this.sites.filter((e=>a[e.cid].showGuide));({layers:n,max:this.max}=Ia.xb(i,{startFn:e=>({model:e,pos:a[e.cid].start}),endFn:e=>({model:e,pos:a[e.cid].end})}))
const s=l.default.sortBy(n,"layer").map((({model:e,layer:t})=>({model:e,layer:t,range:a[e.cid]}))),r=Re().select(this.el).select(".component-wrapper").selectAll(".pamSite").data(s)
function enterScoreG(e,t,n){e.attr("class",`pamSite-score pamSite-score--${n}`)
e.append("svg:rect").attr("class","pamSite-score-rect")
e.append("svg:text").attr("class","pamSite-score-label")
e.each((function(){o()(this).tooltip({delay:{show:500,hide:0},trigger:"hover",placement:"top",container:"body",title:t})}))}const c=r.enter().append("svg:g").attr("class","pamSite")
c.append("svg:path").attr("class","pamSite-line")
c.append("svg:g").call(enterScoreG,"On-Target","on")
c.append("svg:g").call(enterScoreG,"Off-Target","off")
c.append("svg:text").attr("class","pamSite-label")
c.on("mousedown",(({model:e})=>{Re().event.stopPropagation()
this.model.get("sequence").selection().setEndpoints(e.start(),e.end())}))
r.exit().each((function(){return Re().select(this).selectAll(".pamSite-score").each((function(){return o()(this).tooltip("destroy")}))})).remove()
r.call(this._renderPamSite)
e&&this.trigger("redraw")}}PAMSitesView.initClass()
const bi=PAMSitesView
var Ti=n(815363)
const vi="#0B818E",Ci=Vt.pF,Ii=Vt.JF,wi=Vt.pF
function getColor(e,t){return e?Ii:t?Ci:vi}class ViewPart extends s().Model{start(){return this.get("start")}end(){return this.get("end")}color(){return this.get("outOfSync")?Vt.L3:this.get("baseFillColor")}hover(){return!1}selected(){return!1}displayLabel(){return this.get("name")}uid(){return this.cid}partRef(){return this.get("partRef")}}function splitPartsIntoHighlightRegions(e,t){if(!e.length)return[]
const n=[],a=function linearizeParts(e){return e.flatMap((e=>function isCrossOrigin(e){return 0!==e.end()&&e.start()>=e.end()}(e)?[{start:e.start(),end:0,part:e},{start:0,end:e.end(),part:e}]:[{start:e.start(),end:e.end(),part:e}]))}(e).flatMap((e=>{return[{index:e.start,isEnd:!1,partRef:e.part},{index:(n=e.end,a=t.length(),0===n?a:n),isEnd:!0,partRef:e.part}]
var n,a}))
a.sort(((e,t)=>function pointCompare(e,t){const n=e.partRef.id===t.partRef.id?Number(e.isEnd)-Number(t.isEnd):Number(t.isEnd)-Number(e.isEnd)
return e.index===t.index?n:e.index-t.index}(e,t)))
const i={[a[0].partRef.id]:a[0].partRef}
for(const[e,s]of a.slice(1).entries()){const r=a[e],o=Object.values(i).length
s.index>r.index&&o>0&&n.push({start:r.index,end:s.index===t.length()?0:s.index,name:s.partRef.name(),isArchived:s.partRef.sequence().isArchived(),baseFillColor:s.partRef.color(),isOverlap:o>1,outOfSync:Object.values(i).some((e=>!e.isInSync(t._sequence()))),partRef:o>1?null:Object.values(i)[0]})
!s.isEnd||r.index===s.index&&r.partRef===s.partRef?i[s.partRef.id]=s.partRef:delete i[s.partRef.id]}return n}function getFillColor(e){const t=Re().rgb(e.baseFillColor)
return e.isOverlap?t.darker().toString():t.toString()}function getFillOpacity(e){let t=.75
!dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS&&e.isArchived&&(t*=.5)
return t}function getStrokeColor(e){const t=Re().rgb(wi)
return e.isOverlap?t.darker().toString():t.toString()}function getTopLineColor(e){const t=e.outOfSync?Re().rgb(Ii):Re().rgb(vi)
return e.isOverlap?t.darker().toString():t.toString()}function getRectangularPath(e,t,n,a,i,s,r){const o=Math.max(t,e.start),l=Math.min(n,e.start+T.length(e.start,e.end,r.length())),c=a(o),d=a(l)
return`M ${c} ${i} L ${d} ${i} L ${d} ${i+s} L ${c} ${i+s} Z`}function getHeight(e,t,n){return n?2*(e+t):e+t}function PartsView({xFn:e,sliceStart:t,sliceEnd:n,sequence:a,polymerLayout:i,dnaHeight:s,dnaSpacer:r,complementVisible:o,mapType:l,redraw:c}){const u=function getPartRegionsForSlice(e,t,n){const a=n.length()
if(e>a)return[]
const i=Math.min(t,a)
return splitPartsIntoHighlightRegions(n.parts().getSequencePartsBetween(e,i),n)}(t,n,a),m=new bn.Z(13),p=m.height()+2
!function useRedraw(e){const{redraw:t,shouldRedraw:n,newBoxHeight:a}=e;(0,d.useEffect)((()=>{n()?t(a):t(0)}),[t,n,a])}({redraw:c,shouldRedraw:()=>u.length>0,newBoxHeight:p})
const h=p-5
return d.createElement(Pa.Z,{layout:i,shouldStopMouseDownPropagation:!1},d.createElement(d.Fragment,null,u.map(((i,c)=>{const u=function getPartLabelText(e){return e.isArchived?`${e.name} (archived)`:e.name}(i),g=e(i.start),E=function getNameRelativeX(e,t,n,a,i){const s=e.start,r=s+T.length(s,e.end,n),o=a(s)
return(a(r)+o-t.width(i.length))/2}(i,m,a.length(),e,u)
return d.createElement("g",{key:`${i.name}-${c}`},d.createElement("path",{d:getRectangularPath(i,t,n,e,p,getHeight(s,r,o),a),stroke:getStrokeColor(i),strokeWidth:1,strokeOpacity:1,fill:getFillColor(i),fillOpacity:getFillOpacity(i)}),dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS&&d.createElement("path",{d:getRectangularPath(i,t,n,e,h,5,a),fill:getTopLineColor(i),fillOpacity:.75}),!dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS&&d.createElement(P.pf,{tooltipTitle:l===Ts.minimap?u:null},d.createElement(Oe.Z,{renderContent:()=>d.createElement(Ti.V,{id:i.partRef.sequence().id,onClickName:()=>{ve.ZP.get().openFolderItem(i.partRef.sequence().id)},validationExtras:null}),isDisabled:l===Ts.minimap},d.createElement("text",{fontSize:m.fontSize,dx:E<g?g:E,dy:m.height()},E<g?"":u))))}))))}class PrimerAssemblyMismatchView extends LayeredView{static initClass(){this.prototype.className="primerAssemblyMismatches"}initialize(e){super.initialize(e)
this.layout=this.model.get("layout").PrimerAssemblyMismatch}registerListeners(){super.registerListeners()
this.listenTo(this.layout.get("DNA"),"change:complement",(function(){return this.update()}))
this.listenTo(this.sequence.primerAssemblyMismatches(),"reset",(function(){return this.update()}))}shouldShow(){return!0}getData(e,t){return this.sequence.primerAssemblyMismatches().slice(e,t)}layerFill(e){return"#84B0DC"}layerFillOpacity(e){return.4}getLayout(){return this.model.get("layout").PrimerAssemblyMismatch}boxHeight(){return 0}isShown(){return!0}contextMenuOptions(){return getSelectionMenu()}contextMenuData(e){return{}}setLayers(){return Array.from(this.data).map((e=>e.set("linearLayer",0)))}makeLayerPiece(e){e.classed("layer",!0)
e.append("svg:rect").classed("layer-fill",!0)}rerenderSingle(e,t,n,a,i,s,r,o,l,c){this.layout.get("DNA").get("complement")
Re().select(e).select(".layer-fill").attr("x",0).attr("y",0).attr("width",a).attr("height",i).attr("fill",this.layerFill).attr("fill-opacity",this.layerFillOpacity)}clickAction(e){return e.click(this.model.get("sequence"))}}PrimerAssemblyMismatchView.initClass()
const Ni=PrimerAssemblyMismatchView
function getSlicePrimers(e,t,n,a){return e.sequencePrimers().filter((e=>T.isRangeOverlap(e.start(),e.end(),t,n)&&(null==a||e.strand()===a)))}function getSliceHasAnyPrimerMods(e,t,n){return getSlicePrimers(e,t,n).some((e=>getModificationsForPrimerDisplay(e.modifiedNucleotides(),e.nucleotideType()).length>0))}function getPrimerBasesVisible(e){var t,n
return null!==(n=null===(t=e.getOption(Yt.bW.name))||void 0===t?void 0:t.get("visible"))&&void 0!==n&&n}function getPrimerType(e,t){return getPrimerBasesVisible(e)?t:Tn}var Ai=n(478752)
function getNucleotideAwareDisplayName(e){let t=e.displayLabel?e.displayLabel():e.name()
e instanceof Ai.Z&&(t=`${t} (${e.nucleotideType()})`)
return t}function getLayerFill(e,t,n){return t?Re().rgb(e.color()).toString():`url(#stripe-${e.id}-${n})`}function getLayerFillOpacity(e,t){return t?e.hover()||e.selected()?.4:.2:e.hover()||e.selected()?1:.7}function getOverhangFill(e,t,n,a){return e.hasOverhang()&&t&&!n&&a>0?Re().rgb(e.color()).darker().toString():"none"}function getTooltipText(e,t){const n=getNucleotideAwareDisplayName(e),a=e.mismatchedIndices(t)
return a.length>0?`(${a.length} mismatched ${(0,de._6)(a.length,"base")}) ${n}`:n}function PrimersView({xFn:e,yFn:t,sliceStart:n,sliceEnd:a,sequence:i,contextMenuOptions:s,polymerLayout:r,primerBasesVisible:o,sliceHasAnyMods:c,primerType:u,mapType:m,redraw:p,slicePrimers:h,layersDict:g,layeringMode:E}){p()
return d.createElement("svg",null,d.createElement(Pa.Z,{layout:r,shouldStopMouseDownPropagation:!0},d.createElement(d.Fragment,null,h.map((r=>timesPerSlice(r,n,a,r.drawStart(i),r.drawEnd(i)).map(((p,h)=>{var f
const{start:b,end:v}=whichDisplay(n,a,p.drawStart(i),p.drawEnd(i),h,i.length()),C=e(b),I=t(g[p.get(E)]),w=e(v)-e(b),N=getNucleotideAwareDisplayName(p),A=p.mismatchedIndices(i),{boxTransform:R,dashArray:O,strokeRightD:x,strokeRightRender:_,strokeLeftD:D,strokeLeftRender:L,strokeTopD:k,strokeBottomD:M,strokeMiddleRender:F,fillD:Z,leftsideArrow:B,rightsideArrow:q,width:V,bodyHeight:U,showOverhang:G,textProps:z,reverseBaselessBoxTransform:$,overhangD:W}=function getPrimerShape(e,{start:t,end:n,height:a,type:i,sequenceLength:s,xFn:r,sliceStart:o,sliceEnd:c,areBasesVisible:d,circular:u,sequenceDrawEnd:m,sequenceDrawStart:p,bindPosition:h,mismatches:g,dx:E,singleModificationHeight:f,modificationMarginHeight:b,totalModificationHeight:v,modifications:C,nucleotideType:I}){const w=T.getRangeOverlap(t,n,e.start,e.end),N=e.strand,A=e.name,R=e.isNew?"5,5":"1,0"
let P,O,x,_
if(0===w.length){O=0
x=!1
_=!1
P=0}else{const[e,n]=w[0]
O=r(n)-r(e)
x=e>=o
_=n<=c
P=r(e)-r(t)}const D=(0,yn.dA)(e.bases,C,I,fn.uS.OLIGO),L=getModificationsForPrimerDisplay(C,I),k=d&&L.length>0,M=k?i.height()+v:i.height(),F=k?l.default.min([a,O])/2:l.default.min([a,O]),Z=k?(a-M)/2:(a-M)/3,B=k?F/2:F/3,q=d?2:4,V=M/4
let U="crispEdges",G="crispEdges"
const z=`translate(${P}, 0)`,$=`translate(${O-16+P}, 0)`
let W,H,j,Y,Q,K,J,X=!1
if(0===O){H="M 0 0"
Y="M 0 0"
K="M 0 0"
j="M 0 0"
Q="M 0 0"}else{H=""
Y=""
K=""
j=""
Q=""
if(x)if(-1===N){Y+=d?`M ${B} ${M} L ${F} ${a-Z} L ${F} ${a} L 0 ${M} L 0 0`:`M ${F} ${M} L ${F} ${a} L 0 0 `
K+=`M 0 0 L ${F} 0`
j+=d?`M ${B} ${M} `:`M ${F} ${M} `
H+=`${Y}L ${F} 0 `
U="geometricPrecision"}else{W=a
J=a-M
Y+=`M 0 ${W} L 0 ${J} `
K+=`M 0 ${J} `
j+=`M 0 ${W} `
H+=Y
X=!0}else{if(1===N){W=a
J=a-M}else{W=M
J=0}Y+=`M 0 ${W} L ${q} ${W-V} L 0 ${W-2*V} L ${q} ${W-3*V+1} L 0 ${J} `
K+=`M 0 ${J} `
j+=`M 0 ${W} `
H+=Y
U="geometricPrecision"}if(_)if(1===N){if(d){Q+=`M ${O} ${a} L ${O} ${a-M} L ${O-F} 0 L ${O-F} ${Z} L ${O-B} ${a-M}`
K+=`L ${O-B} ${a-M} `
H+=`L ${O-B} ${a-M} L ${O-F} ${Z} L ${O-F} 0 L ${O} ${a-M} L ${O} ${a} L 0 ${a} `}else{Q+=`M ${O} ${a} L ${O-F} 0 L ${O-F} ${a-M} `
K+=`L ${O-F} ${a-M} `
H+=`L ${O-F} ${a-M} L ${O-F} 0 L ${O} ${a} L 0 ${a} `}j+=`L ${O} ${a} `
G="geometricPrecision"}else{Q+=`M ${O} 0 L ${O} ${M} `
K+=`L ${O} 0 `
j+=`L ${O} ${M} `
H+=`L ${O} 0 L ${O} ${M} `
X=!0}else{if(1===N){W=a
J=a-M}else{W=M
J=0}Q+=`M ${O} ${J} L ${O-q} ${W-3*V+1} L ${O} ${W-2*V} L ${O-q} ${W-V} L ${O} ${W} `
K+=`L ${O} ${J} `
j+=`L ${O} ${W} `
H+=`L ${O} ${J} L ${O-q} ${W-3*V+1} L ${O} ${W-2*V} L ${O-q} ${W-V} L ${O} ${W} `
G="geometricPrecision"}}const arrowD=(e,t)=>{const n=1===N?a-M:0,i={[-1]:e+3,0:e,1:e}[t]
return`M ${i} ${4+n} L ${{[-1]:e,0:e,1:e+3}[t]} ${M/2+n} L ${i} ${M-3+n} `}
let ee
const te="M 0 0 L 0 0"
ee=x?te:arrowD(6,N)+arrowD(9,N)
let ne
ne=_?te:arrowD(O-3-3-6,N)+arrowD(O-3-6,N)
if(12>O-F||_&&x){ee=te
ne=te}const ae=i.width(A.length)+24>O-F||d,ie=.2*i.height()
let se,re,oe,le,ce
se=1===N?a-ie:M-ie
if(d){let r,l,d=function zippedBasesAndMods(e,t){const n=t.reduce(((e,t)=>{e[t.position]=t
return e}),{})
return e.split("").map(((e,t)=>({base:e,index:t,modification:n[t]||null})))}(D,L);-1===N&&(d=d.reverse())
if(u)[l,r]=[p,m]
else{l=e.overhangEdge
r=h;-1===N&&([l,r]=[r,l])}const E=T.getRangeOverlap(o,c,t,n)
if(0!==E.length){let e
const[t,n]=E[0]
if(l===t)e=0
else{(0,S.hu)(null!=l,"Error calculating primer position with overhangs")
e=T.length(l,t,s)}const r=T.length(l,n,s)
d=(0,y.circularArraySlice)(d,e,r)
if(d.length>0){const t=a-M+.5*ie+b+.5*f,n=.5*ie+b+.5*f,s=d.map(((e,a)=>null!=e.modification?{cx:a*i.charWidth()+i.charWidth()/2,cy:1===N?t:n,r:.5*f,fill:"#7051FC",shapeRendering:"geometricPrecision",fillOpacity:1}:null)).filter((e=>null!=e))
re={x:0,y:se,"font-size":i.fontSize,transform:"",text:"",fill:void 0,baseProps:d.map(((t,n)=>({x:n*i.charWidth()+i.letterSpacing/2,fill:g.includes(n+e)?"#d9534f":"black",text:t.base}))),modificationProps:dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES?s:[]}}}}else{let e=(O-F-i.width(A.length))/2;-1===N&&(e+=F);-1===N&&(se+=1)
re={x:e,y:se,"font-size":i.fontSize,fill:"black",text:ae||0===E?"":A,transform:z,baseProps:[],modificationProps:[]}}if(1===e.strand){oe=a
le=a-M
const e=(oe+le)/2
ce=`M 16 ${le} L 8 ${le} L 0 ${e} L 8 ${oe} L 16 ${oe} L ${32/3} ${e} L 16 ${le}`}else ce=`M 0 0 L 8 0 L 16 ${M/2} L 8 ${M} L 0 ${M} L 5.333333333333333 ${M/2} L 0 0`
return{strokeRightD:Q,strokeRightRender:G,boxTransform:z,dashArray:R,strokeLeftD:Y,strokeLeftRender:U,strokeTopD:K,strokeBottomD:j,strokeMiddleRender:"crispEdges",fillD:H,leftsideArrow:ee,rightsideArrow:ne,useTooltip:ae,width:O,bodyHeight:M,showOverhang:X,textProps:re,reverseBaselessBoxTransform:$,overhangD:ce}}({start:p.start(),end:p.end(),strand:p.strand(),bases:p.bases(),overhangEdge:p.overhangEdge(),name:N,isNew:p.get("_primer").isNew()&&[Ts.linear,Ts.minimap].includes(m)},{start:b,end:v,height:getSinglePrimerInnerHeight(u,c,o),type:u,singleModificationHeight:getSingleModificationHeight(u),modificationMarginHeight:getModificationMarginHeight(u),totalModificationHeight:getTotalModificationHeight(u),sequenceLength:i.length(),xFn:e,sliceStart:n,sliceEnd:a,areBasesVisible:o,circular:i.circular(),sequenceDrawStart:p.drawStart(i),sequenceDrawEnd:p.drawEnd(i),bindPosition:p.bindPosition(i),mismatches:A,dx:w,modifications:p.modifiedNucleotides(),nucleotideType:p.nucleotideType()}),H={stroke:p.outlineColor(i),strokeWidth:p.mismatchedIndices(i).length>0?2:1,strokeOpacity:.7,fill:"none",transform:R},j=A.length>0?`(${A.length} mismatched ${(0,de._6)(A.length,"base")}) ${N}`:N,Y=r.get("_primer").get("primer_api_id")
return d.createElement("g",{className:"layer-group",key:`${p.name()}-${h}`,pointerEvents:"all",onMouseOver:()=>{p.set({hover:!0})},onMouseLeave:()=>{p.set({hover:!1})},onMouseDown:e=>{p.click(i,e.shiftKey)},onDoubleClick:e=>{p.dblClick(i,e.shiftKey)},onContextMenu:e=>{p.click(i,e.shiftKey)
SelectionContextMenu_open(e.nativeEvent,i,s,{primer:r})}},d.createElement(P.pf,{tooltipTitle:m===Ts.minimap?getTooltipText(r,i):null},d.createElement(Oe.Z,{renderContent:()=>d.createElement(Ti.V,{id:Y,onClickName:()=>{null!=Y&&ve.ZP.get().openFolderItem(Y)},validationExtras:null}),isDisabled:m===Ts.minimap||null==Y},d.createElement("g",{className:"layer",transform:`translate(${C},${I})`,...(0,ee.Z)({component:"linearPrimersView",element:"primerRoot",key:j})},d.createElement("defs",null,d.createElement("pattern",{patternUnits:"userSpaceOnUse",width:14,height:14,id:`stripe-${p.id}-${h}`},d.createElement("rect",{width:14,height:14,fill:Re().rgb(p.color().toString())}),d.createElement("path",{fill:"black",fillOpacity:.15,d:"M5.232,17.089l-3.536-3.535L16.268-1.018l3.536,3.536L5.232,17.089z"}),d.createElement("path",{fill:"black",fillOpacity:.15,d:"M-1.839,10.018l-3.535-3.536L9.197-8.089l3.536,3.535L-1.839,10.018z"}))),d.createElement("path",{d:Z,fill:getLayerFill(p,o,h),fillOpacity:getLayerFillOpacity(p,o),transform:R}),d.createElement("path",{d:D,shapeRendering:L,strokeDasharray:O,...H}),d.createElement("path",{d:x,shapeRendering:_,strokeDasharray:O,...H}),d.createElement("path",{d:`${k}${M}`,shapeRendering:F,strokeDasharray:O,...H}),d.createElement("path",{d:B,shapeRendering:"geometricPrecision",...H,...o||0===V?{strokeOpacity:0}:{}}),d.createElement("path",{d:q,shapeRendering:"geometricPrecision",...H,...o||0===V?{strokeOpacity:0}:{}}),z&&d.createElement("text",{x:z.x,y:z.y,fontSize:z["font-size"],fontWeight:p.selected()?"bold":"normal",transform:z.transform,...null!=z.fill?{fill:z.fill}:{}},z.text,z.baseProps.map(((e,t)=>d.createElement("tspan",{x:e.x,fill:e.fill,key:`tspan-${t}`},e.text)))),d.createElement("path",{shapeRendering:"geometricPrecision",transform:1===p.strand()?R:$,width:16,height:U,d:W,fill:getOverhangFill(p,G,o,V)}),null===(f=null==z?void 0:z.modificationProps)||void 0===f?void 0:f.map(((e,t)=>d.createElement("circle",{cx:e.cx,cy:e.cy,r:e.r,fill:e.fill,shapeRendering:e.shapeRendering})))))))})))))))}class ProteinAxisView extends Xa{static initClass(){this.prototype.className="proteinAxis"
this.prototype.setting=Yt.EP.name}initialize(e){super.initialize(e)
this._hasFragmentRegions()&&(this.layout=this.model.get("layout").AssemblyConstructAxis)}getBasesType(){return this.model.get("layout").AminoAcids.get("type")}_hasFragmentRegions(){return this.model.get("protein").fragments().length>0}_drawAssemblyFragments(){const e=this.model.get("protein").fragments(),t=this.model.get("protein").length(),n=this.getAxisRoot()
n.append("g").attr("id","fragments")
for(const{start:a,end:i,color:s}of e){const e=T.length(this.slice.start(),this.slice.end(),t),r=T.getRangeOverlap(a,i,this.slice.start(),this.slice.end())
if(r.length>0)for(const[a,i]of r){const r=T.length(a,i,t)/e,o=this.slice.get("width")*r,residueIndexToTranslateX=n=>{let a
a=this.slice.start()===n?0:T.length(this.slice.start(),n,t)
const i=a/e
return this.slice.get("width")*i-this.getTypeOffset()}
n.selectAll(".tick").attr("transform",(function(){return`translate(${Re().transform(Re().select(this).attr("transform")).translate[0]},${Kt.ASSEMBLY_CONSTRUCT_AXIS_ADDITIONAL_HEIGHT})`}))
n.selectAll(".tick line").style("stroke-width",1).style("stroke","black")
n.select("#fragments").append("rect").attr("x",0).attr("y",0).attr("z",0).attr("width",o).attr("height",12).style("fill",s).attr("transform",`translate(${residueIndexToTranslateX(a)}, 0)`).classed("linear-axis-piece",!0)}}}_performAdditionalUpdates(){this._hasFragmentRegions()?this._drawAssemblyFragments():Re().select(this.el).selectAll(".axis .tick line").style("stroke-width",1).style("stroke","black")}}ProteinAxisView.initClass()
const Ri=ProteinAxisView
var Pi=n(839004)
const Oi=[Ra.wu.AsparagineDeamidationInCDRs]
function LiabilitySite({availableWidth:e,availableHeight:t,realToGap:n,site:a,xFn:i}){const s=e/2,r=Math.min(s,6),o=r+t/2,l=a.names.map((e=>Ra.pc[e])).join("\n")
return d.createElement(P.ZP,{title:l},d.createElement("g",{className:(0,g.iv)(xi.noFocus),transform:`translate(${i(n[a.viewPos])+s} ${o})`},d.createElement("circle",{className:`${(0,g.iv)(xi.noFocus)} liability-site ${a.names.join(" ")}`,onMouseEnter:()=>{const e=document.querySelector("#protein-map")
e&&a.names.forEach((t=>{e.classList.add(`highlight${t}`)}))},onMouseLeave:()=>{const e=document.querySelector("#protein-map")
e&&a.names.forEach((t=>{e.classList.remove(`highlight${t}`)}))},r,shapeRendering:"geometricPrecision"})))}function ProteinLiabilitySitesSlice(e){const{layout:t,redraw:n,residues:a,sliceStart:i,sliceEnd:s,visibilityOptions:r,xFn:o}=e,c=getRealToGapMap(a),[u,m]=(0,d.useState)([]),[p,h]=(0,d.useState)([]),g=getAntibodyVisibilitySettings(r)[1];(0,d.useEffect)((()=>{const e=(0,y.removeGaps)(a)
if(e.length>0){!async function fetchPTMs(e,t){const[n]=await(0,Pi.yQ)([e])
t(n)}(e,m)
g&&async function fetchCDRs(e,t,n){const[a]=await jt.Z.getCDRAnnotations([e],t)
a&&n(a.reduce(((e,t)=>e.concat(t.regions)),[]).filter((e=>e.name.includes("CDR"))))}(e,g,h)}}),[a,g])
const E=o(i+1)-o(i),f=Object.values(Ra.wu).filter((e=>r.getOption(Yt.pz.name).isSettingChecked(e)))
let S=u.filter((e=>e.viewPos>=i&&e.viewPos<s&&f.includes(e.name)))
S=function filterByCDR(e,t,n){return t&&0!==n.length?e.filter((e=>!Oi.includes(e.name)||n.some((t=>t.start<=e.viewPos&&e.viewPos<t.end)))):e.filter((e=>!Oi.includes(e.name)))}(S,g,p)
const b=t.height+t.vMargin,T=S.length;(0,d.useEffect)((()=>{n(T>0?b:0)}),[b,n,T])
const v=Object.values(l.default.groupBy(S,(e=>e.viewPos))).map((e=>({names:e.map((e=>e.name)),viewPos:e[0].viewPos})))
return d.createElement(d.Fragment,null,v.map((e=>d.createElement(LiabilitySite,{key:e.viewPos,availableHeight:t.height,availableWidth:E,realToGap:c,site:e,xFn:o}))))}const xi=g.mM.create({noFocus:{":focus":{outline:"none"}}})
class ReactWrapperView extends BaseReactWrapperView{initialize(e){super.initialize(e)
this.renderReact=e.renderReact
this._boxHeight=e.boxHeight
this._staticBoxHeight=e._staticBoxHeight}boxHeight(){return this.shouldShow()?this._staticBoxHeight?this._staticBoxHeight:this._boxHeight(this.getLayout()):0}redraw(e){"function"==typeof e?this._boxHeight=e:"number"==typeof e&&(this._boxHeight=()=>e)
this.trigger("redraw")}_renderComponentWrapper(){this.shouldShow()&&(0,Me.A9)(this.renderReact(this.getLayout(),this.redraw),this.el)}}var _i=n(348979),Di=n(434234)
function getFrameStarts(e,t){const n=y.nextNonGapIndex(e,t),a=n>-1?y.nextNonGapIndex(e,n+1):-1,i=a>-1?y.nextNonGapIndex(e,a+1):-1
return{FWD1:n>-1?n:null,FWD2:a>-1?a:null,FWD3:i>-1?i:null}}function getReadingFrameAminoAcids(e,t,n,a){return new Di.Z({_translation:new _i.Hn({start:t,end:a,strand:1,fromSubPart:!1})}).getAminoAcids(e,n,a)}function readingFrameStartIndex(e,t,n){const a=e.find((e=>e.indexStart>=t&&n[e.indexStart]!==R.P8))
return a?a.indexStart:null}function frameIsVisible(e,t,n,a,i){return function visibilityToggledOn(e){return Boolean(e.get("value"))}(n)&&function validMasterFrameStart(e,t){return null!==e[t.get("name")]}(e,n)&&function validAminoAcidsinTranslation(e,t,n,a){return null!==readingFrameStartIndex(e[t.get("name")],n,a)}(t,n,a,i)}var Li=n(886911)
class ReadingFramesView extends pi{static initClass(){this.prototype.className="readingFrames"
this.prototype.setting=Yt.yX.name}initialize(e){super.initialize(e)
this.performanceId=Li.BL("drawAlignmentReadingFrames",{enabled:!1},{interval:yt.TN,aggregations:[Li.Pe.MEDIAN,Li.Pe.MAX]},{})
this.layout=this.model.get("layout").Translations
this.visibleRange=e.range}registerListeners(){super.registerListeners()
this.listenTo(this.visibleRange,"change:start change:end",(0,It.D)(this.update.bind(this),100))
this.listenToTrim(this.model)
this.model.isMasterSequence()||this.listenToTrim(this.tabstate.getMapStateForMasterSequence())}killTooltips(){}getRenderStart(){return Math.max(Math.floor(this.visibleRange.start())-100,this.slice.start())}getRenderEnd(){return Math.min(Math.ceil(this.visibleRange.end())+100,this.slice.end())}aminoAcidFillColor(e,t){const n=e.b,a=t.get("frameName"),i=this.masterAminoAcidMap[a][e.indexStart]
return"?"===n?Vt.ud:i&&i===n?Vt.tN:"red"}listenToTrim(e){this.listenTo(e.get("sequence").get("_sequence"),"updateTrim",this.update)}strokeColor(){return Vt.pF}getTrimRange(e){const t=e.get("sequence").get("trim")
return t?{trimStart:t.start(),trimEnd:t.end()}:{trimStart:0,trimEnd:e.get("sequence").bases().length}}update(e){Li.hY(this.performanceId)
if(this.isShown()){const e=this.tabstate.getMapStateForMasterSequence(),t=e.get("sequence"),{trimStart:n,trimEnd:a}=this.getTrimRange(e)
this.masterAminoAcidMap=function getReadingFrameAAMap(e,t,n){const a=getFrameStarts(e.bases(),t),i=yt.Vp.map((t=>{const i=a[t]
return null!=i?getReadingFrameAminoAcids(e,i,i,n):[]})).map((e=>e.reduce(((e,t)=>{e[t.indexStart]=t.b
return e}),{})))
return l.default.object(yt.Vp,i)}(t,n,a)}super.update(e)
Li.Eb(this.performanceId)}getData(){const e=this.model.get("visibilityOptions").getOption(this.setting).get("settings"),t=this.tabstate.getMapStateForMasterSequence(),n=t.get("sequence"),{trimStart:a,trimEnd:i}=this.getTrimRange(this.model),s=getFrameStarts(n.bases(),this.getTrimRange(t).trimStart),r={}
for(const e of Object.keys(s))r[e]=getReadingFrameAminoAcids(n,s[e],a,i)
const o=this.model.get("sequence").bases()
return e.filter((e=>frameIsVisible(s,r,e,a,o))).map(((e,t)=>{const n=e.get("name"),s={start:readingFrameStartIndex(r[n],a,o),end:i,strand:1,fromSubPart:!1}
return new Di.Z({_translation:new _i.Hn(s),frameName:n,[Kt.LINEAR_LAYER_FULL]:t})}))}getLayout(){return this.model.get("layout").Translations}isShown(){return this.shouldShow()}contextMenuOptions(){return[]}contextMenuData(){return{}}}ReadingFramesView.initClass()
const ki=ReadingFramesView
var Mi=n(977322)
class PolymerAnnotationsView extends LayeredView{static initClass(){this.prototype.className="annotations"
this.prototype.setting=Yt.jB.name}hideHandler(){this.isShown()||this.model.set({visibleA:0,shownA:0})}getLayout(){return this.model.get("layout").Annotations}layeringMode(){return this.model.get("layeringMode")}isShown(){return this.shouldShow()}contextMenuOptions(){return na}contextMenuData(e){return{annotation:e,feature:e,alignment:"alignment"===this.mapType}}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.mapType=e.mapType
this.layout=this.model.get("layout").Annotations}registerListeners(){super.registerListeners()
this._registerAnnotationListeners()}_registerAnnotationListeners(){throw new Error("Method not implemented")}clickAction(e){e.click(this.model.polymer(),Re().event.shiftKey)}dblClickAction(e){e.dblClick(this.model.polymer(),Re().event.shiftKey)}makeLayerPiece(e){e.classed("layer",!0)
e.attr("data-test-component","annotationsView")
e.attr("data-test-element","root")
e.append("svg:path").classed("layer-fill",!0)
e.append("svg:path").classed("left-side",!0).classed("stroked",!0)
e.append("svg:path").classed("right-side",!0).classed("stroked",!0)
e.append("svg:path").classed("middle-side",!0).classed("stroked",!0)
e.append("svg:path").classed("leftside-arrows",!0).classed("stroked",!0)
e.append("svg:path").classed("rightside-arrows",!0).classed("stroked",!0)
e.each((function(e){return o()(this).tooltip({delay:100,trigger:"hover",placement:"top",container:"body"})}))}getResiduesType(){return this.model.get("layout").DNA.get("type")}_addAnnotationBorder(e,t){Re().select(e).selectAll("path.stroked").attr("stroke",(e=>e.selected()?"#111":Re().rgb(t.color).darker().toString())).attr("stroke-opacity",.7).attr("fill","none")}_tooltipText(e,t){const n="This part does not match the containing sequence"
return t?null==e?n:`${e}\n${n}`:e}_addAnnotationLabels(e,t,n){var a,i
const s=null===(i=(a=this.model).inlineAnnotationLabelPlacement)||void 0===i?void 0:i.call(a,t,this.slice),{displayName:r,labelData:l,spaceInside:c,inside:d}=(0,Mi.aU)(n,this.getLayout().get("type"),this.getResiduesType(),t.name(),t.strand(),this.layeringMode(),this.slice.get("visibleWidth"),this.slice.get("leftBP"),this.slice.get("rightBP"),this.model.get("inlineLabelPadding"),s)
c?o()(e).attr("data-original-title",this._tooltipText(null,Boolean(n.outOfSync))):o()(e).attr("data-original-title",this._tooltipText(t.name(),Boolean(n.outOfSync)))
const u=Re().select(e).selectAll("text").data(l)
u.enter().append("svg:text")
u.exit().remove()
u.attr("x",(e=>e)).attr("y",this.getLayout().get("single").height()-2).attr("font-size",this.getLayout().get("type").fontSize).attr("fill",d?n.labelColor:n.outsideLabelColor).text(r)}_drawAnnotation(e,t,n){const{fillD:a,strokeLeftD:i,strokeMiddleD:s,strokeRightD:r,strokeLeftRender:o,strokeRightRender:l,strokeMiddleRender:c}=(0,Mi.Vj)(n,this.slice.start(),this.slice.end(),t.strand())
Re().select(e).select("path.right-side").attr("d",r).attr("shape-rendering",l)
Re().select(e).select("path.left-side").attr("d",i).attr("shape-rendering",o)
Re().select(e).select("path.middle-side").attr("d",s).attr("shape-rendering",c)
const d=t.get("hover")||t.selected()?1:.7,u=null!=n.forceOpacity?n.forceOpacity:d
Re().select(e).select("path.layer-fill").attr("d",a).attr("fill",Re().rgb(n.color).toString()).attr("fill-opacity",u)}_addAnnotationArrows(e,t,n){const{start:a,end:i,width:s,height:r,tipWidth:o}=n
let l,c
function arrowD(e,t){const n=-1===t?e+3:e
return`M ${n} 4 L ${1===t?e+3:e} ${r/2} L ${n} ${r-3} `}const d=a>=this.slice.start(),u=i<=this.slice.end(),m="M 0 0 L 0 0"
l=d?m:arrowD(6,t.strand())+arrowD(9,t.strand())
c=u?m:arrowD(s-3-3-6,t.strand())+arrowD(s-3-6,t.strand())
if(12>s-o||u&&d){l=m
c=m}Re().select(e).select(".leftside-arrows").attr("d",l).attr("shape-rendering","geometricPrecision")
Re().select(e).select(".rightside-arrows").attr("d",c).attr("shape-rendering","geometricPrecision")}rerenderSingle(e,t,n,a,i,s){const r={start:t,end:n,width:a,height:i,tipWidth:Math.min(a,this.getLayout().get("type").charWidth(1)),arrowsOffset:6,arrowWidth:3,arrowSpacing:3,color:s.color(),labelColor:"black",outsideLabelColor:"black"}
this._drawAnnotation(e,s,r)
this._addAnnotationLabels(e,s,r)
this._addAnnotationArrows(e,s,r)
this._addAnnotationBorder(e,r)}}PolymerAnnotationsView.initClass()
const Fi=PolymerAnnotationsView
const Zi=class AnnotationsView extends Fi{constructor(...e){super(...e)
this.className="annotations"
this.setting=Yt.jB.name}getData(e,t){let n
const a=this.model.polymer()
if(this.mapType===Ts.minimap){const e=this.model.getAnnotations(this.slice),{total:t,visible:a}=e;({shown:n}=e)
this.model.set({totalA:t.length,visibleA:a.length,shownA:n.length})}else n=a.annotations().slice(e,t)
return n}_registerAnnotationListeners(){const e=this.model.polymer().annotations()
this.listenTo(e,"change:hover change:selected",this.handleHoverSelect.bind(this))
this.listenTo(e,"click",this.pieceClickHandler.bind(this))}getResiduesType(){return this.model.get("layout").DNA.get("type")}}
function SequencePartAnnotationsView_getTooltipText(e,t){const n="This part does not match the containing sequence"
return t?e:null==e?n:`${e}\n${n}`}function SequencePartAnnotationsView({xFn:e,yFn:t,sliceStart:n,sliceEnd:a,leftBP:i,rightBP:s,visibleWidth:r,sequence:o,residuesType:l,contextMenuOptions:c,mapType:u,layout:m,redraw:p,sliceParts:h,layersDict:E,layeringMode:S}){p()
const y=new bn.Z(13)
return d.createElement("svg",null,d.createElement(Pa.Z,{layout:m,shouldStopMouseDownPropagation:!0},d.createElement(d.Fragment,null,h.map((m=>timesPerSlice(m,n,a,m.drawStart(o),m.drawEnd(o)).map(((p,h)=>{const b=m.sequence().id,{start:T,end:v}=whichDisplay(n,a,m.drawStart(o),m.drawEnd(o),h,o.length()),C=function getAnnotationRenderParams(e,t,n,a,i,s,r){const o=!e.isInSync(t._sequence()),l=e.sequence().isArchived()
return{start:a,end:i,width:s,height:r,tipWidth:Math.min(s,n.width(1)),arrowsOffset:6,arrowWidth:3,arrowSpacing:3,color:getColor(o,l),labelColor:l?Vt.Rl:Vt.Cj,outsideLabelColor:Vt.Rl,forceOpacity:l?.5:1,forceName:e.name()+(l?" (archived)":""),outOfSync:o}}(m,o,y,T,v,e(v)-e(T),12),{fillD:I,strokeLeftD:w,strokeMiddleD:N,strokeRightD:A,strokeLeftRender:R,strokeRightRender:O,strokeMiddleRender:x}=(0,Mi.Vj)(C,n,a,0),_=e(T),D=t(E[m.get(S)]),{displayName:L,labelData:k,spaceInside:M,inside:F}=(0,Mi.aU)(C,y,l,m.name(),0,S,r,i,s,2,"none"),Z={stroke:m.selected()?"#111":Re().rgb(C.color).darker().toString(),strokeOpacity:.7,fill:"none"}
return d.createElement("g",{className:f()((0,g.iv)(Bi.pointer),"layer-group"),onMouseDown:e=>{m.click(o,e.shiftKey)},onDoubleClick:e=>{m.dblClick(o,e.shiftKey)},onContextMenu:e=>{m.click(o,e.shiftKey)
SelectionContextMenu_open(e.nativeEvent,o,c)},key:`${b}-${h}`},d.createElement(P.pf,{tooltipTitle:u!==Ts.minimap||M?null:SequencePartAnnotationsView_getTooltipText(m.name(),m.isInSync(o._sequence()))},d.createElement(Oe.Z,{renderContent:()=>d.createElement(Ti.V,{id:b,onClickName:()=>{ve.ZP.get().openFolderItem(b)},validationExtras:null}),isDisabled:u===Ts.minimap},d.createElement("g",{...(0,ee.Z)({component:"SequencePartAnnotationsView",element:"root"}),transform:`translate(${_}, ${D})`},d.createElement("path",{d:I,fill:C.color,fillOpacity:C.forceOpacity}),d.createElement("path",{d:w,shapeRendering:R,...Z}),d.createElement("path",{d:A,shapeRendering:O,...Z}),d.createElement("path",{d:N,shapeRendering:x,...Z}),k.map(((e,t)=>d.createElement("text",{x:e,y:10,fontSize:y.fontSize,fill:F?C.labelColor:C.outsideLabelColor,key:`${L}-${t}`},L)))))))})))))))}const Bi=g.mM.create({pointer:{cursor:"pointer"}})
class TitleView extends ha{static initClass(){this.prototype.className="title"
this.prototype.setting=null}initialize(e){super.initialize(e)
this.slice=e.slice
this.bufferCentred=e.bufferCentred
this.layout=this.model.get("layout").Title}registerListeners(){super.registerListeners()
this.listenTo(this.slice,this.bufferCentred?"change:visibleWidth":"change:width",this.update.bind(this))
this.listenTo(this.model.get("sequence").get("_sequence"),"change:name",this.update.bind(this))
return this.listenTo(this.model.get("sequence").get("dna"),"change:forward change:reverse",this.update.bind(this))}shouldShow(){return!0}update(){const e=`${this.model.get("sequence").get("_sequence").displayNames()} (${this.model.get("sequence").get("_sequence").length()} bp)`,t=Re().select(this.el).select(".component-wrapper").selectAll("text.title-text").data([e])
t.enter().append("text").classed("title-text",!0).attr("font-size",this.layout.get("type").fontSize).attr("y",this.layout.get("type").height()).attr("text-anchor","middle")
t.exit().remove()
t.attr("x",this.bufferCentred?this.slice.get("visibleWidth")/2:this.slice.get("width")/2).text(e)}}TitleView.initClass()
const qi=TitleView
var Vi=n(212195),Ui=n.n(Vi)
function addTestAttrsToD3Selection(e,t){for(const[n,a]of Object.entries((0,ee.Z)(t)))e.attr(n,a)}class TraceView extends ha{static initClass(){this.prototype.className="trace"
this.prototype.setting=Yt.je.name}initialize(e){super.initialize(e)
this.performanceId=Li.BL("drawAlignmentTrace",{enabled:!1},{interval:yt.TN,aggregations:[Li.Pe.MEDIAN,Li.Pe.MAX]},{})
this.data=e.data
this.tabstate=e.tabstate
this.slice=e.slice
this.range=e.range
this.layout=this.model.get("layout").Trace
this.sequence=this.model.get("sequence")
return(0,S.hu)(this.sequence instanceof ei.Z,"Trace view must take a gap sequence wrapper!")}qualityOption(){return this.model.get("visibilityOptions").getOption(Yt.cM.name)}showHandler(e,t){super.showHandler(e,t)
return this.model.trigger("traceToggle")}_getIndexToBases(e,t,n,a,i){const s=[]
let r=!1
for(var o=t,c=n,d=t<=c;d?o<c:o>c;d?o++:o--){var u=e[o]
if(null==u){if(!r&&this.slice.end()<=this.sequence.length()){r=!0
Fe.ZK("T1356: colorData[base] is undefined, falling back to []",{extra:{base:o,start:t,end:n,colorDataLength:e.length,sliceStart:null!=this.slice?this.slice.start():void 0,sliceEnd:null!=this.slice?this.slice.end():void 0,sequenceLength:null!=this.sequence?this.sequence.length():void 0}})}u=[]}if(0===u.length)s.push(null)
else{const e=u.map(((e,t)=>({x:a(o+t/u.length),y:i(e)})))
var m=Ui()(e,1,!1)
m=l.default.filter(m,(e=>null!=e))
s.push(...m.map((e=>[e.x,e.y])))}}return s}_getDataString(e,t,n){const a=e.length,i=[]
let s="M",r=0
for(;r<a;){if(e[r]){i.push(s,t(e[r][0]),",",n(e[r][1])," ")
s="L"}else s="M"
r++}return i.join("")}drawHoverBoxes(){Li.hY(this.performanceId)
const e=Math.floor(this.range.start()),t=Math.floor(this.range.end()),n=this.layout.get("maxQuality"),a=this.layout.height(),i=Re().scale.linear().domain([0,n]).range([0,a]),s=this.slice.x(),r=this.qualityOption().get("visible")?this.data.get("qualityScores"):[],c=Re().select(this.el).select("g").select("g.quality-hover-bars").selectAll("rect").data(l.default.chain(r).map(((e,t)=>[e,t])).filter(((n,a)=>0!==n[0]&&e<=a&&a<t)).value())
c.enter().append("svg:rect").each((function(e){return o()(this).tooltip({delay:{show:2e3,hide:0},placement:"top",container:"body",trigger:"manual",animate:!1})}))
c.exit().each((function(e){return o()(this).tooltip("destroy")})).remove()
const{layout:d}=this
c.attr("x",(e=>s(e[1]))).attr("width",s(1)).attr("y",(e=>a-i(e[0]))).attr("height",(e=>i(e[0]))).attr("fill",Re().rgb(d.get("qualityFillColor")).darker()).attr("fill-opacity",0).on("mouseenter",(function(){Re().select(this).attr("fill-opacity",d.get("qualityFillOpacity"))
clearTimeout(o()(this).data("showIntervalId"))
return o()(this).data("showIntervalId",setTimeout(l.default.bind((function(){return o()(this).tooltip("show")}),this),300))})).on("mouseleave",(function(){clearTimeout(o()(this).data("showIntervalId"))
o()(this).data("showIntervalId",null)
o()(this).tooltip("hide")
return Re().select(this).attr("fill-opacity",0)})).on("click",l.default.bind((function(e){this.model.get("sequence").get("selection").setEndpoints(e[1],e[1]+1)
return Re().event.stopPropagation()}),this)).each((function(e){o()(this).attr("data-original-title",`Quality: ${e[0]}`)
return o()(this).tooltip("fixTitle")}))
Li.Eb(this.performanceId)}update(e){null==e&&(e=!0)
if(!this.shouldShow())return
const t=this.slice.start(),n=this.slice.end(),id=e=>e,a=this.slice.x()
let i=Re().scale.linear().domain([0,this.layout.get("maxQuality")]).range([this.layout.height(),0])
Re().select(this.el).select("g").select("g.quality-bars").select("path")
const s=this.qualityOption().get("visible")?l.default.chain(this.data.get("qualityScores").slice(t,n)).map(((e,n)=>{const a=n+t
return e?[[a,0],[a,e],[a+1,e],[a+1,0]]:null})).flatten(!0).value():[],r=this._getDataString(s,a,i),o=Re().select(this.el).select("g").select("g.quality-bars").selectAll("path").data([r])
Re().svg.line().x((e=>a(e[0]))).y((e=>i(e[1])))
o.exit().remove()
o.enter().append("svg:path")
o.attr("d",(e=>e)).attr("stroke",this.layout.get("qualityStrokeColor")).attr("fill",this.layout.get("qualityFillColor")).attr("fill-opacity",this.layout.get("qualityFillOpacity")).attr("stroke-opacity",this.layout.get("qualityStrokeOpacity"))
const c=Re().select(this.el).select("g").select("g.color-data").selectAll("path").data(l.default.pairs(this.data.get("baseToColor"))),d=this.data.get("maxY")
i=Re().scale.linear().domain([0,d]).range([this.layout.height(),0]).clamp(!0)
l.default.bind((function(e){return this.sequence.get("_sequence").realToGap(e)}),this)
const u=l.default.bind((function(e){return this._getDataString(this._getIndexToBases(e,t,n,a,i),id,id)}),this)
c.exit().remove()
c.enter().append("svg:path")
c.attr("d",(e=>u(e[1]))).attr("stroke",l.default.bind((function(e){return this.layout.get("colorMap")[e[0]]}),this)).attr("stroke-width",this.layout.get("colorStrokeWidth")).attr("fill","none")
this.drawHoverBoxes()
return e?this.trigger("redraw"):void 0}setup(){super.setup()
const e=Re().select(this.el).select("g")
e.append("svg:g").attr("class","quality-bars")
addTestAttrsToD3Selection(e.append("svg:g").attr("class","quality-hover-bars"),{component:"TraceView",element:"qualityHoverBars"})
return e.append("svg:g").attr("class","color-data")}registerListeners(){super.registerListeners()
this.listenTo(this.range,"change:start change:end",(0,It.D)(l.default.bind(this.drawHoverBoxes,this),500))
this.listenTo(this.data,"change:maxY",(()=>{this.update()}))
this.listenTo(this.qualityOption(),"change:visible",(()=>{this.update()}))}}TraceView.initClass()
const Gi=TraceView
var zi=n(250965)
class TranslationsView extends pi{static initClass(){this.prototype.className="translations"
this.prototype.setting=Yt.KL.name}initialize(e){super.initialize(e)
const t=this.model
this.tabstate=e.tabstate
this.layout=t.get("layout").Translations
this.syncColorScheme()}colorSchemeSetting(){return this.option.getSetting(Yt.gl.name)}colorScheme(){return this.colorSchemeSetting().get("value")}syncColorScheme(){this.layout.set({colorScheme:this.colorScheme()})}aminoAcidOption(){return this.model.get("visibilityOptions").getOption(Yt.tO.name)}indexShown(){return this.aminoAcidOption().get("visible")}registerListeners(){const e=this.model
super.registerListeners()
this.listenTo(e.get("sequence").translations(),"change:selected",this.handleSelect)
this.listenTo(this.colorSchemeSetting(),"change:value",this.syncColorScheme)
this.listenTo(this.aminoAcidOption(),"change:visible",(()=>{this.update()}))
this.listenTo(this.layout,"change:colorScheme",(()=>{this.update()}))
this.listenTo(e.get("sequence")._sequence().translations(),"change:strand",(()=>{this.update()}))
this.listenTo(e.get("sequence")._sequence(),"change:translationGroups",(()=>{this.update()}))}handleSelect(e,t){Re().select(this.el).select("g").selectAll(`path.translation-${e.uid()}`).attr("fill-opacity",t?.75:.5)}getData(e,t){return this.model.get("sequence").translations().slice(e,t)}getLayout(){return this.model.get("layout").Translations}isShown(){return this.shouldShow()}contextMenuOptions(){return ua}contextMenuData(e){return{translation:e,sequence:this.model.get("sequence"),mapstate:this.model}}getAdditionalHeightOptions(){return{nameShown:!0,indexShown:this.indexShown()}}_onDblClickName(e){const t=this.model.get("sequence")
if(t.allowFeatureEdits()&&e.editable()){m.j("translation","open_translation_panel",{product:j.XC.MOLBIO,openedFrom:"translation_double_click",sequence_id:t.get("id")})
t.get("selection").trigger("translation-panel",null,e)}}_renderTranslationNameLabel(e,t,n,a,i,s){var r
const o=this.model,l=this.translationLayout.get("single").get("type"),c=l.height(),d=o.get("sequence"),u=i.getTranslationRegionGroup(d),m=null==u?"":(0,Nn.Xy)(u,i.id,d.startIndex(),d.length()),p=this.translationLayout.get("visible")?[m]:[],h=Re().select(e).selectAll("g.translation-name-group").data(p),g=h.enter().append("svg:g").classed("translation-name-group",!0)
h.attr("transform",`translate(${t}, 0)`)
g.attr("data-test-component","translationsView")
g.attr("data-test-element","root")
g.append("svg:rect").classed("translation",!0)
g.append("svg:rect").classed("translation-name-box",!0)
g.append("svg:text").classed("translation-name",!0)
const E=null!==(r=null==u?void 0:u.color)&&void 0!==r?r:Nn.aP,f=(n-8)/l.charWidth(),S=function formatTranslationDisplayName(e,t){return t<e.length?t<5?"":(0,Mt.fk)(e,t):e}(m,f)
zi(e).attr("data-original-title",f<m.length?m:null)
h.select(".translation").attr("width",n).attr("height",4).attr("y",a+(c/2-2)).attr("fill",E).on("mousedown",(()=>{super._clickHandler(s,i,i.start(),i.end())})).on("dblclick",(()=>{super._dblClickHandler(s,i)
this._onDblClickName(i)}))
h.select(".translation-name-box").attr("width",S.length>0?S.length*l.charWidth()+8:0).attr("height",c).attr("y",a).attr("fill",E).on("mousedown",(()=>{super._clickHandler(s,i,i.start(),i.end())})).on("dblclick",(()=>{super._dblClickHandler(s,i)
this._onDblClickName(i)}))
h.select(".translation-name").text(S).attr("font-size",l.fontSize-2).attr("y",a+l.fontSize-2).attr("x",4).attr("pointer-events","none")
h.exit().remove()}rerenderSingle(e,t,n,a,i,s,r,o){super.rerenderSingle(e,t,n,a,i,s,r,o)
const l=this.model,c=this.translationLayout.indexHeight(this.indexShown())+this.translationLayout.get("single").get("type").height()
this._renderTranslationNameLabel(e,r,a,c,s,l.get("sequence").get("selection"))}}TranslationsView.initClass()
const $i=TranslationsView
class VoteView extends ha{static initClass(){this.prototype.className="votes"
this.prototype.setting=Yt.bp.name}initialize(e){super.initialize(e)
this.performanceId=Li.BL("drawAlignmentVotes",{enabled:!1},{interval:yt.TN,aggregations:[Li.Pe.MEDIAN,Li.Pe.MAX]},{})
this.data=e.data
this.tabstate=e.tabstate
this.slice=e.slice
this.range=e.range
this.layout=this.model.get("layout").Vote
this.sequence=this.model.get("sequence");(0,S.hu)(this.sequence instanceof ei.Z,"Trace view must take a gap sequence wrapper!")}drawBoxes(){if(!this.shouldShow())return
const e=Math.max(Math.floor(this.range.start()),0),t=Math.min(Math.floor(this.range.end()),this.sequence.length()),n=this.slice.x(),a=this.maxVote,i=Re().scale.linear().domain([0,a]).range([this.layout.height(),0]),s=this.data.get("votes"),r=[]
r.push(`M${n(e)},${i(0)}`)
for(let a=e;a<t;a++){const e=s[a]
if(0!==e){const t=a+1
r.push(`L${n(a)},${i(0)}`)
r.push(`L${n(a)},${i(e)}`)
r.push(`L${n(t)},${i(e)}`)
r.push(`L${n(t)},${i(0)}`)
r.push(`M${n(a)},${i(0)}`)}}r.push(`L${n(t)},${i(0)}`)
const o=Re().select(this.el).select("g").select("g.vote-bars").selectAll("path").data([r])
o.exit().remove()
o.enter().append("svg:path")
o.attr("d",(e=>e.join(""))).attr("stroke",this.layout.get("voteStrokeColor")).attr("fill",this.layout.get("voteFillColor")).attr("fill-opacity",this.layout.get("voteFillOpacity")).attr("stroke-opacity",this.layout.get("voteStrokeOpacity")).attr("stroke-width",this.layout.get("strokeWidth"))}drawHoverBoxes(){if(!this.shouldShow())return
const e=Math.max(Math.floor(this.range.start()),0),t=Math.min(Math.floor(this.range.end()),this.sequence.length()),n=this.maxVote,a=this.layout.height(),i=Re().scale.linear().domain([0,n]).range([0,a]),s=this.slice.x(),r=this.data.get("votes"),l=[]
for(let n=e;n<t;n++){const e=r[n]
0!==e&&l.push([e,n])}const c=Re().select(this.el).select("g").select("g.vote-hover-bars").selectAll("rect").data(l)
c.enter().append("svg:rect").each((function showTooltip(e){return o()(this).tooltip({delay:{show:2e3,hide:0},trigger:"manual",placement:"top",container:"body"})}))
c.exit().each((function hideTooltip(e){o()(this).tooltip("destroy")})).remove()
c.attr("x",(e=>s(e[1]))).attr("width",s(1)).attr("y",(e=>a-i(e[0]))).attr("height",(e=>i(e[0]))).attr("fill","black").attr("fill-opacity",0).on("mouseenter",(function enter(){Re().select(this).attr("fill-opacity",.4)
clearTimeout(o()(this).data("showIntervalId"))
o()(this).data("showIntervalId",setTimeout((()=>{o()(this).tooltip("show")}),300))})).on("mouseleave",(function leave(){clearTimeout(o()(this).data("showIntervalId"))
o()(this).data("showIntervalId",null)
Re().select(this).attr("fill-opacity",0)
o()(this).tooltip("hide")})).on("click",(e=>{this.model.get("sequence").get("selection").setEndpoints(e[1],e[1]+1)
Re().event.stopPropagation()})).each((function setVotes(e){o()(this).attr("data-original-title",`Votes: ${e[0]}`)
o()(this).tooltip("fixTitle")}))}update(e=!0){if(this.shouldShow()){this.maxVote=l.default.max(this.data.get("votes"))
this.drawBoxes()
this.drawHoverBoxes()
e&&this.trigger("redraw")}}setup(){super.setup()
const e=Re().select(this.el).select("g")
e.append("svg:g").attr("class","vote-bars")
e.append("svg:g").attr("class","vote-hover-bars")}redraw(e,t){if(e||t){Li.hY(this.performanceId)
this.drawHoverBoxes()
this.drawBoxes()
Li.Eb(this.performanceId)}}registerListeners(){super.registerListeners()
this.listenTo(this.range,"rangeChange",(0,Ja.Z)(((e,t)=>{this.redraw(e,t)}),100))
this.listenTo(this.data,"change:votes",this.update)}}VoteView.initClass()
const Wi=VoteView
class ProteinAnnotationView extends wa.sd{defaults(){return{name:null,color:null,hover:!1,selected:!1,proteinId:null}}_syncHoverStateToStore(e,t){Ea.Z.hoverAnnotation(this.proteinId(),t?this.id:null)}_syncSelectedStateToStore(e,t){Ea.Z.selectAnnotation(this.proteinId(),t?this.id:null)}initialize(e,t){super.initialize(e,t)
this.setting=Yt.jB.name
if(t.syncToStore){this.on("change:hover",this._syncHoverStateToStore.bind(this))
this.on("change:selected",this._syncSelectedStateToStore.bind(this))}}name(){return this.get("name")}color(){return this.get("color")}start(){return this.get("start")}end(){return this.get("end")}strand(){return 1}layerStart(){return this.start()}layerEnd(){return this.end()}uid(){return this.cid}hover(){return this.get("hover")}selected(){return this.get("selected")}proteinId(){return this.get("proteinId")}click(e){e.selection().setEndpoints(this.start(),this.end())
this.set("selected",!0)}dblClick(e){}}const Hi=class ProteinAnnotationsView extends Fi{constructor(e){super(e)
this.setting=Yt.jB.name
this.className="proteinAnnotations"}layeringMode(){return Kt.LINEAR_LAYER_FULL}shouldSyncToStore(){return!0}isAnnotationHovered(e){return ba.Z.getHoveredAnnotationId(this.getProteinId())===e.id}isAnnotationSelected(e){return ba.Z.getSelectedAnnotationId(this.getProteinId())===e.id}getProteinId(){return this.model.protein().id}getAnnotations(){return this.model.protein().annotations()}getResiduesType(){return this.model.get("layout").AminoAcids.get("type")}getData(e,t){const n=this.getProteinId(),a=this.getAnnotations().map((e=>{const t=this.isAnnotationHovered(e),a=this.isAnnotationSelected(e);(0,S.Gp)(null!=e.start&&null!=e.end,"Protein annotation must have start and end")
return new ProteinAnnotationView({proteinId:n,hover:t,selected:a,...e},{syncToStore:this.shouldSyncToStore()})})).filter((n=>T.isRangeOverlap(e,t,n.start(),n.end()))),i=Ia.eo(a,{top:!1})
for(const{model:e,layer:t}of i)e.set(this.layeringMode(),t,{silent:!0})
return a}_updateAfterProteinChange(){this.update()
const e=this.model.protein().id,t=ba.Z.getPendingJump(e)
if(t){const{start:n,end:a}=t
this.model.protein().trigger("jump",n,a)
l.default.defer((()=>{Ea.Z.pendingJumpCompleted(e)}))}}_registerAnnotationListeners(){this.shouldSyncToStore()&&ba.Z.addChangeListener(this._updateAfterProteinChange.bind(this))}}
class ProteinAlignmentAnnotationsView extends Hi{constructor(e,...t){super(e,...t)
this.annotations=e.annotations
this.className="proteinAlignmentAnnotations"}getPolymerLength(){return this.tabstate.getPolymerLength()}contextMenuOptions(){return[]}shouldSyncToStore(){return!1}isAnnotationHovered(e){return!1}isAnnotationSelected(e){return!1}getProteinId(){return null}getAnnotations(){return this.annotations}getResiduesType(){return this.tabstate.getType()}clickAction(e){this.tabstate.get("selection").setEndpoints(e.start(),e.end())}dblClickAction(e){}}class ProteinAlignmentAxisView extends Xa{static initClass(){this.prototype.className="proteinAlignmentAxis"
this.prototype.setting=Yt.EP.name}initialize(e){super.initialize(e)
this.tabstate=e.tabstate}getStartIndex(){return 1}getBasesType(){return this.tabstate.getType()}getPolymerLength(){return this.tabstate.getPolymerLength()}}ProteinAlignmentAxisView.initClass()
const ji=ProteinAlignmentAxisView
var Yi=n(693707)
function aminoAcidMatches(e,t){return"-"!==e&&"-"!==t&&e.toUpperCase()===t.toUpperCase()}function getIdentityValues(e){(0,S.hu)(Array.isArray(e),"Invalid argument type")
return l.default.zip(...e).map((t=>{const[n,...a]=t
return a.filter((e=>aminoAcidMatches(e,n))).length/(e.length-1)}))}function getNonConsensusRows(e){return e.alignmentType===Kt.ALIGNMENT_TYPE.CONSENSUS?e.rows.slice(1):e.rows}function makeSliceView({alignmentRowType:e,tabState:t,slice:n,visibilityOptions:a,row:i,forAlignmentPNGExport:s}){const r=Kt.PROTEIN_ALIGNMENT_ROW_Y_COMPONENTS.filter((t=>t!==Kt.SliceComponentName.proteinAlignmentIdentityGraph||e)),o=Kt.PROTEIN_ALIGNMENT_ROW_Z_COMPONENTS.filter((t=>t!==Kt.SliceComponentName.proteinAlignmentIdentityGraph||e))
return new BasicSliceView({slice:n,selection:t.get("selection"),tabstate:t,visibilityOptions:a,mapType:Ts.proteinAlignment,model:t,data:{row:i},polymerResidues:i.proteinVersion.aminoAcids,y:r,z:o,el:BasicSliceView.createSVGElement(),forAlignmentPNGExport:s,range:t.get("range")})}function makeSliceFromSelection(e){const t=e.get("selection").end()
if(null==t)return e.get("slice")
{const n=e.get("selection").start(),a=e.getType(),i=a.width(t-n)+a.letterSpacing,s=Re().scale.linear().clamp(!0).domain([n,t]).range([0,i]),r=Re().scale.linear().clamp(!0).domain([0,i]).range([n,t])
return new Yi.Z({start:n,end:t,width:i,maxWidth:e.get("slice").get("maxWidth"),visibleWidth:e.get("slice").get("visibleWidth"),x:s,xInv:r})}}async function renderAlignmentSVG(e){const t=function renderAlignmentSliceSVGs(e){const t=e.get("alignment"),n=t.rows.map(((t,n)=>makeSliceView({alignmentRowType:0===n?e.get("alignment").alignmentType:null,tabState:e,slice:makeSliceFromSelection(e),visibilityOptions:e.get("localVisibilityOptionsList")[n],row:t,forAlignmentPNGExport:!0}))),a=[]
for(const e of n){e.render()
e.killSelection()
const n=e.el
Re().select(n).attr("height",e.boxHeight()+20)
const i=new bn.Z(12),s=Re().select(n).insert("svg:g",":first-child").append("svg:text").attr("font-size",i.fontSize).attr("text-anchor","begin").attr("dy",i.height()).attr("x",20),r=s.append("svg:tspan").attr("font-weight",900),o=null===e.data.row.originalProteinId&&t.alignmentType===Kt.ALIGNMENT_TYPE.CONSENSUS,l=e.data.row.name!==e.model.get("alignment").name&&"TEMPLATE"===t.alignmentType
o||l?r.text(`${t.alignmentType.toLowerCase()} sequence `):r.text("aligned sequence ")
s.append("svg:tspan").attr("dx",i.charWidth()).text(e.data.row.name)
s.attr("width",i.charWidth()*(e.data.row.name+r.text()).length)
fixAxis(n)
a.push(n)}return a}(e)
for(let e=0;e<4;e++)await(0,Jt._v)(0)
const n=document.createElementNS("http://www.w3.org/2000/svg","svg")
Re().select(n).attr("xmlns","http://www.w3.org/2000/svg")
o()(n).attr("xmlns:sodipodi","http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd").attr("xmlns:inkscape","http://www.inkscape.org/namespaces/inkscape").append("<sodipodi:namedview inkscape:pageopacity='1' pagecolor='#ffffff'/>")
const a=new bn.Z(16),i=e.get("alignment"),s=(0,Mt.kC)(i.alignmentType)
Re().select(n).append("svg:text").attr("font-size",a.fontSize).attr("font-weight",900).attr("dy",a.height()).text(`${s} Alignment: ${i.name}`)
const r=Math.max(...t.map((e=>parseInt(o()("g text",e).attr("width"),10))))
let l=a.height()+20
for(const e of t){Re().select(e).select("g text").attr("transform",`translate(-${r+40},0)`)
appendSVGToSVG({parentSVG:n,childSVG:e,transform:`translate(${r+20}, ${l})`})
l+=getSVGHeight(e)}return n}function getAminoAcidMatrix(e,t,n){const a=n?t:0,i=n||void 0
return e.map((e=>Array.from(e.proteinVersion.aminoAcids.slice(a,i))))}function getSum(e){return e.reduce(((e,t)=>e+t),0)}function getNumPairs(e){return e*(e-1)/2}function getNumMatchingPairs(e){return l.default.zip(...e).map((e=>function getNumMatchingPairsOfList(e){const t=e.map((e=>e.toUpperCase())),n=l.default.countBy(t,l.default.identity),a=l.default.omit(n,"-")
return getSum(l.default.values(a).map((e=>getNumPairs(e))))}(e)))}function getNumNonGapPairs(e){return l.default.zip(...e).map((e=>function getNumNonGapPairsOfList(e){const t=e.filter((e=>"-"===e)).length
return getNumPairs(e.length)-getNumPairs(t)}(e)))}var Qi=n(249618),Ki=n(623518)
class AminoAcids extends d.PureComponent{constructor(){super(...arguments)
this.state={areFontsReady:Ha.Rj.get().get("areFontsReady")}}static filteredResidues(e,t){const n=t.map((e=>"-"===e?"\\-":e))
return e.replace(new RegExp(`[^${n.join("")}]`,"ig")," ")}componentDidMount(){this._fontAvailabilityCallback=()=>{this.setState({areFontsReady:Ha.Rj.get().get("areFontsReady")})}
Ha.Rj.get().on("change:areFontsReady",this._fontAvailabilityCallback)}componentWillUnmount(){Ha.Rj.get().off("change:areFontsReady",this._fontAvailabilityCallback)}render(){const e=this.props.layout
if(!e.visible)return null
const t=new bn.Z(e.type.fontSize,e.type.letterSpacing).height(),n=Wn.Wr[e.foregroundColoring]
let a=e.type.letterSpacing
this.state.areFontsReady&&(a+=(0,Ha.uh)(e.type.fontSize))
return d.createElement("g",{fontSize:e.type.fontSize,letterSpacing:a,transform:`translate(${e.type.letterSpacing/2}, ${t})`,...(0,ee.Z)({component:"AminoAcids",element:"textRoot"})},l.default.chain(Ki.ZP.ALIGNMENT_AMINO_ACIDS).groupBy((t=>e.showColoring&&n[t]||"#000000")).pairs().sortBy((([e,t])=>e)).map((([e,t])=>d.createElement("text",{key:e,xmlSpace:"preserve",fill:e},AminoAcids.filteredResidues(this.props.aminoAcids,t)))).value())}}const Ji=AminoAcids
var Xi=n(778476)
const es=Vt.tN
function formatRegionName(e,t){return t===Ra.Jb.HEAVY?`H ${e}`:[Ra.Jb.KAPPA,Ra.Jb.LAMBDA].includes(t)?`L ${e}${Xi.fw[t]}`:`${e}${Xi.fw[t]}`}class CDRAnnotationView extends ProteinAnnotationView{initialize(e,t){super.initialize(e,{...t,syncToStore:!1})}strand(){return 0}color(){return this.get("name").indexOf("FW")>=0?es:"#8AB6FF"}}class ProteinCDRView extends Hi{static initClass(){this.prototype.setting=Yt.W3.name}constructor(e){super(e)
this.className="antibodyCDRAnnotations"
this.cachedAminoAcids=e.model.protein?e.model.protein().aminoAcids():e.aminoAcids
this.cachedAnnotations=[]
this._fetchCDRAnnotations()}shouldShow(){return this.option.get("visible")}boxHeight(){return this.cachedAnnotations.length>0?super.boxHeight():0}shouldSyncToStore(){return!1}_getAminoAcids(){return this.model.protein().aminoAcids()}async _fetchCDRAnnotations(){if(!this.option.get("visible"))return
const[e]=await jt.Z.getCDRAnnotations([this._getAminoAcids()],this.option.getSetting("CDRDefinition").get("value").toLowerCase()),t=null==e?void 0:e.map((e=>e.regions.map((t=>({...t,name:formatRegionName(t.name,e.chainType)})))))
this.cachedAnnotations=t?l.default.flatten(t):[]
this._updateAfterProteinChange()}_addAminoAcidsListener(){ba.Z.addChangeListener((()=>{if(this._getAminoAcids()!==this.cachedAminoAcids){this.cachedAminoAcids=this._getAminoAcids()
this._fetchCDRAnnotations()}}))}_addVisibilityOptionsListener(){this.listenTo(this.option.get("settings"),"change:value",this._fetchCDRAnnotations.bind(this))}_registerAnnotationListeners(){this._addAminoAcidsListener()
this._addVisibilityOptionsListener()}getData(e,t){return this.cachedAnnotations.filter((n=>T.isRangeOverlap(e,t,n.start,n.end))).map((e=>new CDRAnnotationView(e)))}contextMenuData(){return{}}}ProteinCDRView.initClass()
const ts=ProteinCDRView
class ProteinAlignmentCDRAnnotationsView extends ts{constructor(e){super(e)
this.className="antibodyAlignmentCDRAnnotations"
this.realToGapMap=getRealToGapMap(e.aminoAcids)}_getAminoAcids(){return this.cachedAminoAcids}getPolymerLength(){return this.cachedAminoAcids.length}_registerAnnotationListeners(){this._addVisibilityOptionsListener()}_updateAfterProteinChange(){this.update()}clickAction(e){this.tabstate.get("selection").setEndpoints(e.start(),e.end())}dblClickAction(){}_convertToGappedAnnotations(e){return e.map((e=>({...e,start:this.realToGapMap[e.start],end:this.realToGapMap[e.end]||this.realToGapMap[this.realToGapMap.length-1]+1})))}async _fetchCDRAnnotations(){if(!this.option.get("visible"))return
const e=(0,y.removeGaps)(this._getAminoAcids()),[t]=await jt.Z.getCDRAnnotations([e],this.option.getSetting("CDRDefinition").get("value").toLowerCase()),n=null==t?void 0:t.map((e=>e.regions.map((t=>({...t,name:formatRegionName(t.name,e.chainType)}))))),a=n?l.default.flatten(n):[]
this.cachedAnnotations=this._convertToGappedAnnotations(a)
this._updateAfterProteinChange()}}var ns=n(648463),as=n(5245),is=n(226576),ss=n(737376),rs=n(364172),os=n(556776)
const ls=3.5
function letterCenterX(e,t,n){return(n-t)*e+.5*e}function getScaleFactor(e){return Math.min(e/11,1)}function getBoxHeightWithMods(e){if(e<6)return e+4
const t=ls*getScaleFactor(e)
return 7*getScaleFactor(e)+1.2*t*2+1.2*t*2+1}function getYOffsetForMod(e,t,n){const a=2*(ls*getScaleFactor(n))*1.2,i=e[Un.Zp.PHOSPHATE],s=e[Un.Zp.SUGAR]
let r=1
if(t===Un.Zp.BASE){s||(r+=a)
i||(r+=a)}if(t===Un.Zp.SUGAR){r+=a
i||(r+=a)}t===Un.Zp.PHOSPHATE&&(r+=2*a)
return r}function getPhosphateXOffset(e){return Math.max(-3.5,(e+1)/12*-3.5)}function ModHeightOffset({offsetY:e,children:t}){return d.createElement("g",{transform:`translate(0, ${e})`},t)}function ModifiedNucleotideDotView({isOligo:e,letterWidth:t,sliceStart:n,monomers:a,seqSliceMods:i,layout:s,nucleotideType:r}){return d.createElement("svg",null,d.createElement(Pa.Z,{layout:s,shouldStopMouseDownPropagation:!1},d.createElement("g",null,i.map(((i,s)=>{var o,l
const c=function getModificationsAtPosition(e,t,n,a){const i={}
i[Un.Zp.PHOSPHATE]=!(0,Ma.sm)(e.phosphateMonomerId,t,n,a)
i[Un.Zp.SUGAR]=!(0,Ma.sm)(e.sugarMonomerId,t,n,a)
i[Un.Zp.BASE]=!(0,Ma.sm)(e.baseMonomerId,t,n,a)
return i}(i,a,r,e),u=getScaleFactor(t),m=a.find((e=>e.id===i.baseMonomerId)),p=ls*u,h=a.find((e=>e.id===i.sugarMonomerId)),g=2.625*u,E=a.find((e=>e.id===i.phosphateMonomerId))
return d.createElement("g",{key:`${i.position}-${i.sugarMonomerId}-${i.baseMonomerId}-${i.phosphateMonomerId}`,transform:`translate(${letterCenterX(t,n,i.position)-.25})`},c[Un.Zp.PHOSPHATE]&&d.createElement(ss.ZP,{size:7*u,offsetX:getPhosphateXOffset(t),offsetY:getYOffsetForMod(c,Un.Zp.PHOSPHATE,t),symbol:(0,Ma.Lt)(E)}),c[Un.Zp.SUGAR]&&d.createElement(ModHeightOffset,{offsetY:getYOffsetForMod(c,Un.Zp.SUGAR,t)},d.createElement(rs.Z,{stroke:null!==(o=null==h?void 0:h.color)&&void 0!==o?o:Un.K4,radius:g,strokeWidth:2*(p-g),cy:p})),c[Un.Zp.BASE]&&d.createElement(ModHeightOffset,{offsetY:getYOffsetForMod(c,Un.Zp.BASE,t)},d.createElement(is.Z,{fill:null!==(l=null==m?void 0:m.color)&&void 0!==l?l:Un.K4,radius:p,cy:p})))})))))}function ModifiedNucleotideBarView({layout:e,letterWidth:t,seqSliceMods:n,sliceStart:a}){return d.createElement("svg",null,d.createElement(Pa.Z,{layout:e,shouldStopMouseDownPropagation:!1},d.createElement("g",null,n.map(((e,n)=>{const i=letterCenterX(t,a,e.position)-t/2
return d.createElement("g",{key:`${e.position}-${e.sugarMonomerId}-${e.baseMonomerId}-${e.phosphateMonomerId}`,transform:`translate(${i}, ${getBoxHeightWithMods(t)})`},d.createElement("rect",{width:t,height:3,stroke:Un.K4,fill:Un.K4}))})))))}function ModifiedNucleotideViewAtLetterWidth({isOligo:e,layout:t,letterWidth:n,modifiedNucleotides:a,monomers:i,nucleotideType:s,redraw:r,sliceEnd:o,sliceStart:l}){const c=a.filter((e=>e.position>=l&&e.position<o)),u=c.length>0,m=n<=24;(0,d.useEffect)((()=>{r(u&&m?getBoxHeightWithMods(n):0)}),[u,m,n,r])
return m?Math.round(n)>=6?d.createElement(ModifiedNucleotideDotView,{isOligo:e,letterWidth:n,sliceStart:l,monomers:i,seqSliceMods:c,layout:t,nucleotideType:s}):d.createElement(ModifiedNucleotideBarView,{letterWidth:n,sliceStart:l,seqSliceMods:c,layout:t}):null}function QueryingModifiedNucleotideViewAtLetterWidth({layout:e,letterWidth:t,redraw:n,sequenceId:a,sliceEnd:i,sliceStart:s,sliceBases:r}){return d.createElement(Da.ZP,{query:Un.V,renderLoading:({refetch:e})=>null},(({monomers:o})=>d.createElement(Da.ZP,{query:os.t,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,variables:{sequenceId:a},fetchPolicy:"cache-only"},(a=>{const l=a.componentSequence.modifiedNucleotides,c=(0,Ma.nP)(o,a.componentSequence.nucleotideType,r,l,s)
return d.createElement(ModifiedNucleotideViewAtLetterWidth,{isOligo:a.componentSequence.type===Sn.uS.oligo,layout:e,letterWidth:t,modifiedNucleotides:c,monomers:o,nucleotideType:a.componentSequence.nucleotideType,redraw:n,sliceEnd:i,sliceStart:s})}))))}function ModifiedNucleotideSummary({xFn:e,sliceStart:t,sliceEnd:n,sequenceId:a,layout:i,redraw:s,sliceBases:r}){const o=(0,li.M)(e,t)
return d.createElement(QueryingModifiedNucleotideViewAtLetterWidth,{layout:i,letterWidth:o,redraw:s,sequenceId:a,sliceEnd:n,sliceStart:t,sliceBases:r})}var cs=n(762802)
class BlankLayout extends cs.Ar{vMargin(){return 0}boxHeight(){return 0}}class SelectionHiddenWrapperView extends ha{static initClass(){this.prototype.className="selection-hidden-wrapper"}initialize(){super.initialize()
this.layout=new BlankLayout}update(){}}SelectionHiddenWrapperView.initClass()
const ds=SelectionHiddenWrapperView
var us=n(427478),ms=n(576118),ps=n.n(ms)
function sliceBoundedTranscriptions(e,t,n,a){ps()(e<=t,`expected sliceStart ${e} <= sliceEnd ${t} when parsing transcriptions`)
return a.filter((a=>(0,T.isRangeOverlap)(a.start,a.end,e,t)&&a.isReverseComplement===n)).map((n=>{const a=n.start,i=n.end,s=a>=e&&a<t?a:e,r=i>=e&&i<t?i:t
return{clampedStart:(0,Jt.uZ)(e,t,s),clampedEnd:(0,Jt.uZ)(e,t,r),feature:n}}))}var hs=n(567e3)
const gs="#FCB768",Es=122*1.15,fs={forward:d.createElement("g",null,d.createElement("path",{d:"M113 7L107.75 13.0622V0.937822L113 7Z"}),d.createElement("path",{d:"M0 1H108V13H0V1Z"})),reverse:d.createElement("g",null,d.createElement("path",{d:"M0 7L5.25 0.937822L5.25 13.0622L0 7Z"}),d.createElement("path",{d:"M5 1H113V13H5V1Z"})),spanForward:d.createElement("g",null,d.createElement("path",{d:"M113 7L107.75 13.0622V0.937822L113 7Z"}),d.createElement("path",{d:"M0.0615399 12.9997L6 6.99968L0.0615399 0.999678H108V12.9997H0.0615399ZM0 12.9997H0.0615399L0 13.0619V12.9997ZM0 0.999678H0.0615399L0 0.9375V0.999678Z"})),spanReverse:d.createElement("g",null,d.createElement("path",{d:"M0 7L5.25 0.937822L5.25 13.0622L0 7Z"}),d.createElement("path",{d:"M112.938 1.00032L107 7.00032L112.938 13.0003L5 13.0003V1.00032L112.938 1.00032ZM113 1.00032H112.938L113 0.938145V1.00032ZM113 13.0003H112.938L113 13.0625V13.0003Z"}))}
function getArrowRelativeTextXPos(e,t){return e||t?8:2}function SVGArrow({isReverseComplement:e,spansStart:t}){let n
n=e||t?!e&&t?"spanForward":e&&!t?"reverse":"spanReverse":"forward"
return d.createElement("svg",{fill:gs},fs[n])}function TranscriptionArrow({transcriptionWithArrowPosition:e,layout:t,arrowXPosition:n,indexFromTop:a,sliceStart:i,setSelection:s}){const r=e.feature.rnaSequence.name,o=e.feature.rnaSequence.id,l=e.feature.isReverseComplement,c=23*a+5,u=e.clampedStart===i&&e.feature.start!==i
return d.createElement(Oe.Z,{renderContent:()=>d.createElement(Ti.V,{id:o,onClickName:()=>{(0,as.sd)()
ve.ZP.get().openFolderItem(o)},validationExtras:null})},d.createElement("svg",{onClick:()=>{s(e.feature.start,e.feature.end)}},d.createElement(Pa.Z,{layout:t,shouldStopMouseDownPropagation:!1},d.createElement("g",{transform:`translate(${n}, ${c})`},d.createElement("g",{transform:"scale(1.15, 1.5)",className:(0,g.iv)(Ss.transcriptionArrow)},d.createElement(SVGArrow,{isReverseComplement:l,spansStart:u})),d.createElement("text",{x:getArrowRelativeTextXPos(l,u),y:13.5,className:(0,g.iv)(Ss.transcriptionArrow),...(0,ee.Z)({component:"TranscriptionArrow",element:"text"})},function formatArrowDisplayText(e){const t=Math.floor(7.5),n=e.length
return e.length>15?`${e.slice(0,t)}...${e.slice(n-t,n)}`:e}(r))))))}function ConnectorLine({transcription:e,layout:t,connectorLineX:n,indexFromTop:a,boxHeightToTranscriptionLine:i}){const s=e.feature.isReverseComplement,r=23+23*a,o=5+23*(e.stackIndex-1),l=r-(s?9:0),c=r+(i(s)+(s?7:5))+o
return d.createElement("svg",null,d.createElement(Pa.Z,{layout:t,shouldStopMouseDownPropagation:!1},d.createElement("g",null,d.createElement("line",{x1:n,x2:n,y1:l,y2:c,stroke:gs,strokeWidth:1.5}))))}function TranscriptionArrowStack({transcriptionsOnSlice:e,layout:t,redraw:n,sliceEnd:a,sliceStart:i,boxHeightToTranscriptionLine:s,xFn:r,setSelection:o,sequenceVersionIsCurrent:l}){const c=function generateArrowStartX(e,t,n){const a=Math.max(0,Math.floor(n(t)-Es))
return e.map((e=>({...e,arrowStartX:Math.min(n(e.clampedStart),a)})))}(e,a,r),u=function generateArrowStackIndices(e){const t=(0,hs.Z)(e,["arrowStartX",{accessor:e=>e.feature.rnaSequence.name,naturalSort:!0},e=>e.feature.rnaSequence.id]),n=[]
for(let e=0;e<t.length;e++){const a=t[e]
let i=0,s=1
for(;i<e;){const e=n[i],t=e.arrowStartX+Es
if(a.arrowStartX<t&&s===e.stackIndex){i=0
s+=1}else i+=1}n.push({...a,stackIndex:s})}return n}(c),m=Math.max(...u.map((e=>e.stackIndex)),0),p=t.visible&&l;(0,d.useEffect)((()=>{n(p?23*m+5:0)}),[p,m,n])
return p?d.createElement("svg",null,d.createElement("g",null,u.map(((e,n)=>d.createElement(ConnectorLine,{key:`${n}`,transcription:e,layout:t,connectorLineX:r(e.clampedStart),indexFromTop:m-e.stackIndex,boxHeightToTranscriptionLine:s})))),d.createElement("g",null,u.map(((e,n)=>{const a=e.arrowStartX-1
return d.createElement(TranscriptionArrow,{key:`${n}`,transcriptionWithArrowPosition:e,layout:t,arrowXPosition:a,sliceStart:i,indexFromTop:m-e.stackIndex,setSelection:o})})))):null}function QueryingTranscriptionArrow({xFn:e,sliceStart:t,sliceEnd:n,sequence:a,layout:i,redraw:s,boxHeightToTranscriptionLine:r,setSelection:o}){return a.id===us.eA?null:d.createElement(Da.ZP,{query:Ge.TRANSCRIPTION_INDICES_QUERY,variables:{sequenceId:a.id},renderLoading:({refetch:e})=>null,fetchPolicy:"cache-only"},(l=>{var c
const u="SequenceNode"===l.bioentity.__typename&&null!==(c=l.bioentity.transcriptionMatches)&&void 0!==c?c:[],m=[...sliceBoundedTranscriptions(t,n,!1,u),...sliceBoundedTranscriptions(t,n,!0,u)]
return d.createElement(TranscriptionArrowStack,{transcriptionsOnSlice:m,layout:i,redraw:s,sliceEnd:n,sliceStart:t,boxHeightToTranscriptionLine:r,xFn:e,setSelection:o,sequenceVersionIsCurrent:a.get("currentVersion")})}))}const Ss=g.mM.create({transcriptionArrow:{cursor:"pointer"}})
function TranscriptionLine({start:e,end:t,layout:n,isReverseComplement:a,xFn:i}){const s=i(e),r=a?7:5
return d.createElement("svg",null,d.createElement(Pa.Z,{layout:n,shouldStopMouseDownPropagation:!1},d.createElement("g",{transform:`translate(${s}, ${r})`},d.createElement("rect",{width:i(t)-i(e),height:n.svgHeight,stroke:gs,fill:gs,shapeRendering:"geometricPrecision"}))))}function TranscriptionLines({transcriptionIndices:e,sliceStart:t,sliceEnd:n,layout:a,isReverseComplement:i,redraw:s,xFn:r,sequenceVersionIsCurrent:o}){const l=sliceBoundedTranscriptions(t,n,i,e),c=l.length>0,u=a.visible&&o;(0,d.useEffect)((()=>{s(u&&c?10:0)}),[u,c,s])
if(!u)return null
const m=[]
for(const e of l){const s=e.clampedStart,o=e.clampedEnd,generateTranscriptionProps=(e,t)=>({start:e,end:t,layout:a,isReverseComplement:i,xFn:r})
if(s>=o){m.push(generateTranscriptionProps(s,n))
m.push(generateTranscriptionProps(t,o))}else m.push(generateTranscriptionProps(s,o))}return d.createElement("svg",null,m.map(((e,t)=>d.createElement(TranscriptionLine,{...e,key:t}))))}function QueryingTranscriptionLine({xFn:e,sliceStart:t,sliceEnd:n,sequence:a,layout:i,isReverseComplement:s,redraw:r}){return a.id===us.eA?null:d.createElement(Da.ZP,{query:Ge.TRANSCRIPTION_INDICES_QUERY,variables:{sequenceId:a.id},renderLoading:({refetch:e})=>null,fetchPolicy:"cache-only"},(o=>{var l
const c="SequenceNode"===o.bioentity.__typename&&null!==(l=o.bioentity.transcriptionMatches)&&void 0!==l?l:[]
return d.createElement(TranscriptionLines,{transcriptionIndices:c,sliceStart:t,sliceEnd:n,layout:i,isReverseComplement:s,redraw:r,xFn:e,sequenceVersionIsCurrent:a.get("currentVersion")})}))}var ys=n(227487)
class TranslationsAsAnnotationsView extends Fi{constructor(...e){super(...e)
this.className="translations"}initialize(e){this.setting=Yt.KL.name
super.initialize(e)}contextMenuOptions(){return da}contextMenuData(e){return{translation:e.get("translationComponentModel")}}getData(e,t){const{numTotal:n,numVisible:a,numShown:i,shownTranslations:s}=(0,ys.A)(this.model.polymer(),e,t)
this.model.set({totalTranslations:n,visibleTranslations:a,shownTranslations:i})
return s}_registerAnnotationListeners(){const e=this.model.polymer()
this.listenTo(e.translations(),"change",(()=>{this.update()}))}}const bs=["sequenceAxis","gapToRealAxis"]
var Ts
!function(e){e.minimap="minimap"
e.linear="linear"
e.alignment="alignment"
e.proteinAlignment="proteinAlignment"}(Ts||(Ts={}))
function assertModelHasPolymer(e){if(null==e.polymer)throw new Error("Cannot call method on model without polymer. Try overriding in BasicSliceView")}class SliceView extends s().View{static initClass(){this.prototype.tagName="svg"
this.prototype.className="slice"
this.prototype.events={mousedown:"updateSelection",mousemove:"updateSelection",mouseup:"updateSelection",contextmenu:"updateSelection",dblclick:"updateSelection"}}static createSVGElement(){const e=document.createElementNS("http://www.w3.org/2000/svg",this.prototype.tagName)
o()(e).addClass(this.prototype.className)
return e}canEditSelection(){assertModelHasPolymer(this.model)
const e=this.model.polymer()
return e.allowEdits()&&e.isSelectionDeletable()}openSelectionContextMenu(e){assertModelHasPolymer(this.model)
const t=this.model.polymer()
if(t instanceof ga.Z)openSelectionContextMenu(e,t)
else if(t.isOligo())SelectionContextMenu_open(e,t,la,this.contextMenuData())
else{SelectionContextMenu_open(e,t,getSelectionMenu({alignment:"alignment"===this.mapType}),this.contextMenuData())}}handleDoubleClick(e){assertModelHasPolymer(this.model)
this.model.polymer().handleDoubleClick(this.slice.start(),this.slice.end())}getPolymerLength(){assertModelHasPolymer(this.model)
return this.model.polymer().length()}getResidueSlice(){assertModelHasPolymer(this.model)
return this.model.polymer().residueSlice(this.slice.start(),this.slice.end())}triggerHeightChange(e){this.slice.set("height",e)}setSVGWidth(){const e=this.model.get("layout").DNA.get("type").width(this.slice.end()-this.slice.start()),t=this.model.get("layout").DNA.get("type").letterSpacing
Re().select(this.el).attr("width",t+e+1)}height(){return this.slice.get("height")}setFocusableParent(e){this.focusableParent=e}constructor(e){super(e)}initialize(e){var t
this.selectionOptions=e.selectionOptions||{}
this.mapType=e.mapType
this.tabstate=e.tabstate
this.focusableParent=e.focusableParent||null
this.slice=e.slice
this.range=null!=e.range?e.range:null
this.selection=e.selection
this.trim=e.trim
this.data=e.data
this.visibilityOptions=e.visibilityOptions||this.model.get("visibilityOptions")
this.y=e.y
this.z=e.z
this.minSliceHeight=null!==(t=e.minSliceHeight)&&void 0!==t?t:20
this.blinkCursor=(0,It.D)(this.blinkCursor,100)
this.oldRectangle=[]
this.oldLineData=[]
this.oldBoxHeight=void 0
this.oldEndpoints=void 0
this.oldEmpty=void 0
this.hasRendered=!1
this.yIndexMap={}
for(let e=0;e<this.y.length;e++)this.yIndexMap[this.y[e]]=e
const[n,a]=l.default.partition(this.y,(e=>["forwardPamSites","cutSites","transcriptionArrow","reversePamSites","modifiedNucleotides"].includes(e))),i=a.concat(l.default.sortBy(n,(e=>Math.abs(this.yIndexMap[e]-this.yIndexMap.dna))))
this.yDeps={}
for(const e of n)this.yDeps[e]=[e]
this.yDeps.dna=n
const s={title(){return new qi({model:this.model,slice:this.slice,bufferCentred:!1})},emptyPlaceholder(){return new Ka({model:this.model,slice:this.slice})},dna(){return new Qa({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType,svgSupportsForeignObject:e.svgSupportsForeignObject,traceData:e.traceData})},aminoAcids(){const e={className:"aminoAcids residues",setting:Yt._j.name,model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"aminoAcids",disableMinimize:!0,boxHeight:e=>qn.ZP.aminoAcidBoxHeight(e),renderReact:e=>{const t=this.getResidueSlice()
return d.createElement(Pa.Z,{layout:e,shouldStopMouseDownPropagation:!1},d.createElement(Ji,{layout:e,aminoAcids:t}))},bottomMarginBleed:()=>4}
return new ReactWrapperView(e)},antibodyCDRAnnotations(){return new ts({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},antibodyAlignmentCDRAnnotations(){return new ProteinAlignmentCDRAnnotationsView({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,annotations:this.data.row.proteinVersion.annotations,aminoAcids:this._polymerResidues,slice:this.slice,parent:this,mapType:this.mapType})},cutSites(){return new za({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},forwardPamSites(){return new bi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType,strand:1,componentClassName:"forwardPamSites"})},reversePamSites(){return new bi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType,strand:-1,componentClassName:"reversePamSites"})},dnaSearch(){return new Wa({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},translations(){return this.mapType===Ts.minimap?new TranslationsAsAnnotationsView({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this}):new $i({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this})},readingFrames(){return new ki({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,range:this.range})},annotations(){return new Zi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},primers(){const e={className:"primers",polymerLayoutName:"primers",disableMinimize:!1,visibilityOptions:this.visibilityOptions,secondarySettings:[Yt.bW.name],setting:Yt.gY.name,model:this.model,additionalListeners:[{other:this.model.get("sequence").sequencePrimers(),event:"change:hover change:selected"}],layeringMode:Kt.LINEAR_LAYER_FULL,singleHeight:()=>getSinglePrimerHeight(getPrimerType(this.visibilityOptions,this.model.get("layout").DNA.get("type")),getSliceHasAnyPrimerMods(this.model.get("sequence"),this.slice.start(),this.slice.end()),getPrimerBasesVisible(this.visibilityOptions)),getSliceModels:()=>getSlicePrimers(this.model.get("sequence"),this.slice.start(),this.slice.end()),renderReact:(e,t,n,a,i,s)=>d.createElement(PrimersView,{xFn:this.slice.x(),yFn:s,sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),contextMenuOptions:oa,polymerLayout:e,primerBasesVisible:getPrimerBasesVisible(this.visibilityOptions),sliceHasAnyMods:getSliceHasAnyPrimerMods(this.model.get("sequence"),this.slice.start(),this.slice.end()),primerType:getPrimerType(this.visibilityOptions,this.model.get("layout").DNA.get("type")),residuesType:this.model.get("layout").DNA.get("type"),mapType:this.mapType,redraw:t,slicePrimers:n,layersDict:a,layeringMode:i})}
return new LayeredReactWrapperView(e)},forwardPrimers(){const e={className:"forwardPrimers",polymerLayoutName:"primers",boxHeight:()=>0,disableMinimize:!1,visibilityOptions:this.visibilityOptions,secondarySettings:[Yt.bW.name],setting:Yt.gY.name,model:this.model,additionalListeners:[{other:this.model.get("sequence").sequencePrimers(),event:"change:hover change:selected"}],layeringMode:Kt.LINEAR_LAYER_FULL,singleHeight:()=>getSinglePrimerHeight(getPrimerType(this.visibilityOptions,this.model.get("layout").DNA.get("type")),getSliceHasAnyPrimerMods(this.model.get("sequence"),this.slice.start(),this.slice.end()),getPrimerBasesVisible(this.visibilityOptions)),getSliceModels:()=>getSlicePrimers(this.model.get("sequence"),this.slice.start(),this.slice.end(),1),renderReact:(e,t,n,a,i,s)=>d.createElement(PrimersView,{xFn:this.slice.x(),yFn:s,sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),contextMenuOptions:oa,polymerLayout:e,primerBasesVisible:getPrimerBasesVisible(this.visibilityOptions),sliceHasAnyMods:getSliceHasAnyPrimerMods(this.model.get("sequence"),this.slice.start(),this.slice.end()),primerType:getPrimerType(this.visibilityOptions,this.model.get("layout").DNA.get("type")),residuesType:this.model.get("layout").DNA.get("type"),mapType:this.mapType,redraw:t,slicePrimers:n,layersDict:a,layeringMode:i})}
return new LayeredReactWrapperView(e)},reversePrimers(){const e={className:"reversePrimers",polymerLayoutName:"primers",boxHeight:()=>0,disableMinimize:!1,visibilityOptions:this.visibilityOptions,secondarySettings:[Yt.bW.name],setting:Yt.gY.name,model:this.model,additionalListeners:[{other:this.model.get("sequence").sequencePrimers(),event:"change:hover change:selected"}],layeringMode:Kt.LINEAR_LAYER_FULL,singleHeight:()=>getSinglePrimerHeight(getPrimerType(this.visibilityOptions,this.model.get("layout").DNA.get("type")),getSliceHasAnyPrimerMods(this.model.get("sequence"),this.slice.start(),this.slice.end()),getPrimerBasesVisible(this.visibilityOptions)),getSliceModels:()=>getSlicePrimers(this.model.get("sequence"),this.slice.start(),this.slice.end(),-1),renderReact:(e,t,n,a,i,s)=>d.createElement(PrimersView,{xFn:this.slice.x(),yFn:s,sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),contextMenuOptions:oa,polymerLayout:e,primerBasesVisible:getPrimerBasesVisible(this.visibilityOptions),sliceHasAnyMods:getSliceHasAnyPrimerMods(this.model.get("sequence"),this.slice.start(),this.slice.end()),primerType:getPrimerType(this.visibilityOptions,this.model.get("layout").DNA.get("type")),residuesType:this.model.get("layout").DNA.get("type"),mapType:this.mapType,redraw:t,slicePrimers:n,layersDict:a,layeringMode:i})}
return new LayeredReactWrapperView(e)},orfs(){return new hi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this})},sequenceAxis(){return new ai({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this,mapType:this.mapType})},homologyRegionAxis(){return new HomologyRegionAxisView({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this,mapType:this.mapType})},trace(){return new Gi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,data:e.traceData})},votes(){return new Wi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,data:e.voteData})},line(){return new si({model:this.tabstate instanceof Qi.Z?this.data.row:this.model,setting:this.tabstate instanceof Qi.Z?Yt.fq.name:Yt.Jv.name,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,lineLayout:this.model.get("layout").Line,slice:this.slice,behind:!0})},parts(){const e={className:"parts",polymerLayoutName:"parts",boxHeight:e=>0,disableMinimize:!1,visibilityOptions:this.visibilityOptions,secondarySettings:[Yt.dq.name],setting:Yt.iX.name,model:this.model,renderReact:(e,t)=>{var n,a
return d.createElement(PartsView,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),polymerLayout:e,dnaHeight:this.model.get("layout").DNA.height(),dnaSpacer:this.model.get("layout").DNA.get("spacer"),complementVisible:null!==(a=null===(n=this.visibilityOptions.getOption(Yt.dq.name))||void 0===n?void 0:n.get("visible"))&&void 0!==a&&a,mapType:this.mapType,redraw:t})}}
return new ReactWrapperView(e)},partAnnotations(){const e={className:"partAnnotations",polymerLayoutName:"partAnnotations",disableMinimize:!1,visibilityOptions:this.visibilityOptions,setting:Yt.qh.name,model:this.model,slice:this.slice,layeringMode:Kt.LINEAR_LAYER_FULL,singleHeight:()=>16,getSliceModels:()=>this.model.get("sequence").parts().getSequencePartsBetween(this.slice.start(),this.slice.end()),renderReact:(e,t,n,a,i,s)=>d.createElement(SequencePartAnnotationsView,{xFn:this.slice.x(),yFn:s,sliceStart:this.slice.start(),sliceEnd:this.slice.end(),leftBP:this.slice.get("leftBP"),rightBP:this.slice.get("rightBP"),visibleWidth:this.slice.get("visibleWidth"),sequence:this.model.get("sequence"),residuesType:this.model.get("layout").DNA.get("type"),contextMenuOptions:getSelectionMenu(),mapType:this.mapType,layout:e,redraw:t,sliceParts:n,layersDict:a,layeringMode:i})}
return new LayeredReactWrapperView(e)},gapToRealAxis(){return new ti({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this})},alignmentComments(){return new AlignmentCommentsView({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this,mapType:this.mapType})},primerAssemblyMismatches(){return new Ni({model:this.model,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this})},goldenGateCutSites(){return new ni({model:this.model,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this})},proteinAxis(){return new Ri({model:this.model,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this})},proteinAlignmentAxis(){return new ji({tabstate:this.tabstate,model:this.model,visibilityOptions:this.visibilityOptions,slice:this.slice,range:this.range,parent:this})},aminoAcidsSearch(){return new Aa({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},codonOptimization(){return new Ga({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},proteinAnnotations(){return new Hi({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,slice:this.slice,parent:this,mapType:this.mapType})},proteinAlignmentAnnotations(){return new ProteinAlignmentAnnotationsView({model:this.model,tabstate:this.tabstate,visibilityOptions:this.visibilityOptions,annotations:this.data.row.proteinVersion.annotations,slice:this.slice,parent:this,mapType:this.mapType})},proteinPIGraph(){return this._proteinBarGraphWrapperView({getValues:()=>{const e=this.getResidueSlice()
return Array.from(e).map((e=>ns.Dd(e)))},propertyName:"pI",componentName:Kt.SliceComponentName.proteinPIGraph,graphClassName:"pIBarGraph",setting:Yt.HV.name})},proteinHydrophobicityGraph(){return this._proteinBarGraphWrapperView({getValues:()=>{const e=this.getResidueSlice()
return Array.from(e).map((e=>ns.JY(e)))},propertyName:"Hydrophobicity",componentName:Kt.SliceComponentName.proteinHydrophobicityGraph,graphClassName:"hydrophobicityBarGraph",setting:Yt.kQ.name})},proteinAlignmentIdentityGraph(){return this._proteinBarGraphWrapperView({getValues:()=>getIdentityValues(getAminoAcidMatrix(this.tabstate.get("alignment").rows,this.slice.start(),this.slice.end())),propertyName:"Identity",componentName:Kt.SliceComponentName.proteinAlignmentIdentityGraph,graphClassName:"alignmentIdentityGraph",setting:Yt.MC.name})},antibodyNumbering(){const e={className:"antibodyNumbering",model:this.model,visibilityOptions:this.visibilityOptions,setting:Yt.XH.name,polymerLayoutName:"antibodyNumbering",disableMinimize:!1,boxHeight:()=>0,renderReact:(e,t)=>d.createElement(AntibodyNumberingSlice,{layout:e,onAlignment:!this.model.protein,redraw:t,residues:this.model.protein?this.model.protein().aminoAcids():this._polymerResidues,scheme:this.visibilityOptions.getOption(Yt.XH.name).getSetting("numberingScheme").get("value"),setSelection:this.selection.setEndpoints.bind(this.selection),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),xFn:this.slice.x()})}
return new ReactWrapperView(e)},attachedMolecules(){const e={className:"attachedMolecules",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"attachedMolecules",boxHeight:e=>0,disableMinimize:!1,shouldUpdateForAdjust:!0,renderReact:(e,t)=>d.createElement(QueryingAttachedMolecules,{complexPolymerId:this.model.get("sequence").get("_sequence").complexPolymerId(),xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),layout:e,boxHeightToDNA:this.boxHeightToDNA(Kt.SliceComponentName.attachedMolecules),redraw:t})}
return new ReactWrapperView(e)},modifiedNucleotides(){const e={className:"modifiedNucleotides",model:this.model,visibilityOptions:this.visibilityOptions,secondarySettings:[Yt.UN.name],polymerLayoutName:"modifiedNucleotides",boxHeight:e=>e.visible?ri.s7:0,disableMinimize:!1,shouldUpdateForAdjust:!0,renderReact:(e,t)=>d.createElement(ri.ZP,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequenceId:this.model.get("sequence").get("id"),bases:this.getResidueSlice(),showNucleotideStructures:this.visibilityOptions.getOption(Yt.UN.name).get("visible"),layout:e,boxHeightToDNA:this.boxHeightToDNA(Kt.SliceComponentName.modifiedNucleotides),complexPolymerId:this.model.get("sequence").get("_sequence").complexPolymerId()})}
return new ReactWrapperView(e)},modifiedNucleotideSummary(){const e={className:"modifiedNucleotideSummary",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"modifiedNucleotideSummary",boxHeight:e=>0,disableMinimize:!1,renderReact:(e,t)=>d.createElement(ModifiedNucleotideSummary,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequenceId:this.model.get("sequence").get("id"),layout:e,redraw:t,sliceBases:this.getResidueSlice()})}
return new ReactWrapperView(e)},forwardTranscriptionLine(){const e={className:"forwardTranscriptionLine",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"forwardTranscriptionLine",setting:Yt.be.name,boxHeight:e=>0,disableMinimize:!1,renderReact:(e,t)=>d.createElement(QueryingTranscriptionLine,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),layout:e,isReverseComplement:!1,redraw:t})}
return new ReactWrapperView(e)},reverseTranscriptionLine(){const e={className:"reverseTranscriptionLine",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"reverseTranscriptionLine",setting:Yt.be.name,boxHeight:e=>0,disableMinimize:!1,renderReact:(e,t)=>d.createElement(QueryingTranscriptionLine,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),layout:e,isReverseComplement:!0,redraw:t})}
return new ReactWrapperView(e)},transcriptionArrow(){const e={className:"transcriptionArrow",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"transcriptionArrow",setting:Yt.be.name,boxHeight:e=>0,disableMinimize:!1,secondarySettings:[Yt.dq.name,Yt.iX.name,Yt.qh.name,Yt.gY.name,Yt.bW.name],renderReact:(e,t)=>d.createElement(QueryingTranscriptionArrow,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequence:this.model.get("sequence"),layout:e,redraw:t,boxHeightToTranscriptionLine:e=>{const t=e?Kt.SliceComponentName.reverseTranscriptionLine:Kt.SliceComponentName.forwardTranscriptionLine
return this.boxHeightBetweenLayers(Kt.SliceComponentName.transcriptionArrow,t)},setSelection:(e,t)=>{this.selection.setEndpoints(e,t)}})}
return new ReactWrapperView(e)},nucleotidesAxisOverlay(){const e={className:"nucleotidesAxisOverlay",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"nucleotidesAxisOverlay",boxHeight:()=>0,disableMinimize:!1,renderReact:(e,t)=>d.createElement(ui.Z,{xFn:this.slice.x(),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),sequenceId:this.model.get("sequence").get("id"),layout:e,bases:this.getResidueSlice(),nucleotideType:this.model.get("sequence").nucleotideType()})}
return new ReactWrapperView(e)},nucleotidesPositionHighlight(){const e={className:"nucleotidesPositionHighlight",model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:"nucleotidesPositionHighlight",boxHeight:()=>0,disableMinimize:!1,renderReact:(e,t)=>d.createElement(di,{height:this.distanceFromSliceTopToBelowDNAResidues(),xFn:this.slice.x(),sequenceId:this.model.get("sequence").get("id"),sliceStart:this.slice.start(),sliceEnd:this.slice.end(),layout:e})}
return new ReactWrapperView(e)},proteinLiabilitySites(){const e=this.model.get("polymerLayout").proteinLiabilitySites,t=e.height+e.vMargin,n={className:"proteinLiabilitySites",model:this.model,visibilityOptions:this.visibilityOptions,setting:Yt.pz.name,secondarySettings:[Yt.W3.name],polymerLayoutName:"proteinLiabilitySites",disableMinimize:!1,boxHeight:()=>0,_staticBoxHeight:this._forAlignmentPNGExport?t:void 0,renderReact:(e,t)=>d.createElement(ProteinLiabilitySitesSlice,{layout:e,redraw:t,residues:this.model.protein?this.model.protein().aminoAcids():this._polymerResidues,sliceStart:this.slice.start(),sliceEnd:this.slice.end(),visibilityOptions:this.visibilityOptions,xFn:this.slice.x()})}
return new ReactWrapperView(n)},selectionHiddenWrapper(){return new ds({model:this.model})}}
this.components={}
this.zComponents=[]
this.rComponents=[]
for(const e of this.y)this.components[e]=s[e].call(this)
for(const e of this.z)this.zComponents.push(this.components[e])
for(const e of i)this.rComponents.push(this.components[e])
o()(document).on(`mouseup.slice-${this.slice.cid}`,(()=>{this.selection.set("active",null)
null!=this.trim&&this.trim.stopDrag()}))}registerListeners(){this.stopListening()
this.listenTo(this.slice,"change:width",((e,t,{skipUpdate:n}={})=>{n||this.update()}))
for(const e of Object.keys(this.components)){const t=this.components[e]
this.listenTo(t,"redraw",this.adjustAndSelect)}this.listenTo(this.selection,"change",this.doSelect)
null!=this.trim&&this.listenTo(this.trim,"change",this.doTrim)}getSlice(){return this.slice}contextMenuData(){const e=null!=this.model.polymer&&this.model.polymer()
return l.default.extend({model:this.model,circular:e instanceof Ge.Sequence&&e.circular(),hasTrim:null!=this.trim},this.selectionOptions)}_proteinBarGraphWrapperView({getValues:e,propertyName:t,componentName:n,graphClassName:a,setting:i}){const s={className:n,setting:i,model:this.model,visibilityOptions:this.visibilityOptions,polymerLayoutName:n,boxHeight:e=>e.height+e.vMargin,renderReact:n=>{const i=e()
return d.createElement(Pa.Z,{layout:n,shouldStopMouseDownPropagation:!1},d.createElement(components_TooltipBarGraph,{values:i,propertyName:t,xFunc:e=>this.slice.get("x")(e+this.slice.start()),maxHeight:n.height,className:a}))}}
return new ReactWrapperView(s)}generateRectangles(e,t){const n=[]
if(null===t)return n
const a=this.slice.start(),i=this.slice.end()
if(e<t)n.push([{start:e,end:t}])
else if(a<=t&&t<=e&&e<i){n.push({start:a-1,end:t})
n.push({start:e,end:i+1})}else{const s=a<=e&&e<i?e:a-1,r=a<=t&&t<i?t:i+1
n.push({start:s,end:r})}return n}killSelection(){Re().select(this.el).selectAll(".selection-component").remove()}createSelectRect(e,t){const n=bs.includes(this.y[this.y.length-1])
const a=Math.max(l.default.reduce(this.components,(function iterator(e,t,a){return bs.includes(a)&&n?e:e+t.boxHeight()}),0),this.minSliceHeight)
e.attr("x",(e=>t(e.start))).attr("y",0).attr("width",(e=>t(e.end)-t(e.start))).attr("height",(e=>a))}checkRectsEqual(e,t){if(e.length!==t.length)return!1
for(let n=0;n<e.length;n++){const a=e[n],i=t[n]
if(a.start!==i.start||a.end!==i.end)return!1}return!0}generateTrimRectangles(e,t){const n=[]
this.slice.start()<e&&n.push({start:this.slice.start(),end:e})
this.slice.end()>t&&n.push({start:t,end:this.slice.end()})
return n}renderTrim(){const e=this.generateTrimRectangles(this.trim.start(),this.trim.end()),t=Re().select(this.el).selectAll("rect.trim").data(e)
t.enter().insert("svg:rect",":first-child").classed("trim",!0)
t.exit().remove()
this.createSelectRect(t,this.slice.x())}renderSelect(){const e=l.default.chain(this.selection.slice(this.slice.start(),this.slice.end())).map((e=>this.generateRectangles(e.start(),e.end()))).flatten().value()
for(;e.length<2;)e.push({start:this.slice.start(),end:this.slice.start()})
const t=this.boxHeight()
if(0===this.oldRectangle.length&&0===e.length)return
if(this.checkRectsEqual(this.oldRectangle,e)&&this.oldBoxHeight===t&&this.oldSelectStart===this.slice.start()&&this.oldSelectEnd===this.slice.end()&&this.oldWidth===this.slice.get("width")&&this.selection.canPCR()===this.oldCanPCR)return
this.oldRectangle=e
this.oldSelectStart=this.slice.start()
this.oldSelectEnd=this.slice.end()
this.oldCanPCR=this.selection.canPCR()
this.oldWidth=this.slice.get("width")
const n=Re().select(this.el).selectAll("rect.selection").data(e),a=Re().select(this.el).selectAll("g.selection-hidden-wrapper").data([e])
addTestAttrsToD3Selection(a,{component:"SliceView",element:"selection"})
n.enter().insert("svg:rect",":first-child").classed("selection",!0).classed("selection-component",!0)
n.classed("can-pcr",this.selection.canPCR()).classed("cant-edit",!this.canEditSelection())
const i=a.selectAll("rect.selection-hidden").data((e=>e))
i.enter().append("svg:rect").classed("selection-hidden",!0).classed("selection-component",!0).on("contextmenu",(e=>{this.openSelectionContextMenu(Re().event);(0,as.cl)(this.model.get("sequence"))}))
const s=this.slice.x()
this.createSelectRect(n,s)
this.createSelectRect(i,s)
n.exit().remove()
i.exit().remove()}die(){this.stopListening()
o()(document).off(`.slice-${this.slice.cid}`)
l.default.each(this.components,((e,t,n)=>{e.die()}))}getTop(){const e=this.$el.parents(".buffer-tab"),t=e.offset().top
return e[0].scrollTop+this.el.getBoundingClientRect().top-t-10}updateSelectionFromScroll(e){const t=e-this.$el.offset().left,n=Math.round(this.slice.xInv()(t))
null!=this.trim&&this.trim.isActive()?this.trim.drag(n):this.selection.get("active")&&this.selection.linearExtend(n)}updateSelection(e){if((3===e.which||e.ctrlKey||"contextmenu"===e)&&e.altKey&&window.debug)return
const t=e.pageX-this.$el.offset().left,n=(0,Jt.uZ)(0,this.getPolymerLength(),Math.round(this.slice.xInv()(t)))
if(null!=this.trim)switch(e.type){case"mousemove":this.trim.isActive()&&this.trim.drag(n)
break
case"mouseup":this.trim.stopDrag()}switch(e.type){case"mousemove":case"mousewheel":this.selection.get("active")===this.mapType&&this.selection.linearExtend(n)
break
case"mousedown":l.default.defer((()=>{this.focusableParent&&this.focusableParent.focus()}))
window.getSelection().removeAllRanges();(0,as.p8)(this.model.get("sequence"),this.mapType)
if(e.shiftKey){ma.gW({isLinear:!0},this,(()=>{this.selection.expand(n)
null!=this.selection.end()&&(0,as.K)(this.model.get("sequence"),as.zL.shiftClickDown,this.selection.start(),this.selection.end(),this.mapType)}))
this.selection.set({active:this.mapType})
e.stopPropagation()}else if(3!==e.which&&!e.ctrlKey){this.selection.reset(n)
this.selection.set({active:this.mapType})
e.stopPropagation()}break
case"contextmenu":this.selection.reset(n)
this.selection.set({active:this.mapType})
break
case"mouseup":if(this.selection.get("active")===this.mapType){this.selection.set({active:null})
if(3!==e.which&&!e.ctrlKey){this.selection.linearExtend(n)
const t=e.shiftKey?as.zL.shiftClickUp:as.zL.clickAndDrag;(0,as.K)(this.model.get("sequence"),t,this.selection.start(),this.selection.end(),this.mapType)}}break
case"dblclick":this.handleDoubleClick(e);(0,as.K)(this.model.get("sequence"),as.zL.doubleClick,this.selection.start(),this.selection.end(),this.mapType)
e.stopPropagation()}}doSelect(){this.renderSelect()
this.selectLines()}doTrim(){this.renderTrim()
this.trimLines()}checkLinesEqual(e,t){if(e.length!==t.length)return!1
for(let n=0;n<e.length;n++){const a=e[n],i=t[n]
if(a.type!==i.type||a.x!==i.x)return!1}return!0}trimLines(){const e=[];(this.trim.start()===this.slice.end()||this.slice.contains(this.trim.start()))&&e.push({type:"start",x:this.trim.start()});(0===this.trim.end()||this.slice.contains(this.trim.end()-1))&&e.push({type:"end",x:this.trim.end()})
this.trim.start()===this.trim.end()&&this.trim.end()===this.slice.end()&&e.reverse()
const t=Re().select(this.el).selectAll(".trim-line").data(e)
t.enter().insert("svg:path").append("svg:title").text("Trim")
const n=this.boxHeight(),a=this.slice.x(),{trim:i}=this
t.classed("trim-line",!0).attr("d",(e=>`M${a(e.x)+("start"===e.type?10:-10)},1L${a(e.x)},1L${a(e.x)},${n}`)).on("mousedown",(e=>{Re().event.stopPropagation()
i.startDrag(e.type)
m.j("editor","trimmed_sequence")}))
t.exit().remove()
addTestAttrsToD3Selection(t,{component:"SliceView",element:"trimLine"})}selectLines(){const e=this.slice.x(),t=this.selection,n=t.slice(this.slice.start(),this.slice.end()),a=[]
this.slice.contains(t.start())&&a.push({type:"start",x:t.start()})
const i=this.getPolymerLength();(this.slice.contains(t.end()-1)||t.end()===this.slice.end()||this.slice.end()===i&&t.start()===i)&&a.push({type:"end",x:t.end()})
const s=this.boxHeight()
if(0===this.oldLineData.length&&0===a.length)return
if(this.checkLinesEqual(this.oldLineData,a)&&this.oldBoxHeight===s&&this.oldLineStart===this.slice.start()&&this.oldLineEnd===this.slice.end()&&this.oldWidthLines===this.slice.get("width")&&this.oldEmpty===t.isEmpty())return
this.oldLineStart=this.slice.start()
this.oldLineEnd=this.slice.end()
this.oldWidthLines=this.slice.get("width")
this.oldLineData=a
this.oldEmpty=t.isEmpty()
const r=Re().select(this.el)
let o=0===n.length||!t.isEmpty(),l=r.selectAll(".map-cursor-line")
l.classed("hide",o)
l=l.data(n)
l.enter().insert("svg:line",":first-child")
l.classed("map-cursor-line",!0).classed("selection-component",!0).attr("x1",(t=>e(t.start()))).attr("y1",0).attr("x2",(t=>e(t.start()))).attr("y2",s).classed("hide",o).classed("line-blink",!1)
addTestAttrsToD3Selection(l,{component:"SliceView",element:"mapCursorLine"})
o||setTimeout((()=>{this.blinkCursor()}),100)
o=t.isEmpty()
l=r.selectAll(".selection-line").data(a)
l.enter().insert("svg:line")
const{mapType:c}=this
l.classed("selection-line",!0).classed("selection-component",!0).attr("x1",(t=>e(t.x))).attr("y1",0).attr("x2",(t=>e(t.x))).attr("y2",s).classed("hide",o).on("mousedown",(e=>{Re().event.stopPropagation()
t.setFreeEnd(e.type)
t.set("active",c)}))
l.exit().remove()
l=r.selectAll(".cursor-triangle").data(a)
l.enter().insert("svg:polygon")
l.classed("cursor-triangle",!0).classed("selection-component",!0).attr("points","-6,0 0,12 6,0").attr("transform",(t=>`translate(${e(t.x)}, 0)`)).classed("hide",o).on("mousedown",(e=>{Re().event.stopPropagation()
t.setFreeEnd(e.type)
t.set("active",c)}))
l.exit().remove()}blinkCursor(){Re().select(this.el).selectAll(".map-cursor-line").classed("line-blink",!0)}boxHeight(){const e=this.y.reduce(((e,t)=>e+Math.ceil(this.components[t].boxHeight())),0)
return Math.max(e,this.minSliceHeight)}boxHeightToDNA(e){let t=0
const[n,a]=[this.yIndexMap.dna,this.yIndexMap[e]].sort(((e,t)=>e-t))
for(const e of this.y.slice(n+1,a))t+=Math.ceil(this.components[e].boxHeight())
return t}boxHeightBetweenLayers(e,t){let n=0
const[a,i]=[this.yIndexMap[t],this.yIndexMap[e]].sort(((e,t)=>e-t))
for(const e of this.y.slice(a+1,i))n+=this.components[e].boxHeight()
return n}distanceFromSliceTopToBelowDNAResidues(){let e=0
const[t,n]=[0,this.yIndexMap.dna+1].sort(((e,t)=>e-t))
for(const a of this.y.slice(t+1,n))e+=Math.ceil(this.components[a].boxHeight())
return e}adjustHeight(e=!1){const t={}
let n=0,a=0
this.y.forEach(((i,s)=>{var r,o,l
const c=Re().select(this.el).selectAll(`g.${i}`)
if(null==c.node())return
const d=/translate\(0,(.+)\)/.exec(c.attr("transform")),u=null!=d&&parseFloat(d[1])
c.attr("transform",`translate(0,${n})`)
if(u!==n&&null!=this.yDeps[i]&&!e)for(const e of this.yDeps[i])t[e]=!0
const m=Math.ceil(this.components[i].boxHeight())
n+=m
0!==m&&(a=null!==(l=null===(o=(r=this.components[i]).bottomMarginBleed)||void 0===o?void 0:o.call(r))&&void 0!==l?l:0)}))
n+=a
for(const e of Object.keys(t))this.components[e].updateForAdjust()
n=Math.max(n,this.minSliceHeight)
Re().select(this.el).attr("height",n)
this.triggerHeightChange(n)}update(){if(this.dontUpdate)return
if(this.hasRendered)for(const e of this.rComponents)e.update(!1)
else{for(const e of this.zComponents)Re().select(this.el).append("svg:g").each((function setThis(){e.setElement(this)}))
for(const e of this.rComponents)e.render(!1)}this.hasRendered=!0
this.adjustAndSelect(!0)
this.setSVGWidth()}updateComponent(e){e in this.components&&this.components[e].update()}adjustAndSelect(e=!1){this.adjustHeight(e)
this.doSelect()
null!=this.trim&&this.doTrim()
const t=this.boxHeight()
if(this.oldBoxHeight!==t){this.oldBoxHeight=t
this.oldMaxBases=this.model.get("maxBases")}const n=Re().select(this.el).selectAll("rect.body-slice").data([{width:this.slice.get("width"),height:t}])
n.enter().insert("rect",":first-child").classed("body-slice",!0)
n.exit().remove()
n.attr("height",(e=>e.height)).attr("width",(e=>e.width))
addTestAttrsToD3Selection(n,{component:"SliceView",element:"bodySliceRectangle"})}render(){this.registerListeners()
this.update()
return this}}SliceView.initClass()
class BasicSliceView extends SliceView{initialize(e){this._polymerResidues=e.polymerResidues
this._forAlignmentPNGExport=e.forAlignmentPNGExport
super.initialize(e)}getResidueSlice(){return T.residueSlice(this._polymerResidues,this.slice.start(),this.slice.end(),!1)}setSVGWidth(){const{fontSize:e,letterSpacing:t}=this.model.get("polymerLayout").aminoAcids.type,n=new bn.Z(e,t).width(this.slice.end()-this.slice.start()),a=t
Re().select(this.el).attr("width",a+n+1)}canEditSelection(){return!1}openSelectionContextMenu(e){e.preventDefault()
e.stopPropagation()}handleDoubleClick(e){e.preventDefault()}getPolymerLength(){return this._polymerResidues.length}}function AlignmentViewUtil_makeSliceView(e,t,n,a,i){const s=t.get("alignment"),r={slice:e,range:a,model:t,tabstate:n,selection:t.polymer().selection(),trim:t.polymer().get("trim"),traceData:s.get("trace"),mapType:Ts.alignment,y:Kt.NUCLEOTIDE_ALIGNMENT_ROW_Y_COMPONENTS,z:Kt.NUCLEOTIDE_ALIGNMENT_ROW_Z_COMPONENTS,selectionOptions:{tabstate:n,alignment:!0},svgSupportsForeignObject:i,voteData:s.get("votes"),minSliceHeight:75}
if(!s.get("trace")){r.y=r.y.filter((e=>e!==Kt.SliceComponentName.trace))
r.z=r.z.filter((e=>e!==Kt.SliceComponentName.trace))
r.traceData=void 0}if(!s.get("votes")){r.y=r.y.filter((e=>![Kt.SliceComponentName.alignmentComments,Kt.SliceComponentName.votes].includes(e)))
r.z=r.z.filter((e=>![Kt.SliceComponentName.alignmentComments,Kt.SliceComponentName.votes].includes(e)))
r.voteData=void 0}return new SliceView(r)}function notifySuccess({id:e,name:t}){const n=t.length>32?`${t.slice(0,29)}...`:t
v.ZP.success(`Sequence alignment **${n}** saved.`,{id:e})
m.j("alignment","saved_alignment",{name:t})}function notifyError(e,t){de.Jf(e,t)||v.ZP.error("Error saving sequencing alignment.")}var vs=n(126675),Cs=n(615439),Is=n.n(Cs),ws=n(55363),Ns=n(948510),As=n(418955)
class RingComponent extends pa{constructor(){super(...arguments)
this.isLinear=!1}initialize(e){this.tabstate=e.tabstate
this.angle=e.angle
this.layout=e.layout
this.circularView=e.circularView}registerListeners(){this.listenTo(this.layout,"change:visible",(()=>{this.redrawPlasmid()?this.triggerRedraw():this.update()}))
const e=this.tabstate.get("visibilityOptions").getOption(this.className)
if(null!=e)return this.listenTo(e.get("settings"),"change:value",(()=>{this.redrawPlasmid()?this.triggerRedraw():this.update()}))}basePairToAngle(e){return(0,As.AW)(this.angle(e))}getAngles(e,t){return(0,As.MV)(e,t,this.model.get("sequence").length(),this.angle)}die(){this.stopListening()}redraw(){}update(){if(this.model.get("sequence").length()<1)this.$el.hide()
else{this.$el.show()
this.redraw()}}redrawPlasmid(){return!1}triggerRedraw(){this.model.trigger("redraw")}}class RingView extends RingComponent{initialize(e){super.initialize(e)
this.radius=Re().scale.linear().domain([0,1])
this.radiusIn=Re().scale.linear().domain([0,1])
this.updateRadius()}isShown(){return!0}radiusFromInner(e,t){return Re().scale.linear().domain([e,e+1]).range([t,t+this.layout.get("ringHeight")])}layerBounds(e,t=null){const n=null!=t?this.radiusFromInner(t):this.radius
return{innerRadius:n(e),outerRadius:n(e+1)-this.layout.vMargin()}}updateRadius(){this.radius.range([this.getInnerRadius(),this.getInnerRadius()+this.layout.get("ringHeight")])
this.radiusIn.range([this.getOuterRadius(),this.getOuterRadius()-this.layout.get("ringHeight")])}setInnerRadius(e){this.layout.set("innerRadius",e)
this.updateRadius()
this.update()}setOuterRadius(e){this.layout.set("outerRadius",e)
this.updateRadius()
this.update()}getInnerRadius(){return this.layout.get("innerRadius")}getOuterRadius(){return this.layout.get("outerRadius")}getOffset(){return(0,As._O)(this.model.get("DNAOffset"),this.model.get("sequence").length())}computeOuterRadius(e){return e}render(){return this}}class SegmentsRingView extends RingView{data(){return[]}initialize(e){super.initialize(e)
this.renderedData=null
this.recomputeLayers=!0}contextMenuData(){return[]}contextMenuOptions(e){return{}}arc(e){return Re().svg.arc()}fill(e){return e.color()}opacity(e){return e.hover()||e.selected()?1:.7}fontColor(e){return Vt.Rl}fontWeight(e){return e.hover()||e.selected()?700:400}stroke(e){return Re().rgb(e.color()).darker().toString()}strokeWidth(e){return e.hover()?1.5:1.000001}handleHover(e,t,n){const a=e.uid()
Re().select(this.el).selectAll(".individual-ring").filter(`[id='${a}']`).select(".ring-shape").attr("stroke-width",this.strokeWidth).transition().duration(25).attr("fill-opacity",this.opacity).attr("fill",(e=>this.fill(e)))}registerPieceHandlers(e){let t=this.model.get("sequence")
const bindStopPropagation=(e,t)=>function(n){if(null!=e){Re().event.stopPropagation()
return e.call(t,n)}}
e.on("mousedown.segmentring",bindStopPropagation(this.pieceClickHandler,this)).on("dblclick.segmentring",bindStopPropagation(this.pieceDblClickHandler,this)).on("mouseover.segmentring",(e=>e.set({hover:!0}))).on("mouseout.segmentring",(e=>e.set({hover:!1}))).on("contextmenu.segmentring",(e=>{if(null!=this.contextMenuData){t=this.model.get("sequence")
if(SelectionContextMenu_open(Re().event,t,this.contextMenuData(),this.contextMenuOptions(e))&&this.shouldCaptureLeftClick()){Re().event.stopPropagation()
this.pieceClickHandler(e)}}}))}handleDraw(e){e.attr("stroke-width",this.strokeWidth).attr("stroke",(e=>this.stroke(e))).attr("fill",(e=>this.fill(e))).attr("d",(t=this,function(e){const n=e.get("annularLayer"),a=e.start(),i=e.end(),s=t.getAngles(a,i),r=t.arc(e),o=t.layerBounds(n)
if(null!=r){r.innerRadius(o.innerRadius).outerRadius(o.outerRadius).startAngle(s.startAngle).endAngle(s.endAngle)
return r(e)}return""})).attr("fill-opacity",this.opacity)
var t}computeMinRings(){var e
if(!this.layout.get("visible"))return 0
const t=null!==(e=this.renderedData)&&void 0!==e?e:this.data(),n=Ia.kg(t)
return Number.isNaN(n)?0:n+1}setConstraints(e){this.update()}baseLine(e){return this.radius(e)}updateLayers(e){if(0===e.length){this.storeBounds(0)
return}const t=Ia.xb(e,{sequence:this.model.get("sequence")})
l.default.each(t.layers,(e=>e.model.set("annularLayer",e.layer)))
this.storeBounds(t.max+1)}storeBounds(e){null==e&&({rings:e}=this)
this.rings=e
const t=this.getInnerRadius()+this.layout.get("ringHeight")*this.rings
this.layout.set("outerRadius",t)
this.updateRadius()}zeroBounds(){this.layout.set("outerRadius",this.layout.get("innerRadius"))
this.updateRadius()}stopListening(){super.stopListening()
Re().select(this.el).selectAll(".ring-shape").on(".segmentring",null)}enterRing(e){e.append("svg:path").classed("ring-shape",!0).classed(this.singularClassName,!0).attr("shape-rendering","geometricPrecision")
this.registerPieceHandlers(e)}eachRing(e){e.attr("id",(e=>e.uid()))
e.each((t=this,function(e){t.handleDraw(Re().select(this).select(".ring-shape"),e)}))
var t}invalidateData(){this.renderedData=null
this.recomputeLayers=!0}invalidateLayers(){this.recomputeLayers=!0}updateData(){this.renderedData=this.data()}hideHandler(){}redraw(){if(!this.layout.get("visible")){this.$el.hide()
this.hideHandler()
this.zeroBounds()
return}this.$el.show()
null==this.renderedData&&this.updateData()
this.recomputeLayers?this.updateLayers(this.renderedData):this.storeBounds(null)
const e=Re().select(this.el).selectAll(".individual-ring").data(this.renderedData)
e.exit().on(".segmentring",null).remove()
const t=e.enter().append("svg:g").classed("individual-ring",!0)
this.enterRing(t)
this.eachRing(e)}}const Rs=class LabeledSegmentsRingView extends SegmentsRingView{initialize(){super.initialize(...arguments)
return this._allowLabels=!1}allowLabels(){return this._allowLabels}handleHover(e,t,n){super.handleHover(e,t,n)
const a=e.uid()
return Re().select(this.el).selectAll(".individual-ring").filter(`[id='${a}']`).select("text").attr("font-weight",this.fontWeight)}handleText(e){const t=[],n=this
return e.each((function(e){const a=Re().select(this).select("path")
let i=Re().select(this).select("text")
const s=Re().select(this).select(".text-bg"),r=i.select(".text-path"),o=e.get("annularLayer"),c=n.layerBounds(o),d=n.baseLine(o)
let u=Ns.Z.linearArc().reverse(!1)
const m=n.calcSize(e,o,e.get("forceLabel")),{angles:p}=m,{name:h}=m,{anglePadding:g}=m,{isOutside:E}=m
let f=null,S=0
if(""!==h){let o,m,y
"none"===this.style.display&&(this.style.display="")
e.set("hasCircularLabel",!0)
const b={angle:(p.startAngle+p.endAngle)/2,orientation:null},T=l.default.sortedIndex(t,b,(e=>e.angle)),v=[]
0<=(m=T-1)&&m<t.length&&v.push(t[T-1])
T<t.length&&v.push(t[T])
const C=l.default.min(v,(e=>Math.abs(e.angle-b.angle)))
null!=C&&Math.abs(C.angle-b.angle)<2*Math.PI/36&&(b.orientation=C.orientation)
t.splice(T,0,b)
const I=Math.PI/2<(y=(p.startAngle+p.endAngle)/2)&&y<3*Math.PI/2
null==b.orientation&&(b.orientation=I)
if(b.orientation){o=Math.abs(p.endAngle-g-p.startAngle)
const e=d+n.layout.get("type").height()-2
u.startAngle(p.startAngle).endAngle(p.endAngle-g).reverse(!0).radius(e)
if(E){f="end"
S=e*(p.endAngle-p.startAngle)}}else{o=Math.abs(p.endAngle-(p.startAngle+g))
u.startAngle(p.startAngle+g).endAngle(p.endAngle).radius(d+2)}const w=(new Date).getTime()
a.attr("d",u).attr("id",`feature-${e.uid()}-${w}`)
i.attr("fill",E?Vt.Rl:n.fontColor)
r.attr("xlink:href",`#feature-${e.uid()}-${w}`).attr("text-anchor",f).attr("startOffset",S).each((function(e){i=Re().select(this).text()
if(i!==h)return Re().select(this).text(h)}))
return s.attr("d",(function(e){if(E){const t=Re().svg.arc()
t.innerRadius(c.innerRadius).outerRadius(c.outerRadius).startAngle(p.startAngle).endAngle(p.clickEndAngle)
return t(e)}return"M 0 0"}))}u="M 0 0"
e.set("hasCircularLabel",!1)
if("none"!==this.style.display)return this.style.display="none"}))}cutoffRadius(){return this.model.get("minInnerRadius")}calcSize(e,t,n){const a=e.start(),i=e.end()
let s=getNucleotideAwareDisplayName(e),r=this.getAngles(a,i)
this.layerBounds(t)
const o=this.baseLine(t)
let l=0!==o?this.layout.get("type").width(s.length)/o:0,c=(r.endAngle-r.startAngle-l)/2,d=!1,u=!0
if(c*o<10)if(l+(r.endAngle-r.startAngle)>2*Math.PI*3/4){const t=(r.endAngle-r.startAngle)*o/this.layout.get("type").width(1)
s=`${e.displayLabel().slice(0,Math.max(0,t-3))}...`
u=!1
if("..."===s||!u)return{name:"",angles:r,anglePadding:0,isOutside:!1}
l=this.layout.get("type").width(s.length)/o
c=(r.endAngle-r.startAngle-l)/2}else{if(!this.allowLabels()&&!n)return{name:"",angles:r,anglePadding:0,isOutside:!1}
const e=r.endAngle+5/o
r={startAngle:e,endAngle:e+Math.min(1.4*l,2*Math.PI-1),clickEndAngle:e+Math.min(1.1*l,2*Math.PI-1)}
c=0
d=!0}return{name:s,angles:r,anglePadding:c,isOutside:d}}enterRing(e){super.enterRing(e)
const t=e.append("svg:g").classed("text-group",!0),n=(t.append("svg:path").attr("stroke","none").attr("stroke-width",1).attr("fill","none"),t.append("svg:path").classed("text-bg",!0).attr("fill","red").attr("fill-opacity",0))
t.append("svg:text").classed("ring-label",!0).attr("font-size",this.layout.get("type").fontSize).attr("font-weight",this.fontWeight).attr("text-rendering","optimizeLegibility").attr("pointer-events","none").append("svg:textPath").classed("text-path",!0).attr("text-rendering","optimizeLegibility")
return this.registerPieceHandlers(n)}eachRing(e){super.eachRing(e)
return this.handleText(e.select(".text-group"))}updateLayers(e){const t=this.model.get("sequence").length(),n=this.layout.get("inlineLabelsVisible")?[!0,!1]:[!1]
for(this._allowLabels of Array.from(n)){const startFn=e=>({model:e,pos:e.layerStart()})
var endFnWithLabel=(e,n,a)=>{let i
const s=this.calcSize(e,n.layer,a)
i=s.isOutside?T.mod(Math.ceil(this.angle.invert(s.angles.endAngle)),t):e.end()
return{model:e,pos:i,calcSize:s}}
const endFn=(e,t)=>this._allowLabels?endFnWithLabel(e,t,!1):{model:e,pos:e.layerEnd()},n=Ia.xb(e,{startFn,endFn,top:!0,sequence:this.model.get("sequence")}),a=n.max
for(const e of Array.from(n.layers)){const{layer:t}=e,{model:a}=e
a.set({annularLayer:t,forceLabel:!1})
if(!this._allowLabels&&this.layout.get("inlineLabelsVisible")){const e=endFnWithLabel(a,{layer:t},!0),i=startFn(n.siblingMap[a.cid]).pos,s=startFn(a).pos,r=e.pos,{calcSize:o}=e
o.isOutside&&!T.baseInRange(i,s+1,r)&&a.set({forceLabel:!0})}}this.storeBounds(a+1)
if(this.layerBounds(a).innerRadius>this.cutoffRadius())break}return this.recomputeLayers=!1}}
class CircularAnnotationsView extends Rs{static initClass(){this.prototype.className="annotations"
this.prototype.singularClassName="annotation"
this.prototype.tagName="g"}contextMenuData(){return na}contextMenuOptions(e){return{annotation:e}}arc(e){return(0,ws.aE)(e.strand())}data(){const e=this.model.get("sequence")
let t=[]
const n=e.annotations(),a=n.slice(this.model.get("leftBP"),this.model.get("rightBP"),(n=>{t=n
return l.default.sortBy(n,(t=>-t.length(e))).slice(0,Kt.MAX_VISIBLE_RING_FEATURES)}))
this.model.set({totalA:n.length,visibleA:t.length,shownA:a.length})
return a}hideHandler(){if(!this.layout.get("visible"))return this.model.set({visibleA:0,shownA:0})}clickAction(e){return e.click(this.model.get("sequence"),Re().event.shiftKey)}dblClickAction(e){return e.dblClick(this.model.get("sequence"),Re().event.shiftKey)}registerListeners(){super.registerListeners()
const e=this.model.get("sequence").annotations()
this.listenTo(e,"layerChange",(function(){this.invalidateData()
return this.triggerRedraw()}))
return this.listenTo(e,"change:hover change:selected",this.handleHover)}setConstraints(e){return this.setOuterRadius(e)}redrawPlasmid(){return!0}storeBounds(e){null==e&&({rings:e}=this)
this.rings=e
const t=this.getOuterRadius()-this.layout.get("ringHeight")*this.rings
this.layout.set("innerRadius",t)
return this.updateRadius()}zeroBounds(){this.layout.set("innerRadius",this.layout.get("outerRadius"))
return this.updateRadius()}layerBounds(e){return{innerRadius:this.radiusIn(e+1),outerRadius:this.radiusIn(e)-this.layout.vMargin()}}baseLine(e,t=null){return this.radiusIn(e+1)}}CircularAnnotationsView.initClass()
const Ps=CircularAnnotationsView
const Os=class Display{static polar(e,t){t=-(t-Math.PI/2)
return{x:e*Math.cos(t),y:-e*Math.sin(t)}}static angleToDisplayDegrees(e){return e/Math.PI*180}}
class CircularAxisView extends RingView{static initClass(){this.prototype.className="axis"}redrawPlasmid(){return!0}computeInnerRadius(e){return e-22}triggerRedraw(){this.model.trigger("invalidateLayers")
super.triggerRedraw()}initialize(e){super.initialize(e)
this.circularLayout=e.circularLayout
this._sequence=this.model.get("sequence").get("_sequence")
this.listenTo(this._sequence,"change:finalized change:fragmentResults",(()=>{this.update()}));(0,S.Gp)(1===this._sequence.startIndex(),"CircularAxisView rendering with startIndex != 1")}render(){Re().select(this.el).append("g").classed("axis-labels",!0)
this.update()
return this}getPiecesData(){return this._sequence.finalized()?null:ye.Z.of(this._sequence).getFragmentResultPieces(this._sequence).map((([e,t,n])=>({pieceStartAngle:this.basePairToAngle(t),pieceEndAngle:this.basePairToAngle(n),color:e})))}redraw(){let e,t,n
if(!this.layout.get("visible")){this.$el.hide()
this.layout.set("innerRadius",this.getOuterRadius())
return}this.$el.show()
this.layout.set("innerRadius",this.computeInnerRadius(this.getOuterRadius()))
const a=this.model.get("sequence").length(),i=this.layout.get("tickSize")
if(this.model.get("fullCircleView")){t=(0,ws.Sd)(a)
e=Re().range(t,a+1,t)}else{let i,s
if(this.model.get("leftBP")>this.model.get("rightBP")){n=a-this.model.get("leftBP")+(this.model.get("rightBP")-0)
t=(0,ws.Sd)(n)
i=this.model.get("leftBP")-this.model.get("leftBP")%t
s=this.model.get("rightBP")-this.model.get("rightBP")%t+t
e=Re().range(i,a-t/2,t).concat(Re().range(t,s,t))}else{n=this.model.get("rightBP")-this.model.get("leftBP")
t=(0,ws.Sd)(n)
i=this.model.get("leftBP")-this.model.get("leftBP")%t
s=this.model.get("rightBP")-this.model.get("rightBP")%t+t
e=Re().range(i,s+1,t)}}const s=-1!==l.default.indexOf(e,1,!0)
e=l.default.union(e,1)
const r=Re().select(this.el),o=this.getOuterRadius(),c=r.select(".axis-labels").selectAll(".axis-label").data(e),d=c.enter().append("g").classed("axis-label",!0)
d.append("text").attr("text-anchor","middle").attr("font-weight",900).attr("font-size",this.layout.get("type").fontSize).append("svg:textPath").classed("text-path",!0)
d.append("path").attr("stroke","none").attr("stroke-width",1).attr("fill","none")
d.append("line").attr("stroke","black").attr("shape-rendering","geometricPrecision")
c.exit().remove()
const u=Re().svg.line.radial().interpolate("basis").tension(0).angle((e=>e)),m=this,p=this.getPiecesData(),{useBaseWidthStripe:h}=(0,ii.$1)(m._sequence.length(),m.getOuterRadius(),(e=>m.basePairToAngle(e)))
c.each((function(t){const n=m.basePairToAngle(T.displayToModel(t,m._sequence.startIndex())),a=Os.polar(1===t?o-i-m.layout.get("type").height():o-i,n),r=Os.polar(o,n),l=Re().select(this).select("path"),c=Math.min(m.layout.get("type").width(2*String(t).length)/o,Math.PI)
if(Math.PI/2<n&&n<3*Math.PI/2){e=Re().range(n+c,n-c,-c/4)
u.radius(o-i)}else{e=Re().range(n-c,n+c,c/4)
u.radius(o-i-m.layout.get("type").height()+2)}l.datum(e)
l.attr("d",u).attr("id",`axis-${t}-${m.cid}`)
Re().select(this).select("text").select(".text-path").attr("xlink:href",`#axis-${t}-${m.cid}`).attr("startOffset",u.radius()*c).text(1!==t||s?t:"")
Re().select(this).select("line").attr("stroke-width",1===t?4:2).attr("stroke",(e=>{if(null!=p)if(h)for(const t of m._sequence.fragmentResults().models){const n=T.displayToModel(e,m._sequence.startIndex())
if(T.baseInRange(n,t.start(),t.end()))return null!=t.homologyRegionOtherColor()&&(n-t.start())%2==0?t.homologyRegionOtherColor():t.color()}else for(const{pieceStartAngle:e,pieceEndAngle:t,color:a}of p){const i=(0,As.AW)(e),s=(0,As.AW)(t),r=s<i&&(i<n||n<=s)
if(i<s&&i<n&&n<=s||r||i===s)return a}return"black"})).attr("shape-rendering","geometricPrecision").attr("x1",a.x).attr("y1",a.y).attr("x2",r.x).attr("y2",r.y)}))}clickAction(e){}dblClickAction(e){}}CircularAxisView.initClass()
const xs=CircularAxisView,_s="#A57CA6",Ds={A:"#C8411E",C:"#7CB2AB",G:"#9BAA53",T:"#DEBA43",R:_s,Y:_s,M:_s,K:_s,W:_s,S:_s,B:_s,D:_s,H:_s,V:_s,N:"#808080"},Ls=Object.keys(Ds).reduce(((e,t)=>{const n=Re().rgb(Ds[t]).brighter(.3).toString()
e[t]=n
e[t.toLowerCase()]=n
return e}),{}),ks=Object.keys(Ds).reduce(((e,t)=>{e[t]=Ds[t]
e[t.toLowerCase()]=Ds[t]
return e}),{})
function computeVisibleBP(e,t,n){return e>=t?(0,Jt.w6)(e,n-1).concat((0,Jt.w6)(0,t-1)):(0,Jt.w6)(e,t-1)}function color(e,t){return Object.keys(ks).includes(e)?t?ks[e]:Ls[e]:"black"}class CircularDNAView extends RingView{static initClass(){this.prototype.className="dna"}initialize(e){super.initialize(e)
this._sequence=this.model.get("sequence").get("_sequence")}registerListeners(){super.registerListeners()
this.listenTo(this._sequence,"change:finalized change:fragmentResults",(()=>{this.update()}))}updateRadius(){this.radius.range([this.getOuterRadius(),this.getOuterRadius()-this.layout.get("ringHeight")])}computeOuterRadius(e){const t=this.model.get("sequence").length(),n=2*Math.PI/t*e
return n>10?e+2*this.layout.get("ringHeight"):e+Number(this.layout.get("ringHeight"))}getPiecesData(){return ye.Z.of(this._sequence).getFragmentResultPieces(this._sequence).map((([e,t,n])=>{const{startAngle:a,endAngle:i}=(0,As.MV)(t,n,this._sequence.length(),(e=>this.basePairToAngle(e)))
return{pieceStartAngle:a,pieceEndAngle:i,color:e}}))}redraw(){let e,t
const n=this.model.get("sequence").length(),a=Re().select(this.el),i=2*Math.PI/n*this.radius(2),s=a.select(".letters"),r=a.select(".squares"),o=a.select(".circles"),l=a.select(".pieces")
if(this.model.get("fullCircleView")||n<40){e=0
t=n}else{e=((this.model.get("leftBP")-10)%n+n)%n
t=(this.model.get("rightBP")+10)%n}let c=s.selectAll(".letter").data([]),d=r.selectAll(".square").data([]),u=o.selectAll(".circle").data([]),m=l.selectAll(".piece").data([])
if(this._sequence.finalized())if(i>10){this.layout.set("innerRadius",this.radius(2))
c=s.selectAll(".letter").data(computeVisibleBP(e,t,n))}else if(i>3){this.layout.set("innerRadius",this.radius(1))
d=r.selectAll(".square").data(computeVisibleBP(e,t,n))}else{this.layout.set("innerRadius",this.radius(0)-4)
u=o.selectAll(".circle").data([""])}else{const a=this.getPiecesData()
m=l.selectAll(".piece").data(a)
if(i>10){this.layout.set("innerRadius",this.radius(2))
c=s.selectAll(".letter").data(computeVisibleBP(e,t,n))}else this.layout.set("innerRadius",this.radius(1))}c.exit().remove()
const p=c.enter().append("text").classed("letter",!0)
p.append("svg:tspan").classed("norm",!0)
p.append("selectvg:tspan").classed("comp",!0)
const h=this,g=this.model.get("sequence").get("_sequence"),E=this.layout.get("type")
c.attr("text-anchor","middle").each((function(e){const t=h.basePairToAngle(e+.5),n=h.radius(0)-E.height(),a=Os.angleToDisplayDegrees(t),i=Re().select(this)
i.attr("transform",`rotate(${a})`).attr("font-weight",900)
i.select(".norm").text((e=>g.at(e))).attr("fill",(e=>color(g.at(e),!0))).attr("x",0).attr("y",-n).attr("dx",0).attr("dy",0)
i.select(".comp").text((e=>Ue.util.complement(g.at(e),g.baseTable()))).attr("fill",(e=>color(Ue.util.complement(g.at(e),g.baseTable()),!0))).attr("x",0).attr("y",-n).attr("dx",0).attr("dy",E.height()+2)}))
const f=Re().svg.arc().innerRadius(this.radius(1)).outerRadius(this.radius(0)).startAngle((e=>this.angle(e))).endAngle((e=>this.angle(e+1)))
d.exit().remove()
d.enter().append("path").classed("square",!0)
d.attr("fill",(e=>color(g.at(e),!1))).attr("d",f)
u.enter().append("svg:circle").classed("circle",!0).attr("stroke-width",4).attr("stroke","grey").attr("fill","none")
u.exit().remove()
u.attr("r",Math.max(this.radius(0)-2,0))
m.enter().append("svg:path").classed("piece",!0)
m.attr("d",(({pieceStartAngle:e,pieceEndAngle:t})=>Re().svg.arc().innerRadius(this.getInnerRadius()).outerRadius(this.getOuterRadius()).startAngle(e).endAngle(t)())).attr("fill",(({color:e})=>e)).on("dblclick",(({selectRegionOnDoubleClick:e})=>{if(null!=e){const{start:t,end:n}=e
h.model.get("sequence").get("selection").set({start:t,end:n})
Re().event.stopPropagation()}}))
m.exit().remove()}render(){const e=Re().select(this.el)
e.append("g").classed("pieces",!0)
e.append("g").classed("letters",!0)
e.append("g").classed("squares",!0)
e.append("g").classed("circles",!0)
return super.render()}clickAction(e){}dblClickAction(e){}}CircularDNAView.initClass()
function getHomologyAwareFragmentResultData(e,t,n){const a=e.length(),[i,s]=(0,Jt.uK)(e.fragmentResults().models,(e=>null==e.homologyRegionOtherColor()))
return[...i.map((e=>{const{startAngle:t,endAngle:i}=(0,As.MV)(e.start(),e.end(),a,(e=>n(e)))
return{pieceStartAngle:t,pieceEndAngle:i,color:e.color()}})),...s.flatMap((e=>(0,ii.Zf)({start:e.start(),end:e.end(),color:e.color(),homologyRegionOtherColor:e.homologyRegionOtherColor()},a,t,n).map((t=>({...t,selectRegionOnDoubleClick:{start:e.start(),end:e.end()}})))))]}class HomologyRegionAxisView_HomologyRegionAxisView extends xs{static initClass(){this.prototype.className="homologyRegionAxis"}getPiecesData(){return getHomologyAwareFragmentResultData(this._sequence,this.getOuterRadius(),(e=>this.basePairToAngle(e)))}}HomologyRegionAxisView_HomologyRegionAxisView.initClass()
class HomologyRegionDNAView extends CircularDNAView{static initClass(){this.prototype.className="homologyRegionDNA"}getPiecesData(){return getHomologyAwareFragmentResultData(this._sequence,this.getOuterRadius(),(e=>this.basePairToAngle(e)))}}HomologyRegionDNAView.initClass()
class LabelsView extends RingView{static initClass(){this.prototype.className="labels"}initialize(e){super.initialize(e)
this.circularLayout=e.circularLayout
this.fastUpdate=this.update
this.modelToLabelGroup={}
this.modelToRerender={}
this.fastDebouncedUpdate=(0,It.D)(this.update,0)
this.debouncedUpdate=(0,It.D)(this.update,500)
this.update=function(){this.$el.hide()
return this.debouncedUpdate()}
this.groups=[]
return this.features=[]}die(){super.die()
return this.stopListening()}featureColor(e){return"cutsite"===e.type()?Re().rgb(e.color()).darker(.5).toString():"black"}textDecoration(e){switch(e.type()){case"annotation":case"translation":case"part":return"underline"
default:return null}}computeOuterRadius(e){return e}setInnerRadius(e,t){this.layout.set("innerRadius",e)
this.updateRadius()
return t?this.fastDebouncedUpdate():this.update()}registerListeners(){super.registerListeners()
this.listenTo(this.model,"change:width change:height",this.update)
this.listenTo(this.model.get("sequence").get("cutsites"),"change:visible add remove change:position change:color",this.fastDebouncedUpdate)
this.listenTo(this.model.get("sequence").annotations(),"layerChange",this.fastDebouncedUpdate)
this.listenTo(this.model.get("sequence").translations(),"layerChange",this.fastDebouncedUpdate)
this.listenTo(this.model.get("sequence").parts(),"layerChange",this.fastDebouncedUpdate)
this.listenTo(this.model.get("sequence").sequencePrimers(),"layerChange",this.fastDebouncedUpdate)
this.listenTo(this.model.get("sequence").get("cutsites"),"change:hover",this.handleHover)
this.listenTo(this.model.get("sequence").annotations(),"change:hover",this.handleHover)
this.listenTo(this.model.get("sequence").sequencePrimers(),"change:hover",this.handleHover)
this.listenTo(this.model.get("sequence").get("cutsites"),"change:selected",this.handleSelect)
this.listenTo(this.model.get("sequence").annotations(),"change:selected",this.handleSelect)
this.listenTo(this.model.get("sequence").sequencePrimers(),"change:selected",this.handleSelect)
this.listenTo(this.layout,"change:cutSitesVisible",this.fastUpdate)
return this.listenTo(this.layout,"change:axisVisible",this.fastUpdate)}pieceContextHandler(e){const t=this.model.get("sequence")
switch(e.type()){case"annotation":SelectionContextMenu_open(Re().event,t,na,{annotation:e,feature:e})
break
case"translation":SelectionContextMenu_open(Re().event,t,getSelectionMenu(),{translation:e.get("translationComponentModel"),feature:e.get("translationComponentModel")})
break
case"part":SelectionContextMenu_open(Re().event,t,getSelectionMenu(),{part:e,feature:e})
break
case"primer":SelectionContextMenu_open(Re().event,t,oa,{primer:e,feature:e})
break
case"cutsite":SelectionContextMenu_open(Re().event,t,ia,{cutsite:e})}}clickAction(e){switch(e.type()){case"annotation":case"primer":case"cutsite":return e.click(this.model.get("sequence"),Re().event.shiftKey)
default:return this.model.get("sequence").get("selection").select(e)}}dblClickAction(e){switch(e.type()){case"annotation":case"primer":case"cutsite":return e.dblClick(this.model.get("sequence"),Re().event.shiftKey)
default:return this.model.get("sequence").get("selection").select(e)}}handleNameChange(e){e.uid()
return Re().select(this.el).selectAll(".plasmid-label").filter(`[id='${this.labelId(e)}']`).select(".text-label").text(getNucleotideAwareDisplayName(e))}handleSelect(e,t,n){const a=e.uid()
if(!(e in this.modelToLabelGroup))return
const i=Re().select(this.el).selectAll("tspan").filter(`[id='${this.labelId(e)}']`),s=this.modelToLabelGroup[a],r=this.modelToRerender[a]
return null==n||ma.U2("mapId")!==this.model.cid&&"reset"!==n.event?Re().select(s).each(r(!1)):i.classed("selected-label",e.selected()||e.get("hover"))}handleHover(e,t,n){let a
if(!e.visible())return
const i=e.get("hover")
t=i||e.selected()
const s=e.uid(),r=this.modelToLabelGroup[s]
if(!i){a=Re().select(this.el).selectAll("tspan").filter(`[id='${this.labelId(e)}']`)
if(null!=a.node()){LabelsView_guard_(a.on("mouseout"),(t=>t.call(a.node(),e,!1)))
a.classed("selected-label",t)}}if(ma.U2("mapId")!==this.model.cid){const t=Re().select(r)
e.get("hover")?null!=t.node()&&LabelsView_guard_(t.on("mouseenter"),(e=>e.call(r))):null!=t.node()&&LabelsView_guard_(t.on("mouseleave"),(e=>e.call(r)))}if(i){a=Re().select(this.el).selectAll("tspan").filter(`[id='${this.labelId(e)}']`)
if(null!=a.node()){LabelsView_guard_(a.on("mouseover"),(t=>t.call(a.node(),e,!1)))
return a.classed("selected-label",t)}}}labelId(e){return`label-${e.uid()}`}labelRadius(){return this.circularView.getDNAView().layout.get("outerRadius")+40}basePairToAngle(e){let t=this.angle(e)%(2*Math.PI)
t<0&&(t+=2*Math.PI)
return t}getAngle(e){const t=this.basePairToAngle(e.start())
return(()=>{if("cutsite"===e.type())return t
{const t=e.start(),n=e.end(),a=this.basePairToAngle(t)
let i=this.basePairToAngle(n)
a>i&&(i+=2*Math.PI)
return(a+i)/2%(2*Math.PI)}})()}redraw(){var e
let t,n,a,i,s
this.$el.show()
this.layout.set("outerRadius",this.layout.get("innerRadius"))
const r=this.model.get("sequence").length(),c=(this.model.get("sequence"),this),d=this.model.get("leftBP"),u=this.model.get("rightBP"),m=this.layout.get("cutSitesVisible")&&!this.model.get("sequence").isReallyBig()?this.model.get("sequence").get("cutsites").filter((e=>{const t=e.get("position")
return d<u?d<=t&&t<u:d<=t||t<u})):[],p=this.layout.get("annotationsVisible")?l.default.filter(this.circularView.views.annotationsView.renderedData,(e=>!e.get("hasCircularLabel"))):[],h=this.layout.get("translationsVisible")?l.default.filter(this.circularView.views.translationsView.renderedData,(e=>!e.get("hasCircularLabel"))):[],g=this.layout.get("partAnnotationsVisible")?(null!=(e=this.circularView.views.partAnnotationsView.renderedData)?e:[]).filter((e=>!e.get("hasCircularLabel"))):[],E=this.layout.get("primersVisible")?l.default.filter(this.circularView.views.primersView.renderedData,(e=>!e.get("hasCircularLabel"))):[]
this.features=m.concat(p,h,g,E)
const f=this.circularView.getDNAView().layout,S=f.get("outerRadius"),y=f.get("outerRadius")+7,b=this.labelRadius(),angleFn=e=>this.getAngle(e),T=this.layout.get("type"),{circularLayout:v}=this,C={},I=Math.ceil(b/T.height())
function bucketIndex(e){const t=(e=>Math.floor(-Math.sin(-e+Math.PI/2)*b/T.height()))(e)
return e>Math.PI?2*I-t:t}const w=this.basePairToAngle(d),N=this.basePairToAngle(u),A=bucketIndex(w)
let R=bucketIndex(N)
R===A&&R--
for(n=A,t=3*I,a=A<=t;a?n<=t:n>=t;a?n++:n--)C[n]=[]
for(n=-I,s=R,i=-I<=s;i?n<=s:n>=s;i?n++:n--)C[n]=[]
const P=30/Math.pow(I,4)
for(const e of Array.from(this.features)){const t=bucketIndex(angleFn(e))
t in C&&C[t].push(e)}function handleBucket(e){C[e]=l.default.sortBy(C[e],angleFn)
const t=C[e]
if(e<3*I){const n=C[e+1]
t.length>1&&null!=n&&0===n.length&&(C[e+1]=t.splice(1,t.length-1))}if(0===t.length)return delete C[e]}for(const e of["right","left"])if("right"===e){var O,x
for(n=-I,O=-I<=(x=R);O?n<=x:n>=x;O?n++:n--)handleBucket(n)}else{var _,D
for(n=A,_=A<=(D=3*I);_?n<=D:n>=D;_?n++:n--)handleBucket(n)}const L=l.default.chain(C).pairs().map((e=>[parseInt(e[0]),e[1]])).sortBy((e=>e[0])).value(),k=Re().select(this.el).selectAll(".plasmid-label").data(L)
k.exit().remove()
const M=k.enter().append("svg:g").classed("plasmid-label",!0).classed("label-component",!0)
M.append("svg:line").classed("hover-label-line1",!0)
M.append("svg:line").classed("hover-label-line2",!0)
M.append("svg:line").classed("label-line1",!0)
M.append("svg:line").classed("label-line2",!0)
const F=M.append("svg:g").classed("more-group",!0).attr("visibility","hidden")
F.append("svg:rect").classed("more-group-bg",!0).attr("width",0).attr("height",0)
F.append("svg:text").classed("more-group-text",!0).attr("font-size",T.fontSize).attr("letter-spacing",T.letterSpacing)
M.append("svg:text").classed("text-label",!0).attr("font-size",T.fontSize).attr("letter-spacing",T.letterSpacing)
const Z=this.model,{featureColor:B}=this,{textDecoration:q}=this
this.modelToLabelGroup={}
this.modelToRerender={}
const{modelToLabelGroup:V}=this,{modelToRerender:U}=this
function featureRadius(e){switch(e.type()){case"annotation":return v.CircularAnnotationsLayout.get("outerRadius")-v.CircularAnnotationsLayout.get("ringHeight")*(e.get("annularLayer")+.5)
case"translation":return v.CircularTranslationsLayout.get("outerRadius")-v.CircularTranslationsLayout.get("ringHeight")*(e.get("annularLayer")+.5)
case"part":return v.CircularPartAnnotationsLayout.get("outerRadius")-v.CircularPartAnnotationsLayout.get("ringHeight")*(e.get("annularLayer")+.5)
case"primer":return v.CircularPrimersLayout.get("innerRadius")+v.CircularPrimersLayout.get("ringHeight")*(e.get("annularLayer")+.5)
default:return S}}const bindStopPropagation=(e,t)=>function(n){Re().event.stopPropagation()
return e.call(t,n)}
var labelEach=e=>function(n,a){let i
const s=Re().select(this).select(".text-label"),d=Re().select(this).select(".hover-label-line1").attr("stroke","none"),u=Re().select(this).select(".hover-label-line2").attr("stroke","none"),m=Re().select(this).select(".label-line1").attr("visibility","visible"),p=Re().select(this).select(".label-line2").attr("visibility","visible"),h=Re().select(this).select(".more-group"),g=h.select(".more-group-text"),E=h.select(".more-group-bg")
let f=angleFn(n[1][0])
const v=n[0]<I,C=function lineFromBucket(e){return e<I?e:2*I-e}(n[0]),w=C*T.height(),N=Math.min(b,Math.abs(w))
var A
const R={x:(Math.sqrt(b*b-N*N)+(A=C,P*Math.pow(A,4)))*(v?1:-1),y:w},O=Os.polar(y,f),x=(Os.polar(featureRadius(n[1][0]),f),Os.polar(S,f)),_=Math.sqrt(R.x*R.x+(R.y-T.height()/4)*(R.y-T.height()/4)),D=_-5,L={x:R.x*D/_,y:(R.y-T.height()/4)*D/_},k=T.width(l.default.max(n[1].map((e=>getNucleotideAwareDisplayName(e).length)))+1)
function getLeftRight(){let e,t
const n=c.model.get("width")/2-20,a=Math.max(50,k)
let i=0
if(v){({x:t}=R)
e=n-R.x
i=e
if(e<a){t=n-a
e=a}}else{t=-n
e=R.x+n
i=e
e<a&&(e=a)}return{x:t,width:e,firstWidth:i}}const M=l.default.chain(n[1]).sortBy((e=>e.start())).sortBy((e=>"cutsite"===e.type()&&e.get("enzyme").forceVisible()?-1:1)).sortBy((e=>e.selected()?-1:1)).sortBy((e=>{switch(e.type()){case"annotation":return-5
case"translation":return-4
case"part":return-3
case"primer":return-2
case"cutsite":return-1
default:return 0}})).value()
let F=getLeftRight(),G=v?F.x+F.width-R.x:R.x-F.x,z=0,$=0,W=0
function moreSize(e){const t=M.length-e
return t>0?T.width(1+String(t).length):0}$=-1
for(;$+1<M.length;){i=T.width(getNucleotideAwareDisplayName(M[++$]).length+1)
W+=i
if(W>G)break}z=$
for(;z>=0&&!(W+moreSize(z+1)<G);){W-=T.width(getNucleotideAwareDisplayName(M[z]).length+1)
z--}z+=1
for(const e of Array.from(M)){V[e.uid()]=this
U[e.uid()]=labelEach}const H=M.slice(0,z),j=M.slice(z)
window.snapshot&&0===H.length&&o()(this).hide()
h.attr("visibility",e&&j.length>0?"visible":"hidden")
s.select(".more-label").remove()
const Y=s.selectAll(".indiv-label").data(H)
Y.exit().remove()
const Q=Y.enter().append("svg:tspan").classed("indiv-label",!0).attr("font-size",T.fontSize).attr("letter-spacing",T.letterSpacing)
Q.append("svg:tspan").classed("just-label",!0)
Q.append("svg:tspan").classed("comma",!0)
function mouseoutHandler(e,t){null==t&&(t=!0)
d.attr("stroke","none")
u.attr("stroke","none")
m.attr("visibility","visible")
p.attr("visibility","visible")
if(t)return ma.gW({mapId:Z.cid},this,(()=>e.set({hover:!1})))}function mouseoverHandler(e,n){null==n&&(n=!0)
const a=e.start()
t=e.end()
t<=a&&(t+=r)
f=angleFn(e)
const i=Os.polar(y,f),s=featureRadius(e),o=Os.polar(s,f)
d.attr("x1",L.x).attr("y1",L.y).attr("x2",i.x).attr("y2",i.y).attr("stroke-width",1.5).attr("stroke","black")
u.attr("x1",i.x).attr("y1",i.y).attr("x2",o.x).attr("y2",o.y).attr("stroke-width",1.5).attr("stroke"," black")
m.attr("visibility","hidden")
p.attr("visibility","hidden")
if(n)return ma.gW({mapId:Z.cid},this,(()=>e.set({hover:!0})))}function lazyExpand(){let e,t
F=getLeftRight()
const{x:n}=F;({width:G}=F)
g.attr("text-anchor",v?"start":"end")
const a=g.selectAll(".indiv-label").data(j)
a.exit().remove()
const s=a.enter().append("svg:tspan").classed("indiv-label",!0).attr("font-size",T.fontSize).attr("letter-spacing",T.letterSpacing)
s.append("svg:tspan").classed("just-label",!0)
s.append("svg:tspan").classed("comma",!0)
let r=2,o=0
a.each((function(e,t){Re().select(this).select(".comma").text(t<j.length-1?",":"")
return Re().select(this).select(".just-label").text(getNucleotideAwareDisplayName(e)).attr("text-decoration",q)})).attr("id",c.labelId).attr("fill",B).on("mousedown",bindStopPropagation(c.pieceClickHandler,c)).on("dblclick",bindStopPropagation(c.pieceDblClickHandler,c)).on("contextmenu",bindStopPropagation(c.pieceContextHandler,c)).on("mouseover",mouseoverHandler).on("mouseout",mouseoutHandler).classed("selected-label",(e=>e.selected()||e.hover()))
a.each((function(e,t){i=T.width(getNucleotideAwareDisplayName(e).length+1)
if(o+i<G||0===o){o+=i
return 0===t?Re().select(this).attr("dy",null).attr("x",v?n:n+G):Re().select(this).attr("dy",null).attr("x",null)}o=i
r+=1
return Re().select(this).attr("dy",T.height()).attr("x",v?n:n+G)}))
let l=R.y-T.height()
const d=r*T.height()
let u=l+2*T.height()
if(l+d>c.model.get("height")/2){l-=d-T.height()
u=l+T.height()}if(R.x<n){t=-c.model.get("width")/2
e=G+(n-t)+5}else{t=n-5
e=G+10}E.attr("fill","white").attr("fill-opacity",1).attr("stroke-width",2).attr("stroke","black").attr("x",t).attr("y",l-5).attr("width",e).attr("height",d+10).on("mousedown",(()=>Re().event.stopPropagation())).on("dblclick",(()=>Re().event.stopPropagation()))
g.attr("x",n)
return g.attr("y",u)}if(j.length>0&&!window.snapshot){s.append("svg:tspan").classed("more-label",!0).text(`+${j.length}`)
Re().select(this).on("mouseenter",(function(e){o()(this).find("~ .plasmid-label").insertBefore(this)
lazyExpand()
s.attr("x",v?F.x:F.x+F.width)
return h.attr("visibility","visible")})).on("mouseleave",(function(e){if("backdrop"!==LabelsView_guard_(null!=Re().event?Re().event.toElement:void 0,(e=>e.className))){h.attr("visibility","hidden")
s.attr("x",R.x)
return Re().select(this).each(labelEach(!1))}c.listenToOnce(ta.e,"close",(()=>{h.attr("visibility","hidden")
s.attr("x",R.x)
return Re().select(this).each(labelEach(!1))}))}))}else Re().select(this).on("mouseenter",null).on("mouseleave",null)
Y.each((function(e,t){Re().select(this).select(".comma").text(t<H.length-1||j.length>0&&!window.snapshot?",":"").attr("dx",-2)
return Re().select(this).select(".just-label").text(getNucleotideAwareDisplayName(e)).attr("text-decoration",q)})).attr("id",c.labelId).attr("fill",B).on("mousedown",bindStopPropagation(c.pieceClickHandler,c)).on("dblclick",bindStopPropagation(c.pieceDblClickHandler,c)).on("contextmenu",bindStopPropagation(c.pieceContextHandler,c)).on("mouseover",mouseoverHandler).on("mouseout",mouseoutHandler).classed("selected-label",(e=>e.selected()))
s.attr("text-anchor",(()=>n[0]<I?"start":"end")).attr("x",R.x).attr("y",R.y)
m.attr("x1",L.x).attr("y1",L.y).attr("x2",O.x).attr("y2",O.y).attr("stroke-width",1)
p.attr("x1",O.x).attr("y1",O.y).attr("x2",x.x).attr("y2",x.y).attr("stroke-width",1)
return e?lazyExpand():g.selectAll(".indiv-label").attr("id",null)}
return k.each(labelEach(!1))}}LabelsView.initClass()
const Ms=LabelsView
function LabelsView_guard_(e,t){return null!=e?t(e):void 0}class CircularORFsView extends SegmentsRingView{static initClass(){this.prototype.className="orfs"
this.prototype.singularClassName="orf"
this.prototype.tagName="g"}contextMenuData(){return getSelectionMenu()}fill(e){return e.get("hover")||e.selected()?Re().rgb(e.color()).darker().toString():e.color()}opacity(e){return 1}strokeWidth(e){return 1}stroke(e){return e.color()}handleHover(e,t,n){const a=e.uid(),i=Re().select(this.el).selectAll(".individual-ring").filter(`[id='${a}']`)
i.select(".line").transition().duration(25).attr("fill-opacity",this.opacity).attr("fill","none")
return i.selectAll(".start-position").transition().duration(25).attr("fill-opacity",this.opacity).attr("fill",this.fill)}handleDraw(e,t){let n,a
const i=this.model.get("sequence"),s=e.selectAll(".line"),setArcValues=(e,t,n)=>e.innerRadius(t.innerRadius).outerRadius(t.outerRadius).startAngle(n.startAngle).endAngle(n.endAngle)
s.data([t])
s.attr("d",(r=this,function(e){const t=Ns.Z.linearArc(),n=e.get("annularLayer"),a=r.getAngles(e.start(),e.end()),i=r.lineBounds(n)
t.radius(i).startAngle(a.startAngle).endAngle(a.endAngle).reverse(!1)
return t()}))
var r
e.selectAll(".hidden-background").attr("d",(e=>function(t){const n=t.get("annularLayer"),a=e.getAngles(t.start(),t.end()),i=e.arc(t),s=e.backgroundBounds(n)
setArcValues(i,s,a)
return i(t)})(this))
const o=t.startPositions(),l=(null!=t.endPosition()&&t.endPosition(),(()=>{const e=[]
for(a=0;a<o.length;a++)e.push(t)
return e})()),c=e.selectAll("path.start-position").data(l)
c.enter().append("svg:path").classed("start-position",!0).classed("layer-fill",!0).attr("fill",this.fill).attr("fill-opacity",this.opacity).attr("shape-rendering","geometricPrecision").attr("stroke-width",this.strokeWidth).attr("stroke","green")
2*Math.PI*(3/i.length())*this.layout.get("innerRadius")>3?c.attr("d",(e=>function(t,a){let s
const r=t.get("annularLayer")
if(1===t.strand()){s=o[a]
n=T.mod(s+3,i.length())}else{n=(o[a]+1)%i.length()
s=T.mod(n-3,i.length())}const l=e.getAngles(s,n),c=(0,ws.aE)(t.strand()),d=e.layerBounds(r)
setArcValues(c,d,l)
return c(t)})(this)):c.attr("d",(e=>function(t,n){const a=t.get("annularLayer")
let s=o[n];-1===t.strand()&&(s=(s+1)%i.length())
const r=e.getAngles(s,s+.1),l=Ns.Z.arc(),c=e.layerBounds(a)
setArcValues(l,c,r)
return l(t)})(this))
c.exit().remove()
return this.registerPieceHandlers(e)}pieceClickHandler(e){const t=this.circularView.getHoverBase(!1)
return ma.gW({isLinear:this.isLinear,mapId:this.model.cid,index:t},this,(function(){return this.clickAction(e)}))}pieceDblClickHandler(e){const t=this.circularView.getHoverBase(!1)
return ma.gW({isLinear:this.isLinear,mapId:this.model.cid,index:t},this,(function(){return this.dblClickAction(e)}))}enterRing(e){const t=e.append("svg:g").classed("ring-shape",!0)
t.append("svg:path").classed("line",!0).classed(this.singularClassName,!0).attr("stroke-width",this.strokeWidth).attr("stroke",this.stroke).attr("shape-rendering","geometricPrecision").attr("fill","none").attr("fill-opacity",this.opacity)
return t.append("svg:path").classed("hidden-background",!0).attr("fill-opacity",0)}data(){const e=this.model.get("sequence"),t=e.length(),n=this.tabstate.get("visibilityOptions").getOption("orfs"),a={minLength:n.getSetting("minimum-orf-length").get("value"),frame:n.getSetting("orf-frame").get("value"),sequence:e,startCodon:n.getSetting("orf-start-codon").get("value")}
return e.get("orfs").slice(0,t,a)}registerListeners(){super.registerListeners()
const e=this.model.get("sequence").get("orfs")
this.listenTo(e,"change:hover change:selected",this.handleHover)
return this.listenTo(e,"click",this.pieceClickHandler)}setConstraints(e){return this.setOuterRadius(e)}clickAction(e){return e.click(this.model.get("sequence"),!1)}dblClickAction(e){return e.dblClick(this.model.get("sequence"),!1)}redraw(){this.invalidateData()
return super.redraw()}redrawPlasmid(){return!0}storeBounds(e){null==e&&({rings:e}=this)
this.rings=e
const t=this.getOuterRadius()-this.layout.get("ringHeight")*this.rings
this.layout.set("innerRadius",t)
return this.updateRadius()}zeroBounds(){this.layout.set("innerRadius",this.layout.get("outerRadius"))
return this.updateRadius()}lineBounds(e){const t=this.layerBounds(e)
return(t.innerRadius+t.outerRadius)/2}backgroundBounds(e){return{innerRadius:this.radiusIn(e+1),outerRadius:this.radiusIn(e+.1)}}layerBounds(e){return{innerRadius:this.radiusIn(e+1),outerRadius:this.radiusIn(e)-this.layout.vMargin()}}baseLine(e,t=null){return null!=t?super.baseLine(e,t):this.radiusIn(e+1)}}CircularORFsView.initClass()
const Fs=CircularORFsView
class PartsView_PartsView extends Rs{static initClass(){this.prototype.className="parts-label"
this.prototype.singularClassName="part-label"
this.prototype.tagName="g"
this.prototype.contextMenuData=null}shouldCaptureLeftClick(){return!1}shouldCaptureDoubleClick(){return!0}contextMenuOptions(e){return{tabstate:this.tabstate}}arc(e){return Ns.Z.arc()}data(){const e=this.model.get("leftBP"),t=this.model.get("rightBP"),n=this.model.get("sequence")
return function makeViewParts(e){return e.map((e=>new ViewPart(e)))}(splitPartsIntoHighlightRegions(n.parts().getSequencePartsBetween(e,t),n))}stroke(e){return wi}fill(e){return e.color()}baseLine(e){return this.radius(e+1)}opacity(e){return e.get("isOverlap")?1:.4}registerListeners(){super.registerListeners()
this.listenTo(this.model.get("sequence").get("_sequence"),"change:bases",(()=>{this.invalidateData()}))}updateRadius(){this.radius.range([this.getInnerRadius()-5,this.layout.get("DNA").get("outerRadius")+5])}updateLayers(e){l.default.each(e,(e=>e.set({annularLayer:0})))
this.layout.set("outerRadius",this.getInnerRadius())}handleText(e){dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS||super.handleText(e)}clickAction(e){}dblClickAction(e){this.model.get("sequence").handleDoubleClick(0,this.model.get("sequence").length())}}PartsView_PartsView.initClass()
const Zs=PartsView_PartsView
class CircularPrimersView extends Rs{static initClass(){this.prototype.className="primers"
this.prototype.singularClassName="primer"
this.prototype.tagName="g"}initialize(){this.fill=this.fill.bind(this)
super.initialize(...arguments)}contextMenuData(){return oa}contextMenuOptions(e){return{primer:e}}arc(e){switch(e.strand()){case 1:return Ns.Z.forwardArrowArc()
case 0:return Ns.Z.arc()
case-1:return Ns.Z.backwardArrowArc()}}fill(e){return`url(#stripe-${this.cid}-${e.uid()})`}data(){const e=this.model.get("sequence")
return e.sequencePrimers().slice(0,e.length())}registerListeners(){super.registerListeners()
const e=this.model.get("sequence").sequencePrimers()
this.listenTo(e,"layerChange",(function(){this.invalidateData()
return this.triggerRedraw()}))
return this.listenTo(e,"change:hover change:selected",this.handleHover)}clickAction(e){return e.click(this.model.get("sequence"),Re().event.shiftKey)}dblClickAction(e){return e.dblClick(this.model.get("sequence"),Re().event.shiftKey)}setConstraints(e){return this.setOuterRadius(e)}redrawPlasmid(){return!0}storeBounds(e){null==e&&({rings:e}=this)
this.rings=e
const t=this.getOuterRadius()-this.layout.get("ringHeight")*this.rings
this.layout.set("innerRadius",t)
return this.updateRadius()}zeroBounds(){this.layout.set("innerRadius",this.layout.get("outerRadius"))
return this.updateRadius()}layerBounds(e){return{innerRadius:this.radiusIn(e+1),outerRadius:this.radiusIn(e)-this.layout.vMargin()}}baseLine(e){return this.radiusIn(e+2/3+1/6)}eachRing(e){super.eachRing(e)
e.attr("data-test-component","circularPrimersView")
e.attr("data-test-element","primerRoot")
e.attr("stroke-dasharray",(e=>e.get("_primer").isNew()?"5,5":"1,0"))
e.select("defs").select("pattern").attr("id",(e=>`stripe-${this.cid}-${e.uid()}`))
return e.select("defs").select("pattern").select("rect").attr("fill",(e=>e.color()))}enterRing(e){super.enterRing(e)
const t=e.append("svg:defs").append("svg:pattern").attr("patternUnits","userSpaceOnUse").attr("width",14).attr("height",14)
t.append("svg:rect").attr("width",14).attr("height",14).attr("fill",(e=>e.color()))
t.append("svg:path").attr("fill","black").attr("fill-opacity","0.15").attr("d","M5.232,17.089l-3.536-3.535L16.268-1.018l3.536,3.536L5.232,17.089z")
return t.append("svg:path").attr("fill","black").attr("fill-opacity","0.15").attr("d","M-1.839,10.018l-3.535-3.536L9.197-8.089l3.536,3.535L-1.839,10.018z")}cutoffRadius(){return this.model.get("primerCutoffRadius")}stroke(e){return e.outlineColor(this.model.get("sequence"))}}CircularPrimersView.initClass()
const Bs=CircularPrimersView
class SearchResultsView_SearchResultsView extends SegmentsRingView{constructor(){super(...arguments)
this.singularClassName="dnaSearch"}static initClass(){this.prototype.className="dnaSearches"
this.prototype.singularClassName="dnaSearch"
this.prototype.tagName="g"}contextMenuData(){return getSelectionMenu()}fill(e){return e.get("selected")?"orange":"yellow"}opacity(e){return.4}strokeWidth(e){return 1}stroke(e){return"black"}data(){const e=this.model.get("sequence"),t=e.length()
return $a.C.get().get("results").slice(0,t,e,$a.C.get().get("onlyShowSelected"))}updateRadius(){return this.radius.range([this.getInnerRadius()-5,this.layout.get("DNA").get("outerRadius")+5])}updateLayers(e){l.default.each(e,(e=>e.set({annularLayer:0})))
this.layout.set("outerRadius",this.getInnerRadius())}registerListeners(){super.registerListeners()
const e=$a.C.get().get("results")
this.listenTo(e,"change:selected",((e,t,n)=>{$a.C.get().get("onlyShowSelected")?this.update():this.handleHover(e,t,n)}))
return this.listenTo(e,"reset",(()=>{this.updateData()
this.update()}))}clickAction(e){e.click(this.model.get("sequence"),!1)}dblClickAction(e){e.dblClick(this.model.get("sequence"),!1)}redraw(){this.invalidateData()
super.redraw()}}SearchResultsView_SearchResultsView.initClass()
const qs=SearchResultsView_SearchResultsView
class CircularSequencePartAnnotationsView extends Rs{static initClass(){this.prototype.className="part-annotations"
this.prototype.singularClassName="part-annotation"
this.prototype.tagName="g"
this.prototype.contextMenuData=null}contextMenuOptions(e){return{tabstate:this.tabstate}}arc(e){return Ns.Z.arc()}fill(e){const t=!e.isInSync(this.model.polymer()._sequence()),n=e.sequence().isArchived()
return t?Ii:n?Ci:vi}fontColor(e){return e.sequence().isArchived()?Vt.Rl:Vt.Cj}opacity(e){return e.sequence().isArchived()?.5:super.opacity(e)}data(){return dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS?this.model.get("sequence").parts().getSequencePartsBetween(this.model.get("leftBP"),this.model.get("rightBP")):[]}clickAction(e){e.click(this.model.polymer(),Re().event.shiftKey)}dblClickAction(e){e.dblClick(this.model.polymer(),Re().event.shiftKey)}registerListeners(){super.registerListeners()
this.listenTo(this.model.get("sequence").get("_sequence"),"change:bases",(()=>{this.invalidateData()}))}setConstraints(e){this.setOuterRadius(e)}redrawPlasmid(){return!0}storeBounds(e){null==e&&({rings:e}=this)
this.rings=e
const t=this.getOuterRadius()-this.layout.get("ringHeight")*this.rings
this.layout.set("innerRadius",t)
this.updateRadius()}zeroBounds(){this.layout.set("innerRadius",this.layout.get("outerRadius"))
this.updateRadius()}layerBounds(e){return{innerRadius:this.radiusIn(e+1),outerRadius:this.radiusIn(e)-this.layout.vMargin()}}baseLine(e){return this.radiusIn(e+1)}}CircularSequencePartAnnotationsView.initClass()
const Vs=CircularSequencePartAnnotationsView
class CircularTranslationsView extends Rs{static initClass(){this.prototype.className="translations"
this.prototype.singularClassName="translation"
this.prototype.tagName="g"}contextMenuData(){return da}contextMenuOptions(e){return{translation:e.get("translationComponentModel")}}arc(e){return(0,ws.aE)(e.strand())}data(){const e=this.model.get("sequence"),{numTotal:t,numVisible:n,numShown:a,shownTranslations:i}=(0,ys.A)(e,this.model.get("leftBP"),this.model.get("rightBP"))
this.model.set({totalTranslations:t,visibleTranslations:n,shownTranslations:a})
return i}hideHandler(){this.layout.get("visible")||this.model.set({visibleTranslations:0,shownTranslations:0})}clickAction(e){e.click(this.model.get("sequence"),Re().event.shiftKey)}dblClickAction(e){e.dblClick(this.model.get("sequence"),Re().event.shiftKey)}registerListeners(){super.registerListeners()
const e=this.model.get("sequence").translations()
this.listenTo(e,"change layerChange",(()=>{this.invalidateData()
this.triggerRedraw()}))
this.listenTo(e,"change:hover change:selected",this.handleHover.bind(this))}setConstraints(e){this.setOuterRadius(e)}redrawPlasmid(){return!0}storeBounds(e){null==e&&({rings:e}=this)
this.rings=e
const t=this.getOuterRadius()-this.layout.get("ringHeight")*this.rings
this.layout.set("innerRadius",t)
this.updateRadius()}zeroBounds(){this.layout.set("innerRadius",this.layout.get("outerRadius"))
this.updateRadius()}layerBounds(e){return{innerRadius:this.radiusIn(e+1),outerRadius:this.radiusIn(e)-this.layout.vMargin()}}baseLine(e){return this.radiusIn(e+1)}}CircularTranslationsView.initClass()
const Us=CircularTranslationsView
class CircularMapView extends s().View{static initClass(){this.prototype.className="circular-map-wrapper"}initialize(e){var t
this.mapstate=this.model
this.tabstate=e.tabstate
this.layout=this.mapstate.get("layout")
this.renderSelection=null===(t=e.renderSelection)||void 0===t||t
const n=this.mapstate.get("DNAOffset"),a=this.mapstate.get("sequence").length()
this.angle=Re().scale.linear().range([0,2*Math.PI]).domain([n,n+a])
this.annotationsView=new Ps({circularView:this,circularLayout:this.layout,layout:this.layout.CircularAnnotationsLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate})
const i={circularView:this,layout:this.layout.CircularTranslationsLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.translationsView=new Us(i)
this.primersView=new Bs({circularView:this,circularLayout:this.layout,layout:this.layout.CircularPrimersLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate})
this.labelsView=new Ms({circularView:this,circularLayout:this.layout,layout:this.layout.LabelLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate})
const s={circularView:this,layout:this.layout.AxisLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.axisView=new xs(s)
const r={circularView:this,layout:this.layout.HomologyAxisLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.homologyAxisView=new HomologyRegionAxisView_HomologyRegionAxisView(r)
const o={circularView:this,layout:this.layout.DNALayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.dnaView=new CircularDNAView(o)
const l={circularView:this,circularLayout:this.layout,layout:this.layout.HomologyDNALayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.homologyDNAView=new HomologyRegionDNAView(l)
const c={circularView:this,layout:this.layout.SearchLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.searchView=new qs(c)
this.orfsView=new Fs({circularView:this,circularLayout:this.layout,layout:this.layout.CircularORFsLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate})
const d={circularView:this,layout:this.layout.PartsLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.partsView=new Zs(d)
const u={circularView:this,layout:this.layout.CircularPartAnnotationsLayout,angle:this.angle,model:this.mapstate,tabstate:this.tabstate}
this.partAnnotationsView=new Vs(u)
this.views={annotationsView:this.annotationsView,translationsView:this.translationsView,primersView:this.primersView,labelsView:this.labelsView,axisView:this.axisView,homologyAxisView:this.homologyAxisView,dnaView:this.dnaView,homologyDNAView:this.homologyDNAView,searchView:this.searchView,orfsView:this.orfsView,partsView:this.partsView,partAnnotationsView:this.partAnnotationsView}
this.zStackBeforeSelection=[this.partsView,this.dnaView,this.homologyDNAView,this.axisView,this.homologyAxisView]
this.zStackAfterSelection=[this.searchView,this.partAnnotationsView,this.orfsView,this.annotationsView,this.translationsView,this.primersView,this.labelsView]
this.orderedInnerRingViews=[this.partAnnotationsView,this.orfsView,this.primersView,this.translationsView,this.annotationsView]
this.isNearFull=!1
this.isActiveSelection=!1
this.type=new bn.Z(15)
this.maxLayer=0}handleResize(){(0,It.D)((()=>{this.reposition()?this.update(!1,!1):this.updateLabel()}),5)()}getSVGNode(){return this.$el.children("svg")[0]}recalculateZooms(){this.computeMinZoom(!0)
this.computeMaxZoom(!0)
this.zoomToFit()}render(){let e
super.render()
this.registerListeners()
const t=Re().select(this.el).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").classed("circular-map",!0).append("svg:g").classed("container",!0)
this.renderSelection&&this.makeSelection()
const n=t.append("svg:text").classed("description",!0).attr("text-anchor","middle")
n.append("svg:tspan").classed("title-desc",!0).attr("font-weight",900).attr("font-size",20)
n.append("svg:tspan").classed("length-desc",!0).attr("font-size",14).attr("x",0).attr("dy",20)
for(const n of this.zStackBeforeSelection){e=t.append("g").classed(n.className,!0)
n.setElement(e.node())
n.render()}this.renderSelection&&this.makeFrontSelection()
for(const n of this.zStackAfterSelection){e=t.append("g").classed(n.className,!0)
n.setElement(e.node())
n.render()}if(this.mapstate.get("isDefault")){this.recalculateZooms()
this.mapstate.set("isDefault",!1)}this.update()
this.labelsView.fastUpdate()
return this}zoomToFit(){const e=this.mapstate.get("width"),t=this.mapstate.get("height"),n=.5*Math.min(e,t)-100
this.mapstate.setZoom(this.mapstate.radiusToZoom(n))}die(){this.stopListening()
Re().select(window).on(".circular",null)
Re().select(this.el).on(".circular",null)
Re().select(this.el).select("svg").select("g").selectAll(".select-handle").on(".circular",null)
Object.values(this.views).forEach((e=>{e.die()}))}remove(){this.die()
super.remove()
return this}getAngles(e,t){return(0,As.MV)(e,t,this.mapstate.get("sequence").length(),this.angle)}getHoverBase(e=!0){let t
const n=this.mapstate.get("sequence").length(),[a,i]=Re().mouse(Re().select(this.el).select(".container").node()),s=(-(Math.atan2(-i,a)-Math.PI/2)+2*Math.PI)%(2*Math.PI)
if(0===n)t=0
else{t=e?Math.round(this.angle.invert(s))%n:Math.floor(this.angle.invert(s))%n
t<0&&(t+=n)}return Math.max(0,Math.min(n,t))}goToBase(e,t){if(!this.mapstate.get("fullCircleView")&&ma.U2("mapId")!==this.mapstate.cid){const a=this.mapstate.get("DNAOffset"),i=e-this.mapstate.get("sequence").length(),s=e+this.mapstate.get("sequence").length(),r=l.default.min([e,i,s],(e=>Math.abs(a-e))),[c,d]=[this.mapstate.get("leftBP"),this.mapstate.get("rightBP")]
if(null!=t){if(T.isRangeWithin(e,t,c,d))return}else if(!T.baseInRange(e,c,d))return
o()({base:a}).animate({base:r},{duration:Math.min(1e3,10*Math.abs(r-this.mapstate.get("DNAOffset"))),step:(n=this.mapstate,function(){n.set("DNAOffset",this.base)})})}var n}updateAngle(){if(this.mapstate.get("fullCircleView"))this.updateSameRadius()
else{this.partAnnotationsView.invalidateData()
this.annotationsView.invalidateData()
this.translationsView.invalidateData()
this.update(!1,!1)}}updateAngleDomain(){const e=this.mapstate.get("DNAOffset"),t=this.mapstate.get("sequence").length()
return this.angle.domain([e,e+t])}updateLength(){if(this.mapstate.get("sequence").length()<2){this.mapstate.setOffset(0)
this.zoomToFit()}else{this.computeMinZoom(!0)
this.computeMaxZoom(!1)}this.updateLabel()
this.update(!0,!1)}updateSameRadius(){this.mapstate.get("fullCircleView")||this.reposition()
Object.values(this.views).forEach((e=>{e.update()}))
this.updateLabel()
this.showSelection()}getVisibleAxisView(){return this.axisView.layout.get("visible")?this.axisView:this.homologyAxisView.layout.get("visible")?this.homologyAxisView:null}getDNAView(){return this.dnaView.layout.get("visible")?this.dnaView:this.homologyDNAView}update(e,t=!0){t&&this.computeMinZoom()
this.reposition()
const n=this.mapstate.getRadius()
this.getDNAView().setOuterRadius(n)
const a=this.getVisibleAxisView(),i=this.getDNAView().getInnerRadius()
this.axisView.setOuterRadius(i)
this.homologyAxisView.setOuterRadius(i)
const s=(null!=a?a.getInnerRadius():i)-this.getDNAView().layout.vMargin()-this.layout.CircularPrimersLayout.vMargin()
this.searchView.setInnerRadius(this.getDNAView().getInnerRadius())
this.partsView.setInnerRadius(this.getDNAView().getInnerRadius())
for(const[e,t]of this.orderedInnerRingViews.entries()){const n=0===e?s:this.orderedInnerRingViews[e-1].getInnerRadius()
t.setConstraints(n)}this.labelsView.setInnerRadius(n,e)
this.updateLabel()
this.renderSelection&&this.showSelection()}reposition(){const e=this.mapstate.getRadius(),t=this.mapstate.get("width"),n=this.mapstate.get("height"),a=Math.min(t,n)/2,getRenderData=()=>[this.mapstate.get("fullCircleView"),this.mapstate.get("leftBP"),this.mapstate.get("rightBP")],i=getRenderData()
a<e?this.mapstate.set("fullCircleView",!1):this.mapstate.set("fullCircleView",!0)
const s=this.mapstate.get("sequence").length(),r=Re().select(this.el).select("svg"),o=r.select("g")
r.attr("height",n)
r.attr("width",t)
if(this.mapstate.get("fullCircleView")){this.mapstate.set("cx",t/2)
this.mapstate.set("cy",n/2)
o.attr("transform",`translate(${t/2},${n/2})`)
this.mapstate.set("leftBP",0)
this.mapstate.set("rightBP",s)}else{this.mapstate.set("cx",t/2)
this.mapstate.set("cy",n/2+e)
const a=Math.min(t/2,e),i=-Math.sqrt(e*e-a*a)
let[r,l]=[-t/2,i],c=(-(Math.atan2(-l,r)-Math.PI/2)+2*Math.PI)%(2*Math.PI)
const d=(Math.round(this.angle.invert(c))%s+s)%s;[r,l]=[t/2,i]
c=(-(Math.atan2(-l,r)-Math.PI/2)+2*Math.PI)%(2*Math.PI)
const u=(Math.round(this.angle.invert(c))%s+s)%s
this.mapstate.set("leftBP",d)
this.mapstate.set("rightBP",u)
o.attr("transform",`translate(${t/2},${n/2+e})`)}const l=getRenderData()
return!Is()(i,l)}computeMaxZoom(e=!1){let t=16*this.mapstate.get("sequence").length()/(2*Math.PI)
t=Math.min(1e4,t)
return this.mapstate.setMaxRadius(t,e)}computeMinZoom(e=!1){const t=(()=>{const e=this.mapstate.get("minInnerRadius"),t=this.orderedInnerRingViews.indexOf(this.primersView),n=this.orderedInnerRingViews.map((e=>e.computeMinRings())),a=n.reduce(((e,t)=>e+t)),i=n.slice(t+1).reduce(((e,t)=>e+t)),s=this.layout.CircularAnnotationsLayout.get("minRingHeight"),r=e+a*s
this.mapstate.set("primerCutoffRadius",e+i*s)
return this.getDNAView().computeOuterRadius(r)+this.getDNAView().layout.vMargin()+this.layout.CircularPrimersLayout.vMargin()})()
return this.mapstate.setMinRadius(t,e)}changeBases(){this.invalidateLabels()
this.partsView.invalidateData()
this.computeMaxZoom()
this.updateAngleDomain()
this.updateLength()}registerListeners(){this.listenTo(this.mapstate,"change:fullCircleView",(()=>{this.invalidateLabels()}))
this.listenTo(this.mapstate,"change:DNAOffset",(()=>{this.updateAngleDomain()
this.updateAngle()}))
this.listenTo(this.mapstate.get("sequence").get("_sequence"),"change:bases",(()=>{this.changeBases()}))
this.listenTo(this.mapstate.get("sequence").get("_sequence"),"change:parts",(()=>{this.changeBases()}))
this.listenTo(this.mapstate.get("sequence"),"jump",((e,t)=>{this.goToBase(e,t)}))
Object.values(this.views).forEach((e=>{e.registerListeners()}))
this.listenTo(this.mapstate,"redraw",(()=>{this.update(!0)}))
this.listenTo(this.mapstate,"change:zoom",(()=>{var e
this.mapstate.get("fullCircleView")?this.invalidateLayers():this.invalidateLabels()
const t=this.mapstate.get("sequence").get("selection")
let[n,a]=[this.mapstate.get("leftBP"),this.mapstate.get("rightBP")]
const[i,s]=[t.start(),null!==(e=t.end())&&void 0!==e?e:t.start()],r=T.isRangeOverlap(i,s,n,a)
this.update(!1,!1);[n,a]=[this.mapstate.get("leftBP"),this.mapstate.get("rightBP")]
if(!this.mapstate.get("fullCircleView")&&r){let e
const t=i-n
e=T.baseInRange(i,n,a)?T.baseInRange(s,n,a)?0:T.baseInRange(i,n+(s-a),s)?s-a:t:t
this.mapstate.setOffset(this.mapstate.get("DNAOffset")+e)}}))
this.listenTo(this.mapstate,"invalidateLayers",(()=>{this.invalidateLayers()}))
this.listenTo(this.mapstate.get("sequence").get("_sequence"),"change:name",(()=>{this.updateLabel()}))
this.renderSelection&&this.listenTo(this.mapstate.get("sequence").get("selection"),"change",(()=>{this.showSelection()}))
this.listenTo(this.mapstate,"change:width change:height",(()=>{this.handleResize()}))
Re().select(this.el).on("mousedown.circular",(()=>{this.updateSelection()})).on("mousemove.circular",(()=>{this.updateSelection()})).on("mouseup.circular",(()=>{this.updateSelection()})).on("dblclick.circular",(()=>{this.updateSelection()})).on("contextmenu.circular",(e=>{if(Re().event.altKey&&window.debug)return
const t=this.mapstate.get("sequence").get("selection"),n=this.getHoverBase()
t.reset(n)}))
Re().select(window).on("mouseup.circular",(()=>{this.updateSelection()}))}updateSelection(e){const t=this.getHoverBase(),n=this.mapstate.get("sequence").get("selection")
switch(e=null!=e?e:Re().event.type){case"mousemove":"circular"===n.get("active")&&n.circularExtend(t)
break
case"mousedown":Re().event.preventDefault()
this.$el.closest(".buffer-tab").focus()
if(Re().event.shiftKey){(0,as.K)(this.model.get("sequence"),as.zL.shiftClickDown,n.start(),n.end(),"circular")
n.expand(t,!1)
n.set({active:"circular"})
Re().event.stopPropagation()}else if(3!==Re().event.which&&!Re().event.ctrlKey){n.reset(t)
n.set({active:"circular"})
Re().event.stopPropagation()}break
case"mouseup":if("circular"===n.get("active")&&3!==Re().event.which&&!Re().event.ctrlKey){n.circularExtend(t)
const e=Re().event.shiftKey?as.zL.shiftClickUp:as.zL.clickAndDrag;(0,as.K)(this.model.get("sequence"),e,n.start(),n.end(),"circular")
n.set({active:null})}break
case"dblclick":this.model.get("sequence").handleDoubleClick(t,t);(0,as.K)(this.model.get("sequence"),as.zL.doubleClick,n.start(),n.end(),"circular")
Re().event.stopPropagation()
break
default:throw Error("Unexpected selection update")}}invalidateLabels(){this.partAnnotationsView.invalidateData()
this.annotationsView.invalidateData()
this.translationsView.invalidateData()
this.primersView.invalidateData()}invalidateLayers(){this.partAnnotationsView.invalidateLayers()
this.annotationsView.invalidateLayers()
this.translationsView.invalidateLayers()
this.primersView.invalidateLayers()}makeSelectHandle(e,t){return e.on("mousedown.circular",(e=>{Re().event.stopPropagation()
this.$el.closest(".buffer-tab").focus()
const n=this.mapstate.get("sequence").get("selection")
n.set("active","circular")
return n.setFreeEnd(t)}))}makeFrontSelection(){return Re().select(this.el).select("svg").select("g").append("path").classed("selection-hidden",!0).on("contextmenu",(e=>{const t=getSelectionMenu()
return SelectionContextMenu_open(Re().event,this.mapstate.get("sequence"),t)}))}makeSelection(){const e=Re().select(this.el).select("svg").select("g").append("g").classed("selection-comp",!0)
e.append("path").classed("selection",!0)
e.append("path").classed("select-handle",!0).classed("start-select",!0).classed("selection-line",!0).call(((e,t)=>this.makeSelectHandle(e,t)),"start")
e.append("path").classed("select-handle",!0).classed("end-select",!0).classed("selection-line",!0).call(((e,t)=>this.makeSelectHandle(e,t)),"end")
e.append("polygon").classed("select-handle",!0).classed("start-cursor-triangle",!0).call(((e,t)=>this.makeSelectHandle(e,t)),"start")
e.append("polygon").classed("select-handle",!0).classed("end-cursor-triangle",!0).call(((e,t)=>this.makeSelectHandle(e,t)),"end")
return e.append("path").classed("map-cursor-line",!0).classed("line-blink",!0)}showSelection(){const e=this.mapstate.get("sequence"),t=e.get("selection"),n=Re().select(this.el).select("svg").select("g"),a=t.start(),i=t.end(),s=n.select(".selection-comp"),r=n.select(".selection-hidden")
if(null==a||this.mapstate.get("sequence").length()<1){s.attr("visibility","hidden")
r.attr("visibility","hidden")
return}s.attr("visibility","visible")
r.attr("visibility","visible")
const o=this.getAngles(a,i),l=Math.max(this.mapstate.get("minInnerRadius"),this.views.annotationsView.getInnerRadius()-5),c=this.getDNAView().getOuterRadius()+8
s.selectAll(".selection").classed("can-pcr",t.canPCR()).classed("cant-edit",!e.allowEdits()||!e.isSelectionDeletable()).attr("visibility","inherit").attr("d",(e=>Ns.Z.arc().innerRadius(l).outerRadius(c).startAngle(o.startAngle).endAngle(o.endAngle)(e)))
Re().select(this.el).select("svg").select(".selection-hidden").attr("d",(e=>Ns.Z.arc().innerRadius(l).outerRadius(c).startAngle(o.startAngle).endAngle(o.endAngle)(e)))
const d=Os.angleToDisplayDegrees(o.startAngle),u=Os.angleToDisplayDegrees(o.endAngle),m=this.layout.SelectionLayout.get("triangleWidth"),p=null==i
s.selectAll(".map-cursor-line").attr("d",`M 0 ${-l} L 0 ${-c}`).attr("transform",`rotate(${d})`).classed("hide",!p)
s.selectAll(".end-select").attr("d",`M 0 ${-l} L 0 ${-c}`).attr("transform",`rotate(${u})`).classed("hide",p)
s.selectAll(".start-select").attr("d",`M 0 ${-l} L 0 ${-c}`).attr("transform",`rotate(${d})`).classed("hide",p)
s.selectAll(".start-cursor-triangle").attr("points",`${-m},${-c}, 0,${-c+m} ${m},${-c}`).attr("transform",`rotate(${d})`).classed("hide",p)
s.selectAll(".end-cursor-triangle").attr("points",`${-m},${-c}, 0,${-c+m} ${m},${-c}`).attr("transform",`rotate(${u})`).classed("hide",p)}updateLabel(){const e=Re().select(this.el).select("svg").select("g")
let t=this.mapstate.get("sequence").get("_sequence").displayNames()
const n=this.layout.TitleLayout,a=n.get("minFontSize"),i=n.get("maxFontSize")
let s=bn.Z.fitToWidth(t.length,2*this.views.annotationsView.getInnerRadius())
e.select(".length-desc").text(`${this.mapstate.get("sequence").length()} bp`)
if(s>=a&&this.mapstate.get("fullCircleView")){n.get("type").setFontSize(Math.min(i,s))
e.select(".title-desc").text(t).attr("font-size",n.get("type").fontSize).attr("visibility","visible").attr("y",0)
e.select(".length-desc").attr("font-size",14*n.get("type").fontSize/20).attr("dy",e.select(".title-desc").attr("font-size")).attr("visibility","visible")
return}const r=-this.mapstate.get("cy")+n.get("type").height()+10,o=this.mapstate.get("width")-20
s=bn.Z.fitToWidth(t.length,o)
const l=this.mapstate.get("cy"),c=10*Math.floor((-this.labelsView.labelRadius()-50+l)/10)-l
if(c>r){if(s<a){n.get("type").setFontSize(a)
s=a
t=`${t.slice(0,n.get("type").numChars(o)-3)}...`}n.get("type").setFontSize(Math.min(i,s))
e.select(".length-desc").attr("font-size",Math.max(a,14*n.get("type").fontSize/20)).attr("visibility","visible")
e.select(".title-desc").text(t).attr("font-size",n.get("type").fontSize).attr("visibility","visible").attr("y",c)}else{e.select(".title-desc").attr("visibility","hidden")
e.select(".length-desc").attr("visibility","hidden")}}}CircularMapView.initClass()
var Gs=n(951777)
class PageInfo{constructor(e){this.options=l.default.defaults(e,{landscape:!1,width:850,pageWidth:"8.5in",height:1100,pageHeight:"11in",headerTop:50,headerLeft:25,headerRight:25,footerBottom:25,footerLeft:25,footerRight:25,marginTop:80,marginBottom:50,marginLeft:50,marginRight:50,css:null})
this.marginTop=this.options.marginTop
this.marginBottom=this.options.marginBottom
this.marginLeft=this.options.marginLeft
this.marginRight=this.options.marginRight
this.css=this.options.css
this.headerTop=this.options.headerTop
this.headerLeft=this.options.headerLeft
this.headerRight=this.options.headerRight
this.footerBottom=this.options.footerBottom
this.footerLeft=this.options.footerLeft
this.footerRight=this.options.footerRight
this.landscape=this.options.landscape
this.width=this.landscape?this.options.height:this.options.width
this.height=this.landscape?this.options.width:this.options.height
this.pageWidth=this.landscape?this.options.pageHeight:this.options.pageWidth
this.pageHeight=this.landscape?this.options.pageWidth:this.options.pageHeight}innerWidth(){return this.width-this.marginLeft-this.marginRight}innerHeight(){return this.height-this.marginTop-this.marginBottom}}class Page extends PageInfo{constructor(e){super(e)
this.lowestY=this.marginTop
this.spacer=20
this.bpStart=null
this.bpEnd=null
this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg")
Re().select(this.svg).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").attr("width",this.pageWidth).attr("height",this.pageHeight).attr("viewBox",`0 0 ${this.width} ${this.height}`)
this.header=Re().select(this.svg).append("svg:g").classed("header",!0).attr("transform",`translate(0,${this.headerTop})`)
this.headerRightText=this.header.append("svg:text").classed("right",!0).attr("x",this.width-this.headerRight).attr("text-anchor","end")
this.headerCentreText=this.header.append("svg:text").classed("centre",!0).attr("x",this.width/2).attr("text-anchor","middle")
this.footer=Re().select(this.svg).append("svg:g").classed("footer",!0).attr("transform",`translate(0,${this.height-this.footerBottom})`)
this.footerLeftText=this.footer.append("svg:text").classed("left",!0).attr("x",this.footerLeft).attr("text-anchor","start")
this.footerRightText=this.footer.append("svg:text").classed("right",!0).attr("x",this.width-this.footerRight).attr("text-anchor","end")
if(null!=this.css){const e=this.css.replace(/font-family:.*?;/,'font-family: "Inconsolata";')
Re().select(this.svg).append("svg:defs").append("svg:style").text(e)}}countSlice(e){(null==this.bpStart||e.start<this.bpStart)&&(this.bpStart=e.start);(null==this.bpEnd||e.end>this.bpEnd)&&(this.bpEnd=e.end)}setHeader(e,t){e=(0,Mt.fk)(e,this.landscape?115:70)
this.headerCentreText.text(e)
this.headerRightText.text(t)}setFooter(e,t){e=(0,Mt.fk)(e,this.landscape?160:120)
this.footerLeftText.text(e)
this.footerRightText.text(t)}hasSpace(e){let t=0
e.forEach((e=>{t+=getSVGHeight(e)+this.spacer}))
t-=this.spacer
return this.lowestY+t<this.height-this.marginBottom}addG(e,t){Re().select(e).attr("transform",`translate(${this.marginLeft}, ${this.lowestY})`)
o()(this.svg).append(e)
this.lowestY+=t+this.spacer}addSpacer(){this.lowestY+=this.spacer}addSVG(e){appendSVGToSVG({parentSVG:this.svg,childSVG:e,transform:`translate(${this.marginLeft}, ${this.lowestY})`})
this.lowestY+=getSVGHeight(e)+this.spacer}}class Pagination extends PageInfo{constructor(e){super(e)
this.pages=[]
this.fits=!0
this.newPage()}truncated(){return!this.fits}newPage(){this.page=new Page(this.options)
this.pages.push(this.page)}addTitle(e){e=(0,Mt.fk)(e,this.page.landscape?65:50)
const t=document.createElementNS("http://www.w3.org/2000/svg","g")
Re().select(t).append("text").attr("x",this.innerWidth()/2).attr("text-anchor","middle").attr("font-size",24).text(e)
this.page.addG(t,0)}addLineBreak(){this.page.lowestY=this.page.height}addSVGGroup(e,t=null){if(this.page.hasSpace(e)){e.forEach((e=>{this.page.addSVG(e)}))
null!=t&&this.page.countSlice(t)
this.page.addSpacer()}else if(new Page(this.options).hasSpace(e)&&this.pages.length<Pagination.PAGE_LIMIT){this.newPage()
e.forEach((e=>{this.page.addSVG(e)}))
null!=t&&this.page.countSlice(t)
this.page.addSpacer()}else{e.forEach((e=>{this.addSVG(e,t)}))
this.addLineBreak()}}addSVG(e,t=null){let n=!0
if(!this.page.hasSpace([e]))if(this.pages.length>=Pagination.PAGE_LIMIT){n=!1
this.fits=!1}else this.newPage()
if(n){this.page.addSVG(e)
null!=t&&this.page.countSlice(t)}return n}setHeaders(e,t,n){const a=new Date,i=`${a.toLocaleDateString()} ${a.toLocaleTimeString()}`
this.pages.forEach(((a,s)=>{let r
if(1===this.pages.length)r=""
else{const[i,o]=T.modelRangeToDisplay(a.bpStart,a.bpEnd,t,n)
r=s>0?`${e} `:""
r+=`(from ${i}-${o} bp)`}a.setHeader(r,i)
a.setFooter(window.location.href,`${s+1}/${this.pages.length}`)}))}svgs(){return this.pages.map((e=>e.svg))}toPDF(e){return an.by({url:"/1/api/svgs-to-pdf",type:"POST",contentType:"application/json",data:JSON.stringify({filename:e,svgs:this.pages.map((e=>function _svgToStr(e){return(new XMLSerializer).serializeToString(e).replace(/[\u0000-\u001f]+/g,"")}(e.svg)))})})}}Pagination.PAGE_LIMIT=200
const zs=Pagination
var $s=n(250965)
const Ws=!1
function circularPaginate(e,t,n){const a=t.get("sequence"),i=new zs({css:n}),s=`${a.get("_sequence").displayNames()} (${a.length()} bp)`
i.addTitle(s)
const r=i.innerWidth()
t=new En.JB({width:r,height:r,visibilityOptions:t.get("visibilityOptions"),fullCircleView:!1,sequence:t.get("sequence")})
const o=new CircularMapView({model:t,tabstate:e,renderSelection:!1})
o.render()
o.die()
i.addSVG(Re().select(o.el).select("svg").node(),{start:0,end:a.length()})
i.setHeaders(s,a.length(),a.startIndex())
return i}function minimapPaginate(e,t,n){const a=t.get("sequence"),i=new zs({css:n}),s=`${a.get("_sequence").displayNames()} (${a.length()} bp)`
i.addTitle(s)
const r=i.innerWidth()
t=new En.nX({fontWidthZoom:0,layout:t.get("layout"),visibilityOptions:t.get("visibilityOptions"),sequence:t.get("sequence"),leftBP:0},{inlineLayeringMode:Kt.LINEAR_LAYER_INLINE_PDF})
const[o,l]=[0,a.length()],c=(0,Qt.Z)().clamp(!0).domain([o,l]).range([0,r]),d=(0,Qt.Z)().clamp(!0).domain([0,r]).range([o,l]),u=new Yi.Z({start:o,end:l,leftBP:o,rightBP:l,x:c,xInv:d,width:r,maxWidth:r,visibleWidth:r})
T.setCutsiteData(a,[u],a.length())
Kt.LINEAR_INLINE_LAYERS.includes(t.get("layeringMode"))&&t.setInlineLayers(u)
const m=new SliceView({slice:u,selection:a.selection(),model:t,tabstate:e,mapType:Ts.minimap,y:Kt.MINI_MAP_Y_COMPONENTS.filter((e=>e!==Kt.SliceComponentName.title)),z:Kt.MINI_MAP_Z_COMPONENTS.filter((e=>e!==Kt.SliceComponentName.title)),svgSupportsForeignObject:Ws})
m.render()
m.killSelection()
m.stopListening()
const p=m.el
Re().select(p).classed("mini-map",!0)
fixAxis(p)
i.addSVG(p,u.pick("start","end"))
i.setHeaders(s,a.length(),a.startIndex())
return i}function linearPaginate(e,t,n){const a=t.get("sequence"),i=t.get("layout").DNA.get("type"),s=new zs({css:n}),r=`${a.get("_sequence").displayNames()} (${a.length()} bp)`
s.addTitle(r)
const o=s.innerWidth()
if(a.supportsChemicalMods()){const e=function getModifiedNucleotidesLegendSvgElement(e){var t
const n=document.createElementNS("http://www.w3.org/2000/svg","svg");(0,Me.A9)(d.createElement(Gs.ZP,{sequenceId:e.get("sequence").get("id"),svgOnly:!0}),n)
const a=$s(n).find(".modifiedNucleotidesLegend")[0]
Re().select(n).attr("height",null!==(t=null==a?void 0:a.getAttribute("height"))&&void 0!==t?t:"")
return n}(t)
s.addSVG(e,null)}const l=i.numChars(o),c=[]
for(let e=0;e<a.length();e+=l){const t=Math.min(e+l,a.length()),n=i.width(t-e)+i.letterSpacing,s=(0,Qt.Z)().clamp(!0).domain([e,t]).range([0,n]),r=(0,Qt.Z)().clamp(!0).domain([0,n]).range([e,t])
c.push(new Yi.Z({start:e,end:t,width:n,x:s,xInv:r,maxWidth:o,visibleWidth:o}))}T.setCutsiteData(a,c,l)
for(const n of c){let i=Kt.LINEAR_MAP_Y_COMPONENTS,r=Kt.LINEAR_MAP_Z_COMPONENTS
if(a.isOligo()){i=Kt.OLIGO_MAP_Y_COMPONENTS
r=Kt.OLIGO_MAP_Z_COMPONENTS}else if(a.isRNASequence()){i=Kt.RNA_LINEAR_MAP_Y_COMPONENTS
r=Kt.RNA_LINEAR_MAP_Z_COMPONENTS}const o=new SliceView({slice:n,model:t,selection:a.selection(),tabstate:e,mapType:Ts.linear,y:i,z:r,svgSupportsForeignObject:Ws})
o.render()
o.killSelection()
o.stopListening()
const l=o.el
fixAxis(l)
if(!s.addSVG(l,n.pick("start","end")))break}s.setHeaders(r,a.length(),a.startIndex())
return s}var Hs=n(255161)
function extractMismatchDataFromTabState(e){const t=e.getMapStateForMasterSequence().get("sequence"),n=t.get("trim"),a=t.get("selection"),i=t.bases().toUpperCase(),s={residues:i,trimStart:n?n.start():0,trimEnd:n?n.end():i.length},r=e.get("mapstates").filter((e=>!e.isMasterSequence())).map((e=>{const t=e.get("sequence")
return{residues:t.bases().toUpperCase(),trimStart:t.get("trim").start(),trimEnd:t.get("trim").end()}})),o=a.start()
return{masterPolymer:s,otherPolymers:r,rangeStart:s.trimStart,rangeEnd:s.trimEnd,currentIndex:o}}function getMismatchLocationAtIndex(e,t,n){const a=function getFirstMismatchingPolymerIndex(e,t,n){const a=function getResiduesAtPositionAcrossPolymers(e,t){return e.map((e=>e.trimStart<=t&&t<e.trimEnd?e.residues[t]:null))}(t,n)
for(const[t,i]of a.entries())if(null!=i&&i!==e.residues[n])return t
return null}(e,t,n)
return null!=a?{residueIndex:n,rowIndex:a}:null}function getAlignmentInput(e,t,n){return t?{type:ft.n$.BIOENTITY,name:e.get("name"),id:e.get("id"),canBeTemplate:e.get("permissions").polymerFeaturesEditable,useCurrentVersion:!0,nucleotideType:e.nucleotideType()}:{type:ft.n$.TEXT,name:e.get("name"),id:(0,gt.Z)(),residues:e.cloneWithoutGaps().get("bases"),alignmentRowNumber:n,nucleotideType:e.nucleotideType()}}function getSequenceAnalysisInfo(e,t){let n
const a=[]
e.get("alignments").forEach(((e,t)=>{"template"===e.get("type")&&(n=e)
"template"!==e.get("type")&&"consensus"!==e.get("type")&&a.push(getAlignmentInput(e.get("sequence"),e.get("existingSequence"),t))}))
const i=n?{template:getAlignmentInput(n.get("sequence"),n.get("existingSequence"),e.get("alignments").indexOf(n)),items:a}:{name:e.get("name"),items:a,nucleotideType:a[0].nucleotideType}
return{sequenceAnalysisId:e.get("apiId"),sequenceId:t.id,alignmentSetup:i}}class SequenceAlignmentTabOptionsView extends s().View{static initClass(){this.prototype.className="navbar"
this.prototype.tagName="div"}initialize(){this.sequence=this.model.get("sequence")
this.listenTo(this.model,"change",this.render.bind(this))
this.listenTo(this.model,"change:loaded",(()=>{if(this.model.get("loaded")){this._bindListenersToAnalysis()
this.listenTo(this.getSelection(),"change",this.render.bind(this))}else this.getSelection()&&this.stopListening(this.getSelection())}))
this.model.get("loaded")&&this._bindListenersToAnalysis()
this.listenTo(this.sequence.get("versions"),"reloaded change:name",this.render.bind(this))
this.listenTo(this.sequence,"change:writable change:permissions",this.render.bind(this))}_bindListenersToAnalysis(){const e=this.model.get("analysis")
this.listenTo(e,"change:shouldRealign",this.render.bind(this))
this.listenTo(e.get("alignments"),"remove",this.render.bind(this))}getSelection(){const e=this.model.get("mapstates").models[0]
return e?e.get("sequence").get("selection"):null}async updateName(e){const t=this.model.get("analysis")
if(0!==e.length)if(e.length>255)v.ZP.error("Please specify a shorter name for your analysis.")
else try{await t.save({name:e},{parse:!1,patch:!0})
this.model.set("title",t.get("name"))
notifySuccess(t.attributes)}catch(e){if((0,Cn.d0)(e)){notifyError(e)
return}throw e}else v.ZP.error("Please specify a name for your analysis.")}addComment(){const e=this.getSelection(),t=this.model.get("analysis").get("alignmentComments")
if(0===e.length()){const t=e.get("sequence").length()
e.start()===t?e.setEndpoints(t-1,t):e.setEndpoints(e.start(),e.start()+1)}const n=new Rt.A({start:e.start(),end:e.end()})
t.add(n)
n.trigger("open",n)}sortRows(e){const t=o()(".fixed-top").find(".alignment-row").attr("data-id"),n=this.model.get("analysis").get("alignments")
n.comparator=n=>n.cid===t?e?0:"0":e?1+Math.max(n.get("trimStart"),n.get("sequence").realToGap(0)):`1${n.get("sequence").get("name")}`
n.sort()
n.trigger("save")}openRealignModal(){(0,m.j)("realignment","openModal",{source:"alignment-tab-view"});(0,Xn.Z)(Et.Z,{initialInputs:[],realignmentInput:{sequenceAnalysisInfo:getSequenceAnalysisInfo(this.model.get("analysis"),this.model.get("sequence")),isTemplateSequenceEditable:this.model.get("sequence").permissions().polymerResiduesEditable||!1}})}goToMismatch(e){m.KK(j.Jg.USED_ALIGNMENT_MISMATCH_NAVIGATION,{direction:e})
const t="next"===e?function getNextMismatch(e){const{masterPolymer:t,otherPolymers:n,rangeEnd:a,rangeStart:i,currentIndex:s}=extractMismatchDataFromTabState(e)
for(let e=Math.max(s+1,i);e<a;e++){const a=getMismatchLocationAtIndex(t,n,e)
if(null!=a)return a}return null}(this.model):function getPreviousMismatch(e){const{masterPolymer:t,otherPolymers:n,rangeStart:a,rangeEnd:i,currentIndex:s}=extractMismatchDataFromTabState(e)
for(let e=Math.min(s-1,i);e>=a;e--){const a=getMismatchLocationAtIndex(t,n,e)
if(null!=a)return a}return null}(this.model)
t&&this.model.jumpToLocation(t)}openPDFSnapshotPreview(){const e={source:"alignment",sequence_api_id:this.model.get("sequence").get("_sequence").id,sequence_length:this.model.get("analysis").get("alignments").seqLength(),alignment_id:this.model.get("analysis").id},t=this.model,n=new xt({paginate:e=>function alignmentPaginate(e,t){let n,a
const i=e.get("mapstates").models[0].get("sequence"),s=e.get("dnaType"),r=e.get("analysis"),o=new zs({landscape:!0,css:t}),c=`${r.get("alignmentType").replace(/^[a-z]/g,(e=>e.toUpperCase()))} Alignment: ${r.name()}`
o.addTitle(c)
const d=o.innerWidth(),u=s.numChars(d),m=(()=>{const e=[],t=i.selection().length(),r=t?i.selection().start():0,o=t?r+t:i.length()
for(a=r;a<o;a+=u){n=Math.min(a+u,o)
const t=s.width(n-a)+s.letterSpacing,i=(0,Qt.Z)().clamp(!0).domain([a,n]).range([0,t]),r=(0,Qt.Z)().clamp(!0).domain([0,t]).range([a,n])
e.push(new Yi.Z({start:a,end:n,width:t,x:i,xInv:r,maxWidth:d,visibleWidth:d}))}return e})(),p=l.default.sortBy(e.get("mapstates").models,((e,t)=>e.get("alignment").get("type")===r.get("alignmentType")?-1:t))
for(const t of m){const n=[],a=new vs.Z({getLengthFn:()=>i.length(),start:t.start(),end:t.end()})
for(let i=0;i<p.length;i++){const s=p[i],r=AlignmentViewUtil_makeSliceView(t,s,e,a,Ws)
r.render()
const o=r.boxHeight()
r.killSelection()
r.die()
const l=r.el,c=new bn.Z(12),d=Re().select(l).append("svg:g").attr("transform",`translate(0,${o})`).append("svg:text").attr("font-size",c.fontSize).attr("dy",c.height()).attr("x",20)
d.append("svg:tspan").attr("font-weight",900).text(`${s.get("alignment").get("type")} sequence`)
d.append("svg:tspan").attr("dx",c.charWidth()).text(`${s.get("sequence").name()}`)
Re().select(l).attr("height",o+c.height()).classed("alignment",!0)
fixAxis(l)
n.push(l)}o.addSVGGroup(n,t.pick("start","end"))}o.setHeaders(c,i.length(),i.startIndex())
return o}(t,e),landscape:!0,trackMetadata:e,filename:(0,Hs.Z)(`${this.model.get("analysis").name()}-alignment`,"pdf")})
n.render()
m.j("alignment","opened_pdf_preview",e)}openPDFFormattedPreview(){const e=function generateRawSequencesFromDNAAlignment(e){const t=function extractSequencesFromTabState(e){return e.get("mapstates").models.map((e=>({residues:e.get("sequence").bases(),master:e.isMasterSequence(),name:e.get("sequence").name()}))).sort(((e,t)=>e.master?-1:t.master?1:0))}(e);(0,S.hu)(1===l.default.uniq(t.map((e=>e.residues.length))).length,"Cannot generate PDF for alignment with different length sequences")
const n=t[0];(0,S.hu)(Boolean(n.master),"Error generating PDF: alignment does not have a master sequence")
return t.map((e=>e.master?{sequenceName:e.name,residues:e.residues.split("").map((e=>({letter:e,format:null})))}:{sequenceName:e.name,residues:e.residues.split("").map(((t,a)=>{const i={letter:t,format:null},s=(0,Ht.A)(n.residues,e.residues,a)
s&&(i.format=s)
return i}))}))}(this.model)
m.KK(j.Jg.OPENED_FORMATTED_PDF_MODAL,{residueType:yt.Q6.DNA})
const t=this.model.get("selectionProps");(0,Xn.Z)(molbio_AlignmentPDFDownloadModal,{rawAlignmentData:e,alignmentName:this.model.get("analysis").name(),alignmentPolymerType:yt.Q6.DNA,selection:{start:t?t.get("start"):0,end:t?t.get("end"):null}})}triggerInSync(e){const t=this.model.get("analysis")
t&&t.getMasterSequence().trigger("inSync",e)}getAlignmentVersion(){const e=this.model.get("analysis")
if(!e)return
const t=e.get("versionId")
return this.model.get("sequence").get("versions").get(t)}openAlignmentVersion(){const e=this.getAlignmentVersion()
if(e){e.trigger("open",e)
this.model.get("sequence").fileState().setIsWorkspaceSplit(!0)}}getClustalFormatData(){const e=this.model.get("analysis")
return e?e.clustalFormat():""}getFastaFormatData(){const e=this.model.get("analysis")
return e?e.fastaFormat():""}getProps(){var e
const t=this.model.get("analysis")
return{addComment:this.addComment.bind(this),alignmentApiId:null==t?void 0:t.get("apiId"),alignmentType:null==t?void 0:t.get("alignmentType"),alignmentVersionExists:Boolean(this.getAlignmentVersion()),alignmentVersionName:null===(e=this.getAlignmentVersion())||void 0===e?void 0:e.get("name"),allowFeatureEdits:this.model.get("sequence").allowFeatureEdits(),allowResidueEdits:this.model.get("sequence").allowResidueEdits(),analysisName:null==t?void 0:t.get("name"),attachedFileCount:(null==t?void 0:t.get("attached_file_count"))||0,getClustalFormatData:this.getClustalFormatData.bind(this),getFastaFormatData:this.getFastaFormatData.bind(this),goToMismatch:this.goToMismatch.bind(this),inSync:Boolean(t&&this.model.inSync()),loaded:this.model.get("loaded"),openPDFFormattedPreview:this.openPDFFormattedPreview.bind(this),openPDFSnapshotPreview:this.openPDFSnapshotPreview.bind(this),openAlignmentVersion:this.openAlignmentVersion.bind(this),openRealignModal:this.openRealignModal.bind(this),selectionLength:this.getSelection()?this.getSelection().length():0,sequenceEditURL:this.model.get("sequence").get("editURL"),shouldRealign:Boolean(null==t?void 0:t.get("shouldRealign")),sortRows:this.sortRows.bind(this),triggerInSync:this.triggerInSync.bind(this),updateName:this.updateName.bind(this),visibilityOptions:this.model.get("visibilityOptions")}}render(){(0,Me.A9)(d.createElement(AlignmentTabMenu,{...this.getProps()}),this.el)
return this}}SequenceAlignmentTabOptionsView.initClass()
var js=n(219048),Ys=n(848640),Qs=n(922633)
function AlignmentTab(){return d.createElement(d.Fragment,null,d.createElement("div",{className:"loading-screen"}),d.createElement("div",{className:"alignment-warning"}),d.createElement("div",{className:"full-container hidden"},d.createElement("div",{className:"fixed-top"},d.createElement("div",{className:"alignment-container"})),d.createElement("div",{className:"alignments-container"},d.createElement("div",{className:"sortable-wrapper"})),d.createElement("div",{className:"fixed-bottom"},d.createElement("div",{className:"statsView-container"}),d.createElement("div",{className:"summaryMapView-container"}))))}const Ks="buffer-tab"
class BufferTabView extends s().View{static initClass(){this.className=Ks
this.prototype.className=Ks
this.prototype.attributes={tabindex:2}}afterAttach(){}}BufferTabView.initClass()
const Js=BufferTabView
const Xs=class PolymerBufferTabView extends Js{addPolymersForSearch(){throw new Error("Not implemented")}removePolymersForSearch(){throw new Error("Not implemented")}remove(){super.remove()
this.removePolymersForSearch()
return this}render(){super.render()
this.addPolymersForSearch()
return this}}
class PolymerAlignmentTabView extends Xs{static initClass(){this.prototype.tagName="div"
this.prototype.className="alignment-view buffer-tab"
this.prototype.attributes={}
this.prototype.events={keydown:"handleKeyDown"}}initialize(e){super.initialize((0,l.default)(e).extend({tabstate:this.model}))
this.scrollAnimator={base:0}
this.debouncedResizeContainer=(0,It.D)((()=>{this.resizeContainer()}),20)}addPolymersForSearch(){throw new Error("Not implemented")}removePolymersForSearch(){throw new Error("Not implemented")}makeRowsView(){throw new Error("Not implemented")}makeSummaryMapView(){throw new Error("Not implemented")}makeTopAlignmentRowView(){throw new Error("Not implemented")}getType(){throw new Error("Not implemented")}setType(e){throw new Error("Not implemented")}getPolymerLength(){throw new Error("Not implemented")}curScrollLeft(){return this.$el.find(".fixed-top").find(".content").scrollLeft()}getDefaultSpan(){const e=this.model.get("slice").get("xInv")
return Math.floor(e(this.mapWidth()))}setMapDimensions(e=!0){const t=this.model.get("slice").get("xInv")
let n
if(null==t)return
if(e){const e=this.curScrollLeft()
n=Math.floor(t(e))}else n=this.model.get("range").start()
const a=this.getDefaultSpan(),i=Math.min(this.getPolymerLength(),n+a)
this.model.get("range").set({start:n,end:i,maxWidth:this.mapWidth()})
this.model.get("range").correct()}handleArrowPress(e){const t=this.$el.find(".alignment-row:focus")
if(0!==t.length)switch(e.which){case 38:{const e=t.prev()
e.length>0?e.focus():t.siblings().last().focus()
break}case 40:{const e=t.next()
e.length>0?e.focus():t.siblings().first().focus()
break}}}handleKeyDown(e){37<=e.which&&e.which<=40&&this.handleArrowPress(e)}resizeContainer(){const e=this.$el.outerHeight(!0),t=this.$(".fixed-bottom").outerHeight(!0),n=e-t,a=this.$(".alignment-warning").children().outerHeight(!0),i=this.$(".fixed-top .alignment-container").outerHeight(!0)+a,s=n-Math.min(n,Math.max(75,n-i))
this.$(".fixed-top").css("height",s-a).toggleClass("fixed-top--overflow",i<=s-a)
this.$(".alignments-container").css("top",s)
this.$(".alignments-container").css("bottom",t)}async save(){try{const e=this.model.get("analysis")
notifySuccess(await e.save(null,{debounce:{namespace:"updateJSON",wait:1e3},parse:!1,fileUpdate:!0,singleton:{namespace:"updateJSON"},skipFileUpdateXHRCount:!0,skipTimeoutXHR:!0,url:e.getUpdateJSONURL()}))}catch(e){if((0,de.Jf)(e))return
if(Cn.d0(e)){notifyError(e)
return}throw e}}killListeners(){o()(this.el).off(".alignment")
this.stopListening()
this.listenTo(this.model,"change:loaded rerender",(function loadRerender(){return this.update()}))}isLoaded(){return this.model.get("loaded")}linkMasterSequenceToActualSequence(){}updateStatsView(){if(null!=this.renderStatsView){const e=this.renderStatsView()
e?(0,Me.A9)(e,this.$(".statsView-container")[0]):u.unmountComponentAtNode(this.$(".statsView-container")[0])}}updateScroller(){this.rowsView.infiniteScroller&&this.rowsView.infiniteScroller.handleScroll()}registerListeners(){this.listenTo(this.model.get("bufferViewLayout"),"change:width change:height",(()=>{this.setMapDimensions()
this.updateScroller()}))
this.listenTo(this.model.get("range"),"rangeChange",((e,t)=>{this.showRange(e)}))
this.listenTo(this.model,"scroll",(e=>{this.showRange(!1,e)}))
this.listenTo(this.model,"rowResize",this.debouncedResizeContainer)
this.model.get("selection")&&this.listenTo(this.model.get("selection"),"change:start change:end",this.updateStatsView)
this.listenTo(this.model.get("visibilityOptions").getOption(Yt.Yv.name),"change",(()=>{this.update()
this.updateScroller()}))
o()(window).on(`resize.alignment-${this.cid}`,this.debouncedResizeContainer)
o()(this.el).on("wheel.alignment",(e=>{const t=-e.originalEvent.deltaX/8,n=-e.originalEvent.deltaY/8
if(Math.abs(t)>Math.abs(n)){const n=this.model.get("range")
n.panStart(n.start()-t)
this.showRange(!1)
e.preventDefault()}}))
this.removePolymersForSearch()
this.addPolymersForSearch()}update(){this.killListeners()
if(!this.isLoaded()){this.$el.find(".full-container").addClass("hidden")
this.$el.find(".loading-screen").removeClass("hidden")
return}this.$el.find(".loading-screen").addClass("hidden")
this.$el.find(".full-container").removeClass("hidden")
this.linkMasterSequenceToActualSequence()
this.setMapDimensions(!1)
let e=!1
if(null==this.model.get("range").get("maxWidth")){const t=new bn.Z(20,0),n=this.mapWidth(),a=Math.min(this.getPolymerLength(),t.numChars(n))
this.model.get("range").set({start:0,end:a,maxWidth:n})
this.model.get("range").correct()
e=!0}this.fitFontToRange()
if(null==this.rowsView){this.rowsView=this.makeRowsView()
this.rowsView.setElement(this.$(".alignments-container")[0])
this.rowsView.$el.addClass(this.rowsView.className)
this.rowsView.render()}else this.rowsView.update()
this.updateStatsView()
this.renderSummaryMapView()
this.topAlignmentView&&this.topAlignmentView.die()
this.topAlignmentView=this.makeTopAlignmentRowView()
this.$el.find(".fixed-top .alignment-container").empty().append(this.topAlignmentView.render().el)
this.maybeRenderWarning&&this.$el.find(".alignment-warning").empty().append(this.maybeRenderWarning())
l.default.defer((()=>this.resizeContainer()))
this.resizeSVGs()
e?this.showRange(!0):this.showRange(!1)
this.registerListeners()
l.default.defer((()=>o()(this.topAlignmentView.el).focus()))}die(){o()(this.el).off(".alignment")
o()(window).off(`resize.alignment-${this.cid}`)
this.renderStatsView&&u.unmountComponentAtNode(this.$(".statsView-container")[0])
this.summaryMapView&&this.summaryMapView.stopListening()
this.rowsView&&this.rowsView.die()
this.topAlignmentView&&this.topAlignmentView.die()}remove(){this.die()
return super.remove()}fitFontToRange(){const e=this.model.get("range").get("type")
this.setType(e)
this.setSliceValues()}resizeSVGs(){this.topAlignmentView.setSVGWidth()
this.rowsView.resizeSVGs()}shouldCollapseMiniMap(e){return!!e&&!e.get("visibilityOptions").getOption(Yt.Yv.name).get("visible")}showRange(e,t){const n=this.model.get("range").start()
if(e){this.fitFontToRange()
this.resizeSVGs()}this.scrollAnimator.base=n
this.topAlignmentView.showRange(t)
this.rowsView.showRange(t)}mapWidth(){return this.model.get("bufferViewLayout").get("width")-110}setSliceValues(){const e=this.getPolymerLength(),t=this.getType(),n=t.width(e-0)+t.letterSpacing,a=Re().scale.linear().clamp(!0).domain([0,e]).range([0,n]),i=Re().scale.linear().clamp(!0).domain([0,n]).range([0,e])
this.model.get("slice").set({start:0,end:e,width:n,x:a,xInv:i,maxWidth:n,visibleWidth:this.mapWidth()})}render(){this.$el.empty()
this.listenTo(this.model,"change:loaded rerender",(()=>{this.update()}));(0,Me.A9)(d.createElement(AlignmentTab,null),this.$el[0])
this.model.get("loaded")?this.update():this.resizeContainer();(0,He.Z)(this.$el,this.getDataTestAttrs())
return this}getDataTestAttrs(){return null}afterAttach(){if(this.model.get("loaded")){this.resizeContainer()
this.showRange(!0)}}renderSummaryMapView(){const e=this.$el.find(".fixed-bottom .summaryMapView-container")
if(null!=this.summaryMapView){this.summaryMapView.stopListening()
e.empty()}this.summaryMapView=this.makeSummaryMapView()
this.summaryMapView&&e.append(this.summaryMapView.render().el)}}PolymerAlignmentTabView.initClass()
var er=n(266981),tr=n(886485)
class PolymerMapTabView extends Xs{constructor(){super(...arguments)
this.inputBubble=null}static initClass(){this.prototype.inputSource="maptab-input"}events(){return{keydown:"handleKeydown",contextmenu:e=>{this.handleContextMenu(e)}}}focusElement(){return this.$el}getSelection(){return this.mapstate.polymer().selection()}getResidueSlice(e,t){return this.mapstate.polymer().residueSlice(e,t)}undo(){this.mapstate.polymer().allowResidueEdits({ignoreVersion:!0})&&this.mapstate.polymer().undo()}allowBubblePositionedAboveSlice(){return!0}_getBubbleOffsetClass(){throw new Error("Not implemented")}trackInput(e,t){null==t&&(t={})
m.j("editor",e,l.default.extend({source:this.inputSource},t))}registerListeners(){this.stopListening()}anticipateMetaShortcut(){const e=this.focusElement()
e.addClass("focus")
const t=o()("#clipboard-input")
t.off().on("copy",(e=>{this.handleCopy(e)})).on("cut",l.default.once((e=>{this.handleCut(e)}))).on("paste",l.default.once((e=>{this.handlePaste(e)}))).on("keydown",(e=>{pn.isCtrlA(e)&&this.handleCtrlA(e)
pn.isCtrlShiftC(e)&&this.handleCtrlShiftC(e)
pn.isCtrlI(e)&&this.handleCtrlI(e)
pn.isCtrlZ(e)&&this.handleCtrlZ(e)})).on("keyup",(function focusAndRemove(){e.removeClass("focus")
l.default.defer((()=>e.focus()))})).on("blur",(()=>{e.removeClass("focus")}))
t.val(" ").focus().select()}handleCtrlA(e){e.preventDefault()
this.selectAll()}handleCtrlI(e){e.preventDefault()
this.invertSelection()}handleCtrlZ(e){e.preventDefault()
this.undo()}selectAll(){const e=this.getSelection(),t=e.getPolymerLength()
e.reset(0)
e.setEndpoints(0,t)
this.trackInput("select_all_bases",{length:t})}handleCopy(e){const t=this.getSelection()
if(t.isEmpty())return
const n=this.storeRegionInBenchlingClipboard(e)
e.originalEvent.clipboardData.setData("text/plain",n)
e.preventDefault()
this.trackInput("copied_bases",{start:t.start(),end:t.end()})}handleCut(e){const t=this.getSelection()
if(t.isEmpty())return
if(!t.allowEdits()){v.ZP.warn("Edits are not allowed for this file.",{id:"PolymerMapTabView.editsNotAllowed"})
return}const n=this.storeRegionInBenchlingClipboard(e)
e.originalEvent.clipboardData.setData("text/plain",n)
e.preventDefault()
var a=null!=a?a.fail((()=>{v.ZP.error("An error occurred while cutting your selection.")})):void 0
this.trackInput("cut_bases")}invertSelection(){const e=this.getSelection()
if(e.canInvert()){e.invert()
this.trackInput("invert_selection")}else v.ZP.warn("The current selection cannot be inverted, as it does not include the start or end of the polymer.")}handlePaste(e){const t=this.getSelection()
if(!t.allowEdits()){v.ZP.warn("Edits are not allowed for this file.",{id:"PolymerMapTabView.editsNotAllowed"})
return}const n=e.originalEvent.clipboardData.getData("text/plain")
this.trackInput("paste_bases",{bases:n.slice(0,100),before:{start:t.start(),end:t.end()},length:n.length})
e.preventDefault()
this.showInputBubble({pasteText:n,doPaste:()=>{this.handlePasteText(n)
this.focusElement().focus()}})}handleKeydown(e){if(e.target!==e.currentTarget)return
if(pn.isControlKey(e)){this.anticipateMetaShortcut()
return}37<=e.which&&e.which<=40&&this.handleArrowPress(e)
const t=this.getSelection(),n=t.isWritable(),a=t.isDeletable()
if(pn.isADeleteKey(e)){e.preventDefault()
if(!a){if(t.isEmpty())return
t.allowEdits()?v.ZP.warn("Cannot delete current selection while it spans a part.",{id:"PolymerMapTabView.handleKeydown"}):v.ZP.warn("Edits are not allowed for this file.",{id:"PolymerMapTabView.editsNotAllowed"})
return}if(t.length()>0){this.trackInput("deleted_bases",{start:t.start(),end:t.end()})
this.showInputBubble({isDelete:!0})}return}const i=String.fromCharCode(e.which),s=window.debug&&"1"===i
if(e.target===this.el&&(this.isValidCharacter(i)||s)){if(!a&&!n){t.allowEdits()?this.model.get("sequence").hasNullPhosphate()&&this.model.get("sequence").get("type")!==fn.uS.OLIGO?v.ZP.warn("Cannot insert after a null phosphate in long sequences.",{id:"PolymerMapTabView.insertAfterNullPhosphate"}):v.ZP.warn("Cannot edit current selection while it spans a part.",{id:"PolymerMapTabView.handleKeydown"}):v.ZP.warn("Edits are not allowed for this file.",{id:"PolymerMapTabView.editsNotAllowed"})
return}this.showInputBubble({debugGenerate:s})}}handleContextMenu(e){const t=this.model.get("sequence")
if(t instanceof ga.Z){((e,t,n)=>{ta.e.open(e,[{name:"Insert residues",click(){n.showInputBubble({})},disabled:()=>!t.allowResidueEdits()||!t.canInsertAt(t.selection().start()),hide:()=>!(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT})}])})(e,t,this)
return}const n=t.isOligo()?sa:ra
SelectionContextMenu_open(e,t,n,this._contextMenuChoicesOptions())}_contextMenuChoicesOptions(){const e=this.model.get("sequence")
return{alignment:!1,circular:e.circular(),polymerMapTabView:this,hasTrim:null!=e.get("trim")}}_getCursorElement(){return this.getSelection().length()>0?this.$el.find(".selection-line").eq(0):this.$el.find(".map-cursor-line:not(.hide)")}_calculateBubblePos(){const e=this._getCursorElement()
if(0===e.length)return null
const t=e.offset(),n=this.$el.offset()
let a=t.top-n.top+this.$el.scrollTop(),i=t.left-n.left
const s=this.$el.innerWidth()-i
let r=0
if(s<tr.Z.BUBBLE_WIDTH-10){i=this.$el.innerWidth()-tr.Z.BUBBLE_WIDTH+10
r=tr.Z.BUBBLE_WIDTH-s-10}if(i<14){const e=14-i
i+=e
r=-e}a+=e.attr("y2")-e.attr("y1")
const o=this.allowBubblePositionedAboveSlice()&&a+100>this.$el.height()
if(o){({top:a}=e.parent().find(this._getBubbleOffsetClass()).offset())
a+=this.$el.scrollTop()-105
if(a>this.$el.height())return null}return{top:a,left:i,offset:r,isPositionedAbove:o}}repositionBubble(){if(null!=this.inputBubble){const e=this._calculateBubblePos()
null==e||e.top<0?this.inputBubble.remove():this.inputBubble.reposition(e)}}getMoveEnd(){var e
const t=this.getSelection()
return null!==(e=t.get(t.freeEnd()))&&void 0!==e?e:t.get(t.anchorEnd())}}PolymerMapTabView.initClass()
const nr=PolymerMapTabView
class PolymerAlignmentRowView extends nr{static initClass(){this.prototype.tagName="div"
this.prototype.className="alignment-row"
this.prototype.attributes={tabindex:2}
this.prototype.inputSource="alignment-input"
this.prototype.addPolymersForSearch=Jt.ZT
this.prototype.removePolymersForSearch=Jt.ZT}initialize(e){super.initialize(e)
this.tabstate=e.tabstate
this.visibilityOptions=e.visibilityOptions||this.model.get("visibilityOptions")}events(){return l.default.extend(super.events(),{keydown:"handleKeydown"})}afterAttach(){this.showRange()}showRange(e=null){const t=this.$(".content")
if(null==e){const n=this.getRange(),a=n.start(),i=n.end(),s=this.getSlice().get("x")
e=Math.floor(s(a))
i>=this.tabstate.getPolymerLength()&&(e=t.find("svg").width()-t.width())}this.lastLeft=e
t.scrollLeft(this.lastLeft)}setSVGWidth(){const e=this.tabstate.getType(),t=e.width(this.tabstate.getPolymerLength())+e.letterSpacing
Re().select(this.el).select("svg").attr("width",t+1)}handleArrowPress(e){e.preventDefault()
const t=this.getSelection(),n=e.shiftKey,a=t.start(),i=t.end()
switch(e.which){case 37:n?t.linearExtendBy(-1):t.isEmpty()?t.resetBy(-1):t.reset(a)
break
case 39:n?t.linearExtendBy(1):t.isEmpty()?t.resetBy(1):t.reset(i)}}allowBubblePositionedAboveSlice(){return!1}die(){o()(window).off(`.alignment-row-${this.cid}`)
this.optionsView.stopListening()
this.stopListening()}remove(){this.die()
super.remove()
return this}stopListening(...e){super.stopListening(...e)
if(0===e.length){this.sliceView.die()
this.optionsView&&this.optionsView.stopListening()}}registerListeners(){this.listenTo(this.getSlice(),"change:height",(()=>{this.tabstate.trigger("rowResize")}))
let e=null
const t=this.$(".handle"),n=this.$(".content")
o()(window).on(`mousemove.alignment-row-${this.cid}`,(n=>{const a=t.offset().left+t.width()+2,i=this.$el.offset().left+this.$el.width()
e=Math.min(Math.max(n.pageX,a),i)}))
t.on("mousemove",(()=>{this.sliceView.updateSelectionFromScroll(e)}))
n.on("scroll",(t=>{const n=o()(t.currentTarget).scrollLeft()
if(n!==this.lastLeft){const e=this.getSlice().get("xInv"),t=Math.floor(e(n))
this.getRange().panStart(t)
this.tabstate.trigger("scroll",n)}this.sliceView.updateSelectionFromScroll(e)}))}renderType(){switch(this.getAlignmentRowType()){case Kt.ALIGNMENT_TYPE.CONSENSUS:this.$el.addClass("consensus-alignment")
break
case Kt.ALIGNMENT_TYPE.TEMPLATE:this.$el.addClass("template-alignment")}}render(){(0,Me.A9)(this.renderRowContent(),this.$el[0])
this.renderType()
this.sliceView=this.makeSliceView()
this.sliceView.setFocusableParent(this.el)
this.optionsView=new er.Z({el:this.$el.find("ul.dropdown-menu"),model:this.visibilityOptions,featureCounts:this.featureCounts})
this.optionsView.render()
const e=this.$(".content")
e.append(this.sliceView.render().el)
de.Ud&&e.css("overflow-x","hidden")
this.registerListeners()
return this}}PolymerAlignmentRowView.initClass()
function AlignmentRow({alignmentRowType:e,canEdit:t,reserveSpaceRight:n}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"handle"},d.createElement("div",{className:"button-wrapper alignment-button-wrapper"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_WHITE,size:C.qE.MINI,isDropdown:!0}),d.createElement("ul",{className:"dropdown-menu select"})),d.createElement("div",{className:"alignment-row-info-section",style:{height:"100%",width:n?"75%":"85%"}}),"aligned"===e&&t&&d.createElement("span",{style:{marginLeft:"auto"},className:"times pull-right"},"×"),d.createElement("div",{className:"slider-container"},d.createElement("div",{style:{height:"100%"},className:"slider"}))),d.createElement("div",{className:"content draggable-svg-container"}))}var ar=n(517944),ir=n(860959)
function AntibodyInfo({residues:e,visibilityOptions:t}){const n=(0,y.removeGaps)(e),[a,i]=getAntibodyVisibilitySettings(t),[s,r]=useAntibodyMetadata(n,a,i)
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(sr.organismInfo)},r),d.createElement("div",{className:(0,g.iv)(sr.antibodyMessage)},s))}const sr=g.mM.create({antibodyMessage:{color:Vt.Y,marginTop:2},organismInfo:{marginTop:2}})
var rr=n(124640),or=n(759345)
function calculateNumMismatches(e,t,n,a){const i=Math.min(a,e.length,t.length),s=Array.from(e.slice(n,i)),r=Array.from(t.slice(n,i))
return l.default.zip(s,r).reduce(((e,t)=>t[0].toLowerCase()===t[1].toLowerCase()?e:e+1),0)}function NameEditModal({originalName:e,onRequestClose:t,onRequestSubmit:n}){const[a,i]=(0,d.useState)(e)
return d.createElement(et.ZP,{title:"Edit Row Name",onRequestClose:t,onRequestSubmit:()=>{n(a)},buttons:[{text:"Save",submit:!0},{text:"Cancel",cancel:!0}]},d.createElement(or.Z,{onChange:e=>{i(e.target.value)},value:a}))}function AlignmentRowInfo(e){var t,n
const a=null!==(t=e.trimStart)&&void 0!==t?t:0,i=null!==(n=e.trimEnd)&&void 0!==n?n:e.residues.length
let s=null
!1===e.reversed?s=d.createElement(pt.Z,{color:pt.J.BLUE,className:"u-tiny-spacing-right"},"FWD"):!0===e.reversed&&(s=d.createElement(pt.Z,{color:pt.J.RED,className:"u-tiny-spacing-right"},"REV"))
const r=e.alignmentType===yt.N2.TEMPLATE&&!e.isReferenceRow&&e.visibilityOptions.getOption(Yt.P$.name).get("visible"),o=null!=e.nucleotideType?e.nucleotideType===R.Wy.DNA?rr.m.Sequence:rr.m.RNASequence:rr.m.Protein
return d.createElement("div",{className:(0,g.iv)(lr.section)},e.isReferenceRow&&d.createElement("span",{className:(0,g.iv)(lr.prefix)},(0,Mt.kC)(e.alignmentType)),d.createElement("div",{className:(0,g.iv)(lr.name)},d.createElement("span",null,d.createElement(pe.Z,{className:(0,g.iv)(lr.icon,lr.nucleotideTypeIcon),icon:o}),s,e.name),e.canEdit&&d.createElement(pe.Z,{className:(0,g.iv)(lr.icon,lr.editIcon),icon:"edit",onClick:()=>{(0,Xn.Z)(NameEditModal,{originalName:e.name,onRequestSubmit:e.onNameChange})}})),e.isProteinAlignment&&shouldShowAntibodyTools(e.visibilityOptions)&&d.createElement(AntibodyInfo,{residues:e.residues,visibilityOptions:e.visibilityOptions}),r&&d.createElement(d.Fragment,null,d.createElement("div",null,"Length: ",function calculateLength(e,t,n){return Array.from(e.slice(t,n)).filter((e=>e!==R.P8)).length}(e.residues,a,i)),d.createElement("div",null,"Mismatches: ",calculateNumMismatches(e.residues,e.templateResidues,a,i)),d.createElement("div",null,"Pairwise Identity:"," ",(0,Jt.NM)(100*function calculatePairwiseIdentity(e,t,n,a){const i=a-n
return 0===i?1:(i-calculateNumMismatches(e,t,n,a))/i}(e.residues,e.templateResidues,a,i),2),"%")))}const lr=g.mM.create({section:{overflowY:"auto",height:"100%",padding:"0px 2px 2px 2px",wordWrap:"break-word",fontSize:"11px","::-webkit-scrollbar":{width:"8px"},"::-webkit-scrollbar-track":{background:"#f8fbfb",border:"1px solid #e8f0f2"},"::-webkit-scrollbar-thumb":{background:"#c9d8db"}},prefix:{fontWeight:600},name:{marginBottom:"2px"},icon:{display:"inline"},editIcon:{cursor:"pointer",marginLeft:"4px"},nucleotideTypeIcon:{marginRight:"4px"}}),{ALIGNMENT_TYPE:cr}=Kt,dr=(0,It.D)(((e,t)=>{e.set("maxY",-1*o()(t).slider("value"))}),20)
class SequenceAlignmentRowView extends PolymerAlignmentRowView{events(){return l.default.extend(super.events(),{"click .times":"showDeleteModal"})}getAlignmentRowType(){switch(this.alignment.get("type")){case yt.Fl.CONSENSUS:return cr.CONSENSUS
case yt.Fl.TEMPLATE:return cr.TEMPLATE
default:return null}}isValidCharacter(e){return y.isValidBase(e,R.jb)}showInputBubble(e){qn.ZP.showInputBubble(this,{...e,refocusTo:this.$el})}storeRegionInBenchlingClipboard(e){const t=qn.ZP.maybeStoreNucleotideRegionInBenchlingClipboard(this.getSelection(),e);(0,S.Gp)(null!=t,"Expected a clipboard hash")
return t}handlePasteText(e){qn.ZP.handlePasteText(this.mapstate.get("sequence"),e)}handleCtrlShiftC(e){qn.ZP.handleCtrlShiftC(this.mapstate.get("sequence"),e)}mimicSelection(){const e=this.tabstate.get("selectionProps")
this.model.get("sequence").get("selection").set(e.pick("start","end","anchor","active"),{propChange:!0})}propSelection(){const e=this.tabstate.get("selectionProps"),t=this.model.get("sequence").get("selection")
e.set({...t.pick("start","end","anchor","active"),rowIndex:this.tabstate.get("mapstates").indexOf(this.mapstate)},{cid:this.model.cid})}getSelection(){return this.model.get("sequence").get("selection")}getResidueSlice(e,t){return this.model.get("sequence").residueSlice(e,t)}makeSliceView(){const e=AlignmentViewUtil_makeSliceView(this.slice,this.model,this.tabstate,this.tabstate.get("range"),(0,ja.p8)({forAlignment:!0}))
e.setElement(SliceView.createSVGElement())
return e}getRange(){return this.tabstate.get("range")}getSlice(){return this.slice}undo(){this.tabView&&this.tabView.undo()}initialize(e){super.initialize(e)
this.tabView=e.tabView
this.alignment=this.model.get("alignment")
this.mapstate=this.model
this.slice=new Yi.Z
this.slice.set(this.tabstate.get("slice").attributes)
this.listenTo(this.tabstate.get("slice"),"change",(e=>{this.slice.set(e.attributes)}))
this.mimicSelection()
this.listenTo(this.tabstate.get("selectionProps"),"change",((e,t)=>{t.cid!==this.model.cid&&this.mimicSelection()}))
this.listenTo(this.model.get("sequence").get("selection"),"change",((e,t={})=>{t.propChange||this.propSelection()}))
this.listenTo(this.model.get("sequence").annotations(),"add remove reset",(()=>{this.setCount("annotations",Yt.jB.name,"Annotations")}))
this.listenTo(this.model.get("sequence").translations(),"add remove reset",(()=>{this.setCount("translations",Yt.KL.name,"Translations")}))
this.listenTo(this.model.get("sequence").sequencePrimers(),"add remove reset",(()=>{this.setCount("sequencePrimers",Yt.gY.name,"Primers")}))
this.listenTo(this.model.get("sequence").annotations(),"layerChange",(()=>{this.sliceView.updateComponent(Kt.SliceComponentName.annotations)}))
this.listenTo(this.model.get("sequence").translations(),"layerChange",(()=>{this.sliceView.updateComponent(Kt.SliceComponentName.translations)}))}height(){return this.slice.get("height")}deleteAlignmentRow(){this.alignment.destroy()
this.tabstate.get("analysis").set({shouldRealign:!0})
this.remove()}showDeleteModal(){new Ot.I4({title:"Remove sequence?",msg:`<p>\n  Are you sure you want to remove the sequence,\n  <b>${l.default.escape(this.model.get("sequence").name())}</b>, from the template alignment?</p>\n  <p><b>Note</b>: To re-include this sequence in the alignment, use the\n  <button type='button' class='button button--small button--secondary' style='pointer-events:none;'>\n    Realign\n  </button> feature.\n</p>`}).choice("Remove Sequence","button button--small button--primary js-submit",(()=>{this.deleteAlignmentRow()})).choice("Cancel","button button--small button--tertiaryGray js-cancel").show()}setCount(e,t,n){const a=this.model.get("sequence").get(e).getCount()
this.$el.find(`.handle .dropdown-menu .${t} + span`).text(`${n} `).append(o()("<span>").addClass("badge pull-right").text(a))}update(){this.sliceView.update()
this.renderNameInfo()}handleSliderShow(){const e=this.$el.find(".slider-container")
this.sliceView.components.trace&&this.sliceView.components.trace.shouldShow()?e.show():e.hide()}renderNameInfo(){const e=this.tabstate.get("analysis").get("alignmentType")===yt.Fl.CONSENSUS?yt.N2.CONSENSUS:yt.N2.TEMPLATE,t=this.tabstate.get("analysis").get("alignments").find((e=>e.get("type")===yt.Fl.TEMPLATE));(0,Me.A9)(d.createElement(AlignmentRowInfo,{residues:this.model.get("alignment").get("sequence").get("bases"),trimStart:this.model.get("alignment").get("trimStart"),trimEnd:this.model.get("alignment").get("trimEnd"),visibilityOptions:this.model.get("visibilityOptions"),name:this.model.get("sequence").get("_sequence").get("name"),canEdit:this.model.get("permissions").polymerFeaturesEditable,isProteinAlignment:!1,alignmentType:e,nucleotideType:this.model.get("alignment").get("sequence").get("nucleotideType"),isReferenceRow:Boolean(this.getAlignmentRowType()),templateResidues:t&&t.get("sequence").get("bases"),onNameChange:this.handleSequenceNameChange.bind(this),reversed:this.model.get("alignment").get("reversed")}),this.$el.find(".alignment-row-info-section")[0])}renderRowContent(){const e=this.model.get("permissions").polymerFeaturesEditable
return d.createElement(AlignmentRow,{alignmentRowType:this.alignment.get("type"),canEdit:e,reserveSpaceRight:e||this.alignment.get("trace")})}render(){super.render()
this.renderNameInfo()
const e=this.$el.find(".handle"),t=e.find(".slider-container"),n=this.alignment.get("trace")
if(null!=n){const t=l.default.max(l.default.flatten(l.default.values(n.get("baseToColor")))),a=-t
e.find(".slider").slider({animate:"fast",orientation:"vertical",range:"min",min:a,max:-25,value:a,slide(){dr(n,this)},change(){dr(n,this)}})
n.set("maxY",t)
this.handleSliderShow()}else t.empty()
this.setCount("annotations",Yt.jB.name,"Annotations")
this.setCount("translations",Yt.KL.name,"Translations")
this.setCount("sequencePrimers",Yt.gY.name,"Primers")
return this}handleSequenceNameChange(e){this.model.get("sequence").get("_sequence").set({name:e})
this.tabstate.get("analysis").save(null,{parse:!1,patch:!0,pickSequenceFields:["name"]}).done(notifySuccess).fail(notifyError)}registerListeners(){super.registerListeners()
this.listenTo(this.model,"traceToggle",this.handleSliderShow.bind(this))
this.listenTo(this.alignment,"updateRow",this.update.bind(this))
this.listenTo(this.model.get("sequence").get("_sequence"),"change:name",this.renderNameInfo.bind(this))
this.listenTo(this.model.get("visibilityOptions").getOption(Yt.P$.name),"change:visible",this.renderNameInfo.bind(this))
this.listenTo(this.model.get("alignment"),"change:trimStart change:trimEnd",this.renderNameInfo.bind(this))
this.listenTo(this.tabstate.get("analysis").getMasterSequence(),"change:bases",this.renderNameInfo.bind(this))}_contextMenuChoicesOptions(){const e=this.model.get("sequence")
return{alignment:!0,circular:e.circular(),polymerMapTabView:this,hasTrim:null!=e.get("trim"),tabstate:this.tabstate}}}SequenceAlignmentRowView.initClass()
class AlignmentItemSource extends ar.KC{static initClass(){this.prototype.updateItem=void 0}initialize(e,t){this.model=e
this.tabView=t
const n=e.get("mapstates"),a=e.get("analysis")
for(let e=0;e<n.models.length;e++){if(n.models[e].get("alignment").get("type")===a.get("alignmentType")){this.indexOfFixed=e
break}}(0,S.Gp)(null!=this.indexOfFixed,"Did not find fixed alignment row")
this.updateLength()
this.listenTo(n,"add remove reset",this.updateLength.bind(this))}updateLength(){this.set("length",this.model.get("mapstates").length-1)}getItem(e){const t=this.model.get("mapstates")
e>=this.indexOfFixed&&e++
const n=t.models[e],a=new SequenceAlignmentRowView({model:n,tabstate:this.model,tabView:this.tabView})
a.$el.attr("data-id",n.get("alignment").cid)
a.$el.attr("data-view",a);(0,He.Z)(a.$el,{component:"AlignmentRow",element:"root"})
return a}estimatedHeight(){return 30}}AlignmentItemSource.initClass()
class AlignmentRowsView extends s().View{static initClass(){this.prototype.className="scrolling-alignment-rows"}initialize(e){this.saveOrderHandler=e.saveOrderHandler
this.views=[]
this.tabView=e.tabView}die(){for(let e=0;e<this.views.length;e++){this.views[e].die()}this.$el.find(".sortable-wrapper").sortable("destroy")}update(){const e=this.$el.find(".sortable-wrapper")
e.empty()
for(const e of this.views)e.remove()
this.views=[]
for(const t of this.model.get("mapstates").models)if(t.get("alignment").get("type")!==this.model.get("analysis").get("alignmentType")){const n=new SequenceAlignmentRowView({model:t,tabstate:this.model,tabView:this.tabView}),{el:a}=n.render()
o()(a).attr("data-id",t.get("alignment").cid)
o()(a).data("data-view",n)
addTestAttrsToDOMElement(a,{component:"AlignmentRow",element:"root"})
e.append(a)
this.views.push(n)}}showRange(e=null){for(let t=0;t<this.views.length;t++){this.views[t].showRange(e)}}resizeSVGs(){for(let e=0;e<this.views.length;e++){this.views[e].setSVGWidth()}}_saveOrder(){const e=this.$el.find(".alignment-row").toArray().map((e=>o()(e).attr("data-id")))
this.saveOrderHandler(e)}handleAlignmentSort(){const e={}
this.model.get("analysis").get("alignments").models.forEach(((t,n)=>{e[t.cid]=n}))
const t=l.default.filter(this.views,(t=>e[t.$el.data("id")]>0)),n=o()(t.map((e=>e.el))),a=n.parent()
n.detach().sort(((t,n)=>e[o()(t).data("id")]-e[o()(n).data("id")]))
a.append(n)}render(){const e=this.$el.find(".sortable-wrapper")
e.sortable({items:"> .alignment-row",handle:".handle",cursorOffset:`url(${(0,me.Z)("/static/img/closedhand.cur")}), pointer`,forcePlaceholderSize:!0,start:(e,t)=>t.placeholder.height(t.item.height()),scroll:!1,axis:"y",stop:()=>{this._saveOrder()}})
e.mousedown((()=>{document.activeElement.blur()}))
e.on("sortstop",((e,t)=>{const n=o()(t.item).data("data-view")
n&&n.showRange()}))
this.update()
return this}jumpToIndex(e){const t=this.views[e].$el[0];(0,ir.p)(this.el,t)}}AlignmentRowsView.initClass()
class InfiniteAlignmentRowsView extends s().View{static initClass(){this.prototype.className="infinite-alignment-rows"}initialize(e){this.scrollData=new ar.cD
this.itemSource=new AlignmentItemSource(this.model,e.tabView)
this.infiniteScroller=new ar.Sp({tabstate:this.model,itemSource:this.itemSource,scrollData:this.scrollData,spacing:0})
this.infiniteScrollbar=new ar.h3({tabstate:this.model,model:this.scrollData,fullHeight:()=>this.$el.height()})
this.listenTo(this.itemSource,"change:length",this.rerenderRows.bind(this))}die(){}rerenderRows(){const e=this.infiniteScroller.firstRendered().index()
this.infiniteScroller.bootstrap({index:e,flush:!0,topAnchor:1e4})
this.infiniteScroller.jumpToIndex(e,0)}resizeSVGs(){for(let e=0;e<this.infiniteScroller.renderedItems.length;e++){this.infiniteScroller.renderedItems[e].item().setSVGWidth()}}showRange(e=null){for(let t=0;t<this.infiniteScroller.renderedItems.length;t++){this.infiniteScroller.renderedItems[t].item().showRange(e)}}handleAlignmentSort(){this.infiniteScroller.bootstrap({index:0,flush:!0,topAnchor:0})
this.infiniteScroller.jumpToIndex(0,0)}update(){if(!this.hasAttached){const e=o()('<div class="reset scroll-wrapper"></div>')
this.$el.append(e)
e.append(this.infiniteScroller.render().el)
e.append(this.infiniteScrollbar.render().el)
this.hasAttached=!0}}render(){this.update()
return this}jumpToIndex(e){this.infiniteScroller.jumpToIndex(e)}}InfiniteAlignmentRowsView.initClass()
const ur=(0,be.Z)((function SummaryMap(){return d.createElement(d.Fragment,null,d.createElement("div",{className:"controls"}),d.createElement("div",{className:"top-map"}),d.createElement("div",{className:"map-wrap"},d.createElement("div",{className:"map"})),d.createElement("div",{className:"bottom-map"}))}))
var mr=n(68150)
class SummarySliceView extends s().View{static initClass(){this.prototype.tagName="svg"
this.prototype.className="slice"}events(){return{mousedown:"updateRange",mousemove:"updateRange",mouseup:"updateRange",dblclick:"updateRange"}}triggerHeightChange(e){this.model instanceof En.v_&&this.model.set("sliceHeight",e)}initialize(e){this.performanceId=Li.BL("drawAlignmentSummarySlice",{enabled:!1},{interval:yt.TN,aggregations:[Li.Pe.MEDIAN,Li.Pe.MAX]},{})
this.mode="show"
this.top=e.top||!1
this.marginBottom=e.marginBottom||0
this.mapType=e.mapType
this.tabstate=e.tabstate
this.blinkCursor=(0,It.D)(this.blinkCursor,100)
this.slice=e.slice
this.range=this.tabstate.get("range")
this.y=e.y||["line"]
this.rowComponentMethods={line:e=>new si({model:e,tabstate:this.tabstate,slice:this.slice,visibilityOptions:this.tabstate.getSummaryMapVisibilityOptions(),lineLayout:this.tabstate.getSummaryMapLineLayout(),parent:this})}
this.componentMethods={summaryIdentityGraph:()=>new ReactWrapperView({className:"summaryIdentityGraph",setting:Yt.Dd.name,model:this.tabstate,visibilityOptions:this.tabstate.get("visibilityOptions"),polymerLayoutName:"summaryIdentityGraph",boxHeight:e=>e.height+e.vMargin,renderReact:e=>{const t=function movingAverage(e,t){return e.map(((n,a)=>{const i=a-Math.floor(t/2),s=function truncatingSlice(e,t,n){return t<0?e.slice(0,n):e.slice(t,n)}(e,i,i+t)
return s.reduce(((e,t)=>e+t),0)/s.length}))}(getIdentityValues(getAminoAcidMatrix(this.tabstate.get("alignment").rows,this.slice.start(),this.slice.end())),e.slidingWindowSize)
return d.createElement(Pa.Z,{layout:e,shouldStopMouseDownPropagation:!1},d.createElement(components_TooltipBarGraph,{values:t,propertyName:"Identity",xFunc:e=>this.slice.get("x")(e+this.slice.start()),maxHeight:e.height,disableTooltips:!0}))}}),sequenceAxis:()=>{const e=new ai({model:this.tabstate.getSubmapstates()[0],tabstate:this.tabstate,slice:this.slice,parent:this})
e.shouldShow=()=>!0
return e},alignmentComments:()=>{const e=new AlignmentCommentsView({model:this.model,tabstate:this.tabstate,slice:this.slice,parent:this,mapType:this.mapType})
e.shouldShow=()=>!0
return e}}
this.listComponents=[]
this.setLineHeights()}registerGlobalMouseEvents(){this.unregisterGlobalMouseEvents()
o()(document).on(`mousemove.summary-${this.cid}`,(e=>{this.moveRangeUpdate(e)}))
o()(document).on(`mouseup.summary-${this.cid}`,(()=>{this.finishRangeUpdate()}))}unregisterGlobalMouseEvents(){o()(document).off(`mousemove.summary-${this.cid}`)
o()(document).off(`mouseup.summary-${this.cid}`)}setLineHeights(){const e=this.tabstate.getSubmapstates().length,t=Math.max(Math.round(100/(e+2)),10),n=Math.round((100-t*e)/e)
this.tabstate.setSummaryMapLineLayout({height:t,vMargin:n})}renderComponentsList(){this.listComponents.forEach((e=>{this.stopListening(e)
e.remove()}))
this.listComponents=[]
const e=this.tabstate.getMasterSubmapstateCid()
this.y.forEach((t=>{if(t in this.componentMethods){const e=this.componentMethods[t]
this.listComponents.push(e())}else t in this.rowComponentMethods&&this.tabstate.getSubmapstates().forEach((n=>{const a=this.tabstate.getCidForSubmapstate(n)
if(e===a!==this.top)return
const i=this.rowComponentMethods[t]
this.listComponents.push(i(n))}))}))
this.forEachVisibleView((e=>{this.listenTo(e,"redraw",this.adjustAndRange)
const t=this.sublineLayer.append("svg:g").node()
e.setElement(t)
e.render(!1)}))}reorder(){this.renderComponentsList()
this.adjustHeight()}rerenderForMapRemoval(){this.renderComponentsList()
this.lazyStart=Math.max(this.lazyStart,0)
this.lazyEnd=Math.min(this.lazyEnd,this.listComponents.length)
this.adjustHeight()}registerListeners(){this.stopListening()
this.listenTo(this.tabstate,"change:polymerLayout",this.update)
this.listenTo(this.slice,"change",this.update)
this.listenTo(this.range,"change",this.doRange)
if(this.model instanceof En.v_){this.listenTo(this.model.get("submapstates"),"sort",this.reorder)
this.listenTo(this.model.get("submapstates"),"remove",(e=>{this.rerenderForMapRemoval()}))}}createRangeRect(e,t,n=!0){let a=this.boxHeight()
a=Math.max(a,30)
e.attr("x",(e=>t(e.start))).attr("y",0).attr("width",(e=>t(e.end)-t(e.start))).attr("height",(e=>a)).attr("fill-opacity",n?.5:0).classed("range-preview",(e=>"preview"===e.type))
e.exit().remove()}renderRange(){const e=[]
e.push({start:this.range.start(),end:this.range.end(),type:"range"})
if(this.range.get("active")){const t=this.range.preview().correct()
e.push({start:t.start(),end:t.end(),type:"preview"})}const t=this.lineLayer.selectAll("rect.range").data(e),n=this.lineLayer.selectAll("rect.range-hidden").data(e)
t.enter().insert("svg:rect",".alignmentComments").classed("range",!0)
const{range:a,slice:i}=this,s=Re().behavior.drag().origin((e=>({x:i.x()(a.start()),y:0}))).on("drag",((e,t)=>{const n=i.get("xInv")
a.panStart(Math.floor(n(Re().event.x)))})).on("dragstart",(()=>{this.lineLayer.selectAll(".range-hidden").classed("grabbed",!0)
Re().event.sourceEvent.stopPropagation()})).on("dragend",(()=>{this.lineLayer.selectAll(".range-hidden").classed("grabbed",!1)}))
n.enter().insert("svg:rect",".alignmentComments").classed("range-hidden",!0).call(s).on("mousedown",(()=>{Re().event.stopPropagation()}))
const r=this.slice.x()
this.createRangeRect(t,r,!0)
this.createRangeRect(n,r,!1)
t.exit().remove()
n.exit().remove()}die(){this.stopListening()
o()(document).off(".summary")
l.default.each(this.listComponents,((e,t,n)=>{e.die()}))}getTop(){return this.el.offsetTop-10}finishRangeUpdate(){this.lineLayer.selectAll(".range-hidden").classed("grabbed",!1)
if(this.range.get("active")){this.range.correct()
m.j("alignment","resized_summary_view_range",{start:this.range.start(),end:this.range.end(),span:this.range.span()})}this.range.set("active",!1)
this.range.set("dragging",!1)}moveRangeUpdate(e){const t=e.pageX-this.$el.offset().left,n=Math.round(this.slice.xInv()(t))
this.range.get("active")&&this.range.extend(n)
this.range.get("dragging")&&this.range.pan(n)}updateRange(e){e.preventDefault()
const t=e.pageX-this.$el.offset().left,n=Math.round(this.slice.xInv()(t))
switch(e.type){case"mousemove":this.moveRangeUpdate(e)
break
case"mousedown":this.lineLayer.selectAll(".range-hidden").classed("grabbed",!0)
this.range.pan(n)
this.range.set("dragging",!0)
this.registerGlobalMouseEvents()
e.stopPropagation()
break
case"mouseup":if(this.range.get("dragging")||this.range.get("active")){this.finishRangeUpdate()
this.unregisterGlobalMouseEvents()}break
case"dblclick":e.stopPropagation()}}doRange(){Li.hY(this.performanceId)
this.renderRange()
this.rangeLines()
Li.Eb(this.performanceId)}rangeLines(){const e=this.slice.x(),t=[]
t.push({x:this.range.start(),type:"start"})
t.push({x:this.range.end(),type:"end"})
const n=this.lineLayer.selectAll(".range-line").data(t)
n.enter().insert("svg:line")
const{range:a}=this,i=this.boxHeight()
n.classed("range-line",!0).attr("x1",(t=>e(t.x))).attr("y1",0).attr("x2",(t=>e(t.x))).attr("y2",i).attr("style","cursor:ew-resize").attr("stroke","black").attr("stroke-width",2).classed("hide",!1).on("mousedown",(e=>{Re().event.stopPropagation()
a.set({active:!0,freeEnd:e.type})}))
n.exit().remove()}boxHeight(e){let t=0
if(null==e){e=this.listComponents.length
t=this.marginBottom}return this.listComponents.slice(0,e).reduce(((e,t)=>e+t.boxHeight()),t)}adjustHeight(){this.forEachVisibleView(((e,t)=>{Re().select(e.el).attr("transform",`translate(0,${this.boxHeight(t)})`)}))
const e=this.boxHeight()
Re().select(this.el).attr("height",e)
this.lineLayer.select("rect.action-rect").attr("height",e)
this.triggerHeightChange(e)}update(){this.forEachVisibleView((e=>{e.update(!1)}))
this.adjustAndRange()}adjustAndRange(){this.adjustHeight()
this.doRange()}setWidth(e){Re().select(this.el).attr("width",e)
this.lineLayer&&this.lineLayer.select("rect.action-rect").attr("width",e)}forEachVisibleView(e){for(let t=0;t<this.listComponents.length;t++){e(this.listComponents[t],t)}}render(){this.registerListeners()
this.sublineLayer=Re().select(this.el).append("svg:g")
this.lineLayer=Re().select(this.el).append("svg:g")
this.lineLayer.append("svg:rect").classed("action-rect",!0).attr("x",0).attr("y",0).attr("width",Re().select(this.el).attr("width")).attr("height",0).attr("fill","blue").attr("fill-opacity",0)
this.renderComponentsList()
this.adjustAndRange()
o()(this.el).on(`${mr.C$}.summary`,(e=>{let t,n
t=null!=e.originalEvent.detailX?e.originalEvent.detailX:null!=e.originalEvent.wheelDeltaX?e.originalEvent.wheelDeltaX/16:null!=e.originalEvent.detail?-e.originalEvent.detail:0
n=null!=e.originalEvent.detailY?e.originalEvent.detailY:null!=e.originalEvent.wheelDeltaY?e.originalEvent.wheelDeltaY/16:null!=e.originalEvent.detail?-e.originalEvent.detail:0
if(Math.abs(t)>Math.abs(n)){this.range.panStart(this.range.start()-t)
e.preventDefault()}}))
return this}}SummarySliceView.initClass()
const pr=(0,be.Z)((function TooltipTemplate_Tooltip({top:e,left:t}){return d.createElement("div",{style:{display:"block",top:e,left:t},className:"tooltip fade top in"},d.createElement("div",{className:"tooltip-arrow"}),d.createElement("div",{className:"tooltip-inner"}))}))
class SummaryScrollbar extends s().View{static initClass(){this.prototype.tagName="rect"
this.prototype.className="summary-scrollbar"}initialize(e){this.range=e.range
this.slice=e.slice
this.tabstate=e.tabstate
this.fullHeight=e.fullHeight}registerListeners(){this.listenTo(this.model,"change:position",this.updateThumb)
this.listenTo(this.model,"change:endPosition",this.updateThumb)
this.listenTo(this.model,"change:size",this.updateThumb)
this.listenTo(this.range,"change",this.updateThumb)}updateThumb(e,t,n){const a=this.model.get("position"),i=this.model.get("size"),s=this.model.get("endPosition")-this.model.get("position")+1
Re().select(this.el).classed("hidden",s>=i)
const r=this.fullHeight(),o=r/i*s,l=r-Math.max(5-o,0),c=r-o,d=Math.min(c,a/i*l),u=this.slice.x(),m=u(this.range.start()),p=u(this.range.span())
Re().select(this.el).datum({x:0,y:d}).attr("x",m-5).attr("width",p+10).attr("y",d).attr("height",o)}handleDrag(e){this.setPosition(e,Re().event.y)}setPosition(e,t){const n=this.fullHeight(),a=this.model.get("size")
t=Math.min(n,Math.max(0,t))
e.y=t
const i=Math.min(a-1,Math.max(0,t/n*a))
this.model.setPosition(i,{who:this.cid})}handleDragEnd(e){this.$el.removeClass("drag")}handleDragStart(e){this.$el.addClass("drag")}posFromY(e){const t=this.fullHeight(),n=this.model.get("size")
e=Math.min(t,Math.max(0,e))
return Math.min(n-1,Math.max(0,e/t*n))}render(){this.registerListeners()
const e=Re().behavior.drag().origin((e=>{const t=Re().mouse(this.el)[1],n=this.posFromY(t);(this.model.get("position")>n||n>this.model.get("endPosition")+1)&&this.setPosition(e,t)
return e})).on("drag",(e=>{this.handleDrag(e)})).on("dragstart",(e=>{this.handleDragStart(e)})).on("dragend",(e=>{this.handleDragEnd(e)}))
Re().select(this.el).datum({x:0,y:0}).call(e)
this.updateThumb()
return this}}SummaryScrollbar.initClass()
class SummarySliceLineView extends SummarySliceView{initialize(e,...t){this.lazyStart=0
this.lazyEnd=0
super.initialize(e,...t)}forEachVisibleView(e){this._doOnRange(Math.max(this.lazyStart,0),Math.min(this.lazyEnd,this.listComponents.length),e)}getScrollData(){return this.tabstate.get("scrollData")}adjustHeight(){const e=this.tabstate.getSummaryMapLineLayout().boxHeight()
let t=e*this.lazyStart
this.forEachVisibleView(((n,a)=>{Re().select(n.el).attr("transform",`translate(0,${t})`)
t+=e}))
t=e*this.listComponents.length
Re().select(this.el).attr("height",t+this.marginBottom)
this.lineLayer.select("rect.action-rect").attr("height",t)
this.triggerHeightChange(t)}_doOnRange(e,t,n){for(let a=e;a<t;a++)n(this.listComponents[a],a)}reorder(){this.forEachVisibleView((e=>{e.remove()}));[this.lazyStart,this.lazyEnd]=[0,0]
super.reorder()
this.showVerticalSlice(0,200)}renderScrollbar(){const e=this.tabstate.getSummaryMapLineLayout().boxHeight(),t=Re().select(this.el).append("svg:g").classed("summary-scrollbar",!0).append("svg:rect").attr("fill","white").attr("fill-opacity",.6).attr("stroke","black").attr("stroke-width",2)
this.scrollBar=new SummaryScrollbar({el:t.node(),slice:this.slice,range:this.range,model:this.getScrollData(),fullHeight:()=>e*this.listComponents.length})
const getPos=()=>{const e=Re().mouse(this.el)[1],t=this.getScrollData(),n=t.get("endPosition")-t.get("position")+1
return this.scrollBar.posFromY(e)-n/2},getBP=()=>{const e=Re().mouse(this.el)[0]
return this.slice.xInv()(e)}
Re().select(this.el).on("dblclick",(()=>{const e=getPos()
this.getScrollData().setPosition(e)})).on("contextmenu",(()=>{const e=getPos(),t=getBP()
ta.e.open(Re().event,[{name:"Scroll Here",click:()=>{this.getScrollData().setPosition(e)
this.range.pan(t)}}])}))
this.scrollBar.render()}die(){super.die()
this.$tooltip.remove()
clearTimeout(this.intId)}renderTooltip(){this.$tooltip=o()(pr({top:"0px",left:"-1000px",text:""}))
this.intId=null
o()(document.body).append(this.$tooltip)
const{$tooltip:e}=this
let t=null,n=null,a=null,i=null,s=null
const clearTooltip=()=>{e.css({left:-1e3})
clearTimeout(this.intId)
t=null},showTooltip=()=>{e.removeClass("in").addClass("out").removeClass("fade")
clearTimeout(this.intId)
this.intId=setTimeout((()=>{e.css({left:a,top:i})
e.find(".tooltip-inner").text(s)
e.removeClass("out").addClass("in").addClass("fade")}),500)},computeTooltip=()=>{const t=Re().mouse(this.el),r=t[0];[a,i]=Re().mouse(document.body)
const o=this.tabstate.getSummaryMapLineLayout().boxHeight(),l=Math.max(t[1],0)
n=Math.min(Math.floor(l/o),this.listComponents.length-1)
i+=n*o+3-l
i-=e.height()+5
a+=r-r
a-=e.width()/2
s=this.tabstate.getNameFromSubmapstate(this.listComponents[n].model)}
Re().select(".summary-scrollbar").on("mousemove",clearTooltip)
this.lineLayer.on("mouseleave",clearTooltip)
this.lineLayer.on("mousemove",(()=>{computeTooltip()
n!==t&&showTooltip()
t=n}))}render(){super.render()
this.getScrollData()&&this.renderScrollbar()
this.renderTooltip()
return this}showVerticalSlice(e,t){const n=this.tabstate.getSummaryMapLineLayout().boxHeight(),[a,i]=[this.lazyStart,this.lazyEnd]
this.lazyStart=Math.max(Math.floor(e/n),0)
this.lazyEnd=Math.min(Math.ceil(t/n),this.listComponents.length)
const removeAction=e=>{e.remove()},renderAction=e=>{const t=this.sublineLayer.insert("svg:g").node()
e.setElement(t)
e.render(!1)}
function updateAction(e){}if(a<this.lazyStart)if(i<this.lazyStart){this._doOnRange(a,i,removeAction)
this._doOnRange(this.lazyStart,this.lazyEnd,renderAction)}else if(i<this.lazyEnd){this._doOnRange(a,this.lazyStart,removeAction)
this._doOnRange(this.lazyStart,i,updateAction)
this._doOnRange(i,this.lazyEnd,renderAction)}else{this._doOnRange(a,this.lazyStart,removeAction)
this._doOnRange(this.lazyStart,this.lazyEnd,updateAction)
this._doOnRange(this.lazyEnd,i,removeAction)}else if(a<this.lazyEnd)if(i<this.lazyEnd){this._doOnRange(this.lazyStart,a,renderAction)
this._doOnRange(a,i,updateAction)
this._doOnRange(i,this.lazyEnd,renderAction)}else{this._doOnRange(this.lazyStart,a,renderAction)
this._doOnRange(a,this.lazyEnd,updateAction)
this._doOnRange(this.lazyEnd,i,removeAction)}else{this._doOnRange(this.lazyStart,this.lazyEnd,renderAction)
this._doOnRange(a,i,removeAction)}this.adjustAndRange()}}class AlignmentSummaryMapView extends s().View{static initClass(){this.prototype.tagName="div"
this.prototype.className="summary-map"
this.prototype.template=ur}initialize(e){super.initialize(e)
this.model=e.model
this.tabstate=e.tabstate
this.isDragging=!1
this.slice=new Yi.Z
this.padding=e.padding||0
this.isCollapsed=e.isCollapsed||!1
this.topSliceView=new SummarySliceView({slice:this.slice,model:this.model,tabstate:this.tabstate,mapType:"summary",top:!0,marginBottom:5,y:e.topY||(this.isCollapsed?["line"]:["alignmentComments","line"])})
if(!this.isCollapsed){this.sliceView=new SummarySliceLineView({slice:this.slice,model:this.model,tabstate:this.tabstate,top:!1,mapType:"summary",y:e.middleY||["line"]})
this.bottomSliceView=new SummarySliceView({slice:this.slice,model:this.model,tabstate:this.tabstate,top:!1,mapType:"summary",y:e.bottomY||["sequenceAxis"]})}this.showFullSequence()}showFullSequence(){const e=this.tabstate.getPolymerLength()
this.tabstate.fitSummaryTypeToWidth(e,this.mapWidth(),{allowFractionalSpacing:!0})
this.setSliceValues()
this.setSVGWidth()}setSVGWidth(){const e=this.tabstate.getSummaryType().width(this.tabstate.getPolymerLength()),t=Boolean(this.sliceView)&&Boolean(this.bottomSliceView)?[this.topSliceView,this.sliceView,this.bottomSliceView]:[this.topSliceView]
for(const n of t)n.setWidth(e+1)}mapWidth(){return this.tabstate.get("bufferViewLayout").get("width")-30-this.padding+(this.isCollapsed?this.padding:0)}setSliceValues(){const e=this.tabstate.getPolymerLength(),t=this.tabstate.getSummaryType().width(e-0),n=Re().scale.linear().clamp(!0).domain([0,e]).range([0,t]),a=Re().scale.linear().clamp(!0).domain([0,t]).range([0,e])
this.slice.set({start:0,end:e,width:t,x:n,xInv:a,maxWidth:t,visibleWidth:this.mapWidth()})}killView(e){e&&e.die()}stopListening(){super.stopListening()
this.killView(this.topSliceView)
this.killView(this.sliceView)
this.killView(this.bottomSliceView)}resizeHandler(){this.showFullSequence()}render(){this.$el.html(this.template())
const attachSliceView=(e,t)=>{const n=Re().select(this.el).select(t).append("svg:svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").classed("mini-map",!0),a=n.node()
e.setElement(a)
n.classed(e.className,!0)
return e.render()}
attachSliceView(this.topSliceView,".top-map")
if(this.sliceView){attachSliceView(this.sliceView,".map")
this.sliceView.showVerticalSlice(0,200)}this.bottomSliceView&&attachSliceView(this.bottomSliceView,".bottom-map")
this.$(".map-wrap").on("scroll",(()=>{const e=this.$(".map-wrap").scrollTop(),t=e+this.$(".map-wrap").height()
return this.sliceView.showVerticalSlice(e,t)}))
this.setSVGWidth()
this.listenTo(this.tabstate.get("bufferViewLayout"),"change:width",this.resizeHandler)
return this}}AlignmentSummaryMapView.initClass()
const hr=g.mM.create({badgeMargin:{margin:"8px"}})
class SequenceAlignmentTabView extends PolymerAlignmentTabView{initialize(e){super.initialize(e)
this.mapstates=this.model.get("mapstates")
this.undoInProgress=!1
Ys.OZ(Qs.ZP.MODULES.SEQUENCE,Qs.ZP.VIEW_ALIGNMENT)}getDataTestAttrs(){return{component:"SequenceAlignmentTab",element:"root"}}getType(){return this.model.get("dnaType")}setType(e){this.getType().copy(e)}getPolymerLength(){return this.model.get("analysis").getMasterSequence().length()}addPolymersForSearch(){this.mapstateSequences=this.model.get("mapstates").map((e=>e.get("sequence")))
$a.C.get().addSequences(this.mapstateSequences,10)}removePolymersForSearch(){this.mapstateSequences&&$a.C.get().removeSequence(...this.mapstateSequences)}setMapDimensions(...e){for(const e of this.mapstates.models){e.set({width:this.model.get("bufferViewLayout").get("width")})
e.set({height:this.model.get("bufferViewLayout").get("height")})}super.setMapDimensions(...e)}linkMasterSequenceToActualSequence(){"template"===this.model.get("analysis").get("alignmentType")&&this.model.get("analysis").getMasterSequence().set({id:this.model.get("sequence").get("_sequence").get("id")})}handleAlignmentSort(){this.rowsView.handleAlignmentSort()}handleAlignmentRemoval(){this.save()}handleAlignmentUpdate(){this.save()
this.setMapDimensions()
this.showRange(!0)
this.summaryMapView.showFullSequence()}registerListeners(){super.registerListeners()
this.listenTo(this.model.get("analysis").get("alignments"),"remove",this.handleAlignmentRemoval)
this.listenTo(this.model.get("analysis").get("alignments"),"update",this.handleAlignmentUpdate)
this.listenTo(this.model.get("mapstates"),"sort",this.handleAlignmentSort)
this.listenTo(this.model.get("analysis").get("alignments"),"save",this.save)
this.model.get("summaryState","change:sliceHeight",this.resizeContainer)
for(const e of this.model.get("mapstates").models){const t=e.get("sequence"),n=this
this.listenTo(t,"jump",((t,a,i=null)=>{null==i&&(i=t+1)
const s=this.model.get("range").start(),r=this.model.get("range").end()
if(!(s<=t&&i<=r)){const e=r-s
o()(this.scrollAnimator).stop().animate({base:Math.floor((t+i)/2)},{duration:Math.max(100,Math.min(300,5*Math.abs(t-s))),step(){n.model.get("range").panStart(Math.floor(this.base-e/2))
n.showRange(!1)},done(){n.model.get("range").panStart(Math.floor(this.base-e/2))
n.showRange(!1)}})}const l=this.mapstates.indexOf(e)
l>0&&this.rowsView.jumpToIndex(l-1)}))}}_saveOrder(e){const t=this.model.get("analysis").get("alignments"),n=o()(".fixed-top").find(".alignment-row").attr("data-id")
e.unshift(n)
t.comparator=t=>e.indexOf(t.cid)
t.sort()
m.j("alignment","reorder_alignments",{name:this.model.get("analysis").get("name"),type:this.model.get("analysis").get("alignmentType")})
this.save()}async save(e={}){await super.save()
dt.ZP.MOLBIO_ENABLE_ALIGNMENT_UNDO&&!e.triggeredByUndo&&this.model.addToHistory()}async undo(){if(dt.ZP.MOLBIO_ENABLE_ALIGNMENT_UNDO&&this.model.canUndo())if(this.undoInProgress)v.ZP.warn("Cannot undo while previous operation is in progress. Try again in a moment.")
else{this.undoInProgress=!0
l.default.defer((()=>{$e.$Z("Reverting...")}))
try{const[e,t]=await this.model.undo()
if(null!=e&&null!=t){await this.save({triggeredByUndo:!0})
this.model.get("analysis").isReallyBig()&&this.rowsView.rerenderRows()
this.model.jumpToLocation({rowIndex:e,residueIndex:t})}}finally{$e.Cp()
this.undoInProgress=!1}}}makeSummaryMapView(){return new AlignmentSummaryMapView({model:this.model.get("summaryState"),tabstate:this.model,isCollapsed:this.shouldCollapseMiniMap(this.model)})}maybeRenderWarning(){const e=5e6
return this.model.get("analysis").get("alignments").collect().reduce(((e,t)=>{const n=t.get("sequence")
return e+n.gapToReal(n.length())}),0)>e?Xt.renderToStaticMarkup(d.createElement("div",{className:(0,g.iv)(hr.badgeMargin)},d.createElement(js.Z,{content:`This alignment exceeds Benchling’s limit of ${e.toLocaleString()} bases across all sequences in the alignment. Realignments that increase its size may fail.`,tooltipTitle:""}))):null}makeRowsView(){const e=this.model.get("analysis").isReallyBig(),t=e?new InfiniteAlignmentRowsView({model:this.model,tabView:this}):new AlignmentRowsView({model:this.model,saveOrderHandler:e=>this._saveOrder(e),tabView:this})
e&&this.model.set("scrollData",t.scrollData)
return t}makeTopAlignmentRowView(){const e=this.model,t=e.get("mapstates").find((t=>t.get("alignment").get("type")===e.get("analysis").get("alignmentType"))),n=new SequenceAlignmentRowView({model:t,tabstate:e,tabView:this})
o()(n.el).attr("data-id",t.get("alignment").cid)
o()(n.el).data("data-view",n)
addTestAttrsToDOMElement(n.el,{component:"AlignmentRow",element:"root",key:"referenceSequence"})
return n}}SequenceAlignmentTabView.initClass()
class AnnotationsTableTabState extends nn.X4{defaults(){return{...super.defaults(),showPartAnnotations:!1}}initialize(e){super.initialize(e)
this.set("title","Annotations")}}const gr=AnnotationsTableTabState
function getAnnotationData(e,t){return{id:e.get("_annotation").id,cid:e.cid,visible:e.visible(),name:e.name(),annotation_type:e.annotationType(),color:e.color(),notes:e.notes(),custom_fields:e.customFields(),hover:e.hover(),start:e.start(),end:e.end(),length:e.length(t),strand:e.strand(),editable:e.editable(),selected:e.selected(),displayStart:(0,T.modelStartToDisplay)(e.start(),t.startIndex()),displayEnd:(0,T.modelEndToDisplay)(e.end(),t.length(),t.startIndex())}}function getUniqueNonEmptyAnnotationTypes(e){return[...new Set(e.map((e=>e.annotation_type)).filter((e=>e)))]}var Er=n(158716)
function FeatureTableChipList({items:e}){return d.createElement(Er.gK,{chips:e.map((e=>d.createElement(Za.ZP,{className:(0,g.iv)(fr.chip),text:e,size:Za.TK.TABLE_CELL,tooltipTitle:e}))),maxChips:3,isVertical:!0,chipSize:Za.TK.TABLE_CELL,showMoreSize:Za.TK.TABLE_CELL})}const fr=g.mM.create({chip:{maxWidth:"95%"}})
var Sr=n(921554)
function ColorSwatch({color:e,selected:t=!1,onClick:n,small:a=!1,dataTestAttrs:i}){const[s,r]=(0,d.useState)(!1)
let o=0
t?o=2:s&&(o=1)
const l=Re().rgb(e).darker(o).toString()
return d.createElement("div",{className:f()((0,g.iv)(yr.colorSwatch),{[(0,g.iv)(yr.smallColorSwatch)]:a,[(0,g.iv)(yr.pointerCursor)]:Boolean(n)}),onClick:n,onMouseEnter:()=>{null!=n&&r(!0)},onMouseLeave:()=>{null!=n&&r(!1)},style:{backgroundColor:e,border:`2px solid ${l}`},...(0,ee.Z)(i)})}function PopoverColorPicker({selectedColor:e,onSelectColor:t,asDropdown:n=!1,disabled:a=!1}){(0,S.hu)(n||null!=e,"Expected non-null color for swatch colorpicker")
const[i,s]=(0,d.useState)(!1),r=Sr.C2
return d.createElement(Oe.Z,{interaction:ne.x2.CONTROLLED,isOpen:i,renderContent:()=>(()=>{const n=(0,Jt.vM)(r,(e=>Math.floor(r.indexOf(e)/4))),a=[]
for(const[i,r]of Object.entries(n))a.push(d.createElement(h.Z,{key:i,className:(0,g.iv)(yr.swatchRow)},r.map((n=>d.createElement(p.Z,{key:n,className:(0,g.iv)(yr.swatchCol)},d.createElement(ColorSwatch,{color:n,selected:n===e,onClick:()=>{t(n)
s(!1)},dataTestAttrs:{component:"PopoverColorPicker",element:"selector"}}))))))
return d.createElement("div",{className:(0,g.iv)(yr.popover)},d.createElement("h3",{className:(0,g.iv)(yr.title)},"Select color"),d.createElement("div",{className:(0,g.iv)(yr.popoverContent)},a))})(),placement:ne.ZH.LEFT},d.createElement("div",{onClick:()=>{a||s(!i)},...(0,ee.Z)({component:"PopoverColorPicker",element:"toggle"})},n?d.createElement("div",{className:f()((0,g.iv)(yr.asDropdownButton),"btn-af-default selectDropdown-button",{"is-disabled":a})},null==e?d.createElement("span",{className:(0,g.iv)(yr.dropdownText)},"Keep existing colors"):d.createElement(ColorSwatch,{color:e,selected:!1,small:!0}),d.createElement(pe.Z,{className:(0,g.iv)(yr.colorButtonCaret),icon:"chevron-down"})):d.createElement(ColorSwatch,{color:e,selected:!1})))}const yr=g.mM.create({colorSwatch:{height:"25px",width:"25px",padding:"0"},pointerCursor:{cursor:"pointer"},smallColorSwatch:{width:"16px",height:"16px"},swatchRow:{margin:"0 0 5px 0"},swatchCol:{display:"inline-block",paddingLeft:"0px",paddingRight:"0px",marginRight:"5px"},popover:{maxWidth:"276px"},popoverContent:{padding:"10px 10px"},title:{margin:"0",padding:"8px 14px",fontSize:"12px",fontWeight:"normal",lineHeight:"18px",backgroundColor:"#f7f7f7",borderBottom:"1px solid #ebebeb",borderRadius:"5px 5px 0 0"},asDropdownButton:{width:"172px",display:"flex",cursor:"pointer",alignItems:"center",justifyContent:"space-between"},dropdownText:{..._n.cf,textTransform:"none"},colorButtonCaret:{color:Vt.pp}})
function VisibilityToggle({isVisible:e,onClick:t}){return d.createElement(pe.Z,{className:(0,g.iv)(br.visibilityIcon),icon:e?"eye":"eye-slash",onClick:t})}const br=g.mM.create({visibilityIcon:{color:Vt.TG,cursor:"pointer"}})
var Tr=n(63573),vr=n(849109)
const Cr=[{header:"Name",accessorKey:"nameElement",isSortable:!0,sortKey:"name"},{header:"Type",accessorKey:"type",isSortable:!0,sortKey:"type"},{header:"Start",accessorKey:"start",isSortable:!0,sortKey:"start"},{header:"End",accessorKey:"end",isSortable:!0,sortKey:"end"},{header:"Length",accessorKey:"length",isSortable:!0,sortKey:"length"},{header:"Strand",accessorKey:"strand",isSortable:!0,sortKey:"strandSort"},{header:"Color",accessorKey:"colorElement",isSortable:!0,sortKey:"color"},{header:"Notes",accessorKey:"notes",isSortable:!0,sortKey:"notesSort"},{header:"Custom fields",accessorKey:"customFieldsElement",isSortable:!1,width:300}]
function VisibilityAndNameCell({name:e,isVisible:t,onChangeVisibility:n}){return d.createElement("div",{className:(0,g.iv)(Ir.nameCell)},d.createElement(VisibilityToggle,{isVisible:t,onClick:n}),d.createElement("p",{className:(0,g.iv)(Ir.nameContents)},e))}function AnnotationTable({annotations:e,selectedIds:t,setSelectedIds:n,allowFeatureEdits:a,onToggleVisibility:i}){const s=e.map((e=>function getAnnotationRow({annotationData:e,selectedIds:t,onToggleVisibility:n}){return{id:e.cid,isSelected:t.includes(e.cid),data:{id:e.cid,name:e.name,nameElement:d.createElement(VisibilityAndNameCell,{name:e.name,isVisible:e.visible,onChangeVisibility:()=>{n([e.cid],!e.visible)}}),type:e.annotation_type,start:e.displayStart,end:e.displayEnd,length:e.length,strand:(0,An.FC)(e.strand),strandSort:e.strand,color:e.color,colorElement:d.createElement(ColorSwatch,{color:e.color,selected:!1,small:!0}),notes:d.createElement("div",{className:(0,g.iv)(Ir.notesCell)},e.notes),notesSort:e.notes,customFieldsElement:d.createElement(FeatureTableChipList,{items:e.custom_fields.map((({name:e,value:t})=>`${e}: ${t}`))}),customFields:e.custom_fields}}}({annotationData:e,selectedIds:t,onToggleVisibility:i})))
return d.createElement(vr.ZP,{className:(0,g.iv)(Ir.table),canResizeColumns:!0,isCompact:!0,columns:Cr,emptyTableText:"This sequence has no annotations",initialRows:s,initialSort:[{sortKey:"start"}],getSortValue:(e,t)=>e.data[t],tableKey:Tr.Uw.EXPANDED_ANNOTATION_TABLE,rowSelectionMode:Tr.rT.MULTIPLE,disableSelection:!a,onRowsSelect:function handleSelection(e,a){const i=e.map((e=>e.id))
if(a){const e=i.filter((e=>!t.includes(e)))
n([...t,...e])}else n(t.filter((e=>!i.includes(e))))},matchParentHeight:!0,getRowContentHeight:function getRowHeight(e){return e>=s.length?Tr._5:(0,Er.m2)(s[e].data.customFields.length,Za.TK.TABLE_CELL)}})}const Ir=g.mM.create({table:{height:"100%"},nameCell:{display:"inline-flex",alignItems:"center"},nameContents:{marginLeft:"8px",marginBottom:"0"},notesCell:{overflow:"hidden",textOverflow:"ellipsis"}})
var wr=n(606903),Nr=n(297020),Ar=n(472347)
function AnnotationTypeVisibilityDropdown({annotations:e,onToggleVisibility:t,useCompactSize:n=!1}){const a=[],i=[],s=(0,Jt.vM)(e,(e=>e.annotation_type))
for(const[e,t]of Object.entries(s))if(e){t.every((e=>!e.visible))&&a.push(e)
i.push(e)}const r=[...i].map((e=>({name:e,value:e,icon:"check",iconClassName:a.includes(e)?"is-selected":void 0}))),o=d.createElement(Ar.Z,{scrollable:!0,isMulti:!0,onSelect:e=>{t(s[e].map((e=>e.cid)),a.includes(e))},selectedValue:[...a],optionDatas:r,getMatchingOptionDatas:e=>r.filter((t=>t.value.includes(e))),height:Nr.Bl.MEDIUM,width:Nr.zL.MEDIUM})
function clearFilters(){t(e.map((e=>e.cid)),!0)}return d.createElement("div",{className:(0,g.iv)(Rr.filterContainer)},d.createElement(I.ZP,{menu:o,closeOnInsideClick:!1},d.createElement(C.Co,{size:C.qE.SMALL,buttonStyle:a?C.ZJ.TERTIARY_GRAY:C.ZJ.TERTIARY_BLUE_POWDER,text:0===a.length?"Visibility filter":`Visibility filter: ${a.length} ${(0,de._6)(a.length,"type")} hidden`,isDropdown:!0})),a.length>0&&(n?d.createElement(pe.Z,{className:(0,g.iv)(Rr.clearIcon),icon:"panel-hidden",onClick:clearFilters}):d.createElement("div",{className:(0,g.iv)(Rr.clearButton)},d.createElement(wr.Z,{onClear:clearFilters}))))}const Rr=g.mM.create({filterContainer:{display:"flex"},clearIcon:{width:"14px",height:"14px",color:Vt.pp,margin:"auto 0 auto 4px",cursor:"pointer"},clearButton:{margin:"auto 0 auto 4px"}})
var Pr=n(691012)
const Or=g.mM.create({titleContainer:{display:"flex",alignItems:"center"},titleText:{marginRight:"8px",fontWeight:_n.hS},titleIcon:{color:Vt.pp,width:"14px",height:"14px"},modalContentContainer:{marginTop:"16px"},bodyText:{marginBottom:"16px"}}),xr=function BulkEditModal({onRequestClose:e,collectionName:t,featureNames:n,onClickSave:a,children:i}){return d.createElement(et.ZP,{title:d.createElement("div",{className:(0,g.iv)(Or.titleContainer)},d.createElement("span",{className:(0,g.iv)(Or.titleText)},`Bulk edit ${t}s`),d.createElement(P.ZP,{title:"Other fields cannot be edited in bulk for data integrity purposes."},d.createElement(pe.Z,{className:(0,g.iv)(Or.titleIcon),icon:"info-circle"}))),wrapInForm:!1,onRequestClose:e,buttons:[{text:"Cancel",cancel:!0},{text:"Save",submit:!0,onClick:a}]},d.createElement("p",{className:(0,g.iv)(Or.bodyText)},`Changes to field values apply to all selected ${t}s.`),d.createElement("p",null,`You are editing ${n.length} ${(0,de._6)(n.length,t)}: ${n.join(", ")}.`),d.createElement("div",{className:(0,g.iv)(Or.modalContentContainer)},i))},_r=[1,-1,0],Dr=[1,-1],Lr="Keep existing strands"
const kr=g.mM.create({buttonCaret:{color:Vt.pp,marginLeft:"5px"}}),Mr=function StrandDropdown({className:e,strand:t,onSelectStrand:n,disabled:a,isMenuOpen:i,onToggleMenuOpen:s,allowNone:r=!0,includeNullOption:o=!1}){return d.createElement("div",{className:e,...(0,ee.Z)({component:"StrandDropdown",element:"root"})},d.createElement(I.ZP,{alwaysDropDown:!0,menu:d.createElement(w.ZP,{value:t,width:Nr.zL.FULL},o&&d.createElement(N.Z,{onSelect:n,value:null},Lr),(r?_r:Dr).map((e=>d.createElement(N.Z,{onSelect:n,value:e,key:e},(0,An.FC)(e))))),isOpen:i,onToggle:s},d.createElement("button",{className:f()("btn-af-default","selectDropdown-button",{"is-disabled":a}),type:"button",disabled:a,...(0,ee.Z)({component:"StrandDropdown",element:"input"})},d.createElement("span",{className:"u-lr-split"},d.createElement("span",{className:"selectDropdown-text"},null==t?Lr:(0,An.FC)(t)),d.createElement(pe.Z,{className:(0,g.iv)(kr.buttonCaret),icon:"chevron-down"})))))}
var Fr=n(801455)
const Zr="Keep existing types"
function AnnotationTypeDropdownInput({className:e,type:t,allTypes:n,onChangeType:a,onBlur:i,includeNullOption:s=!1,disabled:r=!1}){const[o,l]=(0,d.useState)(!1),c=n.filter((e=>e.includes(null!=t?t:""))),u=s?[...c,Zr]:c
return d.createElement(I.ZP,{alwaysDropDown:!0,isOpen:o&&u.length>0,menu:d.createElement(w.ZP,{value:t||Zr,height:Nr.Bl.MEDIUM,width:Nr.zL.FULL,scrollable:!0},u.map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:e=>{a(e===Zr?null:e)}},e)))),onToggle:l},d.createElement(or.Z,{className:e,onChange:e=>{a(e.target.value)},onFocus:()=>{r||l(!0)},onBlur:()=>{l(!1)
null==i||i()},placeholder:"Annotation type",value:s&&null==t&&!o?Zr:null!=t?t:"",disabled:r}))}function AnnotationBulkEditModalContent({isSingleStranded:e,allAnnotationTypes:t,typeProps:n,strandProps:a,colorProps:i}){return d.createElement("div",{className:(0,g.iv)(Br.formContainer)},d.createElement(Ke.Z,{className:(0,g.iv)(Br.inputColumn)},d.createElement(Fr.Z,{className:(0,g.iv)(Br.label),label:"Annotation type"}),d.createElement(AnnotationTypeDropdownInput,{type:n.value,allTypes:t,onChangeType:n.setValue,includeNullOption:!n.allSameValue})),d.createElement(Ke.Z,{className:(0,g.iv)(Br.inputColumn)},d.createElement(Fr.Z,{className:(0,g.iv)(Br.label),label:"Strand"}),d.createElement(Mr,{strand:a.value,onSelectStrand:a.setValue,includeNullOption:!a.allSameValue,disabled:e})),d.createElement(Ke.Z,{className:(0,g.iv)(Br.lastColumn)},d.createElement(Fr.Z,{className:(0,g.iv)(Br.label),label:"Color"}),d.createElement(PopoverColorPicker,{selectedColor:i.value,onSelectColor:i.setValue,asDropdown:!0})))}function AnnotationBulkEditModal({selectedAnnotations:e,allAnnotationTypes:t,isSingleStranded:n,bulkEditAnnotations:a,onRequestClose:i}){const s=e[0],r=getAllSameAttribute("strand"),o=getAllSameAttribute("annotation_type"),l=getAllSameAttribute("color"),[c,u]=(0,d.useState)(r?s.strand:null),[m,p]=(0,d.useState)(getAllSameAttribute("annotation_type")?s.annotation_type:null),[h,g]=(0,d.useState)(getAllSameAttribute("color")?s.color:null)
function getAllSameAttribute(t){return e.every((e=>e[t]===s[t]))}return d.createElement(xr,{onRequestClose:i,collectionName:"annotation",featureNames:e.map((({name:e})=>e)),onClickSave:function onClickSave(){const e=null!=c&&!(r&&c===s.strand),t=null!=m&&!(o&&m===s.annotation_type),n=null!=h&&!(l&&h===s.color)
if(e||t||n){const i={...e&&{strand:c},...t&&{annotation_type:m},...n&&{color:h}}
a(i)}i()}},d.createElement(AnnotationBulkEditModalContent,{isSingleStranded:n,allAnnotationTypes:t,strandProps:{value:c,setValue:u,allSameValue:r},typeProps:{value:m,setValue:p,allSameValue:o},colorProps:{value:h,setValue:g,allSameValue:l}}))}const Br=g.mM.create({formContainer:{display:"flex"},label:{display:"block"},inputColumn:{width:"171px",marginRight:"16px"},lastColumn:{width:"171px"}})
function ExpandedAnnotationTab({annotations:e,allowFeatureEdits:t,saveAnnotationsAsFeatures:n,runCrispr:a,deleteAnnotations:i,bulkEditAnnotations:s,crisprInProgress:r,isSingleStranded:o,onToggleVisibility:l}){const c=(0,d.useRef)(null),[u,m]=(0,d.useState)([]),p=(0,Jt.Pe)(e,(e=>e.cid)),h=u.filter((e=>{var t
return!(null===(t=p[e])||void 0===t?void 0:t.editable)})),E=e.filter((({visible:e})=>!e)).length;(0,d.useEffect)((()=>{t||m([])}),[t])
return d.createElement("div",{className:(0,g.iv)(qr.tabContainer),...(0,ee.Z)({component:"ExpandedAnnotationTab",element:"root"})},d.createElement("div",{className:(0,g.iv)(qr.tabHeaderContainer)},d.createElement("p",{className:(0,g.iv)(qr.tabHeader)},"Annotations"),d.createElement("p",{className:(0,g.iv)(qr.tabSubheader)},`${e.length} total${E>0?`, ${E} hidden`:""}`)),d.createElement("div",{className:(0,g.iv)(qr.actionsContainer)},d.createElement(Pr.Z,null,d.createElement(AnnotationTypeVisibilityDropdown,{annotations:e,onToggleVisibility:l})),d.createElement("div",{className:(0,g.iv)(qr.buttonsContainer)},h.length>0&&d.createElement("div",{className:(0,g.iv)(qr.partsInfoContainer)},d.createElement("p",{className:(0,g.iv)(qr.partsInfoText)},`${h.length} ${(0,de._6)(h.length,"part annotation")} selected`),d.createElement(P.ZP,{title:"Cannot edit or delete annotations that are inside parts"},d.createElement(pe.Z,{icon:"info-circle"}))),d.createElement(Pr.Z,null,d.createElement(P.ZP,{title:"Edit"},d.createElement(C.Co,{icon:"edit",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:()=>{(0,Xn.Z)(AnnotationBulkEditModal,{selectedAnnotations:u.map((e=>p[e])),isSingleStranded:o,allAnnotationTypes:getUniqueNonEmptyAnnotationTypes(e),bulkEditAnnotations:e=>{s(u,e)}})},disabled:!t||0===u.length||h.length>0})),d.createElement(P.ZP,{title:"Save to feature library"},d.createElement(C.Co,{icon:"save",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:()=>{n(u)},disabled:0===u.length})),a&&d.createElement(P.ZP,{title:"Design CRISPR guides",ref:c},d.createElement(C.Co,{icon:"crispr",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:()=>{var e
a(u)
null===(e=c.current)||void 0===e||e.$tooltip("hide")},disabled:!t||0===u.length||r})),d.createElement(P.ZP,{title:"Delete"},d.createElement(C.Co,{icon:"delete",buttonStyle:C.ZJ.NEGATIVE,size:C.qE.SMALL,onClick:()=>{i(u)
m([])},disabled:!t||0===u.length||h.length>0}))))),d.createElement(AnnotationTable,{annotations:e,selectedIds:u,setSelectedIds:m,allowFeatureEdits:t,onToggleVisibility:l}))}const qr=g.mM.create({tabContainer:{height:"100%",display:"flex",flexDirection:"column"},tabHeaderContainer:{display:"flex",alignItems:"baseline"},tabHeader:_n.Oo,tabSubheader:{color:Vt.pp,marginLeft:"10px"},actionsContainer:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},buttonsContainer:{display:"flex"},partsInfoContainer:{display:"flex",alignItems:"center",marginRight:"8px",color:Vt.pp},partsInfoText:{marginBottom:"0",marginRight:"4px"}})
var Vr=n(533132),Ur=n(351893),Gr=n(716959),zr=n(571489),$r=n(954240),Wr=n(6193)
function SaveAnnotationsAsFeaturesModal({annotationCount:e,onRequestSubmit:t,onRequestClose:n}){const a=(0,Wr.dw)(zr.h),[i,s]=(0,d.useState)();(0,d.useEffect)((()=>{if(a.status===Wr.Lr.ERROR){v.ZP.error("Encountered error loading feature libraries.")
n()}else if(a.status===Wr.Lr.SUCCESS){const e=a.data.filter((e=>e.permissions.writable))
e.length>0&&s(e[0])}}),[a,n])
const r={title:e>1?`Save ${e} Annotations to Feature Library`:"Save Annotation to Feature Library",onRequestClose:n,onRequestSubmit:()=>{t(i.id)},buttons:[{text:"Save Features",submit:!0,disabled:null==i},{text:"Cancel",cancel:!0}]}
if(a.status===Wr.Lr.SUCCESS){const e=null==i?"No feature library selected":(0,Bn.s1)(i)
return d.createElement(et.ZP,{...r},d.createElement($r.ZP,{displayName:e,menu:d.createElement(Ar.Z,{optionDatas:a.data.map((e=>({name:(0,Bn.s1)(e),value:e,metadata:e.description,disabled:!e.permissions.writable,disabledMessage:"You do not have sufficient permissions to write to this feature library."}))),onSelect:s,selectedValue:i,width:Nr.zL.FULL})}))}return d.createElement(et.ZP,{...r},d.createElement(Lt.Z,null))}var Hr=n(10584)
const{isLeftPam:jr}=fi
class AnnotationsTableTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}initialize(){this.sequence=this.model.get("sequence")
this.annotations=this.sequence.annotations()
this.selection=this.sequence.get("selection")
this.handleStoreChangeListener=null
this.listenTo(this.annotations,"add remove change reset",(()=>{this.render()}))
this.listenTo(this.annotations._annotations,"add remove change reset",(()=>{this.render()}))
this.listenTo(this.sequence,"change:writable change:permissions change:currentVersion",(()=>{this.render()}))
this.listenTo(this.sequence.get("_sequence"),"change:startIndex change:locked",(()=>{this.render()}))}handleRunCrispr(e){(0,S.Gp)(null==this.handleStoreChangeListener,"Did not expect to run CRISPR from annotations table while CRISPR is already running")
const t=l.default.uniqueId("crispr-analysis-")
this.handleStoreChangeListener=()=>{t in Ur.Z.cidIdMap&&this.handleCrisprAnalysisStoreChange(t,ve.ZP.get())}
!function runCrisprOnAnnotations(e,t,n,a){Ur.Z.addChangeListener(n)
const i=Ei.Z.getDefaults(),s=new $a.C
s.addSequences([a])
s.set({sequence:a})
const r={analysis:i,search:s,sequence:a},o=e.map((e=>({start:e.start(),end:e.end()})))
Vr.Z.createWithRegions(t,{...i,sequence:a.id,name:`Untitled ${(0,Hr.UT)(new Date)}`,isLeftPam:jr(i.pam)},r,o)}(e,t,this.handleStoreChangeListener,this.sequence)
this.render()}handleCrisprAnalysisStoreChange(e,t){const{cidIdMap:n}=Ur.Z.getState(),a=null!=n?n[e]:void 0
if(null!=a){Ur.Z.removeChangeListener(this.handleStoreChangeListener)
this.handleStoreChangeListener=null
!function openCrisprTab(e,t,n){l.default.defer((()=>{const a=t.get(n),i=a.findTab(Gr.Z,(t=>t.analysisId()===e))
if(null!=i)i.set({active:!0})
else{const t=a.model()
a.buffers().addTab(new Gr.Z({analysisId:e,sequence:t}))}}))}(a,t,this.sequence.id)
this.render()}}bulkEditAnnotations(e,t){for(const n of e){const e=n.get("_annotation"),a=e.validate({...e.toJSON(),...t},{sequence:this.sequence})
if(a){v.ZP.error(a)
return}}const n=e.map((e=>({id:e.id,...t})))
this.annotations._annotations.bulkUpdate(n,{fileUpdate:!0}).fail((e=>{v.ZP.notifyError(e)})).done((({updated:e,message:t})=>{m.j("annotation","updated_annotations",{source:"annotations-table",sequence_api_id:this.sequence.id,annotation_count:e.length})
this.sequence.updateVersions()
v.ZP.success(t)}))}update(){}remove(){super.remove()
return this}render(){const e=(0,Jt.Pe)(this.annotations.models,(e=>e.cid));(0,Me.A9)(d.createElement(ExpandedAnnotationTab,{annotations:this.annotations.map((e=>getAnnotationData(e,this.sequence))),allowFeatureEdits:this.sequence.allowFeatureEdits(),saveAnnotationsAsFeatures:t=>{!async function saveAnnotationsAsFeatures(e,t){const n=await(0,Xn.Z)(SaveAnnotationsAsFeaturesModal,{annotationCount:e.length})
if(null!=n){const a=e.map((e=>Promise.resolve((0,Bn.FR)(e,t,n).fail((t=>{const n=v.ZP.getFriendlyError(t)
v.ZP.error(`Error adding **${e.name()}** to library: ${n}`)}))))),i=(await Promise.allSettled(a)).filter((e=>"fulfilled"===e.status)).length
if(i>0){const e=1===i?"1 feature successfully created.":`${i} features successfully created.`
v.ZP.success(e)}}}(t.map((t=>e[t])),this.sequence)},runCrispr:this.sequence.supportsCRISPR()?t=>{this.handleRunCrispr(t.map((t=>e[t].get("_annotation"))))}:null,deleteAnnotations:t=>{!function deleteAnnotations(e,t,n){e._annotations.bulkDelete(t,{fileUpdate:!0}).fail(v.ZP.notifyError).done((({message:e,deleted:t})=>{m.j("annotation","deleted_annotations",{source:"annotations-table",sequence_api_id:n.id,annotation_count:t})
n.updateVersions()
v.ZP.success(e)}))}(this.annotations,t.map((t=>e[t].get("_annotation"))),this.sequence)},bulkEditAnnotations:(t,n)=>{this.bulkEditAnnotations(t.map((t=>e[t])),n)},crisprInProgress:null!=this.handleStoreChangeListener,isSingleStranded:this.sequence.isSingleStranded(),onToggleVisibility:(t,n)=>{m.j("annotation","toggled_visibility",{source:"annotations-table",sequence_id:this.sequence.id,annotation_count:t.length,visible:n})
this.sequence.annotations().batchModify((()=>{for(const a of t)e[a].set({visible:n})}))}}),this.el)
return this}}AnnotationsTableTabView.initClass()
var Yr=n(301008)
const Qr=(0,be.Z)((function FragmentRow({start:e,end:t,length:n,leftCutterName:a,leftCutterOverhang:i,rightCutterName:s,rightCutterOverhang:r}){return d.createElement(d.Fragment,null,d.createElement("td",{...(0,ee.Z)({component:"FragmentRow",element:"start"})},e),d.createElement("td",null,t),d.createElement("td",null,n),d.createElement("td",null,a),d.createElement("td",null,i),d.createElement("td",null,s),d.createElement("td",null,r))}))
const Kr=(0,be.Z)((function DigestTab(){return d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12 digesttab",...(0,ee.Z)({component:"DigestTab",element:"root"})},d.createElement("div",{className:"enzymes"}),d.createElement("div",{className:"fragments"},d.createElement("table",{className:"table table-hover table-condensed fragments-table"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Start"),d.createElement("th",null,"End"),d.createElement("th",null,"Length"),d.createElement("th",null,"Left Cutter"),d.createElement("th",null,"Left Overhang"),d.createElement("th",null,"Right Cutter"),d.createElement("th",null,"Right Overhang"))),d.createElement("tbody",null)))))}))
const Jr=(0,be.Z)((function DigestMenu(){return d.createElement("ul",{className:"nav navbar-nav form-inline digest-menu"},d.createElement("li",null,d.createElement("input",{type:"text",className:"tab-name",defaultValue:"Digest"}),d.createElement("button",{type:"button",className:"button button--tertiaryGray button--mini save"},"Save")),d.createElement("li",{className:"enzymes-providers-mount pull-right"}))}))
function DigestView_ownKeys(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e)
t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function DigestView_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?DigestView_ownKeys(Object(n),!0).forEach((function(t){DigestView_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DigestView_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function DigestView_defineProperty(e,t,n){(t=function DigestView_toPropertyKey(e){var t=function DigestView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class OptionsView extends s().View{static initClass(){this.prototype.tagName="div"
this.prototype.className="navbar"
this.prototype.template=Jr
this.prototype.events={"click .save":"save","keypress .tab-name":"checkEnter","keyup .tab-name":"setFromText"}}initialize(e){this.updateProvider=this.updateProvider.bind(this)
this.sequence=this.model.get("sequence")
this.listenTo(this.model.get("analysis"),"change:provider",this.renderProviderSelector)}setFromText(){this.model.set("title",this.name.val().trim())}checkEnter(e){13===e.which&&this.save()}save(){if(!this.model.get("sequence").allowFeatureEdits())return
this.$(".save").button("loading")
const e=this.model.get("analysis")
e.set("name",this.name.val().trim())
const t=e.isNew()?"saved":"updated"
this.sequence.get("analyses").betterCreate(e).always((()=>this.$(".save").button("reset"))).done((()=>{v.ZP.success(`Digest **${this.name.val()}** successfully ${t}.`)
m.j("digest","saved_digest",{name:e.get("name")})})).fail(v.ZP.notifyError)}updateProvider(e){this.model.get("analysis").set({provider:e.name})}renderProviderSelector(){const e=this.model.get("analysis"),t=this.sequence.allowFeatureEdits(),n=xe.Aq(e.get("enzymes")),a=e.provider();(0,Me.A9)(d.createElement(Le,{inline:!0,providers:n,value:a,onChange:t?this.updateProvider:void 0}),this.$el.find(".enzymes-providers-mount")[0])}render(){this.$el.html(this.template())
this.renderProviderSelector()
this.name=this.$el.find(".tab-name")
if(this.sequence.allowFeatureEdits())this.name.bind("keypress",this.saveFromText)
else{this.name.prop("readonly",!0)
this.$(".save").addClass("disabled").text("Save (disabled in read-only mode)")}this.$(".save").attr({type:"button","data-loading-text":"Saving..."})
this.name.val(this.model.get("analysis").get("name"))
return this}}OptionsView.initClass()
class FragmentRowView extends s().View{static initClass(){this.prototype.tagName="tr"
this.prototype.template=Qr
this.prototype.events={mousedown:"selectFragment",contextmenu:"contextMenu"}
this.prototype.attributes=DigestView_objectSpread(DigestView_objectSpread({},this.prototype.attributes),(0,ee.Z)({component:"FragmentRow",element:"row"}))}initialize(e){this.sequence=e.sequence
this.listenTo(this.model,"change:selected",this.handleSelectedChange)}contextMenu(e){SelectionContextMenu_open(e,this.sequence,aa)}selectFragment(){this.sequence.selectFragment(this.model)}handleSelectedChange(e,t){this.$el.toggleClass("active",t)}render(){const e=this.model.leftOverhang()
let t=DigestView_guard_(this.model.get("_cutter5"),(e=>e.name))
t=null!=t?t:"None"
const n=this.model.rightOverhang()
let a=DigestView_guard_(this.model.get("_cutter3"),(e=>e.name))
a=null!=a?a:"None"
const[i,s]=Array.from(T.modelRangeToDisplay(this.model.get("start"),this.model.get("end"),this.sequence.length(),this.sequence.startIndex()))
this.$el.html(this.template({start:i,end:s,length:this.model.get("length"),leftCutterName:t,leftCutterOverhang:e,rightCutterName:a,rightCutterOverhang:n}))
this.model.get("selected")&&this.$el.addClass("active")
return this}}FragmentRowView.initClass()
class TabView extends s().View{static initClass(){this.prototype.template=Kr
this.prototype.className="buffer-tab"
this.prototype.events={"click tr":"selectFragment"}}initialize(e){this.sequence=this.model.get("sequence")
this._sequence=this.sequence.get("_sequence")
this.listenTo(this._sequence,"change:circular change:bases change:startIndex",this.render)
this.listenTo(this.model,"change:fragments",this.render)
this.listenTo(this.model.get("analysis"),"change:provider",this.renderEnzymes)
this.rows=[]}renderEnzymes(){const e=this.model.get("analysis").provider(),t=this.model.get("analysis").get("enzymes"),n=this.sequence.get("enzymes").getEnzymesJSON(t);(0,Me.A9)(d.createElement(_e,{provider:e,enzymes:n}),this.$el.find(".enzymes")[0])}render(){const e=this.model.get("analysis").get("enzymes"),t=this.sequence.get("enzymes").getEnzymesJSON(e)
this.$el.html(this.template())
this.renderEnzymes()
if(0!==t.length){const e=this.model.get("analysis").get("fragments")
for(const t of Array.from(e.models)){const e=new FragmentRowView({model:t,sequence:this.sequence})
this.rows.push(e)
this.$el.find(".fragments-table tbody").append(e.render().el)}}return this}remove(){for(const e of Array.from(this.rows))e.stopListening()
return super.remove()}}TabView.initClass()
function DigestView_guard_(e,t){return null!=e?t(e):void 0}var Xr=n(259222),eo=n(551705),to=n(392965),no=n(484832),ao=n(690267),io=n(383628),so=n(73374)
function MeltingTempModal({isOligo:e,nucleotideType:t,onRequestClose:n,onRequestSubmit:a}){const[i,s]=(0,d.useState)(We.Z.get(tn.gq.MELTING_TEMP_DNA)),[r,o]=(0,d.useState)(We.Z.get(tn.gq.MELTING_TEMP_RNA)),[l,c]=(0,d.useState)(ao.y),[u,m]=(0,d.useState)(ao.y),p=t===R.Wy.DNA?"T":"U",h=t===R.Wy.DNA?"U":"T"
return d.createElement(et.ZP,{title:"Adjust Thermodynamic Parameters",buttons:[{text:"Save",submit:!0,disabled:Object.values(l).some((e=>e))||Object.values(u).some((e=>e))}],onRequestClose:n,onRequestSubmit:()=>{We.Z.set(tn.gq.MELTING_TEMP_DNA,i)
We.Z.set(tn.gq.MELTING_TEMP_RNA,r)
a()}},d.createElement("div",{className:f()(["form-inline",(0,g.iv)(ro.container)])},d.createElement(so.zV,{className:(0,g.iv)(ro.header)},"DNA"),d.createElement(no.Z,{optionsHaveValidationError:l,meltingTempOptions:i,nucleotideType:R.Wy.DNA,setMeltingTempOptions:s,setOptionsHaveValidationError:c})),d.createElement("div",{className:f()(["form-inline",(0,g.iv)(ro.container)])},d.createElement(so.zV,{className:(0,g.iv)(ro.header)},"RNA"),d.createElement(no.Z,{optionsHaveValidationError:u,meltingTempOptions:r,nucleotideType:R.Wy.RNA,setMeltingTempOptions:o,setOptionsHaveValidationError:m})),e&&t&&(0,yn.JG)()&&d.createElement(io.ZP,{bannerType:io.ct.INFO,text:`When calculating melting temperature for a ${t} oligo, ${h}s are treated as ${p}s.`}))}const ro=g.mM.create({container:{margin:"10px",paddingBottom:"10px"},header:{paddingBottom:"5px"}})
var oo=n(938417),lo=n(216101)
function CheckPrimer_checkPrimer(e,t,n,a,i){Cn.xA(`/1/api/sequences/${e}/check`,{bases:t}).done((e=>{let t=l.default.filter(e,(e=>a!==e.id))
if(0!==t.length){let e,i
t=l.default.map(t,(e=>`<b>${l.default.escape(e.name)}</b>`))
if(t.length>2){t[t.length-2]=`${t[t.length-2]}, and ${t[t.length-1]}`
t.length-=1
i=t.join(", ")}else i=t.join(" and ")
e=null!=a?`This primer is also attached to ${i}. Editing its bases may affect other binding sites.`:`This primer is attached to ${i}. Editing its bases may affect binding sites.`
new Ot.I4({title:"Primer Edits",msg:e}).choice("Save","btn-af-success",n).choice("Cancel","btn-af-default").show()}else n()})).fail(i)}const co=(0,be.Z)((function AssemblyPrimerHelp({isGibson:e,isGoldenGate:t}){return d.createElement(d.Fragment,null,t&&d.createElement(d.Fragment,null,d.createElement("p",{className:"u-small-text help-block u-no-spacing-bottom"},"Recognition site in ",d.createElement("span",{className:"primer-base-recognition-site"},"bold"),". Sticky end in"," ",d.createElement("span",{className:"primer-base-sticky-end"},"blue"),". Bases that bind to parent"," ",d.createElement("span",{className:"primer-base-match"},"highlighted"),"."),d.createElement("p",{className:"u-small-text help-block u-no-spacing-bottom"},"For point mutations, perform replacements on the sequence map."),d.createElement("p",{className:"u-small-text help-block u-no-spacing-bottom"},"To insert spacers, click the ",d.createElement("span",{className:"glyphicon glyphicon-sound-stereo"})," icon on any fragment before creating the assembly.")),e&&d.createElement("p",{className:"u-small-text help-block u-no-spacing-bottom"},"For spacers or mismatches, perform edits directly on the sequence map."))}))
const uo=(0,be.Z)((function EditPrimerOptions({single:e}){return d.createElement("ul",{className:"nav navbar-nav"},d.createElement("li",null,d.createElement("select",null,d.createElement("option",{value:"1"},"Single Primer"),d.createElement("option",{value:"2"},"Primer Pair"))),d.createElement("li",{className:"pull-right"},d.createElement("div",{className:"buttonGroup"},e?d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,className:"js-jump",text:"Jump to Primer"}):d.createElement("div",{className:"buttonGroup"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,type:"button",isDropdown:!0,text:"Jump to Primer"}),d.createElement("ul",{className:"dropdown-menu pull-right"},d.createElement("li",null,d.createElement("a",{className:"js-jump"},"Forward")),d.createElement("li",null,d.createElement("a",{className:"js-jump-reverse"},"Reverse")))),d.createElement("div",{className:"buttonGroup"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MINI,type:"button",isDropdown:!0,text:"Set from Selection"}),d.createElement("ul",{className:"dropdown-menu pull-right"},d.createElement("li",{className:"js-read-selection-forward"},d.createElement("a",null,"Forward")),d.createElement("li",{className:"js-read-selection-reverse"},d.createElement("a",null,"Reverse")))))))}))
var mo=n(257846)
function EditPrimerBasesWarning(){const e=["annotations"]
dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES&&e.push("chemical modifications");(0,yn.JG)()&&e.push("U/T mixed bases")
if(0===e.length)return null
const t=`Editing bases here will remove any existing ${mo.Z.getReadableStringFromList(e)}. As an alternative, open the oligo to edit directly.`
return d.createElement("div",{className:(0,g.iv)(po.bannerContainer)},d.createElement(io.ZP,{bannerType:io.ct.INFO,supportingInfo:t}))}const po=g.mM.create({bannerContainer:{width:"85%",marginBottom:"4px",marginLeft:"12px"}})
const ho=(0,be.Z)((function EditPrimerPair({assemblyPrimerHelp:e,enzymes:t,isGoldenGate:n,showEnzymes:a,primer1Exists:i,primer2Exists:s}){return d.createElement("form",{className:"buffer-content-container form-horizontal"},d.createElement("fieldset",null,d.createElement("legend",null,"Design"),d.createElement("div",{className:"row js-use-existing-primer-group use-existing-primer hidden"},d.createElement("div",{className:"col col-md-5 col-md-offset-2 js-use-existing-primer invisible"}),d.createElement("div",{"data-index":"1",className:"col col-md-5 js-use-existing-primer invisible"})),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-2 control-label"},"Strand"),d.createElement("div",{className:"col col-md-3"},d.createElement("div",{className:"input-field pair-strand"},"Forward")),d.createElement("div",{className:"col col-md-3 col-md-offset-2"},d.createElement("div",{className:"input-field pair-strand"},"Reverse"))),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-2 control-label"},"Bases"),d.createElement("div",{className:"col col-md-10"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-6"},i&&d.createElement(EditPrimerBasesWarning,null),d.createElement("div",{className:"sequence-primer-bases"},d.createElement("span",{className:"prime five-prime"},"5'"),d.createElement("div",{className:"primer-text-outer mono"},d.createElement("div",{contentEditable:!0,className:"primer-text"})),d.createElement("span",{className:"prime three-prime"},"3'"))),d.createElement("div",{className:"col col-md-6"},s&&d.createElement(EditPrimerBasesWarning,null),d.createElement("div",{className:"sequence-primer-bases"},d.createElement("span",{className:"prime five-prime"},"5'"),d.createElement("div",{className:"primer-text-outer mono"},d.createElement("div",{contentEditable:!0,"data-index":"1",className:"primer-text"})),d.createElement("span",{className:"prime three-prime"},"3'")))),d.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))),d.createElement("div",{className:"form-group too-short-msg-group"},d.createElement("div",{className:"col col-md-4 col-md-offset-2 too-short-msg"},d.createElement("p",{className:"error-msg"},"Primer must be at least 6 bp.")),d.createElement("div",{className:"col col-md-4 col-md-offset-1 too-short-msg"},d.createElement("p",{className:"error-msg"},"Primer must be at least 6 bp."))),d.createElement("div",{className:"row js-found-existing-primer-group hidden"},d.createElement("div",{className:"col col-md-5 col-md-offset-2 js-found-existing-primer invisible"}),d.createElement("div",{"data-index":"1",className:"col col-md-5 js-found-existing-primer invisible"})),d.createElement("div",{className:"form-group primer-position-group"},d.createElement("label",{className:"col-md-2 control-label"},"3' Location"),d.createElement("div",{className:"col col-md-3 primer-position"},d.createElement("input",{type:"number",name:"primer-start-position",placeholder:"3' end",className:"form-control js-primer-position"})),d.createElement("div",{className:"col col-md-3 col-md-offset-2 primer-position"},d.createElement("input",{type:"number",name:"primer-start-position",placeholder:"3' end","data-index":"1",className:"form-control js-primer-position"}))),d.createElement("div",{className:"form-group bad-location-msg-group hidden"},d.createElement("div",{className:"col col-md-4 col-md-offset-2 bad-location-msg invisible"},d.createElement("p",{className:"error-msg"},"Binding location should be within the sequence. Using bind location of"," ",d.createElement("span",{className:"location-num"})," instead.")),d.createElement("div",{className:"col col-md-4 col-md-offset-1 bad-location-msg invisible"},d.createElement("p",{className:"error-msg"},"Binding location should be within the sequence. Using bind location of"," ",d.createElement("span",{className:"location-num"})," instead."))),d.createElement("div",{className:"form-group overhang-group"},d.createElement("label",{className:"col-md-2 control-label"},"Overhang"),d.createElement("div",{className:"col col-md-3 overhang"},d.createElement("input",{type:"number",name:"primer-overhang-size",placeholder:"0 bp",min:"0",step:"1",className:"form-control js-overhang-size"})),d.createElement("div",{className:"col col-md-3 col-md-offset-2 overhang"},d.createElement("input",{type:"number",name:"primer-overhang-size",placeholder:"0 bp",min:"0",step:"1","data-index":"1",className:"form-control js-overhang-size"}))),d.createElement("div",{className:"form-group binding-group hidden"},d.createElement("label",{className:"col-md-2 control-label"},"Binding",n&&d.createElement(d.Fragment,null," ",d.createElement("a",{title:"Length of sequence-defined region",className:"glyphicon glyphicon-question-sign u-no-text-decoration"}))),d.createElement("div",{className:"col col-md-3 binding invisible"},d.createElement("input",{type:"number",name:"primer-binding",placeholder:"0 bp",min:"0",step:"1",className:"form-control js-binding"})),d.createElement("div",{className:"col col-md-3 col-md-offset-2 binding invisible"},d.createElement("input",{type:"number",name:"primer-binding",placeholder:"0 bp",min:"0",step:"1","data-index":"1",className:"form-control js-binding"}))),d.createElement("div",{className:"form-group homology-group hidden"},d.createElement("label",{className:"col-md-2 control-label"},"Overhang"),d.createElement("div",{className:"col col-md-3 homology invisible"},d.createElement("input",{type:"number",name:"primer-homology",placeholder:"0 bp",min:"0",step:"1",className:"form-control js-homology"})),d.createElement("div",{className:"col col-md-3 col-md-offset-2 homology invisible"},d.createElement("input",{type:"number",name:"primer-homology",placeholder:"0 bp",min:"0",step:"1","data-index":"1",className:"form-control js-homology"}))),d.createElement("div",{className:"form-group pre-recognition-site-group hidden"},d.createElement("label",{className:"col-md-2 control-label"},"Pre-recog. Site ",d.createElement("a",{title:"5' flanking bases before recognition site",className:"glyphicon glyphicon-question-sign u-no-text-decoration"})),d.createElement("div",{className:"col col-md-4 pre-recognition-site invisible"},d.createElement("input",{type:"text",name:"primer-pre-recognition-site",placeholder:"Enter the pre-recognition site bases",className:"form-control js-pre-recognition-site"})),d.createElement("div",{className:"col col-md-4 col-md-offset-1 pre-recognition-site invisible"},d.createElement("input",{type:"text",name:"primer-pre-recognition-site",placeholder:"Enter the pre-recognition site bases","data-index":"1",className:"form-control js-pre-recognition-site"}))),d.createElement("div",{className:"form-group pre-recognition-site-invalid-bases-msg-group hidden"},d.createElement("div",{className:"col col-md-4 col-md-offset-2 pre-recognition-site-invalid-bases-msg invisible"},d.createElement("p",{className:"error-msg"},"The pre-recognition site cannot contain the same bases as the recognition site.")),d.createElement("div",{className:"col col-md-4 col-md-offset-1 pre-recognition-site-invalid-bases-msg invisible"},d.createElement("p",{className:"error-msg"},"The pre-recognition site cannot contain the same bases as the recognition site."))),d.createElement("div",{className:"form-group post-recognition-site-group hidden"},d.createElement("label",{className:"col-md-2 control-label"},"Post-recog. Site ",d.createElement("a",{title:"Base(s) after recognition site",className:"glyphicon glyphicon-question-sign u-no-text-decoration"})),d.createElement("div",{className:"col col-md-4 post-recognition-site invisible"},d.createElement("input",{type:"text",name:"primer-post-recognition-site",placeholder:"Enter the post-recognition site bases",className:"form-control js-post-recognition-site"})),d.createElement("div",{className:"col col-md-4 col-md-offset-1 post-recognition-site invisible"},d.createElement("input",{type:"text",name:"primer-post-recognition-site",placeholder:"Enter the post-recognition site bases","data-index":"1",className:"form-control js-post-recognition-site"}))),d.createElement("div",{className:"form-group post-recognition-site-invalid-length-msg-group hidden"},d.createElement("div",{className:"col col-md-4 col-md-offset-2 post-recognition-site-invalid-length-msg invisible"},d.createElement("p",{className:"error-msg"},"The post-recognition site must be exactly ",d.createElement("span",{className:"valid-length"})," bp.")),d.createElement("div",{className:"col col-md-4 col-md-offset-1 post-recognition-site-invalid-length-msg invisible"},d.createElement("p",{className:"error-msg"},"The post-recognition site must be exactly ",d.createElement("span",{className:"valid-length"})," bp."))),d.createElement("div",{className:"form-group overhang-too-small-msg-group hidden"},d.createElement("div",{className:"col col-md-4 col-md-offset-2 overhang-too-small-msg invisible"},d.createElement("p",{className:"error-msg"},"Primer bases lying off of the sequence cannot be more than the overhang. Using overhang size of"," ",d.createElement("span",{className:"overhang-num"})," instead.")),d.createElement("div",{className:"col col-md-4 col-md-offset-1 overhang-too-small-msg invisible"},d.createElement("p",{className:"error-msg"},"Primer bases lying off of the sequence cannot be more than the overhang. Using overhang size of"," ",d.createElement("span",{className:"overhang-num"})," instead."))),d.createElement("div",{className:"form-group overhang-too-large-msg-group hidden"},d.createElement("div",{className:"col col-md-4 col-md-offset-2 overhang-too-large-msg invisible"},d.createElement("p",{className:"error-msg"},"Overhang size cannot be longer than primer size. Using overhang size of"," ",d.createElement("span",{className:"overhang-num"})," instead.")),d.createElement("div",{className:"col col-md-4 col-md-offset-1 overhang-too-large-msg invisible"},d.createElement("p",{className:"error-msg"},"Overhang size cannot be longer than primer size. Using overhang size of"," ",d.createElement("span",{className:"overhang-num"})," instead."))),a&&d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-2 control-label"},"Cut Site"),d.createElement("div",{className:"col col-md-10"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-4"},d.createElement("select",{className:"edit-primer-enzymes"},t.map((e=>d.createElement("option",{key:e.id,value:e.id},e.name))))),d.createElement("div",{className:"col col-md-4"},d.createElement("input",{type:"text",readOnly:!0,className:"form-control js-reference"}))),d.createElement("p",{className:"help-block"},"Use the dropdown above to look up restriction sites."))),d.createElement("div",{className:"form-group js-invalid-pair hidden"},d.createElement("p",{className:"error-msg"},"The specified primer pair does not result in a valid product. Make sure that the forward primer binds before the reverse primer if the sequence is linear."))),d.createElement("fieldset",null,d.createElement("legend",null,"Verify",d.createElement("div",{className:"pull-right"},d.createElement("div",{className:"secondary-temp"},d.createElement("button",{type:"button",className:"button button--small button--tertiaryGray js-check-secondary"},"Check Secondary Structure")," ","at ",d.createElement("input",{type:"text",placeholder:"37"}),"°C"))),d.createElement("div",{className:"row"},d.createElement("label",{className:"col-md-2 control-label"},Xi.Mg," ",d.createElement("span",{className:"settings glyphicon glyphicon-wrench js-tm-parameters u-pointer"})),d.createElement("div",{className:"col col-md-2 text-right js-tm input-field"}),d.createElement("div",{className:"col col-md-2 col-md-offset-3 text-right js-tm input-field"})),d.createElement("div",{className:"row"},d.createElement("label",{className:"col-md-2 control-label"},"GC Content"),d.createElement("div",{className:"col col-md-2 text-right js-gc input-field"}),d.createElement("div",{className:"col col-md-2 col-md-offset-3 text-right js-gc input-field"})),d.createElement("div",{className:"row"},d.createElement("label",{className:"col-md-2 control-label"},"Length"),d.createElement("div",{className:"col col-md-2 text-right js-length input-field"}),d.createElement("div",{className:"col col-md-2 col-md-offset-3 text-right js-length input-field"})),d.createElement("div",{className:"row js-secondary hidden"},d.createElement("label",{className:"col-md-2 control-label"},"Min ΔG Homodimer"),d.createElement("div",{className:"col col-md-2 text-right js-homodimer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{className:"col col-md-3 js-homodimer secondary-link invisible"},d.createElement("a",null,"All Structures")),d.createElement("div",{"data-index":"1",className:"col col-md-2 text-right js-homodimer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{"data-index":"1",className:"col col-md-3 js-homodimer secondary-link invisible"},d.createElement("a",null,"All Structures"))),d.createElement("div",{className:"row js-secondary hidden"},d.createElement("label",{className:"col-md-2 control-label"},"Min ΔG Monomer"),d.createElement("div",{className:"col col-md-2 text-right js-monomer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{className:"col col-md-3 js-monomer secondary-link invisible"},d.createElement("a",null,"All Structures")),d.createElement("div",{"data-index":"1",className:"col col-md-2 text-right js-monomer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{"data-index":"1",className:"col col-md-3 js-monomer secondary-link invisible"},d.createElement("a",null,"All Structures"))),d.createElement("hr",null),d.createElement("div",{className:"row"},d.createElement("label",{className:"col col-md-2 control-label"},"Product Size"),d.createElement("div",{className:"col col-md-2 text-right js-product-size input-field"},"--")),d.createElement("div",{className:"row"},d.createElement("label",{className:"col col-md-2 control-label"},Xi.Mg," Diff."),d.createElement("div",{className:"col col-md-2 text-right js-tm-diff input-field"},"--")),d.createElement("div",{className:"row js-secondary hidden"},d.createElement("label",{className:"col col-md-2 control-label heterodimer-title"},"Min ΔG Heterodimer"),d.createElement("div",{className:"col col-md-2 text-right js-heterodimer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{className:"col col-md-3 js-heterodimer secondary-link invisible"},d.createElement("a",null,"All Structures")))),d.createElement("fieldset",null,d.createElement("legend",null,"Save"),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-2 control-label"},"Name"),d.createElement("div",{className:"col col-md-4"},d.createElement("input",{type:"text",name:"primer-name",placeholder:"Enter a short name",className:"js-name"})),d.createElement("div",{className:"col col-md-1 text-right"},d.createElement("div",{className:"swatch-big"})),d.createElement("div",{className:"col col-md-4"},d.createElement("input",{type:"text",name:"primer-name",placeholder:"Enter a short name","data-index":"1",className:"js-name"})),d.createElement("div",{className:"col col-md-1 text-right"},d.createElement("div",{"data-index":"1",className:"swatch-big"}))),d.createElement("div",{className:"col col-md-5 col-md-offset-2 js-name-too-long invisible"},d.createElement("p",{className:"text-warning error-msg"},"The primer name you have selected is too long. Primer names can be at most"," ",tn.Jb," characters long.")),d.createElement("div",{className:"col col-md-5 js-name-too-long invisible"},d.createElement("p",{className:"text-warning error-msg"},"The primer name you have selected is too long. Primer names can be at most"," ",tn.Jb," characters long.")),d.createElement("div",{className:"form-group js-found-existing-name-group hidden"},d.createElement("div",{className:"col col-md-5 col-md-offset-2 js-found-existing-name invisible"},d.createElement("p",{className:"text-warning error-msg"},'A primer with name "',d.createElement("span",{className:"existing-name"}),'" already exists in the designated folder.')),d.createElement("div",{className:"col col-md-5 js-found-existing-name invisible"},d.createElement("p",{className:"text-warning error-msg"},'A primer with name "',d.createElement("span",{className:"existing-name"}),'" already exists in the designated folder.'))),d.createElement("div",{className:"form-group save-library-group"},d.createElement("label",{className:"col-md-2 control-label"},"Save To"),d.createElement("div",{className:"col col-md-4 save-library"},d.createElement("div",{className:"folder-selector-container"})),d.createElement("div",{className:"col col-md-4 col-md-offset-1 save-library"},d.createElement("div",{className:"folder-selector-container"}))),d.createElement("div",{className:"form-group"},d.createElement("div",{className:"col col-md-3 col-md-offset-8"},d.createElement("div",{className:"pull-right"},d.createElement("button",{type:"button",className:"button button--small button--primary is-disabled save-pair"},"Save Primer Pair"))))))}))
const go=(0,be.Z)((function EditPrimer({assemblyPrimerHelp:e,enzymes:t,isGoldenGate:n,showEnzymes:a,primer1Exists:i}){return d.createElement("form",{className:"buffer-content-container form-horizontal"},d.createElement("fieldset",null,d.createElement("legend",null,"Design"),d.createElement("div",{className:"row js-use-existing-primer-group use-existing-primer hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 js-use-existing-primer invisible"})),d.createElement("div",{className:"form-group nucleotide-type-group hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Nucleotide Type"),d.createElement("div",{className:"col col-md-9 nucleotide-type"},d.createElement("label",{className:"radio-inline"},d.createElement("input",{type:"radio",name:"primer-nucleotide-type",className:"js-nucleotide-type",defaultChecked:!0,value:R.Wy.DNA}),"DNA"),d.createElement("label",{className:"radio-inline"},d.createElement("input",{type:"radio",name:"primer-nucleotide-type",className:"js-nucleotide-type",value:R.Wy.RNA}),"RNA"))),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"Strand"),d.createElement("div",{className:"col col-md-9"},d.createElement("label",{className:"radio-inline"},d.createElement("input",{type:"radio",name:"primer-strand",className:"js-strand",defaultChecked:!0,value:"forward"}),"Forward"),d.createElement("label",{className:"radio-inline"},d.createElement("input",{type:"radio",name:"primer-strand",className:"js-strand",value:"reverse"}),"Reverse"))),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"Bases"),d.createElement("div",{className:"col col-md-9"},i&&d.createElement(EditPrimerBasesWarning,null),d.createElement("div",{className:"sequence-primer-bases"},d.createElement("span",{className:"prime five-prime"},"5'"),d.createElement("div",{className:"primer-text-outer mono"},d.createElement("div",{contentEditable:!0,className:"primer-text",...(0,ee.Z)({component:"EditPrimer",element:"primerText"})})),d.createElement("span",{className:"prime three-prime"},"3'")),d.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))),d.createElement("div",{className:"form-group too-short-msg-group"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 too-short-msg"},d.createElement("p",{className:"error-msg"},"Primer must be at least 6 bp."))),d.createElement("div",{className:"row js-found-existing-primer-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 js-found-existing-primer invisible"})),d.createElement("div",{className:"form-group primer-position-group"},d.createElement("label",{className:"col-md-3 control-label"},"3' Location"),d.createElement("div",{className:"col col-md-3 primer-position"},d.createElement("input",{type:"number",name:"primer-start-position",placeholder:"3' end",className:"form-control js-primer-position"}))),d.createElement("div",{className:"form-group bad-location-msg-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 bad-location-msg invisible"},d.createElement("p",{className:"error-msg"},"Binding location should be within the sequence. Using bind location of"," ",d.createElement("span",{className:"location-num"})," instead."))),d.createElement("div",{className:"form-group overhang-group"},d.createElement("label",{className:"col-md-3 control-label"},"Overhang"),d.createElement("div",{className:"col col-md-3 overhang"},d.createElement("input",{type:"number",name:"primer-overhang-size",placeholder:"0 bp",min:"0",step:"1",className:"form-control js-overhang-size"}))),d.createElement("div",{className:"form-group binding-group hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Binding",n&&d.createElement(d.Fragment,null," ",d.createElement("a",{title:"Length of sequence-defined region",className:"glyphicon glyphicon-question-sign u-no-text-decoration"}))),d.createElement("div",{className:"col col-md-3 binding invisible"},d.createElement("input",{type:"number",name:"primer-binding",placeholder:"0 bp",min:"0",step:"1",className:"form-control js-binding",...(0,ee.Z)({component:"EditPrimer",element:"primerBindingInput"})}))),d.createElement("div",{className:"form-group homology-group hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Overhang"),d.createElement("div",{className:"col col-md-3 homology invisible"},d.createElement("input",{type:"number",name:"primer-homology",placeholder:"0 bp",min:"0",step:"1",className:"form-control js-homology",...(0,ee.Z)({component:"EditPrimer",element:"OverhangInput"})}))),d.createElement("div",{className:"form-group pre-recognition-site-group hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Pre-recog. Site ",d.createElement("a",{title:"5' flanking bases before recognition site",className:"glyphicon glyphicon-question-sign u-no-text-decoration"})),d.createElement("div",{className:"col col-md-6 pre-recognition-site invisible"},d.createElement("input",{type:"text",name:"primer-pre-recognition-site",placeholder:"Enter the pre-recognition site bases",className:"form-control js-pre-recognition-site"}))),d.createElement("div",{className:"form-group pre-recognition-site-invalid-bases-msg-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 pre-recognition-site-invalid-bases-msg invisible"},d.createElement("p",{className:"error-msg"},"The pre-recognition site cannot contain the same bases as the recognition site."))),d.createElement("div",{className:"form-group post-recognition-site-group hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Post-recog. Site ",d.createElement("a",{title:"Base(s) after recognition site",className:"glyphicon glyphicon-question-sign u-no-text-decoration"})),d.createElement("div",{className:"col col-md-6 post-recognition-site invisible"},d.createElement("input",{type:"text",name:"primer-post-recognition-site",placeholder:"Enter the post-recognition site bases",className:"form-control js-post-recognition-site"}))),d.createElement("div",{className:"form-group post-recognition-site-invalid-length-msg-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 post-recognition-site-invalid-length-msg invisible"},d.createElement("p",{className:"error-msg"},"The post-recognition site must be exactly ",d.createElement("span",{className:"valid-length"})," bp."))),d.createElement("div",{className:"form-group overhang-too-small-msg-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 overhang-too-small-msg invisible"},d.createElement("p",{className:"error-msg"},"The number of primer bases lying off of the end of the sequence cannot be higher than the overhang size. Using overhang size of ",d.createElement("span",{className:"overhang-num"})," instead."))),d.createElement("div",{className:"form-group overhang-too-large-msg-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 overhang-too-large-msg invisible"},d.createElement("p",{className:"error-msg"},"Overhang size cannot be longer than primer size. Using overhang size of"," ",d.createElement("span",{className:"overhang-num"})," instead."))),a&&d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"Cut Site"),d.createElement("div",{className:"col col-md-9"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-4"},d.createElement("select",{className:"edit-primer-enzymes"},d.createElement("option",null),t.map((e=>d.createElement("option",{key:e.id,value:e.id},e.name))))),d.createElement("div",{className:"col col-md-4"},d.createElement("input",{type:"text",readOnly:!0,className:"form-control js-reference"}))),d.createElement("p",{className:"help-block"},"Use the dropdown above to look up restriction sites.")))),d.createElement("fieldset",null,d.createElement("legend",null,"Verify",d.createElement("div",{className:"pull-right"},d.createElement("div",{className:"secondary-temp"},d.createElement("button",{type:"button",className:"button button--small button--tertiaryGray js-check-secondary"},"Check Secondary Structure")," ","at ",d.createElement("input",{type:"text",placeholder:"37"}),"°C"))),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"T",d.createElement("sub",null,"m")," ",d.createElement("span",{className:"settings glyphicon glyphicon-wrench js-tm-parameters u-pointer"})),d.createElement("div",{className:"col col-md-2 text-right js-tm input-field"})),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"GC Content"),d.createElement("div",{className:"col col-md-2 text-right js-gc input-field"})),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"Length"),d.createElement("div",{className:"col col-md-2 text-right js-length input-field"})),d.createElement("div",{className:"form-group js-secondary hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Min ΔG Homodimer"),d.createElement("div",{className:"col col-md-2 text-right js-homodimer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{className:"col col-md-3 js-homodimer secondary-link invisible"},d.createElement("a",null,"All Structures"))),d.createElement("div",{className:"form-group js-secondary hidden"},d.createElement("label",{className:"col-md-3 control-label"},"Min ΔG Monomer"),d.createElement("div",{className:"col col-md-2 text-right js-monomer-dg input-field"},d.createElement("div",{className:"spinner"})),d.createElement("div",{className:"col col-md-3 js-monomer secondary-link invisible"},d.createElement("a",null,"All Structures")))),d.createElement("fieldset",null,d.createElement("legend",null,"Save"),d.createElement("div",{className:"form-group"},d.createElement("label",{className:"col-md-3 control-label"},"Name"),d.createElement("div",{className:"col col-md-8"},d.createElement("input",{type:"text",name:"primer-name",placeholder:"Enter a short name",className:"js-name"})),d.createElement("div",{className:"col col-md-1 text-right"},d.createElement("div",{className:"swatch-big"}))),d.createElement("div",{className:"col col-md-9 col-md-offset-3 js-name-too-long invisible"},d.createElement("p",{className:"text-warning error-msg"},"The primer name you have selected is too long. Primer names can be at most"," ",tn.Jb," characters long.")),d.createElement("div",{className:"form-group js-found-existing-name-group hidden"},d.createElement("div",{className:"col col-md-9 col-md-offset-3 js-found-existing-name invisible"},d.createElement("p",{className:"text-warning error-msg"},'A primer with name "',d.createElement("span",{className:"existing-name"}),'" already exists in the designated library.'))),d.createElement("div",{className:"form-group save-library-group"},d.createElement("label",{className:"col-md-3 control-label"},"Save To"),d.createElement("div",{className:"col col-md-8 save-library"},d.createElement("div",{className:"folder-selector-container"}))),d.createElement("div",{className:"form-group"},d.createElement("div",{className:"col col-md-3 col-md-offset-8"},d.createElement("div",{className:"pull-right"},d.createElement("button",{type:"button",className:"button button--primary button--small disabled js-save single-save",...(0,ee.Z)({component:"EditPrimerTab",element:"savePrimerButton"})},"Save Primer"))))))}))
const Eo=(0,be.Z)((function EmptySequencePrimer(){return d.createElement("form",{className:"buffer-content-container form-horizontal js-empty-sequence"},d.createElement("fieldset",null,d.createElement("legend",null,"Design"),d.createElement("p",null,"Primer design is disabled on empty sequences. Add bases to your sequence before designing a primer.")))}))
class ExistingPrimers extends d.Component{renderHeading(){const{isAssemblyPrimer:e,primers:t,used:n}=this.props
return n?e?d.createElement("p",null,d.createElement("p",null,"Use the inputs below to adjust this assembly primer:")):1===t.length&&t[0].has("id")?d.createElement("p",null,d.createElement("b",null,"Editing this saved primer and its binding site:")):d.createElement("p",null,d.createElement("b",null,"Editing this saved primer and adding a binding site:")):t.length>1?d.createElement("p",null,"Saved primers exist with the same bases:"):d.createElement("p",null,"Saved primer exists with the same bases:")}renderExistingPrimer(e){const{single:t,used:n}=this.props,a=e.folder().name,i=e.folder().url
return d.createElement("li",{key:e.get("primer_id"),className:"list-group-item clearfix existing-primer"},e.name()," ",(t||n)&&a&&i&&d.createElement("a",{href:i,target:"_blank",className:"faded",rel:"noreferrer"},"(",e.get("owner")," / ",a,")"),d.createElement("span",null,!n&&d.createElement("button",{type:"button","data-primer-id":e.get("primer_id"),className:"button button--primary button--mini js-existing-primer-use pull-right"},"Use")))}render(){const{isAssemblyPrimer:e,primers:t,used:n}=this.props
return d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-11 existing-primers"},this.renderHeading(),d.createElement("ul",{className:"list-group list-group-sm"},t.map((e=>this.renderExistingPrimer(e)))),n&&!e&&d.createElement("p",null,"You can also"," ",1===t.length&&t[0].has("id")?d.createElement("a",{className:"js-existing-primer-duplicate"},"duplicate it"):d.createElement("a",{className:"js-existing-primer-remove"},"remove it"),".")))}}const fo=(0,be.Z)(ExistingPrimers)
const So=(0,be.Z)((function PreviousVersionPrimer(){return d.createElement("form",{className:"buffer-content-container form-horizontal"},d.createElement("fieldset",null,d.createElement("legend",null,"Design"),d.createElement("p",null,"Primer design is disabled on previous versions."," ",d.createElement("a",{href:"#",className:"js-switch-to-latest"},"Switch to the latest version."))))}))
var yo=n(133936),bo=n(331356)
const{ASSEMBLY_TYPE:To}=b
class EditPrimerView_OptionsView extends s().View{static initClass(){this.prototype.tagName="div"
this.prototype.className="navbar edit-primer-options"
this.prototype.template=uo}events(){return{"click .js-read-selection-forward":e=>{this.readSelectionClicked(e,"readSelectionForward")},"click .js-read-selection-reverse":e=>{this.readSelectionClicked(e,"readSelectionReverse")},"click .js-jump":()=>{this.jumpTo(this.model.get("primer"))},"click .js-jump-reverse":()=>{this.jumpTo(this.model.get("primer2"))},"change select":"changeMode"}}initialize(){this.sequence=this.model.get("sequence")
this._sequence=this.sequence.get("_sequence")
this.selection=this.sequence.get("selection")
this.listenTo(this.selection,"change",this.renderSelectionButton.bind(this))
this.listenTo(this.model,"change:primer",this.updatePrimerListeners.bind(this))
this.listenTo(this.model,"change:primer2",this.render.bind(this))
this.listenTo(this.sequence,"change:currentVersion",this.render.bind(this))
this.listenTo(this._sequence,"change:bases",this.render.bind(this))
this.updatePrimerListeners()}renderSelectionButton(){let e,t
e=null==this.selection.getStartState("primer")&&isAssemblyPrimer(this._sequence,this.model.get("primer"))
t=null==this.selection.getEndState("primer")&&(this.model.has("primer2")?isAssemblyPrimer(this._sequence,this.model.get("primer2")):isAssemblyPrimer(this._sequence,this.model.get("primer")))
const n=this.selection.isEmpty()||e&&t
this.$(".js-read-selection").toggleClass("disabled",n)
this.$(".js-read-selection-forward").toggleClass("disabled",e)
this.$(".js-read-selection-reverse").toggleClass("disabled",t)}readSelectionClicked(e,t){o()(e.currentTarget).hasClass("disabled")||this.model.trigger(t)}updatePrimerListeners(){const e=this.model.get("primer")
this.renderModeButton()
this.listenTo(e,"change:nucleotideType",this.renderModeButton.bind(this))}renderModeButton(){this.$("select").prop("disabled",this.model.get("primer").nucleotideType()===R.Wy.RNA)}jumpTo(e){this.sequence.sequencePrimers().find((t=>t.get("_primer").cid===e.cid)).click(this.sequence)}changeMode(e){let t
const n=parseInt(o()(e.currentTarget).find("option:selected").attr("value"),10)
m.j("primer","toggle_primer_pair",{product:j.XC.MOLBIO,numPrimers:n,sequence_id:this._sequence.id})
if(1===n){this.model.set({primer2:null})
return}(0,S.hu)(2===n,"Expected 2 primers")
let a=this.model.get("primer")
const i=this.sequence.primerPairs().find((e=>a.id===e.forwardPrimerId()||a.id===e.reversePrimerId()))
if(null==i){if(1===a.strand())t=new Ue.SequencePrimer({bases:"",strand:-1,start:0,end:1})
else{t=a
a=new Ue.SequencePrimer({bases:"",strand:1,start:0,end:1})}this.model.set({primer:a,primer2:t})}else{const[e,t]=i.getPrimers(this._sequence.sequencePrimers())
this.model.set({primer:e,primer2:t})}}render(){if(!this.sequence.get("currentVersion")||this.sequence.isEmpty()){this.$el.empty()
return this}const e=null===this.model.get("primer2")
this.$el.html(this.template({single:e}))
this.renderSelectionButton()
this.renderModeButton()
const t=e?1:2
this.$(`select option[value=${t}]`).prop("selected",!0)
return this}}EditPrimerView_OptionsView.initClass()
class EditPrimerView_TabView extends s().View{static initClass(){this.prototype.className="edit-primer buffer-tab"}events(){return{"input .js-name":"updateName","change .edit-primer-enzymes":"fillReference","change .primer-libraries":"updateLibrary","click .js-switch-to-latest":"switchToLatest","click .swatch-big":"pickColor","click .js-existing-primer-use":"useExistingPrimer","click .js-existing-primer-remove":"removeExistingPrimer","click .js-existing-primer-duplicate":"duplicateExistingPrimer","input .primer-text":"saveBases","input .js-overhang-size":e=>{this.updateOverhangSize(this.getPrimer(e))},"input .js-primer-position":e=>{this.updatePosition(this.getPrimer(e))},"input .js-binding":e=>{this.updateBinding(this.getPrimer(e))},"input .js-homology":e=>{this.updateHomology(this.getPrimer(e))},"input .js-pre-recognition-site":e=>{this.updatePreRecognitionSite(this.getPrimer(e))},"input .js-post-recognition-site":e=>{this.updatePostRecognitionSite(this.getPrimer(e))},"change .js-binding, .js-homology, .js-pre-recognition-site, .js-post-recognition-site":e=>{this.saveAssemblyPrimer(this.getPrimer(e))},"click .js-save":e=>{this.savePrimer(this.getPrimer(e))
m.j("primer","save_primers_click",{product:j.XC.MOLBIO,numPrimers:1,sequence_id:this.sequence.get("id")})},"change .js-strand":"handleStrandChange","change .js-nucleotide-type":"handleNucleotideTypeChange","click .js-tm-parameters":()=>{(0,Xn.Z)(MeltingTempModal,{})},"click .save-pair":"savePrimerPair","click .js-check-secondary":()=>{this.removeSecondary()
this.model.set({checking:!0})
m.j("primer","check_secondary_structure",{product:j.XC.MOLBIO,numPrimers:this.model.get("primer2")?2:1,sequence_id:this.sequence.get("id")})},"input .secondary-temp input":"saveSecondaryTemp"}}initialize(e){var t
super.initialize(e)
this.sequence=this.model.get("sequence")
this.selection=this.sequence.get("selection")
this._sequence=this.sequence.get("_sequence")
this.primer=this.model.get("primer")
this.primer2=this.model.get("primer2")
this.searchExisting=new Ue.SearchPrimerCollection([],{sequenceID:this.sequence.id})
this.searchExisting2=new Ue.SearchPrimerCollection([],{sequenceID:this.sequence.id})
this.outstandingSearchXhr=null
this.outstandingSearchXhr2=null
this.selectorViews=[null,null]
this.searchExistingName=[new Ue.SearchPrimerCollection,new Ue.SearchPrimerCollection]
this.outstandingSearchNameXHR=[null,null]
this.listenTo(this.model,"change:primer2 change:primer",(()=>{this.removeSecondary()
this.render()}))
this.listenTo(this.model,"change:checking",this.renderSecondary.bind(this))
this.listenTo(this.model,"change:secondary",((e,t)=>{t&&this.renderSecondary()}))
this.listenTo(this._sequence,"change:circular change:bases change:startIndex",(()=>{const e=this.$(".js-empty-sequence").length>0,t=this.sequence.isEmpty()
if(e!==t)this.render()
else if(!t){this.clampPosition(this.primer)
this.renderPosition(this.primer)
this.updatePosition(this.primer)
if(null!=this.primer2){this.clampPosition(this.primer2)
this.renderPosition(this.primer2)
this.updatePosition(this.primer2)}this.renderProductLength()}}))
this.listenTo(this.sequence,"change:currentVersion",this.render.bind(this))
this.enzymes=X.ZP.getCommonEnzymes()
this.colorPicker=new Xr.Z
this.colorPicker2=new Xr.Z
this.listenTo(this.model,"readSelectionForward",this.readSelectionForward.bind(this))
this.listenTo(this.model,"readSelectionReverse",this.readSelectionReverse.bind(this))
this.listenTo(this.model,"change:analyzeSecondary",this.autoSecondaryCheck.bind(this))
this.listenTo(this.model,"change:temperature",this.renderSecondaryTemp.bind(this))
this.primer.isNew()&&this.primer.set("folder_api_id",Qe.Z.get(Qe.O.OLIGO));(null===(t=this.primer2)||void 0===t?void 0:t.isNew())&&this.primer2.set("folder_api_id",Qe.Z.get(Qe.O.OLIGO))
const n=this.sequence.sequencePrimers()
this.listenTo(n,"reset",(()=>{const e={},t=n.get(this.primer.id)
null!=t&&(e.primer=t.get("_primer"))
if(null!=this.primer2){const t=n.get(this.primer2.id)
null!=t&&(e.primer2=t.get("_primer"))}this.model.set(e)}))
this.findExistingPrimer(this.primer)
null!=this.primer2&&this.findExistingPrimer(this.primer2)}clampPosition(e){const t=e.bindPosition(this._sequence),n=Math.min(t,this._sequence.length()-1)
t!==n&&e.setBindPosition(this._sequence,n,e.overhangLength())}remove(){var e,t
super.remove()
null===(e=this.selectorViews[0])||void 0===e||e.remove()
null===(t=this.selectorViews[1])||void 0===t||t.remove()
return this}switchToLatest(e){e.preventDefault()
const t=this.sequence.get("versions"),n=t.max((e=>e.get("id")))
t.trigger("open",n)}saveSecondaryTemp(e){const t=parseInt(o()(e.currentTarget).val(),10)
Number.isNaN(t)?this.model.unset("temperature"):this.model.set({temperature:t})}renderSecondaryTemp(){const e=this.$(".secondary-temp input")
this.model.has("temperature")?e.val(this.model.get("temperature")):e.val("")}updateName(e){var t
null===(t=this.getPrimer(e))||void 0===t||t.set({name:o()(e.currentTarget).val()})}renderName(e){const t=this.fieldIndex(e),n=this.$(".js-name").eq(t)
n.val()!==e.name()&&n.val(e.name())}updateLibrary(e){const t=this.getPrimer(e),n=e.target.value
t.set({folder_api_id:n})
Qe.Z.set(Qe.O.OLIGO,n)}saveSelection(e){var t
if("primer-text"!==(null===(t=null===document||void 0===document?void 0:document.activeElement)||void 0===t?void 0:t.className))return null
const n=e[0],a=oo.rx()
if(null==a)return null
let i=a.startOffset
const s=a.cloneRange()
s.selectNodeContents(n)
s.setEnd(a.startContainer,a.startOffset)
i=s.toString().length
return[i,i+a.toString().length]}restoreSelection(e,t){if(null==t)return
const[n,a]=t,i=e[0]
let s=0
const r=document.createRange()
r.setStart(i,0)
r.collapse(!0)
const o=[i]
let l=!1,c=o.pop()
for(;c;){if(3===c.nodeType){const e=s+c.length
if(!l&&n>=s&&n<=e){r.setStart(c,n-s)
l=!0}if(l&&a>=s&&a<=e){r.setEnd(c,a-s)
break}s=e}else{let e=c.childNodes.length
for(;e--;)o.push(c.childNodes[e])}c=o.pop()}const d=window.getSelection()
null==d||d.removeAllRanges()
null==d||d.addRange(r)}saveBases(e){const t=this.getPrimer(e),n=y.sanitize(o()(e.currentTarget).text(),t.nucleotideType())
n===t.bases()?this.showBases(t):t.changeBases(this._sequence,n)
this.updatePosition(t)}showBases(e){const t=this.$(".primer-text").eq(this.fieldIndex(e)),n=this.saveSelection(t)
de.Ud?t.html(e.bases()):t.html(basesHTML(this._sequence,e,{}))
this.restoreSelection(t,n)
if(isAssemblyPrimer(this._sequence,e)){t.removeAttr("contenteditable")
t.tooltip({placement:"bottom",title:"Perform edits for assembly primers below or on the sequence map.",delay:500})}else{t.attr("contenteditable",!0)
t.tooltip("destroy")}}pickColor(e){const t=this.fieldIndex(this.getPrimer(e))
this.$(".swatch-big").eq(t).popover("show")}initializeFields(e,t){const n=1===e.strand()?"forward":"reverse"
this.$(".js-strand").filter(((e,t)=>t.value===n)).prop("checked",!0)
this.$(".js-nucleotide-type").filter(((t,n)=>n.value===e.nucleotideType())).prop("checked",!0)
this.$(".js-name").eq(t).val(e.name())
this.$(".swatch-big").eq(t).css("background-color",e.color())
const a=e.overhangBases().length
this.$(".js-overhang-size").eq(t).val(a>0?a:null)
this.$(".js-primer-position").eq(t).val(T.modelToDisplay(e.bindPosition(this._sequence),this._sequence.startIndex()))}fillReference(e){if(null==this.enzymes){Fe.vU("enzymes is undefined in TabView.fillReference",{extra:{this:Object.keys(this)}})
return}if(null==e.val)return
const t=this.enzymes.get(e.val)
this.$(".js-reference").val(t.get("seq")).select()}readSelectionForward(){this._readSelection(1)}readSelectionReverse(){this._readSelection(-1)}_readSelection(e){const t=1===e,n=[this.selection.getStartState("primer"),this.selection.getEndState("primer")],a=l.default.find(n,(t=>(null==t?void 0:t.strand())===e)),i=this.selection.get("start"),s=this.selection.get("end")
if(a&&!a.isNew()&&a.start()===i&&a.end()===s)t||!this.primer2?this.model.set({primer:a.get("_primer")}):this.model.set({primer2:a.get("_primer")})
else{const n=t?s-1:i,a=this.dna.slice(i,s),r=t||!this.primer2?this.primer:this.primer2,o=t?a[0].bases:y.reverse(a[1].bases),l=y.sanitize(o,r.nucleotideType())
r.changeBases(this._sequence,l)
r.setBindPosition(this._sequence,n,0)
const c=this.fieldIndex(r)
this.$(".js-overhang-size").eq(c).val(null)
if(null==this.primer2){const t=1===e?"forward":"reverse"
this.$(".js-strand").filter(((e,n)=>n.value===t)).prop("checked",!0)
this.updateStrand(e)}}}closePicker(e){const t=this.fieldIndex(e),n=this.$(".swatch-big").eq(t)
n.css("background-color",e.color());(0===t?this.colorPicker:this.colorPicker2).update(e)
n.popover("hide")}_getExistingPrimer(e,t){const n=e.data("primerId")
return t.findWhere({primer_id:n})}useExistingPrimer(e){const t=1===o()(e.currentTarget).parents(".js-found-existing-primer").data("index")?this.primer2:this.primer,n=t===this.primer?this.searchExisting:this.searchExisting2,a=this._getExistingPrimer(o()(e.currentTarget),n)
t.set({bases:a.bases(),primer_id:a.get("primer_id"),folder:a.get("folder"),owner:a.get("owner"),name:a.name(),folder_api_id:a.get("folder").api_identifier,primer_api_id:a.get("primer_api_id"),color:a.color()})}renderMatches(e){const t=this.fieldIndex(e),n=this.$(".js-found-existing-primer").eq(t),a=0===t?this.searchExisting:this.searchExisting2
if(a.length>0){n.html(fo({primers:a.models,single:null==this.primer2,used:!1,isAssemblyPrimer:!1})).removeClass("invisible")
this.$(".js-use-existing-primer").eq(t).addClass("invisible")
this.toggleGroup(".js-use-existing-primer")}else n.addClass("invisible")
this.toggleGroup(".js-found-existing-primer")}findExistingPrimer(e){var t
if(e.has("id"))return
const n=this.fieldIndex(e),a=0===n?this.searchExisting:this.searchExisting2
let i=0===n?this.outstandingSearchXhr:this.outstandingSearchXhr2
null===(t=null==i?void 0:i.abort)||void 0===t||t.call(i)
i=a.fetch({data:{bases:e.bases(),nucleotideType:e.nucleotideType()},parse:!0}).done((()=>{this.renderMatches(e)}))
0===n?this.outstandingSearchXhr=i:this.outstandingSearchXhr2=i}findExistingName(e){var t
const n=this.fieldIndex(e),a=this.searchExistingName[n]
let i=this.outstandingSearchNameXHR[n]
null===(t=null==i?void 0:i.abort)||void 0===t||t.call(i)
if(e.has("primer_id")||null==e.get("folder_api_id")){a.reset()
i=o().Deferred().resolve().promise()}else i=a.fetch({data:{name:e.name(),nucleotideType:e.nucleotideType(),exact:1,limit:1,folderId:e.get("folder_api_id")}},{parse:!0})
i.done((()=>{const t=this.$(".js-found-existing-name").eq(n)
t.find(".existing-name").text(e.name())
t.toggleClass("invisible",a.isEmpty())
this.toggleGroup(".js-found-existing-name")}))
this.outstandingSearchNameXHR[n]=i}checkNameLength(e){const t=this.fieldIndex(e)
this.$(".js-name-too-long").eq(t).toggleClass("invisible",!this.isNameTooLong(e))}duplicateExistingPrimer(e){let t,n
if(1===o()(e.currentTarget).parents(".js-use-existing-primer").data("index")){t="primer2"
n=this.model.originalPrimer2}else{t="primer"
n=this.model.originalPrimer}const a=this[t],i=a.clone()
a.set(n)
i.unset("id")
i.unset("primer_id")
i.unset("folder")
i.unset("folder_api_id")
i.unset("owner")
i.unset("primer_api_id")
i.set({name:`${i.get("name")} copy`})
this.model.set(t,i)}renderSecondary(){var e,t
const n=0===this.primer.bases().length&&(null==this.primer2||0===this.primer2.bases().length),disableCheckSecondary=e=>{e=e||n
return this.$(".js-check-secondary").toggleClass("is-disabled",e).prop("disabled",e)}
if(this.model.get("checking")){this.$(".js-secondary").removeClass("hidden")
if(this.model.has("secondary")){const n=this.model.get("secondary"),getDG=(e,t,n)=>o()("<a>").addClass("structure").text(`${e.dg} kcal`).click((()=>this.renderSvg(e.svg,e.dg,t,n))),showInfo=(e,t,a,i,s)=>{const r=e(this.$(".js-monomer-dg")),o=e(this.$(".js-monomer"))
if(null!=n[t]){r.html(getDG(n[t],"Monomer",i))
o.removeClass("invisible")
o.click((()=>{this.findAllStructures(o,n[t],"Monomer",i,s)}))}else{r.html("--")
o.addClass("invisible")
o.unbind("click")}const l=e(this.$(".js-homodimer-dg")),c=e(this.$(".js-homodimer"))
if(null!=n[a]){l.html(getDG(n[a],"Homodimer",i))
c.removeClass("invisible")
c.click((()=>{this.findAllStructures(c,n[a],"Homodimer",i,s,s)}))}else{l.html("--")
c.addClass("invisible")
c.unbind("click")}}
showInfo((e=>e.first()),"monomer","homodimer",this.primer.nucleotideType(),this.primer.bases())
showInfo((e=>e.filter("[data-index=1]")),"monomer2","homodimer2",null===(e=this.primer2)||void 0===e?void 0:e.nucleotideType(),null===(t=this.primer2)||void 0===t?void 0:t.bases())
if(null!=this.primer2){const e=this.$(".js-heterodimer-dg"),t=this.$(".js-heterodimer")
if(null!=n.heterodimer){e.html(getDG(n.heterodimer,"Heterodimer",this.primer.nucleotideType()))
t.removeClass("invisible")
t.click((()=>{this.findAllStructures(t,n.heterodimer,"Heterodimer",this.primer.nucleotideType(),this.primer.bases(),this.primer2.bases())}))}else{e.html("--")
t.addClass("invisible")
t.unbind("click")}}disableCheckSecondary(!1)}else disableCheckSecondary(!0)}else{this.$(".js-secondary").addClass("hidden")
disableCheckSecondary(!1)
this.$(".js-secondary .input-field").html(o()("<div>").addClass("spinner"))
this.$(".secondary-link").addClass("invisible")}}findAllStructures(e,t,n,a,i,s){var r,l
const c=new FormData
c.append("all",(!0).toString())
c.append("nucleotideType",a)
c.append("primer",i)
null!=s&&c.append("primer2",s)
c.append("temperature",null!==(l=null===(r=this.model.get("temperature"))||void 0===r?void 0:r.toString())&&void 0!==l?l:"37")
e.html(o()("<div>").addClass("spinner"))
an.by({url:"/1/api/oligo-secondary-structure",data:c,dataType:"json",processData:!1,contentType:!1,type:"PUT"}).fail((e=>{v.ZP.notifyError(e)})).done((r=>{bo.Z.create(this.model.get("sequence"),t,r,n,this.model.get("temperature"),a,i,s)
e.html(o()("<a>").text("All Structures"))}))}renderSvg(e,t,n,a){return new yo.Z({svg:e,dg:t,name:n,nucleotideType:a}).showModal()}removeSecondary(){this.model.set({checking:!1})
this.model.unset("secondary")}removeExistingPrimer(e){const t=1===o()(e.currentTarget).parents(".js-use-existing-primer").data("index")?this.primer2:this.primer
null==t||t.unset("primer_id")
null==t||t.unset("primer_api_id")}renderUsedPrimer(e){if(e.has("primer_id")){const t=this.fieldIndex(e)
this.$(".js-use-existing-primer").eq(t).html(fo({primers:[e],single:null==this.primer2,used:!0,isAssemblyPrimer:isAssemblyPrimer(this._sequence,e)})).removeClass("invisible")
this.toggleGroup(".js-use-existing-primer")
this.$(".js-found-existing-primer").eq(t).addClass("invisible")
this.toggleGroup(".js-found-existing-primer")}else this.renderMatches(e)}renderLibraries(){var e,t
null===(e=this.selectorViews[0])||void 0===e||e.remove()
null===(t=this.selectorViews[1])||void 0===t||t.remove()
this.selectorViews=[null,null]
this.selectorViews[0]=new to.Z({initialFolderId:this.primer.get("folder_api_id"),inputClassName:"primer-libraries",props:{showInventory:!0,enableRedesign:!0}})
this.$(".folder-selector-container").eq(0).html(this.selectorViews[0].render().el)
if(null!=this.primer2){this.selectorViews[1]=new to.Z({initialFolderId:this.primer2.get("folder_api_id"),inputClassName:"primer-libraries",inputData:{index:1},props:{showInventory:!0,enableRedesign:!0}})
this.$(".folder-selector-container").eq(1).html(this.selectorViews[1].render().el)}}listenToPrimer(e){const t=this.fieldIndex(e)
this.listenTo(this.primer,"change:start change:end change:bases",(()=>{const e=this.$(".js-overhang-size").eq(t)
0===e.val().length&&e.val(0)}))
this.listenTo(e,"change:start change:end change:bases change:overhang_length",this.renderStats.bind(this,e))
this.listenTo(e,"change:primer_id",this.renderNucleotideTypeRadioButton.bind(this))
this.listenTo(e,"change:strand change:start change:end",this.renderPosition.bind(this,e))
this.listenTo(e,"change",this.renderSaveButton.bind(this,e))
this.listenTo(this.model,"change:saving",this.renderSaveButton.bind(this,e))
this.listenTo(e,"change",this.renderSavePair.bind(this))
this.listenTo(this.model,"change:saving",this.renderSavePair.bind(this))
this.listenTo(e,"change:color",this.closePicker.bind(this,e))
this.listenTo(e,"change:bases",this.renderBaseMsg.bind(this,e))
this.listenTo(e,"change:bases change:overhang_length change:start change:end change:strand",this.showBases.bind(this,e))
const n=(0,It.D)(this.findExistingPrimer.bind(this,e),500)
this.listenTo(e,"change:bases change:nucleotideType",(()=>{e.get("bases").toUpperCase()===e.previous("bases").toUpperCase()&&e.get("nucleotideType")===e.previous("nucleotideType")||n()}))
this.listenTo(e,"change:name change:folder_api_id change:primer_id",(0,It.D)(this.findExistingName.bind(this,e),500))
this.listenTo(e,"change:name",(0,It.D)(this.checkNameLength.bind(this,e),500))
this.listenTo(e,"change:name change:folder_api_id change:primer_id",this.renderUsedPrimer.bind(this,e))
this.listenTo(e,"change:bases",this.renderSecondary.bind(this))
this.listenTo(e,"change:name",this.renderName.bind(this,e))
this.listenTo(e,"change:bases",this.removeSecondary.bind(this))
this.listenTo(e,"change:bases change:start change:end change:overhang_length",this.renderAssemblyFieldValues.bind(this,e))}registerListeners(){let e
this.listenToPrimer(this.primer)
if(null!=this.primer2){this.listenToPrimer(this.primer2)
for(e of[this.primer,this.primer2]){this.listenTo(e,"change:bases change:start change:end change:overhang_length",this.renderMeltingTempDiff.bind(this))
this.listenTo(e,"change:bases change:start change:end change:overhang_length",this.renderProductLength.bind(this))}}this.listenTo(We.Z,`change:${tn.gq.MELTING_TEMP_DNA} change:${tn.gq.MELTING_TEMP_RNA}`,(()=>{this.renderStats(this.primer)
if(null!=this.primer2){this.renderStats(this.primer2)
this.renderMeltingTempDiff()}}))}computeProductLength(){return y.productLength([this.primer.start(),this.primer.end()],[this.primer2.start(),this.primer2.end()],this._sequence.circular(),this._sequence.length())}renderProductLength(){const[e,t]=[this.primer,this.primer2]
let n=!0
if(null!=t){let a
if(0===e.length()||0===t.length())a="--"
else{const i=this.computeProductLength()
n=i>0
a=`${i+e.overhangBases().length+t.overhangBases().length} bp`}this.$(".js-product-size").html(a)}this.$(".js-invalid-pair").toggleClass("hidden",n)}renderBaseMsg(e){const t=this.fieldIndex(e)
this.$(".too-short-msg").eq(t).toggleClass("invisible",e.validBases())
this.toggleGroup(".too-short-msg")}checkDimerization(){v.ZP.error("We're currently experiencing problems calculating dimerization and have temporarily disabled the service while we roll out a fix. We apologize for the inconvenience.")}handleStrandChange(e){const t="forward"===o()(e.currentTarget).val()?1:-1
this.updateStrand(t)}handleNucleotideTypeChange(e){const t=o()(e.currentTarget).val()
this.primer.set({nucleotideType:t})}updateStrand(e,t){null==t&&({primer:t}=this)
if(e!==t.strand()){t.reverse(this._sequence)
this.updateOverhangSize(t)}}_readPosition(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=this.$(".js-primer-position").eq(t),a=parseInt(n.val(),10),i=this.model.get("sequence").length()
if(Number.isNaN(a))return NaN
const s=T.displayToModel(a,this._sequence.startIndex())
return s<0||s>=i?NaN:s}updatePosition(e){null==e&&({primer:e}=this)
if(isAssemblyPrimer(this._sequence,e))return
const t=this.fieldIndex(e),n=this._readPosition(e),a=this.$(".bad-location-msg").eq(t)
a.toggleClass("invisible",!Number.isNaN(n))
this.toggleGroup(".bad-location-msg")
const i=T.modelToDisplay(e.bindPosition(this._sequence),this._sequence.startIndex())
a.find(".location-num").text(i)
if(!Number.isNaN(n)){this.toggleGroup(".bad-location-msg")
e.setBindPosition(this._sequence,n,e.get("overhang_length"))
this.updateOverhangSize(e)}}saveAssemblyPrimer(e){e.debouncedSave({done:()=>{this.sequence.updateVersions()
v.ZP.success("Assembly primer successfully updated.",{id:"EditPrimerView.saveAssemblyPrimer.done"})},fail:v.ZP.notifyError,invalid:v.ZP.error})}_getGoldenGatePrimerParts(e){const t=this.model.getAssemblyEnzyme(),n=e.bases().indexOf(t.get("seq")),a=n+t.recognitionSiteLength(),i=a+t.postRecognitionSiteLength(),s=i+t.stickyEndLength(),r=e.bases()
return{preRecognitionSite:r.slice(0,n),recognitionSite:r.slice(n,a),postRecognitionSite:r.slice(a,i),stickyEnd:r.slice(i,s),bindingRegion:r.slice(s)}}_joinPrimerParts(e){const{preRecognitionSite:t,recognitionSite:n,postRecognitionSite:a,stickyEnd:i,bindingRegion:s}=e
return t+n+a+i+s}_updateGoldenGatePrimer(e,t){const n=this._getGoldenGatePrimerParts(e),a=l.default.extend({},n,t),i=this.model.getAssemblyEnzyme(),s=this.fieldIndex(e),{preRecognitionSite:r,postRecognitionSite:o}=a,c=r.indexOf(i.get("seq"))>-1
this.$(".pre-recognition-site-invalid-bases-msg").eq(s).toggleClass("invisible",!c)
this.toggleGroup(".pre-recognition-site-invalid-bases-msg")
const d=o.length!==i.postRecognitionSiteLength(),u=this.$(".post-recognition-site-invalid-length-msg").eq(s)
u.toggleClass("invisible",!d)
this.toggleGroup(".post-recognition-site-invalid-length-msg")
u.find(".valid-length").text(i.postRecognitionSiteLength())
if(c||d)return
if(Is()(a,n))return
const m=this._joinPrimerParts(a),p=m.length-e.bases().length
e.set({overhang_length:e.overhangLength()+p,bases:m})
this.saveAssemblyPrimer(e)}updatePreRecognitionSite(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=this.$(".js-pre-recognition-site").eq(t)
this._updateGoldenGatePrimer(e,{preRecognitionSite:n.val()})}updatePostRecognitionSite(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=this.$(".js-post-recognition-site").eq(t)
this._updateGoldenGatePrimer(e,{postRecognitionSite:n.val()})}updateBinding(e){let t,n,a,i
null==e&&({primer:e}=this)
const s=e.bindingBases().length,r=this.fieldIndex(e),o=this.$(".js-binding").eq(r),l=""===o.val()?0:parseInt(o.val(),10)
if(l===s)return
const c=this.sequence.length()
if(l>s){n=l-s
if(1===e.strand()){a=T.mod(e.end()+n,c)
t=e.bases()+this._sequence.residueSlice(e.end(),a)
e.set({end:a,bases:t})}else{(0,S.hu)(-1===e.strand(),"Unexpected primer strand")
i=T.mod(e.start()-n,c)
t=e.bases()+y.revcomp(this._sequence.residueSlice(i,e.start()),this._sequence.baseTable())
e.set({start:i,bases:t})}}else{n=s-l
t=e.bases().slice(0,e.bases().length-n)
if(1===e.strand()){a=T.mod(e.end()-n,c)
e.set({end:a,bases:t})}else{(0,S.hu)(-1===e.strand(),"Unexpected primer strand")
i=T.mod(e.start()+n,c)
e.set({start:i,bases:t})}}}updateHomology(e){let t,n,a
null==e&&({primer:e}=this)
const i=e.overhangLength()
let s=this.fieldIndex(e)
s=this.fieldIndex(e)
const r=this.$(".js-homology").eq(s),o=""===r.val()?0:parseInt(r.val(),10)
if(o===i)return
const l=this.sequence.length()
if(o>i){n=o-i
a=e.overhangLength()+n
if(1===e.strand()){const i=T.mod(e.start()-e.overhangLength(),l),s=T.mod(i-n,l)
t=this._sequence.residueSlice(s,i)+e.bases()
e.set({bases:t,overhang_length:a})}else{(0,S.hu)(-1===e.strand(),"Unexpected primer strand")
const i=T.mod(e.end()+e.overhangLength(),l),s=T.mod(i+n,l)
t=y.revcomp(this._sequence.residueSlice(i,s),this._sequence.baseTable())+e.bases()
e.set({bases:t,overhang_length:a})}}else{n=i-o
a=e.overhangLength()-n
t=e.bases().slice(n,e.bases().length)
e.set({bases:t,overhang_length:a})}}toggleGroup(e){this.$el.find(`${e}-group`).toggleClass("hidden",0===this.$(`${e}-group ${e}:not(.invisible)`).length)}fieldIndex(e){return e===this.primer?0:1}getPrimer(e){return 1===o()(e.currentTarget).data("index")?this.primer2:this.primer}updateOverhangSize(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=this.$(".js-overhang-size").eq(t),a=n.val().length>0?parseInt(n.val(),10):0,i=this.getMinMaxOverhang(e)
i[0]<=a&&a<=i[1]&&e.setOverhang(this._sequence,a)
this.renderOverhangMessage(e)}getMinMaxOverhang(e){let t
null==e&&({primer:e}=this)
const n=e.bases().length-1
t=this.model.get("sequence").circular()?e.bases().length-this.model.get("sequence").length():1===e.strand()?e.bases().length-(e.bindPosition(this._sequence)+1):e.start()+e.bases().length-this.sequence.length()
return[Math.max(0,t),Math.max(0,n)]}handleSavedPrimer(e,t=!0){if(t){v.ZP.success(`Primer **${e.get("name")}** successfully saved.`)
this.model.close(!1)}this._sequence.sequencePrimers().add(e)
this._sequence.sequencePrimers().each((t=>{e.get("primer_id")===t.get("primer_id")&&e.id!==t.id&&t.set({bases:e.bases(),color:e.get("color"),name:e.get("name"),folder_api_id:e.get("folder_api_id")})}))
this.sequence.sequencePrimers().get(e.id).click(this.model.get("sequence"))
ze.Z.invalidateFolderContents(e.get("folder_api_id"))
eo.Z.fetch(e.get("folder_api_id"),{summary:"1"}).then((t=>{lo.isRegistry(t.source)||Qe.Z.set(Qe.O.OLIGO,e.get("folder_api_id"))}))}trackSavePrimersFailure(e,t){v.ZP.notifyError(e)
m.j("primer","save_primers_fail",{product:j.XC.MOLBIO,numPrimers:t,error:v.ZP.getFriendlyError(e),sequence_id:this._sequence.get("id")})}trackSavePrimersSuccess(e,t){m.j("primer","save_primers_success",{product:j.XC.MOLBIO,numPrimers:e,primerApiIds:t,sequence_id:this._sequence.get("id")})}_savePrimerHelper(e){const savePrimer=()=>{this.model.saving(this.fieldIndex(e),!0)
const t=e.save({},{fileUpdate:!0});(0,S.Gp)(t,`Managed to savePrimer with invalid primer: ${e.validationError}`)
if(t)return t.fail((e=>{this.trackSavePrimersFailure(e,1)})).done((()=>{this.trackSavePrimersSuccess(1,[e.get("primer_api_id")])
this.handleSavedPrimer(e)})).always((()=>{this.model.saving(this.fieldIndex(e),!1)
this.sequence.updateVersions()}))
v.ZP.error("An unexpected error has occurred.")}
if(!this.isNameTooLong(e)){if(e.has("primer_api_id"))return CheckPrimer_checkPrimer(e.get("primer_api_id"),e.bases(),savePrimer,this._sequence.id,(e=>{this.trackSavePrimersFailure(e,1)}))
savePrimer()}}savePrimer(e){null==e&&({primer:e}=this)
this._savePrimerHelper(e)}savePrimerPair(){let e
m.j("primer","save_primers_click",{product:j.XC.MOLBIO,numPrimers:2,sequence_id:this.sequence.get("id")})
const savePrimer=e=>{this.model.saving(this.fieldIndex(e),!0)
return e.save(null,{fileUpdate:!0}).fail((e=>{this.trackSavePrimersFailure(e,2)})).done((()=>{this.handleSavedPrimer(e,!1)}))},checkPrimer=t=>{e=o().Deferred()
t.has("primer_api_id")?CheckPrimer_checkPrimer(t.get("primer_api_id"),t.bases(),(()=>e.resolve()),this.sequence.id,(e=>{this.trackSavePrimersFailure(e,2)})):e.resolve()
return e.promise()}
this.isNameTooLong(this.primer)||this.isNameTooLong(this.primer2)||checkPrimer(this.primer).then((()=>checkPrimer(this.primer2))).then((()=>savePrimer(this.primer))).then((()=>savePrimer(this.primer2))).then((()=>{const t=this.sequence.primerPairs().findPair(this.primer,this.primer2),success=e=>{const[t,n]=Array.from(e.getPrimers(this.sequence.sequencePrimers()))
this.sequence.get("selection").selectPair(t,n)
this.sequence.get("selection").trigger("showLinks")
this.model.close(!1)}
e=o().Deferred()
if(null!=t){v.ZP.success("Primer pair updated.")
success(t)
return e.resolve()}{const t=this.sequence
t.primerPairs().create({primer_fwd_id:this.primer.id,primer_rev_id:this.primer2.id},{wait:!0,error(n,a){m.j("primer","save_primers_fail",{product:j.XC.MOLBIO,numPrimers:2,error:v.ZP.getFriendlyError(a),sequence_id:t.get("id")})
e.reject()},success:t=>{v.ZP.success("Primers successfully linked.")
m.j("primer","linked_primers",{forward_primer:`${this.primer.id}-${this.primer.name()}`,reverse_primer:`${this.primer2.id}-${this.primer2.name()}`,sequence_id:this.sequence.get("id")})
this.trackSavePrimersSuccess(2,[this.primer.get("primer_api_id"),this.primer2.get("primer_api_id")])
success(t)
e.resolve()}})
return e.promise()}})).always((()=>this.sequence.updateVersions()))}renderPosition(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e)
this.$(".js-primer-position").eq(t).val(T.modelToDisplay(e.bindPosition(this._sequence),this._sequence.startIndex()))}renderStats(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=this.$(".js-tm").eq(t),a=this.$(".js-gc").eq(t),i=this.$(".js-length").eq(t),s=e.meltingTemperature()
n.html(Number.isNaN(s)?"--":`${s.toFixed(1)}°C`)
const r=y.gc(e.bindingBases(),e.nucleotideType())
a.text(Number.isNaN(r)?"--":`${(100*r).toFixed(2)}%`)
i.html(`${e.length()} bp`)
const[o,l]=Array.from(this.getMinMaxOverhang(e))
this.$(".js-overhang-size").eq(t).attr({min:o,max:l})
this.renderOverhangMessage(e)}renderAssemblyFields(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=isAssemblyPrimer(this._sequence,e),a=isAssemblyPrimer(this._sequence,e,To.GIBSON),i=isAssemblyPrimer(this._sequence,e,To.GOLDEN_GATE),s={".overhang":!n,".primer-position":!n,".save-library":!n,".binding":n,".homology":a,".pre-recognition-site":i,".post-recognition-site":i}
Object.entries(s).forEach((([e,n])=>{this.$(e).eq(t).toggleClass("invisible",!n)
this.toggleGroup(e)}))
this.$(".swatch-big").eq(t).css("pointer-events",n?"none":"")
this.$(".js-binding").prop("disabled",!this.sequence.get("currentVersion"))
this.$(".js-homology").prop("disabled",!this.sequence.get("currentVersion"))}renderAssemblyFieldValues(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e)
this.$(".js-binding").eq(t).val(e.bindingBases().length||"")
this.$(".js-homology").eq(t).val(e.overhangLength()||"")
if(isAssemblyPrimer(this._sequence,e,To.GOLDEN_GATE)){const{preRecognitionSite:n,postRecognitionSite:a}=this._getGoldenGatePrimerParts(e),i=this.$(".js-pre-recognition-site").eq(t)
i.val()!==n&&i.val(n)
const s=this.$(".js-post-recognition-site").eq(t)
s.val()!==n&&s.val(a)}}renderNucleotideTypeRadioButton(){this.$el.find(".nucleotide-type-group input").prop("disabled",this.primer.referencesExistingOligo())}renderOverhangMessage(e){null==e&&({primer:e}=this)
const t=this.fieldIndex(e),n=this.$(".overhang-too-small-msg").eq(t),a=this.$(".overhang-too-large-msg").eq(t),i=this.$(".js-overhang-size").eq(t),[s,r]=Array.from(this.getMinMaxOverhang(e)),o=i.val().length>0?parseInt(i.val(),10):0
n.toggleClass("invisible",o>=s)
a.toggleClass("invisible",o<=r)
this.toggleGroup(".overhang-too-small-msg")
this.toggleGroup(".overhang-too-large-msg")
n.find(".overhang-num").text(this.primer.get("overhang_length"))
a.find(".overhang-num").text(this.primer.get("overhang_length"))}renderSaveButton(e){const t=this.fieldIndex(e),n=this.$(".js-save").eq(t),a=this.model.isSaving(t)||!e.isValid()||!this.sequence.get("currentVersion")||this.isNameTooLong(e)||e.fromSubPart()
n.toggleClass("disabled",a).attr("disabled",a)}renderSavePair(){const e=this.primer.isValid()&&(null!=this.primer2?this.primer2.isValid():void 0)&&this.sequence.get("currentVersion")&&this.computeProductLength()>0,t=this.model.isSaving(this.fieldIndex(this.primer))||this.model.isSaving(this.fieldIndex(this.primer2)),n=!e||t||this.isNameTooLong(this.primer)||this.isNameTooLong(this.primer2)
this.$(".save-pair").toggleClass("is-disabled",n).attr("disabled",n)}renderMeltingTempDiff(){let e
const t=this.primer.meltingTemperature(),n=this.primer2.meltingTemperature()
if(Number.isNaN(t)||Number.isNaN(n))e="--"
else{const a=n-t
e=a.toFixed(2)
a>0&&(e=`+${e}`)
e=`${e}°C`}this.$(".js-tm-diff").html(e)}autoSecondaryCheck(){this.model.get("analyzeSecondary")&&l.default.defer((()=>{this.$(".js-check-secondary").focus()
this.$(".js-check-secondary").click()
this.model.set({analyzeSecondary:!1})}))}isNameTooLong(e){return e.get("name").length>tn.Jb}render(){let e,t,n,a
if(!this.sequence.get("currentVersion")){this.$el.html(So({}))
return this}if(this.sequence.isEmpty()){this.model.removePrimers(this.primer,this.primer2)
this.$el.html(Eo({}))
return this}const i=this.model.get("primer").referencesExistingOligo()
let s=!1
if(this.model.has("primer2")){a=ho
s=this.model.get("primer2").referencesExistingOligo()
const checkBoth=e=>e(this.model.get("primer"))||e(this.model.get("primer2"))
n=checkBoth((e=>!isAssemblyPrimer(this._sequence,e)))
e=checkBoth((e=>isAssemblyPrimer(this._sequence,e,To.GIBSON)))
t=checkBoth((e=>isAssemblyPrimer(this._sequence,e,To.GOLDEN_GATE)))}else{a=go
n=!isAssemblyPrimer(this._sequence,this.model.get("primer"))
e=isAssemblyPrimer(this._sequence,this.model.get("primer"),To.GIBSON)
t=isAssemblyPrimer(this._sequence,this.model.get("primer"),To.GOLDEN_GATE)}this.$el.html(a({enzymes:this.enzymes.toJSON(),showEnzymes:n,assemblyPrimerHelp:co({isGibson:e,isGoldenGate:t}),isGoldenGate:t,primer1Exists:i,primer2Exists:s}))
this.$(".glyphicon-question-sign").tooltip({placement:"bottom",container:"body"})
this.initializeFields(this.model.get("primer"),0)
null!=this.model.get("primer2")&&this.initializeFields(this.model.get("primer2"),1)
this.stopListening(this.primer)
null!=this.primer2&&this.stopListening(this.primer2)
const r=null!=this.primer&&null==this.model.get("primer")?this.primer:null,o=null!=this.primer2&&null==this.model.get("primer2")?this.primer2:null
this.model.removePrimers(r,o)
this.primer=this.model.get("primer")
this.primer2=this.model.get("primer2")
this.$el.find(".nucleotide-type-group").removeClass("hidden")
this.renderNucleotideTypeRadioButton()
this.registerListeners();({dna:this.dna,selection:this.selection}=this.model.get("sequence").attributes)
this.renderStats(this.primer)
this.renderSaveButton(this.primer)
this.renderAssemblyFields(this.primer)
this.renderAssemblyFieldValues(this.primer)
this.$(".js-strand").prop("disabled",isAssemblyPrimer(this._sequence,this.primer))
if(null!=this.primer2){this.renderStats(this.primer2)
this.renderSaveButton(this.primer2)
this.renderAssemblyFields(this.primer2)
this.renderAssemblyFieldValues(this.primer2)
this.renderMeltingTempDiff()
this.renderProductLength()
this.renderSavePair()}this.$(".edit-primer-enzymes").select2({placeholder:"Enzyme"})
this.renderLibraries()
this.renderSecondary()
this.renderSecondaryTemp()
this.showBases(this.primer)
this.colorPicker.attach(this.$(".swatch-big").eq(0),"manual",".edit-primer .swatch-big:eq(0)")
this.colorPicker.update(this.primer)
this.renderUsedPrimer(this.primer)
this.renderBaseMsg(this.primer)
this.findExistingName(this.primer)
this.checkNameLength(this.primer)
if(null!=this.primer2){this.showBases(this.primer2)
this.colorPicker2.attach(this.$(".swatch-big").eq(1),"manual",".edit-primer .swatch-big:eq(1)")
this.colorPicker2.update(this.primer2)
this.renderUsedPrimer(this.primer2)
this.renderBaseMsg(this.primer2)
this.findExistingName(this.primer2)
this.checkNameLength(this.primer2)}this.model.addValidPrimers()
this.autoSecondaryCheck()
return this}}EditPrimerView_TabView.initClass()
var vo
!function(e){e[e.FOLDERS=1]="FOLDERS"
e[e.SINGLE=2]="SINGLE"
e[e.BASES=3]="BASES"
e[e.WORKLIST=4]="WORKLIST"}(vo||(vo={}))
const Co={[tn.dw.LOCATION]:"Location",[tn.dw.TEMPERATURE]:"Temperature",[tn.dw.NAME]:"Name",[tn.dw.STRAND_PLUS]:"Strand (+)",[tn.dw.STRAND_MINUS]:"Strand (-)",[tn.dw.PERCENT_MATCH]:"Percent Match"}
var Io=n(229329)
function FindPrimersTabMenu({highlight:e,setHighlight:t,showSave:n,disableSave:a,addSelectedPrimers:i}){return d.createElement("ul",{className:"nav navbar-nav form-inline"},d.createElement("li",null,d.createElement(Io.Z,{onChange:e=>{t(e.target.checked)},checked:e,id:"highlight-matching-bases",label:"Highlight matching bases"})),n&&d.createElement("li",{className:"pull-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.MINI,onClick:async()=>{await i()},disabled:a,text:"Attach Selected Primers",dataTestAttrs:{component:"FindPrimersTabMenu",element:"attachButton"}})))}var wo=n(786628)
class FindPrimersOptionsView extends s().View{static initClass(){this.prototype.className="navbar"
this.prototype.tagName="div"}initialize(){this.saving=!1
this.listenTo(this.model,"selectChange",(()=>this.render()))
this.listenTo(this.model.get("sequence"),"change:currentVersion",(()=>this.render()))
this.listenTo(this.model.get("sequence").get("_sequence"),"change:locked",(()=>this.render()))
this.listenTo(this.model,"change:findType",(()=>this.render()))
this.listenTo(this.model,"change:highlightMatches",(()=>this.render()))}async addSelectedPrimers(){if(this.saving)return
const e=this.model.get("sequence")
m.j("primer","attach_selected_click",{product:wo.X.MOLBIO,sequence_id:e.get("id")})
const t=e.get("_sequence").sequencePrimers(),n=this.model.getNewPrimers()
if(0!==n.length)try{this.saving=!0
this.render()
const{primers:a}=await Cn.s0({url:t.url(),data:n.map((e=>e.toJSON()))})
for(const e of n)e.set({disabled:!0})
t.remove(n)
t.add(a)
await e.updateVersions()
v.ZP.success(`Successfully added ${n.length} primer(s).`)
m.j("primer","added_primers",{product:wo.X.MOLBIO,source:"find-primers",sequence_api_id:e.id,primer_count:n.length})}catch(e){v.ZP.error("An error occurred while trying to save a primer.")}finally{this.saving=!1
this.render()}else v.ZP.error("Select new primers to add first.")}render(){(0,Me.A9)(d.createElement(FindPrimersTabMenu,{highlight:this.model.get("highlightMatches"),setHighlight:e=>{this.model.set("highlightMatches",e)},showSave:this.model.get("findType")!==vo.BASES,disableSave:this.saving||!this.model.get("sequence").allowFeatureEdits()||0===this.model.get("sequence").sequencePrimers().filter((e=>e.isNew())).length,addSelectedPrimers:async()=>{await this.addSelectedPrimers()}}),this.$el[0])
return this}}FindPrimersOptionsView.initClass()
var No=n(630981),Ao=n(144601),Ro=n(221624),Po=n(117170)
function NucleotideTypeSelector({columnSize:e}){return d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-3"}),d.createElement("div",{className:`col col-sm-${e}`},d.createElement("select",{className:"js-nucleotide-type"},d.createElement("option",{value:R.Wy.DNA},"with a nucleotide type of DNA"),d.createElement("option",{value:R.Wy.RNA},"with a nucleotide type of RNA"))))}function SavedPrimerFind({searchName:e,searchBases:t}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-3 left-label text-right"},"Search folders for"),d.createElement("div",{className:"col col-md-6"},d.createElement("input",{type:"text",placeholder:"Name",className:"search-name search-input",defaultValue:e,...(0,ee.Z)({component:"SavedPrimerFind",element:"primerName"})}))),d.createElement(NucleotideTypeSelector,{columnSize:6}),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-6 col-md-offset-3"},d.createElement("input",{type:"text",placeholder:"Bases (exact)",className:"search-bases search-input",defaultValue:t}),d.createElement("div",{className:f()("js-base-coercion-warning",(0,g.iv)(Oo.baseCoercionWarning))})),d.createElement("div",{className:"col col-md-3"},d.createElement("button",{type:"button",className:"button button--small button--secondary js-search-primers",...(0,ee.Z)({component:"SavedPrimerFind",element:"primerSearchButton"})},"Search"))),d.createElement("div",{className:"search-loading spinner hidden"}),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-9 col-md-offset-3"},d.createElement("ul",{className:"search-results scroll"}),d.createElement("p",{className:"no-search-results hidden"},"No matching primers were found."))))}const Oo=g.mM.create({baseCoercionWarning:{color:Vt.pp,..._n.E0}})
var xo=n(16133),_o=n(992583),Do=n(493437)
function BasesSearchInput({searchBases:e}){return d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-3"}),d.createElement("div",{className:"col col-sm-6"},d.createElement("input",{type:"text",placeholder:"Bases",className:"search-bases",defaultValue:e,...(0,ee.Z)({component:"BasesSearchInput",element:"basesSearchInput"})}),d.createElement("div",{className:f()("js-base-coercion-warning",(0,g.iv)(Lo.baseCoercionWarning))})))}const Lo=g.mM.create({baseCoercionWarning:{color:Vt.pp,..._n.E0}})
const ko=(0,be.Z)((function FindPrimersTab(){return d.createElement(d.Fragment,null,d.createElement("div",{className:"find-type"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-3 left-label text-right"},"Find binding sites"),d.createElement("div",{className:"col col-sm-6"},d.createElement("select",{...(0,ee.Z)({component:"FindPrimersTab",element:"optionsDropdown"})},d.createElement("option",{value:vo.FOLDERS},"for all primers in specified folders"),d.createElement("option",{value:vo.SINGLE},"for a single saved primer"),d.createElement("option",{value:vo.BASES},"for arbitrary bases you provide"),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement("option",{value:vo.WORKLIST},"for all primers in specified worklist"))))),d.createElement("hr",null),d.createElement("form",{className:"search-query-form"},d.createElement("div",{className:"js-find-type-params"}),d.createElement("div",{className:"js-match-params"},d.createElement("div",{className:"row form-group"},d.createElement("span",{className:"col col-sm-3 text-right"},d.createElement("strong",{className:"min-bases-length-warning control-label text-danger hidden"},"Must match ",`${Xi.ud} ${Ue.MIN_PRIMER_LENGTH}`,".")),d.createElement("span",{className:"col col-sm-9 js-misprime-settings"})),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-3"}),d.createElement("div",{className:"col col-sm-6"},"with 3' position in"," ",d.createElement("input",{type:"text","data-find-param":"minBaseIndex",className:"min-base-index find-param"})," -"," ",d.createElement("input",{type:"text","data-find-param":"maxBaseIndex",className:"max-base-index find-param"})),d.createElement("div",{className:"col col-sm-3"},d.createElement("button",{type:"button",className:"button button--tertiaryGray button--mini js-set-selection is-disabled"},"Use Selection"))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-3"}),d.createElement("div",{className:"col col-sm-9"},d.createElement("button",{type:"submit","data-loading-text":"Finding...",className:"button button--secondary button--small js-find-primers u-mini-spacing-right",...(0,ee.Z)({component:"FindPrimersTab",element:"findBindingSitesButton"})},"Find Binding Sites"),d.createElement("a",{className:"tm-params-link"},"T",d.createElement("sub",null,"m")," parameters"))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-sm-9 col-sm-offset-3"},d.createElement("div",{className:"js-existing-primers hide"}))))),d.createElement("hr",null),d.createElement("div",{className:"loading spinner hidden"}),d.createElement("div",{className:"results hidden"},d.createElement("p",null,d.createElement("span",{className:"normal-results"},d.createElement("strong",{className:"num-matched"})," primer(s) were found."),d.createElement("span",{className:"more-results-notice hidden"},d.createElement("strong",null,"Too many matches were found"),"—only the first"," ",d.createElement("span",{className:"max-results-count"})," matches are shown here.")),d.createElement("p",{className:"lower-tm-results hidden"},d.createElement("img",{src:"/static/img/warning.png"})," Matches with low melting temperatures were found but not shown."),d.createElement("p",{className:"higher-tm-results hidden"},d.createElement("img",{src:"/static/img/warning.png"})," Matches with high melting temperatures were found but not shown."),d.createElement("div",{className:"results-section"}),d.createElement("div",{className:"no-results well hidden"},"No binding locations were found.")),d.createElement("div",{className:"save-new-primers hidden"},d.createElement("hr",null),d.createElement("div",{className:"row"},d.createElement("div",{className:"col-md-3 text-right"},"Name"),d.createElement("div",{className:"col col-md-6"},d.createElement("input",{type:"text",name:"primer-name",placeholder:"Enter a short name",className:"js-name",...(0,ee.Z)({component:"FindPrimersTab",element:"newPrimerNameField"})})),d.createElement("div",{className:"col col-md-1 text-right"},d.createElement("div",{className:"swatch-big"}))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col-md-3 text-right"},"Save To"),d.createElement("div",{className:"col col-md-6"},d.createElement("div",{className:"save-folder-selector-container"}))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-6 col-md-offset-3"},d.createElement("button",{type:"button",className:"button button--primary button--small is-disabled js-save single-save",...(0,ee.Z)({component:"FindPrimersTab",element:"saveSelectedPrimersButton"})},"Save Selected Primers")))))}))
function PrimerSearchResult({bases:e,libraryInfo:t,name:n}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"result-header",...(0,ee.Z)({component:"PrimerSearchResult",element:"resultHeader",key:n})},n,t),d.createElement("div",{className:"bases mono"},e))}class PrimerSearchResultView extends s().View{static initClass(){this.prototype.tagName="li"
this.prototype.events={click:"toggleSelected"}}initialize({sequence:e}){this.sequence=e
return this.listenTo(this.model,"change:selected",(()=>{this.renderSelected()}))}toggleSelected(){for(const e of this.model.collection.models)e.set({selected:!1})
this.model.set({selected:!this.model.get("selected")})}renderSelected(){this.$el.toggleClass("selected",null!=this.model.get("selected")&&this.model.get("selected"))}render(){let e
if(null!=this.model.folder()){const t=this.model.folder().name
e=` (${this.model.get("owner")} / ${t})`}else e="";(0,Me.A9)(d.createElement(PrimerSearchResult,{name:this.model.get("name"),libraryInfo:e,bases:this.model.get("bases")}),this.$el[0])
this.renderSelected()
return this}}PrimerSearchResultView.initClass()
var Mo=n(134749)
function FindPrimersRow({bases:e,checked:t,disabled:n,end:a,meltingTemperature:i,nucleotideType:s,name:r,onChange:o,onClick:l,onClickEdit:c,primerApiId:u,seqLength:m,showName:p,start:h,startIndex:E,strand:S}){const y=null!=u?u:`${S}-${h}`,b=(0,d.useRef)(null);(0,d.useEffect)((()=>{null==b.current||b.current.classList.contains("include-primer")||b.current.classList.add("include-primer")}))
return d.createElement("tr",{onClick:e=>{e.target!==b.current&&l()},className:f()((0,g.iv)(Fo.wrapper),{active:t,"disabled success":n})},d.createElement("td",null,d.createElement(Io.Z,{label:"Select primer",labelStyle:Mo.gF.HIDDEN,id:`find-primers-result-${y}`,inputRef:b,checked:t&&!n,disabled:n,onChange:e=>{n||o(e.target.checked)},dataTestAttrs:{component:"FindPrimersRow",element:"checkbox",key:r}})),p&&d.createElement("td",{...(0,ee.Z)({component:"FindPrimersRow",element:"primerName",key:r})},r),d.createElement("td",null,s),1===S?d.createElement("td",null,"+ / ",T.modelEndToDisplay(a,m,E)):d.createElement("td",null,"– / ",T.modelStartToDisplay(h,E)),d.createElement("td",null,i),d.createElement("td",{className:f()((0,g.iv)(Fo.bases),"sequence-primer-bases","mono"),dangerouslySetInnerHTML:{__html:e}}),d.createElement("td",null,!n&&d.createElement("a",{className:"edit",onClick:e=>{e.stopPropagation()
c()}},"Edit")))}const Fo=g.mM.create({bases:{width:"100%"},wrapper:{cursor:"pointer"}})
var Zo=n(920672)
function getResultSortOptionsAndDisplayNames(e){return e===vo.FOLDERS||e===vo.WORKLIST?{[tn.dw.LOCATION]:Co[tn.dw.LOCATION],[tn.dw.TEMPERATURE]:Co[tn.dw.TEMPERATURE],[tn.dw.NAME]:Co[tn.dw.NAME],[tn.b3]:"Strand",[tn.dw.PERCENT_MATCH]:Co[tn.dw.PERCENT_MATCH]}:{[tn.dw.LOCATION]:Co[tn.dw.LOCATION],[tn.dw.TEMPERATURE]:Co[tn.dw.TEMPERATURE],[tn.b3]:"Strand",[tn.dw.PERCENT_MATCH]:Co[tn.dw.PERCENT_MATCH]}}function strandCompHelper(e){return t=>t.strand()===e?-1/t.end():t.end()}const Bo={location:e=>t=>t.bindPosition(e),temperature:()=>e=>-y.meltingTemperature(e.bindingBases(),e.nucleotideType()),name:()=>e=>e.get("name"),strandPlus:()=>e=>strandCompHelper(1)(e),strandMinus:()=>e=>strandCompHelper(-1)(e),percentMatch:e=>t=>t.mismatchedIndices(e).length/t.bindingBases().length}
function FindPrimersResults({highlightMatches:e,findType:t,results:n,sequence:a,onSelectPrimer:i,onClickEdit:s}){const[r,o]=(0,Ln.Z)(tn.VF.RESULTS_SORT),l=(0,d.useRef)(null);(0,d.useEffect)((()=>{null==l.current||l.current.classList.contains("select-all")||l.current.classList.add("select-all")}))
const c=[vo.FOLDERS,vo.WORKLIST].includes(t)
let u
u=r!==tn.dw.NAME||c?r:tn.dw.LOCATION
const m=function sortResults(e,t,n){const a=Bo[t](n)
return(0,hs.Z)(e,[a])}(n,u,a),p=a.get("_sequence").sequencePrimers(),h=m.map((e=>{var t
return null!==(t=e.get("disabled"))&&void 0!==t?t:!e.isNew()})),E=m.map(((e,t)=>{if(h[t])return!1
const n=p.find((t=>t.cid===e.cid))
return null!=n&&n.isNew()})),S=E.some((e=>e)),y=S&&!E.every((e=>e)),b=h.every((e=>e))
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(qo.header)},d.createElement("h3",null,"Primers Search Results"),d.createElement($r.ZP,{displayName:d.createElement("span",null,d.createElement("span",{className:(0,g.iv)(qo.faded)},"Sort by "),d.createElement("span",null,Co[u])),menu:d.createElement(w.ZP,{value:u},Object.entries(getResultSortOptionsAndDisplayNames(t)).map((([e,t])=>d.createElement(N.Z,{key:e,value:e,onSelect:e=>{let t
t=e===tn.b3?u===tn.dw.STRAND_PLUS?tn.dw.STRAND_MINUS:tn.dw.STRAND_PLUS:e
o(t)}},t))))})),d.createElement("table",{className:f()("table","binding-sites",{"no-highlight-matches":!e})},d.createElement("colgroup",null,d.createElement("col",null),c&&d.createElement("col",{className:"name"}),d.createElement("col",{className:"location"}),d.createElement("col",{className:"tm"}),d.createElement("col",null),d.createElement("col",{className:"edit"})),d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,d.createElement(Io.Z,{checked:S,disabled:b,indeterminate:y,label:"",labelStyle:Mo.gF.HIDDEN,id:"find-primers-results-select-all",inputRef:l,onChange:()=>{if(!b){if(S){const e=m.filter(((e,t)=>E[t]&&!h[t]&&p.contains(e)))
p.batchModify((()=>{p.remove(e)}))}else{const e=m.filter(((e,t)=>!E[t]&&!h[t]&&!p.contains(e)))
p.batchModify((()=>{p.add(e)}))}i()}}})),c&&d.createElement("th",null,"Primer"),d.createElement("th",null,"Nucleotide Type"),d.createElement("th",null,"Position"),d.createElement("th",null,Xi.Mg),d.createElement("th",null,"Bases",d.createElement("span",{className:(0,g.iv)(qo.helpIconWrapper)},d.createElement(Zo.Z,{placement:ne.ZH.RIGHT,text:'Select "Highlight matching bases" at the top of this tab to mark bases matching the corresponding sequence in green.'},d.createElement(De.Z,null)))),d.createElement("th",null))),d.createElement("tbody",{...(0,ee.Z)({component:"FindPrimersResults",element:"resultsTable"})},m.map(((e,t)=>{var n
const r=h[t],o=E[t]
return d.createElement(FindPrimersRow,{bases:e.basesHtml(a),checked:o,disabled:r,end:e.end(),key:t,meltingTemperature:`${e.meltingTemperature().toFixed(1)}${Xi.ig}C`,nucleotideType:e.nucleotideType(),name:e.name(),onChange:t=>{t?p.add(e):p.remove(e)
i()},onClick:()=>{a.get("selection").setEndpoints(e.start(),e.end())
a.trigger("jump",e.start())},onClickEdit:()=>{s(e)},primerApiId:null!==(n=e.get("primer_api_id"))&&void 0!==n?n:null,seqLength:a.length(),showName:c,start:e.start(),startIndex:a.startIndex(),strand:e.strand()})})))))}const qo=g.mM.create({header:{display:"flex",width:"100%",justifyContent:"space-between"},faded:{color:Vt.TG},helpIconWrapper:{marginLeft:"5px"}})
class FindPrimersResultsView extends s().View{static initClass(){this.prototype.className=".binding-sites-container"}initialize({model:e,results:t}){this.results=t
this.listenTo(this.results,"sync",(e=>{this.renderResults(e)}))
this.listenTo(this.results,"change:disabled",(()=>{this.renderResults(this.results)}))
this.listenTo(this.model.get("sequence").get("_sequence").sequencePrimers(),"add remove sync",(()=>{this.renderResults(this.results)}))}renderResults(e){e===this.results&&(0,Me.A9)(d.createElement(FindPrimersResults,{highlightMatches:this.model.get("highlightMatches"),findType:this.model.get("findType"),results:this.results.models,sequence:this.model.get("sequence"),onSelectPrimer:()=>{this.model.trigger("selectChange")},onClickEdit:e=>{sn.edit(e.clone(),this.model.get("sequence"))}}),this.$el[0])}render(){return this}}FindPrimersResultsView.initClass()
function parseInput(e,t){let n=t(e.val())
if(isNaN(n)){e.val("")
n=t(e[0].defaultValue)}return n}class FindPrimersView_TabView extends s().View{static initClass(){this.prototype.className="find-primers-view buffer-tab"
this.prototype.events={"submit .search-query-form":"findPrimers","click .tm-params-link":"openTempParams","click .select-all":function(e){this.selectAllToggle(e)
this.renderSaveButton()},"change .include-primer":function(){this.renderSelectAll()
this.renderSaveButton()},"change .find-type select":"changeFindType","change .js-nucleotide-type":"changeNucleotideType","change .min-base-index":"changeMinBaseIndex","change .max-base-index":"changeMaxBaseIndex","input .search-name":"changeSearchName","input .search-bases":"changeSearchBases","input .search-input":"updateSearchButtonState","change .save-library-id-select":function(e){this.updateSelectedSaveLibrary(e)
this.renderSaveButton()},"input .js-name":function(e){this.changePrimerName(e)
this.renderSaveButton()},"click .js-save":"savePrimers","click .swatch-big":"pickColor","click .js-search-primers":"searchPrimers","click .js-existing-primer-use":"useExistingPrimer","click .js-set-selection":"setSelection"}
this.prototype.tagName="div"
this.prototype.template=ko}initialize(){this.onSelectFolder=this.onSelectFolder.bind(this)
this.findPrimersResults=this.model.get("results")
this.searchExisting=this.model.get("searchExisting")
this.searchExistingBases=this.model.get("searchExistingBases")
this.sequence=this.model.get("sequence")
this.listenTo(this.findPrimersResults,"request",this.showLoading)
this.listenTo(this.findPrimersResults,"sync",this.handleResultSync)
this.listenTo(this.model,"change:selectedLibraries",(function(){this.renderFindButton()
this.renderFindType()}))
this.listenTo(this.model,"change:highlightMatches",this.handleHighlightChange)
this.listenTo(this.model,"change:findType",this.renderFindType)
this.listenTo(this.model,"change:showResults",this.showResults)
this.listenTo(this.model,"change:color",this.closePicker)
this.listenTo(this.sequence.get("_sequence"),"change:bases change:circular change:startIndex",(function(){if(this.model.get("showResults")){this.model.set({showResults:!1})
this.findPrimers()}this.renderBaseIndices()}))
this.selection=this.sequence.get("selection")
this.listenTo(this.selection,"change",this.renderSelectionButton)
this.listenTo(this.sequence,"change:currentVersion",this.renderSaveButton)
this.listenTo(this.sequence.get("_sequence"),"change:locked",this.renderSaveButton)
this.listenTo(this.sequence.get("_sequence").sequencePrimers(),"add remove",this.renderSelectAll)
this.listenTo(this.searchExisting,"sync",this.renderFindButton)
this.listenTo(this.searchExisting,"change:selected",(function(){this.renderFindButton()
this.findPrimers()}))
this.listenTo(this.model,"change:minMatchingBases change:minMeltingTemp change:maxMeltingTemp change:maxMismatches change:maxTotalMismatches change:exactMatch change:uniqueMatch",this.renderMisprimeSettings)
this.listenTo(this.model,"change:minMatchingBases",this.validateMinBases)
this.colorPicker=new Xr.Z
this.resultsView=new FindPrimersResultsView({model:this.model,results:this.findPrimersResults})
return this.searchResultViews=[]}renderSelectionButton(){const e=null===this.selection.get("end")
return this.$(".js-set-selection").toggleClass("is-disabled",e)}setSelection(){const e=this.selection.get("start"),t=this.selection.get("end")
this.model.set({minBaseIndex:e,maxBaseIndex:t})
this.$(".min-base-index").val(T.modelStartToDisplay(e,this.sequence.startIndex()))
return this.$(".max-base-index").val(T.modelEndToDisplay(t,this.sequence.length(),this.sequence.startIndex()))}renderFindButton(){const e=(()=>{switch(this.model.get("findType")){case vo.FOLDERS:return 0===this.model.prepareSelectedLibrariesForFind().length
case vo.SINGLE:return null==this.searchExisting.findWhere({selected:!0})
case vo.BASES:return!1
case vo.WORKLIST:return 0===this.model.prepareSelectedLibrariesForFind().length}})()
this.$(".js-find-primers").toggleClass("is-disabled",e)
this.$(".js-find-primers").attr("disabled",e)}validateMinBases(e){const t=this.model.get("minMatchingBases")
this.$(".min-bases-length-warning").toggleClass("hidden",t>=Ue.MIN_PRIMER_LENGTH)
return this.$(".search-query-form button").toggleClass("disabled",t<Ue.MIN_PRIMER_LENGTH)}remove(){super.remove()
this.resultsView.remove()
null!=this.saveFolderSelectorView&&this.saveFolderSelectorView.remove()
u.unmountComponentAtNode(this.$(".js-find-type-params")[0])}findPrimers(e){null!=e&&e.preventDefault()
if(this.$(".js-find-primers").hasClass("is-disabled"))return
m.j("primer","find_binding_sites_click",{product:j.XC.MOLBIO,sequence_id:this.sequence.get("id")})
this.$(".js-find-primers").button("loading")
this.model.removePrimers()
const t=this.$(".more-results-notice"),n=this.$(".normal-results")
t.addClass("hidden")
n.removeClass("hidden")
const a=this.model.get("minMatchingBases"),i=this.model.get("maxMismatches"),s=this.model.get("maxTotalMismatches"),r=this.model.get("minMeltingTemp"),l=this.model.get("maxMeltingTemp"),c=this.model.get("exactMatch"),d=this.model.get("uniqueMatch"),u={min_matching_bases:a,min_temp:r,max_temp:l,min_base_index:T.displayStartToModel(parseInput(this.$(".min-base-index"),parseInt),this.sequence.startIndex()),max_base_index:T.displayEndToModel(parseInput(this.$(".max-base-index"),parseInt),this.sequence.length(),this.sequence.startIndex()),exact_match:c,unique_match:d,max_total_mismatches:s,max_mismatches:i};(0,Do.p)(this.model.getMisprimingState())
switch(this.model.get("findType")){case vo.FOLDERS:{const e=this.model.prepareSelectedLibrariesForFind()
Qe.Z.setList(Qe.O.FIND_OLIGO,e)
u.folderIds=e
u.nucleotideType=this.$(".js-nucleotide-type").val()
break}case vo.SINGLE:{const e=this.searchExisting.findWhere({selected:!0})
u.oligoId=e.get("primer_id")
break}case vo.BASES:u.bases=this.$(".search-bases").val()
u.nucleotideType=this.$(".js-nucleotide-type").val()
break
case vo.WORKLIST:{const e=this.model.prepareSelectedLibrariesForFind();(0,S.Gp)(1===e.length,`Expected exactly one selected worklist in find primers, got ${e.length}.`)
if(!e.length)return
u.worklistId=e[0]
u.nucleotideType=this.$(".js-nucleotide-type").val()
break}}u.dnaTmPreferences=We.Z.get(tn.gq.MELTING_TEMP_DNA)
u.rnaTmPreferences=We.Z.get(tn.gq.MELTING_TEMP_RNA)
o().Deferred().resolve().promise().then((()=>this.model.get("findType")!==vo.BASES?null:this.searchExistingBases.fetch({data:{bases:this.$(".search-bases").val(),nucleotideType:this.$(".js-nucleotide-type").val()}}).then((()=>this.renderExistingPrimers())))).then((()=>this.findPrimersResults.fetch({data:u}))).always((()=>{this.$(".js-find-primers").button("reset")
this.$(".loading").addClass("hidden")
this.$(".find-type").removeClass("disabled")})).fail((e=>{m.j("primer","find_primers_fail",{product:j.XC.MOLBIO,error:v.ZP.getFriendlyError(e)})
v.ZP.notifyError(e)})).done((e=>{if(this.model.get("findType")===vo.BASES)for(const e of Array.from(this.findPrimersResults.models))e.set({color:this.model.get("color")})
m.j("primer","found_primers",{product:j.XC.MOLBIO,count:this.findPrimersResults.length,more_results:e.more_results,lower_tm_results:e.lower_tm_results,higher_tm_results:e.higher_tm_results,sequence_id:this.sequence.get("id")})
if(e.more_results){t.find(".max-results-count").text(e.max_results)
t.removeClass("hidden")
n.addClass("hidden")}this.$(".lower-tm-results").toggleClass("hidden",!e.lower_tm_results)
this.$(".higher-tm-results").toggleClass("hidden",!e.higher_tm_results)
for(const e of Array.from(this.findPrimersResults.models)){null!=this.sequence.get("_sequence").sequencePrimers().findWhere({start:e.get("start"),end:e.get("end"),primer_id:e.get("primer_id")})&&e.set({disabled:!0})}this.renderSaveButton()}))}renderExistingPrimers(){const e=this.$(".js-existing-primers")
if(this.model.get("findType")!==vo.BASES||0===this.searchExistingBases.length)return e.addClass("hide")
e.html(fo({primers:this.searchExistingBases.models,single:!0,used:!1}))
return e.removeClass("hide")}openTempParams(e){e.preventDefault();(0,Xn.Z)(MeltingTempModal,{})}handleHighlightChange(e,t){return this.$(".binding-sites").toggleClass("no-highlight-matches",!t)}showLoading(e){if(e===this.findPrimersResults){this.$(".loading").removeClass("hidden")
this.$(".find-type").addClass("disabled")
return this.model.set({showResults:!1})}}handleResultSync(e){if(e===this.findPrimersResults){this.$(".loading").addClass("hidden")
this.$(".find-type").removeClass("disabled")
this.model.unset("showResults",{silent:!0}).set({showResults:!0})
return this.$(".no-results").toggleClass("hidden",0!==this.findPrimersResults.length)}}showResults(){if(this.model.get("showResults")){this.$(".results").removeClass("hidden")
this.$(".num-matched").text(this.findPrimersResults.length)
this.$(".select-all").prop({checked:!1,indeterminate:!1})
if(this.model.get("findType")===vo.BASES){this.$(".save-new-primers").removeClass("hidden")
null!=this.saveFolderSelectorView&&this.saveFolderSelectorView.remove()
this.saveFolderSelectorView=new to.Z({initialFolderId:this.model.get("selectedSaveLibrary"),inputClassName:"save-library-id-select",props:{showInventory:!0}})
this.$(".save-folder-selector-container").html(this.saveFolderSelectorView.render().el)
return this.renderSaveButton()}return this.$(".save-new-primers").addClass("hidden")}this.$(".results").addClass("hidden")
this.$(".save-new-primers").addClass("hidden")
return this.model.removePrimers()}selectAllToggle(e){const t=o()(e.currentTarget).prop("checked")
t&&m.j("primer","select_primers",{product:j.XC.MOLBIO})
this.findPrimersResults.forEach((e=>{var n
const a=this.sequence.get("_sequence").sequencePrimers(),i=a.find((t=>t.cid===e.cid));(null!=(n=e.get("disabled"))?n:null!=i&&!i.isNew())||(t&&!a.contains(e)?a.add(e):!t&&a.contains(e)&&a.remove(e))}))
this.model.trigger("selectChange")
if(this.model.get("showResults")){this.resultsView.renderResults(this.findPrimersResults)
this.renderSelectAll()}}renderSelectAll(){const e=this.$(".include-primer").length,t=this.$(".include-primer:checked").length,n=t>0,a=n&&t===e
return this.$(".select-all").prop({checked:n,indeterminate:!a&&n})}changeNucleotideType(e){const t=o()(e.currentTarget).val(),n=(0,y.sanitize)(this.model.get("searchBases"),t)
this.model.set("searchBases",n)
this.$(".search-bases").val(n)
this.toggleBaseCoercionWarning(!1)
return this.model.set("nucleotideType",t)}changeFindType(e){return this.model.set({findType:parseInt(o()(e.currentTarget).val()),showResults:!1})}changeMinBaseIndex(e){this.model.set("minBaseIndex",T.displayStartToModel(parseInt(o()(e.currentTarget).val()),this.sequence.startIndex()))}changeMaxBaseIndex(e){this.model.set("maxBaseIndex",T.displayEndToModel(parseInt(o()(e.currentTarget).val()),this.sequence.length(),this.sequence.startIndex()))}onSelectFolder(e){this.model.set({selectedLibraries:e.map((e=>e.api_identifier))})}onSelectWorklist(e){null!=e.worklist?this.model.set({selectedLibraries:[e.worklist.id]}):this.model.set({selectedLibraries:[]})}renderFindType(){const e=this.model.get("findType")
this.$(".find-type select").val(e)
const t=this.$(".js-find-type-params"),n=this.$(".js-match-params")
switch(e){case vo.FOLDERS:(0,Me.A9)(d.createElement("div",null,d.createElement(h.Z,null,d.createElement("div",{className:"col col-sm-3 u-small-padding-top"},d.createElement("div",{className:"text-right"},"Use primers in")),d.createElement("div",{className:"col col-sm-9"},d.createElement(Ao.Z,{selectedFolderIds:this.model.get("selectedLibraries"),showInventory:!0,onSelectFolders:this.onSelectFolder,dataTestAttrs:{component:"FindPrimersTab",element:"folderSelector"}}))),d.createElement(NucleotideTypeSelector,{columnSize:9})),t[0])
n.removeClass("hidden")
break
case vo.SINGLE:(0,Me.A9)(d.createElement(SavedPrimerFind,{searchBases:this.model.get("searchBases"),searchName:this.model.get("searchName")}),t[0])
this.updateSearchButtonState()
this.searchExisting.length>0&&this.renderSearchResults()
n.toggleClass("hidden",0===this.searchExisting.length)
break
case vo.BASES:(0,Me.A9)(d.createElement("div",null,d.createElement(BasesSearchInput,{searchBases:this.model.get("searchBases")}),d.createElement(NucleotideTypeSelector,{columnSize:6})),t[0])
n.removeClass("hidden")
break
case vo.WORKLIST:(0,Me.A9)(d.createElement("div",null,d.createElement(h.Z,null,d.createElement("div",{className:"col col-sm-3 u-small-padding-top"},d.createElement("div",{className:"text-right"},"Use primers in")),d.createElement("div",{className:"col col-sm-9"},d.createElement(Ro.Z,{onChange:e=>{this.onSelectWorklist(e)},worklistTypes:[Po.FN.BIOENTITY],label:""}))),d.createElement(NucleotideTypeSelector,{columnSize:9})),t[0])
n.removeClass("hidden")}this.toggleBaseCoercionWarning(!1)
this.renderExistingPrimers()
this.renderFindButton()
this.$(".js-nucleotide-type").val(this.model.get("nucleotideType"))
this.$(".results").addClass("hidden")
this.$(".save-new-primers").addClass("hidden")}changeMismatchType(e){return this.model.set({mismatchType:parseInt(o()(e.currentTarget).val())})}changePrimerName(e){return this.model.set({primerName:o()(e.currentTarget).val()})}_isSearchPrimersDisabled(){return""===this.$(".search-name").val()&&""===this.$(".search-bases").val()}updateSearchButtonState(){const e=this._isSearchPrimersDisabled()
this.$(".js-search-primers").toggleClass("is-disabled",e)}updateBaseCoercionWarningText(e){this.$(".js-base-coercion-warning").text((0,xo.DD)(e))}toggleBaseCoercionWarning(e){this.$(".js-base-coercion-warning").toggle(e)}changeSearchBases(e){const t=o()(e.currentTarget).val(),{sanitizedBases:n,errors:{convertedUToT:a,convertedTToU:i}}=(0,y.getSanitizedBasesAndSanitizationErrors)(t,this.model.get("nucleotideType"))
if(a||i){this.toggleBaseCoercionWarning(!0)
this.updateBaseCoercionWarningText(this.model.get("nucleotideType"))}this.$(".search-bases").val(n)
this.model.set({searchBases:n})
this.$(".min-matching-bases").val(n.length).trigger("change")}changeSearchName(e){this.model.set({searchName:o()(e.currentTarget).val()})}updateSelectedSaveLibrary(e){this.model.set({selectedSaveLibrary:o()(e.currentTarget).val()})}_isSaveDisabled(e,t){return 0===e.length||0===t.length||0===this.$(".include-primer:checked").length||!this.model.get("sequence").allowFeatureEdits()}renderSaveButton(){const e=this.$(".js-name").val(),t=this.$(".save-library-id-select").val()
this.$(".js-save").toggleClass("is-disabled",this._isSaveDisabled(e,t))}pickColor(e){return this.$(".swatch-big").popover("show")}closePicker(){const e=this.$(".swatch-big")
e.css("background-color",this.model.get("color"))
this.colorPicker.update(this.model)
e.popover("hide")
return Array.from(this.model.getNewPrimers()).map((e=>e.set({color:this.model.get("color")})))}savePrimers(){const e=this.model.get("sequence"),t=e.get("_sequence").sequencePrimers(),n=this.$(".js-name").val(),a=this.$(".save-library-id-select").val()
if(this._isSaveDisabled(n,a))return
const i=this.model.getNewPrimers(),r=i[0].bases(),o=i[0].color(),l=i[0].nucleotideType()
Cn.ty({url:"/1/api/oligos/",data:{name:n,bases:r,color:o,folderId:a,nucleotideType:l,notation:R.gO.NATURAL_BASES}}).fail(v.ZP.notifyError).done((r=>{let o
const l=new Ue.SequencePrimerCollection((()=>{const e=[]
for(const t of Array.from(i)){o=t.clone()
o.set({name:n,folder_api_id:a,primer_api_id:r.id})
e.push(o)}return e})(),{sequenceID:e.id})
s().sync("create",l,{fileUpdate:!0}).fail(v.ZP.notifyError).done((({primers:n,message:a})=>{for(o of Array.from(i))o.set({disabled:!0})
t.batchModify((function(){return this.add(n,{parse:!0})}))
e.updateVersions()
v.ZP.success(a)
m.j("primer","added_primers",{product:j.XC.MOLBIO,source:"find-primers",sequence_api_id:e.id,primer_count:i.length})}))}))}searchPrimers(){if(this._isSearchPrimersDisabled())return
this.model.removePrimers()
const e=this.$(".search-name").val(),t=this.$(".search-bases").val(),n=this.$(".js-nucleotide-type").val()
this.$(".js-match-params").addClass("hidden")
this.$(".search-loading").removeClass("hidden")
this.searchExisting.fetch({data:{name:e,bases:t,nucleotideType:n}}).fail(v.ZP.notifyError).done((()=>this.renderSearchResults()))}useExistingPrimer(e){const t=o()(e.currentTarget).data("primerId"),n=this.model.get("searchExistingBases").findWhere({primer_id:t})
n.set({selected:!0})
this.model.get("searchExisting").reset([n])
return this.model.set({findType:vo.SINGLE})}renderSearchResults(){let e
for(e of Array.from(this.searchResultViews))e.remove()
this.searchResultViews=Array.from(this.searchExisting.models).map((e=>new PrimerSearchResultView({model:e,sequence:this.sequence}).render()))
const t=(()=>{const t=[]
for(e of Array.from(this.searchResultViews))t.push(e.el)
return t})()
this.$(".search-loading").addClass("hidden")
this.$(".search-results").html(t)
this.$(".no-search-results").toggleClass("hidden",0!==t.length)
return this.$(".js-match-params").toggleClass("hidden",0===t.length)}renderBaseIndices(){const e=this.model.get("sequence").length(),t=this.model.get("sequence").startIndex(),n=T.modelStartToDisplay(0,t)
this.$(".min-base-index").attr("placeholder",n).attr("value",n).val(T.modelStartToDisplay(this.model.get("minBaseIndex"),t))
const a=T.modelEndToDisplay(0,e,t)
this.$(".max-base-index").attr("placeholder",a).attr("value",a).val(T.modelEndToDisplay(this.model.get("maxBaseIndex"),e,t))}renderMisprimeSettings(){(0,Me.A9)(d.createElement(_o.Z,{misprimeParams:this.model.getMisprimingState(),setMisprimeParams:e=>{this.model.set(e)},showExactAndUniqueMatch:!0}),this.$(".js-misprime-settings")[0],(()=>{this.validateMinBases()}))}render(){this.$el.html(this.template({highlightMatches:this.model.get("highlightMatches")}))
this.renderBaseIndices()
this.renderMisprimeSettings()
this.renderFindType()
this.renderFindButton()
this.renderSelectionButton()
this.$(".js-name").val(this.model.get("primerName"))
this.$(".results-section").append(this.resultsView.render().el)
this.colorPicker.attach(this.$(".swatch-big"),"manual",".save-new-primers .swatch-big")
this.colorPicker.update(this.model)
this.$(".swatch-big").css("background-color",this.model.get("color"))
this.showResults()
if(this.model.get("showResults")){this.resultsView.renderResults(this.findPrimersResults)
this.renderSelectAll()
this.handleResultSync()}return this}}FindPrimersView_TabView.initClass()
class Primer3TabState extends nn.X4{defaults(){return{...super.defaults(),title:"Primer3 Results",saving:!1}}initialize(e){super.initialize(e)
this.set({originalBases:this.get("sequence").bases()})}haveBasesChanged(){return this.get("sequence").bases()!==this.get("originalBases")}close(){this.trigger("removePrimers")
super.close()}}const Vo=Primer3TabState
var Uo=n(717235),Go=n(901113),zo=n(965131),$o=n(334450),Wo=n(84948),Ho=n(514674)
class PrimerPropertiesModal extends d.Component{constructor(){super(...arguments)
this.state={folderId:Qe.Z.get(Qe.O.OLIGO)||null,tagSchemaId:null}
this.handleChangeFolderId=e=>{this.setState({folderId:e.target.value||null})}
this.handleChangeTagSchemaId=e=>{this.setState({tagSchemaId:e?e.id:null})}
this.handleRequestSubmit=()=>{(0,S.hu)(Boolean(this.state.folderId),"Cannot save primers without a folder")
Qe.Z.set(Qe.O.OLIGO,this.state.folderId)
this.props.onRequestSubmit(this.state)}}render(){return d.createElement(et.ZP,{buttons:[{text:"Create",submit:!0,disabled:!this.state.folderId,dataTestAttrs:{component:"PrimerPropertiesModal",element:"createButton"}}],onRequestClose:this.props.onRequestClose,onRequestSubmit:this.handleRequestSubmit,title:"Select Primer Properties",dataTestAttrs:{component:"PrimerPropertiesModal",element:"root"}},d.createElement(Fr.Z,{label:"Folder",isRequired:!0}),d.createElement(Ye.Z,{className:(0,g.iv)(Yo.folderSelector),onChange:this.handleChangeFolderId,showInventory:!0,value:this.state.folderId,unsetOnFetchFail:!0}),this.props.hasSequenceSchemas&&d.createElement("div",null,d.createElement(Fr.Z,{label:"Schema"}),d.createElement(Ho.ZP,{allowNone:!0,oligoAwareFolderItemTypes:[st.SequenceSubtype.DNA_OLIGO],onChange:this.handleChangeTagSchemaId,selectedTagSchemaId:this.state.tagSchemaId})))}}const jo=function QueryingPrimerPropertiesModal(e){return d.createElement(Da.ZP,{query:$o._,renderLoading:()=>null},(t=>d.createElement(PrimerPropertiesModal,{...e,hasSequenceSchemas:(0,Wo.Z)((0,zo.NA)("TagSchema",t.tagSchemas),{oligoAwareFolderItemTypes:[st.SequenceSubtype.DNA_OLIGO]}).length>0})))},Yo=g.mM.create({folderSelector:{marginBottom:"10px"}})
function Primer3Menu(){return d.createElement("ul",{className:"nav navbar-nav form-inline primer3-menu"},d.createElement("li",null,d.createElement("button",{type:"button",disabled:!0,className:"button button--primary button--mini js-save",...(0,ee.Z)({component:"Primer3Menu",element:"savePrimersButton"})},"Save Selected Primers"),d.createElement("button",{type:"button",disabled:!0,className:"button button--tertiaryGray u-small-spacing-left button--mini js-export-as-csv"},"Export as CSV")),d.createElement("div",{className:"buttonGroup binding-site-sort-group pull-right"},d.createElement(C.Co,{isDropdown:!0,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,text:d.createElement("span",null,d.createElement("span",{className:"faded"},"Sort by")," ",d.createElement("span",{className:"primer-sort-by"},"Penalty"))}),d.createElement("ul",{className:"dropdown-menu"},d.createElement("li",null,d.createElement("a",{href:"#",className:"sort-by sort-by-penalty"},"Penalty")),d.createElement("li",null,d.createElement("a",{href:"#",className:"sort-by sort-by-location"},"Location")),d.createElement("li",null,d.createElement("a",{href:"#",className:"sort-by sort-by-productBP"},"Product BP")))),d.createElement("a",{className:"tm-params pull-right"},"T",d.createElement("sub",null,"m")," params"))}function Primer3Row({model:e,primers:t,sequence:n}){return d.createElement(d.Fragment,null,d.createElement("tr",{className:"forward"},d.createElement("td",null,d.createElement("input",{type:"checkbox",className:"primer3Row-allSelected",...(0,ee.Z)({component:"Primer3Row",element:"rowCheckbox"})})),isNaN(e.get("penalty"))?d.createElement("td",null):d.createElement("td",{className:"text-center"},parseFloat(e.get("penalty")).toFixed(3)),d.createElement("td",null,d.createElement("input",{type:"checkbox",className:f()("primer3Row-forwardSelected",(0,g.iv)(Qo.primerCheckbox))}),"FWD"),d.createElement("td",{className:"text-center"},(100*(0,y.gc)(e.get("forward").bases(),e.get("forward").nucleotideType())).toFixed(1),"%"),d.createElement("td",{className:"text-center"},e.get("forward").meltingTemperature().toFixed(1),"°"),d.createElement("td",{className:"text-center"},T.modelStartToDisplay(e.get("forward").get("start"),n.startIndex()),"-",T.modelEndToDisplay(e.get("forward").get("end"),n.length(),n.startIndex())),d.createElement("td",{className:"text-center"},e.get("forward").get("bases").length),d.createElement("td",{className:"text-center"},e.get("product_size")),d.createElement("td",{className:"mono",dangerouslySetInnerHTML:{__html:t.forward.basesHtml(n)}}),d.createElement("td",null,d.createElement("a",{className:"edit"},"Edit"))),e.get("probe")&&d.createElement("tr",{className:"probe"},d.createElement("td",null),d.createElement("td",null),d.createElement("td",null,d.createElement("input",{type:"checkbox",className:f()("primer3Row-probeSelected",(0,g.iv)(Qo.primerCheckbox))}),"PROBE"),d.createElement("td",{className:"text-center"},(100*(0,y.gc)(e.get("probe").bases(),e.get("probe").nucleotideType())).toFixed(1),"%"),d.createElement("td",{className:"text-center"},e.get("probe").meltingTemperature().toFixed(1),"°"),d.createElement("td",{className:"text-center"},T.modelStartToDisplay(e.get("probe").get("start"),n.startIndex()),"-",T.modelEndToDisplay(e.get("probe").get("end"),n.length(),n.startIndex())),d.createElement("td",{className:"text-center"},e.get("probe").get("bases").length),d.createElement("td",null),d.createElement("td",{className:"mono",dangerouslySetInnerHTML:{__html:t.probe.basesHtml(n)}}),d.createElement("td",null)),d.createElement("tr",{className:"reverse"},d.createElement("td",null),d.createElement("td",null),d.createElement("td",null,d.createElement("input",{type:"checkbox",className:f()("primer3Row-reverseSelected",(0,g.iv)(Qo.primerCheckbox))}),"REV"),d.createElement("td",{className:"text-center"},(100*(0,y.gc)(e.get("reverse").bases(),e.get("reverse").nucleotideType())).toFixed(1),"%"),d.createElement("td",{className:"text-center"},e.get("reverse").meltingTemperature().toFixed(1),"°"),d.createElement("td",{className:"text-center"},T.modelStartToDisplay(e.get("reverse").get("start"),n.startIndex()),"-",T.modelEndToDisplay(e.get("reverse").get("end"),n.length(),n.startIndex())),d.createElement("td",{className:"text-center"},e.get("reverse").get("bases").length),d.createElement("td",null),d.createElement("td",{className:"mono",dangerouslySetInnerHTML:{__html:t.reverse.basesHtml(n)}}),d.createElement("td",null)))}const Qo=g.mM.create({primerCheckbox:{marginRight:4}})
function Primer3Tab({basesChanged:e}){return d.createElement(d.Fragment,null,e?d.createElement("div",{className:"buffer-tab"},d.createElement("div",{className:"alert alert-warning"},"The Primer3 results are out of date since the sequence's bases have changed. Please re-run the primer wizard to generate new primers. (Primers you've already saved haven't been affected.)")):d.createElement("table",{className:"table table-condensed primers-table"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,d.createElement("input",{type:"checkbox",className:"select-all"})),d.createElement("th",{className:"text-center"},"Penalty",d.createElement("a",{className:"glyphicon glyphicon-question-sign"})),d.createElement("th",null,"Direction"),d.createElement("th",{className:"text-center"},"% GC"),d.createElement("th",{className:"text-center"},"T",d.createElement("sub",null,"m"),"°C"),d.createElement("th",{className:"text-center"},"Location"),d.createElement("th",{className:"text-center"},"Length"),d.createElement("th",{className:"text-center"},"Product BP"),d.createElement("th",null,"Primer"),d.createElement("th",null)))))}var Ko
!function(e){e.NONE="NONE"
e.SOME="SOME"
e.ALL="ALL"}(Ko||(Ko={}))
function hasSelectedPrimerToSave(e){return!e.get("saved")&&(Boolean(e.get("forwardSelected"))||Boolean(e.get("probeSelected"))||Boolean(e.get("reverseSelected")))}function isDirectionSelected(e,t){switch(t){case"forward":return Boolean(e.get("forwardSelected"))
case"probe":return Boolean(e.get("probeSelected"))
case"reverse":return Boolean(e.get("reverseSelected"))
default:(0,S.Gp)(!1,`Invalid direction: ${(0,Go.vE)(t)}`)
return!1}}class PrimerRowView extends s().View{static initClass(){this.prototype.tagName="tbody"}events(){return{"change .primer3Row-allSelected":"handleToggleAll","change .primer3Row-forwardSelected":"handleToggleForward","change .primer3Row-probeSelected":"handleToggleProbe","change .primer3Row-reverseSelected":"handleToggleReverse","click tr":"handleClick","click .edit":"edit"}}initialize(e){this.tabstate=e.tabstate
this.index=e.index
this.sequence=this.tabstate.get("sequence")
this.primers={}
for(const e of us.RI)null!=this.model.get(e)&&(this.primers[e]=this.model.get(e))
this.tabstate=e.tabstate
this.listenTo(this.model,"change:forwardSelected",this.updateUI)
this.listenTo(this.model,"change:probeSelected",this.updateUI)
this.listenTo(this.model,"change:reverseSelected",this.updateUI)
this.listenTo(this.model,"change:saved",this.updateUI)}handleClick(e){if(this.primers.forward.isNew()){if(!Array.from(this.$('input[type="checkbox"]')).includes(e.target)){this.handleToggleAll()
this.getSelectionState()!==Ko.NONE&&this.sequence.trigger("jump",this.primers.forward.start())}}else e.preventDefault()}handleToggleAll(){if(this.getSelectionState()===Ko.NONE){m.j("primer","select_primers",{product:j.XC.MOLBIO,selection:"row"})
this.model.set({forwardSelected:!0,probeSelected:Boolean(this.model.get("probe")),reverseSelected:!0})}else this.model.set({forwardSelected:!1,probeSelected:!1,reverseSelected:!1})}trackTogglePrimer(e,t){this.model.get(e)||m.j("primer","select_primers",{product:j.XC.MOLBIO,selection:t})}handleToggleForward(){this.trackTogglePrimer("forwardSelected","forward")
this.model.set({forwardSelected:!this.model.get("forwardSelected")})}handleToggleProbe(){this.trackTogglePrimer("probeSelected","probe")
this.model.set({probeSelected:!this.model.get("probeSelected")})}handleToggleReverse(){this.trackTogglePrimer("reverseSelected","reverse")
this.model.set({reverseSelected:!this.model.get("reverseSelected")})}updateUI(){const e=this.model.get("forwardSelected"),t=this.model.get("probeSelected"),n=this.model.get("reverseSelected")
this.$(".primer3Row-forwardSelected").prop("checked",Boolean(e))
this.$(".primer3Row-probeSelected").prop("checked",Boolean(t))
this.$(".primer3Row-reverseSelected").prop("checked",Boolean(n))
const a=this.getSelectionState(),i=this.$(".primer3Row-allSelected")
if(a===Ko.NONE){i.prop("checked",!1)
i.prop("indeterminate",!1)}else if(a===Ko.SOME){i.prop("checked",!0)
i.prop("indeterminate",!0)}else{(0,S.Gp)(a===Ko.ALL,`Unexpected selectionState: ${a}`)
i.prop("checked",!0)
i.prop("indeterminate",!1)}this.$el.toggleClass("active",a!==Ko.NONE)
if(this.model.get("saved")){this.$el.removeClass("active")
this.$("tr").addClass("disabled").addClass("success")
this.$("input[type=checkbox]").prop("disabled",!0)
this.$(".edit").addClass("hide")}else{const e=this.sequence._sequence().sequencePrimers()
for(const t of us.RI)isDirectionSelected(this.model,t)?e.add(this.primers[t]):e.remove(this.primers[t])}this.tabstate.trigger("selectChange")}getSelectionState(){const e=this.model.get("forwardSelected"),t=this.model.get("probeSelected"),n=this.model.get("reverseSelected"),a=Boolean(this.model.get("probe"));(0,S.Gp)(a||!t,"A primer3 result without a probe cannot have the probe checkbox selected.")
const i=(e?1:0)+(t?1:0)+(n?1:0)
return 0===i?Ko.NONE:i>=(a?3:2)?Ko.ALL:Ko.SOME}edit(e){e.stopPropagation()
sn.editPair(this.primers.forward.clone(),this.primers.reverse.clone(),this.sequence)}render(){this.$el.html(Xt.renderToStaticMarkup(d.createElement(Primer3Row,{model:this.model,primers:this.primers,sequence:this.sequence})))
this.updateUI();(0,He.Z)(this.$el,{component:"Primer3Row",index:`${this.index}`})
return this}}PrimerRowView.initClass()
const Jo={penalty:e=>e.get("penalty"),location:e=>e.get("forward").get("start"),productBP:e=>e.get("product_size")}
class Primer3View_OptionsView extends s().View{static initClass(){this.prototype.tagName="div"
this.prototype.className="navbar"}events(){return{"click .js-save":"save","click .js-export-as-csv":"exportAsCSV","click a.sort-by":"changeSort","click .tm-params":"tmParameters"}}initialize(){this.sequence=this.model.get("sequence")
this.sequencePrimers=this.sequence.sequencePrimers()
this.listenTo(this.model,"selectChange",this.renderSave)
this.listenTo(this.model,"change:saving",this.renderSave)
this.primers=this.model.get("primers")
this.primers.comparator=Jo.penalty
this.primers.sort()}changeSort(e){e.preventDefault()
const t=o()(e.currentTarget)
this.$(".primer-sort-by").text(t.text())
t.hasClass("sort-by-penalty")?this.primers.comparator=Jo.penalty:t.hasClass("sort-by-productBP")?this.primers.comparator=Jo.productBP:this.primers.comparator=Jo.location
this.primers.sort()}tmParameters(){(0,Xn.Z)(MeltingTempModal,{})}async save(){m.j("primer","save_primers_click",{product:j.XC.MOLBIO,sequence_id:this.sequence.get("id")})
const e=await(0,Xn.Z)(jo,{})
e&&this.model.trigger("savePrimers",e)}exportAsCSV(){this.model.trigger("exportPrimersAsCSV")}renderSave(){const e=this.model.get("primers").find((e=>hasSelectedPrimerToSave(e))),t=Boolean(this.model.get("saving"))
this.$(".js-save").prop("disabled",!e||t)
this.$(".js-export-as-csv").prop("disabled",!e)}render(){this.$el.html(Xt.renderToStaticMarkup(d.createElement(Primer3Menu,null)))
this.renderSave()
return this}}Primer3View_OptionsView.initClass()
class Primer3View_TabView extends s().View{static initClass(){this.prototype.className="primer3-view buffer-tab"}events(){return{"change .select-all":"selectAll"}}initialize(){this.sequence=this.model.get("sequence")
this.listenTo(this.model.get("primers"),"reset sort",this.render)
this.rows=[]
this.listenTo(this.model,"removePrimers",this.removePrimers)
this.listenTo(this.model,"savePrimers",this.savePrimers)
this.listenTo(this.model,"exportPrimersAsCSV",this.exportPrimersAsCSV)
this.listenTo(We.Z,`change:${tn.gq.MELTING_TEMP_DNA}`,this.render)
this.listenTo(this.sequence._sequence(),"change:startIndex",this.render)
this.listenTo(this.sequence._sequence(),"change:bases",this.checkIfResultsValidAndReRender)}selectAll(e){const t=o()(e.currentTarget).prop("checked")
t&&m.j("primer","select_primers",{product:j.XC.MOLBIO,selection:"all"})
for(const e of this.model.get("primers").models)e.get("saved")||e.set({forwardSelected:t,probeSelected:null!=e.get("probe")&&t,reverseSelected:t})}render(){const e=this.model.haveBasesChanged()
this.$el.html(Xt.renderToStaticMarkup(d.createElement(Primer3Tab,{basesChanged:e})))
this.removeRows()
e||(this.rows=this.model.get("primers").map(((e,t)=>{const n=new PrimerRowView({tabstate:this.model,model:e,index:t})
this.$("table").append(n.render().el)
return n})))
this.$(".glyphicon-question-sign").popover({placement:"right",title:"Penalty",content:'This is the <a href="http://primer3.ut.ee/primer3web_help.htm#calculatePenalties" target="_blank">Primer3 penalty score</a>. Lower penalties are better.',html:!0})
return this}getNewPrimers(){const e=[]
for(const t of this.rows)for(const n of us.RI)isDirectionSelected(t.model,n)&&e.push(t.primers[n])
return e}removePrimers(){for(const e of this.getNewPrimers())e.destroy()}getNextAvailablePrimerPairIndex(e){let t=1
for(let n=0;n<e.length;n++){const a=/^.+ \d+-\d+ (?:(?:FWD)|(?:REV)) (\d+)$/.exec(e.models[n].attributes.name)
if(a){const e=Number(a[1])
e>=t&&(t=e+1)}}return t}savePrimers({folderId:e,tagSchemaId:t}){if(0===this.getNewPrimers().length){v.ZP.error("Select new primers to add first.")
return}this.model.set({saving:!0})
const n=this.sequence.get("_sequence").sequencePrimers(),a=this.getNextAvailablePrimerPairIndex(n),i=this.sequence.get("_sequence").primerPairs(),r=new en.FE([],{sequenceID:this.sequence.id}),o=this.rows.filter((e=>hasSelectedPrimerToSave(e.model)))
for(let n=0;n<o.length;n++){const i=o[n]
for(const[s,o]of Object.entries(i.primers))if(isDirectionSelected(i.model,s)){o.set("name",`${o.get("name")} ${(a+n).toString()}`)
"probe"!==s&&isDirectionSelected(i.model,"forward")&&isDirectionSelected(i.model,"reverse")?r.add({...o.toJSON(),tagSchemaId:t,folder:e,pairId:n}):r.add({...o.toJSON(),tagSchemaId:t,folder:e})}}s().sync("create",r,{fileUpdate:!0}).always((()=>this.model.set({saving:!1}))).fail(v.ZP.notifyError).done((({primers:e,primerPairs:t,message:a})=>{this.removePrimers()
this.sequence.updateVersions()
for(const e of this.rows)hasSelectedPrimerToSave(e.model)&&e.model.set({saved:!0})
n.batchModify((function modify(){this.add(e,{parse:!0})}))
i.batchModify((function modify(){this.add(t,{parse:!0})}))
v.ZP.success(a)
m.j("primer","added_primers",{product:j.XC.MOLBIO,source:"primer3",sequence_api_id:this.sequence.id,primer_count:e.length})}))}exportPrimersAsCSV(){const e=this.rows.filter((e=>hasSelectedPrimerToSave(e.model))),t=[]
for(let n=0;n<e.length;n++){const a=e[n]
for(const[e,i]of Object.entries(a.primers))isDirectionSelected(a.model,e)&&t.push({name:`${i.get("name")} primer3 pair ${n.toString()}`,bases:i.get("bases"),nucleotideType:i.nucleotideType()})}Uo.ov({oligos:t,filename:Uo.FC(this.sequence.name())})}removeRows(){for(const e of this.rows)e.stopListening()
this.rows=[]}remove(){this.removeRows()
return super.remove()}checkIfResultsValidAndReRender(){this.model.haveBasesChanged()&&this.model.get("primers").forEach((e=>{e.set({forwardSelected:!1,probeSelected:!1,reverseSelected:!1})}))
this.render()}}Primer3View_TabView.initClass()
const Xo=function PrimerRowHeader(e){return d.createElement("div",null,Array.from(e.inputs).map(((e,t)=>d.createElement(p.Z,{md:3,className:"text-center",key:t},e))))}
class PrimerRowInterval extends d.Component{constructor(){super(...arguments)
this.disableSetFromSelection=()=>null==this.props.selection.end
this.setFromSelection=()=>{const e=String(this.props.selection.start),t=String(this.props.selection.end)
this.props.setFromSelection(e,t)}}render(){(0,S.hu)(2===this.props.inputs.length,"PrimerRowInterval should have exactly 2 inputs")
return d.createElement("div",null,Array.from(this.props.inputs).map(((e,t)=>d.createElement(p.Z,{md:3,key:t},d.createElement("input",{...l.default.extend({type:"text"},e)})))),d.createElement(p.Z,{md:4},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.setFromSelection,disabled:this.disableSetFromSelection(),text:"Use selection"})))}}const el=PrimerRowInterval
class PrimerRowIntervalList extends d.Component{constructor(){super(...arguments)
this.disableAddFromSelection=()=>null==this.props.selection.end
this.addFromSelection=()=>{const e=`${this.props.selection.start}-${this.props.selection.end}`,t=this.props.inputs[0].value,n=t?`${t.trim()},${e}`:e
this.props.inputs[0].onChange({target:{value:n}})}}render(){let e;(0,S.hu)(1===this.props.inputs.length,"PrimerRowIntervalList should have exactly one input")
return d.createElement("div",null,(()=>{const t=[]
for(e=0;e<this.props.inputs.length;e++){const n=this.props.inputs[e]
t.push(d.createElement(p.Z,{md:6,key:e},d.createElement("input",{...l.default.extend({type:"text"},n)})))}return t})(),d.createElement(p.Z,{md:4},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.addFromSelection,disabled:this.disableAddFromSelection(),key:e,text:"Add selection"})))}}const tl=PrimerRowIntervalList
const nl=function PrimerRowLongField(e){return d.createElement(p.Z,{sm:9},d.createElement("input",{...l.default.extend({type:"text"},e.inputs[0])}))}
const al=function PrimerRowOnlyFields(e){return d.createElement("div",null,Array.from(e.inputs).map(((e,t)=>d.createElement(p.Z,{md:3,key:t},d.createElement("input",{...l.default.extend({type:"text"},e)})))))}
var il=n(282614),sl=n(720100)
function isAdvancedSpecified(e){return e.rows.some((t=>isRowAdvanced(t,e.task)&&isRowSpecified(t)))}function isRowAdvanced(e,t){for(const{task:n,advanced:a}of Array.from(e.tasks))if(t===n)return a
return!1}function isRowSpecified(e){return e.component.props.inputs.some((e=>null!=e&&null!=e.value&&e.value.length))}function isSectionSpecified(e){return e.rows.some((e=>isRowSpecified(e)))}class PrimerWizardSection extends d.Component{constructor(e){super(e)
this.state={advanced:isAdvancedSpecified(e),open:e.open||isSectionSpecified(e)}}isRowApplicable(e){return e.tasks.some((({task:e})=>e===this.props.task))}isSectionApplicable(){return this.props.rows.some((e=>this.isRowApplicable(e)))}shouldShowRow(e){return this.isRowApplicable(e)&&(!isRowAdvanced(e,this.props.task)||this.state.advanced)}anyAdvanced(){return this.props.rows.some((e=>isRowAdvanced(e,this.props.task)))}toggleOpen(){this.state.open||m.j("primer","expand_wizard_section",{product:j.XC.MOLBIO,section:this.props.title.toLowerCase().replace(/ /g,"_")})
this.setState({open:!this.state.open})}toggleAdvanced(){this.setState({advanced:!this.state.advanced})}renderPanel(){return this.state.open?d.createElement("div",{className:"panel-collapse"},d.createElement("div",{className:"panel-body"},(()=>{const e=[]
for(const t of Array.from(this.props.rows))this.shouldShowRow(t)?e.push(d.createElement(Ke.Z,{key:t.key},d.createElement(Je.Z,{md:2},t.title),t.component)):e.push(void 0)
return e})(),this.anyAdvanced()?d.createElement("div",{className:"u-spacing-top"},d.createElement("a",{className:"pull-right",onClick:this.toggleAdvanced.bind(this)},this.state.advanced?"Hide advanced":"Show advanced")):void 0)):null}renderIcon(){return d.createElement(pe.Z,{icon:this.state.open?"minus-large":"plus-large",className:"u-small-spacing-right"})}renderHeader(){return d.createElement("div",{className:"panel-heading u-pointer",onClick:this.toggleOpen.bind(this)},d.createElement("div",{className:"panel-title"},this.renderIcon(),this.props.title))}render(){return this.isSectionApplicable()?d.createElement("div",{className:"panel panel-default"},this.renderHeader(),this.renderPanel()):null}}const rl=PrimerWizardSection,{PCR:ol,QPCR_DYES:ll,QPCR_PROBE:cl,SEQUENCING:dl}=il.i
class PrimerWizard extends d.Component{constructor(){super(...arguments)
this.resetParameters=()=>{const e={task:this.props.parameters.task}
this.props.updateParameters(e)}}setFromSelection(e,t,n,a){const i=e.label,s=t.label,r=l.default.extend({},this.props.parameters)
r[i]=n
r[s]=a
n.length||delete r[i]
a.length||delete r[s]
this.props.updateParameters(r)}handleChangeParamValue(e,t){"task"===e&&m.j("primer","change_task",{product:j.XC.MOLBIO,task:t})
const n=l.default.clone(this.props.parameters)
n[e]=t
t.length||delete n[e]
this.props.updateParameters(n)}renderHeader(){var e
return d.createElement(Ke.Z,null,d.createElement(Je.Z,{md:2},"Task"),d.createElement(p.Z,{md:6},d.createElement("select",{value:null!==(e=this.props.parameters.task)&&void 0!==e?e:"",onChange:e=>{this.handleChangeParamValue("task",e.target.value)}},d.createElement("option",{value:ol},"PCR"),d.createElement("option",{value:cl},"qPCR (Hybridization Probe)"),d.createElement("option",{value:ll},"qPCR (Intercalating Dyes)"),d.createElement("option",{value:dl},"Sequencing"))),d.createElement(p.Z,{md:2},d.createElement("a",{className:"u-input-line-height",onClick:this.props.showTmParameters},Xi.Mg," params")),d.createElement(p.Z,{md:2},d.createElement("a",{className:"u-input-line-height",onClick:this.resetParameters},"Reset")))}getInputs(e){return e.map((e=>{var t,n
return{value:null!==(t=this.props.parameters[e.label])&&void 0!==t?t:"",onChange:t=>{this.handleChangeParamValue(e.label,t.target.value)},placeholder:null!==(n=e.placeholder)&&void 0!==n?n:this.props.getDefault(e,this.props.parameters.task)}}))}renderRegionSection(){return d.createElement(rl,{title:"Region",open:!0,task:this.props.parameters.task,rows:[{title:"Target",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!0},{task:cl,advanced:!0},{task:dl,advanced:!1}],key:"target",component:d.createElement(el,{inputs:this.getInputs([sl.Z.TARGET_START,sl.Z.TARGET_END]),selection:this.props.selection,setFromSelection:this.setFromSelection.bind(this,sl.Z.TARGET_START,sl.Z.TARGET_END)})},{title:"Included",tasks:[{task:ol,advanced:!0},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!0}],key:"included",component:d.createElement(el,{inputs:this.getInputs([sl.Z.INCLUDED_START,sl.Z.INCLUDED_END]),selection:this.props.selection,setFromSelection:this.setFromSelection.bind(this,sl.Z.INCLUDED_START,sl.Z.INCLUDED_END)})},{title:"Excluded",key:"excluded",tasks:[{task:ol,advanced:!0},{task:dl,advanced:!0}],component:d.createElement(tl,{inputs:this.getInputs([sl.Z.EXCLUDED_REGION]),selection:this.props.selection})},{title:"Excluded (primers)",tasks:[{task:ll,advanced:!0},{task:cl,advanced:!0}],key:"excluded-primers",component:d.createElement(tl,{inputs:this.getInputs([sl.Z.EXCLUDED_REGION]),selection:this.props.selection})},{title:"Excluded (probe)",tasks:[{task:cl,advanced:!0}],key:"excluded_probe",component:d.createElement(tl,{inputs:this.getInputs([sl.Z.EXCLUDED_PROBE_REGION]),selection:this.props.selection})}]})}renderPrimerSection(){return d.createElement(rl,{title:"Primer",open:!1,task:this.props.parameters.task,rows:[{title:"",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!1}],key:"header",component:d.createElement(Xo,{inputs:["Min","Opt","Max"]})},{title:"GC%",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!1}],key:"gc",component:d.createElement(al,{inputs:this.getInputs([sl.Z.GC_MIN,sl.Z.GC_OPT,sl.Z.GC_MAX])})},{title:Xi.Mg,tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!1}],key:"tm",component:d.createElement(al,{inputs:this.getInputs([sl.Z.TM_MIN,sl.Z.TM_OPT,sl.Z.TM_MAX])})},{title:"Size",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!1}],key:"size",component:d.createElement(al,{inputs:this.getInputs([sl.Z.SIZE_MIN,sl.Z.SIZE_OPT,sl.Z.SIZE_MAX])})},{title:"3' GC clamp",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!1}],key:"gc-clamp",component:d.createElement(al,{inputs:this.getInputs([sl.Z.GC_CLAMP])})}]})}renderProbeSection(){return d.createElement(rl,{title:"Probe",open:!1,task:this.props.parameters.task,rows:[{title:"",tasks:[{task:cl,advanced:!1}],key:"header",component:d.createElement(Xo,{inputs:["Min","Opt","Max"]})},{title:"GC%",tasks:[{task:cl,advanced:!1}],key:"gc",component:d.createElement(al,{inputs:this.getInputs([sl.Z.GC_PROBE_MIN,sl.Z.GC_PROBE_OPT,sl.Z.GC_PROBE_MAX])})},{title:Xi.Mg,tasks:[{task:cl,advanced:!1}],key:"tm",component:d.createElement(al,{inputs:this.getInputs([sl.Z.TM_PROBE_MIN,sl.Z.TM_PROBE_OPT,sl.Z.TM_PROBE_MAX])})},{title:"Size",tasks:[{task:cl,advanced:!1}],key:"size",component:d.createElement(al,{inputs:this.getInputs([sl.Z.SIZE_PROBE_MIN,sl.Z.SIZE_PROBE_OPT,sl.Z.SIZE_PROBE_MAX])})}]})}renderAmpliconSection(){return d.createElement(rl,{title:"Amplicon",open:!1,task:this.props.parameters.task,rows:[{title:"",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"header",component:d.createElement(Xo,{inputs:["Min","Opt","Max"]})},{title:"Size",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"size",component:d.createElement(al,{inputs:this.getInputs([sl.Z.PRODUCT_MIN_SIZE,sl.Z.PRODUCT_OPT_SIZE,sl.Z.PRODUCT_MAX_SIZE])})}]})}renderResultGeneration(){return d.createElement(rl,{title:"Result Generation",open:!1,task:this.props.parameters.task,rows:[{title:"# results",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1},{task:dl,advanced:!1}],key:"num-results",component:d.createElement(al,{inputs:this.getInputs([sl.Z.NUM_RESULTS])})}]})}renderPartialDesignInput(){return d.createElement(rl,{title:"Partial Design",open:!1,task:this.props.parameters.task,rows:[{title:"Forward sequence",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"forward-sequence",component:d.createElement(nl,{inputs:this.getInputs([sl.Z.FORWARD_PRIMER_SEQUENCE])})},{title:"Reverse sequence",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"reverse-sequence",component:d.createElement(nl,{inputs:this.getInputs([sl.Z.REVERSE_PRIMER_SEQUENCE])})},{title:"Probe sequence",tasks:[{task:cl,advanced:!1}],key:"probe-sequence",component:d.createElement(nl,{inputs:this.getInputs([sl.Z.INTERNAL_OLIGO_SEQUENCE])})}]})}renderDesignAcrossJunctions(){return d.createElement(rl,{title:"Design Across Junctions",open:!1,task:this.props.parameters.task,rows:[{title:"Overlap junctions",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"overlap-junctions",component:d.createElement(al,{inputs:this.getInputs([sl.Z.OVERLAP_JXN_LIST])})},{title:"Min 3' overlap",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"min-3'-overlap",component:d.createElement(al,{inputs:this.getInputs([sl.Z.MIN_3_PRIME_OVERLAP])})},{title:"Min 5' overlap",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"min-5'-overlap",component:d.createElement(al,{inputs:this.getInputs([sl.Z.MIN_5_PRIME_OVERLAP])})}]})}renderForceLocation(){return d.createElement(rl,{title:"Force Location",open:!1,task:this.props.parameters.task,rows:[{title:"",key:"header",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],component:d.createElement(Xo,{inputs:["Start (5' end)","End (3' end)"]})},{title:"Forward",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"forward",component:d.createElement(al,{inputs:this.getInputs([sl.Z.FORCE_FORWARD_START,sl.Z.FORCE_FORWARD_END])})},{title:"Reverse",tasks:[{task:ol,advanced:!1},{task:ll,advanced:!1},{task:cl,advanced:!1}],key:"reverse",component:d.createElement(al,{inputs:this.getInputs([sl.Z.FORCE_REVERSE_START,sl.Z.FORCE_REVERSE_END])})}]})}renderSequencingSection(){return d.createElement(rl,{title:"Sequencing",open:!1,task:this.props.parameters.task,rows:[{title:"Spacing",tasks:[{task:dl,advanced:!1}],key:"spacing",component:d.createElement(al,{inputs:this.getInputs([sl.Z.SEQUENCING_SPACING])})},{title:"Interval",tasks:[{task:dl,advanced:!1}],key:"interval",component:d.createElement(al,{inputs:this.getInputs([sl.Z.SEQUENCING_INTERVAL])})},{title:"Lead",tasks:[{task:dl,advanced:!1}],key:"lead",component:d.createElement(al,{inputs:this.getInputs([sl.Z.SEQUENCING_LEAD])})},{title:"Accuracy",tasks:[{task:dl,advanced:!1}],key:"accuracy",component:d.createElement(al,{inputs:this.getInputs([sl.Z.SEQUENCING_ACCURACY])})}]})}render(){return d.createElement("div",{className:"buffer-content-container"},d.createElement("form",{className:"form-horizontal"},this.renderHeader(),d.createElement("div",{className:"panel-group u-spacing-top"},this.renderRegionSection(),this.renderPrimerSection(),this.renderProbeSection(),this.renderAmpliconSection(),this.renderResultGeneration(),this.renderPartialDesignInput(),this.renderDesignAcrossJunctions(),this.renderForceLocation(),this.renderSequencingSection()),d.createElement("div",{className:"u-spacing-top"},"Our primer wizard is powered by Primer3. Visit the ",d.createElement("a",{href:"https://www.primer3plus.com/primer3plusHelp.html",target:"_blank",rel:"noopener noreferrer"},"manual")," for more information on the different tasks and parameters. Primer3 does not support RNA primers, so only DNA primers may be created with the Primer Wizard tool.")))}}const ul=PrimerWizard
class PrimerWizardTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}initialize(){const e=this.model.get("sequence").get("selection")
this.listenTo(e,"change:start change:end",this.render)}getSelection(){const e=this.model.get("sequence"),t=e.startIndex(),n=e.get("selection")
return{start:T.modelStartToDisplay(n.start(),t),end:T.modelEndToDisplay(n.end(),e.length(),t)}}render(){(0,Me.A9)(d.createElement(ul,{parameters:this.model.get("params"),updateParameters:e=>{this.model.set({params:e})
this.render()},selection:this.getSelection(),showTmParameters:function(){(0,Xn.Z)(MeltingTempModal,{})},getDefault:this.model.getDefault}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}PrimerWizardTabView.initClass()
class PrimerWizardOptions extends d.Component{render(){return d.createElement("ul",{className:"nav navbar-nav form-inline"},d.createElement("li",{className:"pull-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MINI,onClick:this.props.generatePrimers,disabled:this.props.disabled,text:"Generate Primers",dataTestAttrs:{component:"PrimerWizardTab",element:"generatePrimersButton"}})),this.props.disabled?d.createElement("li",{className:"pull-right"},d.createElement(Lt.Z,null)):void 0)}}PrimerWizardOptions.propTypes={disabled:J().bool.isRequired,generatePrimers:J().func.isRequired}
class PrimerWizardOptionsView extends s().View{static initClass(){this.prototype.className="navbar"}initialize(){this.addPrimers=this.addPrimers.bind(this)
this.generatePrimers=this.generatePrimers.bind(this)
this.working=!1}trackGeneratePrimersFail(e){m.j("primer","generate_primers_fail",{product:j.XC.MOLBIO,error:e,sequence_id:this.model.get("sequence").get("id")})}addPrimers(e){if(0===e.length){const e="No primers could be found - try adjusting your parameters."
this.trackGeneratePrimersFail(e)
v.ZP.error(e)}else{const t=this.model.get("sequence")
m.j("primer","generate_primers_success",{product:j.XC.MOLBIO,sequence_id:t.get("id")})
const n=new(s().Collection)(e),a=t.get("_sequence").get("name")
for(const e of Array.from(n.models))for(const n of["forward","reverse","probe"])if(null!=e.get(n)){const i=e.get(n),s=Ue.SequencePrimer.generateName(a,i.start,i.end,n,t.length(),t.startIndex())
e.set(n,new Ue.SequencePrimer({name:s,bases:i.sequence,color:Sr.fT,start:i.start,end:i.end,strand:"reverse"===n?-1:1}))}const i=new Vo({sequence:t,primers:n})
this.model.get("buffers").addTab(i)}}generatePrimers(){const e=this.model.get("sequence")
m.j("primer","generate_primers_click",{product:j.XC.MOLBIO,sequence_id:e.get("id")})
let t
this.working=!0
this.render()
this.model.savePreferences()
const onFinish=()=>{this.working=!1
this.render()}
try{t=this.model.getParams()}catch(e){if(e instanceof TypeError){onFinish()
v.ZP.error(e.message)
return}throw e}const n=We.Z.get(tn.gq.MELTING_TEMP_DNA),a=n.method===R.m_.primer3?1:0
function getOrElse(e,t){const a=n[e]
return null!=a?a:t}const i={sequence:e.bases(),PRIMER_SALT_MONOVALENT:getOrElse("monovalentConc",50),PRIMER_SALT_DIVALENT:getOrElse("divalentConc",0),PRIMER_DNTP_CONC:getOrElse("dntpConc",0),PRIMER_DNA_CONC:getOrElse("dnaConc",250),PRIMER_TM_FORMULA:a}
an.by({url:"/1/api/primer3",type:"PUT",contentType:"application/json",data:JSON.stringify(l.default.extend(t,i))}).done(this.addPrimers).fail((e=>{this.trackGeneratePrimersFail(v.ZP.getFriendlyError(e))
v.ZP.notifyError(e)})).always(onFinish)}render(){(0,Me.A9)(d.createElement(PrimerWizardOptions,{generatePrimers:this.generatePrimers,disabled:this.working}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}PrimerWizardOptionsView.initClass()
var ml=n(728510)
const pl=(0,be.Z)((function SecondaryStructureTab({models:e,name:t,primer:n,primer2:a,temperature:i}){return d.createElement("div",{className:"buffer-content-container"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},"Showing all ",d.createElement("b",null,t)," secondary structures for"," ","heterodimer"===t?d.createElement(d.Fragment,null,"primers ",d.createElement("b",null,n)," and ",d.createElement("b",null,a)):d.createElement(d.Fragment,null,"primer ",d.createElement("b",null,n))," ","at ",i,"°C.")),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("table",{className:"table table-hover"},d.createElement("colgroup",null,d.createElement("col",{className:"dg"}),d.createElement("col",{className:"structure"})),d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",{className:"deltag"},"ΔG (kcal)"),d.createElement("th",null,"Structure"))),d.createElement("tbody",null,e.map((e=>d.createElement("tr",{key:e.get("index"),"data-index":e.get("index")},d.createElement("td",{className:"deltag"},e.get("dg")),d.createElement("td",{dangerouslySetInnerHTML:{__html:e.get("smallSvg")}})))))))))}))
class SecondaryStructureView_OptionsView extends s().View{}class SecondaryStructureView_TabView extends s().View{static initClass(){this.prototype.className="all-secondary-structures buffer-tab"
this.prototype.events={"click tbody > tr":"openStructure"}}openStructure(e){const t=o()(e.currentTarget).data("index")
return this.structures[t].showModal()}render(){const e=this.model.get("mainStructure")
this.structures=this.model.get("structures").filter((t=>t.get("dg")>e.get("dg")))
this.structures.unshift(e)
l.default.each(this.structures,((e,t)=>e.set({smallSvg:o()("<div>").html(e.getSvg(100,!1))[0].innerHTML,index:t})))
this.$el.html(pl({models:this.structures,name:this.model.get("name").toLowerCase(),primer:this.model.get("primer"),primer2:this.model.get("primer2"),temperature:this.model.get("temperature")}))
return this}}SecondaryStructureView_TabView.initClass()
var hl=n(504544),gl=n(540285),El=n(483882),fl=n(662546)
function TranslationBulkEditModalContent({isSingleStranded:e,geneticCodeProps:t,strandProps:n,colorProps:a}){return d.createElement("div",{className:(0,g.iv)(Sl.modalContent)},d.createElement(Ke.Z,{className:(0,g.iv)(Sl.fieldSection)},d.createElement(Fr.Z,{className:(0,g.iv)(Sl.fieldLabel),label:"Genetic code"}),d.createElement(fl.Z,{geneticCode:t.value,onSelectGeneticCode:t.setValue,includeNullOption:!t.allSameValue})),d.createElement(Ke.Z,{className:(0,g.iv)(Sl.fieldSection)},d.createElement(Fr.Z,{className:(0,g.iv)(Sl.fieldLabel),label:"Strand"}),d.createElement(Mr,{strand:n.value,onSelectStrand:n.setValue,allowNone:!1,includeNullOption:!n.allSameValue,disabled:e})),d.createElement(Ke.Z,{className:(0,g.iv)(Sl.lastSection)},d.createElement(Fr.Z,{className:(0,g.iv)(Sl.fieldLabel),label:"Color"}),d.createElement(PopoverColorPicker,{selectedColor:a.value,onSelectColor:a.setValue,asDropdown:!0})))}const Sl=g.mM.create({modalContent:{display:"flex"},fieldSection:{width:"171px",marginRight:"16px"},lastSection:{width:"171px"},fieldLabel:{display:"block"}}),yl=function TranslationBulkEditModal({selectedTranslationRegionGroups:e,sequenceStartIndex:t,sequenceLength:n,isSingleStranded:a,bulkEditTranslations:i,onRequestClose:s}){const[r,o]=(0,Ln.Z)(R.BU),l=getAllSameAttribute("strand"),[c,u]=(0,d.useState)(l?e[0].strand:null),m=getAllSameAttribute("codonTranslationTable"),[p,h]=(0,d.useState)(m?e[0].codonTranslationTable:null),g=getAllSameAttribute("color"),[E,f]=(0,d.useState)(g?e[0].color:null)
function getAllSameAttribute(t){return e.every((n=>n[t]===e[0][t]))}return d.createElement(xr,{onRequestClose:s,collectionName:"translation",featureNames:e.map((e=>(0,Nn.j5)(e,t,n))),onClickSave:function onClickSave(){const t=null!=c&&!(l&&c===e[0].strand),n=null!=p&&!(m&&p===e[0].codonTranslationTable),a=null!=E&&!(g&&E===e[0].color)
if(t||n||a){const s=e.map((({hasGroup:e,translations:i,cid:s})=>({id:e?parseInt(s,10):null,regions:t||!e?i.map((({id:e})=>({modificationType:gl.u8.UPDATE,id:e,strand:t?c:void 0}))):[],properties:n||a?{codonTranslationTable:null!=p?p:void 0,color:null!=E?E:void 0}:void 0})))
n&&o(p)
i(s)}s()}},d.createElement(TranslationBulkEditModalContent,{isSingleStranded:a,geneticCodeProps:{value:p,setValue:h,allSameValue:m},strandProps:{value:c,setValue:u,allSameValue:l},colorProps:{value:E,setValue:f,allSameValue:g}}))},bl=[{header:"Name",accessorKey:"name",isSortable:!0,sortKey:"name"},{header:"Start",accessorKey:"start",isSortable:!0,sortKey:"start"},{header:"End",accessorKey:"end",isSortable:!0,sortKey:"end"},{header:"# of AAs",accessorKey:"aminoAcidLength",isSortable:!0,sortKey:"aminoAcidLength"},{header:"Regions",accessorKey:"displayRegions",isSortable:!1},{header:"Strand",accessorKey:"strandText",isSortable:!0,sortKey:"strandText"},{header:"Genetic code",accessorKey:"geneticCodeName",isSortable:!0,sortKey:"geneticCodeName"},{header:"Color",accessorKey:"colorElement",isSortable:!0,sortKey:"color"},{header:"Notes",accessorKey:"notes",isSortable:!0,sortKey:"notes"},{header:"Custom fields",accessorKey:"customFieldsElement",isSortable:!1}]
const Tl=g.mM.create({tabContainer:{height:"100%",display:"flex",flexDirection:"column"},tabHeaderContainer:{display:"flex",alignItems:"baseline"},tabHeader:_n.Oo,tabSubheader:{color:Vt.pp,marginLeft:"10px"},actionsContainer:{display:"flex",justifyContent:"flex-end",marginBottom:"8px"},partsInfoContainer:{display:"flex",alignItems:"center",marginRight:"8px",color:Vt.pp},partsInfoText:{marginBottom:"0",marginRight:"4px"},table:{height:"100%"}}),vl=function ExpandedTranslationTab({translationRegionGroups:e,sequenceStartIndex:t,sequenceLength:n,isSingleStranded:a,allowFeatureEdits:i,deleteTranslations:s,bulkEditTranslations:r}){const[o,l]=(0,d.useState)([]),c=e.map((e=>function getTranslationRow(e,t,n){const a=n.translations.length<=1?[]:n.translations.map((({start:n,end:a})=>`${(0,T.modelStartToDisplay)(n,e)}-${(0,T.modelEndToDisplay)(a,t,e)}`))
return{id:n.cid,isSelected:o.includes(n.cid),data:{name:`${n.name} `,start:(0,T.modelStartToDisplay)(n.translations[0].start,e),end:(0,T.modelEndToDisplay)(n.translations[n.translations.length-1].end,t,e),aminoAcidLength:n.aminoAcidLength,strandText:(0,An.FC)(n.strand),displayRegions:d.createElement(FeatureTableChipList,{items:a}),regionTexts:a,notes:n.notes,customFields:n.customFields,customFieldsElement:d.createElement(FeatureTableChipList,{items:n.customFields.map((({name:e,value:t})=>`${e}: ${t}`))}),geneticCodeName:El[n.codonTranslationTable].name,color:n.color,colorElement:d.createElement(ColorSwatch,{color:n.color,selected:!1,small:!0})}}}(t,n,e))),u=(0,Jt.Pe)(e,(e=>e.cid)),m=o.filter((e=>{var t
return!(null===(t=u[e])||void 0===t?void 0:t.editable)}));(0,d.useEffect)((()=>{i||l([])}),[i]);(0,d.useEffect)((()=>{const[e,t]=(0,Jt.uK)(o,(e=>null!=u[e]))
t.length>0&&l(e)}),[e,o,u])
return d.createElement("div",{className:(0,g.iv)(Tl.tabContainer),...(0,ee.Z)({component:"ExpandedTranslationTab",element:"root"})},d.createElement("div",{className:(0,g.iv)(Tl.tabHeaderContainer)},d.createElement("p",{className:(0,g.iv)(Tl.tabHeader)},"Translations"),d.createElement("p",{className:(0,g.iv)(Tl.tabSubheader)},`${e.length} total`)),d.createElement("div",{className:(0,g.iv)(Tl.actionsContainer)},m.length>0&&d.createElement("div",{className:(0,g.iv)(Tl.partsInfoContainer)},d.createElement("p",{className:(0,g.iv)(Tl.partsInfoText)},`${m.length} ${(0,de._6)(m.length,"part translation")} selected`),d.createElement(P.ZP,{title:"Cannot edit or delete translations that are inside parts"},d.createElement(pe.Z,{icon:"info-circle"}))),d.createElement(Pr.Z,null,d.createElement(P.ZP,{title:"Edit"},d.createElement(C.Co,{icon:"edit",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:()=>{(0,Xn.Z)(yl,{selectedTranslationRegionGroups:o.map((e=>u[e])),sequenceStartIndex:t,sequenceLength:n,isSingleStranded:a,bulkEditTranslations:r})},disabled:!i||m.length>0||0===o.length})),d.createElement(P.ZP,{title:"Delete"},d.createElement(C.Co,{icon:"delete",buttonStyle:C.ZJ.NEGATIVE,size:C.qE.SMALL,onClick:function onClickDeleteTranslations(){const t=e.filter((({cid:e})=>o.includes(e))),n=t.flatMap((e=>e.translations.map((({id:e})=>e))))
s(n,`Successfully deleted ${t.length} ${(0,de._6)(t.length,"translation")}`)},disabled:!i||m.length>0||0===o.length})))),d.createElement(vr.ZP,{className:(0,g.iv)(Tl.table),canResizeColumns:!0,rowSelectionMode:Tr.rT.MULTIPLE,tableKey:Tr.Uw.EXPANDED_TRANSLATION_TABLE,disableSelection:!i,columns:bl,getRowContentHeight:function getRowHeight(e){if(e>=c.length)return Tr._5
const t=Math.max(c[e].data.regionTexts.length,c[e].data.customFields.length)
return(0,Er.m2)(t,Za.TK.TABLE_CELL)},isCompact:!0,emptyTableText:"This sequence has no translations",onRowsSelect:function handleSelection(e,t){const n=e.map((e=>e.id))
if(t){const e=n.filter((e=>!o.includes(e)))
l([...o,...e])}else l(o.filter((e=>!n.includes(e))))},initialRows:c,initialSort:[{sortKey:"start"}],getSortValue:(e,t)=>e.data[t],matchParentHeight:!0}))}
class TranslationTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}initialize(){const e=this.model.sequence(),t=e._sequence()
this.listenTo(e,"change:writable change:permissions change:currentVersion change:translations",this.render.bind(this))
this.listenTo(e.translations(),"add remove reset change:_translation",this.render.bind(this))
this.listenTo(t,"change:startIndex change:locked",this.render.bind(this))
this.listenTo(t,"change:translationGroups",this.render.bind(this))}async deleteTranslations(e,t){const n=this.model.sequence(),a=n.tagSchema(),i=n.translations().filter((({id:t})=>e.includes(t))).map((e=>(0,Nn.b2)(n,e)))
await(0,Nn.am)(a,!1,i.some((e=>e.codonTranslationTable!==R.hR.STANDARD)),i.length)&&this.model.deleteTranslations(e).done((({message:n})=>{v.ZP.success(null!=t?t:n)
m.j("translation","deleted_translations",{product:j.XC.MOLBIO,sequence_id:this.model.sequence().id,source:"translations-table",translation_ids:e})})).fail(v.ZP.notifyError)}async bulkEditTranslations(e){const t=this.model.sequence(),n=t.tagSchema(),a=(0,Jt.Pe)(t.translationGroups(),(e=>e.id)),i=e.some((e=>{var t
if(null==e.id)return!1
const n=a[e.id],i=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.codonTranslationTable
return null!=i&&i!==n.codonTranslationTable&&n.codonTranslationTable!==R.hR.STANDARD}))
if(!await(0,Nn.am)(n,i,!1,e.length))return
const{updated:s}=await(0,gl.IF)(t.id,e),r=s.map((({translationGroup:e})=>e)),o=s.flatMap((({translationRegions:e})=>e));(0,Nn._x)(t,r,o,[])
v.ZP.success(`Successfully saved ${s.length} ${(0,de._6)(s.length,"translation")}.`)
m.j("translation","updated_translations",{product:j.XC.MOLBIO,sequence_id:t.id,source:"translations-table",translation_group_ids:r.map((({id:e})=>e)),translation_ids:o.map((({id:e})=>e))})}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}render(){const e=this.model.sequence();(0,Me.A9)(d.createElement(vl,{translationRegionGroups:(0,Nn.KB)(e),sequenceStartIndex:e.startIndex(),sequenceLength:e.length(),isSingleStranded:e.isSingleStranded(),allowFeatureEdits:e.allowFeatureEdits(),deleteTranslations:(e,t)=>{this.deleteTranslations(e,t)},bulkEditTranslations:e=>{this.bulkEditTranslations(e)}}),this.el)
return this}}TranslationTabView.initClass()
var Cl=n(205155)
const Il=(0,be.Z)((function VirtualDigestTab({legend:e}){return d.createElement("div",{className:"container"},d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("dl",{className:"dl-horizontal highlighted"},d.createElement("dt",null,"Highlighted Fragment"),d.createElement("dd",null,"--")))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("dl",{className:"dl-horizontal legend"},e.map((e=>d.createElement(d.Fragment,{key:e.index},d.createElement("dt",null,e.index),d.createElement("dd",null,e.title))))))))}))
const wl=(0,be.Z)((function VirtualDigestMenu(){return d.createElement("ul",{className:"nav navbar-nav form-inline"},d.createElement("li",{className:"ladder-options"},d.createElement("label",null,"Ladder"),d.createElement("select",{className:"select-medium"})),d.createElement("li",null,d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,className:"download-btn",text:"Download PNG"})))}))
var Nl=n(933212),Al=n(782649),Rl=n(826478)
function VirtualDigestView_ownKeys(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e)
t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function VirtualDigestView_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?VirtualDigestView_ownKeys(Object(n),!0).forEach((function(t){VirtualDigestView_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VirtualDigestView_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function VirtualDigestView_defineProperty(e,t,n){(t=function VirtualDigestView_toPropertyKey(e){var t=function VirtualDigestView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}function getLegendInfo(e){const t=[],n=e.ladders().find((t=>t.id.toString()===e.get("ladderId")))
t.push({index:"Ladder",title:n.name})
e.get("digests").each(((e,n)=>{const a=e.get("sequence"),i=e.get("analysis").get("enzymes").map((e=>a.get("enzymes").get(e).get("name")))
t.push({index:n+1,title:`${a.get("_sequence").get("name")} - ${i.join(" ")}`})}))
return t}class VirtualDigestView_OptionsView extends s().View{static initClass(){this.prototype.className="navbar"
this.prototype.template=wl
this.prototype.events={"change select":"changeLadder","click .download-btn":"downloadPNG"}}async copyPNG(e){const makeImagePromise=async()=>{const t=await fetch(e),n=await t.blob()
return new Blob([n],{type:"image/png"})}
if(de.Ud){const t=await fetch(e),n=await t.blob()
await navigator.clipboard.write([new window.ClipboardItem({"image/png":new Blob([n],{type:"image/png"})})])}else await navigator.clipboard.write([new window.ClipboardItem({"image/png":makeImagePromise()})]);(0,Al.M)({message:"PNG copied",type:Rl.pC.SUCCESS})}createSVG(){const e=getLegendInfo(this.model),t=this.model.get("bufferViewLayout").get("el").find("svg")[0].cloneNode(!0),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=60+10*Math.max(e.length-4,0),i=e.flatMap((({index:e,title:t})=>{const n=new RegExp(`(?:\\s|^)(\\S.{0,${a}}|\\S+)(?!\\S)`)
return t.split(n).map((e=>e.trim())).filter((e=>""!==e)).map(((t,n)=>({index:0===n?e:null,title:t})))})),s=parseInt(t.getAttribute("height"),10)+24*(i.length+1),r=Math.max(parseInt(t.getAttribute("width"),10),500);(0,Me.A9)(d.createElement("g",null,d.createElement("rect",{fill:"white",width:r,height:s}),i.map((({index:e,title:t},n)=>d.createElement("g",{key:n,transform:`translate(10, ${24*(n+1)})`},e&&d.createElement("text",{transform:"translate(0, 0)"},e),d.createElement("text",{transform:`translate(80, ${e?0:-4})`},t))))),n)
appendSVGToSVG({parentSVG:n,childSVG:t,transform:`translate(0, ${24*(i.length+1)})`})
return n}async downloadPNG(){const e=(0,gt.Z)();(0,Al.M)({id:e,message:"Creating PNG...",type:Rl.pC.INFO,duration:v.a9})
const t=this.createSVG()
let n
de.a1&&(n=window.open())
try{const a=await getPNGFileForSVG(t,(0,Hs.Z)(`virtual_digest_sequence_${this.model.get("sequence").name()}`,"png"))
de.a1?n.location=a:window.open(a);(0,Al.M)(VirtualDigestView_objectSpread({id:e,message:"PNG downloaded",type:Rl.pC.SUCCESS,duration:v.a9},window.ClipboardItem&&navigator.clipboard.write&&{actionText:"Copy to clipboard",onActionClick:()=>{this.copyPNG(a)}}))}catch(t){(0,Al.M)({id:e,message:v.ZP.getFriendlyError(t),type:Rl.pC.DANGER})
throw t}}changeLadder(){return this.model.set({ladderId:this.$el.find("select option:selected").val()})}addLadderOption(e){return this.$("select").append(new Option(e.name,e.id))}render(){this.$el.html(this.template())
const e=this.model.ladders()
for(const t of Array.from(e))this.addLadderOption(t)
const t=new Nl.F
t.fetch().done((()=>t.each((t=>{const n={id:t.id,name:t.get("name"),bands:t.bandSizes().slice().sort(((e,t)=>e-t))}
if(!e.some((e=>e.id===n.id&&e.name===n.name&&e.bands.every(((e,t)=>e===n.bands[t]))))){e.push(n)
this.addLadderOption(n)}}))))
return this}}VirtualDigestView_OptionsView.initClass()
class VirtualDigestView_TabView extends s().View{static initClass(){this.prototype.id="virtual-gel"
this.prototype.template=Il
this.prototype.className="buffer-tab"
this.prototype.attributes=VirtualDigestView_objectSpread(VirtualDigestView_objectSpread({},this.prototype.attributes),(0,ee.Z)({component:"VirtualDigestView",element:"root"}))}initialize(e){this.sequence=this.model.get("sequence")
this.listenTo(this.model,"change:ladderId",this.render)
this.listenTo(this.model.get("digests"),"add remove",this.render)
this.listenTo(this.model.get("digests"),"selectedFragmentChange",this.update)
const listenToDigest=e=>this.listenTo(e.get("analysis"),"change:fragments",this.render)
this.model.get("digests").each(listenToDigest)
this.listenTo(this.model.get("digests"),"add",listenToDigest)
this.listenTo(this.model.get("digests"),"remove",l.default.bind((function(e){return this.stopListening(e)}),this))
return this.fileStates=ve.ZP.get()}update(){return function(e,t,n,a){const i=e.get("layout")
let s=l.default.find(e.ladders(),(t=>t.id.toString()===e.get("ladderId")))
t=Re().scale.log().domain([s.bands[0],s.bands[s.bands.length-1]]).rangeRound([i.gel.height-i.gel.padding-i.band.height,i.gel.padding]).clamp(!0)
const r=[s].concat(e.get("digests").models),c=Re().select(a.el).select("g.header").selectAll("text").data(r)
c.enter().append("svg:text")
c.text(((e,t)=>0===t?"Ladder":t)).attr("x",((e,t)=>i.lane.width*t+i.lane.width/2)).attr("y",i.header.height/2).attr("text-anchor","middle")
c.exit().remove()
s=Re().select(a.el).select("g.ladder-labels").selectAll("text").data(s.bands)
s.enter().append("svg:text")
s.text((e=>y.formatBaseCount(e))).attr("transform",(e=>`translate(0,${t(e)+Math.floor(i.type.height/3)})`))
s.exit().remove()
const d=Re().select(a.el).select("g.gel").selectAll("g.lane").data(r)
d.enter().append("svg:g").attr("class",((e,t)=>0===t?"lane ladder":"lane")).attr("transform",((e,t)=>`translate(${i.lane.width*t},0)`)).append("svg:g").attr("transform",`translate(${(i.lane.width-i.band.width)/2},0)`).attr("class","bands")
const u=d.select("g.bands").selectAll("rect").data(((e,t)=>e.bands||e.get("analysis").get("fragments").models))
u.enter().append("rect")
function handleClick(t,n){null==n&&(n=!1)
if(null==e.get("digests").at(0).get("sequence").fileState())return
let i=null
e.get("digests").each(((e,n)=>e.get("analysis").get("fragments").each((n=>n===t?i=e:n.set({selected:!1})))))
const s=i.get("sequence")
return a.fileStates.selectFragment(s,t,n)}u.attr("x",0).attr("y",0).attr("width",i.band.width).attr("height",i.band.height).attr("fill",(e=>l.default.isNumber(e)?i.band.fill:e.get("selected")?i.band.active.fill:i.band.fill)).attr("transform",(e=>`translate(0,${l.default.isNumber(e)?t(e):t(e.get("length"))})`)).on("click",(e=>{if(!l.default.isNumber(e))return handleClick(e)})).on("mouseover",(function(e){if(!l.default.isNumber(e)){o()(a.el).find("dl.highlighted dd").text(y.formatBaseCount(e.get("length")))
if(!e.get("selected"))return Re().select(this).attr("fill",i.band.active.fill)}})).on("mouseleave",(function(e){if(!l.default.isNumber(e)){let t="--"
const n=e.collection.find((e=>e.get("selected")))
null!=n&&(t=y.formatBaseCount(n.get("length")))
o()(a.el).find("dl.highlighted dd").text(t)
if(!e.get("selected"))return Re().select(this).attr("fill",i.band.fill)}})).on("contextmenu",(t=>{if(null==e.get("digests").at(0).get("sequence").fileState())return
const n=e.get("digests").find((e=>null!=e.get("analysis").get("fragments").find((e=>e===t))))
return!l.default.isNumber(t)&&SelectionContextMenu_open(Re().event,n.get("sequence"),["copy","copySpecial"])?handleClick(t,!0):void 0})).each((e=>{if(!l.default.isNumber(e)&&null!=e.get("selected")&&e.get("selected"))return o()(a.el).find("dl.highlighted dd").text(y.formatBaseCount(e.get("length")))}))
u.exit().remove()
return d.exit().remove()}(this.model,this.y,this.sequence,this)}render(){this.$el.empty()
const e=getLegendInfo(this.model)
this.$el.append(this.template({legend:e}))
const t=this.model.get("layout")
Re().select(this.el).append("svg").attr("height",t.padding+t.gel.height+t.header.height).attr("width",t.padding+t.ladder.width+e.length*t.lane.width).attr("data-test-component","VirtualDigestView").attr("data-test-element","svgRoot").append("g").attr("transform",`translate(${t.padding},${t.padding})`)
const n=Re().select(this.el).select("svg").select("g")
n.append("g").attr("class","header").attr("transform",`translate(${t.ladder.width},0)`)
n.append("g").attr("class","ladder-labels").attr("transform",`translate(0,${t.header.height})`)
const a=n.append("g").attr("class","gel-container").attr("transform",`translate(${t.ladder.width},${t.header.height})`)
a.append("svg:rect").attr("x",0).attr("y",0).attr("width",e.length*t.lane.width).attr("height",t.gel.height).attr("fill",t.gel.fill)
a.append("svg:g").attr("class","gel")
this.update()
return this}}VirtualDigestView_TabView.initClass()
var Pl=n(982519),Ol=n(694582),xl=n(567202)
const _l=dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES?500:2e3,Dl=(0,xl.ZP)({modifiedAt:null,previousModifiedAt:null})
function usePollingAnalysis(e){const{modifiedAt:t,previousModifiedAt:n}=function usePollingModifiedAt(e){const[t,n]=Dl.useGlobalClientState(e);(0,Da.IJ)(Ol.J,{variables:{analysisId:e},pollInterval:_l,renderCachedDataWhenRefetching:!0,onCompleted:e=>{n({modifiedAt:(0,ka.CZ)(e.analysis)?null:e.analysis.modifiedAt,previousModifiedAt:t.modifiedAt})}})
return t}(e),a=(0,Da.IJ)(Ol.h,{variables:{analysisId:e},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0});(0,d.useEffect)((()=>{null!=n&&n!==t&&a.refetch()}),[n,t])
return a}var Ll=n(714529),kl=n(476604)
function PollingAnalysis(e){const t=usePollingAnalysis(e.analysisId)
return t.type!==Da.NI.SUCCESS?d.createElement(kl.b,null):(0,ka.CZ)(t.data.analysis)?d.createElement(Ll.Z,{inaccessibleInfo:t.data.analysis,modelType:st.ANALYSIS}):d.createElement(d.Fragment,null,e.children(t.data.analysis))}var Ml=n(681896),Fl=n(165043),Zl=n(586208),Bl=n(848880),ql=n(646891),Vl=n(776234),Ul=n(389760)
async function fetchQueryApiSDL(){return await an.s0({url:"/1/api/query-api-sdl-async"})}async function fetchQueryApiBacklinks(e){return await Cn.s0({url:"/1/api/query-api-backlink-type-extension",data:{typeIdentifier:e}})}function getWrappingTypes(e){const t=[]
for(;(0,Fl.fw)(e);){t.push(e)
e=e.ofType}return t}function getDirective(e,t){var n,a
return null!==(a=null===(n=e.directives)||void 0===n?void 0:n.find((e=>e.name.value===t)))&&void 0!==a?a:null}function getDirectiveStringArg(e,t,n){var a,i
const s=null===(i=null===(a=getDirective(e,t))||void 0===a?void 0:a.arguments)||void 0===i?void 0:i.find((e=>e.name.value===n))
return(null==s?void 0:s.value.kind)===Zl.h.STRING?s.value.value:null}function fieldOrTypeToId(e){const t=null==e?void 0:e.astNode
return null==t?null:getDirectiveStringArg(t,"alias","id")}function fieldOrTypeToDisplayName(e){const t=null==e?void 0:e.astNode
return null==t?null:getDirectiveStringArg(t,"alias","displayName")}function buildQueryApiIntrospection(e){const t=(0,Bl.I)(e),n=t.getQueryType();(0,S.hu)(null!=n,"Got null GraphQL query type")
const a=function buildSchemaIdToQueryListingFieldsMap(e){var t
const n=new Map
for(const a of e){if(!getWrappingTypes(a.type).some((e=>(0,Fl.HG)(e))))continue
const e=fieldOrTypeToId((0,Fl.xC)(a.type))
if(null!=e){n.has(e)||n.set(e,[])
null===(t=n.get(e))||void 0===t||t.push(a)}}return n}(Object.values(n.getFields()))
function getQueryListingFieldForSchema(e){var t
const n=null!==(t=a.get(e))&&void 0!==t?t:[];(0,S.Gp)(n.length<=1,"Found multiple query listing fields for schema",{schemaId:e,listingFields:n})
return 0===n.length?null:n[0]}function getFieldDisplayName(e){var t
return null!==(t=fieldOrTypeToDisplayName(e))&&void 0!==t?t:e.name}function getTypeDisplayName(e){var t
return null!==(t=fieldOrTypeToDisplayName(e))&&void 0!==t?t:e.name}function isBacklinkField(e){return null!=e.astNode&&null!=getDirective(e.astNode,"backlink")}function getQueryField(e){var t
return null!==(t=n.getFields()[e])&&void 0!==t?t:null}function backlinkFieldToTargetSchemaId(e){(0,S.hu)(isBacklinkField(e),"backlinkFieldToTargetSchemaId called with non-backlink field")
const t=fieldOrTypeToId((0,Fl.xC)(e.type));(0,S.hu)(null!=t,"Got a backlink field whose type has no corresponding schema",{fieldName:e.name})
return t}return{graphQLSchema:t,getQueryField,getQueryFieldSchemaId:function getQueryFieldSchemaId(e){var t
const n=getQueryField(e)
return null==n?null:null!==(t=fieldOrTypeToId((0,Fl.xC)(n.type)))&&void 0!==t?t:null},getQueryListingFieldForSchema,hasQueryListingFieldForSchema:e=>null!=getQueryListingFieldForSchema(e),getFieldDisplayName,isArchivedField:e=>null!=e.astNode&&null!=getDirective(e.astNode,"archived"),isBacklinkField,isUserDefinedField:function isUserDefinedField(e){return null!=fieldOrTypeToId(e)},getTypeDisplayName,getQueryAstValidationErrors:e=>(0,Vl.Gu)(t,e),targetSchemaIdToBacklinkField:function targetSchemaIdToBacklinkField(e,t){const n=Object.values(e.getFields()).find((e=>isBacklinkField(e)&&backlinkFieldToTargetSchemaId(e)===t))
return null!=n?n:null},backlinkFieldToTargetSchemaId,typeHasResultSchemaBacklinkFields:function typeHasResultSchemaBacklinkFields(e){return Object.values(e.getFields()).some((e=>{if(!isBacklinkField(e))return!1
const t=fieldOrTypeToId((0,Fl.xC)(e.type))
return null!=t&&ea.ZP.isAssaySchema(t)}))},getPossibleJoinKeyFields:function getPossibleJoinKeyFields(e,n){return(0,hs.Z)(Object.values(n.getFields()).filter((n=>(0,ql.uJ)(t,e,(0,Fl.xC)(n.type)))),[{accessor:t=>(0,Fl.xC)(t.type)===e?-1:1},{accessor:getFieldDisplayName}])},getAllListableSchemas:function getAllListableSchemas(){return Object.values(t.getTypeMap()).filter((e=>null!=fieldOrTypeToId(e))).map((e=>({id:fieldOrTypeToId(e),name:getTypeDisplayName(e)})))}}}const Gl=(0,xl.ZP)(Wr.Tp),zl="query-api-introspection"
function fetchQueryApiIntrospection(){const e=Gl.getState(zl)
e.status===Wr.Lr.NOT_FETCHED&&(0,Wr.cC)({makeCall:fetchQueryApiSDL,args:[],asyncState:e,setAsyncState:e=>{Gl.updateState(zl,e)}})}const $l="query-api-type-extension",Wl=(0,xl.ZP)({})
function fetchQueryApiTypeExtension(e){const t=Wl.getState($l),n=t[e]
null!=n&&n.status!==Wr.Lr.NOT_FETCHED||(0,Wr.cC)({makeCall:fetchQueryApiBacklinks,args:[e],asyncState:null!=n?n:Wr.Tp,setAsyncState:n=>{Wl.updateState($l,{...t,[e]:n})}})}function useQueryApiIntrospection(){const e=function useQueryApiSDL(){(0,Ul.Z)(fetchQueryApiIntrospection)
return Gl.useGlobalClientState(zl)[0]}(),t=Wl.useGlobalClientState($l)[0],n=e.status===Wr.Lr.SUCCESS?e.data:null,a=(0,d.useMemo)((()=>{if(null==n)return null
const e=(0,Li.BL)("useQueryApiIntrospection",{enabled:!0,getMetadata:()=>({})}),a=Object.values(t).filter((e=>(null==e?void 0:e.status)===Wr.Lr.SUCCESS&&null!=e.data.typeExtension)).map((e=>e.data.typeExtension)),i=`${n}\n${a.join("\n")}`,s=(0,Li.mg)(e,(()=>buildQueryApiIntrospection(i)));(0,Li.sT)(e)
return s}),[n,t])
return(0,d.useMemo)((()=>e.status===Wr.Lr.ERROR?{status:Da.NI.ERROR}:e.status===Wr.Lr.LOADING||e.status===Wr.Lr.NOT_FETCHED?{status:Da.NI.PENDING}:{status:Da.NI.SUCCESS,...a}),[e.status,a])}var Hl=n(990031),jl=n(936091),Yl=n(624034)
function isAnalysisRunning(e){return e.execution.steps.some((e=>e.statusCode===Sn.wF.RUNNING))}var Ql=n(16049),Kl=n(191193)
function useFuzzyDate(e){!function usePollingRerender(e){const[t,n]=(0,d.useState)(0);(0,d.useEffect)((()=>{const t=setInterval((()=>{n((e=>e+1))}),e)
return()=>{clearInterval(t)}}),[e])}(1e3)
return(0,Kl.Z)(e)}var Jl=n(665704),Xl=n(346383),ec=n(418511),tc=n(866219),nc=n(173220),ac=n(138966)
const ic={item:{name:"Item",propertyKey:"name",sortIndex:0},reference:{name:"Reference",propertyKey:"referencedInText",sortIndex:-1},modifiedAt:{name:"Modified at",propertyKey:"modifiedAt",sortIndex:1},projectLocation:{name:"Project location",propertyKey:"location",sortIndex:2}}
var sc=n(453778),rc=n(601790),oc=n(600561),lc=n(272241)
var cc,dc=n(966248),uc=n(630089)
function getSamplesText(e){const t=e.map((({inputSamples:e,registeredSamples:t})=>[...e,...t])).flat().map((({name:e})=>e)),n=[...new Set(t)]
return n.length>1?`${n.length} samples`:n[0]}function getModifiedAt(e){return"modified_at"in e&&e.modified_at||null}function getLocation(e){return"folder"in e&&e.folder.source?e.folder.source.name:null}function getBaseRelevantItemRowData(e,t,n,a){const{tagged:i,sequencesUsingAsPrimer:s,bulkAssembliesUsingAsFragment:r,bulkAssembliesCreatingAsConstruct:o,bulkAssembliesCreatingAsAmplifiedFragment:l,filesMentioning:c,filesMentioningViaBatch:u,attached:p,workflows:h,mentionedBatchesByFileId:g}=e,filterItems=e=>{switch(t){case cc.ALL:return e
case cc.ENTRIES:return e.filter((e=>e.id&&ea.ZP.isEntry(e.id)))
case cc.ENTITY_LINKS:return e.filter((e=>e.id&&ea.ZP.isBiologicalEntity(e.id)))
case cc.LEGACY_WORKFLOWS:case cc.SEQUENCE_PRIMERS:case cc.PROCESSES:return[]
default:throw new Error("Invalid relevant items filter option")}},relevantBatchesMessage=e=>{(0,S.hu)(e.length>0,"Expected batches to have elements")
const t=e.map((e=>e.name))
return`${(0,de._6)(t.length,"Batch")} ${(0,Mt.gf)(t,3)} ${n?"of converted item ":""}referenced in entry`},E=n?"Converted item":"Entity",f=filterItems(i).map((e=>({id:e.id,name:e.name,referencedInText:`${E} referenced in field`,modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),y=(b=s,[cc.ALL,cc.SEQUENCE_PRIMERS].includes(t)?b:[]).map((e=>{var t,n
return{id:e.sequenceInfo.id,name:e.sequenceInfo.name,referencedInText:`${E} bound as primer at position: ${1===e.bindInfo.bindStrand?"+":"-"}/${T.modelToDisplay(e.bindInfo.bindPosition,e.sequenceInfo.startIndex)}`,modifiedAt:e.sequenceInfo.modified_at,location:(null===(t=e.sequenceInfo.folder)||void 0===t?void 0:t.source)&&(null===(n=e.sequenceInfo.folder.source)||void 0===n?void 0:n.name)||null,chip:d.createElement(sc.Z,{id:e.sequenceInfo.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.sequenceInfo.id)}}}))
var b
const v=r.map((e=>({id:e.id,name:e.name,referencedInText:`${E} used as fragment in assembly`,modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),C=o.map((e=>({id:e.id,name:e.name,referencedInText:`${E} created by assembly`,modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),I=l.map((e=>({id:e.id,name:e.name,referencedInText:`${E} created by assembly`,modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),w=filterItems(c).map((e=>({id:e.id,name:e.name,referencedInText:ea.ZP.isEntry(e.id)?`${E} referenced in entry`:`${E} referenced in description`,modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),N=filterItems(u).map((e=>({id:e.id,name:e.name,referencedInText:relevantBatchesMessage(g[e.id]),modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),A=filterItems(p).map((e=>({id:e.id,name:e.name,referencedInText:"Attached "+(n?"on converted item":""),modifiedAt:getModifiedAt(e),location:getLocation(e),chip:d.createElement(sc.Z,{id:e.id,size:Za.TK.SMALL}),onClick:()=>{Rn.Z.openFile(e.id)}}))),R=(e=>[cc.ALL,cc.LEGACY_WORKFLOWS].includes(t)?e:[])(h).map((e=>{const{workflowSummary:t}=e,{description:a,modifiedAt:i,name:s,projectName:r}=function getRelevantWorkflowInfo(e,t=!1){const{workflowSummary:n,stageEntriesMentioning:a}=e
let i
const s=a.filter((({registeredSamples:e})=>e.length>0))
let r
1===a.length?r=a[0]:1===s.length&&(r=s[0])
if(r){const{stageEntrySummary:e}=r
i=d.createElement("span",null,getSamplesText([r])," referenced in"," ",d.createElement(uc.Z,{href:de.jp(e.editURL),fileId:e.id},e.name),t?" on converted item":"")}else{const e=getSamplesText(a)
i=d.createElement("span",null,e," referenced in multiple entries",t?" on converted item":"")}let o=n.humanId
n.name&&(o+=` • ${n.name}`)
return{description:i,modifiedAt:n.modifiedAt,name:o,projectName:n.source.name}}(e,n)
return{id:t.id,name:s,referencedInText:a,modifiedAt:i,location:r,chip:d.createElement(Za.ZP,{size:Za.TK.SMALL,text:s,icon:"workflow",className:"chip-container",onClick:()=>{dc.g(e.workflowSummary.id)}}),onClick:()=>{dc.g(e.workflowSummary.id)}}})),P=a?(e=>[cc.ALL,cc.PROCESSES].includes(t)?e:[])([...a.processOutputs,...a.processTasks]).map((e=>{var t
const{name:a,process:i}=e,{modifiedAt:s,createdAt:r,editUrl:o,folder:l}=i
return{name:a,id:a,referencedInText:(n?"Converted item":"Entity")+" referenced in task group",modifiedAt:null!=s?s:r,location:null!==(t=null==l?void 0:l.name)&&void 0!==t?t:null,chip:d.createElement(Za.ZP,{text:a,icon:"process",size:Za.TK.SMALL,className:"chip-container",onClick:()=>{(0,ac.ZP)(null!=o?o:"")
m.L9(j.Zm.CLICKED_RELEVANT_ITEM)}}),onClick:()=>{(0,ac.ZP)(null!=o?o:"")}}})):[]
return f.concat(y,v,C,I,w,N,A,R,P)}function lowercaseIncludes(e,t){return e.toLowerCase().includes(t.toLowerCase())}function matchName(e,t){return lowercaseIncludes(e.name,t)}function matchModifiedAt(e,t){return null!=e.modifiedAt&&lowercaseIncludes(Hr.UT(e.modifiedAt),t)}function matchLocation(e,t){return null!=e.location&&lowercaseIncludes(e.location,t)}function getSortedRelevantItemRowData(e,t){let n=e
const a=function getHeaderColumn(e){return Object.values(ic).find((t=>t.sortIndex===e))}(t.columnKey)
a&&(n=(0,hs.Z)(e,[{accessor:a.propertyKey,naturalSort:!0,reversed:"arrow-up"===t.sortDirection}]))
return n}function RelevantItemsSectionTable(e){var t
const{pageOffset:n,searchQuery:a,filterOption:i}=e.filteredTableState,s=function getRelevantItemRowData(e){const t=e.filteredTableState.filterOption,{tagged:n,sequencesUsingAsPrimer:a,bulkAssembliesUsingAsFragment:i,bulkAssembliesCreatingAsConstruct:s,bulkAssembliesCreatingAsAmplifiedFragment:r,filesMentioning:o,filesMentioningViaBatch:l,attached:c,workflows:d,mentionedBatchesByFileId:u,total:m}=e.relevantItems,p=getBaseRelevantItemRowData({tagged:n,sequencesUsingAsPrimer:a,bulkAssembliesUsingAsFragment:i,bulkAssembliesCreatingAsConstruct:s,bulkAssembliesCreatingAsAmplifiedFragment:r,filesMentioning:o,filesMentioningViaBatch:l,attached:c,workflows:d,mentionedBatchesByFileId:u,total:m},t,!1,e.relevantItemsGraphQL),h=getBaseRelevantItemRowData(e.relevantItems.convertedFromRelevantItems,t,!0,e.relevantConvertedFromItemsGraphQL)
return p.concat(h)}(e),r=function filterItemsToSearchQuery(e,t,n){return""===t?e:e.filter((e=>n.some((n=>n(e,t)))))}(s,a,[matchName,matchModifiedAt,matchLocation]),{sortState:o,getHeaderCellProps:l}=(0,lc.Z)(e.itemId),c=getSortedRelevantItemRowData(r,null!=o?o:{columnKey:ic.modifiedAt.sortIndex,sortDirection:"arrow-up"})
function renderHeader(e){(0,S.hu)(-1!==e.sortIndex,"Expected header to have sortable index")
return d.createElement(oc.Z,{...l(e.sortIndex)},e.name)}const u=null!==(t=e.paginationLimit)&&void 0!==t?t:100
return d.createElement(rc.iA,{emptyTableText:"No relevant items were found.",numRows:Math.min(c.length-n,u),pagination:{offset:n,limit:u,total:c.length},setOffset:function setOffset(t){e.setFilteredTableState({filterOption:i,searchQuery:a,pageOffset:t})},isCompact:e.isCompact},d.createElement(rc.sg,{header:renderHeader(ic.item),renderCell:e=>d.createElement(rc.bL,null,c[n+e].chip)}),d.createElement(rc.sg,{header:d.createElement(rc.bL,{className:(0,g.iv)(rc.z6.grayHoverHeaderCell)},ic.reference.name),renderCell:e=>d.createElement(rc.bL,null,c[n+e].referencedInText)}),d.createElement(rc.sg,{header:renderHeader(ic.modifiedAt),renderCell:e=>d.createElement(rc.bL,null,c[n+e].modifiedAt&&Hr.UT(c[n+e].modifiedAt))}),d.createElement(rc.sg,{header:renderHeader(ic.projectLocation),renderCell:e=>d.createElement(rc.bL,null,c[n+e].location)}))}!function(e){e.ALL="All"
e.ENTRIES="Entries"
e.ENTITY_LINKS="Entity links"
e.SEQUENCE_PRIMERS="Primer binding sites"
e.LEGACY_WORKFLOWS="Legacy Workflows"
e.PROCESSES="Task groups"}(cc||(cc={}))
function RelevantItemsSectionHeader(e){const{filterOption:t,searchQuery:n}=e.filteredTableState
return d.createElement("div",{className:f()("pull-left",(0,g.iv)(pc.header))},d.createElement("div",{className:"u-lr-split u-small-spacing-bottom"},d.createElement(tc.Z,{className:"u-display-inline-block",displayName:t,items:[Object.values(cc).filter((e=>e!==cc.LEGACY_WORKFLOWS||dt.ZP.LEGACY_WORKFLOWS_ENABLE)).filter((e=>e!==cc.PROCESSES||dt.ZP.WORKFLOWS_ENABLE)).map((t=>({name:filterOptionToDisplayName(t),handleOnClick:()=>{e.setFilteredTableState({filterOption:t,searchQuery:n,pageOffset:0})}})))]}),d.createElement(nc.ZP,{clearType:nc.Nl.X,placeholder:"Search",onChange:n=>{e.setFilteredTableState({filterOption:t,searchQuery:n.target.value,pageOffset:0})},onEscape:()=>{e.setFilteredTableState({filterOption:t,searchQuery:"",pageOffset:0})},value:n})))}function filterOptionToDisplayName(e){return e===cc.LEGACY_WORKFLOWS?dt.ZP.WORKFLOWS_ENABLE?"Legacy Workflows":"Workflows":e}const mc=(0,xl.ZP)({searchQuery:"",filterOption:cc.ALL,pageOffset:0})
function PresentationalRelevantItemsSection({relevantItems:e,relevantItemsGraphQL:t,itemId:n,relevantConvertedFromItemsGraphQL:a,isCompact:i,paginationLimit:s}){const[r,o]=mc.useGlobalClientState(n)
return d.createElement("div",{...(0,ee.Z)({component:"PresentationalRelevantItemsSection",element:"root"})},d.createElement(RelevantItemsSectionHeader,{filteredTableState:r,setFilteredTableState:o}),d.createElement(RelevantItemsSectionTable,{relevantItems:e,relevantItemsGraphQL:t,relevantConvertedFromItemsGraphQL:a,filteredTableState:r,setFilteredTableState:o,itemId:n,isCompact:i,paginationLimit:s}))}const pc=g.mM.create({header:{lineHeight:"24px",width:"100%",marginLeft:3}}),hc=xa.Ps`
  fragment RelevantProcessGraphQL on ProcessNode {
    id
    modifiedAt
    createdAt
    editUrl
    folder {
      id
      name
    }
  }
`,gc=xa.Ps`
  fragment RelevantItemsGraphQL on RelevantItemsNode {
    total
    processTasks {
      id
      name
      process {
        ...RelevantProcessGraphQL
      }
    }
    processOutputs {
      id
      name
      process {
        ...RelevantProcessGraphQL
      }
    }
  }
  ${hc}
`,Ec=xa.Ps`
  query RelevantItemsQuery($fileId: StrictString!) @skipAudit @engComponent(name: REGISTRY) {
    folderItem(id: $fileId) {
      ... on BaseFolderItemInterface {
        id
        legacyRelevantItemsJson
        relevantItems {
          ...RelevantItemsGraphQL
        }
        relevantConvertedFromItems {
          ...RelevantItemsGraphQL
        }
      }
      ... on FolderItemInterface {
        id
        legacyRelevantItemsJson
        relevantItems {
          ...RelevantItemsGraphQL
        }
        relevantConvertedFromItems {
          ...RelevantItemsGraphQL
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${gc}
`
function QueryingRelevantItemsSection(e){return d.createElement(Da.ZP,{query:Ec,variables:{fileId:e.fileId},renderLoading:()=>d.createElement(kl.b,null)},(t=>(0,ka.CZ)(t.folderItem)?null:d.createElement(PresentationalRelevantItemsSection,{relevantItems:t.folderItem.legacyRelevantItemsJson,relevantItemsGraphQL:t.folderItem.relevantItems,relevantConvertedFromItemsGraphQL:t.folderItem.relevantConvertedFromItems,itemId:e.fileId})))}g.mM.create({disabledRefresh:{pointerEvents:"none"}})
const fc=xa.Ps`
  query AnalysisWithRelevantItemsQuery($analysisId: StrictString!)
  @skipAudit
  @engComponent(name: ANALYSIS_TOOL) {
    analysis(id: $analysisId) {
      ... on AnalysisNode {
        id
        legacyRelevantItemsJson
        relevantItems {
          ...RelevantItemsGraphQL
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${gc}
`
function AnalysisRelevantItemsSection(e){return d.createElement(Da.ZP,{query:fc,variables:{analysisId:e.analysisId},renderLoading:()=>d.createElement(kl.b,null),renderCachedDataWhenRefetching:!0,fetchPolicy:"no-cache"},(e=>(0,ka.CZ)(e.analysis)?null:d.createElement(PresentationalRelevantItemsSection,{relevantItems:e.analysis.legacyRelevantItemsJson,relevantItemsGraphQL:e.analysis.relevantItems,itemId:e.analysis.id,isCompact:!0,paginationLimit:5})))}function AnalysisMetadataModal(e){const t=(0,Ql.Z)(e.analysis.name),[n,a]=(0,d.useState)(e.analysis.project.id),i=t.value,s=i&&null==i.match(/^\s*$/),r=e.analysis.permissions.writable
return d.createElement(et.ZP,{title:"Analysis metadata",buttons:[{style:C.ZJ.SECONDARY,submit:!0,text:r?"Save":"Done",disabled:!s}],onRequestClose:e.onRequestClose,onRequestSubmit:function handleSubmit(){r&&(0,jl.vP)(e.analysis,{name:t.value,projectId:n})
e.onRequestSubmit()},expandHeight:!0},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Jl.Z,{label:"Analysis name",disabled:!r,autoFocus:!0,...t,dataTestAttrs:{component:"AnalysisMetadataModal",element:"TextField"}}))),d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Project"}),d.createElement(Xl.Z,{selectedProjectId:n,readOnly:!r,enableRedesign:!0,onProjectSelected:a})))),n!==e.analysis.project.id&&d.createElement(d.Fragment,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(ec.Z,{projectId:n}))),d.createElement("br",null)),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Creator"}),d.createElement("p",null,e.analysis.creator.name))),d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Last modified"}),d.createElement("p",null,(0,Mt.kC)(useFuzzyDate(e.analysis.modifiedAt)))))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Created at"}),d.createElement("p",null,(0,Hr.UT)(e.analysis.createdAt))))),d.createElement("hr",null),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Relevant items"}),d.createElement(AnalysisRelevantItemsSection,{analysisId:e.analysis.id})))))}var Sc=n(996447),yc=n(382857),bc=n(108696),Tc=n(805937),vc=n(211495),Cc=n(413714),Ic=n(883026),wc=n(26431)
function ToggleAnalysisSidebarButton({sidebarIsOpen:e,toggleSidebar:t}){return d.createElement(P.ZP,{title:e?"Close sidebar":"Open sidebar"},d.createElement(C.Co,{buttonStyle:C.ZJ.CIRCLE_ICON,className:(0,g.iv)(Nc.button),icon:"hamburger",onClick:()=>{t()},size:C.qE.MEDIUM}))}const Nc=g.mM.create({button:{fontSize:16,color:Vt.TG}}),Ac={analysis:Yl.aq}
function ArchivedBanner({onUnarchive:e,archivePurpose:t,itemType:n}){return d.createElement(io.ZP,{bannerType:io.ct.WARNING,icon:"box-archive",action:null!=e?{actionType:io.J7.CUSTOM,actionText:"Unarchive",actionOnClick:e}:void 0,text:`This ${n} is marked as archived (${t}).`,supportingInfo:null!=e?Ac[n]:void 0,dataTestAttrs:{component:"ArchivedBanner",element:"root"}})}function AnalysisUIHeader({analysis:e,showOpenSidebarButton:t,onOpenSidebar:n}){const a=(0,wc.Z)([{icon:"audit-trail",contents:d.createElement("span",null,Tc.QU),onSelect:()=>{(0,bc.dV)([e.id])}},e.permissions.archivable?{icon:"archive",isDisabled:isAnalysisRunning(e),tooltipTitle:isAnalysisRunning(e)?"Cannot archive analysis while it is running":void 0,contents:d.createElement("span",null,"Archive analysis"),onSelect:()=>{(0,Xn.Z)(Sc.ZP,{items:[e],onArchive:(t,n)=>{(0,Ic.jI)((0,jl.Ug)(e.id,n))}})}}:null])
return d.createElement("div",{...(0,ee.Z)({component:"AnalysisUIHeader",element:"root"})},(0,yc.ZP)(e)&&d.createElement("div",{className:(0,g.iv)(Rc.archiveBanner)},d.createElement(ArchivedBanner,{archivePurpose:e.archiveRecord.purpose,itemType:"analysis",onUnarchive:e.permissions.unarchivable?async()=>{await(0,Ic.jI)((0,jl.C7)(e.id))}:void 0})),d.createElement("div",{className:(0,g.iv)(Rc.contentWrapper)},d.createElement("div",{className:(0,g.iv)(Rc.leftContentWrapper)},t&&d.createElement("div",{className:(0,g.iv)(Rc.expandSidebarWrapper)},d.createElement(ToggleAnalysisSidebarButton,{sidebarIsOpen:!1,toggleSidebar:n})),d.createElement(so.R6,{className:(0,g.iv)(Rc.analysisName)},e.name)),d.createElement("div",{className:(0,g.iv)(Rc.rightContentWrapper)},!(e.permissions.writable||e.permissions.unarchivable||e.permissions.archivable)&&d.createElement(P.ZP,{title:"For edit access please contact the project owner.",placement:P.TQ.BOTTOM},d.createElement("span",{className:(0,g.iv)(Rc.readOnly)},"Read-only")),d.createElement(AnalysisMetadataButton,{buttonSize:C.qE.MINI,tooltipPlacement:P.TQ.LEFT,analysis:e}),d.createElement(Cc.Z,{buttonProps:{size:C.qE.MINI,buttonStyle:C.ZJ.TERTIARY_GRAY},enableTooltip:!0,menuProps:{dropLeft:!0},options:a,tooltipPlacement:P.TQ.LEFT}))),dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES&&d.createElement(io.ZP,{bannerType:io.ct.INFO,text:"Charting and filtering is in Beta.",supportingInfo:"Help us improve by sharing your thoughts.",action:{actionText:"Give feedback",actionType:io.J7.CUSTOM,actionOnClick:()=>{(0,m.L9)(vc.Sy.CLICKED_GIVE_FEEDBACK)
window.open("https://forms.gle/ywunGoq8SHHjJvDB6")}}}))}function AnalysisMetadataButton(e){return d.createElement(P.ZP,{title:"View metadata",placement:e.tooltipPlacement},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"info-circle",size:e.buttonSize,onClick:function handleClick(){(0,Xn.Z)(AnalysisMetadataModal,{analysis:e.analysis})},className:"u-mini-spacing-left",dataTestAttrs:{component:"AnalysisMetadataButton",element:"root"}}))}const Rc=g.mM.create({contentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},leftContentWrapper:{display:"flex",alignItems:"center"},rightContentWrapper:{display:"flex",alignItems:"center",paddingLeft:6},expandSidebarWrapper:{marginRight:12},analysisName:{marginTop:3},archiveBanner:{marginBottom:15},readOnly:{..._n.sE,color:Vt.TG}}),Pc=(0,xl.ZP)(!0)
var Oc=n(201069)
const xc=[Sn.zs.THIRD_PARTY]
const _c=[Sn.zs.CONNECTION_DATA_DATASET,Sn.zs.INITIALIZE_DATASET,Sn.zs.NOTEBOOK_TABLE_DATASET,Sn.zs.REGISTRY_SCHEMA_DATASET]
function isSidebarDatasetInitializationStepType(e){return _c.includes(e)}function getInitializeDatasetSteps(e){return e.execution.steps.filter((e=>isSidebarDatasetInitializationStepType(e.definition.stepType)))}var Dc=n(631999)
function getChildSteps(e,t){return t.definition.children.map((({step:{id:t}})=>(0,Dc.ZP)(e,t)))}function stepDatasContainDataFrame(e,t){return e.some((({dataFrames:e})=>e.some((({id:e})=>e===t))))}function getChildStepsForDataFrame(e,t,n){return stepDatasContainDataFrame(t.outputStepDatas,n)?getChildSteps(e,t).filter((e=>stepDatasContainDataFrame(e.inputStepDatas,n))):[]}function getParentSteps(e,t){return t.definition.parents.map((({step:{id:t}})=>(0,Dc.ZP)(e,t)))}const Lc=[Sn.zs.DATASET_VIEW,Sn.zs.SAVE_TO_RESULTS,Sn.zs.THIRD_PARTY],kc=[Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION,Sn.zs.PARAMETER_OPTIMIZATION_MODELING,Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION],Mc=1e3
function isStepSupportedByRedesign({definition:{stepType:e}}){return!kc.includes(e)}function getSupportedChildSteps(e,{step:t,dataFrame:n}){const a=null==n?getChildSteps(e,t):getChildStepsForDataFrame(e,t,n.id),i=a.filter((e=>isStepSupportedByRedesign(e)));(0,S.Gp)(i.length===a.length,"Encountered unsupported step type",{childSteps:a.map((({id:e,definition:{stepType:t}})=>({id:e,stepType:t})))})
return i}function isTerminalStep(e,{step:t,dataFrame:n}){const a=getSupportedChildSteps(e,{step:t,dataFrame:n})
return 1!==a.length||Lc.includes(a[0].definition.stepType)}function getChildLineageForDataset(e,t){let n=t
const a=[n]
let i=0
for(;null!=n;){i++;(0,S.hu)(i<Mc,"Loop exceeded 1000 iterations, possibly looping infinitely.")
if(isTerminalStep(e,n))break
{const t=getSupportedChildSteps(e,n),i=t[0].outputStepDatas.filter((({kind:e})=>e===Sn.AT.DATASET));(0,S.hu)(i.length<=1,"This function only supports steps with one DATASET output step data");(0,S.hu)(0===i.length||i[0].dataFrames.length<=1,"This function only supports non-isMulti step datas")
n={step:t[0],...1===i.length&&1===i[0].dataFrames.length?{dataFrame:i[0].dataFrames[0]}:{}}
a.push(n)}}return a}function getAncestorLineageForDataset(e,t){let n=t
const a=[n]
let i=0
for(;null!=n&&!Lc.includes(n.step.definition.stepType)&&n.step.definition.parents.length>0;){i++;(0,S.hu)(i<Mc,"Loop exceeded 1000 iterations, possibly looping infinitely.")
const t=getParentSteps(e,n.step);(0,S.Gp)(t.length<=1,"Expected at most 1 parent")
if(0===t.length)break
const s=n.step.inputStepDatas.filter((({kind:e})=>e===Sn.AT.DATASET));(0,S.hu)(1===s.length,"This function only supports steps with one DATASET input step data");(0,S.hu)(s[0].dataFrames.length<=1,"This function only supports non-isMulti step datas")
n={step:t[0],...1===s[0].dataFrames.length?{dataFrame:s[0].dataFrames[0]}:{}}
a.unshift(n)}return a}function getLineageWithDataset(e,t){return[...getAncestorLineageForDataset(e,t),...getChildLineageForDataset(e,t).slice(1)]}function getDatasetViewsLineages(e,t){return getChildSteps(e,t[t.length-1].step).filter((({definition:{stepType:e}})=>e===Sn.zs.DATASET_VIEW)).map((t=>getChildLineageForDataset(e,{step:t})))}function getOutputFilesFromStep(e,t){const n=e.outputStepDatas.filter((e=>e.kind===Sn.AT.FILE&&(null==t||e.name===t))).flatMap((e=>e.files.filter((e=>!(0,ka.CZ)(e)))))
return(0,ka.nA)(n)}var Fc
!function(e){e.CHOOSE_DATASET_CREATION_METHOD="CHOOSE_DATASET_CREATION_METHOD"
e.CONNECTION_DATA_DATASET_CONFIGURATION="CONNECTION_DATA_DATASET_CONFIGURATION"
e.EMPTY_ANALYSIS="EMPTY_ANALYSIS"
e.EDIT_VISUALIZATION="EDIT_VISUALIZATION"
e.DATA_FRAME="DATA_FRAME"
e.FAILED="FAILED"
e.FILE="FILE"
e.FILE_DASHBOARD="FILE_DASHBOARD"
e.INITIALIZE_PARAMETER_OPTIMIZATION="INITIALIZE_PARAMETER_OPTIMIZATION"
e.INSIGHTS_BLOCK_DATASET_CONFIGURATION="INSIGHTS_BLOCK_DATASET_CONFIGURATION"
e.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION_DASHBOARD="PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION_DASHBOARD"
e.PARAMETER_OPTIMIZATION_MODELING_DASHBOARD="PARAMETER_OPTIMIZATION_MODELING_DASHBOARD"
e.PARAMETER_OPTIMIZATION_MODELING_OVERVIEW="PARAMETER_OPTIMIZATION_MODELING_OVERVIEW"
e.PARAMETER_OPTIMIZATION_PREDICTION="PARAMETER_OPTIMIZATION_PREDICTION"
e.REGISTRY_SCHEMA_DATASET_CONFIGURATION="REGISTRY_SCHEMA_DATASET_CONFIGURATION"
e.RUNNING="RUNNING"
e.SAVE_TO_RESULTS_CONFIGURATION="SAVE_TO_RESULTS_CONFIGURATION"
e.SAVE_TO_RESULTS_OUTPUT="SAVE_TO_RESULTS_OUTPUT"
e.SAVE_TO_RESULTS_RECONFIGURATION="SAVE_TO_RESULTS_RECONFIGURATION"
e.THIRD_PARTY_STEP="THIRD_PARTY_STEP"
e.VIEW_PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION="VIEW_PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION"
e.VISUALIZATION="VISUALIZATION"
e.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW="DATASET_VIEW_VISUALIZATION_CONFIGURATION"}(Fc||(Fc={}))
const Zc=[Fc.CHOOSE_DATASET_CREATION_METHOD,Fc.CONNECTION_DATA_DATASET_CONFIGURATION,Fc.INSIGHTS_BLOCK_DATASET_CONFIGURATION,Fc.REGISTRY_SCHEMA_DATASET_CONFIGURATION,Fc.SAVE_TO_RESULTS_CONFIGURATION],Bc=[Fc.EDIT_VISUALIZATION,Fc.VIEW_PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION,Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW,Fc.SAVE_TO_RESULTS_RECONFIGURATION],qc={[Sn.zs.VISUALIZATION]:Fc.EDIT_VISUALIZATION,[Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION]:Fc.VIEW_PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION,[Sn.zs.SAVE_TO_RESULTS]:Fc.SAVE_TO_RESULTS_RECONFIGURATION},Vc=[Fc.DATA_FRAME,Fc.VISUALIZATION,Fc.EDIT_VISUALIZATION,Fc.FILE,Fc.FILE_DASHBOARD,Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW,Fc.INITIALIZE_PARAMETER_OPTIMIZATION,Fc.PARAMETER_OPTIMIZATION_MODELING_DASHBOARD,Fc.FAILED,Fc.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION_DASHBOARD,Fc.PARAMETER_OPTIMIZATION_MODELING_OVERVIEW,Fc.PARAMETER_OPTIMIZATION_PREDICTION,Fc.RUNNING,Fc.SAVE_TO_RESULTS_OUTPUT,Fc.SAVE_TO_RESULTS_RECONFIGURATION,Fc.THIRD_PARTY_STEP,Fc.VIEW_PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION]
function isStepInitializationAnalysisItem(e){return Zc.includes(e.type)}function isViewStepConfigAnalysisItem(e){return Bc.includes(e.type)}function isStepAwareAnalysisItem(e){return Vc.includes(e.type)}const Uc="Input dataset",Gc="Output dataset"
var zc,$c,Wc,Hc
!function(e){e.DATASET="Dataset"}(zc||(zc={}))
!function(e){e.DATASET="Dataset"}($c||($c={}))
!function(e){e.INPUT_DATASET="Input dataset"
e.SAVED_RESULTS="Saved results"
e.ROWS_WITH_ERRORS="Rows with errors"}(Wc||(Wc={}))
!function(e){e.INPUT_DATASET="Input dataset"
e.OUTPUT_DATASETS="Output datasets"
e.OUTPUT_FILES="Output files"}(Hc||(Hc={}))
var jc=n(335609)
const Yc={icon:"request-failed",text:"Error"},Qc=[Sn.zs.SAVE_TO_RESULTS,Sn.zs.DATASET_VIEW,Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION,Sn.zs.PARAMETER_OPTIMIZATION_MODELING,Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION],Kc={[Sn.zs.SAVE_TO_RESULTS]:e=>({...Yc,mainViewItem:{type:Fc.SAVE_TO_RESULTS_OUTPUT,stepId:e.id}}),[Sn.zs.THIRD_PARTY]:e=>({...Yc,mainViewItem:{type:Fc.THIRD_PARTY_STEP,stepId:e.id}})}
function getFailedStepSidebarItemData(e){const t=Kc[e.definition.stepType]
return void 0!==t?t(e):{...Yc,mainViewItem:{type:Fc.FAILED,stepId:e.id}}}function getNonOutputSidebarItemDatasForStep(e){if(e.statusCode===Sn.wF.READY||e.statusCode===Sn.wF.RUNNING)return[{icon:"request-in-progress",text:"Awaiting analysis completion",mainViewItem:{type:Fc.RUNNING,stepId:e.id}}]
if(e.statusCode===Sn.wF.FAILED)return[getFailedStepSidebarItemData(e)]
if(e.definition.stepType===Sn.zs.THIRD_PARTY&&e.statusCode!==Sn.wF.SUCCEEDED){if(e.statusCode===Sn.wF.WAITING)return[{icon:"request-in-progress",text:"Awaiting output",mainViewItem:{type:Fc.THIRD_PARTY_STEP,stepId:e.id}}];(0,S.Gp)(!1,"Unexpected status for THIRD_PARTY_STEP",(0,jc.Z)(e,"statusCode","definition"))
return[]}if(e.definition.stepType===Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION)switch(e.statusCode){case Sn.wF.WAITING:return[{icon:"settings",text:"Configure parameter optimization",mainViewItem:{type:Fc.INITIALIZE_PARAMETER_OPTIMIZATION,stepId:e.id}}]
case Sn.wF.SUCCEEDED:return[{icon:"analytics_dashboard",text:"Data summary",mainViewItem:{type:Fc.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION_DASHBOARD,stepId:e.id}}]
default:(0,S.Gp)(!1,"Unexpected status for PARAMETER_OPTIMIZATION_MODELING",(0,jc.Z)(e,"statusCode","definition"))
return[]}else if(e.definition.stepType===Sn.zs.PARAMETER_OPTIMIZATION_MODELING)switch(e.statusCode){case Sn.wF.BLOCKED:return[]
case Sn.wF.SUCCEEDED:return[{icon:"document",text:"Overview",mainViewItem:{type:Fc.PARAMETER_OPTIMIZATION_MODELING_OVERVIEW,stepId:e.id}},{icon:"analytics_dashboard",text:"Analysis results",mainViewItem:{type:Fc.PARAMETER_OPTIMIZATION_MODELING_DASHBOARD,stepId:e.id}}]
default:(0,S.Gp)(!1,"Unexpected status for PARAMETER_OPTIMIZATION_MODELING",(0,jc.Z)(e,"statusCode","definition"))
return[]}else if(e.definition.stepType===Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION)switch(e.statusCode){case Sn.wF.BLOCKED:return[]
case Sn.wF.SUCCEEDED:return[{icon:"crystal-ball",text:"Predictions",mainViewItem:{type:Fc.PARAMETER_OPTIMIZATION_PREDICTION,stepId:e.id}}]
default:(0,S.Gp)(!1,"Unexpected status for PARAMETER_OPTIMIZATION_PREDICTION",(0,jc.Z)(e,"statusCode","definition"))
return[]}else{if(e.definition.stepType===Sn.zs.SAVE_TO_RESULTS){if(e.statusCode===Sn.wF.SUCCEEDED)return[{icon:"table",text:e.outputStepDatas.find((e=>e.name===Wc.SAVED_RESULTS)).dataFrames[0].name,mainViewItem:{type:Fc.SAVE_TO_RESULTS_OUTPUT,stepId:e.id}}];(0,S.Gp)(!1,"Unexpected status for SAVE_TO_RESULTS",(0,jc.Z)(e,"statusCode","definition"))
return[]}if(e.definition.stepType===Sn.zs.VISUALIZATION)switch(e.statusCode){case Sn.wF.BLOCKED:case Sn.wF.SUCCEEDED:return[{mainViewItem:{type:Fc.VISUALIZATION,stepId:e.id},text:e.inputStepDatas.find((e=>e.kind===Sn.AT.DATASET)).dataFrames[0].name,icon:st.DATA_FRAME}]
default:(0,S.Gp)(!1,"Unexpected status for VISUALIZATION",(0,jc.Z)(e,"statusCode","definition"))
return[]}else if(e.definition.stepType===Sn.zs.DATASET_VIEW){if(e.statusCode===Sn.wF.SUCCEEDED)return[{mainViewItem:{type:Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW,stepId:e.id},text:"Unfinished view...",icon:st.DATA_FRAME}];(0,S.Gp)(!1,"Unexpected status for DATASET_VIEW",(0,jc.Z)(e,"statusCode","definition"))}}return[]}function getStepOutputSidebarItemDatas(e){if(e.statusCode!==Sn.wF.SUCCEEDED)return[]
if(Qc.some((t=>t===e.definition.stepType)))return[]
const t=e.outputStepDatas.filter((e=>e.kind===Sn.AT.DATASET)).flatMap((t=>t.dataFrames.map((t=>({mainViewItem:{type:Fc.DATA_FRAME,dataFrameId:t.id,stepId:e.id},text:t.name,icon:st.DATA_FRAME})))))
e.outputStepDatas.some((e=>e.kind===Sn.AT.FILE))&&t.push({mainViewItem:{type:Fc.FILE_DASHBOARD,stepId:e.id},text:"Files",icon:st.FILE})
return t}function getStepSidebarItemDatas(e){return[...getNonOutputSidebarItemDatasForStep(e),...getStepOutputSidebarItemDatas(e)]}function getDefaultMainViewItemForStep(e){const t=getStepSidebarItemDatas(e),n=e.statusCode!==Sn.wF.BLOCKED
if(0===t.length){n&&Fe.ZK("Unexpectedly found a step with 0 sidebar items",{extra:{numOutputFiles:getOutputFilesFromStep(e).length,stepId:e.id,stepStatusCode:e.statusCode,stepType:e.definition.stepType}})
return{type:Fc.EMPTY_ANALYSIS}}return t[0].mainViewItem}function findAndAssertSingleStepDataFrameId(e,t,n=!1){const a=function findAndAssertStepDataFrameIds(e,t,n){const a=n?e.inputStepDatas.find((({name:e})=>e===t)):e.outputStepDatas.find((({name:e})=>e===t));(0,S.hu)(null!=a,"Expected step to have step data with name",{isLookingForInputStepData:n,step:e,stepDataName:t});(0,S.hu)(a.dataFrames.length>=1,"Expected step data to have at least one data frame",{isLookingForInputStepData:n,step:e,stepDataName:t})
return a.dataFrames.map((({id:e})=>e))}(e,t,n);(0,S.Gp)(1===a.length,"Expected step data to only have one data frame",{step:e,stepDataName:t,isLookingForInputStepData:n})
return a[0]}var Jc=n(58647)
const Xc="Updating filter"
function getAncestorFilterStep(e,t){const n=getAncestorLineageForDataset(e,{step:t}).filter((e=>e.step.definition.stepType===Sn.zs.FILTER_DATASET));(0,S.hu)(n.length<2,"Expected at most one filter step for a single input dataset")
return 1===n.length?n[0].step:null}function filterMatchesColumn(e,t){return e.filters.every((e=>e.columnSystemName===t))}function stepHasBlockingDependentSteps(e,t,n){if(!dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES&&(n?getChildStepsForDataFrame(e,t,n):getChildSteps(e,t)).length>0)return!0
return function descendantIsBlocking(t,n){const a=n?getChildStepsForDataFrame(e,t,n):getChildSteps(e,t)
if(a.some((e=>function childIsBlocking(e){return!![Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION,Sn.zs.THIRD_PARTY].includes(e.definition.stepType)||e.definition.stepType===Sn.zs.SAVE_TO_RESULTS&&e.outputStepDatas.filter((e=>e.name===Wc.SAVED_RESULTS)).flatMap((e=>e.dataFrames)).length>0&&e.statusCode!==Sn.wF.FAILED}(e))))return!0
a.forEach((e=>descendantIsBlocking(e)))
return!1}(t,n)}function getReadOnlyInfo(e,t,n,a){return e.permissions.writable||e.permissions.unarchivable?(0,yc.ZP)(e)?{isReadOnly:!1,isDisabled:!0,disabledMessage:Yl.V$}:stepHasBlockingDependentSteps(e,t,a)?{isReadOnly:!1,isDisabled:!0,disabledMessage:Yl.A3}:{isReadOnly:!1,isDisabled:!1}:{isReadOnly:!0,isDisabled:!1}}function getDataFrameFilterOptions(e,t,n,a,i){var s
const r=getAncestorFilterStep(e,t),o=null!==(s=function getAllFilters(e){var t,n,a
const i=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.variables.find((e=>"filter"===e.name))
return null!==(a=null===(n=null==i?void 0:i.value)||void 0===n?void 0:n.filters)&&void 0!==a?a:null}(r))&&void 0!==s?s:[]
return{filters:o,failed:(null==r?void 0:r.statusCode)===Sn.wF.FAILED,getFilterForColumn:e=>{var t
return null!==(t=o.find((t=>filterMatchesColumn(t,e))))&&void 0!==t?t:null},setFilterForColumn:async(t,s)=>{(0,S.hu)(null==s||filterMatchesColumn(s,t),"Filter does not match column.")
const l=function getUpdatedAllFilters(e,t,n){const a=e.filter((e=>!filterMatchesColumn(e,t)))
return n?[...a,n]:a}(o,t,s)
r?await(0,Ic.jI)(async function updateFilterStep(e,t,n){await(0,jl.W8)(e.id,{stepId:t.id,stepConfig:{filter:{operation:Jc.Yu.AND,filters:n}}})}(e,r,l),Xc):await(0,Ic.jI)(async function addFilterStep(e,t,n,a,i){await(0,jl._2)(e.id,{stepType:Sn.zs.FILTER_DATASET,stepVersion:0,stepConfig:{filter:{operation:Jc.Yu.AND,filters:t}},stepInputParents:{[Uc]:[n]},...null==a?{}:{stepInput:{inputDataFrameId:a}},...null==i?{}:{stepOutputChildren:{[Gc]:i}}})}(e,l,n,a,i),Xc)},readOnlyInfo:getReadOnlyInfo(e,t,0,a)}}var ed=n(386091),td=n(592482),nd=n(14331),ad=n(176667)
function isValueValid(e,t,n){if(!t.required&&null==e)return!0
switch(t.kind){case"string":return"string"==typeof e&&(null!=t.value&&e===t.value||null==t.value)
case"number":return"number"==typeof e
case"integer":return"number"==typeof e&&(!(null!=t.minValue&&e<t.minValue)&&(!(null!=t.maxValue&&e>t.maxValue)&&Number.isInteger(e)))
case"boolean":return"boolean"==typeof e
case"columnReference":if("string"!=typeof e)return!1
try{const a=(0,nd.ZP)(n,e)
t.validationOptions&&(0,ad.ZP)(a.type,t.validationOptions)}catch(e){if(e.message===nd.tV)return!1
if(e instanceof td.Z)return!1
throw e}return!0
case"array":return!!Array.isArray(e)&&(!(null!=t.minItems&&e.length<t.minItems)&&(!(null!=t.maxItems&&e.length>t.maxItems)&&e.every((e=>isValueValid(e,t.elementSpec,n)))))
case"enum":return t.choices.some((t=>t===e))
case"taggedUnion":{if("object"!=typeof e||null==e||Array.isArray(e))return!1
const a=e[t.tagKey]
if(null==a)return!1
const i=t.choices.find((e=>{const n=e.fields[t.tagKey]
return null!=n&&"string"===n.kind&&n.value===a}))
return null!=i&&isValueValid(e,i,n)}case"shape":return"object"==typeof e&&null!=e&&!Array.isArray(e)&&Object.entries(t.fields).every((([t,a])=>isValueValid(e[t],a,n)))
case"anything":return!0
default:(0,S.hu)(!1,`Unexpected jsonSpec ${(0,Go.vE)(t)}`)}}function getPipelineStepConfig(e,t,n){(0,S.hu)(e.definition.stepType===t&&e.definition.stepVersion===n,"Unexpected step type and version");(0,S.hu)(null!=e.config,"Expected non-null step config.")
return(0,Jt.m8)(e.config.variables.map((e=>[e.name,e.value])))}function getIconAndTextForVisualizationStep(e){const t=getPipelineStepConfig(e,Sn.zs.VISUALIZATION,0)
return{icon:ed.A3[t.visualizationConfig.type],text:t.visualizationName}}function getInheritedDatasetFilterOptions(e,t){(0,S.hu)(t.definition.stepType===Sn.zs.DATASET_VIEW,`Unexpected step type ${t.definition.stepType}`)
const n=getParentSteps(e,t);(0,S.hu)(1===n.length,"Expected dataset view step to have one parent")
const a=n[0].outputStepDatas.filter((e=>e.kind===Sn.AT.DATASET));(0,S.hu)(1===a.length,"Expected parent step to have one dataset output")
const i=findAndAssertSingleStepDataFrameId(t,Uc,!0),s=n[0],r=a[0]
return getDataFrameFilterOptions(e,s,{stepId:s.id,stepDataName:r.name},i)}const sd={icon:"exclamation-circle",text:"Error"},rd="spinner-third",od={icon:rd,text:"Awaiting analysis completion"}
function getFailedSidebarItemData(e){return{...sd,mainViewItem:{type:Fc.FAILED,stepId:e.id}}}function getRunningSidebarItemData(e){return{...od,mainViewItem:{type:Fc.RUNNING,stepId:e.id}}}function getViewSidebarItemData(e,t){const{step:n}=t[t.length-1],{step:a}=t[0];(0,S.hu)(a.definition.stepType===Sn.zs.DATASET_VIEW,"Expected to have the lineage of a view.")
if([Sn.wF.READY,Sn.wF.RUNNING].includes(n.statusCode))return getRunningSidebarItemData(n)
if(n.statusCode===Sn.wF.FAILED){const e=t.findLast((({step:e})=>e.statusCode===Sn.wF.SUCCEEDED))
if(null==e)return getFailedSidebarItemData(n)
const a=e.step
return n.definition.stepType===Sn.zs.VISUALIZATION?{mainViewItem:{type:Fc.VISUALIZATION,stepId:n.id},...getIconAndTextForVisualizationStep(n)}:{mainViewItem:{type:Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW,stepId:a.id},text:"Unfinished view...",icon:"analyze"}}if(n.definition.stepType!==Sn.zs.VISUALIZATION){if(a.statusCode===Sn.wF.SUCCEEDED)return{mainViewItem:{type:Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW,stepId:a.id},text:"Unfinished view...",icon:"analyze"}
throw Error("Unexpected status for VISUALIZATION")}switch(n.statusCode){case Sn.wF.BLOCKED:case Sn.wF.SUCCEEDED:return{mainViewItem:{type:Fc.VISUALIZATION,stepId:n.id},...getIconAndTextForVisualizationStep(n)}
default:throw Error("Unexpected status for VISUALIZATION")}}function getDatasetRunningSidebarItemData(e,t){const n=t.findLast((({step:{statusCode:e}})=>e===Sn.wF.SUCCEEDED))
if(null==n)return getRunningSidebarItemData(e)
if(null!=n.dataFrame)return{...od,mainViewItem:{type:Fc.DATA_FRAME,dataFrameId:n.dataFrame.id,stepId:e.id}}
throw Error("Unexpectedly got a FAILED step with no output data frames")}function getDatasetSidebarItemData(e,t){const{step:n,dataFrame:a}=t[t.length-1]
if(getAncestorLineageForDataset(e,{step:n,dataFrame:a})[0].step.definition.stepType===Sn.zs.DATASET_VIEW)return getViewSidebarItemData(0,t)
switch(n.statusCode){case Sn.wF.BLOCKED:{const a=t.findLastIndex((({step:{statusCode:e}})=>e!==Sn.wF.BLOCKED))
if(-1===a||t[a].step.statusCode===Sn.wF.SUCCEEDED)return getDatasetRunningSidebarItemData(n,t)
{const i=getDatasetSidebarItemData(e,t.slice(0,a+1))
return{...i,mainViewItem:isStepAwareAnalysisItem(i.mainViewItem)?{...i.mainViewItem,stepId:n.id}:i.mainViewItem}}}case Sn.wF.FAILED:{const e=t.findLast((({step:{statusCode:e}})=>e===Sn.wF.SUCCEEDED))
if(null==e)return getFailedSidebarItemData(n)
if(null!=e.dataFrame)return{...sd,mainViewItem:{type:Fc.DATA_FRAME,dataFrameId:e.dataFrame.id,stepId:n.id},text:e.dataFrame.name}
throw Error("Unexpectedly got a FAILED step with no output data frames")}case Sn.wF.READY:case Sn.wF.RUNNING:return getDatasetRunningSidebarItemData(n,t)
case Sn.wF.SUCCEEDED:{const e=n.outputStepDatas.filter((e=>e.kind===Sn.AT.DATASET));(0,S.hu)(1===e.length,"Data frame's step does not have exactly one output step data")
if(null!=a)return{mainViewItem:{type:Fc.DATA_FRAME,dataFrameId:a.id,stepId:n.id},text:a.name,icon:st.DATA_FRAME,actionButtonOptions:{stepDataReference:{stepDataName:e[0].name,stepId:n.id},dataFrameId:a.id}}
throw Error(`Unexpectedly got a SUCCEEDED step with no output data frames: ${n.id}`)}case Sn.wF.WAITING:throw Error("Unexpectedly got a WAITING step in view-centric UI")
default:throw Error(`Unsupported status code - ${(0,Go.vE)(n.statusCode)}`)}}function getDatasetSectionSidebarItemDatas(e){const t=function getTopLevelDatasetLineages(e){const t=e.execution.steps.filter((e=>e.definition.stepType===Sn.zs.THIRD_PARTY))
return[...getInitializeDatasetSteps(e).map((t=>{const n=t.outputStepDatas.filter((({kind:e})=>e===Sn.AT.DATASET));(0,S.hu)(1===n.length,"Expected exactly one dataset output step data");(0,S.hu)(n[0].dataFrames.length<=1,"Expected only non-isMulti step datas")
return 0===n[0].dataFrames.length?getChildLineageForDataset(e,{step:t}):getChildLineageForDataset(e,{step:t,dataFrame:n[0].dataFrames[0]})})),...t.flatMap((t=>{const n=t.outputStepDatas.some((({dataFrames:e})=>e.length>0))?t.outputStepDatas.flatMap((({dataFrames:n})=>n.map((n=>getChildLineageForDataset(e,{step:t,dataFrame:n}))))):[]
return 0===n.length||t.statusCode===Sn.wF.SUCCEEDED?n:[n[0]]}))]}(e)
return t.map((t=>({...getDatasetSidebarItemData(e,t),childSidebarItems:getDatasetViewsLineages(e,t).filter((e=>{var n
return(null===(n=t[t.length-1].dataFrame)||void 0===n?void 0:n.id)===e[0].step.inputStepDatas.find((e=>e.kind===Sn.AT.DATASET)).dataFrames[0].id})).map((e=>getViewSidebarItemData(0,e)))})))}function getFilesSectionSidebarItemDatas(e){return e.execution.steps.filter((e=>e.definition.stepType===Sn.zs.THIRD_PARTY)).flatMap((e=>function getFileStepSidebarItemDatas(e){return e.outputStepDatas.filter((e=>e.kind===Sn.AT.FILE)).flatMap((t=>t.files.filter((e=>(0,ka.CZ)(e)||!(0,yc.ZP)(e))).map((t=>(0,ka.CZ)(t)?{mainViewItem:{type:Fc.FILE,fileId:t.invalidId,stepId:e.id},text:"(Inaccessible file)",tooltipText:"You do not have access to this file",icon:st.FILE,disabled:!0}:{mainViewItem:{type:Fc.FILE,fileId:t.id,stepId:e.id},text:t.filename,icon:st.FILE}))))}(e)))}function getSaveToResultsSidebarItemData(e){if([Sn.wF.READY,Sn.wF.RUNNING].includes(e.statusCode))return getRunningSidebarItemData(e)
if(e.statusCode===Sn.wF.FAILED)return getFailedSidebarItemData(e)
if(e.statusCode===Sn.wF.SUCCEEDED)return{icon:"table",text:e.outputStepDatas.find((e=>e.name===Wc.SAVED_RESULTS)).dataFrames[0].name,mainViewItem:{type:Fc.SAVE_TO_RESULTS_OUTPUT,stepId:e.id}};(0,S.hu)(!1,`Unexpected status code for save to results step ${e.statusCode}`)}function getSaveToResultsSidebarItemDatas(e){return e.execution.steps.filter((e=>e.definition.stepType===Sn.zs.SAVE_TO_RESULTS)).map((e=>getSaveToResultsSidebarItemData(e)))}function isViewStepConfigSelectedItemValidForStep(e,t){return!!isViewStepConfigAnalysisItem(e)&&(qc[t.definition.stepType]===e.type&&null!=t.config)}function legacyGetValidSelectedItem(e,t){const n=(0,Oc.d)(),a=null!=n.stepId&&(0,Dc.wL)(t,n.stepId),i=!(null!=e&&a&&isStepAwareAnalysisItem(e)&&e.stepId===n.stepId)&&a?getDefaultMainViewItemForStep((0,Dc.ZP)(t,n.stepId)):e
if(null==i)return function getDefaultSelectedItem(e){if(0===e.execution.steps.length)return{type:Fc.EMPTY_ANALYSIS}
{const t=e.execution.steps.map((e=>getDefaultMainViewItemForStep(e))).filter((e=>e.type!==Fc.EMPTY_ANALYSIS))
if(0===t.length){Fe.ZK("Unexpectedly found analysis with no Steps having SidebarItems",{extra:{analysis:e}})
return{type:Fc.EMPTY_ANALYSIS}}return t[t.length-1]}}(t)
if(isStepAwareAnalysisItem(i)){const e=(0,Dc.ZP)(t,i.stepId)
if(!function isSelectedItemValidForStep(e,t){return null!=getStepSidebarItemDatas(t).find((({mainViewItem:t})=>Is()(t,e)))||isViewStepConfigSelectedItemValidForStep(e,t)}(i,e))return getDefaultMainViewItemForStep(e)}return i}function getDefaultItemForAnalysis(e){const t=function getAnalysisSidebarItemDatas(e){return[...getDatasetSectionSidebarItemDatas(e),...getFilesSectionSidebarItemDatas(e),...getSaveToResultsSidebarItemDatas(e)]}(e)
return t.length>0?t[0].mainViewItem:{type:Fc.EMPTY_ANALYSIS}}function getValidSelectedItem(e,t){if(!dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES)return legacyGetValidSelectedItem(e,t)
if(null==e)return getDefaultItemForAnalysis(t)
if(isStepAwareAnalysisItem(e)){const n=(0,Dc.LH)(t,e.stepId),a=e.type===Fc.DATA_FRAME?e.dataFrameId:void 0
return null==n?getDefaultItemForAnalysis(t):(0,S.Gp)(isStepSupportedByRedesign(n),"Unexpectedly selected a step that's not supported by the view-centric UI.")?isViewStepConfigSelectedItemValidForStep(e,n)||e.type===Fc.FILE?e:n.definition.stepType===Sn.zs.SAVE_TO_RESULTS?getSaveToResultsSidebarItemData(n).mainViewItem:function getValidSelectedItemForDatasetStep(e,t,n,a){let i
const s=n.outputStepDatas.filter((({kind:e})=>e===Sn.AT.DATASET));(0,S.Gp)(s.length<=1,"Expected at most 1 output dataset step")
if(s.length>=1){if(null!=t&&t.type===Fc.DATA_FRAME&&[Sn.wF.RUNNING,Sn.wF.READY,Sn.wF.BLOCKED].includes(n.statusCode))return t
if(1===s[0].dataFrames.length)i=s[0].dataFrames[0]
else if(s[0].dataFrames.length>1){(0,S.Gp)(n.definition.stepType===Sn.zs.THIRD_PARTY,"Expected only THIRD_PARTY steps to have multiple output data frames")
const e=s[0].dataFrames.filter((e=>e.id===a))
1===e.length?i=e[0]:n.statusCode===Sn.wF.SUCCEEDED&&(0,S.Gp)(!1,"Expected to find exactly one output data frame for a DATA_FRAME view")}}return{...t,...getDatasetSidebarItemData(e,getLineageWithDataset(e,{step:n,dataFrame:i})).mainViewItem}}(t,e,n,a):getDefaultItemForAnalysis(t)}return e}function getItemQueryParameters(e){return null!=e&&isStepAwareAnalysisItem(e)?{stepId:e.stepId}:{stepId:null}}const ld=(0,xl.ZP)(null)
function useSelectedAnalysisItem(e,t){const[n,a]=ld.useGlobalClientState(e),i=getValidSelectedItem(n,t);(0,d.useEffect)((()=>{Is()(n,i)||a(i)}),[n,i,a]);(0,d.useEffect)((()=>{const e=(0,Oc.d)()
!dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES&&function shouldUpdateUrlQueryParamsForSelectedStep(e,t){return isStepAwareAnalysisItem(t)&&t.stepId!==e||!isStepAwareAnalysisItem(t)&&null!=e}(e.stepId,i)&&(0,ac.ZP)((0,de.Dv)(t.url,getItemQueryParameters(i)),{skipTrigger:!0,replace:!0})}),[t,i])
return{selectedItem:i,onChangeSelectedItem:e=>{dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES||(0,ac.ZP)((0,de.Dv)(t.url,getItemQueryParameters(e)),{skipTrigger:!1,replace:!0})
a(e)}}}var cd=n(429921),dd=n(447417)
const ud=12
function DataFrameTableList(e){const t=function calculateTableCardMaxHeight(e){return`calc(${e>0?Math.max(100/e,40):100}% - 12px)`}(e.dataFrames.length)
return d.createElement("div",{className:f()((0,g.iv)(md.stack),"scrollbar-override")},e.dataFrames.map(((n,a)=>d.createElement("div",{className:(0,g.iv)(md.tableCard),key:a,style:{maxHeight:t}},d.createElement("div",{className:(0,g.iv)(md.table)},d.createElement(dd.Z,{actionOrigin:e.actionOrigin,allowRowSelection:e.allowRowSelection,clientStateId:`${e.clientStateId}-${a}`,dataFrame:n,defaultTableMode:e.defaultTableMode,renderIsExcludedColumn:e.renderIsExcludedColumn}))))))}const md=g.mM.create({stack:{display:"flex",flexDirection:"column",height:"100%",overflow:"auto",paddingBottom:6,paddingTop:6},table:{height:"100%"},tableCard:{borderRadius:4,marginBottom:6,marginLeft:ud,marginRight:ud,marginTop:6}})
var pd=n(59326)
function LoadingOverlay({children:e,message:t,isFaded:n=!1,isLoading:a=!0}){return a?d.createElement("div",{className:(0,g.iv)(hd.container)},d.createElement("div",{className:(0,g.iv)(hd.childrenWrapper,n&&hd.fadedChildren)},e),d.createElement("div",{className:(0,g.iv)(n&&hd.interactionBlockingOverlay)},d.createElement("div",{className:(0,g.iv)(hd.floatingOverlay,null==t?hd.noMessageFloatingOverlay:hd.withMessageFloatingOverlay)},d.createElement(kl.b,{suppressPadding:!0}),null!=t&&d.createElement("span",{className:(0,g.iv)(hd.message)},t)))):d.createElement(d.Fragment,null,e)}const hd=g.mM.create({container:{height:"100%",width:"100%",position:"relative"},childrenWrapper:{height:"100%",width:"100%"},fadedChildren:{opacity:.4},floatingOverlay:{background:Vt.Cj,boxShadow:`1px 3px 6px ${Vt.tN}`,display:"flex",flexDirection:"column",left:"50%",marginLeft:-82,padding:20,position:"absolute",top:"50%",width:164},noMessageFloatingOverlay:{height:55,marginTop:-27.5},withMessageFloatingOverlay:{height:84,marginTop:-42},interactionBlockingOverlay:{height:"100%",left:"0",position:"absolute",top:"0",width:"100%"},message:{..._n.H5,paddingTop:10,textAlign:"center"}})
function NoPreviewPlaceholder({title:e,subtitle:t}){return d.createElement("div",{className:(0,g.iv)(Ed.noPreviewPlaceholderWrapper)},d.createElement("img",{alt:"preview-placeholder",className:(0,g.iv)(Ed.noPreviewPlaceholderImage),width:55,src:(0,me.Z)("/static/img/analyses/configuration_view_placeholder.svg")}),d.createElement("p",{className:(0,g.iv)(Ed.noPreviewPlaceholderTitle)},e),d.createElement("p",{className:(0,g.iv)(Ed.noPreviewPlaceholderSubtitle)},t))}function StepConfigurationViewTemplate(e){var t
const n=null!=e.dataFrames&&e.dataFrames.length>0,a=n||null!=e.renderAdditionalPreviewContent?d.createElement(d.Fragment,null,n&&d.createElement(DataFrameTableList,{actionOrigin:cd.Z.ANALYSIS_TOOL,allowRowSelection:!1,clientStateId:e.clientStateId,dataFrames:e.dataFrames,defaultTableMode:e.defaultDataFrameTableMode,renderIsExcludedColumn:!1}),e.renderAdditionalPreviewContent&&e.renderAdditionalPreviewContent()):e.noPreviewPlaceholderOptions&&d.createElement(NoPreviewPlaceholder,{title:e.noPreviewPlaceholderOptions.title,subtitle:e.noPreviewPlaceholderOptions.subtitle})
return d.createElement("div",{className:(0,g.iv)(fd.view)},d.createElement("div",{className:(0,g.iv)(fd.leftPane)},e.toolbar&&d.createElement("div",{className:(0,g.iv)(fd.toolbarWrapper)},e.toolbar),d.createElement("div",{className:f()((0,g.iv)(fd.steps),"scrollbar-override")},d.createElement("div",{className:(0,g.iv)(fd.title)},e.title),e.isFinalizing?d.createElement("div",{className:(0,g.iv)(fd.leftPaneThrobberWrapper)},d.createElement(kl.b,null),null!=e.finalizingLoadingMessage&&d.createElement("span",{className:(0,g.iv)(fd.leftPaneThrobberMessage)},e.finalizingLoadingMessage)):e.children),d.createElement("div",{className:(0,g.iv)(fd.leftPaneFooter)},e.onCancel&&d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:(0,g.iv)(fd.confirmationButton),disabled:e.isFinalizing,onClick:()=>{e.onCancel()},size:C.qE.MEDIUM,text:"Cancel"}),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:(0,g.iv)(fd.confirmationButton),disabled:e.disableFinalizeButton||e.isFinalizing,onClick:()=>{e.onFinalize()},size:C.qE.MEDIUM,text:e.finalizeButtonText,dataTestAttrs:{component:"StepConfigurationView",element:"finalizeButton"}}))),d.createElement("div",{className:(0,g.iv)(fd.rightPane)},e.messages.length>0&&d.createElement("div",{className:(0,g.iv)(fd.bannerStack)},d.createElement(pd.Z,{messages:e.messages})),d.createElement(LoadingOverlay,{isFaded:!0,isLoading:null!==(t=e.isLoadingPreview)&&void 0!==t&&t},a)))}const gd=15,Ed=g.mM.create({noPreviewPlaceholderImage:{marginBottom:20},noPreviewPlaceholderSubtitle:{..._n.cf,color:Vt.pp,textAlign:"center"},noPreviewPlaceholderTitle:{..._n.VM,color:Vt.pp,textAlign:"center"},noPreviewPlaceholderWrapper:{height:"100%",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:5}}),fd=g.mM.create({bannerStack:{margin:"10px 10px 0 10px"},confirmationButton:{marginLeft:10},leftPane:{display:"flex",flexDirection:"column",height:"100%",width:"50%",padding:12,paddingLeft:gd,paddingRight:gd},leftPaneThrobberWrapper:{display:"flex",alignItems:"center",flexDirection:"column"},leftPaneThrobberMessage:{..._n.H5,textAlign:"center"},leftPaneFooter:{alignSelf:"flex-end",borderTop:`1px solid ${Vt.tN}`,display:"flex",justifyContent:"flex-end",marginTop:"auto",paddingTop:gd,paddingBottom:gd,width:"100%"},rightPane:{background:Vt.bs,display:"flex",flexDirection:"column",width:"50%"},steps:{display:"block",overflowY:"auto",paddingRight:12},title:{..._n.nX,paddingBottom:gd},toolbarWrapper:{paddingBottom:gd},view:{backgroundColor:Vt.Cj,display:"flex",flexDirection:"row",height:"100%",width:"100%"}})
var Sd
!function(e){e.CONNECTION_DATA="CONNECTION_DATA"
e.INSIGHTS_BLOCK="INSIGHTS_BLOCK"
e.REGISTRY_SCHEMA="REGISTRY_SCHEMA"}(Sd||(Sd={}))
const yd={[Sd.CONNECTION_DATA]:{icon:st.CONNECTION,initializationViewItem:{type:Fc.CONNECTION_DATA_DATASET_CONFIGURATION},text:"From connection",analyticsEventName:"connection_data",isEnabled:()=>(0,ln.Oj)({feature:on.d$.LAB_AUTOMATION_DISCOVER})&&dt.ZP.ENABLE_ANALYSIS_TOOL_CONNECTION_DATASET_CREATION,dataTestAttrs:{component:"DataFrameCreationMethod",element:"connectionData"}},[Sd.INSIGHTS_BLOCK]:{icon:"analytics_dashboard",initializationViewItem:{type:Fc.INSIGHTS_BLOCK_DATASET_CONFIGURATION},text:"From dashboard query",analyticsEventName:"insights_block",isEnabled:()=>(0,ln.cr)({feature:on.sZ.INSIGHTS_DISCOVER})&&dt.ZP.ENABLE_ANALYSIS_TOOL_INSIGHTS_DATASET_CREATION,dataTestAttrs:{component:"DataFrameCreationMethod",element:"insightsBlock"}},[Sd.REGISTRY_SCHEMA]:{icon:"registry",initializationViewItem:{type:Fc.REGISTRY_SCHEMA_DATASET_CONFIGURATION},text:"From Registry schema",analyticsEventName:"registry_schema",isEnabled:()=>(0,ln.cr)({feature:on.ed.REGISTRY_DISCOVER}),dataTestAttrs:{component:"DataFrameCreationMethod",element:"registrySchema"}}},bd=[Sd.INSIGHTS_BLOCK,Sd.REGISTRY_SCHEMA,Sd.CONNECTION_DATA],Td="No table preview available yet",vd={finalizeButtonText:"Add table"}
var Cd=n(782353)
function convertRESTToIdentifiedWarehouseParameters(e,t){return e.map((e=>({config:(0,jc.Z)(e,"id","type","systemName","isMulti"),valueJson:e.id?(0,Cd.uz)(t,e.id):null})))}function getEnabledDatasetCreationMethods(){return bd.filter((e=>yd[e].isEnabled()))}function getAddDataFrameAnalysisViewItem(){const e=getEnabledDatasetCreationMethods();(0,S.hu)(e.length>0,"Expected at least 1 data frame creation method to be enabled")
return e.length>1?{type:Fc.CHOOSE_DATASET_CREATION_METHOD}:yd[e[0]].initializationViewItem}function trackSelectedDataFrameCreationMethodEvent(e,t,n,a){(0,m.L9)(j.Sy.SELECTED_DATA_FRAME_CREATION_METHOD,{action_method:j.LY.BUTTON_CLICK,action_origin:e,pipeline_id:t,num_options_available:n,option:yd[a].analyticsEventName})}function DataFrameCreationMethodButton({dataFrameCreationMethod:e,onClick:t}){const{icon:n,text:a,dataTestAttrs:i}=yd[e]
return d.createElement("div",{className:(0,g.iv)(Id.methodButton),onClick:t,...(0,ee.Z)(i)},d.createElement("div",{className:(0,g.iv)(Id.iconWrapper)},d.createElement(pe.Z,{className:(0,g.iv)(Id.icon),icon:n})),d.createElement("div",{className:(0,g.iv)(Id.methodText)},a))}const Id=g.mM.create({grid:{display:"grid",gap:12,gridTemplateColumns:"\n      repeat(\n        auto-fit,\n        minmax(260px, 1fr)\n      )"},methodButton:{display:"flex",alignItems:"center",borderRadius:4,padding:6,cursor:"pointer",border:`1px solid ${Vt.tN}`,background:"white",":hover":{background:Vt.bs}},iconWrapper:{flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",width:26,height:26,borderRadius:4,background:Vt.tN},icon:{fill:Vt.pp},methodText:{..._n.cf,marginLeft:8}})
var wd=n(565281)
function ChooseDifferentDataFrameCreationMethodButton({onOpenStepInitializationView:e}){return d.createElement("div",{className:(0,g.iv)(Nd.wrapper),onClick:()=>{e({type:Fc.CHOOSE_DATASET_CREATION_METHOD})}},d.createElement(pe.Z,{icon:"arrow-left",className:(0,g.iv)(Nd.icon)}),"Choose different creation method")}const Nd=g.mM.create({wrapper:{..._n.cf,color:Vt.t0,cursor:"pointer",alignItems:"center",display:"flex"},icon:{marginRight:4}})
var Ad=n(673743),Rd=n(310913),Pd=n(359936)
function DataFrameNameField(e){return d.createElement(d.Fragment,null,d.createElement(Jl.Z,{className:(0,g.iv)(Od.textField),hasError:e.hasUserEdits&&""===e.name,label:"Table name",labelStyle:Mo.WS.HIDDEN,onChange:t=>{e.onNameChange(t.target.value)},placeholder:"Table name",value:e.name,disabled:e.disabled}),e.hasUserEdits&&""===e.name&&d.createElement(Dt.Z,{message:"Please enter a name",compact:!0}))}const Od=g.mM.create({textField:{position:"relative"}})
function InstrumentDataSelector(e){const[t,n]=(0,d.useState)([]),{value:a}=e,i=new Set(a?[t.findIndex((({id:e})=>e===a.id))]:[])
return d.createElement(Rd.ZP,{instrumentData:t,allowMultiple:!1,setInstrumentData:n,selectedRowIndices:i,onSelectRow:n=>{e.onChange(t[n])},columns:["File name","Status","Data type","Modified at"],filterOptions:[],initialFilterValues:{[Kn.Vm.CONNECTION]:[e.connectionId]}})}function ConnectionDataStepperForm(e){return d.createElement(Pd.ZP,null,d.createElement(Pd.qO,{title:"Select connection"},d.createElement(Ad.kW,{autoFocus:!1,onChange:t=>{t.length&&e.onChangeConnection(t[0])},connectionIds:null!=e.connectionId?[e.connectionId]:[],shouldAllowMultiple:!1})),d.createElement(Pd.qO,{title:"Choose file"},null!=e.connectionId&&d.createElement(InstrumentDataSelector,{connectionId:e.connectionId,value:e.instrumentData,onChange:e.onChangeInstrumentData})),d.createElement(Pd.qO,{title:"Name table"},d.createElement(DataFrameNameField,{...e.dataFrameNameFieldProps})))}const xd={name:"",hasUserEdits:!1},_d=(0,xl.ZP)(null),Dd=(0,xl.ZP)(null),Ld=(0,xl.ZP)(xd),kd=(0,xl.ZP)(!1)
const Md=g.mM.create({previewContainer:{overflowX:"scroll"}})
var Fd=n(536105),Zd=n.n(Fd),Bd=n(402604)
const qd=(0,xl.ZP)({status:Wr.Lr.NOT_FETCHED})
var Vd=n(909428)
function restGetQueryParameterConfigs(e,t){const n=(0,Vd.Z)([e])
return t.filter((e=>n.includes(e.config.systemName)))}var Ud=n(701086)
function convertRESTToWarehouseParameters(e,t){return e.map((e=>({config:(0,jc.Z)(e,"isMulti","systemName","type"),valueJson:e.id?(0,Cd.uz)(t,e.id):null})))}function restGetRunQueryData({parameterConfigs:e,parameterValues:t,sqlQuery:n}){return{parameterizedSQLQuery:n,parameters:restGetQueryParameterConfigs(n,convertRESTToWarehouseParameters(e,t))}}function getRunQueryData({parameterConfigs:e,parameterValues:t,sqlQuery:n}){return restGetRunQueryData({parameterConfigs:(0,zo.NA)("AnalyticsParameterConfig",e),parameterValues:t.map((e=>(0,Ud.L)(e))),sqlQuery:n})}var Gd=n(759783)
function withPromisePool(e,t){(0,S.hu)(t>0,"Cannot pool promise functions with poolsize = 0")
const n=[],a=new Set
function processNextPromise(){if(a.size<t&&n.length>0){const e=n.shift()()
a.add(e)
e.finally((()=>{a.delete(e)
processNextPromise()}))}}return(...t)=>new Promise(((a,i)=>{n.push((()=>e(...t).then(a,i)))
processNextPromise()}))}const zd=withPromisePool((function _runUntrustedSQLQuery(e){!function checkRunQueryParameterNames({parameterizedSQLQuery:e,parameters:t}){const n=(0,Vd.Z)([e]),a=t.map((e=>e.config.systemName));(0,S.Gp)(n.every((e=>a.includes(e))),"Expected parameter names in sqlQuery to be a subset of parameterNamesInConfigs (BNCH-12266)",{parameterNamesInConfigs:a,parameterNamesInSQLQuery:n})}(e)
return an.s0({url:"/1/api/insights:run-untrusted-sql-query",data:e})}),dt.ZP.INSIGHTS_MAX_CONCURRENT_QUERIES_PER_BROWSER_TAB)
function AnalyticsWarehouseActions_exportUntrustedSQLQueryOutputToCSV(e){(0,Gd.Z)((async()=>{const{url:t,warnings:n}=await function exportUntrustedSQLQueryOutputToCSV(e){return an.s0({url:"/1/api/insights:export-untrusted-sql-query-output-to-csv",data:e})}(e),a={url:t}
if(n.length){a.notificationOptions={duration:0}
a.message=`${n.join("  \n")}  \nDownloading...`}return a}))}var $d=n(908415),Wd=n(573133),Hd=n(264867),jd=n(700765),Yd=n(289419)
function resolveRows(e,t){return e.rows.map((n=>function resolveRow(e,t,n,a){return(0,Jt.m8)(t.map((({systemName:t})=>[t,(0,Yd.Z)(e[t],n,a)])))}(n,e.columns,e.hydratedProperties,t)))}function updateColumnDefinitions(e,t,n){return e.map((e=>function updateColumnDefinition(e,t,n){if(e.type.leafType===Hd.i0.JSON)return e
if(!n.some(((n,a)=>n[e.systemName]!==t[a][e.systemName])))return e
const a=n.every((t=>null==t[e.systemName]||"string"==typeof t[e.systemName]))
return{...e,type:{leafType:a?Hd.i0.TEXT:Hd.i0.JSON,isNullable:e.type.isNullable}}}(e,t,n)))}function resolveDataFrame(e,t){const n=resolveRows(e,t),a=updateColumnDefinitions(e.columns,e.rows,n)
return{...e,columns:a,rows:n}}const Qd={[Hd.i0.JSON]:Wd.g.JSON,[Hd.i0.BLOB]:Wd.g.JSON,[Hd.i0.BOOLEAN]:Wd.g.BOOLEAN,[Hd.i0.DECIMAL]:Wd.g.NUMBER,[Hd.i0.INTEGER]:Wd.g.NUMBER,[Hd.i0.DATE]:Wd.g.DATE_OR_TIMESTAMP,[Hd.i0.DATETIME]:Wd.g.DATE_OR_TIMESTAMP}
function convertDataFrameToDeprecatedDataFrame(e){const t=resolveDataFrame(e,{apiIdentifiedObjects:Yd.p.NONE,blobs:Yd.p.WAREHOUSE_BLOB_DICT})
return{axisTypes:(0,Jt.m8)(t.columns.map((({systemName:e,type:t})=>{return[e,(n=t,n.isList?Wd.g.JSON:Qd.hasOwnProperty(n.leafType)?n.maybeText?Wd.g.JSON:Qd[n.leafType]:Wd.g.STRING)]
var n}))),points:t.rows.map((e=>function convertRow(e,t){return(0,Jt.m8)(e.map((({systemName:e,type:n})=>{return[e,(a=t[e],i=n,i.leafType===Hd.i0.DECIMAL?(0,jd.dx)(a).value:a)]
var a,i})))}(t.columns,e)))}}function convertDataFrameToRunQueryOutput(e,t=!0){const n=convertDataFrameToDeprecatedDataFrame(e),a=e.columns.filter((e=>t||!(0,$d.Z)(e)))
return{headers:a.map((e=>e.displayName)),rows:n.points.map((e=>a.map((t=>e[t.systemName]))))}}function convertRunQueryOutputToLegacyOutput(e){return{...e,...convertDataFrameToRunQueryOutput(e.dataFrame,!1)}}function convertRunQueryStateToLegacyState(e){switch(e.status){case Wr.Lr.SUCCESS:return{...e,data:convertRunQueryOutputToLegacyOutput(e.data)}
case Wr.Lr.LOADING:return{...e,...null==e.previousData?{previousData:null}:{previousData:convertRunQueryOutputToLegacyOutput(e.previousData)}}
default:return e}}var Kd,Jd
!function(e){e.BLOCK_EDITOR="BLOCK_EDITOR"
e.DASHBOARD_EDITOR="DASHBOARD_EDITOR"}(Kd||(Kd={}))
!function(e){e.SQL_EDITOR="SQL_EDITOR"
e.VISUALIZATION_EDITOR="VISUALIZATION_EDITOR"
e.WAREHOUSE_BROWSER="WAREHOUSE_BROWSER"}(Jd||(Jd={}))
const Xd={maybeValidExpandedAnalyticsQuery:null,screenStateMode:Kd.DASHBOARD_EDITOR},eu=(0,xl.ZP)(Xd)
function isBlockEditorScreenState(e){return e.screenStateMode===Kd.BLOCK_EDITOR}function isDashboardEditorScreenState(e){return e.screenStateMode===Kd.DASHBOARD_EDITOR}function getValidExpandedAnalyticsQueryId(e,t){var n
const a=null===(n=t.maybeValidExpandedAnalyticsQuery)||void 0===n?void 0:n.id
return null!=a&&e.analyticsQueries.some((e=>e.id===a))?a:null}function getVisibleAnalyticsQueryIds(e,t){const n=e.layoutRows.flatMap((e=>e.analyticsQueries.map((e=>e.id))))
switch(t.screenStateMode){case Kd.DASHBOARD_EDITOR:{const a=getValidExpandedAnalyticsQueryId(e,t)
return null!=a?[a]:n}case Kd.BLOCK_EDITOR:return[t.analyticsQuery.id]
default:(0,S.Gp)(!1,`Unexpected screen state: ${(0,Go.vE)(t)}.`)
return n}}const tu=["_pkey","_sync_key"]
function columnNameToDisplayName(e){if(tu.includes(e))return null
e.endsWith("$")&&(e=e.slice(0,-1))
return(0,Mt.lv)(e)}function sqlColumnTypeToIcon(e){switch(e){case Sn.Fw.CHARACTER_VARYING:return"text"
case Sn.Fw.BOOLEAN:return"boolean"
case Sn.Fw.DOUBLE:case Sn.Fw.INTEGER:case Sn.Fw.NUMERIC:return"number"
case Sn.Fw.DATE:return"calendar"
case Sn.Fw.TIMESTAMP:return"protocol-timer"
case Sn.Fw.JSON:case Sn.Fw.JSONB:return"brackets"
default:(0,S.Gp)(!1,`Invalid column type ${(0,Go.vE)(e)}`)
return"notdef"}}var nu=n(131675),au=n(18694)
function getDefaultAvailableColumnForColumnData(e){return{...nu.kC,columnData:e,alias:columnNameToDisplayName(e.name)}}function getColumnDisplayName(e){var t
return null!==(t=e.alias)&&void 0!==t?t:e.columnData.name}function getColumnIcon(e){return e.typeInfo.type===au.qb.BIOENTITY&&null!=e.typeInfo.linkedSchema?e.typeInfo.linkedSchema.iconId:sqlColumnTypeToIcon(e.columnData.type)}function getColumnTypeInfo(e){var t,n
function columnIsBioentityId(e){return"id"===e.name&&e.table.coreTableType===Sn.yH.ENTITY}if(!nu.Et.includes(e.type))return nu.Vl
let a
a=columnIsBioentityId(e)?e.table:null===(t=e.relationships.find((e=>columnIsBioentityId(e.target))))||void 0===t?void 0:t.target.table
return null!=a?{type:au.qb.BIOENTITY,linkedSchema:"TagSchemaNode"===(null===(n=a.schema)||void 0===n?void 0:n.__typename)?a.schema:null}:nu.Vl}function validateFormValues(e,t,n){const a=e.map((e=>{let a=null
n.forEach((n=>{e.includes(n)&&(a=`${t} cannot include ${n}`)}))
return a})).filter((e=>null!=e))
return a.length>0?a[0]:null}const iu=["id","name","url"]
function isBlob(e){if(null==e)return!1
if(null==e||!(0,Jt.OL)(new Set(Object.keys(e)),new Set(iu)))return!1
const t=e
return iu.every((e=>"string"==typeof t[e]))}function pickBlobProps(e){return{...(0,he.Z)(e,...iu),previewFile:null}}function cellToBlobs(e){return null==e?null:function isBlobArray(e){return Array.isArray(e)&&e.every((e=>isBlob(e)))}(e)?e.map((e=>pickBlobProps(e))):isBlob(e)?[pickBlobProps(e)]:null}var su,ru=n(104801)
function cellToItemIds(e,t){return"string"==typeof e&&t(e)?[e]:function isStringArray(e){return Array.isArray(e)&&e.every((e=>"string"==typeof e))}(e)&&e.every((e=>t(e)))?e:null}!function(e){e.BATCH="BATCH"
e.BIOENTITY="BIOENTITY"
e.ENTRY="ENTRY"
e.PROCESS="PROCESS"
e.PROCESS_OUTPUT="PROCESS_OUTPUT"
e.PROCESS_TASK="PROCESS_TASK"
e.REQUEST="REQUEST"
e.STORABLE="STORABLE"}(su||(su={}))
const ou={[su.BATCH]:e=>ea.ZP.isBatch(e),[su.BIOENTITY]:e=>ea.ZP.isBiologicalEntity(e),[su.ENTRY]:e=>ea.ZP.isEntry(e),[su.PROCESS]:e=>ea.ZP.isProcess(e),[su.PROCESS_OUTPUT]:e=>ea.ZP.isProcessOutput(e),[su.PROCESS_TASK]:e=>ea.ZP.isProcessTask(e),[su.REQUEST]:e=>ea.ZP.isRequest(e),[su.STORABLE]:e=>ea.ZP.isStorable(e)},lu=/^[a-z]+_[a-zA-Z0-9]+$/
function isChipItemId(e){return Boolean(e.match(lu))&&Object.values(ou).some((t=>t(e)))}function cellToChipItemIds(e){return cellToItemIds(e,isChipItemId)}function runQueryOutputToChipRange(e){const t=new Set
for(const[n,a]of e.rows.entries())for(const e of a){const a=cellToChipItemIds(e)
if(null!=a){for(const e of a)t.add(e)
if(t.size>dt.ZP.INSIGHTS_MAX_CHIP_NAMES_TO_RESOLVE)return{chipRangeEnd:n,overLimit:!0}}}return{chipRangeEnd:e.rows.length,overLimit:!1}}function getWarningMessageForChipItems(e){const{overLimit:t}=runQueryOutputToChipRange(e)
return t?`Chip names will only be used for the first ${(0,ru.Z)("INSIGHTS_MAX_CHIP_NAMES_TO_RESOLVE")} values in charts, column sorting, and copying as TSV.`:null}var cu=n(184408)
function getVisualizationType(e){return ed.kI[e.parameters.__typename]}function convertGQLToRESTOutlierConfig(e){const{__typename:t,...n}=e
return{...n,version:1}}function convertGQLToRESTAnalyticsVisualization(e){const{__typename:t,parameters:n,...a}=e,{__typename:i,...s}=n
return{...a,type:getVisualizationType(e),parameters:{...s,...(0,cu.Wo)(n,cu.nB.SCATTER_PLOT)&&{outlierConfig:null==n.outlierConfig?null:{...convertGQLToRESTOutlierConfig(n.outlierConfig)}}}}}const du=/^parameter(\d+)?$/
function isDefaultSystemName(e){return null!=e.match(du)}const uu="SELECT * FROM registry_entity ORDER BY created_at DESC LIMIT 10",mu='SELECT 1 AS " " WHERE FALSE',pu=1e3,hu=["assay_result_schema","assay_run_schema","author","batch","batch_schema","box","box_schema","container","container_content","container_schema","container_transfer","entity_schema","entry","entry_auditor","field","field_definition","folder","location","location_schema","plate","plate_schema","project","registry_entity","request_assignee","request_fulfillment","request_sample","request_schema","schema","stage_run","team","team_member","user","workflow","workflow_template","workflow_template_version"].join("|")
function containsRaw(e){return e.includes("$raw")}function getAllChips(e){return e.rows.flatMap((e=>e.flatMap((e=>{var t
return null!==(t=cellToChipItemIds(e))&&void 0!==t?t:[]}))))}function countAllChips(e){return getAllChips(e).length}function countUniqueChips(e){return new Set(getAllChips(e)).size}function getAllBlobs(e){return e.rows.flatMap((e=>e.flatMap((e=>{var t
return null!==(t=cellToBlobs(e))&&void 0!==t?t:[]}))))}function countAllBlobs(e){return getAllBlobs(e).length}function countUniqueBlobs(e){return new Set(getAllBlobs(e).map((e=>e.id))).size}const gu=[Wr.Lr.SUCCESS,Wr.Lr.ERROR]
function trackRunQuery(e,t,n,a){if(!gu.includes(t.status))return
const i=null!=a?a:e.sqlQuery,s=(0,Vd.Z)([i]),r=n.alreadyFetched?j.JG.RAN_QUERY:j.JG.LOADED_QUERY;(0,m.KK)(r,{block_id:e.id,contains_keywords:(l=i,Boolean(l.match(hu))),contains_raw:containsRaw(i),data_size_bytes:t.status===Wr.Lr.SUCCESS?(o=t.data.rows,new Blob([JSON.stringify(o)]).size):null,has_error:t.status===Wr.Lr.ERROR,is_default:i===uu||i===mu,num_blobs:t.status===Wr.Lr.SUCCESS?countAllBlobs(t.data):null,num_chips:t.status===Wr.Lr.SUCCESS?countAllChips(t.data):null,num_columns:t.status===Wr.Lr.SUCCESS?t.data.headers.length:null,num_rows:t.status===Wr.Lr.SUCCESS?t.data.rows.length:null,num_non_default_parameters:s.filter((e=>!isDefaultSystemName(e))).length,num_parameters:s.length,num_unique_blobs:t.status===Wr.Lr.SUCCESS?countUniqueBlobs(t.data):null,num_unique_chips:t.status===Wr.Lr.SUCCESS?countUniqueChips(t.data):null,query_created_at:e.createdAt,query_creator_api_id:e.creator.id,query_modified_at:e.modifiedAt,sql_template_form_type:n.sqlTemplateFormType,total_num_rows:t.status===Wr.Lr.SUCCESS?t.data.total:null,visualization_configuration:convertGQLToRESTAnalyticsVisualization(e.visualization).parameters,visualization_id:e.visualization.id,visualization_type:getVisualizationType(e.visualization)})
var o,l}function getExtraDataToTrackRunQuery(e,t){const n=eu.getState(e),a=isBlockEditorScreenState(n)?n.analyticsQuery:null,i=a?function getAnalyticsQuerySQLTemplateState(e){var t,n
return null!==(n=null===(t=(0,Vn.getStore)().getState().ui.insights.blockEditorUIs[e.id])||void 0===t?void 0:t.sqlTemplateFormState)&&void 0!==n?n:null}(a):null
return{alreadyFetched:t,sqlTemplateFormType:i?i.formType:null}}function runWarehouseQuery(e,t,n){t.status!==Wr.Lr.LOADING?(0,Wr.cC)({makeCall:zd,args:[e],asyncState:t,setAsyncState:n}):(0,S.Gp)(!1,"Unexpectedly ran query while one is still running. Check the trace to find where the user can rerun the query in parallel and disallow it.")}function runAnalyticsQuery(e,t,n,a,i){(0,S.hu)((0,Bd.y$)(t),"Expected to use runAnalyticsQuery with an analyticsQueryViewState's id")
runWarehouseQuery(n,a,(a=>{qd.updateState(t,a)
trackRunQuery(e,convertRunQueryStateToLegacyState(a),i)
a.status===Wr.Lr.ERROR&&400===a.responseJSON.status&&function logErrorIfFromTemplateForm(e,t,n){null!=n.sqlTemplateFormType&&(0,S.Gp)(!1,"Generated query that caused an error using sql templating",{errorMessage:t,query:e.parameterizedSQLQuery})}(n,a.message,i)}))}function runGraphQLAnalyticsQuery(e,t,n,a,i,s){runAnalyticsQuery(e,t,getRunQueryData({parameterConfigs:n,parameterValues:a,sqlQuery:e.sqlQuery}),i,s)}function runSubQuery(e,t,n,a,i,s,r){runWarehouseQuery(restGetRunQueryData({parameterConfigs:a,parameterValues:i,sqlQuery:t}),n,(n=>{s(n)
trackRunQuery(e,convertRunQueryStateToLegacyState(n),r,t)}))}function exportAnalyticsQueryOutputToCSV(e,t,n,{dashboardName:a,exportType:i}){const s=function getExportQueryData({parameterConfigs:e,parameterValues:t,sqlQuery:n,...a}){return{...restGetRunQueryData({parameterConfigs:(0,zo.NA)("AnalyticsParameterConfig",e),parameterValues:t.map((e=>(0,Ud.L)(e))),sqlQuery:n}),...a}}({exportType:i,filename:`${(0,Hr.nI)(Zd()())} ${a} - ${e.name}`.replace(/\//g,"-"),parameterConfigs:t,parameterValues:n,sqlQuery:e.sqlQuery})
AnalyticsWarehouseActions_exportUntrustedSQLQueryOutputToCSV(s)}var Eu=n(464070),fu=n(345035)
function areParameterValuesValid(e,t){const n=(0,Jt.m8)(e.map((e=>[e.id,(0,Eu.Z)(e)])))
return t.every((e=>fu.N[n[e.config.id]](e.valueJson)))}function getParameterValueObject(e,t){return{config:(0,jc.Z)(e,"__typename","id"),__typename:"AnalyticsParameterValueNode",valueJson:t}}var Su=n(195941),yu=n(455412)
const bu=xa.Ps`
  query BlockInDashboardSelectorQuery($parentDashboardId: StrictString!)
  @skipAudit
  @engComponent(name: INSIGHTS) {
    analyticsDashboard(id: $parentDashboardId) {
      ... on AnalyticsDashboardNode {
        id
        layoutRows {
          analyticsQueries {
            id
            name
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }

  ${(0,La.f)("InaccessibleInfo").fragment}
`
function findAnalyticsQueryName(e,t){var n,a
return null!==(a=null===(n=e.find((e=>e.id===t)))||void 0===n?void 0:n.name)&&void 0!==a?a:"Unknown block"}function BlockInDashboardSelector(e){const t=(0,Da.IJ)(bu,{variables:{parentDashboardId:e.parentDashboardId}})
if(t.type===Da.NI.ERROR){v.ZP.error("Unable to load dashboard. Please try again.")
return null}if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
const n=t.data.analyticsDashboard
if((0,ka.CZ)(n))return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"You do not have access to this dashboard."})
const a=function getAnalyticsQueriesInLayoutOrder(e){return e.layoutRows.flatMap((e=>e.analyticsQueries))}(n)
return d.createElement($r.ZP,{menu:d.createElement(Ar.Z,{onSelect:e.onSelect,optionDatas:a.length>0?a.map((e=>({name:e.name,value:e.id}))):[{name:"Dashboard has no blocks",disabled:!0,value:"__NO_BLOCKS__"}],selectedValue:e.selectedAnalyticsQueryId,width:w.ZP.WIDTHS.FULL}),displayName:null!=e.selectedAnalyticsQueryId?findAnalyticsQueryName(a,e.selectedAnalyticsQueryId):"Select block...",dataTestAttrs:{component:"BlockInDashboardSelector",element:"root"}})}function DashboardAndBlockSelectorSkeleton(e){return d.createElement(d.Fragment,null,d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Dashboard"}),e.dashboardSelector),d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Block"}),e.blockSelector))}const Tu=xa.Ps`
  query DashboardAndBlockSelectorFormGroupQuery($analyticsDashboardId: StrictString!)
  @skipAudit
  @engComponent(name: INSIGHTS) {
    analyticsDashboard(id: $analyticsDashboardId) {
      ... on AnalyticsDashboardNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
  }

  ${(0,La.f)("InaccessibleInfo").fragment}
`
function DashboardSelectorAdapter(e){const t={onSelect:t=>{e.onSelect(t.id)}}
switch(e.selectedDashboardQueryResult.type){case Da.NI.PENDING:return d.createElement(kl.b,null)
case Da.NI.SUCCESS:{const n=e.selectedDashboardQueryResult.data.analyticsDashboard
return(0,ka.CZ)(n)?d.createElement(d.Fragment,null,d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"You do not have access to the previously selected dashboard. Please select a new dashboard."})),d.createElement(yu.Z,{selectedAnalyticsDashboard:null,...t})):d.createElement(yu.Z,{selectedAnalyticsDashboard:n,...t})}case Da.NI.ERROR:v.ZP.error("Unable to load the previously selected dashboard. Please try again.")
return null
case Da.NI.SKIPPED:return d.createElement(yu.Z,{selectedAnalyticsDashboard:null,...t})
default:(0,Go.vE)(e.selectedDashboardQueryResult)
return null}}function PlaceholderBlockSelector(){return d.createElement($r.ZP,{menu:d.createElement(w.ZP,null),disabled:!0,displayName:""})}const vu={analyticsDashboardId:null,analyticsQueryId:null}
function DashboardAndBlockSelectorFormGroup(e){const{analyticsDashboardId:t,analyticsQueryId:n}=e.readOnly?vu:e.selectionState,a=(0,Da.A4)(Tu,{skip:null==t,variables:{analyticsDashboardId:t}})
return e.readOnly?d.createElement(DashboardAndBlockSelectorSkeleton,{dashboardSelector:d.createElement($r.ZP,{menu:d.createElement(Ar.Z,{onSelect:Jt.ZT,optionDatas:[],width:w.ZP.WIDTHS.FULL}),displayName:e.dashboardName,disabled:!0}),blockSelector:d.createElement($r.ZP,{menu:d.createElement(Ar.Z,{onSelect:Jt.ZT,optionDatas:[],width:w.ZP.WIDTHS.FULL}),displayName:e.blockName,disabled:!0})}):d.createElement(DashboardAndBlockSelectorSkeleton,{dashboardSelector:d.createElement(DashboardSelectorAdapter,{selectedDashboardId:t,selectedDashboardQueryResult:a,onSelect:t=>{e.onSelect({analyticsDashboardId:t,analyticsQueryId:null})}}),blockSelector:null==t||(i=a,i.type!==Da.NI.SUCCESS||(0,ka.CZ)(i.data.analyticsDashboard))?d.createElement(PlaceholderBlockSelector,null):d.createElement(BlockInDashboardSelector,{parentDashboardId:t,selectedAnalyticsQueryId:n,onSelect:n=>{e.onSelect({analyticsDashboardId:t,analyticsQueryId:n})}})})
var i}var Cu=n(203499),Iu=n(324569),wu=n(591410),Nu=n(603911)
function ParameterValueFieldList({configs:e,selectedValues:t,onSelectValue:n,disabled:a}){const i=(0,Nu.Z)(e)
return d.createElement(d.Fragment,null,i.map(((e,i)=>{var s
const r=(0,wu.Z)(e),{type:o,configSetting:l}=r,c=getParameterValueObject(e,null!==(s=t[e.id])&&void 0!==s?s:null),u=fu.N[o](c.valueJson),m={valueJson:c.valueJson,paramConfigSetting:l,onChange:t=>{n(e.id,t)},allowAutoFocus:0===i,disabled:a}
return d.createElement(Ke.Z,{key:e.id,className:(0,g.iv)(Au.inputWrapper)},d.createElement(Fr.Z,{label:e.systemName}),d.createElement(Iu.ZP,{paramType:o,inputProps:m}),!u&&d.createElement(Cu.Z,{type:o}))})))}const Au=g.mM.create({inputWrapper:{marginBottom:12,":last-child":{marginBottom:0}}})
function makeSharedParameterValueFieldListProps({dashboardAndBlockSelectionState:e,parameterValuesState:t,setParameterValuesState:n=Jt.ZT}){return{key:`${e.analyticsDashboardId}.${e.analyticsQueryId}`,selectedValues:t,onSelectValue:(e,a)=>{n({...t,[e]:a})}}}function CreateDataFrameFromAnalyticsBlockViewSkeleton({stepConfigurationViewTemplateProps:e,dashboardAndBlockSelectorFormGroupProps:t,dataFrameNameFieldProps:n,parameterValueFieldListProps:a}){return d.createElement(StepConfigurationViewTemplate,{...e},d.createElement(Pd.ZP,null,d.createElement(Pd.qO,{title:"Select query"},d.createElement(DashboardAndBlockSelectorFormGroup,{...t})),d.createElement(Pd.qO,{title:"Name table"},d.createElement(DataFrameNameField,{...n})),null!=a&&d.createElement(Pd.qO,{title:"Specify parameters"},d.createElement(ParameterValueFieldList,{...a}))))}function buildPreviewOverRowLimitMessage(e,t){return{bannerType:io.ct.INFO,text:`This is a preview of the first ${e.toLocaleString()} rows.${null!=t?` ${t}`:""}`}}function buildPreviewFailureMessage(e="Reach out to support@benchling.com if the issue persists."){return{bannerType:io.ct.ERROR,text:`A preview table could not be generated. ${e}`}}const Ru=xa.Ps`
  query UseAnalyticsBlockQuery($analyticsDashboardId: StrictString!)
  @skipAudit
  @engComponent(name: ANALYSIS_TOOL) {
    analyticsDashboard(id: $analyticsDashboardId) {
      ... on AnalyticsDashboardNode {
        id
        name
        parameterConfigs {
          ...AnalyticsParameterConfigGraphQL
        }
        analyticsQueries {
          id
          sqlQuery
          name
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("AnalyticsParameterConfig").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function useAnalyticsBlockQuery({analyticsDashboardId:e,analyticsQueryId:t}){const n=(0,Da.A4)(Ru,{variables:{analyticsDashboardId:e},skip:null==e||null==t})
if(!n||n.type!==Da.NI.SUCCESS||(0,ka.CZ)(n.data.analyticsDashboard))return null
const a=n.data.analyticsDashboard.analyticsQueries.find((({id:e})=>e===t))
if(!(0,S.Gp)(null!=a,"Expected query to exist in dashboard",{analyticsQueryId:t,analyticsDashboardId:e}))return null
const i=function getQueryParameterConfigs(e,t){const n=(0,Vd.Z)([e])
return t.filter((e=>n.includes(e.systemName)))}(a.sqlQuery,n.data.analyticsDashboard.parameterConfigs)
return{sqlQuery:a.sqlQuery,name:a.name,parameterConfigs:i}}var Pu=n(906621)
function useAutoUpdatePreview(e,t,n){const a=(0,Pu.Z)(e),i=(0,d.useRef)(e),s=(0,d.useCallback)((e=>{null==e?n({status:Wr.Lr.NOT_FETCHED}):t(e,(t=>{Is()(i.current,e)&&n(t)}))}),[t,n]);(0,d.useEffect)((()=>{if(!Is()(e,a)){i.current=e
s(e)}}),[e,a,s])}const Ou=5e4
function getErrorAndWarningMessages(e){const t=[]
e.status===Wr.Lr.ERROR&&t.push(buildPreviewFailureMessage("Check your parameters' values or the selected block's query."))
if(e.status===Wr.Lr.SUCCESS&&e.data.total>1e3){t.push(buildPreviewOverRowLimitMessage(1e3,`The final table will have ${Math.min(e.data.total,Ou).toLocaleString()} rows.`))
e.status===Wr.Lr.SUCCESS&&e.data.total>Ou&&t.push({bannerType:io.ct.WARNING,text:(n=Ou,a=e.data.total,`There are ${a.toLocaleString()} matching rows. The final table will be limited to ${n.toLocaleString()} rows.`)})}var n,a
return t}const xu={analyticsDashboardId:null,analyticsQueryId:null},_u={name:"",hasUserEdits:!1},Du={},Lu=(0,xl.ZP)(xu),ku=(0,xl.ZP)(_u),Mu=(0,xl.ZP)(Du),Fu=(0,xl.ZP)(Wr.Tp),Zu=(0,xl.ZP)(!1)
var Bu=n(131993),qu=n(639943)
function countSelectedFields(e){return e.map((e=>{if(e.kind===Zl.h.FIELD)return null!=e.selectionSet?countSelectedFields(e.selectionSet.selections):1;(0,S.hu)(e.kind===Zl.h.INLINE_FRAGMENT,`Got unexpected selection kind ${e.kind}`)
return countSelectedFields(e.selectionSet.selections)})).reduce(((e,t)=>e+t),0)}function useThrottle(e,t){const[n,a]=(0,d.useState)(e),i=(0,d.useRef)(Date.now());(0,d.useEffect)((()=>{const n=setTimeout((()=>{if(Date.now()-i.current>=t){a(e)
i.current=Date.now()}}),t-(Date.now()-i.current))
return()=>{clearTimeout(n)}}),[e,t])
return n}var Vu=n(837219),Uu=n(586358)
function getCompletedRelatedResultsFormStates(e){return e.filter((e=>function isCompletedRelatedResultsFormState(e){return null!=e.joinKeyFieldName&&null!=e.backlinkFieldName&&e.backlinkSelections.selections.length>0}(e)))}function buildNameNode(e){return{kind:Zl.h.NAME,value:e}}const Gu=[{kind:Zl.h.ARGUMENT,name:buildNameNode("first"),value:(0,Vu.tl)("1")},{kind:Zl.h.ARGUMENT,name:buildNameNode("sortArgs"),value:(0,Vu.tl)("{sortKey: MODIFIED_AT, sortOrder: DESCENDING}")}]
var zu=n(764677),$u=n(157530),Wu=n(239070),Hu=n(365791)
const ju=[Kn.Vm.QUERY_API_BIOENTITY_ID,Kn.Vm.QUERY_API_CREATED_AT,Kn.Vm.QUERY_API_MODIFIED_AT,Kn.Vm.QUERY_API_AUTHOR,Kn.Vm.QUERY_API_CREATOR,Kn.Vm.QUERY_API_ARCHIVE_REASON,Kn.Vm.QUERY_API_PROJECT,Kn.Vm.QUERY_API_REGISTRY]
function isQueryApiFilterKey(e){return ju.includes(e)}const Yu={[Kn.Vm.QUERY_API_BIOENTITY_ID]:"id",[Kn.Vm.QUERY_API_MODIFIED_AT]:"modifiedAt",[Kn.Vm.QUERY_API_CREATED_AT]:"createdAt",[Kn.Vm.QUERY_API_AUTHOR]:"authors",[Kn.Vm.QUERY_API_CREATOR]:"creator",[Kn.Vm.QUERY_API_ARCHIVE_REASON]:"archiveReason",[Kn.Vm.QUERY_API_PROJECT]:"project",[Kn.Vm.QUERY_API_REGISTRY]:"registry"},Qu=l.default.invert(Yu)
function fieldNodeToStringValue(e){if(e.value.kind!==Zl.h.STRING){(0,S.Gp)(!1,"Expected field.value to be STRING type",{valueKind:e.value.kind,name:e.name.value})
return null}return e.value.value}function graphQLArgumentsToFilters(e){return(0,wc.Z)(e.map((e=>{const t=Qu[e.name.value]
if(void 0===t){(0,S.Gp)(!1,"Got unexpected GQL argument",{argument:(0,Bu.S)(e)})
return null}if(e.value.kind!==Zl.h.OBJECT){(0,S.Gp)(!1,"Expected all filter arguments to be objects",{argument:(0,Bu.S)(e)})
return null}if(t===Kn.Vm.QUERY_API_MODIFIED_AT||t===Kn.Vm.QUERY_API_CREATED_AT){const n=e.value.fields.find((e=>"gte"===e.name.value)),a=e.value.fields.find((e=>"lte"===e.name.value))
return{...(0,Kn.QW)(t),value:{fromDatetime:null==n?null:fieldNodeToStringValue(n),toDatetime:null==a?null:fieldNodeToStringValue(a)}}}if(t===Kn.Vm.QUERY_API_CREATOR||t===Kn.Vm.QUERY_API_AUTHOR||t===Kn.Vm.QUERY_API_BIOENTITY_ID||t===Kn.Vm.QUERY_API_ARCHIVE_REASON){const n=e.value.fields.find((e=>"anyOf"===e.name.value))
if(null==n)return null
if(n.value.kind!==Zl.h.LIST){(0,S.Gp)(!1,"Got anyOf filter with non-list value",{argument:(0,Bu.S)(e)})
return null}return{...(0,Kn.QW)(t),value:(0,wc.Z)(n.value.values.map((t=>{if(t.kind!==Zl.h.STRING){(0,S.Gp)(!1,"Got anyOf filter with non-string array member",{argument:(0,Bu.S)(e)})
return null}return t.value})))}}if(t===Kn.Vm.QUERY_API_PROJECT||t===Kn.Vm.QUERY_API_REGISTRY){const n=e.value.fields.find((e=>"eq"===e.name.value))
if(null==n)return(0,Kn.QW)(t)
if(n.value.kind!==Zl.h.STRING){(0,S.Gp)(!1,"Got eq filter with non-string value",{argument:(0,Bu.S)(e)})
return null}return{...(0,Kn.QW)(t),value:n.value.value}}(0,S.Gp)(!1,"Got unsupported filter key",{filterKey:(0,Go.vE)(t)})
return null})))}function buildDatetimeFilterValue(e,t){return{kind:Zl.h.OBJECT,fields:(0,wc.Z)([null==e?null:{kind:Zl.h.OBJECT_FIELD,name:{kind:Zl.h.NAME,value:"lte"},value:{kind:Zl.h.STRING,value:e}},null==t?null:{kind:Zl.h.OBJECT_FIELD,name:{kind:Zl.h.NAME,value:"gte"},value:{kind:Zl.h.STRING,value:t}}])}}function buildAnyOfFilterValue(e){return{kind:Zl.h.OBJECT,fields:[{kind:Zl.h.OBJECT_FIELD,name:{kind:Zl.h.NAME,value:"anyOf"},value:{kind:Zl.h.LIST,values:e.map((e=>({kind:Zl.h.STRING,value:e})))}}]}}function buildEqFilterValue(e){return{kind:Zl.h.OBJECT,fields:[{kind:Zl.h.OBJECT_FIELD,name:{kind:Zl.h.NAME,value:"eq"},value:{kind:Zl.h.STRING,value:e}}]}}function buildArgument(e,t){return{kind:Zl.h.ARGUMENT,name:{kind:Zl.h.NAME,value:e},value:t}}const Ku={[Kn.Vm.QUERY_API_BIOENTITY_ID]:e=>buildAnyOfFilterValue(e.value),[Kn.Vm.QUERY_API_AUTHOR]:e=>buildAnyOfFilterValue(e.value),[Kn.Vm.QUERY_API_CREATOR]:e=>buildAnyOfFilterValue(e.value),[Kn.Vm.QUERY_API_ARCHIVE_REASON]:e=>buildAnyOfFilterValue(e.value.filter((e=>e!==zu.S))),[Kn.Vm.QUERY_API_CREATED_AT]:e=>buildDatetimeFilterValue(e.value.toDatetime,e.value.fromDatetime),[Kn.Vm.QUERY_API_MODIFIED_AT]:e=>buildDatetimeFilterValue(e.value.toDatetime,e.value.fromDatetime),[Kn.Vm.QUERY_API_PROJECT]:e=>null==e.value?null:buildEqFilterValue(e.value),[Kn.Vm.QUERY_API_REGISTRY]:e=>null==e.value?null:buildEqFilterValue(e.value)}
function filtersToGraphQLArguments(e){return(0,wc.Z)(l.default.unique(e,(e=>e.key)).map((e=>{if(!isQueryApiFilterKey(e.key)){(0,S.Gp)(!1,"Got unsupported filter key",{filterKey:e.key})
return null}const t=function getBuildArgumentValueFn(e){return Ku[e]}(e.key)(e)
return null==t?null:buildArgument(Yu[e.key],t)})))}function QueryApiFilters({filterArguments:e,onChangeFilterArguments:t,schemaId:n}){return d.createElement(Hu.Z,{filters:graphQLArgumentsToFilters(e),onChangeFilters:e=>{t(filtersToGraphQLArguments(e))},primaryFilterOptions:[],secondaryFilterGroups:[{filterOptions:ju.map((e=>e===Kn.Vm.QUERY_API_BIOENTITY_ID?{filterKey:e,extraProps:{schemaId:n}}:e===Kn.Vm.QUERY_API_ARCHIVE_REASON?{filterKey:e,extraProps:{archivePurposes:(0,$u.FH)(Wu.$.ALL)}}:{filterKey:e}))}],selectedSchema:null})}function DisabledQueryApiFilters(){return d.createElement(Hu.Z,{disabled:!0,filters:[],onChangeFilters:Jt.ZT,primaryFilterOptions:[],secondaryFilterGroups:[{filterOptions:[{filterKey:Kn.Vm.QUERY_API_MODIFIED_AT}]}],selectedSchema:null})}const Ju=buildArgument(Yu[Kn.Vm.QUERY_API_ARCHIVE_REASON],buildAnyOfFilterValue([zu.nr.NOT_ARCHIVED]))
const Xu=xa.ZP`
  query ResolveFilterValueApiIdsQuery(
    $bioentityIds: [StrictString!]!
    $partyIds: [StrictString!]!
    $projectIds: [StrictString!]!
  ) @skipAudit @engComponent(name: ANALYSIS_TOOL) {
    users(ids: $partyIds) {
      ... on PartyInterface {
        id
        handle
      }
      ...InaccessibleInfoGraphQL
    }
    bioentities(ids: $bioentityIds) {
      ... on RegistryItemInterface {
        id
        displayLabel
      }
      ...InaccessibleInfoGraphQL
    }
    projects(ids: $projectIds) {
      ... on ProjectNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
    registries {
      id
      name
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
async function formStateToHumanReadableString(e,t){(0,S.hu)(null!=e.entityListingFieldName,"Cannot build a string description of an incomplete form");(0,S.hu)(t.status===Da.NI.SUCCESS,"Cannot build a string description of a form without introspection")
const n=t.getQueryField(e.entityListingFieldName),a=(0,Fl.Z6)((0,Fl.xC)(null==n?void 0:n.type)),i=t.getTypeDisplayName(a),s=e.entityFilterArguments.length>0?`\n${await async function buildFilterString(e,t=2){const n=" ".repeat(t),a=graphQLArgumentsToFilters(e),i=await async function getApiIdToDisplayTextMap(e){const t=[...new Set(e.flatMap((e=>(0,Kn.om)(e)?e.value.filter((e=>null!=ea.ZP.apiIdToMaybeType(e))):(0,Kn.mg)(e)&&null!=e.value&&null!=ea.ZP.apiIdToMaybeType(e.value)?[e.value]:[])))]
if(0===t.length)return{}
const n=await(0,Ml.doQuerySafe)({query:Xu},{variables:{partyIds:t.filter((e=>ea.ZP.isEntity(e))),bioentityIds:t.filter((e=>ea.ZP.isBiologicalEntity(e))),projectIds:t.filter((e=>ea.ZP.isSource(e)))}})
return(0,Jt.m8)([...(0,wc.Z)(n.users.map((e=>(0,ka.CZ)(e)?null:[e.id,e.handle]))),...(0,wc.Z)(n.bioentities.map((e=>(0,ka.CZ)(e)?null:[e.id,e.displayLabel]))),...(0,wc.Z)(n.projects.map((e=>(0,ka.CZ)(e)?null:[e.id,e.name]))),...n.registries.map((e=>[e.id,e.name]))])}(a)
let s=`${n}Filters:\n`
for(const e of a){(0,S.hu)(isQueryApiFilterKey(e.key),"Got non-query-api filter")
const t=Kn.Oq[e.key].name;(0,S.hu)(null!=t,"Got filter key without a defined name")
s+=`${n}${n}${t}: `;(0,Kn.Rg)(e)?s+=formatDatetimeFilterValue(e):e.key===Kn.Vm.QUERY_API_ARCHIVE_REASON?s+=formatArchiveFilterValue(e.value):e.key===Kn.Vm.QUERY_API_AUTHOR||e.key===Kn.Vm.QUERY_API_CREATOR||e.key===Kn.Vm.QUERY_API_BIOENTITY_ID?s+=formatApiIdentifiedMultiFilterValue(e.value,i):e.key===Kn.Vm.QUERY_API_PROJECT||e.key===Kn.Vm.QUERY_API_REGISTRY?s+=null==e.value?"N/A":i[e.value]:(0,S.hu)(!1,`Got invalid filter key ${(0,Go.vE)(e.key)}`)
s+="\n"}return s}(e.entityFilterArguments)}`:"",r=`\n${buildSelectionString(a,e.entityFieldSelections,t,2)}`,o=`\n${getCompletedRelatedResultsFormStates(e.relatedResultsFormStates).map((e=>`${function buildRelatedResultsString(e,t,n,a){let i=" ".repeat(a)
const s=t.getFields()[e.backlinkFieldName],r=(0,Fl.Z6)((0,Fl.xC)(s.type)),o=r.getFields()[e.joinKeyFieldName]
i+=`${n.getTypeDisplayName(r)} Results, using ${n.getFieldDisplayName(o)} join field, ${e.onlyIncludeLatestItem?"only latest results":"all matching results"}\n`
i+=buildSelectionString(r,e.backlinkSelections,n,a+2)
return i}(e,a,t,2)}`)).join("\n")}`
return`${i}${s}${r}${o}`.replace(/\n$/g,"")}function formatDatetimeFilterValue({value:e}){return null==e.fromDatetime&&null==e.toDatetime?"None":null!=e.fromDatetime&&null==e.toDatetime?`> ${e.fromDatetime}`:null==e.fromDatetime&&null!=e.toDatetime?`< ${e.toDatetime}`:`> ${e.fromDatetime} and < ${e.toDatetime}`}function formatArchiveFilterValue(e){return e.map((e=>e===zu.nr.NOT_ARCHIVED?zu.yP:e)).join(", ")}function formatApiIdentifiedMultiFilterValue(e,t){return e.map((e=>{var n
return null!==(n=t[e])&&void 0!==n?n:e})).join(", ")}function buildSelectionString(e,t,n,a){const i=" ".repeat(a)
let s=""
for(const r of t.selections){s+=i
if(r.kind===Zl.h.FIELD){(0,S.hu)(!(0,Fl.EN)(e),"Cannot have field selection on union type")
const t=e.getFields()[r.name.value]
s+=n.getFieldDisplayName(t)
if(r.selectionSet){s+=`\n${buildSelectionString((0,Fl.M_)((0,Fl.xC)(t.type)),r.selectionSet,n,a+2)}`}}else if(r.kind===Zl.h.INLINE_FRAGMENT){const e=r.typeCondition;(0,S.hu)(null!=e,"Cannot have inline fragment without type condition")
s+=e.name.value
s+=`\n${buildSelectionString((0,Fl.M_)(n.graphQLSchema.getType(e.name.value)),r.selectionSet,n,a+2)}`}else(r.kind===Zl.h.FRAGMENT_SPREAD||(0,Go.vE)(r))&&(0,S.hu)(!1,`Only FIELD and INLINE_FRAGMENT selections are supported; got ${r.kind}`)
s+="\n"}return s.replace(/\n$/g,"")}var em=n(267203),tm=n(512902)
const nm=(0,d.createContext)(null)
function useGraphQLFieldSelectorContext(){const e=(0,d.useContext)(nm);(0,S.hu)(null!=e,"Tried to use GraphQLFieldSelector context without a Provider")
return e}function Row_Row({checkbox:e,description:t,expandIcon:n,typeIcon:a,indentationLevel:i,text:s,onClick:r}){return d.createElement("div",{className:(0,g.iv)(im.wrapper),onClick:r,...(0,ee.Z)({component:"Row",element:"root"})},d.createElement("div",{className:(0,g.iv)(im.checkboxWrapper)},e),d.createElement("div",{className:(0,g.iv)(im.spacing),style:{width:20*i}}),d.createElement("div",{className:(0,g.iv)(im.expandIconWrapper)},n),a&&d.createElement("div",{className:(0,g.iv)(im.typeIconWrapper)},a),d.createElement("div",{className:(0,g.iv)(im.textWrapper)},s),t&&d.createElement("div",{className:(0,g.iv)(im.descriptionWrapper)},t))}const am={width:16,height:16,display:"flex",flexShrink:0,fontSize:16,overflow:"hidden"},im=g.mM.create({wrapper:{height:25,padding:4,overflow:"hidden",display:"flex",flexShrink:0,alignItems:"center",userSelect:"none",cursor:"pointer",":hover":{backgroundColor:Vt.Ro}},checkboxWrapper:{width:16,height:16,flexShrink:0,overflow:"hidden"},expandIconWrapper:{...am,marginRight:4,color:Vt.pp},typeIconWrapper:{...am,color:Vt.TG,marginRight:4},descriptionWrapper:{color:Vt.TG,flexGrow:1,marginLeft:4,textOverflow:"ellipsis",whiteSpace:"nowrap",overflowX:"hidden"},textWrapper:{overflow:"hidden",flexShrink:0},spacing:{flexShrink:0}})
function FieldRow({description:e,field:t,indentationLevel:n,onClick:a,checkbox:i,expandIcon:s}){var r
const{renderFieldName:o,renderFieldTypeIcon:l}=useGraphQLFieldSelectorContext()
return d.createElement(Row_Row,{checkbox:i,description:e,expandIcon:s,typeIcon:l&&l(t),indentationLevel:n,text:null!==(r=o(t))&&void 0!==r?r:t.name,onClick:a})}function getNumSelectedDescription(e,t){return!e&&t>0?`${t} selected`:void 0}const sm={selections:[],kind:Zl.h.SELECTION_SET}
function ObjectFields({fields:e,indentationLevel:t,logicalDepth:n,parentStateId:a,selections:i,onChangeSelections:s}){const{getSortedFilteredFields:r,renderCheckbox:o}=useGraphQLFieldSelectorContext()
return d.createElement(d.Fragment,null,r(e).map((e=>{var r
const l=i.find((t=>t.name.value===e.name)),c=null!=l,u={field:e,indentationLevel:t,key:e.name}
return(0,Fl.Gv)((0,Fl.xC)(e.type))?d.createElement(CompositeField,{...u,logicalDepth:n,fieldStateId:`${a}-${e.name}`,selectionSet:null!==(r=null==l?void 0:l.selectionSet)&&void 0!==r?r:sm,onChangeSelectionSet:t=>{let n
n=0===t.selections.length?i.filter((t=>t.name.value!==e.name)):c?i.map((n=>n.kind===Zl.h.FIELD&&n.name.value===e.name?{kind:Zl.h.FIELD,name:{kind:Zl.h.NAME,value:e.name},selectionSet:t}:n)):[...i,{kind:Zl.h.FIELD,name:{kind:Zl.h.NAME,value:e.name},selectionSet:t}]
s(n)}}):d.createElement(FieldRow,{...u,checkbox:o(c),expandIcon:null,onClick:()=>{s(c?i.filter((t=>t.name.value!==e.name)):[...i,{kind:Zl.h.FIELD,name:{kind:Zl.h.NAME,value:e.name}}])}})})))}function AbstractFieldPossibleType({possibleTypeStateId:e,possibleType:t,sharedFields:n,indentationLevel:a,logicalDepth:i,selections:s,onChangeSelections:r}){const{logicalDepthLimit:o,getIsTypeDisabled:l,renderExpandIcon:c,renderTypeName:u,getIsExpanded:m,toggleIsExpanded:p,getSortedFilteredFields:h}=useGraphQLFieldSelectorContext(),g=m(e,a),E=h(Object.values(t.getFields()).filter((e=>null==n[e.name])))
if(0===E.length)return d.createElement(d.Fragment,null)
const f=countSelectedFields(s),S=l((0,Fl.xC)(t))
return d.createElement(d.Fragment,null,d.createElement(Row_Row,{checkbox:null,expandIcon:c(g,{atMaxDepth:i>=o,isTypeDisabled:S}),indentationLevel:a,onClick:()=>{i<o&&!S&&p(e,a)},text:u((0,Fl.xC)(t)),description:getNumSelectedDescription(g,f),typeIcon:null}),g&&d.createElement(ObjectFields,{parentStateId:e,fields:E,indentationLevel:a+1,logicalDepth:i+1,selections:s,onChangeSelections:r}))}function CompositeField({field:e,fieldStateId:t,indentationLevel:n,logicalDepth:a,selectionSet:i,onChangeSelectionSet:s}){const{graphQLSchema:r,logicalDepthLimit:o,getIsTypeDisabled:l,getSortedFilteredFields:c,renderExpandIcon:u,getIsExpanded:m,toggleIsExpanded:p,noFieldsDisplayText:h}=useGraphQLFieldSelectorContext(),g=m(t,n),E=countSelectedFields(i.selections),f=l((0,Fl.xC)(e.type)),y=d.createElement(FieldRow,{field:e,checkbox:null,expandIcon:u(g,{atMaxDepth:a>=o,isTypeDisabled:f}),indentationLevel:n,description:getNumSelectedDescription(g,E),onClick:()=>{a<o&&!f&&p(t,n)}})
if(!g)return y
const b=(0,Fl.M_)((0,Fl.xC)(e.type)),T=(0,Fl.lp)(b)||(0,Fl.oT)(b)?b.getFields():{},v=c(Object.values(T)),C=function getSortedTypes(e){return e.slice().sort(((e,t)=>e.name.localeCompare(t.name)))}((0,Fl.m0)(b)?[...r.getPossibleTypes(b)]:[]),[I,w]=(0,Jt.uK)([...i.selections].map((e=>{(0,S.hu)(e.kind===Zl.h.FIELD||e.kind===Zl.h.INLINE_FRAGMENT,"Got unexpected selection kind",{selection:e})
return e})),(e=>e.kind===Zl.h.FIELD))
return 0===C.length&&0===v.length?d.createElement(d.Fragment,null,y,d.createElement(Row_Row,{checkbox:null,expandIcon:null,text:"",description:h,indentationLevel:n+1,onClick:Jt.ZT,typeIcon:null})):d.createElement(d.Fragment,null,y,d.createElement(ObjectFields,{parentStateId:t,indentationLevel:n+1,logicalDepth:a+1,fields:v,selections:I,onChangeSelections:e=>{s({kind:Zl.h.SELECTION_SET,selections:[...e,...w]})}}),C.map((e=>{var i
const r=w.findIndex((t=>{var n
return(null===(n=t.typeCondition)||void 0===n?void 0:n.name.value)===e.name})),o=r>=0?w[r]:null;(0,S.hu)(null==o||"InlineFragment"===o.kind,"Got non-InlineFragment selection of an abstract type",{possibleTypeSelections:o})
return d.createElement(AbstractFieldPossibleType,{possibleTypeStateId:`${t}-${e.name}`,indentationLevel:n+1,key:e.name,logicalDepth:a,sharedFields:T,possibleType:e,selections:null!==(i=null==o?void 0:o.selectionSet.selections.map((e=>{(0,S.hu)("Field"===e.kind,"Got non-Field selection for possibleType's selections",{selection:e})
return e})))&&void 0!==i?i:[],onChangeSelections:t=>{let n
n=0===t.length&&r>=0?(0,tm.ZP)(w,(e=>{e.splice(r,1)})):null==o?[...w,{kind:Zl.h.INLINE_FRAGMENT,typeCondition:{kind:Zl.h.NAMED_TYPE,name:{kind:Zl.h.NAME,value:e.name}},selectionSet:{kind:Zl.h.SELECTION_SET,selections:t}}]:(0,tm.ZP)(w,(e=>{e[r].selectionSet.selections=t}))
s({kind:Zl.h.SELECTION_SET,selections:[...I,...n]})}})})))}function defaultRenderFieldName(e){return e.name}function defaultRenderTypeName(e){return e.name}function defaultGetIsTypeDisabled(e){return!1}function defaultGetSortedFilteredFields(e){return e.slice().sort(((e,t)=>e.name.localeCompare(t.name)))}function GraphQLFieldSelector({getSortedFilteredFields:e=defaultGetSortedFilteredFields,graphQLSchema:t,logicalDepthLimit:n,noFieldsDisplayText:a="No fields available to be selected",getIsTypeDisabled:i=defaultGetIsTypeDisabled,renderCheckbox:s,renderExpandIcon:r,renderFieldName:o=defaultRenderFieldName,renderTypeName:l=defaultRenderTypeName,renderFieldTypeIcon:c,rootField:u,selectionSet:m,onChangeSelectionSet:p}){const{getIsExpanded:h,toggleIsExpanded:g}=function useExpansionState(){const[e,t]=(0,d.useState)({}),n=(0,d.useCallback)(((t,n)=>{const a=e[t]
return void 0===a?n<1:a}),[e]),a=(0,d.useCallback)(((a,i)=>{t({...e,[a]:!n(a,i)})}),[e,n])
return{getIsExpanded:n,toggleIsExpanded:a}}(),E=(0,Fl.xC)(u.type);(0,S.hu)((0,Fl.Gv)(E),"Expected root field to be a composite type",{fieldName:u.name,fieldType:u.type.toString()})
return d.createElement(nm.Provider,{value:{getSortedFilteredFields:e,graphQLSchema:t,logicalDepthLimit:n,noFieldsDisplayText:a,getIsTypeDisabled:i,renderCheckbox:s,renderExpandIcon:r,renderFieldName:o,renderTypeName:l,renderFieldTypeIcon:c,getIsExpanded:h,toggleIsExpanded:g}},d.createElement(CompositeField,{fieldStateId:u.name,field:u,indentationLevel:0,logicalDepth:0,selectionSet:m,onChangeSelectionSet:p}))}var rm=n(586089)
const om=dt.ZP.ENABLE_ANALYSIS_TOOL_API_ID_RESOLUTION?["id","name","aliases"]:["name","aliases"]
function GraphQLFieldSelectorWrapper({field:e,graphQLSchema:t,logicalDepthLimit:n,selectionSet:a,setSelectionSet:i,getFieldDisplayName:s,getTypeDisplayName:r,isArchivedField:o,isBacklinkField:c,isUserDefinedField:u}){const m=countSelectedFields(a.selections)
return d.createElement("div",{className:(0,g.iv)(lm.wrapper)},d.createElement("div",{className:(0,g.iv)(lm.header)},d.createElement("div",{className:(0,g.iv)(lm.title)},"Select columns"),d.createElement("div",{className:(0,g.iv)(lm.numSelected)},m," ",(0,de._6)(m,"column")," selected")),d.createElement("div",{className:f()((0,g.iv)(lm.selectorWrapper),"scrollbar-override")},d.createElement(GraphQLFieldSelector,{graphQLSchema:t,logicalDepthLimit:n,getSortedFilteredFields:function getSortedFilteredFields(e){const[t,n]=l.default.partition(e,u),[a,i]=l.default.partition(t,o),[r,d]=l.default.partition(n,(e=>om.includes(e.name))),m=[...(0,hs.Z)(r,[e=>om.indexOf(e.name)]),...(0,hs.Z)(i,[s]),...(0,hs.Z)(d,[s]),...(0,hs.Z)(a,[s])]
return m.filter((e=>!c(e)))},selectionSet:a,onChangeSelectionSet:i,getIsTypeDisabled:e=>"Inaccessible"===e.name,renderCheckbox:e=>d.createElement(rm.Z,{checked:e}),renderExpandIcon:(e,{atMaxDepth:t,isTypeDisabled:n})=>d.createElement(P.ZP,{title:t?"Maximum depth reached":n?"Field type not supported":"",disabled:!(t||n)},d.createElement(pe.Z,{icon:e?"triangle-down":"triangle-right",className:f()((t||n)&&(0,g.iv)(lm.expandIconDisabled))})),renderFieldTypeIcon:void 0,rootField:e,renderFieldName:e=>o(e)?`${s(e)} (archived)`:s(e),renderTypeName:r})))}const lm=g.mM.create({wrapper:{maxHeight:300,borderRadius:"4px 4px 0px 0px",border:`1px solid ${Vt.tN}`,display:"flex",flexDirection:"column"},selectorWrapper:{..._n.cf,flexGrow:1,overflowY:"auto"},header:{flexShrink:0,display:"flex",justifyContent:"space-between",background:Vt.tN,padding:"7px 10px"},title:{..._n.E0,color:Vt.pp,fontWeight:_n.KB,textTransform:"uppercase"},numSelected:{..._n.cf,color:Vt.pp,fontWeight:_n.hS},expandIconDisabled:{cursor:"not-allowed",color:Vt.pF}})
var cm=n(375171),dm=n(273901)
function getAndAssertObjectType(e){return(0,Fl.Z6)((0,Fl.xC)(e.type))}var um=n(211332),mm=n(946948)
function RelatedResultsForm({entityListingField:e,formState:t,onChangeFormState:n,onRemove:a,queryApiIntrospection:i,isBacklinkFieldSelected:s}){const r=getAndAssertObjectType(e),o=null!=t.backlinkFieldName?r.getFields()[t.backlinkFieldName]:null,l=null!=o?getAndAssertObjectType(o):null,c=null!=l&&t.joinKeyFieldName?l.getFields()[t.joinKeyFieldName]:null,u=null!=l?i.getPossibleJoinKeyFields(r,l):null
return d.createElement("div",{...(0,ee.Z)({component:"RelatedResultsForm",element:"root"}),className:(0,g.iv)(pm.wrapper)},d.createElement(Fr.Z,{label:"Result schema"}),d.createElement("div",{className:(0,g.iv)(pm.resultSchemaRow)},d.createElement("div",{className:(0,g.iv)(pm.resultSchemaWrapper)},d.createElement(um.$n,{selectedSchemaId:null==t.backlinkFieldName?null:i.backlinkFieldToTargetSchemaId(r.getFields()[t.backlinkFieldName]),onChange:a=>{if(null==a){n({...t,backlinkFieldName:null,joinKeyFieldName:null,backlinkSelections:sm})
return}const s=i.targetSchemaIdToBacklinkField(r,a.id);(0,S.hu)(null!=s,"No backlink field found for schema",{entityListingField:e.name,schemaId:a.id})
const o=i.getPossibleJoinKeyFields(r,getAndAssertObjectType(s));(0,S.hu)(o.length>0,"No possible join keys found on backlink field",{backlinkFieldName:s.name,ofType:(0,Fl.xC)(s.type).name})
n({...t,backlinkFieldName:s.name,joinKeyFieldName:1===o.length?o[0].name:null,backlinkSelections:sm})},filter:e=>{const t=i.targetSchemaIdToBacklinkField(r,e.id)
return null!=t&&(!s(t.name)||o===t)},shouldShowNoSchemaOption:!1})),d.createElement(pe.Z,{className:(0,g.iv)(pm.deleteIcon),icon:"delete",onClick:()=>{a()}})),null!=l&&null!=u&&u.length>1&&d.createElement("div",{className:(0,g.iv)(pm.joinKeyDropdownWrapper)},d.createElement($r.ZP,{displayName:null==c?"Select field to join on":`Join on: ${i.getFieldDisplayName(c)}`,menu:d.createElement(w.ZP,{value:c},u.map((e=>d.createElement(N.Z,{key:e.name,value:e,onSelect:()=>{n({...t,joinKeyFieldName:e.name})}},i.getFieldDisplayName(e)))))})),null!=t.backlinkFieldName&&d.createElement(d.Fragment,null,d.createElement(mm.t,{hasBottomSpacing:!0,selectedValue:t.onlyIncludeLatestItem,options:[{label:"Only include latest results",value:!0},{label:"Include all results",value:!1}],onChange:e=>{n({...t,onlyIncludeLatestItem:e})}}),!t.onlyIncludeLatestItem&&d.createElement("div",{className:(0,g.iv)(pm.resultLimitBanner)},d.createElement(io.ZP,{bannerType:io.ct.INFO,text:`Only the ${1e3.toLocaleString()} most recent results per entity will be included.`}))),null!=l&&null!=o&&d.createElement(GraphQLFieldSelectorWrapper,{field:o,logicalDepthLimit:3,selectionSet:t.backlinkSelections,setSelectionSet:e=>{n({...t,backlinkSelections:e})},getFieldDisplayName:e=>e===o?i.getTypeDisplayName(l):i.getFieldDisplayName(e),...(0,he.Z)(i,"getTypeDisplayName","graphQLSchema","isArchivedField","isBacklinkField","isUserDefinedField")}))}const pm=g.mM.create({wrapper:{marginBottom:28},resultSchemaRow:{display:"flex",alignItems:"center",marginBottom:6},resultSchemaWrapper:{flexGrow:1},deleteIcon:{flexShrink:0,marginLeft:6,width:16,height:16,color:Vt.TG,cursor:"pointer",":hover":{color:Vt.pp}},joinKeyDropdownWrapper:{marginBottom:6},resultLimitBanner:{marginBottom:8}}),hm={backlinkFieldName:null,backlinkSelections:sm,joinKeyFieldName:null,onlyIncludeLatestItem:!0}
function RelatedResultsFormList({entityListingField:e,relatedResultsFormStates:t,onChangeRelatedResultFormStates:n,queryApiIntrospection:a}){const i=getAndAssertObjectType(e),s=function useQueryApiExtensionStatus(e){var t,n;(0,Ul.Z)((()=>{fetchQueryApiTypeExtension(e)}))
return null!==(n=null===(t=Wl.useGlobalClientState($l)[0][e])||void 0===t?void 0:t.status)&&void 0!==n?n:Wr.Lr.NOT_FETCHED}(i.name)
if(s===Wr.Lr.ERROR)return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"Failed to load related result schemas."})
if(s===Wr.Lr.LOADING||s===Wr.Lr.NOT_FETCHED)return d.createElement(kl.b,null)
const r=a.typeHasResultSchemaBacklinkFields(i)
function isBacklinkFieldSelected(e){return t.some((t=>t.backlinkFieldName===e))}return d.createElement(d.Fragment,null,t.map(((i,s)=>{var r
return d.createElement(RelatedResultsForm,{key:null!==(r=i.backlinkFieldName)&&void 0!==r?r:s,entityListingField:e,formState:i,isBacklinkFieldSelected,onChangeFormState:e=>{n((0,cm.WJ)(t,s,e))},onRemove:()=>{n((0,tm.ZP)(t,(e=>{e.splice(s,1)})))},queryApiIntrospection:a})})),d.createElement("div",{className:(0,g.iv)(gm.addResultsButtonWrapper)},d.createElement(P.ZP,{disabled:r,title:"No result schemas available"},d.createElement(dm.Z,{disabled:!r,label:"Add Results",onClick:()=>{n([...t,hm])},dataTestAttrs:{component:"RelatedResultsFormList",element:"addItemButton"}}))))}const gm=g.mM.create({addResultsButtonWrapper:{width:"fit-content"}}),Em=dt.ZP.ENABLE_ANALYSIS_TOOL_API_ID_RESOLUTION?"id":"name"
function fieldHasArgument(e,t){return e.args.some((e=>e.name===t))}function QueryApiAllSchemaSelector({schemaId:e,queryApiIntrospection:t,handleSchemaChange:n}){return d.createElement(em.Z,{error:null,isDisabled:!1,onChange:n,selectedSchemaId:e,schemas:t.getAllListableSchemas()})}const fm={kind:Zl.h.FIELD,name:{kind:Zl.h.NAME,value:Em}}
const Sm=d.memo((function RegistrySchemaStepperForm({queryFormState:e,setQueryFormState:t,dataFrameNameState:n,queryApiIntrospection:a,setDataFrameNameState:i}){const s=null==e.entityListingFieldName?null:a.getQueryField(e.entityListingFieldName),r=(0,d.useCallback)((e=>{if(null==e){t({entityListingFieldName:null})
return}const s=a.getQueryListingFieldForSchema(e.id);(0,S.hu)(null!=s,"User selected a schema without a corresponding Query API listing field")
const r={schemaId:e.id,schemaName:e.name,listingFieldName:s.name},o=function typeHasDefaultField(e){const t=(0,Fl.xC)(e)
return((0,Fl.oT)(t)||(0,Fl.lp)(t))&&null!=t.getFields()[Em]}(s.type)
if(ea.ZP.isTagSchema(e.id)){(0,S.Gp)(o,`User selected a schema without the "${Em}" field`,r)
fetchQueryApiTypeExtension((0,Fl.xC)(s.type).name)}const l=function fieldHasArchiveReasonArg(e){return fieldHasArgument(e,Yu[Kn.Vm.QUERY_API_ARCHIVE_REASON])}(s);(0,S.Gp)(l,"User selected a schema without an archiveReason argument",r)
const c=function fieldHasRegistryArg(e){return fieldHasArgument(e,Yu[Kn.Vm.QUERY_API_REGISTRY])}(s)
t({entityListingFieldName:s.name,entityFilterArguments:(0,wc.Z)([l?Ju:null,c&&null!=e.registryId?(d=e.registryId,buildArgument(Yu[Kn.Vm.QUERY_API_REGISTRY],buildEqFilterValue(d))):null]),entityFieldSelections:{kind:Zl.h.SELECTION_SET,selections:o?[fm]:[]},relatedResultsFormStates:[]})
var d
n.hasUserEdits||i({...n,name:`${e.name} data`})}),[n,a,i,t]),o=(0,d.useCallback)((e=>a.hasQueryListingFieldForSchema(e.id)),[a]),l=null==e.entityListingFieldName?null:a.getQueryFieldSchemaId(e.entityListingFieldName),c=dt.ZP.ENABLE_ANALYSIS_TOOL_ALL_TYPE_QUERY_OPTION?{schemaSelectorElementTitle:"Schema",schemaSelectorElement:d.createElement(QueryApiAllSchemaSelector,{schemaId:l,handleSchemaChange:r,queryApiIntrospection:a}),shouldRenderRelatedResults:!1}:{schemaSelectorElementTitle:"Entity schema",schemaSelectorElement:d.createElement(Ho.ZP,{onChange:r,allowNone:!1,selectedTagSchemaId:l,tagSchemaFilterFn:o}),shouldRenderRelatedResults:!0}
return d.createElement(Pd.ZP,null,d.createElement(Pd.qO,{title:"Select registry schema"},d.createElement(Fr.Z,{label:c.schemaSelectorElementTitle}),d.createElement("div",{className:(0,g.iv)(ym.entitySchemaSelectorWrapper)},d.createElement("div",{className:(0,g.iv)(ym.entitySchemaSelector)},c.schemaSelectorElement),null==e.entityListingFieldName||null==l?d.createElement(DisabledQueryApiFilters,null):d.createElement(QueryApiFilters,{filterArguments:e.entityFilterArguments,onChangeFilterArguments:n=>{t({...e,entityFilterArguments:n})},schemaId:l}))),d.createElement(Pd.qO,{title:"Select columns"},null!=e.entityListingFieldName&&null!=s&&d.createElement(GraphQLFieldSelectorWrapper,{field:s,logicalDepthLimit:4,selectionSet:e.entityFieldSelections,setSelectionSet:n=>{t({...e,entityFieldSelections:n})},getFieldDisplayName:e=>e===s?a.getTypeDisplayName((0,Fl.xC)(s.type)):a.getFieldDisplayName(e),...(0,he.Z)(a,"getTypeDisplayName","graphQLSchema","isArchivedField","isBacklinkField","isUserDefinedField")})),c.shouldRenderRelatedResults&&d.createElement(Pd.qO,{title:"Add Results"},null==e.entityListingFieldName||null==s?null:d.createElement(RelatedResultsFormList,{relatedResultsFormStates:e.relatedResultsFormStates,onChangeRelatedResultFormStates:n=>{t({...e,relatedResultsFormStates:n})},entityListingField:s,queryApiIntrospection:a})),d.createElement(Pd.qO,{title:"Name table"},d.createElement(DataFrameNameField,{...n,onNameChange:e=>{i({name:e,hasUserEdits:!0})}})))})),ym=g.mM.create({entitySchemaSelectorWrapper:{display:"flex"},entitySchemaSelector:{flexGrow:1,marginRight:6}})
function buildErrorAndWarningMessages(e){if(e.status===Wr.Lr.ERROR)return[buildPreviewFailureMessage()]
const t=(0,Wr.yf)(e)
return null==(null==t?void 0:t.dataFrame)?[]:t.dataFrame.rows.length>=100?[buildPreviewOverRowLimitMessage(100,`The final table will be limited to the first ${5e4.toLocaleString()} rows.`)]:[]}const bm={name:"",hasUserEdits:!1},Tm=(0,xl.ZP)(bm),vm={entityListingFieldName:null},Cm=(0,xl.ZP)(vm),Im=(0,xl.ZP)(Wr.Tp),wm=(0,xl.ZP)(!1)
const Nm={mappings:[],resultSchema:null}
const Am=(0,xl.ZP)(null)
function useDataMappingState(e,t,n){var a
const i=`${e}-${t}-data-mapping`,[s,r]=Am.useGlobalClientState(i)
return[null!==(a=null!=s?s:n)&&void 0!==a?a:function getDefaultDataMappingState(){return{...Nm}}(),r,()=>{r(null)}]}var Rm=n(733435),Pm=n(143120),Om=n(547894)
function ColumnDropdownSelector(e){var t
const n=(0,Pm.Z)(e.dataFrameSpec),a=(0,Jt.m8)(n.map((e=>[e.systemName,e]))),i=null!==(t=e.validationOptions)&&void 0!==t?t:{}
function valueToDisplayName(t){var n
return null!=t?a[t].displayName:null!==(n=e.noColumnSelectedText)&&void 0!==n?n:"None"}function valueToIcon(e){return null!=e?(0,Om.Z)(a[e]):"none-option"}const s=[null,...n.filter((e=>(0,ad.Xh)(e.type,i))).map((e=>e.systemName))].map((e=>({icon:valueToIcon(e),name:valueToDisplayName(e),value:e}))),r=d.createElement(Ar.Z,{height:Nr.Bl.MEDIUM,width:Nr.zL.FULL,selectedValue:e.selectedColumnSystemName,onSelect:t=>{e.onChange(t)},optionDatas:s})
return d.createElement($r.ZP,{buttonSize:e.buttonSize,menu:r,displayName:valueToDisplayName(e.selectedColumnSystemName),error:null==e.selectedColumnSystemName||(0,ad.Xh)(a[e.selectedColumnSystemName].type,i)?e.error:"Invalid column selected",errorStyle:$r.ww.TOOLTIP})}var xm=n(552648)
function ColumnMappingTable(e){const t=e.outputResultSchema.fields,n=(0,Jt.m8)(e.mappings.map((e=>[e.outputFieldId,e.inputColumnSystemName])))
return d.createElement("table",{className:"table",...(0,ee.Z)({component:"ColumnMappingTable",element:"root"})},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Result column"),d.createElement("th",null,"Analysis table column"))),d.createElement("tbody",null,t.length>0?t.map((t=>{var a,i,s,r
return d.createElement("tr",{key:t.apiId},d.createElement("td",{className:(0,g.iv)(_m.textColumn)},d.createElement(pe.Z,{className:(0,g.iv)(_m.typeIcon),icon:(r=t,xm.o[Hn.FIELD_TYPE_TO_LEAF_TYPE[r.fieldType]])}),t.displayName),d.createElement("td",{className:(0,g.iv)(_m.dropdownSelectorColumn)},d.createElement(ColumnDropdownSelector,{dataFrameSpec:e.inputDataFrameSpec,selectedColumnSystemName:null!==(a=n[t.apiId])&&void 0!==a?a:null,onChange:n=>{e.setMappings(function updateMappingsOnSelect(e,t,n){const a=e.filter((e=>e.outputFieldId!==n))
null!=t&&a.push({inputColumnSystemName:t,outputFieldId:n})
return a}(e.mappings,n,t.apiId))},error:null===(s=null===(i=e.errors)||void 0===i?void 0:i.find((e=>e.outputFieldId===t.apiId)))||void 0===s?void 0:s.message})))})):d.createElement("tr",null,d.createElement("td",{colSpan:2},"This schema does not have any fields"))))}const _m=g.mM.create({dropdownSelectorColumn:{width:255},textColumn:{..._n.cf,verticalAlign:"middle"},typeIcon:{color:Vt.TG,marginRight:8}})
const Dm=(0,xl.ZP)(!1)
function InternalSaveToResultsStepConfigurationView(e){const[t,n]=Dm.useGlobalClientState(e.clientStateId),a=function validateDataMapping(e){var t
const n=null===(t=e.resultSchema)||void 0===t?void 0:t.fields
if(!n)return[]
const a=[],i=new Set
for(const t of n){const n=e.mappings.find((e=>e.outputFieldId===t.apiId))
!n&&t.isRequired&&a.push({message:`${t.displayName} is a required field.`,outputFieldId:t.apiId})
n&&t.fieldType===Hn.FieldType.JSON&&a.push({message:"Mapping to JSON fields is not supported.",outputFieldId:t.apiId})
n&&i.has(n.inputColumnSystemName)&&a.push({message:"This column is mapped to a previous field.",outputFieldId:t.apiId})
n&&i.add(n.inputColumnSystemName)}return a}(e.dataMappingState)
return d.createElement(StepConfigurationViewTemplate,{clientStateId:e.clientStateId,dataFrames:[e.inputDataFrame],disableFinalizeButton:null==e.dataMappingState.resultSchema||0===e.dataMappingState.mappings.length||a.length>0,finalizeButtonText:"Save to Results",finalizingLoadingMessage:"Creating Results...",messages:[],onCancel:e.onCancel,onFinalize:async()=>{n(!0)
await e.addSaveToResultsStep(e.dataMappingState)
n(!1)},title:"Save to Results",isFinalizing:t},d.createElement(Pd.ZP,null,d.createElement(Pd.qO,{title:"Select Result schema",id:"schema"},d.createElement(um.ZP,{selectedSchema:e.dataMappingState.resultSchema,onChange:t=>{e.setDataMappingState(function updateResultSchema(e,t){return(0,tm.Uy)(e,(e=>{e.resultSchema=t
e.mappings=[]}))}(e.dataMappingState,t))},filter:e=>!(0,yc.ZP)(e)})),e.dataMappingState.resultSchema&&d.createElement(Pd.qO,{title:"Map columns to Results",id:"map"},d.createElement(ColumnMappingTable,{inputDataFrameSpec:e.inputDataFrame,outputResultSchema:e.dataMappingState.resultSchema,mappings:e.dataMappingState.mappings,setMappings:t=>{e.setDataMappingState(function updateMappings(e,t){return(0,tm.Uy)(e,(e=>{e.mappings=t}))}(e.dataMappingState,t))},errors:a}))))}function RetryFailedSaveToResultsStepBanner(e){return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:e.text,supportingInfo:e.supportingInfo,action:e.openReconfigurationView?{actionType:io.J7.CUSTOM,actionText:"Reconfigure mapping",actionOnClick:e.openReconfigurationView}:void 0})}function numericAccessor(e,t){(0,Hd.kM)(t)
return t=>{const n=e(t)
return"string"==typeof n?(0,jd.j5)(n):n}}function resolvedStringAccessor(e,t,n){return stringAccessor((a=>(0,Yd.Z)(e(a),t,n)))}function stringAccessor(e){return t=>String(e(t))}function stringListAccessor(e){return t=>e(t).map((e=>String(e)))}var Lm=n(143313),km=n(605604),Mm=n(700518),Fm=n(458573),Zm=n(53433),Bm=n(41529)
const qm={allowedLeafTypes:[Hd.i0.TEXT,Hd.i0.RESULT],listType:ad.FS.NOT_ALLOWED,nullableType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED}
var Vm
!function(e){e.COLUMN_MAPPING="columnMapping"
e.SCHEMA_ID="schemaId"}(Vm||(Vm={}))
const Um="Please see error message in the last column",Gm=xa.ZP`
  query GetOutputDataFrames(
    $savedResultsDataFrameId: StrictString!
    $rowsWithErrorsDataFrameId: StrictString!
  ) @skipAudit @engComponent(name: ANALYSIS_TOOL) {
    savedResultsDataFrame: dataFrame(id: $savedResultsDataFrameId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    rowsWithErrorsDataFrame: dataFrame(id: $rowsWithErrorsDataFrameId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${Rm.KN.fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,zm=xa.ZP`
  query GetSavedResultsQuery($resultIds: [StrictString!]!, $schemaId: StrictString!) @skipAudit {
    results(ids: $resultIds) {
      ... on ResultNode {
        ...ResultGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    resultSchema(id: $schemaId) {
      ... on ResultSchemaNode {
        ...ResultSchemaGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("Result").fragment}
  ${(0,La.f)("ResultSchema").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function PresentationalSucceededDataMappingResults({analysis:e,allResultIds:t,rowsWithErrorsDataFrameId:n,rowsWithErrorsDataFrame:a,refetchResults:i,results:s,resultSchema:r,stepId:o,clientStateId:l,openReconfigurationView:c}){const[u,m]=(0,d.useState)(!1),p=s.every((e=>null!=e.archiveRecord)),h=s.every((e=>null==e.archiveRecord))
const E={onSelect:function updateArchiveStatusAndRefetch(){p?(0,Ic.jI)(async function unarchiveResults(){await Fm.dS(o)
i()}(),"Unarchiving results..."):(0,Xn.Z)(Mm.Q,{onRequestSubmit:e=>{(0,Ic.jI)(async function archiveResults(e){await Fm.xe(o,e)
i()}(e),"Archiving results...")},onRequestClose:()=>{},numResults:t.length})},isDisabled:(0,yc.ZP)(e),tooltipTitle:(0,yc.ZP)(e)?Yl.V$:void 0},S=e.permissions.writable||e.permissions.unarchivable,y=[d.createElement(I.ZP,{key:"overflow-menu",closeOnInsideClick:!0,closeOnOutsideClick:!0,menu:d.createElement(w.ZP,{dropLeft:!0,height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},S&&h&&d.createElement(N.Z,{...E},"Archive results"),S&&p&&d.createElement(N.Z,{...E},"Unarchive results"),d.createElement(N.Z,{onSelect:()=>{(0,bc.dV)([],{relatedResultsModelId:o})},isDisabled:!1,tooltipTitle:"Export results audit logs"},"Export results audit logs")),isOpen:u,onToggle:()=>{m(!u)}},d.createElement(Cc.C,{enableTooltip:!0,className:"u-mini-spacing-left"}))]
return d.createElement(d.Fragment,null,a.rows.length>0&&d.createElement("div",null,d.createElement(dd.Z,{dataFrameId:n,actionOrigin:cd.Z.ANALYSIS_TOOL,allowRowSelection:!1,banner:s.length>0?d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:"The following rows were unable to be saved to Results.",supportingInfo:Um}):d.createElement(RetryFailedSaveToResultsStepBanner,{openReconfigurationView:e.permissions.writable?c:void 0,text:"No rows could be saved to Results.",supportingInfo:Um}),clientStateId:l,dataFrame:a,renderIsExcludedColumn:!1})),t.length>s.length&&d.createElement("div",{className:(0,g.iv)($m.resultLimitInfoBanner)},d.createElement(io.ZP,{bannerType:io.ct.INFO,text:`Showing the first 500 Results of ${t.length}.`,supportingInfo:"Download to view the complete data."})),s.length>0&&d.createElement("div",{className:f()("mediocre","react-tab-container--mediocre-tableWrapper","react-tab-container--mediocre-tableWrapper--noPaddingTop")},d.createElement("div",{key:r.id,className:"mediocre-item is-table"},d.createElement(Bm.Z,{additionalColumns:[],attachedForReview:!1,autoCollapseLimit:500,headerControls:y,results:s,schema:r,canRename:!1,updateDisplayConfigHandler:()=>{},...km.W9,cid:l,isOversized:!1,locked:!0,onDownloadAsCSV:function handleDownloadAsCSV(){(0,Zm.Ss)(t)}}))))}function SucceededDataMappingResult({analysis:e,step:t,clientStateId:n,openReconfigurationView:a}){const i=findAndAssertSingleStepDataFrameId(t,Wc.SAVED_RESULTS),s=findAndAssertSingleStepDataFrameId(t,Wc.ROWS_WITH_ERRORS)
return d.createElement(Da.ZP,{query:Gm,variables:{savedResultsDataFrameId:i,rowsWithErrorsDataFrameId:s},renderLoading:()=>d.createElement(kl.b,null)},(({savedResultsDataFrame:i,rowsWithErrorsDataFrame:r})=>{(0,S.hu)(!(0,ka.CZ)(i),"User does not have access to step output");(0,S.hu)(!(0,ka.CZ)(r),"User does not have access to step output")
const o=i.dataFrameJson,l=stringAccessor((0,Lm.$0)(o,"result",qm).accessor),c=o.rows.map((e=>l(e))),u=c.slice(0,500),{schemaId:m}=getPipelineStepConfig(t,Sn.zs.SAVE_TO_RESULTS,1)
return d.createElement(Da.ZP,{query:zm,variables:{resultIds:u,schemaId:m},renderLoading:()=>d.createElement(kl.b,null)},((i,o)=>{if(null==i.resultSchema||(0,ka.CZ)(i.resultSchema))return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"You do not have permission to access the saved Results"})
const l=(0,zo.NA)("Result",(0,ka.nA)(i.results)),u=(0,zo.tY)("ResultSchema",i.resultSchema)
return d.createElement(PresentationalSucceededDataMappingResults,{analysis:e,rowsWithErrorsDataFrameId:s,allResultIds:c,refetchResults:()=>{o.refetch()},results:l,resultSchema:u,stepId:t.id,clientStateId:n,rowsWithErrorsDataFrame:r.dataFrameJson,openReconfigurationView:a})}))}))}const $m=g.mM.create({errorRowsContainer:{paddingBottom:Yl.hW},resultLimitInfoBanner:{paddingBottom:Yl.hW}})
const Wm=g.mM.create({container:{margin:Yl.hW}}),Hm=xa.ZP`
  query GetResultSchemaQuery($schemaId: StrictString!) @skipAudit {
    resultSchema(id: $schemaId) {
      ... on ResultSchemaNode {
        ...ResultSchemaGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("ResultSchema").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function InternalSaveToResultsStepReconfigurationView(e){const t=e.step.inputStepDatas[0].dataFrames[0].id,[n,a,i]=useDataMappingState(e.clientStateId,t,e.defaultDataMappingState),closeViewAndReturnToOutputView=()=>{e.onCloseStepInitializationView({type:Fc.SAVE_TO_RESULTS_OUTPUT,stepId:e.step.id})},onCancel=()=>{closeViewAndReturnToOutputView()
i()}
return d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>d.createElement(kl.b,null),variables:{dataFrameId:t}},(({dataFrame:t})=>{(0,S.hu)(!(0,ka.CZ)(t),"Expected data frame to be accessible.")
return d.createElement(InternalSaveToResultsStepConfigurationView,{clientStateId:e.clientStateId,inputDataFrame:t.dataFrameJson,dataMappingState:n,setDataMappingState:a,addSaveToResultsStep:t=>(async t=>{await(0,jl.W8)(e.analysis.id,{stepId:e.step.id,stepConfig:{schemaId:t.resultSchema.id,columnMapping:t.mappings}})
closeViewAndReturnToOutputView()})(t),onCancel})}))}var jm=n(353785)
function MachineLearningActions_trainParameterOptimization(e){return function trainParameterOptimization(e){return an.s0({url:"/1/api/machine-learning/parameter-optimization",data:e})}(e)}function MachineLearningActions_runParameterOptimizationPrediction(e){return function runParameterOptimizationPrediction(e){return an.s0({url:"/1/api/machine-learning/parameter-optimization:predict",data:e})}(e)}var Ym=n(492262)
const Qm=(0,xl.ZP)(""),Km=(0,xl.ZP)(!1),Jm=(0,xl.ZP)(null)
function CreateParameterOptimizationDatasetJSONView({analysis:e,clientStateId:t,onCancel:n,onDataFrameFinalized:a,readonly:i,step:s}){const[r,o]=Qm.useGlobalClientState(t),[l,c]=Km.useGlobalClientState(t),[u,m]=Jm.useGlobalClientState(t)
let p=null
try{p=JSON.parse(r)}catch(e){if(!(e instanceof SyntaxError))throw e}return d.createElement(StepConfigurationViewTemplate,{clientStateId:t,dataFrames:[],disableFinalizeButton:null==p,finalizeButtonText:"Run analysis",finalizingLoadingMessage:"Running analysis...",messages:null!=u?u.split("\n").map((e=>({text:e,bannerType:io.ct.ERROR}))):[],isFinalizing:l,onCancel:n,isLoadingPreview:!1,onFinalize:async function onFinalize(){var t
c(!0)
try{await jl.W8(e.id,{stepId:s.id,stepConfig:{dataDefinitionConfig:p,datasetConfiguration:{}}})
a()}catch(e){c(!1)
if(!Cn.d0(e)||null==(null===(t=e.responseJSON)||void 0===t?void 0:t.userMessage))throw e
m(e.responseJSON.userMessage)}},title:"Create Parameter Optimization Table"},d.createElement(Ym.ZP,{mode:"json",theme:"github",enableBasicAutocompletion:!0,value:r,onChange:o,readOnly:i}))}function makeVisualizationConfig(e,t){return{__typename:"AnalyticsVisualizationNode",id:(0,gt.Z)(),parameters:{__typename:ed.Ll[e],...t}}}var Xm=n(471936)
function sampleRows(e,t){return{...e,rows:l.default.shuffle(e.rows).slice(0,t)}}var ep=n(339312)
function getRegressionType(e){const t=e.parameters
return(0,cu.qw)(t)?getRegressionTypeFromConfig(t.regressionConfig):null}function getRegressionTypeFromConfig(e){var t
return null!==(t=null==e?void 0:e.regressionType)&&void 0!==t?t:null}function updateVisualization(e,t){const n={...e,...t},a=getVisualizationType(n),i=getRegressionType(e),s=getRegressionType(n)
if(a===cu.nB.SCATTER_PLOT&&i!==s&&s===ep.ZZ.LOGISTIC){const e={...n.parameters,xAxisScale:Sn.gA.LOG}
return{...n,parameters:e}}return n}class VisualizationTypeSetter{constructor(e,t,n){this.columnNames=e
this.previousVisualization=t
this.useSystemNames=n}getParameters(){const e=this.getDefaultParameters(),t=this.previousVisualization.parameters,n=(0,he.Z)(t,...Object.keys(e))
return{...e,...n}}getColumnDisplayName(e){return this.columnNames[e].displayName}getColumnNameForConfigSettingAtIndex(e){return this.useSystemNames?this.columnNames[e].systemName:this.columnNames[e].displayName}}class BaseChartVisualizationSetter extends VisualizationTypeSetter{getBaseDefaultParameters(){return{seriesColumnName:null,xAxisColumnName:this.getColumnNameForConfigSettingAtIndex(0),yAxisColumnName:this.getColumnNameForConfigSettingAtIndex(this.columnNames.length>1?1:0),yAxisScale:Sn.gA.LINEAR}}}class Continuous2DChartSetter extends BaseChartVisualizationSetter{getContinuous2DDefaultParameters(){return{xAxisScale:Sn.gA.LINEAR,yAxisIncludesZero:!0,...super.getBaseDefaultParameters()}}}const tp={[cu.nB.BAR_CHART]:class BarChartSetter extends BaseChartVisualizationSetter{getDefaultParameters(){return{aggregationType:null,barChartType:Sn.JG.STANDARD,errorBarType:null,yAxisMax:null,yAxisMin:null,sortDirection:null,...super.getBaseDefaultParameters()}}getParameters(){return{...super.getParameters(),...(0,cu.Wo)(this.previousVisualization.parameters,cu.nB.PIE_CHART)?{xAxisColumnName:this.previousVisualization.parameters.sliceColumnName,yAxisColumnName:this.previousVisualization.parameters.measureColumnName}:{}}}getUpdate(){return{parameters:{__typename:"AnalyticsVisualizationBarChartParametersNode",...this.getParameters()}}}},[cu.nB.HEATMAP]:class HeatmapSetter extends VisualizationTypeSetter{getDefaultParameters(){return{gradientDirection:Sn._G.ASCENDING_METRIC_VALUES,metricColumnName:this.getColumnNameForConfigSettingAtIndex((0,Jt.uZ)(0,this.columnNames.length-1,2)),xAxisColumnName:this.getColumnNameForConfigSettingAtIndex(0),yAxisColumnName:this.getColumnNameForConfigSettingAtIndex((0,Jt.uZ)(0,this.columnNames.length-1,1))}}getUpdate(){return{parameters:{__typename:"AnalyticsVisualizationHeatmapParametersNode",...this.getParameters()}}}},[cu.nB.LINE_CHART]:class LineChartSetter extends Continuous2DChartSetter{getDefaultParameters(){return{...super.getContinuous2DDefaultParameters()}}getUpdate(){return{parameters:{__typename:"AnalyticsVisualizationLineChartParametersNode",...this.getParameters()}}}},[cu.nB.PIE_CHART]:class PieChartSetter extends VisualizationTypeSetter{constructor(){super(...arguments)
this.DEFAULT_AGGREGATION_TYPE=Sn.FP.COUNT}getDefaultParameters(){return{aggregationType:this.DEFAULT_AGGREGATION_TYPE,legendLocation:Sn.S1.RIGHT,measureColumnName:this.getColumnNameForConfigSettingAtIndex(0),sliceColumnName:this.getColumnNameForConfigSettingAtIndex(0),showPercentageInLabel:!0,showSliceNameInLabel:!0,showValueInLabel:!1}}getParameters(){return{...super.getParameters(),...(0,cu.Wo)(this.previousVisualization.parameters,cu.nB.BAR_CHART)?{sliceColumnName:this.previousVisualization.parameters.xAxisColumnName,measureColumnName:this.previousVisualization.parameters.yAxisColumnName}:{}}}getUpdate(){var e
const t=[Sn.S1.LEFT,Sn.S1.RIGHT,null],n=this.getParameters(),a=t.includes(n.legendLocation)?n.legendLocation:Sn.S1.RIGHT
return{parameters:{__typename:"AnalyticsVisualizationPieChartParametersNode",...n,aggregationType:null!==(e=n.aggregationType)&&void 0!==e?e:this.DEFAULT_AGGREGATION_TYPE,legendLocation:null!=a?a:null}}}},[cu.nB.SCATTER_PLOT]:class ScatterPlotSetter extends Continuous2DChartSetter{getDefaultParameters(){return{aggregationType:null,colorPalette:ed.RR,errorBarType:null,legendLocation:Sn.S1.TOP,outlierConfig:null,regressionConfig:null,rowIdColumnName:null,yAxisMax:null,yAxisMin:null,...super.getContinuous2DDefaultParameters()}}getUpdate(){const e=[Sn.S1.TOP,null],t=this.getParameters(),n=e.includes(t.legendLocation)?t.legendLocation:Sn.S1.TOP
return{parameters:{__typename:"AnalyticsVisualizationScatterPlotParametersNode",...t,legendLocation:null!=t.seriesColumnName?n:null,regressionConfig:null==t.seriesColumnName?t.regressionConfig:null}}}},[cu.nB.TABLE]:class TableSetter extends VisualizationTypeSetter{getDefaultParameters(){return{displayColumnsJson:null}}getUpdate(){return{parameters:{__typename:"AnalyticsVisualizationTableParametersNode",...this.getParameters()}}}}},np=[cu.nB.TABLE,cu.nB.BAR_CHART,cu.nB.LINE_CHART,cu.nB.PIE_CHART,cu.nB.SCATTER_PLOT,cu.nB.HEATMAP]
function VisualizationTypeSelector({visualizationType:e,onChange:t,disabledVisualizationTypes:n}){function handleSelect(n){e!==n&&t(n)}const a=null!=n?np.filter((e=>!n.includes(e))):np,i=d.createElement(w.ZP,{dropLeft:!0,height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL,value:e},a.map((e=>d.createElement(N.Z,{key:e,icon:ed.A3[e],onSelect:handleSelect,value:e,dataTestAttrs:{component:"VisualizationTypeSelector",element:"visualizationType",key:e}},ed.Qp[e])))),s=null!=e?ed.Qp[e]:"Select a chart type"
return d.createElement($r.ZP,{menu:i,displayName:d.createElement(d.Fragment,null,null!=e&&d.createElement(pe.Z,{className:(0,g.iv)(ap.displayNameIcon),icon:ed.A3[e]}),d.createElement("span",{className:"u-mini-spacing-left"},s)),dataTestAttrs:{component:"VisualizationTypeSelector",element:"button"}})}const ap=g.mM.create({displayNameIcon:{color:Vt.TG}})
var ip=n(537623),sp=n(745826),rp=n(306)
const op=[Sn.FP.COUNT,Sn.FP.MEAN,Sn.FP.SUM]
function AggregationConfigEditor({parameters:e,onUpdateParameters:t}){return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Aggregation"}),d.createElement(rp.qF,{allowNull:!0,onChange:n=>{t({...e,aggregationType:n,errorBarType:null==n?null:e.errorBarType})},searchable:!1,selectedValue:e.aggregationType,values:op,valueToReadable:e=>ed.CA[e]}))}const lp={[Sn.JG.STACKED]:"/static/img/insights/stacked_bar_chart.svg",[Sn.JG.STANDARD]:"/static/img/insights/grouped_bar_chart.svg"},cp={[Sn.JG.STACKED]:"Stacked bar chart",[Sn.JG.STANDARD]:"Grouped bar chart"},dp=[Sn.JG.STANDARD,Sn.JG.STACKED]
function BarChartTypeConfigEditorComponent({onUpdateParameters:e,parameters:t}){return d.createElement("div",{className:(0,g.iv)(up.typeOptionsWrapper)},dp.map((n=>d.createElement(P.ZP,{key:n,title:cp[n]},d.createElement("img",{alt:cp[n],className:(0,g.iv)(up.typeOption,t.barChartType===n&&up.activeTypeOption),onClick:()=>{e({barChartType:n})},src:(0,me.Z)(lp[n])})))))}const up=g.mM.create({typeOptionsWrapper:{marginBottom:ip.mR,marginLeft:ip.mR},typeOption:{background:Vt.bs,borderColor:Vt.tN,borderStyle:"solid",borderRadius:4,borderWidth:1,cursor:"pointer",marginRight:6,width:32,height:32},activeTypeOption:{background:Vt.ip,borderColor:Vt.t0}})
var mp=n(314670)
function ErrorBarConfigEditor({warning:e=null,parameters:t,onUpdateParameters:n}){return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:d.createElement(d.Fragment,null,"Error bars",e&&d.createElement(P.ZP,{title:e},d.createElement(mp.Z,{className:"u-tiny-spacing-left"})))}),d.createElement(rp.qF,{allowNull:!0,errorMessage:null==t.aggregationType?"Error bars can only be calculated for aggregated points":null,onChange:e=>{n({...t,errorBarType:e})},searchable:!1,selectedValue:t.errorBarType,values:[Sn.dA.STANDARD_DEVIATION,Sn.dA.STANDARD_ERROR],valueToReadable:e=>ed.Xr[e]}))}var pp=n(703350)
function SortDirectionConfigEditor({warning:e=null,parameters:t,onUpdateParameters:n}){var a
return d.createElement("div",null,d.createElement(Fr.Z,{label:d.createElement(d.Fragment,null,"Sort Direction",e&&d.createElement(P.ZP,{title:e},d.createElement(mp.Z,{className:"u-tiny-spacing-left"})))}),d.createElement(rp.qF,{allowNull:!0,onChange:e=>{n({...t,sortDirection:e})},searchable:!1,selectedValue:null!==(a=t.sortDirection)&&void 0!==a?a:null,values:[Sn.SM.ASCENDING,Sn.SM.DESCENDING],valueToReadable:e=>ed.SM[e]}))}function XYSeriesColumnEditor(e){return d.createElement(d.Fragment,null,d.createElement(XYColumnEditor,{...e}),d.createElement(SeriesColumnEditor,{...e}))}function SeriesColumnEditor({columns:e,onUpdateParameters:t,parameters:n,errorMessage:a=null,useSystemNames:i}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Series"}),d.createElement(rp.ZP,{allowNull:!0,errorMessage:a,onChange:function handleSelectSeriesColumnName(e){t({seriesColumnName:e})},searchable:!0,selectedValue:n.seriesColumnName,optionDatas:(0,pp.O)(e,i)})))}function AxisEditorSubMenu({children:e}){return d.createElement("div",{className:(0,g.iv)(hp.axisSubOptionsContainer)},e)}function XYColumnEditor(e){const{columns:t,fieldLabels:n={x:"X-Axis",y:"Y-Axis"},onUpdateParameters:a,reverseDisplayedAxes:i=!1,isSortable:s=!1,parameters:r,useSystemNames:o}=e,[l,c]=(0,d.useState)(!1)
function handleSelectXAxisColumnName(e){a({xAxisColumnName:e})}const u=(0,pp.O)(t,o),m=s?d.createElement(d.Fragment,null,d.createElement(rp.ZP,{allowNull:!1,onChange:handleSelectXAxisColumnName,searchable:!0,selectedValue:r.xAxisColumnName,optionDatas:u,settingsIconProps:{isActive:l,onClick:()=>{c(!l)}}}),l&&d.createElement(AxisEditorSubMenu,null,d.createElement(SortDirectionConfigEditor,{...e}))):d.createElement(rp.ZP,{allowNull:!1,onChange:handleSelectXAxisColumnName,searchable:!0,selectedValue:r.xAxisColumnName,optionDatas:u}),p=d.createElement(rp.ZP,{allowNull:!1,onChange:function handleSelectYAxisColumnName(e){a({yAxisColumnName:e})},searchable:!0,selectedValue:r.yAxisColumnName,optionDatas:u})
return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:i?n.y:n.x}),i?p:m),d.createElement("div",{className:"u-input-spacing-top"},d.createElement("div",{className:"u-lr-split"},d.createElement(Fr.Z,{label:i?n.x:n.y}),d.createElement("div",{className:(0,g.iv)(hp.swapButton)},d.createElement(C.Co,{icon:"arrow-up-down",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:function handleSwapAxisColumnNames(){a({xAxisColumnName:r.yAxisColumnName,yAxisColumnName:r.xAxisColumnName})},dataTestAttrs:{component:"XYSeriesColumnEditor",element:"swapButton"}}))),i?m:p))}const hp=g.mM.create({swapButton:{marginTop:-15},xAxisSelectorGroup:{display:"flex",flexDirection:"row"},xAxisDropdownContainer:{flexGrow:1},axisSubOptionsContainer:{border:`1px solid ${Vt.pF}`,backgroundColor:Vt.bs,padding:"6px",marginTop:"6px",borderRadius:"0 0 6px 6px"},axisSubMenuButton:{marginLeft:"6px"}})
var gp=n(137975)
function YAxisRangeConfigEditor({onUpdateParameters:e,parameters:t,warning:n}){const[a,i]=(0,d.useState)(t.yAxisMin),[s,r]=(0,d.useState)(t.yAxisMax)
const o=useThrottle(a,300),l=useThrottle(s,300);(0,d.useEffect)((()=>{t.yAxisMin===o&&t.yAxisMax===l||(null==o||null==l||o<l)&&e({yAxisMin:o,yAxisMax:l})}),[e,t,o,l])
return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:d.createElement(d.Fragment,null,"Y-Axis Range",n&&d.createElement(P.ZP,{title:n},d.createElement(mp.Z,{className:"u-tiny-spacing-left"})))}),d.createElement("div",{className:(0,g.iv)(Ep.numericInputsWrapper)},d.createElement(gp.A,{className:"u-mini-spacing-left",onChange:e=>{!function handleOnChangeMin(e){i(e)}(e.target.numericValue)},placeholder:"Min",value:a}),d.createElement(gp.A,{className:"u-mini-spacing-left",onChange:e=>{!function handleOnChangeMax(e){r(e)}(e.target.numericValue)},placeholder:"Max",value:s})),null!=a&&null!=s&&s<=a&&d.createElement(Dt.Z,{message:`Max needs to be greater than ${a}`}))}const Ep=g.mM.create({numericInputsWrapper:{display:"flex"}})
var fp
!function(e){e.SETUP_TAB="SETUP_TAB"
e.ANALYSIS_TAB="ANALYSIS_TAB"
e.FORMAT_TAB="FORMAT_TAB"}(fp||(fp={}))
const Sp=(0,xl.ZP)({})
function TabbedConfigEditorSkeleton({setupTabContent:e,analysisTabContent:t,formatTabContent:n,visualizationConfigId:a,visualizationType:i}){var s;(0,S.Gp)(null!=e||null!=t||null!=n,"Expected at least one of setupTabContent, analysisTabContent, or formatTabContent to be specified")
const[r,o]=Sp.useGlobalClientState(a),l=null!==(s=r[i])&&void 0!==s?s:fp.SETUP_TAB
return d.createElement(sp.Xl,{activeTab:l,onRequestTabChange:function changeTab(e){o({...r,[i]:e})},className:(0,g.iv)(yp.wrapper),navClassName:(0,g.iv)(yp.header),paneClassName:f()("scrollbar-override",(0,g.iv)(yp.pane))},e&&d.createElement(sp.OK,{tabKey:fp.SETUP_TAB,title:"Setup"},e),t&&d.createElement(sp.OK,{tabKey:fp.ANALYSIS_TAB,title:"Analysis"},t),n&&d.createElement(sp.OK,{tabKey:fp.FORMAT_TAB,title:"Format"},n))}const yp=g.mM.create({wrapper:{overflowY:"auto",display:"flex",flexDirection:"column"},header:{padding:`0px ${ip.mR}px`},pane:{marginTop:0,padding:`0px ${ip.mR}px ${ip.mR}px ${ip.mR}px`,overflowY:"auto"}})
function MetricColumnEditor({columns:e,onUpdateParameters:t,parameters:n,useSystemNames:a}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Metric"}),d.createElement(rp.ZP,{allowNull:!1,onChange:function handleSelectMetricColumnName(e){t({metricColumnName:e})},searchable:!0,selectedValue:n.metricColumnName,optionDatas:(0,pp.O)(e,a)})))}function AscendingOrderCheckbox({onUpdateParameters:e,parameters:t}){return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Io.Z,{id:"ascending-order",label:"Use ascending gradient",onChange:t=>{e({gradientDirection:t.target.checked?Sn._G.ASCENDING_METRIC_VALUES:Sn._G.DESCENDING_METRIC_VALUES})},checked:t.gradientDirection===Sn._G.ASCENDING_METRIC_VALUES}))}function Continuous2DChartConfigEditor({onUpdateParameters:e,parameters:t}){return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Io.Z,{id:"yAxisIncludes0",label:"Y-axis scale includes 0",onChange:t=>{e({yAxisIncludesZero:t.target.checked})},checked:t.yAxisIncludesZero}))}var bp=n(944309)
const Tp=[Vt.Ej,Vt.Zl,Vt.ud,Vt.xO,Vt.nQ,Vt.t0,Vt.hM,"#EAC76C","#0C8697","#A2B9BE","#5293FF","#FF7280","#FFCB90","#90DED6","#C9E4EB","#6BA1FF","#FF949F","#CA4F28","#57AFC2","#E5BFEE","#7387CF","#FFCF52","#8B271C","#67B897","#B459B6","#B5C5FF","#5F44AD","#879CA0","#8ACFCB","#3C5A62"],vp=[Vt.nQ,Vt.Ej],Cp=Vt.Ej,Ip=_n.cf.fontSize,wp=_n.cf.lineHeight,Np=Ip*wp,Ap=15,Rp=8+Ip,Pp=Rp+11+Ip,Op={top:Ap,right:Ap,bottom:Pp,left:Ip+11+30+8},xp={strokeWidth:1,stroke:Vt.pF},_p={strokeWidth:1,stroke:Vt.tN},Dp={fontSize:Ip,lineHeight:wp,fontFamily:_n.I3,fontWeight:_n.hS,fill:Vt.Rl},Lp=Vt.Rl,kp=Vt.tN,Mp=Vt.TG,Fp=Vt.pF,Zp=[Vt.ip,Vt.Ej],Bp=Vt.pp,qp=Vt.TG,Vp=Vt.ZA,Up={[Sn.BL.DISCRETE]:function DiscreteColorPalette(){return d.createElement("div",{className:(0,g.iv)(Gp.palette)},Tp.slice(0,8).map((e=>d.createElement("span",{key:e,className:(0,g.iv)(Gp.colorBlock),style:{backgroundColor:e}}))))},[Sn.BL.GRADIENT]:function GradientColorPalette(){return d.createElement("div",{className:(0,g.iv)(Gp.palette)},d.createElement("svg",{height:12,width:170},d.createElement(bp.Z,{id:"gradient-color-palette",from:vp[0],to:vp[1],rotate:-90}),d.createElement("rect",{fill:"url(#gradient-color-palette)",height:12,width:170})))}}
function ColorPaletteConfigEditor({parameters:e,onUpdateParameters:t}){return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Color palette"}),d.createElement(rp.qF,{allowNull:!1,errorMessage:null==e.seriesColumnName?"Select series to configure color palette":null,onChange:function handleUpdateColorPalette(n){e.colorPalette!==n&&t({...e,colorPalette:n})},searchable:!1,selectedValue:e.colorPalette,values:[Sn.BL.DISCRETE,Sn.BL.GRADIENT],valueToReadable:e=>Up[e]()}))}const Gp=g.mM.create({colorBlock:{height:16,width:16,marginRight:6},palette:{display:"flex",justifyContent:"flex-start",alignItems:"center"}})
function FormatConfigEditor({onUpdateParameters:e,parameters:t}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"X-Axis"}),d.createElement(Io.Z,{id:"x-axis-log-scale",label:"Log scale",className:"u-mini-spacing-top",onChange:t=>{e({xAxisScale:t.target.checked?Sn.gA.LOG:Sn.gA.LINEAR})},checked:t.xAxisScale===Sn.gA.LOG})),d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{className:"u-small-spacing-top",label:"Y-Axis"}),d.createElement(Io.Z,{id:"y-axis-log-scale",label:"Log scale",className:"u-mini-spacing-top",onChange:t=>{e({yAxisScale:t.target.checked?Sn.gA.LOG:Sn.gA.LINEAR})},checked:t.yAxisScale===Sn.gA.LOG}),d.createElement(Io.Z,{id:"y-axis-includes-0",label:"Include 0",className:"u-small-spacing-top",onChange:t=>{e({yAxisIncludesZero:t.target.checked})},checked:t.yAxisIncludesZero}),d.createElement(YAxisRangeConfigEditor,{onUpdateParameters:e,parameters:t,warning:t.yAxisIncludesZero&&(t.yAxisMax||t.yAxisMin)?"Including 0 on the y-axis might override the set range":null})))}var zp=n(125440)
function MaskConfigEditor({columns:e,onUpdateParameters:t,parameters:n,useSystemNames:a}){const[i,s]=(0,d.useState)(null!=n.rowIdColumnName)
return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Io.Z,{id:"allow-point-masking",label:"Allow point masking",onChange:function handleToggleMasking(){const n=!i
s(n)
t(n?{rowIdColumnName:a?e[0].systemName:e[0].displayName}:{rowIdColumnName:null})},checked:i})),d.createElement("div",{className:"u-spacing-left"},i&&d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Unique ID Field"}),d.createElement(zp.Z,{renderContent:()=>d.createElement("div",{className:"u-normal-font-weight"},"Masked points will be tied to the unique ID field you select"),placement:ne.ZH.TOP,iconClassName:"u-mini-spacing-left",interaction:ne.x2.HOVER}),d.createElement(rp.ZP,{allowNull:!1,onChange:function handleSelectIdColumnName(e){t({rowIdColumnName:e})},searchable:!0,selectedValue:n.rowIdColumnName,optionDatas:(0,pp.O)(e,a)}))))}const $p={[Sn.bK.DETECT]:"Detect",[Sn.bK.EXCLUDE]:"Detect and exclude"}
var Wp=n(771701)
function SliderLabels({minLabel:e,maxLabel:t}){return d.createElement("div",{className:(0,g.iv)(Hp.labelsWrapper)},d.createElement("div",{className:(0,g.iv)(Hp.labelText)},e),d.createElement("div",{className:(0,g.iv)(Hp.labelText,Hp.maxLabelText)},t))}function LabeledSlider({min:e,minLabel:t,max:n,maxLabel:a,onChange:i,step:s,value:r}){(0,S.Gp)(s>0,"step parameter must be greater than 0");(0,S.Gp)((n-e)%s==0,"max - min should be evenly divisible by the step value");(0,S.Gp)(e<=r&&r<=n,"value must be between min and max (inclusive)");(0,S.Gp)((r-e)%s==0,"value must equal min + step * n")
return d.createElement(d.Fragment,null,d.createElement(Wp.Z,{range:!0,dots:(n-e)/s<25,min:e,max:n,onChange:i,step:s,value:r,handleStyle:{backgroundColor:Vt.t0,border:0,boxShadow:"none",marginTop:-4,height:12,width:12},dotStyle:{backgroundColor:Vt.tN,border:0},railStyle:{backgroundColor:Vt.tN}}),d.createElement(SliderLabels,{minLabel:t,maxLabel:a}))}const Hp=g.mM.create({labelsWrapper:{alignItems:"center",display:"flex",justifyContent:"space-between",marginTop:2},labelText:{..._n.cf,lineHeight:"16px"},maxLabelText:{textAlign:"right"}})
function getOutlierSetting(e){var t
return null!==(t=null==e?void 0:e.outlierSetting)&&void 0!==t?t:null}const jp=[Sn.bK.DETECT,Sn.bK.EXCLUDE],Yp={0:.001,1:.002,2:.005,3:.01,4:.02,5:.05,6:.1},Qp={.001:0,.002:1,.005:2,.01:3,.02:4,.05:5,.1:6}
function OutlierConfigEditor({parameters:e,onUpdateParameters:t,errorMessage:n}){var a,i
const[s,r]=(0,d.useState)(e.outlierConfig),[o,l]=(0,d.useState)((null===(a=e.outlierConfig)||void 0===a?void 0:a.qValue)&&null!==(i=Qp[e.outlierConfig.qValue])&&void 0!==i?i:3),c=(0,Su.N)(o,300);(0,d.useEffect)((()=>{r(e.outlierConfig)}),[e]);(0,d.useEffect)((()=>{var n
const a=null!==(n=Yp[c])&&void 0!==n?n:.01
if(null!=e.outlierConfig&&e.outlierConfig.qValue!==a){r({...e.outlierConfig,qValue:a})
t({...e,outlierConfig:{...e.outlierConfig,qValue:a}})}}),[t,e,c])
return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Outliers"}),d.createElement(Oe.Z,{renderContent:()=>"Excluded outliers are omitted from regressions, aggregations, and error bars."},d.createElement("span",null,d.createElement(pe.Z,{className:(0,g.iv)(Kp.outlierInfo),icon:"more-info"}))),d.createElement("div",{className:"u-vertical-center-items"},d.createElement("div",{className:"u-flex-grow"},d.createElement(rp.qF,{allowNull:!0,errorMessage:n,onChange:function handleUpdateOutlierSetting(n){getOutlierSetting(e.outlierConfig)!==n&&t({...e,outlierConfig:n?{__typename:"OutlierConfigNode",outlierSetting:n,qValue:Yp[c]}:null})},searchable:!1,selectedValue:getOutlierSetting(e.outlierConfig),values:jp,valueToReadable:e=>$p[e],nullOptionName:"Don't detect"}))),null!=getOutlierSetting(s)&&d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Sensitivity"}),d.createElement(LabeledSlider,{min:0,minLabel:d.createElement(d.Fragment,null,"Fewer",d.createElement("br",null),"outliers"),max:6,maxLabel:d.createElement(d.Fragment,null,"More",d.createElement("br",null),"outliers"),onChange:l,step:1,value:o})))}const Kp=g.mM.create({outlierInfo:{color:Vt.TG,marginLeft:3,marginTop:3}})
var Jp,Xp=n(181412)
!function(e){e.INLINE="INLINE"
e.BLOCK="BLOCK"}(Jp||(Jp={}))
const eh=null
function LatexEquation({equation:e,displayMode:t}){const a=(0,d.useRef)(null);(0,d.useEffect)((()=>{n.e(793).then(n.t.bind(n,479583,23)).then((t=>{var n
a.current&&(null!==(n=eh)&&void 0!==n?n:t.render)(e,a.current,{throwOnError:!1})}))}),[e,t])
return t===Jp.INLINE?d.createElement("span",{ref:a}):d.createElement("div",{ref:a})}var th=n(289924)
const nh={[ep.ZZ.LOGISTIC]:String.raw`Y = \text{min} + \frac{\text{max} - \text{min}}{1+(\text{IC50}/X)^\text{slope}}`}
function RegressionConfigModalModelSection(e){return d.createElement(d.Fragment,null,d.createElement(so.Dx,null,"Model"),d.createElement("p",null,Xp.ew[e.regressionType]),d.createElement("div",{className:(0,g.iv)(ah.descriptionWrapper,ah.proxima15)},d.createElement(LatexEquation,{displayMode:Jp.BLOCK,equation:nh[e.regressionType]})),d.createElement(so.Dx,{className:"u-small-spacing-top"},"Fitting algorithm"),d.createElement("p",null,"Least squares"),d.createElement("div",{className:(0,g.iv)(ah.descriptionWrapper)},d.createElement(th.Z,{href:"https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html",target:"_new"},"See details")," ","on how the regression is calculated using the least squares fitting algorithm."))}const ah=g.mM.create({proxima15:_n.H5,descriptionWrapper:{backgroundColor:Vt.bs,borderRadius:4,color:Vt.pp,marginBottom:20,padding:"8px 8px 8px 16px"}})
var ih=n(712315)
const sh={numericValue:null,value:"",isValid:!0},rh={[ep.JV.MIN]:"Min",[ep.JV.MAX]:"Max",[ep.JV.IC50]:"IC50",[ep.JV.HILL_SLOPE]:"Slope"},oh={[ep.JV.IC50]:{min:0,minIsInclusive:!1}}
function numericInputValueIsComplete({isValid:e,numericValue:t}){return e&&Number.isFinite(t)}function getParameterConstraintInputStates(e){const{type:t}=e
switch(t){case ep.Ew.NONE:return[]
case ep.Ew.EQUAL:return[e.value]
case ep.Ew.LESS_THAN:return[e.upperBound]
case ep.Ew.GREATER_THAN:return[e.lowerBound]
case ep.Ew.BETWEEN:return[e.lowerBound,e.upperBound]
default:(0,S.Gp)(!1,`Unexpected constraint ${(0,Go.vE)(t)}`)
return[]}}function regressionConfigModalStateIsValid(e){return e.parameterCustomizations.every((({name:e,constraint:t,initialValue:n})=>function regressionParameterConstraintIsValid(e,t){const n=getParameterConstraintInputStates(t)
return!(t.type===ep.Ew.BETWEEN&&t.lowerBound.numericValue>=t.upperBound.numericValue)&&n.every((t=>numericInputValueIsComplete(t)&&!hasParameterValueError(e,t.value)))}(e,t)&&function regressionParameterInitialValueIsValid(e,t){return!t.userDefined||numericInputValueIsComplete(t.value)&&!hasParameterValueError(e,t.value.value)}(e,n)))}const lh={[ep.JV.IC50]:e=>{const t=parseFloat(e)
return!Number.isNaN(t)&&t<=0?"IC50 values must be positive.":null}}
function getParameterValueErrorMessage(e,t){const n=lh[e]
return null!=n?n(t):null}function hasParameterValueError(e,t){return null!=getParameterValueErrorMessage(e,t)}function InitialValuesEditorRow({labelContent:e,checkboxContent:t,inputContent:n,errorContent:a,className:i}){return d.createElement(d.Fragment,null,d.createElement("div",{className:f()((0,g.iv)(ch.rowWrapper),"u-vertical-center-items",i)},d.createElement("div",{className:(0,g.iv)(ch.label)},e),d.createElement("div",{className:(0,g.iv)(ch.checkbox)},t),d.createElement("div",{className:(0,g.iv)(ch.input)},n)),a)}function RegressionConfigInitialValuesEditor(e){return d.createElement(d.Fragment,null,d.createElement(InitialValuesEditorRow,{labelContent:null,checkboxContent:"Set automatically",inputContent:null,errorContent:null,className:"u-input-spacing-top",key:"header"}),e.regressionConfigState.parameterCustomizations.map((({constraint:t,name:n,initialValue:a},i)=>{function handleChange(t){e.onChangeRegressionConfigState((0,tm.ZP)(e.regressionConfigState,(e=>{e.parameterCustomizations[i].initialValue=t})))}const s=t.type===ep.Ew.EQUAL,r=d.createElement(P.ZP,{title:s?"Initial value cannot be set because this parameter is already constrained to a value.":"",disabled:!s},d.createElement(Io.Z,{id:`${n}-initial-value-checkbox`,className:(0,g.iv)(ch.checkboxInput),label:"",checked:!a.userDefined,disabled:s,onChange:e=>{e.target.checked?handleChange({userDefined:!1}):handleChange({userDefined:!0,value:sh})}})),o=oh[n],l=d.createElement(gp.A,{value:a.userDefined?a.value.value:"",onChange:e=>{handleChange({userDefined:!0,value:e.target})},isDisabled:!a.userDefined,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,...o}),c=a.userDefined&&!a.value.isValid?d.createElement(Dt.Z,{message:getParameterValueErrorMessage(n,a.value.value)}):null
return d.createElement(InitialValuesEditorRow,{labelContent:rh[n],checkboxContent:r,inputContent:l,errorContent:c,className:0===i?"u-small-spacing-top":"u-input-spacing-top",key:n})})))}const ch=g.mM.create({rowWrapper:{display:"flex"},label:{fontWeight:"bold",width:80},checkbox:{width:120,textAlign:"center"},checkboxInput:{justifyContent:"center"},input:{width:120,marginLeft:40}}),dh={[ep.Ew.NONE]:"None",[ep.Ew.EQUAL]:"Is equal to",[ep.Ew.LESS_THAN]:"Is less than",[ep.Ew.GREATER_THAN]:"Is greater than",[ep.Ew.BETWEEN]:"Is between"},uh={[ep.Ew.NONE]:{type:ep.Ew.NONE},[ep.Ew.EQUAL]:{type:ep.Ew.EQUAL,value:sh},[ep.Ew.LESS_THAN]:{type:ep.Ew.LESS_THAN,upperBound:sh},[ep.Ew.GREATER_THAN]:{type:ep.Ew.GREATER_THAN,lowerBound:sh},[ep.Ew.BETWEEN]:{type:ep.Ew.BETWEEN,upperBound:sh,lowerBound:sh}}
function getConstraintErrorMessage(e,t){const n=getParameterConstraintInputStates(t).reduce(((t,n)=>null!=t?t:getParameterValueErrorMessage(e,n.value)),null)
return null!=n?n:t.type===ep.Ew.BETWEEN?function getBetweenConstraintError({lowerBound:e,upperBound:t}){const n=(0,Jt.p3)(t.value)
return null!=e.numericValue&&null!=n&&n<=e.numericValue?`Upper bound must be greater than ${e.numericValue}`:null}(t):null}function ParameterConstraintNumericInputs({constraint:e,onChange:t,parameterName:n}){const a={className:f()((0,g.iv)(mh.numericInput),"u-spacing-right"),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,...oh[n]}
switch(e.type){case ep.Ew.NONE:return null
case ep.Ew.EQUAL:return d.createElement(gp.A,{...a,onChange:n=>{t({...e,value:n.target})},value:e.value.value})
case ep.Ew.LESS_THAN:return d.createElement(gp.A,{...a,onChange:n=>{t({...e,upperBound:n.target})},value:e.upperBound.value})
case ep.Ew.GREATER_THAN:return d.createElement(gp.A,{...a,onChange:n=>{t({...e,lowerBound:n.target})},value:e.lowerBound.value})
case ep.Ew.BETWEEN:{const{upperBound:n,lowerBound:i}=e
return d.createElement(d.Fragment,null,d.createElement(gp.A,{...a,onChange:n=>{t({...e,lowerBound:n.target})},value:i.value}),d.createElement(gp.A,{...a,onChange:n=>{t({...e,upperBound:n.target})},value:n.value}))}default:(0,S.hu)(!1,`Unexpected constraint ${(0,Go.vE)(e)}`,e)}}function RegressionParameterConstraintEditor(e){return d.createElement(d.Fragment,null,d.createElement("div",{className:f()((0,g.iv)(mh.wrapper),"u-vertical-center-items")},d.createElement("div",{className:f()((0,g.iv)(mh.label),"u-spacing-right")},rh[e.parameterName]),d.createElement("div",{className:f()((0,g.iv)(mh.typeSelector),"u-spacing-right")},d.createElement(rp.qF,{allowNull:!1,onChange:t=>{e.onChange(uh[t])},selectedValue:e.constraint.type,values:[ep.Ew.NONE,ep.Ew.EQUAL,ep.Ew.LESS_THAN,ep.Ew.GREATER_THAN,ep.Ew.BETWEEN],searchable:!1,valueToReadable:e=>dh[e]})),d.createElement("div",{className:(0,g.iv)(mh.numericInputsWrapper)},d.createElement(ParameterConstraintNumericInputs,{...e}))),d.createElement(Dt.Z,{message:getConstraintErrorMessage(e.parameterName,e.constraint)}))}const mh=g.mM.create({wrapper:{display:"flex"},label:{width:45,fontWeight:"bold"},typeSelector:{width:150},numericInputsWrapper:{flexShrink:1},numericInput:{width:120}}),ph={component:"RegressionConfigModalParameterSection"}
function RegressionConfigModalParameterSection(e){return d.createElement("div",{...(0,ee.Z)({...ph,element:"root"})},d.createElement(so.Dx,null,"Constrain parameter values"),e.regressionConfigState.parameterCustomizations.map((({name:t,constraint:n},a)=>d.createElement("div",{className:"u-input-spacing-top",key:t,...(0,ee.Z)({...ph,element:"editor",key:t})},d.createElement(RegressionParameterConstraintEditor,{parameterName:t,constraint:n,onChange:t=>{e.onChangeRegressionConfigState((0,tm.ZP)(e.regressionConfigState,(e=>{e.parameterCustomizations[a].constraint=t
t.type===ep.Ew.EQUAL&&(e.parameterCustomizations[a].initialValue={userDefined:!1})})))}})))),d.createElement("div",{className:"u-input-spacing-top u-text-align-right"},d.createElement(th.Z,{onClick:()=>{e.onChangeRegressionConfigState({...e.regressionConfigState,showAdvancedSettings:!e.regressionConfigState.showAdvancedSettings})}},e.regressionConfigState.showAdvancedSettings?"Hide advanced settings":"Show advanced settings")),e.regressionConfigState.showAdvancedSettings&&d.createElement(d.Fragment,null,d.createElement("hr",null),d.createElement(so.Dx,null,"Initial parameter values"," ",d.createElement(ih.Z,{className:(0,g.iv)(hh.initialParameterValueHelpIcon),text:"Poor initial values may lead to a suboptimal solution, so we recommend letting Benchling automatically suggest initial parameter values based on your data."})),d.createElement(RegressionConfigInitialValuesEditor,{regressionConfigState:e.regressionConfigState,onChangeRegressionConfigState:e.onChangeRegressionConfigState})))}const hh=g.mM.create({initialParameterValueHelpIcon:{transform:"translateY(-1px)"}}),gh=[1]
var Eh
!function(e){e.MODEL="MODEL"
e.PARAMETERS="PARAMETERS"}(Eh||(Eh={}))
const fh=[ep.ZZ.LOGISTIC]
function isRegressionConfigModalSupportedConfig(e){var t
return fh.includes(null!==(t=null==e?void 0:e.regressionType)&&void 0!==t?t:null)}function numberToNumericInputState(e){return{isValid:!0,numericValue:e,value:e.toString()}}function regressionConstraintToModalStateConstraint(e){switch(e.type){case ep.Ew.NONE:return e
case ep.Ew.EQUAL:return{type:e.type,value:numberToNumericInputState(e.value)}
case ep.Ew.LESS_THAN:return{type:e.type,upperBound:numberToNumericInputState(e.upperBound)}
case ep.Ew.GREATER_THAN:return{type:e.type,lowerBound:numberToNumericInputState(e.lowerBound)}
case ep.Ew.BETWEEN:return{type:e.type,lowerBound:numberToNumericInputState(e.lowerBound),upperBound:numberToNumericInputState(e.upperBound)}
default:(0,S.hu)(!1,"Got unexpected constraint type",{constraint:(0,Go.vE)(e)})}}function modalStateConstraintToRegressionConfigConstraint(e){switch(e.type){case ep.Ew.NONE:return{type:e.type}
case ep.Ew.EQUAL:return{type:e.type,value:e.value.numericValue}
case ep.Ew.LESS_THAN:return{type:e.type,upperBound:e.upperBound.numericValue}
case ep.Ew.GREATER_THAN:return{type:e.type,lowerBound:e.lowerBound.numericValue}
case ep.Ew.BETWEEN:return{type:e.type,lowerBound:e.lowerBound.numericValue,upperBound:e.upperBound.numericValue}
default:(0,S.hu)(!1,"Got unexpected constraint type on",{constraint:(0,Go.vE)(e)})}}function convertRegressionConfigToModalState({version:e,parameterCustomizations:t}){if(!gh.includes(e)){!function showRefreshBenchlingToast(){v.ZP.info("A newer version of Benchling is available.",{actionText:"Refresh",closeable:!1,onActionClick:()=>{window.location.reload()}})}()
throw new Error("Got unsupported regressionConfig version")}return{parameterCustomizations:t.map((({name:e,initialValue:t,constraint:n})=>({name:e,constraint:regressionConstraintToModalStateConstraint(n),initialValue:null==t?{userDefined:!1}:{userDefined:!0,value:numberToNumericInputState(t)}}))),showAdvancedSettings:t.some((({initialValue:e})=>null!=e))}}function hasParameterCustomizations({parameterCustomizations:e}){return e.some((e=>null!=e.initialValue||e.constraint.type!==ep.Ew.NONE))}function RegressionConfigModal({onRequestClose:e,onRequestSubmit:t,regressionConfig:n}){(0,S.hu)(isRegressionConfigModalSupportedConfig(n),"Got unsupported regression type",{regressionType:n.regressionType})
const[a,i]=(0,d.useState)(function chooseInitialTab(e){return hasParameterCustomizations(e)?Eh.PARAMETERS:Eh.MODEL}(n)),[s,r]=(0,d.useState)(convertRegressionConfigToModalState(n))
return d.createElement(et.ZP,{onRequestClose:e,onRequestSubmit:()=>{(0,S.hu)(regressionConfigModalStateIsValid(s),"Tried to submit modal with invalid state",{regressionConfigModalState:s})
t(function convertModalStateToRegressionConfig(e){return{regressionType:ep.ZZ.LOGISTIC,parameterCustomizations:e.parameterCustomizations.map((({name:e,initialValue:t,constraint:n})=>({name:e,initialValue:t.userDefined?t.value.numericValue:null,constraint:modalStateConstraintToRegressionConfigConstraint(n)}))),version:1}}(s))},buttons:[{text:"Save",submit:!0,style:C.ZJ.SECONDARY,disabled:!regressionConfigModalStateIsValid(s)}],title:"Regression settings",className:(0,g.iv)(Sh.wrapper)},d.createElement(sp.Xl,{activeTab:a,onRequestTabChange:i},d.createElement(sp.OK,{tabKey:Eh.MODEL,title:"Model"},d.createElement(RegressionConfigModalModelSection,{regressionType:n.regressionType})),d.createElement(sp.OK,{tabKey:Eh.PARAMETERS,title:"Parameters"},d.createElement(RegressionConfigModalParameterSection,{regressionConfigState:s,onChangeRegressionConfigState:r}))))}const Sh=g.mM.create({wrapper:{..._n.cf}})
var yh=n(994495)
function RegressionSettingsIcon({regressionConfig:e,onRequestSubmit:t}){const n=hasParameterCustomizations(e),a=n?"Custom regression applied":"Customize regression"
return d.createElement(P.ZP,{title:a},d.createElement(yh.Z,{className:"u-small-spacing-left",highlighted:n,onClick:()=>{(0,Xn.Z)(RegressionConfigModal,{regressionConfig:e,onRequestSubmit:t})}}))}const bh=[ep.ZZ.LINEAR,ep.ZZ.LOGISTIC]
function RegressionConfigEditor({parameters:e,onUpdateParameters:t,errorMessage:n}){return d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Regression line"}),d.createElement("div",{className:"u-vertical-center-items"},d.createElement("div",{className:"u-flex-grow"},d.createElement(rp.qF,{allowNull:!0,errorMessage:n,onChange:function handleUpdateRegression(n){getRegressionTypeFromConfig(e.regressionConfig)!==n&&t({...e,regressionConfig:n?Xp.N2[n]:null})},searchable:!1,selectedValue:getRegressionTypeFromConfig(e.regressionConfig),values:bh,valueToReadable:e=>Xp.ew[e]})),isRegressionConfigModalSupportedConfig(e.regressionConfig)&&d.createElement(RegressionSettingsIcon,{regressionConfig:e.regressionConfig,onRequestSubmit:function handleRequestSubmit(n){t({...e,regressionConfig:n})}})))}const Th=Sn.S1.TOP
const vh={__typename:"AnalyticsVisualizationNode",id:"stub_id",parameters:{__typename:"AnalyticsVisualizationTableParametersNode",displayColumnsJson:null}},Ch={[cu.nB.BAR_CHART]:function BarChartConfigEditor(e){const{onUpdateParameters:t,parameters:n,visualizationConfig:{id:a}}=e
return d.createElement(d.Fragment,null,d.createElement(BarChartTypeConfigEditorComponent,{...e}),d.createElement(TabbedConfigEditorSkeleton,{setupTabContent:d.createElement(XYSeriesColumnEditor,{...e,isSortable:!0}),analysisTabContent:d.createElement(d.Fragment,null,d.createElement(AggregationConfigEditor,{parameters:n,onUpdateParameters:t}),d.createElement(ErrorBarConfigEditor,{parameters:n,onUpdateParameters:t,warning:n.barChartType===Sn.JG.STACKED?"Error bars can’t be displayed on stacked bar charts. The error calculation will still appear in the chart tooltip.":null})),formatTabContent:d.createElement(YAxisRangeConfigEditor,{parameters:n,onUpdateParameters:t}),visualizationConfigId:a,visualizationType:cu.nB.BAR_CHART}))},[cu.nB.HEATMAP]:function HeatmapConfigEditor(e){return d.createElement(d.Fragment,null,d.createElement(XYColumnEditor,{...e,fieldLabels:{x:"Columns",y:"Rows"},reverseDisplayedAxes:!0}),d.createElement(MetricColumnEditor,{...e}),d.createElement(AscendingOrderCheckbox,{...e}))},[cu.nB.LINE_CHART]:function LineChartConfigEditor(e){return d.createElement(d.Fragment,null,d.createElement(XYSeriesColumnEditor,{...e}),d.createElement(Continuous2DChartConfigEditor,{...e}))},[cu.nB.PIE_CHART]:function PieChartConfigEditor(e){const{onUpdateParameters:t,columns:n,parameters:a,visualizationConfig:i,useSystemNames:s}=e,r=a.aggregationType===Sn.FP.COUNT
return d.createElement(TabbedConfigEditorSkeleton,{setupTabContent:d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Slice"}),d.createElement(rp.ZP,{allowNull:!1,onChange:e=>{t({sliceColumnName:e})},searchable:!0,selectedValue:a.sliceColumnName,optionDatas:(0,pp.O)(n,s)})),d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Aggregation"}),d.createElement(rp.qF,{allowNull:!1,onChange:e=>{t({aggregationType:e})},searchable:!1,selectedValue:a.aggregationType,values:op,valueToReadable:e=>ed.CA[e]})),d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Measure"}),d.createElement(rp.ZP,{allowNull:r,errorMessage:r?'Measure column can not be set when aggregation is set to "Count".':null,onChange:e=>{t({measureColumnName:e})},searchable:!0,selectedValue:r?null:a.measureColumnName,optionDatas:(0,pp.O)(n,s)}))),formatTabContent:d.createElement(d.Fragment,null,d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Legend location"}),d.createElement(rp.qF,{allowNull:!0,onChange:e=>{t({legendLocation:e})},searchable:!1,selectedValue:a.legendLocation,values:[Sn.S1.LEFT,Sn.S1.RIGHT],valueToReadable:e=>ed.cY[e]})),d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Slice label"}),d.createElement(Io.Z,{id:"show-slice-name",label:"Slice name",className:"u-mini-spacing-top",onChange:e=>{t({showSliceNameInLabel:e.target.checked})},checked:a.showSliceNameInLabel}),d.createElement(Io.Z,{id:"show-percentage",label:"Percentage",className:"u-mini-spacing-top",onChange:e=>{t({showPercentageInLabel:e.target.checked})},checked:a.showPercentageInLabel}),d.createElement(Io.Z,{id:"show-value",label:"Value",className:"u-mini-spacing-top",onChange:e=>{t({showValueInLabel:e.target.checked})},checked:a.showValueInLabel}))),visualizationConfigId:i.id,visualizationType:cu.nB.PIE_CHART})},[cu.nB.SCATTER_PLOT]:function ScatterPlotConfigEditor(e){const{onUpdateParameters:t,isAnalysisTool:n,parameters:a,visualizationConfig:i}=e
return d.createElement(TabbedConfigEditorSkeleton,{setupTabContent:d.createElement(d.Fragment,null,d.createElement(XYColumnEditor,{...e}),d.createElement(SeriesColumnEditor,{...e,errorMessage:null!=getRegressionTypeFromConfig(a.regressionConfig)?"Remove the regression line to configure a series":null,onUpdateParameters:function handleUpdateSeries(e){let n=e
null==e.seriesColumnName&&(n={...n,colorPalette:ed.RR})
t(n)}}),d.createElement(ColorPaletteConfigEditor,{parameters:a,onUpdateParameters:t})),analysisTabContent:d.createElement(d.Fragment,null,!n&&d.createElement(RegressionConfigEditor,{...e,errorMessage:null!=a.seriesColumnName?"Remove the series configuration to add a regression line":null,onUpdateParameters:function handleUpdateRegression(e){t({...e,...(!e.regressionConfig||getRegressionTypeFromConfig(e.regressionConfig)!==ep.ZZ.LOGISTIC)&&{outlierConfig:null}})}}),d.createElement(AggregationConfigEditor,{parameters:a,onUpdateParameters:t}),d.createElement(ErrorBarConfigEditor,{parameters:a,onUpdateParameters:t}),!n&&d.createElement(OutlierConfigEditor,{...e,errorMessage:getRegressionTypeFromConfig(a.regressionConfig)!==ep.ZZ.LOGISTIC?"Apply a logistic regression line to detect outliers":null}),!n&&dt.ZP.INSIGHTS_ENABLE_POINT_MASKING&&null!=getRegressionTypeFromConfig(a.regressionConfig)&&d.createElement(MaskConfigEditor,{...e})),formatTabContent:d.createElement(d.Fragment,null,d.createElement(FormatConfigEditor,{...e}),null!=a.seriesColumnName&&d.createElement("div",{className:"u-input-spacing-top"},d.createElement(Fr.Z,{label:"Legend"}),d.createElement(Io.Z,{id:"show-legend",label:"Show legend",className:"u-mini-spacing-top",onChange:e=>{t({...a,legendLocation:e.target.checked?Th:null})},checked:null!=a.legendLocation}))),visualizationConfigId:i.id,visualizationType:cu.nB.SCATTER_PLOT})},[cu.nB.TABLE]:null},Ih={[cu.nB.BAR_CHART]:!0,[cu.nB.HEATMAP]:!1,[cu.nB.LINE_CHART]:!1,[cu.nB.PIE_CHART]:!0,[cu.nB.SCATTER_PLOT]:!0,[cu.nB.TABLE]:!1}
function VisualizationConfigEditor({columns:e,onChangeVisualizationConfig:t,visualizationConfig:n,chartTitleOptions:a,useSystemNames:i,disabledVisualizationTypes:s,isAnalysisTool:r=!1}){const o=function usePreviousVisualizationParametersByType(e){const[t,n]=(0,d.useState)({});(0,d.useEffect)((()=>{null!=e&&n((t=>({...t,[getVisualizationType(e)]:e.parameters})))}),[e])
return t}(n)
function handleUpdateVisualizationConfig(e){const a=updateVisualization(null!=n?n:vh,e)
t(a)}const l=null!=n?getVisualizationType(n):null,c=null!=l?Ch[l]:null,u=null!=l&&Ih[l]
return d.createElement("div",{className:(0,g.iv)(wh.wrapper)},d.createElement("div",{className:(0,g.iv)(wh.header)},d.createElement(Fr.Z,{label:r?"View type":"Chart type"}),d.createElement(VisualizationTypeSelector,{visualizationType:l,onChange:function handleUpdateType(t){var a
const s={...o[t],...null!==(a=null==n?void 0:n.parameters)&&void 0!==a?a:vh.parameters},r={...null!=n?n:vh,parameters:s}
handleUpdateVisualizationConfig(new tp[t](e,r,i).getUpdate())},disabledVisualizationTypes:s}),null!=a&&d.createElement(d.Fragment,null,d.createElement(Fr.Z,{className:"u-small-padding-top",label:"View title"}),d.createElement(or.Z,{value:a.visualizationName,onChange:e=>{a.onChangeVisualizationName(e.target.value)}}))),!u&&d.createElement(sp.I,null),null!=c&&d.createElement("div",{className:u?(0,g.iv)(wh.editorWithTabs):f()((0,g.iv)(wh.editorWithoutTabs),"scrollbar-override")},d.createElement(c,{columns:e,isAnalysisTool:r,onUpdateParameters:function handleUpdateParameters(e){handleUpdateVisualizationConfig({parameters:{...null!=n?n.parameters:{},...e}})},parameters:n.parameters,visualizationConfig:n,useSystemNames:i})))}const wh=g.mM.create({wrapper:{display:"flex",flexDirection:"column",overflowY:"auto"},header:{padding:ip.mR},editorWithTabs:{display:"flex",flexDirection:"column",overflowY:"auto"},editorWithoutTabs:{padding:`0px ${ip.mR}px ${ip.mR}px ${ip.mR}px`,overflowY:"auto"}})
var Nh,Ah,Rh,Ph=n(428171),Oh=n(683061),xh=n(523432),_h=n(219861),Dh=n(585887),Lh=n(270651),kh=n(297002)
!function(e){e.END="end"
e.MIDDLE="middle"
e.START="start"}(Nh||(Nh={}))
!function(e){e.BAND="band"
e.LINEAR="linear"
e.LOG="log"
e.POINT="point"
e.UTC="utc"}(Ah||(Ah={}))
!function(e){e.BOTTOM="bottom"
e.LEFT="left"
e.RIGHT="right"
e.TOP="top"}(Rh||(Rh={}))
const Mh={...xp,hideTicks:!0},Fh={...Dp,textAnchor:Nh.MIDDLE}
function getBaseVisxAxisProps({axisConfig:{label:e,scale:t,suggestedNumTicks:n,tickLabelFormatter:a},hideAxisLine:i=!1}){return{...Mh,hideAxisLine:i,label:e,numTicks:n,scale:t,tickFormat:a}}function getBottomAxisLabelTranslation(e){return{dy:0,y:e-3}}function getLeftAxisLabelTranslation(e){return{dx:0,y:-(8+e+3)}}function Axis_AxisBottom(e){const{axisConfig:{tickLabelRotation:t},chartHeight:n,marginBottom:a}=e
return d.createElement(Dh.Z,{...getBaseVisxAxisProps(e),labelProps:{...Fh,...getBottomAxisLabelTranslation(a)},top:n,tickLabelProps:()=>({...Fh,textAnchor:Nh.MIDDLE,...null!=t&&0!==t?{angle:-1*t,textAnchor:Nh.END}:{}})})}function Axis_AxisLeft(e){const{axisConfig:t,longestYTickLabelWidth:n}=e;(0,S.Gp)(null==t.label||null!=t.label&&null!=n,"Expected longestYTickLabelWidth to be specified when axis has a label.")
return d.createElement(Lh.Z,{...getBaseVisxAxisProps(e),...void 0!==e.axisConfig.label?{labelProps:{...Fh,...getLeftAxisLabelTranslation(e.longestYTickLabelWidth||30)}}:{},tickLabelProps:()=>({...Fh,dx:-8,textAnchor:Nh.END})})}function Axis_AxisTop(e){const{axisConfig:{tickLabelRotation:t}}=e
return d.createElement(kh.Z,{...getBaseVisxAxisProps(e),tickLabelProps:()=>({...Dp,textAnchor:Nh.MIDDLE,...null!=t&&0!==t?{angle:t,textAnchor:Nh.START}:{}})})}var Zh
!function(e){e.GROUPED="GROUPED"
e.STACKED="STACKED"}(Zh||(Zh={}))
var Bh=n(670623),qh=n(809681)
function BarChartBar({dataFrameRow:e,isFaded:t,onHover:n,stepWidth:a,...i}){return i.height<0?null:d.createElement(d.Fragment,null,d.createElement("rect",{...i,width:a,fill:"transparent",onMouseEnter:()=>{n({dataFrameRow:e,barProperties:i})},onMouseLeave:()=>{n(null)}}),d.createElement("rect",{...i,className:(0,g.iv)(Vh.visibleRect),fill:i.color,opacity:t?.25:1,pointerEvents:"none"}))}const Vh=g.mM.create({visibleRect:{transition:"opacity 0.2s"}})
var Uh=n(225094)
function ErrorBar({opacity:e=1,x:t,y1:n,y2:a,width:i}){const s={strokeOpacity:e,shapeRendering:"geometricPrecision",stroke:Lp,strokeWidth:1.5},r={...s,x1:-i/2,x2:i/2}
return d.createElement(xh.Z,{left:t,top:0,pointerEvents:"none"},d.createElement(Uh.Z,{...s,x1:0,x2:0,y1:n,y2:a}),d.createElement(Uh.Z,{...r,y1:n,y2:n}),d.createElement(Uh.Z,{...r,y1:a,y2:a}))}function BarGroupBar({errorValueAccessor:e,yAccessor:t,yScale:n,...a}){const{dataFrameRow:i,isFaded:s,width:r,x:o}=a,l=t(i),c=n(0),u=n(l),m=l>=0?u:c,p=l>=0?c-u:u-c
return p<0?null:d.createElement(d.Fragment,null,d.createElement(BarChartBar,{...a,y:m,height:p}),e&&null!=e(i)&&d.createElement(ErrorBar,{opacity:s?.25:1,x:o+r/2,y1:n(l+e(i)),y2:n(l-e(i)),width:Math.min(r,20)}))}function GroupedBarChartContent({accessors:{errorValueAccessor:e,rowIdAccessor:t,seriesAccessor:n,xAccessor:a,yAccessor:i},barGroupDicts:s,barGroupRowMaps:r,chartWidth:o,chartHeight:l,handleOnHoverBar:c,highlightedSeries:u,hoveredRow:m,isSeriesEnabled:p,seriesUniqueValues:h,scales:{colorScale:g,xScale:E,yScale:f}}){const S=function getSecondaryXScale(e,t){return(0,Bh.Z)({domain:t,range:[0,e.bandwidth()]}).paddingInner(t.length>1?$h:0)}(E,h)
return d.createElement(qh.Z,{color:g,data:s,keys:h,height:l,width:o,x0:a,x0Scale:E,x1Scale:S,yScale:f},(a=>a.map((({bars:a,x0:s,index:o})=>d.createElement(xh.Z,{key:`bar-group-${o}-${s}`,left:s},a.map(((a,l)=>{if(null==a.value)return null
const h=r[o].rowMap[a.key]
return a.value&&d.createElement(BarGroupBar,{...a,dataFrameRow:h,errorValueAccessor:e,isFaded:p?null!=u&&n(h)!==u:null!=m&&t(h)!==t(m),key:`bar-group-${o}-${s}-bar-${l}`,onHover:e=>{c(null!=e?{...e,barGroupInfo:{x:s}}:e)},stepWidth:S.step(),yScale:f,yAccessor:i})})))))))}var Gh=n(461982)
function StackedBarChartContent({accessors:{rowIdAccessor:e,seriesAccessor:t,xAccessor:n,yAccessor:a},barGroupDicts:i,barGroupRowMaps:s,chartWidth:r,chartHeight:o,handleOnHoverBar:l,highlightedSeries:c,hoveredRow:u,isSeriesEnabled:m,seriesUniqueValues:p,scales:{colorScale:h,xScale:g,yScale:E}}){return d.createElement(Gh.Z,{color:h,data:i,keys:p,height:o,width:r,x:n,xScale:g,yScale:E},(n=>n.map((({bars:n},a)=>n.map(((n,i)=>{const r=s[n.index].rowMap[n.key]
return null==r?null:r&&d.createElement(BarChartBar,{...n,stepWidth:g.step(),dataFrameRow:r,isFaded:m?null!=c&&t(r)!==c:null!=u&&e(r)!==e(u),key:`bar-stack-layer-${a}-bar-${i}`,onHover:e=>{l(null!=e?{...e,barGroupInfo:{x:0}}:e)}})}))))))}const zh={[Zh.GROUPED]:e=>d.createElement(GroupedBarChartContent,{...e}),[Zh.STACKED]:e=>d.createElement(StackedBarChartContent,{...e})},$h=.1
var Wh=n(409029),Hh=n(494327)
const jh=(0,Hh.x)((()=>{throw new Error("Could not find BenchlingChartContext during rendering")}),"BenchlingChartContext"),Yh=jh.useContext,Qh={height:"100%",width:"100%",margin:5}
function BenchlingChart({children:e,dataTestAttrs:t}){const n=(0,d.useMemo)((()=>l.default.uniqueId("benchling-chart-")),[])
return d.createElement(Wh.Z,{...(0,ee.Z)(t),parentSizeStyles:Qh},(({height:t,width:a})=>a>0&&t>5?d.createElement(jh.Provider,{value:{clientId:n,width:a-10,height:t-10}},e({clientId:n,width:a-10,height:t-10})):null))}function getChartDimensions(e,t,n){return{chartWidth:t>e.left+e.right?t-e.left-e.right:t,chartHeight:n>e.bottom+e.top?n-e.bottom-e.top:n}}function getChartMaskId(e){return`${e}-chart-mask`}function ChartMask({margins:e={left:0,right:0,top:0,bottom:0},width:t,height:n}){const{clientId:a}=Yh(),{chartWidth:i,chartHeight:s}=getChartDimensions(e,t,n)
return d.createElement("mask",{id:getChartMaskId(a),fill:"none"},d.createElement("rect",{x:e.left,y:e.top,width:i,height:s,fill:"white"}))}var Kh=n(350441),Jh=n(491756),Xh=n(199030),eg=n(783646),tg=n(13669),ng=n(850709),ag=n(598738),ig=n(38317),sg=n(476882),rg=n(201261)
function truncateToMaxLengthLabel(e,t=25,n=3){if(e.length>t&&t>n){return`${e.substring(0,t-(n+1))}…${e.substring(e.length-n,e.length)}`}return e}function getTickLabelFormatter(e,t,n){switch(e){case Ah.LINEAR:case Ah.LOG:return e=>(0,rg.Z)(e)
case Ah.BAND:case Ah.POINT:return e=>truncateToMaxLengthLabel(e)
case Ah.UTC:return function getDatetimeTickLabelFormatter(e,t){var n
const[a,i]=e.domain().map((e=>Zd().utc(e))),s=e.ticks(t).length,r=null!==(n=og.find((e=>i.diff(a,e)>=s)))&&void 0!==n?n:"milliseconds"
return e=>"hours"===r&&i.diff(a,r)>=24?cg(e):lg[r](e)}(t,n)
default:throw new Error(`Unexpected scale type ${(0,Go.vE)(e)}`)}}const og=["years","months","days","hours","minutes","seconds","milliseconds"],lg={years:(0,sg.i$)("%Y"),months:(0,sg.i$)("%b %Y"),days:(0,sg.i$)("%b %-d"),hours:(0,sg.i$)("%-I:%M %p"),minutes:(0,sg.i$)("%-I:%M %p"),seconds:(0,sg.i$)("%-I:%M:%S %p"),milliseconds:(0,sg.i$)("%-I:%M:%S.%L %p")},cg=(0,sg.i$)("%b %-d %-I:%M %p")
const dg={[ng.OZ.LINEAR]:Ah.LINEAR,[ng.OZ.LOG]:Ah.LOG},ug={[Wd.g.DATE_OR_TIMESTAMP]:Ah.UTC,[Wd.g.STRING]:Ah.POINT}
function getVisxAxisConfig(e,t,n,{extentOverride:a,sortDomain:i=!1,suggestedNumTicks:s}={}){!function validateAxis(e,t){if((0,ng.Xp)(e)){(0,S.hu)(ng.T[t].includes(e.scale),`${t} axis not compatible with ${e.scale} scale`)
t!==Wd.g.NUMBER&&(0,S.hu)(!e.includeZero,`${t} axes do not support including zero`)
e.scale===ng.OZ.LOG&&(0,S.hu)(!e.includeZero,"Log scales do not support including zero");(0,S.Gp)(null==e.min||null==e.max||e.min<e.max,"Expected axis's min to be less than its max when both are set.",e)}}(e,t)
const r=function getVisxScaleType(e,t){if(!(0,ng.Xp)(e))return Ah.BAND
if(t===Wd.g.NUMBER)return dg[e.scale]
return ug[t]}(e,t),o={...e.hideLabel?{}:{label:e.label},...(0,ng.Xp)(e)?{zero:e.includeZero}:{},nice:!(null!=a&&!Is()(a,[null,null]))&&(null!=s?s:8),suggestedNumTicks:null!=s?s:8,type:r},c=function getDomain(e,t,n,a){(0,S.Gp)(null==a||t===Wd.g.NUMBER,"Extent can only be overridden when axisType is NUMBER")
switch(t){case Wd.g.DATE_OR_TIMESTAMP:return(0,ag.Z)(n)
case Wd.g.NUMBER:{if(!(0,ng.Xp)(e))return l.default.unique(n)
const t=null!=a&&null!=a[0]?a[0]:Math.min(...n),i=null!=a&&null!=a[1]?a[1]:Math.max(...n)
return e.includeZero?[Math.min(0,t),Math.max(0,i)]:[t,i]}case Wd.g.STRING:return l.default.unique(n)
default:throw new Error(`Unexpected axis type ${t}`)}}(e,t,n,a)
switch(r){case Ah.BAND:{let e=c
i&&(e=t===Wd.g.NUMBER?l.default.sortBy(c):(0,Jt.SL)(c))
e=e.map((e=>String(e)))
const n=(0,Bh.Z)({domain:e}),a=null!=s?s:null==c?void 0:c.length
return{...o,domain:e,scale:n,suggestedNumTicks:a,tickLabelFormatter:getTickLabelFormatter(r,n,a)}}case Ah.LINEAR:{const e=(0,Jh.Z)({domain:c,nice:o.nice})
return{...o,domain:c,scale:e,tickLabelFormatter:getTickLabelFormatter(r,e,o.suggestedNumTicks)}}case Ah.LOG:{(0,S.Gp)(void 0===s,"Cannot specify suggested num ticks for log-scale axes")
const e=(0,Xh.Z)({domain:c})
let t=Math.log10(Math.abs(e.domain()[0])),n=Math.log10(Math.abs(e.domain()[1]))
t>n&&([t,n]=[n,t])
const a=n-t
return{...(0,ig.C)(o,"nice"),domain:c,scale:e,suggestedNumTicks:a,tickLabelFormatter:getTickLabelFormatter(r,e,a)}}case Ah.POINT:{const e=i?(0,Jt.SL)(c):c,t=(0,eg.Z)({domain:e}),n=null!=s?s:null==c?void 0:c.length
return{...o,domain:e,scale:t,suggestedNumTicks:n,tickLabelFormatter:getTickLabelFormatter(r,t,n)}}case Ah.UTC:{const e=(0,tg.Z)({domain:c,nice:o.nice})
return{...o,domain:c,scale:e,tickLabelFormatter:getTickLabelFormatter(r,e,o.suggestedNumTicks)}}default:(0,S.hu)(!1,`Invalid scale type ${(0,Go.vE)(r)}`)}}function isVisxAxisConfigScaleType(e,t){return e.type===t}function assertVisxAxisConfigScaleType(e,t){(0,S.hu)(isVisxAxisConfigScaleType(e,t),`Expected visx axis config to match type ${t}`)}function ChartGrid({xAxisConfig:e,yAxisConfig:t,width:n,height:a}){return d.createElement(Kh.Z,{xScale:e.scale,yScale:t.scale,width:n,height:a,numTicksColumns:e.suggestedNumTicks,numTicksRows:t.suggestedNumTicks,xOffset:isVisxAxisConfigScaleType(e,Ah.BAND)?e.scale.step()/2:0,..._p})}var mg=n(87348)
function useChartTooltip(e){const[t,n]=(0,d.useState)(null)
return{tooltipProps:null!=t?{...e,tooltipInfo:t}:null,updateTooltipProps:n}}function ChartTooltip(e){const{containerRef:t,TooltipInPortal:n}=(0,mg.Z)({detectBounds:!0,scroll:!0}),a=(0,d.useCallback)((e=>{var n
t(null!==(n=null==e?void 0:e.parentElement)&&void 0!==n?n:null)}),[t]),{tooltipInfo:{point:i,label:s,warning:r,...o}}=e
return d.createElement(d.Fragment,null,d.createElement("svg",{ref:a}),d.createElement(n,{...o},d.createElement(ChartTooltipContents,{...(0,ig.Z)(e,"tooltipInfo"),point:i,label:s,warning:r})))}function ChartTooltipContents(e){const{axisTypes:t,columnLabels:n,columnNames:a,label:i,point:s,warning:r}=e
return d.createElement("div",{className:(0,g.iv)(pg.tooltipContents)},a.map(((e,a)=>d.createElement(AxisValue,{axisLabel:n[e],axisType:t[e],key:a,value:s[e]}))),null!=i&&d.createElement(LabelValue,{...i}),null!=r&&d.createElement(WarningValue,{warning:r}))}function AxisValue({axisLabel:e,axisType:t,value:n}){let a=null!=n?n:"null"
if(t===Wd.g.NUMBER&&null!=n){const e="string"==typeof n?(0,jd.j5)(n):n
a=(0,rg.Z)(e,!0)}return d.createElement("div",{className:"u-ellipsis-text"},(0,Mt.fk)(e,20),": ",a)}function LabelValue({color:e,text:t}){return d.createElement("div",{className:"u-flex-display"},d.createElement("span",{className:(0,g.iv)(pg.colorBlock),style:{backgroundColor:e}}),d.createElement("span",{className:"u-ellipsis-text"},t))}function WarningValue({warning:e}){return d.createElement("div",{className:`u-flex-display ${(0,g.iv)(pg.warning)}`},d.createElement(pe.Z,{className:(0,g.iv)(pg.warningIcon),icon:"revision"}),d.createElement("span",null,e))}const pg=g.mM.create({colorBlock:{flexShrink:0,height:10,width:10,marginRight:3,marginTop:1},tooltipContents:{...(0,ig.Z)(Dp,"fill"),..._n.XI,color:Vt.Rl,lineHeight:"14px",maxWidth:400,padding:"4px 6px"},warning:{color:Vt.hM},warningIcon:{marginRight:3,marginTop:1}})
var hg=n(491264),gg=n(16110),Eg=n(67579),fg=n(942093),Sg=n(554578)
const yg=Dp.fontSize*Dp.lineHeight
function estimateDiscreteSeriesLegendItemWidth(e){var t
return(null!==(t=(0,fg.Z)(e,Dp))&&void 0!==t?t:0)+4+16+10+10}function DiscreteSeriesLegendItem({direction:e=Sg.z.ROW,label:t,isExcluded:n,onClickLegendItem:a,onHover:i}){const s=a?()=>{a(t.datum)}:void 0
return d.createElement(gg.Z,{...i?{onMouseEnter:()=>{i(t.datum)},onMouseLeave:()=>{i()}}:{},className:(0,g.iv)(bg.legendItem,a&&bg.clickable,n&&bg.excluded,e===Sg.z.COLUMN&&bg.verticalLegendItem),onClick:s},d.createElement("div",{className:(0,g.iv)(bg.legendLabelSwatch),style:{backgroundColor:t.value}}),d.createElement(Eg.Z,{className:(0,g.iv)(bg.legendLabel),margin:0},t.text))}const bg=g.mM.create({clickable:{":hover":{backgroundColor:kp,cursor:"pointer"}},excluded:{color:Mp,textDecoration:"line-through"},legendItem:{marginLeft:5,marginRight:5,alignItems:"flex-start"},legendLabel:{...Dp,align:"left",marginLeft:4,maxHeight:"auto",whitespace:"nowrap",wrap:"nowrap",wordBreak:"break-word"},legendLabelSwatch:{margin:.5*(yg-16)+"px 0px",height:16,width:16},verticalLegendItem:{marginBottom:10,height:"auto"}}),Tg=3*yg
function estimateDiscreteSeriesLegendHeight(e,t){const n=t-60
let a=0,i=1
for(const t of e.domain()){const e=estimateDiscreteSeriesLegendItemWidth("string"==typeof t?t:(0,rg.Z)(t))
if(a+e>n){i+=1
a=e}else a+=e}return Math.min(i*yg,Tg)}function DiscreteSeriesLegend({colorConfig:{colorScale:e},direction:t=Sg.z.ROW,excludedSeries:n,location:a=Sg.L.TOP,onClickLegendItem:i,onHoverItem:s,width:r,height:o}){return d.createElement(hg.Z,{scale:e},(e=>d.createElement("div",{style:{...null!=r?{width:`${r}px`}:{},...o?{maxHeight:`${o}px`}:{}},className:f()((0,g.iv)(vg.legendContainer,t===Sg.z.ROW?vg.legendHorizontalContainer:vg.legendVerticalContainer,a===Sg.L.LEFT&&vg.legendVerticalContainerLeft,a===Sg.L.RIGHT&&vg.legendVerticalContainerRight),"scrollbar-override")},function maybeWrapContent(e){return t===Sg.z.COLUMN?d.createElement("div",{className:(0,g.iv)(vg.verticalScrollFix)},e):e}(e.map(((e,a)=>d.createElement(DiscreteSeriesLegendItem,{key:`legend-item-${a}`,label:e,isExcluded:null==n?void 0:n.has(e.datum),onClickLegendItem:i,onHover:s,direction:t})))))))}const vg=g.mM.create({legendContainer:{paddingLeft:30,paddingRight:30,overflowY:"auto"},legendHorizontalContainer:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",maxHeight:Tg},legendVerticalContainer:{display:"flex",flexDirection:"column"},legendVerticalContainerLeft:{paddingRight:0},legendVerticalContainerRight:{paddingLeft:0},verticalScrollFix:{marginTop:"auto",marginBottom:"auto"}})
var Cg=n(398815),Ig=n(238037)
function useSeriesExcludedState(){const[e,t]=(0,d.useState)(new Ig.Z)
return{excludedSeries:e,toggleExcludedSeries:n=>{e.has(n)?t(e.delete(n)):t(e.add(n))}}}function useSeriesExcludedWithDataFrameState(e,t){const{excludedSeries:n,toggleExcludedSeries:a}=useSeriesExcludedState(),i=(0,d.useMemo)((()=>(0,Cg.Z)(e,(e=>!n.has(t(e))))),[n,e,t])
return{excludedSeries:n,filteredDataFrame:i,toggleExcludedSeries:a}}function getTickLabelWidths({scale:e,suggestedNumTicks:t,tickLabelFormatter:n}){return("ticks"in e?e.ticks(t):e.domain()).map((e=>n(e))).filter((e=>e.length>0)).map((e=>(0,fg.Z)(e,Dp)+10))}function getXTickLabelRotationAndMargins({currentMargins:e,totalWidth:t,xAxisConfig:n,xAxisOrientation:a}){const i=getTickLabelWidths(n),s=Math.max(...i),r=t/i.length,o=(n.type===Ah.BAND&&i.length>1?t-r:t)/i.length,[l,c]=[i[0],i[i.length-1]]
return s<=o?function getOutputWithoutRotation(e,{label:t},n,[a,i]){const s=Math.max(a/2+3,e.left),r=Math.max(i/2+3,e.right),o=void 0===t?Rp:Pp
return{rotation:0,margins:{...e,left:s,right:r,...n===Rh.BOTTOM?{bottom:o}:{top:o}}}}(e,n,a,[l,c]):function getOutputWithRotation(e,{label:t,type:n},a,[i,s],r,o){(0,S.hu)(r>o,"Tried to rotate tick labels when they should not be rotated")
const l=Math.acos(o/r),c=Math.abs(Math.cos(l)),d=Math.abs(Math.sin(l)),u=d*Ip,m=c*Ip+d*r+4+(void 0===t?0:11+Ip),p=3-(n===Ah.BAND?o/2:0)
if(a===Rh.TOP){const t=u+c*s,n=Math.max(t+p,e.right)
return{rotation:180*l*-1/Math.PI,margins:{...e,top:m,right:n}}}{const t=u+c*i,n=Math.max(t+p,e.left)
return{rotation:180*l/Math.PI,margins:{...e,bottom:m,left:n}}}}(e,n,a,[l,c],s,o)}function fitChartAndLabels({defaultMargins:e,width:t,height:n,xAxisOrientation:a,xAxisConfig:i,yAxisConfig:s,extraMargin:r}){const{margins:o,rotation:l}=getXTickLabelRotationAndMargins({currentMargins:e,totalWidth:t,xAxisConfig:i,xAxisOrientation:a}),c=function getYTickLabelMargins({currentMargins:e,yAxisConfig:t}){const n=getTickLabelWidths(t),a=Math.max(...n),i=Math.max(8+a+(void 0===t.label?0:11+Ip),e.left)
return{...e,left:i}}({currentMargins:o,yAxisConfig:s}),{chartWidth:d,chartHeight:u}=getChartDimensions(c,t,n)
return{chartWidth:d,chartHeight:u,margins:r?(m=c,p=r,{top:m.top+p.top,left:m.left+p.left,right:m.right+p.right,bottom:m.bottom+p.bottom}):c,xAxisConfig:{...i,scale:i.scale.copy().range([0,d]),tickLabelRotation:l},yAxisConfig:{...s,scale:s.scale.copy().range([0,u])}}
var m,p}function getDiscreteAxisNumTicks(e,t){let n=e
for(;n*Dp.fontSize*1.1>t&&n>1;)n=Math.floor(n/2)
return n}const wg={top:Ap,bottom:Ap,left:Ap,right:Ap},Ng={x:{allowedLeafTypes:[...Hd.XK,Hd.i0.TEXT,Hd.i0.DATE,Hd.i0.DATETIME],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.ALLOWED},y:{allowedLeafTypes:Hd.XK,nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},series:{allowedLeafTypes:[...Hd.XK,Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.ALLOWED},errorValue:{allowedLeafTypes:Hd.XK,nullableType:ad.FS.ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED}}
function getBarChartYAxisExtent(e,t,n,a,i){switch(e){case Zh.GROUPED:return function getGroupedBarChartYExtent(e,t){const n=e.map(((e,n)=>e-(null==t?0:t[n]))),a=e.map(((e,n)=>e+(null==t?0:t[n])))
return[Math.min(...n),Math.max(...a)]}(a,i)
case Zh.STACKED:return function getStackedBarChartYExtent(e,t,n){const a=e.map((({rowMap:e})=>Object.values(e).reduce(((e,n)=>e+t(n)),0)))
return[Math.min(...n),Math.max(...a)]}(t,n,a)
default:(0,S.Gp)(!1,`Invalid bar chart type: ${(0,Go.vE)(e)}`)
return[0,0]}}function BarChart({clientId:e,columnsMapping:t,config:n,dataFrame:a,height:i,width:s}){const r=null!=t.errorValue,o=null!=t.series
!function validateBarChartInput(e,{errorBarConfig:t,legend:n,yAxis:{min:a,max:i}},s,r){(0,S.Gp)(null==n||null!=n&&r,"The series columnsMapping needs to be specified to enable legends.",{columnsMapping:e,legend:n});(0,S.Gp)(null==t||null!=t&&s,"The errorValue columnsMapping needs to be specified to enable error bars.",{columnsMapping:e,errorBarConfig:t})}(t,n,r,o)
const c=function getBarChartAccessors(e,t){const{accessors:{rowId:n,...a},validatedLeafTypes:i}=(0,Lm.yL)(e,t,Ng)
return{xAccessor:resolvedStringAccessor(a.x,e.hydratedProperties,ed.vm),yAccessor:numericAccessor(a.y,i.y),rowIdAccessor:n,seriesAccessor:null==a.series?()=>"__points":resolvedStringAccessor(a.series,e.hydratedProperties,ed.vm),...null!=a.errorValue?{errorValueAccessor:numericAccessor(a.errorValue,i.y)}:{}}}(a,t),{xAccessor:u,yAccessor:m,seriesAccessor:p,errorValueAccessor:h}=c,{excludedSeries:g,filteredDataFrame:E,toggleExcludedSeries:f}=useSeriesExcludedWithDataFrameState(a,p),y=l.default.unique(a.rows.map((e=>u(e)))),b=l.default.unique(a.rows.map((e=>p(e)))),T=E.rows.map((e=>m(e))),v=null==h?null:E.rows.map((e=>h(e))),{colorConfig:C,colorScale:I,legendAdjustedHeight:w,legendHeight:N,showLegend:A}=function getBarChartLegendOptions(e,{legend:t},n,a){const i=(0,_h.Z)({domain:e,range:Tp}),s=estimateDiscreteSeriesLegendHeight(i,n),r=null!=t,o=a-(r?s:0)
return{colorConfig:{colorPalette:Sn.BL.DISCRETE,colorScale:i},colorScale:i,legendAdjustedHeight:o,legendHeight:s,showLegend:r}}(b,n,s,i),{chartWidth:R}=getChartDimensions(wg,s,w),P=function convertDataFrameToBarGroupRowMaps(e,t,n){return Object.entries((0,Jt.vM)(e.rows,t)).map((([e,t])=>({groupName:e,rowMap:(0,Jt.m8)(t.map((e=>[n(e),e])))})))}(E,u,p),O=function convertDataFrameToBarGroupDicts(e,t,n){return e.map((({groupName:e,rowMap:a})=>({[n.x]:e,...(0,Jt.m8)(Object.entries(a).map((([e,n])=>[e,t(n)])))})))}(P,m,t),x=function getBarChartAxisConfigs({xAxis:e,yAxis:t},n,a,i){var s,r
const o=getDiscreteAxisNumTicks(n.length,i),l=getVisxAxisConfig(e,Wd.g.STRING,n,{suggestedNumTicks:o}),c=getVisxAxisConfig(t,Wd.g.NUMBER,a,{extentOverride:[null!==(s=t.min)&&void 0!==s?s:null,null!==(r=t.max)&&void 0!==r?r:null]})
assertVisxAxisConfigScaleType(l,Ah.BAND);(0,S.hu)(isVisxAxisConfigScaleType(c,Ah.LINEAR)||isVisxAxisConfigScaleType(c,Ah.LOG),"Expected axis scale to be either LINEAR or LOG")
return{xAxisConfig:l,yAxisConfig:c}}(n,y,getBarChartYAxisExtent(n.type,P,m,T,v),R),{chartWidth:_,chartHeight:D,margins:L,xAxisConfig:k,yAxisConfig:M}=fitChartAndLabels({defaultMargins:wg,height:w,width:s,xAxisOrientation:Rh.BOTTOM,...x}),F=function getBarChartScales(e,t,n,a){return{xScale:e.scale.range([0,n]).paddingInner(.2).paddingOuter(.1),yScale:t.scale.range([a,0])}}(k,M,_,D),Z=function getBarChartUseChartTooltipInput(e,t){const n={axisTypes:{[e.x]:Wd.g.STRING,[e.y]:Wd.g.NUMBER},columnLabels:{[e.x]:t.xAxis.label,[e.y]:t.yAxis.label},columnNames:[e.x,e.y]},a=e.errorValue
return null==a?n:(0,tm.ZP)(n,(e=>{e.axisTypes[a]=Wd.g.NUMBER
e.columnLabels[a]=t.errorBarConfig.errorValueLabel
e.columnNames.push(a)}))}(t,n),{tooltipProps:B,updateTooltipProps:q}=useChartTooltip(Z),[V,U]=(0,d.useState)(null),[G,z]=(0,d.useState)(null)
const $={accessors:c,barGroupDicts:O,barGroupRowMaps:P,chartWidth:_,chartHeight:D,handleOnHoverBar:function handleOnHoverBar(e){if(null!=e){U(e.dataFrameRow)
z(p(e.dataFrameRow))
q(function getBarChartTooltipInfo({barProperties:{color:e,x:t,y:n,width:a},barGroupInfo:{x:i},dataFrameRow:s},r,o){const l=-1*(function estimateTooltipHeight(e,t){return 14*(e+(t?1:0))+8}(2,o)+10)
return{point:s,top:Math.max(l,n+l),left:i+t+a/2,...o&&{label:{text:r(s),color:e}}}}(e,p,o))}else{U(null)
z(null)
q(null)}},hoveredRow:V,highlightedSeries:G,isSeriesEnabled:o,seriesUniqueValues:b,scales:{...F,colorScale:I}},W=zh[n.type]
return d.createElement(d.Fragment,null,A&&d.createElement(DiscreteSeriesLegend,{colorConfig:C,excludedSeries:g,onClickLegendItem:f,onHoverItem:function handleOnHoverLegendItem(e){z(null!=e?e:null)}}),d.createElement("svg",{height:i-(A?N:0),width:s},B&&d.createElement(ChartTooltip,{...B}),d.createElement(xh.Z,{left:L.left,top:L.top},d.createElement(ChartMask,{width:_,height:D}),d.createElement(xh.Z,{mask:`url(#${getChartMaskId(e)})`},d.createElement(ChartGrid,{xAxisConfig:k,yAxisConfig:M,width:_,height:D}),d.createElement(W,{...$})),d.createElement(Axis_AxisLeft,{axisConfig:M,longestYTickLabelWidth:Math.max(...getTickLabelWidths(M))}),d.createElement(Axis_AxisBottom,{axisConfig:k,chartHeight:D,marginBottom:L.bottom}))))}function BarChartWrapper(e){return d.createElement(BenchlingChart,null,(t=>d.createElement(BarChart,{...e,...t})))}function aggregateRows(e,t,n,a){const i=e.columns.filter((e=>(0,$d.Z)(e)))
return{...e,columns:[...a,...i],rows:Object.entries((0,Jt.vM)(e.rows,t)).map((([e,t])=>{(0,S.hu)(t.length>0,"Unexpected empty partition")
return{...(0,he.Z)(t[0],...i.map((e=>e.systemName))),...n(t,e)}}))}}var Ag=n(358348)
const Rg={[Sn.FP.COUNT]:e=>e.length,[Sn.FP.MEAN]:e=>(0,Ag.J6)(e),[Sn.FP.SUM]:e=>(0,de.Sm)(e)},Pg={[Sn.dA.STANDARD_DEVIATION]:e=>e.length>1?(0,Ag.IN)(e):null,[Sn.dA.STANDARD_ERROR]:e=>e.length>1?(0,Ag.fU)(e):null},Og={[Sn.dA.STANDARD_DEVIATION]:"SD",[Sn.dA.STANDARD_ERROR]:"SE"}
function getAggregatedAxisName(e,t){switch(e){case Sn.FP.COUNT:return`Count ${t}`
case Sn.FP.MEAN:return`Mean ${t}`
case Sn.FP.SUM:return`Sum ${t}`
case null:return t
default:throw new Error(`Unsupported aggregation type ${(0,Go.vE)(e)}`)}}const xg={systemName:"aggregated_values",type:{leafType:Hd.i0.DECIMAL}},_g={systemName:"error_bar_values",displayName:"Error bar values",type:{leafType:Hd.i0.DECIMAL,isNullable:!0}}
function aggregateChartDataFrame(e,t,n,a=null){const i=(0,nd.ZP)(e,t.partitionColumn),s=null==t.secondaryPartitionColumn?null:(0,nd.ZP)(e,t.secondaryPartitionColumn),r=(0,nd.ZP)(e,t.valueColumn),{accessors:{partitionColumn:o,secondaryPartitionColumn:l,...c},validatedLeafTypes:d}=(0,Lm.yL)(e,t);(0,S.hu)(n===Sn.FP.COUNT&&null==a||(0,Wd.fx)(r.type),"Expected column type to be numerical if aggregationType is not COUNT or errorBarTypeIsSpecified")
const u=n===Sn.FP.COUNT?()=>1:numericAccessor(c.valueColumn,d.valueColumn),m=Rg[n],p=a&&Pg[a]
return{dataFrame:aggregateRows(e,(e=>null==l?String(o(e)):`${String(o(e))} - ${String(l(e))}`),(e=>{(0,S.hu)(e.length>0,"Expected partition to be non-empty")
const n=e.map((e=>u(e))),i=m(n),s=p&&p(n)
return{[t.partitionColumn]:o(e[0]),...l&&t.secondaryPartitionColumn&&{[t.secondaryPartitionColumn]:l(e[0])},[xg.systemName]:String(i),...a&&{[_g.systemName]:null==s?null:String(s)}}}),[i,...null==s?[]:[s],{...xg,displayName:getAggregatedAxisName(n,r.displayName)},...null==a?[]:[_g]]),columnsMapping:{...(0,jc.Z)(t,"partitionColumn","secondaryPartitionColumn"),aggregatedValues:xg.systemName,...null!=a?{errorBarValues:_g.systemName}:{}}}}function getNumberColumnValues(e,t){const{accessor:n,validatedLeafType:a}=(0,Lm.$0)(e,t),i=(0,Cg.Z)(e,(e=>null!=n(e))),s=numericAccessor(n,a)
return i.rows.map((e=>s(e)))}var Dg=n(600066)
function updateColumnDef(e,t,n){(0,nd.ZP)(e,t);(0,S.hu)(null==n.systemName||n.systemName===t||null==(0,Dg.Z)(e,n.systemName),"Tried to update the name of a column with a name that already exists in the data frames",{oldColumnName:t,newColumnName:n.systemName,dataFrameColumns:e.columns})
return{...e,columns:e.columns.map((e=>e.systemName===t?{...e,...n}:e))}}function transformColumn(e,t,n,a){(0,nd.ZP)(e,t)
const i={...e,rows:e.rows.map(((e,a)=>({...e,[t]:n(e,a)})))}
return null==a?i:updateColumnDef(i,t,a)}const Lg={[Hd.i0.BOOLEAN]:!1,[Hd.i0.TEXT]:"No value"}
function coerceOrFilterNulls(e,t){const n=(0,nd.ZP)(e,t)
if(!n.type.isNullable)return e
const{accessors:{columnSystemName:a},validatedLeafTypes:{columnSystemName:i}}=(0,Lm.yL)(e,{columnSystemName:t}),s=Lg[i]
return updateColumnDef(null!=s?transformColumn(e,t,(e=>null==a(e)?s:a(e))):(0,Cg.Z)(e,(e=>null!=a(e))),t,{type:(0,ig.C)(n.type,"isNullable")})}var kg=n(525098)
class ConvertToChartPropsException extends kg.Z{}const Mg={[Hd.i0.BOOLEAN]:"boolean",[Hd.i0.DATE]:"time series",[Hd.i0.DATETIME]:"time series",[Hd.i0.DECIMAL]:"numerical",[Hd.i0.INTEGER]:"numerical",[Hd.i0.TEXT]:"text"}
function makeColumnNameNotFoundErrorMessage(e,t){return`"${t}" is not a valid column in the query to use for ${(0,Mt.kC)(e)}`}function validateNonEmptyDataFrame(e,t){if(0===e.rows.length){if(null!=t)throw new ConvertToChartPropsException(`There are no results to display in the "${t.displayName}" column`)
throw new ConvertToChartPropsException("There are no results to display")}}function cleanAndValidateNullValues(e,t){const{cleanupNulls:n,inputDataColumnSystemName:a}=t,i=(0,nd.ZP)(e,a),s=function maybeUpdateFullNullColumnType(e,{typeValidationOptions:{allowedLeafTypes:t},inputDataColumnSystemName:n}){const{systemName:a,type:i}=(0,nd.ZP)(e,n),s=e.rows.every((e=>null==e[a]))
if(i.leafType===Hd.i0.JSON&&i.isNullable&&s){(0,S.hu)(null!=t&&t.length>0,"Expected to have at least one allowedLeafTypes",{allowedLeafTypes:t,type:i})
const n=t[0]
return updateColumnDef(e,a,{type:{...i,leafType:n}})}return e}(e,t),r=n?coerceOrFilterNulls(s,i.systemName):s
validateNonEmptyDataFrame(r,i)
return r}function makeInvalidColumnTypeErrorMessage(e,t,n,a,i){const s=null!=n?(0,Mt.Dw)(l.default.unique(n.map((e=>{var t
return null!==(t=Mg[e])&&void 0!==t?t:(0,Mt.if)(e).toLowerCase().trim()}))),"or"):"any"
return`${(0,Mt.kC)(e)} column "${t}" contains an invalid data type. ${(0,de._6)(2,ed.Qp[a])} ${i?`${i} `:""}only support ${s} ${e} columns.`}function cleanAndValidateDataFrame(e,t,n,a){return t.reduce(((e,t)=>function cleanAndValidateColumn(e,t,n,a){const{chartDataColumnName:i,typeValidationOptions:s}=t,r=(0,Dg.Z)(e,t.inputDataColumnSystemName)
if(null==r)throw new ConvertToChartPropsException(makeColumnNameNotFoundErrorMessage(i,t.inputDataColumnSystemName))
validateNonEmptyDataFrame(e)
const o=cleanAndValidateNullValues(e,t)
try{(0,ad.ZP)((0,nd.ZP)(o,r.systemName).type,s)
return o}catch(e){if(e instanceof td.Z)throw new ConvertToChartPropsException(makeInvalidColumnTypeErrorMessage(i,r.displayName,s.allowedLeafTypes,n,a))
throw e}}(e,t,n,a)),e)}function maybeConvertProps(e){try{return e()}catch(e){if(e instanceof ConvertToChartPropsException)return{valid:!1,message:e.message}
throw e}}function getDataFrameColumnsMapping(e,t){return(0,Jt.m8)(t.map((e=>[e.chartDataColumnName,e.inputDataColumnSystemName])))}const Fg={[Sn.JG.STACKED]:Zh.STACKED,[Sn.JG.STANDARD]:Zh.GROUPED}
function cleanAndValidateBarChartData(e,t,n){const a=cleanAndValidateDataFrame(e,t,cu.nB.BAR_CHART)
n.barChartType===Sn.JG.STACKED&&function validateStackPositiveValues(e,{yAxisColumnName:t}){if(getNumberColumnValues(e,t).some((e=>e<0)))throw new ConvertToChartPropsException("All y-values in a stacked bar chart must be positive")}(e,n)
return a}function shouldBarChartIncludeZero({yAxisMin:e,yAxisMax:t}){return null==e&&null==t||null!=e&&null==t&&e<=0||null!=t&&null==e&&t>=0}function convertBarChartConfig(e,t){const n=(0,nd.ZP)(e,t.xAxisColumnName).displayName,a=(0,nd.ZP)(e,t.yAxisColumnName).displayName,i=null!=t.seriesColumnName?(0,nd.ZP)(e,t.seriesColumnName).displayName:""
return{...t.seriesColumnName?{legend:{label:i}}:{},...t.errorBarType&&{errorBarConfig:{errorValueLabel:Og[t.errorBarType]}},type:Fg[t.barChartType],xAxis:{label:n},yAxis:{includeZero:shouldBarChartIncludeZero(t),label:getAggregatedAxisName(t.aggregationType,a),scale:ng.OZ.LINEAR,...null!=t.yAxisMin&&{min:t.yAxisMin},...null!=t.yAxisMax&&{max:t.yAxisMax}}}}function convertBarChartProps(e,t){const n=function getBarChartColumnInfos(e){return[{chartDataColumnName:"x",inputDataColumnSystemName:e.xAxisColumnName,typeValidationOptions:Ng.x,cleanupNulls:!0},{chartDataColumnName:"y",inputDataColumnSystemName:e.yAxisColumnName,typeValidationOptions:Ng.y,cleanupNulls:!0},...null==e.seriesColumnName?[]:[{chartDataColumnName:"series",inputDataColumnSystemName:e.seriesColumnName,typeValidationOptions:Ng.series,cleanupNulls:!0}]]}(t)
return{valid:!0,props:{dataFrame:cleanAndValidateBarChartData(e,n,t),columnsMapping:getDataFrameColumnsMapping(0,n),config:convertBarChartConfig(e,t)}}}var Zg=n(613146),Bg=n(895502),qg=n(671268)
function assertWellFormedColumn({columnTypes:e,rows:t},n){t.some((e=>null!=e[n]))&&(0,S.Gp)(void 0!==e[n],`Expected "${n}" columnType to be specified if some rows have "${n}" specified`)
void 0!==e[n]&&(0,S.Gp)(t.every((e=>void 0!==e[n])),`Expected every row to have "${n}" specified if it is specified in columnTypes`)}var Vg=n(854710),Ug=n(830476)
function estimateGradientSeriesLegendWidth(e,t,n){const a=(0,fg.Z)(e,Dp),i=(0,fg.Z)((0,rg.Z)(t),Dp),s=(0,fg.Z)((0,rg.Z)(n),Dp)
return Math.max(a,i+25,s+25)+50}function GradientSeriesLegend({chartHeight:e,chartWidth:t,colorConfig:{colorScale:n},label:a}){const i=.25*e,s=t+25,r=.5*(e-i-25),{clientId:o}=Yh(),l=`gradient-legend-${o}`,c=(0,Bh.Z)({domain:n.domain(),paddingInner:.9,range:[i,0]})
return d.createElement(xh.Z,{left:s,top:r},d.createElement(bp.Z,{id:l,from:n.range()[1],to:n.range()[0]}),d.createElement(Ug.Z,{style:Dp},a),d.createElement("rect",{fill:`url(#${l})`,height:i,width:25,y:25}),d.createElement(Vg.Z,{hideAxisLine:!0,hideTicks:!0,left:25,scale:c,tickFormat:e=>(0,rg.Z)(e),tickLabelProps:()=>Dp,top:25}))}function HeatmapBox({color:e,heatmapInnerBin:t,height:n,width:a,x:i,y:s}){const r={x:t.x,y:t.y,isMasked:t.isMasked,metric:null==t.metric?"No data":t.metric},o=.75*Math.min(a,n),l=Math.max(i,i+(a-o)/2),c=Math.max(s,s+(n-o)/2)
return d.createElement(d.Fragment,null,d.createElement("rect",{fill:r.isMasked?Bp:e,height:n,width:a,x:i,y:s}),r.isMasked&&d.createElement("g",{pointerEvents:"none",style:{stroke:`${qp}`,strokeLinecap:"round",strokeWidth:o/8,transform:`translate(${l}px, ${c}px)`}},d.createElement("line",{x2:o,y2:o}),d.createElement("line",{x1:o,y2:o})))}var Gg=n(854721)
function invertBandScale(e,t){const n=e.step(),a=Math.floor(t/n)
return a<0||a>=e.domain().length?null:e.domain()[a]}function createHeatmapMouseEventHandler({handler:e,xScale:t,yScale:n,points:a,offsetPosition:i}){return null==e?void 0:s=>{const r=function getHeatmapEventInfo(e,t,n,a,i){var s,r
if(null==e)return null
const o=a.find((a=>String(a.x)===invertBandScale(t,e.x-i.left)&&String(a.y)===invertBandScale(n,e.y-i.top)))
return null==o?null:{dataPoint:o,targetBinHeight:n.step(),targetBinWidth:t.step(),x:null!==(s=t(o.x))&&void 0!==s?s:0,y:null!==(r=n(o.y))&&void 0!==r?r:0}}((0,Gg.Z)(s),t,n,a,i)
e(r)}}function HeatmapWrapper({children:e,offsetPosition:t,points:n,xScale:a,yScale:i,onClickPoint:s,onMouseLeave:r,onMouseMove:o}){const l={offsetPosition:t,points:n,xScale:a,yScale:i}
return d.createElement(xh.Z,{left:t.left,top:t.top,onClick:createHeatmapMouseEventHandler({...l,handler:s}),onMouseLeave:createHeatmapMouseEventHandler({...l,handler:r}),onMouseMove:createHeatmapMouseEventHandler({...l,handler:o})},e)}const zg={top:Ip+8,right:Ap,bottom:Ap,left:Ip+8},$g={hideLabel:!0,label:"Column"},Wg={hideLabel:!0,label:"Row"},Hg=(Wd.g.NUMBER,Wd.g.STRING,Wd.g.NUMBER,Wd.g.STRING,Wd.g.NUMBER,Wd.g.BOOLEAN,{x:{allowedLeafTypes:[Hd.i0.DECIMAL,Hd.i0.INTEGER,Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},y:{allowedLeafTypes:[Hd.i0.DECIMAL,Hd.i0.INTEGER,Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},metric:{allowedLeafTypes:[Hd.i0.DECIMAL,Hd.i0.INTEGER],nullableType:ad.FS.ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED}})
function prepareHeatmapPoints(e,t){const n=function convertPointsIntoHeatmapInternalPoints(e){return e.map((e=>({x:e.x,y:e.y,metric:e.metric,isMasked:Boolean(e.isMasked),point:e})))}(e).slice().reverse().filter(((e,t,n)=>n.findIndex((t=>t.x===e.x&&t.y===e.y))===t)),numericSortByKey=(e,t)=>l.default.sortBy(e,t)
return(t.x===Wd.g.NUMBER?numericSortByKey:Jt.UY)((t.y===Wd.g.NUMBER?numericSortByKey:Jt.UY)(function fillHeatmapGrid(e){const t=l.default.groupBy(e,"x"),n=l.default.uniq(e.map((e=>e.x))),a=l.default.uniq(e.map((e=>e.y))),i=n.map((e=>({x:e,absentYArray:a.filter((n=>!t[e].some((e=>e.y===n))))}))),s=i.flatMap((({x:e,absentYArray:t})=>t.map((t=>({x:e,y:t,metric:null,isMasked:!1,point:null})))))
return[...e,...s]}(n),"y"),"x")}function getHeatmapRectProps(e,t,n,a){const i=function getColumnData(e){const t=l.default.groupBy(e,"x"),n=[...new Set(e.map((e=>e.x)))]
return n.map((e=>({x:e,bins:t[e]})))}(a),s=l.default.uniq(a,"y").length,r=function getHeatmapRectXYScales(e,t,n){const a=l.default.uniq(n,"x").length,i=l.default.uniq(n,"y").length
return{xScale:(0,Jh.Z)({domain:[0,a],range:[0,t]}),yScale:(0,Jh.Z)({domain:[0,i],range:[0,e]})}}(e,t,a)
return{...r,binHeight:e/s,binWidth:t/i.length,colorScale:n,data:i,gap:0}}const jg=d.memo((function _HeatmapGridArea({chartHeight:e,chartWidth:t,heatmapRectProps:n}){return d.createElement(d.Fragment,null,d.createElement(Zg.Z,{...n,count:e=>e.metric},(e=>e.map((e=>e.map((e=>{var t
return null==(null===(t=e.bin.point)||void 0===t?void 0:t.metric)?null:d.createElement(HeatmapBox,{...e,color:e.color,heatmapInnerBin:e.bin,key:`heatmap-rect-${e.row}-${e.column}`})})))))),d.createElement("rect",{fill:"transparent",height:e,pointerEvents:"none",stroke:Vt.tN,width:t}))}))
function Heatmap({config:e,data:{axisTypes:t,points:n},onClickPoint:a,height:i,width:s}){assertWellFormedColumn({rows:n,columnTypes:t},"isMasked")
const{chartHeight:r,chartWidth:o,heatmapLegendProps:l,heatmapMargins:c,heatmapRectProps:u,preparedPoints:m,xAxisConfig:p,yAxisConfig:h}=(0,d.useMemo)((()=>{const a=prepareHeatmapPoints(n,t),r={ascendingOrder:!0,...e},o=function getColorScale(e,t){const n=(0,Jh.Z)({range:Zp}),a=(0,qg.Z)(t.filter((e=>!e.isMasked)).map((e=>e.metric)))
n.domain(e.ascendingOrder?a:a.slice().reverse())
return n}(r,a),l=function getHeatmapLegendProps(e,t,n,a){const[i,s]=e.domain(),r=a-estimateGradientSeriesLegendWidth(t.label,i,s)
return{colorConfig:{colorPalette:Sn.BL.GRADIENT,colorScale:e},chartHeight:n,chartWidth:r,label:t.label}}(o,r.legend,i,s),c={...zg,right:s-l.chartWidth},d=function getHeatmapAxisConfigs(e,t,n,a){const i=a.x,s=a.y;(0,S.hu)(ng.xK.includes(i),"Heatmap has invalid x-axis");(0,S.hu)(ng.xK.includes(s),"Heatmap has invalid y-axis")
const r=[...new Set(n.map((e=>e.x)))],o=getDiscreteAxisNumTicks(r.length,t),l=getVisxAxisConfig($g,i,r,{sortDomain:!0,suggestedNumTicks:o}),c=[...new Set(n.map((e=>e.y)))],d=getDiscreteAxisNumTicks(c.length,e),u=getVisxAxisConfig(Wg,s,c,{sortDomain:!0,suggestedNumTicks:d})
assertVisxAxisConfigScaleType(l,Ah.BAND)
assertVisxAxisConfigScaleType(u,Ah.BAND)
return{xAxisConfig:l,yAxisConfig:u}}(i,l.chartWidth,a,t),{chartWidth:u,chartHeight:m,margins:p,xAxisConfig:h,yAxisConfig:g}=fitChartAndLabels({defaultMargins:c,height:i,width:s,xAxisOrientation:Rh.TOP,...d})
return{chartHeight:m,chartWidth:u,heatmapLegendProps:l,heatmapMargins:p,heatmapRectProps:getHeatmapRectProps(m,u,o,a),preparedPoints:a,xAxisConfig:h,yAxisConfig:g}}),[e,t,i,s,n]),{tooltipProps:g,updateTooltipProps:E}=useChartTooltip({axisTypes:t,columnNames:["y","x","metric"],columnLabels:{x:$g.label,y:Wg.label,metric:e.legend.label}}),[f,y]=(0,d.useState)(null),b=(0,d.useCallback)((e=>{y(e)
E(null==e?null:function getTooltipInfo(e,t){return{left:e.x+e.targetBinWidth+t.left,offsetLeft:6,top:e.y+e.targetBinHeight/2+t.top,offsetTop:-27,point:e.dataPoint}}(e,c))}),[E,c]),T=null==a?void 0:e=>{var t
null!=(null===(t=null==e?void 0:e.dataPoint)||void 0===t?void 0:t.point)&&a(e.dataPoint.point)},{clientId:v}=Yh(),C=`lines-${v}`
return d.createElement("svg",{height:i,width:s,shapeRendering:"crispEdges"},d.createElement(HeatmapWrapper,{offsetPosition:c,points:m,xScale:p.scale,yScale:h.scale,onClickPoint:T,onMouseLeave:b,onMouseMove:b},d.createElement(Bg.Z,{id:C,height:20,width:20,stroke:Vt.tN,strokeWidth:1,orientation:["diagonal"]}),d.createElement("rect",{fill:`url(#${C})`,height:r,width:o}),d.createElement(jg,{chartHeight:r,chartWidth:o,heatmapRectProps:u}),d.createElement(Axis_AxisLeft,{axisConfig:h,hideAxisLine:!0}),d.createElement(Axis_AxisTop,{axisConfig:p,hideAxisLine:!0}),g&&d.createElement(ChartTooltip,{...g}),null==f?null:d.createElement("rect",{fill:"transparent",height:f.targetBinHeight,pointerEvents:"none",stroke:Vt.Rl,strokeWidth:3,width:f.targetBinWidth,x:f.x,y:f.y})),d.createElement(GradientSeriesLegend,{...l}))}function HeatmapChartWrapper(e){return d.createElement(BenchlingChart,null,(({height:t,width:n})=>d.createElement(Heatmap,{...e,height:t,width:n})))}var Yg=n(399658)
function convertDataFrameToLegacyChartData(e,t){const n=function makeChartFriendlyDataFrame(e,t){const n=e.columns.filter((e=>(0,$d.Z)(e))),a=t.map((t=>{const{chartDataColumnName:n,inputDataColumnSystemName:a,typeValidationOptions:i}=t,s=(0,Dg.Z)(e,a)
return{...s,type:{...s.type,leafType:(0,ad.ZP)(s.type,i)},systemName:n}})).concat(n),i=e.rows.map((e=>{const n=(0,he.Z)(e,...Object.values(Yg.Cb))
return t.reduce(((t,n)=>{const{chartDataColumnName:a,inputDataColumnSystemName:i}=n
return{...t,[a]:e[i]}}),n)}))
return{...e,columns:a,rows:i}}(e,t)
return convertDataFrameToDeprecatedDataFrame(n)}function getHeatmapColumnInfos(e){return[{chartDataColumnName:"x",inputDataColumnSystemName:e.xAxisColumnName,typeValidationOptions:Hg.x,cleanupNulls:!0},{chartDataColumnName:"y",inputDataColumnSystemName:e.yAxisColumnName,typeValidationOptions:Hg.y,cleanupNulls:!0},{chartDataColumnName:"metric",inputDataColumnSystemName:e.metricColumnName,typeValidationOptions:Hg.metric,cleanupNulls:!1}]}function convertDeprecatedHeatmapData(e,t){const n=function cleanAndValidateHeatmapData(e,t){return cleanAndValidateDataFrame(e,getHeatmapColumnInfos(t),cu.nB.HEATMAP)}(e,t)
return convertDataFrameToLegacyChartData(n,getHeatmapColumnInfos(t))}function convertHeatmapConfig(e,t){return{legend:{label:(0,nd.ZP)(e,t.metricColumnName).displayName},ascendingOrder:"ASCENDING_METRIC_VALUES"===t.gradientDirection}}function maybeConvertHeatmapProps(e,t){return maybeConvertProps((()=>function convertHeatmapProps(e,t){return{valid:!0,props:{data:convertDeprecatedHeatmapData(e,t),config:convertHeatmapConfig(e,t)}}}(e,t)))}const Qg=xa.Ps`
  query AnalyticsChipItemResolutionQuery(
    $batchIds: [StrictString!]!
    $bioentityIds: [StrictString!]!
    $entryIds: [StrictString!]!
    $requestIds: [StrictString!]!
    $processIds: [StrictString!]!
    $processOutputIds: [StrictString!]!
    $processTaskIds: [StrictString!]!
    $storableIds: [StrictString!]!
  ) @skipAudit @engComponent(name: INSIGHTS) {
    batches(ids: $batchIds) {
      ... on BatchNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
    bioentities(ids: $bioentityIds) {
      ... on RegistryItemInterface {
        id
        displayLabel
      }
      ...InaccessibleInfoGraphQL
    }
    entries(ids: $entryIds) {
      ... on EntryNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
    processes(ids: $processIds) {
      ... on ProcessNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
    processOutputs(ids: $processOutputIds) {
      ... on ProcessOutputNode {
        id
        name
        process {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
    processTasks(ids: $processTaskIds) {
      ... on ProcessTaskNode {
        id
        name
        process {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
    requests(ids: $requestIds) {
      ... on RequestNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
    storables(ids: $storableIds) {
      ... on StorableInterface {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function itemIdsToQueryVariables(e){const t={batchIds:e.filter((e=>ou[su.BATCH](e))),bioentityIds:e.filter((e=>ou[su.BIOENTITY](e))),entryIds:e.filter((e=>ou[su.ENTRY](e))),processIds:e.filter((e=>ou[su.PROCESS](e))),processOutputIds:e.filter((e=>ou[su.PROCESS_OUTPUT](e))),processTaskIds:e.filter((e=>ou[su.PROCESS_TASK](e))),requestIds:e.filter((e=>ou[su.REQUEST](e))),storableIds:e.filter((e=>ou[su.STORABLE](e)))};(0,S.Gp)(e.length===function countItemIdsInQueryVariables(e){return Object.values(e).flat().length}(t),"Expected to query for all itemIds, but some are missing")
return t}function useResolvedChipItemIdMap(e){const t=(0,d.useMemo)((()=>{const t=Array.from(function runQueryOutputToChipItemIds(e){const{chipRangeEnd:t}=runQueryOutputToChipRange(e),n=e.rows.slice(0,t).flatMap((e=>e.flatMap((e=>{var t
return null!==(t=cellToChipItemIds(e))&&void 0!==t?t:[]}))))
return new Set(n)}(e))
return itemIdsToQueryVariables(t)}),[e]),n=(0,Da.IJ)(Qg,{variables:t}),a=n.type===Da.NI.SUCCESS?n.data:null,i=(0,d.useMemo)((()=>null!=a?function queryDataToResolvedChipItemIdMap(e){const t={}
for(const n of[...(0,ka.mj)(e.batches),...(0,ka.mj)(e.entries),...(0,ka.mj)(e.requests),...(0,ka.mj)(e.processes),...(0,ka.mj)(e.processOutputs),...(0,ka.mj)(e.processTasks),...(0,ka.mj)(e.storables)])t[n.id]={name:n.name}
for(const n of(0,ka.mj)(e.bioentities))t[n.id]={name:n.displayLabel}
return t}(a):{}),[a])
return{queryResultType:n.type,resolvedChipItemIdMap:i}}function resolveCell(e,t){const n=cellToItemIds(e,(e=>null!=t[e]))
if(null!=n){return n.map((e=>t[e].name)).join(", ")}return e}function withIdsAsNames(e,t){return{...e,rows:e.rows.map((e=>e.map((e=>resolveCell(e,t)))))}}function useResolvedRunQueryOutput(e){const{queryResultType:t,resolvedChipItemIdMap:n}=useResolvedChipItemIdMap(e)
return{queryResultType:t,resolvedRunQueryOutput:withIdsAsNames(e,n)}}function getAllXValues(e){return e.flatMap((({data:e})=>e.map((({x:e})=>e))))}function getDatasetColor(e){const t=e%Tp.length,n=Tp[t]
return{backgroundColor:n,borderColor:n}}var Kg,Jg,Xg=n(452868),eE=n.n(Xg)
eE().defaults.global.defaultFontFamily=_n.I3
eE().defaults.global.defaultFontSize=_n.hv.fontSize
function DeprecatedChartJSChart({chartConfiguration:e,height:t,dataTestAttrs:n}){const a=(0,d.useRef)(null);(0,d.useEffect)((()=>{qt.isNodeTesting||function updateChartIfExists(e,t){if(e){Object.assign(e,t)
e.update()}}(a.current,e)}),[e])
const i=(0,d.useCallback)((t=>{if(!qt.isNodeTesting){!function tearDownChartIfExists(e){e&&e.destroy()}(a.current)
a.current=t?function setUpChart(e,t){return new(eE())(e,t)}(t,e):null}}),[e])
return d.createElement("div",{className:"u-flex-grow u-no-select u-overflow-hidden u-position-relative u-width-full u-height-full",...(0,ee.Z)(n)},d.createElement("canvas",{ref:i}))}!function(e){e.CATEGORICAL="CATEGORICAL"
e.LINEAR="LINEAR"
e.TIME="TIME"}(Kg||(Kg={}))
!function(e){e.LINE="line"}(Jg||(Jg={}))
const tE={[Kg.CATEGORICAL]:"category",[Kg.LINEAR]:"linear",[Kg.TIME]:"time"}
function getTimeScale(e){if(e.length){const t=l.default.sortBy(e),n=t[0],a=t[t.length-1],i=Zd().duration(Zd()(a).diff(n))
if(i.asDays()>1&&i.asMonths()<1)return{unit:"day"}}return{unit:void 0}}function getCategoricalLabels(e){const t=new Set(e)
return(0,Jt.SL)(Array.from(t))}function getTooltipLabel(e,t){const n=t.datasets[e.datasetIndex].data[e.index]
return`(${String(n.x)}, ${e.value})`}function getTooltipTitle(e,t){return[]}function Continuous2DChart({chartType:e,chartProps:t,dataTestAttrs:n}){return d.createElement(DeprecatedChartJSChart,{chartConfiguration:{type:e,data:{...t.xAxisScale===Kg.CATEGORICAL?{labels:getCategoricalLabels(getAllXValues(t.datasets))}:{},datasets:t.datasets.map(((e,n)=>function datasetToChartJS(e,t,n){return{...getDatasetColor(t),borderWidth:2,fill:!1,lineTension:0,...e,data:n?(0,hs.Z)(e.data,[{accessor:"x",naturalSort:!0},{accessor:"y",naturalSort:!1}]):(0,hs.Z)(e.data,["x","y"])}}(e,n,t.xAxisScale===Kg.CATEGORICAL)))},options:{...(a=t.datasets,{animation:{duration:0},legend:{display:a.some((({label:e})=>e))},maintainAspectRatio:!1}),scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:t.xAxisLabel},time:t.xAxisScale===Kg.TIME?getTimeScale(getAllXValues(t.datasets)):void 0,type:tE[t.xAxisScale],ticks:{callback:e=>truncateToMaxLengthLabel(e.toString())}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:t.yAxisLabel},ticks:{beginAtZero:t.yAxisIncludesZero},type:"linear"}]},tooltips:{callbacks:{label:getTooltipLabel,title:getTooltipTitle}}}},height:t.height,dataTestAttrs:n})
var a}function DeprecateLineChart(e){return d.createElement(Continuous2DChart,{chartType:Jg.LINE,chartProps:e})}const nE={[Wd.g.BOOLEAN]:!1,[Wd.g.DATE_OR_TIMESTAMP]:null,[Wd.g.JSON]:null,[Wd.g.NUMBER]:null,[Wd.g.STRING]:"No value"}
function coerceOrFilterNulls_coerceOrFilterNulls(e,t,n){const a=Object.keys(t)
return e.map((e=>function coerceRow(e,t,n){return t.reduce(((t,a)=>{var i
const s=n[a]
return{...t,[a]:null!==(i=e[a])&&void 0!==i?i:nE[s]}}),{})}(e,a,t))).filter((e=>!function shouldFilterRow(e,t){return t.some((t=>null==e[t]))}(e,n)))}const aE={[Wd.g.BOOLEAN]:e=>"boolean"==typeof e,[Wd.g.DATE_OR_TIMESTAMP]:e=>"string"==typeof e&&Zd()(e,Zd().ISO_8601,!0).isValid(),[Wd.g.JSON]:e=>!0,[Wd.g.NUMBER]:e=>"number"==typeof e,[Wd.g.STRING]:e=>"string"==typeof e}
function inferAndValidateTypes(e,t){const n=function inferColumnTypes(e,t){return Object.keys(t).map((n=>{const a=e.map((e=>e[n]))
return{columnName:n,columnType:iE.filter((e=>t[n].includes(e))).find((e=>function testValuesType(e,t){return e.every((e=>aE[t](e)||null==e))}(a,e)))}}))}(e,t),a=n.filter((e=>void 0===e.columnType))
return a.length>0?{valid:!1,invalidColumns:a.map((e=>e.columnName))}:function makeValidOutput(e){return{valid:!0,columnTypes:e.reduce(((e,t)=>({...e,[t.columnName]:t.columnType})),{})}}(n)}const iE=[Wd.g.BOOLEAN,Wd.g.NUMBER,Wd.g.DATE_OR_TIMESTAMP,Wd.g.STRING,Wd.g.JSON]
function runQueryOutputToChartData(e,t,n,a){var i,s;(0,S.Gp)(t.filter((e=>e.isSeriesLabel)).length<2,"Expected at most one series label column.")
const r=function runQueryOutputToDataset(e,t){const n=t.map((t=>{const n=e.headers.indexOf(t.runQueryColumnName)
if(-1===n)throw new ConvertToChartPropsException(makeColumnNameNotFoundErrorMessage(t.chartDataColumnName,t.runQueryColumnName))
return[t.chartDataColumnName,n]}))
return e.rows.map((e=>(0,Jt.m8)(n.map((([t,n])=>[t,e[n]])))))}(e,t),o=inferAndValidateTypes(r,(0,Jt.m8)(t.map((e=>[e.chartDataColumnName,e.possibleTypes]))))
if(!1===o.valid){const e=o.invalidColumns[0],i=t.find((t=>t.chartDataColumnName===e))
throw new ConvertToChartPropsException(function runQueryOutputToChartData_makeInvalidColumnTypeErrorMessage(e,t,n,a,i){const s=(0,Mt.Dw)(n.map((e=>Yg.R$[e])),"or")
return`${(0,Mt.kC)(e)} column "${t}" contains an invalid data type. ${(0,de._6)(2,ed.Qp[a])} ${i?`${i} `:""}only support ${s} ${e} columns.`}(e,i.runQueryColumnName,i.possibleTypes,n,a))}const l=o.columnTypes,c=t.filter((e=>e.filterNulls)).map((e=>e.chartDataColumnName)),d=null!==(s=null===(i=t.find((e=>e.isSeriesLabel)))||void 0===i?void 0:i.chartDataColumnName)&&void 0!==s?s:null
return{datasets:transformRowObjectsToDatasets(coerceOrFilterNulls_coerceOrFilterNulls(r,l,c),d),axisTypes:l}}function transformRowObjectsToDatasets(e,t){return 0===e.length?[]:null==t?[{points:e}]:function partitionDataset(e,t){const n=e.reduce(((e,n)=>{e.set(n[t],[...e.get(n[t])||[],n])
return e}),new Map)
return Array.from(n).map((([e,n])=>({label:e,points:n.map((e=>(0,ig.Z)(e,t)))})))}(e,t).map((({label:e,points:t})=>({label:e,points:t})))}function maybeConvertToContinuous2DChartProps(e,t,n,a){return maybeConvertProps((()=>function convertToContinuous2DChartProps(e,t,n,a){const i=function getDisplayNameBasedParameters(e,t){const n=(0,nd.ZP)(e,t.xAxisColumnName).displayName,a=(0,nd.ZP)(e,t.yAxisColumnName).displayName,i=null!=t.seriesColumnName?(0,nd.ZP)(e,t.seriesColumnName).displayName:null
return{...t,xAxisColumnName:n,yAxisColumnName:a,seriesColumnName:i}}(e,n),s=function convertToBaseChartProps(e,{seriesColumnName:t,xAxisColumnName:n,yAxisColumnName:a},i,s){let r=[{chartDataColumnName:"x",runQueryColumnName:n,possibleTypes:i,filterNulls:!0},{chartDataColumnName:"y",runQueryColumnName:a,possibleTypes:[Wd.g.NUMBER],filterNulls:!0}]
null!=t&&(r=[...r,{chartDataColumnName:"series",runQueryColumnName:t,possibleTypes:[Wd.g.NUMBER,Wd.g.STRING],filterNulls:!0,isSeriesLabel:!0}])
const o=runQueryOutputToChartData(e,r,s)
if(o.datasets.length>100)throw new ConvertToChartPropsException("Chart cannot render more than 100 different series")
return{props:{datasets:o.datasets.map((e=>({data:e.points,...null==e.label?{}:{label:e.label.toString()}}))),xAxisLabel:n,yAxisLabel:a},valid:!0,xAxisType:o.axisTypes.x}}(t,i,[Wd.g.NUMBER,Wd.g.DATE_OR_TIMESTAMP,Wd.g.STRING],a),r={yAxisIncludesZero:n.yAxisIncludesZero}
switch(s.xAxisType){case Wd.g.NUMBER:return{valid:!0,props:{...s.props,...r,xAxisScale:Kg.LINEAR}}
case Wd.g.DATE_OR_TIMESTAMP:return{valid:!0,props:{...s.props,...r,xAxisScale:Kg.TIME}}
case Wd.g.STRING:return{valid:!0,props:{...s.props,...r,xAxisScale:Kg.CATEGORICAL}}
default:throw new Error(`Unexpected axis type: ${(0,Go.vE)(s)}`)}}(e,t,n,a)))}var sE=n(462885),rE=n(919597)
function PieChartSlice({arc:e,color:t,config:{sliceLabels:{showSliceName:n,showValue:a,showPercentage:i}},getNumericLabel:s,estimateMaxLabelLength:r,isFaded:o,isHovered:l,onHover:c,pie:u,sliceNameAccessor:m,totalPieValue:p,valueAccessor:h}){const[g,E]=u.path.centroid(e),f=u.path.outerRadius()(e),{x:S,y}=function calculateHoverTranslation(e,t,n){const a=Math.sqrt(e*e+t*t)
return{x:e/a*(.1*n),y:t/a*(.1*n)}}(g,E,f),{translate:b}=(0,rE.useSpring)({translate:l?[S,y]:[0,0],config:{duration:50}}),T=m(e.data),v=h(e.data),C=v<p,I=e.endAngle-e.startAngle>=.2,w=function getLabelAnchor(e){const t=Math.abs((e.endAngle+e.startAngle)/2-Math.PI)<.1,n=(e.endAngle+e.startAngle)/2>Math.PI?"end":"start"
return t?"middle":n}(e),{labelX:N,labelY:A}=function calculateLabelPosition(e,t,n,a){const i=Math.sqrt(e*e+t*t),s=a?oE+5:oE
return{labelX:e/i*(n+s),labelY:t/i*(n+s)}}(g,E,f,a||i),R=u.path(e)
return d.createElement(d.Fragment,null,d.createElement(rE.animated.g,{...(0,ee.Z)({component:"PieChartSlice",element:"root"}),transform:C?b.to(((e,t)=>`translate(${e}, ${t})`)):void 0,opacity:o?.35:1},d.createElement("path",{d:null!=R?R:void 0,fill:t}),I&&d.createElement(xh.Z,{top:A,left:N},n&&d.createElement("text",{fill:Vt.pp,fontSize:Ip,textAnchor:w},truncateToMaxLengthLabel(String(T),r(N))),(a||i)&&d.createElement("text",{y:n?Np:0,fill:Vt.pp,fontSize:Ip,textAnchor:w},s(v,p,a,i)))),d.createElement("path",{d:null!=R?R:void 0,fill:"transparent",onMouseEnter:()=>{c(e)},onMouseLeave:()=>{c()}}))}function getDiscreteColorScale(e){return(0,_h.Z)({domain:e,range:Tp})}function getSeriesColorConfig(e,t){if(!(0,ng.XN)(e))return{colorPalette:Sn.BL.DISCRETE,colorScale:getDiscreteColorScale([])}
switch(t){case Sn.BL.DISCRETE:return{colorPalette:t,colorScale:getDiscreteColorScale(e.map((e=>e.label)))}
case Sn.BL.GRADIENT:return{colorPalette:t,colorScale:function getGradientColorScale(e){return(0,Jh.Z)({domain:(0,qg.Z)(e),range:vp})}(e.map((e=>e.label)))}
default:(0,S.hu)(!1,`Got unexpected color palette ${(0,Go.vE)(t)}`)}}const oE=13,lE={measure:{allowedLeafTypes:[Hd.i0.DECIMAL,Hd.i0.INTEGER,Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},sliceName:{allowedLeafTypes:[Hd.i0.DECIMAL,Hd.i0.INTEGER,Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.ALLOWED}}
function getNumericLabel(e,t,n,a){const i=e/t*100
return n&&a?`${(0,rg.Z)(e)} (${Math.round(i)}%)`:n?(0,rg.Z)(e):a?`${Math.round(i)}%`:""}function PieChart(e){const[t,n]=(0,d.useState)(null),a=(0,d.useRef)(null),{columnsMapping:i,config:{legend:s},dataFrame:r,height:o,width:l}=e,{accessors:c,validatedLeafTypes:u}=(0,Lm.yL)(r,i,lE),m=(0,nd.ZP)(r,i.measure),p=resolvedStringAccessor(c.sliceName,r.hydratedProperties,ed.vm),h=numericAccessor(c.measure,u.measure),{tooltipProps:E,updateTooltipProps:f}=useChartTooltip({axisTypes:{[i.measure]:Wd.g.STRING},columnLabels:{[i.measure]:m.displayName},columnNames:[i.measure]}),{excludedSeries:S,filteredDataFrame:y,toggleExcludedSeries:b}=useSeriesExcludedWithDataFrameState(r,p),T=null!=s,v=getDiscreteColorScale(r.rows.map((e=>p(e)))),C=T?function estimateDiscreteSeriesLegendWidth(e,t){let n=0
for(const t of e.domain()){const e=estimateDiscreteSeriesLegendItemWidth("string"==typeof t?t:(0,rg.Z)(t))
n=Math.max(n,e)}return Math.min(t,n+30)}(v,.33*l):0,I=l-C,w=o,{chartWidth:N,chartHeight:A}=getChartDimensions({top:Ap+Np,right:Ap,bottom:Ap+Np,left:Ap},I,w),R=Math.min(N,A)/2-oE,P=w/2,O=I/2,x=y.rows.reduce(((e,t)=>e+h(t)),0)
function onHoverSlice(e,t){if(null!=t){const[a,s]=e.path.centroid(t)
n(p(t.data))
f({top:s+P,label:{color:v(p(t.data)),text:p(t.data)},left:a+O,offsetTop:0,offsetLeft:10,point:{[i.measure]:getNumericLabel(h(t.data),x,!0,!0)}})}else{n(null)
f(null)}}const _=null!=s&&d.createElement(DiscreteSeriesLegend,{colorConfig:{colorScale:v,colorPalette:Sn.BL.DISCRETE},width:C,height:o,direction:Sg.z.COLUMN,location:s.location,excludedSeries:S,onClickLegendItem:b,onHoverItem:function onHoverLegendItem(e){if(null==a.current)return
const t=a.current.arcs.find((t=>p(t.data)===e))
onHoverSlice(a.current,null!=t?t:void 0)}})
function estimateMaxLabelLength(e){return.169*(I/2-Math.abs(e))-1.25}return d.createElement("div",{className:(0,g.iv)(cE.chartContainer)},T&&(null==s?void 0:s.location)===Sg.L.LEFT&&_,d.createElement("svg",{width:I,height:w},E&&d.createElement(ChartTooltip,{...E}),d.createElement(xh.Z,{top:P,left:O},d.createElement(sE.Z,{data:y.rows,pieValue:h,outerRadius:R},(n=>{a.current=n
return n.arcs.map(((a,i)=>{const s=t===p(a.data)
return d.createElement(PieChartSlice,{key:`arc-${p(a.data)}-${i}`,arc:a,color:v(p(a.data)),config:e.config,getNumericLabel,estimateMaxLabelLength,isFaded:null!=t&&!s,isHovered:s,onHover:e=>{onHoverSlice(n,e)},pie:n,sliceNameAccessor:p,totalPieValue:x,valueAccessor:h})}))})))),T&&(null==s?void 0:s.location)===Sg.L.RIGHT&&_)}function PieChartWrapper(e){return d.createElement(BenchlingChart,{dataTestAttrs:{component:"PieChart",element:"root"}},(({height:t,width:n})=>d.createElement(PieChart,{...e,height:t,width:n})))}const cE=g.mM.create({chartContainer:{display:"flex",flexDirection:"row"}})
function convertPieChartConfig(e){const{showPercentageInLabel:t,showSliceNameInLabel:n,showValueInLabel:a}=e,i=null!=e.legendLocation?ed.oV[e.legendLocation]:null
return{sliceLabels:{showPercentage:t,showSliceName:n,showValue:a},...null!=i?{legend:{location:i}}:{}}}function convertPieChartProps(e,t){var n
const a=null!==(n=t.aggregationType)&&void 0!==n?n:Sn.FP.COUNT,i={...t,aggregationType:a,measureColumnName:a===Sn.FP.COUNT?t.sliceColumnName:t.measureColumnName},s=function getPieChartColumnInfos(e){return[{chartDataColumnName:"sliceName",inputDataColumnSystemName:e.sliceColumnName,typeValidationOptions:lE.sliceName,cleanupNulls:!0},{chartDataColumnName:"measure",inputDataColumnSystemName:e.measureColumnName,typeValidationOptions:lE.measure,cleanupNulls:!0}]}(i),r=function cleanAndValidatePieChartDataFrame(e,t,n){const a=cleanAndValidateDataFrame(e,n,cu.nB.PIE_CHART),i=(0,nd.ZP)(a,t.measureColumnName)
if(null==t.aggregationType)throw new ConvertToChartPropsException("Pie chart has invalid aggregation")
if(t.aggregationType!==Sn.FP.COUNT&&!(0,Wd.fx)(i.type))throw new ConvertToChartPropsException(`Pie charts with ${ed.CA[t.aggregationType].toLowerCase()} aggregation only support numerical measure columns`)
return a}(e,i,s)
return{valid:!0,props:{columnsMapping:getDataFrameColumnsMapping(0,s),config:convertPieChartConfig(i),dataFrame:r}}}function hasColumn(e,t){return e.axisTypes.hasOwnProperty(t)&&e.points.every((e=>e.hasOwnProperty(t)))}function hasOptionalColumn(e,t){return hasColumn(e,t)}function areObjectKeysSubset(e,t){return Object.keys(e).every((e=>Object.keys(t).includes(e)))}function filterRows_filterRows(e,t){return{...e,points:e.points.filter(((e,n)=>t(e,n)))}}const dE={actionOrigin:cd.Z.INSIGHTS,viewStateId:"BlockViewState-UNKNOWN"},uE=(0,Hh.x)((()=>{(0,S.Gp)(!1,`Could not find block view context while rendering analytics component, defaulting to ${dE}`)
return dE}),"BlockViewContext")
var mE=n(85802),pE=n(314647)
function inputToMaskedDataFrame(e){return function addColumn(e,t,n){const{name:a,type:i}=t;(0,S.Gp)(!hasColumn(e,a),`Expected column "${a}" to not already exist in the dataFrame`)
return{...e,axisTypes:{...e.axisTypes,[a]:i},points:e.points.map(((e,t)=>({...e,[a]:n(e,t)})))}}(e,Yg.QB,(e=>!1))}function isMaskingStateCompatibleWithDataFrameType(e,t){return function areDataFrameColumnsCompatible(e,t){return areObjectKeysSubset(t.axisTypes,e.axisTypes)&&e.points.every((e=>areObjectKeysSubset(t.axisTypes,e)))}(e.inputDataFrame,t)}function useMaskedBlockViewState({inputDataFrame:e}){const t=hasOptionalColumn(e,"id");(0,S.hu)(!t||function areColumnValuesUnique(e,t){return new Set(e.points.map((e=>e[t]))).size===e.points.length}(e,"id"),"Expected ids in the id column to be unique")
const{viewStateId:n}=uE.useContext(),a=(0,_a.v9)((e=>new pE.aR(e).getMaskingState(n))),i=(0,_a.I0)(),s=(0,d.useCallback)((e=>{i((0,mE.RF)(n,e))}),[n,i]),r=null==a?void 0:a.inputDataFrame;(0,d.useEffect)((()=>{Is()(e,r)||s({inputDataFrame:e,maskedDataFrame:inputToMaskedDataFrame(e)})}),[e,r,s])
const o=null!=a&&isMaskingStateCompatibleWithDataFrameType(a,e)?a.maskedDataFrame:inputToMaskedDataFrame(e)
return t?{maskedDataFrame:o,isMaskingEnabled:!0,onToggleRowMask:t=>{(0,S.Gp)(filterRows_filterRows(o,(e=>e.id===t.id)).points.length>0,"Expected toggled dataRow.id to exist in the input dataFrame")
s({inputDataFrame:e,maskedDataFrame:(n=o,a=e=>t.id===e.id,i=e=>({...e,isMasked:!e.isMasked}),{...n,points:n.points.map((e=>a(e)?i(e):e))})})
var n,a,i}}:{maskedDataFrame:inputToMaskedDataFrame(e),isMaskingEnabled:!1}}function filterMaskedRows(e){return hasOptionalColumn(e,"isMasked")?filterRows_filterRows(e,(e=>!e.isMasked)):e}var hE=n(967687),gE=n(438633)
const EE=withPromisePool((function _runLogisticRegression(e){return an.s0({url:"/1/api/insights/statistics:run-hill-curve-fit",data:e})}),dt.ZP.INSIGHTS_MAX_CONCURRENT_REGRESSIONS_PER_BROWSER_TAB)
function convertDatasetToCurveFitData(e,t,n=null){return{fitFunctionToColumnMap:{rowIds:Yg.Cb.ROW_ID,xValues:"x",yValues:"y"},dataframe:{dataTypes:{[Yg.Cb.ROW_ID]:e.axisTypes.benchcol_row_id,x:e.axisTypes.x,y:e.axisTypes.y},points:e.points.map((e=>({[Yg.Cb.ROW_ID]:e.benchcol_row_id,x:e.x,y:e.y})))},outlierConfig:null!=n?convertGQLToRESTOutlierConfig(n):null,regressionConfig:t}}const fE=d.createElement("p",null,"For non-linear models, ",d.createElement(LatexEquation,{equation:"R^2",displayMode:Jp.INLINE})," does not necessarily capture goodness-of-fit. We also include a p-value for how likely it is that the observations occurred by random chance, rather than following a logistic distribution. Lower p-values imply a more statistically significant model fit.")
function convertAsyncRegressionStateToAnalysis(e){if(e.status===Wr.Lr.NOT_FETCHED||e.status===Wr.Lr.LOADING)return{status:gE._.LOADING}
if(e.status===Wr.Lr.ERROR)return{status:gE._.ERROR,message:e.message}
{const t=e.data
return{status:gE._.SUCCESS,result:{getEstimatedY:e=>function estimatePointY(e,t){return t.min+(t.max-t.min)/(1+10**((t.logIC50-Math.log10(e))*t.hillSlope))}(e,t),detectedOutliers:new Set(t.detectedOutliers),fitEquation:null,outputValues:[{fieldName:"IC50",showInPlotHeader:!0,value:t.ic50},{fieldName:"Slope",showInPlotHeader:!1,value:t.hillSlope},{fieldName:"Min",showInPlotHeader:!1,value:t.min},{fieldName:"Max",showInPlotHeader:!1,value:t.max},{fieldName:"p",showInPlotHeader:!0,value:t.relativeLikelihoodOfNull},{fieldName:"R2",fieldNameDisplayOverride:Xp.X7,showInPlotHeader:!0,value:t.R2}],fitOutput:t,tooltipDisclaimer:fE}}}}function performRegressionAnalysis(e,t,n,a=null){const{regressionType:i}=t
switch(i){case ep.ZZ.LINEAR:n((0,hE.AT)(e))
break
case ep.ZZ.LOGISTIC:(0,ep.k5)(e)
!function performLogisticRegressionAnalysis(e,t,n,a){(0,Wr.cC)({makeCall:EE,args:[convertDatasetToCurveFitData(e,t,a)],asyncState:{status:Wr.Lr.NOT_FETCHED},setAsyncState:e=>{n(convertAsyncRegressionStateToAnalysis(e))}})}(e,t,n,a)
break
default:throw new Error(`Invalid regression type ${(0,Go.vE)(i)}`)}}var SE=n(166310),yE=n(174554),bE=n(776376)
function XAxis(e){return d.createElement(bE.Z,{hideTicks:!0,label:e.label,numTicks:e.suggestedNumTicks,orientation:"bottom",tickFormat:e.tickLabelFormatter,tickLabelProps:()=>0!==e.tickLabelRotation?{angle:-e.tickLabelRotation,textAnchor:"end"}:{}})}function YAxis(e){return d.createElement(bE.Z,{hideTicks:!0,label:e.label,numTicks:e.suggestedNumTicks,orientation:"left",tickFormat:e.tickLabelFormatter})}var TE=n(916666)
function Cross({color:e,radius:t,x:n,y:a}){return d.createElement(d.Fragment,null,d.createElement(Uh.Z,{from:{x:n-t,y:a-t},to:{x:n+t,y:a+t},stroke:e,strokeWidth:3}),d.createElement(Uh.Z,{from:{x:n+t,y:a-t},to:{x:n-t,y:a+t},stroke:e,strokeWidth:3}))}function dataAccessor(e,t){return n=>t===Wd.g.DATE_OR_TIMESTAMP?Zd()(n[e]).toDate():n[e]}function dataAccessorForColumnIfPresent(e,t){return null==t?null:dataAccessor(e,t)}const vE=d.memo((function CartesianPoint({axisTypes:e,color:t,isHovered:n,dataPoint:a,dataPointKey:i,onClick:s,onHover:r,x:o,y:l}){const c=dataAccessorForColumnIfPresent("isMasked",e.isMasked),u=dataAccessorForColumnIfPresent("isOutlier",e.isOutlier),m=null!=c&&c(a),p=null!=u&&u(a)
return d.createElement(xh.Z,{left:o,pointerEvents:"all",onClick:()=>{null!=s&&s(a)},onMouseLeave:()=>{r(null)},onMouseOver:()=>{r({dataPoint:a,dataPointKey:i,x:o,y:l})},top:l},d.createElement(TE.Z,{fill:"none",r:6}),p?d.createElement(Cross,{color:m?"#ECCFC7":"#FC6535",radius:n?6:4,x:0,y:0}):d.createElement(TE.Z,{fill:m?Fp:t,r:n?6:4}))}))
const CE=(0,n(253575).Z)({backgroundColor:Vt.Cj,colors:[],gridColor:Vt.tN,gridColorDark:Vt.pF,tickLength:8,svgLabelSmall:Dp,svgLabelBig:Dp,xAxisLineStyles:xp,yAxisLineStyles:xp})
function computeCartesianTheme(e,t,n){return(0,tm.ZP)(CE,(a=>{e&&(a.axisStyles.x.bottom.tickLength=4)
a.axisStyles.x.bottom.axisLabel={...a.axisStyles.x.bottom.axisLabel,...getBottomAxisLabelTranslation(t)}
a.axisStyles.y.left.axisLabel={...a.axisStyles.y.left.axisLabel,...getLeftAxisLabelTranslation(n)}}))}const IE={captureEvents:!1}
function CartesianPlot(e){var t
const{children:n,height:a,width:i,xAxis:s,yAxis:r,extraMargin:o}=e,{chartWidth:l,chartHeight:c,longestYTickLabelWidth:u,margins:m,xAxisConfig:p,yAxisConfig:h}=(0,d.useMemo)((()=>{const{chartWidth:e,chartHeight:t,margins:n,xAxisConfig:l,yAxisConfig:c}=fitChartAndLabels({defaultMargins:Op,height:a,width:i,xAxisOrientation:Rh.BOTTOM,xAxisConfig:s,yAxisConfig:r,extraMargin:o})
return{chartWidth:e,chartHeight:t,longestYTickLabelWidth:Math.max(...getTickLabelWidths(c)),margins:n,xAxisConfig:l,yAxisConfig:c}}),[a,i,s,r,o])
p.scale.range([0,l])
h.scale.range([c,0])
return d.createElement(d.Fragment,null,d.createElement(xh.Z,{left:m.left,top:m.top},d.createElement(ChartGrid,{xAxisConfig:p,yAxisConfig:h,width:l,height:c})),d.createElement(yE.Z,{...IE,height:a,margin:m,width:i,theme:computeCartesianTheme(0!==p.tickLabelRotation,m.bottom,u),xScale:p,yScale:h},d.createElement(ChartMask,{margins:{bottom:m.bottom-9,left:m.left-9,right:m.right-9,top:m.top-9},width:i,height:a}),d.createElement(XAxis,{label:p.label,tickLabelRotation:null!==(t=p.tickLabelRotation)&&void 0!==t?t:0,suggestedNumTicks:p.suggestedNumTicks,tickLabelFormatter:p.tickLabelFormatter}),d.createElement(YAxis,{label:h.label,suggestedNumTicks:h.suggestedNumTicks,tickLabelFormatter:h.tickLabelFormatter}),n))}var wE=n(241321),NE=n(261921)
const AE=["xScale","yScale"]
function useVisXContext(...e){const t=(0,d.useContext)(NE.Z);(0,S.hu)(e.filter((e=>!AE.includes(e))).every((e=>null!=t[e])),"useVisXContext called while not in CartesianPlot component tree")
return(0,jc.Z)(t,...e)}function getCartesianErrorRange(e){return null==e.y||null==e.errorValue?null:[e.y-e.errorValue,e.y+e.errorValue]}function CartesianErrorBar({color:e,dataPoint:t,x:n}){const{yScale:a}=useVisXContext("yScale"),i=getCartesianErrorRange(t)
if(null==i||null==a)return null
const s=i.map((e=>a(e)))
return d.createElement(d.Fragment,null,d.createElement(Uh.Z,{from:{x:n,y:s[0]},to:{x:n,y:s[1]},shapeRendering:"geometricPrecision",stroke:e,strokeWidth:1.5}),s.map(((t,a)=>d.createElement(Uh.Z,{key:a,from:{x:n-5,y:t},to:{x:n+5,y:t},shapeRendering:"geometricPrecision",stroke:e,strokeWidth:1.5}))))}function ErrorBarSeries({color:e,data:t,label:n,xAccessor:a,yAccessor:i}){const s=null==n?Lp:e
return d.createElement(d.Fragment,null,d.createElement(wE.Z,{dataKey:`${n}-error-bars`,data:t.filter((e=>null!=e.errorValue)),xAccessor:a,yAccessor:i,renderGlyph:({x:e,y:t,datum:n})=>d.createElement(CartesianErrorBar,{color:s,dataPoint:n,x:e})}))}function getCartesianAccessors(e){return{xAccessor:dataAccessor("x",e.x),yAccessor:dataAccessor("y",e.y)}}function CartesianPointsWrapper(e){return d.createElement(RE,{...e})}const RE=d.memo((function _CartesianPoints({axisTypes:e,colorConfig:t,dataset:n,errorValueLabel:a,onClickPoint:i,xAxisLabel:s,yAxisLabel:r}){var o
const{clientId:l}=Yh(),c=function getColorForDataset(e,t){return(0,ng.jW)(e)?(t.colorPalette,Sn.BL.DISCRETE,t.colorScale(e.label)):Cp}(n,t),u=(0,d.useMemo)((()=>(0,ng.jW)(n)?{color:c,text:String(n.label)}:void 0),[c,n]),m=getCartesianAccessors(e),{tooltipProps:p,updateTooltipProps:h}=useChartTooltip({axisTypes:e,columnLabels:{x:s,y:r,...null==e.errorValue?{}:{errorValue:a}},columnNames:["x","y",...null==e.errorValue?[]:["errorValue"]]}),[g,E]=(0,d.useState)(null),f=(0,d.useCallback)((e=>{var t
E(null!==(t=null==e?void 0:e.dataPointKey)&&void 0!==t?t:null)
h(function getTooltipProps(e,t){return null!=e?{left:e.x,point:e.dataPoint,top:e.y,label:t,...null!=e.dataPoint.pointWarning&&{warning:e.dataPoint.pointWarning}}:null}(e,u))}),[u,h])
return d.createElement(d.Fragment,null,d.createElement(xh.Z,{mask:`url(#${getChartMaskId(l)})`},d.createElement(ErrorBarSeries,{color:c,data:n.points,label:null==u?void 0:u.text,xAccessor:m.xAccessor,yAccessor:m.yAccessor}),d.createElement(wE.Z,{dataKey:null!==(o=null==u?void 0:u.text)&&void 0!==o?o:"__points",data:n.points,xAccessor:m.xAccessor,yAccessor:m.yAccessor,renderGlyph:({x:t,y:n,datum:a,key:s})=>d.createElement(vE,{axisTypes:e,color:c,isHovered:s===g,dataPoint:a,dataPointKey:s,onClick:i,onHover:f,x:t,y:n})})),p&&d.createElement(ChartTooltip,{...p}))}))
var PE=n(602335),OE=n(769673),xE=n(146636)
function RegressionLine(e){const{clientId:t}=Yh(),{axisTypes:n,dataset:a,domain:i,scale:s}=e,r=function interpolatePoints(e,t,n,a){let i
if(t===Wd.g.NUMBER){const[t,a]=[e[0],e[e.length-1]]
if(n===ng.OZ.LINEAR){const e=(a-t)/199
i=(0,OE.Z)(t,a+e,e)}else if(n===ng.OZ.LOG){const e=(Math.log10(a)-Math.log10(t))/199
i=(0,OE.Z)(Math.log10(t),Math.log10(a)+e,e).map((e=>Math.pow(10,e)))}else(0,S.hu)(!1,`Got unexpected axis scale ${(0,Go.vE)(n)}`)}else i=t===Wd.g.DATE_OR_TIMESTAMP?[e[0],...(0,xE.Z)().domain(e).ticks(198),e[1]]:e
return i.map((e=>({x:e,y:a(e)})))}(i,n.x,s,a.regressionAnalysis.result.getEstimatedY),o=getCartesianAccessors(n)
return d.createElement(PE.Z,{mask:`url(#${getChartMaskId(t)})`,data:r,dataKey:"fitted-curve",stroke:Vp,xAccessor:o.xAccessor,yAccessor:o.yAccessor,...(0,ee.Z)({component:"RegressionLine",element:"root"})})}var _E=n(731772),DE=n(65959)
function RegressionOutputTooltipContent({regressionResult:{outputValues:e,tooltipDisclaimer:t}}){const n=Uo.VB([e.map((e=>e.fieldName)),e.map((e=>e.value.toString()))],"\t")
return d.createElement("div",{className:(0,g.iv)(LE.wrapper)},d.createElement("div",{className:"u-lr-split"},d.createElement(so.Dx,null,"Regression values"),d.createElement(P.ZP,{title:"Copy values"},d.createElement(DE.Z,{size:C.qE.SMALL,value:n,buttonStyle:C.ZJ.CIRCLE_ICON}))),d.createElement(rc.iA,{numRows:e.length,isCompact:!0,getRowClassName:e=>0===e?(0,g.iv)(LE.noBoxShadow):""},d.createElement(rc.sg,{renderCell:t=>{var n
return null!==(n=e[t].fieldNameDisplayOverride)&&void 0!==n?n:e[t].fieldName}}),d.createElement(rc.sg,{renderCell:t=>(0,_E.Z)(e[t].value,null)})),d.createElement("span",{className:(0,g.iv)(LE.disclaimerWrapper)},t))}const LE=g.mM.create({wrapper:{width:190},disclaimerWrapper:{color:Vt.pp},noBoxShadow:{boxShadow:"none"}})
const kE=d.memo((function _PresentationalRegressionSummary(e){const t={...(0,ee.Z)({component:"RegressionSummary",element:"summarySection"}),className:(0,g.iv)(ME.section)}
let n=e.regressionAnalysis.result.outputValues.filter((({showInPlotHeader:e})=>e)).map((({fieldName:e,fieldNameDisplayOverride:n,value:a})=>d.createElement("span",{...t,key:e},`${null!=n?n:e} = ${(0,_E.Z)(a,null)}`)))
e.regressionAnalysis.result.fitEquation&&(n=[d.createElement("span",{...t,key:"equation"},e.regressionAnalysis.result.fitEquation),...n])
return d.createElement("foreignObject",{width:e.width,height:17,x:0,y:0},d.createElement("div",{style:{marginRight:e.margin.right},className:(0,g.iv)(ME.wrapper)},n,d.createElement(Oe.Z,{renderContent:()=>d.createElement(RegressionOutputTooltipContent,{regressionResult:e.regressionAnalysis.result}),placement:ne.ZH.LEFT,interaction:ne.x2.CLICK},d.createElement("span",{className:(0,g.iv)(ME.infoIcon)},d.createElement(pe.Z,{icon:"info-circle"})))))}))
function RegressionSummary(e){return d.createElement(kE,{...e,...useVisXContext("width","margin")})}const ME=g.mM.create({wrapper:{overflowX:"hidden",textAlign:"right",whiteSpace:"nowrap"},section:{..._n.cf,color:Vt.pp,marginLeft:24},infoIcon:{cursor:"pointer",color:Vt.pp,marginLeft:24}})
function SeriesLegend(e){return e.colorConfig.colorPalette===Sn.BL.DISCRETE?d.createElement(DiscreteSeriesLegend,{...e}):d.createElement(GradientSeriesLegend,{...e})}ng.xK,Wd.g.NUMBER,Wd.g.BOOLEAN,Wd.g.BOOLEAN
const FE=[Hd.i0.DATE,Hd.i0.DATETIME,Hd.i0.DECIMAL,Hd.i0.INTEGER,Hd.i0.TEXT],ZE={x:{allowedLeafTypes:FE,nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},y:{allowedLeafTypes:[Hd.i0.DECIMAL,Hd.i0.INTEGER],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},series:{allowedLeafTypes:[Hd.i0.TEXT,Hd.i0.DECIMAL,Hd.i0.INTEGER],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},isMasked:{allowedLeafTypes:[Hd.i0.BOOLEAN],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},isOutlier:{allowedLeafTypes:[Hd.i0.BOOLEAN],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED}},BE={top:8,left:0,right:0,bottom:0}
function shouldRenderDataset(e,t){return!(0,ng.jW)(e)||!t.has(e.label)}function ScatterPlot(e){var t,n,a
const{data:{axisTypes:i,datasets:s},config:{colorPalette:r,xAxis:o,yAxis:l}}=e;(0,S.Gp)(1===s.length||!s.find((e=>(0,ng.sk)(e))),"Expected to not receive a regression analysis with multiple series")
const{excludedSeries:c,toggleExcludedSeries:u}=useSeriesExcludedState(),m=getCartesianAccessors(i),p=s.filter((e=>shouldRenderDataset(e,c))).map((e=>({...e,points:e.points.filter((e=>{const t=m.yAccessor(e)
return(null==l.min||t>=l.min)&&(null==l.max||t<=l.max)}))}))),h=p.flatMap((e=>e.points))
assertWellFormedColumn({rows:h,columnTypes:i},"isMasked")
assertWellFormedColumn({rows:h,columnTypes:i},"isOutlier")
assertWellFormedColumn({rows:h,columnTypes:i},"pointWarning")
const E=h.map((e=>m.xAccessor(e))),f=function getCartesianErrorRangeExtents(e){const t=e.flatMap((e=>{var t
return null!==(t=getCartesianErrorRange(e))&&void 0!==t?t:[e.y]}))
return[Math.min(...t),Math.max(...t)]}(h),y=getVisxAxisConfig(o,i.x,E,{sortDomain:null===(t=o.sortDomain)||void 0===t||t}),b=getVisxAxisConfig(l,i.y,f,{extentOverride:[null!==(n=l.min)&&void 0!==n?n:null,null!==(a=l.max)&&void 0!==a?a:null]}),T=getSeriesColorConfig(s,r),{legendLocation:v,legendProps:C,remainingChartHeight:I,remainingChartWidth:w,showLegend:N}=function useSeriesLegend(e,t,n,a,i,s,r){if(s&&(0,ng.XN)(a)){if(e.colorPalette===Sn.BL.DISCRETE){const a=estimateDiscreteSeriesLegendHeight(e.colorScale,n)
return{legendLocation:Sg.L.TOP,legendProps:{colorConfig:e,excludedSeries:i,onClickLegendItem:r},remainingChartHeight:t-a,remainingChartWidth:n,showLegend:!0}}{const a=e.colorScale.domain(),i=n-estimateGradientSeriesLegendWidth(s.label,a[0],a[1])
return{legendLocation:Sg.L.RIGHT,legendProps:{colorConfig:e,chartHeight:t,chartWidth:i,label:s.label},remainingChartHeight:t,remainingChartWidth:i,showLegend:!0}}}return{legendLocation:Sg.L.TOP,legendProps:{colorConfig:e},remainingChartHeight:t,remainingChartWidth:n,showLegend:!1}}(T,e.height,e.width,s,c,e.config.legend,(e=>{u(e)})),A=s.some((e=>(0,ng.sk)(e)))?BE:void 0
return d.createElement(d.Fragment,null,N&&v===Sg.L.TOP?d.createElement(SeriesLegend,{...C}):null,d.createElement("svg",{height:I,width:e.width},c.size()===s.length?d.createElement("div",{className:(0,g.iv)(qE.banner)},d.createElement(SE.Z,null,"Please select a series.")):d.createElement(CartesianPlot,{xAxis:y,yAxis:b,height:I,width:w,extraMargin:A},p.map(((t,n)=>{var a
return shouldRenderDataset(t,c)?d.createElement(d.Fragment,{key:(0,ng.jW)(t)?t.label:0},(0,ng.sk)(t)&&d.createElement(d.Fragment,null,d.createElement(RegressionLine,{axisTypes:i,dataset:t,domain:y.scale.domain(),scale:o.scale}),d.createElement(RegressionSummary,{regressionAnalysis:t.regressionAnalysis})),d.createElement(CartesianPointsWrapper,{axisTypes:i,colorConfig:T,dataset:t,errorValueLabel:null===(a=e.config.errorBarConfig)||void 0===a?void 0:a.errorValueLabel,onClickPoint:e.onClickPoint,xAxisLabel:e.config.xAxis.label,yAxisLabel:e.config.yAxis.label})):null}))),N&&v===Sg.L.RIGHT?d.createElement(SeriesLegend,{...C}):null))}function ScatterPlotWrapper(e){return d.createElement(BenchlingChart,{dataTestAttrs:{component:"ScatterPlot",element:"root"}},(({height:t,width:n})=>d.createElement(ScatterPlot,{...e,height:t,width:n})))}const qE=g.mM.create({banner:{marginLeft:"20px",marginRight:"20px",marginTop:"10px"}})
function ChartErrorMessage({children:e,message:t}){return d.createElement("div",{className:(0,g.iv)(VE.container)},d.createElement("div",{className:(0,g.iv)(VE.message)},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:t})),d.createElement("div",{className:(0,g.iv)(VE.chart)},e))}const VE=g.mM.create({chart:{height:"100%",width:"100%"},container:{height:"100%",paddingBottom:32,width:"100%"},message:{height:32}})
const UE={[Sn.FP.COUNT]:e=>function aggregateCount(e,t){return e.length}(e),[Sn.FP.MEAN]:e=>function aggregateMean(e,t){return e.length>0?(0,Ag.J6)(e.map((e=>e[t]))):null}(e,"y"),[Sn.FP.SUM]:e=>function aggregateSum(e,t){return(0,de.Sm)(e.map((e=>e[t])))}(e,"y")},GE={[Sn.dA.STANDARD_DEVIATION]:e=>function aggregateStandardDeviation(e,t){return e.length>1?(0,Ag.IN)(e.map((e=>e[t]))):null}(e,"y"),[Sn.dA.STANDARD_ERROR]:e=>function aggregateStandardError(e,t){return e.length>1?(0,Ag.fU)(e.map((e=>e[t]))):null}(e,"y")}
function aggregateCartesianPoints(e,t,n,a){(0,S.Gp)(null==n||null!=t,"Can only calculate error bar values for aggregated points")
return null==t?e:function aggregateRows_aggregateRows(e,t,n,a){return{points:Object.values((0,Jt.vM)(e.points,t)).map((e=>n(e))),axisTypes:a}}(filterMaskedRows(e),(e=>String(e.x)),(a=>{return{pointWarning:a.some((e=>!0===e.isOutlier))?(i=(0,de.Sm)(a.map((e=>!0===e.isOutlier))),`Aggregation includes ${i} ${(0,de._6)(i,"outlier")}`):null,x:a[0].x,y:UE[t](a),...null==n?{}:{errorValue:GE[n](a)},...null==e.axisTypes.isOutlier?{}:{isOutlier:a.some((e=>!0===e.isOutlier))}}
var i}),{pointWarning:Wd.g.STRING,x:e.axisTypes.x,y:e.axisTypes.y,...null==n?{}:{errorValue:e.axisTypes.y},...e.axisTypes.isOutlier?{isOutlier:e.axisTypes.isOutlier}:{}})}function aggregateScatterPlotProps({data:e,config:t,...n},a){const i=e.datasets.map(((t,n)=>aggregateCartesianPoints(convertScatterPlotDataToDataFrame(e,n),a.aggregationType,a.errorBarType,a.outlierConfig))),s=e.datasets.map(((e,t)=>(0,ng.jW)(e)?{...e,label:e.label,points:i[t].points}:{...e,points:i[t].points}))
return{...n,data:{axisTypes:i[0].axisTypes,datasets:s},config:{...t,...getConfigOverride(t,a.aggregationType,a.errorBarType)}}}function getConfigOverride(e,t,n){return null==t?{}:{yAxis:{...e.yAxis,label:getAggregatedAxisName(t,e.yAxis.label)},...null==n?{}:{errorBarConfig:{errorValueLabel:Og[n]}}}}const zE="Log scale can only be used when all values are either positive or negative.",$E="Log scale can’t be used when values include 0.",WE="Log scale can’t be used when axis includes 0.",HE={[ep.ZZ.LOGISTIC]:Hd.XK},jE={allowedLeafTypes:[Hd.i0.JSON],nullableType:ad.FS.ALLOWED,listType:ad.FS.ALLOWED,maybeTextType:ad.FS.ALLOWED}
function getScatterPlotColumnInfos(e){var t
const n=getRegressionTypeFromConfig(e.regressionConfig)
return[{chartDataColumnName:"x",inputDataColumnSystemName:e.xAxisColumnName,typeValidationOptions:{...ZE.x,allowedLeafTypes:null!=n&&null!==(t=HE[n])&&void 0!==t?t:FE},cleanupNulls:!0},{chartDataColumnName:"y",inputDataColumnSystemName:e.yAxisColumnName,typeValidationOptions:ZE.y,cleanupNulls:!0},...null==e.seriesColumnName?[]:[{chartDataColumnName:"series",inputDataColumnSystemName:e.seriesColumnName,typeValidationOptions:ZE.series,cleanupNulls:!0}],...null==e.rowIdColumnName?[]:[{chartDataColumnName:"id",inputDataColumnSystemName:e.rowIdColumnName,typeValidationOptions:jE,cleanupNulls:!1}]]}function validateAxisType(e,t,n,a){if(a!==Sn.gA.LOG)return
const i=(0,nd.ZP)(e,t)
if(a===Sn.gA.LOG){if(!(0,Wd.fx)(i.type))throw new ConvertToChartPropsException(makeInvalidColumnTypeErrorMessage(n.toUpperCase(),i.displayName,Hd.XK,cu.nB.SCATTER_PLOT,`configured with a logarithmic ${n}-axis scale`))
if(getNumberColumnValues(e,i.systemName).some((e=>0===e)))throw new ConvertToChartPropsException($E)
if(function getColumnMin(e,t){return Math.min(...getNumberColumnValues(e,t))}(e,i.systemName)*function getColumnMax(e,t){return Math.max(...getNumberColumnValues(e,t))}(e,i.systemName)<0)throw new ConvertToChartPropsException(zE)}}function cleanAndValidateScatterPlotData(e,t){const n=getScatterPlotColumnInfos(t),a=function getExtraScatterPlotVisualizationDetails(e){const t=getRegressionTypeFromConfig(e.regressionConfig)
return null!=t?`with ${Xp.ew[t].toLowerCase()} regressions`:void 0}(t),i=cleanAndValidateDataFrame(e,n,cu.nB.SCATTER_PLOT,a)
!function validateAxisTypes(e,{xAxisColumnName:t,xAxisScale:n,yAxisColumnName:a,yAxisIncludesZero:i,yAxisScale:s}){if(s===Sn.gA.LOG&&i)throw new ConvertToChartPropsException(WE)
validateAxisType(e,t,"x",n)
validateAxisType(e,a,"y",s)}(i,t)
!function validateColorPalette(e,{colorPalette:t,seriesColumnName:n}){if(n&&t===Sn.BL.GRADIENT){const t=(0,nd.ZP)(e,n)
if(!(0,Hd.xk)(t.type.leafType))throw new ConvertToChartPropsException(`Gradient color palette requires a numerical series, but ${t.displayName} is not numerical.`)}}(i,t)
!function validateRowIDColumn(e,{rowIdColumnName:t}){if(null==t)return
const n=(0,nd.ZP)(e,t),a=e.rows.map((e=>String(e[n.systemName])))
if(l.default.unique(a).length!==a.length)throw new ConvertToChartPropsException(`Unique ID Field ${n.displayName} contains duplicate values. All values must be unique.`)}(i,t)
return function updateRowIDSystemColumn(e,{rowIdColumnName:t}){if(null==t)return e
const n=(0,nd.ZP)(e,t)
return transformColumn(e,Yg.Cb.ROW_ID,(e=>String(e[n.systemName])))}(i,t)}function convertScatterPlotData(e,t){const n=convertDataFrameToLegacyChartData(cleanAndValidateScatterPlotData(e,t),getScatterPlotColumnInfos(t)),a=transformRowObjectsToDatasets(n.points,t.seriesColumnName?"series":null)
return{axisTypes:(0,ig.C)(n.axisTypes,"series"),datasets:a}}function convertScatterPlotConfig(e,t){(0,S.Gp)(null==getRegressionTypeFromConfig(t.regressionConfig)||null==t.seriesColumnName,"Expected either regressionType or seriesColumnName to be null, both are non-null");(0,S.Gp)(null==t.outlierConfig||getRegressionTypeFromConfig(t.regressionConfig)===ep.ZZ.LOGISTIC,"Expected regressionType to be logistic when outlierConfig is non-null")
const n=(0,nd.ZP)(e,t.xAxisColumnName).displayName,a=(0,nd.ZP)(e,t.yAxisColumnName).displayName,i=t.seriesColumnName?(0,nd.ZP)(e,t.seriesColumnName).displayName:""
return{colorPalette:t.colorPalette,xAxis:{includeZero:!1,label:n,scale:ed.V6[t.xAxisScale]},yAxis:{includeZero:t.yAxisIncludesZero,label:a,scale:ed.V6[t.yAxisScale],...null!=t.yAxisMin&&{min:t.yAxisMin},...null!=t.yAxisMax&&{max:t.yAxisMax}},...null!=t.legendLocation?{legend:{label:i}}:{}}}function maybeConvertScatterPlotProps(e,t){return maybeConvertProps((()=>function convertScatterPlotProps(e,t){return{valid:!0,props:{config:convertScatterPlotConfig(e,t),data:convertScatterPlotData(e,t)}}}(e,t)))}const YE={axisTypes:{[Yg.Cb.ROW_ID]:Wd.g.STRING,x:Wd.g.NUMBER,y:Wd.g.NUMBER},points:[]}
function convertScatterPlotDataToDataFrame(e,t){return{axisTypes:e.axisTypes,points:e.datasets[t].points}}function PresentationalScatterPlotViewer({aggregationType:e,errorBarType:t,outlierConfig:n,regressionAnalysis:a,...i}){const s=aggregateScatterPlotProps(i,{aggregationType:e,errorBarType:t,outlierConfig:null!=n?n:null})
if(null==a)return d.createElement(ScatterPlotWrapper,{...s})
if(a.status===gE._.LOADING)return d.createElement(LoadingOverlay,{message:"Calculating curve..."},d.createElement(ScatterPlotWrapper,{...(0,ig.C)(s,"onClickPoint")}))
if(a.status===gE._.ERROR)return d.createElement(ChartErrorMessage,{message:a.message},d.createElement(ScatterPlotWrapper,{...s}))
{const s=function addRegressionAnalysisToScatterPlotProps(e,t,n){return(0,tm.ZP)(e,(e=>{const a=t.result.detectedOutliers,i=(null==n?void 0:n.outlierSetting)===Sn.bK.EXCLUDE,s=e.data.datasets[0]
s.regressionAnalysis=t
s.points=s.points.map((e=>({...e,...null!=a&&{isMasked:e.isMasked||i&&a.has(e.benchcol_row_id),isOutlier:a.has(e.benchcol_row_id),pointWarning:a.has(e.benchcol_row_id)?e.isMasked||i&&a.has(e.benchcol_row_id)?"Excluded outlier":"Outlier":null}})))
e.data.axisTypes={...e.data.axisTypes,...null!=a&&{isOutlier:Wd.g.BOOLEAN,isMasked:Wd.g.BOOLEAN,pointWarning:Wd.g.STRING}}}))}(i,a,n),r=aggregateScatterPlotProps(s,{aggregationType:e,errorBarType:t,outlierConfig:null!=n?n:null})
return d.createElement(ScatterPlotWrapper,{...r})}}function ScatterPlotViewer({conversionOutput:{props:{data:e,config:t}},parameters:{aggregationType:n,errorBarType:a,outlierConfig:i,regressionConfig:s,rowIdColumnName:r,seriesColumnName:o}}){null!=o&&(0,S.Gp)(null==s&&null==r,"Expected both regression and point masking to be disabled when series column is set.")
const l=useMaskedBlockViewState({inputDataFrame:null==o?convertScatterPlotDataToDataFrame(e,0):YE}),{maskedDataFrame:c}=l,u=l.isMaskingEnabled?function convertDataFrameToScatterPlotData(e){const{axisTypes:t,points:n}=e
return{axisTypes:t,datasets:[{points:n}]}}(c):e,{regressionAnalysis:m}=function useRegressionBlockViewState({inputDataset:e,outlierConfig:t,regressionConfig:n}){var a
const{viewStateId:i}=uE.useContext(),s=(0,d.useMemo)((()=>filterMaskedRows(e)),[e]),r=(0,_a.v9)((e=>new pE.aR(e).getRegressionState(i))),o=(0,_a.I0)(),l=(0,d.useCallback)((e=>{o((0,mE.SB)(i,e))}),[i,o]);(0,d.useEffect)((()=>{const e=null==r?null:(0,he.Z)(r,"inputDataset","outlierConfig","regressionConfig")
!Is()(e,{inputDataset:s,outlierConfig:t,regressionConfig:n})&&(null!=n?performRegressionAnalysis(s,n,(e=>{l({inputDataset:s,outlierConfig:t,regressionConfig:n,regressionAnalysis:e})}),t):l(null))}),[s,t,n,r,l])
return{regressionAnalysis:null!==(a=null==r?void 0:r.regressionAnalysis)&&void 0!==a?a:null}}({inputDataset:c,outlierConfig:i,regressionConfig:s})
return d.createElement(PresentationalScatterPlotViewer,{config:t,aggregationType:n,errorBarType:a,outlierConfig:i,regressionAnalysis:m,data:u,onClickPoint:l.isMaskingEnabled&&null==n?l.onToggleRowMask:void 0})}var QE=n(316028)
function cellToString(e){if(null==e)return String(e)
if("boolean"==typeof e||"number"==typeof e)return e.toString()
if("string"==typeof e)return e
if("object"==typeof e)return JSON.stringify(e,null,1).replace(/\s+/g," ");(0,S.Gp)(!1,`Unexpected cell type: ${(0,Go.vE)(e)}`)
return e}function rowToStrings(e){return e.map((e=>cellToString(e)))}function runQueryOutputToTSV(e){return Uo.VB(e.rows.map((e=>rowToStrings(e))),"\t")}var KE=n(512262)
function RunQueryOutputTable({renderCellContent:e,runQueryOutput:t,renderHeader:n,calculateInView:a,experimentalShapashTableOptions:i}){const{headers:s,rows:r}=t
return d.createElement(d.Fragment,null,d.createElement(rc.iA,{calculateInView:a,className:(0,g.iv)(XE.table),emptyTableText:"No rows",fitContent:!0,frozenHeader:!0,isCompact:!0,numRows:r.length,overflowVisible:!0},d.createElement(rc.sg,{renderCell:e=>{return d.createElement(rc.bL,null,dt.ZP.INSIGHTS_ENABLE_COPY_BUTTON_PER_ROW?d.createElement(KE.Z,{clipboardData:(t=r[e],Uo.VB([rowToStrings(t)],"\t")),message:"Row has been copied to the clipboard in TSV format."},e+1):d.createElement(d.Fragment,null,e+1))
var t}}),s.map(((t,a)=>d.createElement(rc.sg,{key:a,header:d.createElement(rc.bL,{className:(0,g.iv)(XE.cell)},n(t,a)),renderCell:(t,n)=>d.createElement(rc.bL,{className:f()((0,g.iv)(XE.cell,i&&XE.pointer)),onClick:null!=i?()=>{i.onClick(r[t])}:void 0},e(r[t][a],n))})))))}RunQueryOutputTable.defaultProps={renderCellContent:cellToString,renderHeader:e=>e,calculateInView:!1}
const JE=d.memo(RunQueryOutputTable),XE=g.mM.create({cell:_n.cf,table:{borderRadius:0,marginBottom:0},pointer:{cursor:"pointer"}})
var ef
!function(e){e.UNSORTED="unsorted"
e.DESCENDING="descending"
e.ASCENDING="ascending"}(ef||(ef={}))
function SortableRunQueryOutputTableHeaderCell(e){const[t,n]=(0,d.useState)(!1),a=e.columnSortState!==ef.UNSORTED?tf.sortedIcon:t?tf.hoveredUnsortedIcon:tf.unhoveredUnsortedIcon
return d.createElement("div",{className:(0,g.iv)(tf.wrapper),onMouseOver:()=>{n(!0)},onMouseLeave:()=>{n(!1)}},d.createElement("div",{className:(0,g.iv)(tf.text)},e.header),d.createElement(pe.Z,{className:(0,g.iv)(tf.sortIcon,a),onClick:()=>{e.onSortClick()},icon:e.columnSortState===ef.DESCENDING||e.columnSortState===ef.UNSORTED?"arrow-down":"arrow-up"}))}const tf=g.mM.create({wrapper:{display:"flex",justifyContent:"space-between",alignItems:"center"},text:{marginRight:6},sortIcon:{cursor:"pointer"},sortedIcon:{color:Vt.Ej},unhoveredUnsortedIcon:{color:"transparent"},hoveredUnsortedIcon:{color:Vt.pp}})
function sortedRunQueryOutput(e,t,n,a){if(null==t)return e
let i
i=function columnIsNumeric({rows:e},t){for(const n of e)if(null!=n[t])return"number"==typeof n[t]
return!1}(e,t.index)?l.default.sortBy(e.rows,(e=>e[t.index])):(0,Jt.MZ)(e.rows,(e=>cellToString(a?e[t.index]:resolveCell(e[t.index],n))))
const s=l.default.sortBy(i,(e=>null==e[t.index]?-1:0))
t.descending&&s.reverse()
return{...e,rows:s}}function SortableRunQueryOutputTable({renderCellContent:e,runQueryOutput:t,rawOutputMode:n,sortState:a,toggleSort:i,calculateInView:s,experimentalShapashTableOptions:r}){const o=sortedRunQueryOutput(t,a,useResolvedChipItemIdMap(t).resolvedChipItemIdMap,n)
return d.createElement(JE,{renderCellContent:e,renderHeader:function renderHeader(e,t){return d.createElement(SortableRunQueryOutputTableHeaderCell,{header:e,columnSortState:(null==a?void 0:a.index)===t?a.descending?ef.DESCENDING:ef.ASCENDING:ef.UNSORTED,onSortClick:()=>{i(t)}})},runQueryOutput:o,calculateInView:s,experimentalShapashTableOptions:r})}SortableRunQueryOutputTable.defaultProps={renderCellContent:cellToString,calculateInView:!1}
const nf=d.memo(SortableRunQueryOutputTable),af=(0,xl.ZP)(null)
function useRunQueryOutputTableSortState(e){const[t,n]=af.useGlobalClientState(e),a=(0,d.useCallback)((e=>{null==t||e!==t.index?n({index:e,descending:!0}):n(t.descending?{index:e,descending:!1}:null)}),[t,n])
return{sortState:t,toggleSort:a}}var sf=n(976327),rf=n(465534),of=n(574796)
const lf=Za.TK.TABLE_CELL
const cf=qu.c.RICH
const df=d.memo((function TableViewer({dataFrame:e,experimentalShapashTableOptions:t,isLegacyInsights:n}){const a=convertDataFrameToRunQueryOutput(e,!1),{actionOrigin:i,viewStateId:s}=uE.useContext(),{sortState:r,toggleSort:o}=useRunQueryOutputTableSortState(s),l=(0,lc.Z)(s),c=(0,d.useMemo)((()=>(0,Oh.Z)(e,l.sortState,cf)),[e,l.sortState])
return n?d.createElement(nf,{renderCellContent:(e,t)=>function renderTableViewerCellContent(e){const t=cellToChipItemIds(e.cell),n=cellToBlobs(e.cell),a=void 0===e.cellRenderOptions.hasRowBeenInView||e.cellRenderOptions.hasRowBeenInView
return null!=t&&!a||null!=n&&!a?d.createElement(rf.Z,{size:lf}):null!=t?1===t.length?d.createElement(sc.Z,{id:t[0],size:lf}):d.createElement(Er.ZP,{chipSize:lf,isVertical:!1,itemIds:t,maxChips:sf.MD}):n?d.createElement(QE.Z,{blobIds:n.map((e=>e.id)),chipSize:lf}):d.createElement(of.ZP,{className:(0,g.iv)(uf.textCellWrapper),textValue:cellToString(e.cell)})}({cell:e,cellRenderOptions:t}),runQueryOutput:a,rawOutputMode:!1,sortState:r,toggleSort:o,calculateInView:!0,experimentalShapashTableOptions:t}):d.createElement(Xm.ZP,{actionOrigin:i,dataFrame:c,clientStateId:s,mode:cf,renderIsExcludedColumn:!1,selectionOptions:{allowRowSelection:!1},sortOptions:l})})),uf=g.mM.create({textCellWrapper:{display:"block",maxWidth:1500,overflowX:"hidden",overflowY:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})
var mf
!function(e){e.DYNAMIC="DYNAMIC"
e.EDITOR_HEIGHT="EDITOR_HEIGHT"
e.EXPANDED_EDITOR_HEIGHT="EXPANDED_EDITOR_HEIGHT"}(mf||(mf={}))
const pf={[cu.nB.BAR_CHART]:function BarChartViewer({dataFrame:e,parameters:t}){const n=function maybeConvertBarChartProps(e,t){return maybeConvertProps((()=>convertBarChartProps(e,t)))}(e,t)
if(!n.valid)return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:n.message})
const{dataFrame:a,...i}=function aggregateBarChartProps(e,{aggregationType:t,errorBarType:n=null}){if(null==t){(0,S.Gp)(null==n,"Expected errorBarType to be null when aggregationType is null",{aggregationType:t,errorBarType:n})
return e}const{dataFrame:a,columnsMapping:i,config:s,...r}=e,{dataFrame:o,columnsMapping:l}=aggregateChartDataFrame(a,{partitionColumn:i.x,...i.series&&{secondaryPartitionColumn:i.series},valueColumn:i.y},t,n)
return{...r,dataFrame:o,columnsMapping:{x:l.partitionColumn,y:l.aggregatedValues,...l.secondaryPartitionColumn&&{series:l.secondaryPartitionColumn},...l.errorBarValues&&{errorValue:l.errorBarValues}},config:{...s,yAxis:{...s.yAxis,label:(0,nd.ZP)(o,l.aggregatedValues).displayName}}}}(n.props,t),s=(0,nd.ZP)(a,t.xAxisColumnName),{accessor:r,validatedLeafType:o}=(0,Lm.$0)(a,s.systemName,Ng.x),l=(0,Hd.xk)(o)?numericAccessor(r,o):stringAccessor(r),c=null!=t.sortDirection?(0,Oh.o)(a,[l],t.sortDirection===Sn.SM.ASCENDING):a
return d.createElement(BarChartWrapper,{dataFrame:c,...i})},[cu.nB.HEATMAP]:function HeatmapViewer({dataFrame:e,parameters:t}){const n=maybeConvertHeatmapProps(resolveDataFrame(e,ed.vm),t)
return n.valid?function isHeatmapTooLarge(e){const t=new Set(e.map((e=>e.x))).size,n=new Set(e.map((e=>e.y))).size
return t*n>1e4}(n.props.data.points)?d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"The heatmap is too large to display. Heatmaps can display up to 10,000 bins."}):d.createElement(HeatmapChartWrapper,{...n.props}):d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:n.message})},[cu.nB.LINE_CHART]:function LineChartViewer({dataFrame:e,parameters:t}){const n=convertDataFrameToRunQueryOutput(e),{resolvedRunQueryOutput:a}=useResolvedRunQueryOutput(n),i=maybeConvertToContinuous2DChartProps(e,a,t,cu.nB.LINE_CHART)
return i.valid?d.createElement(DeprecateLineChart,{...i.props}):d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:i.message})},[cu.nB.PIE_CHART]:function PieChartViewer({parameters:e,dataFrame:t}){var n
const a=null!==(n=e.aggregationType)&&void 0!==n?n:Sn.FP.COUNT,i=function maybeConvertPieChartProps(e,t){return maybeConvertProps((()=>convertPieChartProps(e,t)))}(t,e)
if(!i.valid)return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:i.message})
const{dataFrame:s,columnsMapping:r}=i.props,{dataFrame:o,columnsMapping:l}=aggregateChartDataFrame(s,{partitionColumn:r.sliceName,valueColumn:r.measure},a),c=a===Sn.FP.COUNT?updateColumnDef(o,l.aggregatedValues,{displayName:ed.CA[a]}):o
return d.createElement(PieChartWrapper,{...i.props,columnsMapping:{sliceName:l.partitionColumn,measure:l.aggregatedValues},dataFrame:c})},[cu.nB.SCATTER_PLOT]:function ErrorHandlingScatterPlotViewer({dataFrame:e,parameters:t}){const n=maybeConvertScatterPlotProps(resolveDataFrame(e,ed.vm),t)
return n.valid?d.createElement(ScatterPlotViewer,{conversionOutput:n,parameters:t}):d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:n.message})},[cu.nB.TABLE]:df},hf={_stubbableVisualizationViewerBrowserRender:Jt.ZT}
function VisualizationViewer({dataFrame:e,delayExpensiveRenders:t=!1,isLegacyInsights:n,viewerHeight:a,visualization:i,experimentalShapashTableOptions:s}){hf._stubbableVisualizationViewerBrowserRender()
const r=getVisualizationType(i),o=function useDelayedRender(e){const[t,n]=(0,d.useState)(null!=e&&e);(0,Ul.Z)((()=>{setTimeout((()=>{n(!0)}),0)}))
return t}(!t),{ref:l,hasBeenInView:c}=(0,Ph.Z)(r===cu.nB.TABLE),u=o&&(null==c||c),m=pf[r]
return d.createElement("div",{className:f()("u-flex-full-height",(0,g.iv)(ed.ml[r]&&ff[a],!u&&Ef.centeredContent,ed.xw[r]&&Ef.contentMargin)),ref:l,...(0,ee.Z)({component:"VisualizationViewer",element:"root"})},u?d.createElement(m,{dataFrame:e,isLegacyInsights:n,parameters:i.parameters,experimentalShapashTableOptions:s}):d.createElement(kl.b,null))}VisualizationViewer.defaultProps={viewerHeight:mf.DYNAMIC}
const gf=d.memo(VisualizationViewer),Ef=g.mM.create({editorHeight:{height:ip.ZB},expandedEditorHeight:{height:ip.Si},centeredContent:{justifyContent:"center",alignItems:"center"},contentMargin:{margin:ip.mR}}),ff={[mf.DYNAMIC]:void 0,[mf.EDITOR_HEIGHT]:Ef.editorHeight,[mf.EXPANDED_EDITOR_HEIGHT]:Ef.expandedEditorHeight},Sf=["xAxisColumnName","yAxisColumnName","rowIdColumnName","measureColumnName","metricColumnName","seriesColumnName","sliceColumnName"]
var yf=n(741431)
function RawOutputButton({showRawOutput:e,onChange:t}){return d.createElement(P.ZP,{title:(e?"Hide":"Show")+" raw output"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:f()({"is-active":e}),icon:"table",onClick:function handleClick(){t(!e)},size:C.qE.MINI}))}const bf=(0,xl.ZP)(!1)
function PresentationalUniversalBlockView({actionOrigin:e,configEditorSettings:t={showConfigEditor:!1},errorMessage:n,experimentalShapashTableOptions:a,inputDataFrame:i,isLegacyInsights:s=!1,paneProps:{toolbar:r,...o},renderOptions:{delayExpensiveRenders:l=!1,isRawOutputEnabled:c=!1}={},viewStateId:u,visualizationConfig:m,maxRows:p}){var h;(0,S.Gp)(s===(e===cd.Z.INSIGHTS),"Expected isLegacyInsights to only be true when used in Insights",{actionOrigin:e,isLegacyInsights:s})
const{rawOutputButton:E,showRawOutput:f}=function useRawOutputButton(e){const[t,n]=bf.useGlobalClientState(e)
return{rawOutputButton:d.createElement(RawOutputButton,{showRawOutput:t,onChange:n}),showRawOutput:t}}(u),y=(0,lc.Z)(u),{sortState:b,toggleSort:T}=useRunQueryOutputTableSortState(u),{visualizationConfig:v,missingColumns:C}=(0,d.useMemo)((()=>{if(!s)return{visualizationConfig:m,missingColumns:[]}
const{parameters:e,missingColumns:t}=function convertDisplayNameBasedConfigs(e,t){const n=[],a={...t}
Object.keys(t).forEach((e=>{e.toLowerCase().includes("columnname")&&!Sf.includes(e)&&(0,S.Gp)(!1,`AnalyticsVisualizationParameters contains unhandled column name property ${e}`)}))
Sf.forEach((i=>{if(t.hasOwnProperty(i)){const t=a[i]
if(null==t)return
const s=(0,Dg.s)(e,t)
null==s?n.push(t):a[i]=s.systemName}}))
return{parameters:a,missingColumns:n}}(i,m.parameters)
return{visualizationConfig:{...m,parameters:e},missingColumns:t}}),[i,m,s]),I=(0,d.useMemo)((()=>null==p||i.rows.length<p?i:sampleRows(i,p)),[i,p])
i.rows.length>I.rows.length&&(o.warnings=[...null!==(h=o.warnings)&&void 0!==h?h:[],"Showing sampled dataset"])
const w=null!=n?n:C.length>0?`Missing ${(0,de._6)(C.length,"column")} in query output: ${(0,Mt.Dw)(C)}`:null
return d.createElement(uE.Provider,{value:{actionOrigin:e,viewStateId:u}},d.createElement(yf.ZP,{...o,centerContent:!1,sidebar:t.showConfigEditor?d.createElement(VisualizationConfigEditor,{columns:i.columns.filter((e=>!(0,$d.Z)(e))),onChangeVisualizationConfig:t.onChangeVisualizationConfig,visualizationConfig:m,useSystemNames:!s}):void 0,toolbar:d.createElement(d.Fragment,null,c&&d.createElement("span",{className:"u-mini-spacing-left"},E),r)},f&&c?s?d.createElement(nf,{runQueryOutput:convertDataFrameToRunQueryOutput(i,!1),rawOutputMode:!0,sortState:b,toggleSort:T}):d.createElement(Xm.ZP,{actionOrigin:e,dataFrame:i,clientStateId:u,mode:qu.c.RAW_WAREHOUSE,renderIsExcludedColumn:!1,selectionOptions:{allowRowSelection:!1},sortOptions:y}):null!=w?d.createElement("div",{className:(0,g.iv)(Tf.errorBanner)},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:w})):d.createElement(gf,{dataFrame:I,delayExpensiveRenders:l,experimentalShapashTableOptions:a,isLegacyInsights:s,visualization:v})))}const Tf=g.mM.create({errorBanner:{margin:ip.mR}})
function ToggleExpandButton({className:e,isExpanded:t,onChange:n}){return d.createElement(P.ZP,{title:t?"Collapse":"Expand"},d.createElement(C.Co,{className:e,buttonStyle:C.ZJ.TERTIARY_GRAY,icon:t?"collapse-right-full":"expand-right-full",onClick:function handleClick(){n(!t)},size:C.qE.MINI}))}function ModelingDashboardBlock({blockTitle:e,blockDescription:t,dashboardClientStateId:n,inputDataFrame:a,visualizationConfig:i,isExpanded:s,onToggleExpand:r,toolbarExtension:o}){return d.createElement(PresentationalUniversalBlockView,{actionOrigin:cd.Z.MACHINE_LEARNING,inputDataFrame:a,paneProps:{description:t,title:e,toolbar:d.createElement("div",{className:(0,g.iv)(vf.toolbar)},o,d.createElement(ToggleExpandButton,{isExpanded:s,onChange:r}))},viewStateId:`${e} - ${n}`,visualizationConfig:i})}const vf=g.mM.create({toolbar:{display:"flex",alignItems:"center",flexDirection:"row"}}),Cf={allowedLeafTypes:[Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.REQUIRED,maybeTextType:ad.FS.NOT_ALLOWED},If={allowedLeafTypes:[Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.REQUIRED,maybeTextType:ad.FS.NOT_ALLOWED},wf={allowedLeafTypes:[Hd.i0.TEXT,...Hd.XK],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},Nf={allowedLeafTypes:[Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},Af={allowedLeafTypes:[Hd.i0.DECIMAL],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},Rf={allowedLeafTypes:[Hd.i0.DECIMAL],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},Pf="All data",Of={dataPointId:"data_point_id",predictedOutput:"predicted_output",actualOutput:"actual_output",testTrain:"test_train",features:"features",datetime:"datetime",grouping:"grouping"},xf={dataPointId:wf,predictedOutput:Af,actualOutput:Rf,testTrain:{allowedLeafTypes:[Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},features:{allowedLeafTypes:[Hd.i0.JSON],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},datetime:{allowedLeafTypes:[Hd.i0.DATETIME],nullableType:ad.FS.ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},grouping:{allowedLeafTypes:[Hd.i0.TEXT,Hd.i0.INTEGER],nullableType:ad.FS.ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED}},_f={featureName:"feature_name",importance:"importance",baseFeatures:"base_features",baseEntities:"base_entities",description:"description"},Df={featureName:Nf,importance:{allowedLeafTypes:[Hd.i0.DECIMAL],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},baseFeatures:Cf,baseEntities:{allowedLeafTypes:[Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.REQUIRED,maybeTextType:ad.FS.NOT_ALLOWED},description:{allowedLeafTypes:[Hd.i0.TEXT],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED}},Lf={featureName:"feature_name",baseFeatures:"base_features",baseEntities:"base_entities",featureValues:"feature_values",shapValue:"shap_value",predictedOutput:"predicted_output",actualOutput:"actual_output",dataPointId:"data_point_id"},kf={featureName:Nf,baseFeatures:Cf,baseEntities:If,featureValues:{allowedLeafTypes:[Hd.i0.JSON],nullableType:ad.FS.ALLOWED,listType:ad.FS.ALLOWED,maybeTextType:ad.FS.ALLOWED},shapValue:{allowedLeafTypes:[Hd.i0.DECIMAL],nullableType:ad.FS.NOT_ALLOWED,listType:ad.FS.NOT_ALLOWED,maybeTextType:ad.FS.NOT_ALLOWED},predictedOutput:Af,actualOutput:Rf,dataPointId:wf},Mf="predicted_value"
var Ff=n(821089)
const Zf="Parameter data",Bf="Parameter summary statistics",qf="Output data",Vf="Output summary statistics",Uf=[Bf,Vf,Zf,qf],Gf=(0,xl.ZP)(null)
function ParameterOptimizationDatasetConfigurationDashboardView({clientStateId:e,data:{featureData:t,featureDescriptions:n,labelData:a,labelDescriptions:i},step:{id:s}}){const[r,o]=Gf.useGlobalClientState(s),l={[Bf]:n,[Vf]:i,[Zf]:t,[qf]:a},c=Object.fromEntries(Uf.map((t=>[t,d.createElement(ModelingDashboardBlock,{dashboardClientStateId:e,isExpanded:r===t,onToggleExpand:e=>{o(e?t:null)},inputDataFrame:l[t],visualizationConfig:makeVisualizationConfig(cu.nB.TABLE,{displayColumnsJson:null}),blockTitle:t,blockDescription:""})])))
return d.createElement("div",{className:(0,g.iv)($f.wrapper)},"This dashboard includes data about the parameters and outputs that were used when building the model.",null!=r?d.createElement("div",{className:"u-small-spacing-top"},c[r]):d.createElement("div",{className:(0,g.iv)($f.grid)},Object.entries(c).map((([e,t])=>d.createElement("div",{className:f()("u-small-spacing-top",(0,g.iv)($f.block)),key:e},t)))))}const zf=xa.ZP`
  query GetParameterOptimizationDatasetConfigurationOutputsQuery(
    $featureDataId: StrictString!
    $featureDescriptionsId: StrictString!
    $labelDataId: StrictString!
    $labelDescriptionsId: StrictString!
  ) @skipAudit @engComponent(name: MACHINE_LEARNING) {
    featureData: dataFrame(id: $featureDataId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    featureDescriptions: dataFrame(id: $featureDescriptionsId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    labelData: dataFrame(id: $labelDataId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    labelDescriptions: dataFrame(id: $labelDescriptionsId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${Rm.KN.fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
const $f=g.mM.create({wrapper:{margin:Yl.hW},grid:{display:"grid",gap:Yl.hW,gridTemplateColumns:"100%"},block:{maxHeight:400}}),Wf=Yl.hW
function DashboardLayout(e){const t=e.blockSpecs.find((t=>t.key===e.expandedBlockKey))
let n
n=null!=t?d.createElement("div",{className:(0,g.iv)(Hf.expandedBlock)},t.block):d.createElement("div",{className:(0,g.iv)(Hf.grid)},e.blockSpecs.map((({block:e,minHeight:t,key:n,maxHeight:a})=>d.createElement("div",{key:n,style:{minHeight:t,maxHeight:a}},e))))
return d.createElement("div",{className:(0,g.iv)(Hf.layoutWrapper)},n)}const Hf=g.mM.create({expandedBlock:{height:"100%"},grid:{display:"grid",gap:Wf,gridTemplateColumns:`\n      repeat(\n        auto-fit,\n        minmax(\n          max(\n            300px,\n            calc((100% - 2*${Wf}px)/2)\n          ),\n          1fr\n        )\n      )`},layoutWrapper:{flexGrow:1,padding:Wf}})
function addColumn_addColumn(e,t,n){(0,S.hu)(!(0,Dg.Z)(e,t.systemName),"New column already exists.",{newColumnDefinition:t,existingColumns:e.columns})
return{...e,columns:[...e.columns.filter((e=>!(0,$d.Z)(e))),t,...e.columns.filter((e=>(0,$d.Z)(e)))],rows:e.rows.map(((e,a)=>({...e,[t.systemName]:n(e,a)})))}}var jf=n(634168)
function getBaseEntitiesToBaseFeaturesMap(e,t,n){return e.rows.reduce(((e,a)=>{const i=t(a),s=n(a)
return{...e,...(0,Jt.m8)(i.map((t=>{var n
return[t,new Ig.Z([...null!==(n=e[t])&&void 0!==n?n:new Set,...s])]})))}}),{})}function makeParameterOptimizationFeature(e,t,n){const a=Object.keys(n).some((a=>e!==a&&n[a].has(t)))
return{baseEntity:e,baseFeature:t,displayName:a?`${e}.${t}`:t}}const Yf={systemName:"parameter",displayName:"Parameter",type:{leafType:Hd.i0.TEXT}},Qf="Contribution",Kf="shap_value",Jf="Parameter contribution",Xf="typed_feature_value",eS=cu.nB.SCATTER_PLOT,tS={aggregationType:null,colorPalette:Sn.BL.GRADIENT,errorBarType:null,legendLocation:Sn.S1.RIGHT,outlierConfig:null,regressionConfig:null,rowIdColumnName:null,seriesColumnName:null,xAxisScale:Sn.gA.LINEAR,yAxisIncludesZero:!1,yAxisMin:null,yAxisMax:null,yAxisScale:Sn.gA.LINEAR},nS=(0,xl.ZP)(null)
function makeVisualizationData(e,t,n,a,i,s){const r=(0,Cg.Z)(e,(e=>n(e)[0]===s.baseEntity&&a(e)[0]===s.baseFeature)),o=r.rows.map((e=>i(e))),l=function getFeatureValuesType(e){const t=new Ig.Z(e.map((e=>typeof e)))
return t.has("number")&&(0,S.Gp)(1===t.size()||2===t.size()&&t.has("object"),"Expected all feature values for feature to be the same type",{featureValues:e,featureValueJSTypesSet:t})?Hd.i0.DECIMAL:Hd.i0.TEXT}(o)
let c=addColumn_addColumn(r,{systemName:Xf,displayName:`${s.displayName} value`,type:{leafType:l}},((e,t)=>null==o[t]?null:String(o[t])))
c=updateColumnDef(c,t.shapValue,{displayName:Qf})
return coerceOrFilterNulls(c,Xf)}function FeatureContributionBlock({baseEntitiesAccessor:e,baseFeaturesAccessor:t,dataFrame:n,columnsMapping:a,featureValuesAccessor:i,...s}){const{dashboardClientStateId:r}=s,o=(0,Jt.UY)(function getFeatureList(e,t,n){const a=getBaseEntitiesToBaseFeaturesMap(e,t,n)
return Object.keys(a).flatMap((e=>[...a[e]].map((t=>makeParameterOptimizationFeature(e,t,a)))))}(n,e,t),"displayName"),[l,c]=nS.useGlobalClientState(r),u=null!=l?l:o[0],m=makeVisualizationData(n,a,e,t,i,u),p=makeVisualizationConfig(eS,{...tS,xAxisColumnName:Xf,yAxisColumnName:Kf,seriesColumnName:a.predictedOutput}),h=d.createElement($r.ZP,{className:(0,g.iv)(aS.featureDropdown),displayName:d.createElement("div",{className:(0,g.iv)(aS.featureDropdownDisplayNameWrapper)},u.displayName),menu:d.createElement(Ar.Z,{height:Nr.Bl.MEDIUM,width:Nr.zL.FULL,optionDatas:o.map((e=>({name:e.displayName,value:e}))),onSelect:e=>{c(e)},selectedValue:u})})
return d.createElement(ModelingDashboardBlock,{...s,blockTitle:Jf,blockDescription:"The parameter value is plotted against how much it contributed to the experimental output.",inputDataFrame:m,toolbarExtension:h,visualizationConfig:p})}const aS=g.mM.create({featureDropdown:{...jf.O6},featureDropdownDisplayNameWrapper:{overflowWrap:"normal",overflow:"hidden",textOverflow:"ellipsis",width:250}}),iS="Parameter importance",sS=cu.nB.BAR_CHART,rS={aggregationType:null,barChartType:Sn.JG.STANDARD,errorBarType:null,sortDirection:null,seriesColumnName:null,yAxisMin:null,yAxisMax:null,yAxisScale:Sn.gA.LINEAR},oS={systemName:"importance",displayName:"Importance",type:{leafType:Hd.i0.DECIMAL}}
function makeFeatureImportanceVisualizationDataFrame(e,t,n,a){const i=function aggregateImportanceByBaseFeatures(e,t,n,a){const i=getBaseEntitiesToBaseFeaturesMap(e,t,n)
return aggregateRows(e,(e=>makeParameterOptimizationFeature(t(e)[0],n(e)[0],i).displayName),((e,t)=>({[Yf.systemName]:t,[oS.systemName]:String((0,de.Sm)(e.map((e=>Math.abs(a(e))))))})),[Yf,oS])}(e,t,n,a)
return function aggregateLessImportantFeatures(e){const t=e.rows.slice(20),n=`Remaining ${t.length} ${(0,de._6)(t.length,"feature")}`,a=numericAccessor((0,Lm.$0)(e,oS.systemName).accessor,oS.type.leafType),i={[Yf.systemName]:n,[oS.systemName]:String((0,de.Sm)(t.map((e=>a(e))))),[Yg.Cb.IS_EXCLUDED]:!1,[Yg.Cb.ROW_ID]:n}
return{...e,rows:[...e.rows.slice(0,20),...t.length>0?[i]:[]]}}((0,Oh.Z)(i,{columnKey:"importance",sortDirection:"arrow-up"}))}function FeatureImportanceBlock({dataFrame:e,baseEntitiesAccessor:t,baseFeaturesAccessor:n,importanceAccessor:a,...i}){const s=makeVisualizationConfig(sS,{...rS,xAxisColumnName:Yf.systemName,yAxisColumnName:oS.systemName}),r=(0,d.useMemo)((()=>makeFeatureImportanceVisualizationDataFrame(e,t,n,a)),[e,t,n,a])
return d.createElement(ModelingDashboardBlock,{...i,blockTitle:iS,blockDescription:"The parameters are ranked from most to least important based on how much they factored into the model's prediction. Importance is always positive.",inputDataFrame:r,visualizationConfig:s})}function filterColumns(e,t){const n=e.columns.filter(((e,n)=>t(e,n)||(0,$d.Z)(e))),a=n.map((e=>e.systemName))
return{...e,columns:n,rows:e.rows.map((e=>(0,Jt.m8)(Object.entries(e).filter((([e])=>a.includes(e))))))}}const lS="Parameter contribution by data point",cS=cu.nB.BAR_CHART,dS={aggregationType:null,barChartType:Sn.JG.STANDARD,errorBarType:null,sortDirection:null,seriesColumnName:null,yAxisMin:null,yAxisMax:null,yAxisScale:Sn.gA.LINEAR},uS="Remaining (+) features",mS="Remaining (-) features"
function LocalExplanationBlock_makeVisualizationData(e,t,n,a,i,s,r){let o=(0,Cg.Z)(e,(e=>s(e)===t))
o=function addFeatureColumn(e,t,n){const a=getBaseEntitiesToBaseFeaturesMap(e,t,n)
return addColumn_addColumn(e,Yf,(e=>makeParameterOptimizationFeature(t(e)[0],n(e)[0],a).displayName))}(o,a,i)
o=filterColumns(o,(e=>[Yf.systemName,n.shapValue].includes(e.systemName)))
const c=stringAccessor((0,Lm.$0)(o,Yf.systemName).accessor)
o=function summarizeLessInfluentialFeatures(e,t,n,a){const i=(0,Oh.o)(e,[e=>-1*Math.abs(a(e)),n]),s=i.rows.slice(20),[r,o]=l.default.partition(s,(e=>a(e)>=0)),c=(0,de.Sm)(r.map((e=>a(e)))),d=(0,de.Sm)(o.map((e=>a(e))))
return{...i,rows:[...i.rows.slice(0,20),...r.length>0?[{[Yf.systemName]:uS,[t.shapValue]:c,[Yg.Cb.IS_EXCLUDED]:!1,[Yg.Cb.ROW_ID]:uS}]:[],...o.length>0?[{[Yf.systemName]:mS,[t.shapValue]:d,[Yg.Cb.IS_EXCLUDED]:!1,[Yg.Cb.ROW_ID]:mS}]:[]]}}(o,n,c,r)
o=(0,Oh.o)(o,[r])
return updateColumnDef(o,n.shapValue,{displayName:Qf})}function LocalExplanationBlock({baseEntitiesAccessor:e,baseFeaturesAccessor:t,dataFrame:n,columnsMapping:a,dataPointIdAccessor:i,resolveDataPointId:s,selectedDataPointId:r,shapValueAccessor:o,...l}){const c=makeVisualizationConfig(cS,{...dS,xAxisColumnName:Yf.systemName,yAxisColumnName:Kf}),u=(0,d.useMemo)((()=>LocalExplanationBlock_makeVisualizationData(n,r,a,e,t,i,o)),[n,r,a,e,t,i,o])
return d.createElement(ModelingDashboardBlock,{...l,blockTitle:lS,blockDescription:"The parameter value is plotted against how much it contributed to the experimental output.",inputDataFrame:u,visualizationConfig:c})}const pS="Model metrics",hS=cu.nB.TABLE,gS={displayColumnsJson:null}
function ModelMetricsTableBlock({dataFrame:e,...t}){const n=makeVisualizationConfig(hS,gS)
return d.createElement(ModelingDashboardBlock,{...t,blockTitle:pS,blockDescription:"R-squared is the percentage of variation that helps you determine how well the model's prediction approximates the actual data. The closer the R-squared value is to 1, the better the fit.",inputDataFrame:e,visualizationConfig:n})}const ES="Predicted vs. actual output",fS=cu.nB.SCATTER_PLOT,SS={aggregationType:null,colorPalette:Sn.BL.DISCRETE,errorBarType:null,legendLocation:Sn.S1.TOP,outlierConfig:null,regressionConfig:null,rowIdColumnName:null,seriesColumnName:null,xAxisScale:Sn.gA.LINEAR,yAxisIncludesZero:!1,yAxisMin:null,yAxisMax:null,yAxisScale:Sn.gA.LINEAR}
function PredictedVsActualBlock({dataFrame:e,columnsMapping:t,...n}){const a=makeVisualizationConfig(fS,{...SS,xAxisColumnName:t.actualOutput,yAxisColumnName:t.predictedOutput,seriesColumnName:t.testTrain}),i=(0,d.useMemo)((()=>sampleRows(e,1e3)),[e])
return d.createElement(ModelingDashboardBlock,{...n,blockTitle:ES,blockDescription:"The actual experimental output is plotted against the model's predicted output to give you confidence in the model's accuracy.",inputDataFrame:i,visualizationConfig:a})}const yS="Predicted and actual outputs by data point",bS=cu.nB.TABLE,TS={displayColumnsJson:null},vS="local_explanations_available",CS={displayName:"Local Explanations Available",systemName:vS,type:{leafType:Hd.i0.BOOLEAN}}
function PredictionsAndLabelsBlock({allDataDataFrame:e,columnsMapping:t,dataPointIdAccessor:n,shapValuesDataFrame:a,...i}){const s=makeVisualizationConfig(bS,TS),r=(0,d.useMemo)((()=>function PredictionsAndLabelsBlock_makeVisualizationData(e,t,n,a){const i=new Set(t.rows.map((e=>n(e)))),s=filterColumns(addColumn_addColumn(e,CS,(e=>i.has(n(e)))),(({systemName:e})=>e!==a.features))
return(0,Oh.o)(s,[e=>e.local_explanations_available?0:1])}(e,a,n,t)),[e,a,n,t])
return d.createElement(ModelingDashboardBlock,{...i,blockTitle:yS,blockDescription:"",inputDataFrame:r,visualizationConfig:s})}const IS="Model class comparisons",wS=cu.nB.TABLE,NS={displayColumnsJson:null}
function SearchRankingsTableBlock({dataFrame:e,...t}){const n=makeVisualizationConfig(wS,NS)
return d.createElement(ModelingDashboardBlock,{...t,blockTitle:IS,blockDescription:"This table compares the relative performance of all models trained. Only the best model as measured by Ranking score is used in your analysis.",inputDataFrame:e,visualizationConfig:n})}const AS="Parameters by data point",RS="Actual output",PS="Predicted output",OS=cu.nB.TABLE,xS={displayColumnsJson:null},_S={systemName:"parameter_name",displayName:"Parameter Name",type:{leafType:Hd.i0.TEXT}},DS={systemName:"parameter_value",displayName:"Parameter Value",type:{leafType:Hd.i0.JSON}}
function SelectedPredictionFeaturesBlock({dataFrame:e,featuresAccessor:t,predictedOutputAccessor:n,dataPointIdAccessor:a,resolveDataPointId:i,selectedDataPointId:s,actualOutputAccessor:r,...o}){const l=makeVisualizationConfig(OS,xS),c=function makeFeaturesDataFrame(e,t,n,a,i,s,r){const o=e.rows.find((e=>a(e)===s));(0,S.hu)(null!=o,"Expected selectedDataPointId to be present in the input dataFrame",{dataFrame:e,selectedDataPointId:s})
const l=t(o);(0,S.hu)("object"==typeof l,"Expected feature column to contain dicts",{features:l,dataFrame:e})
return{...e,name:AS,columns:[_S,DS,...Object.values(Yg.Xg)],rows:[{[_S.systemName]:RS,[DS.systemName]:r(o),[Yg.Cb.IS_EXCLUDED]:!1,[Yg.Cb.ROW_ID]:RS},{[_S.systemName]:PS,[DS.systemName]:n(o),[Yg.Cb.IS_EXCLUDED]:!1,[Yg.Cb.ROW_ID]:PS},...Object.entries(l).map((([e,t],n)=>({[_S.systemName]:e,[DS.systemName]:t,[Yg.Cb.IS_EXCLUDED]:!1,[Yg.Cb.ROW_ID]:String(n)})))]}}(e,t,n,a,0,s,r)
return d.createElement(ModelingDashboardBlock,{...o,blockTitle:c.name,blockDescription:"",inputDataFrame:c,visualizationConfig:l})}const LS={minHeight:400,maxHeight:400},kS=xa.ZP`
  query GetParameterOptimizationOutputsQuery(
    $allDataId: StrictString!
    $featureImportanceId: StrictString!
    $modelEvaluationId: StrictString!
    $searchRankingsId: StrictString!
    $shapValuesId: StrictString!
  ) @skipAudit @engComponent(name: MACHINE_LEARNING) {
    allData: dataFrame(id: $allDataId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    featureImportance: dataFrame(id: $featureImportanceId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    modelEvaluation: dataFrame(id: $modelEvaluationId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    searchRankings: dataFrame(id: $searchRankingsId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    shapValues: dataFrame(id: $shapValuesId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${Rm.KN.fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,MS=(0,xl.ZP)(null),FS=(0,xl.ZP)(null)
function ParameterOptimizationModelingDashboardView({data:{allData:e,featureImportance:t,modelEvaluation:n,searchRankings:a,shapValues:i},step:{id:s}}){var r
const[o,l]=FS.useGlobalClientState(s),{accessors:c,validatedLeafTypes:u}=(0,Lm.yL)(t,_f,Df),{accessors:m,validatedLeafTypes:p}=(0,Lm.yL)(i,Lf,kf),{accessors:h}=(0,Lm.yL)(e,Of,xf),E=stringListAccessor(c.baseEntities),f=stringListAccessor(c.baseFeatures),S=stringListAccessor(m.baseEntities),y=stringListAccessor(m.baseFeatures),b=stringAccessor(h.dataPointId)
function resolveDataPointId(t){return String((0,Yd.Z)(t,e.hydratedProperties,{apiIdentifiedObjects:Yd.p.NAME,blobs:Yd.p.NONE}))}const T=(0,Jt.MZ)(e.rows.map((e=>b(e))),resolveDataPointId),[v,C]=MS.useGlobalClientState(s),I=null!=v?v:T[0],w={[ES]:{...LS,key:ES,block:d.createElement(PredictedVsActualBlock,{dashboardClientStateId:s,dataFrame:e,columnsMapping:Of,isExpanded:o===ES,onToggleExpand:e=>{l(e?ES:null)}})},[pS]:{...LS,key:pS,block:d.createElement(ModelMetricsTableBlock,{dashboardClientStateId:s,dataFrame:n,isExpanded:o===pS,onToggleExpand:e=>{l(e?pS:null)}})},[IS]:{...LS,key:IS,block:d.createElement(SearchRankingsTableBlock,{dashboardClientStateId:s,dataFrame:a,isExpanded:o===IS,onToggleExpand:e=>{l(e?IS:null)}})},[iS]:{...LS,key:iS,block:d.createElement(FeatureImportanceBlock,{dashboardClientStateId:s,dataFrame:t,baseEntitiesAccessor:E,baseFeaturesAccessor:f,importanceAccessor:numericAccessor(c.importance,u.importance),isExpanded:o===iS,onToggleExpand:e=>{l(e?iS:null)}})},[Jf]:{...LS,key:Jf,block:d.createElement(FeatureContributionBlock,{dashboardClientStateId:s,dataFrame:i,columnsMapping:Lf,isExpanded:o===Jf,baseEntitiesAccessor:S,baseFeaturesAccessor:y,featureValuesAccessor:m.featureValues,onToggleExpand:e=>{l(e?Jf:null)}})},[yS]:{...LS,key:yS,block:d.createElement(PredictionsAndLabelsBlock,{dashboardClientStateId:s,allDataDataFrame:e,columnsMapping:Of,dataPointIdAccessor:b,isExpanded:o===yS,onToggleExpand:e=>{l(e?yS:null)},shapValuesDataFrame:i})},[lS]:{...LS,key:lS,block:d.createElement(LocalExplanationBlock,{dashboardClientStateId:s,dataFrame:i,columnsMapping:Lf,isExpanded:o===lS,baseEntitiesAccessor:S,baseFeaturesAccessor:y,dataPointIdAccessor:b,resolveDataPointId,shapValueAccessor:numericAccessor(m.shapValue,p.shapValue),selectedDataPointId:I,onToggleExpand:e=>{l(e?lS:null)}})},[AS]:{...LS,key:AS,block:d.createElement(SelectedPredictionFeaturesBlock,{dashboardClientStateId:s,dataFrame:e,featuresAccessor:h.features,predictedOutputAccessor:h.predictedOutput,dataPointIdAccessor:stringAccessor(h.dataPointId),resolveDataPointId,selectedDataPointId:I,actualOutputAccessor:h.actualOutput,isExpanded:o===AS,onToggleExpand:e=>{l(e?AS:null)}})}},N=d.createElement(d.Fragment,null,d.createElement(so.R6,{className:(0,g.iv)(ZS.header,ZS.firstHeader)},"Model summary"),d.createElement(DashboardLayout,{blockSpecs:[w["Predicted vs. actual output"],w["Model metrics"],w["Model class comparisons"]]})),A=d.createElement(d.Fragment,null,d.createElement(so.R6,{className:(0,g.iv)(ZS.header)},"Parameter analysis"),d.createElement(DashboardLayout,{blockSpecs:[w["Parameter importance"],w["Parameter contribution"]]})),R=d.createElement(d.Fragment,null,d.createElement(so.R6,{className:(0,g.iv)(ZS.header)},"Data point drilldown"),d.createElement(DashboardLayout,{blockSpecs:[w[yS]]}),d.createElement("div",{className:(0,g.iv)(ZS.dropdownSelector)},d.createElement("div",{className:"u-small-spacing-right"},d.createElement(Fr.Z,{label:"Data point:"})),d.createElement("div",{className:"u-flex-grow"},d.createElement($r.ZP,{displayName:null!==(r=resolveDataPointId(I))&&void 0!==r?r:"Select data point",menu:d.createElement(Ar.Z,{height:Nr.Bl.MEDIUM,width:Nr.zL.FULL,optionDatas:T.map((e=>({name:resolveDataPointId(e),value:e}))),onSelect:e=>{C(e)},selectedValue:I})}))),d.createElement(DashboardLayout,{blockSpecs:[w[lS],w["Parameters by data point"]]}))
return d.createElement("div",{className:(0,g.iv)(ZS.stepWrapper)},null==o?d.createElement(d.Fragment,null,N,A,R):d.createElement(DashboardLayout,{blockSpecs:[w[o]],expandedBlockKey:o}))}const ZS=g.mM.create({header:{marginLeft:Yl.hW},firstHeader:{marginTop:Yl.hW},dropdownSelector:{marginLeft:Yl.hW,display:"flex",alignItems:"center",flexDirection:"row",marginRight:32,width:300},stepWrapper:{height:"100%",display:"flex",flexDirection:"column"}})
const BS=g.mM.create({wrapper:{...Yl.xT,background:Vt.Cj,marginLeft:"10%",marginRight:"10%",padding:20,overflowY:"auto"}})
var qS=n(911525)
function ExternalFileChip({file:e}){return d.createElement(Za.ZP,{className:"chip-container",icon:st.EXTERNAL_FILE,onClick:async function handleClick(){const t=await(0,qS.V)(e.externalFileId,e.downloadUrl,e.id)
null!=t&&window.open(t,"_blank","noopener noreferrer")},size:Za.TK.SMALL,text:e.filename})}var VS=n(583310)
function ExternalFileIFrame({file:e,externalFileWarning:t,dangerouslyAllowScriptsInIFrame:n=!1,dangerouslyOverrideHTMLFileContentTypeHeader:a=!1}){return d.createElement(VS.Z,{addHtmlContentTypeHeader:a,externalFileId:e.externalFileId,url:e.downloadUrl,renderWithSignedURL:a=>{if(void 0===a)return d.createElement(kl.b,null)
if(null==a){(0,S.Gp)(!1,"Got inaccessible file within an analysis",{externalFileId:e.externalFileId})
return d.createElement(Ff.Z,null,"Error loading file.")}return d.createElement("div",{className:(0,g.iv)(US.wrapper)},d.createElement("div",{className:(0,g.iv)(US.warning)},d.createElement(mp.Z,null),d.createElement("span",null,t)),d.createElement("iframe",{sandbox:n?"allow-scripts":"",src:a,className:(0,g.iv)(US.iframe),title:e.filename}))},owningEntityApiId:e.id})}const US=g.mM.create({wrapper:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},warning:{..._n.cf,background:Vt.bs,borderBottom:`1px solid ${Vt.tN}`,padding:10,display:"flex",alignItems:"center",gap:8},iframe:{flexGrow:1,border:"none"}})
function ExternalFileImage(e){return d.createElement(VS.Z,{externalFileId:e.file.externalFileId,url:e.file.downloadUrl,renderWithSignedURL:e=>void 0===e?d.createElement(kl.b,null):null==e?d.createElement(Ff.Z,null,"Error loading image."):d.createElement("div",{className:(0,g.iv)(GS.wrapper)},d.createElement("img",{className:(0,g.iv)(GS.image),src:e})),owningEntityApiId:e.file.id})}const GS=g.mM.create({wrapper:{margin:8,textAlign:"center",height:"fill-available"},image:{maxWidth:"100%",maxHeight:"100%"}})
function ExternalFilePaneContent({file:e}){switch(e.mimeType){case"text/html":return d.createElement(ExternalFileIFrame,{file:e,externalFileWarning:"This block contains a file that is external to Benchling.",dangerouslyAllowScriptsInIFrame:!0,dangerouslyOverrideHTMLFileContentTypeHeader:!0})
case"image/jpeg":case"image/png":return d.createElement(ExternalFileImage,{file:e})
default:return d.createElement("div",{className:(0,g.iv)(zS.fileChip)},d.createElement(ExternalFileChip,{file:e}))}}const zS=g.mM.create({fileChip:{margin:"10px 12px"}})
function FeatureContourPlotsBlock({contourPlotFiles:e}){const[t,n]=(0,d.useState)(0),a=e.filter((e=>null!=e.externalFileId));(0,S.Gp)(e.length===a.length,"One or more contour plot files has not been finalized")
const i=a[t],s=i.filename.slice(0,-1*".html".length).split("!*!");(0,S.Gp)(2===s.length,"Expected feature contour plot filenames to be of the format {feature_name_1}!*!{feature_name_2}.",{filename:i.filename})
return d.createElement("div",{className:(0,g.iv)($S.block)},d.createElement(yf.ZP,{description:"This chart shows the relationship between a pair of parameters and the output. The points represent the top 10 recommendations from our model. Use the left and right arrows to browse relationships between other pairs of parameters.",title:`${s[0]} vs. ${s[1]}`,toolbar:d.createElement(d.Fragment,null,0===t?d.createElement(pe.Z,{icon:"chevron-left",className:"faded"}):d.createElement(pe.Z,{icon:"chevron-left",className:"u-pointer",onClick:()=>{n(t-1)}}),d.createElement("span",{className:(0,g.iv)($S.pager)},t+1," of ",a.length),t===a.length-1?d.createElement(pe.Z,{icon:"chevron-right",className:"faded"}):d.createElement(pe.Z,{icon:"chevron-right",className:"u-pointer",onClick:()=>{n(t+1)}}))},d.createElement(ExternalFilePaneContent,{file:i})))}const $S=g.mM.create({block:{height:610,width:550},pager:{..._n.gt,...jf.g3,...jf.O6}})
function PredictionOutput({output:e}){return d.createElement("div",{className:(0,g.iv)(WS.container)},d.createElement(so.R6,null,"Predicted output"),d.createElement("p",null,"Based on the parameter values you entered, we predict the experimental output to be:"),e.status===Wr.Lr.NOT_FETCHED&&d.createElement(io.ZP,{bannerType:io.ct.INFO,hideIcon:!0,text:"--"}),e.status===Wr.Lr.LOADING&&d.createElement(kl.Z,null),e.status===Wr.Lr.ERROR&&d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:e.message}),e.status===Wr.Lr.SUCCESS&&d.createElement(io.ZP,{bannerType:io.ct.INFO,hideIcon:!0,text:`${e.data.value}`}))}const WS=g.mM.create({container:{backgroundColor:Vt.Cj,borderRadius:4,border:`1px solid ${Vt.tN}`,padding:Yl.hW,margin:Yl.hW}}),HS={displayName:"Output",systemName:"output",type:{leafType:Hd.i0.DECIMAL}},jS={displayName:"Output type",systemName:"output_type",type:{leafType:Hd.i0.TEXT}},YS={displayName:"Rank",systemName:"rank",type:{leafType:Hd.i0.INTEGER}},QS={aggregationType:null,colorPalette:Sn.BL.DISCRETE,errorBarType:null,legendLocation:Sn.S1.TOP,outlierConfig:null,regressionConfig:null,rowIdColumnName:null,seriesColumnName:jS.systemName,xAxisColumnName:YS.systemName,xAxisScale:Sn.gA.LINEAR,yAxisColumnName:HS.systemName,yAxisIncludesZero:!0,yAxisMin:null,yAxisMax:null,yAxisScale:Sn.gA.LINEAR}
const KS=d.memo((function PredictionsScatterPlot({allData:e,predictionOutput:t}){const n=makeVisualizationConfig(cu.nB.SCATTER_PLOT,QS).parameters,a=function transformAllDataDataFrame(e){const{accessors:t}=(0,Lm.yL)(e,(0,he.Z)(Of,"predictedOutput","actualOutput"),(0,he.Z)(xf,"predictedOutput","actualOutput")),n=sampleRows(e,500),a=(0,Oh.Z)(n,{columnKey:Of.actualOutput,sortDirection:"arrow-up"}).rows.flatMap(((e,n)=>{const a=(0,ig.C)(e,Of.actualOutput,Of.predictedOutput),i=n+1
return[{...a,[Yg.Cb.ROW_ID]:`${t.rowId(e)}_actual`,output:t.actualOutput(e),output_type:"actual",rank:i},{...a,[Yg.Cb.ROW_ID]:`${t.rowId(e)}_predicted`,output:t.predictedOutput(e),output_type:"predicted",rank:i}]}))
return{...e,columns:[YS,HS,jS,...e.columns.filter((e=>"actual_output"===e.systemName||"predicted_output"===e.systemName||(0,$d.Z)(e)))],rows:a}}(e),i=maybeConvertScatterPlotProps(resolveDataFrame(a,ed.vm),n);(0,S.hu)(i.valid,"Unexpected malformed dataframe")
const{data:s,config:r}=i.props,o=null!=t?function addPredictionPointToScatterPlotData(e,t){(0,S.hu)((0,ng.XN)(e.datasets),"Expected labeled datasets")
const n=e.datasets.find((e=>"predicted"===e.label));(0,S.hu)(null!=n,"Prediction data frame was incorrectly converted to legacy data frame")
const a=t.upperBound-t.lowerBound,i={...n,points:[...n.points,{x:0,y:t.value,errorValue:a}]}
return{axisTypes:{...e.axisTypes,errorValue:Wd.g.NUMBER},datasets:[e.datasets[0],i]}}(s,t):s,l={...r,errorBarConfig:{errorValueLabel:"Prediction error"}}
return d.createElement(yf.ZP,{className:(0,g.iv)(JS.pane),title:"Ranked outputs",description:"This chart shows all actual and predicted outputs from your experimental data. If you have submitted a prediction, it will appear as the leftmost point.",centerContent:!1},d.createElement("div",{className:f()("u-flex-full-height",(0,g.iv)(JS.chartContainer))},d.createElement(ScatterPlotWrapper,{data:o,config:l})))})),JS=g.mM.create({pane:{padding:Yl.hW},chartContainer:{padding:5}}),XS=400,ey=["Lower Bound","Upper Bound","Interval Width","Uncertainty"]
function PredictionDashboard({allData:e,parametersForOutput:t,output:n}){let a=null
if(n.status===Wr.Lr.SUCCESS){const e=[n.data.lowerBound,n.data.upperBound,n.data.intervalWidth,n.data.uncertainty]
a=d.createElement(DashboardLayout,{blockSpecs:[{key:"prediction stats",block:d.createElement(yf.ZP,{fitContent:!0,paneBorder:yf.K9.SOLID,title:"Prediction statistics"},d.createElement(rc.iA,{className:(0,g.iv)(ty.table),isCompact:!0,numRows:ey.length,showBorder:!1},d.createElement(rc.sg,{header:"Statistic",renderCell:e=>ey[e]}),d.createElement(rc.sg,{header:"Value",renderCell:t=>(0,rg.Z)(e[t])}))),minHeight:0,maxHeight:XS},{key:"nearest point",block:d.createElement(yf.ZP,{fitContent:!0,paneBorder:yf.K9.SOLID,title:"Parameter value comparison"},d.createElement(rc.iA,{className:(0,g.iv)(ty.table),isCompact:!0,numRows:t.length,showBorder:!1},d.createElement(rc.sg,{header:"Parameter name",renderCell:e=>t[e].displayName}),d.createElement(rc.sg,{header:"Entered value",renderCell:e=>t[e].valueInput.isDropdown?t[e].valueInput.value:(0,rg.Z)(t[e].valueInput.value)}),d.createElement(rc.sg,{header:"Nearest match",renderCell:e=>t[e].valueInput.isDropdown?n.data.point[t[e].systemName]:(0,rg.Z)(n.data.point[t[e].systemName])}))),minHeight:0,maxHeight:XS}]})}const i=d.createElement(DashboardLayout,{blockSpecs:[{key:"Predictions scatter plot",block:d.createElement(KS,{allData:e,predictionOutput:n.status===Wr.Lr.SUCCESS?n.data:null}),minHeight:XS,maxHeight:XS}]})
return d.createElement(d.Fragment,null,d.createElement(PredictionOutput,{output:n}),i,a)}const ty=g.mM.create({table:{borderRadius:0,marginBottom:0}})
var ny=n(421185)
function parameterValueToSliderValue(e){const t=(e.max-e.min)/100
return Math.round((e.value-e.min)/t)}function PredictionParameters({parameters:e,onChangeValue:t}){return d.createElement(d.Fragment,null,e.map(((e,n)=>d.createElement("div",{key:e.systemName,"data-test-component":"PredictionParameters","data-test-element":"input",className:f()(n>0&&"u-input-spacing-top")},d.createElement("div",{className:(0,g.iv)(ay.parameterName)},e.displayName,e.valueInput.isDropdown?"":`: ${(0,rg.Z)(e.valueInput.value)}`),e.valueInput.isDropdown?d.createElement($r.ZP,{displayName:e.valueInput.value,menu:d.createElement(Ar.Z,{height:Nr.Bl.LARGE,width:Nr.zL.FULL,selectedValue:e.valueInput.value,onSelect:n=>{t(e.systemName,n)},optionDatas:e.valueInput.options.map((e=>({name:(0,ny.Z)(e),value:(0,ny.Z)(e)})))})}):d.createElement(LabeledSlider,{min:0,minLabel:(0,rg.Z)(e.valueInput.min),max:100,maxLabel:(0,rg.Z)(e.valueInput.max),onChange:n=>{const a=e.valueInput
t(e.systemName,(a.max-a.min)/100*n+a.min)},step:1,value:parameterValueToSliderValue(e.valueInput)})))))}const ay=g.mM.create({parameterName:_n.sE}),iy=(0,xl.ZP)({}),sy=(0,xl.ZP)([]),ry=(0,xl.ZP)(Wr.Tp)
function ParameterOptimizationPredictionStepView(e){const[t,n]=iy.useGlobalClientState(e.clientStateId),[a,i]=sy.useGlobalClientState(e.clientStateId),[s,r]=ry.useGlobalClientState(e.clientStateId),o=e.parameters.map((e=>(0,tm.ZP)(e,(e=>{const n=t[e.systemName]
null!=n&&(e.valueInput.value=n)})))),l=(0,d.useMemo)((()=>{const t=e.predictionDefaults.columns.map((e=>e.systemName)).concat(Mf),n=getOutputFilesFromStep(e.step,"contour_plots_partial_dependence")
return d.createElement(d.Fragment,null,n.length>0&&d.createElement(d.Fragment,null,d.createElement(FeatureContourPlotsBlock,{contourPlotFiles:n}),d.createElement("div",{className:"u-input-spacing-top"})),d.createElement(PresentationalUniversalBlockView,{actionOrigin:cd.Z.MACHINE_LEARNING,inputDataFrame:(0,Oh.Z)(filterColumns(e.predictionsGrid,(e=>t.includes(e.systemName))),{columnKey:Mf,sortDirection:"arrow-up"}),paneProps:{title:"Recommendations",description:"This table ranks the top parameter values according to predicted output."},viewStateId:`predictions-grid-${e.clientStateId}`,visualizationConfig:makeVisualizationConfig(cu.nB.TABLE,{displayColumnsJson:null})}))}),[e.clientStateId,e.predictionDefaults,e.predictionsGrid,e.step])
return d.createElement("div",{className:(0,g.iv)(ly.wrapper)},d.createElement("div",{className:(0,g.iv)(ly.columnsContainer)},d.createElement("div",{className:(0,g.iv)(ly.inputColumn)},d.createElement("div",{className:(0,g.iv)(ly.title)},"Parameter values"),d.createElement("div",null,"Adjust the parameter values below to see how the predicted output changes. Parameter and output values will be rounded to the nearest match in the model's precalculated predictions."),d.createElement("div",{className:"u-spacing-top"},d.createElement(PredictionParameters,{parameters:o,onChangeValue:function handleUpdateParameter(e,a){n({...t,[e]:a})}})),d.createElement("div",{className:f()((0,g.iv)(ly.resetValues),"u-spacing-top"),onClick:()=>{n({})}},"Reset values"),d.createElement(C.Co,{className:"u-spacing-top",disabled:s.status===Wr.Lr.LOADING,size:C.qE.MEDIUM,buttonStyle:C.ZJ.SECONDARY,onClick:function runPrediction(){(0,Wr.cC)({makeCall:MachineLearningActions_runParameterOptimizationPrediction,args:[{features:(0,Jt.m8)(o.map((e=>[e.systemName,e.valueInput.value]))),stepId:e.step.id}],asyncState:s,setAsyncState:e=>{i(o)
r(e)}})},text:"Run prediction"})),d.createElement("div",{className:(0,g.iv)(ly.outputColumn)},d.createElement(PredictionDashboard,{allData:e.allData,output:s,parametersForOutput:a}))),d.createElement("div",{className:"u-input-spacing-top"},l))}const oy=xa.ZP`
  query GetPredictionStepViewDataFramesQuery(
    $allDataDataFrameId: StrictString!
    $predictionDefaultsDataFrameId: StrictString!
    $predictionsGridDataFrameId: StrictString!
  ) @skipAudit @engComponent(name: MACHINE_LEARNING) {
    allDataDataFrame: dataFrame(id: $allDataDataFrameId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    predictionDefaultsDataFrame: dataFrame(id: $predictionDefaultsDataFrameId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    predictionsGridDataFrame: dataFrame(id: $predictionsGridDataFrameId) {
      ... on DataFrameNode {
        ...DataFrameGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${Rm.KN.fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
const ly=g.mM.create({title:{..._n.sE,..._n.VM},columnsContainer:{display:"flex"},inputColumn:{flex:"1 1 0"},outputColumn:{marginLeft:16,flex:"2 1 0"},resetValues:{..._n.sE,color:Vt.t0,cursor:"pointer"},scatterPlot:{height:400},wrapper:{backgroundColor:Vt.bs,padding:16}})
const cy={[cu.nB.BAR_CHART]:[],[cu.nB.HEATMAP]:[],[cu.nB.LINE_CHART]:["outlierConfig","regressionConfig","rowIdColumnName"],[cu.nB.SCATTER_PLOT]:["outlierConfig","regressionConfig","rowIdColumnName"],[cu.nB.PIE_CHART]:[],[cu.nB.TABLE]:["displayColumnsJson"]}
function getPersistedVisualizationConfig_getPersistedVisualizationConfig(e){const{__typename:t,...n}=e.parameters,a=ed.kI[t],i=(0,tm.ZP)(n,(e=>{for(const t of cy[a])e.hasOwnProperty(t)&&delete e[t]}))
return{type:a,parameters:i}}var dy=n(498497),uy=n(824272),my=n(133475),py=n(911623)
function getDefaultVisualizationNameForVisualizationType(e){return`${ed.Qp[ed.kI[e]]}`}const hy={[Sn.zs.INITIALIZE_DATASET]:[{stepType:Sn.zs.INITIALIZE_DATASET,version:0,inputDataShapes:{},outputDataShapes:{Dataset:{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:null},{stepType:Sn.zs.INITIALIZE_DATASET,version:1,inputDataShapes:{},outputDataShapes:{Dataset:{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{dashboardId:{kind:"string",required:!0},blockId:{kind:"string",required:!0},dataFrameName:{kind:"string",required:!0},parameterizedSQLQuery:{kind:"string",required:!0},parameters:{kind:"array",required:!0,elementSpec:{kind:"shape",required:!0,fields:{config:{kind:"shape",required:!0,fields:{isMulti:{kind:"boolean",required:!1},systemName:{kind:"string",required:!0},type:{kind:"enum",required:!0,choices:["BIOENTITY_LINK","DATE","ENTRY_LINK","FOLDER_LINK","NUMBER","PROCESS_LINK","PROCESS_TASK_LINK","PROJECT_LINK","SELECTOR","STORABLE_LINK","STRING","TEAM_LINK","USER_LINK"]},id:{kind:"string",required:!0}}},valueJson:{kind:"anything",required:!0}}}}}},{stepType:Sn.zs.INITIALIZE_DATASET,version:2,inputDataShapes:{},outputDataShapes:{Dataset:{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{dashboardId:{kind:"string",required:!0},blockId:{kind:"string",required:!0},dataFrameName:{kind:"string",required:!0},parameterizedSQLQuery:{kind:"string",required:!0},parameters:{kind:"array",required:!0,elementSpec:{kind:"shape",required:!0,fields:{config:{kind:"shape",required:!0,fields:{isMulti:{kind:"boolean",required:!1},systemName:{kind:"string",required:!0},type:{kind:"enum",required:!0,choices:["BIOENTITY_LINK","DATE","ENTRY_LINK","FOLDER_LINK","NUMBER","PROCESS_LINK","PROCESS_TASK_LINK","PROJECT_LINK","SELECTOR","STORABLE_LINK","STRING","TEAM_LINK","USER_LINK"]},id:{kind:"string",required:!0}}},valueJson:{kind:"anything",required:!0}}}},dashboardName:{kind:"string",required:!0},blockName:{kind:"string",required:!0}}}],[Sn.zs.NOTEBOOK_TABLE_DATASET]:[{stepType:Sn.zs.NOTEBOOK_TABLE_DATASET,version:0,inputDataShapes:{},outputDataShapes:{Dataset:{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{entryId:{kind:"string",required:!0},entryName:{kind:"string",required:!0},tableId:{kind:"string",required:!0},tableName:{kind:"string",required:!0}}}],[Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION]:[{stepType:Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION,version:0,inputDataShapes:{},outputDataShapes:{"Model training input":{kind:Sn.AT.DATASET,isMulti:!0,isRequired:!0},"Feature data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Feature descriptions":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Label data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Label description":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{datasetConfiguration:{kind:"anything",required:!0},dataDefinitionConfig:{kind:"anything",required:!0}}}],[Sn.zs.PARAMETER_OPTIMIZATION_MODELING]:[{stepType:Sn.zs.PARAMETER_OPTIMIZATION_MODELING,version:0,inputDataShapes:{},outputDataShapes:{"Model training input":{kind:Sn.AT.DATASET,isMulti:!0,isRequired:!0},"All data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Feature importance":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"SHAP values":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Model evaluation":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Search rankings":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},"Feature data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},"Feature descriptions":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},"Label data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},"Label description":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},exclusion_reasons:{kind:Sn.AT.FILE,isMulti:!1,isRequired:!1}},config:{datasetConfiguration:{kind:"anything",required:!0},dataDefinitionConfig:{kind:"anything",required:!0}}},{stepType:Sn.zs.PARAMETER_OPTIMIZATION_MODELING,version:1,inputDataShapes:{"Feature data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Label data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"All data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Feature importance":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"SHAP values":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Model evaluation":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Search rankings":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},exclusion_reasons:{kind:Sn.AT.FILE,isMulti:!1,isRequired:!1}},config:null}],[Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION]:[{stepType:Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION,version:0,inputDataShapes:{"Model training input":{kind:Sn.AT.DATASET,isMulti:!0,isRequired:!0},"All data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Feature importance":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Predictions default values":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},"Predictions grid":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1}},config:null},{stepType:Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION,version:1,inputDataShapes:{"Model training input":{kind:Sn.AT.DATASET,isMulti:!0,isRequired:!0},"All data":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Feature importance":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Predictions default values":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},"Predictions grid":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!1},contour_plots_partial_dependence:{kind:Sn.AT.FILE,isMulti:!0,isRequired:!0}},config:null}],[Sn.zs.CONNECTION_DATA_DATASET]:[{stepType:Sn.zs.CONNECTION_DATA_DATASET,version:0,inputDataShapes:{},outputDataShapes:{Dataset:{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{dataFrameName:{kind:"string",required:!0},connectionId:{kind:"string",required:!0},connectionFileId:{kind:"string",required:!0}}}],[Sn.zs.COMPUTED_COLUMN]:[{stepType:Sn.zs.COMPUTED_COLUMN,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{formula:{kind:"shape",required:!0,fields:{formulaText:{kind:"string",required:!0},formulaAst:{kind:"taggedUnion",required:!0,tagKey:"type",choices:[{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"COLUMN_REFERENCE"},value:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"STRING_LITERAL"},value:{kind:"string",required:!0}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"NUMBER_LITERAL"},value:{kind:"number",required:!0}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"BOOLEAN_LITERAL"},value:{kind:"boolean",required:!0}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"OPERATION"},operation:{kind:"enum",required:!0,choices:["ABSOLUTE_VALUE","ADD","AND","AVERAGE","CEILING","COUNT","COUNT_BLANKS","DIVIDE","EQUALS","EXTRACT","FACTORIAL","FLOOR","GEOMETRIC_MEAN","GREATER_THAN","GREATER_THAN_OR_EQUALS","IF","IS_BLANK","LEFT","LENGTH","LESS_THAN","LESS_THAN_OR_EQUALS","LOG_10","LOG_2","MAX","MEDIAN","MIN","MODE","MODULUS","MULTIPLY","NATURAL_LOG","NOT_EQUALS","OR","POWER","PRODUCT","RIGHT","ROUND","SPLIT","STANDARD_DEVIATION","STANDARD_ERROR","SUBSTITUTE","SUBSTRING","SUBTRACT","SUM","TEXT_JOIN","VARIANCE"]},arguments:{kind:"array",required:!0,elementSpec:{kind:"anything",required:!0}}}}]}}},newColumnName:{kind:"string",required:!0}}}],[Sn.zs.FILTER_DATASET]:[{stepType:Sn.zs.FILTER_DATASET,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{filter:{kind:"taggedUnion",required:!0,tagKey:"operation",choices:[{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"AND"},filters:{kind:"array",required:!0,elementSpec:{kind:"anything",required:!0}}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"CONTAINS"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"ENDS_WITH"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"EQUALS"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"GREATER_THAN"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"GREATER_THAN_OR_EQUALS"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"INCLUDES"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"IS_IN"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"IS_NULL"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"LESS_THAN"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"LESS_THAN_OR_EQUALS"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"OR"},filters:{kind:"array",required:!0,elementSpec:{kind:"anything",required:!0}}}},{kind:"shape",required:!0,fields:{operation:{kind:"string",required:!0,value:"STARTS_WITH"},columnSystemName:{kind:"string",required:!0},not_:{kind:"boolean",required:!1},value:{kind:"anything",required:!0}}}]}}}],[Sn.zs.REGISTRY_SCHEMA_DATASET]:[{stepType:Sn.zs.REGISTRY_SCHEMA_DATASET,version:0,inputDataShapes:{},outputDataShapes:{Dataset:{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{dataFrameName:{kind:"string",required:!0},query:{kind:"string",required:!0},queryDescription:{kind:"string",required:!0}}}],[Sn.zs.SAVE_TO_RESULTS]:[{stepType:Sn.zs.SAVE_TO_RESULTS,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Saved results":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Rows with errors":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:null},{stepType:Sn.zs.SAVE_TO_RESULTS,version:1,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Saved results":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0},"Rows with errors":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{schemaId:{kind:"string",required:!0},columnMapping:{kind:"array",required:!0,elementSpec:{kind:"shape",required:!0,fields:{inputColumnSystemName:{kind:"string",required:!0},outputFieldId:{kind:"string",required:!0}}}}}}],[Sn.zs.THIRD_PARTY]:[{stepType:Sn.zs.THIRD_PARTY,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!0,isRequired:!1}},outputDataShapes:{"Output datasets":{kind:Sn.AT.DATASET,isMulti:!0,isRequired:!1},"Output files":{kind:Sn.AT.FILE,isMulti:!0,isRequired:!1}},config:null}],[Sn.zs.SORT_COLUMNS]:[{stepType:Sn.zs.SORT_COLUMNS,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{sortOptions:{kind:"array",required:!0,elementSpec:{kind:"shape",required:!0,fields:{column:{kind:"columnReference",required:!0,validationOptions:null},direction:{kind:"enum",required:!0,choices:["ASCENDING","DESCENDING"]}}},minItems:1}}}],[Sn.zs.AGGREGATE_DATASET]:[{stepType:Sn.zs.AGGREGATE_DATASET,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{groupColumns:{kind:"array",required:!0,elementSpec:{kind:"columnReference",required:!0,validationOptions:null}},aggregations:{kind:"array",required:!0,elementSpec:{kind:"taggedUnion",required:!0,tagKey:"aggregationFunction",choices:[{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"AVERAGE"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"COUNT"},newColumnName:{kind:"string",required:!0}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"COUNT_NULLS"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"GEOMETRIC_MEAN"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MAX"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MEDIAN"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MIN"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MODE"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"PRODUCT"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"STANDARD_DEVIATION"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"STANDARD_ERROR"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"SUM"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"VARIANCE"},newColumnName:{kind:"string",required:!0},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}}]},minItems:1}}}],[Sn.zs.BIN_DATA]:[{stepType:Sn.zs.BIN_DATA,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{column:{kind:"columnReference",required:!0,validationOptions:null},numBins:{kind:"integer",required:!1,minValue:1,maxValue:1e3}}}],[Sn.zs.PIVOT_DATASET]:[{stepType:Sn.zs.PIVOT_DATASET,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{pivotColumns:{kind:"array",required:!0,elementSpec:{kind:"columnReference",required:!0,validationOptions:null},minItems:1},valueColumns:{kind:"array",required:!0,elementSpec:{kind:"taggedUnion",required:!0,tagKey:"aggregationFunction",choices:[{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"AVERAGE"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"COUNT"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"COUNT_NULLS"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"GEOMETRIC_MEAN"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MAX"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MEDIAN"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MIN"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"MODE"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:null}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"PRODUCT"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"STANDARD_DEVIATION"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"STANDARD_ERROR"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"SUM"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}},{kind:"shape",required:!0,fields:{aggregationFunction:{kind:"string",required:!0,value:"VARIANCE"},newColumnName:{kind:"string",required:!1},column:{kind:"columnReference",required:!0,validationOptions:{allowedLeafTypes:[Hd.i0.INTEGER,Hd.i0.DECIMAL]}}}}]},minItems:1},groupColumns:{kind:"array",required:!0,elementSpec:{kind:"columnReference",required:!0,validationOptions:null}}}}],[Sn.zs.DATASET_VIEW]:[{stepType:Sn.zs.DATASET_VIEW,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{"Output dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},config:{}}],[Sn.zs.VISUALIZATION]:[{stepType:Sn.zs.VISUALIZATION,version:0,inputDataShapes:{"Input dataset":{kind:Sn.AT.DATASET,isMulti:!1,isRequired:!0}},outputDataShapes:{},config:{visualizationConfig:{kind:"taggedUnion",required:!0,tagKey:"type",choices:[{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"TABLE"},parameters:{kind:"shape",required:!0,fields:{}}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"BAR_CHART"},parameters:{kind:"shape",required:!0,fields:{aggregationType:{kind:"enum",required:!1,choices:["COUNT","MEAN","SUM"]},barChartType:{kind:"enum",required:!0,choices:["STANDARD","STACKED"]},errorBarType:{kind:"enum",required:!1,choices:["STANDARD_DEVIATION","STANDARD_ERROR"]},seriesColumnName:{kind:"columnReference",required:!1,validationOptions:null},sortDirection:{kind:"enum",required:!1,choices:["ASCENDING","DESCENDING"]},xAxisColumnName:{kind:"columnReference",required:!0,validationOptions:null},yAxisColumnName:{kind:"columnReference",required:!0,validationOptions:null},yAxisMin:{kind:"number",required:!1},yAxisMax:{kind:"number",required:!1},yAxisScale:{kind:"enum",required:!0,choices:["LINEAR","LOG"]}}}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"LINE_CHART"},parameters:{kind:"shape",required:!0,fields:{seriesColumnName:{kind:"columnReference",required:!1,validationOptions:null},xAxisColumnName:{kind:"columnReference",required:!0,validationOptions:null},xAxisScale:{kind:"enum",required:!0,choices:["LINEAR","LOG"]},yAxisColumnName:{kind:"columnReference",required:!0,validationOptions:null},yAxisIncludesZero:{kind:"boolean",required:!0},yAxisScale:{kind:"enum",required:!0,choices:["LINEAR","LOG"]}}}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"SCATTER_PLOT"},parameters:{kind:"shape",required:!0,fields:{aggregationType:{kind:"enum",required:!1,choices:["COUNT","MEAN","SUM"]},colorPalette:{kind:"enum",required:!0,choices:["DISCRETE","GRADIENT"]},errorBarType:{kind:"enum",required:!1,choices:["STANDARD_DEVIATION","STANDARD_ERROR"]},legendLocation:{kind:"enum",required:!1,choices:["LEFT","RIGHT","TOP"]},seriesColumnName:{kind:"columnReference",required:!1,validationOptions:null},xAxisColumnName:{kind:"columnReference",required:!0,validationOptions:null},xAxisScale:{kind:"enum",required:!0,choices:["LINEAR","LOG"]},yAxisColumnName:{kind:"columnReference",required:!0,validationOptions:null},yAxisIncludesZero:{kind:"boolean",required:!0},yAxisMin:{kind:"number",required:!1},yAxisMax:{kind:"number",required:!1},yAxisScale:{kind:"enum",required:!0,choices:["LINEAR","LOG"]}}}}},{kind:"shape",required:!0,fields:{type:{kind:"string",required:!0,value:"PIE_CHART"},parameters:{kind:"shape",required:!0,fields:{aggregationType:{kind:"enum",required:!1,choices:["COUNT","MEAN","SUM"]},legendLocation:{kind:"enum",required:!1,choices:["LEFT","RIGHT","TOP"]},measureColumnName:{kind:"columnReference",required:!0,validationOptions:null},showPercentageInLabel:{kind:"boolean",required:!0},showSliceNameInLabel:{kind:"boolean",required:!0},showValueInLabel:{kind:"boolean",required:!0},sliceColumnName:{kind:"columnReference",required:!0,validationOptions:null}}}}}]},visualizationName:{kind:"string",required:!0}}}]}
var gy=n(224993)
function DeleteIcon({icon:e,disabled:t,onClick:n,dataTestAttrs:a}){return d.createElement(gy.Z,{icon:e,onClick:n,disabled:t,dataTestAttrs:a,iconStyle:gy.L.NEGATIVE,className:f()((0,g.iv)(Ey.deleteIcon),!t&&"trash-can"===e&&(0,g.iv)(Ey.trashCanHover),!t&&"cross-thick"===e&&(0,g.iv)(Ey.crossThickHover))})}const Ey=g.mM.create({deleteIcon:{width:16,height:16},trashCanHover:{":hover":{color:Vt.Zl}},crossThickHover:{":hover":{color:Vt.pp}}})
function ArrayEditor({config:e,configShape:t,onChangeConfig:n,uiSchema:a}){var i
const s=e.length<=(null!==(i=t.minItems)&&void 0!==i?i:0)
return d.createElement(d.Fragment,null,e.map(((i,r)=>{var o,l
return d.createElement(StepConfigEditorRouter,{key:r,config:i,configShape:t.elementSpec,uiSchema:a,onChangeConfig:t=>{n((0,cm.WJ)(e,r,t))},trashIcon:d.createElement(Zo.Z,{isDisabled:!s,text:`Must have at least ${null!==(o=t.minItems)&&void 0!==o?o:0} ${(0,de._6)(null!==(l=t.minItems)&&void 0!==l?l:0,"item","items")}`},d.createElement(DeleteIcon,{icon:"trash-can",disabled:s,onClick:()=>{n((0,cm.bX)(e,r))}}))})})))}const fy=(0,Hh.x)((()=>{(0,S.hu)(!1,"StepConfigEditorContext not initialized")}),"StepConfigEditorContext")
function useStepConfigEditorContext(){return fy.useContext()}function ColumnReferenceEditor({config:e,onChangeConfig:t,configShape:n}){var a
const{dataFrameSpec:i}=useStepConfigEditorContext()
return d.createElement(ColumnDropdownSelector,{dataFrameSpec:i,onChange:t,selectedColumnSystemName:e,validationOptions:null!==(a=n.validationOptions)&&void 0!==a?a:void 0,buttonSize:C.qE.MEDIUM,noColumnSelectedText:"Select column"})}function EnumEditor({config:e,configShape:t,onChangeConfig:n,uiSchema:a}){var i
function getEnumOptionDisplayName(e){var t,n
return null!==(n=null===(t=null==a?void 0:a.displayNames)||void 0===t?void 0:t[e])&&void 0!==n?n:String(e)}const s=null!==(i=null==a?void 0:a.placeholder)&&void 0!==i?i:"Select an option"
return d.createElement($r.ZP,{displayName:null!=e?getEnumOptionDisplayName(e):s,menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.MEDIUM},t.choices.map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:e=>{n(null!=e?e:null)}},getEnumOptionDisplayName(e))))),className:(0,g.iv)(Sy.grow),buttonSize:C.qE.MEDIUM})}const Sy=g.mM.create({grow:{flexGrow:1}}),yy=Symbol("FieldOrderUISchemaKey"),by=Symbol("OnChangeConfigMiddlewareKey"),Ty=Symbol("CustomComponent")
function getFieldSettingsIfPresent(e,t){const n=null==e?void 0:e[t]
if(function isFieldUISchemaWithStandardComponent(e){return null!=e&&e.hasOwnProperty("fieldSettings")}(n))return n.fieldSettings}function isFieldUISchemaWithCustomComponent(e){return null!=e&&e.hasOwnProperty(Ty)}var vy=n(761974)
function jsonSpecToInitialValue(e,t){var n,a,i
if("string"===e.kind)return e.value?e.value:null
if("number"===e.kind)return null
if("integer"===e.kind)return null
if("boolean"===e.kind)return null
if("columnReference"===e.kind)return null
if("anything"===e.kind)(0,S.hu)(!1,"anything type not supported")
else{if("array"===e.kind)return(0,Jt.w6)(1,null!==(n=e.minItems)&&void 0!==n?n:0).map((()=>jsonSpecToInitialValue(e.elementSpec,t)))
if("enum"===e.kind)return null!==(a=null==t?void 0:t.hasOwnProperty("defaultValue"))&&void 0!==a&&a&&null!==(i=null==t?void 0:t.defaultValue)&&void 0!==i?i:null
if("taggedUnion"===e.kind)return null
if("shape"===e.kind)return(0,Jt.m8)(Object.entries(e.fields).map((([e,n])=>[e,jsonSpecToInitialValue(n,getFieldSettingsIfPresent(t,e))])));(0,S.hu)(!1,`Unexpected jsonSpec ${(0,Go.vE)(e)}`)}}function AddArrayElementIcon({specShape:e,config:t,onChangeConfig:n,elementUiSchema:a}){const i=void 0!==e.maxItems&&(null!=t?t:[]).length===e.maxItems
return d.createElement(Zo.Z,{isDisabled:!i,text:`Can only have up to ${e.maxItems} ${(0,de._6)(e.maxItems,"item","items")}`},d.createElement(vy.Z,{disabled:i,onClick:()=>{const i=jsonSpecToInitialValue(e.elementSpec,a)
n(null==t?[i]:[...t,i])}}))}function getSortedSubfields(e,t){const n=Object.entries(e),a=null==t?void 0:t[yy]
if(null==a)return n
const i=[...Object.keys(e)]
return(0,hs.Z)(n,[([e])=>{const t=a.indexOf(e)
return t<0?a.length+i.indexOf(e):t}])}function StepConfigFieldsTemplate({fields:e,numColumns:t}){return d.createElement(d.Fragment,null,[...(0,Jt.yo)(e,t)].map(((e,n)=>d.createElement(h.Z,{key:n,className:(0,g.iv)(Cy.marginBottom)},e.map((({variableName:e,addIcon:n,editor:a},i)=>d.createElement(p.Z,{key:e,sm:12/t,className:(0,g.iv)(2===t&&i%2==0&&Cy.smallPaddingRight,2===t&&i%2==1&&Cy.smallPaddingLeft)},d.createElement("div",{className:(0,g.iv)(Cy.variableHeader)},d.createElement("span",{className:(0,g.iv)(Cy.variableText)},e),n),a)))))))}const Cy=g.mM.create({variableHeader:{display:"flex",alignItems:"center",marginBottom:4},variableText:{..._n.gt,fontWeight:_n.KB},marginBottom:{marginBottom:8},smallPaddingRight:{paddingRight:8},smallPaddingLeft:{paddingLeft:8}})
function ShapeEditor({config:e,configShape:t,onChangeConfig:n,uiSchema:a,isTopLevel:i=!1}){const{dataFrameSpec:s}=useStepConfigEditorContext()
function handleChangeConfig(t){(null==a?void 0:a[by])?n(a[by](t,e,s)):n(t)}const r=getSortedSubfields(t.fields,a).map((([t,n])=>{var i,r
const o="array"===n.kind?d.createElement(AddArrayElementIcon,{specShape:n,config:e[t],onChangeConfig:n=>{handleChangeConfig({...e,[t]:n})},elementUiSchema:getFieldSettingsIfPresent(a,t)}):void 0,l=null==a?void 0:a[t]
return{variableName:null!==(r=null===(i=null==a?void 0:a[t])||void 0===i?void 0:i.displayName)&&void 0!==r?r:t,addIcon:o,editor:isFieldUISchemaWithCustomComponent(l)?l[Ty]({config:e[t],onChangeConfig:n=>{l[by]?handleChangeConfig({...e,[t]:l[by](n,e[t],s)}):handleChangeConfig({...e,[t]:n})}}):d.createElement(StepConfigEditorRouter,{config:e[t],configShape:n,onChangeConfig:n=>{handleChangeConfig({...e,[t]:n})},uiSchema:getFieldSettingsIfPresent(a,t)})}}))
return d.createElement(StepConfigFieldsTemplate,{numColumns:i?1:2,fields:r})}function isTaggedUnionChoice(e){return"string"===e.kind&&null!=e.value}function TagChoiceDropdown({selectedTag:e,onChangeChoice:t,uiSchema:n,configShape:a}){var i
const s=a.tagKey
function getTagOptionDisplayName(e){var t,a
return null!==(a=null===(t=null==n?void 0:n.tagKeyDisplayNames)||void 0===t?void 0:t[e])&&void 0!==a?a:e}return d.createElement($r.ZP,{displayName:null!=e?getTagOptionDisplayName(e):null!==(i=null==n?void 0:n.placeholder)&&void 0!==i?i:"Select a value",className:(0,g.iv)(Iy.grow),buttonSize:C.qE.MEDIUM,menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.MEDIUM},a.choices.map(((n,a)=>{const i=n.fields[s];(0,S.hu)(null!=i&&isTaggedUnionChoice(i),"Invalid tagged union choice found")
return d.createElement(N.Z,{key:a,value:i.value,isSelected:i.value===e,onSelect:()=>{t(n)}},getTagOptionDisplayName(i.value))})))})}function TaggedUnionEditor({config:e,configShape:t,onChangeConfig:n,uiSchema:a}){var i,s,r,o,l
const{dataFrameSpec:c}=useStepConfigEditorContext()
function handleChangeConfig(t){(null==a?void 0:a[by])?n(a[by](t,e,c)):n(t)}const u=t.tagKey,m=null!==(i=null==e?void 0:e[u])&&void 0!==i?i:null;(0,S.hu)(null==m||"string"==typeof m,"Invalid tag key found")
const p=null!=m&&null!==(s=t.choices.find((e=>{const t=e.fields[u];(0,S.hu)(isTaggedUnionChoice(t),`Tag key ${u} not found in choice ${e}`)
return t.value===m})))&&void 0!==s?s:null,h={variableName:null!==(l=null===(o=null===(r=null==a?void 0:a.choiceSettings)||void 0===r?void 0:r[u])||void 0===o?void 0:o.displayName)&&void 0!==l?l:u,editor:d.createElement(TagChoiceDropdown,{configShape:t,onChangeChoice:e=>{handleChangeConfig(jsonSpecToInitialValue(e,getFieldSettingsIfPresent(null==a?void 0:a.choiceSettings,u)))},selectedTag:m,uiSchema:a})}
return d.createElement(StepConfigFieldsTemplate,{numColumns:2,fields:null==p?[h]:[h,...getSortedSubfields(p.fields,a).filter((([e])=>e!==u)).map((([t,n])=>{var i,s,r,o,l
return{variableName:null!==(r=null===(s=null===(i=null==a?void 0:a.choiceSettings)||void 0===i?void 0:i[t])||void 0===s?void 0:s.displayName)&&void 0!==r?r:t,addIcon:"array"===n.kind?d.createElement(AddArrayElementIcon,{specShape:n,config:null!==(o=null==e?void 0:e[t])&&void 0!==o?o:[],onChangeConfig:n=>{handleChangeConfig({...e,[t]:n})},elementUiSchema:getFieldSettingsIfPresent(null==a?void 0:a.choiceSettings,t)}):void 0,editor:d.createElement(StepConfigEditorRouter,{config:null!==(l=null==e?void 0:e[t])&&void 0!==l?l:null,configShape:n,onChangeConfig:n=>{handleChangeConfig({...e,[t]:n})},uiSchema:getFieldSettingsIfPresent(null==a?void 0:a.choiceSettings,t)})}}))]})}const Iy=g.mM.create({grow:{flexGrow:1}})
function getMinMaxErrorMessage(e,t){if(null==e)return null
if("string"==typeof e&&!Number.isInteger(parseFloat(e)))return"Value must be a valid integer"
const n=Number(e),a=t.minValue,i=t.maxValue
return null!=a&&null!=i&&(n<a||n>i)?`Value must be between ${a} and ${i}`:null!=i&&n>i?`Value must be less than ${i}`:null!=a&&n<a?`Value must be greater than ${a}`:null}const wy=[{name:"Yes",value:!0},{name:"No",value:!1}]
function StepConfigEditorRouter({config:e,configShape:t,onChangeConfig:n,uiSchema:a,trashIcon:i,isTopLevel:s}){var r
switch(t.kind){case"string":return d.createElement("div",{className:(0,g.iv)(Ny.oneRowWrapper)},d.createElement(or.Z,{className:(0,g.iv)(Ny.grow,Ny.primitiveEditor),value:null!==(r=e)&&void 0!==r?r:"",placeholder:"Text",onChange:e=>{n(e.target.value)}}),i&&d.createElement("div",{className:(0,g.iv)(Ny.oneRowTrashIconWrapper)},i))
case"boolean":return d.createElement("div",{className:(0,g.iv)(Ny.oneRowWrapper)},d.createElement("div",{className:(0,g.iv)(Ny.grow)},d.createElement(rp.ZP,{selectedValue:e,onChange:n,allowNull:!t.required,buttonSize:C.qE.MEDIUM,searchable:!1,optionDatas:wy})),i&&d.createElement("div",{className:(0,g.iv)(Ny.oneRowTrashIconWrapper)},i))
case"number":return d.createElement("div",{className:(0,g.iv)(Ny.oneRowWrapper)},d.createElement(gp.A,{onChange:e=>{n(e.target.numericValue)},value:e,placeholder:"Number",className:(0,g.iv)(Ny.primitiveEditor)}),i&&d.createElement("div",{className:(0,g.iv)(Ny.oneRowTrashIconWrapper)},i))
case"integer":return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(Ny.oneRowWrapper)},d.createElement(gp.A,{onChange:e=>{var t
n(null!==(t=e.target.numericValue)&&void 0!==t?t:e.target.value||null)},value:e,placeholder:"Integer",className:(0,g.iv)(Ny.primitiveEditor),validateInteger:!0,min:t.minValue,max:t.maxValue}),i&&d.createElement("div",{className:(0,g.iv)(Ny.oneRowTrashIconWrapper)},i)),getMinMaxErrorMessage(e,t)&&d.createElement(Dt.Z,{message:getMinMaxErrorMessage(e,t)}))
case"enum":return d.createElement("div",{className:(0,g.iv)(Ny.oneRowWrapper,Ny.grow)},d.createElement(EnumEditor,{config:e,configShape:t,onChangeConfig:n,uiSchema:a}),i&&d.createElement("div",{className:(0,g.iv)(Ny.oneRowTrashIconWrapper)},i))
case"columnReference":return d.createElement("div",{className:(0,g.iv)(Ny.oneRowWrapper,Ny.grow)},d.createElement("div",{className:(0,g.iv)(Ny.grow)},d.createElement(ColumnReferenceEditor,{config:e,configShape:t,onChangeConfig:n})),i&&d.createElement("div",{className:(0,g.iv)(Ny.oneRowTrashIconWrapper)},i))
case"array":return d.createElement(ArrayEditor,{config:e,configShape:t,onChangeConfig:n,uiSchema:a})
case"shape":{const r=d.createElement(ShapeEditor,{configShape:t,config:e,onChangeConfig:n,uiSchema:a,isTopLevel:s})
return s?r:d.createElement("div",{className:(0,g.iv)(Ny.subeditorWrapper)},r,i&&d.createElement("div",{className:(0,g.iv)(Ny.topRightTrashIcon)},i))}case"taggedUnion":return d.createElement("div",{className:(0,g.iv)(Ny.subeditorWrapper)},d.createElement(TaggedUnionEditor,{configShape:t,config:e,onChangeConfig:n,uiSchema:a}),i&&d.createElement("div",{className:(0,g.iv)(Ny.topRightTrashIcon)},i))
default:return d.createElement("div",null,"Unsupported")}}const Ny=g.mM.create({oneRowWrapper:{display:"flex",alignItems:"center",marginBottom:8},grow:{flexGrow:1},oneRowTrashIconWrapper:{marginLeft:6,display:"flex",flexDirection:"column",alignItems:"center"},primitiveEditor:{..._n.gt,height:36,borderRadius:4},subeditorWrapper:{background:Vt.bs,position:"relative",borderRadius:2,padding:12,marginBottom:10},topRightTrashIcon:{position:"absolute",top:10,right:10}}),Ay="$c$",Ry=/"\$c\$(?<columnSystemName>.+?)"/g
class AnalysisFormulaParsingError extends kg.Z{}hy[Sn.zs.COMPUTED_COLUMN][0].config.formula.fields.formulaAst
const Py="STRING_LITERAL",Oy="NUMBER_LITERAL",xy="OPERATION"
var _y=n(28366),Dy=n(792924),Ly=n(991346),ky=n(6025),My=n(262082),Fy=n(999273)
const Zy={category:Fy.Z.MATH,params:[{name:"value",type:My.Z.number,description:"Either a column or number."}]},By={category:Fy.Z.STATS,params:[{name:"value",type:My.Z.number,description:"Either a column or number."}],repeatableLastParamType:My.Z.number,repeatableLastParamDescription:"Additional columns or numbers."},qy=[{...Zy,name:"ABS",description:"Absolute value of each number in a column or of a single number.",shortDescription:"Absolute value"},{name:"AND",category:Fy.Z.LOGIC,description:"Returns true if all the values in a single column OR across each row of multiple columns are logically true, and false otherwise. Single values are treated as columns containing just that value.",shortDescription:"Logical AND operator",params:[{name:"value",type:My.Z.any,description:"Either a column or value."}],repeatableLastParameterType:My.Z.any,repeatableLastParameterDescription:"Additional columns or values."},{...By,name:"AVERAGE",description:"Averages all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Average value"},{...Zy,name:"CEILING",description:"Rounds up each number in a column or a single number to the closest integer.",shortDescription:"Rounds up"},{name:"CONCATENATE",category:Fy.Z.TEXT,description:"Appends strings across each row of the given columns. Single strings are treated as columns containing only that string.",shortDescription:"Appends strings to one another",params:[{name:"value",type:My.Z.text,description:"Either a column or string."}],repeatableLastParamType:My.Z.text,repeatableLastParamDescription:"Additional columns or strings."},{name:"COUNT",category:Fy.Z.STATS,description:"Counts all non-null values in a single column OR across each row of multiple columns.",shortDescription:"Count",params:[{name:"column",type:My.Z.any,description:"A column."}],repeatableLastParamType:My.Z.any,repeatableLastParamDescription:"Additional columns."},{name:"COUNTBLANKS",category:Fy.Z.STATS,description:"Counts all blank or null values in a single column OR across each row of multiple columns.",shortDescription:"Counts blank or null values",params:[{name:"column",type:My.Z.any,description:"A column."}],repeatableLastParamType:My.Z.any,repeatableLastParamDescription:"Additional columns."},{name:"EXTRACT",category:Fy.Z.LOOKUP,description:"Extracts element from each list in a column.",shortDescription:"Extracts element from list",params:[{name:"value",type:My.Z.any,description:"A column of lists to extract from."},{name:"index",type:My.Z.number,description:"Either a column or number, index of the element to extract."}]},{...Zy,name:"FACT",description:"Takes factorial of each number in a column or a single number.",shortDescription:"Factorial"},{...Zy,name:"FLOOR",description:"Rounds down each number in a column or a single number to the closest integer.",shortDescription:"Rounds down"},{...By,name:"GEOMEAN",description:"Geometric mean of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Geometric mean"},{name:"IF",category:Fy.Z.LOGIC,description:"Returns one value if a logical expression is true, and another if it is false.",shortDescription:"Returns value depending on logical expression",params:[{name:"logical_test",type:My.Z.any,description:"A column or expression that represents some logical value, i.e. true or false."},{name:"value_if_true",type:My.Z.any,description:"The value to return if logical_test is true."},{name:"value_if_false",type:My.Z.any,description:"The value to return if logical_test is false."}]},{name:"ISBLANK",category:Fy.Z.LOGIC,description:"Checks whether each value of a column or a single value is empty or null.",shortDescription:"Checks whether a value is empty or null",params:[{name:"value",type:My.Z.any,description:"Either a column or value."}]},{name:"LEFT",category:Fy.Z.TEXT,description:"Substring from the beginning of each string in a column or a single string.",shortDescription:"Substring from the beginning of a string",params:[{name:"value",type:My.Z.text,description:"Either a column or string to substring."},{name:"number_of_characters",type:My.Z.number,description:"Either a column or number, number of characters to use in the substring."}]},{name:"LEN",category:Fy.Z.TEXT,description:"Returns the length of each string in a column or a single string.",shortDescription:"Length of a string",params:[{name:"value",type:My.Z.text,description:"Either a column or string."}]},{...Zy,name:"LN",description:"Natural log of each number in a column or of a single number.",shortDescription:"Logarithm, base e (Euler's number)"},{...Zy,name:"LOG",description:"Base 10 log of each number in a column or of a single number.",shortDescription:"Logarithm, base 10"},{...By,name:"MAX",description:"Maximum of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Maximum value"},{...By,name:"MED",description:"Median of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Median"},{name:"MID",category:Fy.Z.TEXT,description:"Substring of each string in a column or a single string, taken from starting_at for number_of_characters characters.",shortDescription:"Substring of a string",params:[{name:"value",type:My.Z.text,description:"Either a column or string to substring."},{name:"starting_at",type:My.Z.number,description:"Either a column or number, the index from the left of the string from which to begin the substring. The first character in the string has index 1."},{name:"number_of_characters",type:My.Z.number,description:"Either a column or number, number of characters to use in the substring."}]},{...By,name:"MIN",description:"Minimum of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Minimum value"},{name:"MOD",category:Fy.Z.MATH,description:"Modulo (remainder) operation on each number in a column or a single number, when divided by either a column or number.",shortDescription:"Modulo (remainder) operation",params:[{name:"dividend",type:My.Z.number,description:"Either a column or number to be divided to find the remainder."},{name:"divisor",type:My.Z.number,description:"Either a column or number to divide by."}]},{...By,name:"MODE",description:"Mode of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Mode"},{name:"OR",category:Fy.Z.LOGIC,description:"Returns true if any of the values in a single column OR any of the values across each row for multiple columns are logically true, and false otherwise. Single values are treated as columns containing just that value.",shortDescription:"Logical OR operator",params:[{name:"value",type:My.Z.any,description:"Either a column or value."}],repeatableLastParameterType:My.Z.any,repeatableLastParameterDescription:"Additional columns or values."},{name:"POWER",category:Fy.Z.MATH,description:"Raises each number in a column or a single number to the power of a column or number.",shortDescription:"Raises to a power",params:[{name:"base",type:My.Z.number,description:"Either a column or number to raise to the exponent power."},{name:"exponent",type:My.Z.number,description:"Either a column or number to be used as the exponent."}]},{...By,category:Fy.Z.MATH,name:"PRODUCT",description:"Multiplies all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Multiplies all values"},{name:"RIGHT",category:Fy.Z.TEXT,description:"Substring from the end of each string in a column or a single string.",shortDescription:"Substring from the end of a string",params:[{name:"value",type:My.Z.text,description:"Either a column or string to substring."},{name:"number_of_characters",type:My.Z.number,description:"Either a column or number, number of characters to use in the substring."}]},{name:"ROUND",category:Fy.Z.MATH,description:"Rounds each number in a column or a single number to the specified number of decimal places.",shortDescription:"Rounds to number of decimal places",params:[{name:"value",type:My.Z.number,description:"Either a column or number to round to num_places number of places."},{name:"num_places",type:My.Z.number,description:"Either a column or number, the number of places to round to."}]},{...By,name:"SE",description:"Standard error of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Standard error"},{...Zy,name:"SQRT",description:"Returns the positive square root of each number in a column or a single number.",shortDescription:"Square root"},{...By,name:"STDEV",description:"Sample standard deviation of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Sample standard deviation"},{name:"SUBSTITUTE",category:Fy.Z.TEXT,description:"Replaces existing text from each value in a column or a single string with new text.",shortDescription:"Replaces existing text with new text",params:[{name:"text_to_search",type:My.Z.text,description:"Either a column or string, the text within which to search and replace."},{name:"old_text",type:My.Z.text,description:"Either a column or string, the string to search for within text_to_search. All occurrences will be replaced with new_text."},{name:"new_text",type:My.Z.text,description:"Either a column or string, the string that will replaced old_text."}]},{...By,category:Fy.Z.MATH,name:"SUM",description:"Adds all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Adds all values"},{name:"TEXTJOIN",category:Fy.Z.TEXT,description:"Combines strings across each row of the given columns, separated by a delimiter. Single strings are treated as columns containing only that string.",shortDescription:"Combines strings with a delimiter",params:[{name:"delimiter",type:My.Z.text,description:"Either a column or string to be used as the delimiter. If empty, text will simply be concatenated."},{name:"value",type:My.Z.text,description:"Either a column or string."}],repeatableLastParamType:My.Z.text,repeatableLastParamDescription:"Additional columns or strings."},{name:"SPLIT",category:Fy.Z.TEXT,description:"Splits each value in a column or a single string into a list. Strings are split on each occurrence of the delimiter.",shortDescription:"Splits strings by a delimiter",params:[{name:"value",type:My.Z.text,description:"Either a column or string."},{name:"delimiter",type:My.Z.text,description:"Either a column or string to be used as the delimiter to split on."}]},{...By,name:"VAR",description:"Sample variance of all numbers in a single column OR across each row of multiple columns. Single numbers are treated as columns containing only that number.",shortDescription:"Sample variance"}],Vy={[_y.BinaryOperatorType.ADDITION]:"ADD",[_y.BinaryOperatorType.SUBTRACTION]:"SUBTRACT",[_y.BinaryOperatorType.MULTIPLICATION]:"MULTIPLY",[_y.BinaryOperatorType.DIVISION]:"DIVIDE",[_y.BinaryOperatorType.EXPONENTIAL]:"POWER",[_y.BinaryOperatorType.EQUALS]:"EQUALS",[_y.BinaryOperatorType.NOT_EQUALS]:"NOT_EQUALS",[_y.BinaryOperatorType.GREATER_THAN]:"GREATER_THAN",[_y.BinaryOperatorType.GREATER_THAN_OR_EQUAL]:"GREATER_THAN_OR_EQUALS",[_y.BinaryOperatorType.LESS_THAN]:"LESS_THAN",[_y.BinaryOperatorType.LESS_THAN_OR_EQUAL]:"LESS_THAN_OR_EQUALS"},Uy={ABS:"ABSOLUTE_VALUE",FACT:"FACTORIAL",LN:"NATURAL_LOG",LOG:"LOG_10",MOD:"MODULUS",STDEV:"STANDARD_DEVIATION",VAR:"VARIANCE",MED:"MEDIAN",GEOMEAN:"GEOMETRIC_MEAN",SE:"STANDARD_ERROR",COUNTBLANKS:"COUNT_BLANKS",ISBLANK:"IS_BLANK",MID:"SUBSTRING",LEN:"LENGTH",TEXTJOIN:"TEXT_JOIN"}
function functionNodeToJson(e){!function validateFunction(e){const t=qy.find((t=>t.name===e.type))
if(null==t)throw new AnalysisFormulaParsingError(`Unexpected operator: ${e.type}.`)
const n=t.params.length,a=null!=t.repeatableLastParamDescription?1/0:n,i=e.childNodes().length
if(i<n||i>a)throw new AnalysisFormulaParsingError(`Wrong number of arguments to ${t.name}.`)}(e)
const t=e.childNodes().map((e=>astToRequestJson(e)))
return"SQRT"===e.type?{type:xy,operation:"POWER",arguments:t.concat([{type:Oy,value:.5}])}:"CONCATENATE"===e.type?{type:xy,operation:"TEXT_JOIN",arguments:[{type:Py,value:""}].concat(t)}:null!=Uy[e.type]?{type:xy,operation:Uy[e.type],arguments:t}:{type:xy,operation:e.type,arguments:t}}function astToRequestJson(e){if(e instanceof _y.BinaryOperator)return{type:xy,operation:Vy[e.type],arguments:e.childNodes().map((e=>astToRequestJson(e)))}
if(e instanceof _y.UnaryOperator)return function unaryOperatorToJson(e){switch(e.type){case _y.UnaryOperatorType.NEGATION:return{type:xy,operation:"MULTIPLY",arguments:[{type:Oy,value:-1},astToRequestJson(e.child)]}
case _y.UnaryOperatorType.PLUS:return astToRequestJson(e.child)
default:throw new AnalysisFormulaParsingError(`Unexpected operator: ${e.type}`)}}(e)
if(e instanceof _y.FunctionOperator)return functionNodeToJson(e)
if(e instanceof _y.Value)return function valueNodeToJson(e){switch(e.typedValue.type){case"NUMBER":return{type:Oy,value:e.typedValue.rawValue}
case"BOOLEAN":return{type:"BOOLEAN_LITERAL",value:e.typedValue.booleanValue}
case"STRING":return e.typedValue.rawValue.startsWith(Ay)?{type:"COLUMN_REFERENCE",value:e.typedValue.rawValue.slice(Ay.length)}:{type:Py,value:e.typedValue.rawValue}
default:throw new AnalysisFormulaParsingError("Invalid formula.")}}(e)
throw new AnalysisFormulaParsingError("Invalid formula.")}function formulaTextToFormulaAstJson(e){const t=function parseAnalysisFormula(e){try{const t=Ly.ZP.tokenize(e)
if(t.some((e=>e.isCellRef())))throw new AnalysisFormulaParsingError("Cannot reference cells in analysis formulas.")
const n=Dy.Z._reduce(t)
if(!n.node.isSingular())throw new AnalysisFormulaParsingError("Invalid formula.")
return n.node}catch(e){if(e instanceof ky.FormulaTokenizeError||e instanceof ky.FormulaParseError)throw new AnalysisFormulaParsingError(e.message)
throw e}}(e)
return astToRequestJson(t)}var Gy=n(424563)
function getDuplicateColumnsDisplayText(e,t){const n=(0,Gy.Z)(t).map((t=>(0,nd.ZP)(e,t).displayName))
return 0===n.length?null:n.join(", ")}var zy=n(766933),$y=n(494041)
function ColumnReferenceChip(e){return d.createElement("span",{className:(0,g.iv)(Wy.chip),contentEditable:!1,"data-original-text":e.columnReferenceString},d.createElement(pe.Z,{className:(0,g.iv)(Wy.icon),icon:(0,Om.Z)(e.column)}),e.column.displayName)}const Wy=g.mM.create({chip:{borderRadius:4,backgroundColor:Vt.bs,padding:"2px 8px",userSelect:"none"},icon:{color:Vt.hc,marginRight:5}})
function formulaTextToHTML(e,t){const n=Object.fromEntries(t.columns.map((e=>[e.systemName,e]))),a=[...e.matchAll(Ry)]
let i="",s=0
a.forEach((t=>{const a=t.index,r=t[0].length+a
i+=l.default.escape(e.slice(s,a))
i+=function getColumnReferenceChipHTML(e,t){return Xt.renderToStaticMarkup(d.createElement(ColumnReferenceChip,{column:t,columnReferenceString:e}))}(t[0].slice(1,t[0].length-1),n[t.groups.columnSystemName])
s=r}))
i+=l.default.escape(e.slice(s))
return i}function getFormulaLength(e){return e.replace(Ry," ").length}var Hy=n(305466),jy=n(487558),Yy=n(958376)
const Qy="FUNCTIONS",Ky="COLUMNS",Jy="FUNCTION",Xy="COLUMN",eb=d.forwardRef(((e,t)=>{const n=[],a=qy.filter((t=>t.name.toLowerCase().startsWith(e.query.toLowerCase()))).map((e=>({item_id:e.name,name:Jy,item:{}})))
if(a.length>0){n.push({item_id:Qy,name:Qy,item:{}})
n.push(...a)}const i=e.dataFrame.columns.filter((t=>t.displayName.toLowerCase().startsWith(e.query.toLowerCase()))).map((e=>({item_id:e.systemName,name:Xy,item:{}})))
if(i.length>0){n.push({item_id:Ky,name:Ky,item:{}})
n.push(...i)}return d.createElement(jy.Z,{getRenderOptionInfo:t=>{switch(t.name){case Qy:return{optionContent:d.createElement(Yy.uc,{title:Qy}),hoverable:!0,clickable:!1}
case Jy:{const e=qy.find((e=>e.name===t.item_id))
return{optionContent:d.createElement(Yy.uc,{title:e.name,icon:Fy.U[e.category],metadata:e.shortDescription}),hoverable:!0,clickable:!0}}case Ky:return{optionContent:d.createElement(Yy.uc,{title:Ky}),hoverable:!0,clickable:!1}
default:{(0,S.Gp)(t.name===Xy,"Invalid result in AnalysisFormulaSearchDropdown",t.name)
const n=e.dataFrame.columns.find((e=>e.systemName===t.item_id))
return{optionContent:d.createElement(Yy.uc,{title:n.displayName,icon:(0,Om.Z)(n)}),hoverable:!0,clickable:!0}}}},noResultsMessage:`No functions or columns match "${e.query}"`,query:e.query,ref:t,results:n,searching:!1,selectAttachment:(t,n)=>{n===Jy?e.onSelectFunction(t):e.onSelectColumn(t)}})})),tb=/^(\w+)$/
const nb=g.mM.create({functionDropdown:{borderTopRightRadius:0,borderBottomRightRadius:0,height:34},input:{borderColor:Vt.pF,borderRadius:"0px 4px 4px 0px",borderStyle:"solid",borderWidth:1,padding:"7px 10px 3px 10px",minHeight:34,minWidth:0,flexGrow:1,":focus":{borderColor:Vt.mu}},wrapper:{display:"flex"}}),ab=hy[Sn.zs.AGGREGATE_DATASET][0].config.aggregations.elementSpec,ib=(0,Jt.m8)(ab.choices.map((e=>e.fields[ab.tagKey].value)).map((e=>[e,(0,Mt.kC)((0,Mt.Vx)(e))]))),sb={[yy]:["aggregations","groupColumns"],groupColumns:{displayName:"Group by"},aggregations:{displayName:"Aggregate",fieldSettings:{tagKeyDisplayNames:ib,placeholder:"Select function",[yy]:["column","newColumnName"],[by]:(e,t,n)=>{var a
return null==(null==e?void 0:e.aggregationFunction)?e:"COUNT"===e.aggregationFunction?{...e,newColumnName:null!==(a=e.newColumnName)&&void 0!==a?a:ib.COUNT}:null==e.column||(null==t?void 0:t.aggregationFunction)===e.aggregationFunction&&(null==t?void 0:t.column)===e.column?e:{...e,newColumnName:`${ib[e.aggregationFunction]}(${(0,nd.ZP)(n,e.column).displayName})`}},choiceSettings:{aggregationFunction:{displayName:"Aggregation function"},column:{displayName:"Column to aggregate"},newColumnName:{displayName:"New column name"}}}}},rb={[yy]:["column","numBins"],column:{displayName:"Column"},numBins:{displayName:"Number of bins"}},ob=(hy[Sn.zs.COMPUTED_COLUMN][0].config.formula,{[yy]:["newColumnName","formula"],newColumnName:{displayName:"New column name"},formula:{displayName:"Formula text",[Ty]:function AnalysisFormulaEditor(e){var t
const n=null!==(t=e.config.formulaText)&&void 0!==t?t:"",{dataFrameSpec:a}=useStepConfigEditorContext(),[i,s]=(0,d.useState)(null),[r,c]=(0,d.useState)(!1),[m,p]=(0,d.useState)(!1),h=(0,d.useRef)(null),[E]=(0,d.useState)(n),S=(0,d.useRef)(null),y=Ly.ZP.partialTokenize(n,{relative:!1})
let b=null
null!=i&&i.start===i.end&&getFormulaLength(n)===i.end&&y.leftover&&tb.test(y.leftover)&&(b=y.leftover)
const T=null!=i?function getScopedFunction(e,t){const n=Ly.ZP.partialTokenize(e,{relative:!1}).tokens
if(null==n||n.length<2)return null
let a=0
const i=[]
let s=0
for(const e of n){if(s>=t){if(i.length>0&&i[i.length-1].isASTNode()&&e.isLeftParen()){i.push(e)
s+=e.text.length
a=-1}break}i.push(e)
e.node instanceof _y.Value&&"STRING"===e.node.typedValue.type&&e.node.typedValue.rawValue.startsWith(Ay)?s+=1:s+=e.text.length}let r=0
for(let e=i.length-1;e>=0;e--){const t=i[e]
if(t.isRightParen())r++
else if(t.isLeftParen())r--
else if(0===r&&t.isComma())a++
else if(r<0&&t.isASTNode()&&t.node instanceof _y.FunctionOperator){const e=qy.find((e=>e.name===t.node.type))
return e?{function:e,currentParameterIndex:a}:null}}return null}(n,i.end):null
function onChangeFormulaText(t){e.onChangeConfig({...e.config,formulaText:t})}function completeFormulaText(e,t){var i,s
let r,l
r=t.replaceLeftoverTokens?null!==(s=null===(i=y.tokens)||void 0===i?void 0:i.map((e=>e.text)).join(""))&&void 0!==s?s:"":n
l=t.isFunction?`${r}${e}(`:`${r}"$c$${e}" `
onChangeFormulaText(l)
S.current.innerHTML=formulaTextToHTML(l,a)
const c=getFormulaLength(l)
oo.vq(o()(u.findDOMNode(S.current))[0],{start:c,end:c})}return d.createElement("div",{className:(0,g.iv)(nb.wrapper)},d.createElement(zy.Z,{className:(0,g.iv)(nb.functionDropdown),isOpen:r,onFunctionClick:e=>{completeFormulaText(e.name,{isFunction:!0,replaceLeftoverTokens:!1})},primaryFunctions:qy,setDropdownOpenState:c}),d.createElement(Hy.ZP,{canDropUnder:!0,menu:function getDropdownMenu(){return null!=b?d.createElement(eb,{dataFrame:a,onSelectColumn:e=>{completeFormulaText(e,{isFunction:!1,replaceLeftoverTokens:!0})},onSelectFunction:e=>{completeFormulaText(e,{isFunction:!0,replaceLeftoverTokens:!0})},ref:h,query:b}):null!=T?d.createElement($y.ZP,{spreadsheetFunction:T.function,currentParameterIndex:T.currentParameterIndex}):null}(),onRequestClose:()=>{p(!1)},open:m&&(null!=b||null!=T)},d.createElement("div",{className:f()("editable",(0,g.iv)(nb.input)),contentEditable:!0,dangerouslySetInnerHTML:{__html:formulaTextToHTML(E,a)},onInput:e=>{var t
s(oo.xH())
onChangeFormulaText(function htmlToFormulaText(e){return l.default.unescape(e).replace(/<span.+?data-original-text="(.+?)">.+?<\/span>/g,'"$1"')}(null!==(t=e.target.innerHTML)&&void 0!==t?t:""))
p(!0)},onKeyDown:function handleKeyDown(e){null!=h.current&&h.current.queryKeydownHandler(e)},onSelect:()=>{s(oo.xH())
p(!0)},ref:S})))},[by]:(e,t,n)=>{if(null==e.formulaText)return{...e,formulaAst:null}
try{return{...e,formulaAst:formulaTextToFormulaAstJson(e.formulaText)}}catch(t){if(t instanceof AnalysisFormulaParsingError)return{...e,formulaAst:null}
throw t}}}}),lb=(hy[Sn.zs.PIVOT_DATASET][0].config.valueColumns.elementSpec,{[yy]:["pivotColumns","valueColumns","groupColumns"],pivotColumns:{displayName:"Pivot columns"},valueColumns:{displayName:"Values",fieldSettings:{tagKeyDisplayNames:ib,placeholder:"Select function",[yy]:["column","newColumnName"],[by]:(e,t,n)=>null==(null==e?void 0:e.aggregationFunction)||null!=e.newColumnName||null==e.column||(null==t?void 0:t.aggregationFunction)===e.aggregationFunction&&(null==t?void 0:t.column)===e.column?e:{...e,newColumnName:`${ib[e.aggregationFunction]}(${(0,nd.ZP)(n,e.column).displayName})`},choiceSettings:{aggregationFunction:{displayName:"Aggregation function"},column:{displayName:"Column to aggregate"},newColumnName:{displayName:"New column name"}}}},groupColumns:{displayName:"Group by"}})
const cb={[Sn.zs.AGGREGATE_DATASET]:[0],[Sn.zs.BIN_DATA]:[0],[Sn.zs.COMPUTED_COLUMN]:[0],[Sn.zs.PIVOT_DATASET]:[0],[Sn.zs.SORT_COLUMNS]:[0]}
function isStepConfigEditorModalSupported(e,t){var n,a
return null!==(a=null===(n=cb[e])||void 0===n?void 0:n.includes(t))&&void 0!==a&&a}const db={[Sn.zs.AGGREGATE_DATASET]:{0:{modalTitle:"Add aggregation",additionalConfigValidationFn:(e,t)=>{const n=getDuplicateColumnsDisplayText(t,e.groupColumns),a=null==n?null:`Cannot group by the same column more than once. Duplicate columns: ${n}`,i=getDuplicateColumnsDisplayText(t,[...new Set(e.groupColumns),...new Set(e.aggregations.filter((e=>"COUNT"!==e.aggregationFunction)).map((e=>e.column)))]),s=null==i?null:`Cannot group by a column and aggregate it. Columns being aggregated and grouped: ${i}`
return(0,wc.Z)([a,s])},uiSchema:sb}},[Sn.zs.BIN_DATA]:{0:{modalTitle:"Bin data",additionalConfigValidationFn:(e,t)=>[],uiSchema:rb}},[Sn.zs.COMPUTED_COLUMN]:{0:{modalTitle:"Add column",additionalConfigValidationFn:()=>[],additionalDraftConfigValidationFn:(e,t)=>{if(!e.formula.formulaText||null!=e.formula.formulaAst)return[]
try{formulaTextToFormulaAstJson(e.formula.formulaText);(0,S.hu)(!1,"Config validation has valid formula text but null formula AST")}catch(e){if(e instanceof AnalysisFormulaParsingError)return[e.message]
throw e}},uiSchema:ob}},[Sn.zs.PIVOT_DATASET]:{0:{modalTitle:"Add pivot",additionalConfigValidationFn:(e,t)=>{const n=getDuplicateColumnsDisplayText(t,e.pivotColumns),a=null==n?null:`Cannot pivot by the same column more than once. Duplicate columns: ${n}`,i=getDuplicateColumnsDisplayText(t,e.groupColumns),s=null==i?null:`Cannot group by the same column more than once. Duplicate columns: ${i}`,r=e.valueColumns.map((e=>e.column)).filter((t=>e.pivotColumns.includes(t))).map((e=>(0,nd.ZP)(t,e).displayName)),o=0===r.length?null:`Cannot use a column both as a pivot column and a value column. Columns being used as both pivot and value: ${r}`,l=e.valueColumns.map((e=>e.column)).filter((t=>e.groupColumns.includes(t))).map((e=>(0,nd.ZP)(t,e).displayName)),c=0===l.length?null:`Cannot use a column both as a group by column and a value column. Columns being used as both group by and value: ${l}`
return(0,wc.Z)([a,s,o,c])},uiSchema:lb}},[Sn.zs.SORT_COLUMNS]:{0:{modalTitle:"Add sort by",additionalConfigValidationFn:(e,t)=>{const n=getDuplicateColumnsDisplayText(t,e.sortOptions.map((({column:e})=>e)))
return null==n?[]:[`Cannot sort the same column more than once. Duplicate columns: ${n}`]},uiSchema:{sortOptions:{displayName:"Sort by",fieldSettings:{column:{displayName:"Column"},direction:{displayName:"Direction",fieldSettings:{placeholder:"Select sort direction",defaultValue:"ASCENDING",displayNames:{ASCENDING:"Ascending",DESCENDING:"Descending"}}}}}}}}}
function StepConfigEditorModal({stepType:e,stepVersion:t,initialConfig:n,inputDataFrameSpec:a,onRequestClose:i,onRequestSubmit:s}){var r,o,l,c,u
const m=null!==(l=null===(o=null===(r=hy[e])||void 0===r?void 0:r[t])||void 0===o?void 0:o.config)&&void 0!==l?l:null,p={kind:"shape",fields:m,required:!0},{modalTitle:h,uiSchema:g,additionalConfigValidationFn:E,additionalDraftConfigValidationFn:f}=null!==(u=null===(c=db[e])||void 0===c?void 0:c[t])&&void 0!==u?u:{};(0,S.hu)(isStepConfigEditorModalSupported(e,t)&&null!=m,`Config shape should not be null for stepType ${e} and stepVersion ${t}`)
const[y,b]=(0,d.useState)(null!=n?n:function makeInitialConfigState(e,t){return(0,Jt.m8)(Object.entries(e).map((([e,n])=>[e,jsonSpecToInitialValue(n,getFieldSettingsIfPresent(t,e))])))}(m,g)),T=[]
null!=f&&T.push(...f(y,a))
const v=isValueValid(y,p,a)
v&&T.push(...E(y,a))
const C=(0,d.useMemo)((()=>({dataFrameSpec:a})),[a])
return d.createElement(et.ZP,{buttons:[{submit:!0,text:"Submit",disabled:!v||T.length>0}],onRequestClose:i,onRequestSubmit:()=>{s(y)},title:h},d.createElement(fy.Provider,{value:C},d.createElement(StepConfigEditorRouter,{configShape:p,config:y,onChangeConfig:e=>{(0,Go.gF)(e)
b(e)},uiSchema:g,isTopLevel:!0}),d.createElement(pd.Z,{messages:T.map((e=>({bannerType:io.ct.WARNING,text:e})))})))}function UIPlaceholder({infoSection:e,actionContent:t}){return d.createElement("div",{className:(0,g.iv)(ub.wrapper)},d.createElement("div",{className:(0,g.iv)(ub.infoSection)},e),t)}const ub=g.mM.create({wrapper:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",top:"25%"},infoSection:{..._n.H5,color:Vt.pp,fontWeight:_n.hS,textAlign:"center",width:320,marginBottom:12}})
var mb=n(384463)
const pb="Please reach out to Benchling Support for additional help."
function getDatasetViewErrorMessage(e){const t=e.find((e=>e.statusCode===Sn.wF.FAILED))
return null==t?null:t.definition.stepType===Sn.zs.FILTER_DATASET?`Filtering was unsuccessful. ${pb}`:`There was an error creating this view. ${pb}`}const hb=(0,xl.ZP)(null),gb=(0,xl.ZP)(null),Eb=[{stepType:Sn.zs.COMPUTED_COLUMN,stepVersion:0},{stepType:Sn.zs.AGGREGATE_DATASET,stepVersion:0},{stepType:Sn.zs.BIN_DATA,stepVersion:0},{stepType:Sn.zs.PIVOT_DATASET,stepVersion:0}]
function AdditionalEditorSection({title:e,addItemElement:t,pills:n,showTopBorder:a}){return d.createElement("div",{className:(0,g.iv)(fb.additionalEditorSection)},d.createElement("div",{className:(0,g.iv)(fb.additionalEditorSectionHeader,a&&fb.borderTop)},e,t),n.map(((e,t)=>d.createElement("div",{className:0===t?"u-small-spacing-top":"u-tiny-spacing-top",key:t},e))))}function AddTransformStepDropdown({viewSteps:e,dataFrameSpec:t,inputDataFrameId:n,analysis:a}){const i=e[e.length-1].definition.stepType===Sn.zs.VISUALIZATION,s=e.findLast((e=>e.definition.stepType!==Sn.zs.VISUALIZATION));(0,S.hu)(null!=s,"Expected viewSteps to contain a non-VISUALIZATION step")
const r=hy[s.definition.stepType][s.definition.stepVersion];(0,S.hu)(r.outputDataShapes.hasOwnProperty(Gc),`Step type ${s.definition.stepType} does not have SINGLE_DATASET_OUTPUT_STEP_DATA_NAME output data to use as input for new transform steps`)
const o=i?{[Gc]:[{stepId:e[e.length-1].id,stepDataName:Uc}]}:void 0,l={[Uc]:[{stepId:s.id,stepDataName:Gc}]},c=Eb.map((({stepType:e,stepVersion:i})=>({key:e,text:py.ni[e],onSelect:()=>{(0,Xn.Z)(StepConfigEditorModal,{stepType:e,stepVersion:i,inputDataFrameSpec:t,onRequestSubmit:t=>{(0,Ic.jI)((0,jl._2)(a.id,{stepType:e,stepVersion:i,stepConfig:t,stepInput:{inputDataFrameId:n},stepOutputChildren:o,stepInputParents:l}),"Updating transformations...")}})}})))
return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{dropLeft:!0,width:Nr.zL.MEDIUM,height:Nr.Bl.MEDIUM},c.map((({key:e,onSelect:t,text:n})=>d.createElement(N.Z,{key:e,onSelect:t},n))))},d.createElement(vy.Z,{className:(0,g.iv)(fb.addIcon)}))}function getTransformSteps(e){return e.filter((e=>isStepConfigEditorModalSupported(e.definition.stepType,e.definition.stepVersion)))}function hasTransformStep(e){return getTransformSteps(e).length>0}function VisualizationStepEditor({analysis:e,viewSteps:t,clientStateId:n,handleSaveChart:a,inputDataFrameId:i,filterOptions:s,onCancel:r,initialVisualizationConfig:o,initialVisualizationName:l,isRunning:c}){var u,m,p
const h=[...dt.ZP.ENABLE_ANALYSIS_TOOL_TABLE_VIEW?[]:[cu.nB.TABLE],cu.nB.HEATMAP],[E,f]=hb.useGlobalClientState(n),[y,b]=gb.useGlobalClientState(n),T=getInheritedDatasetFilterOptions(e,t[0]),v=null!==(m=null!==(u=null!=E?E:o)&&void 0!==u?u:hasTransformStep(t)?{__typename:"AnalyticsVisualizationNode",id:"stub-id",parameters:{__typename:"AnalyticsVisualizationTableParametersNode",displayColumnsJson:null}}:null)&&void 0!==m?m:null,I=null!==(p=null!=y?y:l)&&void 0!==p?p:null!=v?getDefaultVisualizationNameForVisualizationType(v.parameters.__typename):"New view"
function getColumns(e){return e.columns.filter((e=>!(0,$d.Z)(e)))}const w=d.createElement("div",{className:(0,g.iv)(fb.previewAreaPane)},d.createElement(kl.b,null))
if(c)return d.createElement("div",{className:(0,g.iv)(fb.view)},w)
const N="AnalyticsVisualizationTableParametersNode"===(null==v?void 0:v.parameters.__typename)
return d.createElement("div",{className:(0,g.iv)(fb.view)},d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>w,variables:{dataFrameId:i}},(({dataFrame:o})=>{(0,S.hu)(!(0,ka.CZ)(o),"User does not have access to input data frame")
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(fb.previewAreaPane)},null==v?d.createElement("div",{className:(0,g.iv)(fb.wrapper),...(0,ee.Z)({component:"ChartEditorView",element:"root"})},d.createElement(yf.ZP,{title:I},d.createElement(UIPlaceholder,{infoSection:d.createElement(d.Fragment,null,d.createElement("img",{className:(0,g.iv)(fb.emptyChartImg),src:(0,me.Z)("/static/img/insights/grouped_bar_chart_v2.svg")}),d.createElement("div",{className:(0,g.iv)(fb.emptyChartTitle)},"This view is empty")),actionContent:d.createElement("span",{className:(0,g.iv)(fb.emptyChartHint)},"Begin by selecting a view type")}))):d.createElement(d.Fragment,null,N&&d.createElement("div",{className:(0,g.iv)(fb.allTableChangesSavedWrapper)},d.createElement(io.ZP,{bannerType:io.ct.INFO,text:"All changes to this table will be saved."})),d.createElement("div",{className:(0,g.iv)(fb.wrapper),...(0,ee.Z)({component:"ChartEditorView",element:"root"})},d.createElement(PresentationalUniversalBlockView,{actionOrigin:cd.Z.ANALYSIS_TOOL,errorMessage:getDatasetViewErrorMessage(t),inputDataFrame:o.dataFrameJson,maxRows:1e3,viewStateId:n,visualizationConfig:v,paneProps:{title:I,banner:d.createElement(uy.Z,{dataFrameSpec:o.dataFrameJson,filterOptions:s,parentFilterOptions:T})}})))),d.createElement("div",{className:(0,g.iv)(fb.rightPane)},d.createElement(VisualizationConfigEditor,{columns:getColumns(o.dataFrameJson),disabledVisualizationTypes:h,isAnalysisTool:!0,onChangeVisualizationConfig:async n=>{if(N&&"AnalyticsVisualizationTableParametersNode"!==n.parameters.__typename&&hasTransformStep(t)){await je.iG("Change view type?","All existing transformations will be removed.",C.ZJ.NEGATIVE,{enableRedesign:!0})
const a=t.findIndex((e=>isStepConfigEditorModalSupported(e.definition.stepType,e.definition.stepVersion)))
await(0,Ic.jI)((0,jl.UF)(e.id,{stepIds:t.filter((e=>e.definition.stepType!==Sn.zs.VISUALIZATION)).slice(a).map((e=>e.id))}),"Updating chart...")
f(n)}else f(n)},visualizationConfig:v,chartTitleOptions:{visualizationName:I,onChangeVisualizationName:b},useSystemNames:!0}),v&&d.createElement(AdditionalEditorSection,{title:"Filter",addItemElement:d.createElement(mb.Z,{dataFrameSpec:o.dataFrameJson,filterOptions:s},((e,t)=>d.createElement(P.ZP,{disabled:!t,title:"No more filters can be added because all columns are already filtered"},d.createElement(vy.Z,{className:(0,g.iv)(fb.addIcon),onClick:e,disabled:t})))),pills:s.filters.map((e=>d.createElement(dy.Z,{hasError:s.failed,dataFrame:o.dataFrameJson,filter:e,filterOptions:s,onDelete:()=>{s.setFilterForColumn(e.filters[0].columnSystemName,null)}}))),showTopBorder:!N}),N&&d.createElement(AdditionalEditorSection,{title:"Transformations",addItemElement:d.createElement(AddTransformStepDropdown,{viewSteps:t,dataFrameSpec:o.dataFrameJson,inputDataFrameId:i,analysis:e}),pills:getTransformSteps(t).map((t=>d.createElement(my.Z,{key:t.id,text:py.ni[t.definition.stepType],onClick:()=>{(0,Ic.jI)((0,Ml.doQuerySafe)({query:Rm.Oh},{variables:{dataFrameId:t.inputStepDatas[0].dataFrames[0].id}})).then((({dataFrame:n})=>{(0,S.hu)(!(0,ka.CZ)(n),"User does not have access to data frame");(0,Xn.Z)(StepConfigEditorModal,{stepType:t.definition.stepType,stepVersion:t.definition.stepVersion,inputDataFrameSpec:n.dataFrameJson,onRequestSubmit:n=>{(0,Ic.jI)((0,jl.W8)(e.id,{stepId:t.id,stepConfig:n}),"Updating transformations...")},initialConfig:getPipelineStepConfig(t,t.definition.stepType,t.definition.stepVersion)})}))}}))),showTopBorder:!0}),d.createElement("div",{className:"u-input-spacing-top"}),d.createElement("div",{className:(0,g.iv)(fb.rightPaneFooter)},N?d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:(0,g.iv)(fb.confirmationButton),size:C.qE.MEDIUM,onClick:()=>{a(v,I)},text:"Done"}):d.createElement(d.Fragment,null,d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:(0,g.iv)(fb.confirmationButton),size:C.qE.MEDIUM,onClick:()=>{f(null)
b(null)
r()},text:"Cancel"}),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:(0,g.iv)(fb.confirmationButton),size:C.qE.MEDIUM,disabled:null==v||""===I,onClick:()=>{a(v,I)},text:"Save view"})))))})))}const fb=g.mM.create({wrapper:{...Yl.xT,overflowY:"auto",height:"100%"},divider:{marginTop:10,marginBottom:10},emptyChartImg:{height:100,width:100},emptyChartHint:{..._n.dY,color:Vt.pp,fontWeight:_n.hS,textAlign:"center"},emptyChartTitle:{fontSize:22,color:Vt.Rl},confirmationButton:{marginLeft:10},additionalEditorSection:{padding:"4px 12px"},additionalEditorSectionHeader:{textTransform:"uppercase",fontWeight:"bold",display:"flex",alignItems:"center",color:Vt.pp,paddingTop:8},borderTop:{borderTop:`1px solid ${Vt.tN}`},previewAreaPane:{background:Vt.bs,display:"flex",flexDirection:"column",flexGrow:1,overflowX:"hidden"},rightPane:{display:"flex",flexDirection:"column",height:"100%",padding:12,paddingLeft:4,paddingRight:4,width:232,flexShrink:0},rightPaneFooter:{alignSelf:"flex-end",borderTop:`1px solid ${Vt.tN}`,display:"flex",justifyContent:"flex-end",marginTop:"auto",paddingTop:15,paddingBottom:15,width:"100%"},typeSelector:{margin:ip.mR},view:{backgroundColor:Vt.Cj,display:"flex",flexDirection:"row",height:"100%",width:"100%"},fullWidth:{width:"100%"},addIcon:Yl.CQ,allTableChangesSavedWrapper:{marginTop:Yl.hW,marginLeft:Yl.hW,marginRight:Yl.hW}})
var Sb=n(101118),yb=n(384727),bb=n(929945),Tb=n(453580),vb=n(368734)
const Cb={disabled:!1,style:C.ZJ.TERTIARY_GRAY,text:"Cancel"},Ib={disabled:!1,style:C.ZJ.SECONDARY,text:"Next",dataTestAttrs:{component:"getDataMappingConfirmationButtons",key:vb.Z.NEXT}}
function getColumnsThatMayBeMappedToField(e,t){const n=function getAllowedLeafTypes(e){if(e===Hn.FieldType.JSON)return[]
const t=Hn.FIELD_TYPE_TO_LEAF_TYPE[e]
if(t===Hd.i0.TEXT)return Object.values(Hd.i0)
let n=[t,Hd.i0.TEXT,Hd.i0.JSON]
for(const[e,a]of Object.entries(Hd.HA))t===e?n=[...n,...a]:a.includes(t)&&(n=[...n,e]);(0,Hd.ho)(t)||(n=[...n,Hd.i0.BENCHLING_OBJECT])
t===Hd.i0.BOOLEAN&&(n=[...n,Hd.i0.DECIMAL,Hd.i0.INTEGER])
return n}(t.fieldType)
return e.filter((e=>n.includes(e.type.leafType)&&!(0,$d.Z)(e)))}const NAME_MATCH_FN=(e,t)=>e.displayName.toUpperCase()===t.displayName.toUpperCase(),EXACT_TYPE_MATCH_FN=(e,t)=>Hn.FIELD_TYPE_TO_LEAF_TYPE[e.fieldType]===t.type.leafType,LOOSE_MATCH_FN=()=>!0
function createMapping(e,t){return{inputColumnSystemName:t.systemName,outputFieldId:e.apiId}}function removePairFromPossibleMatchGraph(e,t,n){n.delete(e)
for(const e of n.values())e.delete(t)}function getDefaultColumnMapping(e,t){const n=new Map(t.fields.map((t=>[t,new Set(getColumnsThatMayBeMappedToField(e.columns,t))]))),a=[NAME_MATCH_FN,EXACT_TYPE_MATCH_FN,LOOSE_MATCH_FN].flatMap((e=>function findMappings(e,t){const n=[]
for(const[a,i]of[...e.entries()]){const s=[...i.values()].filter((e=>t(a,e)))
if(1===s.length){n.push(createMapping(a,s[0]))
removePairFromPossibleMatchGraph(a,s[0],e)}}return n}(n,e)))
return a}function InternalDataMappingModal(e){const[t,n,a]=useDataMappingState(e.analysisId,e.dataFrameId),{resultSchema:i}=t,s=function getDataMappingConfirmationButtons({onClose:e,onNext:t,resultSchema:n}){return[{...Cb,onClick:e},{...Ib,disabled:null==n,onClick:t}]}({resultSchema:i,onClose:()=>{a()
e.onRequestClose()},onNext:()=>{e.onOpenStepInitializationView({type:Fc.SAVE_TO_RESULTS_CONFIGURATION,inputDataReference:e.inputDataReference,inputDataFrameId:e.dataFrameId})
e.onRequestClose()}}),r=(0,bb.ZP)({includeArchivedSelectors:!0})
return d.createElement(et.ZP,{title:"Save to Results",buttons:s,onRequestClose:e.onRequestClose},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Result schema"}),d.createElement(um.ZP,{selectedSchema:i,onChange:t=>{const a=t?getDefaultColumnMapping(e.dataFrame,t):[]
n({resultSchema:t,mappings:a})},filter:e=>!(0,yc.ZP)(e)}),i&&(0,bb.VD)(r)&&d.createElement("div",{className:"mediocre"},d.createElement(yb.I,{schemaAndColumnGroup:{...i,columnGroup:null},adapter:new Sb.Z(Tb.sl.RESULTS),selectorsById:r}))))}function DataMappingModal(e){return d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>d.createElement(kl.b,null),variables:{dataFrameId:e.dataFrameId}},(({dataFrame:t})=>(0,ka.CZ)(t)?null:d.createElement(InternalDataMappingModal,{...e,dataFrame:t.dataFrameJson})))}async function createViewAndOpenCreateVisualizationView(e,t,n,a,i){const s=await(0,Ic.jI)((0,jl._2)(e.id,{stepType:Sn.zs.DATASET_VIEW,stepVersion:0,stepConfig:{},stepInputParents:{[Uc]:[n]},stepInput:{inputDataFrameId:t}}),"Creating view...")
a({type:Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW,stepId:s.id,initialStepConfig:null!=i?{visualizationConfig:i,visualizationName:getDefaultVisualizationNameForVisualizationType(i.parameters.__typename)}:void 0})}var wb,Nb,Ab=n(153686),Rb=n(909171)
function getDefaultVisualizationConfigGQL(e,t){const n={__typename:"AnalyticsVisualizationNode",id:`stub-id-${l.default.uniqueId()}`,parameters:{__typename:"AnalyticsVisualizationTableParametersNode",displayColumnsJson:null}}
return{...n,...new tp[t](e.columns.filter((e=>!(0,$d.Z)(e))),n,!0).getUpdate()}}!function(e){e.TABLE="Table"
e.BAR="Bar"
e.OTHER="Other charts"}(wb||(wb={}))
!function(e){e.TABLE="Table"
e.GROUPED_BAR="Vertical grouped bar chart"
e.STACKED_BAR="Vertical stacked bar chart"
e.LINE="Line chart"
e.PIE="Pie chart"
e.SCATTER="Scatter plot"}(Nb||(Nb={}))
const Pb={[Nb.TABLE]:cu.nB.TABLE,[Nb.GROUPED_BAR]:cu.nB.BAR_CHART,[Nb.STACKED_BAR]:cu.nB.BAR_CHART,[Nb.LINE]:cu.nB.LINE_CHART,[Nb.PIE]:cu.nB.PIE_CHART,[Nb.SCATTER]:cu.nB.SCATTER_PLOT},Ob={[Nb.TABLE]:"/static/img/insights/table.svg",[Nb.GROUPED_BAR]:"/static/img/insights/grouped_bar_chart_v2.svg",[Nb.STACKED_BAR]:"/static/img/insights/stacked_bar_chart_v2.svg",[Nb.LINE]:"/static/img/insights/line_chart.svg",[Nb.PIE]:"/static/img/insights/pie_chart.svg",[Nb.SCATTER]:"/static/img/insights/scatter_plot.svg"}
function makeChartTypeOption(e){const t={optionType:e,imagePath:Ob[e]}
function baseCreateVisualizationConfig(t){return getDefaultVisualizationConfigGQL(t,Pb[e])}switch(e){case Nb.TABLE:case Nb.GROUPED_BAR:case Nb.LINE:case Nb.PIE:case Nb.SCATTER:return{...t,createVisualizationConfig:baseCreateVisualizationConfig}
case Nb.STACKED_BAR:return{...t,createVisualizationConfig:e=>{const t=baseCreateVisualizationConfig(e)
return updateVisualization(t,{parameters:{...t.parameters,barChartType:Sn.JG.STACKED}})}}
default:(0,S.hu)(!1,"Encountered an unsupported visualization subtype")}}const xb=[{chartTypeCategory:wb.TABLE,chartOptions:[Nb.TABLE].map((e=>makeChartTypeOption(e)))},{chartTypeCategory:wb.BAR,chartOptions:[Nb.GROUPED_BAR,Nb.STACKED_BAR].map((e=>makeChartTypeOption(e)))},{chartTypeCategory:wb.OTHER,chartOptions:[Nb.LINE,Nb.PIE,Nb.SCATTER].map((e=>makeChartTypeOption(e)))}]
function ChartButton({imagePath:e,onClick:t}){return d.createElement("div",{className:(0,g.iv)(_b.chartOption),onClick:t},d.createElement("img",{className:(0,g.iv)(_b.chartImg),src:(0,me.Z)(e)}))}function AddChartViewMenu({analysis:e,stepId:t,onOpenStepInitializationView:n,dataFrameId:a,onRequestClose:i}){const s=(0,Dc.ZP)(e,t),r=s.outputStepDatas.filter((e=>e.kind===Sn.AT.DATASET));(0,S.hu)(1===r.length,"Data frame's step has more than one output step data",{numDatasetOutputStepDatas:r.length})
const o={stepId:s.id,stepDataName:r[0].name}
return d.createElement("div",{className:(0,g.iv)(_b.selectViewPopover)},d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>d.createElement(kl.b,null),variables:{dataFrameId:a}},(({dataFrame:t})=>{(0,S.hu)(!(0,ka.CZ)(t),"User does not have access to input data frame")
return xb.map((a=>d.createElement("div",{className:(0,g.iv)(_b.chartTypeSection),key:a.chartTypeCategory},d.createElement(Fr.Z,{label:a.chartTypeCategory.toUpperCase()}),d.createElement("div",{className:(0,g.iv)(_b.chartOptionsSection)},a.chartOptions.map((a=>d.createElement(ChartButton,{key:a.optionType,imagePath:a.imagePath,onClick:()=>{const s=null!=a.createVisualizationConfig?a.createVisualizationConfig(t.dataFrameJson):void 0
createViewAndOpenCreateVisualizationView(e,t.id,o,n,s)
i()}})))))))})))}function AddChartViewPopover({analysis:e,stepId:t,onOpenStepInitializationView:n,dataFrameId:a,children:i}){const[s,r]=(0,d.useState)(!1)
return d.createElement(Rb.Z,{isOpen:s,onRequestClose:()=>{r(!1)},interaction:ne.x2.CONTROLLED,placement:ne.ZH.BOTTOM_END,floatingElementOptions:{floatingBodyZIndex:Dn.Ch,floatingBodyClassName:(0,g.iv)(_b.popdownBody)},renderContent:()=>d.createElement(AddChartViewMenu,{analysis:e,stepId:t,onOpenStepInitializationView:n,dataFrameId:a,onRequestClose:()=>{r(!1)}})},i((()=>{r(!0)})))}const _b=g.mM.create({chartImg:{width:46,height:25,margin:"auto"},chartOptionsSection:{display:"flex",flexWrap:"wrap"},chartOption:{width:72,height:48,display:"inline-flex",borderRadius:4,marginRight:4,marginBottom:8,backgroundColor:Ab.Il.GRAY_50,border:"1px solid",borderColor:Ab.Il.GRAY_200,cursor:"pointer",":hover":{backgroundColor:Ab.Il.GRAY_200,borderColor:Ab.Il.GRAY_200}},chartTypeSection:{marginBottom:8},popdownBody:{background:Vt.Cj,borderRadius:4,boxShadow:`0px 2px 6px ${Vt.pp}`},sectionTitle:{..._n.sE,marginBotton:8},selectViewPopover:{paddingTop:16,paddingLeft:16,paddingRight:12,width:256}})
function DataFrameActionButton(e){return d.createElement(P.ZP,{title:e.title,placement:P.TQ.TOP},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:f()("u-mini-spacing-left",Boolean(e.toggled)&&"is-active"),disabled:e.disabled,icon:e.icon,onClick:e.onClick,size:C.qE.MINI}))}function createRenderAddChartViewButton(e,t,n,a){return()=>d.createElement(AddChartViewPopover,{analysis:e,stepId:t,dataFrameId:n.id,onOpenStepInitializationView:a,key:"AddChartViewButton"},(e=>d.createElement(DataFrameActionButton,{icon:"chart-plus",onClick:e,title:"Add view"})))}var Db=n(194786)
function PersistedDataFrameMetadataModal({dataFrameNode:e,additionalGridCells:t=[],additionalContent:n,onRequestClose:a}){return d.createElement(et.ZP,{mediumLarge:!0,title:"Table metadata",onRequestClose:a,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"root"}},d.createElement("div",null,d.createElement(Db.X2,null,d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"column",key:"Name"}},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Name"}),d.createElement("p",null,e.name))),d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"column",key:"Creator"}},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Creator"}),d.createElement("p",null,e.creator.name)))),d.createElement(Db.X2,null,d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"column",key:"Last modified"}},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Last modified"}),d.createElement("p",null,(0,Mt.kC)((0,Kl.Z)(e.modifiedAt))))),d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"column",key:"Created at"}},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Created at"}),d.createElement("p",null,(0,Hr.UT)(e.createdAt))))),[...(0,Jt.yo)(t,2)].map((([e,t],n)=>d.createElement(Db.X2,{key:n},d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"column",key:e.key}},e.component),null!=t&&d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"PersistedDataFrameMetadataModal",element:"column",key:t.key}},t.component))))),d.createElement("div",{...(0,ee.Z)({component:"PersistedDataFrameMetadataModal",element:"div",key:"additionalContent"})},n))}function PresentationalPersistedDataFrameTableWrapper({dataFrameNode:e,actionOrigin:t,additionalOverflowOptions:n,additionalActionButtons:a=[],clientStateId:i,additionalMetadataModalGridCells:s=[],additionalMetadataModalContent:r,filterOptions:o}){if((0,ka.CZ)(e)){(0,S.Gp)(!1,"Got inaccessible dataframe",{dataFrameId:e.invalidId})
return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"You do not have access to this table."})}{const l={icon:"info-circle",onSelect:()=>{(0,Xn.Z)(PersistedDataFrameMetadataModal,{dataFrameNode:e,additionalGridCells:s,additionalContent:r})},title:"Table metadata"}
return d.createElement(dd.Z,{actionOrigin:t,additionalOverflowOptions:[...null!=n?n:[],l],additionalActionButtons:a,allowRowSelection:!0,clientStateId:`${i}-${e.id}`,dataFrame:e.dataFrameJson,dataFrameId:e.id,renderIsExcludedColumn:!1,filterOptions:o})}}var Lb=n(84666)
const kb="This action is unavailable because of an error",Mb={[Sn.zs.AGGREGATE_DATASET]:"Aggregate table",[Sn.zs.COMPUTED_COLUMN]:"Add computed column",[Sn.zs.BIN_DATA]:"Bin data",[Sn.zs.CONNECTION_DATA_DATASET]:"Connection data",[Sn.zs.DATASET_VIEW]:"View",[Sn.zs.FILTER_DATASET]:"Filter table",[Sn.zs.INITIALIZE_DATASET]:"Insights block",[Sn.zs.NOTEBOOK_TABLE_DATASET]:"Notebook table",[Sn.zs.REGISTRY_SCHEMA_DATASET]:"Registry schema",[Sn.zs.THIRD_PARTY]:"API",[Sn.zs.SAVE_TO_RESULTS]:"Save to results",[Sn.zs.SORT_COLUMNS]:"Sort columns",[Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION]:"Parameter optimization table creation",[Sn.zs.PARAMETER_OPTIMIZATION_MODELING]:"Parameter optimization modeling",[Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION]:"Parameter optimization prediction",[Sn.zs.PIVOT_DATASET]:"Pivot table",[Sn.zs.VISUALIZATION]:"Chart"}
function getAdditionalOverflowOptions(e,t,n,a,i){var s,r
const o=t.outputStepDatas.filter((e=>e.kind===Sn.AT.DATASET));(0,S.hu)(1===o.length,"Data frame's step has more than one output step data")
const l=function getCannotCreateViewTooltipText(e,t,n){return(0,yc.ZP)(e)?Yl.V$:t.statusCode===Sn.wF.FAILED?kb:void 0}(e,t),c=!e.permissions.writable&&!e.permissions.unarchivable,d=!dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES||dt.ZP.ENABLE_ANALYSIS_TOOL_TABLE_VIEW||c?[]:[{icon:"chart-column",title:"Create view",isDisabled:null!=l,tooltipTitle:l,onSelect:()=>{createViewAndOpenCreateVisualizationView(e,n.id,{stepId:t.id,stepDataName:o[0].name},i)}}],u=null!==(r=null===(s=e.execution.steps.find((e=>e.definition.stepType===Sn.zs.SAVE_TO_RESULTS&&null!=e.inputStepDatas.find((e=>e.dataFrames.find((e=>e.id===n.id)))))))||void 0===s?void 0:s.id)&&void 0!==r?r:null
if(null!=u&&(0,ln.cr)({feature:on.gm.RESULTS_OPEN}))d.push({icon:"table",title:"View saved Results",onSelect:()=>{a({type:Fc.SAVE_TO_RESULTS_OUTPUT,stepId:u})}})
else if(null==u&&(e.permissions.writable||e.permissions.unarchivable)&&(0,ln.cr)({feature:on.gm.RESULTS_CREATE})){let a,s=!1
if((0,yc.ZP)(e)){s=!0
a=Yl.V$}else if(t.statusCode===Sn.wF.FAILED){s=!0
a=kb}d.push({icon:"table",title:"Save table to Results",isDisabled:s,tooltipTitle:a,onSelect:()=>(0,Xn.Z)(DataMappingModal,{analysisId:e.id,inputDataReference:{stepId:t.id,stepDataName:o[0].name},dataFrameId:n.id,onOpenStepInitializationView:i})})}return d}function stepToAdditionalGridCells(e){if(e.definition.stepType===Sn.zs.INITIALIZE_DATASET&&2===e.definition.stepVersion){const t=getPipelineStepConfig(e,Sn.zs.INITIALIZE_DATASET,2)
return[{component:d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Dashboard name"}),d.createElement("p",null,t.dashboardName)),key:"Dashboard name"},{component:d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Block name"}),d.createElement("p",null,t.blockName)),key:"Block name"}]}if(e.definition.stepType===Sn.zs.NOTEBOOK_TABLE_DATASET){const t=getPipelineStepConfig(e,Sn.zs.NOTEBOOK_TABLE_DATASET,0)
return[{component:d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Entry"}),d.createElement("p",null,d.createElement(Lb.Z,{id:t.entryId,size:Za.TK.MINI}))),key:"Entry name"},{component:d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Table name"}),d.createElement("p",null,t.tableName)),key:"Table name"}]}return[]}function ParameterCol({parameterValue:e,parameterConfig:t}){return d.createElement(p.Z,{sm:6,dataTestAttrs:{component:"ParameterCol",key:t.systemName}},d.createElement(Ke.Z,{key:t.id},d.createElement(Fr.Z,{label:`{{${t.systemName}}}`}),d.createElement("p",null,e)))}function AdditionalMetadataModalContent({step:e}){if(e.definition.stepType===Sn.zs.INITIALIZE_DATASET&&2===e.definition.stepVersion){const t=getPipelineStepConfig(e,Sn.zs.INITIALIZE_DATASET,2)
return d.createElement(d.Fragment,null,d.createElement("hr",{className:(0,g.iv)(Fb.divider)}),[...(0,Jt.yo)(t.parameters,2)].map((([e,t],n)=>d.createElement(h.Z,{key:n},d.createElement(ParameterCol,{parameterConfig:e.config,parameterValue:e.valueJson}),null!=t&&d.createElement(ParameterCol,{parameterConfig:t.config,parameterValue:t.valueJson})))),d.createElement("pre",{...(0,ee.Z)({component:"AdditionalMetadataModalContent",key:"parameterizedSqlQuery"})},t.parameterizedSQLQuery))}if(e.definition.stepType===Sn.zs.REGISTRY_SCHEMA_DATASET){const t=getPipelineStepConfig(e,Sn.zs.REGISTRY_SCHEMA_DATASET,0)
return d.createElement("pre",{...(0,ee.Z)({component:"AdditionalMetadataModalContent",key:"queryDescription"})},t.queryDescription)}return null}const Fb=g.mM.create({wrapper:{...Yl.xT,overflowY:"auto"},banner:{paddingBottom:10},divider:{marginTop:10,marginBottom:10}})
function getVisualizationConfigGQLFromStep(e){const t=getPipelineStepConfig(e,Sn.zs.VISUALIZATION,0)
return{visualizationConfig:{__typename:"AnalyticsVisualizationNode",id:`stub-id-${e.id}`,parameters:{__typename:ed.Ll[t.visualizationConfig.type],...t.visualizationConfig.parameters,...(0,Jt.m8)(cy[t.visualizationConfig.type].map((e=>[e,null])))}},visualizationName:t.visualizationName}}function getFilterConfigFromStep(e){return getPipelineStepConfig(e,Sn.zs.FILTER_DATASET,0)}var Zb=n(650546)
const Bb=(0,xl.ZP)(null)
const qb=g.mM.create({banner:{marginBottom:10},wrapper:{...(0,ig.C)(Yl.xT,"boxShadow")},fullHeight:{height:"100%"}})
function BaseStepStatusView({children:e}){return d.createElement("div",{className:(0,g.iv)(Vb.wrapper)},d.createElement(UIPlaceholder,{infoSection:e}))}const Vb=g.mM.create({wrapper:{margin:20,height:"calc(100% - 40px)",width:"calc(100% - 40px)",backgroundColor:Vt.Cj},loadingImage:{width:100,height:100}})
const Ub=g.mM.create({icon:{width:48,height:48,marginBottom:15,color:Vt.TG}})
var Gb,zb=n(22689)
!function(e){e.ANALYSIS="ANALYSIS"}(Gb||(Gb={}))
var $b=n(20859)
function CopyAnalysisKeyButton({analysisId:e,disabled:t}){const[n,a]=(0,d.useState)(null),i=(0,d.useCallback)((()=>(0,zb.O)({bearerTokenConsumer:zb.i.ASSAYS}).then((e=>{a(e.access_token)}))),[a]);(0,Ul.Z)((()=>{i()}));(0,d.useEffect)((()=>{const e=setInterval(i,6e4)
return()=>{clearInterval(e)}}),[i])
return d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,disabled:null==n||t,fontWeight:_n.KB,icon:"copy",onClick:function handleCopyAnalysisKey(){(0,S.hu)(null!=n,"Access token not defined");(0,$b.Z)(`${e}:${n}`,{showToastOnSuccess:!0,toastText:"Copied Analysis key to clipboard."});(0,m.L9)(j.Sy.COPIED_ANALYSIS_STEP_KEY,{pipeline_id:e,pipeline_type:Gb.ANALYSIS,action_origin:cd.Z.ANALYSIS_TOOL})},size:C.qE.SMALL,text:"Copy Analysis key",textColor:null==n||t?void 0:Vt.pp,dataTestAttrs:{component:"CopyAnalysisKeyButton",element:"root"}})}const Wb=[Sn.wF.SUCCEEDED,Sn.wF.WAITING,Sn.wF.FAILED]
function ThirdPartyStepHeader({analysis:e,step:t}){(0,S.hu)(function statusCodeIsSupported(e){return Wb.includes(e)}(t.statusCode),"Unexpected status code for third party step",t.statusCode)
const n={[Sn.wF.SUCCEEDED]:{bannerType:io.ct.SUCCESS,text:"Successfully received data."},[Sn.wF.WAITING]:{bannerType:io.ct.INFO,text:"Awaiting output from external tool."},[Sn.wF.FAILED]:{bannerType:io.ct.ERROR,text:"Error receiving data.",supportingInfo:t.statusMessage}}[t.statusCode]
return d.createElement("div",{className:(0,g.iv)(Hb.viewWrapper),...(0,ee.Z)({component:"ThirdPartyStepHeader",element:"root"})},d.createElement("div",{className:"u-flex-display"},d.createElement("div",{className:(0,g.iv)(Hb.headerIconWrapper)},d.createElement(pe.Z,{icon:"integration",className:(0,g.iv)(Hb.headerIcon)})),d.createElement("div",{className:"u-small-spacing-left"},d.createElement("div",{className:(0,g.iv)(Hb.title)},py.ni[Sn.zs.THIRD_PARTY]),d.createElement("div",{className:(0,g.iv)(Hb.subtitle)},"Last modified: ",useFuzzyDate(t.modifiedAt)))),d.createElement("div",{className:(0,g.iv)(Hb.banner)},d.createElement(io.ZP,{...n,dataTestAttrs:{component:"ThirdPartyStepHeader",element:"banner"}})),(e.permissions.writable||e.permissions.unarchivable)&&d.createElement("div",{className:(0,g.iv)(Hb.copyStepKeyButton)},d.createElement(P.ZP,{title:(0,yc.ZP)(e)?Yl.V$:"Depending on your external tool’s connection, you may need this Analysis key.",placement:P.TQ.TOP},d.createElement(CopyAnalysisKeyButton,{analysisId:e.id,disabled:(0,yc.ZP)(e)}))))}const Hb=g.mM.create({viewWrapper:{...Yl.xT,padding:"20px 20px 16px 20px",backgroundColor:"white"},headerIcon:{height:23,width:23},headerIconWrapper:{backgroundColor:Vt.bs,height:40,width:40,display:"flex",alignItems:"center",justifyContent:"center"},subtitle:{..._n.E0,color:Vt.pp},title:{..._n.VM,fontWeight:_n.KB},banner:{...jf.S1},copyStepKeyButton:{marginTop:16}})
function doesStepSupportHeader(e){return e.definition.stepType===Sn.zs.THIRD_PARTY}function StepHeaderRouter(e){(0,S.Gp)(doesStepSupportHeader(e.step),"Step does not support header")
return e.step.definition.stepType===Sn.zs.THIRD_PARTY?d.createElement(ThirdPartyStepHeader,{...e}):null}const jb=(0,xl.ZP)(null),Yb={"text/html":448},Qb={"image/jpeg":448,"image/png":448}
function getFileBlockMinHeight(e){var t;(0,S.hu)(null!=e.externalFileId,"Pipeline file has not been finalized")
return null!==(t=null!=e.mimeType?Yb[e.mimeType]:null)&&void 0!==t?t:100}function getFileBlockMaxHeight(e){(0,S.hu)(null!=e.externalFileId,"Pipeline file has not been finalized")
return null!=e.mimeType?Qb[e.mimeType]:void 0}const Kb=g.mM.create({stepHeader:{marginBottom:-Yl.hW},stepWrapper:{height:"100%",display:"flex",flexDirection:"column"}})
const Jb=g.mM.create({wrapper:{...Yl.xT,height:"100%"}}),Xb=[Vt.ZA,Vt.G$]
function generateBarHeight(){return Array.from({length:6},(()=>10+40*Math.random()))}function AnalysisRunningAnimation(){const[e,t]=(0,d.useState)(generateBarHeight());(0,d.useEffect)((()=>{const e=setInterval((()=>{t(generateBarHeight())}),500)
return()=>{clearInterval(e)}}))
return d.createElement("div",{className:(0,g.iv)(eT.rectanglesWrapper)},e.map(((e,t)=>d.createElement("div",{className:(0,g.iv)(eT.animatedRectangle),style:{height:e,backgroundColor:Xb[t%Xb.length]},key:t}))))}const eT=g.mM.create({rectanglesWrapper:{display:"flex",alignItems:"flex-end",height:50},animatedRectangle:{width:5,marginRight:5,transitionProperty:"height, transform",transitionDuration:"500ms",transitionTimingFunction:"ease",borderRadius:"1px 1px 0px 0px"}}),tT={title:"Your analysis is running...",subtitle:"This could take a moment to complete."}
const nT=g.mM.create({runningAnimationWrapper:{marginBottom:20},runningStepViewWrapper:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},subtitleText:{..._n.cf,color:Vt.Rl},titleText:{..._n.VM,color:Vt.Rl}})
const aT={[Fc.CHOOSE_DATASET_CREATION_METHOD]:function ChooseDataFrameCreationMethodView({analysis:e,clientStateId:t,onCloseStepInitializationView:n,onOpenStepInitializationView:a}){const i=getEnabledDatasetCreationMethods();(0,S.hu)(i.length>0,"Expected at least 1 data frame creation method to be enabled",{dataFrameCreationMethods:i});(0,S.Gp)(i.length>1,"Expected data frame creation view to be rendered directly when there's only 1 data frame creation method enabled",{dataFrameCreationMethods:i})
return d.createElement(StepConfigurationViewTemplate,{...vd,title:"How do you want to create your table?",clientStateId:t,dataFrames:[],disableFinalizeButton:!0,messages:[],noPreviewPlaceholderOptions:{title:Td,subtitle:"Select a creation method to see a preview of your table."},onCancel:n,onFinalize:Jt.ZT},d.createElement("div",{className:(0,g.iv)(Id.grid)},i.map((t=>d.createElement(DataFrameCreationMethodButton,{dataFrameCreationMethod:t,key:t,onClick:()=>{a(yd[t].initializationViewItem)
trackSelectedDataFrameCreationMethodEvent(j.D2.ANALYSIS_TOOL_CHOOSE_DATA_FRAME_CREATION_VIEW,e.id,i.length,t)}})))))},[Fc.CONNECTION_DATA_DATASET_CONFIGURATION]:function CreateDataFrameFromConnectionDataView(e){const[t,n]=_d.useGlobalClientState(e.clientStateId),[a,i]=Dd.useGlobalClientState(e.clientStateId),[s,r]=Ld.useGlobalClientState(e.clientStateId),[o,l]=kd.useGlobalClientState(e.clientStateId),clearState=()=>{n(null)
i(null)
r(xd)},c={...s,onNameChange:e=>{r({name:e,hasUserEdits:!0})},disabled:!1}
return d.createElement(StepConfigurationViewTemplate,{...vd,title:"Connection data",clientStateId:e.clientStateId,dataFrames:[],disableFinalizeButton:""===s.name||null==a,isFinalizing:o,messages:[],noPreviewPlaceholderOptions:{title:Td,subtitle:"Select a connection and file to see a preview of your table."},onCancel:(...t)=>{e.onCloseStepInitializationView(...t)
clearState()},onFinalize:async function handleAddAndRunStep(){(0,S.hu)(null!=a&&""!==s.name,"Tried to finalize with incomplete form")
l(!0)
try{const t=await jl._2(e.analysis.id,{stepType:Sn.zs.CONNECTION_DATA_DATASET,stepVersion:0,stepConfig:{dataFrameName:s.name,connectionId:a.connectionId,connectionFileId:a.id}})
e.onCloseStepInitializationView(getDefaultMainViewItemForStep(t))
clearState()}finally{l(!1)}},renderAdditionalPreviewContent:null==a?void 0:()=>d.createElement("div",{className:(0,g.iv)(Md.previewContainer)},d.createElement(wd.Z,{url:a.downloadUrl,maxRows:1e3})),toolbar:getEnabledDatasetCreationMethods().length>1&&d.createElement(ChooseDifferentDataFrameCreationMethodButton,{onOpenStepInitializationView:e.onOpenStepInitializationView})},d.createElement(ConnectionDataStepperForm,{dataFrameNameFieldProps:c,connectionId:t,onChangeConnection:e=>{n(e.id)
s.hasUserEdits||r({name:`${e.name} data`,hasUserEdits:!1})},instrumentData:a,onChangeInstrumentData:i}))},[Fc.EDIT_VISUALIZATION]:function EditVisualizationView({analysis:e,clientStateId:t,onCloseStepInitializationView:n,step:a}){const{visualizationConfig:i,visualizationName:s}=getVisualizationConfigGQLFromStep(a),r=findAndAssertSingleStepDataFrameId(a,Uc,!0),o=getAncestorLineageForDataset(e,{step:a}).map((({step:e})=>e)),l=o[0],c=getDataFrameFilterOptions(e,a,{stepId:l.id,stepDataName:Gc},r,[{stepId:a.id,stepDataName:Uc}]),[u]=Bb.useGlobalClientState(t)
return d.createElement(VisualizationStepEditor,{analysis:e,clientStateId:t,inputDataFrameId:r,handleSaveChart:async function handleSaveChart(t,i){const s=await(0,Ic.jI)((0,jl.W8)(e.id,{stepId:a.id,stepConfig:{visualizationConfig:getPersistedVisualizationConfig_getPersistedVisualizationConfig(t),visualizationName:i}}),"Updating view...")
n(getDefaultMainViewItemForStep(s))},onCancel:async()=>{const t=getAncestorFilterStep(e,a)
null!=u&&null!=t&&getFilterConfigFromStep(u).filter.filters!==getFilterConfigFromStep(t).filter.filters?await(0,jl.W8)(e.id,{stepId:u.id,stepConfig:getFilterConfigFromStep(u)}):null==u&&null!=t&&await(0,jl.W8)(e.id,{stepId:t.id,stepConfig:{filter:{operation:Jc.Yu.AND,filters:[]}}})
await(0,jm.Z)(e.id).then((()=>{n({type:Fc.VISUALIZATION,stepId:a.id})}))},filterOptions:c,viewSteps:o,initialVisualizationConfig:i,initialVisualizationName:s,isRunning:a.statusCode===Sn.wF.BLOCKED})},[Fc.EMPTY_ANALYSIS]:function EmptyAnalysisView({analysis:e,onOpenStepInitializationView:t}){const n=getEnabledDatasetCreationMethods()
return d.createElement(UIPlaceholder,{infoSection:e.permissions.writable?"Get started by adding a table to this analysis.":"This analysis doesn't have anything in it.",actionContent:e.permissions.writable||e.permissions.unarchivable?d.createElement(P.ZP,{title:0===n.length?"Feature disabled - Please contact your Benchling representative for more information":(0,yc.ZP)(e)?Yl.V$:null,disabled:n.length>0&&!(0,yc.ZP)(e)},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,text:"Add analysis table",icon:"plus-large",disabled:0===n.length||(0,yc.ZP)(e),onClick:()=>{t(getAddDataFrameAnalysisViewItem())
1===n.length&&trackSelectedDataFrameCreationMethodEvent(j.D2.ANALYSIS_TOOL_EMPTY_ANALYSIS_PAGE,e.id,n.length,n[0])}})):void 0})},[Fc.DATA_FRAME]:function DataFrameView({analysis:e,clientStateId:t,onChangeSelectedItem:n,onOpenStepInitializationView:a,selectedItem:i,step:s}){const r=i.dataFrameId,o=s.outputStepDatas.filter((({kind:e})=>e===Sn.AT.DATASET));(0,S.hu)(o.length>0,"Expected to render a step with at least 1 DATASET output step data.")
const l=1===o.length?o[0]:o.find((e=>e.dataFrames.some((({id:e})=>e===r))));(0,S.hu)(null!=l,"Expected dataFrameId to be in the given step's output when the step has multiple output step datas.");(0,S.Gp)(s.statusCode!==Sn.wF.WAITING,"Unexpected statusCode for DataFrameView.")
const c={stepId:i.stepId,stepDataName:l.name}
let u
const m=getChildStepsForDataFrame(e,s,r)
m.length>0&&(u=m.map((e=>{const t=e.inputStepDatas.filter((e=>e.dataFrames.some((e=>e.id===r))));(0,S.Gp)(t.length>0,"Unexpectedly found child step for data frame that does not accept data frame as input");(0,S.Gp)(1===t.length,"Unexpectedly found multiple step datas that accept data frame as input")
return{stepId:e.id,stepDataName:t[0].name}})))
const p=getDataFrameFilterOptions(e,s,c,r,u)
return d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>d.createElement(kl.b,null),variables:{dataFrameId:r},renderCachedDataWhenRefetching:!0},((i,r)=>d.createElement(LoadingOverlay,{message:"Filtering table",isFaded:!0,isLoading:s.statusCode===Sn.wF.RUNNING||s.statusCode===Sn.wF.READY||s.statusCode===Sn.wF.BLOCKED||r.type===Da.NI.PENDING||r.loading},d.createElement("div",{className:(0,g.iv)(Fb.wrapper),...(0,ee.Z)({component:"DataFrameView",element:"root"})},(0,ka.CZ)(i.dataFrame)?d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"You do not have access to this table."}):d.createElement(d.Fragment,null,s.statusCode===Sn.wF.FAILED&&d.createElement("div",{className:(0,g.iv)(Fb.banner)},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:`Filtering was unsuccessful. ${pb}`})),d.createElement(PresentationalPersistedDataFrameTableWrapper,{actionOrigin:cd.Z.ANALYSIS_TOOL,allowRowSelection:!0,renderIsExcludedColumn:!1,clientStateId:t,additionalOverflowOptions:getAdditionalOverflowOptions(e,s,i.dataFrame,n,a),additionalActionButtons:(0,ru.Z)("ENABLE_ANALYSIS_TOOL_TABLE_VIEW")?[createRenderAddChartViewButton(e,s.id,i.dataFrame,a)]:void 0,dataFrameNode:i.dataFrame,additionalMetadataModalGridCells:[{component:d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Created from"}),d.createElement("p",null,Mb[s.definition.stepType])),key:"Created from"},...stepToAdditionalGridCells(s)],additionalMetadataModalContent:d.createElement(AdditionalMetadataModalContent,{step:s}),filterOptions:(0,ru.Z)("ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES")?p:void 0}))))))},[Fc.FAILED]:function FailedStepView({step:{statusCode:e,statusMessage:t}}){(0,S.Gp)(e===Sn.wF.FAILED,`Expected to only use this component with ${Sn.wF.FAILED} steps`,{statusCode:e})
return d.createElement(BaseStepStatusView,null,d.createElement(pe.Z,{icon:"error",className:(0,g.iv)(Ub.icon)}),d.createElement(so.zV,null,t),d.createElement("p",null,pb))},[Fc.FILE]:function FileView({selectedItem:{fileId:e},step:t}){const n=getOutputFilesFromStep(t).find((t=>t.id===e));(0,S.hu)(null!=n,"Expected specified fileId to be present in step output datas",{fileId:e,step:t});(0,S.hu)(null!=n.externalFileId,"Pipeline file has not been finalized",{fileId:e})
return d.createElement("div",{className:(0,g.iv)(Jb.wrapper)},d.createElement(yf.ZP,{title:n.filename,toolbar:dt.ZP.FILES_ENABLE&&d.createElement(P.pf,{tooltipTitle:"Open file in new tab"},d.createElement(uc.Z,{href:de.jp(n.url),fileId:n.id},d.createElement(C.Co,{icon:"open",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI})))},d.createElement(ExternalFilePaneContent,{file:n})))},[Fc.FILE_DASHBOARD]:function FileDashboardView(e){const[t,n]=jb.useGlobalClientState(e.clientStateId),a=getOutputFilesFromStep(e.step)
a.length>25&&Fe.ZK("Expected < 25 files to render")
const i=a.filter((e=>null!=e.externalFileId));(0,S.Gp)(a.length===i.length,"One or more pipeline files has not been finalized")
const s=i.map((e=>{(0,S.hu)(null!=e.externalFileId,"Pipeline file has not been finalized")
return{key:e.id,block:d.createElement(yf.ZP,{title:e.filename,toolbar:d.createElement(ToggleExpandButton,{isExpanded:e.id===t,onChange:()=>{n(e.id===t?null:e.id)}})},d.createElement(ExternalFilePaneContent,{file:e})),minHeight:getFileBlockMinHeight(e),maxHeight:getFileBlockMaxHeight(e)}}))
return d.createElement("div",{className:(0,g.iv)(Kb.stepWrapper)},doesStepSupportHeader(e.step)&&null==t&&d.createElement("div",{className:(0,g.iv)(Kb.stepHeader)},d.createElement(StepHeaderRouter,{...e})),i.length>0?d.createElement(DashboardLayout,{blockSpecs:s,expandedBlockKey:t}):d.createElement(UIPlaceholder,{infoSection:"This step doesn't have any files."}))},[Fc.INITIALIZE_PARAMETER_OPTIMIZATION]:function InitializeParameterOptimizationStepView(e){const{analysis:t,onCloseStepInitializationView:n,step:a}=e
return d.createElement(CreateParameterOptimizationDatasetJSONView,{...e,finalizeDataFrame:MachineLearningActions_trainParameterOptimization,onCancel:n,onDataFrameFinalized:async function handleOnDatasetFinalized(){const e=await(0,jm.Z)(t.id),i=(0,Dc.ZP)(e,a.id)
n(getDefaultMainViewItemForStep(i))},readonly:!1})},[Fc.INSIGHTS_BLOCK_DATASET_CONFIGURATION]:function CreateDataFrameFromAnalyticsBlockView(e){var t
const n=function useFormState(e){const[t,n]=Lu.useGlobalClientState(e),[a,i]=ku.useGlobalClientState(e),[s,r]=Mu.useGlobalClientState(e)
return{dashboardAndBlockSelectionState:t,dataFrameNameState:a,parameterValuesState:s,setDashboardAndBlockSelectionState:n,setDataFrameNameState:i,setParameterValuesState:r,clearState:()=>{n(xu)
i(_u)
r(Du)}}}(e.clientStateId),a=useAnalyticsBlockQuery(n.dashboardAndBlockSelectionState),[i,s]=Fu.useGlobalClientState(e.clientStateId),[r,o]=Zu.useGlobalClientState(e.clientStateId),l=(0,Su.N)(n.parameterValuesState,300),c=null!==(t=null==a?void 0:a.parameterConfigs.map((e=>{var t
return getParameterValueObject(e,null!==(t=l[e.id])&&void 0!==t?t:null)})))&&void 0!==t?t:[],u=a&&function getPersistedRunQueryData({parameterConfigs:e,parameterValues:t,sqlQuery:n}){return{parameterizedSQLQuery:n,parameters:restGetQueryParameterConfigs(n,convertRESTToIdentifiedWarehouseParameters((0,zo.NA)("AnalyticsParameterConfig",e),t.map((e=>(0,Ud.L)(e)))))}}({sqlQuery:a.sqlQuery,parameterConfigs:a.parameterConfigs,parameterValues:c}),m=function getInsightsRunQueryData(e){return null==e?null:{...e,parameters:e.parameters.map((({config:e,valueJson:t})=>({config:(0,jc.Z)(e,"isMulti","systemName","type"),valueJson:t})))}}(u)
useAutoUpdatePreview(m,(function generatePreview(e,t){runWarehouseQuery(e,{status:Wr.Lr.NOT_FETCHED},t)}),(e=>{s(e)}));(0,d.useEffect)((()=>{var e
if(n.dataFrameNameState.hasUserEdits)return
const t=null!==(e=null==a?void 0:a.name)&&void 0!==e?e:""
t!==n.dataFrameNameState.name&&n.setDataFrameNameState({name:t,hasUserEdits:!1})}),[n,a])
const p={...vd,title:"Dashboard query",clientStateId:e.clientStateId,dataFrames:i.status===Wr.Lr.SUCCESS?[{...i.data.dataFrame,name:n.dataFrameNameState.name}]:[],disableFinalizeButton:i.status!==Wr.Lr.SUCCESS||null==i.data.dataFrame||""===n.dataFrameNameState.name&&n.dataFrameNameState.hasUserEdits||null!=(null==a?void 0:a.parameterConfigs)&&!areParameterValuesValid(a.parameterConfigs,c),isFinalizing:r,isLoadingPreview:i.status===Wr.Lr.LOADING,messages:getErrorAndWarningMessages(i),noPreviewPlaceholderOptions:{title:Td,subtitle:"Select a dashboard and block to see a preview of your table."},onCancel:(...t)=>{e.onCloseStepInitializationView(...t)
n.clearState()},onFinalize:async function finalize(){(0,S.hu)(null!=u,"Expected query to be defined.");(0,S.hu)(null!=n.dashboardAndBlockSelectionState.analyticsDashboardId,"Expected dashboard to be defined.");(0,S.hu)(null!=n.dashboardAndBlockSelectionState.analyticsQueryId,"Expected block to be defined.")
try{o(!0)
const t=await(0,jl._2)(e.analysis.id,{stepType:Sn.zs.INITIALIZE_DATASET,stepVersion:2,stepConfig:{dataFrameName:n.dataFrameNameState.name,dashboardId:n.dashboardAndBlockSelectionState.analyticsDashboardId,blockId:n.dashboardAndBlockSelectionState.analyticsQueryId,parameters:u.parameters,parameterizedSQLQuery:u.parameterizedSQLQuery}})
e.onCloseStepInitializationView(getDefaultMainViewItemForStep(t))
n.clearState()}finally{o(!1)}},finalizeButtonText:vd.finalizeButtonText,toolbar:getEnabledDatasetCreationMethods().length>1&&d.createElement(ChooseDifferentDataFrameCreationMethodButton,{onOpenStepInitializationView:e.onOpenStepInitializationView})},h={selectionState:n.dashboardAndBlockSelectionState,onSelect:n.setDashboardAndBlockSelectionState,readOnly:!1},g={...n.dataFrameNameState,onNameChange:e=>{n.setDataFrameNameState({name:e,hasUserEdits:!0})},disabled:!1},E=null!=(null==a?void 0:a.parameterConfigs)&&a.parameterConfigs.length>0?{...makeSharedParameterValueFieldListProps(n),configs:a.parameterConfigs,disabled:!1}:null
return d.createElement(CreateDataFrameFromAnalyticsBlockViewSkeleton,{stepConfigurationViewTemplateProps:p,dashboardAndBlockSelectorFormGroupProps:h,dataFrameNameFieldProps:g,parameterValueFieldListProps:E})},[Fc.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION_DASHBOARD]:function QueryingParameterOptimizationDatasetConfigurationDashboardView(e){const{step:t}=e
return d.createElement(Da.ZP,{query:zf,renderLoading:()=>d.createElement(kl.b,null),variables:{featureDataId:findAndAssertSingleStepDataFrameId(t,"Feature data"),featureDescriptionsId:findAndAssertSingleStepDataFrameId(t,"Feature descriptions"),labelDataId:findAndAssertSingleStepDataFrameId(t,"Label data"),labelDescriptionsId:findAndAssertSingleStepDataFrameId(t,"Label description")}},(t=>{if((0,ka.CZ)(t.featureData)||(0,ka.CZ)(t.featureDescriptions)||(0,ka.CZ)(t.labelData)||(0,ka.CZ)(t.labelDescriptions)){(0,S.Gp)(!1,"Got inaccessible dataframe with an analysis",{featureData:(0,ka.CZ)(t.featureData)?t.featureData.invalidId:t.featureData.id,featureDescriptionsId:(0,ka.CZ)(t.featureDescriptions)?t.featureDescriptions.invalidId:t.featureDescriptions.id,labelDataId:(0,ka.CZ)(t.labelData)?t.labelData.invalidId:t.labelData.id,labelDescriptions:(0,ka.CZ)(t.labelDescriptions)?t.labelDescriptions.invalidId:t.labelDescriptions.id})
return d.createElement(Ff.Z,null,"You do not have access to the datasets for this dashboard.")}return d.createElement(ParameterOptimizationDatasetConfigurationDashboardView,{...e,data:{featureData:t.featureData.dataFrameJson,featureDescriptions:t.featureDescriptions.dataFrameJson,labelData:t.labelData.dataFrameJson,labelDescriptions:t.labelDescriptions.dataFrameJson}})}))},[Fc.PARAMETER_OPTIMIZATION_MODELING_DASHBOARD]:function QueryingParameterOptimizationModelingDashboardView(e){const{step:t}=e
return d.createElement(Da.ZP,{query:kS,renderLoading:()=>d.createElement(kl.b,null),variables:{allDataId:findAndAssertSingleStepDataFrameId(t,Pf,!1),featureImportanceId:findAndAssertSingleStepDataFrameId(t,"Feature importance",!1),modelEvaluationId:findAndAssertSingleStepDataFrameId(t,"Model evaluation",!1),searchRankingsId:findAndAssertSingleStepDataFrameId(t,"Search rankings",!1),shapValuesId:findAndAssertSingleStepDataFrameId(t,"SHAP values",!1)}},(t=>{if((0,ka.CZ)(t.allData)||(0,ka.CZ)(t.featureImportance)||(0,ka.CZ)(t.modelEvaluation)||(0,ka.CZ)(t.searchRankings)||(0,ka.CZ)(t.shapValues)){(0,S.Gp)(!1,"Got inaccessible dataframe within an analysis",{allDataId:(0,ka.CZ)(t.allData)?t.allData.invalidId:t.allData.id,featureImportanceId:(0,ka.CZ)(t.featureImportance)?t.featureImportance.invalidId:t.featureImportance.id,modelEvaluationId:(0,ka.CZ)(t.modelEvaluation)?t.modelEvaluation.invalidId:t.modelEvaluation.id,searchRankingsId:(0,ka.CZ)(t.searchRankings)?t.searchRankings.invalidId:t.searchRankings.id,shapValuesId:(0,ka.CZ)(t.shapValues)?t.shapValues.invalidId:t.shapValues.id})
return d.createElement(Ff.Z,null,"You do not have access to the datasets for this dashboard.")}return d.createElement(ParameterOptimizationModelingDashboardView,{...e,data:{allData:t.allData.dataFrameJson,featureImportance:t.featureImportance.dataFrameJson,modelEvaluation:t.modelEvaluation.dataFrameJson,searchRankings:t.searchRankings.dataFrameJson,shapValues:t.shapValues.dataFrameJson}})}))},[Fc.PARAMETER_OPTIMIZATION_MODELING_OVERVIEW]:function ParameterOptimizationModelingOverviewView(e){return d.createElement("div",{className:(0,g.iv)(BS.wrapper)},d.createElement(so.zV,null,"Using this analysis"),d.createElement("p",null,"We have built a machine learning model that analyzes how your experimental inputs affect your experimental outcome. Use the dashboard to learn more about the effects of these inputs on the outcome, and use the interactive prediction to simulate the results of different experimental inputs."),d.createElement(so.zV,null,"Understanding your dashboard"),d.createElement("p",null,"The dashboard helps you assess your model’s quality through model metrics and a ranking of parameter importance. Use the dashboard to evaluate how the model results compare to your own assumptions about your experiments. If the model gives unexpected or poor results, you may need to rerun the analysis with more data or use different parameters."),d.createElement(so.zV,null,"Making predictions"),d.createElement("p",null,"You can predict an experimental output on the Predictions page after entering new parameter values. Certain parameters will not be displayed. Some possible reasons include:"),d.createElement("ol",null,d.createElement("li",null,d.createElement("code",null,"id")," columns used for joins are excluded."),d.createElement("li",null,"The model may remove inputs if it learns that they do not have predictive power.")),d.createElement(so.zV,null,"Terminology"),d.createElement("ol",null,d.createElement("li",null,d.createElement("b",null,"Parameter:")," A parameter represents a variable in your experiment which can have an impact on the output. We recommend using parameters that map to an experimental input that you have control over."),d.createElement("li",null,d.createElement("b",null,"Output:")," The output is the dependent variable being optimized, and the value that is predicted by the model. Some possible examples could be yield, titer, or assay result."),d.createElement("li",null,d.createElement("b",null,"Parameter contribution:")," The parameter contribution measures how much the parameter’s value affects the output. We calculate this with"," ",d.createElement("a",{href:"https://medium.com/dataman-in-ai/explain-your-model-with-the-shap-values-bc36aac4de3d"},"SHAP values")," ","because they are agnostic to the type of machine learning model that best fits your data."),d.createElement("li",null,d.createElement("b",null,"Training & testing:"),' As part of model-building, we randomly split the data 80:20 between training data and testing data. Training data "teaches" the ML algorithms the patterns found in the data while testing data is used to validate the model performance.')),d.createElement(so.zV,null,"Can I provide feedback?"),d.createElement("p",null,"The Benchling Machine Learning team would love your feedback! Feel free to email our Product Manager at helen.liumayo@benchling.com with any feedback or requests."))},[Fc.PARAMETER_OPTIMIZATION_PREDICTION]:function QueryingParameterOptimizationPredictionStepView({step:e,...t}){return d.createElement(Da.ZP,{query:oy,renderLoading:()=>d.createElement(kl.b,null),variables:{allDataDataFrameId:findAndAssertSingleStepDataFrameId(e,Pf,!0),predictionDefaultsDataFrameId:findAndAssertSingleStepDataFrameId(e,"Predictions default values",!1),predictionsGridDataFrameId:findAndAssertSingleStepDataFrameId(e,"Predictions grid",!1)}},(n=>{if((0,ka.CZ)(n.allDataDataFrame)||(0,ka.CZ)(n.predictionDefaultsDataFrame)||(0,ka.CZ)(n.predictionsGridDataFrame)){(0,S.Gp)(!1,"Got inaccessible dataframe within an analysis")
return d.createElement(Ff.Z,null,"You do not have access to the datasets for this analysis.")}const a=function getPredictionParametersFromDataFrames(e,t){return(0,Pm.Z)(e).map((n=>{const{accessor:a,validatedLeafType:i}=(0,Lm.$0)(t,n.systemName)
return{displayName:n.displayName,systemName:n.systemName,valueInput:(0,Hd.xk)(i)?{isDropdown:!1,value:numericAccessor(a,i)(e.rows[0]),min:Math.min(...t.rows.map((e=>numericAccessor(a,i)(e)))),max:Math.max(...t.rows.map((e=>numericAccessor(a,i)(e))))}:{isDropdown:!0,value:stringListAccessor(a)(e.rows[0])[0],options:stringListAccessor(a)(e.rows[0])}}}))}(n.predictionDefaultsDataFrame.dataFrameJson,n.predictionsGridDataFrame.dataFrameJson)
return d.createElement(ParameterOptimizationPredictionStepView,{...t,allData:n.allDataDataFrame.dataFrameJson,step:e,parameters:a,predictionDefaults:n.predictionDefaultsDataFrame.dataFrameJson,predictionsGrid:n.predictionsGridDataFrame.dataFrameJson})}))},[Fc.REGISTRY_SCHEMA_DATASET_CONFIGURATION]:function RegistrySchemasDataFrameCreationView({analysis:e,clientStateId:t,onOpenStepInitializationView:n,onCloseStepInitializationView:a}){var i,s
const[r,o]=Tm.useGlobalClientState(t),[l,c]=Cm.useGlobalClientState(t),[u,m]=Im.useGlobalClientState(t),[p,h]=wm.useGlobalClientState(t),g=useQueryApiIntrospection(),E=(0,d.useMemo)((()=>function buildQueryApiQueryAst(e){if(null==e.entityListingFieldName)return null
if(e.entityFieldSelections.selections.length+(0,de.Sm)(e.relatedResultsFormStates.map((e=>e.backlinkSelections.selections.length)))===0)return null
const t=e.relatedResultsFormStates
return{kind:Zl.h.DOCUMENT,definitions:[{kind:Zl.h.OPERATION_DEFINITION,operation:Uu.ku.QUERY,selectionSet:{kind:Zl.h.SELECTION_SET,selections:[{kind:Zl.h.FIELD,name:buildNameNode(e.entityListingFieldName),arguments:e.entityFilterArguments.length>0?e.entityFilterArguments:void 0,selectionSet:{kind:Zl.h.SELECTION_SET,selections:[...e.entityFieldSelections.selections,...getCompletedRelatedResultsFormStates(t).map((e=>({kind:Zl.h.FIELD,name:buildNameNode(e.backlinkFieldName),selectionSet:e.backlinkSelections,arguments:[{kind:Zl.h.ARGUMENT,name:buildNameNode("joinKey"),value:{kind:Zl.h.STRING,value:e.joinKeyFieldName}},...e.onlyIncludeLatestItem?Gu:[]]})))]}}]}}]}}(l)),[l]),f=useThrottle(E,1e3),y=g.status===Da.NI.SUCCESS&&null!=E&&0===g.getQueryAstValidationErrors(E).length&&null!=l.entityListingFieldName&&""!==r.name
useAutoUpdatePreview(null==f?null:{queryAst:f},((e,t)=>{(0,S.hu)(g.status===Da.NI.SUCCESS,"Tried to generate a preview before introspection finished")
const n=g.getQueryAstValidationErrors(e.queryAst)
n.length>0&&Fe.ZK("Tried to preview an invalid query",{extra:{query:(0,Bu.S)(e.queryAst),errors:n.map((e=>e.message))}})
return(0,Wr.cC)({args:[e],asyncState:u,makeCall:({queryAst:e})=>async function generateDatasetPreview(e){return await an.s0({url:"/1/api/query-api-preview-async",data:{query:e}})}((0,Bu.S)(e)),setAsyncState:t})}),m)
function handleClearState(){o(bm)
c(vm)
m(Wr.Tp)}const b=(0,d.useCallback)((e=>{(null==e.entityListingFieldName?0:countSelectedFields(e.entityFieldSelections.selections)+(0,de.Sm)(e.relatedResultsFormStates.map((e=>countSelectedFields(e.backlinkSelections.selections)))))>100?v.ZP.error("Only 100 column selections are allowed.",{duration:4}):c(e)}),[c]),T=null!==(s=null===(i=(0,Wr.yf)(u))||void 0===i?void 0:i.dataFrame)&&void 0!==s?s:null
return d.createElement(StepConfigurationViewTemplate,{...vd,clientStateId:t,dataFrames:null==T?[]:[{...T,name:r.name}],disableFinalizeButton:!y,isFinalizing:p,isLoadingPreview:u.status===Wr.Lr.LOADING,messages:buildErrorAndWarningMessages(u),noPreviewPlaceholderOptions:{title:Td,subtitle:"Select a registry schema to see a preview of your table."},defaultDataFrameTableMode:dt.ZP.ENABLE_ANALYSIS_TOOL_API_ID_RESOLUTION?qu.c.RICH:qu.c.TEXT,onCancel:()=>{handleClearState()
a()},onFinalize:async function handleAddAndRunStep(){(0,S.hu)(null!=E&&""!==r.name,"Tried to finalize with incomplete form")
h(!0)
try{const t=await jl._2(e.id,{stepType:Sn.zs.REGISTRY_SCHEMA_DATASET,stepVersion:0,stepConfig:{dataFrameName:r.name,query:(0,Bu.S)(E),queryDescription:await formStateToHumanReadableString(l,g)}})
a(getDefaultMainViewItemForStep(t))
handleClearState()
h(!1)}catch(e){h(!1)
throw e}},title:"Registry schemas",toolbar:getEnabledDatasetCreationMethods().length>1&&d.createElement(ChooseDifferentDataFrameCreationMethodButton,{onOpenStepInitializationView:e=>{handleClearState()
n(e)}})},g.status===Da.NI.ERROR?d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"Error loading registry schemas."}):g.status===Da.NI.PENDING?d.createElement(kl.b,null):d.createElement(Sm,{queryApiIntrospection:g,queryFormState:l,setQueryFormState:b,dataFrameNameState:r,setDataFrameNameState:o}))},[Fc.RUNNING]:function RunningStepView({step:e}){(0,S.Gp)(e.statusCode===Sn.wF.RUNNING||e.statusCode===Sn.wF.READY||dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES&&e.statusCode===Sn.wF.SUCCEEDED,`Expected to only use this component with ${Sn.wF.RUNNING} or ${Sn.wF.READY} steps`)
const{title:t,subtitle:n}=function getMessages(e){if(isSidebarDatasetInitializationStepType(e.definition.stepType))return{title:"Creating Table",subtitle:"This could take several minutes."}
switch(e.definition.stepType){case Sn.zs.PARAMETER_OPTIMIZATION_MODELING:return{...tT,subtitle:"This could take up to a few hours to complete. You’ll receive an email when it’s ready."}
case Sn.zs.SAVE_TO_RESULTS:return{title:"Creating Results",subtitle:"This could take several minutes."}
default:return tT}}(e)
return d.createElement("div",{className:(0,g.iv)(nT.runningStepViewWrapper),...(0,ee.Z)({component:"RunningStepView",element:"root"})},d.createElement("div",{className:(0,g.iv)(nT.runningAnimationWrapper)},d.createElement(AnalysisRunningAnimation,null)),d.createElement("p",{className:(0,g.iv)(nT.titleText)},t),d.createElement("p",{className:(0,g.iv)(nT.subtitleText)},n))},[Fc.SAVE_TO_RESULTS_CONFIGURATION]:function SaveToResultsStepConfigurationView(e){const[t,n,a]=useDataMappingState(e.clientStateId,e.selectedItem.inputDataFrameId),addSaveToResultsStep=async(t,n)=>{!function trackAddSaveToResultsStepEvent(e,t,n){const a=(0,Pm.Z)(t).length,i=e.resultSchema.fields.length,s=e.mappings.length;(0,m.L9)(j.Sy.RESULTS_COLUMNS_MAPPED,{action_method:j.LY.BUTTON_CLICK,action_origin:j.D2.ANALYSIS_TOOL_SAVE_TO_RESULTS_CONFIGURATION_VIEW,data_frame_id:n,result_schema_id:e.resultSchema.id,num_result_columns:i,num_data_frame_columns:a,num_mappings:s})}(t,n,e.selectedItem.inputDataFrameId)
const{id:a}=await(0,jl._2)(e.analysis.id,{stepType:Sn.zs.SAVE_TO_RESULTS,stepVersion:1,stepConfig:{schemaId:t.resultSchema.id,columnMapping:t.mappings},stepInputParents:{[Wc.INPUT_DATASET]:[e.selectedItem.inputDataReference]},stepInput:{inputDataFrameId:e.selectedItem.inputDataFrameId}})
e.onCloseStepInitializationView({type:Fc.SAVE_TO_RESULTS_OUTPUT,stepId:a})},onCancel=()=>{const t=e.analysis.execution.steps.find((t=>t.outputStepDatas.some((t=>t.dataFrames.some((t=>t.id===e.selectedItem.inputDataFrameId))))));(0,S.hu)(null!=t,"Expected input data frame to be the output of a step.")
e.onCloseStepInitializationView({type:Fc.DATA_FRAME,stepId:t.id,dataFrameId:e.selectedItem.inputDataFrameId})
a()}
return d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>d.createElement(kl.b,null),variables:{dataFrameId:e.selectedItem.inputDataFrameId}},(({dataFrame:a})=>{(0,S.hu)(!(0,ka.CZ)(a),"Expected data frame to be accessible.")
return d.createElement(InternalSaveToResultsStepConfigurationView,{clientStateId:e.clientStateId,inputDataFrame:a.dataFrameJson,dataMappingState:t,setDataMappingState:n,addSaveToResultsStep:e=>addSaveToResultsStep(e,a.dataFrameJson),onCancel})}))},[Fc.SAVE_TO_RESULTS_OUTPUT]:function SaveToResultsStepOutputView({analysis:e,step:t,clientStateId:n,onOpenStepInitializationView:a}){const openReconfigurationView=()=>{a({type:Fc.SAVE_TO_RESULTS_RECONFIGURATION,stepId:t.id})}
return d.createElement("div",{className:(0,g.iv)(Wm.container),...(0,ee.Z)({component:"SaveToResultsStepOutputView",element:"root"})},function getContents(){switch(t.statusCode){case Sn.wF.FAILED:(0,S.hu)(null!=t.statusMessage,"Expected statusMessage to be defined for FAILED step.")
return d.createElement(RetryFailedSaveToResultsStepBanner,{openReconfigurationView:e.permissions.writable?openReconfigurationView:void 0,text:t.statusMessage})
case Sn.wF.SUCCEEDED:return d.createElement(SucceededDataMappingResult,{analysis:e,step:t,clientStateId:n,openReconfigurationView})
default:throw new Error(`Unexpected step status for SAVE_TO_RESULTS: ${t.statusCode}`)}}())},[Fc.SAVE_TO_RESULTS_RECONFIGURATION]:function SaveToResultsStepReconfigurationView(e){(0,S.hu)(null!=e.step.config,"Expected step config to exist.")
const{columnMapping:t,schemaId:n}=getPipelineStepConfig(e.step,Sn.zs.SAVE_TO_RESULTS,1)
return d.createElement(Da.ZP,{query:Hm,renderLoading:()=>d.createElement(kl.b,null),variables:{schemaId:n}},(({resultSchema:n})=>{(0,S.hu)(null!=n,"Querying for result schema unexpectedly failed.");(0,S.hu)(!(0,ka.CZ)(n),"Expected result schema to be accessible.")
const a={resultSchema:(0,zo.tY)("ResultSchema",n),mappings:t}
return d.createElement(InternalSaveToResultsStepReconfigurationView,{...e,defaultDataMappingState:a})}))},[Fc.THIRD_PARTY_STEP]:function ThirdPartyStepView(e){return d.createElement(ThirdPartyStepHeader,{analysis:e.analysis,clientStateId:e.clientStateId,step:e.step})},[Fc.VIEW_PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION]:function ReadOnlyParameterOptimizationDatasetView({step:e}){var t;(0,S.hu)(null!=e.config,"Parameter optimization modeling step unexpectedly does not have a persisted config")
const n=null===(t=e.config.variables.find((e=>"dataDefinitionConfig"===e.name)))||void 0===t?void 0:t.value
return d.createElement(d.Fragment,null,null!=n?d.createElement(Ym.ZP,{mode:"json",theme:"github",enableBasicAutocompletion:!0,value:JSON.stringify(n,null,"\t"),readOnly:!0}):d.createElement("div",null,"We currently only support showing configs for steps configured through the JSON view."))},[Fc.VISUALIZATION]:function VisualizationView({clientStateId:e,analysis:t,onChangeSelectedItem:n,step:a}){const{visualizationConfig:i,visualizationName:s}=getVisualizationConfigGQLFromStep(a),r=ed.kI[i.parameters.__typename],o=getAncestorLineageForDataset(t,{step:a}),l=o[0].step,c=findAndAssertSingleStepDataFrameId(a,Uc,!0),u=!t.permissions.writable&&!t.permissions.unarchivable,m=getInheritedDatasetFilterOptions(t,l)
async function handleSaveChartName(e){e!==s&&await(0,Ic.jI)((0,jl.W8)(t.id,{stepId:a.id,stepConfig:{visualizationConfig:getPersistedVisualizationConfig_getPersistedVisualizationConfig(i),visualizationName:e}}),"Updating view...")}const p=d.createElement(d.Fragment,null,!u&&d.createElement(P.ZP,{title:(0,yc.ZP)(t)?Yl.V$:"Edit view"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"edit",disabled:(0,yc.ZP)(t),onClick:()=>{const i=getAncestorFilterStep(t,a)
null!=i&&Bb.updateState(e,i)
n({type:Fc.EDIT_VISUALIZATION,stepId:a.id})},size:C.qE.MINI})),!u&&d.createElement(Cc.Z,{menuProps:{dropLeft:!0},options:[{contents:d.createElement("span",null,"Delete view"),onSelect:()=>{(0,Zb.Z)({typeName:"view"}).then((e=>{if(e)return(0,Ic.jI)((0,jl.UF)(t.id,{stepIds:getAncestorLineageForDataset(t,{step:a}).map((e=>e.step.id))}))}))},isDisabled:(0,yc.ZP)(t),tooltipTitle:(0,yc.ZP)(t)?Yl.V$:""}]}))
return d.createElement("div",{className:(0,g.iv)(qb.wrapper,ed.ml[r]&&qb.fullHeight)},[Sn.wF.SUCCEEDED,Sn.wF.FAILED].includes(a.statusCode)?d.createElement(Da.ZP,{query:Rm.Oh,renderLoading:()=>d.createElement(kl.b,null),variables:{dataFrameId:c}},(n=>{(0,S.hu)(!(0,ka.CZ)(n.dataFrame),"User does not have access to step input")
const r=n.dataFrame.dataFrameJson,u=getDataFrameFilterOptions(t,a,{stepId:l.id,stepDataName:Gc},c,[{stepId:a.id,stepDataName:Uc}]),h=r.columns.some((({systemName:e})=>null!=(null==u?void 0:u.getFilterForColumn(e))))?d.createElement(uy.Z,{dataFrameSpec:r,filterOptions:u,parentFilterOptions:m}):null
return d.createElement(PresentationalUniversalBlockView,{actionOrigin:cd.Z.ANALYSIS_TOOL,errorMessage:getDatasetViewErrorMessage(o.map((({step:e})=>e))),inputDataFrame:n.dataFrame.dataFrameJson,viewStateId:e,visualizationConfig:i,maxRows:1e3,paneProps:{title:s,onChangeTitle:t.permissions.writable?handleSaveChartName:void 0,toolbar:p,banner:h}})})):d.createElement(kl.b,null))},[Fc.VISUALIZATION_CONFIGURATION_FOR_DATASET_VIEW]:function CreateVisualizationView({analysis:e,clientStateId:t,onCloseStepInitializationView:n,step:a,selectedItem:i}){var s,r
const o=getChildLineageForDataset(e,{step:a,dataFrame:a.outputStepDatas[0].dataFrames[0]}).map((({step:e})=>e)),l=o[o.length-1],c=findAndAssertSingleStepDataFrameId(o.findLast((e=>e.statusCode===Sn.wF.SUCCEEDED)),Gc),u=getDataFrameFilterOptions(e,l,{stepId:l.id,stepDataName:Gc},c)
return d.createElement(VisualizationStepEditor,{analysis:e,clientStateId:t,inputDataFrameId:c,handleSaveChart:async function handleSaveChart(t,a){const i=await(0,Ic.jI)((0,jl._2)(e.id,{stepType:Sn.zs.VISUALIZATION,stepVersion:0,stepConfig:{visualizationConfig:getPersistedVisualizationConfig_getPersistedVisualizationConfig(t),visualizationName:a},stepInputParents:{[Uc]:[{stepId:l.id,stepDataName:Gc}]},stepInput:{inputDataFrameId:c}}),"Saving view...")
n(getDefaultMainViewItemForStep(i))},filterOptions:u,onCancel:()=>{(0,Ic.jI)((0,jl.UF)(e.id,{stepIds:o.map((e=>e.id))}))
n(function getViewItemForSourceDataset(){const t=getParentSteps(e,o[0]);(0,S.hu)(1===t.length,"Unexpected view with multiple parents")
const n=t[0].id,a=findAndAssertSingleStepDataFrameId(o[0],Uc,!0)
return{type:Fc.DATA_FRAME,dataFrameId:a,stepId:n}}())},isRunning:l.statusCode===Sn.wF.READY||l.statusCode===Sn.wF.RUNNING||l.statusCode===Sn.wF.BLOCKED,viewSteps:o,initialVisualizationConfig:null===(s=i.initialStepConfig)||void 0===s?void 0:s.visualizationConfig,initialVisualizationName:null===(r=i.initialStepConfig)||void 0===r?void 0:r.visualizationName})}}
function AnalysisUIMainViewRouter({analysis:e,clientStateId:t,selectedItem:n,...a}){const i=function getClientStateIdForMainView(e,t){return isStepAwareAnalysisItem(t)?`${e}-${t.stepId}`:e}(t,n)
if(isStepAwareAnalysisItem(n)){const t=aT[n.type]
return d.createElement(t,{...a,analysis:e,clientStateId:i,selectedItem:n,step:(0,Dc.ZP)(e,n.stepId)})}{const t=aT[n.type]
return d.createElement(t,{...a,analysis:e,clientStateId:i,selectedItem:n})}}function ThirdPartyImportExportModal({analysis:e,...t}){return d.createElement(et.ZP,{title:"Connect with external tool",...t,buttons:[{submit:!0,text:"Close"}]},d.createElement("div",{className:(0,g.iv)(iT.modalText)},"Send or receive data from an external analytics tool. Depending on your connection, you may need an Analysis key."),d.createElement(CopyAnalysisKeyButton,{analysisId:e.id,disabled:(0,yc.ZP)(e)}))}const iT=g.mM.create({modalText:{..._n.cf,marginBottom:11}}),sT={[Sn.zs.THIRD_PARTY]:"Send or receive data from external analytics tool"},rT={[Sn.zs.THIRD_PARTY]:{stepType:Sn.zs.THIRD_PARTY,stepVersion:0}}
function AnalysisAddStepButton({disabled:e,onAddStep:t}){return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FIT_CONTENT},xc.map((e=>d.createElement(N.Z,{key:e,metadata:sT[e],onSelect:()=>{t(rT[e])},value:e},py.ni[e]))))},d.createElement(vy.Z,{disabled:e}))}function SidebarItem(e){return d.createElement("div",{className:(0,g.iv)(oT.wrapper,e.isSelected&&oT.selectedSidebarItem),onClick:e.onSelect,...(0,ee.Z)({component:"SidebarItem",element:"root"})},d.createElement("div",{className:(0,g.iv)(oT.leftWrapper)},d.createElement(pe.Z,{className:(0,g.iv)(oT.sidebarItemIcon,e.isSelected&&oT.selectedSidebarItemIcon),icon:e.icon}),e.text),e.configIcon)}const oT=g.mM.create({wrapper:{..._n.XI,fontWeight:_n.hS,marginTop:3,padding:"7px 9px 7px 9px",borderRadius:2,cursor:"pointer",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",":hover":{backgroundColor:Vt.ip}},leftWrapper:{display:"flex",flexDirection:"row",alignItems:"flex-start"},sidebarItemIcon:{color:Vt.TG,flexShrink:0,marginRight:8,marginTop:3},selectedSidebarItem:{backgroundColor:Vt.ip,fontWeight:_n.KB},selectedSidebarItemIcon:{color:Vt.pp}})
function StepConfigIcon(e){return d.createElement(P.ZP,{title:e.tooltipTitle,placement:e.tooltipPlacement},d.createElement(yh.Z,{className:(0,g.iv)(lT.stepConfigIcon),onClick:t=>{t.stopPropagation()
e.onOpenStepConfig()}}))}function StepName({stepName:e,stepStatusCode:t,configIcon:n}){const a=t===Sn.wF.BLOCKED,i=d.createElement("div",{className:(0,g.iv)(lT.stepName,a&&lT.blockedStepStatus)},e,n)
return a?d.createElement(P.ZP,{title:"This step is awaiting an output from a previous step",placement:P.TQ.RIGHT},i):i}function SidebarStepSection({selectedItemState:e,step:t,stepName:n,stepConfigIconProps:a}){const i=(0,d.useMemo)((()=>getStepSidebarItemDatas(t)),[t]),s=a.showOpenStepConfig?d.createElement(StepConfigIcon,{onOpenStepConfig:a.onOpenStepConfig,tooltipPlacement:P.TQ.TOP,tooltipTitle:a.stepConfigTooltipTitle}):void 0
return d.createElement("div",{key:t.id,className:(0,g.iv)(lT.wrapper)},n&&d.createElement(StepName,{stepName:n,stepStatusCode:t.statusCode,configIcon:s}),d.createElement(d.Fragment,null,i.map((({icon:t,text:a,mainViewItem:i},r)=>d.createElement(SidebarItem,{icon:t,isSelected:Is()(e.selectedItem,i),key:r,onSelect:()=>{e.onChangeSelectedItem(i)},text:a,configIcon:null==n&&0===r?s:void 0})))))}const lT=g.mM.create({wrapper:{marginTop:8},stepName:{..._n.XI,color:Vt.Rl,display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:9},blockedStepStatus:{color:Vt.TG},stepConfigIcon:{flexShrink:0,marginRight:2,display:"flex",alignItems:"center"}}),cT={[Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION]:"Setup",[Sn.zs.PARAMETER_OPTIMIZATION_MODELING]:"Results",[Sn.zs.PARAMETER_OPTIMIZATION_PREDICTION]:"Predictions"}
function SidebarSection({headerButton:e,selectedItemState:t,showStepNames:n,steps:a,title:i,toggleSidebar:s}){function getStepConfigIconProps(e){if(null==e.config||!function isViewStepConfigEnabledForPipelineStepDefinition(e){return e.stepType!==Sn.zs.SAVE_TO_RESULTS&&null!=qc[e.stepType]}(e.definition))return{showOpenStepConfig:!1}
const n={type:qc[e.definition.stepType],stepId:e.id}
return{showOpenStepConfig:!0,onOpenStepConfig:()=>{t.onChangeSelectedItem(n);(function shouldToggleSidebarWhenViewingStepConfig(e){return e!==Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION})(e.definition.stepType)&&s()},stepConfigTooltipTitle:"View table configuration"}}return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(dT.sectionHeader),...(0,ee.Z)({component:"SidebarSection",element:"header"})},d.createElement("div",{className:(0,g.iv)(dT.sectionTitle)},i),e),n?a.map((e=>{var n
return d.createElement(SidebarStepSection,{key:e.id,selectedItemState:t,step:e,stepName:null!==(n=cT[e.definition.stepType])&&void 0!==n?n:py.ni[e.definition.stepType],stepConfigIconProps:getStepConfigIconProps(e)})})):a.map((e=>d.createElement(SidebarStepSection,{key:e.id,selectedItemState:t,step:e,stepConfigIconProps:getStepConfigIconProps(e)}))))}const dT=g.mM.create({sectionHeader:{display:"flex",flexDirection:"row",alignItems:"center"},sectionTitle:{..._n.sE,textTransform:"uppercase",color:Vt.pp,letterSpacing:1}})
var uT=n(723635)
function AddViewButton({onClick:e,disabledReason:t}){const n=null!=t,[a,i]=(0,uT.Z)()
return d.createElement(Zo.Z,{text:t,isDisabled:!n},d.createElement("div",{className:(0,g.iv)(mT.wrapper,n?mT.disabledWrapper:mT.enabledWrapper),onClick:()=>{n||e()},...i},d.createElement(vy.Z,{className:(0,g.iv)(mT.icon,a&&!n&&mT.hoveredEnabledIcon,n&&mT.disabledIcon),disabled:n}),d.createElement("span",{className:"u-mini-spacing-left"},"New view")))}const mT=g.mM.create({wrapper:{..._n.cf,display:"flex",alignItems:"center"},enabledWrapper:{color:Vt.pp,":hover":{fontWeight:"bold",color:Vt.Rl},cursor:"pointer"},disabledWrapper:{color:Vt.TG,cursor:"not-allowed"},icon:{color:Vt.t0,padding:2},disabledIcon:{color:Vt.TG},hoveredEnabledIcon:{borderRadius:4,background:Vt.bs}})
var pT=n(563327)
function isBenchlingDuotoneIconName(e){return(0,Ab.m0)(e)||(0,pT.P$)(e)&&(0,Ab.m0)((0,pT.I1)(e))}function BenchlingDuotoneIcon({icon:e,primaryColor:t,secondaryColor:n,onClick:a,spin:i,altText:s}){if(isBenchlingDuotoneIconName(e))return d.createElement(Ab.l7,{icon:(0,pT.P$)(e)?(0,pT.I1)(e):e,primaryColor:t,secondaryColor:n,onClick:a,spin:i,altText:s})
Fe.ZK(`Icon '${e}' missing. Using notdef by default.`)
return d.createElement(Ab.JO,{icon:"notdef"})}function SidebarItem_SidebarItem(e){var t
return d.createElement(P.pf,{tooltipPlacement:P.TQ.AUTO,tooltipTitle:null!==(t=e.tooltipText)&&void 0!==t?t:null},d.createElement("div",{className:(0,g.iv)(hT.wrapper,e.isSelected&&hT.selectedSidebarItem,!0===e.disabled&&hT.disabledSidebarItem),onClick:()=>{e.disabled||e.onSelect()},...(0,ee.Z)({component:"SidebarItem",element:"root"})},d.createElement("div",{className:(0,g.iv)(hT.leftWrapper)},d.createElement("div",{className:(0,g.iv)(hT.iconWrapper)},e.isSelected&&isBenchlingDuotoneIconName(e.icon)?d.createElement(BenchlingDuotoneIcon,{icon:e.icon,primaryColor:Vt.Ej,secondaryColor:Vt.mu,spin:e.icon===rd}):d.createElement(pe.Z,{icon:e.icon,className:f()(e.icon===rd&&"fa-spin",(0,g.iv)(e.icon===sd.icon?hT.errorIcon:e.isSelected?hT.selectedMonotoneIcon:hT.unselectedIcon))})),e.text)))}const hT=g.mM.create({wrapper:{..._n.cf,fontWeight:_n.hS,marginTop:3,padding:"7px 9px 7px 9px",borderRadius:2,cursor:"pointer",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",":hover":{backgroundColor:Vt.ip}},leftWrapper:{display:"flex",flexDirection:"row",alignItems:"flex-start"},iconWrapper:{flexShrink:0,marginRight:8},selectedSidebarItem:{backgroundColor:Vt.ip,fontWeight:_n.KB},selectedMonotoneIcon:{color:Vt.Ej},unselectedIcon:{color:Vt.TG},errorIcon:{color:Vt.Zl},disabledSidebarItem:{color:Vt.TG,cursor:"default"}})
function SidebarSectionItems({analysis:e,sidebarItemDatas:t,selectedItemState:n,tier:a=0,onOpenStepInitializationView:i}){return d.createElement(d.Fragment,null,t.map((({icon:t,text:s,mainViewItem:r,childSidebarItems:o=[],actionButtonOptions:l,disabled:c,tooltipText:u},p)=>d.createElement("div",{key:`${a}-${p}`},d.createElement(SidebarItem_SidebarItem,{icon:t,isSelected:Is()(n.selectedItem,r)||isViewStepConfigAnalysisItem(n.selectedItem)&&isStepAwareAnalysisItem(r)&&n.selectedItem.stepId===r.stepId,onSelect:()=>{(0,m.L9)(j.Sy.SELECTED_SIDEBAR_ITEM,{previousItem:n.selectedItem,newItem:r})
n.onChangeSelectedItem(r)},text:s,disabled:c,tooltipText:u}),o.length>0&&d.createElement("div",{className:(0,g.iv)(gT.childSidebarItemsWrapper)},d.createElement(SidebarSectionItems,{analysis:e,sidebarItemDatas:o,selectedItemState:n,tier:a+1,onOpenStepInitializationView:i})),l&&(e.permissions.writable||e.permissions.unarchivable)&&d.createElement("div",{className:(0,g.iv)(gT.childSidebarItemsWrapper,gT.addViewButtonWrapper)},(0,ru.Z)("ENABLE_ANALYSIS_TOOL_TABLE_VIEW")?d.createElement(AddChartViewPopover,{analysis:e,stepId:l.stepDataReference.stepId,dataFrameId:l.dataFrameId,onOpenStepInitializationView:i},(t=>d.createElement(AddViewButton,{disabledReason:isAnalysisRunning(e)?"Analysis is running":(0,yc.ZP)(e)&&e.permissions.unarchivable?Yl.V$:null,onClick:t}))):d.createElement(AddViewButton,{disabledReason:isAnalysisRunning(e)?"Analysis is running":(0,yc.ZP)(e)&&e.permissions.unarchivable?Yl.V$:null,onClick:()=>{createViewAndOpenCreateVisualizationView(e,l.dataFrameId,l.stepDataReference,i)}}))))))}function SidebarSection_SidebarSection({headerButton:e,title:t,...n}){return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(gT.sectionHeader),...(0,ee.Z)({component:"SidebarSection",element:"header"})},d.createElement("div",{className:(0,g.iv)(gT.sectionTitle)},t),e),d.createElement(SidebarSectionItems,{...n}))}const gT=g.mM.create({sectionHeader:{display:"flex",flexDirection:"row",alignItems:"center"},sectionTitle:{..._n.sE,textTransform:"uppercase",color:Vt.pp,letterSpacing:1},childSidebarItemsWrapper:{marginLeft:20},addViewButtonWrapper:{marginTop:8,marginBottom:12,paddingLeft:7}})
function ArchivedButtonWrapper({analysis:e,children:t}){const n=d.createElement(P.ZP,{title:Yl.V$},d.createElement(vy.Z,{disabled:!0}))
return(0,yc.ZP)(e)&&e.permissions.unarchivable?n:d.createElement(d.Fragment,null,t)}function LegacyAnalysisUISidebarContent({analysis:e,onCloseSidebar:t,onOpenStepInitializationView:n,selectedItemState:a}){const i=getInitializeDatasetSteps(e),s=function getNonInitializeDatasetSteps(e){return e.execution.steps.filter((e=>!isSidebarDatasetInitializationStepType(e.definition.stepType)))}(e),r=getEnabledDatasetCreationMethods(),o=e.execution.steps.some((e=>e.definition.stepType===Sn.zs.THIRD_PARTY)),l=e.execution.steps.some((e=>e.definition.stepType===Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION)),c=e.execution.steps.some((e=>e.definition.stepType===Sn.zs.SAVE_TO_RESULTS)),u=isAnalysisRunning(e),m=!(u||o||l||c),p=!u&&!o&&!l&&r.length>0
return d.createElement("div",{className:(0,g.iv)(ET.legacyContentWrapper)},d.createElement(SidebarSection,{headerButton:d.createElement(ArchivedButtonWrapper,{analysis:e},e.permissions.writable?d.createElement(P.ZP,{disabled:!p,title:"Add table"},d.createElement(vy.Z,{disabled:!p,onClick:function handleAddDataset(){n(getAddDataFrameAnalysisViewItem())
1===r.length&&trackSelectedDataFrameCreationMethodEvent(Sn.D2.ANALYSIS_TOOL_ANALYSIS_PAGE_DATA_FRAME_SIDEPANEL,e.id,r.length,r[0])}})):null),selectedItemState:a,showStepNames:!1,steps:i,title:"Analysis tables",toggleSidebar:t}),d.createElement("hr",null),d.createElement(SidebarSection,{headerButton:d.createElement(ArchivedButtonWrapper,{analysis:e},e.permissions.writable?d.createElement(P.ZP,{disabled:!m,title:"Add analysis step"},d.createElement(AnalysisAddStepButton,{disabled:!m,onAddStep:async function handleAddStep(t){const n=await(0,Ic.jI)((0,jl._2)(e.id,t))
a.onChangeSelectedItem(getDefaultMainViewItemForStep(n))}})):null),selectedItemState:a,showStepNames:!0,steps:s,title:"Analysis Steps",toggleSidebar:t}))}function AnalysisUISidebarContent({analysis:e,onCloseSidebar:t,onOpenStepInitializationView:n,selectedItemState:a}){const i=getEnabledDatasetCreationMethods(),s=e.execution.steps.some((e=>e.definition.stepType===Sn.zs.PARAMETER_OPTIMIZATION_DATASET_CONFIGURATION)),r=!isAnalysisRunning(e)&&!s&&i.length>0,o=getDatasetSectionSidebarItemDatas(e),l=getFilesSectionSidebarItemDatas(e),c=getSaveToResultsSidebarItemDatas(e)
return d.createElement("div",{className:(0,g.iv)(ET.sidebarContentWrapper)},d.createElement("div",{className:(0,g.iv)(ET.sectionsWrapper)},d.createElement(SidebarSection_SidebarSection,{analysis:e,headerButton:d.createElement(ArchivedButtonWrapper,{analysis:e},e.permissions.writable?d.createElement(P.ZP,{disabled:!r,title:"Add table"},d.createElement(vy.Z,{className:(0,g.iv)(ET.addIcon),disabled:!r,onClick:function handleAddDataset(){n(getAddDataFrameAnalysisViewItem())
1===i.length&&trackSelectedDataFrameCreationMethodEvent(Sn.D2.ANALYSIS_TOOL_ANALYSIS_PAGE_DATA_FRAME_SIDEPANEL,e.id,i.length,i[0])}})):null),sidebarItemDatas:o,selectedItemState:a,onOpenStepInitializationView:n,title:"Analysis tables"}),l.length>0&&d.createElement("div",{className:(0,g.iv)(ET.secondarySidebarSectionWrapper)},d.createElement(SidebarSection_SidebarSection,{analysis:e,sidebarItemDatas:l,selectedItemState:a,title:"Files",onOpenStepInitializationView:n})),c.length>0&&d.createElement("div",{className:(0,g.iv)(ET.secondarySidebarSectionWrapper)},d.createElement(SidebarSection_SidebarSection,{analysis:e,onOpenStepInitializationView:n,sidebarItemDatas:c,selectedItemState:a,title:"Results"}))),d.createElement("div",{className:(0,g.iv)(ET.thirdPartyImportExportButtonWrapper)},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,fullWidth:!0,onClick:()=>{(0,Xn.Z)(ThirdPartyImportExportModal,{onRequestSubmit:()=>{},onRequestClose:()=>{},analysis:e})},size:C.qE.MEDIUM,text:"Connect with external tool"})))}function AnalysisUISidebar(e){const{onCloseSidebar:t}=e
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(ET.collapseButtonWrapper)},d.createElement(ToggleAnalysisSidebarButton,{sidebarIsOpen:!0,toggleSidebar:t})),dt.ZP.ENABLE_ANALYSIS_TOOL_FIRST_PARTY_ANALYSES?d.createElement(AnalysisUISidebarContent,{...e}):d.createElement(LegacyAnalysisUISidebarContent,{...e}))}const ET=g.mM.create({legacyContentWrapper:{paddingRight:16},sidebarContentWrapper:{paddingRight:16,flexGrow:1,display:"flex",flexDirection:"column"},sectionsWrapper:{flexGrow:1},secondarySidebarSectionWrapper:{marginTop:16},collapseButtonWrapper:{paddingRight:4,display:"flex",flexDirection:"row-reverse"},thirdPartyImportExportButtonWrapper:{marginTop:8},addIcon:Yl.CQ})
const fT=d.memo((function PresentationalAnalysisUISkeleton({clientStateId:e,analysis:t}){const n=function useAnalysisUISidebarState(e){const[t,n]=Pc.useGlobalClientState(e)
return{isOpen:t,open:(0,d.useCallback)((()=>{n(!0)}),[n]),close:(0,d.useCallback)((()=>{n(!1)}),[n])}}(e),a=useSelectedAnalysisItem(e,t),i=isViewStepConfigAnalysisItem(a.selectedItem),s=n.isOpen&&!isStepInitializationAnalysisItem(a.selectedItem)&&!i
function openStepInitializationView(e){a.onChangeSelectedItem(e)
n.close()}return d.createElement("div",{className:(0,g.iv)(ST.wrapper),...(0,ee.Z)({component:"AnalysisUISkeleton",element:"root"})},s&&d.createElement("div",{className:f()("scrollbar-override",(0,g.iv)(ST.sidebarWrapper)),...(0,ee.Z)({component:"AnalysisUISkeleton",element:"sidebarRoot"})},d.createElement(AnalysisUISidebar,{analysis:t,onCloseSidebar:n.close,onOpenStepInitializationView:openStepInitializationView,selectedItemState:a})),d.createElement(Hl.Z,{backgroundColor:Hl.v.GRAY_LIGHTER,className:(0,g.iv)(ST.bodyWrapper),header:d.createElement(AnalysisUIHeader,{analysis:t,showOpenSidebarButton:!s&&!isStepInitializationAnalysisItem(a.selectedItem)&&!i,onOpenSidebar:n.open}),isHeaderFrozen:!0,dataTestAttrs:{component:"AnalysisUISkeleton",element:"tabLayout"}},d.createElement(AnalysisUIMainViewRouter,{analysis:t,clientStateId:e,selectedItem:a.selectedItem,onChangeSelectedItem:a.onChangeSelectedItem,onCloseStepInitializationView:function closeStepInitializationView(e){a.onChangeSelectedItem(null!=e?e:{type:Fc.EMPTY_ANALYSIS})
n.open()},onOpenStepInitializationView:openStepInitializationView})))}))
function QueryingAnalysisUISkeleton(e){(0,Ul.Z)((()=>{fetchQueryApiIntrospection();(0,Ml.doQuerySafe)({query:Ho.Dx})}))
return d.createElement(PollingAnalysis,{analysisId:e.analysisId},(t=>d.createElement(fT,{...e,analysis:t})))}const ST=g.mM.create({wrapper:{display:"flex",flexDirection:"row",width:"100%",height:"100%"},sidebarWrapper:{display:"flex",flexDirection:"column",flex:"0 0 300px",borderRight:`1px solid ${Vt.tN}`,padding:"12px 0px 16px 16px",overflow:"auto"},bodyWrapper:{flex:1}})
class AnalysisTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){(0,Me.A9)(d.createElement(QueryingAnalysisUISkeleton,{analysisId:this.model.get("analysisId"),clientStateId:this.model.get("analysisId")}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}AnalysisTabView.initClass()
var yT=n(586704),bT=n(421426)
class JellyfishTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){const e=this.model.get("id");(0,Me.A9)(d.createElement(bT.Z,{id:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}JellyfishTabView.initClass()
var TT=n(955212),vT=n(60614)
const CT=(0,be.Z)((function PrimerAssemblyMismatchRow({fragmentResultColor:e,fragmentSequenceName:t,fragmentSequenceID:n,newBase:a,originalBase:i,pos:s,showPrintableSummary:r}){return d.createElement(d.Fragment,null,d.createElement("td",null,s),d.createElement("td",{style:{[r?"borderLeftColor":"backgroundColor"]:e},className:"printable-color"},n?d.createElement("a",{"data-fragment-sequence-id":n,className:"js-fragment-sequence"},t):t),d.createElement("td",null,i),d.createElement("td",null,a))}))
const IT=(0,be.Z)((function PrimerAssemblyRow({binding:e,dg:t,finalized:n,fragmentResultColor:a,misprime:i,overhang:s,primerBases:r,primerName:o,showBinding:l,showHomology:c,showPrintableSummary:u,tmAnneal:m,tmDiff:p,tmWhole:h}){return d.createElement(d.Fragment,null,d.createElement("td",{style:{[u?"borderLeftColor":"backgroundColor"]:a},className:"printable-color"},d.createElement("a",{className:"js-primer",...(0,ee.Z)({component:"PrimerAssemblyRow",element:"primerName"})},o)),u&&d.createElement("td",{dangerouslySetInnerHTML:{__html:r}}),d.createElement("td",{className:"tm text-center",...(0,ee.Z)({component:"PrimerAssemblyRow",element:"tmWhole"})},h.toFixed(1)),d.createElement("td",{className:"tm text-center"},m.toFixed(1)),d.createElement("td",{className:"tm text-center"},d.createElement("a",{className:"js-pair"},p.toFixed(2))),l&&d.createElement("td",{className:"binding text-center"},e),c&&d.createElement("td",{className:"homology text-center"},s),d.createElement("td",{className:"monomer text-center js-monomer",dangerouslySetInnerHTML:{__html:t}}),!n&&d.createElement("td",{className:"misprime text-center js-misprime",dangerouslySetInnerHTML:{__html:i}}))}))
const wT=(0,be.Z)((function PrimerAssemblyTabOptions(){return d.createElement("ul",{className:"nav navbar-nav"},d.createElement("li",{className:"pull-right"},d.createElement("div",null,d.createElement("button",{type:"button",className:"button button--mini button--secondary js-clone-into-wizard"},"Re-open [?]")),d.createElement("div",{className:"js-finalize-group"},d.createElement("button",{type:"button",className:"button button--mini button--primary js-save",...(0,ee.Z)({component:"PrimerAssemblyTabOptions",element:"finalizeButton"})},"Finalize [?]"))),d.createElement("li",null,d.createElement("div",{className:"buttonGroup"},d.createElement("button",{type:"button",className:"button button--mini button--tertiaryGray js-primer-tab-settings"},"Settings"),d.createElement("button",{type:"button",className:"button button--mini button--tertiaryGray js-print"},d.createElement("span",{className:"glyphicon glyphicon-print"})))),d.createElement("li",null,d.createElement("div",{className:"buttonGroup"},d.createElement("button",{type:"button",className:"button button--mini button--tertiaryGray js-copy-primers"},"Copy Primers"),d.createElement("div",{className:"buttonGroup js-export-group"},d.createElement("a",{className:"button button--mini button--secondary"},"Export CSV")))))}))
const NT=(0,be.Z)((function PrimerAssemblyTab({isGoldenGate:e,showPrintableSummary:t,showBinding:n,showHomology:a,finalized:i}){return d.createElement("form",{className:f()({"printable-summary":t},"buffer-content-container-fluid")},d.createElement("div",{className:"assembly-preview-mount"}),d.createElement("fieldset",null,d.createElement("legend",null,"Assembly Primers"),d.createElement("div",{className:"row primer-assembly-primers"},d.createElement("div",{className:"col col-md-12"},t&&e&&d.createElement("p",null,"Recognition site in ",d.createElement("span",{className:"primer-base-recognition-site"},"bold"),". Sticky end"," ",d.createElement("span",{className:"primer-base-sticky-end"},"underlined"),". Bases that bind to parent in"," ",d.createElement("span",{className:"primer-base-match"},"italics"),"."),d.createElement("table",{className:"table table-condensed"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",{className:"primer-name"},"Primer"),t&&d.createElement("th",null,"Bases"),d.createElement("th",{className:"text-center"},"T",d.createElement("sub",null,"m"),d.createElement("sup",null,"whole"),d.createElement("br",null),"(°C)"),d.createElement("th",{className:"text-center"},"T",d.createElement("sub",null,"m"),d.createElement("sup",null,"anneal"),d.createElement("br",null),"(°C)"),d.createElement("th",{className:"text-center"},"T",d.createElement("sub",null,"m"),d.createElement("sup",null,"diff"),d.createElement("br",null),"(°C)"),n&&d.createElement("th",{className:"text-center"},"Binding",d.createElement("br",null),"(bp)"),a&&d.createElement("th",{className:"text-center"},"Overhang",d.createElement("br",null),"(bp)"),d.createElement("th",{className:"text-center"},"Self ΔG",d.createElement("br",null),"(kcal)"),!i&&d.createElement("th",{className:"text-center"},"Mispriming"))),d.createElement("tbody",null))))),d.createElement("div",{className:"js-sticky-ends-area hidden"}),d.createElement("div",{className:"js-mismatches-area hidden"},d.createElement("fieldset",null,d.createElement("legend",null,"Mismatches Introduced"),d.createElement("div",{className:"row primer-assembly-mismatches"},d.createElement("div",{className:"col col-md-12"},d.createElement("table",{className:"table table-condensed table-hover"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Position"),d.createElement("th",null,"Parent"),d.createElement("th",null,"Original Base"),d.createElement("th",null,"New Base"))),d.createElement("tbody",null)),d.createElement("p",null,"No mismatches with parent sequences have been introduced."))))),d.createElement("div",{className:"design-parameters-mount"}))}))
var AT=n(676113)
function AssemblyTabSettingsModal(e){const[t,n]=(0,d.useState)(We.Z.get(tn.gq.MELTING_TEMP_DNA)),[a,i]=(0,d.useState)(ao.y),[s,r]=(0,d.useState)((0,Do.j)()),[o,l]=(0,d.useState)(We.Z.get(tn.gq.SECONDARY_TEMP))
return d.createElement(et.ZP,{title:"Assembly Primer Settings",className:"buffer-content-container",onRequestSubmit:()=>{We.Z.set({[tn.gq.MELTING_TEMP_DNA]:t,[tn.gq.SECONDARY_TEMP]:o});(0,Do.p)(s)},onRequestClose:e.onRequestClose,buttons:[{text:"Save",submit:!0,disabled:Object.values(a).some((e=>e))}]},d.createElement("h4",null,"Melting Temperature"),d.createElement(no.Z,{nucleotideType:R.Wy.DNA,meltingTempOptions:t,setMeltingTempOptions:n,optionsHaveValidationError:a,setOptionsHaveValidationError:i}),d.createElement("h4",null,"Mispriming"),d.createElement(_o.Z,{misprimeParams:s,setMisprimeParams:r,displayTextPrefix:"Find mispriming sites"}),d.createElement("h4",null,"Self-priming"),d.createElement("div",{className:(0,g.iv)(RT.row)},d.createElement("span",null,"Calculate ΔG for secondary structures at "),d.createElement(AT.Z,{className:(0,g.iv)(RT.fixedSizeInput),value:o,onChange:e=>{l(e.target.numericValue)},placeholder:"37"}),d.createElement("span",null,`${Xi.ig}C.`)))}const RT=g.mM.create({row:{display:"flex",alignItems:"center",marginBottom:"8px",whiteSpace:"pre-wrap"},fixedSizeInput:{flex:"0 0 40px"}})
function PrimerAssemblyTabView_defineProperty(e,t,n){(t=function PrimerAssemblyTabView_toPropertyKey(e){var t=function PrimerAssemblyTabView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}const{ASSEMBLY_TYPE:PT}=b,OT=X.ZP.getCommonEnzymes()
class PrimerAssemblyTabView_OptionsView extends s().View{static initClass(){this.prototype.template=wT
this.prototype.className="navbar"
this.prototype.events={"click .js-print":"print","click .js-save":"save","click .js-clone-into-wizard":"cloneIntoWizard","click .js-primer-tab-settings":function(){(0,Xn.Z)(AssemblyTabSettingsModal,{})}}}initialize(){this.listenTo(this.model.get("sequence"),"change:writable change:permissions change:currentVersion",this.renderFinalize)
this.listenTo(this.model.get("sequence")._sequence(),"change:finalized",this.renderFinalize)
this.listenTo(this.model.get("rows"),"reset",(function(){this.renderCopyButton()
this.renderExportButton()}))
this.listenTo(this.model,"print",this.print)}remove(){super.remove()
null!=this.selectorView&&this.selectorView.remove()
null!=this.clipboard&&vT.MB(this.clipboard)}print(){$e.$Z()
const e=this.model.get("sequence")._sequence(),showSummary=()=>{this.model.set({showPrintableSummary:!0})
const e=o()("html").find("head").html(),t=this.$el.closest(".buffer-container").find(".buffer-content").html(),n=window.open()
if(null!=n){n.document.open()
n.document.write(function renderPrintableSummary(e){return'<!DOCTYPE html><html lang="en"><head>'+e.head+'</head><body onload="setTimeout(function() { return window.print(); }, 1000);" class="printable-summary-container">'+e.tab+"</body></html>"}({head:e,tab:t}))
n.document.close()
n.focus()
this.model.set({showPrintableSummary:!1})
$e.Cp()}else{Fe.ZK("Assembly tab blocked")
v.ZP.warn("Please disable popup blockers and try again in a few seconds.")
this.model.set({showPrintableSummary:!1})
$e.Cp()}}
e.get("hasSnapshot")?showSummary():o().ajax({url:`/1/api/sequences/${e.id}`,async:!1,dataType:"json",success(t){if(t.hasSnapshot){e.set({snapshot_url:t.snapshot_url,hasSnapshot:!0})
showSummary()}else{v.ZP.warn("Sequence preview is not available yet. Please try again in a few seconds.")
$e.Cp()}}})}save(){this.$(".js-save").addClass("disabled")
const e={}
if(this.model.get("sequence").assemblyType()===PT.GOLDEN_GATE){e.fragmentResultStickyEnds={}
this.model.get("sequence").fragmentResults().each((t=>{e.fragmentResultStickyEnds[t.id]={}}))
const t=ye.Z.goldenGate.stickyEndRanges(this.model.get("sequence")._sequence())
for(const{start:n,end:a,upstreamFragment:i,downstreamFragment:s}of Array.from(t)){const t=this.model.get("sequence").residueSlice(n,a)
e.fragmentResultStickyEnds[i.id].end=t
e.fragmentResultStickyEnds[s.id].start=t}}this.model.get("sequence").finalize(e).always((()=>this.$(".js-save").removeClass("disabled"))).fail(v.ZP.notifyError)}renderFinalize(){const e=this.model.get("sequence")._sequence().finalized()||!this.model.get("sequence").allowFeatureEdits()
this.$(".js-finalize-group").toggleClass("hidden",e)}cloneIntoWizard(){const{assemblies:e}=n(770188)
$e.$Z()
const t=this.model.get("sequence")._sequence().assembly()
t.clone().done((n=>{e.add(n)
t.allFragments().length!==n.allFragments().length&&v.ZP.warn("Some sequences that were originally used in this assembly have been shortened or deleted. You will need to re-set those fragments.",{duration:10})})).fail(v.ZP.notifyError).always((()=>{$e.Cp()}))}canExportPrimers(){return null!=window.user}primersToExport(){return this.model.get("rows").map((e=>{const t=this.model.primers.get(e.id)
return{name:t.name(),nucleotideType:t.nucleotideType(),bases:t.bases()}}))}renderCopyButton(){const e=this.$(".js-copy-primers")
if(!this.canExportPrimers()){e.addClass("hidden")
return}e.removeClass("hidden")
const t=this.primersToExport()
e.toggleClass("disabled",0===t.length)
null!=this.clipboard&&vT.MB(this.clipboard)
const n=Uo.mT(t,"tsv")
this.clipboard=vT.Lx(e[0],{dataTransform:()=>n,notifyCopied:()=>v.ZP.success(Uo.UK,{duration:30,id:"tsv-primer-copied"})})}renderExportButton(){const e=this.$(".js-export-group .button")
if(!this.canExportPrimers()){e.addClass("hidden")
return}e.removeClass("hidden")
const t=this.primersToExport(),n=0===t.length
e.toggleClass("is-disabled",n)
t.length>=1&&e.click((()=>{n||Uo.ov({oligos:t,filename:Uo.FC(this.model.get("sequence").name())})}))}render(){this.$(".js-print").tooltip("destroy")
this.$el.html(this.template())
this.$(".js-print").tooltip({title:"Printable Summary",placement:"bottom",container:"body"})
this.$(".js-clone-into-wizard").tooltip({placement:"bottom",title:"Open a copy of this assembly in the assembly wizard",container:"body",trigger:"hover"})
this.$(".js-save").tooltip({placement:"bottom",title:"Finalize the assembly to enable creating alignments and editing anywhere in the sequence",trigger:"hover",container:"body"})
this.renderExportButton()
this.renderFinalize()
this.renderCopyButton()
return this}}PrimerAssemblyTabView_OptionsView.initClass()
class PrimerRow extends s().View{static initClass(){this.prototype.template=IT
this.prototype.tagName="tr"
this.prototype.events={"click .js-primer":"openPrimer","click .js-pair":"openPair","click .js-misprime a":"openMisprime","click .js-monomer a":"openMonomer"}}initialize({tabModel:e,showBinding:t,showHomology:n}){this.tabModel=e
this.showBinding=t
this.showHomology=n
this.listenTo(this.model,"change",(0,It.D)(this.render,100))
this.sequence=this.model.get("sequence")}getPrimer(){return this.sequence.sequencePrimers().get(this.model.id)}openPrimer(e){this.getPrimer().dblClick(this.sequence,e.shiftKey)}openPair(){return this.sequence.selectPrimerPair(this.model.get("pairId"))}openMisprime(){return this.model.get("misprimeHandler")()}openMonomer(){return this.model.get("dgHandler")()}render(){const e=this.getPrimer().get("_primer"),t=l.default.extend(this.model.toJSON(),{primerBases:basesHTML(this.sequence._sequence(),e,{isAssemblyPrimer:!0}),fragmentResultColor:this.tabModel.lighten(this.model.get("fragmentResultColor")),finalized:this.sequence.finalized(),showBinding:this.showBinding,showHomology:this.showHomology,showPrintableSummary:this.tabModel.showPrintableSummary()})
this.$el.html(this.template(t))
return this}}PrimerRow.initClass()
class MismatchRow extends s().View{static initClass(){this.prototype.template=CT
this.prototype.tagName="tr"
this.prototype.events={"click .js-fragment-sequence":"openFragmentSequence",click(){return this.model.click(this.tabModel.get("sequence"))}}}initialize(e){this.tabModel=e.tabModel
this.listenTo(this.model,"change:selected",(function(e,t){return this.$el.toggleClass("active",t)}))
this.listenTo(this.tabModel.get("sequence")._sequence(),"change:startIndex",(()=>{(0,S.Gp)(!1,"Start index changed while mismatch row rendered")}))}openFragmentSequence(){return this.tabModel.openFragmentSequence(this.model)}render(){const e=l.default.extend(this.model.toJSON(),{fragmentResultColor:this.tabModel.lighten(this.model.get("fragmentResultColor")),pos:T.modelToDisplay(this.model.get("pos"),this.tabModel.get("sequence").startIndex()),showPrintableSummary:this.tabModel.showPrintableSummary()})
this.$el.html(this.template(e))
return this}}MismatchRow.initClass()
class AssemblyPreview extends d.Component{render(){return d.createElement("fieldset",null,d.createElement("legend",null,"Assembly Preview"),d.createElement(h.Z,null,d.createElement(p.Z,{xs:8},d.createElement("img",{src:this.props.snapshotURL})),d.createElement(p.Z,{xs:4},d.createElement("table",{className:"table table-condensed table-hover"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Parent Sequence")),d.createElement("tbody",null,Array.from(this.props.fragmentSequenceNames).map(((e,t)=>d.createElement("tr",{key:t},d.createElement("td",{className:"printable-color",style:{borderLeftColor:Sr.vx[t]}},e))))))))))}}PrimerAssemblyTabView_defineProperty(AssemblyPreview,"propTypes",{fragmentSequenceNames:J().arrayOf(J().string).isRequired,snapshotURL:J().string.isRequired})
class DesignParameters extends d.Component{constructor(...e){super(...e)
PrimerAssemblyTabView_defineProperty(this,"renderParameter",((e,t)=>{switch(e){case"tmAnneal":case"bindingRegionMinTM":return[d.createElement("span",null,"Min T",d.createElement("sub",null,"m")," for primer's binding bases"),`${t} °C`]
case"tmWhole":return[d.createElement("span",null,"Min T",d.createElement("sub",null,"m")," for whole primer"),`${t} °C`]
case"tmDiff":case"primerPairMaxTMDiff":return[d.createElement("span",null,"Max T",d.createElement("sub",null,"m")," diff for primer pairs"),`${t} °C`]
case"minOverlap":return["Min length of homology/binding regions",t]
case"maxOverlap":return["Max length of homology/binding regions",t]
case"preRecognitionSiteLength":return["Pre-recognition site length",t]
case"preRecognitionSiteBases":return["Pre-recognition site bases",t||"(random)"]
case"bindingRegionMinLength":return["Min length for binding region",t]
case"enzymeID":return["Type IIS Enzyme",OT.get(t).name()]
default:throw new Error(`Unexpected parameter key: ${e}`)}}))}render(){const e=(()=>{switch(this.props.assemblyType){case PT.GIBSON:return["tmAnneal","tmWhole","tmDiff","minOverlap","maxOverlap"]
case PT.GOLDEN_GATE:return["preRecognitionSiteLength","preRecognitionSiteBases","bindingRegionMinTM","bindingRegionMinLength","primerPairMaxTMDiff","enzymeID"]}})()
return d.createElement("fieldset",null,d.createElement("legend",null,"Design Parameters"),d.createElement("table",{className:"table table-condensed table-hover"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Parameter"),d.createElement("th",null,"Value")),d.createElement("tbody",null,(()=>{const t=[]
for(const n of Array.from(e)){const[e,a]=Array.from(this.renderParameter(n,this.props.parameters[n]))
t.push(d.createElement("tr",{key:n},d.createElement("td",null,e),d.createElement("td",null,a)))}return t})()))))}}PrimerAssemblyTabView_defineProperty(DesignParameters,"propTypes",{assemblyType:J().string.isRequired,parameters:J().object.isRequired})
class PrimerAssemblyTabView_TabView extends s().View{static initClass(){this.prototype.template=NT
this.prototype.className="primer-assembly-tab-results buffer-tab"
this.prototype.showBinding=!0
this.prototype.showHomology=!0}initialize(){this.sequence=this.model.get("sequence")
this.listenTo(this.sequence._sequence(),"change:finalized",this.render)
this.listenTo(this.model.get("rows"),"reset",this.render)
this.listenTo(this.model,"change:showPrintableSummary",this.render)
this.listenTo(this.sequence.primerAssemblyMismatches(),"reset",this._renderMismatchRows)
this.primerRows=[]
this.mismatchRows=[]}remove(){u.unmountComponentAtNode(this.$(".design-parameters-mount")[0])
this._removeMismatchRows()
this._removePrimerRows()
return super.remove()}_removePrimerRows(){for(const e of Array.from(this.primerRows))e.remove()}_renderPrimerRows(){this._removePrimerRows()
this.primerRows=this.model.get("rows").map((e=>{const t=new PrimerRow({model:e,tabModel:this.model,showBinding:this.showBinding,showHomology:this.showHomology})
this.$(".primer-assembly-primers tbody").append(t.render().el)
return t}))}_removeMismatchRows(){for(const e of Array.from(this.mismatchRows))e.remove()}_renderMismatchRows(){this._removeMismatchRows()
this.mismatchRows=this.sequence.primerAssemblyMismatches().map((e=>{const t=new MismatchRow({model:e,tabModel:this.model})
this.$(".js-mismatches-area tbody").append(t.render().el)
return t}))
this.$(".js-mismatches-area p").toggleClass("hidden",0!==this.mismatchRows.length)}render(){this.$el.html(this.template({finalized:this.sequence.finalized(),showBinding:this.showBinding,showHomology:this.showHomology,isGoldenGate:this.sequence.assemblyType()===PT.GOLDEN_GATE,showPrintableSummary:this.model.showPrintableSummary()}))
this._renderPrimerRows()
this.sequence.finalized()||this._renderMismatchRows()
this.$(".js-mismatches-area").toggleClass("hidden",this.sequence.finalized())
this.model.showPrintableSummary()?(0,Me.A9)(d.createElement(AssemblyPreview,{fragmentSequenceNames:this.sequence.fragmentResults().map((e=>function PrimerAssemblyTabView_guard_(e,t){return null!=e?t(e):void 0}(e.parent(),(e=>e.name)))),snapshotURL:this.sequence._sequence().get("snapshot_url")}),this.$(".assembly-preview-mount")[0]):u.unmountComponentAtNode(this.$(".assembly-preview-mount")[0]);(0,Me.A9)(d.createElement(DesignParameters,{assemblyType:this.sequence.assemblyType(),parameters:this.sequence._sequence().assembly().parameters()}),this.$(".design-parameters-mount")[0])
return this}}PrimerAssemblyTabView_TabView.initClass()
var xT=n(920119)
const _T=(0,be.Z)((function StickyEndsArea(){return d.createElement("fieldset",null,d.createElement("legend",null,"Sticky Ends"),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("table",{className:"table table-condensed table-hover"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Upstream"),d.createElement("th",null,"Downstream"),d.createElement("th",null,"Bases",d.createElement("a",{className:"glyphicon glyphicon-info-sign u-no-text-decoration u-tiny-spacing-left js-finalized-message hidden"})),d.createElement("th",null,"Reverse Complement"))),d.createElement("tbody",{className:"js-sticky-ends-tbody"})),d.createElement("div",{className:"assembly-check-mount"}))))}))
const DT=(0,be.Z)((function StickyEndsRow({bases:e,downstreamFragment:t,revcomp:n,showPrintableSummary:a,upstreamFragment:i}){return d.createElement(d.Fragment,null,d.createElement("td",{style:{[a?"borderLeftColor":"backgroundColor"]:i.color},className:"printable-color js-upstream"},d.createElement("a",null,i.name)),d.createElement("td",{style:{[a?"borderLeftColor":"backgroundColor"]:t.color},className:"printable-color js-downstream"},d.createElement("a",null,t.name)),d.createElement("td",null,e||d.createElement("span",{className:"faded"},"N/A")),d.createElement("td",null,n||d.createElement("span",{className:"faded"},"N/A")))})),{ASSEMBLY_TYPE:LT}=b
function stickyEndBases(e,t,n,a,i){return null!=a&&null!=i?e.residueSlice(a,i):t.has("end_sticky_end")?t.get("end_sticky_end"):n.has("start_sticky_end")?n.get("start_sticky_end"):""}class AssemblyCheckView extends s().View{initialize({sequence:e}){this.sequence=e}checkAssembly(){let e,t
const n=this.sequence._sequence(),a=ye.Z.goldenGate.stickyEndRanges(n)
let i=(()=>{let n,i
const s=[]
for({upstreamFragment:i,downstreamFragment:n,start:e,end:t}of Array.from(a)){const a=GoldenGateTabView_guard_(i.parent(),(e=>e.name)),r=GoldenGateTabView_guard_(n.parent(),(e=>e.name))
s.push(new ye.Z.goldenGate.StickyEnd(stickyEndBases(this.sequence,i,n,e,t),`${a} / ${r}`))}return s})()
i=l.default.filter(i,(e=>e.bases.length>0))
const s=n.assembly().enzyme(),r=n.getCuts(s.toJSON()).map((a=>{e=a.position
t=T.mod(e+s.get("offset"),n.length())
s.get("offset")<0&&([e,t]=Array.from([t,e]))
return new ye.Z.goldenGate.StickyEnd(n.residueSlice(e,t),`${n.name()} at base ${e}`)}))
return ye.Z.goldenGate.validateStickyEnds(i,r,!0)}render(){const{errors:e,warnings:t}=this.checkAssembly();(0,Me.A9)(d.createElement(fe,{errors:e,warnings:t,method:LT.GOLDEN_GATE}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}class StickyEndsRowView extends s().View{static initClass(){this.prototype.template=DT
this.prototype.tagName="tr"
this.prototype.events={"click .js-upstream":function(){return this.open(this.upstreamFragment)},"click .js-downstream":function(){return this.open(this.downstreamFragment)}}}initialize({tabModel:e,upstreamFragment:t,downstreamFragment:n,bases:a}){this.tabModel=e
this.upstreamFragment=t
this.downstreamFragment=n
this.bases=a}open(e){if(null==e.parent())return
const t=e.parent().id
ve.ZP.get().openFolderItem(t)}render(){const e=this.upstreamFragment.collection,t=Sr.vx
this.$el.html(this.template({upstreamFragment:{name:GoldenGateTabView_guard_(this.upstreamFragment.parent(),(e=>e.name))||"deleted",color:this.tabModel.lighten(t[e.indexOf(this.upstreamFragment)])},downstreamFragment:{name:GoldenGateTabView_guard_(this.downstreamFragment.parent(),(e=>e.name))||"deleted",color:this.tabModel.lighten(t[e.indexOf(this.downstreamFragment)])},bases:this.bases,revcomp:y.revcomp(this.bases,R.jb),showPrintableSummary:this.tabModel.showPrintableSummary()}))
return this}}StickyEndsRowView.initClass()
class StickyEndsAreaView extends s().View{static initClass(){this.prototype.template=_T}initialize({tabModel:e,sequence:t}){this.tabModel=e
this.sequence=t
this.listenTo(this.sequence._sequence(),"change:bases change:fragmentResults",this.render)
this.listenTo(this.sequence._sequence(),"change:finalized",this.renderFinalizedMessage)
this.stickyEndRows=[]
this.assemblyCheckView=null}renderFinalizedMessage(){const e=this.$(".js-finalized-message")
e.popover("destroy")
this.sequence.finalized()?e.removeClass("hidden").popover({placement:"bottom",content:"The sticky end bases are from the sequence when it was finalized.",container:"body",trigger:"hover"}):e.addClass("hidden")}render(){this.$el.html(this.template())
this.renderFinalizedMessage()
const e=ye.Z.goldenGate.stickyEndRanges(this.sequence._sequence())
for(var t of Array.from(this.stickyEndRows))t.remove()
this.stickyEndRows=l.default.map(e,(({upstreamFragment:e,downstreamFragment:n,start:a,end:i})=>{t=new StickyEndsRowView({tabModel:this.tabModel,upstreamFragment:e,downstreamFragment:n,bases:stickyEndBases(this.sequence,e,n,a,i)})
this.$(".js-sticky-ends-tbody").append(t.render().el)
return t}))
null!=this.assemblyCheckView&&this.assemblyCheckView.remove()
this.assemblyCheckView=new AssemblyCheckView({sequence:this.sequence,el:this.$(".assembly-check-mount")[0]})
this.assemblyCheckView.render()
return this}remove(){for(const e of Array.from(this.stickyEndRows))e.remove()
null!=this.assemblyCheckView&&this.assemblyCheckView.remove()
return super.remove()}}StickyEndsAreaView.initClass()
class GoldenGateTabView extends PrimerAssemblyTabView_TabView{static initClass(){this.prototype.showBinding=!1
this.prototype.showHomology=!1}initialize(){super.initialize(...arguments)
this.stickyEndsView=null}render(){super.render(...arguments)
this.renderStickyEnds()
return this}renderStickyEnds(){const e=this.$(".js-sticky-ends-area")
e.removeClass("hidden")
null!=this.stickyEndsView&&this.stickyEndsView.remove()
this.stickyEndsView=new StickyEndsAreaView({sequence:this.sequence,tabModel:this.model,el:e[0]})
this.stickyEndsView.render()}remove(){null!=this.stickyEndsView&&this.stickyEndsView.remove()
return super.remove()}}GoldenGateTabView.initClass()
function GoldenGateTabView_guard_(e,t){return null!=e?t(e):void 0}var kT=n(902246),MT=n(144904),FT=n(334089),ZT=n(673448),BT=n(312656),qT=n(201670)
function ExpandedClickableIcon({icon:e,onClick:t}){return d.createElement("div",{className:f()((0,g.iv)(VT.icon)),onClick:t},e)}const VT=g.mM.create({icon:{cursor:"pointer",minHeight:"27px",minWidth:"27px",display:"flex",justifyContent:"center",alignItems:"center"}})
function OverflowDropdown({menu:e,icon:t,isOpen:n,onToggle:a}){return d.createElement(I.ZP,{className:f()((0,g.iv)(UT.dropdown),"dropdown-menu--dropLeft"),closeOnInsideClick:!0,closeOnOutsideClick:!0,menu:e,isOpen:n,onToggle:a},t)}const UT=g.mM.create({dropdown:{width:195}})
var GT,zT=n(75359),$T=n(933388)
!function(e){e.GRANTED="GRANTED"
e.NOT_GRANTED="NOT_GRANTED"
e.MIXED="MIXED"}(GT||(GT={}))
function DescriptionHelpButton(e){return d.createElement(zp.Z,{renderContent:()=>d.createElement("div",{className:(0,g.iv)(WT.helpButtonContent)},e.description),iconClassName:(0,g.iv)(WT.helpButtonIcon)})}function renderActionOptionCell(e,t,n){const a=n?d.createElement("div",{style:{marginLeft:20*t+"px"},className:(0,g.iv)(WT.iconContainer)},[e,d.createElement(DescriptionHelpButton,{key:"description",description:n})]):d.createElement("div",{style:{marginLeft:20*t+"px"}},e)
return d.createElement(rc.bL,{className:(0,g.iv)(WT.cell,WT.actionOptionCell)},a)}function createActionOptionsCells(e,t=0){if(e.hidden)return[]
if("action"in e)return[renderActionOptionCell(e.name,t,e.description)]
{const n=e.actionOptions.flatMap((e=>createActionOptionsCells(e,t+1)))
return[renderActionOptionCell(e.name,t,e.description),...n]}}function createPolicyCells(e,t,n,a){const i=[]
t.forEach((t=>{if(!t.hidden&&"action"in t){const s=t.itemTypeOverride||e,r=n[`${s}${t.action}`],o=r?GT.GRANTED:GT.NOT_GRANTED
i.push(function renderPolicyCell(e,t,n){let a
switch(e){case GT.MIXED:a=d.createElement(pe.Z,{className:(0,g.iv)(t?WT.effectivePermissionCheckIcon:WT.policyCellIcon),icon:"minus"})
break
case GT.NOT_GRANTED:a=void 0
break
case GT.GRANTED:a=!n||n.has($T.gP.ALWAYS)?d.createElement(pe.Z,{className:(0,g.iv)(WT.checkIcon,t?WT.effectivePermissionCheckIcon:WT.policyCellIcon),icon:"check"}):(0,Jt.SL)([...n.keys()]).map((e=>d.createElement("div",{key:e,className:(0,g.iv)(WT.conditionCellContainer)},d.createElement(pe.Z,{className:(0,g.iv)(WT.checkIcon,t?WT.effectivePermissionCheckIcon:WT.policyCellIcon),icon:"check"}),`${(0,$T.DQ)(e)}`)))
break
default:throw new Error(`Unimplemented status: ${(0,Go.vE)(e)}`)}return d.createElement(rc.bL,{className:(0,g.iv)(WT.cell,WT.policyCell)},a)}(o,a,r))}else if(!t.hidden&&"actionOptions"in t){const s=createPolicyCells(e,t.actionOptions,n,a)
s.length>0&&i.push(d.createElement(rc.bL,{className:(0,g.iv)(WT.cell,WT.policyCell)}),...s)}}))
return i}function renderPolicyColumn({itemTypeOptions:e,name:t,policyStatements:n,isEffectivePermission:a}){const i=n.reduce(((e,t)=>{e[t.itemType+t.action]||(e[t.itemType+t.action]=new Set)
e[t.itemType+t.action].add(t.condition)
return e}),{}),s=e.flatMap((e=>{const t=createPolicyCells(e.itemType,e.actionOptions,i,a)
return t.length>0?[d.createElement(rc.bL,{cellTypeOverride:rc.lT.INLINE_HEADER,className:(0,g.iv)(WT.cell,WT.policyCell)}),...t]:[]}))
return d.createElement(rc.sg,{key:`${t}-${a}`,header:d.createElement(rc.bL,{className:(0,g.iv)(WT.cell)},t),renderCell:e=>s[e]})}function createActionOptionCellsFromTemplate(e){return e.flatMap((e=>{const t=d.createElement(rc.bL,{className:(0,g.iv)(WT.cell,WT.actionOptionCell),cellTypeOverride:rc.lT.INLINE_HEADER},e.name),n=e.actionOptions.flatMap((e=>createActionOptionsCells(e)))
return n.length>0?[t,...n]:[]}))}function EffectivePermissionsModal({onRequestClose:e,policyTemplate:t,policies:n,effectivePolicyStatements:a,resource:i,principalType:s}){(0,Ul.Z)((()=>{m.L9(j.zR.OPENED_MODAL_EFFECTIVE_PERMISSIONS,{objectType:i.type,objectId:i.id})}))
const r=createActionOptionCellsFromTemplate(t.itemTypeOptions)
return d.createElement(et.ZP,{onRequestClose:()=>{m.L9(j.zR.CLOSED_MODAL_EFFECTIVE_PERMISSIONS,{objectType:i.type,objectId:i.id})
e()},fullHeight:!0,fullWidth:!0,scrollable:!1,title:`${(0,Mt.kC)(i.type)} Access Summary - ${i.name}`},d.createElement("div",{className:(0,g.iv)(WT.modalFlexbox)},d.createElement("p",{className:(0,g.iv)(WT.infoText)},"The ",s," can perform the following actions in this ",i.type.toLowerCase()," based on their effective permissions."),d.createElement("p",{className:(0,g.iv)(WT.infoText)},"Effective permissions are generated from all the access policies the ",s," has been assigned for this specific ",i.type.toLowerCase(),". When a ",s," is assigned more than one access policy, they are granted the most permissive action across all assigned policies."),d.createElement("div",{className:(0,g.iv)(WT.scrollContainer)},d.createElement(rc.iA,{className:(0,g.iv)(WT.table),numRows:r.length,frozenHeader:!0,overflowVisible:!0,getRowClassName:()=>(0,g.iv)(WT.tableRow)},d.createElement(rc.sg,{header:"",renderCell:e=>r[e]}),renderPolicyColumn({name:"Effective Permissions",policyStatements:a,itemTypeOptions:t.itemTypeOptions,isEffectivePermission:!0}),n.map((e=>renderPolicyColumn({name:e.name,policyStatements:e.policyStatements,itemTypeOptions:t.itemTypeOptions})))))))}const WT=g.mM.create({actionOptionCell:{minWidth:"350px"},cell:{boxShadow:"none",fontSize:"14px",minWidth:"150px"},checkIcon:jf.aM,conditionCellContainer:{alignItems:"center",display:"flex"},effectivePermissionCheckIcon:{color:Vt.EL},helpButtonContent:{whiteSpace:"pre-wrap"},helpButtonIcon:jf.lC,iconContainer:{alignItems:"center",display:"flex"},infoText:{...jf.Qc,fontSize:"14px"},modalFlexbox:{display:"flex",flexDirection:"column",height:"100%"},policyCell:{boxShadow:`1px 0 0 0 ${Vt.tN}`},policyCellIcon:{color:Vt.pp},scrollContainer:{overflowY:"scroll"},table:{borderRight:0},tableRow:{boxShadow:"none"}})
var HT=n(263174)
const jT=[10,50,100],YT=jT[0]
function useLimitOffset(){const[e,t]=(0,d.useState)(0),[n,a]=(0,d.useState)(YT)
return[{limit:n,offset:e},{setLimit:e=>{n!==e&&t(0)
a(e)},setOffset:t}]}const QT=xa.Ps`
  fragment PolicyTablePartyPoliceableListing on PartyPoliceablesListingNode {
    total
    partyPoliceables {
      party {
        ... on PartyInterface {
          id
        }
      }
      policeable {
        ... on PoliceableInterface {
          id
          name
        }
        ... on SourceInterface {
          id
          url
          ownerJson
          permissions {
            readable
            writable
            appendable
            admin
          }
        }
      }
      effectivePolicyStatements {
        itemType
        condition
        action
      }
      collaborations {
        teamRole
        organizationRole
        policy {
          ... on PolicyInterface {
            id
            name
            policyStatements {
              itemType
              condition
              action
            }
          }
        }
        party {
          ... on PartyInterface {
            id
            name
          }
        }
      }
    }
  }
`
function PoliceableDropdown(e){const[t,n]=d.useState(!1)
return d.createElement(OverflowDropdown,{isOpen:t,onToggle:t=>{t&&m.L9(j.zR.OPENED_DATA_ACCESS_ROW_OVERFLOW_MENU,{objectType:e.resourceType,objectId:e.policeable.id})
n(t)},menu:d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(N.Z,{onSelect:e.openEffectivePermissionsModal},"View effective permissions"),d.createElement(N.Z,{onSelect:()=>{e.openPoliceablePage(e.policeable)}},"Navigate to ",e.resourceType.toLowerCase()),d.createElement(N.Z,{onSelect:()=>{e.openPoliceableSettingsPage(e.policeable)}},"Edit ",e.resourceType.toLowerCase()," settings")),icon:d.createElement(ExpandedClickableIcon,{icon:d.createElement(pe.Z,{icon:"overflow"})})})}function TableOrLoadingContainer(e){var t
if(e.isLoading)return d.createElement("div",{className:(0,g.iv)(KT.tableOrLoadingContainer)},d.createElement(kl.b,null))
const n=e.partyPoliceablesListing.partyPoliceables.map((e=>e.collaborations.reduce(((e,t)=>{e[t.policy.name]?e[t.policy.name].collaborations.push(t):e[t.policy.name]={collaborations:[t],policy:t.policy}
return e}),{}))),a=null!==(t=e.getPoliceableDisplayName)&&void 0!==t?t:e=>e.name,i=Object.values(n).map((e=>Object.values(e).map((e=>e.policy)))).map(((t,n)=>async()=>{const i=e.partyPoliceablesListing.partyPoliceables[n]
await(0,Xn.Z)(EffectivePermissionsModal,{resource:{name:a(i.policeable),type:e.resourceType,id:i.policeable.id},policyTemplate:e.policyTemplate,policies:t,effectivePolicyStatements:i.effectivePolicyStatements,principalType:e.principalType})}))
return d.createElement(rc.iA,{className:f()((0,g.iv)(KT.table),(0,g.iv)(KT.tableOrLoadingContainer)),numRows:e.partyPoliceablesListing.partyPoliceables.length,emptyTableText:`No ${(0,de._6)(2,e.resourceType)} for ${e.principalType}.`,onRowClick:e=>{i[e]()}},d.createElement(rc.sg,{header:(0,Mt.kC)(e.resourceType),renderCell:t=>function renderName(e,t){return d.createElement(rc.bL,null,d.createElement("div",{className:(0,g.iv)(KT.nameCellChildren,KT.text)},d.createElement(pe.Z,{className:(0,g.iv)(KT.resourceTypeIcon),icon:e}),t))}(e.icon,a(e.partyPoliceablesListing.partyPoliceables[t].policeable))}),d.createElement(rc.sg,{header:"Access Policies",renderCell:e=>function renderPolicies(e){const t=(0,Jt.SL)(Object.keys(e))
return d.createElement(rc.bL,{className:(0,g.iv)(KT.cellText,KT.text)},t.map((e=>d.createElement("div",{key:e,className:(0,g.iv)(KT.collaborationDiv)},e))))}(n[e])}),d.createElement(rc.sg,{header:"Assigned To",renderCell:e=>function renderAssignedTo(e){const t=(0,Jt.SL)(Object.keys(e))
return d.createElement(rc.bL,{className:(0,g.iv)(KT.cellText,KT.text)},t.map((t=>d.createElement("div",{key:t,className:(0,g.iv)(KT.collaborationDiv)},e[t].collaborations.sort(((e,t)=>e.party.name.localeCompare(t.party.name,void 0,{numeric:!0})||(null!=e.teamRole&&null!=t.teamRole?t.teamRole-e.teamRole:null!=e.organizationRole&&null!=t.organizationRole?t.organizationRole-e.organizationRole:0))).map((e=>e.organizationRole===HT.OrganizationPermissionRole.ADMIN||e.teamRole===HT.TeamPermissionRole.ADMIN?`${e.party.name} (Admin)`:e.party.name)).join(", ")))))}(n[e])}),d.createElement(rc.sg,{header:d.createElement(rc.bL,{className:(0,g.iv)(KT.overflowButtonCell)}),renderCell:(t,n)=>function renderOverflowButtonCell({resourceType:e,policeable:t,openEffectivePermissionsModal:n,openPoliceablePage:a,openPoliceableSettingsPage:i}){return d.createElement(rc.bL,{className:(0,g.iv)(KT.overflowButtonCell)},d.createElement(PoliceableDropdown,{resourceType:e,policeable:t,openEffectivePermissionsModal:n,openPoliceablePage:a,openPoliceableSettingsPage:i}))}({resourceType:e.resourceType,policeable:e.partyPoliceablesListing.partyPoliceables[t].policeable,openEffectivePermissionsModal:i[t],openPoliceablePage:e.openPoliceablePage,openPoliceableSettingsPage:e.openPoliceableSettingsPage})}))}function PoliceablePolicyTable(e){return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(KT.resultPagerContainer)},d.createElement("div",{className:(0,g.iv)(KT.resultPagerContainerContent)},d.createElement(zT.Z,{allowFastForwardAndBackward:!0,setOffset:e.setOffset,isLoading:e.isLoading,pagination:e.pagination})),d.createElement("div",{className:(0,g.iv)(KT.resultPagerContainerContent)},d.createElement(qT.Z,{pageSizeConfig:{availablePageSizes:jT,pageSize:e.pagination.limit,onSetPageSize:e.setLimit},iconAltText:"Results Per Page"}))),d.createElement(TableOrLoadingContainer,{...e}))}const KT=g.mM.create({cellText:{color:Vt.pp},collaborationDiv:{minHeight:"16px",":not(:last-child)":{...jf.De}},resultPagerContainer:{...jf.lC,...jf.S1},resultPagerContainerContent:{display:"inline-block",verticalAlign:"top"},tableOrLoadingContainer:{...jf.S1,maxWidth:"1000px"},table:{backgroundColor:Vt.Cj},text:{fontSize:"13px",maxWidth:"1000px"},resourceTypeIcon:{...jf.O6,color:Vt.pF},nameCellChildren:{alignItems:"center",display:"flex"},overflowButtonCell:{width:20,color:Vt.pp}}),JT=xa.Ps`
  query BenchlingAppProjectsListingQuery($appId: StrictString!, $limitOffsetInput: LimitOffsetInput!)
  @skipAudit
  @engComponent(name: BENCHLING_APPS) {
    benchlingApp(id: $appId) {
      ... on BenchlingAppNode {
        id
        benchlingAppProjectsListing(limitOffsetInput: $limitOffsetInput) {
          ... on PartyPoliceablesListingNode {
            ...PolicyTablePartyPoliceableListing
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${QT}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,XT="app"
function BenchlingAppProjectPolicyTable(e){const[{limit:t,offset:n},{setLimit:a,setOffset:i}]=useLimitOffset(),s=(0,Da.IJ)(JT,{variables:{appId:e.appId,limitOffsetInput:{limit:t,offset:n}},fetchPolicy:"network-only"})
if(s.type===Da.NI.ERROR){v.ZP.error("Could not load projects; try reloading the page.")
return null}if(s.type===Da.NI.PENDING)return d.createElement(PoliceablePolicyTable,{isLoading:!0,resourceType:"project",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:0},principalType:XT});(0,S.hu)(!(0,ka.CZ)(s.data.benchlingApp),"Expected app currently being viewed to be readable")
return d.createElement(PoliceablePolicyTable,{isLoading:!1,resourceType:"project",icon:"project",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:s.data.benchlingApp.benchlingAppProjectsListing.total},policyTemplate:ZT,partyPoliceablesListing:s.data.benchlingApp.benchlingAppProjectsListing,openPoliceablePage:e=>{(0,S.hu)("ProjectNode"===e.__typename,"Expected ProjectNode");(0,ac.ZP)(e.url)},openPoliceableSettingsPage:e=>{(0,S.hu)("ProjectNode"===e.__typename,"Expected ProjectNode");(0,Xn.Z)(BT.M,{permissions:e.permissions,sourceId:e.id,onUpdate:()=>{s.refetch()
i(0)}})},principalType:XT})}const ev=xa.Ps`
  query BenchlingAppRegistriesListingQuery($appId: StrictString!, $limitOffsetInput: LimitOffsetInput!)
  @skipAudit
  @engComponent(name: BENCHLING_APPS) {
    benchlingApp(id: $appId) {
      ... on BenchlingAppNode {
        id
        benchlingAppRegistriesListing(limitOffsetInput: $limitOffsetInput) {
          ... on PartyPoliceablesListingNode {
            ...PolicyTablePartyPoliceableListing
          }
        }
      }
    }
  }
  ${QT}
`,tv="app"
function BenchlingAppRegistryPolicyTable(e){const[{limit:t,offset:n},{setLimit:a,setOffset:i}]=useLimitOffset(),s=(0,Da.IJ)(ev,{variables:{appId:e.appId,limitOffsetInput:{limit:t,offset:n}},fetchPolicy:"network-only"})
if(s.type===Da.NI.ERROR){v.ZP.error("Could not load projects; try reloading the page.")
return null}if(s.type===Da.NI.PENDING)return d.createElement(PoliceablePolicyTable,{isLoading:!0,resourceType:"project",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:0},principalType:tv})
{(0,S.hu)(!(0,ka.CZ)(s.data.benchlingApp),"Expected app currently being viewed to be readable")
const e=s.data.benchlingApp.benchlingAppRegistriesListing
return d.createElement(PoliceablePolicyTable,{isLoading:!1,resourceType:"registry",icon:"registry",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:e.total},policyTemplate:ZT,getPoliceableDisplayName:e=>{(0,S.hu)("RegistryNode"===e.__typename,"Expected RegistryNode")
return`${e.ownerJson.name} ${e.name}`},partyPoliceablesListing:e,openPoliceablePage:e=>{(0,S.hu)("RegistryNode"===e.__typename,"Expected RegistryNode");(0,ac.ZP)(e.url)},openPoliceableSettingsPage:e=>{(0,S.hu)("RegistryNode"===e.__typename,"Expected RegistryNode");(0,ac.ZP)(lo.getRegistryGeneralSettingsUrl(e.ownerJson.url_identifier,e.id))},principalType:tv})}}const nv=xa.Ps`
  query CurrentTenantQueryApp @skipAudit @engComponent(name: BENCHLING_APPS) {
    currentTenant {
      id
      displayName
    }
  }
`
var av
!function(e){e.PROJECT="PROJECT"
e.REGISTRY="REGISTRY"}(av||(av={}))
const iv={[av.PROJECT]:"Projects",[av.REGISTRY]:"Registries"}
function Sidepanel(e){return d.createElement(d.Fragment,null,d.createElement(Db.X2,{className:(0,g.iv)(sv.sidebarTitle)},d.createElement(MT.Z,null),d.createElement("strong",null,"Resource Types")),Object.keys(av).map((t=>d.createElement(FT.Z,{key:t,active:e.activeResourceType===t,name:iv[t],icon:d.createElement(MT.Z,null),clickHandler:()=>{e.onChangeActiveResourceType(t)}}))))}function BenchlingAppDataAccessTabSection(e){const t=(0,Da.IJ)(nv)
if(t.type===Da.NI.PENDING)return d.createElement("div",{className:(0,g.iv)(sv.benchlingAppDataAccessTabSection)},d.createElement(kl.b,null))
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load tenant details; try reloading the page.")
return null}return d.createElement("div",{className:(0,g.iv)(sv.benchlingAppDataAccessTabSection)},d.createElement("p",{className:(0,g.iv)(sv.description)},"The app has access to the following ",(0,de._6)(2,e.resourceType.toLowerCase())," in"," ",t.data.currentTenant.displayName," that you have access to. You can see which access policies the app has been granted per ",e.resourceType.toLowerCase()," and view more details on their effective permissions."),d.createElement("p",{className:(0,g.iv)(sv.description)},"This view is limited to ",(0,de._6)(2,e.resourceType.toLowerCase())," you can also access. As a result you may not see a complete list of all the ",(0,de._6)(2,e.resourceType.toLowerCase())," for which this app is a collaborator."),e.children)}function PolicyTable(e){switch(e.resourceType){case av.PROJECT:return d.createElement(BenchlingAppProjectPolicyTable,{appId:e.appId})
case av.REGISTRY:return d.createElement(BenchlingAppRegistryPolicyTable,{appId:e.appId})
default:(0,S.hu)(!1,`Unexpected resource type ${(0,Go.vE)(e.resourceType)}`)
return d.createElement(d.Fragment,null)}}function BenchlingAppDataAccessTab(e){(0,Ul.Z)((()=>{m.L9(j.zR.OPENED_PARTY_DATA_ACCESS_TAB,{objectType:"app",objectId:e.appId})}))
const[t,n]=(0,d.useState)(av.PROJECT)
return d.createElement(Db.W2,{size:"lg",className:(0,g.iv)(sv.container)},d.createElement(Db.X2,{className:(0,g.iv)(sv.containerRow)},d.createElement(Db.JX,{lg:4,className:f()("sidepanel",(0,g.iv)(sv.sidepanelColumn))},d.createElement(Sidepanel,{activeResourceType:t,onChangeActiveResourceType:n})),d.createElement(Db.JX,{lg:18},d.createElement(BenchlingAppDataAccessTabSection,{resourceType:t},d.createElement(PolicyTable,{resourceType:t,appId:e.appId})))))}const sv=g.mM.create({description:{fontSize:"13px",maxWidth:"1000px"},sidepanelColumn:{zIndex:0,position:"sticky",maxWidth:"182px",borderRight:`1px solid ${Vt.tN}`,boxShadow:"0px 0px",overflowX:"hidden"},container:{height:"100%",paddingLeft:0},containerRow:{height:"100%"},sidebarTitle:{padding:"20px 15px 5px 15px"},benchlingAppDataAccessTabSection:{padding:"35px 29px"}})
var rv=n(232493)
function BenchlingAppSessionActivityFilters(e){const t=e.allSessions;(0,d.useEffect)((()=>{filterSessions(e,t)}),[])
return d.createElement("div",{className:(0,g.iv)(ov.filterStyle)},d.createElement(Hu.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.MODIFIED_AT},{filterKey:Kn.Vm.SESSION_NAME},{filterKey:Kn.Vm.SESSION_STATUS}],secondaryFilterGroups:[],filters:[{key:Kn.Vm.MODIFIED_AT,value:e.modifiedAtFilter,operator:Kn.EF.IS},{key:Kn.Vm.SESSION_NAME,value:e.sessionNameFilter,operator:Kn.EF.CONTAINS},{key:Kn.Vm.SESSION_STATUS,value:e.sessionStatusFilter,operator:Kn.EF.IS_ONE_OF}],onChangeFilters:n=>{!function onChangeFilters(e,t,n){e.setOffset(0)
let a=e.modifiedAtFilter,i=e.sessionNameFilter,s=e.sessionStatusFilter
for(const t of n)switch(t.key){case Kn.Vm.MODIFIED_AT:e.setModifiedAtFilter(t.value)
a=t.value
break
case Kn.Vm.SESSION_NAME:e.setSessionNameFilter(t.value)
i=t.value
break
case Kn.Vm.SESSION_STATUS:e.setSessionStatusFilter([...t.value])
s=[...t.value]
break
default:(0,S.hu)(!1,`Unexpected filter key in BenchlingAppSessionActivityFilters: ${t.key}`)}filterSessions({...e,modifiedAtFilter:a,sessionNameFilter:i,sessionStatusFilter:s},t)}(e,t,n)},selectedSchema:null,clearButton:d.createElement(C.Co,{buttonStyle:C.ZJ.CIRCLE_ICON,size:C.qE.SMALL,onClick:()=>{!function clearFilters(e,t){e.setOffset(0)
e.setModifiedAtFilter({fromDatetime:null,toDatetime:null})
e.setSessionNameFilter(null)
e.setSessionStatusFilter([])
e.setFilteredSessions(t)}(e,t)},icon:"cross-thick"})}))}function filterSessions(e,t){e.setFilteredSessions(t.filter((t=>(null==e.modifiedAtFilter.fromDatetime||""===e.modifiedAtFilter.fromDatetime||t.modifiedAt>e.modifiedAtFilter.fromDatetime)&&(null==e.modifiedAtFilter.toDatetime||""===e.modifiedAtFilter.toDatetime||t.modifiedAt<e.modifiedAtFilter.toDatetime)&&(null==e.sessionNameFilter||t.name.includes(e.sessionNameFilter))&&(0===e.sessionStatusFilter.length||e.sessionStatusFilter.includes(t.status)))))}const ov=g.mM.create({filterStyle:{margin:"10px"}})
var lv=n(91971),cv=n(214918),dv=n(192978)
const uv=g.mM.create({messagesWrapper:{marginTop:"32px"},timestamp:{width:"auto",padding:"11px 12px 0px 0px",color:Vt.TG,fontSize:"12px",verticalAlign:"top",lineHeight:"16px"},message:{whiteSpace:"normal",width:"100%"}}),mv={[Sn.Gw.NONE]:"",[Sn.Gw.INFO]:"Info: ",[Sn.Gw.SUCCESS]:"Success: ",[Sn.Gw.WARNING]:"Warning: ",[Sn.Gw.ERROR]:"Error: "}
function BenchlingAppSessionMessageTimestamp(e){return d.createElement("td",{className:(0,g.iv)(uv.timestamp)},d.createElement(cv.h,{datetime:e.timestamp,showTimeInCell:!0}))}function BenchlingAppSessionActivityMessage(e){const t=mv[e.message.style],n=(0,dv.tg)(e.message.content)
return d.createElement("td",{className:(0,g.iv)(uv.message)},t,n)}function BenchlingAppSessionActivityMessagesTable(e){const t=e.session.allMessagesListing,n=d.createElement(so.Dx,{className:(0,g.iv)(pv.title)},"No messages recorded for this session.")
return function cardRow(e){return d.createElement("tr",{className:f()("messageRow",(0,g.iv)(pv.sessionMessageRow))},d.createElement("td",{key:"col1"}),d.createElement("td",{key:"col2",colSpan:3},d.createElement("div",{className:f()("messagesCard",(0,g.iv)(pv.messagesCard))},e)))}(0===t.total?n:function messagesTable(e){const t=e.messages,n=t.length<e.total
return d.createElement(d.Fragment,null,n?d.createElement("div",{className:(0,g.iv)(pv.limitMessage)},`${t.length} message limit applied`):null,d.createElement(so.Dx,{className:(0,g.iv)(pv.title)},"Messages"),d.createElement(rc.iA,{numRows:t.length,isCompact:!1,getRowClassName:()=>f()("simpleTable-row--noShadow",(0,g.iv)(pv.messageRow)),className:(0,g.iv)(pv.messagesTable)},d.createElement(rc.sg,{renderCell:e=>d.createElement(BenchlingAppSessionMessageTimestamp,{timestamp:t[e].timestamp})}),d.createElement(rc.sg,{renderCell:e=>d.createElement(BenchlingAppSessionActivityMessage,{message:t[e]})})))}(t))}const pv=g.mM.create({sessionMessageRow:{borderBottom:`1px solid ${Vt.tN}`},title:{fontSize:"12px"},limitMessage:{color:Vt.TG,float:"right"},messagesCard:{backgroundColor:Vt.bs,marginRight:"14px",marginBottom:"14px",padding:"12px",border:`1px solid ${Vt.tN}`,borderRadius:"4px"},messagesTable:{tableLayout:"auto",border:"none"},messageRow:{height:"36px"}})
var hv=n(260067)
function BenchlingAppSessionActivityTableRows(e){var t
const n=[]
for(const a of e.sessions){const i=null===(t=e.areRowsCollapsed.get(a.id))||void 0===t||t,setIsCollapsed=t=>{e.isCollapsedCallback(a.id,t)}
for(const e of generateRows(a,i,setIsCollapsed))n.push(e)}return d.createElement("tbody",{...(0,ee.Z)(e.dataTestAttrs)},...n)}function*generateRows(e,t,n){const a=e.id
yield d.createElement("tr",{key:a,className:(0,g.iv)(gv.sessionRow,t?gv.sessionRowClosed:null)},d.createElement("td",{className:(0,g.iv)(gv.triangleToggle)},d.createElement(lv.Z,{toggleLabel:"",isCollapsed:t,setIsCollapsed:n},d.createElement(d.Fragment,null))),d.createElement("td",{className:(0,g.iv)(gv.statusCell)},d.createElement(hv.Z,{status:e.status,dataTestAttrs:{component:"SessionStatusCell",key:a}})),d.createElement("td",{className:(0,g.iv)(gv.nameCell)},e.name),d.createElement("td",{className:(0,g.iv)(gv.timeCell)},d.createElement(cv.h,{datetime:e.modifiedAt,showTimeInCell:!0})))
t||(yield d.createElement(BenchlingAppSessionActivityMessagesTable,{key:`${a}_msgs`,session:e}))}const gv=g.mM.create({sessionRow:{height:"32px",borderCollapse:"separate",":hover":{background:Vt.bs},":hover + tr.messageRow":{backgroundColor:Vt.bs},":hover + tr.messageRow div.messagesCard":{backgroundColor:Vt.tN,border:`1px solid ${Vt.pF}`}},sessionRowClosed:{borderBottom:`1px solid ${Vt.tN}`},triangleToggle:{padding:"0px 12px"},statusCell:{paddingLeft:"0px",width:"20%"},nameCell:{paddingLeft:"0px",width:"45%"},timeCell:{paddingLeft:"0px",width:"35%"}})
const Ev=1e5
function ExportSessionActivityDropdown(e){return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(N.Z,{onSelect:()=>{runExportSessionActivityModal({appId:e.benchlingApp.id,modifiedAtFilter:{fromDatetime:null,toDatetime:null},sessionNameFilter:null,sessionStatusFilter:[]})}},"Export all activity   ",e.benchlingApp.sessionListing.total<=Ev?d.createElement(d.Fragment,null):d.createElement(pe.Z,{icon:"warning",className:(0,g.iv)(fv.warningIcon)})),d.createElement(N.Z,{onSelect:()=>{runExportSessionActivityModal({appId:e.benchlingApp.id,modifiedAtFilter:e.modifiedAtFilter,sessionNameFilter:e.sessionNameFilter,sessionStatusFilter:e.sessionStatusFilter})}},"Export filtered activity (",e.filteredSessions.length<=Ev?e.filteredSessions.length:Ev,")   ",e.filteredSessions.length<=Ev?d.createElement(d.Fragment,null):d.createElement(pe.Z,{icon:"warning",className:(0,g.iv)(fv.warningIcon)})))},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,icon:"ellipsis",isDropdown:!0,hideDropdownCaret:!0}))}function ExportSessionActivityModal(e){const[t,n]=d.useState()
return d.createElement(et.ZP,{enableRedesign:!0,title:"Export activity",onRequestClose:e.onRequestClose,medium:!0,onRequestSubmit:()=>{e.onRequestSubmit(t)},buttons:[{text:"Export",submit:!0,style:C.ZJ.PRIMARY,disabled:null==t}],dataTestAttrs:{component:"ExportSessionActivityModal",element:"root"}},d.createElement("div",{className:"form-group"},d.createElement($r.ZP,{displayName:null!=t?t:"Select export format",menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},d.createElement(N.Z,{onSelect:n,value:"CSV"},"CSV"),d.createElement(N.Z,{onSelect:n,value:"PDF"},"PDF")),dataTestAttrs:{component:"ExportSessionActivityModal",element:"dropdown"}})))}function runExportSessionActivityModal(e){(0,Xn.Z)(ExportSessionActivityModal,{onRequestSubmit:t=>{v.ZP.info("Exporting...");(function exportSessions(e){return an.ty({url:"/1/api/benchling-app-sessions:export",data:e})})({appId:e.appId,exportFormat:t,startTime:null!=e.modifiedAtFilter.fromDatetime?e.modifiedAtFilter.fromDatetime:void 0,endTime:null!=e.modifiedAtFilter.toDatetime?e.modifiedAtFilter.toDatetime:void 0,sessionName:null!=e.sessionNameFilter?e.sessionNameFilter:void 0,sessionStatuses:0!==e.sessionStatusFilter.length?e.sessionStatusFilter:void 0}).done((({url:e})=>{window.location.href=e
v.ZP.success("Export complete. Downloading...")})).fail((e=>{v.ZP.notifyError(e)}))}})}const fv=g.mM.create({warningIcon:{marginRight:"3px",color:Vt.ud}})
function NoSessionsCard(){return d.createElement("div",{className:(0,g.iv)(Sv.noSessionsCardWrapper)},d.createElement("div",{className:(0,g.iv)(Sv.noSessionsCard)},d.createElement(pe.Z,{icon:"info-circle",className:(0,g.iv)(Sv.noSessionsCardIcon)}),d.createElement(so.R6,{className:(0,g.iv)(Sv.noSessionsCardHeader)},"No sessions recorded"),d.createElement("div",null,"Sessions appear when",d.createElement("br",null),"apps have this feature implemented",d.createElement("br",null),"and have sent data to Benchling")))}const Sv=g.mM.create({noSessionsCardWrapper:{color:Vt.TG,width:"100%",height:"800px",textAlign:"center",paddingTop:"100px"},noSessionsCard:{margin:"auto",width:"40%",fontSize:"13px"},noSessionsCardHeader:{fontSize:"18px"},noSessionsCardIcon:{color:Vt.pF,fontSize:"30px",marginBottom:"8px"}}),yv=xa.Ps`
  query BenchlingAppActivitySessionsQuery($appId: StrictString!, $limitOffsetInput: LimitOffsetInput!)
  @skipAudit
  @engComponent(name: BENCHLING_APPS) {
    benchlingApp(id: $appId) {
      ... on BenchlingAppNode {
        id
        isActivityTabVisible
        sessionListing(limitOffsetInput: $limitOffsetInput) {
          total
          sessions {
            ...BenchlingAppSessionGraphQL
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("BenchlingAppSession").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function BenchlingAppSessionActivityTable(e){const[{limit:t,offset:n},{setLimit:a,setOffset:i}]=useLimitOffset(),[s,r]=(0,d.useState)(),[o,l]=(0,d.useState)({fromDatetime:null,toDatetime:null}),[c,u]=(0,d.useState)(null),[m,p]=(0,d.useState)([]),[h,E]=(0,d.useState)([]),[S,y]=(0,d.useState)([]),b=(0,Da.IJ)(yv,{variables:{appId:e.appId,limitOffsetInput:{limit:10,offset:0}},pollInterval:dt.ZP.BENCHLING_APP_SESSIONS_POLLING_FREQUENCY_MS,renderCachedDataWhenRefetching:!0,onCompleted:e=>{const t=e.benchlingApp
r(t);(0,ka.CZ)(t)||y(t.sessionListing.sessions)}})
return b.type===Da.NI.PENDING||b.type===Da.NI.ERROR||void 0===s?d.createElement(BenchlingAppSessionActivityPagedTable,{isLoading:!0,setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:0}}):(0,ka.CZ)(s)?d.createElement(d.Fragment,null):d.createElement(d.Fragment,null,s.isActivityTabVisible?0===s.sessionListing.total?d.createElement("div",null,d.createElement(so.R6,{className:(0,g.iv)(bv.activityHeader)},"Activity"),d.createElement(NoSessionsCard,null)):d.createElement("div",null,d.createElement("div",{className:f()("u-lr-split",(0,g.iv)(bv.activityHeader))},d.createElement(so.R6,null,"Activity"),d.createElement("div",{className:(0,g.iv)(bv.buttonStyling)},s.sessionListing.total<=Ev?d.createElement(d.Fragment,null):d.createElement(P.ZP,{title:"Data exceeds table limits. Only the most recent 100k rows of data are displayed and available for export.",container:"body"},d.createElement(pe.Z,{icon:"warning",className:(0,g.iv)(bv.warningIcon)})),"  ",d.createElement(ExportSessionActivityDropdown,{benchlingApp:s,modifiedAtFilter:o,sessionNameFilter:c,sessionStatusFilter:m,filteredSessions:h}))),d.createElement(BenchlingAppSessionActivityFilters,{modifiedAtFilter:o,setModifiedAtFilter:l,sessionNameFilter:c,setSessionNameFilter:u,sessionStatusFilter:m,setSessionStatusFilter:p,allSessions:S,setFilteredSessions:E,setOffset:i}),d.createElement(BenchlingAppSessionActivityPagedTable,{isLoading:!1,app:s,setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:h.length},filteredSessions:h})):d.createElement("div",{className:f()("u-lr-split","u-spacing-top",(0,g.iv)(bv.inaccessible))},d.createElement("div",null,d.createElement(so.R6,null,"Activity"),d.createElement("div",null,"Insufficient permissions to view app activity. Only the app's creator and tenant admins may view app activity."))))}function BenchlingAppSessionActivityPagedTable(e){function allClosedMap(){const t=new Map
if(!e.isLoading)for(const n of e.app.sessionListing.sessions)t.set(n.id,!0)
return t}const[t,n]=(0,d.useState)(allClosedMap())
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(bv.resultPagerContainer)},d.createElement("div",{className:(0,g.iv)(bv.resultPagerContainerContent)},d.createElement(zT.Z,{allowFastForwardAndBackward:!0,setOffset:e.setOffset,isLoading:e.isLoading,pagination:e.pagination})),d.createElement("div",{className:(0,g.iv)(bv.resultPagerContainerContent)},d.createElement(qT.Z,{pageSizeConfig:{availablePageSizes:jT,pageSize:e.pagination.limit,onSetPageSize:e.setLimit},iconAltText:"Results Per Page"})),d.createElement("div",{className:(0,g.iv)(bv.collapseButton),onClick:function collapseAll(){n(allClosedMap())}},"Collapse all")),e.isLoading?d.createElement(BenchlingAppSessionActivityTable_TableOrLoadingContainer,{...e}):d.createElement(BenchlingAppSessionActivityTable_TableOrLoadingContainer,{areRowsCollapsed:t,isCollapsedCallback:function setRowForSessionIsCollapsed(e,a){const i=new Map(t)
i.set(e,a)
n(i)},...e}))}function BenchlingAppSessionActivityTable_TableOrLoadingContainer(e){if(e.isLoading)return d.createElement("div",{className:(0,g.iv)(bv.tableOrLoadingContainer)},d.createElement(kl.b,null))
if(0===e.filteredSessions.length)return d.createElement(NoSessionsCard,null)
const t=e.filteredSessions,n=e.pagination.limit,a=e.pagination.offset,i=t.slice(a,a+n),s=d.createElement("tr",{className:(0,g.iv)(bv.header)},d.createElement("th",null),d.createElement(rc.bL,{className:(0,g.iv)(bv.headerCell),cellTypeOverride:rc.lT.HEADER},"Status"),d.createElement(rc.bL,{className:(0,g.iv)(bv.headerCell),cellTypeOverride:rc.lT.HEADER},"Session name"),d.createElement(rc.bL,{className:(0,g.iv)(bv.headerCell),cellTypeOverride:rc.lT.HEADER},"Modified at"))
return d.createElement("table",null,d.createElement("thead",null,s),d.createElement(BenchlingAppSessionActivityTableRows,{sessions:i,areRowsCollapsed:e.areRowsCollapsed,isCollapsedCallback:e.isCollapsedCallback,dataTestAttrs:{component:"SessionActivityTableRows",element:"root"}}))}const bv=g.mM.create({inaccessible:{padding:"16px 24px",borderBottom:`1px solid ${Vt.tN}`},activityHeader:{height:"48px",lineHeight:"48px",paddingLeft:"12px",marginBottom:"0px",borderBottom:"1px solid #E8F0F2"},header:{height:"32px",background:Vt.bs,borderBottom:`1px solid ${Vt.tN}`},headerCell:{paddingLeft:"0px"},collapseButton:{display:"inline-block",marginTop:"5px",marginLeft:"8px",cursor:"pointer",color:Vt.pp,":hover":{color:Vt.t0}},resultPagerContainer:{...jf.lC,...jf.S1,paddingLeft:12},resultPagerContainerContent:{display:"inline-block",verticalAlign:"top"},tableOrLoadingContainer:{...jf.S1,width:"100%"},buttonStyling:{margin:"10px"},warningIcon:{marginRight:"3px",color:Vt.ud}})
var Tv=n(900793)
function BenchlingAppLifecycleButton(e){let t,n,a
if(e.isLoading){t=d.createElement(C.Co,{text:"",buttonStyle:C.ZJ.TERTIARY_WHITE,icon:d.createElement(pe.Z,{icon:"refresh",className:"glyphicon-spin"}),disabled:!0,size:C.qE.SMALL,onClick:()=>{},textColor:Vt.pF})
n=d.createElement(d.Fragment,null)
a=""}else switch(e.appLifecycleState){case Sn.qt.INACTIVE:t=d.createElement(C.Co,{dataTestAttrs:{component:"BenchlingAppLifecycleButton",element:"Button"},text:"Activate",buttonStyle:C.ZJ.PRIMARY,icon:d.createElement(d.Fragment,null),disabled:e.missingWebhookUrl,size:C.qE.SMALL,onClick:async function handleActivateBenchlingApp(){e.pollingStartTime.current=(new Date).getTime()
const t=await Tv.kJ(e.appId)
e.pollForChangeComplete(t)
await e.refetch()},textColor:Vt.Cj})
n=d.createElement(pe.Z,{icon:"dot",color:Vt.pF})
a="Inactive"
break
case Sn.qt.ACTIVE:t=d.createElement(C.Co,{dataTestAttrs:{component:"BenchlingAppLifecycleButton",element:"Button"},text:"Deactivate",buttonStyle:C.ZJ.TERTIARY_WHITE,icon:d.createElement(d.Fragment,null),disabled:e.missingWebhookUrl,size:C.qE.SMALL,onClick:async function handleDeactivateBenchlingApp(){if(await Tv.z0()){e.pollingStartTime.current=(new Date).getTime()
const t=await Tv.wC(e.appId)
e.pollForChangeComplete(t)
await e.refetch()}},textColor:Vt.hM})
n=d.createElement(pe.Z,{icon:"done",color:Vt.ZA})
a="Active"
break
case Sn.qt.ACTIVATE_PENDING:t=d.createElement(C.Co,{dataTestAttrs:{component:"BenchlingAppLifecycleButton",element:"Button"},text:"Activating",buttonStyle:C.ZJ.PRIMARY,icon:d.createElement(pe.Z,{icon:"refresh",className:"glyphicon-spin"}),disabled:!0,size:C.qE.SMALL,onClick:()=>{},textColor:Vt.Cj})
n=d.createElement(pe.Z,{icon:"dot",color:Vt.pF})
a="Inactive"
break
case Sn.qt.DEACTIVATE_PENDING:t=d.createElement(C.Co,{dataTestAttrs:{component:"BenchlingAppLifecycleButton",element:"Button"},text:"Deactivating",buttonStyle:C.ZJ.TERTIARY_WHITE,icon:d.createElement(pe.Z,{icon:"refresh",className:"glyphicon-spin"}),disabled:!0,size:C.qE.SMALL,onClick:()=>{},textColor:Vt.hM})
n=d.createElement(pe.Z,{icon:"done",color:Vt.ZA})
a="Active"
break
default:(0,Go.vE)(e.appLifecycleState)
t=d.createElement(d.Fragment,null)
n=d.createElement(d.Fragment,null)
a="Inactive"}const i=d.createElement("div",{className:f()((0,g.iv)(vv.appState))},n," ",a)
return d.createElement(so.R6,{className:f()("u-lr-split","u-spacing-top",(0,g.iv)(vv.appTitle))},d.createElement("div",null,e.name,"     ",e.appActivationViewable&&!e.isLoading&&i),(e.appActivationViewable||e.isLoading)&&d.createElement(P.ZP,{title:"App requires a Webhook URL to activate. Go to Feature Settings > Developer Console > Apps to add.",disabled:!e.missingWebhookUrl,placement:P.TQ.LEFT},t))}const vv=g.mM.create({appTitle:{padding:"14px 12px 12px 14px",backgroundColor:`${Vt.Cj}`,marginBottom:"0px",position:"sticky",zIndex:1,top:0},appState:{display:"inline",fontSize:"13px"}})
var Cv=n(901138),Iv=n(907639),wv=n(288758),Nv=n(467922),Av=n(615937)
const Rv=xa.Ps`
  query BenchlingAdminCheckQuery @skipAudit @engComponent(name: BENCHLING_APPS) {
    currentUser {
      id
      isTenantAdmin
    }
  }
`,Pv=xa.Ps`
  query getBenchlingAppLifecycleStateQuery($benchlingAppId: StrictString!)
  @skipAudit
  @engComponent(name: BENCHLING_APPS) {
    benchlingApp(id: $benchlingAppId) {
      ... on BenchlingAppNode {
        id
        lifecycleState
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function BenchlingAppDetailsGeneral({id:e,name:t,archived:n,description:a,lastSeen:i,creator:s,versionNumber:r,appDefinitionId:o,refetchResults:l}){return d.createElement("div",{className:f()((0,g.iv)(Ov.detailsGeneral))},d.createElement(so.R6,{className:f()((0,g.iv)(Ov.header))},"General",!n&&d.createElement(P.ZP,{title:"Archive"},d.createElement("div",{className:f()((0,g.iv)(Ov.rightAlignedButton))},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"archive",size:C.qE.SMALL,onClick:()=>{(0,Cv.lf)([{archived:!1,id:e,name:t}],l)}}))),n&&d.createElement(P.ZP,{title:"Unarchive"},d.createElement("div",{className:f()((0,g.iv)(Ov.rightAlignedButton))},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"unarchive",size:C.qE.SMALL,onClick:()=>{(0,Cv.nL)([{archived:!0,id:e,name:t}],l)}}))),d.createElement(P.ZP,{title:"App Listing"},d.createElement("div",{className:f()((0,g.iv)(Ov.rightAlignedButton))},o&&d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"book",size:C.qE.SMALL,onClick:()=>{(0,ac.ZP)(`/app-catalog/apps/${o}/install`)}})))),d.createElement("div",{className:f()("u-lr-split",(0,g.iv)(Ov.detailRow))},r&&d.createElement("div",null,d.createElement(so.Dx,null,"Version"),d.createElement(Nv.Z,{value:r})),d.createElement("div",null,d.createElement(so.Dx,null,"Last Seen"),d.createElement(Nv.Z,{value:i?(0,Kl.Z)(i):"App has no activity to show."})),d.createElement("div",null,d.createElement(so.Dx,null,"Author"),d.createElement(wv.Z,{parties:[s],useAvatar:!0}))),d.createElement("div",{className:(0,g.iv)(Ov.detailRow)},d.createElement(so.Dx,null,"Description"),d.createElement(Iv.Z,{value:a})),d.createElement("br",null),d.createElement("div",{className:(0,g.iv)(Ov.canvasContainer)},d.createElement(Av.ZP,{resourceId:e,featureType:Sn.a4.APP_HOMEPAGE,enabledOverride:!0})))}function BenchlingAppDetailsStatus({id:e,webhookConfigurations:t,lifecycleManagement:n,name:a}){const i=(0,d.useRef)(0),s=(0,d.useRef)(),r=(0,Da.IJ)(Rv),o=(0,Da.IJ)(Pv,{variables:{benchlingAppId:e},fetchPolicy:"network-only"}),l=0!==t.length
if(o.type===Da.NI.PENDING||r.type===Da.NI.PENDING)return d.createElement(BenchlingAppLifecycleButton,{appId:e,appLifecycleState:Sn.qt.INACTIVE,pollForChangeComplete:pollForLifecycleChangeResult,pollingStartTime:i,name:a,appActivationViewable:!1,refetch:o.refetch,isLoading:!0,missingWebhookUrl:!l})
if(o.type===Da.NI.ERROR){v.ZP.error("Unable to load app. Please try again.")
return d.createElement(d.Fragment,null)}if(r.type===Da.NI.ERROR){v.ZP.error("Unable to load current user. Please try again.")
return d.createElement(d.Fragment,null)}if((0,ka.CZ)(o.data.benchlingApp))return d.createElement(d.Fragment,null)
const c=o.data.benchlingApp,u=r.data.currentUser.isTenantAdmin,m=n===Sn.o4.AUTOMATIC&&dt.ZP.ENABLE_BENCHLING_APPS_ACTIVATION_FOR_TENANT_ADMINS&&u
async function pollForLifecycleChangeResult(e){const t=await(0,Tv.NS)(e)
if("success"===t)!function lifecycleTaskSuccess(e){if(e===Sn.qt.INACTIVE||e===Sn.qt.ACTIVATE_PENDING){v.ZP.success("Successfully activated app.")
o.refetch()}else if(e===Sn.qt.ACTIVE||e===Sn.qt.DEACTIVATE_PENDING){v.ZP.success("Successfully deactivated app.")
o.refetch()}}(c.lifecycleState)
else if("failure"===t)!function lifecycleTaskFailure(e){if(e===Sn.qt.INACTIVE||e===Sn.qt.ACTIVATE_PENDING){v.ZP.error("Failed to activate app. Please try again or contact Benchling Support if the issue persists.")
o.refetch()}else if(e===Sn.qt.ACTIVE||e===Sn.qt.DEACTIVATE_PENDING){v.ZP.error("An error occurred while deactivating the app. The app is deactivated, but the app developer may not have been notified.")
o.refetch()}}(c.lifecycleState)
else{if((new Date).getTime()-i.current<5e3){const t=setTimeout((()=>{pollForLifecycleChangeResult(e)}),2e3)
s.current=t}else if(s.current){clearTimeout(s.current)
!function lifecycleTaskTimeout(e){if(e===Sn.qt.INACTIVE||e===Sn.qt.ACTIVATE_PENDING){v.ZP.error("activate request timed out. Please try again or contact Benchling Support if the issue persists.")
o.refetch()}else if(e===Sn.qt.ACTIVE||e===Sn.qt.DEACTIVATE_PENDING){v.ZP.error("deactivate request timed out. Please try again or contact Benchling Support if the issue persists.")
o.refetch()}}(c.lifecycleState)}}}return d.createElement(BenchlingAppLifecycleButton,{appId:e,appLifecycleState:c.lifecycleState,pollForChangeComplete:pollForLifecycleChangeResult,pollingStartTime:i,name:a,appActivationViewable:m,refetch:o.refetch,isLoading:!1,missingWebhookUrl:!l})}const Ov=g.mM.create({header:{height:"48px",lineHeight:"48px",padding:"0px 24px",borderBottom:`1px solid ${Vt.tN}`},detailRow:{marginTop:"16px",padding:"0px 24px"},detailsGeneral:{paddingBottom:"16px"},canvasContainer:{margin:"0px 24px"},rightAlignedButton:{float:"right",marginLeft:"7px"}}),xv=xa.Ps`
  fragment BenchlingAppDetailsGeneralBenchlingApp on BenchlingAppNode {
    id
    archived
    name
    description
    lastSeen
    lifecycleState
    creator {
      id
      handle
      name
      avatar_url: avatarUrl
    }
    webhookConfigurations {
      ... on InaccessibleInfoNode {
        invalidId
      }
      ... on WebhookConfigurationNode {
        id
      }
    }
    lifecycleManagement
    versionNumber
    appDefinitionId
  }
`,_v=xa.Ps`
  query getBenchlingAppDetailsQuery($benchlingAppId: StrictString!)
  @skipAudit
  @engComponent(name: BENCHLING_APPS) {
    benchlingApp(id: $benchlingAppId) {
      ... on BenchlingAppNode {
        id
        ...BenchlingAppDetailsGeneralBenchlingApp
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${xv}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,Dv="BENCHLING_APP_DETAILS_OVERVIEW"
function BenchlingAppDetails({benchlingAppId:e}){const[t,n]=(0,d.useState)(Dv),a=(0,Da.IJ)(_v,{variables:{benchlingAppId:e}})
if(a.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(a.type===Da.NI.ERROR){v.ZP.error("Unable to load app. Please try again.")
return d.createElement(d.Fragment,null)}if((0,ka.CZ)(a.data.benchlingApp))return d.createElement(Ll.Z,{inaccessibleInfo:a.data.benchlingApp,modelType:st.BENCHLING_APP})
const i=a.data.benchlingApp
return d.createElement("div",{className:(0,g.iv)(Lv.pageContainer),...(0,ee.Z)({component:"BenchlingAppDetails",element:"root"})},d.createElement(BenchlingAppDetailsStatus,{...i}),d.createElement(sp.Xl,{className:(0,g.iv)(Lv.tabContainer),activeTab:t,navClassName:f()((0,g.iv)(Lv.stickyNav)),paneClassName:f()("u-flex-grow","scrollbar-override",(0,g.iv)(Lv.container)),onRequestTabChange:n},d.createElement(sp.OK,{tabKey:Dv,title:"GENERAL"},d.createElement("div",{className:(0,g.iv)(Lv.contentCard)},d.createElement(BenchlingAppDetailsGeneral,{...i,refetchResults:async()=>{await a.refetch()}}))),d.createElement(sp.OK,{tabKey:"BENCHLING_APP_DETAILS_CONFIGURATION",title:"CONFIGURATION"},d.createElement("div",{className:(0,g.iv)(Lv.contentCard),...(0,ee.Z)({component:"BenchlingAppConfigurationSection",element:"root"})},d.createElement(rv.ZP,{benchlingAppId:e}))),d.createElement(sp.OK,{tabKey:"BENCHLING_APP_DETAILS_ACCESS",title:"ACCESS"},d.createElement("div",{className:(0,g.iv)(Lv.content)},d.createElement(BenchlingAppDataAccessTab,{appId:e}))),d.createElement(sp.OK,{tabKey:"BENCHLING_APP_DETAILS_ACTIVITY",title:"ACTIVITY"},d.createElement("div",{className:(0,g.iv)(Lv.contentCard)},d.createElement(BenchlingAppSessionActivityTable,{appId:e})))))}const Lv=g.mM.create({pageContainer:{height:"calc(100% - 50px)"},tabContainer:{height:"100%"},container:{height:"calc(100% - 37px)",overflow:"auto",marginTop:"0px"},contentCard:{margin:"24px auto",maxWidth:"840px",backgroundColor:`${Vt.Cj}`,borderRadius:"3px"},content:{margin:"0px",height:"100%"},stickyNav:{position:"sticky",zIndex:1,top:"50px",paddingBottom:"0px",backgroundColor:`${Vt.Cj}`,height:"36px",marginBottom:"0px",padding:"10px 12px 6px 14px"},appTitle:{padding:"14px 12px 12px 14px",backgroundColor:`${Vt.Cj}`,marginBottom:"0px",position:"sticky",zIndex:1,top:0}}),kv=g.mM.create({background:{backgroundColor:"#f5f8fa"}})
class BenchlingAppTabView extends s().View{static initClass(){this.prototype.className=f()("buffer-tab buffer-tab--no-padding",(0,g.iv)(kv.background))}render(){(0,Me.A9)(d.createElement(BenchlingAppDetails,{benchlingAppId:this.model.get("benchlingAppId")}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}BenchlingAppTabView.initClass()
var Mv=n(774613),Fv=n(581197),Zv=n(610789)
const Bv=xa.ZP`
  query MoleculeCanonicalSmilesQuery($moleculeId: StrictString!, $moleculeVersionId: StrictString!)
  @skipAudit
  @engComponent(name: CHEMISTRY) {
    molecule(id: $moleculeId) {
      ... on MoleculeNode {
        id
        version(versionId: $moleculeVersionId) {
          id
          chemicalStructure {
            id
            canonicalSmiles
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function MoleculeCanonicalSmiles(e){return d.createElement(Da.ZP,{query:Bv,variables:{moleculeId:e.moleculeId,moleculeVersionId:e.moleculeVersionId},renderLoading:()=>d.createElement(kl.b,null)},(e=>{if((0,ka.CZ)(e.molecule))return d.createElement("div",null,"You do not have access to view this molecule. Please ask your administrator for access.")
const t=e.molecule.version?e.molecule.version.chemicalStructure.canonicalSmiles:"Chemical structure for this version not found"
return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(qv.fieldHeader)},"Canonical SMILES"),d.createElement("div",{className:(0,g.iv)(qv.fieldValue),...(0,ee.Z)({component:"MoleculeChemicalStructure",element:"canonicalSmiles"})},t))}))}const qv=g.mM.create({fieldHeader:{fontWeight:"bold",margin:"4px 0px",paddingTop:"10px"},fieldValue:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"6px 12px",background:Zv.W,border:Zv.S,boxSizing:"border-box",borderRadius:"4px",overflowWrap:"anywhere"}}),Vv=xa.ZP`
  query MoleculeChemicalFormulaQuery($moleculeId: StrictString!, $moleculeVersionId: StrictString!)
  @skipAudit
  @engComponent(name: CHEMISTRY) {
    molecule(id: $moleculeId) {
      ... on MoleculeNode {
        id
        version(versionId: $moleculeVersionId) {
          id
          chemicalStructure {
            id
            chemicalFormula {
              ... on ChemicalFormulaNode {
                value
              }
              ... on ErrorNode {
                message
              }
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function MoleculeChemicalFormula(e){return d.createElement(Da.ZP,{query:Vv,variables:{moleculeId:e.moleculeId,moleculeVersionId:e.moleculeVersionId},renderLoading:()=>d.createElement(kl.b,null)},(e=>(0,ka.CZ)(e.molecule)?d.createElement("div",null,"You do not have access to view this molecule. Please ask your administrator for access."):function isError(e){return"ErrorNode"===e.__typename}(e.molecule.version.chemicalStructure.chemicalFormula)?d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(Uv.fieldHeader)},"Chemical Formula"),d.createElement("div",{className:(0,g.iv)(Uv.fieldValue)},e.molecule.version.chemicalStructure.chemicalFormula.message)):d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(Uv.fieldHeader)},"Chemical Formula"),d.createElement("div",{className:(0,g.iv)(Uv.fieldValue)},d.createElement("div",null,e.molecule.version.chemicalStructure.chemicalFormula.value.split("").map(((e,t)=>/^\d+$/.test(e)?d.createElement("sub",{key:`chem-formula-${t}`},e):e)))))))}const Uv=g.mM.create({fieldHeader:{fontWeight:"bold",margin:"4px 0px"},fieldValue:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"6px 12px",background:Zv.W,border:Zv.S,boxSizing:"border-box",borderRadius:"4px"}})
var Gv=n(181319)
class MoleculeChemicalStructureTabConnector extends oi.C{enhanceProps(){return{moleculeVersionId:this.reduxState().ui.chemistry.moleculeVersionUIs[this.props.moleculeId].moleculeVersionId}}}const zv=MoleculeChemicalStructureTabConnector.connect((function MoleculeChemicalStructureTab(e){return d.createElement("div",{className:"chemical-structure-tab"},!e.molecule.allowChemicalStructureEdits()&&d.createElement(Fv.Z,{banner:e.molecule.getBannerText()}),d.createElement("div",{className:"react-tab-container"},d.createElement(Gv.ZP,{...e,size:Gv.Y8.FULL_SIZE,editable:e.molecule.allowChemicalStructureEdits()}),d.createElement(MoleculeChemicalFormula,{...e}),d.createElement(MoleculeCanonicalSmiles,{...e})))}))
class MoleculeChemicalStructureTabView extends Js{render(){const e={moleculeId:this.model.get("moleculeId"),molecule:this.model.get("molecule")};(0,Me.A9)(d.createElement(zv,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}MoleculeChemicalStructureTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var $v=n(835476),Wv=n(306258)
function MoleculePropertyItem({chemicalProperty:e,value:t,error:n}){return d.createElement("div",{className:"simpleDivTable-row",key:e},d.createElement("div",{className:f()("simpleDivTable-cell",(0,g.iv)(Hv.propertyNameColumn))},Wv.UH[e]),d.createElement("div",{className:f()("simpleDivTable-cell",(0,g.iv)(Hv.valueColumn)),...(0,ee.Z)({component:"MoleculePropertyItem",element:"propertyValue",key:`${e}`})},null!=n?n:t))}const Hv=g.mM.create({propertyNameColumn:{flex:1},valueColumn:{flex:2},smallHeader:{..._n.E0}}),jv=xa.ZP`
  fragment MoleculeFloatProperty on FloatPropertyOrErrorNode {
    ... on FloatPropertyNode {
      value
    }
    ... on ErrorNode {
      message
    }
  }
`,Yv=xa.ZP`
  fragment MoleculeIntProperty on IntPropertyOrErrorNode {
    ... on IntPropertyNode {
      value
    }
    ... on ErrorNode {
      message
    }
  }
`,Qv=xa.ZP`
  query MoleculePhysicochemicalPropertiesQuery($moleculeId: StrictString!, $moleculeVersionId: StrictString!)
  @skipAudit
  @engComponent(name: CHEMISTRY) {
    molecule(id: $moleculeId) {
      ... on MoleculeNode {
        id
        version(versionId: $moleculeVersionId) {
          id
          chemicalStructure {
            id
            molecularWeight {
              ... on MolecularWeightNode {
                value
              }
              ... on ErrorNode {
                message
              }
            }
            exactMolecularWeight {
              ...MoleculeFloatProperty
            }
            atomCount {
              ...MoleculeIntProperty
            }
            heavyAtomCount {
              ...MoleculeIntProperty
            }
            hydrogenAcceptorCount {
              ...MoleculeIntProperty
            }
            hydrogenDonorCount {
              ...MoleculeIntProperty
            }
            logp {
              ...MoleculeFloatProperty
            }
            molarRefractivity {
              ...MoleculeFloatProperty
            }
            rotatableBondCount {
              ...MoleculeIntProperty
            }
            tpsa {
              ...MoleculeFloatProperty
            }
            aromaticRingCount {
              ...MoleculeIntProperty
            }
            ringCount {
              ...MoleculeIntProperty
            }
            sp3AtomCount {
              ...MoleculeIntProperty
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${jv}
  ${Yv}
`
class MoleculePhysicochemicalPropertiesConnector extends oi.C{enhanceProps(){return{moleculeVersionId:this.reduxState().ui.chemistry.moleculeVersionUIs[this.props.moleculeId].moleculeVersionId}}}const Kv=MoleculePhysicochemicalPropertiesConnector.connect((function MoleculePhysicochemicalProperties(e){return d.createElement(Da.ZP,{query:Qv,variables:{moleculeId:e.moleculeId,moleculeVersionId:e.moleculeVersionId},renderLoading:()=>d.createElement(kl.b,null)},(e=>(0,ka.CZ)(e.molecule)?d.createElement("div",null,"You do not have access to view this molecule. Please ask your administrator for access."):d.createElement("div",null,d.createElement("div",{className:"simpleDivTable"},d.createElement("div",{className:`simpleDivTable-header ${(0,g.iv)(Jv.smallHeader)}`},d.createElement("div",{className:`simpleDivTable-headerCell ${(0,g.iv)(Jv.propertyNameColumn)}`},"PROPERTY"),d.createElement("div",{className:`simpleDivTable-headerCell ${(0,g.iv)(Jv.valueColumn)}`},"VALUE")),function getMoleculePropertyItemPropsFromStructure(e){const t=[],{molecularWeight:n,exactMolecularWeight:a,atomCount:i,heavyAtomCount:s,sp3AtomCount:r,hydrogenAcceptorCount:o,hydrogenDonorCount:l,logp:c,ringCount:d,aromaticRingCount:u,rotatableBondCount:m,tpsa:p,molarRefractivity:h}=e;[{chemicalProperty:Wv.m7.MOLECULAR_WEIGHT,propertyData:n},{chemicalProperty:Wv.m7.EXACT_MOLECULAR_WEIGHT,propertyData:a},{chemicalProperty:Wv.m7.ATOM_COUNT,propertyData:i},{chemicalProperty:Wv.m7.HEAVY_ATOM_COUNT,propertyData:s},{chemicalProperty:Wv.m7.SP3_ATOM_COUNT,propertyData:r},{chemicalProperty:Wv.m7.HYDROGEN_ACCEPTOR_COUNT,propertyData:o},{chemicalProperty:Wv.m7.HYDROGEN_DONOR_COUNT,propertyData:l},{chemicalProperty:Wv.m7.RING_COUNT,propertyData:d},{chemicalProperty:Wv.m7.NUM_AROMATIC_RINGS,propertyData:u},{chemicalProperty:Wv.m7.ROTATABLE_BOND_COUNT,propertyData:m},{chemicalProperty:Wv.m7.LOGP,propertyData:c},{chemicalProperty:Wv.m7.TOPOLOGICAL_POLAR_SURFACE_AREA,propertyData:p},{chemicalProperty:Wv.m7.MOLAR_REFRACTIVITY,propertyData:h}].forEach((({chemicalProperty:e,propertyData:n})=>{if("ErrorNode"===n.__typename)t.push({chemicalProperty:e,value:null,error:n.message})
else{const a="FloatPropertyNode"===n.__typename||"MolecularWeightNode"===n.__typename?n.value.toFixed(3):n.value
t.push({chemicalProperty:e,value:a,error:null})}}))
return t}(e.molecule.version.chemicalStructure).map((({chemicalProperty:e,value:t,error:n})=>d.createElement(MoleculePropertyItem,{key:e,chemicalProperty:e,value:t,error:n})))))))})),Jv=g.mM.create({propertyNameColumn:{flex:1},valueColumn:{flex:2},smallHeader:{..._n.E0}})
class MoleculePhysicochemicalPropertiesTabView extends Js{render(){const e={moleculeId:this.model.get("moleculeId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(Kv,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}MoleculePhysicochemicalPropertiesTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var Xv=n(663117),eC=n(103171),tC=n(176792),nC=n(601771),aC=n(129187),iC=n(682170),sC=n(612092),rC=n(893424),oC=n(200465),lC=n(402360),cC=n(188663),dC=n(581210)
var uC=n(876831),mC=n(407307),pC=n(251808),hC=n(978980),gC=n(115902)
class MetadataTagTable extends d.Component{constructor(){super(...arguments)
this.state={isEditing:!1,tags:this.props.initialTags}
this.getEditableTags=()=>this.state.tags.filter((e=>null!=e))
this.handleEdit=()=>{this.setState({isEditing:!0})}
this.handleCreateTag=()=>{this.setState({isEditing:!0,tags:Q()(this.state.tags,{$push:[{name:"",value:"",url:"",schemaFieldSelectorOptionIds:null,targetBatches:null,targetFiles:null}]})})}
this.handleUpdateTag=(e,t)=>{const n=Q()(this.state.tags[e],{$merge:t})
this.setState({tags:Q()(this.state.tags,{$merge:{[e]:n}})})}
this.handleRemoveTag=e=>{this.state.isEditing?e>=this.props.initialTags.length?this.setState({tags:Q()(this.state.tags,{$splice:[[e,1]]})}):this.setState({tags:Q()(this.state.tags,{[e]:{$set:null}})}):this.handleSaveUpdates([{currentTag:this.state.tags[e],updatedTag:null}])}
this.handleCancelUpdate=()=>{this.setState({isEditing:!1,tags:this.props.initialTags})}
this.validateTags=()=>{const e=this.getEditableTags(),t=e.map((e=>e.name)),n=this.props.fieldsForCustomTagNameValidation.find((e=>t.includes(e.name)))
return null!=n?(0,mC.Z)(n)?"Field name conflicts with a name of an archived field.":"Two fields cannot have the same name.":t.some((e=>!e))?"Field names cannot be empty.":t.length!==new Set(t).size?"Two fields cannot have the same name.":this.props.showRequiredFieldErrors&&!this.hasValueForAllRequiredFields(e)?"Missing values for required fields":null}
this.getUpdatesArray=()=>{const e=l.default.zip(this.props.initialTags,this.state.tags).map((([e,t])=>{if(Is()(e,t))return null
const n=null!=e?pC.xB(e):null,a=null!=t?pC.xB(t):null
return{currentTag:e?{name:e.name}:null,updatedTag:t?{name:t.name,tagUpdateParams:Is()(n,a)?null:a}:null}}))
return l.default.compact(e)}
this.handleCompleteUpdate=()=>{const e=this.validateTags()
if(e){v.ZP.error(e)
return}if(!pC.$2(this.getEditableTags()))return
this.setState({isEditing:!1})
const t=this.getUpdatesArray()
this.handleSaveUpdates(t)}
this.handleSaveUpdates=async e=>{const t={},n=[],a={},i=e.filter((e=>Boolean(e.currentTag))).map((e=>{var t
return null===(t=e.currentTag)||void 0===t?void 0:t.name}));(0,S.hu)(i.length===new Set(i).size,"Cannot update the same tag twice")
e.forEach((({currentTag:e,updatedTag:i})=>{if(null==e){if(null!=i&&null!=i.name)if(null!=l.default.findWhere(this.props.initialTags,{name:i.name})||this.props.fieldsForCustomTagNameValidation.some((e=>e.name===(null==i?void 0:i.name))))v.ZP.error("Cannot add two fields with the same name.")
else{(0,S.hu)(null!=i.tagUpdateParams,"TagUpdateParams only null on rename action")
t[i.name]=i.tagUpdateParams}}else if(null==i)n.push(e.name)
else{i.tagUpdateParams&&(t[e.name]=i.tagUpdateParams)
i.name!==e.name&&(a[e.name]=i.name)}}))
if(Object.keys(t).length>0||n.length>0||Object.keys(a).length>0){await this.props.updateTags({toSet:t,toRemove:n,toRename:a},{onFailure:this.handleEdit})||this.handleEdit()}}
this.handleKeyDown=e=>{if((0,pn.isEnterKey)(e)){e.preventDefault()
this.handleCompleteUpdate()}else if((0,pn.isEscapeKey)(e)){e.preventDefault()
this.handleCancelUpdate()}}}UNSAFE_componentWillReceiveProps(e){Is()(this.props.initialTags,e.initialTags)||this.setState({isEditing:!1,tags:e.initialTags})}getRequiredFieldValidationErrors(){const e=pC.EF(this.getEditableTags()).filter((e=>e.tagSchemaField.isRequired))
return(0,tm.ZP)(this.props.errorsByFieldId,(t=>{for(const{tagSchemaField:n}of e){const e=n.id,a=(0,gC.VD)(n)
t.hasOwnProperty(e)?t[e].push(a):t[e]=[a]}}))}hasValueForAllRequiredFields(e){return pC.EF(e).filter((e=>e.tagSchemaField.isRequired)).every((e=>pC.qd(e)))}render(){return d.createElement(hC.Z,{canAddOrRemoveTags:this.props.canAddOrRemoveTags,canRefreshTags:this.props.canRefreshTags,emptyMessage:this.props.emptyMessage,errorsByFieldId:this.state.isEditing&&this.props.showRequiredFieldErrors?this.getRequiredFieldValidationErrors():this.props.errorsByFieldId,fileId:this.props.fileId,itemLinkAllowed:this.props.itemLinkAllowed,hoistedTags:this.props.hoistedTags,hoistedTagSchemaGraphs:this.props.hoistedTagSchemaGraphs,tags:this.state.tags,showEditButtons:this.props.areTagsEditable,isLoadingTags:this.props.isLoadingTags,isNameEditable:this.props.isNameEditable,onAnalyzeProteins:this.props.onAnalyzeProteins,registryId:this.props.registryId,sequenceParts:this.props.sequenceParts,subheaderNode:this.props.subheaderNode,title:this.props.title,isEditing:this.state.isEditing,onUpdateTag:this.handleUpdateTag,onCreateTag:this.handleCreateTag,onRemoveTag:this.handleRemoveTag,onEdit:this.handleEdit,onCompleteUpdate:this.handleCompleteUpdate,onCancelUpdate:this.handleCancelUpdate,onKeyDown:this.handleKeyDown,autofillBanner:this.props.autofillBanner,showFieldDescriptions:this.props.showFieldDescriptions})}}MetadataTagTable.defaultProps={canAddOrRemoveTags:!1,canRefreshTags:!1,errorsByFieldId:{},itemLinkAllowed:!0,fieldsForCustomTagNameValidation:[],hoistedTags:[],hoistedTagSchemaGraphs:[],areTagsEditable:!1,isLoadingTags:!1,isNameEditable:!1,sequenceParts:[],showFieldDescriptions:!1}
const EC=MetadataTagTable
var fC=n(281100),SC=n(309718)
function DatasetDetails(e){const t=e.dataset,n=t.id,a=t.permissions.writable
return d.createElement("div",{className:"react-tab-container"},d.createElement("div",null,d.createElement("div",null,d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{xs:6},d.createElement(uC.Z,{initialAlias:t.name,isFullWidth:!0,isHeader:!0,isWritable:a,complete:async t=>{await function updateDataset(e){const t=[e]
return(0,Cn.Ry)({url:(0,dC.Kq)(cC.J.DATASET),data:{updates:t}})}({id:n,name:t})
e.reload()},placeholder:"Name"}),d.createElement(lC.Z,{item:{...t,archiveRecord:t.archiveRecord}}))))),d.createElement("div",{className:"u-spacing-top"},d.createElement(Ke.Z,null,d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{xs:4},d.createElement(so.Dx,null,"Origin Type"),d.createElement("div",null,t.originType)),d.createElement(p.Z,{xs:4},d.createElement(so.Dx,null,"Project"),d.createElement("div",null,t.folder.sourceJson.name)),d.createElement(p.Z,{xs:4},d.createElement(so.Dx,null,"Creator"),d.createElement("div",null,d.createElement(fC.Z,{className:"u-mini-spacing-right",size:SC.D.XXSMALL,entity:t.creator}),t.creator.name)))),d.createElement("div",{className:"u-spacing-top"},d.createElement(Ke.Z,null,d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{xs:4},d.createElement(so.Dx,null,"Created At"),d.createElement("div",null,Hr.UT(t.createdAt))),d.createElement(p.Z,{xs:4},d.createElement(so.Dx,null,"Folder"),d.createElement(Ye.Z,{value:t.folder.id,showInventory:!0,readOnly:!0,unsetOnFetchFail:!1})),d.createElement(p.Z,{xs:4},d.createElement(so.Dx,null,"Size (bytes)"),d.createElement("div",null,function dataFrameSize(e){return(0,ka.CZ)(e)?null:e.size}(t.dataFrame)))))),d.createElement("div",{className:"u-spacing-top"},d.createElement(Ke.Z,null,d.createElement(h.Z,{bufferRowReset:!0},d.createElement(EC,{emptyMessage:"This entity has no custom fields.",initialTags:t.customFields,title:"Custom Fields"}))))))}const yC=xa.Ps`
  query DatasetViewQuery($id: StrictString!) @skipAudit @engComponent(name: DATA_FRAMES) {
    dataset(id: $id) {
      ... on DatasetNode {
        id
        name
        archiveRecord {
          purpose
        }
        folder {
          ...FolderSummaryGraphQL
        }
        permissions {
          readable
          writable
          archivable
          unarchivable
        }
        creator {
          id
          name
          handle
          avatarUrl
        }
        createdAt
        dataFrame {
          ... on DataFrameNode {
            id
            size
          }
          ...InaccessibleInfoGraphQL
        }
        originType
        customFields {
          name
          value
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("FolderSummary").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function DatasetView({id:e}){(0,S.hu)(dt.ZP.DATA_FRAMES_ENABLE_DATASET,"DATA_FRAMES_ENABLE_DATASET is not enabled")
const t=(0,Da.IJ)(yC,{variables:{id:e}})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.SUCCESS){const{data:n}=t
if((0,ka.CZ)(n.dataset))return d.createElement(Ll.Z,{inaccessibleInfo:n.dataset,modelType:st.DATASET})
{const reload=()=>{t.refetch({id:e})}
return d.createElement(DatasetDetails,{dataset:n.dataset,reload})}}return null}class DatasetTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){const e=this.model.get("id");(0,Me.A9)(d.createElement(DatasetView,{id:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}DatasetTabView.initClass()
var bC=n(712257),TC=n(506516)
function FileDetails({file:e,reload:t}){return d.createElement("div",{className:"react-tab-container",...(0,ee.Z)({component:"FileDetails",element:"root"})},e.id,d.createElement("br",null),e.name,d.createElement("br",null),e.filename)}const vC=xa.Ps`
  query FileViewQuery($id: StrictString!) @skipAudit @engComponent(name: PIPELINES) {
    file(id: $id) {
      ... on FileNode {
        id
        name
        filename
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function FileView_FileView({id:e}){(0,S.hu)(dt.ZP.FILES_ENABLE,"FILES_ENABLE is not enabled")
const t=(0,Da.IJ)(vC,{variables:{id:e}})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.SUCCESS){const{data:n}=t
if((0,ka.CZ)(n.file))return d.createElement(Ll.Z,{inaccessibleInfo:n.file,modelType:st.FILE})
{const reload=()=>{t.refetch({id:e})}
return d.createElement(FileDetails,{file:n.file,reload})}}return null}class FileTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){const e=this.model.get("id");(0,Me.A9)(d.createElement(FileView_FileView,{id:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}FileTabView.initClass()
var CC=n(88583)
function FormInstanceHeader({name:e,disableSubmit:t,hideSubmit:n,onSubmit:a}){return d.createElement("div",{className:(0,g.iv)(IC.headerWrapper)},d.createElement(so.R6,{className:(0,g.iv)(IC.header)},e),!n&&d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,disabled:t,onClick:a,text:"Submit"}))}const IC=g.mM.create({headerWrapper:{display:"flex",alignItems:"center",justifyContent:"space-between"},header:{fontSize:"22px"}})
var wC=n(531559),NC=n(35991)
var AC=n(973103)
const RC=(0,xl.ZP)(void 0),PC=((0,xl.ZP)(!0),(0,xl.ZP)(!1)),OC=(0,xl.ZP)(!1)
function FormInstance({formDefinition:e}){const[t]=RC.useGlobalClientState(e.id),[n,a]=PC.useGlobalClientState(e.id),[i,s]=OC.useGlobalClientState(e.id),r=e.latestFormDefinitionVersion.definition
return d.createElement(Hl.Z,{backgroundColor:Hl.v.GRAY_LIGHTER,header:d.createElement(FormInstanceHeader,{name:e.name,disableSubmit:!n,hideSubmit:i,onSubmit:async()=>{if(!n||i)return
const o={fieldValues:(0,AC.g5)(t)}
await(0,Ic.jI)(function submitFormSubmission(e,t){const n={formDefinitionVersionId:t,fieldValues:e.fieldValues}
return Cn.s0({url:"/1/api/forms/form-submission",data:n})}(o,e.latestFormDefinitionVersion.id),"Submitting...")
s(!0)
a(function gatherFormFieldsFromDefinitionContent(e){const t=e.sections.flatMap((({content:e})=>e)),n=[]
for(;t.length;){const e=t.shift()
if("content"in e){const n=e
t.unshift(...n.content)}else{const t=e
n.push(t)}}return n}(r).every((e=>!e.isRequired)))}}),isHeaderFrozen:!0},d.createElement("div",{className:(0,g.iv)(xC.bodyWrapper)},i?d.createElement(io.ZP,{bannerType:io.ct.SUCCESS,text:`Successfully submitted ${e.name}.`}):d.createElement(NC.S,{formDefinitionContent:e.latestFormDefinitionVersion.definition,formInstanceTableState:{},onUpdateFormInstanceTableState:()=>{},fieldKeyToTableColumnIndex:{}})))}function QueryingFormInstance(e){const t=(0,Da.IJ)(wC.P,{variables:{formDefinitionId:e.formDefinitionId},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load form; try reloading the page.")
return null}const{formDefinition:n}=t.data
return(0,ka.CZ)(n)?d.createElement(Ll.Z,{inaccessibleInfo:n,modelType:st.FORM_DEFINITION}):d.createElement(FormInstance,{formDefinition:n})}const xC=g.mM.create({bodyWrapper:{paddingTop:28,paddingLeft:215,paddingRight:215}})
class FormInstanceTabView extends Js{render(){const e={formDefinitionId:this.model.get("formDefinitionId")};(0,Me.A9)(d.createElement(QueryingFormInstance,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}FormInstanceTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var _C=n(458697)
function getLocalValue(e,t){return null!=e?e:t}function useLocalGraphQLState(e,t,n,a){return[getLocalValue(t,a),t=>{n(e,t)}]}var DC=n(76213)
function generateErrorMessage(e,t){return e.concat(""===t?"":" ",t)}function assertWellFormedLayout(e,t){const n=e.layoutRows.map(((n,a)=>{const i=n.analyticsQueries.length;(0,S.Gp)(2===i||a===e.layoutRows.length-1,generateErrorMessage("Expected every row except the last row to have exactly 2 analyticsQueryIds",t));(0,S.Gp)(i<=2,generateErrorMessage("Expected row to have at most 2 analyticsQueryIds",t));(0,S.Gp)(i>0,generateErrorMessage("Expected row to have at least 1 analyticsQueryIds",t))
return i})).reduce(((e,t)=>e+t),0);(0,S.Gp)(n===e.analyticsQueries.length,generateErrorMessage("Found unexpected orphan blocks while rendering block layout",t))}var LC=n(247950),kC=n(726763)
function getRenameInfos(e,t){const n=[]
t.forEach((t=>{const a=e.find((e=>e.id===t.id))
if(null!=a){const e=a.systemName,i=t.systemName
e!==i&&n.push({oldName:e,newName:i})}}))
return n}function getRenamedSQLQuery(e,t){let n=e
t.forEach((({oldName:e,newName:t})=>{n=function renameParameterInSQLQuery(e,t,n){const a=(0,kC.Z)(`{{${t}}}`),i=`{{${n}}}`
return e.replace(new RegExp(a,"g"),i)}(n,e,t)}))
return n}function renameParametersInLocalSQLQueryOverrides(e,t,n){const a=getRenameInfos(t,n)
e.forEach((({id:e})=>{const t=(0,LC.k5)(e)
null!=t&&(0,LC.nd)(e,getRenamedSQLQuery(t,a))}))}var MC=n(248762)
function syncParameterConfigsToSQLQueries(e,t){const n=t.map((e=>e.systemName)),a=(0,Vd.Z)(e),i=l.default.intersection(n,a),s=(0,zo.NA)("AnalyticsParameterConfig",t.filter((e=>i.includes(e.systemName)))),r=l.default.difference(a,n).map((e=>function createDefaultParameterConfig(e){return{isMulti:!1,systemName:e,type:MC.r.STRING}}(e)))
!function trackParameters(e,t){const n=l.default.difference(t,e)
for(const e of n)(0,m.KK)(j.JG.INSERTED_PARAMETER,{num_parameters:t.length,is_default:isDefaultSystemName(e)})}(n,a)
return s.concat(r)}function syncParametersToSQLQueries(e,t,n){const a=syncParameterConfigsToSQLQueries(e,t),i=function syncParameterValuesToNewConfigs(e,t){const n=e.map((e=>e.id)).filter((e=>null!=e))
return t.filter((e=>n.includes(e.config.id))).map((e=>(0,Ud.L)(e)))}(a,n)
return{parameterConfigs:a,parameterValues:i}}var FC=n(174441)
function onUpdateAnalyticsDashboard(e){const t=(0,FC.mI)(e)
return{...(0,ig.Z)(t,"modifiedAt"),clientModifiedAt:t.modifiedAt}}function onTransformAnalyticsQueries(e,t){assertWellFormedLayout(e,"before making spec request")
const n=onUpdateAnalyticsDashboard(e),a=t(n.analyticsQueries),i=function syncLayoutToAnalyticsQueries(e,t){const n=t.map((e=>e.id)),a=e.flatMap((e=>e.analyticsQueryIds)).filter((e=>n.includes(e)))
return l.default.chunk(a,2).map((e=>({analyticsQueryIds:e})))}(n.layoutRows,a),s=syncParametersToSQLQueries(a.map((e=>e.sqlQuery)),e.parameterConfigs,e.parameterValues)
return{...n,analyticsQueries:a,layoutRows:i,...s}}function onChangeAnalyticsQuery(e,t,n){return onTransformAnalyticsQueries(e,(e=>e.map((e=>e.id===t?{...n,id:t}:e))))}function onChangeParameterConfigsAndValues(e,t){var n,a
const i=null!=t.configs?function getRenamedSqlQueries(e,t,n){const a=getRenameInfos(t,n)
return e.map((e=>({...e,sqlQuery:getRenamedSQLQuery(e.sqlQuery,a)})))}(e.analyticsQueries,e.parameterConfigs,t.configs):e.analyticsQueries,s=null!==(n=t.configs)&&void 0!==n?n:e.parameterConfigs,r=function updateParameterValuesForMultipleValueSetting(e,t){const n=new Set(e.filter((e=>e.isMulti)).map((e=>e.id)))
return[...t.map((e=>n.has(e.config.id)&&!Array.isArray(e.valueJson)?{...e,valueJson:null==e.valueJson?[]:[e.valueJson]}:!n.has(e.config.id)&&Array.isArray(e.valueJson)?{...e,valueJson:e.valueJson.length>0?e.valueJson[0]:null}:e)),...e.filter((e=>n.has(e.id))).filter((e=>null==t.find((t=>t.config.id===e.id)))).map((e=>getParameterValueObject(e,[])))]}(s,null!==(a=t.values)&&void 0!==a?a:e.parameterValues)
return onUpdateAnalyticsDashboard({...e,analyticsQueries:i,parameterConfigs:s,parameterValues:r})}function ActionBarSkeleton(e){(0,S.Gp)(null!=e.leftButtons||null!=e.parameterList||null!=e.rightButtons,"Expected action bar to have contents")
return d.createElement("div",{className:f()((0,g.iv)(ZC.actionBarContainer),"u-small-spacing-top")},d.createElement("span",null,d.createElement("span",{className:(0,g.iv)(ZC.leftButtons)},e.leftButtons),e.parameterList),e.rightButtons&&d.createElement("div",{className:"u-mini-spacing-left u-no-wrap"},e.rightButtons))}const ZC=g.mM.create({actionBarContainer:{alignItems:"center",display:"flex",justifyContent:"space-between"},leftButtons:{":nth-child(1n) > *":{marginRight:16}}})
var BC=n(719645)
const qC={analyticsDashboardViewStateId:BC.Uj,delayExpensiveRenders:!1,showReadOnlyBadge:!0,showDashboardCloneButton:!0,showDashboardLink:!1,theme:{dashboardBackgroundColor:Hl.v.GRAY_LIGHTER,paneBorder:yf.K9.BOX_SHADOW}},VC=(0,Hh.x)((()=>qC),"AnalyticsDashboardDetailsContext")
function useAnalyticsDashboardContext(){return VC.useContext()}const UC=VC
function AnalyticsTabSkeleton({children:e,...t}){const{theme:{dashboardBackgroundColor:n}}=useAnalyticsDashboardContext()
return d.createElement(Hl.Z,{...t,isHeaderFrozen:!0,backgroundColor:n},e)}var GC=n(597619),zC=n(949357),$C=n(669063)
function writeAnalyticsVisualizationToCache(e){(0,Ml.writeFragmentsToCache)(ed.NE,[e])}async function AnalyticsVisualizationActions_updateAnalyticsVisualization(e,t){await(0,$C.Y)({persistData:async()=>await function updateAnalyticsVisualization(e,t){return Cn.Ry({url:`/1/api/analytics-visualizations/${e}`,data:t})}(t.id,convertGQLToRESTAnalyticsVisualization(t)),writeDataToCache:writeAnalyticsVisualizationToCache,optimisticData:t,revertData:e})}function getHighestNumericSuffixAmongDefaultNames(e){const t=e.map((e=>function getNumericSuffixIfDefaultName(e){if(!isDefaultSystemName(e))return null
const t=e.match(du)[1]
return null==t?0:(0,Jt.Lk)(t)}(e))).filter((e=>null!=e))
return t.length?Math.max(...t):null}function getAddParameterMenuOption({disabled:e,onAddParameter:t,sqlQuery:n}){return{contents:d.createElement("span",null,"Add parameter"),icon:"compose",isDisabled:e,onSelect:function handleSelect(){t(function getNextDefaultName(e){const t=getHighestNumericSuffixAmongDefaultNames((0,Vd.Z)([e]))
return null!=t?`parameter${t+1}`:"parameter"}(n))},tooltipTitle:"Add parameter\n( {{name}} from SQL editor)"}}var WC=n(545135)
n(855501),n(922098),n(248101),n(262503)
const HC=window.ace.acequire("ace/mode/sql_highlight_rules").SqlHighlightRules,jC=window.ace.acequire("ace/mode/sql").Mode
class ParameterizedSQLHighlightRules extends HC{constructor(){super()
this.$rules.start.unshift({token:"custom_insights_sql_parameter",regex:"{{.*?}}"})}}class ParameterizedSQLMode extends jC{constructor(){super()
this.HighlightRules=ParameterizedSQLHighlightRules}}function SQLEditor(e){var t,n
const a=(0,d.useRef)(null),i=null!==(t=e.editorRef)&&void 0!==t?t:a;(0,Ul.Z)((()=>{const t=new ParameterizedSQLMode,n=i.current.editor
n.getSession().setMode(t)
n.session.selection.on("changeSelection",(()=>{const t=n.getSelectedText()
e.onTextSelected&&e.onTextSelected(t||null)}))}))
const s=function useValueAsRef(e){const t=(0,d.useRef)(e);(0,d.useEffect)((()=>{t.current=e}),[e])
return t}(null!==(n=e.onRun)&&void 0!==n?n:Jt.ZT),r=[{name:"run",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:()=>{s.current()}}]
return d.createElement(Ym.ZP,{value:e.query,onChange:e.onQueryChange,commands:r,ref:i,mode:"sql",enableLiveAutocompletion:!0,showGutter:e.showGutter,showPrintMargin:!1,wrapEnabled:!0,className:e.className,editorProps:{$blockScrolling:1/0},width:e.width,height:e.height})}function SQLEditorPaneContent({actions:e,className:t,isExpanded:n,isRunning:a,sqlQuery:i}){const{currentState:s,makeCall:r}=(0,Wr.ZP)(e.saveAndRunQuery)
function onRun(){a||s.status===Wr.Lr.LOADING||r()}return d.createElement(WC.ZP,{disableHeight:!0},(({width:a})=>d.createElement(SQLEditor,{className:t,onTextSelected:e.setSQLSubQuery,onRun,height:n?"500px":`${ip.gd}px`,onQueryChange:t=>{e.setSQLQuery(t)},query:i,width:`${a}px`,showGutter:!0})))}function SQLEditorPane({actions:e,additionalActionButtons:t,isExpanded:n,isRunning:a,sqlQuery:i}){return d.createElement(yf.ZP,{title:"SQL",fitContent:!0,toolbar:t,dataTestAttrs:{component:"SQLEditorPane",element:"root"}},d.createElement(SQLEditorPaneContent,{actions:e,isExpanded:n,isRunning:a,sqlQuery:i}))}var YC,QC=n(210665)
!function(e){e.ID="ID"
e.RELATIONAL_USER_DEFINED="RELATIONAL_USER_DEFINED"
e.RELATIONAL_SYSTEM_DEFINED="RELATIONAL_SYSTEM_DEFINED"
e.NON_RELATIONAL_USER_DEFINED="NON_RELATIONAL_USER_DEFINED"
e.NON_RELATIONAL_SYSTEM_DEFINED="NON_RELATIONAL_SYSTEM_DEFINED"
e.INTERNAL_SYSTEM="INTERNAL_SYSTEM"}(YC||(YC={}))
function columnToCategory(e){const t=e.columnRelationships.length>0,n=!e.name.endsWith("$")
return"id"===e.name?YC.ID:e.name.startsWith("_")||"source_id"===e.name?YC.INTERNAL_SYSTEM:t&&n?YC.RELATIONAL_USER_DEFINED:t&&!n?YC.RELATIONAL_SYSTEM_DEFINED:!t&&n?YC.NON_RELATIONAL_USER_DEFINED:YC.NON_RELATIONAL_SYSTEM_DEFINED}function tableNodeToTableData(e,t){const n={schemaName:e.schemaName,name:e.tableName,columns:[],coreTableType:e.coreTableType,schema:e.schema,perSchemaTableType:e.perSchemaTableType}
n.columns=(t?function sortedTableColumns(e){const t={[YC.ID]:[],[YC.RELATIONAL_USER_DEFINED]:[],[YC.RELATIONAL_SYSTEM_DEFINED]:[],[YC.NON_RELATIONAL_USER_DEFINED]:[],[YC.NON_RELATIONAL_SYSTEM_DEFINED]:[],[YC.INTERNAL_SYSTEM]:[]}
for(const n of e)t[columnToCategory(n)].push(n)
return t[YC.ID].concat(t[YC.RELATIONAL_USER_DEFINED]).concat(t[YC.RELATIONAL_SYSTEM_DEFINED]).concat(t[YC.NON_RELATIONAL_USER_DEFINED]).concat(t[YC.NON_RELATIONAL_SYSTEM_DEFINED]).concat(t[YC.INTERNAL_SYSTEM])}(e.columns):e.columns).map((({name:e,type:t,isMulti:a},i)=>({name:e,type:t,isMulti:a,table:n,relationships:[],index:i})))
return n}function transformWarehouseModel(e,t){const n=function indexArrayIntoMap(e,t){const n=new Map
for(const a of e)n.set(t(a),a)
return n}(e.tables.map((e=>{var n
return tableNodeToTableData(e,null!==(n=null==t?void 0:t.sortColumns)&&void 0!==n&&n)})),(e=>e.name)),a=new QC.Z(Array.from(n.entries()).flatMap((([e,t])=>t.columns.map((t=>[{tableName:e,columnName:t.name},t])))))
let i=0
const s=e.tables.flatMap((e=>e.columns.flatMap((t=>t.columnRelationships.flatMap((n=>{const s=a.get({tableName:e.tableName,columnName:t.name}),r=a.get({tableName:n.targetColumn.table.tableName,columnName:n.targetColumn.name})
if(!s||!r){(0,S.Gp)(!1,"Invalid relationship in warehouse diagram model")
return[]}return{source:s,target:r,type:n.type,id:i++}}))))))
for(const e of s){e.source.relationships.push(e)
e.target.relationships.push(e)}return{tables:n,relationships:s}}const KC=xa.Ps`
  query ListWarehouseModelsQuery @skipAudit @engComponent(name: INSIGHTS) {
    warehouseModelListing {
      warehouseModels {
        schemaName
        tables {
          schemaName
          tableName
          perSchemaTableType
          coreTableType
          schema {
            ... on SchemaInterface {
              id
              name
              allFieldsJson
              fieldsJson
            }
            ... on TagSchemaNode {
              ...TagSchemaGraphQL
              registry {
                id
                ownerJson
              }
            }
          }
          columns {
            name
            type
            isMulti
            columnRelationships {
              type
              targetColumn {
                name
                table {
                  tableName
                }
              }
            }
          }
        }
      }
    }
  }
  ${(0,La.f)("TagSchema").fragment}
`
function useWarehouseModelsQuery(e){var t
const n=(0,Da.IJ)(KC),a=n.type===Da.NI.SUCCESS?n.data:null,i=null!==(t=null==e?void 0:e.sortColumns)&&void 0!==t&&t,s=(0,d.useMemo)((()=>null==a?null:function warehouseModelGQLToRelationalData(e,t){const n=new Map
for(const a of e.warehouseModelListing.warehouseModels)n.set(a.schemaName,transformWarehouseModel(a,t))
return n}(a,{sortColumns:i})),[a,i])
return n.type===Da.NI.SUCCESS?{queryResultType:n.type,transformedData:s}:{queryResultType:n.type}}function fullTableNameToSchemaAndRawTableNames(e){const t=e.split(".");(0,S.Gp)(2===t.length,"Invalid full table name",{fullTableName:e})
const[n,a]=t
return[n,a.endsWith("$raw")?a:`${a}$raw`]}function getTableViewName(e,t){return`${e}.${t.replace(/\$raw$/,"")}`}var JC
!function(e){e.LISTING="LISTING"
e.DETAILS="DETAILS"}(JC||(JC={}))
function LoadingPaneContents(){return d.createElement("div",{className:(0,g.iv)(XC.throbberMargin)},d.createElement(kl.Z,null))}const XC=g.mM.create({throbberMargin:{margin:ip.mR}})
function WarehouseDiagramSQLEditor(e){const t=(0,d.useRef)(null),n=(0,Su.N)(e.sidebarWidth,100);(0,d.useEffect)((()=>{t.current.editor.resize()}),[n])
return d.createElement(SQLEditor,{width:"100%",height:"100%",showGutter:!1,onQueryChange:e.onModalSQLQueryChange,query:e.modalSQLQuery,editorRef:t})}function WarehouseDiagramSidebar(e){return d.createElement("div",{className:(0,g.iv)(eI.sidebar)},d.createElement("div",{className:(0,g.iv)(eI.sqlEditorHeader)},d.createElement(so.zV,null,"SQL query"),d.createElement("p",{className:(0,g.iv)(eI.sidebarSubtext)},"Use this area to work on your SQL query. It will appear in the SQL editor when you close this window.")),d.createElement("div",{className:f()("scrollbar-override",(0,g.iv)(eI.sqlEditorWrapper))},d.createElement(WarehouseDiagramSQLEditor,{modalSQLQuery:e.modalSQLQuery,onModalSQLQueryChange:e.onModalSQLQueryChange,sidebarWidth:e.sidebarWidth})))}const eI=g.mM.create({sidebar:{display:"flex",flexDirection:"column",height:"100%"},sqlEditorHeader:{padding:"0px 6px",borderBottom:`1px solid ${Vt.tN}`},sidebarSubtext:{color:Vt.pp},sqlEditorWrapper:{flexGrow:1}})
function DiagramError({errorMessage:e}){return d.createElement("div",{className:f()((0,g.iv)(tI.wrapper),"u-text-align-center")},d.createElement(pe.Z,{icon:"warning",className:f()((0,g.iv)(tI.icon))}),d.createElement("div",{className:(0,g.iv)(tI.errorText)},e))}const tI=g.mM.create({wrapper:{marginTop:"16px"},icon:{color:Vt.tN,height:"60px",width:"60px"},errorText:{..._n.Nk,color:Vt.TG,fontWeight:_n.KB}})
function useBodyStyleWhileMounted(e,t,n=!0){const[a,i]=(0,d.useState)(null),s=(0,d.useCallback)((()=>{if(null!=a){document.body.style[e]=a
i(null)}}),[e,a]);(0,d.useEffect)((()=>{if(n){if(null==a){i(document.body.style[e])
document.body.style[e]=t}}else s()
return s}),[s,e,n,t,a])}function useDocumentCursor(e,t){useBodyStyleWhileMounted("cursor",e,t)}const nI=270
function dwdHeightOfTableWithNColumns(e){return 32+20*e+30}const aI=dwdHeightOfTableWithNColumns(5),iI={tableNameToCell:new QC.Z,cellToTableName:new QC.Z,verticallyExpandedTables:new Ig.Z,hoveredRelationship:null,relationshipTooltip:null},sI={x:0,y:0}
function pointToString(e){return`${e.x},${e.y}`}var rI,oI,lI
!function(e){e.LEFT="left"
e.RIGHT="right"}(rI||(rI={}))
!function(e){e.TOP="top"
e.BOTTOM="bottom"}(oI||(oI={}))
function expandedTableHeight(e,t){return dwdHeightOfTableWithNColumns(t.tables.get(e).columns.length)}function cellToTopLeftPixel(e){return{x:320*e.x,y:e.y*(aI+50)}}function pixelToCell(e){return{x:Math.floor(e.x/320),y:Math.floor(e.y/(aI+50))}}function cellIsObscured(e,t,n){for(const a of e.verticallyExpandedTables){const i=e.tableNameToCell.get(a)
if(!(t.x===i.x&&t.y>i.y))continue
const s=cellToTopLeftPixel(i)
if(pixelToCell({x:s.x,y:s.y+expandedTableHeight(a,n)}).y>=t.y)return!0}return!1}function columnIsShown(e,t,n){return e.tableNameToCell.has(t.table.name)&&t.index<(e.verticallyExpandedTables.has(t.table.name)?t.table.columns.length:5)&&!cellIsObscured(e,e.tableNameToCell.get(t.table.name),n)}function columnVerticalOffset(e){return 32+20*e.index+10}function columnToPixel(e,t,n){const a=cellToTopLeftPixel(e.tableNameToCell.get(t.table.name))
return{x:a.x+(n===rI.LEFT?0:nI),y:a.y+columnVerticalOffset(t)}}function getNewTableCellsNear(e,t,n){if(n<=0)return[]
const a=[],i=new Set,s=[t]
for(;s.length>0;){const t=s.shift()
if(i.has(pointToString(t)))continue
i.add(pointToString(t))
if(!e.cellToTableName.has(t)){a.push(t)
if(a.length===n)return a}const{x:r,y:o}=t
s.push({x:r+1,y:o},{x:r,y:o-1},{x:r-1,y:o},{x:r,y:o+1})}(0,S.Gp)(!1,"Could not find enough empty diagram positions")
return a}function getUnpopulatedRelatedTables(e,t){const n=t.columns.flatMap((e=>e.relationships.flatMap((e=>[e.source.table.name,e.target.table.name]))))
n.push(t.name)
return new Set(n.filter((n=>!e.tableNameToCell.has(n)&&n!==t.name)))}function addTablesToLayout(e,t,n){return t.reduce(((e,t,a)=>({...e,tableNameToCell:e.tableNameToCell.set(t,n[a]),cellToTableName:e.cellToTableName.set(n[a],t)})),e)}function cellColumnIsIn(e,t){return pixelToCell(columnToPixel(e,t,rI.LEFT))}!function(e){e.ADD_TABLE_AT_CELL="ADD_TABLE_AT_CELL"
e.ADD_TABLES="ADD_TABLES"
e.COLLAPSE_TABLE="COLLAPSE_TABLE"
e.EXPAND_TABLE="EXPAND_TABLE"
e.HIDE_RELATIONSHIP_TOOLTIP="HIDE_RELATIONSHIP_TOOLTIP"
e.SHOW_RELATIONSHIP_TOOLTIP="SHOW_RELATIONSHIP_TOOLTIP"
e.START_HOVER_RELATIONSHIP="START_HOVER_RELATIONSHIP"
e.STOP_HOVER_RELATIONSHIP="STOP_HOVER_RELATIONSHIP"}(lI||(lI={}))
function diagramLayoutReducer(e,t){switch(t.type){case lI.ADD_TABLE_AT_CELL:return addTablesToLayout(e,[t.tableName],[t.cell])
case lI.ADD_TABLES:return addTablesToLayout(e,t.tableNames,t.cells)
case lI.COLLAPSE_TABLE:return{...e,verticallyExpandedTables:e.verticallyExpandedTables.delete(t.tableName)}
case lI.EXPAND_TABLE:return{...e,verticallyExpandedTables:e.verticallyExpandedTables.add(t.tableName)}
case lI.HIDE_RELATIONSHIP_TOOLTIP:return null==e.relationshipTooltip?e:{...e,relationshipTooltip:null}
case lI.SHOW_RELATIONSHIP_TOOLTIP:return{...e,relationshipTooltip:{relationshipData:t.relationship,triggerPoint:t.triggerPoint}}
case lI.START_HOVER_RELATIONSHIP:return{...e,hoveredRelationship:t.relationship}
case lI.STOP_HOVER_RELATIONSHIP:return{...e,hoveredRelationship:null}
default:throw new Error(`Invalid action type ${(0,Go.vE)(t)}`)}}function useDiagramLayoutState(e){const[t,n]=(0,d.useReducer)(diagramLayoutReducer,function initializeDiagramLayout(e){const t={...iI,tableNameToCell:iI.tableNameToCell.set(e.name,sI),cellToTableName:iI.cellToTableName.set(sI,e.name)},n=getUnpopulatedRelatedTables(t,e),a=getNewTableCellsNear(t,sI,Math.min(n.size,24))
return addTablesToLayout(t,Array.from(n).slice(0,24),a)}(e))
return{layout:t,addRelatedTables:function addRelatedTables(e){const a=t.tableNameToCell.get(e.name),i=getUnpopulatedRelatedTables(t,e),s=getNewTableCellsNear(t,a,Math.min(i.size,25)),r=Array.from(i).slice(0,25)
n({type:lI.ADD_TABLES,tableNames:r,cells:s})},expandTableColumns:function expandTableColumns(e){n({type:lI.EXPAND_TABLE,tableName:e})},collapseTableColumns:function collapseTableColumns(e){n({type:lI.COLLAPSE_TABLE,tableName:e})},cellIsObscured:(e,n)=>cellIsObscured(t,e,n),getCellTopLeftPixelPoint:function getCellTopLeftPixelPoint(e){return cellToTopLeftPixel(e)},getRelationshipPath:e=>function getRelationshipPath(e,t){const n=cellColumnIsIn(e,t.source),a=cellColumnIsIn(e,t.target),i=a.x-n.x,s=a.y-n.y
let r,o
if(0===i){r=rI.LEFT
o=rI.LEFT}else if(i<0){r=rI.LEFT
o=rI.RIGHT}else{r=rI.RIGHT
o=rI.LEFT}const l=columnToPixel(e,t.source,r),c=columnToPixel(e,t.target,o),d={x:l.x+50*(r===rI.LEFT?-1:1)/2,y:l.y},u={x:c.x+50*(o===rI.LEFT?-1:1)/2,y:c.y}
if(0===s&&i>=-1&&i<=1)return{points:[l,d,u,c],sourceExitSide:r,targetEntranceSide:o}
let m,p
if(0===s){m=oI.TOP
p=oI.TOP}else if(s<0){m=oI.TOP
p=oI.BOTTOM}else{m=oI.BOTTOM
p=oI.TOP}const h=m===oI.TOP?-columnVerticalOffset(t.source)-25:aI-columnVerticalOffset(t.source)+25,g=(p===oI.TOP?a.y-1:a.y)-(m===oI.TOP?n.y-1:n.y),E={x:d.x,y:d.y+h+g*(aI+50)},f=(o===rI.LEFT?a.x-1:a.x)-(r===rI.LEFT?n.x-1:n.x)
return{points:[l,d,E,{x:E.x+320*f,y:E.y},u,c],sourceExitSide:r,targetEntranceSide:o}}(t,e),hideRelationshipTooltip:function hideRelationshipTooltip(){n({type:lI.HIDE_RELATIONSHIP_TOOLTIP})},showRelationshipTooltip:function showRelationshipTooltip(e,t){n({type:lI.SHOW_RELATIONSHIP_TOOLTIP,relationship:e,triggerPoint:t})},shouldShowRelationship:function shouldShowRelationship(e,n){return columnIsShown(t,e.source,n)&&columnIsShown(t,e.target,n)},startHoverRelationship:function startHoverRelationship(e){n({type:lI.START_HOVER_RELATIONSHIP,relationship:e})},stopHoverRelationship:function stopHoverRelationship(){n({type:lI.STOP_HOVER_RELATIONSHIP})},_addTableAtCell:function _addTableAtCell(e,t){n({type:lI.ADD_TABLE_AT_CELL,tableName:e.name,cell:t})}}}const cI=(0,Hh.x)((()=>{throw new Error("Could not find DiagramLayout context while rendering entity relationship diagram.")}),"DiagramLayoutContext")
function useDiagramLayoutContext(){return cI.useContext()}const dI=cI,uI=(0,Hh.x)((()=>{(0,S.Gp)(!1,"Could not find diagram panning context while rendering analytics component, defaulting to false")
return!1}),"DiagramPanningContext")
const mI=uI
var pI
!function(e){e.MOVE="MOVE"
e.SET="SET"}(pI||(pI={}))
function panningReducer(e,t){switch(t.type){case pI.MOVE:return{x:e.x+t.mouseDelta.x,y:e.y+t.mouseDelta.y}
case pI.SET:return t.newTranslation
default:throw new Error(`Invalid action type ${(0,Go.vE)(t)}`)}}var hI
!function(e){e.MANY="many"
e.ONE="one"
e.NONE="none"}(hI||(hI={}))
function getRelationshipDecoratorTypes(e){switch(e){case Sn.nm.MANY_TO_MANY:return{sourceDecoratorType:hI.MANY,targetDecoratorType:hI.MANY}
case Sn.nm.MANY_TO_ONE:return{sourceDecoratorType:hI.MANY,targetDecoratorType:hI.ONE}
case Sn.nm.ONE_TO_MANY:return{sourceDecoratorType:hI.ONE,targetDecoratorType:hI.MANY}
case Sn.nm.ONE_TO_ONE:return{sourceDecoratorType:hI.ONE,targetDecoratorType:hI.ONE}
case Sn.nm.UNKNOWN:default:return{sourceDecoratorType:hI.NONE,targetDecoratorType:hI.NONE}}}function getRelationshipDecoratorPixelPath(e,t,n){switch(e){case hI.ONE:return[{x:n.x+(t===rI.LEFT?-8:8),y:n.y-5},{x:n.x+(t===rI.LEFT?-8:8),y:n.y+5}]
case hI.MANY:return[{x:n.x,y:n.y+5},{x:n.x+(t===rI.LEFT?-10:10),y:n.y},{x:n.x,y:n.y-5}]
case hI.NONE:default:return[]}}function stringifyPath(e){return e.map((({x:e,y:t})=>`${e},${t}`)).join(" ")}function WarehouseDiagramRelationship(e){const{points:t,sourceExitSide:n,targetEntranceSide:a}=e.path,i=function useDiagramPanningContext(){return uI.useContext()}(),{startHoverRelationship:s,hideRelationshipTooltip:r,showRelationshipTooltip:o}=useDiagramLayoutContext()
const l=stringifyPath(t),{sourceDecoratorType:c,targetDecoratorType:u}=getRelationshipDecoratorTypes(e.relationshipData.type),m=getRelationshipDecoratorPixelPath(c,n,t[0]),p=getRelationshipDecoratorPixelPath(u,a,t[t.length-1])
return d.createElement("g",{cursor:i?"unset":"pointer",pointerEvents:"stroke",onMouseOver:function handleRelationshipHover(){e.hovered||i||s(e.relationshipData)},onMouseMove:e=>{i||e.stopPropagation()},onMouseDown:e=>{r()
e.stopPropagation()},onClick:t=>{o(e.relationshipData,{x:t.clientX,y:t.clientY})}},d.createElement("polyline",{points:l,fill:"none",stroke:"none",strokeWidth:"10",key:1}),d.createElement("polyline",{points:l,fill:"none",stroke:e.hovered?Vt.G$:Vt.t0,strokeWidth:e.hovered?3:2,strokeLinejoin:"round",key:2}),d.createElement("polyline",{stroke:e.hovered?Vt.G$:Vt.t0,strokeWidth:e.hovered?3:2,fill:"transparent",points:stringifyPath(m),key:3}),d.createElement("polyline",{stroke:e.hovered?Vt.G$:Vt.t0,strokeWidth:e.hovered?3:2,fill:"transparent",points:stringifyPath(p),key:4}))}function WarehouseDiagramTableRow(e){var t,n
const[a,i]=(0,uT.Z)(),{layout:s}=useDiagramLayoutContext(),r=Boolean(e.columnData===(null===(t=s.hoveredRelationship)||void 0===t?void 0:t.source)||e.columnData===(null===(n=s.hoveredRelationship)||void 0===n?void 0:n.target)),o=(0,d.useMemo)((()=>e.columnData.relationships.some((t=>function areColumnsEqual(e,t){return e.name===t.name&&e.table.name===t.table.name&&e.table.schemaName===t.table.schemaName}(t.source,e.columnData)))),[e.columnData])
return d.createElement("div",{className:(0,g.iv)(gI.wrapper,r&&gI.highlightedWrapper),...i},d.createElement("div",{className:f()("u-vertical-center-items",(0,g.iv)(gI.columnNameIconWrapper))},d.createElement(pe.Z,{className:(0,g.iv)(gI.typeIcon),icon:sqlColumnTypeToIcon(e.columnData.type),...(0,ee.Z)({component:"WarehouseDiagramTableRow",element:"typeIcon"})}),d.createElement("div",{className:f()((0,g.iv)(gI.columnName),(0,g.iv)(o?gI.foreignKeyColumnName:gI.nonForeignKeyColumnName)),...(0,ee.Z)({component:"WarehouseDiagramTableRow",element:"columnName"})},d.createElement("div",{className:"clipboardIcon-wrapper--flex"},d.createElement(KE.Z,{clipboardData:e.columnData.name,copyIconAlwaysVisible:a},d.createElement("div",{className:(0,g.iv)(gI.wrappedColumnName)},e.columnData.name))))),d.createElement("div",{className:f()((0,g.iv)(gI.columnType),"u-vertical-center-items"),...(0,ee.Z)({component:"WarehouseDiagramTableRow",element:"typeText"})},function sqlColumnTypeToString(e){switch(e){case Sn.Fw.CHARACTER_VARYING:return"varchar"
case Sn.Fw.BOOLEAN:return"boolean"
case Sn.Fw.DOUBLE:return"double"
case Sn.Fw.INTEGER:return"int"
case Sn.Fw.DATE:return"date"
case Sn.Fw.TIMESTAMP:return"timestamp"
case Sn.Fw.JSON:return"json"
case Sn.Fw.JSONB:return"jsonb"
case Sn.Fw.NUMERIC:return"numeric"
default:(0,S.Gp)(!1,`Invalid column type ${(0,Go.vE)(e)}`)
return"unknown"}}(e.columnData.type)))}const gI=g.mM.create({wrapper:{width:"100%",display:"flex",justifyContent:"space-between",padding:"2px 6px",transition:"background-color 0.2s",":hover":{backgroundColor:Vt.bs,transition:"background-color 0.2s"}},highlightedWrapper:{backgroundColor:Vt.ip},columnNameIconWrapper:{display:"flex"},columnType:{color:Vt.TG},columnName:{marginLeft:6,marginTop:1,whiteSpace:"nowrap"},foreignKeyColumnName:{color:Vt.t0},nonForeignKeyColumnName:{color:"black"},wrappedColumnName:{overflowX:"hidden",maxWidth:140,textOverflow:"ellipsis"},typeIcon:{color:Vt.TG}}),EI={x:0,y:10},fI={x:70,y:10}
function SimpleRelationshipSVG(e){const{sourceDecoratorType:t,targetDecoratorType:n}=getRelationshipDecoratorTypes(e.relationshipType),a=getRelationshipDecoratorPixelPath(t,rI.RIGHT,EI),i=getRelationshipDecoratorPixelPath(n,rI.LEFT,fI),s={strokeLinejoin:"round",fill:"none",stroke:Vt.t0,strokeWidth:2}
return d.createElement("svg",{className:(0,g.iv)(yI.simpleRelationshipSVG)},d.createElement("polyline",{...s,points:stringifyPath(a)}),d.createElement("polyline",{...s,points:stringifyPath(i)}),d.createElement("polyline",{...s,points:stringifyPath([EI,fI])}))}const SI=d.memo((function WarehouseDiagramLegend(){return d.createElement("div",{className:(0,g.iv)(yI.wrapper)},d.createElement(so.BB,null,"Legend"),d.createElement("table",null,d.createElement("tbody",null,d.createElement("tr",null,d.createElement("td",{className:(0,g.iv)(yI.cell)},d.createElement(SimpleRelationshipSVG,{relationshipType:Sn.nm.MANY_TO_ONE})),d.createElement("td",{className:(0,g.iv)(yI.cell)},"Many-to-one relationship")),d.createElement("tr",null,d.createElement("td",{className:(0,g.iv)(yI.cell)},d.createElement(SimpleRelationshipSVG,{relationshipType:Sn.nm.ONE_TO_ONE})),d.createElement("td",{className:(0,g.iv)(yI.cell)},"One-to-one relationship")),d.createElement("tr",null,d.createElement("td",{className:(0,g.iv)(yI.cell)},d.createElement(SimpleRelationshipSVG,{relationshipType:Sn.nm.UNKNOWN})),d.createElement("td",{className:(0,g.iv)(yI.cell)},"Unknown relationship type")),d.createElement("tr",null,d.createElement("td",{className:(0,g.iv)(yI.cell)},d.createElement("span",{className:(0,g.iv)(gI.foreignKeyColumnName)},"blue_column")),d.createElement("td",{className:(0,g.iv)(yI.cell)},"Foreign key")))))})),yI=g.mM.create({wrapper:{position:"absolute",bottom:15,right:15,background:Vt.bs,border:`1px solid ${Vt.pF}`,boxShadow:"0 0 2px #ccc",borderRadius:4,padding:10},cell:{paddingRight:15},simpleRelationshipSVG:{width:70,height:17}})
function WarehouseDiagramRelationshipSVG(e){const{layout:{hoveredRelationship:t},shouldShowRelationship:n,getRelationshipPath:a}=useDiagramLayoutContext(),{hoveredDiagramRelationship:i,otherDiagramRelationships:s}=(0,d.useMemo)((()=>{const i=e.models.relationships.filter((t=>n(t,e.models))),s=t?i.indexOf(t):-1
let r
s>=0?[r]=i.splice(s,1):r=null
return{hoveredDiagramRelationship:null!=r&&d.createElement(WarehouseDiagramRelationship,{relationshipData:r,path:a(r),hovered:!0,key:r.id}),otherDiagramRelationships:i.map((e=>d.createElement(WarehouseDiagramRelationship,{relationshipData:e,path:a(e),hovered:!1,key:e.id})))}}),[e.models,t,a,n])
return d.createElement("svg",{className:(0,g.iv)(bI.svg)},d.createElement(d.Fragment,null,s,i))}const bI=g.mM.create({svg:{width:"100%",height:"100%",overflow:"visible",cursor:"move"}})
function WarehouseDiagramTableFooter(e){const{expandTableColumns:t,collapseTableColumns:n}=useDiagramLayoutContext()
return d.createElement("div",{className:(0,g.iv)(TI.footer)},d.createElement(C.Co,{text:e.expanded?"See fewer columns":"See more columns",onClick:function handleToggleExpanded(){e.expanded?n(e.tableName):t(e.tableName)},buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI}))}const TI=g.mM.create({footer:{marginTop:3,textAlign:"center"}})
function WarehouseDiagramUnrelatedTablesButton(e){const{addRelatedTables:t}=useDiagramLayoutContext()
return d.createElement(P.ZP,{title:`Show ${Math.min(e.numberUnpopulatedRelatedTables,25)} other related ${(0,de._6)(e.numberUnpopulatedRelatedTables,"table","tables")}`},d.createElement(C.Co,{icon:"erd",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,onClick:function handleAddRelatedTablesClick(){(0,m.KK)(j.JG.ADDED_RELATED_TABLES_TO_WAREHOUSE_DIAGRAM,{expandedTableName:e.tableData.name})
t(e.tableData)}}))}function WarehouseDiagramTableHeader(e){return d.createElement("div",{className:f()((0,g.iv)(vI.wrapper))},d.createElement("div",{className:f()("u-vertical-center-items",e.isFocus&&"tableHeader--focusTable",(0,g.iv)(vI.tableIconWrapper))},d.createElement(pe.Z,{className:f()((0,g.iv)(vI.tableIcon),(0,g.iv)(e.isFocus?vI.focusTableIcon:vI.notFocusTableIcon)),icon:"warehouse-table"}),d.createElement("div",{className:(0,g.iv)(vI.tableName)},d.createElement("div",{className:"clipboardIcon-wrapper--flex"},d.createElement(KE.Z,{clipboardData:`${e.schemaName}.${e.tableData.name}`},d.createElement("div",{className:(0,g.iv)(vI.wrappedTableName)},e.tableData.name))))),d.createElement("div",null,e.numberUnpopulatedRelatedTables>0&&d.createElement(WarehouseDiagramUnrelatedTablesButton,{tableData:e.tableData,numberUnpopulatedRelatedTables:e.numberUnpopulatedRelatedTables})))}const vI=g.mM.create({wrapper:{padding:"4px 6px",fontSize:14,display:"flex",flexDirection:"row",justifyContent:"space-between",height:"100%"},tableName:{marginLeft:4,whiteSpace:"nowrap"},tableIconWrapper:{display:"flex"},tableIcon:{marginBottom:1},focusTableIcon:{color:"white"},notFocusTableIcon:{color:Vt.TG},wrappedTableName:{overflowX:"hidden",maxWidth:185,textOverflow:"ellipsis"}})
function WarehouseDiagramTable({schemaName:e,tableData:t,columnsExpanded:n,isFocus:a,cell:i}){const{layout:s,getCellTopLeftPixelPoint:r}=useDiagramLayoutContext(),o=n?t.columns.length:Math.min(t.columns.length,5),l=n||o<t.columns.length,c=r(i),u=d.createElement("div",{className:f()((0,g.iv)(CI.headerWrapper),(0,g.iv)(a?CI.focusHeaderWrapper:CI.notFocusHeaderWrapper))},d.createElement(WarehouseDiagramTableHeader,{isFocus:a,schemaName:e,tableData:t,numberUnpopulatedRelatedTables:getUnpopulatedRelatedTables(s,t).size})),m=t.columns.slice(0,o).map(((e,t)=>d.createElement("div",{key:t,className:f()("u-vertical-center-items",(0,g.iv)(CI.tableRowWrapper))},d.createElement(WarehouseDiagramTableRow,{columnData:e})))),p=d.createElement("div",{className:f()((0,g.iv)(CI.tableBodyWrapper),(0,g.iv)(a?CI.focusTableBodyWrapper:CI.notFocusTableBodyWrapper))},m),h=d.createElement("div",{className:(0,g.iv)(CI.footerWrapper)},d.createElement(WarehouseDiagramTableFooter,{tableName:t.name,expanded:n}))
return d.createElement("div",{onMouseDown:e=>{e.stopPropagation()},style:{left:c.x,top:c.y},className:f()((0,g.iv)(CI.wrapper))},u,p,l&&h)}const CI=g.mM.create({wrapper:{display:"flex",flexDirection:"column",position:"absolute",width:nI,overflow:"hidden",pointerEvents:"all",cursor:"default",boxShadow:"0 0 5px #ccc",borderRadius:3},headerWrapper:{height:32,overflow:"hidden"},tableBodyWrapper:{backgroundColor:"white",borderBottom:`1px solid ${Vt.bs}`},tableRowWrapper:{height:20,overflow:"hidden"},footerWrapper:{height:30,overflow:"hidden",backgroundColor:"white"},focusTableBodyWrapper:{borderTop:"1px solid white"},notFocusTableBodyWrapper:{borderTop:`1px solid ${Vt.bs}`},focusHeaderWrapper:{backgroundColor:Vt.t0,color:"white"},notFocusHeaderWrapper:{backgroundColor:"white",color:"initial"}}),II={x:2,y:13},wI={x:2,y:39},NI=[II,{x:25,y:II.y},{x:25,y:wI.y},wI]
function getRelationshipTooltipTranslation(e,t,n){const a=t.current.getBoundingClientRect(),i=e.x-a.left<t.current.offsetWidth/2,s=Math.round(e.x-a.left+(i?7:-7)),r=Math.round(e.y-a.top-50-7)
return`translate3d(${i?`${s}px`:n?`${Math.ceil(s-n)}px`:`calc(${s}px - 100%)`}, ${`${r}px`}, 0px)`}function WarehouseRelationshipTooltip({tooltipData:{relationshipData:e,triggerPoint:t},diagramWrapperRef:n}){const[a,i]=(0,d.useState)(getRelationshipTooltipTranslation(t,n,null)),s=(0,d.useRef)(null);(0,Ul.Z)((()=>{s.current&&i(getRelationshipTooltipTranslation(t,n,s.current.offsetWidth))}))
const{sourceDecoratorType:r,targetDecoratorType:o}=getRelationshipDecoratorTypes(e.type),l=getRelationshipDecoratorPixelPath(r,rI.RIGHT,II),c=getRelationshipDecoratorPixelPath(o,rI.RIGHT,wI),u=`${e.source.table.name}.${e.source.name}`,m=`${e.target.table.name}.${e.target.name}`
return d.createElement("div",{onMouseDown:e=>{e.stopPropagation()},className:f()((0,g.iv)(AI.wrapper)),ref:s,style:{transform:a}},d.createElement("div",{className:(0,g.iv)(AI.relationshipDataDiv)},d.createElement("div",{className:(0,g.iv)(AI.tableColumnNameDiv)},u),d.createElement("div",{className:(0,g.iv)(AI.tableColumnNameDiv)},m)),d.createElement("div",{className:(0,g.iv)(AI.relationshipSvgDiv)},d.createElement("svg",{width:"100%",height:"100%"},d.createElement("polyline",{strokeLinejoin:"round",points:stringifyPath(NI),fill:"none",stroke:Vt.G$,strokeWidth:2}),d.createElement("polyline",{strokeLinejoin:"round",points:stringifyPath(l),fill:"none",stroke:Vt.G$,strokeWidth:2}),d.createElement("polyline",{strokeLinejoin:"round",points:stringifyPath(c),fill:"none",stroke:Vt.G$,strokeWidth:2}))))}const AI=g.mM.create({wrapper:{width:"fit-content",height:50,backgroundColor:"white",cursor:"default",boxShadow:"0 0 5px #aaa",display:"flex"},relationshipDataDiv:{paddingLeft:6},relationshipSvgDiv:{width:40,paddingLeft:6},tableColumnNameDiv:{height:"50%",display:"flex",alignItems:"center",justifyContent:"flex-end"}})
function WarehouseDiagramContents({schemaName:e,focusTableName:t,warehouseModels:n}){const{layout:a,cellIsObscured:i,hideRelationshipTooltip:s,stopHoverRelationship:r}=useDiagramLayoutContext()
!function useDisabledHorizontalOverscroll(e=!0){useBodyStyleWhileMounted("overscrollBehaviorX","none",e)}()
const{translation:o,isPanning:l,centerLayout:c,startDiagramPan:u,shiftDiagramByWheelEvent:m}=function useDiagramPanningState(){const[e,t]=(0,d.useReducer)(panningReducer,{x:0,y:0}),[n,a]=(0,d.useState)(!1),i=(0,d.useRef)({x:0,y:0}),s=(0,d.useCallback)((e=>{const n={x:e.clientX-i.current.x,y:e.clientY-i.current.y}
t({type:pI.MOVE,mouseDelta:n})
i.current={x:e.clientX,y:e.clientY}
e.preventDefault()}),[]),r=(0,d.useCallback)((()=>{a(!1)
window.removeEventListener("mousemove",s)
window.removeEventListener("mouseup",r)}),[s]),o=(0,d.useCallback)((e=>{a(!0)
i.current={x:e.clientX,y:e.clientY}
window.addEventListener("mousemove",s)
window.addEventListener("mouseup",r)}),[s,r]);(0,d.useEffect)((()=>()=>{window.removeEventListener("mousemove",s)
window.removeEventListener("mouseup",r)}),[s,r])
return{translation:e,isPanning:n,centerLayout:(0,d.useCallback)((e=>{e.current&&t({type:pI.SET,newTranslation:{x:Math.floor(e.current.offsetWidth/2-135),y:Math.floor(e.current.offsetHeight/2-aI/2)}})}),[]),startDiagramPan:o,shiftDiagramByWheelEvent:(0,d.useCallback)((e=>{t({type:pI.MOVE,mouseDelta:{x:-e.deltaX,y:-e.deltaY}})}),[])}}(),p=`translate3d(${o.x}px, ${o.y}px, 0px)`
useDocumentCursor("move",l)
const h=(0,d.useRef)(null);(0,Ul.Z)((()=>{c(h)
window.addEventListener("resize",(0,Ja.Z)((()=>{c(h)}),20))}))
const E=(0,d.useMemo)((()=>d.createElement(WarehouseDiagramRelationshipSVG,{models:n})),[n]),S=(0,d.useMemo)((()=>Array.from(a.tableNameToCell).flatMap((([s,r],o)=>i(r,n)?[]:[d.createElement(WarehouseDiagramTable,{schemaName:e,tableData:n.tables.get(s),columnsExpanded:a.verticallyExpandedTables.has(s),isFocus:s===t,cell:r,key:o})]))),[t,e,n,a.tableNameToCell,a.verticallyExpandedTables,i])
return d.createElement(mI.Provider,{value:l},d.createElement("div",{className:(0,g.iv)(RI.wrapper),ref:h,onWheel:m,onMouseDown:e=>{u(e)
s()},onMouseMove:()=>{a.hoveredRelationship&&r()}},d.createElement("div",{className:(0,g.iv)(RI.diagramOverlayWrapper),style:{transform:p}},E),d.createElement("div",{className:f()((0,g.iv)(RI.diagramOverlayWrapper,RI.tableOverlayWrapper),"u-no-select"),style:{transform:p}},S),a.relationshipTooltip&&h.current&&d.createElement(WarehouseRelationshipTooltip,{tooltipData:a.relationshipTooltip,diagramWrapperRef:h}),d.createElement(SI,null)))}function WarehouseDiagram(e){const t=useDiagramLayoutState(e.warehouseModels.tables.get(e.focusTableName))
return d.createElement(dI.Provider,{value:t},d.createElement(WarehouseDiagramContents,{...e}))}const RI=g.mM.create({wrapper:{position:"relative",width:"100%",height:"100%",backgroundColor:Vt.bs,cursor:"move",overflow:"hidden"},diagramOverlayWrapper:{width:"100%",height:"100%",position:"absolute",overflow:"visible"},tableOverlayWrapper:{pointerEvents:"none"}})
function WarehouseDiagramWrapper(e){var t
const n=useWarehouseModelsQuery({sortColumns:!0})
switch(n.queryResultType){case Da.NI.SUCCESS:{const a=n.transformedData
if(null!=(null===(t=a.get(e.schemaName))||void 0===t?void 0:t.tables.get(e.focusTableName)))return d.createElement(WarehouseDiagram,{schemaName:e.schemaName,focusTableName:e.focusTableName,warehouseModels:a.get(e.schemaName)});(0,S.Gp)(!1,"Could not find warehouse table",{schemaName:e.schemaName,tableName:e.focusTableName})
return d.createElement(DiagramError,{errorMessage:"Failed to load entity diagram for this table"})}case Da.NI.PENDING:return d.createElement("div",{className:f()((0,g.iv)(PI.throbberWrapper),"u-text-align-center")},d.createElement(kl.Z,null))
default:return d.createElement(DiagramError,{errorMessage:"Failed to load entity diagram data"})}}const PI=g.mM.create({throbberWrapper:{marginTop:"16px"}})
function WarehouseDiagramModal(e){const{sidebarWidth:t,resizing:n,sidebarResize:a,endSidebarResize:i,startSidebarResize:s}=function useSidebarDragState(){const[e,t]=(0,d.useState)(350),[n,a]=(0,d.useState)({resizing:!1,startSidebarWidth:350})
return{sidebarWidth:e,resizing:n.resizing,startSidebarResize:t=>{if(!n.resizing){a({resizing:!0,startMouseX:t.clientX,startSidebarWidth:e})
t.preventDefault()}},sidebarResize:e=>{if(!n.resizing)return
const a=Math.floor(e.clientX-n.startMouseX)
t(Math.max(250,n.startSidebarWidth-a))
e.preventDefault()},endSidebarResize:t=>{if(n.resizing){a({resizing:!1,startSidebarWidth:e})
t.preventDefault()}}}}(),[r,o]=(0,d.useState)(e.draftSQLQuery)
return d.createElement("div",{className:f()("warehouse-diagram-modal-wrapper",(0,g.iv)(n&&OI.resizing)),onMouseMove:a,onMouseUp:i},d.createElement(et.ZP,{fullWidth:!0,fullHeight:!0,closeableOnBackgroundClick:!1,closeableOnEscapeKey:!1,bodyPadded:!1,onRequestClose:e.onRequestClose,title:"Entity Relationship Diagram"},d.createElement("div",{className:(0,g.iv)(OI.diagramModalContentWrapper)},d.createElement("div",{className:(0,g.iv)(OI.diagramContainer)},d.createElement(WarehouseDiagramWrapper,{schemaName:e.schemaName,focusTableName:e.focusTableName})),d.createElement("div",{className:(0,g.iv)(OI.sidebarSeparator),onMouseDown:s}),d.createElement("div",{className:(0,g.iv)(OI.sidebarContainer),style:{width:`${t}px`}},d.createElement(WarehouseDiagramSidebar,{modalSQLQuery:r,onModalSQLQueryChange:t=>{e.setDraftSQLQuery(t)
o(t)},sidebarWidth:t})))))}const OI=g.mM.create({diagramModalContentWrapper:{width:"100%",height:"100%",display:"flex",overflow:"hidden"},diagramContainer:{flexGrow:1,zIndex:0},sidebarContainer:{height:"100%",overflowY:"hidden",background:"white",zIndex:1},sidebarSeparator:{borderLeft:`4px solid ${Vt.tN}`,cursor:"col-resize",zIndex:1},resizing:{cursor:"col-resize"}})
var xI=n(191537)
function OpenEntityDiagramButton(e){const{draftSQLQuery:t,setDraftSQLQuery:n}=function useDraftQueryContext(){return Rw.useContext()}()
const a={icon:"erd",onClick:function openEntityDiagramModal(){(0,m.KK)(j.JG.OPENED_WAREHOUSE_DIAGRAM,{schemaName:e.schemaName,tableName:e.tableName})
const a={schemaName:e.schemaName,focusTableName:e.tableName,draftSQLQuery:t,setDraftSQLQuery:n,onRequestClose:()=>{}};(0,Xn.Z)(WarehouseDiagramModal,a)}}
return d.createElement(P.ZP,{title:"Open entity diagram",placement:e.tooltipPlacement},e.useHoverIcon?d.createElement(xI.Z,{...a,className:(0,g.iv)(DI.erdHoverIcon)}):d.createElement(C.Co,{...a,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI}))}OpenEntityDiagramButton.defaultProps={useHoverIcon:!1}
const _I=d.memo(OpenEntityDiagramButton),DI=g.mM.create({erdHoverIcon:{marginLeft:4}})
function trackOnCopy(){(0,m.KK)(j.JG.COPIED_TABLE_NAME_IN_SCHEMA_BROWSER)}function PresentationalWarehouseTableDetails({additionalActionButtons:e,fullTableName:t,onOpenListing:n,runQueryState:a}){(0,Ul.Z)((()=>{(0,m.KK)(j.JG.OPENED_TABLE_IN_SCHEMA_BROWSER)}))
const[i,s]=fullTableNameToSchemaAndRawTableNames(t)
return d.createElement(yf.ZP,{title:d.createElement("span",{className:"u-pointer",onClick:n},d.createElement(KE.Z,{className:"u-vertical-center-items",clipboardData:t,onClick:trackOnCopy},d.createElement(pe.Z,{className:f()("u-primary-color",(0,g.iv)(LI.titleIcon)),icon:"chevron-left"}),d.createElement("span",{className:"u-ellipsis-text"},t))),fitContent:!0,toolbar:d.createElement(d.Fragment,null,d.createElement("span",{className:f()("u-mini-spacing-right","faded")},a.status===Wr.Lr.SUCCESS?`${a.data.rows.length} row preview`:null),d.createElement("span",{className:f()("u-mini-spacing-right","faded")},d.createElement(_I,{schemaName:i,tableName:s,tooltipPlacement:P.TQ.TOP})),e)},a.status===Wr.Lr.SUCCESS&&d.createElement(JE,{runQueryOutput:a.data}),a.status===Wr.Lr.LOADING&&d.createElement(LoadingPaneContents,null))}function ConnectedWarehouseTableDetails(e){const t=(0,Wr.dw)((()=>zd({parameterizedSQLQuery:`SELECT * FROM ${e.fullTableName} LIMIT 5`,parameters:[]})))
return d.createElement(PresentationalWarehouseTableDetails,{...e,runQueryState:convertRunQueryStateToLegacyState(t)})}const LI=g.mM.create({titleIcon:{flexShrink:0}}),kI="Schema browser"
function WarehouseTableRow({actions:e,fullTableName:t}){const[n,a]=(0,uT.Z)(),[i,s]=fullTableNameToSchemaAndRawTableNames(t)
return d.createElement("div",{className:f()((0,g.iv)(MI.warehouseTableRow),"u-vertical-center-items"),onClick:()=>{e.openTable(t)},...a},d.createElement(KE.Z,{clipboardData:t,onClick:trackOnCopy,copyIconAlwaysVisible:n,disableTooltip:!n,tooltipPlacement:P.TQ.TOP,className:f()("u-vertical-center-items",(0,g.iv)(MI.clipboardTextWrapper))},d.createElement(pe.Z,{className:f()((0,g.iv)(MI.warehouseTableIcon),"u-mini-spacing-right"),icon:"warehouse-table"}),d.createElement("div",{className:(0,g.iv)(MI.ellipsisText)},t),n&&d.createElement(_I,{schemaName:i,tableName:s,useHoverIcon:!0,tooltipPlacement:P.TQ.TOP})))}function WarehouseTableListing({actions:e,additionalActionButtons:t,matchedSortedFullTableNames:n,query:a}){!function useTrackOnSearch(e,t){const n=(0,d.useMemo)((()=>({query:e,numResults:t})),[e,t]),{query:a,numResults:i}=(0,Su.N)(n,1e3);(0,d.useEffect)((()=>{a.length&&(0,m.KK)(j.JG.SEARCHED_IN_SCHEMA_BROWSER,{query_length:a.length,num_results:i})}),[a,i])}(a,n.length)
const[i,s]=(0,d.useState)(0),r=(0,d.useRef)(null)
function resetScroll(){r.current&&(r.current.scrollTop=0)}function handleChangeQuery(t){e.setQuery(t)
s(0)
resetScroll()}const o=n.slice(i,i+100)
return d.createElement(yf.ZP,{title:kI,fitContent:!0,toolbar:d.createElement("div",{className:"u-vertical-center-items"},d.createElement(nc.ZP,{className:(0,g.iv)(MI.searchInput),clearType:nc.Nl.X,onChange:e=>{handleChangeQuery(e.target.value)},onEscape:()=>{handleChangeQuery("")},placeholder:"Search",value:a}),t&&d.createElement("span",{className:"u-mini-spacing-left"},t))},d.createElement("div",{className:f()((0,g.iv)(MI.warehouseTableListing))},d.createElement("div",{ref:r,className:f()((0,g.iv)(MI.rowListWrapper),"scrollbar-override")},o.map((t=>d.createElement(WarehouseTableRow,{key:t,actions:e,fullTableName:t})))),n.length>100&&d.createElement("div",{className:(0,g.iv)(MI.pagerWrapper)},d.createElement(zT.Z,{setOffset:e=>{s(e)
resetScroll()},resultDescription:null,isLoading:!1,pagination:{limit:100,offset:i,total:n.length}}))))}function LoadingWarehouseTableListing({additionalActionButtons:e}){return d.createElement(yf.ZP,{title:kI,toolbar:e,fitContent:!0},d.createElement(LoadingPaneContents,null))}const MI=g.mM.create({clipboardTextWrapper:{display:"flex",width:"100%"},searchInput:{width:241},warehouseTableIcon:{color:Vt.pF,flexShrink:0},warehouseTableListing:{maxHeight:ip.gd,overflowY:"auto",display:"flex",flexDirection:"column"},pagerWrapper:{borderTop:`1px solid ${Vt.tN}`,paddingLeft:ip.mR,paddingRight:3},rowListWrapper:{overflowY:"auto"},warehouseTableRow:{cursor:"pointer",fontSize:13,paddingTop:3,paddingRight:3,paddingBottom:3,paddingLeft:ip.mR,width:"100%",height:26,":hover":{backgroundColor:Vt.bs}},ellipsisText:jf.wj})
function useWarehouseTableBrowserState(){const e=function useTableBrowserScreenState(){const[e,t]=(0,d.useState)({screen:JC.LISTING})
return(0,d.useMemo)((()=>({onOpenListing:()=>{t({screen:JC.LISTING})},onOpenTable:e=>{t({screen:JC.DETAILS,fullTableName:e})},screenState:e})),[e,t])}(),[t,n]=(0,d.useState)("")
return(0,d.useMemo)((()=>({...e,searchQuery:t,setSearchQuery:n})),[e,t,n])}const FI={_stubbableWarehouseTableBrowserRender:Jt.ZT}
function WarehouseTableBrowser({additionalActionButtons:e,warehouseModelsData:t,warehouseBrowserState:n}){const{onOpenListing:a,onOpenTable:i,screenState:s,searchQuery:r,setSearchQuery:o}=n,l=function getMatchedFullTableNames(e,t){return e.filter((e=>mo.Z.caseInsensitiveContains(e,t)))}((0,d.useMemo)((()=>(0,Jt.SL)([...t.entries()].flatMap((([e,t])=>[...t.tables.keys()].map((t=>[`${e}.${t}`,getTableViewName(e,t)])))).flat())),[t]),r)
FI._stubbableWarehouseTableBrowserRender()
switch(s.screen){case JC.LISTING:return d.createElement(WarehouseTableListing,{actions:{openTable:i,setQuery:o},additionalActionButtons:e,matchedSortedFullTableNames:l,query:r})
case JC.DETAILS:return d.createElement(ConnectedWarehouseTableDetails,{additionalActionButtons:e,fullTableName:s.fullTableName,onOpenListing:a})
default:(0,S.Gp)(!1,`Unexpected screen: ${(0,Go.vE)(s)}.`)
return null}}function WarehouseTableBrowserError(){return d.createElement("div",{className:f()((0,g.iv)(BI.errorWrapper),"u-text-align-center")},d.createElement(pe.Z,{icon:"warning",className:f()((0,g.iv)(BI.errorIcon))}),d.createElement("div",{className:(0,g.iv)(BI.errorText)},"Schema browser did not load correctly. Please refresh to try again."))}const ZI=d.memo((function QueryingWarehouseTableBrowser(e){const t=useWarehouseModelsQuery()
switch(t.queryResultType){case Da.NI.SUCCESS:return d.createElement(WarehouseTableBrowser,{...e,warehouseModelsData:t.transformedData})
case Da.NI.PENDING:return d.createElement(LoadingWarehouseTableListing,null)
default:return d.createElement(WarehouseTableBrowserError,null)}})),BI=g.mM.create({errorWrapper:{marginTop:16},errorIcon:{color:Vt.tN,height:60,width:60},errorText:{..._n.Nk,color:Vt.TG,fontWeight:_n.KB}})
function DynamicLayoutRow({children:e,height:t}){const n=d.Children.toArray(e).reduce(((e,t)=>{(0,S.hu)(d.isValidElement(t),"Expected children to be valid elements")
return e+t.props.widthProportion}),0);(0,S.hu)(1===n,"Expected total width proportions of column definitions to be equal to 1.",{totalProportion:n})
return d.createElement("div",{className:(0,g.iv)(qI.row),style:{height:t}},e)}function DynamicLayoutColumn({children:e,widthProportion:t}){return d.createElement("div",{className:(0,g.iv)(qI.column),style:{flexBasis:100*t+"%"},...(0,ee.Z)({component:"DynamicLayoutColumn",element:"wrapper"})},e)}function OneColumnDynamicLayoutRow({children:e,height:t}){return d.createElement(DynamicLayoutRow,{height:t},d.createElement(DynamicLayoutColumn,{widthProportion:1},e))}function DynamicLayout({children:e}){return d.createElement("div",{className:(0,g.iv)(qI.layout)},e)}const qI=g.mM.create({layout:{display:"flex",flexDirection:"column",minHeight:"100%",paddingLeft:12,paddingTop:12},row:{display:"flex",flexWrap:"wrap"},column:{flexShrink:1,flexGrow:1,minWidth:300,height:"100%",paddingRight:12,paddingBottom:12}})
function AnalyticsBlockEditorPaneToggleExpandButton({className:e,expandedPane:t,onToggleExpandPane:n,pane:a}){return d.createElement(ToggleExpandButton,{className:e,isExpanded:t===a,onChange:e=>{n(a,e)}})}function getShouldShowRawSQLQuery({sqlQuery:e}){const t=(0,Vd.Z)([e])
return Boolean(t.length)}function getRawSQLQuery(e){if(e.status===Wr.Lr.SUCCESS)return e.data.rawSQLQuery
if(e.status===Wr.Lr.ERROR){const{invalidSQLQuery:t}=e.responseJSON
return t||null}return null}const VI={showRawOutputState:bf,sortState:af}
function BaseBlockOverflowDropdown(e){return d.createElement(I.ZP,{menu:e.menu},d.createElement(Cc.C,{className:e.className,dataTestAttrs:{component:"BaseBlockOverflowDropdown",element:"button"},enableTooltip:!0}))}const UI={dropLeft:!0,height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE}
var GI,zI=n(946408),$I=n(507149)
function runQueryOutputToWorklistItemIds(e,t){const n=e.rows.flatMap((e=>{var n
return null!==(n=cellToItemIds(e[t],$I.f_))&&void 0!==n?n:[]}))
return l.default.unique(n)}function getAddToWorklistOption(e){return d.createElement(N.Z,{icon:"worklist-add",isDisabled:e.runQueryState.status!==Wr.Lr.SUCCESS},"Add to worklist",e.runQueryState.status===Wr.Lr.SUCCESS&&(0,zI.Z)({columns:(t=e.runQueryState.data,t.headers.map(((e,n)=>({name:e,itemIds:runQueryOutputToWorklistItemIds(t,n)}))).filter((e=>e.itemIds.length>0)))}))
var t}function LoadingOptionContent(){return d.createElement("span",{className:"u-faded"},"Preparing for copy...")}function OptionContent(e){const{queryResultType:t,resolvedRunQueryOutput:n}=useResolvedRunQueryOutput(e.runQueryOutput)
switch(t){case Da.NI.PENDING:return d.createElement(LoadingOptionContent,null)
case Da.NI.SUCCESS:e.tsvTextRef.current=runQueryOutputToTSV(function sortedResolvedRunQueryOutput(e,t){return sortedRunQueryOutput(e,t,{},!0)}(e.showRawOutput?e.runQueryOutput:n,e.sortState))
return d.createElement("div",null,e.showRawOutput?"Copy raw output to clipboard":"Copy to clipboard")
default:t!==Da.NI.ERROR&&t!==Da.NI.SKIPPED&&(0,Go.vE)(t)
e.tsvTextRef.current=runQueryOutputToTSV(e.runQueryOutput)
return d.createElement("div",null,"Copy raw output to clipboard")}}function getCopyAsTSVOption(e){const t=(0,Wr.yf)(e.runQueryState)
return d.createElement(N.Z,{icon:"copy",isDisabled:null==t,onSelect:()=>{if(e.tsvTextRef.current){(0,m.KK)(j.JG.COPIED_QUERY_OUTPUT_AS_TSV);(0,$b.Z)(e.tsvTextRef.current,{showToastOnSuccess:!0,toastText:"Copied to clipboard."})}},dataTestAttrs:{component:"BaseBlockOverflowDropdown",key:"copyAsTSV"}},null!=t?d.createElement(OptionContent,{runQueryOutput:t,showRawOutput:e.showRawOutput,sortState:e.sortState,tsvTextRef:e.tsvTextRef}):d.createElement(LoadingOptionContent,null))}getCopyAsTSVOption.defaultProps={sortState:null}
!function(e){e.RAW_OUTPUT_CSV="RAW_OUTPUT_CSV"
e.RESOLVED_OUTPUT_CSV="RESOLVED_OUTPUT_CSV"}(GI||(GI={}))
function getDownloadAsCSVOption(e){const{exportType:t,optionText:n}=e.showRawOutput?{exportType:GI.RAW_OUTPUT_CSV,optionText:"Download raw output as CSV"}:{exportType:GI.RESOLVED_OUTPUT_CSV,optionText:"Download as CSV"}
return d.createElement(N.Z,{icon:"download",isDisabled:e.runQueryState.status!==Wr.Lr.SUCCESS,onSelect:function handleSelect(){e.actions.exportBlock(t)},dataTestAttrs:{component:"BaseBlockOverflowDropdown",element:"menuOption",key:"downloadAsCSV"}},n)}var WI=n(722417),HI=n(199052),jI=n(554475),YI=n(914073)
const QI=xa.Ps`
  query ExecuteRequestsQuery($requestIds: [StrictString!]!) @skipAudit @engComponent(name: INSIGHTS) {
    requests(ids: $requestIds) {
      ... on RequestNode {
        ...RequestGraphQL
        schema {
          ...RequestSchemaGraphQL
        }
        sampleGroups {
          samples {
            id
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("Request").fragment}
  ${(0,La.f)("RequestSchema").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
async function handleSelectColumn({uniqueRequestIds:e}){(0,S.Gp)(e.length===new Set(e).size,"Column items have duplicates",{uniqueRequestIds:e})
const t="checking-requests-executable"
v.ZP.info("Checking whether requests are executable...",{id:t,duration:0})
const n=await(0,Ml.doQuerySafe)({query:QI},{variables:{requestIds:e}})
if(n.requests){const e=n.requests.filter((e=>(0,ka.CZ)(e)))
if(e.length>0){v.ZP.error(`You do not have permission to execute ${de._6(e.length,"request")} ${e.map((e=>e.invalidId)).join(", ")}`)
return}const a=(0,Jt.m8)(n.requests.map((e=>[e.id,(0,zo.tY)("RequestSchema",e.schema)]))),i=(0,Jt.m8)(n.requests.map((e=>[e.id,e.sampleGroups.filter((e=>0!==e.samples.length)).length>0]))),s=(0,zo.NA)("Request",n.requests),{explanationMessage:r}=(0,WI.Z)({requests:s,requestSchemaByRequestId:a,requestIdToRequestHasSamples:i})
v.ZP.close(t)
null==r?Xe.bA(HI.ZP,d.createElement(HI.ZP,{requests:s,initialFilters:[],requestSchemasByRequestId:a,onRequestClose:()=>{Xe.xv(HI.ZP)}})):v.ZP.error(r)}}function runQueryOutputToRequestIds(e,t){const n=e.rows.flatMap((e=>{var n
return null!==(n=cellToItemIds(e[t],(e=>ea.ZP.isRequest(e))))&&void 0!==n?n:[]}))
return l.default.unique(n)}function getExecuteRequestOptionMenu(e){return d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.MEDIUM},d.createElement(jI.Z,null,d.createElement(YI.Z,null,"Column"),e.columns.length?e.columns.map(((e,t)=>function columnToOption(e,t){(0,S.Gp)(e.uniqueRequestIds.length>0,"Column has no items",{name:e.name})
return d.createElement(N.Z,{key:`${t}-${e.name}`,contentType:Nr.O7.PLAIN,onSelect:handleSelectColumn,shouldEllipsize:!0,value:e},e.name)}(e,t))):d.createElement(N.Z,{contentType:Nr.O7.PLAIN,isDisabled:!0},"No columns for requests found")))}function getExecuteRequestOption(e){return d.createElement(N.Z,{icon:"request",isDisabled:e.runQueryState.status!==Wr.Lr.SUCCESS},"Execute request",e.runQueryState.status===Wr.Lr.SUCCESS&&getExecuteRequestOptionMenu({columns:(t=e.runQueryState.data,t.headers.map(((e,n)=>({name:e,uniqueRequestIds:runQueryOutputToRequestIds(t,n)}))).filter((e=>e.uniqueRequestIds.length>0)))}))
var t}function AnalyticsBlockEditorOverflowDropdown({actions:e,className:t,blockViewStateId:n,runQueryState:a}){const[i]=VI.showRawOutputState.useGlobalClientState(n),[s]=VI.sortState.useGlobalClientState(n),r=(0,d.useRef)(null),o=(0,d.useMemo)((()=>convertRunQueryStateToLegacyState(a)),[a]),l=(0,d.useMemo)((()=>getDownloadAsCSVOption({actions:e,runQueryState:o,showRawOutput:i})),[e,o,i]),c=(0,d.useMemo)((()=>getCopyAsTSVOption({runQueryState:o,showRawOutput:i,sortState:s,tsvTextRef:r})),[o,i,s,r]),u=(0,d.useMemo)((()=>getAddToWorklistOption({runQueryState:o})),[o]),m=(0,d.useMemo)((()=>getExecuteRequestOption({runQueryState:o})),[o])
return d.createElement(BaseBlockOverflowDropdown,{className:t,menu:d.createElement(w.ZP,{...UI},l,c,u,m)})}function BlankUniversalBlockView({paneProps:e}){return d.createElement(yf.ZP,{...e,centerContent:!0},d.createElement("div",null))}function getWarningMessageForRowLimit(e){return e.total>pu?"Query limit of 1000 automatically added.":null}function getVisualizationWarnings(e,t=!1){return l.default.compact([getWarningMessageForRowLimit(e),getWarningMessageForChipItems(e),t?"Displayed results are from a sub query and will not be saved on dashboard.":null])}function shouldRenderAnalyticsVisualizationEditor(e){return e.isRunning||null!=e.runQueryOutput}function AnalyticsVisualizationEditor(e){(0,S.Gp)(shouldRenderAnalyticsVisualizationEditor(e),"Caller should check shouldRenderAnalyticsVisualizationEditor")
const{viewStateId:t}=uE.useContext(),n=(0,d.useMemo)((()=>e.runQueryOutput?convertRunQueryOutputToLegacyOutput(e.runQueryOutput):null),[e.runQueryOutput]),a=(0,d.useMemo)((()=>n?getVisualizationWarnings(n,e.isDisplayingSubQueryResults):[]),[e.isDisplayingSubQueryResults,n])
async function handleChangeAnalyticsVisualization(t){const n=e.visualization
await e.actions.updateAnalyticsVisualization(n,t)
null!=getRegressionType(n)&&getRegressionType(t)!==getRegressionType(n)&&e.actions.cleanUpRegressionState()}const i={paneProps:{title:e.visualizationTitle,toolbar:e.additionalActionButtons,warnings:a,dataTestAttrs:{component:"AnalyticsVisualizationEditor",element:"root"}}}
return d.createElement(LoadingOverlay,{message:ip.FX,isLoading:e.isRunning||!e.runQueryOutput},function renderUniversalBlock(){const n=e.runQueryOutput
return null==n?d.createElement(BlankUniversalBlockView,{...i}):d.createElement(PresentationalUniversalBlockView,{actionOrigin:cd.Z.INSIGHTS,...i,configEditorSettings:{onChangeVisualizationConfig:handleChangeAnalyticsVisualization,showConfigEditor:!0},inputDataFrame:n.dataFrame,isLegacyInsights:!0,renderOptions:{isRawOutputEnabled:!0},viewStateId:t,visualizationConfig:e.visualization})}())}function shouldRenderSQLConsole(e){return null!=e.errorMessage||null!=e.rawSQLQuery}function SQLConsole(e){(0,S.Gp)(shouldRenderSQLConsole(e),"Caller should check shouldRenderSQLConsole")
return d.createElement(yf.ZP,{title:"Console",fitContent:!0},e.errorMessage&&d.createElement("pre",{className:(0,g.iv)(KI.errorMessage,KI.contentMargin)},e.errorMessage),e.rawSQLQuery&&d.createElement("pre",{className:(0,g.iv)(null==e.errorMessage?KI.contentMargin:KI.partialContentMargin)},"----- Executed query -----","\n",e.rawSQLQuery))}const KI=g.mM.create({errorMessage:{color:Vt.hM},contentMargin:{margin:ip.mR},partialContentMargin:{marginTop:0,marginRight:ip.mR,marginBottom:ip.mR,marginLeft:ip.mR}})
function AnalyticsQueryOutputPaneGroup(e){const{screenState:t}=e,{analyticsDashboardViewStateId:n}=useAnalyticsDashboardContext(),a=(0,Bd.kn)(e.analyticsQuery.id,n),i={actions:{cleanUpRegressionState:()=>{(0,Vn.getStore)().dispatch((0,mE.t3)(e.analyticsQuery.id,null))},updateAnalyticsVisualization:e.actions.updateAnalyticsVisualization},additionalActionButtons:d.createElement(d.Fragment,null,d.createElement(AnalyticsBlockEditorOverflowDropdown,{actions:{exportBlock:e.actions.exportBlock},className:"u-mini-spacing-left",blockViewStateId:a,runQueryState:e.runQueryState}),d.createElement(AnalyticsBlockEditorPaneToggleExpandButton,{className:"u-mini-spacing-left",expandedPane:t.expandedPane,onToggleExpandPane:e.actions.toggleExpandPane,pane:Jd.VISUALIZATION_EDITOR})),isDisplayingSubQueryResults:e.isDisplayingSubQueryResults,isExpanded:e.isExpanded,isRunning:e.isRunning,runQueryOutput:(0,Wr.yf)(e.runQueryState),visualization:e.analyticsQuery.visualization,visualizationTitle:e.analyticsQuery.name},s={errorMessage:e.runQueryState.status===Wr.Lr.ERROR?e.runQueryState.message:null,rawSQLQuery:getShouldShowRawSQLQuery(e.analyticsQuery)||e.isDisplayingSubQueryResults?getRawSQLQuery(e.runQueryState):null}
return d.createElement(d.Fragment,null,shouldRenderAnalyticsVisualizationEditor(i)&&d.createElement(OneColumnDynamicLayoutRow,{height:e.isExpanded?ip.Si:ip.ZB},d.createElement(uE.Provider,{value:{actionOrigin:cd.Z.INSIGHTS,viewStateId:a}},d.createElement(AnalyticsVisualizationEditor,{...i}))),shouldRenderSQLConsole(s)&&d.createElement(OneColumnDynamicLayoutRow,null,d.createElement(SQLConsole,{...s})))}var JI
!function(e){e.EQ="EQ"
e.GTE="GTE"
e.IN="IN"
e.IS="IS"
e.JSON_IN="JSON_IN"
e.LTE="LTE"}(JI||(JI={}))
const XI={[JI.EQ]:"=",[JI.GTE]:">=",[JI.IN]:"IN",[JI.IS]:"IS",[JI.JSON_IN]:"?|",[JI.LTE]:"<="}
function interpolateSQLQuery(e){const t=e.excludeDuplicates?" DISTINCT":"",n=function interpolateSelectedColumns(e){return e.length>0?e.map((e=>{const t=e.alias?` AS "${e.alias}"`:""
return`\t"${e.columnName}"${t}`})).join(",\n"):"\t*"}(e.selectedColumns),a=e.filters.length>0?function interpolateFilters(e){return e.map(((e,t)=>{let n
if(function isListFilter(e){return e.operator===JI.IN||e.operator===JI.JSON_IN}(e))n=function interpolateListFilter(e){(0,S.hu)(Array.isArray(e.value),"Got non-array value for list filter")
const t=XI[e.operator],n=e.isNot?"NOT ":"",a=e.value.map((e=>`'${e}'`)).join(", ")
let i
switch(e.operator){case JI.JSON_IN:i=`array[${a}]`
break
case JI.IN:i=`(${a})`
break
default:throw new Error(`Invalid sql filter operator type ${(0,Go.vE)(e.operator)}`)}return`${n}"${e.filteredColumnName}" ${t} ${i}`}(e)
else{(0,S.hu)(!Array.isArray(e.value),"Got array value for non-list filter")
switch(e.operator){case JI.EQ:{const t=`${e.isNot?"!":""}${XI[e.operator]}`,a="string"==typeof e.value?`'${e.value}'`:String(e.value)
n=`"${e.filteredColumnName}" ${t} ${a}`
break}case JI.IS:n=`"${e.filteredColumnName}" ${XI[e.operator]}${e.isNot?" NOT":""} NULL`
break
case JI.GTE:case JI.LTE:{const t="string"==typeof e.value?`'${e.value}'`:String(e.value)
n=`"${e.filteredColumnName}" ${XI[e.operator]} ${t}`
break}default:throw new Error(`Unexpected sql filter operator type ${e.operator}`)}}return`\t${0===t?"":"AND "}${n}`})).join("\n")}(e.filters):null
let i=`SELECT${t}\n${n}\nFROM ${e.selectedTable}`
null!=a&&(i=`${i}\nWHERE\n${a}`)
null!=e.limit&&(i=`${i}\nLIMIT ${e.limit}`)
return i}const ew=new Set([au.Dq.IS_NONE_OF,au.Dq.NOT_EQUALS,au.Dq.IS_NOT_NULL])
function isSQLTemplateFormStateValid(e){return(0,au.Cn)(e)&&!e.availableColumns.some((e=>null!=e.validationError))&&!e.columnFilters.some((e=>null!=e.validationError))}function columnFilterTypeToSQLFilterOperator(e,t){if(e===au.Dq.IS_ONE_OF||e===au.Dq.IS_NONE_OF)return t?JI.JSON_IN:JI.IN
if(e===au.Dq.EQUALS||e===au.Dq.NOT_EQUALS)return JI.EQ
if(e===au.Dq.GTE)return JI.GTE
if(e===au.Dq.LTE)return JI.LTE
if(e===au.Dq.IS_NULL||e===au.Dq.IS_NOT_NULL)return JI.IS
throw new Error(`Invalid column filter type ${e}`)}function makeSQLInterpolationInput(e){if(!isSQLTemplateFormStateValid(e))return null
const{availableColumns:t,columnFilters:n,excludeDuplicates:a,selectedTable:i}=e
return{excludeDuplicates:a,filters:n.filter((e=>e.values.length>0)).map((e=>function columnFilterToSQLFilter(e,t){const n=t[e.filteredColumnIndex]
return{filteredColumnName:n.columnData.name,operator:columnFilterTypeToSQLFilterOperator(e.filterType,(i=n,i.columnData.type===Sn.Fw.JSON||i.columnData.type===Sn.Fw.JSONB)),value:e.values,isNot:(a=e.filterType,ew.has(a))}
var a,i}(e,t))),selectedTable:`${i.schemaName}.${i.name}`,selectedColumns:t.filter((e=>e.selected)).map((e=>{const{alias:t,columnData:n}=e
return{alias:t,columnName:n.name}}))}}function EditSQLButton(e){const t=(0,au.Cn)(e.sqlTemplateFormState)&&!isSQLTemplateFormStateValid(e.sqlTemplateFormState)
return d.createElement(P.ZP,{disabled:!t,title:"The form has errors that must be fixed before editing the SQL",placement:P.TQ.TOP},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,disabled:t,onClick:async function handleClick(){await async function runConfirmEditSQLModal(){return await je.iG("Edit SQL?","You will not be able to return to the template if you edit the SQL query. Are you sure you want to edit the SQL?",C.ZJ.SECONDARY,{acceptText:"Edit SQL",rejectText:"Cancel",enableRedesign:!0,promiseCompatible:!0})}()&&e.editSQL()},size:C.qE.MINI,text:"Edit SQL",dataTestAttrs:{component:"EditSQLButton",element:"button"}}))}var tw=n(537076),nw=n(351231),aw=n(556543)
function BioentityTableSelector(e){var t
const[n,a]=(0,d.useMemo)((()=>{const t=[...e.warehouseModelsData.values()].flatMap((e=>[...e.tables.values()])).filter((e=>{var t
return"TagSchemaNode"===(null===(t=e.schema)||void 0===t?void 0:t.__typename)})),n=(0,Jt.m8)(t.map((e=>[e.schema.id,e]))),a=function getBioentityTableSelectorOptions(e){const t=e.filter((e=>(0,tw.isRegistrySupportedType)((0,zo.tY)("TagSchema",e).folderItemType))),n=[...new Set(t.map((e=>(0,aw.E5)((0,zo.tY)("TagSchema",e)))))]
return(0,nw.U)(t,[],null,{sections:(0,Jt.UY)(n.map((e=>({title:(0,Mt.co)((0,Mt.E2)(e)),containsSchema:t=>(0,aw.E5)((0,zo.tY)("TagSchema",t))===e}))),"title")}).map((e=>"schema-option"===e.className?{...e,icon:e.value.iconId}:e))}(t.map((e=>e.schema)))
return[n,a]}),[e.warehouseModelsData]),i=null==e.selectedTable?null:e.selectedTable.schema
return d.createElement($r.ZP,{displayName:null!==(t=null==i?void 0:i.name)&&void 0!==t?t:"Select an entity schema",menu:d.createElement(Ar.Z,{onSelect:function handleChangeSelectedTable(t){const a=n[t.id],i=a?function getDefaultAvailableColumnsForTable(e){return e.columns.map((e=>{const t=function getFieldNameForColumn(e){var t,n
return null==e.table.schema?null:null!==(n=null===(t=e.table.schema.allFieldsJson.find((t=>t.systemName===e.name)))||void 0===t?void 0:t.displayName)&&void 0!==n?n:null}(e)
return{...getDefaultAvailableColumnForColumnData(e),...t?{alias:t}:null,typeInfo:getColumnTypeInfo(e)}}))}(a):[]
e.setSelectedTable(a,i)},optionDatas:a,selectedValue:i}),dataTestAttrs:{component:"BioentityTableSelector",element:"root"}})}function QueryingBioentityTableSelector(e){const t=useWarehouseModelsQuery({sortColumns:!0})
return t.queryResultType===Da.NI.SUCCESS?d.createElement(BioentityTableSelector,{...e,warehouseModelsData:t.transformedData}):t.queryResultType===Da.NI.PENDING?d.createElement(kl.b,null):null}function ExcludeDuplicatesCheckbox(e){return d.createElement(Io.Z,{className:f()("u-spacing-top",(0,g.iv)(iw.checkboxWrapper)),checked:e.excludeDuplicates,id:"exclude-duplicates-checkbox",label:"Exclude duplicate values",onChange:t=>{e.setExcludeDuplicates(t.target.checked)}})}const iw=g.mM.create({checkboxWrapper:{display:"flex"}})
var sw=n(356873)
function SQLColumnSelectorTable(e){const t=0===e.availableColumns.length,[n,a]=(0,d.useState)(null)
return d.createElement(rc.iA,{className:f()("u-no-select",(0,g.iv)(rw.table)),emptyTableText:"No fields available.",numRows:e.availableColumns.length,frozenHeader:!0,overflowVisible:!0,onRowClick:(t,i)=>{!function handleSelection(t,i,s){if(s&&null!=n){const a=Math.min(n,t),s=Math.max(n,t)
e.updateColumnStatesInRange(a,s,{selected:i})}else e.updateColumnState(t,{selected:i})
a(t)}(t,!e.availableColumns[t].selected,i.shiftKey)}},d.createElement(rc.sg,{header:d.createElement(rc.bL,{className:"simpleTable-checkboxCell"},d.createElement(sw.Z,{disabled:t,items:e.availableColumns,selectedMap:e=>e.selected,onChange:t=>{e.updateAllColumnStates({selected:t.target.checked})}})),renderCell:n=>d.createElement(rc.bL,{className:"simpleTable-checkboxCell"},d.createElement("input",{checked:e.availableColumns[n].selected,disabled:t,readOnly:!0,type:"checkbox"}))}),d.createElement(rc.sg,{header:d.createElement(rc.bL,null,"Field"),renderCell:t=>d.createElement(rc.bL,null,d.createElement(pe.Z,{className:(0,g.iv)(rw.typeIcon),icon:getColumnIcon(e.availableColumns[t])}),d.createElement("span",{className:"u-mini-spacing-left"},e.availableColumns[t].columnData.name))}),d.createElement(rc.sg,{header:d.createElement(rc.bL,null,"Display name"),renderCell:n=>{const a=e.availableColumns[n].validationError
return d.createElement(rc.bL,null,d.createElement(or.Z,{className:(0,g.iv)(rw.aliasInput),disabled:t,onClick:e=>{e.stopPropagation()},hasError:null!=a,onChange:t=>{!function setColumnAlias(t,n){e.updateColumnState(t,{alias:n.length>0?n:null,selected:!0,validationError:validateFormValues([n],"Display name",nu.KE)})}(n,t.target.value)},size:Mo.$u.SMALL,value:e.availableColumns[n].alias||""}),d.createElement(Dt.Z,{compact:!0,message:a}))}}))}const rw=g.mM.create({aliasInput:{width:200},table:{overflowY:"scroll",maxHeight:ip.vm-125},typeIcon:{color:Vt.TG}}),ow=[au.Dq.IS_ONE_OF,au.Dq.IS_NONE_OF]
function SQLFilterOperatorSelector(e){var t,n
const a=null!==(t=e.columnFilterTypeOptions)&&void 0!==t?t:ow
return d.createElement($r.ZP,{buttonSize:null!==(n=e.buttonSize)&&void 0!==n?n:C.qE.SMALL,className:(0,g.iv)(lw.selectButton),disabled:e.disabled,displayName:nu.pM[e.selectedType],menu:d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.LARGE},a.map(((t,n)=>d.createElement(N.Z,{key:n,value:t,onSelect:()=>{e.onUpdateOperator(t)}},nu.pM[t]))))})}const lw=g.mM.create({selectButton:{whiteSpace:"nowrap"}})
var cw=n(65301),dw=n(239310)
function SQLFilterValueInput(e){const{typeInfo:t}=e.filteredColumn
let n
if(t.type===au.qb.BIOENTITY)n=d.createElement(cw.Z,{chipSize:Za.TK.MINI,onChange:t=>{const n=t.map((({id:e})=>e)).filter((e=>null!=e))
e.updateValues(n,n.join(","))},shouldAllowMultiple:!0,selectedItems:e.columnFilter.values.map((e=>({id:e}))),tagSchemaOrInterfaceId:t.linkedSchema?t.linkedSchema.id:null})
else{(0,S.Gp)(t.type===au.qb.TEXT,`Unexpected value type: ${t}`)
n=d.createElement(dw.Z,{className:(0,g.iv)(uw.textInput),hasError:null!=e.columnFilter.validationError,onChange:e.updateValues,value:e.columnFilter.rawValues,size:Mo.$u.MEDIUM})}return d.createElement(Ke.Z,null,n,d.createElement(Dt.Z,{message:e.columnFilter.validationError}))}const uw=g.mM.create({textInput:{flexGrow:1,flexBasis:200,height:36,maxWidth:600}}),mw={},pw={name:"Clear selection",value:mw},hw={name:"Included fields",isHeader:!0,className:"schema-section"},gw={name:"Excluded fields",isHeader:!0,className:"schema-section"},Ew={disabled:!0,disabledMessage:"This column's type is not supported as a filter."},fw="_selected"
function getColumnSelectorMenuOptions(e,t){const n=e.map(((e,t)=>({icon:getColumnIcon(e),name:getColumnDisplayName(e),[fw]:e.selected,value:t,...nu.xf[e.columnData.type]?{}:Ew}))),[a,i]=l.default.partition(n,(e=>e._selected))
return[...null!=t?[pw]:[],...a.length>0?[hw,...a.map((e=>(0,ig.Z)(e,fw)))]:[],...i.length>0?[gw,...i.map((e=>(0,ig.Z)(e,fw)))]:[]]}function SQLFilterSelector(e){var t,n
const a=null!==(t=e.columnFilters[0])&&void 0!==t?t:null,i=null!==(n=e.availableColumns[null==a?void 0:a.filteredColumnIndex])&&void 0!==n?n:null,s=e.disabled||0===e.availableColumns.length
function handleUpdateColumnFilter(t){e.updateColumnFilters([t])}const r=d.createElement(Ar.Z,{height:Nr.Bl.MEDIUM,optionDatas:getColumnSelectorMenuOptions(e.availableColumns,a),onSelect:function onSelectColumn(t){t===mw?function handleClearFilter(){e.updateColumnFilters([])}():function handleUpdateFilteredColumnIndex(e){handleUpdateColumnFilter({...nu._D,filteredColumnIndex:e})}(t)},scrollable:!0,selectedValue:null==a?void 0:a.filteredColumnIndex,width:Nr.zL.LARGE});(0,S.Gp)(null==a||null!=e.selectedTable,"Found non-null columnFilter but did not get a non-null selectedTable")
return d.createElement("div",{className:(0,g.iv)(Sw.rootWrapper)},d.createElement($r.ZP,{buttonSize:C.qE.MEDIUM,className:(0,g.iv)(Sw.subSelectorWrapper),disabled:s,displayName:null!=i?getColumnDisplayName(i):"Select a field",menu:r}),!s&&null!=a&&null!=e.selectedTable&&d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(Sw.subSelectorWrapper)},d.createElement(SQLFilterOperatorSelector,{buttonSize:C.qE.MEDIUM,selectedType:a.filterType,onUpdateOperator:e=>{!function handleUpdateOperator(e){(0,S.hu)(null!=a,"Expected filter to exist before being able to select an filterType")
handleUpdateColumnFilter({...a,filterType:e})}(e)}})),d.createElement(SQLFilterValueInput,{columnFilter:a,filteredColumn:i,updateValues:function handleUpdateValues(e,t){(0,S.hu)(null!=a,"Expected filter to exist before being able to update values")
handleUpdateColumnFilter({...a,rawValues:t,validationError:validateFormValues(e,"Filter values",nu.RW),values:e})}})))}const Sw=g.mM.create({rootWrapper:{display:"flex",flexWrap:"wrap"},subSelectorWrapper:{paddingBottom:8,paddingRight:8,whiteSpace:"nowrap"}})
function SQLTemplateFormStepWrapper(e){return d.createElement("div",{className:(0,g.iv)(yw.formStepWrapper)},d.createElement(so.BB,null,e.title),d.createElement("div",{className:"u-spacing-left"},e.children))}SQLTemplateFormStepWrapper.defaultProps={isLastStep:!1}
function SQLTemplateFormWrapper(e){return d.createElement("form",{className:(0,g.iv)(yw.formWrapper)},e.children)}const yw=g.mM.create({formWrapper:{display:"flex",flexDirection:"row",flexWrap:"nowrap",margin:ip.mR},formStepWrapper:{paddingRight:50,flexGrow:0,":last-child":{flexGrow:1,paddingRight:0}}})
const bw={[au.dm.BASIC_BIOENTITY]:function BioentitySQLTemplateForm(e){const{availableColumns:t,columnFilters:n,selectedTable:a}=(0,au.Cn)(e.sqlTemplateFormState)?e.sqlTemplateFormState:{availableColumns:[],columnFilters:[],selectedTable:null}
return d.createElement(d.Fragment,null,d.createElement(SQLTemplateFormStepWrapper,{title:"1. Select data"},d.createElement(QueryingBioentityTableSelector,{selectedTable:e.sqlTemplateFormState.selectedTable,setSelectedTable:e.setSelectedTable}),d.createElement(ExcludeDuplicatesCheckbox,{excludeDuplicates:e.sqlTemplateFormState.excludeDuplicates,setExcludeDuplicates:e.setExcludeDuplicates})),d.createElement(SQLTemplateFormStepWrapper,{title:"2. Choose fields to include"},d.createElement(SQLColumnSelectorTable,{availableColumns:t,updateColumnState:e.updateColumnState,updateColumnStatesInRange:e.updateColumnStatesInRange,updateAllColumnStates:e.updateAllColumnStates})),d.createElement(SQLTemplateFormStepWrapper,{title:"3. Filter results"},d.createElement(SQLFilterSelector,{availableColumns:t,columnFilters:n,disabled:!(0,au.Cn)(e.sqlTemplateFormState),selectedTable:a,updateColumnFilters:e.updateColumnFilters})))}}
function SQLTemplateForm(e){const t=bw[e.formType]
function setSQLTemplateFormStateAndQuery(t){e.actions.setSQLTemplateFormState(t)
const n=makeSQLInterpolationInput(t)
null!=n&&e.actions.setDraftSQLQuery(interpolateSQLQuery(n))}function handleUpdateColumnStatesInRange(t,n,a){(0,au.jL)(e.sqlTemplateFormState)
setSQLTemplateFormStateAndQuery({...e.sqlTemplateFormState,availableColumns:e.sqlTemplateFormState.availableColumns.map(((e,i)=>i>=t&&i<=n?{...e,...a}:e))})}return d.createElement(yf.ZP,{title:"Query",toolbar:e.additionalActionButtons,dataTestAttrs:{component:"SQLTemplateForm",element:"root"}},d.createElement(SQLTemplateFormWrapper,null,d.createElement(t,{sqlTemplateFormState:e.sqlTemplateFormState,setSelectedTable:function handleSetSelectedTable(t,n){setSQLTemplateFormStateAndQuery({...e.sqlTemplateFormState,selectedTable:t,availableColumns:n,columnFilters:[]})},setExcludeDuplicates:function handleSetExcludeDuplicates(t){setSQLTemplateFormStateAndQuery({...e.sqlTemplateFormState,excludeDuplicates:t})},updateColumnFilters:function handleUpdateColumnFilters(t){(0,au.jL)(e.sqlTemplateFormState)
setSQLTemplateFormStateAndQuery({...e.sqlTemplateFormState,columnFilters:t})},updateColumnState:function handleUpdateColumnState(t,n){(0,au.jL)(e.sqlTemplateFormState)
setSQLTemplateFormStateAndQuery({...e.sqlTemplateFormState,availableColumns:e.sqlTemplateFormState.availableColumns.map(((e,a)=>a===t?{...e,...n}:e))})},updateColumnStatesInRange:handleUpdateColumnStatesInRange,updateAllColumnStates:function handleUpdateAllColumnStates(t){(0,au.jL)(e.sqlTemplateFormState)
handleUpdateColumnStatesInRange(0,e.sqlTemplateFormState.availableColumns.length-1,t)}})))}function AnalyticsBlockEditorContent(e){const{screenState:t,actions:{collapsePane:n,expandPane:a}}=e,i=e.runQueryState.status===Wr.Lr.LOADING
const s=(0,d.useCallback)(((e,t)=>{t?a(e):n()}),[n,a])
const r=d.createElement(SQLEditorPane,{additionalActionButtons:d.createElement(d.Fragment,null,d.createElement(Cc.Z,{enableTooltip:!0,menuProps:{dropLeft:!0},options:[getAddParameterMenuOption({sqlQuery:e.draftSQLQuery,onAddParameter:function handleAddParameter(t){const n=`${e.draftSQLQuery}\n{{${t}}}`
e.actions.setDraftSQLQuery(n)
e.actions.saveAndRunQuery(n)},disabled:i}),{icon:"note-code",contents:d.createElement("span",null,"Format SQL"),onSelect:function formatSQLQuery(){const t=(0,GC.WU)(e.draftSQLQuery,{language:"postgresql",paramTypes:{custom:[{regex:String.raw`\{\{.+?\}\}`}]}})
e.actions.setDraftSQLQuery(t)}},{icon:"open",contents:d.createElement("span",null,"Help with dashboards"),href:ip.lZ,openInNewTab:!0}]}),d.createElement(AnalyticsBlockEditorPaneToggleExpandButton,{className:"u-mini-spacing-left",expandedPane:t.expandedPane,onToggleExpandPane:s,pane:Jd.SQL_EDITOR})),actions:{saveAndRunQuery:e.actions.saveAndRunQuery,setSQLQuery:e.actions.setDraftSQLQuery,setSQLSubQuery:e.actions.setSQLSubQuery},isExpanded:t.expandedPane===Jd.SQL_EDITOR,isRunning:i,sqlQuery:e.draftSQLQuery}),o=(0,d.useMemo)((()=>d.createElement(AnalyticsBlockEditorPaneToggleExpandButton,{expandedPane:t.expandedPane,onToggleExpandPane:s,pane:Jd.WAREHOUSE_BROWSER})),[t.expandedPane,s]),l=useWarehouseTableBrowserState(),c=d.createElement(ZI,{additionalActionButtons:o,warehouseBrowserState:l})
let u
const m=e.blockEditorUIState.sqlTemplateFormState
u=null!=m?d.createElement(OneColumnDynamicLayoutRow,{height:ip.vm},d.createElement(SQLTemplateForm,{...e,formType:m.formType,additionalActionButtons:d.createElement(EditSQLButton,{editSQL:e.actions.switchToSQLEditor,sqlTemplateFormState:m}),sqlTemplateFormState:m})):d.createElement(DynamicLayoutRow,null,d.createElement(DynamicLayoutColumn,{widthProportion:7/12},r),d.createElement(DynamicLayoutColumn,{widthProportion:5/12},c))
const p=d.createElement(AnalyticsQueryOutputPaneGroup,{...e,actions:{exportBlock:function handleExportToCSV(t){e.actions.exportAnalyticsQueryOutputToCSV(e.analyticsQuery,e.parameterConfigs,e.parameterValues,{dashboardName:e.analyticsDashboardAttrs.name,exportType:t})},toggleExpandPane:s,updateAnalyticsVisualization:e.actions.updateAnalyticsVisualization},isExpanded:t.expandedPane===Jd.VISUALIZATION_EDITOR,isRunning:i})
switch(t.expandedPane){case Jd.SQL_EDITOR:return d.createElement(DynamicLayout,null,d.createElement(OneColumnDynamicLayoutRow,null,r),p)
case Jd.VISUALIZATION_EDITOR:return d.createElement(DynamicLayout,null,p)
case Jd.WAREHOUSE_BROWSER:return d.createElement(DynamicLayout,null,d.createElement(OneColumnDynamicLayoutRow,null,c))
default:(0,S.Gp)(null==t.expandedPane,"Unsupported expanded pane for block editor",{screenState:t})
return d.createElement(DynamicLayout,null,u,p)}}function ConnectedAnalyticsBlockEditorContent(e){const{analyticsDashboardViewStateId:t}=useAnalyticsDashboardContext(),[n,a]=eu.useGlobalClientState(t)
if(!isBlockEditorScreenState(n))return null
return d.createElement(AnalyticsBlockEditorContent,{...e,actions:{...e.actions,collapsePane:()=>{a(function collapsePane(e){return{...e,expandedPane:null}}(n))},expandPane:e=>{a(function expandPane(e,t){return{...e,expandedPane:t}}(n,e))},exportAnalyticsQueryOutputToCSV,runGraphQLAnalyticsQuery,updateAnalyticsVisualization:async function handleUpdateAnalyticsVisualization(t,n){await AnalyticsVisualizationActions_updateAnalyticsVisualization(t,n)
await(0,zC.F)(e.analyticsDashboardAttrs.id)}},screenState:n})}var Tw=n(337195),vw=n(715365)
function AnalyticsQuerySettingsModal(e){const[t,n]=(0,d.useState)(e.analyticsQuery.description),a=(0,Ql.Z)(e.analyticsQuery.name)
return d.createElement(et.ZP,{buttons:[{style:C.ZJ.SECONDARY,submit:!0,text:"Save"}],onRequestClose:e.onRequestClose,onRequestSubmit:function handleSubmit(){const n={...(0,Tw.nQ)(e.analyticsQuery),description:t,name:a.value}
e.actions.updateAnalyticsQuery(e.analyticsQuery.id,n)
e.onRequestSubmit()},title:"Block settings"},d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(Jl.Z,{label:"Name",...a})))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Description"}),d.createElement(vw.Z,{setDescription:n,description:t})))))}function AnalyticsQuerySettingsButton(e){return d.createElement(P.ZP,{title:"Block settings",placement:e.tooltipPlacement},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:e.className,icon:"settings",onClick:function handleClick(){const t=(0,jc.Z)(e,"actions","analyticsQuery");(0,Xn.Z)(AnalyticsQuerySettingsModal,t)},size:e.buttonSize}))}var Cw=n(484827),Iw=n(369706)
function EditableBlockName(e){return d.createElement(Iw.Z,{inputClassName:(0,g.iv)(ww.input),requestChange:function handleChangeName(t){const n={...(0,Tw.nQ)(e.analyticsQuery),name:t};(0,Ic.jI)(e.actions.updateAnalyticsQuery(e.analyticsQuery.id,n),"Saving block...")},value:e.analyticsQuery.name,isDisabled:!1})}const ww=g.mM.create({input:{width:300}})
function Divider(){return d.createElement(pe.Z,{className:"faded",icon:"chevron"})}function AnalyticsBlockEditorHeader(e){const t=[d.createElement(Cw.Ak,{key:"analyticsDashboard",className:"faded",dataTestAttrs:{component:"AnalyticsBlockEditorHeader",element:"dashboardLink"},text:e.dashboardName,onClick:e.actions.openDashboardEditor}),d.createElement(EditableBlockName,{key:"analyticsQuery",actions:e.actions,analyticsQuery:e.analyticsQuery})]
return d.createElement("span",{className:"u-lr-split"},d.createElement(Cw.ZP,{className:"breadcrumbs--large u-vertical-center-items",crumbs:t,divider:d.createElement(Divider,null)}),d.createElement("span",null,d.createElement(AnalyticsQuerySettingsButton,{actions:e.actions,analyticsQuery:e.analyticsQuery,buttonSize:C.qE.SMALL,tooltipPlacement:P.TQ.BOTTOM}),d.createElement(Cc.Z,{buttonProps:{size:C.qE.SMALL,dataTestAttrs:{component:"AnalyticsBlockEditorHeader",element:"overflowMenu"}},enableTooltip:!0,menuProps:{dropLeft:!0},options:[{icon:"delete",contents:d.createElement("span",null,"Delete"),onSelect:function handleDelete(){e.actions.deleteAnalyticsQuery(e.analyticsQuery.id)},dataTestAttrs:{component:"AnalyticsBlockEditorHeader",element:"menuOption",key:"deleteBlock"}}],tooltipPlacement:P.TQ.LEFT})))}var Nw=n(290222),Aw=n(2376)
function SaveAndRunButton(e){var t
const n=null!==(t=e.isDisabledMessage)&&void 0!==t?t:e.isSubQuery?`Save query and run selected sub query\n(${pn.ctrl} + Enter from SQL editor)`:`Save and run query\n(${pn.ctrl} + Enter from SQL editor)`
return d.createElement(P.pf,{tooltipTitle:n,tooltipPlacement:P.TQ.TOP},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:e.className,disabled:null!=e.isDisabledMessage,icon:"run-query",onClick:function handleClick(){e.onSaveAndRun()},size:C.qE.SMALL,text:e.isSubQuery?"Run selected":"Run query",dataTestAttrs:{component:"SaveAndRunButton",element:"button"}}))}function useSaveAndRunQuery({actions:e,analyticsDashboardAttrs:t,analyticsQuery:n,parameterConfigs:a,parameterValues:i}){const{analyticsDashboardViewStateId:s}=useAnalyticsDashboardContext(),r=(0,Bd.kn)(n.id,s),[o]=qd.useGlobalClientState(r),l=(0,_a.v9)((e=>{var t,a
return null!==(a=null===(t=e.ui.insights.blockEditorUIs[n.id])||void 0===t?void 0:t.sqlQueryOverride)&&void 0!==a?a:n.sqlQuery})),saveDraftSQLQuery=async t=>{t=null!=t?t:l
await(a=n.id,i=t,e.updateAnalyticsQuery(a,{...(0,Tw.nQ)(n),sqlQuery:i}))
var a,i;(0,LC.ts)(n.id)},[c,u]=(0,d.useState)(null),[m,p]=(0,d.useState)(null),h=(0,d.useMemo)((()=>null!=m?m:o),[m,o])
return{draftSQLQuery:l,isResultsFromSubQuery:null!=m,setDraftSQLQuery:e=>{(0,LC.nd)(n.id,e)},setSQLSubQuery:u,runQueryState:h,saveAndRunQuery:async function saveAndRunQuery(t=l){let r=!1
t!==n.sqlQuery?await saveDraftSQLQuery(t):r=!0
if(null!=c){const{parameterConfigs:t,parameterValues:r}=syncParametersToSQLQueries([c],a,i)
e.runSubQuery(n,c,h,t,r,p,getExtraDataToTrackRunQuery(s,!0))}else{p(null)
r&&e.runGraphQLAnalyticsQuery(n,(0,Bd.kn)(n.id,s),a,i,o,getExtraDataToTrackRunQuery(s,!0))}},sqlSubQuery:c}}class BlockEditorConnector extends oi.C{enhanceProps(){var e
const t=null!==(e=this.reduxState().ui.insights.blockEditorUIs[this.props.analyticsQuery.id])&&void 0!==e?e:Aw.tT
return{actions:{...this.props.actions,runGraphQLAnalyticsQuery,runSubQuery,setSQLTemplateFormState:e=>{this.dispatch((0,Nw.R1)(this.props.analyticsQuery.id,e))},switchToSQLEditor:()=>{this.dispatch((0,Nw.r6)(this.props.analyticsQuery.id))}},blockEditorUIState:t}}}const Rw=(0,Hh.x)((()=>({draftSQLQuery:"",setDraftSQLQuery:e=>{}})),"DraftQueryContext")
function getSaveAndRunDisableMessage(e,t){return t.status===Wr.Lr.LOADING?"Query is already running":null==e.sqlTemplateFormState||isSQLTemplateFormStateValid(e.sqlTemplateFormState)?null:"The form has errors that must be fixed before the query can be run"}const Pw=BlockEditorConnector.connect((function AnalyticsBlockEditor(e){const{draftSQLQuery:t,setDraftSQLQuery:n,runQueryState:a,saveAndRunQuery:i,isResultsFromSubQuery:s,sqlSubQuery:r,setSQLSubQuery:o}=useSaveAndRunQuery(e),l=d.createElement(ActionBarSkeleton,{leftButtons:d.createElement(SaveAndRunButton,{isDisabledMessage:getSaveAndRunDisableMessage(e.blockEditorUIState,a),isSubQuery:null!=r,onSaveAndRun:i}),parameterList:e.parameterList}),c=d.createElement(d.Fragment,null,d.createElement(AnalyticsBlockEditorHeader,{actions:{...e.actions,openDashboardEditor:async function conditionallyOpenDashboardEditor(){if((0,LC.z6)(e.analyticsQuery)){if(!await async function runConfirmOpenDashboardModal(e){const t=null!=e.sqlTemplateFormState,n=t?"Discard changes?":"Discard query?",a=t?"Your query hasn’t been run, so you will lose any changes you’ve made to the template. Do you want to discard your changes?":"Your query hasn’t been run, so you will lose any progress you’ve made. Do you want to discard your query?"
return await Promise.resolve(je.iG(n,a,C.ZJ.NEGATIVE,{acceptText:"Discard",rejectText:"Cancel",enableRedesign:!0,promiseCompatible:!0}))}(e.blockEditorUIState))return;(0,LC.ts)(e.analyticsQuery.id)}e.actions.openDashboardEditor()}},dashboardName:e.analyticsDashboardAttrs.name,analyticsQuery:e.analyticsQuery}),l),u=d.createElement(ConnectedAnalyticsBlockEditorContent,{actions:{...e.actions,setDraftSQLQuery:n,setSQLSubQuery:o,saveAndRunQuery:i},analyticsDashboardAttrs:e.analyticsDashboardAttrs,analyticsQuery:e.analyticsQuery,blockEditorUIState:e.blockEditorUIState,draftSQLQuery:t,isDisplayingSubQueryResults:s,parameterConfigs:e.parameterConfigs,parameterList:e.parameterList,parameterValues:e.parameterValues,runQueryState:a})
return d.createElement(Rw.Provider,{value:{draftSQLQuery:t,setDraftSQLQuery:n}},d.createElement(AnalyticsTabSkeleton,{header:c,dataTestAttrs:{component:"AnalyticsBlockEditor",element:"root"}},u))})),Ow=(0,Hh.x)((()=>{(0,S.Gp)(!1,"Could not find writable context while rendering analytics component, defaulting to false")
return!1}),"WritableContext")
function useWritableContext(){return Ow.useContext()}const xw=Ow
function useAreAnyAnalyticsQueriesRunning({analyticsQueries:e},t){const n=e.map((e=>(0,Bd.kn)(e.id,t))),[a]=qd.useGlobalClientStates(n)
return n.some((e=>a[e].status===Wr.Lr.LOADING))}async function AnalyticsQueryActions_cloneAnalyticsQuery(e,t){const n=await function cloneAnalyticsQuery(e,t){return Cn.s0({url:`/1/api/analytics-queries/${e}:clone`,data:t})}(e,t)
await(0,zC.F)(t.destinationDashboardId)
return n}function getCloneBlockOption(e){const t=e.dashboardAttrs.analyticsQueries.length>=ip.AL
return d.createElement(N.Z,{icon:"copy",isDisabled:t,onSelect:e.actions.cloneBlock,tooltipTitle:t?ip.J_:void 0},"Duplicate")}function AnalyticsBlockOverflowDropdown({actions:e,blockViewStateId:t,className:n,dashboardAttrs:a,runQueryState:i}){const[s]=VI.sortState.useGlobalClientState(t),r=useWritableContext(),o=(0,d.useRef)(""),l={actions:e,runQueryState:convertRunQueryStateToLegacyState(i),showRawOutput:!1,sortState:s,tsvTextRef:o}
return d.createElement(BaseBlockOverflowDropdown,{className:n,menu:d.createElement(w.ZP,{...UI},d.createElement(jI.Z,null,getDownloadAsCSVOption(l),getCopyAsTSVOption(l),getAddToWorklistOption(l),getExecuteRequestOption(l)),r&&d.createElement(jI.Z,null,getCloneBlockOption({...l,dashboardAttrs:a}),(c=l,d.createElement(N.Z,{icon:"delete",onSelect:c.actions.deleteBlock,dataTestAttrs:{component:"BaseBlockOverflowDropdown",element:"menuOption",key:"deleteBlock"}},"Delete"))))})
var c}function ErrorUniversalBlockView({errorMessage:e,paneProps:t}){var n,a
return d.createElement(yf.ZP,{...t,centerContent:!0},d.createElement(pe.Z,{icon:"warning",className:(0,g.iv)(_w.icon),dataTestAttrs:{...t.dataTestAttrs,component:null!==(a=null===(n=t.dataTestAttrs)||void 0===n?void 0:n.component)&&void 0!==a?a:"ErrorUniversalBlockView",element:"errorIcon"}}),d.createElement("div",{className:(0,g.iv)(_w.errorText)},e))}const _w=g.mM.create({icon:{color:Vt.tN,height:"60px",width:"60px"},errorText:{..._n.H5,color:Vt.TG,fontWeight:_n.KB}})
function updateValueJsonForConfig(e,t,n,a){const i=e.find((e=>e.id===n)),s=t.find((e=>e.config.id===n))
return s?t.map((e=>e===s?{...s,valueJson:a}:e)):[...t,getParameterValueObject(i,a)]}function isShapashDashboard(e){return dt.ZP.INSIGHTS_ENABLE_SHAPASH_CONTROLLER_TABLES&&"SHAPASH"===e.name.toUpperCase()}function AnalyticsBlockErrorMessage({openBlockEditor:e}){const t=useWritableContext()
return d.createElement(d.Fragment,null,"Query is invalid. ",t&&d.createElement("a",{onClick:e},"Edit"))}function AnalyticsBlock({actions:e,analyticsQuery:t,blockViewStateId:n,dashboardAttrs:a,dragHandleProps:i,index:s,isExpanded:r,parameterConfigs:o,parameterValues:l,runQueryState:c}){const u=convertRunQueryStateToLegacyState(c),m=useWritableContext(),{delayExpensiveRenders:p,theme:{paneBorder:h}}=useAnalyticsDashboardContext(),g=(0,d.useMemo)((()=>u.status===Wr.Lr.SUCCESS?getVisualizationWarnings(u.data):[]),[u])
function handleOpenBlockEditor(){e.openBlockEditor(t.id)}const E=d.createElement(d.Fragment,null,m&&d.createElement(P.ZP,{title:"Edit block"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"edit",onClick:handleOpenBlockEditor,size:C.qE.MINI,className:"u-mini-spacing-left",dataTestAttrs:{component:"AnalyticsBlock",element:"editButton"}})),m&&d.createElement(AnalyticsQuerySettingsButton,{actions:e,analyticsQuery:t,buttonSize:C.qE.MINI,className:"u-mini-spacing-left"}),d.createElement(AnalyticsBlockOverflowDropdown,{actions:{cloneBlock:()=>{e.cloneBlock(t.id)},deleteBlock:()=>{e.deleteBlock(t.id)},exportBlock:n=>{e.exportAnalyticsQueryOutputToCSV(t,o,l,{dashboardName:a.name,exportType:n})}},blockViewStateId:n,className:"u-mini-spacing-left",dashboardAttrs:a,runQueryState:c}),d.createElement(ToggleExpandButton,{className:"u-mini-spacing-left",isExpanded:r,onChange:function handleToggleExpandOnChange(n){e.toggleExpandBlock(t.id,n)}})),f={paneProps:{description:t.description,dragHandleProps:m?i:void 0,paneBorder:h,title:t.name,toolbar:E,warnings:g,dataTestAttrs:{component:"AnalyticsBlock",index:`${s}`,element:"root"}}}
function renderUniversalBlock(i){return null==i?d.createElement(BlankUniversalBlockView,{...f}):d.createElement(PresentationalUniversalBlockView,{...f,actionOrigin:cd.Z.INSIGHTS,inputDataFrame:i.dataFrame,isLegacyInsights:!0,renderOptions:{delayExpensiveRenders:p},viewStateId:n,visualizationConfig:t.visualization,experimentalShapashTableOptions:isShapashDashboard(a)?{onClick:t=>{!function handleClickShapashTableRow(e,t,n,a,i){const s=(0,Jt.m8)(a.map((e=>[e.config.id,e.valueJson])))
let r=!1
const o=n.reduce(((a,i)=>{const o=t.headers.indexOf(i.systemName)
if(-1!==o&&s[i.id]!==e[o]){r=!0
return updateValueJsonForConfig(n,a,i.id,e[o])}return a}),a)
r&&i(o)}(t,convertRunQueryOutputToLegacyOutput(i),o,l,e.updateParameterValues)}}:void 0})}const y=d.createElement(AnalyticsBlockErrorMessage,{openBlockEditor:handleOpenBlockEditor})
switch(c.status){case Wr.Lr.SUCCESS:return renderUniversalBlock(c.data)
case Wr.Lr.LOADING:return d.createElement(LoadingOverlay,{message:ip.FX},renderUniversalBlock(c.previousData))
case Wr.Lr.NOT_FETCHED:return d.createElement(LoadingOverlay,{message:ip.FX},renderUniversalBlock(null))
case Wr.Lr.ERROR:return d.createElement(ErrorUniversalBlockView,{...f,errorMessage:y})
default:(0,S.Gp)(!1,`Unexpected runQueryState status: ${(0,Go.vE)(c)}`)
return d.createElement(ErrorUniversalBlockView,{...f,errorMessage:y})}}function ConnectedAnalyticsBlock(e){const{analyticsDashboardViewStateId:t}=useAnalyticsDashboardContext(),n=(0,Bd.kn)(e.analyticsQuery.id,t),[a]=qd.useGlobalClientState(n)
return d.createElement(AnalyticsBlock,{...e,actions:{...e.actions,exportAnalyticsQueryOutputToCSV},blockViewStateId:n,runQueryState:a})}function moveBlockLayoutPosition(e,t,n){const a=e.map((e=>e.analyticsQueries)),{layoutChanged:i,newLayout:s}=function moveSourceToRightOfTarget(e,t,n,a=((e,t)=>e===t)){if(t===n)return{layoutChanged:!1,newLayout:e}
const i=e[0].length,s=e.flat(),r=s.findIndex((e=>a(t,e)))
s.splice(r,1)
const o=s.findIndex((e=>a(n,e)))+1
s.splice(o,0,t)
return{layoutChanged:o!==r,newLayout:l.default.chunk(s,i)}}(a,t,n,((e,t)=>e.id===t.id))
return{newLayoutRows:s.map((e=>({__typename:"AnalyticsDashboardLayoutRowNode",analyticsQueries:e}))),layoutChanged:i}}var Dw=n(306924)
const Lw=12
function makeMinBlockWidthStyle(e){return{flexBasis:`${e}px`}}function DnDPlaceholderBlock(e){return d.createElement("div",{className:(0,g.iv)(kw.block),style:makeMinBlockWidthStyle(e.minBlockWidth)})}function DnDBlock(e){const{disabled:t,dragState:n,blockHeight:a,index:i,item:s,onDragStart:r,renderItem:o}=e,l=(0,d.useCallback)((e=>{r(e,s)}),[r,s])
const c=(0,d.useMemo)((()=>o(s,{className:Dw.re,onMouseDown:t?Jt.ZT:l},i)),[t,l,i,s,o])
return d.createElement("div",{className:(0,g.iv)(kw.block,n.isDragging&&s===n.draggedItem&&kw.draggedBlock,n.isDragging&&n.isHovering&&s===n.hoveredItem&&!t&&kw.hoveredPreviewBlock),onMouseOver:t?void 0:function handleOnMouseEnter(){e.onMouseEnterBlock(s)},onMouseLeave:t?void 0:function handleOnMouseLeave(){e.onMouseLeaveBlock()},style:{...makeMinBlockWidthStyle(e.minBlockWidth),...n.isDragging&&s===n.draggedItem?{transform:`translate3d(${n.dragDelta.translateX}px, ${n.dragDelta.translateY}px, 0)`}:{},height:a}},d.createElement("div",{className:f()({"u-no-mouse-target":n.isDragging},(0,g.iv)(kw.mouseEventWrapper))},c))}const kw=g.mM.create({block:{flexShrink:0,flexGrow:1,minWidth:0,marginBottom:Lw,borderRight:"3px solid transparent",paddingRight:4.5,marginRight:4.5},draggedBlock:{pointerEvents:"none",opacity:.9,zIndex:Dn.yY},hoveredPreviewBlock:{borderRightColor:Vt.t0},mouseEventWrapper:{height:"100%"}})
function useDnDScrollHandler({setScrollDelta:e}){const t=(0,d.useRef)({scrollLeft:0,scrollTop:0})
return{handleScroll:(0,d.useCallback)((n=>{const a=function eventToScrollPosition(e){if(null==e.srcElement){(0,S.Gp)(!1,"Expected scroll event.srcElement to be non-null on Element scroll events")
return null}if(void 0!==e.srcElement.scrollLeft)return{scrollLeft:e.srcElement.scrollLeft,scrollTop:e.srcElement.scrollTop}
{const t=e.srcElement.scrollingElement
if(null==t){(0,S.Gp)(!1,"Expected scroll event.srcElement.scrollingElement to be non-null on Document scroll events")
return null}return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}}(n)
if(null==a)return
const i={deltaLeft:a.scrollLeft-t.current.scrollLeft,deltaTop:a.scrollTop-t.current.scrollTop}
e(i)
t.current=a}),[e])}}var Mw
!function(e){e.ITEM_HOVER_ENTER="ITEM_HOVER_ENTER"
e.ITEM_HOVER_LEAVE="ITEM_HOVER_LEAVE"
e.MOVE_MOUSE="MOVE_MOUSE"
e.SCROLL="SCROLL"
e.START_DRAGGING="START_DRAGGING"
e.STOP_DRAGGING="STOP_DRAGGING"}(Mw||(Mw={}))
function useDnDCanvasDragState({onMoveItem:e}){const t=function createDragStateReducer(){return(e,t)=>{if(e.isDragging)switch(t.type){case Mw.ITEM_HOVER_ENTER:return e.draggedItem===t.itemToHover?e:{...e,isHovering:!0,hoveredItem:t.itemToHover}
case Mw.ITEM_HOVER_LEAVE:return e.isHovering?{...(0,ig.Z)(e,"hoveredItem"),isHovering:!1}:{...e,isHovering:!1}
case Mw.MOVE_MOUSE:return{...e,dragDelta:{translateX:e.dragDelta.translateX+t.mouseDelta.deltaX,translateY:e.dragDelta.translateY+t.mouseDelta.deltaY}}
case Mw.SCROLL:return{...e,dragDelta:{translateX:e.dragDelta.translateX+t.scrollDelta.deltaLeft,translateY:e.dragDelta.translateY+t.scrollDelta.deltaTop}}
case Mw.START_DRAGGING:return e
case Mw.STOP_DRAGGING:return{isDragging:!1}
default:throw new Error(`Invalid action type ${(0,Go.vE)(t)}`)}else switch(t.type){case Mw.ITEM_HOVER_ENTER:case Mw.ITEM_HOVER_LEAVE:case Mw.MOVE_MOUSE:case Mw.SCROLL:case Mw.STOP_DRAGGING:return e
case Mw.START_DRAGGING:return{isDragging:!0,draggedItem:t.itemToDrag,dragDelta:{translateX:0,translateY:0},isHovering:!1}
default:throw new Error(`Invalid action type ${(0,Go.vE)(t)}`)}}}(),[n,a]=(0,d.useReducer)(t,{isDragging:!1}),i=(0,Pu.Z)(n),s=(0,d.useCallback)((e=>{a({type:Mw.MOVE_MOUSE,mouseDelta:e})}),[]),r=(0,d.useCallback)((e=>{a({type:Mw.SCROLL,scrollDelta:e})}),[]),{handleMouseMove:o,setMousePosition:l}=function useDnDMouseMoveHandler({setMouseDelta:e}){const t=(0,d.useRef)({clientX:0,clientY:0})
return{handleMouseMove:(0,d.useCallback)((n=>{const a={deltaX:n.clientX-t.current.clientX,deltaY:n.clientY-t.current.clientY}
e(a)
t.current={clientX:n.clientX,clientY:n.clientY}}),[e]),setMousePosition:(0,d.useCallback)((e=>{t.current={clientX:e.clientX,clientY:e.clientY}}),[])}}({setMouseDelta:s}),{handleScroll:c}=useDnDScrollHandler({setScrollDelta:r}),u=(0,d.useCallback)(((e,t)=>{a({type:Mw.START_DRAGGING,itemToDrag:t})
l(e)}),[a,l]),m=(0,d.useCallback)((()=>{a({type:Mw.STOP_DRAGGING})}),[]),p=(0,d.useCallback)((()=>{window.removeEventListener("mousemove",o)
window.removeEventListener("mouseup",m)
window.removeEventListener("scroll",c)}),[o,m,c]),h=(0,d.useCallback)((()=>{window.addEventListener("mousemove",o)
window.addEventListener("mouseup",m)
window.addEventListener("scroll",c,!0)}),[o,m,c]),{isDragging:g}=n,E=!!i&&i.isDragging,f=(null==i?void 0:i.isDragging)?i.draggedItem:void 0,S=(null==i?void 0:i.isDragging)&&i.isHovering?i.hoveredItem:void 0,y=(0,d.useCallback)((()=>{f&&S&&e(f,S)
p()}),[p,e,f,S]);(0,d.useEffect)((()=>{g&&!E&&h()
!g&&E&&y()}),[g,E,h,y]);(0,d.useEffect)((()=>()=>{p()}),[p])
return{dragState:n,onItemDragStart:u,onItemHoverEnter:e=>{a({type:Mw.ITEM_HOVER_ENTER,itemToHover:e})},onItemHoverLeave:()=>{a({type:Mw.ITEM_HOVER_LEAVE})},_handleOnDragEnd:m}}function DnDCanvas(e){const{dragState:t,onItemDragStart:n,onItemHoverEnter:a,onItemHoverLeave:i}=useDnDCanvasDragState({onMoveItem:e.onMoveItem})
useDocumentCursor("grabbing",t.isDragging);(0,S.hu)(e.items.length>0,"Expected the layout to be non-empty")
return d.createElement("div",{className:f()({"u-no-select":t.isDragging},(0,g.iv)(Fw.dndCanvas))},e.items.map(((s,r)=>d.createElement("div",{className:(0,g.iv)(Fw.row),key:r,...(0,ee.Z)({component:"DnDCanvas",element:"row"})},s.map(((s,o)=>{const l=e.maxColumnCount*r+o
return d.createElement(DnDBlock,{dragState:t,blockHeight:e.blockHeight,item:s,index:l,key:`${r}${o}`,minBlockWidth:e.minBlockWidth,onDragStart:n,onMouseEnterBlock:a,onMouseLeaveBlock:i,renderItem:e.renderItem,disabled:null!=e.disabledItems&&e.disabledItems.includes(l)})})),r===e.items.length-1?l.default.times(e.maxColumnCount-s.length,(t=>d.createElement(DnDPlaceholderBlock,{key:`${r}${s.length+t}`,minBlockWidth:e.minBlockWidth}))):null))))}const Fw=g.mM.create({dndCanvas:{overflow:"hidden",minHeight:"100%",paddingTop:Lw,paddingLeft:Lw},row:{display:"flex",flexFlow:"row wrap"}})
const Zw={[au.dm.BASIC_BIOENTITY]:"List of entities"},Bw={[au.dm.BASIC_BIOENTITY]:"entityList"}
function AddBlockToDashboardButton(e){async function handleAddBlock(t){const n=function createDefaultAnalyticsQuery(e,t={returnNoResults:!1}){const n=e.map((e=>e.name))
let a,i=n.length+1
do{a=`Block ${i}`;++i}while(n.includes(a))
return{name:a,description:"",sqlQuery:t.returnNoResults?mu:uu}}(e.analyticsDashboard.analyticsQueries,{returnNoResults:null!=t}),a=await(0,Ic.jI)(e.actions.updateAnalyticsDashboard(e.analyticsDashboard.id,function onAddAnalyticsQuery(e,t){return onTransformAnalyticsQueries(e,(e=>[...e,t]))}(e.analyticsDashboard,n)),"Adding block..."),i=function findNewAnalyticsQueryId(e,t){const n=e.analyticsQueries.map((e=>e.id))
return t.analyticsQueries.find((e=>!n.includes(e.id))).id}(e.analyticsDashboard,a)
t&&(0,Vn.getStore)().dispatch((0,Nw.Z)(i,t))
e.actions.openBlockEditor(i);(0,m.KK)(j.JG.ADDED_BLOCK,{num_blocks:a.analyticsQueries.length,sql_template_form_type:t})}const t=d.createElement(w.ZP,{dropLeft:!0,width:Nr.zL.MEDIUM,height:Nr.Bl.MEDIUM},d.createElement(jI.Z,null,d.createElement(N.Z,{icon:"note-code",onSelect:()=>handleAddBlock(null),dataTestAttrs:{component:"AddBlockToDashboardButton",key:"sqlQuery"}},"SQL query")),d.createElement(YI.Z,null,"Block templates"),Object.keys(au.dm).map((e=>d.createElement(N.Z,{icon:"warehouse-table",key:e,onSelect:()=>handleAddBlock(e),value:e,dataTestAttrs:{component:"AddBlockToDashboardButton",key:Bw[e]}},Zw[e])))),n=e.analyticsDashboard.analyticsQueries.length>=ip.AL
return d.createElement(P.ZP,{disabled:!n,title:ip.J_},d.createElement(I.ZP,{menu:t},d.createElement(C.Co,{...e.buttonProps,buttonStyle:C.ZJ.SECONDARY,dataTestAttrs:{component:"AddBlockToDashboardButton",element:"root"},disabled:n,icon:"compose",text:"Add block"})))}AddBlockToDashboardButton.defaultProps={buttonProps:{size:C.qE.SMALL}}
function isParameterTypeEnabled(e){switch(e){case MC.r.PROCESS_LINK:case MC.r.PROCESS_TASK_LINK:return(0,ln.cr)({feature:on.gx.PROCESSES_DISCOVER})
case MC.r.STORABLE_LINK:return(0,ln.cr)({feature:on.TD.INVENTORY_DISCOVER})
case MC.r.TEAM_LINK:return(0,ru.Z)("ENABLE_TEAMS")
default:return!0}}function ParameterTypeHelpButton(e){const t=d.createElement("div",{className:"u-normal-font-weight"},d.createElement("p",null,"The parameter's type controls which values it accepts and how those values are substituted into the SQL query."),d.createElement("p",null,d.createElement("strong",null,"Text:")," Substituted as single-quoted text in SQL. ",d.createElement("br",null),d.createElement("b",null,"value")," becomes ",d.createElement("code",null,"'value'")),d.createElement("p",null,d.createElement("strong",null,"Number:")," Substituted as number in SQL. ",d.createElement("br",null),d.createElement("b",null,"3.14")," becomes ",d.createElement("code",null,"3.14")),d.createElement("p",null,d.createElement("strong",null,"Date:")," Substituted as date in SQL. ",d.createElement("br",null),d.createElement("b",null,"2019-01-21")," becomes ",d.createElement("code",null,"'2019-01-21'::date")),d.createElement("p",null,d.createElement("strong",null,"Dropdown:")," The dropdown option name is substituted as single-quoted text in SQL.",d.createElement("br",null),d.createElement("b",null,"Kanamycin")," becomes ",d.createElement("code",null,"'Kanamycin'")),d.createElement("p",null,d.createElement("strong",null,"Entry:")," The entry ID is substituted as single-quoted text in SQL. ",d.createElement("br",null),"An entry with ID ",d.createElement("b",null,"etr_yzNP1XVd")," becomes ",d.createElement("code",null,"'etr_yzNP1XVd'")),d.createElement("p",null,d.createElement("strong",null,"Entity:")," The entity ID is substituted as single-quoted text in SQL. ",d.createElement("br",null),"A sequence with ID ",d.createElement("b",null,"seq_fcZi9llW")," becomes ",d.createElement("code",null,"'seq_fcZi9llW'")),d.createElement("p",null,d.createElement("strong",null,"Folder:")," The folder ID is substituted as single-quoted text in SQL. ",d.createElement("br",null),"A folder with ID ",d.createElement("b",null,"lib_ecYrmDJM")," becomes ",d.createElement("code",null,"'lib_ecYrmDJM'")),d.createElement("p",null,d.createElement("strong",null,"Project:")," The project ID is substituted as single-quoted text in SQL. ",d.createElement("br",null),"A project with ID ",d.createElement("b",null,"src_ztQi3aaR")," becomes ",d.createElement("code",null,"'src_ztQi3aaR'")),isParameterTypeEnabled(MC.r.STORABLE_LINK)&&d.createElement("p",null,d.createElement("strong",null,"Inventory:")," The inventory item ID is substituted as a single-quoted text in SQL.",d.createElement("br",null),"A container with ID ",d.createElement("b",null,"con_8Gp0Zxh2")," becomes ",d.createElement("code",null,"'con_8Gp0Zxh2'")),d.createElement("p",null,d.createElement("strong",null,"Team:")," The team ID is substituted as a single-quoted text in SQL. ",d.createElement("br",null),"A team with ID"," ",d.createElement("b",null,"ent_y1afX3Fv")," becomes ",d.createElement("code",null,"'ent_y1afX3Fv'")),d.createElement("p",null,d.createElement("strong",null,"User:")," The user ID is substituted as a single-quoted text in SQL. ",d.createElement("br",null),"A user with ID"," ",d.createElement("b",null,"ent_y1afX3Fv")," becomes ",d.createElement("code",null,"'ent_y1afX3Fv'")),d.createElement("p",null,d.createElement("strong",null,"Workflow task group:")," The workflow task group ID is substituted as single-quoted text in SQL. ",d.createElement("br",null),"A workflow task group with ID ",d.createElement("b",null,"prs_Fea8JY5U")," becomes ",d.createElement("code",null,"'prs_Fea8JY5U'")),d.createElement("p",null,d.createElement("strong",null,"Workflow task:")," The workflow task ID is substituted as single-quoted text in SQL."," ",d.createElement("br",null),"A workflow with ID ",d.createElement("b",null,"wftask_fj7Usr5H")," becomes ",d.createElement("code",null,"'wftask_fj7Usr5H'")))
return d.createElement(zp.Z,{renderContent:()=>t,iconClassName:e.className,placement:ne.ZH.BOTTOM})}var qw=n(910237),Vw=n(392663),Uw=n(439707)
const Gw=[MC.r.SELECTOR]
function getDisplayParameterType(e){return(0,Mt.kC)(Uw.wL[e])}function getLinkedOptionDisplayName(e,t,n){const a=t.find((t=>t.id===e))
return a?(0,Vw.Z)(a):`Inaccessible ${n}`}function getOptionValueForType(e,t=!1,n=null){switch(e){case MC.r.BIOENTITY_LINK:return{tagSchema:n,isMulti:t}
case MC.r.PROCESS_LINK:case MC.r.PROCESS_TASK_LINK:return{processTaskSchema:n,isMulti:t}
case MC.r.SELECTOR:return{schemaFieldSelector:n,isMulti:t}
case MC.r.STORABLE_LINK:return{storableSchema:n,isMulti:t}
default:return{isMulti:t}}}function getSchemaSubmenu(e,t,n){return[(0,nw.U)(e,[],null,{allSchemasValue:{type:t,configSetting:getOptionValueForType(t,n)},transformSchema:e=>({type:t,configSetting:getOptionValueForType(t,n,{id:e.id})})})]}const zw=xa.Ps`
  query AnalyticsParameterTypeDropdownQuery @skipAudit @engComponent(name: INSIGHTS) {
    registries {
      ...SchemaFieldSelectorsForRegistryGraphQL
    }
  }
  ${(0,La.f)("SchemaFieldSelectorsForRegistry").fragment}
`,$w=xa.Ps`
  query AnalyticsParameterTypeDropdownStorableSchemasQuery @skipAudit @engComponent(name: INSIGHTS) {
    ...AllStorableSchemasGraphQL
  }
  ${(0,La.f)("AllStorableSchemas").fragment}
`,Ww=xa.Ps`
  query AnalyticsParameterProcessTaskSchemasQuery @skipAudit @engComponent(name: INSIGHTS) {
    ...AllProcessTaskSchemasGraphQL
  }
  ${(0,La.f)("AllProcessTaskSchemas").fragment}
`
function AnalyticsParameterTypeDropdown({parameterConfig:e,onChange:t,disabled:n}){const a=(0,Da.IJ)($o._),i=(0,Da.IJ)(zw),s=(0,Da.IJ)($w),r=(0,Da.IJ)(Ww)
let o,l,c,u
if(a.type===Da.NI.ERROR||i.type===Da.NI.ERROR||s.type===Da.NI.ERROR||r.type===Da.NI.ERROR)return null
a.type===Da.NI.SUCCESS&&(o=a.data.tagSchemas.filter((e=>e.folderItemType!==Sn.S5.entry)))
i.type===Da.NI.SUCCESS&&(l=i.data.registries.map((e=>e.schemaFieldSelectors)).flat())
s.type===Da.NI.SUCCESS&&(c=s.data.boxSchemas.concat(s.data.containerSchemas,s.data.locationSchemas,s.data.plateSchemas))
r.type===Da.NI.SUCCESS&&(u=r.data.processTaskSchemas)
if(function isLoadingParameterDisplayName(e){return e.type===MC.r.BIOENTITY_LINK&&null!=e.configSetting.tagSchema&&a.type===Da.NI.PENDING||e.type===MC.r.SELECTOR&&null!=e.configSetting.schemaFieldSelector&&i.type===Da.NI.PENDING||e.type===MC.r.STORABLE_LINK&&null!=e.configSetting.storableSchema&&s.type===Da.NI.PENDING||(e.type===MC.r.PROCESS_LINK||e.type===MC.r.PROCESS_TASK_LINK)&&null!=e.configSetting.processTaskSchema&&r.type===Da.NI.PENDING}(e))return d.createElement(kl.b,{className:(0,g.iv)(Hw.throbber)})
const getSubmenu=t=>{const n=[{name:"Loading...",disabled:!0}]
return t===MC.r.BIOENTITY_LINK?a.type===Da.NI.PENDING?[n]:getSchemaSubmenu(o,MC.r.BIOENTITY_LINK,e.configSetting.isMulti):t===MC.r.SELECTOR?i.type===Da.NI.PENDING?[n]:[l.length>0?l.filter((e=>!(0,yc.ZP)(e))).map((e=>({name:e.name,value:{type:MC.r.SELECTOR,configSetting:{schemaFieldSelector:{id:e.id}}}}))):[{name:"No dropdowns found"}]]:t===MC.r.STORABLE_LINK?s.type===Da.NI.PENDING?[n]:getSchemaSubmenu(c,MC.r.STORABLE_LINK,e.configSetting.isMulti):t===MC.r.PROCESS_LINK||t===MC.r.PROCESS_TASK_LINK?getSchemaSubmenu(u,t,e.configSetting.isMulti):null},m=function getEnabledParameterTypes(){return Uw.e.concat(Uw.Fn).filter((e=>isParameterTypeEnabled(e)))}().map((t=>{const n=e.configSetting.isMulti&&Uw.Ao[t]
return{name:getDisplayParameterType(t),value:Gw.includes(t)?Uw.wL[t]:{type:t,configSetting:getOptionValueForType(t,n,null)},submenu:getSubmenu(t)}}))
return d.createElement(d.Fragment,null,d.createElement($r.ZP,{buttonClassName:(0,g.iv)(Hw.dropdownButton),displayName:(p=e,p.type===MC.r.BIOENTITY_LINK&&p.configSetting.tagSchema?getLinkedOptionDisplayName(p.configSetting.tagSchema.id,o,"entity schema"):p.type===MC.r.SELECTOR&&p.configSetting.schemaFieldSelector?getLinkedOptionDisplayName(p.configSetting.schemaFieldSelector.id,l,"dropdown"):p.type===MC.r.STORABLE_LINK&&p.configSetting.storableSchema?getLinkedOptionDisplayName(p.configSetting.storableSchema.id,c,"inventory schema"):p.type===MC.r.PROCESS_LINK&&p.configSetting.processTaskSchema||p.type===MC.r.PROCESS_TASK_LINK&&p.configSetting.processTaskSchema?getLinkedOptionDisplayName(p.configSetting.processTaskSchema.id,u,"workflow task schema"):getDisplayParameterType(p.type)),disabled:n,buttonSize:C.qE.MEDIUM,menu:d.createElement(Ar.Z,{onSelect:e=>{"string"==typeof e?v.ZP.info(`Please select a particular ${e}`):t(e)},optionDatas:m,selectedValue:e})}))
var p}const Hw=g.mM.create({dropdownButton:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},throbber:{paddingTop:9,paddingBottom:10}})
function EditAnalyticsParametersModalRow(e){const{config:t,value:n,valueJsonIsValid:a,onUpdateConfig:i,onUpdateValue:s}=e,r=(0,wu.Z)(t),{type:o,configSetting:l}=r,c={valueJson:n.valueJson,paramConfigSetting:l,onChange:e=>{s(t.id,e)},allowAutoFocus:!1}
return d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:3},d.createElement(Jl.Z,{label:"Name",value:t.systemName,inputClassName:(0,g.iv)(jw.inputHeightFix),disabled:!e.writable,labelStyle:Mo.WS.HIDDEN,onChange:e=>{i({...t,systemName:e.target.value})}})),d.createElement(p.Z,{sm:3},d.createElement(AnalyticsParameterTypeDropdown,{parameterConfig:r,onChange:e=>{i({id:t.id,systemName:t.systemName,__typename:Uw.dM[e.type],...e.configSetting})},disabled:!e.writable})),d.createElement(p.Z,{sm:4},d.createElement(Iu.ZP,{paramType:o,inputProps:c}),!a&&d.createElement(Dt.Z,{message:"Please select a valid value"})),d.createElement(P.ZP,{disabled:!e.writable||Uw.Ao[o],title:"Multi-value parameters are not supported for this parameter type",placement:P.TQ.TOP},d.createElement(p.Z,{sm:2,className:(0,g.iv)(jw.checkboxContainer)},d.createElement("input",{className:(0,g.iv)(jw.inputHeightFix),checked:t.isMulti,onChange:e=>{i({...t,isMulti:e.target.checked})},disabled:!e.writable||!Uw.Ao[o],type:"checkbox"})))))}const jw=g.mM.create({inputHeightFix:{height:36},checkboxContainer:{textAlign:"center"}})
function ParameterInfoModal({large:e=!1,onRequestClose:t,onRequestSubmit:n}){const a=Object.values(MC.r).filter((e=>!Uw.Ao[e])).map((e=>Uw.wL[e]))
return d.createElement(et.ZP,{title:"Help with parameters",buttons:[{style:C.ZJ.SECONDARY,submit:!0,text:"Done"}],closeableOnEscapeKey:!0,large:e,onRequestClose:t,onRequestSubmit:n},d.createElement("p",null,"Parameters allow you to filter results on a dashboard to only those that meet certain conditions. You can create a parameter by replacing a value in your SQL query with the parameter name in double curly brackets. This allows users to later select the values they want to include in the query."),d.createElement(so.BB,null,"Single value parameters"),d.createElement("p",null,"Single value parameters will be inserted using the given value, or, in the case of object types, as the ID of the object in single quotes. Date inputs will be casted as dates."),d.createElement("p",null,"In this example, we use the given value, unless it is not defined:"),d.createElement("pre",null,"color = ","{{parameter}}"," OR ","{{parameter}}"," IS NULL"),d.createElement("p",null,"For a value of ",d.createElement("code",null,"'blue'"),", this results in:"),d.createElement("pre",null,"color = 'blue' OR 'blue' IS NULL"),d.createElement(so.BB,null,"Multi-value parameters"),d.createElement("p",null,"Multi-value parameters will be inserted as an array of values. Multi-value parameters are not supported for"," ",`${a.slice(0,a.length-1).join(", ")}, and ${a[a.length-1]}`," ","parameters."),d.createElement("p",null,"In this example, we check whether the value of a field is any of the given values, unless the parameter does not have any selected values:"),d.createElement("pre",null,"field = ANY(","{{parameter}}",") OR CARDINALITY(","{{parameter}}",") = 0"),d.createElement("p",null,"For selected objects with IDs ",d.createElement("code",null,"seq_1234abcd")," and ",d.createElement("code",null,"seq_2345defg"),", this results in:"),d.createElement("pre",null,"field = ANY(ARRAY['seq_1234abcd','seq_2345defg']::text[]) OR CARDINALITY(ARRAY['seq_1234abcd','seq_2345defg']::text[]) = 0"))}function ParameterInfoButton({largeModal:e=!1}){return d.createElement(zp.Z,{renderContent:()=>d.createElement("div",null,"When this setting is enabled, users can enter one or more values in this parameter. Queries must be written to allow for multiple values."," ",d.createElement("a",{onClick:async()=>{await(0,Xn.Z)(ParameterInfoModal,{large:e})}},"Learn more")," ","about how to configure parameters in your query."),iconClassName:"u-mini-spacing-left",placement:ne.ZH.BOTTOM,interaction:ne.x2.HOVER})}function useAnalyticsParametersState(e,t){const n=e.map((e=>{var n
return null!==(n=t.find((t=>t.config.id===e.id)))&&void 0!==n?n:getParameterValueObject(e,null)})),[a,i]=(0,d.useState)({configs:(0,Jt.m8)(e.map((e=>[e.id,e]))),valueStates:(0,Jt.m8)(n.map((e=>[e.config.id,{value:e,isValid:!0}])))})
return{updateConfig:function updateConfig(e){var t,n
const s=a.valueStates[e.id],r=Uw.PB[e.__typename]
let o=(0,fu.N[r])(null===(t=s.value)||void 0===t?void 0:t.valueJson)?null===(n=s.value)||void 0===n?void 0:n.valueJson:null
e.isMulti&&!Array.isArray(o)?o=null==o?[]:[o]:!e.isMulti&&Array.isArray(o)&&(o=o.length>0?o[0]:null)
i({configs:{...a.configs,[e.id]:e},valueStates:{...a.valueStates,[e.id]:{value:getParameterValueObject(e,o),isValid:!0}}})},updateValue:function updateValue(e,t){const n=a.valueStates[e],s=function validateAgainstConfig(e,t){const n=a.configs[e],i=Uw.PB[n.__typename]
return(0,fu.N[i])(t)}(e,t),r={value:{...n.value,valueJson:t},isValid:s}
i({configs:{...a.configs},valueStates:{...a.valueStates,[e]:r}})},clearAllValues:function clearAllValues(){const e=(0,Jt.m8)(Object.entries(a.valueStates).map((([e,t])=>[e,{value:{...t.value,valueJson:null},isValid:!0}])))
i({configs:a.configs,valueStates:e})},configs:a.configs,valueStates:a.valueStates}}function EditAnalyticsParametersModal(e){const{configs:t,valueStates:n,clearAllValues:a,updateConfig:i,updateValue:s}=useAnalyticsParametersState(e.parameterConfigs,e.parameterValues),r=Object.values(n).every((({isValid:e})=>e)),o=(0,Nu.Z)(e.parameterConfigs).map((e=>e.id)),l=function getSimilarConfigNames(e){const t={}
for(const n of e){const e=(0,qw.Z)(n.systemName,!1)
null==t[e]&&(t[e]=[])
t[e].push(n.systemName)}return Object.values(t).filter((e=>e.length>1)).flat()}(Object.values(t))
return d.createElement(et.ZP,{large:!0,buttons:[{asLink:!0,style:C.ZJ.LINK,text:"Clear all parameter values",onClick:a,pullLeft:!0},{style:C.ZJ.SECONDARY,submit:!0,text:"Save",disabled:!r||l.length>1||!Object.values(t).every((e=>e.systemName.length>0))}],onRequestClose:e.onRequestClose,onRequestSubmit:()=>{e.onRequestSubmit({parameterConfigs:Object.values(t),parameterValues:Object.values(n).filter((({value:e})=>fu.N[(0,Eu.Z)(t[e.config.id])](e.valueJson))).map((({value:e})=>e))})},title:"Edit parameters"},d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:3},d.createElement(Fr.Z,{label:"Name"})),d.createElement(p.Z,{sm:3},d.createElement(Fr.Z,{label:"Type"}),d.createElement(ParameterTypeHelpButton,{className:"u-mini-spacing-left"})),d.createElement(p.Z,{sm:4},d.createElement(Fr.Z,{label:"Value"})),d.createElement(p.Z,{sm:2},d.createElement(Fr.Z,{label:"Multi-select"}),d.createElement(ParameterInfoButton,{largeModal:!0}))),o.map((a=>{var r,o,l
return d.createElement(EditAnalyticsParametersModalRow,{config:t[a],value:null===(r=n[a])||void 0===r?void 0:r.value,valueJsonIsValid:null===(l=null===(o=n[a])||void 0===o?void 0:o.isValid)||void 0===l||l,key:a,onUpdateConfig:i,onUpdateValue:s,writable:e.writable})}))),l.length>1&&d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:`Config names are too similar: ${l.join(", ")}`}))}var Yw=n(584051),Qw=n(443626)
function AnalyticsDashboardSettingsModal(e){const[t,n]=(0,d.useState)(e.analyticsDashboard.description),a=(0,Ql.Z)(e.analyticsDashboard.name),[i,s]=(0,d.useState)(e.analyticsDashboard.project.id);(0,S.Gp)((0,ln.cr)({feature:on.sZ.INSIGHTS_MOVE}),"Expected INSIGHTS_MOVE to be enabled if INSIGHTS_EDIT is enabled")
return d.createElement(et.ZP,{buttons:[{style:C.ZJ.SECONDARY,submit:!0,text:"Save"}],className:"modal-text-only",onRequestClose:e.onRequestClose,onRequestSubmit:async function handleSubmit(){const n={...onUpdateAnalyticsDashboard(e.analyticsDashboard),description:t,name:a.value,projectId:i}
await(0,Ic.jI)(e.actions.updateAnalyticsDashboard(e.analyticsDashboard.id,n),"Saving dashboard...")
e.onRequestSubmit()},title:"Dashboard settings"},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Jl.Z,{label:"Name",dataTestAttrs:{component:"AnalyticsDashboardSettingsModal",element:"dashboardName"},...a}))),d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Project"}),d.createElement(Yw.Z,{onChange:s,projectId:i})))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Description"}),d.createElement(vw.Z,{setDescription:n,description:t})))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Fr.Z,{label:"Creator"}),d.createElement("p",null,(0,Qw.a)(e.analyticsDashboard.creator))),d.createElement(p.Z,{sm:6},d.createElement(Fr.Z,{label:"Last modified"}),d.createElement("p",null,(0,Mt.kC)((0,Kl.Z)(e.analyticsDashboard.modifiedAt))))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Fr.Z,{label:"Created"}),d.createElement("p",null,(0,Hr.UT)(e.analyticsDashboard.createdAt)))))}function ConnectedAnalyticsDashboardSettingsModal(e){return d.createElement(AnalyticsDashboardSettingsModal,{...e,actions:{updateAnalyticsDashboard:DC.Kt}})}function AnalyticsDashboardSettingsButton(e){return d.createElement(P.ZP,{title:"Dashboard settings",placement:P.TQ.BOTTOM},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:e.className,icon:"settings",onClick:function handleClick(){const t=(0,jc.Z)(e,"analyticsDashboard");(0,Xn.Z)(ConnectedAnalyticsDashboardSettingsModal,t)},size:C.qE.SMALL,dataTestAttrs:{component:"AnalyticsDashboardSettingsButton",element:"root"}}))}function CloneAnalyticsDashboardModal(e){const[t,n]=(0,d.useState)((0,Yw.w)()),a=null!=t
return d.createElement(et.ZP,{buttons:[{disabled:!a,style:C.ZJ.SECONDARY,submit:!0,text:"Duplicate"}],medium:!0,onRequestClose:e.onRequestClose,onRequestSubmit:async function handleSubmit(){(0,S.hu)(null!=t,"Expected project for cloned dashboard")
const n=await(0,Ic.jI)(e.actions.cloneAnalyticsDashboard(e.analyticsDashboardId,{projectId:t}),"Duplicating dashboard...");(0,ac.ZP)(n.url)
e.onRequestSubmit()},title:"Duplicate dashboard"},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Project"}),d.createElement(Yw.Z,{onChange:n,projectId:t})))}function ConnectedCloneAnalyticsDashboardModal(e){return d.createElement(CloneAnalyticsDashboardModal,{...e,actions:{cloneAnalyticsDashboard:DC.Aq}})}function AnalyticsDashboardActionButtons(e){const t=useWritableContext(),{analyticsDashboardViewStateId:n,showDashboardCloneButton:a}=useAnalyticsDashboardContext();(0,S.Gp)(!t||(0,ln.cr)({feature:on.sZ.INSIGHTS_DELETE}),"Expected INSIGHTS_DELETE to be enabled if INSIGHTS_EDIT is enabled")
const i=useAreAnyAnalyticsQueriesRunning(e.analyticsDashboard,n),s=l.default.compact([{icon:"link",contents:d.createElement("span",null,"Copy link to dashboard"),onSelect:function handleCopyLink(){(0,$b.Z)((0,de.jp)(e.analyticsDashboard.url),{showToastOnSuccess:!0})}},a&&{icon:"copy",contents:d.createElement("span",null,"Duplicate"),onSelect:function handleCloneDashboard(){(0,Xn.Z)(ConnectedCloneAnalyticsDashboardModal,{analyticsDashboardId:e.analyticsDashboard.id})}},t&&{icon:"delete",contents:d.createElement("span",null,"Delete"),onSelect:async function handleDelete(){if(await(0,Zb.Z)({typeName:"dashboard"})){await(0,Ic.jI)(e.actions.deleteAnalyticsDashboard(e.analyticsDashboard.id),"Deleting dashboard...")
e.actions.removeFromWorkspace(e.analyticsDashboard.id)}}},e.analyticsDashboard.parameterConfigs.length>0&&{icon:"edit",isDisabled:i,tooltipTitle:i?"Parameter values can't be changed while queries are running":void 0,contents:d.createElement("span",null,"Edit parameters"),onSelect:function handleEditParameters(){(0,Xn.Z)(EditAnalyticsParametersModal,{parameterConfigs:e.analyticsDashboard.parameterConfigs,parameterValues:e.analyticsDashboard.parameterValues,onRequestSubmit:({parameterConfigs:n,parameterValues:a})=>{t?e.actions.updateParameterConfigsAndValues(n,a):e.actions.updateParameterValues(a)},writable:t})}},{icon:"audit-trail",contents:d.createElement("span",null,Tc.QU),onSelect:()=>{(0,bc.dV)([e.analyticsDashboard.id])}},{icon:"open",contents:d.createElement("span",null,"Help with dashboards"),href:ip.lZ,openInNewTab:!0}]),r=l.default.compact([t&&d.createElement(AnalyticsDashboardSettingsButton,{analyticsDashboard:e.analyticsDashboard,className:"u-mini-spacing-left",key:"settings"}),d.createElement(Cc.Z,{buttonProps:{size:C.qE.SMALL},enableTooltip:!0,key:"overflow",menuProps:{dropLeft:!0},options:s,tooltipPlacement:P.TQ.LEFT})])
return d.createElement("div",{className:e.className},r)}function ConnectedAnalyticsDashboardActionButtons(e){return d.createElement(AnalyticsDashboardActionButtons,{...e,actions:{...e.actions,deleteAnalyticsDashboard:DC.v1,removeFromWorkspace:Rn.Z.removeFromWorkspace}})}function AnalyticsDashboardReadOnlyInfo(){return d.createElement("span",{className:f()("u-cursor-default",(0,g.iv)(Kw.info))},d.createElement(P.ZP,{title:"Changes will not be saved. For edit access please contact the project owner.",placement:P.TQ.BOTTOM},d.createElement("span",null,"Read-only")))}const Kw=g.mM.create({info:{color:Vt.TG,..._n.c4}})
var Jw=n(768606)
function AnalyticsDescriptionIcon(e){return d.createElement(P.ZP,{placement:P.TQ.BOTTOM,title:e.description},d.createElement(pe.Z,{icon:"info-circle",className:f()(e.className,(0,g.iv)(Xw.largerIcon))}))}const Xw=g.mM.create({largerIcon:{transform:"translateY(1px)",width:"14px",height:"14px",marginBottom:"0px"}})
function EditableAnalyticsDashboardName(e){const t=useWritableContext(),{showDashboardLink:n}=useAnalyticsDashboardContext(),[a,i]=(0,d.useState)(!1)
const s=""!==e.analyticsDashboard.description,r=t&&s
return d.createElement("div",{className:"u-vertical-center-items"},d.createElement("span",{className:(0,g.iv)(r&&!a&&eN.notBeingEdited)},d.createElement(Iw.Z,{requestChange:function handleChangeName(t){const n=onUpdateAnalyticsDashboard({...e.analyticsDashboard,name:t});(0,Ic.jI)(e.actions.updateAnalyticsDashboard(e.analyticsDashboard.id,n),"Saving dashboard...")},value:e.analyticsDashboard.name,isDisabled:!t,onIsBeingEditedChanged:i,initialIsBeingEdited:a,dataTestAttrs:{component:"EditableAnalyticsDashboardName",element:"editableTextField"}})),!a&&s&&d.createElement("span",{className:"description-icon-wrapper"},d.createElement("span",{className:"u-mini-spacing-left"}),d.createElement(AnalyticsDescriptionIcon,{description:e.analyticsDashboard.description})),!a&&n&&d.createElement(Jw.Z,{analyticsDashboard:e.analyticsDashboard,className:"u-mini-spacing-left",showDashboardName:!1}))}const eN=g.mM.create({notBeingEdited:{":not(:hover) .registry-actionGroup":{display:"none"},":hover + .description-icon-wrapper":{display:"none"}}})
function AnalyticsDashboardEditorHeader(e){const t=useWritableContext(),{showReadOnlyBadge:n}=useAnalyticsDashboardContext(),{updateParameterConfigsAndValues:a,updateParameterValues:i,...s}=e.actions,r=[d.createElement(EditableAnalyticsDashboardName,{key:"analyticsDashboard",actions:s,analyticsDashboard:e.analyticsDashboard})]
return d.createElement("span",{className:"u-lr-split"},d.createElement(Cw.ZP,{crumbs:r,className:"breadcrumbs--large"}),d.createElement("div",{className:"u-vertical-center-items"},!t&&n&&d.createElement(AnalyticsDashboardReadOnlyInfo,null),d.createElement(ConnectedAnalyticsDashboardActionButtons,{actions:{updateParameterConfigsAndValues:a,updateParameterValues:i},analyticsDashboard:e.analyticsDashboard,className:t?void 0:"u-mini-spacing-left"})))}function AnalyticsDashboardNoBlocksContent(e){const t=useWritableContext()
return d.createElement(UIPlaceholder,{infoSection:"This dashboard doesn't have any blocks.",actionContent:t?d.createElement(AddBlockToDashboardButton,{...e,buttonProps:{size:C.qE.MEDIUM}}):void 0})}function refreshDashboard(e,t){e.analyticsQueries.forEach((n=>{const a=(0,Bd.kn)(n.id,t)
runGraphQLAnalyticsQuery(n,a,e.parameterConfigs,e.parameterValues,qd.getState(a),getExtraDataToTrackRunQuery(t,!0))}))}function RefreshDashboardButton(e){const{analyticsDashboardViewStateId:t}=useAnalyticsDashboardContext()
const n=useAreAnyAnalyticsQueriesRunning(e.analyticsDashboard,t)
return d.createElement(P.ZP,{title:n?"Refreshing...":"Refresh dashboard"},d.createElement(C.Co,{onClick:function handleClick(){e.actions.refreshDashboard(e.analyticsDashboard,t)},buttonStyle:C.ZJ.TERTIARY_GRAY,className:e.className,disabled:n,icon:"refresh",size:C.qE.SMALL}))}function ConnectedRefreshDashboardButton(e){return d.createElement(RefreshDashboardButton,{...e,actions:{refreshDashboard}})}function AnalyticsDashboardEditor({actions:e,analyticsDashboard:t,screenState:n,parameterList:a}){const i=useWritableContext()
const s={actions:{cloneBlock:async function cloneBlock(n){const a=await(0,Ic.jI)(e.cloneAnalyticsQuery(n,{destinationDashboardId:t.id}),"Duplicating block...")
e.openBlockEditor(a.id)},deleteBlock:e.deleteAnalyticsQuery,updateAnalyticsQuery:async function updateAnalyticsQuery(n,a){await(0,Ic.jI)(e.updateAnalyticsDashboard(t.id,onChangeAnalyticsQuery(t,n,a)),"Updating block...")},updateParameterValues:e.updateParameterValues,openBlockEditor:e.openBlockEditor,toggleExpandBlock:function handleToggleExpandBlock(t,n){n?e.expandBlock(t):e.collapseBlock()}},dashboardAttrs:t,parameterConfigs:t.parameterConfigs,parameterValues:t.parameterValues},r=d.createElement(AnalyticsDashboardEditorHeader,{actions:e,analyticsDashboard:t}),o=d.createElement(ActionBarSkeleton,{leftButtons:d.createElement(d.Fragment,null,d.createElement(ConnectedRefreshDashboardButton,{analyticsDashboard:t})),parameterList:a,rightButtons:i?d.createElement(AddBlockToDashboardButton,{actions:e,analyticsDashboard:t}):null}),renderBlock=(e,t,n)=>d.createElement(ConnectedAnalyticsBlock,{...s,analyticsQuery:e,index:n,dragHandleProps:t,isExpanded:!1})
let l
const c=getValidExpandedAnalyticsQueryId(t,n)
if(null!=c)l=d.createElement(DynamicLayout,null,d.createElement(OneColumnDynamicLayoutRow,{height:ip.Si},d.createElement(ConnectedAnalyticsBlock,{...s,analyticsQuery:t.analyticsQueries.find((e=>e.id===c)),index:0,isExpanded:!0})))
else{const n=t.layoutRows.map((e=>e.analyticsQueries))
l=n.length>0?d.createElement(DnDCanvas,{items:n,blockHeight:ip.$M,maxColumnCount:2,minBlockWidth:ip.C5,onMoveItem:async function moveBlocks(n,a){const{layoutChanged:i,newLayoutRows:s}=moveBlockLayoutPosition(t.layoutRows,n,a)
if(i){await(0,Ic.jI)(e.updateAnalyticsDashboard(t.id,function onChangeLayoutRows(e,t){const n={...e,layoutRows:t}
assertWellFormedLayout(n,"before making spec request")
return onUpdateAnalyticsDashboard(n)}(t,s)));(0,m.KK)(j.JG.CHANGED_BLOCK_LAYOUT)}},renderItem:renderBlock}):d.createElement(AnalyticsDashboardNoBlocksContent,{actions:e,analyticsDashboard:t})
assertWellFormedLayout(t,"while rendering layout in AnalyticsDashboardEditor")}return d.createElement(AnalyticsTabSkeleton,{header:d.createElement(d.Fragment,null,r,o),dataTestAttrs:{component:"AnalyticsDashboardEditor",element:"root"}},l)}function ConnectedAnalyticsDashboardEditor(e){const{analyticsDashboardViewStateId:t}=useAnalyticsDashboardContext(),[n,a]=eu.useGlobalClientState(t)
return isDashboardEditorScreenState(n)?d.createElement(AnalyticsDashboardEditor,{...e,actions:{...e.actions,collapseBlock:()=>{a(function collapseBlock(e){return{...e,maybeValidExpandedAnalyticsQuery:null}}(n))},expandBlock:e=>{a(function expandBlock(e,t){return{...e,maybeValidExpandedAnalyticsQuery:{id:t}}}(n,e))},cloneAnalyticsQuery:AnalyticsQueryActions_cloneAnalyticsQuery},screenState:n}):null}async function deleteAnalyticsQueryFromDashboard(e,t,n){if(await(0,Zb.Z)({typeName:"block"})){n.openDashboardEditor()
const a=await(0,Ic.jI)(n.updateAnalyticsDashboard(e.id,function onDeleteAnalyticsQuery(e,t){return onTransformAnalyticsQueries(e,(e=>e.filter((e=>e.id!==t))))}(e,t)),"Deleting block...");(0,m.KK)(j.JG.DELETED_BLOCK,{num_blocks:a.analyticsQueries.length})}}var tN=n(860608),nN=n(286455),aN=n(954587)
function AnalyticsParameterConfigModal({initialConfig:e,initialValueJson:t,disabled:n,onRequestClose:a,onRequestSubmit:i}){const s=(0,Ql.Z)(e.systemName),[r,o]=(0,d.useState)((0,wu.Z)(e))
return d.createElement(et.ZP,{buttons:[{disabled:n||""===s.value,style:C.ZJ.SECONDARY,submit:!0,text:"Update"}],onRequestClose:a,onRequestSubmit:function handleSubmit(){i({...e,__typename:Uw.dM[r.type],systemName:s.value,...r.configSetting})
const t=Uw.PB[e.__typename]
t!==r.type&&function trackParameterTypes(e,t){(0,m.KK)(j.JG.UPDATED_PARAMETER_TYPE,{old_type:e,new_type:t})}(t,r.type)},title:"Parameter configuration"},d.createElement(Ke.Z,null,d.createElement(Jl.Z,{inputClassName:(0,g.iv)(iN.inputHeightFix),label:"Name",...s,disabled:n})),d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Type"}),d.createElement(ParameterTypeHelpButton,{className:"u-mini-spacing-left"}),d.createElement(AnalyticsParameterTypeDropdown,{parameterConfig:r,onChange:o,disabled:n})),Uw.Ao[r.type]&&d.createElement(Ke.Z,{className:(0,g.iv)(iN.checkboxFormGroup)},d.createElement(Io.Z,{id:"multiple-values-checkbox",label:"Allow multiple values",disabled:n,onChange:e=>{const t={...r,configSetting:{...r.configSetting,isMulti:e.target.checked}}
o(t)},checked:r.configSetting.isMulti||!1}),d.createElement(ParameterInfoButton,null)),function currentStateWillDropValues(){return!r.configSetting.isMulti&&Array.isArray(t)&&t.length>1}()&&d.createElement(aN.Z,null,"This parameter has multiple values selected. If you remove the multi-value setting, all values except the first one will be removed."))}const iN=g.mM.create({inputHeightFix:{height:36},checkboxFormGroup:{display:"flex"}})
var sN=n(808342)
function AnalyticsParameterValueModal(e){const{type:t,configSetting:n}=(0,wu.T)(e.config),a=n,{valueJson:i,valueJsonIsValid:s,updateValueJson:r}=(0,sN.Z)(t,e.initialValueJson)
const o={valueJson:i,paramConfigSetting:a,onChange:r,allowAutoFocus:!0}
return d.createElement(et.ZP,{buttons:[{disabled:!s,style:C.ZJ.SECONDARY,submit:!0,text:"Update"}],onRequestClose:e.onRequestClose,onRequestSubmit:function handleSubmit(){e.onRequestSubmit({valueJson:i})},title:`Edit ${e.config.systemName} value`},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:`Value (${Uw.wL[t]})`}),d.createElement(ParameterTypeHelpButton,{className:"u-mini-spacing-left"}),d.createElement(Iu.ZP,{paramType:t,inputProps:o}),!s&&d.createElement(Cu.Z,{type:t})))}var rN=n(720180),oN=n(8781)
function DashboardDetailsParameterPill(e){const t=useWritableContext()
return d.createElement(rN.ZP,{renderedConfig:d.createElement(rN.Vw,{tooltipProps:{disabled:!t,title:e.areQueriesRunning?"View parameter configuration":"Configure parameter"}},e.config.systemName),renderedValue:d.createElement(oN.ZP,{areQueriesRunning:e.areQueriesRunning,config:e.config,valueJson:e.valueJson}),onClickConfig:t?async function handleEditConfig(){if(!(0,S.Gp)(t,"Should not be able to edit config if dashboard is read-only"))return
const n=await(0,Xn.Z)(AnalyticsParameterConfigModal,{initialConfig:e.config,initialValueJson:e.valueJson,disabled:e.areQueriesRunning})
null==n||e.areQueriesRunning||e.onChangeConfig(n)}:void 0,onClickValue:e.areQueriesRunning?void 0:async function handleEditValue(){if(!(0,S.Gp)(!e.areQueriesRunning,"Should not be able to edit parameter value while queries are running"))return
const t=await(0,Xn.Z)(AnalyticsParameterValueModal,{config:e.config,initialValueJson:e.valueJson})
null!=t&&e.onChangeValueJson(e.config.id,t.valueJson)}})}function DashboardDetailsParameterPillList(e){function handleChangeConfig(t){const n=function updateConfig(e,t){return e.map((e=>e.id===t.id?t:e))}(e.parameterConfigs,t)
e.onChangeParameterConfigs(n)}function handleChangeValueJson(t,n){const a=updateValueJsonForConfig(e.parameterConfigs,e.parameterValues,t,n)
e.onChangeParameterValues(a)}return d.createElement(nN.Z,null,(0,Nu.Z)(e.parameterConfigs).map((t=>d.createElement(DashboardDetailsParameterPill,{key:t.id,config:t,valueJson:(0,Cd.YG)(e.parameterValues,t.id),onChangeConfig:handleChangeConfig,onChangeValueJson:handleChangeValueJson,areQueriesRunning:e.areQueriesRunning}))))}function getComparableData(e){return{...e,parameters:(0,hs.Z)(e.parameters,[e=>e.config.systemName])}}function processAnalyticsQuery({actions:e,analyticsDashboardViewStateId:t,analyticsQueryViewStateId:n,analyticsQuery:a,lastRunQueryDatasByIdRef:i,parameterConfigs:s,parameterValues:r,pendingRunQueryDatasById:o,runQueryState:l,setPendingRunQueryDatasById:c}){const d=l.status!==Wr.Lr.NOT_FETCHED,u=o[a.id],m=(()=>{if(!d)return!0
const e=i.current[a.id]
return null!=u&&(null==e||!function areRunQueryDatasEqual(e,t){return Is()(getComparableData(e),getComparableData(t))}(u,e))})()
if(m){const o=null!=u?u:getRunQueryData({parameterConfigs:s,parameterValues:r,sqlQuery:a.sqlQuery})
e.runAnalyticsQuery(a,n,o,l,getExtraDataToTrackRunQuery(t,d))
i.current[a.id]=o}null!=u&&c((0,ig.Z)(o,a.id))}const lN=(0,xl.ZP)(null)
function AnalyticsDashboardDetails(e){const{screenState:t,serverAnalyticsDashboard:{analyticsQueries:n,parameterConfigs:a},viewStateId:i,_skipMalformedStateAssertion:s=!1}=e,r=e.serverAnalyticsDashboard.permissions.writable&&!e.readOnly,o=e.serverAnalyticsDashboard.id;(0,S.Gp)(null==e.parameterValueOverrides||!r,"Expected to only use the parameterValueOverrides prop when the dashboard details are read-only")
const[c]=(0,d.useState)(r?void 0:e.parameterValueOverrides),[u,m]=lN.useGlobalClientState(i),p=function useCheckScreenState({openDashboardEditor:e,screenState:t,skipAssert:n,writable:a}){const i=isDashboardEditorScreenState(t)||isBlockEditorScreenState(t)&&a;(0,d.useEffect)((()=>{if(!i){n||(0,S.Gp)(!1,"Expected dashboard editor or writable block editor screen, got but unexpected screenState",{screenState:t,writable:a})
e()}}),[i,e,t,n,a])
return i}({openDashboardEditor:e.actions.openDashboardEditor,screenState:t,skipAssert:s,writable:r})
async function updateWithLoadingScreen(t){(0,S.Gp)(r,"Unexpectedly trying to update dashboard as read-only user")
y(t)
await(0,Ic.jI)(e.actions.updateAnalyticsDashboard(o,t),"Saving dashboard...")}function handleDeleteAnalyticsQuery(t){deleteAnalyticsQueryFromDashboard(e.serverAnalyticsDashboard,t,{openDashboardEditor:handleOpenDashboardEditor,updateAnalyticsDashboard:e.actions.updateAnalyticsDashboard})}const[h,g]=function useConditionalLocalGraphQLState(e,t,n,a,i,s){const[r,o]=useLocalGraphQLState(t,n,a,i)
return e?[r,o]:[i,e=>{s(t,e)}]}(!r,i,u,((e,t)=>{m(t)}),void 0===c?e.serverAnalyticsDashboard.parameterValues:c,((t,n)=>{updateWithLoadingScreen(function onChangeParameterValues(e,t){return onChangeParameterConfigsAndValues(e,{values:t})}(e.serverAnalyticsDashboard,n))}))
function handleChangeParameterValues(e){f(e)
g(e)}const E=(0,d.useMemo)((()=>({...e.serverAnalyticsDashboard,parameterValues:h})),[h,e.serverAnalyticsDashboard]),{runOnChangeParameterValues:f,runOnUpdateDashboard:y}=function useRunDashboardQueries({actions:e,analyticsDashboard:t,analyticsDashboardViewStateId:n}){const{analyticsQueries:a,parameterConfigs:i,parameterValues:s}=t,[r]=eu.useGlobalClientState(n),o=(0,d.useMemo)((()=>getVisibleAnalyticsQueryIds(t,r).map((e=>(0,Bd.kn)(e,n)))),[t,n,r]),c=(0,d.useMemo)((()=>new Set(o)),[o]),u=(0,Pu.Z)(c),[m]=qd.useGlobalClientStates(o),p=(0,Jt.m8)(a.map((e=>(0,Jt.LI)(e.id,getRunQueryData({parameterConfigs:i,parameterValues:s,sqlQuery:e.sqlQuery}))))),h=(0,d.useRef)(p),[g,E]=(0,d.useState)({}),f=(0,Pu.Z)(g);(0,d.useEffect)((()=>{if(f===g&&u&&(0,Jt.OL)(u,c))return
const t=l.default.indexBy(a,"id")
o.forEach((a=>{processAnalyticsQuery({actions:e,analyticsDashboardViewStateId:n,analyticsQuery:t[(0,Bd.mX)(a)],analyticsQueryViewStateId:a,lastRunQueryDatasByIdRef:h,parameterConfigs:i,parameterValues:s,pendingRunQueryDatasById:g,runQueryState:m[a],setPendingRunQueryDatasById:E})}))}),[e,t,n,a,i,s,g,f,o,u,m,c])
return{runOnChangeParameterValues(e){const t=(0,Jt.m8)(a.map((t=>(0,Jt.LI)(t.id,getRunQueryData({parameterConfigs:i,parameterValues:e,sqlQuery:t.sqlQuery})))))
E(t)},runOnUpdateDashboard(e){const t=e.analyticsQueries.filter((e=>null!=e.id)),n=(0,Jt.m8)(t.map((t=>(0,Jt.LI)(t.id,restGetRunQueryData({parameterConfigs:e.parameterConfigs,parameterValues:e.parameterValues,sqlQuery:t.sqlQuery})))))
E(n)}}}({actions:e.actions,analyticsDashboard:E,analyticsDashboardViewStateId:i})
function handleOpenDashboardEditor(){e.actions.openDashboardEditor()}const b=function useAreAnyVisibleAnalyticsQueriesRunning(e,t,n){const a=getVisibleAnalyticsQueryIds(e,n).map((e=>(0,Bd.kn)(e,t))),[i]=qd.useGlobalClientStates(a)
return a.some((e=>i[e].status===Wr.Lr.LOADING))}(e.serverAnalyticsDashboard,i,t),T=a.length>0?d.createElement(DashboardDetailsParameterPillList,{areQueriesRunning:b,onChangeParameterConfigs:function handleChangeParameterConfigs(t){updateWithLoadingScreen(function onChangeParameterConfigs(e,t){return onChangeParameterConfigsAndValues(e,{configs:t})}(e.serverAnalyticsDashboard,t))
renameParametersInLocalSQLQueryOverrides(n,a,t)},onChangeParameterValues:handleChangeParameterValues,parameterConfigs:a,parameterValues:h}):null
let v
if(!p)return null
if(isBlockEditorScreenState(t)){const findQuery=e=>n.find((t=>t.id===e))
v=d.createElement(Pw,{actions:{...e.actions,deleteAnalyticsQuery:handleDeleteAnalyticsQuery,updateAnalyticsQuery:async function updateAnalyticsQuery(t,n){await updateWithLoadingScreen(onChangeAnalyticsQuery(e.serverAnalyticsDashboard,t,n))},openDashboardEditor:handleOpenDashboardEditor},analyticsDashboardAttrs:E,analyticsQuery:findQuery(t.analyticsQuery.id),parameterList:T,parameterConfigs:a,parameterValues:h})}else{(0,S.Gp)(isDashboardEditorScreenState(t),"Unexpected screenStateMode",{screenState:t})
v=d.createElement(ConnectedAnalyticsDashboardEditor,{actions:{...e.actions,deleteAnalyticsQuery:handleDeleteAnalyticsQuery,openBlockEditor:function handleOpenBlockEditor(t){e.actions.openBlockEditor(t)},updateParameterConfigsAndValues:function handleChangeParameterConfigsAndValues(t,i){updateWithLoadingScreen(onChangeParameterConfigsAndValues(e.serverAnalyticsDashboard,{configs:t,values:i}))
renameParametersInLocalSQLQueryOverrides(n,a,t)},updateParameterValues:handleChangeParameterValues},analyticsDashboard:E,parameterList:T})}return d.createElement(UC.Provider,{value:{...qC,analyticsDashboardViewStateId:i,delayExpensiveRenders:e.delayExpensiveRenders,showReadOnlyBadge:e.showReadOnlyBadge,showDashboardLink:e.showDashboardLink,showDashboardCloneButton:e.showDashboardCloneButton&&(0,ln.cr)({feature:on.sZ.INSIGHTS_CREATE}),theme:e.theme}},d.createElement(xw.Provider,{value:r},v))}function QueryingAnalyticsDashboardDetails({analyticsDashboardId:e,...t}){(0,Ul.Z)((()=>{!async function fetchWarehouseModelsQuery(){await(0,Ml.doQuerySafe)({query:KC})}()}))
return d.createElement(Da.ZP,{query:tN.F,renderLoading:()=>d.createElement(kl.b,null),variables:{analyticsDashboardId:e}},(e=>(0,ka.CZ)(e.analyticsDashboard)?d.createElement(Ll.Z,{inaccessibleInfo:e.analyticsDashboard,modelType:st.ANALYTICS_DASHBOARD}):d.createElement(AnalyticsDashboardDetails,{...t,serverAnalyticsDashboard:e.analyticsDashboard})))}function ConnectedAnalyticsDashboardDetails(e){const[t,n]=eu.useGlobalClientState(e.viewStateId)
return d.createElement(QueryingAnalyticsDashboardDetails,{...e,actions:{openBlockEditor:e=>{n(function makeBlockEditorScreenState(e){return{analyticsQuery:{id:e},expandedPane:null,screenStateMode:Kd.BLOCK_EDITOR}}(e))},openDashboardEditor:()=>{n(function makeDashboardEditorScreenState(){return{...Xd}}())},runAnalyticsQuery,updateAnalyticsDashboard:DC.Kt},screenState:t})}ConnectedAnalyticsDashboardDetails.defaultProps={readOnly:!1}
class AnalyticsDashboardTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){const e={analyticsDashboardId:this.model.get("analyticsDashboardId"),viewStateId:this.model.get("viewStateId")};(0,Me.A9)(d.createElement(ConnectedAnalyticsDashboardDetails,{...e,...qC}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}AnalyticsDashboardTabView.initClass()
var cN=n(195633),dN=n(963839)
function parameterValueTemplatesToOverrides(e,t){const n=e.filter((e=>!(0,ka.CZ)(e.config)));(0,S.Gp)(n.length===e.length,"parameterValueTemplatesToOverrides should not be used in a context where some parameterConfigs are inaccessible")
return n.map((e=>getParameterValueObject(e.config,e.valueOperation===Sn.LR.USE_EMBEDDING_ITEM?t:e.valueJson)))}var uN=n(180823)
function EmbeddedAnalyticsDashboardView(e){const{originalAnalyticsDashboard:t,parameterValueTemplates:n}=e.analyticsDashboardLink;(0,Ul.Z)((()=>{const t=ea.ZP.apiIdToType(e.itemId);(0,S.hu)((0,tw.isRegistrySupportedType)(t),`OPENED_EMBEDDED_DASHBOARD_TAB event not implemented for item of type ${t}`);(0,m.KK)(j.JG.OPENED_EMBEDDED_DASHBOARD_TAB,{entityType:t})}))
return d.createElement("div",{className:(0,g.iv)(mN.wrapper)},(0,ka.CZ)(t)?d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:"You do not have access to the dashboard embedded in this item"}):d.createElement(uN.I,{fileId:e.itemId},d.createElement(ConnectedAnalyticsDashboardDetails,{analyticsDashboardId:t.id,readOnly:!0,delayExpensiveRenders:!0,parameterValueOverrides:parameterValueTemplatesToOverrides(n,e.itemId),showReadOnlyBadge:!1,showDashboardCloneButton:!1,showDashboardLink:!0,theme:{dashboardBackgroundColor:Hl.v.WHITE,paneBorder:yf.K9.SOLID},viewStateId:(0,BC.FX)(t.id,{embeddingItemId:e.itemId,viewType:dN.b.EMBEDDED_ANALYTICS_DASHBOARD})})))}const mN=g.mM.create({wrapper:{position:"absolute",left:0,right:0,top:0,bottom:0,overflowY:"auto"}})
var pN=n(317776),hN=n(656039),gN=n(285560),EN=n(528431)
function ConnectionData(e){const[t,n]=(0,d.useState)([])
return d.createElement("div",{className:"react-tab-container"},d.createElement(Rd.ZP,{instrumentData:t,setInstrumentData:n,columns:["File name","Status","Modified at"],fileTypeFilter:hN.u2.ORIGINAL,filterOptions:[],initialFilterValues:{[Kn.Vm.CONNECTION]:[e.connectionId]},hideCheckboxColumn:!0,onSelectRow:dt.ZP.FILES_ENABLE?async n=>{const a=t[n]
if(a.status!==hN.jS.UPLOADED){v.ZP.error("The file cannot be opened due to its unavailable status.")
return}if(!e.dataCatalogFolderId){v.ZP.error("Files cannot be created in data catalog because a data catalog folder has not been set for this connection.")
return}$e.x$()
const i=await gN.C8({instrumentDataId:a.id,folderId:e.dataCatalogFolderId,connectionId:e.connectionId})
Rn.Z.openFile(i)}:void 0}))}const fN=xa.Ps`
  query ConnectionDataQuery($connectionId: StrictString!) @skipAudit @engComponent(name: INSTRUMENTS) {
    connection(id: $connectionId) {
      ... on ConnectionNode {
        id
        dataCatalogFolder {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function QueryingConnectionData(e){var t,n
const a=(0,Da.IJ)(fN,{variables:{connectionId:e.connectionId}})
return a.type!==Da.NI.SUCCESS?d.createElement(EN.d,null):(0,ka.CZ)(a.data.connection)?d.createElement(Ll.Z,{inaccessibleInfo:a.data.connection,modelType:"connection"}):d.createElement(ConnectionData,{connectionId:e.connectionId,dataCatalogFolderId:null!==(n=null===(t=a.data.connection.dataCatalogFolder)||void 0===t?void 0:t.id)&&void 0!==n?n:null})}class ConnectionDataTabView extends Js{render(){const e={connectionId:this.model.get("connectionId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(QueryingConnectionData,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ConnectionDataTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var SN=n(69526),yN=n(145242)
class ConnectionDetailsTabView extends Js{render(){const e={connectionId:this.model.get("connectionId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(yN.ZP,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ConnectionDetailsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var bN=n(28903),TN=n(872543),vN=n(162617),CN=n(865886),IN=n(224921),wN=n(91278),NN=n(539593),AN=n(480353),RN=n(68526),PN=n(843085)
class ConnectionRunsConnector extends oi.C{constructor(){super(...arguments)
this.stores=[IN.Z]}enhanceProps(){var e
const t=null!==(e=IN.Z.getRunSchemas())&&void 0!==e?e:[]
return{runSchemasById:(0,Jt.m8)(t.map((e=>(0,Jt.LI)(e.id,e))))}}}const ON=ConnectionRunsConnector.connect((function ConnectionRuns(e){const[t,n]=(0,d.useState)(!1),[a,i]=(0,d.useState)(function getDefaultFilters(){return[{...(0,Kn.QW)(Kn.Vm.TYPES),value:[st.ASSAY_RUN]},{...(0,Kn.QW)(Kn.Vm.ARCHIVE_PURPOSES),value:[zu.BH]}]}()),[s,r]=(0,d.useState)([]),[o,l]=(0,d.useState)({}),[c,u]=(0,d.useState)(!1),[m,p]=(0,d.useState)(0),[h,E]=(0,d.useState)(!1),S=(0,d.useCallback)((async t=>await(0,vN.jl)(function getSearchParams(e,t,n){const a={offset:e,limit:TN.L8,query:"",filters:[...t,{...(0,Kn.QW)(Kn.Vm.CONNECTION),value:[n]}],sorts:[],groupBy:null}
return(0,AN.DO)(a,Kn.Sc.RUN)}(t,a,e.connectionId),"read")),[e.connectionId,a]);(0,Ul.Z)((()=>{(0,CN.TN)()}));(0,d.useEffect)((()=>{!async function fetchInitialData(){n(!0)
const e=await S(0)
r(e.assayRuns)
l(e.entriesByRunId)
p(TN.L8)
E(e.total>TN.L8)
n(!1)}()}),[S,r])
const y=(0,NN.jl)(a,Object.values(e.runSchemasById))
return d.createElement("div",{className:"react-tab-container"},d.createElement("div",null,d.createElement("div",{className:"u-flex-display u-spacing-bottom"},d.createElement(Hu.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.TYPES,extraProps:{availableTypes:[st.ASSAY_RUN],isTypeRequired:!0}},{filterKey:Kn.Vm.ARCHIVE_PURPOSES,extraProps:{archivePurposes:dt.ZP.ARCHIVE_RUN_AND_RESULT_PURPOSES}}],secondaryFilterGroups:[{name:"General",filterOptions:[{filterKey:Kn.Vm.CREATED_AT},{filterKey:Kn.Vm.MODIFIED_AT},{filterKey:Kn.Vm.CREATOR},{filterKey:Kn.Vm.SCHEMA_FIELD,extraProps:{allowBlobLinkFields:!0,schemaFields:y?y.fields:[]}}]}],filters:a,onChangeFilters:e=>{i((0,RN.Fh)(e,(0,wN.yO)(e)))},selectedSchema:y}))),t?d.createElement(kl.b,null):d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(xN.tableContainer)},d.createElement(rc.iA,{emptyTableText:"No runs",numRows:s.length,overflowVisible:!0,className:(0,g.iv)(xN.table),getRowClassName:()=>(0,g.iv)(xN.tableRow)},d.createElement(rc.sg,{header:"Run",renderCell:e=>d.createElement(rc.bL,{className:f()({"u-faded":null!=s[e].archiveRecord})},d.createElement(PN.Z,{id:s[e].apiId,size:Za.TK.SMALL}))}),d.createElement(rc.sg,{header:"Schema",renderCell:t=>{var n
return d.createElement(rc.bL,{className:f()({"u-faded":null!=s[t].archiveRecord})},null===(n=e.runSchemasById[s[t].schemaId])||void 0===n?void 0:n.name)}}),d.createElement(rc.sg,{header:"Created At",renderCell:e=>d.createElement(rc.bL,{className:f()({"u-faded":null!=s[e].archiveRecord})},Hr.nI(s[e].createdAt))}),d.createElement(rc.sg,{header:"Origin",renderCell:e=>d.createElement(rc.bL,{className:f()({"u-faded":null!=s[e].archiveRecord})},o[s[e].id]?d.createElement(Lb.Z,{id:o[s[e].id].id,size:Za.TK.SMALL}):s[e].originType)})),h&&d.createElement("div",{className:"u-text-align-center u-small-spacing"},c?d.createElement("span",{className:"u-faded"},"Loading..."):d.createElement("a",{onClick:async()=>{u(!0)
const e=await S(m)
r([...s,...e.assayRuns])
l({...o,...e.entriesByRunId})
p(m+TN.L8)
E(e.total>m+TN.L8)
u(!1)}},"Load more runs")))))})),xN=g.mM.create({tableContainer:{maxHeight:"400px",overflowY:"auto"},table:{borderLeft:0,borderRight:0,marginBottom:0,marginRight:0,marginLeft:0},tableRow:{height:"36px"},tableCell:{padding:"0 13px"},checkboxCell:{textAlign:"center",padding:0,width:"20px"}})
class ConnectionRunsTabView extends Js{render(){const e={connectionId:this.model.get("connectionId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(ON,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ConnectionRunsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var _N=n(241500),DN=n(572928),LN=n(56063),kN=n(95537),MN=n(69152),FN=n(643509),ZN=n(3472),BN=n(428895),qN=n(731412),VN=n(475684),UN=n(273887),GN=n(832821),zN=n(139894),$N=n(763089),WN=n(787116),HN=n(678333),jN=n(186905)
function EditingList({studyableId:e,exitEditing:t,studies:n,refetch:a}){const[i,s]=(0,uT.Z)(),[r,o]=(0,uT.Z)(),l=(0,jN.Gm)(n),c=(0,jN.ZC)(l)
return d.createElement("div",{className:(0,g.iv)(QN.wrapper)},d.createElement(jN.ZP,{...l,shouldAllowMultiple:!0,chipSize:Za.TK.MINI}),d.createElement("span",{className:(0,g.iv)(QN.wrapper,QN.formIconWrapper)},d.createElement(pe.Z,{className:(0,g.iv)(QN.formIcon,i?QN.hoveredCloseIcon:QN.unhoveredCloseIcon),icon:"close",...s,onClick:()=>{t()}}),d.createElement(pe.Z,{className:(0,g.iv)(QN.formIcon,r?QN.hoveredSubmitIcon:QN.unhoveredSubmitIcon),icon:"check",onClick:async()=>{await async function updateStudyableStudies(e,t){await(0,HN.c)({studyables:{[e]:t}})}(e,c)
a()
t()},...o})))}function EditableStudiesList({refetch:e,studyableId:t,studies:n,isWritable:a}){const[i,s]=(0,d.useState)(!1),[r,o]=(0,uT.Z)(),l=n.every((e=>!(0,ka.CZ)(e)))
if(i){(0,S.hu)(l,"User must have permission to edit all studies of a studyable to edit any")
return d.createElement(EditingList,{studies:n,studyableId:t,exitEditing:()=>{s(!1)},refetch:e})}return d.createElement("div",{className:(0,g.iv)(QN.wrapper,QN.listWrapper,r?QN.hover:null),...o},d.createElement(Er.ZP,{itemIds:n.map((e=>(0,ka.CZ)(e)?e.invalidId:e.id)),isVertical:!1,chipSize:Za.TK.MINI}),r&&a&&d.createElement(P.pf,{tooltipTitle:l?null:"Cannot edit Studies as some are inaccessible"},d.createElement(pe.Z,{icon:"edit",className:(0,g.iv)(QN.editIcon),onClick:()=>{l&&s(!0)}})))}const YN=xa.Ps`
  query StudyableStudiesQuery($studyableId: StrictString!) @skipAudit @engComponent(name: STUDIES) {
    studyableItem(id: $studyableId) {
      ...InaccessibleInfoGraphQL
      ... on StudyableInterface {
        id
        studies {
          ...InaccessibleInfoGraphQL
          ... on StudyNode {
            id
            name
            humanId
          }
        }
      }
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
const QN=g.mM.create({wrapper:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},listWrapper:{padding:"3px"},formWrapper:{backgroundColor:Vt.bs},hover:{backgroundColor:Vt.bs},editIcon:{alignSelf:"flex-end",color:Vt.TG,marginBottom:"6px",marginRight:"24px",cursor:"pointer"},formIcon:{padding:"0 5px",cursor:"pointer"},formIconWrapper:{marginRight:"19px"},unhoveredCloseIcon:{color:Vt.TG},hoveredCloseIcon:{color:Vt.hM},unhoveredSubmitIcon:{color:Vt.Ej},hoveredSubmitIcon:{color:Vt.G$}}),KN=function QueryingEditableStudiesList({studyable:e,isWritable:t}){const n=!dt.ZP.STUDIES_ENABLE||!(0,WN.Hw)(e),a=(0,Da.A4)(YN,{variables:{studyableId:e.id},fetchPolicy:"network-only",skip:n})
if(a.type===Da.NI.SKIPPED)return null
if(a.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(a.type===Da.NI.ERROR)return d.createElement("div",null,"error")
if((0,ka.CZ)(a.data.studyableItem))return d.createElement("div",null,"You do not have permission to view this item.")
const i=a.data.studyableItem.studies
return d.createElement(EditableStudiesList,{studyableId:e.id,studies:i,refetch:a.refetch,isWritable:t})}
function ParentLink({icon:e,onClickParent:t,parentName:n,tooltipTitle:a}){return d.createElement("div",{className:(0,g.iv)(JN.parentLink),...(0,ee.Z)({component:"ParentLink",element:"root"})},d.createElement(pe.Z,{className:"u-faded u-mini-spacing-right",icon:e}),n,d.createElement(P.ZP,{title:a},Jn.Z.currentUser()&&d.createElement(pe.Z,{className:"metadata-icon--folder-parent",icon:"upload",onClick:t})))}ParentLink.propTypes={icon:J().string.isRequired,onClickParent:J().func.isRequired,parentName:J().node,tooltipTitle:J().string}
const JN=g.mM.create({parentLink:{alignItems:"center",display:"inline-flex"}})
var XN=n(468991),eA=n(343748),tA=n(198438),nA=n(220798),aA=n(684321)
class AuthorList extends d.Component{constructor(){super(...arguments)
this.state={isBeingEdited:!1,newAuthors:[]}
this._handleEdit=()=>{var e
this.setState({isBeingEdited:!0,newAuthors:null!==(e=this.props.authors)&&void 0!==e?e:[]})}
this._handleCancel=()=>{this.setState({isBeingEdited:!1})}
this._isEntry=()=>[st.ENTRY,st.STAGE_ENTRY].includes(ea.ZP.apiIdToType(this.props.fileId))
this._handleComplete=async()=>{const e=this.state.newAuthors.map((({id:e})=>e)),{warnings:t}=await eA.K5(this.props.fileId,e)
if(t.length)try{await je.iG("Updating Authors",d.createElement("div",null,"Are you sure you want to remove yourself as an author?"," ",t.map((e=>e.message)).join(" ")))}catch(e){this._handleCancel()
return}await Rn.Z.updateAuthorsWithDataMods(this.props.fileId,e,this.props.isRegistered)
this.setState({isBeingEdited:!1})}
this._updateAuthors=e=>{this.setState({newAuthors:e})}}_isAuthor(e){return Boolean(this.props.currentUser)&&e.some((({id:e})=>e===this.props.currentUser.id))}_getAuthorTags(){return this.state.newAuthors.map((({handle:e,id:t})=>({id:t,handle:e,text:e})))}render(){return d.createElement("div",{className:f()("metadata-field metadata-field--authorList",{[(0,g.iv)(iA.hover)]:this.props.isReadOnly})},d.createElement("div",{className:"metadata-field-row"},d.createElement("div",{className:"metadata-field-col"},(()=>this.state.isBeingEdited?d.createElement(tA.D,{allowAdjustInputWidth:!1,allowTeams:!1,allowOrganizations:!1,allowBenchlingApps:!0,onChange:this._updateAuthors,organizationIds:this.props.currentUser.organizations.map((({id:e})=>e)),size:nA.I.SMALL,value:this._getAuthorTags()}):this.props.authors&&this.props.authors.length>0?this.props.authors.map((e=>d.createElement("div",{key:e.handle},d.createElement("a",{key:e.handle,href:`/${e.url_identifier}`,target:"_blank",rel:"noopener noreferrer"},e.name)))):"This file has no authors.")()),d.createElement("div",{className:"registry-actionGroupContainer"},!this.props.isReadOnly&&d.createElement(aA.Z,{isEditing:this.state.isBeingEdited,cancel:this._handleCancel,complete:this._handleComplete,isCompleteEnabled:!0,edit:this._handleEdit}))))}}AuthorList.propTypes={authors:J().arrayOf(XN.OP.isRequired).isRequired,fileId:J().string.isRequired,isReadOnly:J().bool.isRequired,isRegistered:J().bool.isRequired,currentUser:J().shape({id:J().string.isRequired,organizations:J().arrayOf(J().shape({id:J().string.isRequired}).isRequired).isRequired})}
const iA=g.mM.create({hover:{":hover":{backgroundColor:Vt.Cj}}}),sA=AuthorList
function RegistryIdList(e){return d.createElement("div",{...(0,ee.Z)({component:"RegistryIdList",element:"root"})},d.createElement("div",{className:"metadata-header"},(0,de._6)(e.registryIds.length,"Registry ID")),e.registryIds.map((t=>{var n
return d.createElement(uC.Z,{className:"metadata-field--registryId",complete:n=>{((t,n)=>{qN.ru(e.fileId,t,n,!0)})(t.alias,n)},key:t.alias,initialAlias:t.alias,subtitle:null===(n=t.registryCollectionOwner)||void 0===n?void 0:n.name,isWritable:e.isRegistryWritable})})))}function SectionWrapper(e){return d.createElement("div",{className:"metadata-section",...(0,ee.Z)({component:"SectionWrapper",element:e.elementName})},d.createElement("div",{className:"metadata-header"},e.headerName),e.children)}const rA=xa.Ps`
  query BioentityRegistrationOriginQuery($id: StrictString!) @skipAudit @engComponent(name: REGISTRY) {
    bioentity(id: $id) {
      ... on RegistryItemInterface {
        id
        registrationOrigin {
          ...RegistrationOriginGraphQL
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("RegistrationOrigin").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class MetadataEditorInfoSection extends d.Component{constructor(){super(...arguments)
this.isRegistered=()=>Boolean(this.props.registryId)}showContainingFolder(e){const t=st.NOTEBOOK_ITEMS.includes(ea.ZP.apiIdToType(this.props.fileId))?ZN.NOTEBOOK_SECTION:ZN.INVENTORY_SECTION;(0,$N.Z)(e,t)}renderAuthors(){const e=this.isRegistered()
return d.createElement(SectionWrapper,{headerName:"Authors",elementName:"authorsSection"},d.createElement(sA,{authors:this.props.authors,fileId:this.props.fileId,isReadOnly:!(0,ln.cr)({feature:rn.N7.EDIT,item:{id:this.props.fileId,permissions:this.props.permissions},itemState:{isRegistered:e}})||ea.ZP.isBulkAssembly(this.props.fileId),isRegistered:e,currentUser:Jn.Z.currentUser()}))}renderProjectFolderSection(){return d.createElement(SectionWrapper,{headerName:"Project location",elementName:"projectFolderSection"},d.createElement(ParentLink,{icon:"folder",onClickParent:()=>{this.showContainingFolder(this.props.projectFolder)},parentName:this.props.projectFolder.name,tooltipTitle:"Show containing project folder"}))}renderLocationSection(){const e=this.props.folder
return null==e?null:d.createElement(SectionWrapper,{headerName:"Location",elementName:"locationSection"},d.createElement(ParentLink,{icon:"folder",onClickParent:()=>{this.showContainingFolder(e)},parentName:e.name,tooltipTitle:"Show containing folder"}))}renderRegistryIdsSection(){var e
return d.createElement("div",{className:"metadata-section",...(0,ee.Z)({component:"SectionWrapper",element:"registryIdsSection"})},d.createElement(RegistryIdList,{fileId:this.props.fileId,isRegistryWritable:null!==(e=this.props.permissions.registryIdsChangeable)&&void 0!==e&&e,registryIds:this.props.bioentityAliasInfos.filter((e=>null!=e.registryCollectionOwner))}))}renderRegisteredInSection(){return this.props.isLoadingRegistrationOrigin?d.createElement(kl.Z,null):d.createElement(SectionWrapper,{headerName:"Registered in",elementName:"registeredInSection"},d.createElement(sc.Z,{size:Za.TK.SMALL,id:this.props.registrationOrigin.originEntry.id,isLink:!0}))}renderHumanIdSection(){return d.createElement(SectionWrapper,{headerName:"ID",elementName:"humanIdSection"},this.props.humanId)}renderCreatedAt(){return d.createElement(SectionWrapper,{headerName:"Created",elementName:"createdAtSection"},(0,Hr.UT)(this.props.createdAt))}renderFinalizedAt(){const{finalizedAt:e}=this.props.finalized
return d.createElement(SectionWrapper,{headerName:"Finalized",elementName:"finalizedAtSection"},d.createElement("span",null,null!=e?(0,Hr.UT)(e):"Unknown"))}renderCollaborationManagementSection(){return d.createElement(SectionWrapper,{headerName:"Collaborators",elementName:"collaboratorsSection"},d.createElement(zN.Av,{policeableId:this.props.fileId}))}render(){var e,t
const n={id:this.props.fileId},a=l.default.compact([null!=this.props.authors&&d.createElement(p.Z,{sm:6},this.renderAuthors()),d.createElement(p.Z,{sm:6},(()=>null!=this.props.projectFolder?this.renderProjectFolderSection():this.props.hasFileSchemaSupport?this.renderLocationSection():null)()),dt.ZP.STUDIES_ENABLE&&(0,WN.Hw)(n)&&d.createElement(p.Z,{sm:6},d.createElement(SectionWrapper,{headerName:"Studies",elementName:"studiesSection"},d.createElement(KN,{studyable:n,isWritable:this.props.permissions.writable}))),this.props.hasRegistrySupport&&this.isRegistered()&&d.createElement(p.Z,{sm:6},this.renderRegistryIdsSection()),this.props.hasRegistrySupport&&this.isRegistered()&&((null===(e=this.props.registrationOrigin)||void 0===e?void 0:e.originEntry)||this.props.isLoadingRegistrationOrigin)&&d.createElement(p.Z,{sm:6},this.renderRegisteredInSection()),null!=this.props.humanId&&d.createElement(p.Z,{sm:6},this.renderHumanIdSection()),null!=this.props.createdAt&&d.createElement(p.Z,{sm:6},this.renderCreatedAt()),null!=(null===(t=this.props.finalized)||void 0===t?void 0:t.isFinalized)&&d.createElement(p.Z,{sm:6},this.renderFinalizedAt()),(0,GN.ZP)({id:this.props.fileId})&&d.createElement(p.Z,{sm:6},this.renderCollaborationManagementSection())]),i=[]
for(let e=0,t=a.length;e<t;e+=2)i.push(d.createElement(h.Z,{bufferRowReset:!0,key:e},a[e],a[e+1]))
return d.createElement("div",null,i)}}function QueryingMetadataEditorInfoSection(e){var t
if(e.hasRegistrySupport){const n=(0,Da.IJ)(rA,{variables:{id:e.fileId},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0})
if(n.type===Da.NI.PENDING)return d.createElement(MetadataEditorInfoSection,{...e,registrationOrigin:null,isLoadingRegistrationOrigin:!0})
if(n.type===Da.NI.SUCCESS){(0,S.Gp)(Boolean(!(0,ka.CZ)(n.data.bioentity)||e.fileId===(null===(t=window.bootstrap)||void 0===t?void 0:t.sharedFolderItemAPIId)),"Expected accessible bioentity")
return d.createElement(MetadataEditorInfoSection,{...e,registrationOrigin:(0,ka.CZ)(n.data.bioentity)?null:n.data.bioentity.registrationOrigin,isLoadingRegistrationOrigin:!1})}return null}return d.createElement(MetadataEditorInfoSection,{...e,registrationOrigin:null})}var oA=n(130153),lA=n(377249),cA=n(902680),dA=n(381148),uA=n(609133)
const mA=xa.Ps`
  query ProcessMetadataSectionQuery($processId: StrictString!) @skipAudit @engComponent(name: WORKFLOWS) {
    process(id: $processId) {
      ... on ProcessNode {
        id
        processTaskSchema {
          id
          name
          archiveRecord {
            purpose
          }
        }
        watchers {
          id
          name
          handle
        }
        responsibleTeam {
          id
          name
          handle
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ProcessResponsibleTeamField(e){return null==e.processId?d.createElement(kl.Z,null):d.createElement(dA.Z,{value:e.responsibleTeam,onChange:()=>{},isDisabled:!0,chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowEmails:!1,allowTeams:!0,allowOrganizations:!1,shouldAllowMultiple:!1,userSearchType:tA.t.None,isFullWidth:!1,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0})}function ProcessWatchersField(e){return null==e.processId?d.createElement(kl.Z,null):d.createElement(dA.Z,{value:e.watchers,onChange:async t=>{const{watchers:n,responsibleTeam:a,processTaskSchema:i}=await uA.Q3({id:e.processId,watcherIds:t.map((({id:e})=>e)),sourceType:"metadata",actionOrigin:j.D2.WORKFLOWS_TASK_GROUP_METADATA_TAB,actionMethod:j.LY.DIRECT_EDIT,eventGroupId:(0,m.Vr)()})
Ml.writeQuery({query:mA},{process:{__typename:"ProcessNode",id:e.processId,watchers:n,responsibleTeam:a,processTaskSchema:{__typename:"ProcessTaskSchemaNode",id:i.id,name:i.name}}})
v.ZP.success("Updated watchers")},isDisabled:!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT}),chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowEmails:!1,allowTeams:!1,allowOrganizations:!1,shouldAllowMultiple:!0,userSearchType:tA.t.NotSuspended,isFullWidth:!1,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0})}function ProcessTaskSchemaField(e){return null==e.processTaskSchema?d.createElement(kl.Z,null):d.createElement("span",null,e.processTaskSchema.name,e.processTaskSchema.archiveRecord&&" (archived)")}function MetadataColumn(e){return d.createElement(p.Z,{sm:6},d.createElement("div",{className:"metadata-section"},d.createElement("div",{className:"metadata-header"},e.title),e.children))}function ProcessMetadataSection(e){var t,n,a,i,s,r,o,l,c,u
return d.createElement(d.Fragment,null,d.createElement(h.Z,{bufferRowReset:!0},d.createElement(MetadataColumn,{title:"Task schema"},d.createElement(ProcessTaskSchemaField,{processTaskSchema:null!==(n=null===(t=e.process)||void 0===t?void 0:t.processTaskSchema)&&void 0!==n?n:null}))),d.createElement(h.Z,{bufferRowReset:!0},d.createElement(MetadataColumn,{title:"Watchers"},d.createElement(ProcessWatchersField,{processId:null!==(i=null===(a=e.process)||void 0===a?void 0:a.id)&&void 0!==i?i:null,watchers:null!==(r=null===(s=e.process)||void 0===s?void 0:s.watchers)&&void 0!==r?r:[]})),!dt.ZP.WORKFLOWS_ENABLE_COLLABORATORS&&d.createElement(MetadataColumn,{title:"Responsible team"},d.createElement(ProcessResponsibleTeamField,{processId:null!==(l=null===(o=e.process)||void 0===o?void 0:o.id)&&void 0!==l?l:null,responsibleTeam:null!==(u=null===(c=e.process)||void 0===c?void 0:c.responsibleTeam)&&void 0!==u?u:null}))))}function QueryingProcessMetadataSection(e){return d.createElement(Da.ZP,{query:mA,variables:{processId:e.processId},renderLoading:()=>d.createElement(ProcessMetadataSection,{process:null})},(e=>{const{process:t}=e
return(0,ka.CZ)(t)?d.createElement(Ll.Z,{inaccessibleInfo:t,modelType:"process"}):d.createElement(ProcessMetadataSection,{process:t})}))}var pA=n(546075),hA=n(540332),gA=n(812617),EA=n(919210),fA=n(609630),SA=n(331251)
var yA=n(386382)
async function MixtureActions_update(e,t){const n=await async function update(e,t){return await Cn.Ry({url:`/1/api/mixtures/${e}`,data:t})}(e,t);(0,Ml.writeFragmentsToCache)((0,La.f)("UpdateMixtureResponse"),[n.mixture])
v.ZP.success("Successfully updated mixture")
return n.mixture}async function MixtureActions_initializeInstructions(e){const t=await async function initializeInstructions(e){return await Cn.s0({url:"/1/api/mixtures:initialize-instructions",data:{mixtureId:e}})}(e),n=t.mixture;(0,S.hu)(null!=n.instructions,`Expected initialize-instructions endpoint to create non-null instructions for mixture ${n.id}`)
EA.Z.load(n.instructions.id,(0,SA.Z)(n.instructions.noteJson)).done((()=>{(0,Ml.writeFragmentsToCache)((0,La.f)("MixtureWithInstructions"),[n])}))}var bA=n(768614),TA=n(185994)
class MixtureValidationError extends kg.Z{}var vA=n(175504),CA=n(944149),IA=n(680011),wA=n(993391),NA=n(155079),AA=n(542578),RA=n(435191),PA=n(974298),OA=n(84133)
function isElement(e){return Boolean(e&&null!=e.id)}class _TextInputWithSuggestions extends d.Component{constructor(){super(...arguments)
this.optionRefs={}
this.state={value:"",isMenuOpen:!1,menuItems:[]}
this.scrollAreaRef=d.createRef()
this.scrollIndexIntoView=e=>{const t=u.findDOMNode(this.scrollAreaRef.current),n=u.findDOMNode(this.optionRefs[(0,RA.C2)(e)])
isElement(t)&&isElement(n)&&(0,ir.p)(t,n)}
this.changeHovered=e=>{const t=this.props.onChangeHoverIndex(e)
this.scrollIndexIntoView(t)}
this.updateState=({value:e,isMenuOpen:t,forceUpdateSelectableIndices:n})=>{const a=this.getMenuItems(e),i=(0,RA.vn)(a),s=!Is()(i,this.props.selectableIndices),r=!Is()(a.map((e=>{var t
return null!==(t=e.pureTextName)&&void 0!==t?t:e.name})),this.state.menuItems.map((e=>{var t
return null!==(t=e.pureTextName)&&void 0!==t?t:e.name})))
e!==this.state.value&&this.props.onChange&&this.props.onChange({target:{value:e}});(s||n)&&this.props.onUpdateSelectableIndices(i);(r||e!==this.state.value||t!==this.state.isMenuOpen)&&this.setState({menuItems:a,value:e,isMenuOpen:t})}
this.getMenuItems=e=>this.props.isLoading?[{name:d.createElement(kl.Z,null),disabled:!0,pureTextName:"Loading..."}]:this.props.getMatchingOptionDatas(null!=e?e:this.state.value,this.props.optionDatas)
this.handleKeyDown=e=>{var t,n
const{hoverIndex:a}=this.props
let i=!0
if(pn.isUpKey(e)){this.changeHovered(a-1)
e.preventDefault()}else if(pn.isDownKey(e))if(this.state.isMenuOpen)this.changeHovered(a+1)
else{this.setState({isMenuOpen:!0})
this.changeHovered(0)}else if(pn.isEnterKey(e)){i=!this.state.isMenuOpen
const e=null!==(n=null===(t=this.props.getMatchingOptionDatas(this.state.value,this.props.optionDatas)[(0,RA.i6)(this.props.selectableIndices,a)])||void 0===t?void 0:t.value)&&void 0!==n?n:this.state.value
this.updateState({value:e,isMenuOpen:!1})}return i}}componentDidMount(){this.updateState({value:this.props.value,isMenuOpen:!1,forceUpdateSelectableIndices:!0})}componentDidUpdate(e,t){e.isLoading&&!this.props.isLoading&&this.updateState({value:this.state.value,isMenuOpen:this.state.isMenuOpen})}render(){const e=this.getMenuItems(),t=d.createElement(w.ZP,{width:Nr.zL.MEDIUM,height:Nr.Bl.MEDIUM,ref:this.scrollAreaRef},e.map(((e,t)=>d.createElement(PA.Z,{key:t,value:e.value,isHovered:t===(0,RA.i6)(this.props.selectableIndices,this.props.hoverIndex),onHover:()=>{this.props.onHoverOption(t)},onSelect:e=>{this.updateState({value:e,isMenuOpen:!1})},ref:e=>{this.optionRefs[(0,RA.C2)(t)]=e}},(0,RA.xG)(e)))))
return d.createElement(I.ZP,{menu:t,isOpen:this.state.isMenuOpen&&Boolean(e.length),alwaysDropDown:!0},d.createElement(or.Z,{className:this.props.className,hasButton:this.props.hasButton,hasError:this.props.hasError,size:this.props.size,type:this.props.type,autoFocus:this.props.autoFocus,disabled:this.props.disabled,readOnly:this.props.readOnly,value:this.state.value,onChange:e=>{this.updateState({value:e.target.value,isMenuOpen:!0})},onFocus:e=>{this.updateState({value:this.state.value,isMenuOpen:!0})},onBlur:e=>{this.updateState({value:this.state.value,isMenuOpen:!1})},onKeyDown:e=>{this.handleKeyDown(e)&&this.props.onKeyDown&&this.props.onKeyDown(e)},dataTestAttrs:this.props.dataTestAttrs}))}}_TextInputWithSuggestions.defaultProps={getMatchingOptionDatas:RA.wd}
const xA=(0,OA.Z)(_TextInputWithSuggestions)
function CatalogIdentifierInput({componentBioentity:e,onChange:t,value:n,onKeyDown:a}){return d.createElement(Da.F,{query:MA,skip:null==e,variables:e?{bioentityId:e.id}:void 0,fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0},(e=>{const i=null==e.data||(0,ka.CZ)(e.data.bioentity)?[]:function getOptionDatas(e){return e.filter((e=>{var t
return e.value&&[Hn.FieldType.FLOAT,Hn.FieldType.INTEGER,Hn.FieldType.TEXT,Hn.FieldType.LONG_TEXT,Hn.FieldType.SELECTOR].includes(null===(t=e.tagSchemaField)||void 0===t?void 0:t.fieldType)})).map((e=>({name:d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(_A.ellipsisText)},e.value),d.createElement("div",{className:(0,g.iv)(_A.ellipsisText,_A.faded)},e.name)),value:e.value,pureTextName:`${e.name} ${e.value}`})))}(e.data.bioentity.tagsJson)
return d.createElement(xA,{optionDatas:i,className:(0,g.iv)(_A.textInput),size:Mo.$u.SMALL,value:null!=n?n:"",onChange:t,onKeyDown:a,isLoading:e.type===Da.NI.PENDING})}))}const _A=g.mM.create({textInput:{display:"flex"},ellipsisText:jf.wj,faded:jf.V6})
function AmountInput(e){return d.createElement(or.Z,{className:f()((0,g.iv)(DA.textInput),e.className),size:Mo.$u.SMALL,value:e.currentAmount||"",onChange:t=>{const n=t.target.value.trim()||null
e.onChangeAmount(n)},onKeyDown:e.onKeyDown,disabled:e.disabled,dataTestAttrs:{component:"IngredientTableSubheader",element:"amountTextInput"}})}function UnitsSelector(e){return d.createElement($r.ZP,{className:"disabled--withBorder",menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FIT_CONTENT,value:e.currentUnits},e.validUnits.map((t=>d.createElement(N.Z,{key:e.getUnitDisplayText(t),value:t,onSelect:e.onSelectUnits},e.getUnitDisplayText(t))))),displayName:e.getUnitDisplayText(e.currentUnits),disabled:e.disabled})}function IngredientTableSubheader(e){const setDraftMixtureUnits=t=>{e.isLoading||e.draftState.updateDraftData({mixtureUnits:t})},setDraftMixtureAmount=t=>{e.isLoading||e.draftState.updateDraftData({mixtureAmount:t})},renderPrepUnits=t=>!e.isLoading&&e.draftState.data.ingredients.some((e=>e.isInherited))?d.createElement(P.ZP,{title:"Units are inherited from parent mixture",delay:{show:350}},d.createElement("span",null,t.data.mixtureUnits)):d.createElement(UnitsSelector,{validUnits:bA.JT,currentUnits:t.data.mixtureUnits,getUnitDisplayText:e=>e,onSelectUnits:e=>{t.updateDraftData({mixtureUnits:e})},disabled:!t.isEditing})
return e.allowMeasuredIngredients?d.createElement("div",{className:"u-spacing-top u-vertical-center-items"},d.createElement("span",{className:f()("u-no-wrap u-small-spacing-right",(0,g.iv)(DA.ingredientTableSubHeader))},"Target Amount:"),d.createElement("div",{className:"u-vertical-center-items"},e.isLoading?d.createElement(kl.Z,null):d.createElement(d.Fragment,null,d.createElement(AmountInput,{className:f()((0,g.iv)(DA.mixtureTargetAmountInput),"u-small-spacing-right"),onChangeAmount:setDraftMixtureAmount,currentAmount:e.draftState.data.mixtureAmount,disabled:!e.draftState.isEditing,onKeyDown:e.onKeyDown}),renderPrepUnits(e.draftState)))):d.createElement("div",{className:f()("u-spacing-top",(0,g.iv)(DA.recipeUnitsHeader))},d.createElement("span",{className:f()("u-small-spacing-right",(0,g.iv)(DA.ingredientTableSubHeader))},"Ingredients Specified:"),e.isLoading?d.createElement(kl.Z,null):d.createElement(UnitsSelector,{validUnits:bA.JT,currentUnits:e.draftState.data.mixtureUnits,getUnitDisplayText:e=>`per ${e}`,onSelectUnits:setDraftMixtureUnits,disabled:!e.draftState.isEditing}))}const DA=g.mM.create({mixtureTargetAmountInput:{width:"40%"},recipeUnitsHeader:{display:"flex",alignItems:"center"},ingredientTableSubHeader:{..._n.Iv,fontWeight:_n.hS},textInput:{display:"flex"}})
function IngredientTableTitle({tagSchemaName:e,mixtureSchemaConfig:t}){const n={component:d.createElement(d.Fragment,null,d.createElement("div",null,d.createElement("b",null,"Component")),d.createElement("div",null,"Link to any entity representing an ingredient.")),catalogIdentifier:d.createElement(d.Fragment,null,d.createElement("div",null,d.createElement("b",null,"Catalog #")),d.createElement("div",null,"Identifier for the component entity, such as manufacturer ID.")),units:d.createElement(d.Fragment,null,d.createElement("div",null,d.createElement("b",null,"Ingredient Units")),d.createElement("div",null,"Units that will be used to measure an ingredient.")),notes:d.createElement(d.Fragment,null,d.createElement("div",null,d.createElement("b",null,"Notes")),d.createElement("div",null,"Any additional comments or notes about the ingredient."))}
return d.createElement(d.Fragment,null,`${e} Ingredients `,d.createElement(zp.Z,{renderContent:()=>d.createElement(d.Fragment,null,t.allowMeasuredIngredients?function getPrepHelp(e){return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Target Amount")),d.createElement("div",null,"The total quantity of the mixture you intend to create.")),d.createElement("div",{className:"u-small-spacing-bottom"},n.component),d.createElement("div",{className:"u-small-spacing-bottom"},n.catalogIdentifier),d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Target Amount ",d.createElement(AA.Z,{className:"u-faded u-normal-font-weight u-no-text-transform"}))),d.createElement("div",null,"The scaled quantity for an inherited ingredient, based on the mixture's target amount. This is blank if the ingredient is not inherited.")),d.createElement("div",{className:"u-small-spacing-bottom"},n.units),d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Measured Amount")),d.createElement("div",null,"Record the actual quantity of an ingredient measured when preparing the mixture.")),e.componentLotTextEnabled&&d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Lot Text")),d.createElement("div",null,"Identifier for the specific material used in this preparation.")),e.componentLotStorageEnabled&&d.createElement(d.Fragment,null,d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Lot Container")),d.createElement("div",null,"Holds the specific entity used in this preparation.")),d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Lot Entity")),d.createElement("div",null,"The specific entity used in this preparation."))),d.createElement("div",null,n.notes))}(t):function getRecipeHelp(){return d.createElement(d.Fragment,null,d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Ingredients specified")),d.createElement("div",null,"Set ingredients to be per ",bA.JT.slice(0,-1).join(", "),", or"," ",bA.JT.slice(-1)[0],". This is reflected in the ingredient units.")),d.createElement("div",{className:"u-small-spacing-bottom"},n.component),d.createElement("div",{className:"u-small-spacing-bottom"},n.catalogIdentifier),d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,d.createElement("b",null,"Target Amount")),d.createElement("div",null,"Quantity of ingredient a scientist should aim to measure out.")),d.createElement("div",{className:"u-small-spacing-bottom"},n.units),d.createElement("div",null,n.notes))}())}))}function IngredientTableColumnHeader(e){return d.createElement("div",{className:f()((0,g.iv)(LA.ingredientTableHeaderCell),"simpleDivTable-headerCell")},d.createElement(so.As,{className:(0,g.iv)(LA.ingredientTableColumnHeader)},e.children))}function PresentationalIngredientTable(e){var t
const n=Boolean(null===(t=e.tagSchema.mixtureSchemaConfig)||void 0===t?void 0:t.allowMeasuredIngredients),handleKeyDown=t=>{if(!e.isLoading)if(pn.isEnterKey(t)){t.preventDefault()
e.onCompleteEdit()}else if(pn.isEscapeKey(t)){t.preventDefault()
e.draftState.stopEditing()}},hasValueForComponentLot=(t,n)=>Boolean(!e.isLoading&&e.draftState.data.ingredients[t].componentLotValues[n])
return d.createElement("div",{className:"metadata-table simpleDivTable",...(0,ee.Z)({component:"PresentationalIngredientTable",element:"root"})},d.createElement(CA.Z,{isEditable:!e.isLoading&&e.areIngredientsEditable,isEditing:!e.isLoading&&e.draftState.isEditing,title:d.createElement(IngredientTableTitle,{tagSchemaName:e.tagSchema.name,mixtureSchemaConfig:e.tagSchema.mixtureSchemaConfig}),headerContent:d.createElement(IngredientTableSubheader,{...e,allowMeasuredIngredients:n,onKeyDown:handleKeyDown}),onEdit:e.isLoading?Jt.ZT:e.draftState.startEditing,handleCancelEdit:e.isLoading?Jt.ZT:e.draftState.stopEditing,handleCompleteEdit:e.isLoading?Jt.ZT:e.onCompleteEdit}),d.createElement("div",{className:`${(0,g.iv)(LA.scroll)}`},d.createElement("div",{className:`${(0,g.iv)(LA.maxContent)}`},d.createElement(vA.Z,{isLoading:e.isLoading,items:e.isLoading?[]:e.draftState.data.ingredients,isEmpty:e.isLoading||0===e.draftState.data.ingredients.length,columnDefinitions:(()=>{var t,a
const i={columnHeader:"Component",columnWidth:vA.a.LARGE,mapItemToColumnContent:(t,n)=>{return a=n,i=t.componentBioentity,s=t.isInherited,e.isLoading||!e.draftState.isEditing||s?d.createElement(Fa.default,{id:i.id,size:Za.TK.SMALL}):d.createElement(cw.m,{autoFocus:!1,chipSize:Za.TK.SMALL,onChange:t=>{let n=null
if(t.length>0){const e=t[0].id
n={id:e,__typename:(0,IA.bq)(e)}}e.onUpdateIngredient(a,{componentBioentity:n})},selectedItems:null==i?[]:[i],shouldAllowMultiple:!1,onKeyDown:handleKeyDown})
var a,i,s}},s={columnHeader:"Units",columnWidth:vA.a.DEFAULT,mapItemToColumnContent:(t,a)=>((t,a,i)=>{function ingredientUnitToDisplayText(t){return e.isLoading||n?t:`${t}/${e.draftState.data.mixtureUnits}`}return e.isLoading||!e.draftState.isEditing||i?d.createElement("span",null,ingredientUnitToDisplayText(a)):d.createElement(UnitsSelector,{validUnits:bA.T$,currentUnits:a,getUnitDisplayText:ingredientUnitToDisplayText,onSelectUnits:n=>{e.onUpdateIngredient(t,{units:n})},disabled:!e.draftState.isEditing})})(a,t.units,t.isInherited)},r={columnHeader:"Catalog #",mapItemToColumnContent:(t,n)=>{return a=n,i=t.componentBioentity,s=t.catalogIdentifier,r=t.isCatalogIdentifierInherited,e.isLoading||!e.draftState.isEditing||r?d.createElement("span",null,s):d.createElement(CatalogIdentifierInput,{componentBioentity:i,onChange:t=>{e.onUpdateIngredient(a,{catalogIdentifier:t.target.value})},value:s,onKeyDown:handleKeyDown})
var a,i,s,r}},o={columnHeader:"Lot Text",mapItemToColumnContent:(t,n)=>{return a=n,i=t.componentLotValues,!e.isLoading&&e.draftState.isEditing?d.createElement(or.Z,{className:(0,g.iv)(LA.textInput),size:Mo.$u.SMALL,value:i.text||"",onChange:t=>{e.onUpdateIngredient(a,{componentLotValues:{...i,text:t.target.value}})},onKeyDown:handleKeyDown,disabled:!e.draftState.isEditing}):d.createElement("span",null,i.text)
var a,i}},l={columnHeader:"Lot Entity",columnWidth:vA.a.LARGE,mapItemToColumnContent:(t,n)=>((t,n)=>{if(!e.isLoading&&e.draftState.isEditing){const a=hasValueForComponentLot(t,"container")
return d.createElement(cw.m,{autoFocus:!1,chipSize:Za.TK.SMALL,onChange:a=>{let i=null
if(a.length>0){const e=a[0].id
i={id:e,__typename:(0,IA.bq)(e)}}e.onUpdateIngredient(t,{componentLotValues:{...n,bioentity:i}})},selectedItems:null==n.bioentity?[]:[n.bioentity],shouldAllowMultiple:!1,onKeyDown:handleKeyDown,disabled:a,isReadOnly:a})}return n.bioentity?d.createElement(Fa.default,{id:n.bioentity.id,size:Za.TK.SMALL}):""})(n,t.componentLotValues)},c={columnHeader:"Lot Container",columnWidth:vA.a.LARGE,mapItemToColumnContent:(t,n)=>((t,n)=>{if(!e.isLoading&&e.draftState.isEditing){const a=!hasValueForComponentLot(t,"container")&&hasValueForComponentLot(t,"bioentity")
return d.createElement(wA.H,{autoFocus:!1,chipSize:Za.TK.SMALL,onChange:a=>{let i=null
a.length>0&&(i={id:a[0].id,__typename:"ContainerNode"})
e.onUpdateIngredient(t,{componentLotValues:{...n,container:i}})},selectedItems:null==n.container?[]:[n.container],shouldAllowMultiple:!1,storableTypes:[st.CONTAINER],onKeyDown:handleKeyDown,disabled:a,isReadOnly:a})}return n.container?d.createElement(NA.Z,{id:n.container.id,size:Za.TK.SMALL}):""})(n,t.componentLotValues)},u={columnHeader:n?"Measured Amount":"Target Amount",mapItemToColumnContent:(t,n)=>((t,n)=>{const a=n||""
return!e.isLoading&&e.draftState.isEditing?d.createElement(AmountInput,{currentAmount:n,onChangeAmount:n=>{e.onUpdateIngredient(t,{amount:n})},onKeyDown:handleKeyDown,disabled:!e.draftState.isEditing}):d.createElement("span",null,a)})(n,t.amount)},m={columnHeader:d.createElement("div",null,"Target Amount ",n&&d.createElement(AA.Z,{className:"u-faded u-normal-font-weight u-no-text-transform"})),mapItemToColumnContent:(e,t)=>{return n=e.inheritedTargetAmount,d.createElement("span",null,n)
var n}},p={columnHeader:"Notes",columnWidth:vA.a.LARGE,mapItemToColumnContent:(t,n)=>{return a=n,i=t.notes,!e.isLoading&&e.draftState.isEditing?d.createElement(or.Z,{className:(0,g.iv)(LA.textInput),size:Mo.$u.MEDIUM,value:i||"",onChange:t=>{e.onUpdateIngredient(a,{notes:t.target.value})},onKeyDown:handleKeyDown,disabled:!e.draftState.isEditing}):d.createElement("span",null,i)
var a,i}}
return(n?[i,r,m,s,u,...(null===(t=e.tagSchema.mixtureSchemaConfig)||void 0===t?void 0:t.componentLotTextEnabled)?[o]:[],...(null===(a=e.tagSchema.mixtureSchemaConfig)||void 0===a?void 0:a.componentLotStorageEnabled)?[c,l]:[],p]:[i,r,u,s,p]).map((({columnHeader:t,mapItemToColumnContent:n,...a},i)=>({columnHeader:d.createElement(IngredientTableColumnHeader,null,d.createElement("div",null,t,e.areIngredientsEditable&&0===i&&d.createElement(vy.Z,{disabled:e.isLoading,onClick:e.isLoading?void 0:e.onAddIngredient}))),mapItemToColumnContent:(e,t)=>function formattedTableColumnContent(e){return d.createElement("div",{className:f()("simpleDivTable-cell")},e)}(n(e,t)),...a})))})(),emptyMessage:"This mixture has no ingredients.",isEditing:!e.isLoading&&e.draftState.isEditing,canRemoveRows:e.areIngredientsEditable,handleRemoveRow:e.isLoading?Jt.ZT:e.onDeleteIngredient,isRoomy:!0,confirmDeleteModalBody:d.createElement(d.Fragment,null,"Are you sure you want to delete this ingredient? This action is irreversible.")}))))}const LA=g.mM.create({ingredientTableColumnHeader:{height:"32px",display:"table-cell",verticalAlign:"bottom"},ingredientTableHeaderCell:{paddingBottom:"4px",paddingRight:"4px"},textInput:{display:"flex"},scroll:{overflow:"auto"},maxContent:{minWidth:"max-content"}})
function validateNonEmptyIngredients(e,t){try{e.forEach((e=>{var n
!function validateIngredientAmount(e){if(null!=e&&""!==e&&!(0,TA.mG)(e)&&!(0,Jt.r)(e))throw new MixtureValidationError('Ingredient amount must be a positive number or the string "QS"')}(e.amount)
!function validateIngredientComponentBioentity(e,t){(0,S.Gp)(ea.ZP.isMixture(t),"Mixture ID should be valid")
if(null==e)throw new MixtureValidationError("Ingredients must specify a component entity")
if(e===t)throw new MixtureValidationError("Ingredients cannot specify their own mixture as the component entity")}(null===(n=e.componentBioentity)||void 0===n?void 0:n.id,t)
!function validateIngredientUnits(e){if(!Object.values(Sn.lU).includes(e))throw new MixtureValidationError(`Ingredient units must be one of: ${bA.T$.join(", ")}`)}(e.units)}))
!function validateMixtureComponentBioentitiesAreUnique(e){if(new Set(e).size<e.length)throw new MixtureValidationError("Ingredients within a mixture cannot specify the same component entity")}(e.map((({componentBioentity:e})=>null==e?void 0:e.id)).filter((e=>null!=e)))
!function validateMixtureAtMostOneQS(e){if(e.filter((e=>null!=e&&(0,TA.mG)(e))).length>1)throw new MixtureValidationError('At most one ingredient can have amount "QS"')}(e.map((({amount:e})=>e)))}catch(e){if(e instanceof MixtureValidationError){v.ZP.error(e.message)
return!1}throw e}return!0}async function validateAndPersistMixtureChanges(e,t,n,a,i){try{!function validateMixtureAmount(e){if(null==e||!(0,Jt.r)(e))throw new MixtureValidationError("Mixture amount must be a positive number")}(n)
!function validateMixtureUnits(e){const t=Object.values(bA.JT)
if(!t.includes(e))throw new MixtureValidationError(`Mixture units must be one of: ${t.join(", ")}`)}(a)}catch(e){if(e instanceof MixtureValidationError){v.ZP.error(e.message)
return!1}throw e}const s=function filterToNonEmptyIngredients(e){return e.filter((({componentBioentity:e,amount:t,catalogIdentifier:n,componentLotValues:a})=>e||t||n||a.text))}(i)
if(!validateNonEmptyIngredients(s,e))return!1
const r=await async function updateWithDataMods(e,t,n){let a=null
await(0,fA.GE)({changeSummary:t?(0,yA.P_)({apiIds:[e],action:yA.wV.MODIFY}):"",onRequestClose:()=>{},onRequestSubmit:async()=>{a=await MixtureActions_update(e,n)}},dt.ZP.REGISTRY_ENABLE_DATA_MOD_REASONS&&t,{module:"REGISTRY",actionOrigin:"inventory_registry_search_ui",modifiedAction:yA.wV.MODIFY,numModifiedTotalItems:1,entryId:null})
return a}(e,t,{amount:n,units:a,ingredients:s.map((e=>(0,bA.xK)(e)))})
return null!=r}const kA=xa.Ps`
  query IngredientTableQuery($mixtureId: StrictString!) @skipAudit @engComponent(name: REGISTRY) {
    mixture(id: $mixtureId) {
      ...MixtureSpecificAttributesGraphQL
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("MixtureSpecificAttributes").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,MA=xa.Ps`
  query BioentityTagsQuery($bioentityId: StrictString!) @skipAudit @engComponent(name: REGISTRY) {
    bioentity(id: $bioentityId) {
      ... on FolderItemInterface {
        id
        tagsJson
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,FA=Sn.lU.mL
function IngredientTable(e){const t=(0,hA.Z)({mixtureUnits:e.initialMixtureUnits,mixtureAmount:e.initialMixtureAmount,ingredients:e.initialIngredients}),{data:n,updateDraftData:a,isEditing:i,startEditing:s,stopEditing:r}=t,{mixtureUnits:o,mixtureAmount:l,ingredients:c}=n,setDraftIngredients=e=>{a({ingredients:e})},{refetchMixtureData:u,parentLinkFileId:m,tagSchema:p}=e;(0,gA.Z)((()=>{u()}),[m,p.id])
return d.createElement(PresentationalIngredientTable,{...e,isLoading:!1,draftState:t,onAddIngredient:()=>{s()
setDraftIngredients([...c,{__typename:"IngredientNode",id:null,componentBioentity:null,catalogIdentifier:null,componentLotValues:{__typename:"ComponentLotValuesNode",text:null,bioentity:null,container:null},amount:null,units:FA,isInherited:!1,inheritedTargetAmount:null,notes:null,isCatalogIdentifierInherited:!1}])},onUpdateIngredient:(e,t)=>{setDraftIngredients([...c.slice(0,e),{...c[e],...t},...c.slice(e+1)])},onDeleteIngredient:async t=>{const n=[...c.slice(0,t),...c.slice(t+1)]
i?setDraftIngredients(n):await validateAndPersistMixtureChanges(e.mixtureId,e.isRegistered,l,o,n)},onCompleteEdit:async()=>{await validateAndPersistMixtureChanges(e.mixtureId,e.isRegistered,l,o,c)&&r()}})}function QueryingIngredientTable(e){return d.createElement(Da.ZP,{query:kA,variables:{mixtureId:e.mixtureId},renderLoading:()=>d.createElement(PresentationalIngredientTable,{...e,isLoading:!0}),renderCachedDataWhenRefetching:!0},((t,{refetch:n})=>{if((0,ka.CZ)(t.mixture)){Fe.ZK(`Expected mixture to be accessible: ${e.mixtureId}`)
return null}{const a=t.mixture
return d.createElement(IngredientTable,{...e,initialMixtureAmount:a.amount,initialMixtureUnits:a.units,initialIngredients:a.ingredients,refetchMixtureData:n})}}))}var ZA=n(785249),BA=n(459561),qA=n(909410),VA=n(344984)
class GeneralNoteViewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ZA.Z]}enhanceProps(){return ZA.Z.inStore(this.props.fileId)?this.noteStore().getEditorState(this.props.fileId):null}}class UnconnectedGeneralNoteView extends d.Component{componentDidUpdate(e){ZA.Z.inStore(this.props.fileId)||Fe.ZK("NoteView was re-rendered though note is not present in the NoteStore")
if(this.props.saving!==e.saving||this.props.openVersion!==e.openVersion||this.props.savedVersion!==e.savedVersion||this.props.saveSuccess!==e.saveSuccess)if(this.props.saving||this.props.openVersion!==this.props.savedVersion){const e=this.props.saveSuccess?"Saving...":"Retrying save..."
this.props.updateStatusBar&&this.props.updateStatusBar(e)}else this.props.clearStatusBar&&this.props.clearStatusBar()}restoreStateAndSelection({note:e},t){EA.Z.replace(this.props.fileId,e,t)}printHandler(e){EA.Z.print(this.props.fileId,e)}registerObjects(e){EA.Z.registerObjects(this.props.fileId,e)}getIdFromCid(e){return ZA.Z.getIdFromCid(this.props.fileId,e)}updateNote(e){EA.Z.update(this.props.fileId,{$set:e})}render(){return null==this.props.note?d.createElement("div",null,"Loading..."):d.createElement(VA.WP,{...l.default.defaults({getIdFromCid:e=>this.getIdFromCid(e),printHandler:e=>{this.printHandler(e)},note:this.props.note,registerObjects:e=>{this.registerObjects(e)},updateNote:e=>{this.updateNote(e)},isLatest:this.props.isLatest,locked:!this.props.isLatest||!this.props.allowEdits,lockedFromExternalChange:this.props.lockedFromExternalChange,restoreStateAndSelection:(e,t)=>{this.restoreStateAndSelection(e,t)},historyManager:this.props.historyManager,printOptions:this.props.minimalToolbar?[]:[qA.dF.NOTE]},this.props)})}}UnconnectedGeneralNoteView.propTypes={banner:K.string,fileId:K.string.isRequired,updateStatusBar:K.func,clearStatusBar:K.func,allowEdits:K.bool.isRequired,preview:K.shape({followLink:K.bool.isRequired,showOpenLink:K.bool.isRequired}),lockedFromExternalChange:K.bool.isRequired}
const UA=GeneralNoteViewConnector.connect(UnconnectedGeneralNoteView),GA=xa.Ps`
  query MixtureInstructionsQuery($mixtureId: StrictString!) @skipAudit @engComponent(name: REGISTRY) {
    mixture(id: $mixtureId) {
      ... on MixtureNode {
        ...MixtureWithInstructionsGraphQL
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("MixtureWithInstructions").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function MixtureInstructions(e){const{instructions:t}=e;(0,d.useEffect)((()=>{null==t||ZA.Z.inStore(t.id)||EA.Z.load(t.id,(0,SA.Z)(t.noteJson))}),[t])
return d.createElement("div",{className:f()("metadata-table simpleDivTable",(0,g.iv)(zA.instructionsBottomMargin))},d.createElement(CA.Z,{isEditable:!1,title:`${e.tagSchema.name} Instructions`,headerContent:null,customButton:e.isLoading||null!=t?null:d.createElement(P.ZP,{title:"Create instructions for this mixture"},d.createElement(C.Co,{className:(0,g.iv)(zA.insertButton),buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:()=>{MixtureActions_initializeInstructions(e.mixtureId)},size:C.qE.MINI,text:"Insert",...(0,ee.Z)({component:"MixtureInstructions",element:"insertButton"})}))}),e.isLoading&&d.createElement("div",{className:(0,g.iv)(zA.loadingThrobber)},d.createElement(kl.Z,null)),null!=t&&ZA.Z.inStore(t.id)&&d.createElement(BA.k.Provider,{value:{}},d.createElement(BA.q.Provider,{value:{showFormulas:!1,fileId:t.id}},d.createElement(UA,{...e.instructionsEditorProps,fileId:t.id}))))}function QueryingMixtureInstructions(e){return d.createElement(Da.ZP,{query:GA,variables:{mixtureId:e.mixtureId},renderLoading:()=>d.createElement(MixtureInstructions,{isLoading:!0,...e})},(t=>{if((0,ka.CZ)(t.mixture)){Fe.ZK(`Expected mixture to be accessible: ${e.mixtureId}`)
return null}return d.createElement(MixtureInstructions,{...e,instructions:t.mixture.instructions})}))}const zA=g.mM.create({instructionsBottomMargin:{marginBottom:"15px"},loadingThrobber:{marginTop:"10px",marginBottom:"10px",marginLeft:"15px",marginRight:"15px"},insertButton:{marginBottom:"10px"}})
var $A=n(298991),WA=n(305595),HA=n(85386),jA=n(305487)
class ValidationStateFetcherConnector extends oi.C{constructor(){super(...arguments)
this.stores=[jA.Z]
this.shouldSubscribeToRedux=!1}enhanceProps(){const e=this.workspaceStore().getState().workspaceItems.slice(0,this.workspaceStore().getMaxOverheadTabs()).filter((e=>ea.ZP.isBiologicalEntity(e.fileId)))
return{visibleBioentityIds:l.default.pluck(e,"fileId")}}}class ValidationStateFetcher extends d.PureComponent{componentDidMount(){this._fetch()}componentDidUpdate(e){Is()(e.proteinResidues,this.props.proteinResidues)&&Is()(e.sequenceBases,this.props.sequenceBases)&&Is()(e.sequenceCircular,this.props.sequenceCircular)&&Is()(e.sequenceModifiedNucleotides,this.props.sequenceModifiedNucleotides)&&Is()(e.sequenceParts,this.props.sequenceParts)&&Is()(e.sequenceTranslations,this.props.sequenceTranslations)&&Is()(e.tags,this.props.tags)&&Is()(e.registryId,this.props.registryId)||this._fetch()}_fetch(){qN.ky(this.props.visibleBioentityIds)}render(){return null}}const YA=ValidationStateFetcherConnector.connect(ValidationStateFetcher)
var QA=n(802021),KA=n(85722),JA=n(280034),XA=n(102385)
class ComputedTagFetcherConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[jA.Z]}enhanceProps(){return{activeWorkspaceId:this.workspaceStore().getState().activeId}}}class ComputedTagFetcher extends d.Component{componentDidMount(){this._fetchTags()}componentDidUpdate(e){this.props.fileId===this.props.activeWorkspaceId&&(Is()(e.proteinAminoAcids,this.props.proteinAminoAcids)&&Is()(e.sequenceBases,this.props.sequenceBases)&&Is()(e.sequenceModifiedNucleotides,this.props.sequenceModifiedNucleotides)&&Is()(e.tags,this.props.tags)||this._fetchTags())}_fetchTags(){XA.Z.hasEnterprisePlan()&&qN.NJ(this.props.fileId)}render(){return null}}const eR=ComputedTagFetcherConnector.connect(ComputedTagFetcher)
var tR,nR=n(648491),aR=n(730216)
!function(e){e.ASSIGNEE="assignee"
e.WATCHERS="watchers"}(tR||(tR={}))
const iR=tR.ASSIGNEE
var sR
!function(e){e.V1="v1"}(sR||(sR={}))
const rR={itemType:{name:Hd.i0.TEXT,selectorId:null},type:nR.p.CONSTANT_VALUE,value:iR},oR={name:"SET_TIME_ON_DATETIME_V1",parameters:[{expression:{contextKey:"scheduled_on_date",itemType:{name:Hd.i0.DATE},type:nR.p.CONTEXT_VARIABLE},name:"datetime"},{expression:{contextKey:"timezone",itemType:{name:Hd.i0.TEXT},type:nR.p.CONTEXT_VARIABLE},name:"timezone"},{expression:{itemType:{name:Hd.i0.INTEGER},type:nR.p.CONSTANT_VALUE,value:0},name:"second"},{expression:{itemType:{name:Hd.i0.INTEGER},type:nR.p.CONSTANT_VALUE,value:0},name:"minute"},{expression:{itemType:{name:Hd.i0.INTEGER},type:nR.p.CONSTANT_VALUE,value:0},name:"hour"}],type:nR.p.FUNCTION},lR={name:"CALCULATE_DATETIME_V1",parameters:[{expression:oR,name:"datetime"},{expression:{itemType:{name:Hd.i0.BOOLEAN,selectorId:null},type:nR.p.CONSTANT_VALUE,value:!0},name:"subtract_from_datetime"},{expression:{itemType:{name:Hd.i0.INTEGER},type:nR.p.CONSTANT_VALUE,value:0},name:"seconds"},{expression:{itemType:{name:Hd.i0.INTEGER},type:nR.p.CONSTANT_VALUE,value:0},name:"minutes"},{expression:{itemType:{name:Hd.i0.INTEGER},type:nR.p.CONSTANT_VALUE,value:0},name:"hours"},{expression:{itemType:{name:Hd.i0.INTEGER,selectorId:null},type:nR.p.CONSTANT_VALUE,value:1},name:"days"}],type:nR.p.FUNCTION}
function _getParamFromName(e,t){return e.parameters.find((e=>e.name===t))}function setParamValueFromName(e,t,n){var a;(null===(a=_getParamFromName(e,t))||void 0===a?void 0:a.expression).value=n}function createNewRecipientExpr(e){const t=(0,aR.Z)(rR)
t.value=e
return t}function createNewDeliveryDateExpr(e,t,n){const a=(0,aR.Z)(lR)
setParamValueFromName(a,"days",e)
setParamValueFromName(a,"subtract_from_datetime",t)
!function setExpressionFromName(e,t,n){_getParamFromName(e,t).expression=n}(a,"datetime",n)
return a}function currentEvaluatorVersion(){return sR.V1}const cR={[tR.ASSIGNEE]:"Assignee",[tR.WATCHERS]:"Watchers"}
var dR
!function(e){e.BEFORE="Before"
e.AFTER="After"}(dR||(dR={}))
const uR={[dR.BEFORE]:"Before Due",[dR.AFTER]:"After Due"}
function createNewDeliveryDateExprFromUI(e,t,n){const a=t===dR.BEFORE,{second:i,minute:s,hour:r}=n,o=function createNewSetTimeOnDatetimeExpr(e,t,n){const a=(0,aR.Z)(oR)
setParamValueFromName(a,"second",e)
setParamValueFromName(a,"minute",t)
setParamValueFromName(a,"hour",n)
return a}(i,s,r)
return createNewDeliveryDateExpr(e,a,o)}function getNotificationScheduleAttributes(e){return{recipient:function getRecipientFromExprV1(e){return e.value}(e.recipientExpr),days:function getDaysFromExprV1(e){const t=_getParamFromName(e,"days")
return(null==t?void 0:t.expression).value}(e.deliveryDateExpr),deliveryDirection:function getSubtractFromDatetimeFromExprV1(e){const t=_getParamFromName(e,"subtract_from_datetime")
return(null==t?void 0:t.expression).value}(e.deliveryDateExpr)?dR.BEFORE:dR.AFTER}}function NotificationScheduleEditorRow(e){const{recipient:t,days:n,deliveryDirection:a}=getNotificationScheduleAttributes(e.notificationSchedule),i=[tR.ASSIGNEE],onUpdateRecipient=t=>{const n={recipientExpr:createNewRecipientExpr(t),deliveryDateExpr:(0,aR.Z)(e.notificationSchedule.deliveryDateExpr),evaluatorVersion:currentEvaluatorVersion()}
e.onUpdate(n)},onUpdateDeliveryDirection=t=>{const a=createNewDeliveryDateExprFromUI(n,t,e.defaultDeliveryTime),i={recipientExpr:(0,aR.Z)(e.notificationSchedule.recipientExpr),deliveryDateExpr:a,evaluatorVersion:currentEvaluatorVersion()}
e.onUpdate(i)}
return d.createElement("div",{className:(0,g.iv)(mR.formGrow)},d.createElement(h.Z,null,d.createElement(p.Z,{sm:4,style:{paddingLeft:"20px"}},d.createElement(Je.Z,{style:{paddingLeft:"0px"}},"Recipient"),d.createElement($r.ZP,{alwaysDropDown:!0,displayName:cR[t],disabled:e.readOnly,menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},i.map((e=>d.createElement(N.Z,{key:e,onSelect:onUpdateRecipient,value:e},cR[e]))))})),d.createElement(p.Z,{sm:4,style:{paddingLeft:"20px"}},d.createElement(Je.Z,{style:{paddingLeft:"0px"}},"Notify"),d.createElement(AT.Z,{value:n,onChange:t=>{const n=createNewDeliveryDateExprFromUI(t.target.numericValue,a,e.defaultDeliveryTime),i={recipientExpr:(0,aR.Z)(e.notificationSchedule.recipientExpr),deliveryDateExpr:n,evaluatorVersion:currentEvaluatorVersion()}
e.onUpdate(i)},isDisabled:e.readOnly,min:0,max:365,validateInteger:!0})),d.createElement(p.Z,{sm:4,style:{paddingLeft:"20px"}},d.createElement(Je.Z,{style:{paddingLeft:"0px"}},"Before/After"),d.createElement($r.ZP,{alwaysDropDown:!0,displayName:uR[a],disabled:e.readOnly,menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},Object.values(dR).map((e=>d.createElement(N.Z,{key:e,onSelect:onUpdateDeliveryDirection,value:e},uR[e]))))}))))}const mR=g.mM.create({formGrow:{flex:"auto"}})
function NotificationScheduleEditor(e){var t
const n=null!==(t=e.readonly)&&void 0!==t&&t
return d.createElement("div",null,e.notificationSchedules.map(((t,a)=>d.createElement("div",{className:(0,g.iv)(pR.background),key:gt.Z()},d.createElement(NotificationScheduleEditorRow,{notificationSchedule:t,defaultDeliveryTime:e.defaultDeliveryTime,onUpdate:t=>{((t,n)=>{const a=e.notificationSchedules.map(((e,a)=>a===n?t:e))
e.onUpdate(a)})(t,a)},readOnly:n}),!n&&d.createElement("div",{className:(0,g.iv)(pR.removeButton),"data-test-key":"removeButton",onClick:()=>{(t=>{const n=e.notificationSchedules.map((e=>e))
n.splice(t,1)
e.onUpdate(n)})(a)}},d.createElement(pe.Z,{icon:"delete",altText:"Delete"}))))),!n&&d.createElement(C.Co,{className:(0,g.iv)(pR.addButton),buttonStyle:C.ZJ.TEXT,size:C.qE.MEDIUM,icon:"compose",text:"Add Schedule",onClick:()=>{const t=e.notificationSchedules.map((e=>e)),n=createNewRecipientExpr(e.defaultRecipient),{days:a,direction:i}=e.defaultDeliveryDate,s={recipientExpr:n,deliveryDateExpr:createNewDeliveryDateExprFromUI(a,i,e.defaultDeliveryTime),evaluatorVersion:currentEvaluatorVersion()}
t.push(s)
e.onUpdate(t)},"data-test-key":"addScheduleButton"}))}const pR=g.mM.create({background:{backgroundColor:Vt.bs,borderRadius:"4px",marginBottom:"12px",padding:"6px",position:"relative",display:"flex",alignItems:"center"},addButton:{marginBottom:"10px"},removeButton:{cursor:"pointer",color:Vt.pF,":hover":{color:Vt.pp},padding:"16px"}})
var hR=n(630442),gR=n(128716),ER=n(10708)
function EditableNotifications({studyId:e,existingNotificationSchedules:t,isWritable:n}){const[a,i]=(0,d.useState)(!1),[s,r]=(0,d.useState)(t),o={days:1,direction:dR.BEFORE},l=tR.ASSIGNEE,c=(0,d.useRef)(s)
return d.createElement("div",null,d.createElement(CA.Z,{isEditable:n,isEditing:a,title:"Notification schedules",headerContent:0===s.length?d.createElement("div",{style:{color:gR.DM.GRAYS[4]}},"This study does not have any notification schedules configured."):null,onEdit:()=>{c.current=s
i(!0)},handleCancelEdit:()=>{i(!1)
r(c.current)},handleCompleteEdit:async()=>{await async function updateNotifications(e,t){await(0,hR.Ss)(e,{schedules:t})}(e,s)
i(!1)}}),d.createElement(NotificationScheduleEditor,{notificationSchedules:s,defaultDeliveryTime:{second:0,minute:0,hour:0},defaultDeliveryDate:o,defaultRecipient:l,onUpdate:e=>{r(e)},readonly:!a}))}const fR=xa.Ps`
  query StudyNotificationSchedulesQuery($studyId: StrictString!) @skipAudit @engComponent(name: STUDIES) {
    study(id: $studyId) {
      ... on StudyNode {
        id
        notificationSchedules {
          deliveryDateExpr
          recipientExpr
          evaluatorVersion: scheduleEvalVersion
        }
      }
    }
  }
`
const SR=function QueryingEditableNotifications({studyId:e,isWritable:t}){const n=(0,Da.A4)(fR,{variables:{studyId:e},fetchPolicy:"cache-and-network",skip:!dt.ZP.STUDIES_ENABLE_NOTIFICATIONS})
if(n.type===Da.NI.SKIPPED)return null
if(n.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(n.type===Da.NI.ERROR)return d.createElement(ER.Z,{error:"Failed to load notification schedule"})
if((0,ka.CZ)(n.data.study))return d.createElement("div",null,"You do not have permission to view this item.")
const a=n.data.study.notificationSchedules.map((e=>({recipientExpr:e.recipientExpr,deliveryDateExpr:e.deliveryDateExpr,evaluatorVersion:sR.V1})))
return d.createElement(EditableNotifications,{studyId:e,existingNotificationSchedules:a,isWritable:t})},yR=xa.Ps`
  query StudySchemaTagTableQuery($id: StrictString!) @skipAudit @engComponent(name: STUDIES) {
    study(id: $id) {
      ... on StudyNode {
        id
        tags: tagsJson
        name
        studySchema {
          id
          name
        }
        permissions {
          writable
        }
      }
      ... on InaccessibleInfoNode {
        invalidId
        canRequestAccess
      }
    }
  }
`
function StudySchemaTagTable({studyId:e}){return d.createElement(Da.ZP,{query:yR,variables:{id:e},renderLoading:()=>d.createElement(kl.b,null),fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0},(({study:e},{refetch:t})=>(0,ka.CZ)(e)?null:d.createElement(EC,{title:"Schema",subheaderNode:d.createElement(CA.G,{text:e.studySchema.name}),emptyMessage:"This study has no fields.",fileId:e.id,initialTags:e.tags,areTagsEditable:e.permissions.writable,showRequiredFieldErrors:!0,updateTags:async(n,a)=>{var i
try{await hR.m9(e.id,{tags:n.toSet})
const{data:a}=await t();(0,S.hu)(!(0,ka.CZ)(a.study),"Expected study to be accessible")
v.ZP.success("Fields were updated successfully.")
return[{id:e.id,tags:a.study.tags}]}catch(e){null===(i=null==a?void 0:a.onFailure)||void 0===i||i.call(a)
throw e}}})))}var bR,TR=n(351702)
!function(e){e[e.notCreating=0]="notCreating"
e[e.editing=1]="editing"
e[e.inFlight=2]="inFlight"}(bR||(bR={}))
function AliasList(e){const[t,n]=(0,d.useState)(bR.notCreating)
function deleteAlias(t){qN.Ps(e.fileId,t)}return d.createElement("div",{className:"metadata-aliasList simpleDivTable"},d.createElement("div",{className:"simpleDivTable-header"},d.createElement("div",{className:"metadata-table-header"},"Aliases"),e.isWritable&&d.createElement(vy.Z,{onClick:()=>{n(bR.editing)}})),e.bioentityAliasInfos.map((t=>d.createElement(uC.Z,{className:"simpleDivTable-row",complete:async n=>{await async function updateAlias(t,n){await qN.ru(e.fileId,t,n,!1)}(t.alias,n)},key:t.alias,initialAlias:t.alias,isWritable:e.isWritable,remove:deleteAlias}))),t===bR.inFlight?d.createElement("div",{className:"simpleDivTable-row"},d.createElement(kl.Z,null)):t===bR.editing?d.createElement(uC.Z,{className:"simpleDivTable-row",cancel:()=>{n(bR.notCreating)},complete:async function createAlias(t){n(bR.inFlight)
try{await(0,TR.Z)(qN.Zt(e.fileId,t))}catch(e){}n(bR.notCreating)},initialIsBeingEdited:!0,isWritable:e.isWritable}):0===e.bioentityAliasInfos.length?d.createElement("div",{className:"simpleDivTable-row"},d.createElement("div",{className:"simpleDivTable-cell simpleDivTable-cell--emptyMessage"},"This entity has no aliases.")):null)}const vR=xa.ZP`
  query ConvertedToItemQuery($bioentityId: StrictString!) @skipAudit @engComponent(name: REGISTRY) {
    bioentity(id: $bioentityId) {
      ... on RegistryItemInterface {
        id
        convertedToItem {
          ... on RegistryItemInterface {
            id
          }
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ConvertedToItemField(e){return(0,ka.CZ)(e.bioentity)?d.createElement("div",null,"You do not have access to view the converted item. Please ask your administrator for access."):null!=e.bioentity.convertedToItem?d.createElement("div",{className:`${(0,g.iv)(CR.convertedToItem)} metadata-convertedToItem-header`},"Converted to: ",d.createElement(Fa.default,{id:e.bioentity.convertedToItem.id,size:Za.TK.SMALL})):null}function QueryingConvertedToItemField(e){const t=(0,Da.IJ)(vR,{variables:{bioentityId:e.fileId},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0})
return t.type===Da.NI.PENDING?null:t.type===Da.NI.SUCCESS?d.createElement(ConvertedToItemField,{bioentity:t.data.bioentity}):null}const CR=g.mM.create({convertedToItem:{paddingTop:"10px"}})
var IR=n(620080),wR=n(367780),NR=n(679726),AR=n(679374),RR=n(977043)
function ExportMoleculeModal(e){const[t,n]=(0,d.useState)(null)
return d.createElement(et.ZP,{enableRedesign:!0,title:"Export Molecule",onRequestClose:e.onRequestClose,medium:!0,buttons:[{text:"Download",submit:!0,style:"success",disabled:!t,onClick:()=>{Cn.e7("POST",RR.M7(e.editURL,t,{dl:!0}),{target:"_blank"})},dataTestAttrs:{component:"ExportMoleculeModal",element:"submit"}},{text:"Cancel",onClick:e.onRequestClose}]},d.createElement("div",{className:"form-group"},d.createElement($r.ZP,{displayName:null==t?"Choose Molecule Format...":Wv.iR[t],menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},Object.values(Wv.En).map((e=>({name:Wv.iR[e],handleOnClick:()=>{n(e)}}))).map((e=>d.createElement(N.Z,{key:e.name,onSelect:e.handleOnClick},e.name))))})))}const PR="FORMAT_GENBANK"
class ExportSequenceModal extends d.Component{constructor(){super(...arguments)
this.state={format:null,nocol:!0,restrictFeatType:!1}
this._getFormatItems=()=>[Object.keys(ExportSequenceModal.formatToText).map((e=>({name:ExportSequenceModal.formatToText[e],handleOnClick:()=>{this.setState({format:e})}})))]
this._getExportUrl=()=>{switch(this.state.format){case"FORMAT_FASTA":return RR.M7(this.props.editURL,"fasta",{dl:!0})
case"FORMAT_RDF":return RR.M7(this.props.editURL,"rdf",{dl:!0})
case PR:return RR.M7(this.props.editURL,"gb",{dl:!0,nocol:this.state.nocol,restrictFeatType:this.state.restrictFeatType})
default:throw new Error("Unrecognized download format.")}}
this._handleDownload=()=>{Cn.e7("POST",this._getExportUrl(),{target:"_blank"})}
this._getDisplayName=()=>this.state.format?ExportSequenceModal.formatToText[this.state.format]:"Choose sequence format..."}render(){return d.createElement(et.ZP,{enableRedesign:!0,title:"Export sequence",onRequestClose:this.props.onRequestClose,medium:!0,buttons:[{text:"Download",submit:!0,style:C.ZJ.PRIMARY,disabled:!this.state.format,onClick:this._handleDownload}]},d.createElement("div",{className:"form-group"},d.createElement(tc.Z,{displayName:this._getDisplayName(),items:this._getFormatItems()})),this.state.format===PR&&[d.createElement("div",{className:"checkbox",key:"no-col"},d.createElement("label",null,d.createElement("input",{type:"checkbox",checked:!this.state.nocol,onChange:e=>{this.setState({nocol:!this.state.nocol})}}),"Export feature colors")),d.createElement("div",{className:"checkbox",key:"feat-type"},d.createElement("label",null,d.createElement("input",{type:"checkbox",className:"u-small-spacing-right",checked:this.state.restrictFeatType,onChange:e=>{this.setState({restrictFeatType:!this.state.restrictFeatType})}}),"Convert non-standard annotation types"))])}}ExportSequenceModal.formatToText={FORMAT_GENBANK:"Genbank (.gb)",FORMAT_FASTA:"FASTA (.fasta)",FORMAT_RDF:"SBOL RDF (.rdf)"}
const OR=ExportSequenceModal
var xR=n(778095),_R=n(839810),DR=n(433444),LR=n(300707),kR=n(293651)
class MetadataEditorToolbar extends d.Component{constructor(){super(...arguments)
this.handleChangeCollection=()=>{(0,DR.c)({files:[{id:this.props.fileId,name:this.props.fileName}]})}
this.isRegistered=()=>null!=this.props.registryId
this.getPartialFeatureDefinition=e=>({item:{id:this.props.fileId,permissions:e},itemState:{isRegistered:this.isRegistered()}})
this.handleOpenForMove=e=>{const t=this.isRegistered()?this.props.projectFolder:this.props.folder,n=[{id:this.props.fileId}]
NR.Z.openForMove({allowNone:this.isRegistered()&&!dt.ZP.ENABLE_PROJECTS_REQUIRED_FOR_REGISTRY_FILES&&!e,initialSelectedFolderId:t?t.api_identifier:void 0,itemsToMove:n,showInventory:!0,showNotebook:!0,showRegistries:!1},(t=>{const n=[this.props.folder.api_identifier]
if(e){null!=this.props.projectFolder&&n.push(this.props.projectFolder.api_identifier)
_R.Z.unregisterWithDataMods([this.props.fileId],t,n)}else Rn.Z.moveItemsWithDataMods([this.props.fileId],t,{parentFolderIds:n,hasRegisteredItems:this.isRegistered()},(()=>this.isRegistered()))}))}
this.makeExempt=()=>{qN.Ti([this.props.fileId])}
this.renderMoreFileOptions=()=>{const e=[]
ea.ZP.isNucleotideSequence(this.props.fileId)&&e.push({name:"Export sequence",handleOnClick:()=>(0,Xn.Z)(OR,{editURL:this.props.sequenceEditURL})})
ea.ZP.isMolecule(this.props.fileId)&&e.push({name:"Export molecule",handleOnClick:()=>(0,Xn.Z)(ExportMoleculeModal,{editURL:this.props.moleculeEditURL}),dataTestAttrs:{component:"OverflowDropdownButton",element:"exportMolecule"}})
ea.ZP.isBulkAssembly(this.props.fileId)&&e.push({name:"Export assembly",disabled:!0,tooltipText:"Export is not yet available for Bulk Assembly."})
XA.Z.hasEnterprisePlan()&&e.push({name:Tc.QU,handleOnClick:()=>{bc.dV([this.props.fileId])},dataTestAttrs:{component:"OverflowDropdownButton",element:"exportAuditLog"}})
this.props.permissions.admin&&this.props.isBioentityFailed&&e.push({name:"Override validation checks",handleOnClick:this.makeExempt});(0,ln.cr)({feature:on.TD.INVENTORY_EXPORT})&&this.props.registryId&&e.push({name:"Print registry labels",handleOnClick:()=>(0,Xn.Z)(AR.ZP,{itemIds:[this.props.fileId]})})
return e.length?d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:"More"},d.createElement("span",{className:"dropdown"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,hideDropdownCaret:!0,className:"metadata-header-button-spacing-left",icon:"overflow",isDropdown:!0,size:C.qE.SMALL}),d.createElement(LR.Z,{className:"dropdown-menu--dropLeft",items:[e]}))):null}}render(){const e=this.props.schemaRegistryId,t=null==this.props.registryId&&this.props.hasRegistrySupport&&(null==this.props.schemaPermissions||this.props.schemaPermissions.objectsRegisterable)&&(null==e||xR.Z.hasSourceAuth(e,LN.ZP.APPEND))&&(0,ln.cr)({feature:on.ed.REGISTRY_REGISTER,item:{id:this.props.fileId,permissions:this.props.permissions}}),n=(0,ln.cr)({feature:on.ed.REGISTRY_UNREGISTER,item:{id:this.props.fileId,permissions:this.props.permissions}}),a=dt.ZP.ENABLE_ARCHIVING_V2&&(0,ln.or)([{feature:rn.N7.ARCHIVE,...this.getPartialFeatureDefinition(this.props.permissions)},{feature:rn.N7.UNARCHIVE,...this.getPartialFeatureDefinition(this.props.permissions)}])&&!(ea.ZP.isTemplateCollectible(this.props.fileId)&&!dt.ZP.ELN_ENABLE_TEMPLATE_COLLECTIONS_PAGE_REFACTOR)&&!(ea.ZP.isTemplateCollectible(this.props.fileId)&&!dt.ZP.ELN_ENABLE_TEMPLATE_ARCHIVING)&&(!ea.ZP.isMolecule(this.props.fileId)||dt.ZP.CHEMISTRY_ENABLE_MOLECULE)
return d.createElement("div",{className:"metadata-header-section u-justify-content-end"},this.props.registryId&&this.props.shouldAllowChangeCollection&&(0,ln.cr)({...this.getPartialFeatureDefinition(),feature:rn.N7.EDIT})&&d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:"Change collection..."},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:"metadata-header-button-spacing-left",icon:"add-collection",onClick:this.handleChangeCollection,size:C.qE.SMALL})),ea.ZP.isFolderContainable(this.props.fileId)&&(0,ln.cr)({feature:rn.N7.MOVE,...this.getPartialFeatureDefinition()})&&d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:"Move to folder"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:"metadata-header-button-spacing-left",disabled:!this.props.permissions.movable,icon:"move",onClick:()=>{this.handleOpenForMove(!1)},size:C.qE.SMALL})),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement(kR.Z,{className:"u-mini-spacing-left",buttonStyle:C.ZJ.TERTIARY_GRAY,disabled:!Jn.Z.currentUser(),ids:[this.props.fileId],refreshOptions:{refreshRecentWorklists:!0}}),(()=>t?d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:"metadata-header-button-spacing-left",key:"register",onClick:this.props.onRegister,size:C.qE.SMALL,text:"Register",disabled:this.props.disableRegistering,dataTestAttrs:{component:"MetadataEditorToolbar",element:"registerButton"}}):n?d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:"Unregister"},d.createElement(C.Co,{buttonStyle:C.ZJ.NEGATIVE,className:"metadata-header-button-spacing-left",icon:"unregister",key:"unregister",onClick:()=>{this.handleOpenForMove(!0)},size:C.qE.SMALL,dataTestAttrs:{component:"MetadataEditorToolbar",element:"unregisterButton"}})):null)(),a&&d.createElement(wR.Z,{className:"metadata-header-button-spacing-left",isArchivable:Boolean(this.props.permissions.archivable),isUnarchivable:Boolean(this.props.permissions.unarchivable),item:{id:this.props.fileId,name:this.props.fileName,archiveRecord:this.props.archiveRecord,folder:this.props.folder,projectFolder:this.props.projectFolder},onArchive:IR.ap,onUnarchive:IR.yg}),this.renderMoreFileOptions())}}const MR=MetadataEditorToolbar
var FR=n(996693)
function RegisteredErrorBanners(e){let t=null
if((0,KA.gO)(e.schemaValidationState)){const n=(0,FR.s)(e.validationExtras)
t=d.createElement(pd.Z,{messages:[{bannerType:io.ct.ERROR,text:`${JA.Ob.FAILED}: Please fix the errors below.`},...n.map((e=>({bannerType:io.ct.ERROR,text:e})))]})}else(0,KA.PB)(e.schemaValidationState)?t=d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:JA.Ob.OVERRIDDEN}):(0,KA.Pn)(e.schemaValidationState)&&(t=d.createElement(io.ZP,{bannerType:io.ct.INFO,text:JA.Ob.VALIDATING}))
return null!=t?d.createElement("div",{className:"u-moderate-spacing-bottom"},t):null}const ZR={schemaValidationState:JA.kw,validationExtras:JA.d8}
RegisteredErrorBanners.propTypes=ZR
function hasTagErrors(e){return null!=e&&e.length>0}function getErrorText(e){return e.some((e=>e.errorLabel===oA.d))?"is missing required fields":"contains metadata errors"}function UnregisteredErrorBanner(e){let t
if(e.itemIsUnregisteredEntity)t=(n=e.tagErrors,null==e.tagSchema?"Please set schema to register the entity.":hasTagErrors(n)?`This entity ${getErrorText(n||[])}. Please fix the errors to register the entity.`:"")
else{if(!e.itemIsEntry)return null
t=((e,t)=>{if(null==t)return"Please set schema."
if(hasTagErrors(e))return`This entry ${getErrorText(e||[])}.`
return""})(e.tagErrors,e.tagSchema)}var n
return t?d.createElement("div",{className:"u-moderate-spacing-bottom"},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:t})):null}const BR={itemIsUnregisteredEntity:K.bool.isRequired,itemIsEntry:K.bool.isRequired,tagErrors:K.arrayOf(JA.aT),tagSchema:tw.TAG_SCHEMA_SHAPE}
UnregisteredErrorBanner.propTypes=BR
const MetadataErrors=e=>d.createElement("div",null,e.registryId?d.createElement(RegisteredErrorBanners,{schemaValidationState:e.schemaValidationState,validationExtras:e.validationExtras}):d.createElement(UnregisteredErrorBanner,{itemIsUnregisteredEntity:e.itemIsUnregisteredEntity,itemIsEntry:e.itemIsEntry,tagSchema:e.tagSchema,tagErrors:e.tagErrors}))
MetadataErrors.propTypes={...ZR,...BR,registryId:K.string}
const qR=MetadataErrors
var VR=n(227887),UR=n(481677),GR=n(411358),zR=n(672725),$R=n(767755)
const WR=g.mM.create({container:{padding:"10px 0px 8px",display:"flex",flexDirection:"column"},infoColors:{backgroundColor:Vt.Ro,borderColor:Vt.t0}})
function LinkWithBanner(e){return d.createElement("div",{className:"simpleDivTable-header"},d.createElement(io.ZP,{text:"Apply autofill to visualize schema field links on sequence maps.",bannerType:io.ct.INFO}),e.children)}function AutoFillLink({isEditing:e,isOligo:t,fileId:n,areTagsEditable:a,tagSchema:i}){if(!n||!a||!i||t||e)return null
const s=[...[{name:"Parts",fieldType:Hn.FIELD_TYPES.PART_LINK.type,autofillActionFn:()=>{(0,as.jE)([n],j.D2.ENTITY_PAGE_METADATA_TAB_SCHEMA_TABLE,"Parts")
$R.ip(n)}},{name:"Transcriptions",fieldType:Hn.FIELD_TYPES.TRANSCRIPTION_LINK.type,autofillActionFn:()=>{const e=(0,gt.Z)();(0,as.jE)([n],j.D2.ENTITY_PAGE_METADATA_TAB_SCHEMA_TABLE,"Transcriptions",e)
$R.KV(n,(({sequenceId:t,autofillCount:n,autofillErrors:a})=>{(0,as.aJ)({actionOrigin:j.D2.ENTITY_PAGE_METADATA_TAB_SCHEMA_TABLE,autofillRunUID:e,autofillName:"Transcriptions",sequenceId:t,autofillCount:n,autofillErrors:a})}))}},{name:"Translations",fieldType:Hn.FIELD_TYPES.TRANSLATION_LINK.type,autofillActionFn:()=>{(0,as.jE)([n],j.D2.ENTITY_PAGE_METADATA_TAB_SCHEMA_TABLE,"Translations")
$R.sZ(n)}}]].filter((e=>function fieldTypePresentInSchema(e){return i.fields.some((t=>t.fieldType===e))}(e.fieldType))),r=s.length
return r>1?d.createElement(LinkWithBanner,null,d.createElement("div",{className:(0,g.iv)(WR.container,WR.infoColors)},d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.SMALL,width:w.ZP.WIDTHS.MEDIUM},s.map((e=>d.createElement(N.Z,{key:e.name,onSelect:e.autofillActionFn},e.name))))},d.createElement("a",{className:"u-mini-spacing-left"},"Autofill ",d.createElement(pe.Z,{icon:"chevron-down"}))))):1===r?d.createElement(LinkWithBanner,null,d.createElement("div",{className:(0,g.iv)(WR.container,WR.infoColors)},d.createElement("a",{className:"u-mini-spacing-left",onClick:s[0].autofillActionFn,...(0,ee.Z)({component:"AutoFillLink",element:`autofill${s[0].name}`})},"Autofill ",s[0].name.toLowerCase()))):null}var HR=n(544192)
K.oneOfType([K.shape({id:K.string.isRequired,name:K.string.isRequired,modified_at:K.string.isRequired,folder:K.shape({source:K.shape({name:K.string.isRequired})}),tagSchema:tw.TAG_SCHEMA_SHAPE}),K.shape({id:K.string.isRequired,name:K.string.isRequired,modifiedAt:K.string.isRequired})]),K.shape({workflowSummary:HR.UV,stageEntriesMentioning:K.arrayOf(K.shape({stageEntrySummary:HR.Ks,inputSamples:K.arrayOf(HR.P5),registeredSamples:K.arrayOf(HR.P5)}))})
const jR=K.shape({errorLabel:K.string.isRequired,field:Hn.SCHEMA_FIELD_SHAPE.isRequired,message:K.string.isRequired})
var YR=n(291531)
const{TAG_SCHEMA_SHAPE:QR}=tw
function SchemaTableTitle({hasRegistrySupport:e,tagSchema:t}){return d.createElement("div",null,"Schema",e&&!t&&d.createElement(zR.Z,{className:"u-mini-spacing-left"}))}function SchemaTagTable(e){(0,S.hu)(void 0!==e.fileId||void 0!==e.fileType,"FileId or fileType required in SchemaTagTable to filter relevant schema types")
const t=(0,pC.IT)(e.schemaTags)
function _renderTagTable(){var n
return d.createElement(EC,{canRefreshTags:UR.hasComputedTags(t)||GR.v(t),emptyMessage:"This schema has no fields.",errorsByFieldId:e.errorsByFieldId,fileId:e.fileId,hoistedTags:e.hoistedTags,hoistedTagSchemaGraphs:e.tagSchema?e.tagSchema.hoistedTagSchemaGraphs:[],initialTags:t,areTagsEditable:e.areTagsEditable,isLoadingTags:e.isLoadingTags,onAnalyzeProteins:e.onAnalyzeProteins,registryId:e.tagSchema&&e.tagSchema.registryId,sequenceParts:e.sequenceParts,subheaderNode:d.createElement(YR.Z,{sequenceSubtype:e.sequenceSubtype,fileType:null!==(n=e.fileType)&&void 0!==n?n:aw.gq(e.fileId),isSchemaEditable:e.isSchemaEditable,isFileRegistered:e.isFileRegistered,onUpdateTagSchema:e.onUpdateTagSchema,tagSchema:e.tagSchema}),title:d.createElement(SchemaTableTitle,{hasRegistrySupport:e.hasRegistrySupport,tagSchema:e.tagSchema}),updateTags:e.onUpdateTags,autofillBanner:t=>d.createElement(AutoFillLink,{isEditing:t,isOligo:(0,T.isOligoSubtype)(e.sequenceSubtype),fileId:e.fileId,areTagsEditable:e.areTagsEditable,tagSchema:e.tagSchema}),showFieldDescriptions:dt.ZP.SCHEMAS_ENABLE_SCHEMA_FIELD_DESCRIPTION_FOR_TAG_SCHEMAS})}return e.fileId?d.createElement(uN.I,{fileId:e.fileId},d.createElement("div",null,_renderTagTable())):d.createElement("div",null,_renderTagTable())}SchemaTagTable.propTypes={sequenceSubtype:J().string,errorsByFieldId:J().objectOf(J().arrayOf(jR.isRequired).isRequired).isRequired,fileId:J().string,fileType:J().string.isRequired,hasRegistrySupport:J().bool.isRequired,hoistedTags:J().arrayOf(VN.D).isRequired,isFileRegistered:J().bool.isRequired,areTagsEditable:J().bool.isRequired,isSchemaEditable:J().bool.isRequired,isLoadingTags:J().bool.isRequired,onAnalyzeProteins:J().func,onUpdateTagSchema:J().func.isRequired,schemaTags:J().arrayOf(VR.kY).isRequired,sequenceParts:J().array,tagSchema:QR,isEditing:J().bool,setIsEditing:J().func}
const{DEPRECATED_FOLDER_SHAPE:KR}=ZN
class MetadataEditorConnector extends oi.C{constructor(){super(...arguments)
this.stores=[UN.Z,HA.Z,ba.Z]}forceFetchOnMount(){this.props.hasFileSchemaSupport&&ea.ZP.isFolderItem(this.props.fileId)&&Rn.Z.bulkFetchFileSummaries([this.props.fileId])}enhanceProps(){var e,t,n
let a
if(null==this.props.projectFolderId)a=null
else{const e=this.getOrFetchMaybeInaccessibleRequired(lA.V.FOLDER_BY_ID,this.props.projectFolderId)
a=(0,kN.Eh)(e)?null:e}const i=this.reduxState().models.validationExtrasByBioentityId[this.props.fileId],s=this.reduxState().ui.metadataTab[this.props.fileId]
return{projectFolder:a,validationExtras:i,reviewBlockedByErrors:!!s&&s.reviewBlockedByErrors,bioentityAliasInfos:this.inventoryFileStore().getBioentityAliasInfos(this.props.fileId)||[],hoistedTags:this.inventoryFileStore().getHoistedTags(this.props.fileId)||[],isLoadingTags:this.inventoryFileStore().getIsLoadingTags(),proteinResidues:ea.ZP.isProtein(this.props.fileId)?null===(t=null===(e=this.proteinStore().getProteinById(this.props.fileId))||void 0===e?void 0:e.version)||void 0===t?void 0:t.aminoAcids:null,tagErrors:null!==(n=this.registryValidatorStore().getTagErrors(this.props.fileId))&&void 0!==n?n:[]}}}class MetadataEditor extends d.Component{constructor(){super(...arguments)
this.state={orderedTags:this.props.tags}
this.shouldShowReviewTagErrors=()=>cA.fD(ea.ZP.apiIdToType(this.props.fileId))&&(dt.ZP.ELN_ENABLE_SCHEMA_REQUIRED_FOR_REVIEW||null!=this.props.tagSchema)
this.isRegistered=()=>Boolean(this.props.registryId)
this.getPartialFeatureDefinition=e=>({item:{id:this.props.fileId,permissions:e},itemState:{isRegistered:this.isRegistered()}})
this.registeredValidationTagErrors=()=>this.props.schemaValidationState&&(0,KA.gO)(this.props.schemaValidationState)&&this.props.validationExtras?this.props.validationExtras.errorRecords:null
this.getVisibleFieldErrors=e=>{let t=e||[]
this.props.reviewBlockedByErrors||(t=t&&t.filter((e=>!e.field||!((0,QA.c)(e.field)&&e.errorLabel===oA.d))))
return t}
this.getFieldErrorsToDisplay=()=>{const e=this.registeredValidationTagErrors()
if(e&&e.length||this.shouldShowUnregisteredTagErrors()||this.shouldShowReviewTagErrors()){const t=this.getVisibleFieldErrors(e||this.props.tagErrors)
return null==t?{}:l.default.chain(t).filter((({field:e})=>null!=e)).groupBy((({field:e})=>e.id)).value()}return{}}
this.handleRegister=()=>{this.isRegistrable()&&WA.ku([this.getFinderResult()])}
this.updateTags=async(e,t)=>{const{toSet:n,toAdd:a,toRemove:i,toRename:s}=e,r={toSet:null!=n?n:{},toAdd:null!=a?a:[],toRemove:null!=i?i:[],toRename:null!=s?s:{}}
return await BN.Z.updateTagsWithDataMods([this.props.fileId],this.isRegistered(),r,{onFailure:null==t?void 0:t.onFailure})}
this.updateTagSchema=e=>{aw.oE([{id:this.props.fileId,tags:this.props.tags}],e)}}componentDidMount(){this.props.hasRegistrySupport&&XA.Z.hasEnterprisePlan()&&qN.Zh(this.props.fileId)
this.fetchValidation()
this.props.hasRegistrySupport&&this.fetchSchemaValidationExtras()}componentDidUpdate(e){!e.hasRegistrySupport&&this.props.hasRegistrySupport&&this.fetchSchemaValidationExtras()}UNSAFE_componentWillReceiveProps(e){const[t,n]=Array.from(l.default.partition(e.tags,(e=>null!=l.default.findWhere(this.state.orderedTags,{name:e.name})))),a=[]
for(const e of Array.from(this.state.orderedTags)){const n=l.default.findWhere(t,{name:e.name})
null!=n&&a.push(n)}this.setState({orderedTags:a.concat(n)})
MetadataEditor.shouldFetchValidation(this.props,e)&&this.fetchValidation(e)}getSchemaRegistryId(e){var t
null==e&&({props:e}=this)
return null===(t=e.tagSchema)||void 0===t?void 0:t.registryId}static shouldFetchValidation(e,t){return e.registryId!==t.registryId||(!Is()(e.tagSchema,t.tagSchema)||!Is()(e.tags,t.tags))}shouldShowUnregisteredTagErrors(){return this.props.hasRegistrySupport}fetchValidation(e){null==e&&({props:e}=this)
if(this.props.hasRegistrySupport){if(this.isRegistered()||!aw.rS(e.fileId,e.permissions))return
const t=this.getSchemaRegistryId(e)
null!=t&&WA.OH(this.props.fileId,t)}else this.shouldShowReviewTagErrors()&&WA.Qe(this.props.fileId)}fetchSchemaValidationExtras(){this.isRegistered()&&(0,MN.Z)(this.props.fileId)}getFinderResult(){return{id:this.props.fileId,name:this.props.fileName,tags:this.props.tags,tagSchema:this.props.tagSchema,folder:{api_identifier:this.props.folder.api_identifier}}}isRegistrable(){return Boolean(this.props.tagSchema&&(!this.props.tagErrors||!this.props.tagErrors.length)&&this.props.hasRegistrySupport)}renderTitle(){var e,t
return d.createElement("div",{className:"metadata-header-section"},d.createElement(Zo.Z,{isDisabled:null===(e=this.props.permissions.canEditNamesAndAliases)||void 0===e||e,text:"You do not have permission to edit this item's name or aliases."},d.createElement("div",null,d.createElement(uC.Z,{initialAlias:this.props.fileName,isFullWidth:!0,isHeader:!0,isWritable:(null!==(t=this.props.permissions.canEditNamesAndAliases)&&void 0!==t?t:this.props.isRegistryWritable)&&(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()}),complete:this.props.updateName,placeholder:"Name"}))),d.createElement(lC.Z,{item:{name:this.props.fileName,id:this.props.fileId,archiveRecord:this.props.archiveRecord}}),null!=this.props.registryName&&d.createElement("div",{className:"metadata-registry-header"},this.props.registryName),this.props.hasRegistrySupport&&d.createElement(QueryingConvertedToItemField,{fileId:this.props.fileId}))}renderAliasSection(){var e
return d.createElement("div",{className:"metadata-section"},d.createElement(AliasList,{bioentityAliasInfos:this.props.bioentityAliasInfos.filter((e=>e.alias!==this.props.fileName&&null==e.registryCollectionOwner)),fileId:this.props.fileId,isWritable:(null!==(e=this.props.permissions.canEditNamesAndAliases)&&void 0!==e?e:this.props.isRegistryWritable)&&(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()})}))}maybeRenderProcessMetadata(){return ea.ZP.isProcess(this.props.fileId)?d.createElement(QueryingProcessMetadataSection,{processId:this.props.fileId}):null}maybeRenderMixtureMetadata(){if(ea.ZP.apiIdToType(this.props.fileId)===st.MIXTURE){(0,S.hu)(null!=this.props.tagSchema,`Expected mixture to have tag schema: ${this.props.fileId}`)
const e=(0,$A.V)(this.props.tags)
return d.createElement(d.Fragment,null,d.createElement("div",{className:`${(0,g.iv)(XR.overflowXAuto)} metadata-section`},d.createElement(QueryingIngredientTable,{tagSchema:this.props.tagSchema,areIngredientsEditable:(0,bA.wR)(this.props.permissions),mixtureId:this.props.fileId,parentLinkFileId:e?(0,pA.zG)(e):null,isRegistered:this.isRegistered()})),d.createElement(QueryingMixtureInstructions,{mixtureId:this.props.fileId,tagSchema:this.props.tagSchema,instructionsEditorProps:this.props.instructionsEditorProps}))}return null}userCanEditTags(){return aw.rS(this.props.fileId,this.props.permissions)}renderSchemaTagTable({schemaTags:e}){if(this.props.hasFileSchemaSupport){const t=this.userCanEditTags()&&(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()})
return d.createElement("div",{className:"metadata-section"},d.createElement(SchemaTagTable,{fileId:this.props.fileId,fileType:aw.gq(this.props.fileId),hasRegistrySupport:this.props.hasRegistrySupport,hoistedTags:this.props.hoistedTags,isFileRegistered:this.isRegistered(),areTagsEditable:t,isSchemaEditable:t,isLoadingTags:this.props.isLoadingTags,sequenceSubtype:this.props.sequenceSubtype,onAnalyzeProteins:this.props.onAnalyzeProteins,schemaTags:e,sequenceParts:this.props.sequenceParts,errorsByFieldId:this.getFieldErrorsToDisplay(),tagSchema:this.props.tagSchema,onUpdateTags:this.updateTags,onUpdateTagSchema:this.updateTagSchema}))}return ea.ZP.apiIdToType(this.props.fileId)===st.STUDY?d.createElement("div",{className:"metadata-section"},d.createElement(StudySchemaTagTable,{studyId:this.props.fileId})):null}renderCustomTagTable({schemaFields:e,customTags:t}){return d.createElement("div",{className:"metadata-section"},d.createElement(EC,{canAddOrRemoveTags:(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()}),emptyMessage:"This entity has no custom fields.",fieldsForCustomTagNameValidation:e,fileId:this.props.fileId,initialTags:t,areTagsEditable:this.userCanEditTags()&&(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()}),isNameEditable:(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()}),onAnalyzeProteins:this.props.onAnalyzeProteins,title:"Custom Field",updateTags:this.updateTags,sequenceParts:this.props.sequenceParts}))}maybeRenderNotificationSchedules(){return ea.ZP.isStudy(this.props.fileId)&&dt.ZP.STUDIES_ENABLE_NOTIFICATIONS?d.createElement(SR,{studyId:this.props.fileId,isWritable:this.props.permissions.writable}):null}render(){var e,t
const{schemaTags:n,customTags:a}=pC.JY({tags:this.state.orderedTags,tagSchema:this.props.tagSchema})
return d.createElement("div",{className:"metadata-editor",...(0,ee.Z)({component:"MetadataEditor",element:"root"})},this.props.hasFileSchemaSupport&&d.createElement(eR,{fileId:this.props.fileId,proteinAminoAcids:this.props.proteinResidues,sequenceBases:this.props.sequenceBases,sequenceModifiedNucleotides:this.props.sequenceModifiedNucleotides,tags:this.props.tags}),ea.ZP.isBiologicalEntity(this.props.fileId)&&d.createElement(YA,{proteinResidues:this.props.proteinResidues,registryId:this.props.registryId,sequenceBases:this.props.sequenceBases,sequenceCircular:this.props.sequenceCircular,sequenceModifiedNucleotides:this.props.sequenceModifiedNucleotides,sequenceParts:this.props.sequenceParts,sequenceTranslations:this.props.sequenceTranslations,tags:this.props.tags}),null!=this.props.banner&&d.createElement(Fv.Z,{banner:this.props.banner}),d.createElement("div",{className:"react-tab-container"},d.createElement("div",{className:"react-tab-container-narrowTab"},d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{sm:6},this.renderTitle()),d.createElement(p.Z,{sm:6},d.createElement(MR,{archiveRecord:this.props.archiveRecord,fileId:this.props.fileId,isBioentityFailed:(0,KA.gO)(this.props.schemaValidationState),fileName:this.props.fileName,folder:this.props.folder,hasRegistrySupport:this.props.hasRegistrySupport,moleculeEditURL:this.props.moleculeEditURL,onRegister:this.handleRegister,permissions:this.props.permissions,projectFolder:this.props.projectFolder,registryId:this.props.registryId,schemaRegistryId:this.getSchemaRegistryId(),schemaPermissions:null===(e=this.props.tagSchema)||void 0===e?void 0:e.permissions,sequenceEditURL:this.props.sequenceEditURL,shouldAllowChangeCollection:this.props.shouldAllowChangeCollection,disableRegistering:!this.isRegistrable()}))),d.createElement(qR,{registryId:this.props.registryId,schemaValidationState:this.props.schemaValidationState,itemIsUnregisteredEntity:this.shouldShowUnregisteredTagErrors(),itemIsEntry:this.shouldShowReviewTagErrors(),tagErrors:this.getVisibleFieldErrors(this.props.tagErrors),tagSchema:this.props.tagSchema,validationExtras:this.props.validationExtras}),d.createElement(QueryingMetadataEditorInfoSection,{fileId:this.props.fileId,authors:this.props.authors,projectFolder:this.props.projectFolder,hasFileSchemaSupport:this.props.hasFileSchemaSupport,folder:this.props.folder,hasRegistrySupport:this.props.hasRegistrySupport,permissions:this.props.permissions,bioentityAliasInfos:this.props.bioentityAliasInfos,humanId:this.props.humanId,createdAt:this.props.createdAt,finalized:this.props.finalized,registryId:this.props.registryId}),this.props.hasRegistrySupport&&d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{sm:12},this.renderAliasSection())),this.maybeRenderMixtureMetadata(),this.maybeRenderProcessMetadata(),this.renderSchemaTagTable({schemaTags:n}),this.props.hasCustomTagSupport&&this.renderCustomTagTable({schemaFields:(null===(t=this.props.tagSchema)||void 0===t?void 0:t.allFields)||[],customTags:a}),this.maybeRenderNotificationSchedules())))}}MetadataEditor.propTypes={archiveRecord:zu.k0,authors:J().arrayOf(J().shape(FN.Q).isRequired),banner:J().string,createdAt:J().string,sequenceSubtype:J().string,fileId:J().string.isRequired,fileName:J().string.isRequired,folder:KR,hasFileSchemaSupport:J().bool.isRequired,hasRegistrySupport:J().bool.isRequired,humanId:J().string,isRegistryWritable:J().bool.isRequired,moleculeEditURL:J().string,onAnalyzeProteins:J().func.isRequired,permissions:LN.OD.isRequired,projectFolder:KR,registryId:J().string,registryName:J().string,reviewBlockedByErrors:J().bool.isRequired,sequenceBases:J().string,sequenceParts:J().arrayOf(J().object),sequenceTranslations:J().arrayOf(J().object),sequenceEditURL:J().string,schemaValidationState:JA.kw,shouldAllowChangeCollection:J().bool.isRequired,tags:J().arrayOf(J().shape({name:J().string,value:J().string,url:J().string})).isRequired,tagSchema:tw.TAG_SCHEMA_SHAPE,updateName:J().func.isRequired,validationExtras:JA.d8,bioentityAliasInfos:J().arrayOf(tw.BIOENTITY_ALIAS_INFO_SHAPE),hoistedTags:J().arrayOf(VN.D),isLoadingTags:J().bool,tagErrors:J().arrayOf(JA.aT)}
MetadataEditor.defaultProps={authors:null,sequenceBases:null,sequenceParts:[],sequenceTranslations:[],schemaValidationState:null}
const JR=MetadataEditorConnector.connect(MetadataEditor),XR=g.mM.create({overflowXAuto:{overflowX:"auto"}})
const eP=function formatAminoAcids(e){const t=[],n=`${e.length-e.length%50}`.length+2
for(let a=0;a<e.length;a+=50){const i=[]
for(let t=a;t<Math.min(a+50,e.length);t+=10)i.push(e.substr(t,10))
let s=`${a}`
for(;s.length<n;)s+=" "
const r=s+i.join(" ")
t.push(r)}return t.join("\n")}
function ProteinChainPreview({name:e,aminoAcids:t}){return d.createElement("div",null,d.createElement("div",null,d.createElement("strong",null,e)),d.createElement("pre",null,eP(t)))}function ProteinComplexPreviewBody({proteins:e}){return d.createElement("div",{className:"container u-spacing-top"},e.map(((e,t)=>d.createElement(ProteinChainPreview,{key:t,name:e.name,aminoAcids:e.aminoAcids}))))}class ProteinComplexPreviewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const e=[]
this.props.proteinIds.forEach((t=>{const n=this.proteinStore().getProteinById(t)
if(null!=n){const t={name:n.name,aminoAcids:n.version.aminoAcids}
e.push(t)}}))
return{proteins:e}}}class ProteinComplexPreview extends d.Component{componentDidMount(){this.props.proteinIds.forEach((e=>{Ea.Z.open(e,{})}))}render(){return d.createElement(ProteinComplexPreviewBody,{proteins:this.props.proteins})}}const tP=ProteinComplexPreviewConnector.connect(ProteinComplexPreview)
class ProteinComplexPreviewTabState extends nn.Xh{constructor({proteinIds:e}){super()
this.set("proteinIds",e)}defaults(){return{...super.defaults(),title:"Protein Preview",closeable:!0}}}class ProteinComplexPreviewTabView extends s().View{constructor({model:e}){super()
this.model=e}render(){(0,Me.A9)(d.createElement(tP,{proteinIds:this.model.get("proteinIds")}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}ProteinComplexPreviewTabView.prototype.className="buffer-tab buffer-tab-reset buffer-tab--no-padding"
var nP=n(179929)
class ProteinComplexProperties_ProteinComplexPreviewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const e=[]
for(const t of this.props.proteinIds){const n=this.proteinStore().getProteinById(t)
if(!n)return{isLoading:!0}
e.push(n.version.aminoAcids)}return{isLoading:!1,combinedAminoAcids:e.join("")}}}class ProteinComplexProperties_ProteinComplexPreview extends d.Component{componentDidMount(){this.props.proteinIds.forEach((e=>{Ea.Z.open(e,{})}))}render(){return this.props.isLoading?d.createElement("div",{className:"text-center u-spacing-top"},d.createElement("div",null,"Loading..."),d.createElement(Lt.Z,null)):d.createElement("div",{className:(0,g.iv)(aP.wrapper)},d.createElement(nP.Z,{aminoAcids:this.props.combinedAminoAcids}))}}const aP=g.mM.create({wrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}),iP=ProteinComplexProperties_ProteinComplexPreviewConnector.connect(ProteinComplexProperties_ProteinComplexPreview)
class ProteinComplexPropertiesTabState extends nn.Xh{constructor({proteinIds:e}){super()
this.set("proteinIds",e)}defaults(){return l.default.extend(super.defaults(),{title:"Protein Properties",closeable:!0})}}class ProteinComplexPropertiesTabView extends s().View{constructor({model:e}){super()
this.model=e}render(){(0,Me.A9)(d.createElement(iP,{proteinIds:this.model.get("proteinIds")}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}ProteinComplexPropertiesTabView.prototype.className="buffer-tab buffer-tab-reset buffer-tab--no-padding"
var sP=n(15655)
const rP={showOpenLink:!0,followLink:!1}
function getSharedNoteViewProps(e){let t=e.get("model").fileType()
t===st.SEQUENCE&&e.get("model")._sequence().get("type")===ZN.SEQUENCE_TYPE.OLIGO&&(t=qA.ZP.OLIGO)
const n=e.get("displayOptions"),a={fileType:t,displayOptions:n,fileId:e.get("model").id,cidIdMap:e.get("model").get("cidIdMap"),humanId:e.get("model").humanId(),allowEdits:e.get("model").allowEditsToNote(),permissions:e.get("model").permissions(),historyResetCount:e.get("model").get("historyResetCount"),preview:rP,fullScreen:!0}
if(null==n)return{...a,showTimestamps:!1,spellCheck:!1,showTableOfContents:!1,printLayout:!1,showPrintMargins:!1}
const i=n.getOption(Yt.hC.name)
return{...a,showTimestamps:n.getOption(Yt.SQ.name).get("visible"),spellCheck:n.getOption(Yt.Q8.name).get("visible"),showTableOfContents:n.getOption(Yt.A_.name).get("visible"),printLayout:i.get("visible"),showPrintMargins:i.isSettingChecked(Yt.Ub.name)}}function getDedicatedGeneralNoteViewProps(e,t={}){const n=e.get("model").getBannerText()
return{banner:e.get("model").allowEditsToNote()?void 0:n,parentType:"Note",updateStatusBar:e=>sP.qu(e),clearStatusBar:()=>sP.nJ(),fullScreen:!0,minimalToolbar:!1,...t}}class MetadataTabView extends s().View{static initClass(){this.prototype.className="metadataTab buffer-tab buffer-tab--no-padding"}initialize(){this._handleAnalyzeProteins=this._handleAnalyzeProteins.bind(this)
this._updateName=this._updateName.bind(this);(0,as.SX)(this.model.get("model"))}render(){this.listenTo(this.model.get("model"),"change",(()=>{this.renderMetadataEditor()}))
ea.ZP.isNucleotideSequence(this.model.get("model").id)&&this.listenTo(this.model.get("model")._sequence(),"change",(()=>{this.renderMetadataEditor()}))
this.listenTo(this.model.get("model").fileState(),"change",(()=>{this.renderMetadataEditor()}))
this.renderMetadataEditor()
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}_handleAnalyzeProteins(e){const t=this.model.get("model"),n=ve.ZP.get().get(t.id)
n.buffers().addTab(new ProteinComplexPreviewTabState({proteinIds:e}),{side:"left"})
n.buffers().addTab(new ProteinComplexPropertiesTabState({proteinIds:e}),{side:"right"})}async _updateName(e){const t=this.model.get("model")
return await t.triggerUpdateNameAction(e)}renderMetadataEditor(){const e=this.model.get("model"),t=e.permissions(),n=lo.hasRegistrySupport(e.id),a=(0,ln.cr)({feature:on.ed.REGISTRY_SHOW_DETAILS,item:{id:e.id}}),i=aw.DN(e.id),s=(!n||a)&&i,r=n&&a,o=r&&e.folder().source.sourceType===DN.REGISTRY_TYPE,c=XA.Z.hasEnterprisePlan()&&null!=e.authors(),u=l.default.sortBy(e.tags(),"name"),m=this.model.get("model").id;(0,Me.A9)(d.createElement(JR,{archiveRecord:e.archiveRecord(),banner:t.writable?void 0:e.getBannerText(),createdAt:e.createdAt(),fileId:e.id,fileName:e.name(),finalized:ea.ZP.isBulkAssembly(m)?e.finalized():void 0,folder:e.folder(),projectFolderId:e.projectFolderId(),humanId:e.humanId(),updateName:async e=>{await this._updateName(e)},permissions:t,sequenceSubtype:e.subtype&&e.subtype(),isRegistryWritable:t.writable,tags:u,registryId:o?e.folder().source.id:null,registryName:o?e.folder().source.name:null,hasCustomTagSupport:aw.WL(e.id),hasFileSchemaSupport:s,hasRegistrySupport:r,tagSchema:i?e.tagSchema():null,sequenceBases:ea.ZP.isNucleotideSequence(m)?e.bases():null,sequenceCircular:ea.ZP.isNucleotideSequence(m)?e.circular():null,sequenceModifiedNucleotides:ea.ZP.isNucleotideSequence(m)?e.modifiedNucleotides():null,sequenceParts:ea.ZP.isNucleotideSequence(m)?e.parts().toReactJSON():[],sequenceTranslations:ea.ZP.isNucleotideSequence(m)?e.translations().toReactJSON():[],sequenceEditURL:ea.ZP.isNucleotideSequence(m)?e.get("editURL"):null,moleculeEditURL:ea.ZP.isMolecule(m)?e.get("editURL"):null,schemaValidationState:e.schemaValidationState(),shouldAllowChangeCollection:o&&!e.folder().source.disablePersonalCollections&&t.appendable,onAnalyzeProteins:e=>{this._handleAnalyzeProteins(e)},authors:c?e.authors():null,instructionsEditorProps:{...getSharedNoteViewProps(this.model),...getDedicatedGeneralNoteViewProps(this.model,{fullScreen:!1,minimalToolbar:!0})}}),this.el)}}MetadataTabView.initClass()
const oP=MetadataTabView
var lP=n(456445),cP=n(388616)
class OligoConjugateMapTabState extends cP.Z{constructor(){super(...arguments)
this.BASES_PER_SLICE_ADJUSTMENT=-1}mapState(e){return new En.Jg(e)}msVisibilityOptions(){return this.get("visibilityOptions").makeLocalSync()}defaults(){return{...super.defaults(),closeable:!1,title:"Polymer Map",bufferViewLayout:null,visibilityOptions:(0,Yt.Ig)("linear",[{base:Yt.lA,visible:!0,editable:!1,sync:!1},{base:Yt.jB,visible:!1,editable:!1,sync:!1},{base:Yt.gY,visible:!1,editable:!1,sync:!1},{base:Yt.bW,visible:!1,editable:!1,sync:!1},{base:Yt.gO,visible:!1,editable:!1,sync:!1},{base:Yt.dq,visible:!1,editable:!1,sync:!1},{base:Yt.D1,visible:!1,editable:!1,sync:!1},{base:Yt.Cz,visible:!0,editable:!0,sync:!0},{base:Yt.UN,visible:!0,editable:!0,sync:!0},{base:Yt.KL,visible:!1,editable:!1,sync:!1},{base:Yt.tO,visible:!1,editable:!1,sync:!1},{base:Yt.VZ,visible:!1,editable:!1,sync:!1},{base:Yt.Jv,visible:!0,editable:!1,sync:!0},{base:Yt._j,visible:!1,editable:!1,sync:!1},{base:Yt.B$,visible:!0,editable:!1,sync:!0},{base:Yt.iX,visible:!1,editable:!1}]),preferenceKey:"oligo-conjugate-map"}}}const dP=OligoConjugateMapTabState
var uP=n(143683),mP=n(581634)
const pP={addListeners:function(e,t,n){e.listenTo(t,"cutsitesChanged change:color",n)}},hP=pP
class Slices extends s().Collection{static initClass(){this.prototype.model=Yi.Z}}Slices.initClass()
const gP=Slices
var EP=n(789385),fP=n(115564)
const SP=xa.Ps`
  query OligoInfoQuery($id: StrictString!) @skipAudit @engComponent(name: MOLBIO) {
    componentSequence(id: $id) @client {
      bases @client
      id @client
      nucleotideType @client
    }
    sequence(id: $id) {
      ... on SequenceNode {
        id
        legacyRelevantItemsJson
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function OligoPropertyText({label:e,value:t}){return d.createElement(d.Fragment,null,d.createElement("span",{className:(0,g.iv)(yP.labelText)},e)," ",d.createElement("span",{className:(0,g.iv)(yP.valueText)},t))}function Separator(){return d.createElement("div",{className:(0,g.iv)(yP.separator)})}function OligoPropertiesBanner({sequenceId:e}){const[t,n]=mc.useGlobalClientState(e);(0,Ln.Z)(tn.gq.MELTING_TEMP_DNA);(0,Ln.Z)(tn.gq.MELTING_TEMP_RNA)
return d.createElement(Da.ZP,{query:SP,variables:{id:e},renderLoading:()=>d.createElement("div",null),renderCachedDataWhenRefetching:!0},(t=>{if((0,ka.CZ)(t.sequence)||null==t.componentSequence)return null
const a=t.componentSequence.bases,i=t.componentSequence.nucleotideType,s=100*(0,y.gc)(a,i),r=(0,y.meltingTemperature)(a,i),o=t.sequence.legacyRelevantItemsJson.sequencesUsingAsPrimer.length
return d.createElement("div",{className:(0,g.iv)(yP.banner)},d.createElement("div",{className:(0,g.iv)(yP.buffer)}),d.createElement(OligoPropertyText,{label:"Length",value:a.length}),d.createElement(Separator,null),d.createElement(OligoPropertyText,{label:"GC",value:`${s.toFixed(2)}%`}),d.createElement(Separator,null),d.createElement(OligoPropertyText,{label:d.createElement(d.Fragment,null,Xi.Mg,d.createElement(pe.Z,{icon:"settings",onClick:()=>{(0,Xn.Z)(MeltingTempModal,{})},className:(0,g.iv)(yP.tmSettings)})),value:`${r.toFixed(1)}${Xi.ig}C`}),o>0&&d.createElement(d.Fragment,null,d.createElement(Separator,null),d.createElement(C.Co,{className:(0,g.iv)(yP.linkedSequences),buttonStyle:C.ZJ.LINK,onClick:()=>{n({searchQuery:"",filterOption:cc.SEQUENCE_PRIMERS,pageOffset:0})
ve.ZP.get().get(e).buffers().getTabByClass(fP.Z).set({active:!0})}},o," linked ",(0,de._6)(o,"sequence"))),d.createElement("div",{className:(0,g.iv)(yP.buffer)}))}))}const yP=g.mM.create({banner:{..._n.cf,backgroundColor:Vt.bs,display:"flex",alignItems:"center",padding:"10px"},labelText:{fontWeight:_n.KB},valueText:{fontWeight:_n.hS},buffer:{flex:1},linkedSequences:{verticalAlign:"text-top"},separator:{height:"24px",borderRight:`1px solid ${Vt.pp}`,margin:"0px 10px"},tmSettings:{width:"13px",marginBottom:"0px",color:Vt.pp,cursor:"pointer",margin:"0px 3px"}})
const bP=class PolymerLinearMapView extends nr{createSliceItemSource(){throw new Error("Not implemented error")}initialize(e){super.initialize(e)
this.slices=new gP
this.mapstate=this.model.get("mapstate")
this.type=this.getType()
this.mapType="linear"
this.sliceSource=this.createSliceItemSource({mapstate:this.mapstate,tabstate:this.model,$linear:this.$el,cutsiteSlices:this.slices})
const t=this.mapstate.get("scrollData")
this.infiniteScroller=new ar.Sp({tabstate:this.model,mapstate:this.mapstate,itemSource:this.sliceSource,scrollData:t,spacing:30})
this.infiniteScrollbar=new ar.h3({tabstate:this.model,model:t,fullHeight:()=>this.infiniteScroller.$el.height()})
this.sliceSource.setScroller(this.infiniteScroller)}getType(){throw new Error("Not implemented")}handleArrowPress(e){e.preventDefault()
const t=this.mapstate.polymer().get("selection"),n=e.shiftKey,a=this.mapstate.get("maxBases"),i=t.start(),s=t.end(),r=this.getMoveEnd()
let o=t.getState("column")
if(null==o){t.addState({column:r%a})
o=r%a}switch(e.which){case 37:n?t.linearExtendBy(-1):t.isEmpty()?t.resetBy(-1):t.reset(i)
t.addState({column:this.getMoveEnd()%a})
break
case 39:n?t.linearExtendBy(1):t.isEmpty()?t.resetBy(1):t.reset(s)
t.addState({column:this.getMoveEnd()%a})
break
case 38:n?t.linearExtendByRow(-1,a,o):t.resetByRow(-1,a,o)
t.addState({column:o})
break
case 40:n?t.linearExtendByRow(1,a,o):t.resetByRow(1,a,o)
t.addState({column:o})}this.mapstate.polymer().trigger("cursorJump")}scrollToIncludeCursor(){const e=Math.max(0,Math.floor((this.getMoveEnd()-1)/this.mapstate.get("maxBases")))
this.infiniteScroller.scrollToIncludeIndex(e)}remove(){this.infiniteScroller.remove()
this.infiniteScrollbar.remove()
this.sliceSource.stopListening()
o()(window).off(".linear")
this.$("#parts-warning-banner").children().length>0&&(0,u.unmountComponentAtNode)(this.$("#parts-warning-banner")[0])
this.$("#oligo-properties").children().length>0&&(0,u.unmountComponentAtNode)(this.$("#oligo-properties")[0])
return super.remove()}handleJump(e){if(ma.U2("mapId")!==this.mapstate.cid){const t=this.sliceSource.indexOf(e)
this.infiniteScroller.scrollToIncludeIndex(t)}}registerListeners(){this.listenTo(this.mapstate,"change:skipRender",(()=>{this.handleChangeSkipRender()}))
this.listenTo(this.mapstate.polymer(),"jump",this.handleJump)
this.listenTo(this.mapstate.polymer(),"cursorJump",this.scrollToIncludeCursor)
this.listenTo(this.infiniteScroller,"scroll",this.handleScroll)
this.listenTo(this.sliceSource,"resizeX",this.debouncedUpdateCutsiteData)
o()(window).on("mouseup.linear",(()=>this.updateSelection()))
if(this.model.get("sequence")instanceof Ge.ComponentsSequence&&this.model.get("sequence").isOligo()&&null==this.model.get("sequence").get("_sequence").complexPolymerId()){const e=this.mapstate.get("visibilityOptions").getOption(Yt.jw.name)
this.listenTo(e,"change:visible",(()=>{e.get("visible")?(0,Me.A9)(d.createElement(OligoPropertiesBanner,{sequenceId:this.model.get("sequence").get("id")}),this.$("#oligo-properties")[0]):(0,u.unmountComponentAtNode)(this.$("#oligo-properties")[0])}))}Re().select(this.el).on(`${mr.C$}.linear`,(e=>{const t=(e=Re().event).wheelDelta?e.wheelDelta:e.detail?-40*e.detail:e&&e.wheelDelta?e.wheelDelta:0
if(e.ctrlKey){t<0?this.mapstate.changeZoomByStep(2*Math.floor(t/120/2)):this.mapstate.changeZoomByStep(2*Math.ceil(t/120/2))
e.preventDefault()}}))}updateSelection(){this.model.polymer().get("selection").set({active:null})}maxBases(){return this.mapstate.get("maxBases")}handleScroll(e,t){if(this.mapstate.polymer().get("selection").get("active")&&null!=t){this.infiniteScroller.findSliceByTop(t).updateSelectionFromScroll(e)
document.getSelection().removeAllRanges()}this.repositionBubble()}handleChangeSkipRender(){this.$(".scroll-wrapper").toggleClass("hidden",this.mapstate.get("skipRender"))}render(){super.render()
this.registerListeners()
if(this.model.get("sequence")instanceof Ge.ComponentsSequence&&this.model.get("sequence").get("writable")){const e=o()('<div id="parts-warning-banner"></div>')
this.$el.prepend(e);(0,Me.A9)(d.createElement(EP.Z,{sequenceId:this.model.get("sequence").get("id")}),e[0])}if(this.model.get("sequence")instanceof Ge.ComponentsSequence&&this.model.get("sequence").isOligo()&&null==this.model.get("sequence").get("_sequence").complexPolymerId()){const e=o()('<div id="oligo-properties"></div>')
this.$el.prepend(e)
this.mapstate.get("visibilityOptions").getOption(Yt.jw.name).get("visible")&&(0,Me.A9)(d.createElement(OligoPropertiesBanner,{sequenceId:this.model.get("sequence").get("id")}),e[0])}const e=o()('<div class="reset scroll-wrapper"></div>')
this.$el.addClass((0,g.iv)(TP.linearMap))
this.$el.append(e)
this.handleChangeSkipRender()
e.append(this.infiniteScroller.render().el)
e.append(this.infiniteScrollbar.render().el)
if(this.model.get("sequence")instanceof Ge.ComponentsSequence&&this.model.get("sequence").supportsChemicalMods()){this.$el.addClass((0,g.iv)(TP.linearMapWithLegend))
const e=o()('<div id="modified-nucleotides-legend"></div>')
e.addClass((0,g.iv)(TP.legend))
this.$el.append(e)
const renderLegend=()=>{(0,Me.A9)(d.createElement(Gs.ZP,{sequenceId:this.model.get("sequence").get("id")}),e[0])}
this.listenTo(this.model.get("sequence"),"splitWorkspace",(()=>{renderLegend()}))
renderLegend()}return this}},TP=g.mM.create({linearMap:{overflow:"hidden"},linearMapWithLegend:{display:"flex",flexDirection:"column"},legend:{display:"flex",width:"100%"}})
class PolymerSliceItemSource extends ar.KC{static initClass(){this.SIDEPADDING=15
this.SCROLLBAR_WIDTH=10}initialize(e){super.initialize(...arguments)
this.mapstate=e.mapstate
this.tabstate=e.tabstate
this.calcMaxBases()
this.updateLength()
this.listenTo(this.tabstate.get("bufferViewLayout"),"change:height",(function(){return this.trigger("resizeY")}))
this.listenTo(this.tabstate.get("bufferViewLayout"),"change:width",this.calcMaxBases)
this.listenTo(this.mapstate,"change:zoom",this.calcMaxBases)
this.listenTo(this.mapstate,"change:maxBases",(function(){return this.updateLength()}))
this.listenTo(this.mapstate,"change:maxBases",this.resizeXHandler)}getBasesLayout(){throw new Error("Not implemented")}_logBadMaxBases(e){let t={}
try{t={maxBases:e,layoutWidth:this.tabstate.get("bufferViewLayout").get("width"),elWidth:this.tabstate.get("bufferViewLayout").get("el").find(".buffer-tab-wrapper").width(),typeWidth:this.getBasesLayout().get("type")._width}}catch(e){t={}}Fe.ZK("Expected maxBases to be a positive number",{extra:t})}calcMaxBases(){var e
const t=this.tabstate.get("bufferViewLayout").get("width"),n=this.getBasesLayout().get("type"),a=null!=(e=this.tabstate.BASES_PER_SLICE_ADJUSTMENT)?e:0
let i=/Firefox/i.test(navigator.userAgent)?n.numChars(t-2*PolymerSliceItemSource.SIDEPADDING-PolymerSliceItemSource.SCROLLBAR_WIDTH):n.numChars(t-2*PolymerSliceItemSource.SIDEPADDING-PolymerSliceItemSource.SCROLLBAR_WIDTH+PolymerSliceItemSource.SIDEPADDING/2)
i+=a
const s=i>0
if(!s){this._logBadMaxBases(i)
i=80}this.mapstate.set({maxBases:i,skipRender:!s})
return i}resizeXHandler(){let e
const t=this.mapstate.polymer().selection(),n=this.get("scroller").firstRendered().item().slice.get("start"),a=Math.floor(n/this.mapstate.get("maxBases")),i=Math.floor(t.start()/this.mapstate.get("maxBases"))
e=t.isEmpty()?i:Math.floor(t.end()/this.mapstate.get("maxBases"))
const s=l.default.any(this.get("scroller").renderedItems,(t=>{let n
return i<=(n=t.index())&&n<=e}))
this.trigger("resizeX",s?i:a)}sliceData(e){const t=this.mapstate.get("maxBases"),n=this.mapstate.polymer().length(),a=t*e,i=Math.min(a+t,n),s=this.getBasesLayout().get("type").width(i-a)+this.getBasesLayout().get("type").letterSpacing,r=Re().scale.linear().clamp(!0).domain([a,i]).range([0,s]),o=Re().scale.linear().clamp(!0).domain([0,s]).range([a,i]),c=this.tabstate.get("bufferViewLayout").get("width")
return l.default.extend({start:a,end:i,width:s,x:r,xInv:o,maxWidth:c,visibleWidth:c,height:100.1,y:0},this.extraSliceData(e))}extraSliceData(){return{}}indexOf(e){const t=this.mapstate.get("maxBases")
return Math.floor(e/t)}update(){this.updateLength()
l.default.each(this.get("scroller").renderedItems,(e=>{const t=e.item()
this.updateItem(t,e.index())}))}updateItem(e,t){const n=this.sliceData(t)
e.slice.set(n,{skipUpdate:!0})
e.update()}getItem(e){const t=Ts.linear,n=new Yi.Z(this.sliceData(e)),a=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=new SliceView({slice:n,selection:this.mapstate.polymer().selection(),model:this.mapstate,tabstate:this.tabstate,mapType:t,el:a,focusableParent:this.$linear,y:this.sliceViewY(),z:this.sliceViewZ(),svgSupportsForeignObject:(0,ja.p8)()})
Re().select(a).classed(i.className,!0)
return i}updateLength(){this.set("length",Math.ceil(this.mapstate.polymer().length()/this.mapstate.get("maxBases")))}setScroller(e){this.set("scroller",e)}sliceViewY(){throw new Error("Not implemented")}sliceViewZ(){throw new Error("Not implemented")}}PolymerSliceItemSource.initClass()
const vP=PolymerSliceItemSource
class SequenceLinearMap extends bP{static initClass(){this.prototype.id="linear-map"
this.prototype.inputSource="linear-input"}initialize(e){this._onAnalysisUpdate=this._onAnalysisUpdate.bind(this)
super.initialize(e)
this._setAnalysis(null)
this._listenToAnalysis()
this.debouncedUpdateCutsiteData=(0,It.D)(this.updateCutsiteData,1)
this.updateCutsiteData();(0,as.hM)(this.mapstate.get("sequence"),this.model.get("title"))}getType(){return this.mapstate.get("layout").DNA.get("type")}storeRegionInBenchlingClipboard(e){return qn.ZP.maybeStoreNucleotideRegionInBenchlingClipboard(this.mapstate.get("sequence").selection(),e)}handlePasteText(e){qn.ZP.handlePasteText(this.mapstate.get("sequence"),e)}handleCtrlShiftC(e){return qn.ZP.handleCtrlShiftC(this.mapstate.get("sequence"),e)}addPolymersForSearch(){qn.ZP.addPolymersForSearch(this.model.get("sequence"))}removePolymersForSearch(){qn.ZP.removePolymersForSearch(this.model.get("sequence"))}stopListening(){if(0===arguments.length){super.stopListening()
o()(window).off(".linear")
this.$el.off(".linear")
Ur.Z.removeChangeListener(this._onAnalysisUpdate)}else super.stopListening(...arguments)}_setAnalysis(e){this.analysisId=e
this._onAnalysisUpdate()}_listenToAnalysis(){const e=this.mapstate.get("sequence").fileState(),t=e.findTab(Gr.Z,(e=>e.get("active")))
if(null==t){if(null!=e.findTab(Gr.Z,(e=>e.analysisId()===this.analysisId)))return
this._setAnalysis(null)
return}const n=t.analysisId()
this.analysisId!==n&&this._setAnalysis(n)}_onAnalysisUpdate(){const{analyses:e}=Ur.Z.getState(),t=null!=e[this.analysisId]?e[this.analysisId]:null
null==t&&(this.analysisId=null)
this.mapstate.get("layout").PAMSites.set({analysis:t})}registerListeners(){super.registerListeners()
this.mapstate.get("sequence").fileState().buffers().forEach((e=>{this.listenTo(e.tabs(),"add remove reset change:active",this._listenToAnalysis)}))
Ur.Z.addChangeListener(this._onAnalysisUpdate)
const e=this.mapstate.get("sequence").get("cutsites")
hP.addListeners(this,e,this.debouncedUpdateCutsiteData)}updateCutsiteData(){const e=this.makeSlicesForCutsites()
T.setCutsiteData(this.mapstate.get("sequence"),e,this.maxBases())
for(const e in this.infiniteScroller.indexMap){const t=this.infiniteScroller.indexMap[e],{slice:n}=t.item(),a=null!=this.sliceSource.cutsiteSlices[e]?this.sliceSource.cutsiteSlices[e].get("cutData"):void 0
null!=a&&n.set("cutData",a)}}createSliceItemSource(e){return new SliceItemSource(e)}makeSlicesForCutsites(){this.sliceSource.makeSlices()
return this.sliceSource.cutsiteSlices}isValidCharacter(e){return this.model.get("sequence").isOligo()&&(0,yn.JG)()?(0,y.isValidMixedBaseSequence)(e):(0,y.isValidBase)(e,this.model.get("sequence").get("_sequence").baseTable())}_getBubbleOffsetClass(){return".dna"}showInputBubble(e){qn.ZP.showInputBubble(this,e)}}SequenceLinearMap.initClass()
class SliceItemSource extends vP{initialize(e){super.initialize(e)
this.slices=new gP
this.debouncedUpdate=(0,It.D)(this.update,1)
this.debouncedSetCutsiteRange=(0,It.D)(this.setCutsiteRange,100)
this.cutsiteSlices=e.cutsiteSlices
this.listenTo(this.mapstate.get("sequence"),"cutswherepls",this.setCutsiteRange)
this.listenTo(this.mapstate.get("sequence")._sequence(),"change:bases change:offset3 change:offset5",this.update)
this.listenTo(this.mapstate.get("sequence").get("_sequence"),"change:parts",this.update)
this.listenTo(this.mapstate.get("sequence").annotations(),"layerChange",(function(){return this.updateAllSliceViews("annotations")}))
this.listenTo(this.mapstate.get("sequence").sequencePrimers(),"layerChange",(function(){this.updateAllSliceViews("forwardPrimers")
this.updateAllSliceViews("reversePrimers")}))
dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS&&this.listenTo(this.mapstate.get("sequence").parts(),"layerChange",(()=>this.updateAllSliceViews("partAnnotations")))
this.listenTo(this.mapstate.get("sequence").orfs(),"reset",(function(){return this.updateAllSliceViews("orfs")}))
this.listenTo(this.mapstate.get("sequence").translations(),"layerChange",(function(){this.updateAllSliceViews("translations")}))
this.listenTo(this.mapstate.get("sequence")._sequence().translations(),"change:translationGroupId",(function(){this.updateAllSliceViews("translations")}))}getBasesLayout(){return this.mapstate.get("layout").DNA}makeSlices(){const e=this.mapstate.get("maxBases"),t=this.mapstate.get("sequence").length(),n=Math.max(1,Math.ceil(t/e))
this.cutsiteSlices=(()=>{if(this.mapstate.get("sequence").isReallyBig()){const e={},t=this.get("scroller").indexMap
for(const n in t)e[n]=new Yi.Z
return e}this.slices.reset(function Linear_range_(e,t,n){const a=[],i=e<t,s=n?i?t+1:t-1:t
for(let t=e;i?t<s:t>s;i?t++:t--)a.push(t)
return a}(0,n,!1).map((e=>({}))))
return this.slices.models})()}setScroller(e){super.setScroller(e)
this.makeSlices()
this.listenTo(e,"scroll",this.debouncedSetCutsiteRange)}updateAllSliceViews(e){l.default.each(this.get("scroller").items(),(t=>t.updateComponent(e)))}setCutsiteRange(){const e=this.get("scroller").firstRendered().item().slice.get("start"),t=this.get("scroller").lastRendered().item().slice.get("end")
if(this.mapstate.get("sequence").isReallyBig()){this.makeSlices()
this.mapstate.get("sequence").trigger("cutstherepls",{start:e,end:t})}}extraSliceData(e){return{cutData:null!=this.cutsiteSlices[e]?this.cutsiteSlices[e].get("cutData"):[]}}sliceViewY(){if(this.mapstate.get("complexPolymerType")===uP.Jt.OLIGO_CONJUGATE)return Kt.OLIGO_CONJUGATE_MAP_Y_COMPONENTS
const e=this.mapstate.get("sequence")
return e.isOligo()?Kt.OLIGO_MAP_Y_COMPONENTS:e.isRNASequence()?Kt.RNA_LINEAR_MAP_Y_COMPONENTS:Kt.LINEAR_MAP_Y_COMPONENTS}sliceViewZ(){if(this.mapstate.get("complexPolymerType")===uP.Jt.OLIGO_CONJUGATE)return Kt.OLIGO_CONJUGATE_MAP_Z_COMPONENTS
const e=this.mapstate.get("sequence")
return e.isOligo()?Kt.OLIGO_MAP_Z_COMPONENTS:e.isRNASequence()?Kt.RNA_LINEAR_MAP_Z_COMPONENTS:Kt.LINEAR_MAP_Z_COMPONENTS}}var CP=n(669327),IP=n(728417)
function CreatePDFButton({onOpenPreview:e}){return d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,text:"Create PDF",onClick:e})}var wP=n(239460)
function OptionsBanner({bannerText:e}){return d.createElement(CP.Z,{className:"buffer-options-item--bannerContainer"},null!=e&&d.createElement(wP.Z,{message:e}))}function SearchButton({onToggleSearch:e}){return d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,icon:"search",onClick:e})}function BaseSlider(e){const{className:t,leftIcon:n,onLeftIconClick:a,rightIcon:i,onRightIconClick:s,disabled:r,...o}=e,l={border:`1px solid ${Vt.Uq}`,cursor:r?"not-allowed":"pointer"}
return d.createElement("div",{className:f()((0,g.iv)(NP.container),t)},d.createElement(pe.Z,{icon:n,onClick:r?void 0:a,className:r?(0,g.iv)(NP.disabledCursor):(0,g.iv)(NP.pointerCursor)}),d.createElement(Wp.Z,{...o,className:(0,g.iv)(NP.slider),disabled:r,trackStyle:{...l,backgroundColor:"#f6a828"},railStyle:l,handleStyle:{border:`1px solid ${Vt.TG}`,opacity:1}}),d.createElement(pe.Z,{icon:i,onClick:r?void 0:s,className:r?(0,g.iv)(NP.disabledCursor):(0,g.iv)(NP.pointerCursor)}))}function ZoomSlider(e){const{zoomSmaller:t,zoomBigger:n,...a}=e
return d.createElement(BaseSlider,{leftIcon:"minus-large",onLeftIconClick:t,rightIcon:"plus-large",onRightIconClick:n,...a})}function PanSlider(e){const{panLeft:t,panRight:n,...a}=e
return d.createElement(BaseSlider,{leftIcon:"arrow-left",onLeftIconClick:t,rightIcon:"arrow-right",onRightIconClick:n,...a})}const NP=g.mM.create({container:{display:"flex",width:"100px"},slider:{margin:"0px 8px"},disabledCursor:{cursor:"not-allowed"},pointerCursor:{cursor:"pointer"}})
function getStrandedMenuOption(e,t,n,a={}){return n?d.createElement(N.Z,{value:1,onSelect:t},e):d.createElement(N.Z,null,e,d.createElement(w.ZP,null,d.createElement(N.Z,{...a,value:1,onSelect:t},"Forward"),d.createElement(N.Z,{...a,value:-1,onSelect:t},"Reverse")))}function DropdownMenus(e){const t=0===e.selectionLength,n=e.selectionLength%3==0
return d.createElement(d.Fragment,null,d.createElement(I.ZP,{menu:d.createElement(w.ZP,{width:Nr.zL.SMALL},d.createElement(N.Z,{onSelect:e.createAnnotation},"Annotation"),getStrandedMenuOption("Primer",e.createPrimer,!1),getStrandedMenuOption("Translation",e.createTranslation,e.isSingleStranded),getStrandedMenuOption("New AA sequence",e.createProtein,e.isSingleStranded),d.createElement(N.Z,{onSelect:()=>{e.createSequence(fn.uS.DOUBLE_STRANDED)}},"New DNA"),getStrandedMenuOption("New RNA",(t=>{e.createSequence(fn.uS.SINGLE_STRANDED,t)}),e.isSingleStranded),d.createElement(N.Z,{onSelect:e.createPart,isDisabled:e.isCreateNewPartFromSelectionDisabled},"New part"))},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,isDropdown:!0,text:"Create",size:C.qE.MINI,disabled:t,onMouseDown:e.onClickCreate})),d.createElement(I.ZP,{menu:d.createElement(w.ZP,{width:Nr.zL.SMALL},d.createElement(N.Z,{onSelect:e.runPrimer3},"Run Primer3"),dt.ZP.ENABLE_BLAST_SEARCH&&d.createElement(N.Z,{isDisabled:!e.isBenchlingBlastable,tooltipTitle:e.isBenchlingBlastable?void 0:"The selected residues are too long or not eligible for BLAST.",onSelect:e.runBenchlingBlast},jn.Y6),dt.ZP.MOLBIO_ENABLE_EXTERNAL_BLAST&&d.createElement(N.Z,{isDisabled:!e.isNcbiBlastable,tooltipTitle:e.isNcbiBlastable?void 0:`NCBI BLAST is limited to ${IP.oH} base pairs.`,onSelect:e.runNcbiBlast},jn.wL),d.createElement(N.Z,{onSelect:e.analyzeAsTranslation},"Analyze as translation"),!e.isRnaSequence&&getStrandedMenuOption("Optimize codons",e.handleOptimizeCodonsFromSelectionClick,!1,{isDisabled:!n,tooltipTitle:n?void 0:"Selection isn't a multiple of 3."}))},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,isDropdown:!0,text:"Analyze",size:C.qE.MINI,disabled:t,onMouseDown:e.onClickAnalyze})))}function LinearOptions(e){const{isOligo:t,zoomSliderProps:n,bannerText:a,selectionLength:i,isCopyable:s,onCopy:r,onOpenPreview:o,visibilityOptions:l,featureCounts:c,onToggleSearch:u,allowFeatureEdits:m,...p}=e
return d.createElement("div",{className:"buffer-options-container",...(0,ee.Z)({component:"LinearOptions",element:"root"})},d.createElement(CP.Z,null,!t&&d.createElement(ZoomSlider,{...n})),d.createElement(OptionsBanner,{bannerText:a}),d.createElement(CP.Z,{className:"u-vertical-center-items"},d.createElement(P.ZP,{title:"Select bases to create features, analyze, or copy.",placement:P.TQ.BOTTOM,disabled:0!==i},d.createElement(Pr.Z,null,!t&&m&&d.createElement(DropdownMenus,{...p,selectionLength:i}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,text:"Copy",dataTestAttrs:{component:"LinearOptions",element:"button",key:"copy"},onClick:r,disabled:!s}))),d.createElement(Pr.Z,null,d.createElement(CreatePDFButton,{onOpenPreview:o})),d.createElement(Pr.Z,null,d.createElement(St.Z,{options:l,featureCounts:c}),d.createElement(SearchButton,{onToggleSearch:u}))))}class SequenceOptionsView extends s().View{static initClass(){this.prototype.tagName="div"
this.prototype.className="reset"}initialize(e){this.mapstate=this.model.get("mapstate")
const t=this.mapstate.sequence()
this.handleBigSequence()
this.listenTo(t,"change:banner",(()=>{this.render()}))
this.listenTo(t._sequence(),"change:bases",(()=>{this.handleBigSequence()}))
for(const e of this.trackedFeatureCollections()){const n=t[e]()
if("parts"===e){this.listenTo(t._sequence(),"change:parts",(()=>this.render()))
this.listenTo(n,"add remove reset change",(()=>this.render()))}else{const e=this.listenToBatch(n,(()=>this.render()))
this.listenTo(n,"add remove reset",(()=>{e()}))}}}getProps(){const e=this.mapstate.sequence()
return{bannerText:e.getBannerText(),featureCounts:(0,Jt.m8)(this.trackedFeatureCollections().map((t=>[t,e[t]().getCount()]))),visibilityOptions:this.model.get("visibilityOptions"),onToggleSearch:()=>{const e=$a.C.get(),t=null!=e.get("mode")
e.trigger(t?"close":"open")},onOpenPreview:()=>{const t={source:this.previewSourceName,sequence_api_id:e.get("_sequence").id,sequence_length:e.length()}
new xt({paginate:e=>this.previewPaginate(this.model,this.mapstate,e),landscape:!1,trackMetadata:t,filename:(0,Hs.Z)(`${e.name()}-sequence`,"pdf")}).render()
m.j("editor","opened_pdf_preview",t)}}}}SequenceOptionsView.initClass()
const AP=SequenceOptionsView,RP={[Kt.MapType.PLASMID]:"Plasmid map",[Kt.MapType.LINEAR_SEQUENCE]:"Sequence map",[Kt.MapType.MINIMAP]:"Linear map"}
function MapSelector({mapType:e,onSelectMapType:t,isCircular:n}){const a=n?[Kt.MapType.LINEAR_SEQUENCE,Kt.MapType.PLASMID,Kt.MapType.MINIMAP]:[Kt.MapType.LINEAR_SEQUENCE,Kt.MapType.MINIMAP]
return d.createElement($r.ZP,{displayName:`View: ${RP[e]}`,buttonSize:C.qE.MINI,menu:d.createElement(w.ZP,{width:Nr.zL.FULL},a.map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:t},RP[e]))))})}function SimplifiedLinearOptions({isOligo:e,mapType:t,onSelectMapType:n,isCircular:a,zoomSliderProps:i,visibilityOptions:s,featureCounts:r}){return d.createElement("div",{className:"buffer-options-container"},d.createElement(CP.Z,null,!e&&d.createElement(MapSelector,{mapType:t,onSelectMapType:n,isCircular:a})),d.createElement(CP.Z,null,!e&&d.createElement(ZoomSlider,{...i})),d.createElement(CP.Z,{className:(0,g.iv)(PP.expander)}),d.createElement(CP.Z,{className:"u-vertical-center-items"},d.createElement(St.Z,{options:s,featureCounts:r})))}const PP=g.mM.create({expander:{flex:1}})
class LinearMapTabOptionsView extends AP{constructor(){super(...arguments)
this.previewSourceName="linear"
this.previewPaginate=linearPaginate}trackedFeatureCollections(){const e=["annotations","sequencePrimers","translations"]
dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS&&e.push("parts")
return e}getProps(){const e=this.mapstate.sequence(),t=e.selection()
return{...super.getProps(),allowFeatureEdits:e.allowFeatureEdits(),isOligo:e.isOligo(),isRnaSequence:e.isRNASequence(),isSingleStranded:e.isSingleStranded(),onCopy:()=>{e.handleCopy((0,Fn.Cd)(e))},selectionLength:e.selection().length(),zoomSliderProps:{min:this.mapstate.get("minZoom"),max:this.mapstate.get("maxZoom"),value:this.mapstate.get("zoom"),step:this.mapstate.get("stepZoom"),disabled:!1,onChange:e=>this.mapstate.setZoom(e),zoomSmaller:()=>this.mapstate.changeZoomByStep(-10),zoomBigger:()=>this.mapstate.changeZoomByStep(10)},createProtein:t=>{e.handleCreateProteinFromSelectionClick(t)},createAnnotation:()=>{m.j("annotation","open_annotation_panel",{product:j.XC.MOLBIO,openedFrom:"create_options",sequence_id:e.get("id")})
t.trigger("annotation")},createPrimer:t=>{m.j("primer","open_edit_primer_tab",{product:j.XC.MOLBIO,createdFrom:"create_options",direction:(0,An.FC)(t).toLowerCase(),sequence_id:e.get("id")})
const n=sn.createFromSelection(e,t)
e.fileState().buffers().addTab(n)},createTranslation:t=>{m.j("translation","open_translation_panel",{product:j.XC.MOLBIO,openedFrom:"create_options",strand:t,sequence_id:e.get("id")})
e.createTranslation(t)},runBenchlingBlast:()=>(0,Yn.ld)(t),runNcbiBlast:()=>{blastSequence(e)},runPrimer3:()=>{e.handlePrimer3FromSelectionClick()},analyzeAsTranslation:()=>{openOrCreateBiochemicalPropertiesTab(e,R.hR.STANDARD)},handleOptimizeCodonsFromSelectionClick:t=>{e.handleOptimizeCodonsFromSelectionClick(t)},createSequence:(t,n)=>{e.handleCreateFromSelectionClick(t,n)},createPart:()=>{e.handleCreatePartFromSelectionClick()},isCopyable:t.isCopyable(),isBenchlingBlastable:!t.isEmpty()&&(0,Qn.H_)(t.getSelectionResidues(),Kn.EF.BLASTN).isValid,isNcbiBlastable:t.isBlastable(),isCreateNewPartFromSelectionDisabled:isCreateNewPartFromSelectionDisabled(e),onClickCreate:()=>{(0,as.tg)(e)},onClickAnalyze:()=>{(0,as.YZ)(e)}}}handleBigSequence(){const e=this.mapstate.sequence().isReallyBig()
this.model.get("visibilityOptions").getOption(Yt.D1.name).set("disabled",e)}initialize(e){super.initialize(e)
this.listenTo(this.mapstate,"change:zoom change:minZoom change:maxZoom change:stepZoom",(()=>this.render()))
this.listenTo(this.model.get("visibilityOptions"),"open",(()=>{(0,S.Gp)(!1,"Reached code that we thought was dead")
this.$el.find(".display-options").parent().addClass("open")}))
const t=this.mapstate.sequence()
this.listenTo(t.selection(),"change:start change:end",(()=>this.render()))
this.listenTo(t,"change:currentVersion change:writable change:permissions",(()=>this.render()))
this.listenTo(t._sequence(),"change:locked",(()=>this.render()))}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}render(){(0,Me.A9)(d.createElement(LinearOptions,{...this.getProps()}),this.el)
return this}}const OP=xa.Ps`
  query ComplexPolymerStructureQuery($complexPolymerId: StrictString!, $versionId: StrictString!)
  @engComponent(name: MODIFIED_BIOLOGICS)
  @skipAudit {
    complexPolymer(id: $complexPolymerId, versionId: $versionId) {
      ... on ComplexPolymerNode {
        id
      }
      ... on OligoConjugateNode {
        id
      }
      ... on ComplexPolymerInterface {
        structure {
          polymers {
            ... on SimplePolymerInterface {
              id
              polymerType
            }
            ... on NucleotideSequencePolymerNode {
              id
              bases
              nucleotideType
              modifiedNucleotides {
                position
                sugarMonomerId
                baseMonomerId
                phosphateMonomerId
              }
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ComplexPolymerMap(e){const t=(0,_a.v9)((t=>t.ui.modbio.complexPolymerVersionUIs[e.complexPolymerId].complexPolymerVersionId))
return d.createElement(Da.ZP,{query:OP,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,variables:{complexPolymerId:e.complexPolymerId,versionId:t}},(t=>{if((0,ka.CZ)(t.complexPolymer))return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:`You do not have permission to view this ${uP.TV[uP.Jt.OLIGO_CONJUGATE]}`})
const n=(0,mP.C$)(t.complexPolymer);(0,S.Gp)(!n,"Expected complex polymer entity")
if(n)return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:`Entity is not an ${uP.TV[uP.Jt.OLIGO_CONJUGATE]}`})
if((0,mP.Sl)(t.complexPolymer))return d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:`${(0,Mt.kC)(uP.TV[uP.Jt.OLIGO_CONJUGATE])} structure is empty`})
const a=(0,mP.Gx)(t.complexPolymer.structure.polymers),i=a.version,s=(0,xo.m9)(a,i,e.complexPolymerId)
return d.createElement("div",{className:f()("reset")},d.createElement("div",{className:"buffer-container"},d.createElement(mt,{tabState:new dP({sequence:s}),TabOptionsViewCls:LinearMapTabOptionsView,TabContentViewCls:SequenceLinearMap})))}))}function ComplexPolymerMapTab(e){return d.createElement("div",{className:"react-tab-container"},d.createElement(ComplexPolymerMap,{...e}))}class ComplexPolymerMapTabView extends Js{render(){const e={complexPolymerId:this.model.get("complexPolymerId")};(0,Me.A9)(d.createElement(ComplexPolymerMapTab,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ComplexPolymerMapTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var xP=n(381794),_P=n(838523),DP=n(18526)
var LP=n(550977),kP=n(18487)
const MP={requeryOligoConjugate:async(e,t)=>await(0,DP.W)().query({query:YP,variables:{complexPolymerId:e,versionId:t},fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0})}
async function ComplexPolymerActions_createOligoConjugate(e,t,n,a){const i=(0,LP.sj)(a),{complexPolymerId:s}=await async function createOligoConjugate(e,t,n,a,i){return await Cn.s0({url:"/1/api/oligo-conjugates",data:{name:e,folderId:t,schemaId:n,tags:a,entityAssociations:i}})}(e,t,n,a,i)
ve.ZP.get().openFolderItem(s)}async function refetchUpdatedOligoConjugate(e,t){return await MP.requeryOligoConjugate(e,t)}async function ComplexPolymerActions_updateOligoConjugate(e,t,n,a){const i=await async function updateOligoConjugate(e,t,n,a){return await Cn.s0({url:`/1/api/oligo-conjugates/${e}/actions/update-structure`,data:{entityIds:t,connectionInputs:n,entityAssociations:a}})}(e,t,n,a);(0,Vn.getStore)().dispatch((0,kP.ME)(e,i.versionId))
await refetchUpdatedOligoConjugate(e,i.versionId)
v.ZP.success("Successfully updated oligo conjugate structure")
Sa.Z.dispatch({actionType:fa.JFe,tagData:[{id:e,tags:i.tags}]})}async function ComplexPolymerActions_resetOligoConjugateVersion(e,t,n){const a=await async function resetOligoConjugateVersion(e,t,n){return await Cn.s0({url:`/1/api/oligo-conjugates/${e}/actions/reset-version`,data:{versionId:t,expectedCurrentVersionId:n}})}(e,t,n);(0,Vn.getStore)().dispatch((0,kP.ME)(a.complexPolymerId,a.versionId))
await refetchUpdatedOligoConjugate(e,a.versionId)
v.ZP.success("Successfully reset oligo conjugate version")
Sa.Z.dispatch({actionType:fa.JFe,tagData:[{id:e,tags:a.tags}]})}var FP=n(956435),ZP=n(294120),BP=n(619174),qP=n(374669),VP=n(627259),UP=n(343106)
function initializeSearchParams(e,t){const n=(0,Vn.getStore)(),a=function defaultSearchParams(e,t){return{filters:[{...(0,Kn.QW)(Kn.Vm.TYPES),value:t},{...(0,Kn.QW)(Kn.Vm.SCHEMA),operator:Kn.EF.IS_ONE_OF,value:[...e]},...(0,qP.hN)(ZP.$0.COMPLEX_POLYMERS)],offset:0,limit:25,query:"",sorts:[]}}(e,t)
n.dispatch((0,VP._c)(ZP.$0.COMPLEX_POLYMERS,Kn.Sc.FOLDERS_AND_ITEMS,a,(0,wN.yO)(a.filters)))}function ComplexPolymerComponentSearchViewListing(e){const[t,n]=(0,d.useState)(!0),a=function getAvailableSchemasFilter(e){return t=>{const n={}
for(const a of Object.keys(t)){const i=t[a].filter((t=>e.includes(t.id)))
n[a]=i}return n}}(e.schemaIds)
return d.createElement(BP.ZP,{...e,isTypeRequired:!0,isCompactDisplay:t,setIsCompactDisplay:n,isExpanded:!0,activeItemId:null,enableToggleExpanded:!1,onSelectIds:t=>{e.onSelectIds(t)
e.setSelectedIds(t)},actionSource:j.D2.MODBIO_COMPLEX_POLYMERS,availableTypes:e.componentTypes,makeCrumbs:void 0,extraPrimaryFilterOptions:[{filterKey:Kn.Vm.ANCESTOR_FOLDER}],availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_IDENTIFIER_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],renderToolbar:()=>d.createElement(d.Fragment,null),preservedFilterKeys:[Kn.Vm.TYPES,Kn.Vm.SCHEMA],section:ZP.$0.COMPLEX_POLYMERS,disableOpenItem:!0,disableBLAST:!0,rowSelectionMode:e.rowSelectionMode,alwaysShowSelector:!0,filterSchemas:a})}function ComplexPolymerComponentSearchView(e){(0,d.useEffect)((()=>{initializeSearchParams(e.schemaIds,e.componentTypes)}),[e.schemaIds,e.componentTypes])
const t=(0,UP.ZP)(ComplexPolymerComponentSearchViewListing,Kn.Sc.FOLDERS_AND_ITEMS,ZP.$0.COMPLEX_POLYMERS,{})
return d.createElement(t,{...e})}function ComplexPolymerComponentSearchModal({onRequestClose:e,schemaIds:t,componentTypes:n,complexPolymerTypeDescriptor:a,onSubmit:i,titleText:s,submitButtonText:r,rowSelectionMode:o,isDisabled:l}){const[c,u]=(0,d.useState)([])
let m=0===c.length
l&&(m=l(c))
const p=[{text:"Cancel",cancel:!0},{text:r,disabled:m,submit:!0}]
return d.createElement(et.ZP,{title:s,large:!0,buttons:p,onRequestClose:e,fullWidth:!0,fullHeight:!0,scrollable:!1,onRequestSubmit:async()=>{$e.$Z(`Updating ${a}...`)
try{await i(c)}finally{e()
$e.Cp()}}},d.createElement("div",{className:(0,g.iv)(GP.bodyContainer)},d.createElement(ComplexPolymerComponentSearchView,{schemaIds:t,setSelectedIds:u,componentTypes:n,rowSelectionMode:o})))}const GP=g.mM.create({pageContainer:{display:"flex",flexDirection:"column",height:"100%",overflowY:"scroll"},bodyContainer:{display:"flex",flexDirection:"column",height:"100%"}}),zP=xa.Ps`
  query ComplexPolymerAddConjugateQuery($id: StrictString!, $versionId: StrictString!)
  @skipAudit
  @engComponent(name: MODIFIED_BIOLOGICS) {
    complexPolymer(id: $id, versionId: $versionId) {
      ... on OligoConjugateNode {
        id
        structure {
          polymers {
            ... on SimplePolymerInterface {
              id
              helmReference
              entity {
                ... on SequenceNode {
                  id
                }
                ... on MoleculeNode {
                  id
                }
                ... on ProteinNode {
                  id
                }
                ...InaccessibleInfoGraphQL
              }
            }
          }
          connections {
            source {
              polymerHelmReference
              residueIndex
            }
            target {
              polymerHelmReference
              residueIndex
            }
          }
        }
        oligoSchemaField {
          ... on ComplexPolymerSchemaFieldDefinitionNode {
            id
            schemaId
          }
          ...InaccessibleInfoGraphQL
        }
        conjugatesSchemaFields {
          ... on ComplexPolymerSchemaFieldDefinitionNode {
            id
            schemaId
          }
          ...InaccessibleInfoGraphQL
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ComplexPolymerAddConjugateMenu({complexPolymerId:e,versionId:t}){return d.createElement(Da.ZP,{query:zP,variables:{id:e,versionId:t},renderLoading:()=>d.createElement(pe.Z,{className:(0,g.iv)($P.disabledAddIcon),icon:"edit"})},(t=>{(0,S.hu)("OligoConjugateNode"===t.complexPolymer.__typename,"Expected oligo conjugate");(0,S.hu)(null!=t.complexPolymer.conjugatesSchemaFields,"Expected oligo conjugate to have conjugate schema fields")
const n=t.complexPolymer.conjugatesSchemaFields.flatMap((e=>null==e||(0,ka.CZ)(e)?[]:[e])).map((e=>{(0,S.hu)(null!=e.schemaId,"Conjugates field on oligo conjugate must link to a schema")
return e.schemaId})),{structure:a}=t.complexPolymer;(0,S.hu)(null!=a,"Complex polymer structure summary should not be rendered if structure is null")
const i=(0,LP.Co)(a.connections),s=(0,LP.aH)(a.polymers),r=(0,LP.Nc)(a.polymers)
async function addConjugate(t){const n=(0,aR.Z)(r)
for(const e of t){const t=(0,LP.UF)(n,e)
n.hasOwnProperty(e)?n[e].push(t):n[e]=[t]}await ComplexPolymerActions_updateOligoConjugate(e,[...s,...t],i,n)}return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FIT_CONTENT},d.createElement(N.Z,{onSelect:()=>{(0,Xn.Z)(ComplexPolymerComponentSearchModal,{schemaIds:n,componentTypes:[st.MOLECULE],onSubmit:addConjugate,complexPolymerTypeDescriptor:"oligo conjugate",titleText:"Add conjugates",submitButtonText:"Add",rowSelectionMode:Tr.rT.MULTIPLE})}},"Search for molecules"))},d.createElement(pe.Z,{className:(0,g.iv)($P.addIcon),icon:"edit"}))}))}const $P=g.mM.create({addIcon:{cursor:"pointer",color:Vt.t0,marginLeft:"5px"},disabledAddIcon:{color:Vt.tN,marginLeft:"5px"}})
function getOrderedConnectionInputChain(e){const t=[]
t.push(e.connection)
return t.concat(e.linkedMolecules.map((e=>e.connection)))}function getConjugateConnectionsWithRemovedConjugate(e,t){const n=e.findIndex((e=>e.target.polymerHelmReference===t))
return-1===n?e:e.slice(0,n)}async function removeConjugate(e,t,n,a,i){const s=(0,LP.aH)(t),r=s.findIndex((e=>e===a));(0,S.hu)(-1!==r,"Expected to find entity ID to remove in existing entity IDs")
const o=(0,aR.Z)(s)
o.splice(r,1)
const l=function getAllConjugateChains(e){const t=[]
for(const n of e){const e=getOrderedConnectionInputChain(n)
t.push(e)}return t}(n),c=[]
for(const e of l)c.push(getConjugateConnectionsWithRemovedConjugate(e,i))
const d=(0,LP.Co)(c.flat()),u=function getUpdatedEntityAssociations(e,t,n){const a=(0,aR.Z)(e),i=a[t],s=i.findIndex((e=>e===n));(0,S.hu)(-1!==s,"Expected to find polymer reference in entity associations")
i.splice(s,1)
0===i.length?delete a[t]:a[t]=i
return a}((0,LP.Nc)(t),a,i)
await ComplexPolymerActions_updateOligoConjugate(e,o,d,u)}function ComplexPolymerRemoveConjugateWarningModal({onRequestClose:e,onRemoveConjugate:t,complexPolymerName:n,entityId:a}){return d.createElement(et.ZP,{title:"Remove conjugate",medium:!0,buttons:[{text:"Remove conjugate",disabled:!1,submit:!0}],onRequestClose:e,scrollable:!1,onRequestSubmit:async()=>{$e.$Z("Updating oligo conjugate...")
try{await t()}finally{e()
$e.Cp()}}},d.createElement("div",{className:(0,g.iv)(WP.bodyContainer)},d.createElement("span",null,"You are about to remove ",d.createElement(Fa.default,{id:a,isLink:!1,size:Za.TK.MINI})," from"," ",n,"."),d.createElement("span",null,"Are you sure this is what you want to do?")))}const WP=g.mM.create({pageContainer:{display:"flex",flexDirection:"column",height:"100%",overflowY:"scroll"},bodyContainer:{display:"flex",flexDirection:"column",height:"100%"}})
function ComplexPolymerSwapOligoMenu({complexPolymerId:e,simplePolymers:t,oligo:n,oligoSchemaField:a}){function getCurrentOligoId(){const e=t.filter((e=>"SequenceNode"===e.entity.__typename));(0,S.hu)(1===e.length,"Only one sequence expected on an oligo conjugate");(0,S.hu)(!(0,ka.CZ)(e[0].entity),"All component entities of complex polymer must be accessible to edit")
return e[0].entity.id}async function swapOligo(n){(0,S.hu)(1===n.length,"Can only set one oligo on an oligo conjugate")
const a=(0,LP.aH)(t),i=(0,LP.Nc)(t),s=(0,aR.Z)(i),r=getCurrentOligoId()
delete s[r]
s[n[0]]=["RNA1"]
await ComplexPolymerActions_updateOligoConjugate(e,[...a.filter((e=>e!==r)),n[0]],[],s)}(0,S.hu)(!(0,ka.CZ)(a)&&null!=a.schemaId,"Expected schema field to link to entity schema ")
const i=a.schemaId
return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FIT_CONTENT},d.createElement(N.Z,{icon:"swap",onSelect:()=>{(0,Xn.Z)(ComplexPolymerComponentSearchModal,{schemaIds:[i],componentTypes:n.nucleotideType===R.Wy.RNA?[st.SequenceSubtype.RNA_OLIGO]:[st.SequenceSubtype.DNA_OLIGO],onSubmit:swapOligo,complexPolymerTypeDescriptor:"oligo conjugate",titleText:"Swap oligo",submitButtonText:"Swap",rowSelectionMode:Tr.rT.SINGLE,isDisabled:e=>e.includes(getCurrentOligoId())})}},"Change oligo"))},d.createElement(pe.Z,{className:(0,g.iv)(HP.addIcon),icon:"edit"}))}const HP=g.mM.create({addIcon:{cursor:"pointer",color:Vt.t0,marginLeft:"5px"},disabledAddIcon:{color:Vt.tN,marginLeft:"5px"}})
function OligoSummary({oligo:e}){return d.createElement(Fa.BioentityChip,{id:(0,ka.CZ)(e.entity)?null:e.entity.id,size:Za.TK.MINI,validationExtras:null})}function getAttachmentText(e){return null==e.connectionResidueIndex?"":null!=e.linkedMoleculeName?`${(0,LP.xs)(e.connectionResidueIndex)}, ${e.linkedMoleculeName}`:`${(0,LP.xs)(e.connectionResidueIndex)}`}function AttachmentInformation({attachmentText:e,isEditable:t,conjugateConnection:n,onDeleteConnection:a}){const[i,s]=(0,d.useState)(!1),[r,o]=(0,d.useState)(!1)
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(jP.attachmentInformation),onMouseOver:()=>{s(!0)},onMouseOut:()=>{s(!1)}},d.createElement(pe.Z,{icon:"minus-large"}),i&&t?d.createElement(pe.Z,{className:(0,g.iv)(jP.attachmentText),icon:"caret-down",onClick:()=>{o(!r)}}):d.createElement(Fr.Z,{className:(0,g.iv)(jP.attachmentText),label:e})),r&&d.createElement("div",{className:(0,g.iv)(jP.attachmentMenu)},d.createElement(w.ZP,null,d.createElement(N.Z,{key:"remove-connection",value:"remove-connection",onSelect:()=>{a(n)}},"Remove connection"))))}function ConjugateSummary({oligoConjugateId:e,isEditable:t,conjugateConnection:n,allConjugateConnections:a,oligo:i,simplePolymers:s,attachedConjugates:r,complexPolymerName:o,onAddConnection:l,onDeleteConnection:c}){const[u,m]=(0,d.useState)(!1),p=null!=n.connectionResidueIndex,h=getAttachmentText(n),E=function getAttachmentPointOptions(e,t,n,a){const i=(0,Jt.w6)(0,n-1).map((t=>{const n={entityId:e.entityId,entityName:e.entityName,helmReference:e.helmReference,connectionResidueIndex:t,linkedEntityHelmReference:a}
return{name:getAttachmentText(n),value:n}})),s=Object.values(t).filter((t=>t.helmReference!==e.helmReference&&null!=t.connectionResidueIndex)).map((t=>{const n={entityId:e.entityId,entityName:e.entityName,helmReference:e.helmReference,connectionResidueIndex:t.connectionResidueIndex,linkedMoleculeName:t.entityName,linkedEntityHelmReference:t.helmReference}
return{name:getAttachmentText(n),value:n}}))
return i.concat(s)}(n,a,i.bases.length,i.helmReference)
return d.createElement("div",{className:p&&t?(0,g.iv)(jP.conjugateSummaryWithHover):(0,g.iv)(jP.conjugateSummary)},d.createElement("div",null,d.createElement(Fa.BioentityChip,{className:(0,g.iv)(jP.conjugateChip),id:n.entityId,size:Za.TK.MINI,validationExtras:null,...t&&{onRemove:()=>{(0,Xn.Z)(ComplexPolymerRemoveConjugateWarningModal,{entityId:n.entityId,complexPolymerName:o,onRemoveConjugate:async()=>{await removeConjugate(e,s,r,n.entityId,n.helmReference)}})}}}),p?d.createElement(d.Fragment,null,d.createElement(AttachmentInformation,{attachmentText:h,isEditable:t,conjugateConnection:n,onDeleteConnection:c})):t&&d.createElement("div",{className:(0,g.iv)(jP.addAttachment)},d.createElement(pe.Z,{icon:"minus-large"}),d.createElement(C.Co,{className:(0,g.iv)(jP.attachmentButton),buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,icon:"plus",onClick:()=>{m(!u)}}))),u&&d.createElement(d.Fragment,null,d.createElement(Fr.Z,{label:"Add attachment"}),d.createElement(Ar.Z,{className:(0,g.iv)(jP.attachmentMenu),optionDatas:E,onSelect:e=>{m(!1)
l(e)},scrollable:!0,width:w.ZP.WIDTHS.MINI})))}function ConjugatesSummary({oligoConjugateId:e,isEditable:t,attachedConjugates:n,simplePolymers:a,oligo:i,complexPolymerName:s,onAddConnection:r,onDeleteConnection:o}){const l=function makeConjugateConnections(e,t,n){const a={}
t.map((e=>{e.polymerType===Sn.Mp.CHEM&&(a[e.id]={entityId:(0,ka.CZ)(e.entity)?null:e.entity.id,entityName:(0,ka.CZ)(e.entity)?FP.N:e.entity.name,helmReference:e.helmReference})
return null}))
e.map((e=>{(0,S.hu)(a.hasOwnProperty(e.id),"Expected conjugateConnectionMap to have attached molecule in map")
a[e.id]={entityId:(0,ka.CZ)(e.entity)?null:e.entity.id,entityName:(0,ka.CZ)(e.entity)?FP.N:e.entity.name,helmReference:e.polymerHelmReference,connectionResidueIndex:e.residueIndex,linkedEntityHelmReference:n}
e.linkedMolecules.map((t=>{(0,S.hu)(a.hasOwnProperty(t.id),"Expected conjugateConnectionMap to have linked molecule in map")
a[t.id]={entityId:(0,ka.CZ)(t.entity)?null:t.entity.id,entityName:(0,ka.CZ)(t.entity)?FP.N:t.entity.name,helmReference:t.polymerHelmReference,connectionResidueIndex:e.residueIndex,linkedMoleculeName:(0,ka.CZ)(t.connection.source.referencedPolymer.entity)?FP.N:t.connection.source.referencedPolymer.entity.name,linkedEntityHelmReference:t.connection.source.referencedPolymer.helmReference}
return null}))
return null}))
return a}(n,a,i.helmReference)
return d.createElement("div",{className:(0,g.iv)(jP.conjugatesSummary)},Object.keys(l).map((c=>d.createElement("div",{key:c},d.createElement(ConjugateSummary,{oligoConjugateId:e,isEditable:t,conjugateConnection:l[c],allConjugateConnections:l,oligo:i,simplePolymers:a,attachedConjugates:n,complexPolymerName:s,onAddConnection:r,onDeleteConnection:o})))))}function ComplexPolymerStructureSummary({oligoConjugateId:e,versionId:t,isEditable:n,oligo:a,attachedConjugates:i,simplePolymers:s,oligoSchemaField:r,complexPolymerName:o}){const l=function getNumMolecules(e){return e.filter((e=>e.polymerType===Sn.Mp.CHEM)).length}(s),c=function canEditComplexPolymer(e,t){const n=t.filter((e=>(0,ka.CZ)(e.entity)))
return e&&0===n.length}(n,s),getExistingConnectionInputs=e=>i.flatMap((t=>{let n=null
t.polymerHelmReference!==e&&(n={source:{polymer_ref:a.helmReference,residue_index:t.residueIndex},target:{polymer_ref:t.polymerHelmReference,residue_index:null}})
return[n,...t.linkedMolecules.map((t=>{let n=null
t.polymerHelmReference!==e&&(n={source:{polymer_ref:t.connection.source.referencedPolymer.helmReference,residue_index:null},target:{polymer_ref:t.polymerHelmReference,residue_index:null}})
return n}))]})).filter((e=>null!=e)),updateComplexPolymer=t=>{const n=s.map((e=>{(0,S.hu)(!(0,ka.CZ)(e.entity),"Expected entity to be accessible")
return e.entity.id})),a={}
s.map((e=>{(0,S.hu)(!(0,ka.CZ)(e.entity),"Expected entity to be accessible")
a.hasOwnProperty(e.entity.id)?a[e.entity.id].push(e.helmReference):a[e.entity.id]=[e.helmReference]
return null}))
ComplexPolymerActions_updateOligoConjugate(e,n,t,a)}
return d.createElement("div",{className:(0,g.iv)(jP.summary)},d.createElement("div",{className:(0,g.iv)(jP.entityHeader)},d.createElement(h.Z,null,d.createElement(Fr.Z,{label:"Oligo"}),c&&d.createElement(ComplexPolymerSwapOligoMenu,{complexPolymerId:e,simplePolymers:s,oligo:a,oligoSchemaField:r}))),d.createElement(h.Z,null,d.createElement(OligoSummary,{oligo:a})),d.createElement("div",{className:(0,g.iv)(jP.entityHeader)},d.createElement(h.Z,null,d.createElement(Fr.Z,{label:`Conjugates (${l})`}),c&&d.createElement(ComplexPolymerAddConjugateMenu,{complexPolymerId:e,versionId:t}))),d.createElement(h.Z,null,d.createElement(ConjugatesSummary,{oligoConjugateId:e,isEditable:c,attachedConjugates:i,simplePolymers:s,oligo:a,complexPolymerName:o,onAddConnection:e=>{const t=getExistingConnectionInputs(e.helmReference)
t.push({source:{polymer_ref:e.linkedEntityHelmReference,residue_index:(0,LP.gd)(e.linkedEntityHelmReference)===Sn.Mp.RNA?e.connectionResidueIndex:null},target:{polymer_ref:e.helmReference,residue_index:null}})
updateComplexPolymer(t)},onDeleteConnection:e=>{const t=getExistingConnectionInputs(e.helmReference)
updateComplexPolymer(t)}})))}const jP=g.mM.create({summary:{paddingLeft:10},entityHeader:{paddingTop:5},conjugatesSummary:{display:"flex",flexWrap:"wrap"},conjugateSummary:{display:"inline-block"},conjugateSummaryWithHover:{display:"inline-block",":hover":{background:Vt.bs}},conjugateChip:{marginRight:4},attachmentText:{..._n.gt,color:Vt.pp,fontWeight:_n.KB,marginLeft:4,marginRight:4},removeConnectionButton:{marginRight:4,marginBottom:5},addAttachment:{marginRight:4,display:"inline"},attachmentButton:{marginLeft:4,marginBottom:5},attachmentInformation:{display:"inline-block",marginRight:5},attachmentMenu:{position:"relative"},addIcon:{cursor:"pointer",color:Vt.t0,marginLeft:"5px"}})
const YP=xa.Ps`
  query ComplexPolymerStructureTableQuery($complexPolymerId: StrictString!, $versionId: StrictString!)
  @engComponent(name: MODIFIED_BIOLOGICS)
  @skipAudit {
    complexPolymer(id: $complexPolymerId, versionId: $versionId) {
      ... on OligoConjugateNode {
        id
        name
        oligo {
          id
          helmReference
          bases
          entity {
            ... on SequenceNode {
              id
            }
            ... on MoleculeNode {
              id
            }
            ... on ProteinNode {
              id
            }
            ...InaccessibleInfoGraphQL
          }
          modifiedNucleotides {
            position
            sugarMonomerId
            baseMonomerId
            phosphateMonomerId
          }
          nucleotideType
        }
        conjugates {
          id
          polymerHelmReference
          residueIndex
          entity {
            ... on MoleculeNode {
              id
              name
            }
            ...InaccessibleInfoGraphQL
          }
          connection {
            source {
              polymerHelmReference
              residueIndex
            }
            target {
              polymerHelmReference
              residueIndex
            }
          }
          linkedMolecules {
            id
            polymerHelmReference
            entity {
              ... on MoleculeNode {
                id
                name
              }
              ...InaccessibleInfoGraphQL
            }
            connection {
              source {
                polymerHelmReference
                residueIndex
                referencedPolymer {
                  ... on SimplePolymerInterface {
                    id
                    helmReference
                    entity {
                      ... on MoleculeNode {
                        id
                        name
                      }
                      ... on SequenceNode {
                        id
                        name
                      }
                      ... on ProteinNode {
                        id
                        name
                      }
                      ...InaccessibleInfoGraphQL
                    }
                  }
                }
              }
              target {
                polymerHelmReference
                residueIndex
              }
            }
          }
        }
        structure {
          polymers {
            ... on SimplePolymerInterface {
              id
              polymerType
              helmReference
              entity {
                ... on MoleculeNode {
                  id
                  name
                }
                ... on SequenceNode {
                  id
                  name
                }
                ... on ProteinNode {
                  id
                  name
                }
                ...InaccessibleInfoGraphQL
              }
            }
          }
        }
        oligoSchemaField {
          ... on ComplexPolymerSchemaFieldDefinitionNode {
            id
            schemaId
          }
          ...InaccessibleInfoGraphQL
        }
        currentVersion {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ComplexPolymerStructureTableTab({complexPolymerId:e,isEditable:t}){const n=(0,_a.v9)((t=>t.ui.modbio.complexPolymerVersionUIs[e].complexPolymerVersionId))
return d.createElement(d.Fragment,null,d.createElement(so.R6,{className:(0,g.iv)(QP.title)},"Polymer structure"),d.createElement(Da.ZP,{query:Un.V,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING},(({monomers:a})=>d.createElement(Da.ZP,{query:YP,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,fetchPolicy:"network-only",variables:{complexPolymerId:e,versionId:n}},(e=>{if((0,ka.CZ)(e.complexPolymer))return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:`You do not have permission to view this ${uP.TV[uP.Jt.OLIGO_CONJUGATE]}`})
if(!function ComplexPolymerStructureTableTabUtil_isOligoConjugate(e){return"OligoConjugateNode"===e.__typename}(e.complexPolymer))return d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:`Entity is not an ${uP.TV[uP.Jt.OLIGO_CONJUGATE]}`})
if(!e.complexPolymer.oligo)return d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:"There is no associated oligo with this oligo-conjugate, please add an oligo"});(0,S.hu)(null!=e.complexPolymer.structure,"Expected oligo conjugate to have non-null structure")
const{bases:i,nucleotideType:s,modifiedNucleotides:r}=e.complexPolymer.oligo,o=function getResidueIndexToConjugates(e){const t={}
e.conjugates.filter((e=>null!=e.residueIndex)).reduce(((e,t)=>{const n=t.residueIndex
null==e[n]?e[n]=[t]:e[n].push(t)
return e}),t)
return t}(e.complexPolymer);(0,S.hu)(null!=e.complexPolymer.oligoSchemaField,"Expected oligo field to exist on oligo conjugate configuration");(0,S.hu)(null!=e.complexPolymer.currentVersion,"Expected complex polymer to have current version")
const l=n===e.complexPolymer.currentVersion.id
return d.createElement("div",null,d.createElement(ComplexPolymerStructureSummary,{oligoConjugateId:e.complexPolymer.id,isEditable:t&&l,oligo:e.complexPolymer.oligo,attachedConjugates:e.complexPolymer.conjugates,simplePolymers:e.complexPolymer.structure.polymers,oligoSchemaField:e.complexPolymer.oligoSchemaField,complexPolymerName:e.complexPolymer.name,versionId:n}),d.createElement(_P.Z,{areNucleotideEditsEnabled:!1,areComplexPolymerEditsEnabled:!1,bases:i,modifiedNucleotides:r,monomers:a,nucleotideType:s,sequenceId:uP.oR,isOligo:!1,isComplexPolymer:!0,residueIndexToConjugates:o,onBulkUpdateMods:Jt.ZT,onUpdateMod:Jt.ZT}))})))))}const QP=g.mM.create({title:{..._n.Oo,color:Vt.pp}})
class ComplexPolymerStructureTabView extends Js{render(){const e={complexPolymerId:this.model.get("complexPolymerId"),isEditable:this.model.get("isEditable")};(0,Me.A9)(d.createElement(ComplexPolymerStructureTableTab,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ComplexPolymerStructureTabView.prototype.className="buffer-tab"
var KP=n(781910)
function BulkAssemblyArchivedBanner({assemblyId:e}){return d.createElement(io.ZP,{bannerType:io.ct.WARNING,icon:"box-archive",text:"This assembly has been archived.",supportingInfo:"Editing is disabled on archived objects.",action:{actionType:io.J7.CUSTOM,actionText:"Unarchive",actionOnClick:()=>{$e.$Z("Unarchiving...");(0,IR.yg)([e],{hasRegisteredItems:!1},(()=>{$e.Cp()}))}}})}function ConstructsTabBanners({numWithErrors:e,numWithWarnings:t}){return d.createElement(d.Fragment,null,e>0&&d.createElement("div",{className:(0,g.iv)(JP.banner)},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:`${e} of your constructs ${1===e?"is":"are"} currently invalid.`,supportingInfo:d.createElement("span",null,"These constructs cannot be assembled as currently designed. To fix the relevant errors, go to the ",d.createElement("strong",null,"Overview")," tab."),action:{actionType:io.J7.ACCORDION}})),t>0&&d.createElement("div",{className:(0,g.iv)(JP.banner)},d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:`${t} of your constructs ${1===t?"has":"have"} associated warnings.`,supportingInfo:d.createElement("div",null,d.createElement("div",null,"These warnings may cause downstream issues with your sequences, but they are not blocking errors. You may proceed without addressing them, if you wish."),d.createElement("div",null,"To review the warnings, go to the ",d.createElement("strong",null,"Overview")," tab.")),action:{actionType:io.J7.ACCORDION}})))}const JP=g.mM.create({banner:{marginTop:12,marginBottom:12}})
var XP=n(183367),eO=n(434202),tO=n(875855)
class AssemblyFrontendFragmentValidator{constructor(e,t,n){this.method=e
this.fragment=t
this.fragmentBin=n}getRestrictionEnzymesForFragment(){return this.method.type===eO.tU.GOLDEN_GATE&&this.getFragmentProductionMethod()===eO.y0.EXISTING_CUT_SITES?{restrictionEnzyme5:(0,xe.Rt)(this.method.parameters.defaultRestrictionEnzymeId),restrictionEnzyme3:(0,xe.Rt)(this.method.parameters.defaultRestrictionEnzymeId)}:{restrictionEnzyme5:null,restrictionEnzyme3:null}}getFragmentProductionMethod(){return this.fragmentBin?this.fragmentBin.fragmentProductionMethod:this.method.parameters.defaultFragmentProductionMethod}getOtherParticipatingRestrictionEnzymes(){return this.method.type===eO.tU.GOLDEN_GATE&&this.getFragmentProductionMethod()===eO.y0.PRIMER_PAIR?[(0,xe.Rt)(this.method.parameters.defaultRestrictionEnzymeId)]:[]}getEntireCutsForRestrictionEnzyme(e,t){return(0,xe.kh)(e,t.residues,y.NucleotideType.DNA,fn.uS.DOUBLE_STRANDED,t.circular)}filterToInternalCutsForRestrictionEnzyme(e){let t=null
if((0,tO.l5)(this.fragment.start)&&(0,tO.l5)(this.fragment.end)){const n=this.fragment.start.value,a=this.fragment.end.value
t=e.filter((({position:e})=>(0,T.baseInExclusiveRange)(e,n,a)))}return t}getSingleRestrictionEnzymeValidationErrors(e,t,n){const a=[],i=this.getEntireCutsForRestrictionEnzyme(e,n),s=i.length,r=this.filterToInternalCutsForRestrictionEnzyme(i),o=null==r?void 0:r.length
if(null!=r&&null!=o){if(o>0){const t=`This sequence has ${s} ${e.name} ${(0,de._6)(s,"cut site","cut sites")}, ${o} of which ${(0,de._6)(o,"occurs","occur")} in the middle of your fragment selection region.`
a.push({status:Sn.zc.WARNING,text:t})}}else if(2!==s&&null!=t&&e.id===t.id||1!==s&&null!=t&&e.id!==t.id){const t=`This sequence has ${s} ${e.name} ${(0,de._6)(s,"cut site","cut sites")}`
a.push({status:Sn.zc.WARNING,text:t})}return a}getRestrictionEnzymeValidationErrors(e,t,n,a){const i=[]
null!=e&&i.push(...this.getSingleRestrictionEnzymeValidationErrors(e,t,a))
null==t||null!=e&&e.id===t.id||i.push(...this.getSingleRestrictionEnzymeValidationErrors(t,e,a))
n.forEach((e=>{const t=this.filterToInternalCutsForRestrictionEnzyme(this.getEntireCutsForRestrictionEnzyme(e,a)),n=null!=t?t.length:null
if(null!=t&&null!=n&&n>0){const t=`There ${(0,de._6)(n,"is","are")} ${n} ${e.name} ${(0,de._6)(n,"cut site","cut sites")} in the middle of your selected fragment`
i.push({status:Sn.zc.WARNING,text:t})}}))
return i}getAssemblyFrontendFragmentValidationErrors(e){const t=[],{restrictionEnzyme5:n,restrictionEnzyme3:a}=this.getRestrictionEnzymesForFragment()
null!=e&&t.push(...this.getRestrictionEnzymeValidationErrors(n,a,this.getOtherParticipatingRestrictionEnzymes(),e))
return t}}var nO=n(503627)
class AssemblySelector{constructor(e){this.state=e}getTopology(){return this.state.topology}getSequenceTopology(){return eO.EN[this.getTopology()]}getMethod(){return this.state.method}getFragmentBins(){return this.state.binCidOrdering.map((e=>this.state.binsByCid[e])).filter((e=>(0,eO.fO)(e)))}getNumFragmentBins(){return this.getFragmentBins().length}getConstructFragmentIndex(e){const t=e.bin
return(0,tO._F)(t)?this.getFragmentBins().findIndex((e=>e.cid===t.id)):null}getFragmentProductionMethodForBin(e){const{method:t}=this.state
if((0,tO.Yv)(e))return t.parameters.defaultFragmentProductionMethod
{const t=this.state.binsByCid[e.id];(0,S.hu)((0,eO.fO)(t),"Expected bin to be a fragment bin")
return t.fragmentProductionMethod}}getRestrictionEnzymeIdsForFragment(e){return{restrictionEnzymeId5:(0,tO.lq)(e.restrictionEnzyme5)?e.restrictionEnzyme5.id:null,restrictionEnzymeId3:(0,tO.lq)(e.restrictionEnzyme3)?e.restrictionEnzyme3.id:null}}}var aO=n(789471),iO=n(901441),sO=n(117694),rO=n(907704),oO=n(118574),lO=n(304315)
class AssemblyCoordinator{constructor(e,t,n,a,i,s,r,o,l,c,d,u){this.stateManager=e
this.assemblyId=t
this.isFinalized=n
this.isArchived=a
this.canEditAssembly=i
this.state=s
this.name=r
this.folderId=o
this.polymerData=l
this.validationResults=c
this.refetchAssembly=d
this.refetchValidation=u
this.fragmentsByCid=(0,Jt.Pe)(this.state.fragments,(e=>e.cid))
this.assemblyLayoutValidator=new nO.K(this.state)
this.assemblySelector=new AssemblySelector(this.state)
this.topology=eO.EN[this.state.topology]}async doRefetchAssembly(){await this.refetchAssembly()}async doRefetchValidation(){await this.refetchValidation()}performEffectsAfterRender(){let e=!1
const t=[],n=this.assemblySelector.getMethod()
for(const a of this.state.fragments){const i=this.assemblySelector.getConstructFragmentIndex(a),s=(0,oO.vo)(a,this.polymerData,this.canSpecifyEndpoints(),(0,rO.Kh)(n),i,this.assemblySelector.getNumFragmentBins(),this.topology,this.assemblySelector.getFragmentProductionMethodForBin(a.bin))
e||(e=null!=s)
t.push({...a,...s})}e&&this.resolveAndUpdateState({...this.state,fragments:t})}resolveAndUpdateState(e){(0,Vn.getStore)().dispatch({type:aO.cj.BULK_ASSEMBLY_STATE_UPDATED,assemblyId:this.assemblyId,state:this.stateManager.resolveState(e)})}getFragmentModalFragments(e,t){let n,a
if((0,tO._F)(e.bin)){const t=e.bin.id,i=this.state.binsByCid[t]
n=i.color
a=i.name}const{polymer:i,polymerKind:s,polymerVersionDbId:r}=(0,rO.OC)(e);(0,S.hu)((0,tO._F)(i),"Expected sequence or protein id to be resolved")
return(0,rO.QS)({polymerId:i.id,polymerKind:s,expectedVersionDbId:r,showPrimerSearch:this.enableSelectPreferredPrimers(e.bin),endpoints:{start:e.start,end:e.end},color:n,orientation:(0,tO.xz)(e.orientation)?e.orientation.value:void 0,binName:a,preferredPrimer5Id:(0,tO._F)(e.preferredPrimer5)?e.preferredPrimer5.id:null,preferredPrimer3Id:(0,tO._F)(e.preferredPrimer3)?e.preferredPrimer3.id:null,cid:e.cid,binCid:(0,tO._F)(e.bin)?e.bin.id:null,binIndex:this.getBinIndexFromFragment(e),restrictionEnzyme5:e.restrictionEnzyme5,restrictionEnzyme3:e.restrictionEnzyme3,canSpecifyEndpoints:this.canSpecifyEndpoints(),canUpdateRestrictionEnzymes:this.canUpdateRestrictionEnzymes((0,tO._F)(e.bin)?e.bin.id:null),isReadOnly:t,constructTopology:this.topology,numFragmentBins:this.assemblySelector.getNumFragmentBins(),assemblyMethod:this.assemblySelector.getMethod(),fragmentProductionMethod:this.assemblySelector.getFragmentProductionMethodForBin(e.bin)})}enableSelectPreferredPrimers(e){return this.assemblySelector.getFragmentProductionMethodForBin(e)===eO.y0.PRIMER_PAIR}canSpecifyEndpoints(){return(0,rO.K)(this.state.method.type)}canUpdateRestrictionEnzymes(e){let t
if(null==e)t=this.assemblySelector.getMethod().parameters.defaultFragmentProductionMethod
else{const n=this.state.binsByCid[e];(0,S.hu)((0,eO.fO)(n),"Expected bin to be a fragment bin")
t=n.fragmentProductionMethod}return this.assemblySelector.getMethod().type===eO.tU.GIBSON&&t===eO.y0.EXISTING_CUT_SITES}isReadOnly(){return this.isArchived||this.isFinalized||!this.canEditAssembly}canCreatePrimers(){return![eO.tU.HOMOLOGY,eO.tU.CONCATENATION].includes(this.state.method.type)}canMethodUseHomologyRegions(){return[eO.tU.GIBSON,eO.tU.HOMOLOGY].includes(this.state.method.type)}getFragmentProductionMethod(){const e=new Set(this.assemblySelector.getFragmentBins().map((e=>this.assemblySelector.getFragmentProductionMethodForBin((0,tO.rx)(e.cid)))));(0,S.hu)(0!==e.size,"Unexpectedly encountered no fragment bins")
return 1===e.size?e.values().next().value:eO.Sv.VARIABLE}getNextFragmentBin(e){(0,S.hu)((0,eO.fO)(e),"Expected to receive only fragment bins")
const t=(this.assemblySelector.getFragmentBins().indexOf(e)+1)%this.assemblySelector.getFragmentBins().length
return this.assemblySelector.getFragmentBins()[t]}getConstructsByCid(){return(0,Jt.Pe)(this.state.constructs,(e=>e.cid))}prepareValidationMessages(e){return this.isFinalized?e.map((e=>e.status===Sn.zc.SUCCESS?{status:Sn.zc.SUCCESS,text:""}:e)):e}getFragmentsForDisplay(){const e=0===this.state.fragments.length?[{cid:(0,gt.Z)(),sequence:tO.zQ,sequenceVersionDbId:null,protein:tO.zQ,proteinVersionDbId:null,bin:tO.zQ,start:tO.zQ,end:tO.zQ,orientation:(0,tO.sZ)(tO.ij.FORWARD),preferredPrimer5:tO.zQ,preferredPrimer3:tO.zQ,restrictionEnzyme5:tO.zQ,restrictionEnzyme3:tO.zQ}]:this.state.fragments
return(0,hs.Z)(e,[e=>{var t
return null!==(t=this.getBinIndexFromFragment(e))&&void 0!==t?t:1/0}]).map((e=>this.getFragmentForDisplay(e)))}getPolymerNameForBAValue(e){return(0,tO._F)(e)?this.polymerData.getName(e.id):null}getPolymerDataForBAValues({polymer:e,polymerVersionDbId:t}){return(0,tO._F)(e)&&null!=t?this.polymerData.getBasicPolymerInfo(e.id,t):null}getBinIndexFromFragment(e){const t=e.bin
return(0,tO._F)(t)&&null!=this.state.binsByCid[t.id]?this.getBinCidOrdering().findIndex((e=>e===t.id)):null}getEndpointDataForDisplay(e){const t={start:{text:"",locked:!0},end:{text:"",locked:!0},length:{text:""},enzymeCutsiteData5:null,enzymeCutsiteData3:null},n=this.getPolymerDataForBAValues((0,rO.OC)(e)),{restrictionEnzymeId5:a,restrictionEnzymeId3:i}=this.assemblySelector.getRestrictionEnzymeIdsForFragment(e)
if(!n)return t
const s=(0,oO.AW)(n.startIndex),r=(0,tO.W9)(e.orientation),o=(0,oO.WD)(a,n.residues,n.circular),l=(0,oO.WD)(i,n.residues,n.circular),{startErrorMessage:c,endErrorMessage:d,length:u}=(0,oO.Lv)(e,n.residues.length,n.startIndex,r,o,l,this.canSpecifyEndpoints(),n.circular),m=(0,tO.wz)(e.start,s.start),p=(0,tO.wz)(e.end,s.end)
return{start:{text:(0,oO.yf)(r,m,p),error:c,locked:!this.canSpecifyEndpoints()},end:{text:(0,oO.yf)(r,p,m),error:d,locked:!this.canSpecifyEndpoints()},length:{text:null==u?"":String(u)},enzymeCutsiteData5:null!=o.cutsiteIndices?{restrictionEnzymeId:o.restrictionEnzymeId,cutsites:o.cutsiteIndices,modelToDisplayConverters:s,orientation:r}:null,enzymeCutsiteData3:null!=l.cutsiteIndices?{restrictionEnzymeId:l.restrictionEnzymeId,cutsites:l.cutsiteIndices,modelToDisplayConverters:s,orientation:r}:null}}formatRestrictionEnzymeForDisplay(e){const t=this.assemblySelector.getMethod()
if(!(0,eO.i_)(t))return{restrictionEnzyme5:{text:"",locked:!0},restrictionEnzyme3:{text:"",locked:!0}}
const n=this.assemblySelector.getFragmentProductionMethodForBin(e.bin),{restrictionEnzymeId5:a,restrictionEnzymeId3:i}=this.assemblySelector.getRestrictionEnzymeIdsForFragment(e)
return{restrictionEnzyme5:{text:null!=a&&a!==te.kA?(0,xe.Rt)(a||t.parameters.defaultRestrictionEnzymeId).name:"No enzyme selected",locked:n!==eO.y0.EXISTING_CUT_SITES},restrictionEnzyme3:{text:null!=i&&i!==te.kA?(0,xe.Rt)(i||t.parameters.defaultRestrictionEnzymeId).name:"No enzyme selected",locked:n!==eO.y0.EXISTING_CUT_SITES}}}getFragmentRowNumber(e){const t=this.getFragmentsForDisplay(),n=t.find((t=>t.cid===e.cid));(0,S.hu)(null!=n,"Expected to find fragment in display fragments")
return t.indexOf(n)+1}formatPolymerForDisplay(e){var t
return(0,tO._F)(e)?{text:null!==(t=this.getPolymerNameForBAValue(e))&&void 0!==t?t:"",id:e.id}:{text:e.rawText}}getFragmentForDisplay(e){var t,n
const{polymer:a,polymerVersionDbId:i}=(0,rO.OC)(e),s=this.getPolymerDataForBAValues({polymer:a,polymerVersionDbId:i})
let r,o
r=(0,tO._F)(e.bin)||(0,tO.Av)(e.bin)?(0,tO._F)(e.bin)?{text:null!==(n=null===(t=this.state.binsByCid[e.bin.id])||void 0===t?void 0:t.name)&&void 0!==n?n:""}:{text:""}:{text:e.bin.rawText,error:"Bin is not recognized"}
const l=!(null==s?void 0:s.circular)&&this.canSpecifyEndpoints()
o=(0,tO.Av)(e.orientation)?{text:"",locked:l}:(0,tO.xz)(e.orientation)?{text:tO.ej[e.orientation.value],locked:l}:{text:e.orientation.rawText,error:'Orientation must be "Forward" or "Reverse".',locked:l}
const c=this.assemblySelector.getFragmentProductionMethodForBin(e.bin),d={...this.getEndpointDataForDisplay(e),cid:e.cid,bin:r,orientation:o,...this.formatRestrictionEnzymeForDisplay(e),fragmentProductionMethod:{text:eO.R[this.assemblySelector.getMethod().type][c].display},polymer:this.formatPolymerForDisplay(a),polymerVersionId:i,preferredPrimer5:{...this.formatPolymerForDisplay(e.preferredPrimer5),locked:!this.enableSelectPreferredPrimers(e.bin)},preferredPrimer3:{...this.formatPolymerForDisplay(e.preferredPrimer3),locked:!this.enableSelectPreferredPrimers(e.bin)}}
return{...d,validationMessages:this.formatValidationMessagesForFragment(e.cid,d,s)}}formatValidationMessagesForFragment(e,t,n){var a,i
const s=null!==(a=this.validationResults.fragmentResultsByCid[e])&&void 0!==a?a:null
if(s===Go.br)return Go.br
const r=[],{bin:o,start:l,end:c,orientation:d}=t
for(const e of[o,l,c,d])null!=(null==e?void 0:e.error)&&r.push({status:Sn.zc.ERROR,text:e.error})
const u=this.state.fragments.find((t=>t.cid===e))
if(null!=u){const e=(0,tO._F)(u.bin)?this.state.binsByCid[u.bin.id]:null;(0,S.hu)(null==e||(0,eO.fO)(e),"Expected to receive fragment bin")
const t=new AssemblyFrontendFragmentValidator(this.state.method,u,e)
r.push(...t.getAssemblyFrontendFragmentValidationErrors(n))}return r.length?r:this.prepareValidationMessages(null!==(i=null==s?void 0:s.validationMessages)&&void 0!==i?i:[])}handleAddNewFragmentBin(){const e=(0,gt.Z)();(0,Vn.getStore)().dispatch((0,aO.AB)(this.assemblyId,e))}handleAddNewSpacerBin(){const e=(0,gt.Z)();(0,Vn.getStore)().dispatch((0,aO.Wx)(this.assemblyId,e))}getDuplicateFragmentNamesByBin(){const e=this.state.fragments.filter((e=>(0,tO._F)(e.bin))),t=(0,Jt.vM)(e,(e=>e.bin.id)),n=(0,Jt.m8)(Object.keys(t).map((e=>[e,new Set])))
for(const[e,a]of Object.entries(t)){const t=new Set
for(const i of a){const a=(0,rO.WB)(this.assemblySelector.getMethod())?i.protein:i.sequence,s=this.getPolymerNameForBAValue(a)
null!=s&&""!==s&&(t.has(s)?n[e].add(s):t.add(s))}}return n}getSpecifiedFragmentInfosByBinCid(){const e=this.state.fragments.flatMap((e=>{const t=(0,rO.WB)(this.assemblySelector.getMethod())?e.protein:e.sequence
if(!(0,tO._F)(t)||!(0,tO._F)(e.bin))return[]
let n=this.getPolymerNameForBAValue(t)
if(null==n)return[]
const{start:a,end:i}=this.getEndpointDataForDisplay(e)
n=this.getFragmentDisplayName(e,e.bin.id)
const s=[]
if(this.canSpecifyEndpoints()){""===a.text?s.push(`Add a start value to ${n} to autopopulate.`):null!=a.error&&s.push(`Fix the invalid start value for ${n} to autopopulate.`)
""===i.text?s.push(`Add an end value to ${n} to autopopulate.`):null!=i.error&&s.push(`Fix the invalid end value for ${n} to autopopulate.`)}(0,tO.xz)(e.orientation)||s.push(`Fix the invalid orientation for ${n} to autopopulate.`)
const r=this.validationResults.fragmentResultsByCid[e.cid]
null!=r&&r!==Go.br&&r.validationMessages.filter((e=>e.status===Sn.zc.ERROR)).length>0&&s.push(`Resolve error(s) for ${n} to autopopulate.`)
return[{fragmentCid:e.cid,binCid:e.bin.id,polymerName:n,errors:s}]}))
return(0,Jt.vM)(e,(e=>e.binCid))}updateBinName(e,t){(0,Vn.getStore)().dispatch((0,aO.Js)(this.assemblyId,e,t))}deleteBin(e){this.resolveAndUpdateState((0,tm.ZP)(this.state,(t=>{const[n]=t.binCidOrdering.splice(e,1)
delete t.binsByCid[n]})))}updateBinFragmentProductionMethod(e,t){(0,S.Gp)((0,eO.fO)(this.state.binsByCid[e]),"Tried to set fragment production method on a non-fragment bin")&&(0,S.Gp)(this.state.method.type===eO.tU.GOLDEN_GATE||this.state.method.type===eO.tU.GIBSON,`Tried to set fragment production method in a ${eO.Vk[this.state.method.type]} assembly`)&&(0,Vn.getStore)().dispatch({type:aO.cj.BULK_ASSEMBLY_BIN_UPDATED_FRAGMENT_PRODUCTION_METHOD,assemblyId:this.assemblyId,binCid:e,fragmentProductionMethod:t})}updateSpacerBinBases(e,t){(0,Vn.getStore)().dispatch((0,aO.BD)(this.assemblyId,e,t))}getOrderedFragmentListsForAutopopulate(){const e=this.getSpecifiedFragmentInfosByBinCid(),t=(0,Jt.m8)(Object.entries(e).map((([e,t])=>[e,t.filter((e=>this.isValidFragmentForAutopopulate(e.fragmentCid)))])))
return this.assemblySelector.getFragmentBins().map((e=>{var n
return null!==(n=t[e.cid])&&void 0!==n?n:[]}))}handleAutopopulateConstructs(){if(null==this.getAutopopulateButtonStatus()){const e=this.getOrderedFragmentListsForAutopopulate(),t=(0,rO.gr)(e).map((e=>({cid:(0,gt.Z)(),constructFragmentsByBinId:(0,Jt.m8)(e.map((e=>[e.binCid,{fragment:(0,tO.rx)(e.fragmentCid)}])))})))
this.updateConstructs(t)}}handleMoveBin(e,t){(0,Vn.getStore)().dispatch((0,aO.qT)(this.assemblyId,e,t))}getBinCount(){return this.state.binCidOrdering.length}getBinCidOrdering(){return this.state.binCidOrdering}getBinsForDisplay(){return this.state.binCidOrdering.map((e=>{const t=this.state.binsByCid[e]
if((0,eO.fO)(t)){const e=this.getFilledOutFragments().filter((e=>(0,tO._F)(e.bin)&&e.bin.id===t.cid)).length
return{...t,lockName:!1,numBinFragments:e}}return t}))}generateConstructName(e){const t=[],n=this.getDuplicateFragmentNamesByBin()
for(const{cid:a}of this.assemblySelector.getFragmentBins()){const i=e.constructFragmentsByBinId[a]
if(!i)return""
if(i.fragment.type===tO.xd.RAW_TEXT){if(i.fragment.rawText===eO.EE)continue
return""}const s=this.fragmentsByCid[i.fragment.id]
if(null==s)return""
const r=(0,rO.WB)(this.assemblySelector.getMethod())?s.protein:s.sequence,o=this.getPolymerNameForBAValue(r)
if(null==o)return""
if(null!=n[a]&&n[a].has(o)&&(0,tO.l5)(s.start)&&(0,tO.l5)(s.end)){const{start:e,end:n}=this.getEndpointDataForDisplay(s),a=`${o}-${e.text}-${n.text}`
t.push(a)}else t.push(o)}return t.join("-")}getBinColorByFragmentCid(e){const t=this.fragmentsByCid[e].bin
return(0,tO.Yv)(t)?null:this.state.binsByCid[t.id].color}getFragmentResults(e){var t,n,a,i,s
let r=[]
if(this.canMethodUseHomologyRegions()){const o=e.constructFragments.every((e=>null==e.overlap5End&&null==e.overlap3Start))
for(const l of(0,Jt.w6)(0,e.constructFragments.length-1)){const c=e.constructFragments[l]
let d
d=this.topology===fn.JH.CIRCULAR?T.mod(l+1,e.constructFragments.length):l!==e.constructFragments.length-1?l+1:null
const u=null!=d?e.constructFragments[d]:null
let m,p,h
if(o){m=c.start
p=c.end
h=null!==(t=null==u?void 0:u.start)&&void 0!==t?t:null}else{m=null!==(n=c.overlap5End)&&void 0!==n?n:c.start
p=null!==(a=c.overlap3Start)&&void 0!==a?a:c.end
h=null!==(s=null!==(i=null==u?void 0:u.overlap5End)&&void 0!==i?i:null==u?void 0:u.start)&&void 0!==s?s:null}r.push({start:m,end:p,color:this.getBinColorByFragmentCid(c.fragmentId),homologyRegionOtherColor:null})
null!=u&&null!=h&&r.push({start:p,end:h,color:this.getBinColorByFragmentCid(c.fragmentId),homologyRegionOtherColor:this.getBinColorByFragmentCid(u.fragmentId)})}}else r=e.constructFragments.map((({start:e,end:t,fragmentId:n})=>({start:e,end:t,color:this.getBinColorByFragmentCid(n),homologyRegionOtherColor:null})))
r.sort(((e,t)=>e.start-t.start))
return r}sequencePolymerInfoFromValidationResult(e,t){const n={name:t,bases:e.polymer.bases,circular:e.polymer.circular,type:fn.fB[e.polymer.sequenceType],nucleotideType:e.polymer.nucleotideType,modifiedNucleotides:e.polymer.modifiedNucleotides.map((({position:e,sugarMonomerId:t,phosphateMonomerId:n,baseMonomerId:a})=>({position:e,sugarMonomerId:t,phosphateMonomerId:n,baseMonomerId:a}))),id:us.eA,finalized:!1},a=new XP.T9(n),i=e.polymer.annotations.map((({name:e,start:t,end:n,strand:a,color:i})=>new Ue.Annotation({name:e,start:t,end:n,strand:a,color:i})))
a.annotations().reset(i)
const s=e.polymer.translations.flatMap((({name:e,strand:t,color:n,codonTranslationTable:a,regions:i},s)=>i.map((({start:e,end:n})=>new _i.Wb({start:e,end:n,strand:t,fromSubPart:!1,translationGroupId:s})))))
a.translations().reset(s)
a.set("translationGroups",e.polymer.translations.map((({name:e,codonTranslationTable:t,color:n},a)=>({id:a,name:e,notes:"",customFields:[],codonTranslationTable:t,color:n,fromSubPart:!1}))))
const r=this.getFragmentResults(e)
a.fragmentResults().reset(r)
for(const t of e.primerValidationResults){const{primer:e}=t
if(!e)continue
const n=new Ue.SequencePrimer({name:e.oligoContents.name,bases:e.oligoContents.bases,strand:t.sequencePrime===Sn.cG.FIVE?1:-1,primer_api_id:e.oligoId})
n.setBindPosition(a,e.bindPosition,e.overhangLength)
a.get("sequencePrimers").add(n)}const o=new Ge.Sequence({fileState:null,id:us.eA,_sequence:a},{}),l=new ve.Au({sequence:o})
o.set({fileState:l})
return{kind:"sequence",ref:{current:o}}}proteinPolymerInfoFromValidationResult(e,t){const n=(0,gt.Z)(),a=new ga.Z({id:n}),i={id:0,aminoAcids:e.polymer.aminoAcids,annotations:e.polymer.annotations.map((({name:e,start:t,end:n,color:a},i)=>({id:i,name:e,start:t,end:n,color:a,type:""}))),createdAt:"",name:t,parentId:null,structures:[],fragments:this.getFragmentResults(e)}
Sa.Z.dispatch({actionType:fa.KxQ,versions:[i],proteinId:n})
Sa.Z.dispatch({actionType:fa.GSP,protein:{alignments:[],linkedAlignments:[],archiveRecord:null,authors:[],bioentityAliasInfos:[],created_at:"",modified_at:"",displayLabel:"",editURL:"",id:n,isLatest:!0,name:t,permissions:{admin:!1,appendable:!1,archivable:!1,canEditNamesAndAliases:!0,deletable:!1,movable:!1,polymerFeaturesEditable:!1,polymerResiduesEditable:!1,readable:!0,registryIdsChangeable:!1,unarchivable:!1,unregisterable:!1,writable:!1},schemaValidationState:null,tagSchema:null,tags:[],version:i},proteinId:n})
return{kind:"protein",ref:{current:a}}}maybeCreatePreviewConstructPolymer(e){const t=this.validationResults.constructResultsByCid[e]
if(!t||t===Go.br||null==t.polymer)return null
const n=this.generateConstructName(this.getConstructsByCid()[e]),a=t.polymer
return(0,iO.nj)(a)?this.sequencePolymerInfoFromValidationResult({...t,polymer:a},n):this.proteinPolymerInfoFromValidationResult({...t,polymer:a},n)}maybeCreatePreviewConstructVisualPolymer(e){const t=this.validationResults.constructResultsByCid[e]
if(!t||t===Go.br||null==t.polymer)return null
const n=this.getConstructsByCid()[e],a=t.polymer
if((0,iO.nj)(a)){const e=[...new Set(Object.values(n.constructFragmentsByBinId).flatMap((e=>{const t=(0,tO._F)(e.fragment)?this.state.fragments.find((t=>t.cid===e.fragment.id)):null
if(null==t)return[]
const{restrictionEnzymeId5:n,restrictionEnzymeId3:a}=this.assemblySelector.getRestrictionEnzymeIdsForFragment(t),i=[]
null!=n&&n!==te.kA&&i.push(n)
null!=a&&a!==te.kA&&i.push(a)
return i})))].flatMap((e=>(0,xe.kh)((0,xe.Rt)(e),a.bases,a.nucleotideType,fn.fB[a.sequenceType],a.circular).map((({position:t})=>({position:t,enzymeId:e})))))
return{circular:a.circular,fragments:this.getFragmentResults(t),length:a.bases.length,startIndex:1,cutSites:e,annotations:a.annotations.map((({name:e,start:t,end:n,strand:a,color:i})=>({name:e,start:t,end:n,color:i,strand:a}))),overlays:[]}}return{circular:!1,fragments:this.getFragmentResults(t),length:a.aminoAcids.length,startIndex:1,cutSites:[],annotations:a.annotations.map((({name:e,start:t,end:n,color:a})=>({name:e,start:t,end:n,color:a,strand:1}))),overlays:[]}}getPreviewConstruct(e){const t=this.validationResults.constructResultsByCid[e.cid]
if(!t||t===Go.br)return null
const n=this.generateConstructName(e),a=Object.values(e.constructFragmentsByBinId).flatMap((e=>(0,tO._F)(e.fragment)?[e.fragment.id]:[]))
return{cid:e.cid,name:n,visualPolymer:this.maybeCreatePreviewConstructVisualPolymer(e.cid),fragmentCids:a,numPrimers:t.primerValidationResults.length,hasErrors:t.validationMessages.some((e=>e.status===Sn.zc.ERROR)),hasWarnings:t.validationMessages.some((e=>e.status===Sn.zc.WARNING)),outputPolymerId:this.getConstructOutputPolymerId(e.cid)}}getPreviewConstructs(){return this.state.constructs.flatMap((e=>{const t=this.getPreviewConstruct(e)
return t?[t]:[]}))}getConstructsForDisplay(){return this.state.constructs.map((e=>this.getConstructForDisplay(e)))}getConstructOutputPolymerId(e){var t
const n=null!==(t=this.validationResults.constructResultsByCid[e])&&void 0!==t?t:null
return this.isFinalized&&null!=n&&n!==Go.br&&null!=n.polymer?(0,iO.nj)(n.polymer)?n.polymer.createdSequenceId:n.polymer.createdProteinId:null}getConstructForDisplay(e){var t
const n=null!==(t=this.validationResults.constructResultsByCid[e.cid])&&void 0!==t?t:null,a=null!=n&&n!==Go.br&&null!=n.polymer?n.polymer:null
let i,s=null,r=null
if(null!=a&&(0,iO.nj)(a)){s=a.bases.length
r=this.isFinalized?a.createdSequenceCurrentName:null}else if(null!=a){s=a.aminoAcids.length
r=this.isFinalized?a.createdProteinCurrentName:null}i=null==n?null:n===Go.br?Go.br:(0,Jt.Pe)(n.constructFragments,(e=>e.fragmentId))
const o=(0,Jt.m8)(Object.entries(e.constructFragmentsByBinId).filter((([e,t])=>null!=this.state.binsByCid[e])).map((([t,n],a)=>{const r=this.getNextFragmentBin(this.state.binsByCid[t]).cid,o=e.constructFragmentsByBinId[r]
return[t,this.getConstructFragmentForDisplay(t,n,o,i,s)]}))),l={...e,createdSequenceId:this.getConstructOutputPolymerId(e.cid),name:null!=r?r:this.generateConstructName(e),displayConstructFragmentByBinId:o,canPreview:null!=n&&n!==Go.br}
return{...l,validationMessages:this.formatValidationMessagesForConstruct(l)}}hasNonEmptySpacers(){return this.state.binCidOrdering.map((e=>this.state.binsByCid[e])).filter((e=>(0,eO.Eg)(e)&&e.residues.length>0)).length>0}formatValidationMessagesForConstruct(e){var t
const n=null!==(t=this.validationResults.constructResultsByCid[e.cid])&&void 0!==t?t:null,a=Object.values(e.displayConstructFragmentByBinId).flatMap((e=>null!=e.error?[{status:Sn.zc.ERROR,text:e.error}]:[])),i=Object.values(e.constructFragmentsByBinId).filter((e=>e.fragment.type!==tO.xd.RAW_TEXT||e.fragment.rawText!==eO.EE))
i.length<2&&a.push({status:Sn.zc.ERROR,text:"Constructs must contain at least two fragments"})
i.length<this.assemblySelector.getNumFragmentBins()&&this.hasNonEmptySpacers()&&a.push({status:Sn.zc.ERROR,text:"Skipping bins in an assembly with spacers is not currently supported. Consider breaking your assembly into multiple assemblies instead."})
return a.length>0?a:null==n?[]:n===Go.br?Go.br:this.prepareValidationMessages(n.validationMessages)}getFormattedOverlapLengthForConstructFragment(e,t,n){if(this.assemblySelector.getMethod().type===eO.tU.HOMOLOGY){let a="-"
if(null!=t&&null!=n){const i=e.end!==n?e.end:0,s=t.start!==n?t.start:0
if(i!==s){const e=T.length(i,s,n)
a=`${e} bp`;(0,S.Gp)(e<n,"Expected construct fragments to be non-overlapping ")}}return a}return this.assemblySelector.getMethod().type===eO.tU.GIBSON?null==n||null==(null==e?void 0:e.overlap3Start)||null==(null==t?void 0:t.overlap5End)?"-":`${T.length(null==e?void 0:e.overlap3Start,null==t?void 0:t.overlap5End,n)} bp`:"-"}getFragmentDisplayName(e,t){var n
const a=(0,rO.WB)(this.assemblySelector.getMethod())?e.protein:e.sequence
let i=null!==(n=this.getPolymerNameForBAValue(a))&&void 0!==n?n:""
const s=this.getDuplicateFragmentNamesByBin()
if(null!=s[t]&&s[t].has(i)&&!this.canSpecifyEndpoints())i=`${i} (row ${this.getFragmentRowNumber(e)})`
else if(null!=s[t]&&s[t].has(i)){const{start:t,end:n}=this.getEndpointDataForDisplay(e)
i=`${i} (${t.text}-${n.text})`}return i}getConstructFragmentForDisplay(e,t,n,a,i){var s,r
if((0,tO.Yv)(t.fragment)||!this.fragmentsByCid[t.fragment.id]){const n=`Fragment in ${this.state.binsByCid[e].name} is ${t.fragment===tO.zQ?"missing":"invalid"}`,a=(0,tO.Yv)(t.fragment)?t.fragment.rawText:""
return{fragmentCid:null,fragmentName:a,fragmentEndpoints:null,overhangBases:"",overlapLength:null,error:a!==eO.EE?n:void 0}}const o=this.fragmentsByCid[t.fragment.id],l=(null===(s=null==n?void 0:n.fragment)||void 0===s?void 0:s.type)!==tO.xd.ID?null:this.fragmentsByCid[n.fragment.id],c=this.getFragmentDisplayName(o,e)
if(null==a)return{fragmentCid:t.fragment.id,fragmentName:c,fragmentEndpoints:null,overhangBases:"",overlapLength:null}
if(a===Go.br)return{fragmentCid:t.fragment.id,fragmentName:c,fragmentEndpoints:Go.br,overhangBases:Go.br,overlapLength:Go.br}
const d=a[o.cid],u=this.getPolymerDataForBAValues((0,rO.OC)(o))
return{fragmentCid:t.fragment.id,fragmentName:c,fragmentEndpoints:null!=u?`${null!=(null==d?void 0:d.inputStart)?(0,T.modelStartToDisplay)(null==d?void 0:d.inputStart,u.startIndex):"-"} / ${null!=(null==d?void 0:d.inputEnd)?(0,T.modelEndToDisplay)(null==d?void 0:d.inputEnd,u.residues.length,u.startIndex):"-"}`:"- / -",overhangBases:null!==(r=null==d?void 0:d.overhang3Bases)&&void 0!==r?r:"",overlapLength:this.getFormattedOverlapLengthForConstructFragment(d,null!=l?a[l.cid]:null,i)}}getPrimersForDisplayByConstruct(e){const t=this.validationResults.constructResultsByCid[e]
return t&&t!==Go.br?t.primerValidationResults.map((e=>{var t,n,a,i,s,r,o,l,c,d,u
const m={fragmentName:null!==(t=this.getPolymerNameForBAValue(this.fragmentsByCid[e.fragmentId].sequence))&&void 0!==t?t:"",orientation:e.sequencePrime,name:null!==(a=null===(n=e.primer)||void 0===n?void 0:n.oligoContents.name)&&void 0!==a?a:null,bases:null!==(s=null===(i=e.primer)||void 0===i?void 0:i.oligoContents.bases)&&void 0!==s?s:null,wholeMeltingTemperature:null!==(o=null===(r=e.primer)||void 0===r?void 0:r.wholeTm)&&void 0!==o?o:null,validationMessages:this.prepareValidationMessages(e.validationMessages)}
if((null===(l=e.primer)||void 0===l?void 0:l.oligoSource)===Sn.x8.PREFERRED_PRIMER){(0,S.hu)(null!=e.primer.oligoId,"Expected to receive an oligoId for a preferred primer result")
return{primerType:sO.g0.USE_EXISTING,oligoId:e.primer.oligoId,...m}}(0,S.hu)((null===(c=e.primer)||void 0===c?void 0:c.oligoSource)===Sn.x8.DESIGNED,"Unexpected oligo source")
return{primerType:sO.g0.CREATE_NEW,createdOligoId:null!==(u=null===(d=e.primer)||void 0===d?void 0:d.oligoId)&&void 0!==u?u:null,...m}})):[]}isValidFragmentForAutopopulate(e){const t=this.fragmentsByCid[e],n=this.validationResults.fragmentResultsByCid[e],{start:a,end:i}=this.getEndpointDataForDisplay(t)
return!(null==n||n===Go.br||n.validationMessages.some((e=>e.status===Sn.zc.ERROR))||null==this.getPolymerDataForBAValues((0,rO.OC)(t))||!(0,tO._F)(t.bin)||null!=a.error||null!=i.error||!(0,tO.xz)(t.orientation))}getAutopopulateButtonStatus(){const e=this.getLayoutErrorMessages(),t=this.state.fragments.every((e=>this.isValidFragmentForAutopopulate(e.cid))),n=new Set(this.state.fragments.flatMap((e=>(0,tO._F)(e.bin)?[e.bin.id]:[]))).size,a=this.getOrderedFragmentListsForAutopopulate().reduce(((e,t)=>e*t.length),1)
return e.length>0?e[0]:t?n!==this.assemblySelector.getNumFragmentBins()?"You can't autopopulate constructs until every bin has a valid fragment.":a>eO.hk?`You can't autopopulate constructs because the number of possible combinations exceeds Benchling's maximum permissible limit of ${eO.hk} constructs.`:0!==this.getNumConstructs()?"You can't autopopulate constructs since the table is already partially filled. Please remove all existing rows to enable this option.":null:"You can't autopopulate constructs because there are incomplete and/or invalid rows in the fragments table."}addFragments(e){this.resolveAndUpdateState({...this.state,fragments:[...this.state.fragments,...e]})}updateMethodParametersAndTopology(e,t){this.resolveAndUpdateState((0,tm.ZP)(this.state,(n=>{n.method.parameters=e
n.topology=t})))}updateFragment(e){this.resolveAndUpdateState({...this.state,fragments:this.state.fragments.map((t=>t.cid===e.cid?e:t))})}handleTableFragmentsUpdate(e){const t=(0,lO.p)(this.assemblySelector.getFragmentBins(),(e=>e.name))
this.resolveAndUpdateState({...this.state,fragments:e.map((e=>this.normalizeFragmentUpdateFromTable(e,t)))})}normalizeFragmentUpdateFromTable(e,t){var n,a
const i=this.parseBin(e.bin,t),s=this.enableSelectPreferredPrimers(i),r=null!=e.cid?this.fragmentsByCid[e.cid]:null,o=null!=r?(0,rO.OC)(r):null,l=this.getPolymerDataForBAValues(e)
let c
c=this.supportedPolymerSubtypes()[0]===An.Dj.aa_sequence?{cid:null!==(n=e.cid)&&void 0!==n?n:(0,gt.Z)(),bin:i,preferredPrimer3:s?e.preferredPrimer3:tO.zQ,preferredPrimer5:s?e.preferredPrimer5:tO.zQ,restrictionEnzyme5:tO.zQ,restrictionEnzyme3:tO.zQ,protein:e.polymer,proteinVersionDbId:e.polymerVersionDbId,sequence:tO.zQ,sequenceVersionDbId:null}:{cid:null!==(a=e.cid)&&void 0!==a?a:(0,gt.Z)(),bin:i,preferredPrimer3:s?e.preferredPrimer3:tO.zQ,preferredPrimer5:s?e.preferredPrimer5:tO.zQ,restrictionEnzyme5:e.restrictionEnzyme5,restrictionEnzyme3:e.restrictionEnzyme3,sequence:e.polymer,sequenceVersionDbId:e.polymerVersionDbId,protein:tO.zQ,proteinVersionDbId:null}
if(null!=l&&(0,tO._F)(e.polymer)&&(null==o||o.polymer.type===tO.xd.RAW_TEXT||o.polymer.id===e.polymer.id)){const t=(0,tO.W9)(e.orientation)
let n=!1
if(null!=r&&(0,tO.Yv)(e.start)&&(0,tO.Yv)(e.end)&&t!==(0,tO.W9)(r.orientation)){const{start:t,end:a}=this.getEndpointDataForDisplay(r)
n=e.start.rawText===t.text&&e.end.rawText===a.text}const a=(0,oO.ns)(l.startIndex),i=(0,oO.yf)(n?eO.vy[t]:t,{start:(0,tO.Cb)(e.start,a.start),end:(0,tO.Cb)(e.end,a.end)},{start:(0,tO.Cb)(e.end,a.start),end:(0,tO.Cb)(e.start,a.end)}),{orientation:s,...o}=(0,oO.ht)(i,t,l.circular,l.singleStranded)
return{...c,...o,orientation:null!=s?(0,tO.sZ)(s):(0,tO._g)(e.orientation)}}return{...c,sequenceVersionDbId:null,proteinVersionDbId:null,start:tO.zQ,end:tO.zQ,orientation:(0,tO.sZ)(tO.ij.FORWARD)}}parseBin(e,t){if(e.type===tO.xd.ID)return e
const n=t(e.rawText)
return n.type===lO.D.FOUND?(0,tO.rx)(n.value.cid):e}updateConstructs(e){const t=this.getSpecifiedFragmentInfosByBinCid(),n=(0,Jt.Xc)(t,(e=>(0,lO.p)(e.filter((e=>e.polymerName)),(e=>e.polymerName))));(0,Vn.getStore)().dispatch({type:aO.cj.BULK_ASSEMBLY_CONSTRUCTS_UPDATED,assemblyId:this.assemblyId,constructs:e.map((e=>{var t
return{cid:null!==(t=e.cid)&&void 0!==t?t:(0,gt.Z)(),constructFragmentsByBinId:(0,Jt.m8)(Object.entries(e.constructFragmentsByBinId).map((([e,t])=>{let a=t.fragment
const i=n[e]
if((0,tO.Yv)(t.fragment)&&null!=i){const e=i(t.fragment.rawText)
e.type===lO.D.FOUND&&(a=(0,tO.rx)(e.value.fragmentCid))}return[e,{fragment:a}]})))}}))})}getNumConstructs(){return this.state.constructs.length}getFilledOutFragments(){return this.state.fragments.filter((e=>null!=this.validationResults.fragmentResultsByCid[e.cid]))}getNumFilledOutConstructs(){return Object.values(this.validationResults.constructResultsByCid).filter((e=>null!=e)).length}getNumValidConstructs(){return Object.values(this.validationResults.constructResultsByCid).filter((e=>null!=e&&e!==Go.br&&Object.values(e.validationMessages).every((e=>e.status!==Sn.zc.ERROR)))).length}areAllConstructsSpecified(){return this.state.constructs.every((e=>null!=this.validationResults.constructResultsByCid[e.cid]))}areAllConstructsValid(){return this.getNumValidConstructs()===this.getNumConstructs()}getLayoutHasErrorTypes(){const{errorsByBin:e,otherErrors:t}=this.assemblyLayoutValidator.getAssemblyLayoutValidationErrors()
return Object.values(e).reduce(((e,t)=>{t.forEach((t=>e.add(t)))
return e}),new Set(t))}getLayoutErrorMessages(){const e=this.getLayoutHasErrorTypes()
return(0,hs.Z)([...e],[e=>e]).map((e=>(0,sO.HR)(e,this.assemblySelector.getMethod().type)))}getAssemblyFinalizationErrorMessage(){const e=this.getLayoutErrorMessages()
return e.length>0?e[0]:0===this.getNumConstructs()?"Specify valid constructs to finalize your assembly.":this.areAllConstructsSpecified()?this.areAllConstructsValid()?null:"Resolve construct errors to finalize your assembly.":"Add missing fragments to constructs, or choose to skip them, to finalize your assembly."}getUpdatedFragmentsOnBinChange(e){const{method:t}=this.state
if(t.type!==eO.tU.GOLDEN_GATE||e.fragmentProductionMethod===eO.y0.PRIMER_PAIR)return null
let n=!1
const a=[]
for(const t of this.state.fragments){const i=(0,rO.OC)(t)
if(!(0,tO._F)(t.bin)||t.bin.id!==e.cid||(0,tO.Av)(t.preferredPrimer5)&&(0,tO.Av)(t.preferredPrimer3))a.push({...i,...t})
else{n=!0
a.push({...i,...t,preferredPrimer5:tO.zQ,preferredPrimer3:tO.zQ})}}return n?{updatedFragments:a,warnings:["This change will remove the preferred primers you've specified for this bin."]}:null}supportedPolymerSubtypes(){const e=this.assemblySelector.getMethod()
return e.type===eO.tU.CONCATENATION?e.parameters.polymerSubtype===An.Dj.dna_sequence?[e.parameters.polymerSubtype,An.Dj.dna_oligo]:e.parameters.polymerSubtype===An.Dj.rna_sequence?[e.parameters.polymerSubtype,An.Dj.rna_oligo]:[e.parameters.polymerSubtype]:[An.Dj.dna_sequence]}getFragmentIcon(){const e=this.supportedPolymerSubtypes()
return e.includes(An.Dj.dna_sequence)?rr.m.Sequence:e.includes(An.Dj.rna_sequence)?rr.m.RNASequence:e.includes(An.Dj.aa_sequence)?rr.m.Protein:rr.m.OligoV2}}var cO=n(532386),dO=n(565242)
const uO=(0,n(989566).Z)((()=>new Set))
function startBulkAssemblyAutoSaverIfNecessary(e){const t=uO()
if(!t.has(e)){t.add(e)
!function autoSaveBulkAssembly(e){let t=!1
!function subscribeToBulkAssemblyEdits(e,t){let n=null,a=null,i=null
return(0,Vn.getStore)().subscribe((async()=>{var s
const r=null!==(s=(0,Vn.getStore)().getState().ui.molbio.bulkAssemblies[e])&&void 0!==s?s:null
if(!n||!r||Is()(n,r)){n=r
return}n=r
const o=l.default.uniqueId("bulk-assembly-subscription")
i=o
a&&await Promise.allSettled([a])
if(o===i){a=t(r)
await a
a=null}}))}(e,(async n=>{await async function withWarnOnClose(e){function handleBeforeUnload(e){e.preventDefault()
e.returnValue=""}window.addEventListener("beforeunload",handleBeforeUnload)
try{return await e()}finally{window.removeEventListener("beforeunload",handleBeforeUnload)}}((async()=>{sP.qu("Saving...")
try{await(0,dO.fr)(e,n)
if(t){v.ZP.success("Saved.",{id:`bulk-assembly-${e}`})
t=!1}sP.v8("Saved.")}catch(n){sP.qu("Error saving your assembly.")
if(!(0,Cn.d0)(n))throw n
v.ZP.error("There was an error saving your assembly.",{id:`bulk-assembly-${e}`,duration:v.a9})
t=!0}}))}))}(e)}}const mO=xa.Ps`
  query BulkAssemblySequenceNameQuery($ids: [StrictString]!) @skipAudit @engComponent(name: MOLBIO) {
    sequences(ids: $ids) {
      ... on SequenceNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,pO=xa.Ps`
  query BulkAssemblyProteinNameQuery($ids: [StrictString]!) @skipAudit @engComponent(name: MOLBIO) {
    proteins(ids: $ids) {
      ... on ProteinNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,hO=xa.Ps`
  query BulkAssemblySequenceLatestVersionBulkQuery($ids: [StrictString]!)
  @skipAudit
  @engComponent(name: MOLBIO) {
    sequences(ids: $ids) {
      ... on SequenceNode {
        id
        latestVersionId
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,gO=xa.Ps`
  query BulkAssemblyProteinLatestVersionBulkQuery($ids: [StrictString]!)
  @skipAudit
  @engComponent(name: MOLBIO) {
    proteins(ids: $ids) {
      ... on ProteinNode {
        id
        latestVersionId
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,EO=xa.Ps`
  query BulkAssemblySequenceBasicContentsQuery($sequenceVersionSpecifiers: [SequenceVersionSpecifierInput!]!)
  @skipAudit
  @engComponent(name: MOLBIO) {
    sequenceVersions(sequenceVersionSpecifiers: $sequenceVersionSpecifiers) {
      ... on SequenceVersionNode {
        dbId
        sequence {
          id
          sequenceType
        }
        bases
        circular
        startIndex
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,fO=xa.Ps`
  query BulkAssemblyProteinBasicContentsQuery($proteinVersionSpecifiers: [ProteinVersionSpecifierInput!]!)
  @skipAudit
  @engComponent(name: MOLBIO) {
    proteinVersions(proteinVersionSpecifiers: $proteinVersionSpecifiers) {
      ... on ProteinVersionNode {
        dbId
        protein {
          id
        }
        aminoAcids
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function versionKey(e,t){return`${e}:${t}`}class BulkAssemblyPolymerData{constructor(e,t,n){this.polymerNamesById=e
this.latestVersionDbIdById=t
this.basicPolymerInfoByKey=n}getName(e){var t
return null!==(t=this.polymerNamesById[e])&&void 0!==t?t:null}getLatestVersionDbId(e){var t
return null!==(t=this.latestVersionDbIdById[e])&&void 0!==t?t:null}getBasicPolymerInfo(e,t){var n
return null!==(n=this.basicPolymerInfoByKey[versionKey(e,t)])&&void 0!==n?n:null}}function getAllFragmentSequenceIds(e){return l.default.compact(e.fragments.map((e=>(0,tO._F)(e.sequence)?e.sequence.id:null)))}function getAllFragmentPreferredPrimerIds(e){return l.default.compact(e.fragments.flatMap((e=>[(0,tO._F)(e.preferredPrimer5)?e.preferredPrimer5.id:null,(0,tO._F)(e.preferredPrimer3)?e.preferredPrimer3.id:null])))}function getResultDataOrPrevious(e){var t
return e.type===Da.NI.SUCCESS?e.data:e.type===Da.NI.PENDING&&null!==(t=e.previousData)&&void 0!==t?t:null}function usePolymerNamesById(e){const t=e?[...getAllFragmentSequenceIds(e),...getAllFragmentPreferredPrimerIds(e)]:[],n=e?function getAllFragmentProteinIds(e){return l.default.compact(e.fragments.map((e=>(0,tO._F)(e.protein)?e.protein.id:null)))}(e):[],a=(0,Da.A4)(mO,{variables:{ids:t},skip:0===t.length}),i=(0,Da.A4)(pO,{variables:{ids:n},skip:0===n.length}),s=getResultDataOrPrevious(a),r=getResultDataOrPrevious(i)
let o=[]
null!=s&&(o=o.concat((0,ka.mj)(s.sequences)))
null!=r&&(o=o.concat((0,ka.mj)(r.proteins)))
return(0,Jt.m8)(o.map((({id:e,name:t})=>[e,t])))}function useBulkAssemblyPolymerData(e){const t=usePolymerNamesById(e),n=function useLatestVersionDbIdById(e){var t,n
const a=null!==(t=null==e?void 0:e.fragments.flatMap((e=>(0,tO._F)(e.sequence)&&null==e.sequenceVersionDbId?[e.sequence.id]:[])))&&void 0!==t?t:[],i=null!==(n=null==e?void 0:e.fragments.flatMap((e=>(0,tO._F)(e.protein)&&null==e.proteinVersionDbId?[e.protein.id]:[])))&&void 0!==n?n:[],s=(0,Da.A4)(hO,{variables:{ids:a},skip:0===a.length}),r=(0,Da.A4)(gO,{variables:{ids:i},skip:0===i.length}),o=getResultDataOrPrevious(s),l=getResultDataOrPrevious(r)
let c=[]
null!=o&&(c=c.concat((0,ka.mj)(o.sequences)))
null!=l&&(c=c.concat((0,ka.mj)(l.proteins)))
return(0,Jt.m8)(c.map((({id:e,latestVersionId:t})=>[e,null!=t?t:void 0])))}(e),a=function useBasicPolymerInfosByKey(e,t){var n,a
const i=[...null!==(n=null==e?void 0:e.fragments.flatMap((e=>(0,tO._F)(e.sequence)&&null!=e.sequenceVersionDbId?[{sequenceId:e.sequence.id,versionDbId:e.sequenceVersionDbId}]:[])))&&void 0!==n?n:[],...Object.entries(t).filter((([e,t])=>ea.ZP.isNucleotideSequence(e))).map((([e,t])=>({sequenceId:e,versionDbId:t})))],s=[...null!==(a=null==e?void 0:e.fragments.flatMap((e=>(0,tO._F)(e.protein)&&null!=e.proteinVersionDbId?[{proteinId:e.protein.id,versionDbId:e.proteinVersionDbId}]:[])))&&void 0!==a?a:[],...Object.entries(t).filter((([e,t])=>ea.ZP.isProtein(e))).map((([e,t])=>({proteinId:e,versionDbId:t})))],r=(0,Da.A4)(EO,{variables:{sequenceVersionSpecifiers:i},skip:0===i.length}),o=(0,Da.A4)(fO,{variables:{proteinVersionSpecifiers:s},skip:0===s.length}),l=getResultDataOrPrevious(r),c=getResultDataOrPrevious(o),d={}
if(null!=l)for(const e of l.sequenceVersions)(0,ka.CZ)(e)||(d[versionKey(e.sequence.id,e.dbId)]={residues:e.bases,circular:e.circular,startIndex:e.startIndex,singleStranded:e.sequence.sequenceType!==Sn.uS.ds})
if(null!=c)for(const e of c.proteinVersions)(0,ka.CZ)(e)||(d[versionKey(e.protein.id,e.dbId)]={residues:e.aminoAcids,circular:!1,startIndex:1,singleStranded:!0})
return d}(e,n)
return new BulkAssemblyPolymerData(t,n,a)}class BulkAssemblyStateManager{constructor(e,t){this.existingState=e
this.polymerData=t
this.existingFragmentsByCid=(0,Jt.Pe)(this.existingState.fragments,(e=>e.cid))
this.existingStateSelector=new AssemblySelector(e)}resolveState(e){const t=new AssemblySelector(e),n=new Set(e.binCidOrdering),a=e.fragments.map((e=>this.resolveFragment(e,n,t))),i=new Set(a.flatMap((e=>(0,tO._F)(e.bin)?[this.binFragmentKey(e.bin.id,e.cid)]:[]))),s=e.constructs.map((e=>this.resolveConstruct(e,n,i)))
return{...e,fragments:a,constructs:s}}binFragmentKey(e,t){return`${e}:${t}`}updateFragmentForRestrictionEnzymes(e,t){if(!this.existingFragmentsByCid.hasOwnProperty(e.cid))return e
return this.existingStateSelector.getFragmentProductionMethodForBin(this.existingFragmentsByCid[e.cid].bin)!==t.getFragmentProductionMethodForBin(e.bin)?{...e,restrictionEnzyme5:tO.zQ,restrictionEnzyme3:tO.zQ}:e}resolveFragment(e,t,n){let a={...e};(0,tO._F)(a.bin)&&!t.has(a.bin.id)&&(a={...a,bin:(0,tO.vW)(this.lastKnownBinName(a.bin.id))})
a=this.updateFragmentForRestrictionEnzymes(a,n)
return a}resolveConstruct(e,t,n){return{...e,constructFragmentsByBinId:(0,Jt.m8)(Object.entries(e.constructFragmentsByBinId).flatMap((([e,a])=>t.has(e)?[[e,this.resolveConstructFragment(e,a,n)]]:[])))}}resolveConstructFragment(e,t,n){return(0,tO._F)(t.fragment)&&!n.has(this.binFragmentKey(e,t.fragment.id))?{fragment:(0,tO.vW)(this.lastKnownFragmentName(t.fragment.id))}:t}lastKnownBinName(e){return this.existingState.binsByCid.hasOwnProperty(e)?this.existingState.binsByCid[e].name:""}lastKnownFragmentName(e){var t,n
if(this.existingFragmentsByCid.hasOwnProperty(e)){const a=this.existingFragmentsByCid[e]
if((0,tO._F)(a.sequence))return null!==(t=this.polymerData.getName(a.sequence.id))&&void 0!==t?t:""
if((0,tO._F)(a.protein))return null!==(n=this.polymerData.getName(a.protein.id))&&void 0!==n?n:""}return""}}const SO=xa.Ps`
  ${iO.bp}
  query BulkAssemblyValidationResultsQuery($validationInput: BulkAssemblyValidationInput!)
  @skipAudit
  @engComponent(name: MOLBIO) {
    bulkAssemblyValidation(validationInput: $validationInput) {
      ...BulkAssemblyValidationFragment
    }
  }
`
function useAssemblyValidationResults(e,t,n){const a=(0,d.useRef)((0,iO.ix)()),i=null!=t&&(0,yc.ZP)(t),s=t&&t.isFinalized,r=i||s?null:(0,iO.QZ)(e,n),o=(0,Da.A4)(SO,{variables:{validationInput:r},skip:null==r}),l=o.refetch
let c
if(s){const{assemblyValidationResult:e,fragmentValidationResults:n,constructValidationResults:a}=t.finalizedResults
c={assemblyResult:e,fragmentResultsByCid:(0,Jt.Pe)(n,(e=>e.fragmentId)),constructResultsByCid:(0,Jt.Pe)(a,(e=>e.constructId))}}else{c=(0,iO.j0)(r,o.type===Da.NI.SUCCESS?o.data.bulkAssemblyValidation:null,a.current)
null==t||function isValidationLoading(e){return e.assemblyResult===Go.br||Object.values(e.fragmentResultsByCid).includes(Go.br)||Object.values(e.constructResultsByCid).includes(Go.br)}(c)||m.L9(vc.Jg.UPDATED_BULK_ASSEMBLY_VALIDATION,{actionOrigin:Sn.D2.MOLBIO,assemblyId:t.id,numAssemblyWarnings:getNumValidationResultsByStatus([c.assemblyResult],Sn.zc.WARNING),numAssemblyErrors:getNumValidationResultsByStatus([c.assemblyResult],Sn.zc.ERROR),numAssemblySuccesses:getNumValidationResultsByStatus([c.assemblyResult],Sn.zc.SUCCESS),numFragmentWarnings:getNumValidationResultsByStatus(Object.values(c.fragmentResultsByCid),Sn.zc.WARNING),numFragmentErrors:getNumValidationResultsByStatus(Object.values(c.fragmentResultsByCid),Sn.zc.ERROR),numFragmentSuccesses:getNumValidationResultsByStatus(Object.values(c.fragmentResultsByCid),Sn.zc.SUCCESS),numFragmentRows:Object.values(c.fragmentResultsByCid).length,numCompletedFragmentRows:Object.values(c.fragmentResultsByCid).filter((e=>null!=e)).length,numConstructWarnings:getNumValidationResultsByStatus(Object.values(c.constructResultsByCid),Sn.zc.WARNING),numConstructErrors:getNumValidationResultsByStatus(Object.values(c.constructResultsByCid),Sn.zc.ERROR),numConstructSuccesses:getNumValidationResultsByStatus(Object.values(c.constructResultsByCid),Sn.zc.ERROR),numConstructRows:Object.values(c.constructResultsByCid).length,numCompletedConstructRows:Object.values(c.constructResultsByCid).filter((e=>null!=e)).length})}return{validationResults:c,refetchValidation:l}}function getNumValidationResultsByStatus(e,t){return e.flatMap((e=>null!=e&&e!==Go.br?e.validationMessages:[])).filter((e=>e.status===t)).length}function useAssemblyCoordinator(e){const t=(0,Da.IJ)(cO.bW,{variables:{fileId:e,procedureVersion:eO.GR}}),n=t.type!==Da.NI.SUCCESS||(0,ka.CZ)(t.data.bulkAssembly)?null:t.data.bulkAssembly,a=function useAssemblyProcedure(e,t){var n,a,i
const s=null!==(n=(0,_a.v9)((t=>t.ui.molbio.bulkAssemblies[e])))&&void 0!==n?n:null
null!=t&&null==t.procedureJson&&v.ZP.error("There was an error loading data. Please refresh the page")
const r=null!==(a=null==t?void 0:t.procedureJson)&&void 0!==a?a:null,o=null!==(i=null==t?void 0:t.isFinalized)&&void 0!==i&&i,l=null!=t&&(0,yc.ZP)(t),c=(null==t?void 0:t.permissions.writable)&&(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT}),u=null!=s;(0,d.useEffect)((()=>{o||l||!c||null==r||u||(0,Vn.getStore)().dispatch((0,aO.un)(e,r))}),[o,l,c,e,u,r])
return o||!c||l&&!u?r:s}(e,n),i=useBulkAssemblyPolymerData(a),{validationResults:s,refetchValidation:r}=useAssemblyValidationResults(a,n,i),o=null!=n&&null!=a?new AssemblyCoordinator(new BulkAssemblyStateManager(a,i),e,n.isFinalized,(0,yc.ZP)(n),n.permissions.writable&&(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT}),a,n.name,n.folder.id,i,s,t.refetch,r):null;(0,d.useEffect)((()=>{n&&!n.isFinalized&&startBulkAssemblyAutoSaverIfNecessary(e)
null!=o&&o.performEffectsAfterRender()}))
return o}function PolymerCard({active:e,isOnlyCard:t,condensedView:n,onActivate:a,children:i}){return d.createElement("div",{className:(0,g.iv)(yO.cardContent,e&&!t&&yO.active,!e&&yO.clickable),onClick:e?void 0:a},e&&null!=i?i:n)}const yO=g.mM.create({cardContent:{borderBottom:`1px solid ${Vt.pF}`,padding:"12px"},clickable:{cursor:"pointer"},active:{borderLeftColor:Vt.t0,borderLeftWidth:"5px",borderLeftStyle:"solid"}})
function PolymerModalContent({assemblyId:e,activeIndex:t,cards:n,activePolymerMap:a,setActiveIndex:i}){return d.createElement("div",{className:(0,g.iv)(bO.modalContents)},d.createElement("div",{className:(0,g.iv)(bO.panel)},n.map(((a,s)=>d.createElement(PolymerCard,{condensedView:a.condensedView,key:s,active:t===s,isOnlyCard:1===n.length,onActivate:()=>{m.L9(vc.Jg.UPDATED_BULK_ASSEMBLY_FRAGMENT_MODAL_ACTIVE_FRAGMENT,{assemblyId:e,actionOrigin:Sn.D2.MOLBIO_BULK_ASSEMBLY_FRAGMENT_MODAL})
i(s)}},a.contents)))),d.createElement("div",{className:(0,g.iv)(bO.map)},a))}const bO=g.mM.create({modalContents:{display:"flex",width:"100%",height:"100%"},panel:{width:"280px",borderRight:`1px solid ${Vt.pF}`,overflowY:"auto"},map:{flex:1,overflowX:"auto"}})
function PolymerTitle({polymerId:e,polymerName:t}){return d.createElement("div",null,null!=e?d.createElement(Fa.BioentityChip,{id:e,size:Za.TK.MINI,validationExtras:null}):d.createElement("span",null,t))}function PolymerMapWrapper({className:e,tabState:t,TabOptionsViewCls:n,TabContentViewCls:a}){return d.createElement("div",{className:f()("reset",e)},d.createElement("div",{id:"buffers",className:(0,g.iv)(TO.buffers)},d.createElement("div",{className:"buffer-container"},d.createElement(mt,{TabOptionsViewCls:n,TabContentViewCls:a,tabState:t}))))}const TO=g.mM.create({buffers:{bottom:"0",right:"0",height:"100%"}})
function AntibodyToolsMetadata({aminoAcids:e,visibilityOptions:t}){const[n,a]=getAntibodyVisibilitySettings(t),[i,s]=useAntibodyMetadata(e,n,a)
return shouldShowAntibodyTools(t)?d.createElement("div",{className:(0,g.iv)(vO.antibodyMetadataContainer)},i&&d.createElement(P.ZP,{title:i},d.createElement("span",{className:(0,g.iv)(vO.antibodyMessage)},i)),s&&d.createElement(P.ZP,{title:"Antibody Chain(s) (Best Match)"},d.createElement("span",{className:(0,g.iv)(vO.organismInfo)},s))):d.createElement(d.Fragment,null)}const vO=g.mM.create({antibodyMetadataContainer:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingRight:15,paddingBottom:2},antibodyMessage:{color:Vt.Y},organismInfo:{marginLeft:5}})
const CO=g.mM.create({noShrink:{flexShrink:0}}),IO=function ProteinMapOptions({aminoAcids:e,bannerText:t,onSearch:n,visibilityOptions:a,zoomSliderProps:i,featureCounts:s}){return d.createElement("div",{className:"reset"},d.createElement("div",{className:"buffer-options-container",...(0,ee.Z)({component:"ProteinMapOptions",element:"root"})},d.createElement(CP.Z,null,d.createElement(ZoomSlider,{...i,className:(0,g.iv)(CO.noShrink)})),d.createElement(OptionsBanner,{bannerText:t}),d.createElement(AntibodyToolsMetadata,{aminoAcids:e,visibilityOptions:a}),d.createElement("div",{className:`buttonGroup ${(0,g.iv)(CO.noShrink)}`},d.createElement(St.Z,{featureCounts:s,options:a}),d.createElement(SearchButton,{onToggleSearch:n}))))}
const wO=g.mM.create({noShrink:{flexShrink:0},expander:{flex:1}}),NO=function SimplifiedProteinMapOptions_ProteinMapOptions({visibilityOptions:e,zoomSliderProps:t,featureCounts:n,aminoAcids:a}){return d.createElement("div",{className:"reset"},d.createElement("div",{className:"buffer-options-container",...(0,ee.Z)({component:"ProteinMapOptions",element:"root"})},d.createElement(CP.Z,null,d.createElement(ZoomSlider,{...t,className:(0,g.iv)(wO.noShrink)})),d.createElement(CP.Z,{className:(0,g.iv)(wO.expander)}),d.createElement(AntibodyToolsMetadata,{aminoAcids:a,visibilityOptions:e}),d.createElement("div",{className:`buttonGroup ${(0,g.iv)(wO.noShrink)}`},d.createElement(St.Z,{featureCounts:n,options:e}))))}
const AO=g.mM.create({input:{marginBottom:"10px"},pressText:{..._n.E0,fontWeight:_n.KB,margin:"0",padding:"0"}}),RO=function ProteinInputBubble(e){const[t,n]=(0,d.useState)(filterValidAminoAcids(e.pasteText)),a=e.isDelete?e.selection.length():t.length
function handleCommitAminoAcids(){var n;(null===(n=e.selection)||void 0===n?void 0:n.isNotEmpty())?Ea.Z.replaceAminoAcids(e.proteinId,{start:e.selection.start(),end:e.selection.end(),aminoAcids:t,onSuccess:e.onRequestClose}):Ea.Z.insertAminoAcids(e.proteinId,{position:e.selection.start(),aminoAcids:t,onSuccess:e.onRequestClose})}function filterValidAminoAcids(e){return e.split("").filter((e=>ns.IJ(e))).join("")}function handleKbdMouseDown(e){e.preventDefault()}return d.createElement("div",{className:"input-bubble",onKeyDown:function handleKeyDown(t){pn.isEscapeKey(t)&&e.onRequestClose()
pn.isEnterKey(t)&&handleCommitAminoAcids()},onBlur:e.onRequestClose,style:{top:e.top,left:e.left,width:tr.Z.BUBBLE_WIDTH},tabIndex:-1,...(0,ee.Z)({component:"ProteinInputBubble",element:"root"})},!e.isPositionedAbove&&d.createElement("div",{className:"triangle top",style:{left:e.offset}}),!e.isDelete&&d.createElement("input",{className:f()((0,g.iv)(AO.input),"mono"),type:"text",value:t,onChange:e=>{n(filterValidAminoAcids(e.target.value))},autoFocus:!0,spellCheck:!1}),d.createElement("p",{className:(0,g.iv)(AO.pressText)},"Press"),d.createElement("p",null,d.createElement("a",{className:"enter-btn"},d.createElement("kbd",{onMouseDown:handleKbdMouseDown,onClick:handleCommitAminoAcids},"ENTER")),` to ${function getActionText(){var t
return e.isDelete?"delete":(null===(t=e.selection)||void 0===t?void 0:t.isNotEmpty())?"replace with":"insert"}()} ${a} ${de._6(a,"residue")}\n            at position ${T.modelToDisplay(e.selection.start(),1)}`),d.createElement("p",null,d.createElement("a",{className:"esc-btn"},d.createElement("kbd",{onMouseDown:handleKbdMouseDown,onClick:e.onRequestClose},"ESC")),"to cancel"),e.isPositionedAbove&&d.createElement("div",{className:"triangle bottom",style:{left:e.offset}}))}
var PO=n(783705)
class ProteinSliceItemSource extends vP{initialize(e){super.initialize(e)
this.listenTo(this.get("mapstate").protein(),"change",this.update)}getBasesLayout(){return this.mapstate.get("layout").AminoAcids}sliceViewY(){return Kt.PROTEIN_MAP_Y_COMPONENTS}sliceViewZ(){return Kt.PROTEIN_MAP_Z_COMPONENTS}}class ProteinMap extends bP{static initStatics(){this.prototype.id="protein-map"
this.prototype.inputSource="protein-map-input"}initialize(...e){super.initialize(...e)
this.$reactMount=o()("<div>",{class:"js-reactMount"})
this.$el.append(this.$reactMount)
addTestAttrsToDOMElement(this.$el[0],{component:"ProteinMapView",element:"root"})
this._handleRemoveInputBubble=this._handleRemoveInputBubble.bind(this)}createSliceItemSource(e){return new ProteinSliceItemSource(e)}addPolymersForSearch(){Ea.Z.addProteinsForSearch([this.model.protein().id])}removePolymersForSearch(){Ea.Z.removeProteinsFromSearch([this.model.protein().id])}storeRegionInBenchlingClipboard(e){const t=this.mapstate.protein(),n=t.selection().assertNotEmpty(),a=t.residueSlice(n.start(),n.end()),i=PO.BR.stdDesc(n)
PO.BR.store(a)
return PO.BR.getHash(a,i)}getType(){return this.mapstate.get("layout").AminoAcids.get("type")}handlePasteText(e){if(!this.model.protein().allowResidueEdits())return
const t=function validateAndStripAminoAcids(e){const[t,n]=l.default.partition(e,(e=>ns.IJ(e))),a=t.join("")
if(0===a.length){v.ZP.info("No valid amino acids were pasted.")
return null}n.length>0&&n.some((e=>!/\s/.test(e)))&&v.ZP.info("Some amino acids pasted were not valid and were removed.")
return a}(e)
if(null==t)return
const n=this.model.protein(),a=n.selection().start(),i=n.selection().end()
null!==i?Ea.Z.replaceAminoAcids(n.id,{start:a,end:i,aminoAcids:t}):Ea.Z.insertAminoAcids(n.id,{position:a,aminoAcids:t})}undo(){const e=this.model.protein()
e.allowResidueEdits()&&Ea.Z.undo(e.id)}handleCtrlShiftC(e){e.preventDefault()}_getBubbleOffsetClass(){return".aminoAcids"}repositionBubble(){this.inputBubble&&this.showInputBubble()}showInputBubble(e){var t,n
const a=this._calculateBubblePos()
if(null==a){this._handleRemoveInputBubble()
return}const{top:i,left:s,offset:r,isPositionedAbove:l}=a,c=this.mapstate.protein();(0,Me.A9)(d.createElement(RO,{proteinId:c.id,selection:c.selection(),top:i,left:s,offset:r,isPositionedAbove:l,onRequestClose:this._handleRemoveInputBubble,pasteText:null!==(t=null==e?void 0:e.pasteText)&&void 0!==t?t:"",isDelete:null!==(n=null==e?void 0:e.isDelete)&&void 0!==n&&n}),this.$reactMount[0]);(null==e?void 0:e.isDelete)&&o()(".input-bubble").focus()}_handleRemoveInputBubble(){u.unmountComponentAtNode(this.$reactMount[0])
this.inputBubble=null}isValidCharacter(e){return ns.IJ(e)}}ProteinMap.initStatics()
class ProteinMapOptionsView extends s().View{initialize(){this.mapstate=this.model.get("mapstate")
this.listenTo(this.mapstate,"change:zoom",this.render)
this.listenTo(this.mapstate.get("polymer"),"change:banner",this.render)
ba.Z.addChangeListener((()=>this.render()))
this.listenTo(this.mapstate.get("visibilityOptions"),"change",this.render)
dt.ZP.MOLBIO_ENABLE_ANTIBODY_ENGINEERING_TOOLS&&listenToAntibodyVisibilitySettings(this.mapstate.get("visibilityOptions"),this,this.render.bind(this))}render(){(0,Me.A9)(d.createElement(IO,{aminoAcids:this.mapstate.get("polymer").aminoAcids(),onSearch:()=>{Ea.Z.openSearchView()},bannerText:this.mapstate.get("polymer").getBannerText(),zoomSliderProps:{min:this.mapstate.get("minZoom"),max:this.mapstate.get("maxZoom"),value:this.mapstate.get("zoom"),step:this.mapstate.get("stepZoom"),disabled:!1,onChange:e=>this.mapstate.setZoom(e),zoomBigger:()=>this.mapstate.changeZoomByStep(10),zoomSmaller:()=>this.mapstate.changeZoomByStep(-10)},visibilityOptions:this.mapstate.get("visibilityOptions"),featureCounts:{annotations:this.mapstate.get("polymer").annotations().length}}),this.el)
return this}}class SimplifiedProteinMapOptionsView extends s().View{initialize(){this.mapstate=this.model.get("mapstate")
this.listenTo(this.mapstate,"change:zoom",this.render)
this.listenTo(this.mapstate.get("polymer"),"change:banner",this.render)
ba.Z.addChangeListener((()=>this.render()))
this.listenTo(this.mapstate.get("visibilityOptions"),"change",this.render)}render(){(0,Me.A9)(d.createElement(NO,{zoomSliderProps:{min:this.mapstate.get("minZoom"),max:this.mapstate.get("maxZoom"),value:this.mapstate.get("zoom"),step:this.mapstate.get("stepZoom"),disabled:!1,onChange:e=>this.mapstate.setZoom(e),zoomBigger:()=>this.mapstate.changeZoomByStep(10),zoomSmaller:()=>this.mapstate.changeZoomByStep(-10)},visibilityOptions:this.mapstate.get("visibilityOptions"),featureCounts:{annotations:this.mapstate.get("polymer").annotations().length},aminoAcids:this.mapstate.get("polymer").aminoAcids()}),this.el)
return this}}function ProteinMapContainer({proteinRef:e,className:t}){const[n,a]=(0,d.useState)((()=>new aC.Z({protein:e.current})));(0,d.useEffect)((()=>{a(new aC.Z({protein:e.current}))}),[e])
return d.createElement(PolymerMapWrapper,{className:t,TabOptionsViewCls:SimplifiedProteinMapOptionsView,TabContentViewCls:ProteinMap,tabState:n})}class CircularMapTab extends nr{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-overflow"
this.prototype.id="circular-map"
this.prototype.inputSource="circular-input"}addPolymersForSearch(){qn.ZP.addPolymersForSearch(this.model.get("sequence"))}removePolymersForSearch(){qn.ZP.removePolymersForSearch(this.model.get("sequence"))}getHeight(){return null}initialize(e){this.mapstate=this.model.get("mapstate")
this.setMapDimensions()
return this.layout=this.mapstate.get("layout")}stopListening(){if(0===arguments.length){super.stopListening()
Re().select(this.el).on(".circular",null)
return null!=this.circularMapView?this.circularMapView.die():void 0}super.stopListening(...arguments)}isValidCharacter(e){return y.isValidBase(e,R.jb)}showInputBubble(e){qn.ZP.showInputBubble(this,e)}storeRegionInBenchlingClipboard(e){return qn.ZP.maybeStoreNucleotideRegionInBenchlingClipboard(this.mapstate.get("sequence").selection(),e)}handlePasteText(e){qn.ZP.handlePasteText(this.mapstate.get("sequence"),e)}handleCtrlShiftC(e){return qn.ZP.handleCtrlShiftC(this.mapstate.get("sequence"),e)}handleArrowPress(e){e.preventDefault()
const t=this.mapstate.get("sequence").get("selection"),n=e.shiftKey,a=t.start(),i=t.end(),s=this.mapstate.get("sequence").length()
switch(e.which){case 37:n?t.circularExtendBy(-1):t.isEmpty()?t.reset((a+s-1)%s):t.reset(a)
break
case 39:n?t.circularExtendBy(1):t.isEmpty()?t.reset((a+1)%s):t.reset(i)}return this.mapstate.get("sequence").trigger("cursorJump")}_calculateBubblePos(){const e=this._getCursorElement()
if(0===e.length)return null
let t,n,a
const i=this.$el.offset(),s=this.getSelection(),r=this.circularMapView.getAngles(s.start(),s.end()).startAngle
if(this.$el.find(".square").length>0||this.$el.find(".letter").length>0){const i=24,s=36,o=this.$el.find(".square").length>0?i:s
t=e.offset()
const l=Math.floor(r/(Math.PI/2))+1,c=[3,4].includes(l)?r+Math.PI:r;({x:n,y:a}=Os.polar(o,c))
a=[1,3].includes(l)?-a:a}else{if(!(this.$el.find(".circle").length>0))return null
{t=this.$el.find(".circle").offset()
const e=this.circularMapView.views.dnaView.getInnerRadius(),i=this.circularMapView.views.dnaView.getOuterRadius();({x:n,y:a}=Os.polar(e,r))
n+=i
a+=i}}let o=t.top-i.top+18+a,l=t.left-i.left+n
const c=this.$el.width()-l
let d=0
if(c<tr.Z.BUBBLE_WIDTH-20){l=this.$el.width()-tr.Z.BUBBLE_WIDTH+20
d=tr.Z.BUBBLE_WIDTH-c-20}if(l<0||c<20||o>this.$el.height()+18)return null
const u=this.allowBubblePositionedAboveSlice()&&o+100>this.$el.height()
u&&(o-=30)
return{top:o,left:l,offset:d,isPositionedAbove:u}}registerListeners(){this.stopListening()
Re().select(this.el).on(`${mr.C$}.circular`,(e=>{const t=(e=Re().event).wheelDelta?e.wheelDelta:e.detail?-40*e.detail:e&&e.wheelDelta?e.wheelDelta:0
if(e.ctrlKey)this.mapstate.changeZoomByStep(t/120)
else{const e=Math.ceil(Math.abs(t/60*10*this.mapstate.get("sequence").length()/2e3)),n=t>0?-1:1
this.mapstate.changePanByStep(n*e)
this.circularMapView.updateSelection("mousemove")}this.repositionBubble()
return e.preventDefault()}))
return this.listenTo(this.model.get("bufferViewLayout"),"change:width change:height",this.setMapDimensions)}setMapDimensions(){this.mapstate.set({width:this.model.get("bufferViewLayout").get("width")})
return this.mapstate.set({height:this.model.get("bufferViewLayout").get("height")})}render(){super.render()
this.registerListeners()
this.circularMapView=new CircularMapView({model:this.mapstate,tabstate:this.model})
this.$el.append(this.circularMapView.render().el)
return this}}CircularMapTab.initClass()
function MiniMap_ownKeys(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e)
t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function MiniMap_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?MiniMap_ownKeys(Object(n),!0).forEach((function(t){MiniMap_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MiniMap_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function MiniMap_defineProperty(e,t,n){(t=function MiniMap_toPropertyKey(e){var t=function MiniMap_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class MiniMap extends nr{static initClass(){this.prototype.id="mini-map"
this.prototype.className="draggable-svg-container buffer-tab"
this.prototype.attributes=MiniMap_objectSpread(MiniMap_objectSpread({},this.prototype.attributes),(0,ee.Z)({component:"MiniMap",element:"root"}))}events(){return l.default.extend(super.events(),{scroll:"storeScroll",mousemove:"saveMouseCoordinates"})}saveMouseCoordinates(e){return this.lastMouseX=e.pageX}addPolymersForSearch(){qn.ZP.addPolymersForSearch(this.model.get("sequence"))}removePolymersForSearch(){qn.ZP.removePolymersForSearch(this.model.get("sequence"))}storeScroll(e){const t=this.$el.scrollLeft(),n=Math.floor(t/Re().select(this.el).select("svg.mini-map").attr("width")*this.mapstate.get("sequence").length()),a=Math.min(n+this.type.numChars(this.model.get("bufferViewLayout").get("width")),this.mapstate.get("sequence").length())
this.slice.set({leftBP:n,rightBP:a})
this.mapstate.set("leftBP",n)
if(this.mapstate.get("sequence").get("selection").get("active")&&null!=this.lastMouseX){this.sliceView.updateSelectionFromScroll(this.lastMouseX)
return document.getSelection().removeAllRanges()}}isValidCharacter(e){return Ue.util.isValidBase(e,this.mapstate.get("sequence").get("_sequence").baseTable())}restoreScroll(){return this.goToBase(this.mapstate.get("leftBP"),!1,this.mapstate.get("rightBP"))}storeRegionInBenchlingClipboard(e){return qn.ZP.maybeStoreNucleotideRegionInBenchlingClipboard(this.mapstate.get("sequence").selection(),e)}handlePasteText(e){return qn.ZP.handlePasteText(this.mapstate.get("sequence"),e)}handleCtrlShiftC(e){return qn.ZP.handleCtrlShiftC(this.mapstate.get("sequence"),e)}supportCutsites(){return!0}initialize(e){super.initialize(e)
this.mapstate=this.model.get("mapstate")
this.slice=new Yi.Z
this.slices=new gP([this.slice])
this.type=this.mapstate.get("layout").DNA.get("type")
this.mapType="minimap"
this.setSliceValues(!0)
this.lastMouseX=null
this.sliceView=new SliceView({slice:this.slice,model:this.mapstate,tabstate:this.model,selection:this.mapstate.polymer().selection(),mapType:Ts.minimap,y:Kt.MINI_MAP_Y_COMPONENTS,z:Kt.MINI_MAP_Z_COMPONENTS,svgSupportsForeignObject:(0,ja.p8)()});(0,as.hM)(this.mapstate.get("sequence"),this.model.get("title"))
return this.debouncedUpdateCutsiteData=(0,It.D)(this.updateCutsiteData,1)}maxBases(){return this.mapstate.get("sequence").length()}getHeight(){return parseInt(this.$("svg").attr("height"))+25}setZooms(){Re().select("svg.mini-map-title").attr("width",this.model.get("bufferViewLayout").get("width"))
const e=0===this.mapstate.get("sequence").length()?1:(this.model.get("bufferViewLayout").get("width")-30)/this.mapstate.get("sequence").length(),t=this.model.get("bufferViewLayout").get("width")/this.mapstate.get("sequence").length()>30?e:30
return this.mapstate.setFontWidthRange(e,t)}calcScroll(e,t){return this.sliceView.boxHeight()}remove(){this.sliceView.die()
return super.remove()}updateSelection(){return this.mapstate.get("sequence").get("selection").set({active:null})}goToBase(e,t,n=null){let a
null==t&&(t=!0)
const baseToScroll=e=>e/this.mapstate.get("sequence").length()*Re().select(this.el).select("svg.mini-map").attr("width"),i=this.$el.scrollLeft(),s=i+this.$el.width(),r=baseToScroll(e),o=null!=n?baseToScroll(n):r
a=i<r&&r<s?null==n||i<o&&o<s?null:Math.min(r,o-this.$el.width()):r
if(null!=a)return t?this.$el.stop(!0,!1).animate({scrollLeft:a},500):this.$el.scrollLeft(a)}handleZoom(){const e=this.mapstate.get("sequence").get("selection"),[t,n]=Array.from([this.mapstate.get("leftBP"),this.mapstate.get("rightBP")]),[a,i]=Array.from([e.start(),e.isEmpty()?e.start():e.end()])
T.isRangeOverlap(t,n,a,i)&&this.mapstate.set({leftBP:a,rightBP:i})
this.update()
this.restoreScroll()
this.repositionBubble()}mapWidth(){return this.model.get("bufferViewLayout").get("width")-30}_getBubbleOffsetClass(){return".body-slice"}showInputBubble(e){qn.ZP.showInputBubble(this,e)}_calculateBubblePos(){const e=super._calculateBubblePos()
if(null==e)return null
const{top:t,left:n,offset:a,isPositionedAbove:i}=e,s=this.$el.find(".sequenceAxis").offset(),r=this.$el.offset()
return{top:i?t+216:s.top-r.top+24,left:n+this.$el.scrollLeft(),offset:a,isPositionedAbove:i}}handleArrowPress(e){e.preventDefault()
const t=this.mapstate.get("sequence").get("selection"),n=e.shiftKey,a=t.start(),i=t.end()
this.mapstate.get("sequence").length(),this.getMoveEnd(),t.getState("column")
switch(e.which){case 37:n?t.linearExtendBy(-1):t.isEmpty()?t.resetBy(-1):t.reset(a)
break
case 39:n?t.linearExtendBy(1):t.isEmpty()?t.resetBy(1):t.reset(i)}return this.mapstate.get("sequence").trigger("cursorJump")}setSliceValues(e){null==e&&(e=!1)
const t=this.mapstate.get("sequence").length(),n=(this.mapstate.get("sequence").length(),this.mapstate.get("layout").DNA.get("type").width(t-0)+this.mapstate.get("layout").DNA.get("type").letterSpacing),a=Re().scale.linear().clamp(!0).domain([0,t]).range([0,n]),i=Re().scale.linear().clamp(!0).domain([0,n]).range([0,t]),s=(()=>{if(e)return{}
{const e=this.$el.scrollLeft(),t=Math.floor(e/Re().select(this.el).select("svg.mini-map").attr("width")*this.mapstate.get("sequence").length())
return{leftBP:t,rightBP:Math.min(t+this.type.numChars(this.model.get("bufferViewLayout").get("width")),this.mapstate.get("sequence").length())}}})(),r=l.default.extend({start:0,end:t,width:n,x:a,xInv:i,maxWidth:n,visibleWidth:this.mapWidth()},s)
this.slice.set(r,{skipUpdate:!0})}update(){const e=this.mapstate.get("layout").DNA.get("type").width(this.mapstate.get("sequence").length())
Re().select(this.el).select("svg.mini-map").attr("width",e+1)
this.setSliceValues()
if(0!==this.mapstate.get("sequence").length()){this.sliceView.$el.show()
this.sliceView.hasRendered?this.sliceView.update():this.sliceView.render()}else this.sliceView.$el.hide()}stopListening(){super.stopListening(...arguments)
0===arguments.length&&o()(window).off(".minimap")}registerLayerHandler(){const e=this.mapstate.get("sequence").annotations(),t=this.mapstate.get("sequence").translations(),n=this.model.get("visibilityOptions").getOption(Yt.ih.name)
this.listenTo(this.mapstate,"change:layeringMode",(function(){this.computeInlineLayers()
this.sliceView.updateComponent("annotations")
this.sliceView.updateComponent("translations")
this.sliceView.updateComponent("partAnnotations")}))
this.listenTo(this.slice,"change:xInv",(function(){this.computeInlineLayers()
if(n.get("visible")){this.sliceView.updateComponent("annotations")
this.sliceView.updateComponent("translations")
this.sliceView.updateComponent("partAnnotations")}}))
this.listenTo(e,"layerChange",(function(){this.computeInlineLayers()
this.sliceView.updateComponent("annotations")
this.sliceView.updateComponent("partAnnotations")}))
this.listenTo(t,"layerChange",(function(){this.computeInlineLayers()
this.sliceView.updateComponent("translations")}))
this.listenTo(this.slice,"change:rightBP",(0,Ja.Z)((function(){this.computeInlineLayers()
this.sliceView.updateComponent("annotations")
this.sliceView.updateComponent("translations")
this.sliceView.updateComponent("partAnnotations")}),100))
this.computeInlineLayers()}computeInlineLayers(){Array.from(Kt.LINEAR_INLINE_LAYERS).includes(this.mapstate.get("layeringMode"))&&this.mapstate.setInlineLayers(this.slice)}updateZoomAndSlice(){this.sliceView.dontUpdate=!0
this.setZooms()
this.sliceView.dontUpdate=!1
this.update()}registerListeners(){super.registerListeners()
const e=this.mapstate.get("sequence").get("cutsites")
hP.addListeners(this,e,this.debouncedUpdateCutsiteData)
this.listenTo(this.slice,"change:width",this.debouncedUpdateCutsiteData)
this.listenTo(this.model.get("bufferViewLayout"),"change:width",(()=>l.default.defer((()=>this.updateZoomAndSlice()))))
this.listenTo(this.mapstate.get("sequence").get("dna"),"change:forward",this.updateZoomAndSlice)
this.listenTo(this.mapstate,"change:fontWidthZoom",this.handleZoom)
this.listenTo(this.mapstate.get("sequence"),"jump",this.goToBase)
this.listenTo(this.mapstate.get("sequence").sequencePrimers(),"layerChange",l.default.bind((function(){return this.sliceView.updateComponent("primers")}),this))
this.listenTo(this.mapstate.get("sequence").get("_sequence"),"change:parts",this.update)
this.listenTo(this.mapstate.get("sequence").orfs(),"reset",(function(){return this.sliceView.updateComponent("orfs")}))
this.registerLayerHandler()
o()(window).on("mouseup.minimap",(()=>this.updateSelection()))
Re().select(this.el).on(`${mr.C$}.minimap`,(e=>{const t=(e=Re().event).wheelDelta?e.wheelDelta:e.detail?-40*e.detail:e&&e.wheelDelta?e.wheelDelta:0
if(e.ctrlKey){this.mapstate.zoomByFactor(Math.pow(2,t/480))
e.preventDefault()}}))}updateCutsiteData(){const e=this.makeSlicesForCutsites()
if(window.snapshot)for(const t of Array.from(e))t.set("cutData",[])
else{T.setCutsiteData(this.mapstate.get("sequence"),e,this.maxBases())
e[0].set("cutData",this.cutsiteFilter(e[0].get("cutData")))}}makeSlicesForCutsites(){return this.slices.models}cutsiteFilter(e){const t=this.mapstate.get("sequence"),n=this.model,a={[X.kH.ALL]:[X.kH.SINGLEANDDOUBLE,X.kH.DOUBLE,X.kH.SINGLE,X.kH.NONE],[X.kH.SINGLEANDDOUBLE]:[X.kH.DOUBLE,X.kH.SINGLE,X.kH.NONE],[X.kH.DOUBLE]:[X.kH.NONE],[X.kH.SINGLE]:[X.kH.NONE],[X.kH.NONE]:[]}
return function getCutsites(e){const i=1e3
let s=t.get("enzymes").filter((e=>e.isVisibleByCuts(X.kH.NONE,[])))
s=l.default.sortBy(s,(e=>-e.get("cutPositions").length))
let r=l.default.reduce(s,((e,t)=>e+t.get("cutPositions").length),0)
const o=[]
for(;r>i;){const e=s.shift()
r-=e.get("cutPositions").length
o.push(e)}const c=function MiniMap_guard_(e,t){return null!=e?t(e):void 0}(t.get("fileState"),(e=>e.get("toolbar").get("restrictionPanelState"))),d=(null!=c?c.get(te.n$.VIEW_ENZYMES):void 0)||X.kH.ALL
let u=d
const m=a[u],p=l.default.filter(e,(e=>e.get("enzyme").isVisibleByCuts(u,o)))
if(p.length>i){for(u of Array.from(m)){const e=l.default.filter(p,(e=>e.get("enzyme").isVisibleByCuts(u,[])))
if(e.length<=i){u===X.kH.NONE&&0===s.length?n.set("cutsiteFilter",{before:d,after:null,blackList:[]}):n.set("cutsiteFilter",{before:d,after:u,blackList:o})
return e}}n.set("cutsiteFilter",{before:d,after:null,blackList:o})
return[]}n.set("cutsiteFilter",{before:d,after:d,blackList:o})
return p}(e)}getSVGNode(){return this.$el.children("svg")[0]}render(){super.render()
const e=Re().select(this.el).append("svg:svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").classed("mini-map",!0).classed(this.sliceView.className,!0)
if(!window.snapshot){const e=Re().select(this.el).append("svg:svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").classed("mini-map-title",!0).classed(this.sliceView.className,!0).attr("width",this.model.get("bufferViewLayout").get("width")),t=e.append("svg:g")
this.titleView=new qi({el:t.node(),model:this.mapstate,slice:this.slice,bufferCentred:!0})
e.attr("height",this.titleView.layout.boxHeight()+10)
this.titleView.render()}this.setZooms()
this.updateCutsiteData()
this.sliceView.setElement(e.node())
this.sliceView.setFocusableParent(this.el)
this.registerListeners()
this.update()
return this}afterAttach(){return this.restoreScroll()}}MiniMap.initClass()
function HiddenAnnotationsWarningBadge({shownAnnotationsCount:e,visibleAnnotationsCount:t}){return e!==t?d.createElement(CP.Z,null,d.createElement(js.Y,{content:"Annotations",className:(0,g.iv)(OO.badge),popoverProps:{renderContent:()=>d.createElement("span",null,"The 100 largest annotations in the viewing window are shown. Use the"," ",d.createElement("strong",null,"zoom feature")," to see a particular region in more detail."),title:"Annotations",placement:ne.ZH.BOTTOM}})):d.createElement(CP.Z,{className:"annotation-msg"})}const OO=g.mM.create({badge:{whiteSpace:"nowrap"}})
const xO=function CircularOptions({bannerText:e,onOpenPreview:t,onToggleSearch:n,visibilityOptions:a,featureCounts:i,panSliderProps:s,zoomSliderProps:r,shownAnnotationsCount:o,visibleAnnotationsCount:l}){return d.createElement("div",{className:"buffer-options-container"},d.createElement(CP.Z,null,d.createElement(ZoomSlider,{...r})),d.createElement(CP.Z,null,d.createElement(PanSlider,{...s})),d.createElement(HiddenAnnotationsWarningBadge,{shownAnnotationsCount:o,visibleAnnotationsCount:l}),d.createElement(OptionsBanner,{bannerText:e}),d.createElement(CP.Z,{className:"u-vertical-center-items"},d.createElement(Pr.Z,null,d.createElement(CreatePDFButton,{onOpenPreview:t})),d.createElement(Pr.Z,null,d.createElement(St.Z,{options:a,featureCounts:i}),d.createElement(SearchButton,{onToggleSearch:n}))))}
function SimplifiedCircularOptions({mapType:e,onSelectMapType:t,isCircular:n,visibilityOptions:a,featureCounts:i,panSliderProps:s,zoomSliderProps:r,shownAnnotationsCount:o,visibleAnnotationsCount:l}){return d.createElement("div",{className:"buffer-options-container"},d.createElement(CP.Z,null,d.createElement(MapSelector,{mapType:e,onSelectMapType:t,isCircular:n})),d.createElement(CP.Z,null,d.createElement(ZoomSlider,{...r})),d.createElement(CP.Z,null,d.createElement(PanSlider,{...s})),d.createElement(HiddenAnnotationsWarningBadge,{shownAnnotationsCount:o,visibleAnnotationsCount:l}),d.createElement(CP.Z,{className:(0,g.iv)(_O.expander)}),d.createElement(CP.Z,{className:"u-vertical-center-items"},d.createElement(St.Z,{options:a,featureCounts:i})))}const _O=g.mM.create({expander:{flex:1}})
class CircularMapTabOptionsView extends AP{constructor(){super(...arguments)
this.previewSourceName="plasmid"
this.previewPaginate=circularPaginate}trackedFeatureCollections(){return["annotations","translations","parts","sequencePrimers"]}getProps(){const e=this.mapstate.sequence().length()
return{...super.getProps(),zoomSliderProps:{min:this.mapstate.get("minZoom"),max:this.mapstate.get("maxZoom"),value:this.mapstate.get("zoom"),step:this.mapstate.get("stepZoom"),disabled:!1,onChange:e=>this.mapstate.setZoom(e),zoomBigger:()=>this.mapstate.smoothZoomByStep(5),zoomSmaller:()=>this.mapstate.smoothZoomByStep(-5)},panSliderProps:{min:-Math.floor(e/2),max:Math.floor(e/2),value:this.calculateOffset(),step:1,disabled:!1,onChange:e=>this.mapstate.setOffset(e),panLeft:()=>this.mapstate.smoothChangePanByStep(-this.calculatePanJump()),panRight:()=>this.mapstate.smoothChangePanByStep(this.calculatePanJump())},shownAnnotationsCount:this.mapstate.get("shownA"),visibleAnnotationsCount:this.mapstate.get("visibleA"),shownTranslationsCount:this.mapstate.get("shownTranslations"),visibleTranslationsCount:this.mapstate.get("visibleTranslations")}}calculatePanJump(){const e=this.mapstate.get("leftBP"),t=this.mapstate.get("rightBP"),n=this.mapstate.get("sequence").length()
let a=(t-e+n)%n
0===a&&(a=n)
const i=20/360*n
return Math.min(Math.max(1,a/4),i)}calculateOffset(){const e=this.mapstate.sequence().length()
let t=this.mapstate.get("DNAOffset")%e
t<-e/2&&(t+=e)
t>e/2&&(t-=e)
return t}handleBigSequence(){const e=this.mapstate.sequence().isReallyBig(),t=this.model.get("visibilityOptions").getOption(Yt.gO.name),n=this.model.get("visibilityOptions").getOption(Yt.D1.name)
t.set("disabled",e,{noSave:!0})
n.set("disabled",e,{noSave:!0})
if(e){t.set("visible",!1,{noSave:!0})
n.set("visible",!1,{noSave:!0})}}initialize(e){super.initialize(e)
this.listenTo(this.mapstate,"change:zoom change:maxZoom change:minZoom change:stepZoom change:DNAOffset change:shownA change:visibleA change:totalA change:shownTranslations change:visibleTranslations change:totalTranslations",(()=>this.render()))
this.listenTo(this.mapstate.sequence().get("dna"),"change:forward",(()=>this.render()))}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}render(){(0,Me.A9)(d.createElement(xO,{...this.getProps()}),this.el)
return this}}const DO={[X.kH.ALL]:"all enzymes",[X.kH.NONE]:"selected and compatible cutters",[X.kH.SINGLEANDDOUBLE]:"single and double cutters",[X.kH.SINGLE]:"single cutters",[X.kH.DOUBLE]:"double cutters"}
function HiddenCutsitesWarningBadge_PopoverContent({cutsiteFilter:e,onHiddenCutsitesLinkClick:t}){const CutsitesTextLink=({text:e})=>d.createElement(C.Co,{buttonStyle:C.ZJ.LINK,className:(0,g.iv)(LO.buttonLink),text:e,onClick:t}),n=e.blackList,a=n.length>0?` (without ${n.map((e=>e.get("name"))).join(", ")})`:"",i=null!=e.after?d.createElement("span",null,"Only ",d.createElement(CutsitesTextLink,{text:DO[e.after]}),a):d.createElement(CutsitesTextLink,{text:"No enzymes"})
return d.createElement("span",null,i," are being displayed to reduce clutter.")}function HiddenCutsitesWarningBadge({cutsiteFilter:e,onHiddenCutsitesLinkClick:t}){return null!=e&&(e.before!==e.after||e.blackList.length>0)?d.createElement(CP.Z,null,d.createElement(js.Y,{content:"Cutsites Hidden",className:(0,g.iv)(LO.badge),popoverProps:{renderContent:()=>d.createElement(HiddenCutsitesWarningBadge_PopoverContent,{cutsiteFilter:e,onHiddenCutsitesLinkClick:t}),title:"Cutsites",placement:ne.ZH.BOTTOM}})):d.createElement(CP.Z,null)}const LO=g.mM.create({buttonLink:{verticalAlign:"baseline"},badge:{whiteSpace:"nowrap"}})
const kO=function MiniMapOptions({bannerText:e,onOpenPreview:t,onToggleSearch:n,visibilityOptions:a,featureCounts:i,zoomSliderProps:s,onHiddenCutsitesLinkClick:r,cutsiteFilter:o,shownAnnotationsCount:l,visibleAnnotationsCount:c}){return d.createElement("div",{className:"buffer-options-container"},d.createElement(CP.Z,null,d.createElement(ZoomSlider,{...s})),d.createElement(HiddenAnnotationsWarningBadge,{shownAnnotationsCount:l,visibleAnnotationsCount:c}),d.createElement(HiddenCutsitesWarningBadge,{cutsiteFilter:o,onHiddenCutsitesLinkClick:r}),d.createElement(OptionsBanner,{bannerText:e}),d.createElement(CP.Z,{className:"u-vertical-center-items"},d.createElement(Pr.Z,null,d.createElement(CreatePDFButton,{onOpenPreview:t})),d.createElement(Pr.Z,null,d.createElement(St.Z,{options:a,featureCounts:i}),d.createElement(SearchButton,{onToggleSearch:n}))))}
function SimplifiedMiniMapOptions({mapType:e,onSelectMapType:t,isCircular:n,visibilityOptions:a,featureCounts:i,zoomSliderProps:s,shownAnnotationsCount:r,visibleAnnotationsCount:o}){return d.createElement("div",{className:"buffer-options-container"},d.createElement(CP.Z,null,d.createElement(MapSelector,{mapType:e,onSelectMapType:t,isCircular:n})),d.createElement(CP.Z,null,d.createElement(ZoomSlider,{...s})),d.createElement(HiddenAnnotationsWarningBadge,{shownAnnotationsCount:r,visibleAnnotationsCount:o}),d.createElement(CP.Z,{className:(0,g.iv)(MO.expander)}),d.createElement(CP.Z,{className:"u-vertical-center-items"},d.createElement(St.Z,{options:a,featureCounts:i})))}const MO=g.mM.create({expander:{flex:1}})
class MiniMapTabOptionsView extends AP{constructor(){super(...arguments)
this.previewSourceName="minimap"
this.previewPaginate=minimapPaginate}trackedFeatureCollections(){const e=["annotations","translations","sequencePrimers"]
dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS&&e.push("parts")
return e}getProps(){const e=this.mapstate.sequence()
return{...super.getProps(),onHiddenCutsitesLinkClick:()=>{e.selection().trigger("cutsite")
o()("#restriction-panel .view-enzymes").focus()},cutsiteFilter:this.model.get("cutsiteFilter"),shownAnnotationsCount:this.mapstate.get("shownA"),visibleAnnotationsCount:this.mapstate.get("visibleA"),shownTranslationsCount:this.mapstate.get("shownTranslations"),visibleTranslationsCount:this.mapstate.get("visibleTranslations"),zoomSliderProps:{min:this.mapstate.getMinZoom(),max:this.mapstate.getMaxZoom(),value:this.mapstate.getZoom(),step:this.mapstate.getStepZoom(),disabled:!this.mapstate.get("zoomEnabled"),onChange:e=>this.mapstate.setZoom(e),zoomBigger:()=>this.mapstate.zoomByFactor(2),zoomSmaller:()=>this.mapstate.zoomByFactor(.5)}}}handleBigSequence(){const e=this.mapstate.sequence().isReallyBig(),t=this.model.get("visibilityOptions").getOption(Yt.gO.name),n=this.model.get("visibilityOptions").getOption(Yt.D1.name)
t.set("disabled",e,{noSave:!0})
n.set("disabled",e,{noSave:!0})
if(e){t.set("visible",!1,{noSave:!0})
n.set("visible",!1,{noSave:!0})}}initialize(e){super.initialize(e)
this.listenTo(this.mapstate,"change:zoom change:zoomEnabled change:stepZoom change:scale change:visibleA change:shownA change:totalA change:visibleTranslations change:shownTranslations change:totalTranslations",(()=>this.render()))
this.listenTo(this.model,"change:cutsiteFilter",(()=>this.render()))}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}render(){(0,Me.A9)(d.createElement(kO,{...this.getProps()}),this.el)
return this}}function useRefEventHandler(e,t,n){(0,d.useEffect)((()=>{const a=e.current
a.on(t,n)
return()=>{a.off(t,n)}}),[e,t,n])}const FO={[Kt.MapType.LINEAR_SEQUENCE]:{TabOptionsViewCls:class SimplifiedLinearMapTabOptionsView extends LinearMapTabOptionsView{getProps(){return{...super.getProps(),mapType:Kt.MapType.LINEAR_SEQUENCE,onSelectMapType:e=>{this.mapstate.sequence().trigger("changeMapType",e)},isCircular:this.mapstate.sequence().circular()}}render(){(0,Me.A9)(d.createElement(SimplifiedLinearOptions,{...this.getProps()}),this.el)
return this}},TabContentViewCls:SequenceLinearMap},[Kt.MapType.PLASMID]:{TabOptionsViewCls:class SimplifiedCircularMapTabOptionsView extends CircularMapTabOptionsView{getProps(){return{...super.getProps(),mapType:Kt.MapType.PLASMID,onSelectMapType:e=>{this.mapstate.sequence().trigger("changeMapType",e)},isCircular:this.mapstate.sequence().circular()}}render(){(0,Me.A9)(d.createElement(SimplifiedCircularOptions,{...this.getProps()}),this.el)
return this}},TabContentViewCls:CircularMapTab},[Kt.MapType.MINIMAP]:{TabOptionsViewCls:class SimplifiedMiniMapTabOptionsView extends MiniMapTabOptionsView{getProps(){return{...super.getProps(),mapType:Kt.MapType.MINIMAP,onSelectMapType:e=>{this.mapstate.sequence().trigger("changeMapType",e)},isCircular:this.mapstate.sequence().circular()}}render(){(0,Me.A9)(d.createElement(SimplifiedMiniMapOptions,{...this.getProps()}),this.el)
return this}},TabContentViewCls:MiniMap}}
var ZO
!function(e){e.FRAGMENT="FRAGMENT"
e.CONSTRUCT="CONSTRUCT"}(ZO||(ZO={}))
function getMapTabStates(e,t,n){var a,i,s,r,o,l,c
const d=e.current.subtype(),u={[Kt.MapType.LINEAR_SEQUENCE]:new ja.pz[d]({sequence:e.current})}
e.current.circular()&&(u[Kt.MapType.PLASMID]=new eC.Z({sequence:e.current}))
d!==st.SequenceSubtype.SEQUENCE&&d!==st.SequenceSubtype.RNA_SEQUENCE||(u[Kt.MapType.MINIMAP]=new ja.dO[d]({sequence:e.current}))
const m=e.current.get("enzymes").any((e=>e.visible()))
for(const e of Object.values(u)){m&&(null===(a=e.getVisibilityOptions().getOption(Yt.gO.name))||void 0===a||a.set({visible:!0},{noSave:!0}))
null===(i=e.getVisibilityOptions().getOption(Yt.gY.name))||void 0===i||i.set({visible:!0},{noSave:!0})
if([eO.tU.HOMOLOGY,eO.tU.GIBSON]&&n===ZO.CONSTRUCT){if(e instanceof eC.Z){null===(s=e.getVisibilityOptions().getOption(Yt.Jv.name))||void 0===s||s.set({visible:!1,editable:!1},{noSave:!0})
null===(r=e.getVisibilityOptions().getOption(Yt.Nq.name))||void 0===r||r.set({visible:!0,editable:!1},{noSave:!0})}null===(o=e.getVisibilityOptions().getOption(Yt.Cz.name))||void 0===o||o.set({visible:!1,editable:!1},{noSave:!0})
null===(l=e.getVisibilityOptions().getOption(Yt.xs.name))||void 0===l||l.set({visible:!0,editable:!0},{noSave:!0})}}null===(c=u[Kt.MapType.LINEAR_SEQUENCE].getVisibilityOptions().getOption(Yt.jw.name))||void 0===c||c.set({sync:!1,editable:!1,visible:!1},{noSave:!0})
return u}function SequenceMapContainer({sequenceRef:e,className:t,bulkAssemblyMethod:n,type:a}){const[i,s]=(0,Ln.Z)(Kt.SEQUENCE_MAP_TYPE_USER_PREFERENCE_KEY),[r,o]=(0,d.useState)((()=>getMapTabStates(e,0,a)));(0,d.useEffect)((()=>{o(getMapTabStates(e,0,a))}),[e,n,a])
const l=null==r[i]?Kt.MapType.LINEAR_SEQUENCE:i
useRefEventHandler(e,"changeMapType",(0,d.useCallback)((e=>{s(e)}),[s]))
return d.createElement(PolymerMapWrapper,{className:t,...FO[l],tabState:r[l]})}var BO,qO=n(758613),VO=n(525184),UO=n(729913),GO=n(783851),zO=n(851422)
!function(e){e.FRAGMENT="FRAGMENT"
e.ORIENTATION="ORIENTATION"
e.ACTION="ACTION"
e.PRIMER="PRIMER"
e.BASES="BASES"
e.TM_WHOLE="TM_WHOLE"
e.STATUS="STATUS"}(BO||(BO={}))
const $O={[Sn.cG.FIVE]:"5' primer",[Sn.cG.THREE]:"3' primer"},WO={[sO.g0.USE_EXISTING]:"Use existing primer",[sO.g0.CREATE_NEW]:"Design new primer"}
function BulkAssemblyPrimersTable({assemblyId:e,constructCid:t,primers:n}){const a=`${e}-${t}-primersTable`,i=qO.Z.getAdapter(),s=function getColumns(){return[{columnKey:BO.FRAGMENT,structuredTableColumn:(0,GO.Ao)({name:"Fragment",columnType:zO.TableColumnType.STRING,isReadOnly:!0,width:135})},{columnKey:BO.ORIENTATION,structuredTableColumn:(0,GO.Ao)({name:"Orientation",columnType:zO.TableColumnType.STRING,isReadOnly:!0})},{columnKey:BO.ACTION,structuredTableColumn:(0,GO.Ao)({name:"Action",columnType:zO.TableColumnType.STRING,isReadOnly:!0,width:154})},{columnKey:BO.PRIMER,structuredTableColumn:(0,GO.Ao)({name:"Primer",columnType:zO.TableColumnType.BULK_ASSEMBLY_PRIMER,isReadOnly:!0,width:154})},{columnKey:BO.BASES,structuredTableColumn:(0,GO.Ao)({name:"Bases",columnType:zO.TableColumnType.BULK_ASSEMBLY_PRIMER_BASES,isReadOnly:!0,width:145})},{columnKey:BO.TM_WHOLE,structuredTableColumn:(0,GO.Ao)({name:`${Xi.Mg} whole (${Xi.ig}C)`,columnType:zO.TableColumnType.STRING,isReadOnly:!0})},{columnKey:BO.STATUS,structuredTableColumn:(0,GO.Ao)({name:"Status",columnType:zO.TableColumnType.BULK_ASSEMBLY_VALIDATION_STATUS,isReadOnly:!0,width:300})}]}(),r=(0,Jt.m8)(s.map(((e,t)=>[e.columnKey,t]))),o={columns:s.map((e=>e.structuredTableColumn))},l=i.createTable({name:"",metadata:o,entryId:null,schemas:[],selectorsById:{}})
l.rows=n.map(((e,t)=>{const n=i.getBlankRow(o,t,l.columns)
return(0,tm.Uy)(n,(t=>{var n,a
t.cells[r[BO.FRAGMENT]]={text:e.fragmentName}
t.cells[r[BO.ORIENTATION]]={text:$O[e.orientation]}
t.cells[r[BO.ACTION]]={text:WO[e.primerType]}
t.cells[r[BO.PRIMER]]=function preparePrimerCell(e){var t,n,a
return e.primerType===sO.g0.CREATE_NEW?e.createdOligoId?{text:"",typedValue:{type:zO.BaseTypedValueType.BIOENTITY,bioentitySummary:{id:e.createdOligoId,name:null!==(t=e.name)&&void 0!==t?t:""}}}:{text:null!==(n=e.name)&&void 0!==n?n:""}:{text:"",typedValue:{type:zO.BaseTypedValueType.BIOENTITY,bioentitySummary:{id:e.oligoId,name:null!==(a=e.name)&&void 0!==a?a:""}}}}(e)
t.cells[r[BO.BASES]]=function preparePrimerBasesCell(e){var t
return{text:"",typedValue:{type:zO.BaseTypedValueType.STRING,rawValue:null!==(t=e.bases)&&void 0!==t?t:""}}}(e)
t.cells[r[BO.TM_WHOLE]]={text:null!==(a=null===(n=e.wholeMeltingTemperature)||void 0===n?void 0:n.toFixed(2).toString())&&void 0!==a?a:""}
t.cells[r[BO.STATUS]]={text:(0,VO.IU)(e.validationMessages)}}))}))
return d.createElement(UO.Z,{structuredTable:{...l,cid:a},cid:a,updateHandler:Jt.ZT,includeUnsubmittedStatus:!1,hideColumnHeaderIcons:!0,canRename:!1})}var HO
!function(e){e.POLYMER="polymer"
e.PRIMERS="primers"}(HO||(HO={}))
function ConstructModalContents({assemblyId:e,bulkAssemblyMethod:t,canCreatePrimers:n,getPrimers:a,initialConstructCid:i,initialTab:s,constructData:r}){const[o,l]=(0,d.useState)(r.findIndex((e=>e.cid===i))),c=r[o],u=c.cid,[p,h]=(0,d.useState)(s),E=a(u),f=c.hasErrors?d.createElement("div",{className:(0,g.iv)(jO.errorBanner)},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:d.createElement("strong",null,"This construct is invalid. It cannot be assembled as currently specified."),supportingInfo:d.createElement("span",null,"To review and fix the relevant error(s), go to the ",d.createElement("strong",null,"Overview")," tab."),action:{actionType:io.J7.ACCORDION}})):null,b=c.polymer;(0,S.Gp)(Boolean(f||null!=b),"Expected either a polymer or an error to be present in construct validation results.")
return d.createElement(PolymerModalContent,{assemblyId:e,activeIndex:o,setActiveIndex:l,cards:r.map((e=>{var t,n
return{condensedView:d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(jO.condensedCardHeader)},d.createElement(PolymerTitle,{polymerId:e.outputPolymerId,polymerName:e.name})),d.createElement("div",null,null!=(null===(t=e.visualPolymer)||void 0===t?void 0:t.length)&&null!=b?(0,y.formatPolymerResidueCount)(null===(n=e.visualPolymer)||void 0===n?void 0:n.length,b.kind):"no length"))}})),activePolymerMap:d.createElement(sp.Xl,{onRequestTabChange:t=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_CONSTRUCT_MODAL_ACTIVE_TAB,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_CONSTRUCT_MODAL,assemblyId:e,tab:t})
h(t)},activeTab:p,className:(0,g.iv)(jO.tabContainer),navClassName:(0,g.iv)(jO.nav),paneClassName:(0,g.iv)(jO.tabPane),isFullHeight:!0},d.createElement(sp.OK,{tabKey:HO.POLYMER,title:"Sequence"},f,null!=b&&"sequence"===b.kind&&d.createElement(SequenceMapContainer,{sequenceRef:b.ref,bulkAssemblyMethod:t,type:ZO.CONSTRUCT}),null!=b&&"protein"===b.kind&&d.createElement(ProteinMapContainer,{proteinRef:b.ref})),n&&d.createElement(sp.OK,{tabKey:HO.PRIMERS,title:"Primers"},f,d.createElement("div",{className:(0,g.iv)(jO.primerTabContainer),...(0,ee.Z)({component:"BulkAssemblyConstructPrimerTab",element:"root"})},E.length>0?d.createElement(BulkAssemblyPrimersTable,{assemblyId:e,constructCid:u,primers:E}):d.createElement("p",null,"No primers associated with this construct."))))})}function ConstructModal({assemblyId:e,initialConstructCid:t,initialTab:n=HO.POLYMER,constructData:a,onRequestClose:i}){const s=useAssemblyCoordinator(e)
return d.createElement(et.ZP,{...eO.Fs,title:"View constructs",onRequestClose:i,buttons:[{text:"Done",submit:!0,style:C.ZJ.SECONDARY,onClick:i}]},null!=s?d.createElement(ConstructModalContents,{assemblyId:e,bulkAssemblyMethod:s.assemblySelector.getMethod().type,canCreatePrimers:s.canCreatePrimers(),getPrimers:e=>s.getPrimersForDisplayByConstruct(e),initialConstructCid:t,initialTab:n,constructData:a}):d.createElement(kl.b,null))}const jO=g.mM.create({errorBanner:{margin:12,marginTop:16},tabContainer:{display:"flex",flexDirection:"column",height:"100%"},nav:{padding:12},tabPane:{marginTop:0,flexGrow:1},primerTabContainer:{padding:16,paddingRight:32,overflowY:"auto"},condensedCardHeader:{display:"flex",justifyContent:"space-between",paddingBottom:"8px"}})
var YO=n(630029)
function ConstructPreviewCard_ErrorIcon(){return d.createElement("div",{className:(0,g.iv)(QO.iconWrapper)},d.createElement(Oe.Z,{renderContent:()=>d.createElement("span",null,"This construct is invalid. It cannot be assembled as currently designed. To review the relevant errors, go to the ",d.createElement("strong",null,"Overview")," tab.")},d.createElement(pe.Z,{icon:"revision",className:(0,g.iv)(QO.icon,QO.errorIcon)})))}function ConstructPreviewCard_WarningIcon(){return d.createElement("div",{className:(0,g.iv)(QO.iconWrapper)},d.createElement(Oe.Z,{renderContent:()=>d.createElement("span",null,"This construct has associated warnings. To review the relevant warnings, go to the"," ",d.createElement("strong",null,"Overview")," tab.")},d.createElement(pe.Z,{icon:"warning",className:(0,g.iv)(QO.icon,QO.warningIcon)})))}function PolymerPreviewSVG({visualPolymer:e,uniquePrefix:t,onClick:n}){const a=null==e?void 0:e.circular
return d.createElement("div",{className:(0,g.iv)(a||!e?QO.previewSVGPlasmid:QO.previewSVGLinear),onClick:n},e&&d.createElement(YO.Z,{uniqueIdPrefix:t,polymer:e}))}function ConstructPreviewCard({assemblyId:e,construct:t,canCreatePrimers:n}){const a=useAssemblyCoordinator(e),{name:i,numPrimers:s,hasErrors:r,hasWarnings:o}=t
if(null==a)return d.createElement(kl.b,null)
function openConstructModal(n,a){(0,Xn.Z)(ConstructModal,{assemblyId:e,constructData:a.getPreviewConstructs().map((e=>({...e,polymer:a.maybeCreatePreviewConstructPolymer(e.cid)}))),initialConstructCid:t.cid,initialTab:n})}return d.createElement("div",{className:(0,g.iv)(QO.cardContainer)},d.createElement("div",{className:(0,g.iv)(QO.cardHeader)},r?d.createElement(ConstructPreviewCard_ErrorIcon,null):o?d.createElement(ConstructPreviewCard_WarningIcon,null):null,null!=t.outputPolymerId?d.createElement("div",{...(0,ee.Z)({component:"ConstructPreviewCard",element:"name"})},d.createElement(Fa.BioentityChip,{id:t.outputPolymerId,size:Za.TK.MINI,validationExtras:null})):d.createElement("div",{className:(0,g.iv)(QO.polymerName),...(0,ee.Z)({component:"ConstructPreviewCard",element:"name"})},i),d.createElement(pe.Z,{className:(0,g.iv)(QO.expandIcon),dataTestAttrs:{component:"ConstructPreviewCard",element:"expandIcon"},icon:"expand-right-full",onClick:()=>{openConstructModal(HO.POLYMER,a)}})),d.createElement(PolymerPreviewSVG,{visualPolymer:t.visualPolymer,uniquePrefix:t.cid,onClick:()=>{openConstructModal(HO.POLYMER,a)}}),s>0&&d.createElement("div",{className:(0,g.iv)(QO.primerViewFooter)},d.createElement("p",{className:(0,g.iv)(QO.primerViewText)},`${s} associated ${(0,de._6)(s,"primer")}`),d.createElement(C.Co,{className:(0,g.iv)(QO.primerViewLink),buttonStyle:C.ZJ.LINK,disabled:!1,onClick:e=>{e.stopPropagation()
openConstructModal(HO.PRIMERS,a)},text:"View"})),0===s&&n&&d.createElement("p",{className:(0,g.iv)(QO.primerViewText)},"No associated primers"))}const QO=g.mM.create({cardContainer:{border:`1px solid ${Vt.pF}`,borderRadius:"4px",padding:"12px",minWidth:"266px"},cardHeader:{display:"flex",justifyContent:"space-between",marginBottom:6,gap:"4px"},polymerName:{..._n.cf,marginBottom:0,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},iconWrapper:{height:16,width:16},icon:{height:16,width:16},errorIcon:{color:Vt.JF},warningIcon:{color:Vt.ud},previewSVGPlasmid:{margin:"4px auto",width:236,height:236,cursor:"pointer"},previewSVGLinear:{margin:"4px auto",minWidth:236,maxWidth:"350px",height:"200px",cursor:"pointer"},expandIcon:{color:Vt.pp,marginTop:"2px",cursor:"pointer"},primerViewFooter:{display:"flex"},primerViewText:{..._n.E0,marginRight:"8px",marginBottom:"0"},primerViewLink:{..._n.E0,fontWeight:_n.hS}})
function BulkAssemblyConstructsTabContent({assemblyId:e,isArchived:t,constructs:n,fragments:a,canCreatePrimers:i}){const s=(0,Jt.Pe)(a,(e=>e.cid)),r=n.map((e=>({...e,fragmentNames:e.fragmentCids.map((e=>s[e].polymer.text.toLowerCase()))}))),[o,l]=(0,d.useState)(""),c=function searchConstructs(){const e=o.trim().toLowerCase()
if(""===e)return r
return r.filter((({name:t,fragmentNames:n})=>t.toLowerCase().includes(e)||n.some((t=>t.includes(e)))))}(),u=n.filter((e=>e.hasErrors)).length,m=n.filter((e=>e.hasWarnings)).length
return d.createElement(d.Fragment,null,t&&d.createElement(BulkAssemblyArchivedBanner,{assemblyId:e}),d.createElement("div",{className:(0,g.iv)(KO.tabContent),...(0,ee.Z)({component:"BulkAssemblyConstructsTab",element:"root"})},d.createElement(so.zV,null,"Constructs"),u+m>0&&d.createElement("div",{className:(0,g.iv)(KO.bannerArea)},d.createElement(ConstructsTabBanners,{numWithErrors:u,numWithWarnings:m})),d.createElement(nc.ZP,{className:(0,g.iv)(KO.searchInput),clearType:nc.Nl.X,onChange:e=>{var t
l(null!==(t=e.target.value)&&void 0!==t?t:"")},onEscape:()=>{l("")},placeholder:"",value:o}),d.createElement("div",{className:(0,g.iv)(KO.cardsSection)},c.map((t=>d.createElement(ConstructPreviewCard,{key:t.cid,assemblyId:e,construct:t,canCreatePrimers:i}))))))}function BulkAssemblyConstructsTab({assemblyId:e}){const t=useAssemblyCoordinator(e)
return null==t?d.createElement(kl.b,null):d.createElement(BulkAssemblyConstructsTabContent,{assemblyId:e,isArchived:t.isArchived,constructs:t.getPreviewConstructs(),fragments:t.getFragmentsForDisplay(),canCreatePrimers:t.canCreatePrimers()})}const KO=g.mM.create({tabContent:{padding:"10px 16px"},bannerArea:{marginTop:30,marginBottom:30},searchInput:{marginTop:16,marginBottom:32,width:200},cardsSection:{display:"grid",gridGap:16,gridTemplateColumns:"repeat(auto-fit, minmax(266px, 1fr))"}})
class BulkAssemblyFragmentsTabState extends nn.Xh{defaults(){return{...super.defaults(),title:"Fragments",closeable:!1,preferenceKey:"bulk_assembly_fragments"}}}var JO=n(931723),XO=n(485809),ex=n(61419),tx=n(441499),nx=n(402763)
function TextEndpointInput({displayValue:e,setFromDisplay:t,isDisabled:n}){return d.createElement(gp.Z,{value:e,onChange:e=>{t(e.target.numericValue)},isDisabled:n})}function DropdownEndpointInput({displayValue:e,setFromDisplay:t,displayCutsites:n,isDisabled:a}){let i
i=0===n.length?[d.createElement(N.Z,{key:"no-cut-sites",isDisabled:!0},"No cut sites detected")]:n.map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:t},e)))
return d.createElement($r.ZP,{displayName:null!=e?e:"",menu:d.createElement(w.ZP,{scrollable:!0,width:Nr.zL.FIT_CONTENT},i),disabled:a})}function EndpointRestrictionEnzymeInput({restrictionEnzymeId:e,label:t,updateRestrictionEnzymeId:n}){return d.createElement("div",{className:(0,g.iv)(ax.equalFlex)},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:t,htmlFor:"restrictionEnzyme"}),d.createElement(ex.L,{allowedRestrictionEnzymeIds:te.ZP.enzymes.filter((e=>!(0,xe.UG)(e))).map((e=>e.id)),isDisabled:!1,restrictionEnzymeId:e,updateRestrictionEnzymeId:e=>{n(e)},shouldAllowNull:!0})))}function SelectionEndpointInput({displayValue:e,setFromDisplay:t,label:n,displayCutsites:a,isDisabled:i}){return d.createElement(d.Fragment,null,d.createElement(Fr.Z,{label:n}),null==a?d.createElement(TextEndpointInput,{displayValue:e,setFromDisplay:t,isDisabled:i}):d.createElement(DropdownEndpointInput,{displayValue:e,setFromDisplay:t,displayCutsites:a,isDisabled:i}))}function PrimerSearchInput({primerId:e,setPrimerId:t,isReadOnly:n}){const[a,i]=(0,d.useState)("")
return d.createElement(nx.ZP,{isMulti:!1,disableTyping:null!=e,disabled:n,searchURL:`/1/api/all/search?filter=${st.DNA_OLIGO_SEARCH_TYPE}`,doSearch:nx.Kq,autoFocus:!1,searchOnEmptyQuery:!1,placeholder:"Search by name",fetchParams:{context:Kn.ci.LISTING},getOptionDatasFromResponse:e=>e.data.map((e=>({name:d.createElement(XO.Z,{name:e.name,folderName:e.folder.name,bases:e.bases,nucleotideType:e.nucleotideType}),value:e.id}))),onSelect:e=>{i("")
t(e)},value:e?[e]:[],query:a,onQueryChange:e=>{i(e.target.value)},renderChips:e=>d.createElement(d.Fragment,null,e.map((e=>d.createElement(Fa.default,{id:e,size:Za.TK.MINI,onRemove:()=>{t(null)},key:e}))))})}function getEnzymeDisplayInfo(e,t){return null!=e.cutsiteIndices&&(0,tO.l5)(t)&&e.cutsiteIndices.includes(t.value)?e.restrictionEnzymeId:null}function useRestrictionEnzymeInfo(e,t){return(0,d.useMemo)((()=>{if(null!=e&&e!==te.kA){const n=t.ref.current._sequence().getCuts((0,xe.Rt)(e))
return{restrictionEnzymeId:e,cutsiteIndices:n.map((({position:e})=>e))}}return{restrictionEnzymeId:null,cutsiteIndices:null}}),[t.ref,e])}function FragmentCardContents({assemblyId:e,canSpecifyEndpoints:t,preferredPrimer5Id:n,setPreferredPrimer5Id:a,preferredPrimer3Id:i,setPreferredPrimer3Id:s,restrictionEnzymeId5:r,setRestrictionEnzymeId5:o,restrictionEnzymeId3:l,setRestrictionEnzymeId3:c,endpoints:u,setEndpoints:p,orientation:h,setOrientation:E,polymer:f,hadStaleVersion:S,color:b,binName:T,showPrimerSearch:v,canUpdateRestrictionEnzymes:I,isReadOnly:A,polymerId:R}){const P=(0,d.useRef)(f.ref.current.selection()),[O,x]=(0,d.useState)(),_=useRestrictionEnzymeInfo(r,f),D=useRestrictionEnzymeInfo(l,f),L=f.ref.current.isSingleStranded()
useRefEventHandler(P,"change:start change:end",(0,d.useCallback)((()=>{(0,It.D)((()=>{var e,t
const n=P.current.end(),a=null===(e=P.current.getStartState("cutsite"))||void 0===e?void 0:e.get("enzyme").id,i=null===(t=P.current.getEndState("cutsite"))||void 0===t?void 0:t.get("enzyme").id,s={start:(0,tO.Io)(P.current.start()),end:null!=n?(0,tO.Io)(n):tO.zQ}
p(s)
o(null!=a?a:te.kA)
c(null!=i?i:te.kA)}),50)()}),[p,o,c]));(0,d.useEffect)((()=>{const{canMirrorToMap:e,startErrorMessage:n,endErrorMessage:a}=(0,oO.Lv)(u,f.ref.current.length(),f.ref.current.startIndex(),h,_,D,t,f.ref.current.circular())
x(null!=n?n:a)
const i=(0,tO.l5)(u.start)?u.start.value:null,s=(0,tO.l5)(u.end)?u.end.value:null
!e||A||i===P.current.start()&&s===P.current.end()||P.current.setEndpoints(i,s)
if(f.ref.current instanceof Ge.Sequence){const e=f.ref.current.get("cutsites").filter((e=>e.position()===i&&e.get("enzyme").id===_.restrictionEnzymeId&&(0===e.strand()||e.strand()===(0,oO.yf)(h,1,-1))))
1===e.length?P.current.addStartState({cutsite:e[0]}):null!=P.current.getStartState("cutsite")&&P.current.unsetStartState("cutsite")
const t=f.ref.current.get("cutsites").filter((e=>e.position()===s&&e.get("enzyme").id===D.restrictionEnzymeId&&(0===e.strand()||e.strand()===(0,oO.yf)(h,1,-1))))
1===t.length?P.current.addEndState({cutsite:t[0]}):null!=P.current.getEndState("cutsite")&&P.current.unsetEndState("cutsite")}}),[u,h,f,_,D,t,A])
const k=function getSelectionDisplayProps(e,t,n,a,i,s,r,o,l){const c=(0,oO.ns)(i),d=(0,oO.AW)(i)
function getProps(i){const r=e[i]
return{displayValue:(0,tO.l5)(r)?d[i](r.value):null,setFromDisplay:r=>{if(null==r){t({...e,[i]:tO.zQ})
return}const o=c[i](r),{orientation:d,...u}=(0,oO.ht)({...e,[i]:(0,tO.Io)(o)},n,s,l)
t(u)
null!=d&&a(d)}}}const u=(0,oO.yf)(n,r,o),m=(0,oO.yf)(n,o,r)
return{start:{label:"Start",displayCutsites:null!=u.cutsiteIndices?u.cutsiteIndices.map((e=>d[(0,oO.yf)(n,"start","end")](e))):null,...getProps((0,oO.yf)(n,"start","end"))},end:{label:"End",displayCutsites:null!=m.cutsiteIndices?m.cutsiteIndices.map((e=>d[(0,oO.yf)(n,"end","start")](e))):null,...getProps((0,oO.yf)(n,"end","start"))}}}(u,p,h,E,f.ref.current.startIndex(),f.ref.current.circular(),_,D,L),M=(0,oO.WP)(_.cutsiteIndices,D.cutsiteIndices,u,f.ref.current.length(),f.ref.current.circular())
return d.createElement(d.Fragment,null,d.createElement("div",null,T&&d.createElement("div",{className:(0,g.iv)(ax.binName),...(0,ee.Z)({component:"FragmentCard",element:"div",key:"binName"})},T," /"),d.createElement(PolymerTitle,{polymerId:R,polymerName:f.ref.current.name()})),d.createElement("div",{className:(0,g.iv)(ax.inputsRow)},t&&d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(ax.equalFlex)},d.createElement(SelectionEndpointInput,{...k.start,isDisabled:A})),L?d.createElement("div",{className:(0,g.iv)(ax.dashContainer)},d.createElement("div",null,d.createElement(Fr.Z,{label:""})),d.createElement(pe.Z,{className:(0,g.iv)(ax.dash),icon:"minus"})):d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:(0,g.iv)(ax.switchIcon),size:C.qE.SMALL,icon:"exchange",onClick:()=>{m.L9(j.Jg.CLICKED_BULK_ASSEMBLY_FRAGMENT_SWAP_ENDPOINTS_BUTTON,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_FRAGMENT_MODAL,assemblyId:e})
E(eO.vy[h])
f.ref.current.circular()&&p({start:u.end,end:u.start})},disabled:A}),d.createElement("div",{className:(0,g.iv)(ax.equalFlex)},d.createElement(SelectionEndpointInput,{...k.end,isDisabled:A}))),!L&&d.createElement("div",{className:(0,g.iv)(ax.equalFlex,ax.orientationMaxWidth)},d.createElement(Fr.Z,{label:"Orientation"}),d.createElement($r.ZP,{disabled:!f.ref.current.circular()&&t||A,displayName:(0,An.FC)(eO.r9[h]),menu:d.createElement(w.ZP,{width:Nr.zL.FULL},d.createElement(N.Z,{onSelect:E,value:tO.ij.FORWARD},"Forward"),d.createElement(N.Z,{onSelect:E,value:tO.ij.REVERSE},"Reverse"))}))),O&&d.createElement("p",null,d.createElement("span",{className:(0,g.iv)(ax.validationError)},O," "),null!=M&&d.createElement("span",null,d.createElement(C.Co,{buttonStyle:C.ZJ.LINK,onClick:()=>{p(M)}},"Snap to nearest cut site(s)"))),v&&d.createElement("div",{className:(0,g.iv)(ax.inputsRow)},d.createElement("div",{className:(0,g.iv)(ax.equalFlex)},d.createElement(Fr.Z,{label:"Preferred 5' primer"}),d.createElement(PrimerSearchInput,{primerId:n,setPrimerId:a,isReadOnly:A})),d.createElement("div",{className:(0,g.iv)(ax.equalFlex)},d.createElement(Fr.Z,{label:"Preferred 3' primer"}),d.createElement(PrimerSearchInput,{primerId:i,setPrimerId:s,isReadOnly:A}))),I&&d.createElement("div",{className:(0,g.iv)(ax.inputsRow)},null!=r&&d.createElement(EndpointRestrictionEnzymeInput,{restrictionEnzymeId:r,label:"5' enzyme",updateRestrictionEnzymeId:o}),null!=l&&d.createElement(EndpointRestrictionEnzymeInput,{restrictionEnzymeId:l,label:"3' enzyme",updateRestrictionEnzymeId:c})),S&&d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:"Sequence has changed since it was added here.\n Please review your selections to make sure they're still valid."}),d.createElement("div",{className:(0,g.iv)(ax.visualizationContainer)},d.createElement(tx.Z,{sequence:{start:P.current.start(),end:P.current.end(),sequenceLength:f.ref.current.length(),strand:eO.r9[h],circular:f.ref.current.circular(),fivePrimeDisplayInfo:{enzymeId:getEnzymeDisplayInfo(_,(0,oO.yf)(h,u.start,u.end)),bases:null,primer:!1},threePrimeDisplayInfo:{enzymeId:getEnzymeDisplayInfo(D,(0,oO.yf)(h,u.end,u.start)),bases:null,primer:!1}},fragmentColor:b,width:200})),d.createElement("div",{className:(0,g.iv)(ax.sizeText)},(0,y.formatPolymerResidueSubcount)(P.current.length(),f.ref.current.length(),f.kind)))}const ax=g.mM.create({clickable:{cursor:"pointer"},inputsRow:{display:"flex",gap:"6px",padding:"8px 0px"},equalFlex:{flex:1},visualizationContainer:{display:"flex",justifyContent:"center"},validationError:{color:Vt.JF},switchIcon:{alignSelf:"flex-end",boxShadow:"none"},sizeText:{textAlign:"center"},binName:{color:Vt.pp,marginBottom:"8px"},dash:{flex:1,width:"100%"},dashContainer:{display:"flex",flexDirection:"column"},orientationMaxWidth:{maxWidth:"96px"}})
function useControlledFragments(e,t,n){return e.map(((e,a)=>({...e,setPreferredPrimer5Id:e=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_PREFERRED_PRIMER,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_FRAGMENT_MODAL,assemblyId:n,end:"5_prime"})
t((t=>Q()(t,{[a]:{preferredPrimer5Id:{$set:e}}})))},setPreferredPrimer3Id:e=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_PREFERRED_PRIMER,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_FRAGMENT_MODAL,assemblyId:n,sequencePrime:"3_prime"})
t((t=>Q()(t,{[a]:{preferredPrimer3Id:{$set:e}}})))},setRestrictionEnzymeId5:e=>{t((t=>Q()(t,{[a]:{restrictionEnzymeId5:{$set:e}}})))},setRestrictionEnzymeId3:e=>{t((t=>Q()(t,{[a]:{restrictionEnzymeId3:{$set:e}}})))},setOrientation:e=>{t((t=>Q()(t,{[a]:{orientation:{$set:e}}})))},setEndpoints:e=>{t((t=>Q()(t,{[a]:{endpoints:{$set:e}}})))}})))}const PolymerFragmentCondensedCard=({polymerId:e,polymerRef:t,formatResidueCount:n})=>d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(ix.condensedCardHeader)},d.createElement(PolymerTitle,{polymerId:e,polymerName:t.current.name()}),d.createElement(pe.Z,{className:(0,g.iv)(ix.chevronIcon),icon:"chevron-down",color:Vt.pp})),d.createElement("div",null,n(t.current.selection().length())))
function FragmentsModalContent({assemblyId:e,bulkAssemblyMethod:t,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,controlledFragmentsData:i,isReadOnly:s}){(0,S.hu)(i.length>0,"Expected at least one fragment")
const[r,o]=(0,d.useState)(0)
let l
const c=i[r]
l="protein"===c.polymer.kind?d.createElement(ProteinMapContainer,{proteinRef:c.polymer.ref}):d.createElement(SequenceMapContainer,{sequenceRef:c.polymer.ref,bulkAssemblyMethod:t,type:ZO.FRAGMENT})
return d.createElement(PolymerModalContent,{assemblyId:e,activeIndex:r,setActiveIndex:o,cards:i.map(((t,i)=>({condensedView:d.createElement(PolymerFragmentCondensedCard,{polymerId:t.polymerId,polymerRef:t.polymer.ref,formatResidueCount:e=>(0,y.formatPolymerResidueCount)(e,c.polymer.kind)}),contents:[d.createElement(FragmentCardContents,{assemblyId:e,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,...t,key:i,isReadOnly:s})]}))),activePolymerMap:l})}const ix=g.mM.create({condensedCardHeader:{display:"flex",justifyContent:"space-between",paddingBottom:"8px"},chevronIcon:{alignSelf:"center"}})
function AddPolymersModal({assemblyId:e,bulkAssemblyMethod:t,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,onRequestSubmit:i,fragmentDatas:s,onRequestClose:r}){const[o,l]=(0,d.useState)(s),c=useControlledFragments(o,l,e)
return d.createElement(et.ZP,{...eO.Fs,title:"Add fragment(s)",buttons:[{text:"Cancel",cancel:!0},{text:"Add",submit:!0,style:C.ZJ.SECONDARY,dataTestAttrs:{component:"AddPolymersModal",key:vb.Z.ADD}}],onRequestClose:r,onRequestSubmit:()=>{i(c.map((e=>(0,rO.aj)(e))))}},d.createElement(FragmentsModalContent,{assemblyId:e,bulkAssemblyMethod:t,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,controlledFragmentsData:c,isReadOnly:!1}))}var sx,rx=n(861447)
!function(e){e.SEARCH="SEARCH"
e.SELECT_FRAGMENTS="SELECT_FRAGMENTS"}(sx||(sx={}))
function AddPolymersSearchModal({assemblyId:e,bulkAssemblyMethodData:t,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,onRequestSubmit:i,binColor:s,enableSelectPreferredPrimers:r,binCid:o,binIndex:l,polymerSubtypes:c,onRequestClose:u,topology:m,numFragmentBins:p,fragmentProductionMethod:h}){const[E,f]=(0,d.useState)([]),[S,y]=(0,d.useState)(sx.SEARCH),[b,T]=(0,d.useState)([]),v=useControlledFragments(b,T,e),I=S===sx.SEARCH?function getSearchButtons(e){return[{text:"Cancel",cancel:!0},{text:"Next",style:C.ZJ.SECONDARY,submit:!0,disabled:e,dataTestAttrs:{component:"AddPolymersSearchModal",key:vb.Z.NEXT}}]}(0===E.length):function getFragmentSelectionButtons(e){return[{text:"Back",style:C.ZJ.TERTIARY_GRAY,onClick:e,disabled:!1,dataTestAttrs:{component:"AddPolymersSearchModal",key:vb.Z.BACK}},{text:"Add",style:C.ZJ.SECONDARY,submit:!0,disabled:!1,dataTestAttrs:{component:"AddPolymersSearchModal",key:vb.Z.ADD}}]}((()=>{y(sx.SEARCH)}))
return d.createElement(et.ZP,{...eO.Fs,title:S===sx.SEARCH?"Search for sequences":"Add fragment(s)",buttons:I,onRequestClose:()=>{u()},onRequestSubmit:async()=>{S===sx.SEARCH?await(async()=>{const e=(0,Jt.Pe)(b,(e=>e.polymer.ref.current.id)),i=Promise.all(E.map((i=>{var d
return null!==(d=e[i])&&void 0!==d?d:(0,rO.QS)({polymerId:i,polymerKind:c[0]===An.Dj.aa_sequence?"protein":"sequence",expectedVersionDbId:null,showPrimerSearch:r,color:s,binCid:o,binIndex:l,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,isReadOnly:!1,constructTopology:m,numFragmentBins:p,assemblyMethod:t,fragmentProductionMethod:h})}))),d=await(0,Ic.jI)(i)
T(d)
y(sx.SELECT_FRAGMENTS)})():i(v.map((e=>(0,rO.aj)(e))))}},S===sx.SEARCH?d.createElement("div",{className:(0,g.iv)(ox.sequenceSearchView)},d.createElement(rx.Z,{selectedIds:E,setSelectedIds:f,polymerSubtypes:c,navSection:ZP.$0.MOLBIO_BULK_ASSEMBLY,rowSelectionMode:Tr.rT.MULTIPLE})):d.createElement(FragmentsModalContent,{assemblyId:e,bulkAssemblyMethod:t.type,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,controlledFragmentsData:v,isReadOnly:!1}))}const ox=g.mM.create({sequenceSearchView:{display:"flex",flexDirection:"column",height:"100%",width:"95%"}})
var lx=n(489678),cx=n(997574)
const dx=xa.ZP`
  query WorklistItemsQuery($worklistId: StrictString!) @skipAudit @engComponent(name: INVENTORY) {
    worklist(id: $worklistId) {
      ... on WorklistNode {
        id
        items {
          # BatchNode and PlateNode are just included for type completeness
          ... on BatchNode {
            id
            name
          }
          ... on PlateNode {
            id
            name
          }
          ... on ContainerNode {
            id
            name
            ...HasArchiveRecordGraphQL
            storableSchema {
              id
              name
              iconId
            }
            contents {
              ... on ContainerContentNode {
                id
                concentrationJson
                containedItem {
                  ... on WorklistItemInterface {
                    id
                  }
                }
                containedItemTagSchema {
                  ... on TagSchemaNode {
                    id
                    name
                    iconId
                  }
                }
              }
            }
            parentStorable {
              ... on PlateNode {
                id
              }
              ... on InaccessibleInfoNode {
                ...InaccessibleInfoGraphQL
              }
            }
            barcode {
              value
            }
          }
          ... on FolderItemInterface {
            id
            name
            archiveRecord {
              purpose
            }
            tagSchema {
              id
              isContainable
              name
              iconId
            }
          }
          ... on SequenceNode {
            id
            name
            archiveRecord {
              purpose
            }
            tagSchema {
              id
              isContainable
              name
            }
            nucleotideType
            sequenceType
          }
          ... on InaccessibleInfoNode {
            ...InaccessibleInfoGraphQL
          }
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("HasArchiveRecord").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,ux={header:"Item",accessorKey:"itemDisplay",isCollapsible:!1,isSortable:!1,flexGrow:1},mx={header:"Barcode",accessorKey:"barcode",flexGrow:1,isCollapsible:!1,isSortable:!1}
function SelectableWorklistItemsTable({worklistItems:e,selectedWorklistItems:t,setSelectedWorklistItems:n,validateItem:a}){const i=new Set(t.map((e=>(0,ka.k3)(e))));(0,d.useEffect)((()=>{0===i.size&&n(s.filter((e=>!e.isSelectorDisabled)).map((e=>e.data.item)))}),[])
const s=e.map((e=>function getWorklistItemRow(e,t,n){var a
const i=(0,ka.k3)(e),s="ContainerNode"===e.__typename?null===(a=e.barcode)||void 0===a?void 0:a.value:void 0,{isSelectorDisabled:r,tooltipText:o}=n(e)
return{id:i,isSelectorDisabled:r,isSelected:t.has(i),data:{item:e,itemDisplay:d.createElement(d.Fragment,null,d.createElement(sc.Z,{id:i,size:Za.TK.TABLE_CELL}),r&&d.createElement(mp.Z,null)),barcode:s},tooltipText:o}}(e,i,a))),r=[ux]
s.some((e=>e.data.barcode))&&r.push(mx)
return d.createElement(lx.TT,{columns:r,rows:s,rowSelectionMode:Tr.rT.MULTIPLE,hiddenColumnKeys:[],allowOverflow:!1,emptyTableText:"No items in worklist",getRowContentHeight:()=>30,matchParentHeight:!1,hasLineBelowHeader:!1,isCompact:!0,canResizeColumns:!1,canFilterColumns:!1,onRowsSelect:(e,t)=>{const a=new Set(e.map((e=>e.id))),i=s.filter((e=>t?(a.has(e.id)||e.isSelected)&&!e.isSelectorDisabled:!a.has(e.id)&&e.isSelected)).map((e=>e.data.item))
n(i)}})}function SelectItemsFromWorklistView({selectedWorklistItems:e,setSelectedWorklistItems:t,setWorklistSummary:n,validateItem:a,worklistSummary:i}){return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(px.selector)},d.createElement(cx.Z,{onChange:function onWorklistChange(e){n(e)
null==e&&t([])},worklistTypes:[Po.FN.BIOENTITY,Po.FN.CONTAINER]})),i&&d.createElement(Da.ZP,{query:dx,variables:{worklistId:i.id},renderLoading:Da.ZP.DEFAULT_RENDER_LOADING},(n=>{const i=n.worklist
return(0,ka.CZ)(i)?d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:"You don't have permissions to view this worklist"}):d.createElement(SelectableWorklistItemsTable,{worklistItems:i.items,selectedWorklistItems:e,setSelectedWorklistItems:t,validateItem:a})})))}const px=g.mM.create({selector:{width:"50%",marginBottom:16}})
var hx
!function(e){e.SELECT_WORKLIST="SELECT_WORKLIST"
e.SELECT_FRAGMENTS="SELECT_FRAGMENTS"}(hx||(hx={}))
function getAllowedSubtypesErrorMessage(e){const t=e.map((e=>`${An.sm[e]}s`))
return 1===t.length?`Only ${t[0]} may be used in this assembly.`:2===t.length?`Only ${t[0]} or ${t[1]} may be used in this assembly.`:`Only ${t.slice(0,t.length-1).join(", ")}, or ${t[t.length-1]} may be used in this assembly`}function AddPolymersWorklistModal({assemblyId:e,bulkAssemblyMethodData:t,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,onRequestSubmit:i,binColor:s,enableSelectPreferredPrimers:r,binCid:o,binIndex:l,polymerSubtypes:c,onRequestClose:u,topology:m,numFragmentBins:p,fragmentProductionMethod:h}){const[g,E]=(0,d.useState)(null),[f,S]=(0,d.useState)([]),[y,b]=(0,d.useState)(hx.SELECT_WORKLIST),[T,v]=(0,d.useState)([]),I=useControlledFragments(T,v,e),w=y===hx.SELECT_WORKLIST?function AddPolymersWorklistModal_getSearchButtons(e){return[{text:"Cancel",cancel:!0},{text:"Next",style:C.ZJ.SECONDARY,submit:!0,disabled:e,dataTestAttrs:{component:"AddPolymersWorklistModal",key:vb.Z.NEXT}}]}(0===f.length):function AddPolymersWorklistModal_getFragmentSelectionButtons(e){return[{text:"Back",style:C.ZJ.TERTIARY_GRAY,onClick:e,disabled:!1,dataTestAttrs:{component:"AddPolymersSearchModal",key:vb.Z.BACK}},{text:"Add",style:C.ZJ.SECONDARY,submit:!0,disabled:!1,dataTestAttrs:{component:"AddPolymersWorklistModal",key:vb.Z.ADD}}]}((()=>{b(hx.SELECT_WORKLIST)})),N=y===hx.SELECT_WORKLIST?{}:eO.Fs
return d.createElement(et.ZP,{...N,title:y===hx.SELECT_WORKLIST?"Add from worklist":"Add fragment(s)",buttons:w,onRequestClose:u,onRequestSubmit:async()=>{y===hx.SELECT_WORKLIST?await(async()=>{const e=Promise.all(f.map((e=>(0,rO.QS)({polymerId:e.id,polymerKind:c[0]===An.Dj.aa_sequence?"protein":"sequence",expectedVersionDbId:null,showPrimerSearch:r,color:s,binCid:o,binIndex:l,canSpecifyEndpoints:n,canUpdateRestrictionEnzymes:a,isReadOnly:!1,constructTopology:m,numFragmentBins:p,assemblyMethod:t,fragmentProductionMethod:h})))),i=await(0,Ic.jI)(e)
v(i)
b(hx.SELECT_FRAGMENTS)})():i(I.map((e=>(0,rO.aj)(e))))}},y===hx.SELECT_WORKLIST?d.createElement(SelectItemsFromWorklistView,{selectedWorklistItems:f,setSelectedWorklistItems:S,setWorklistSummary:E,validateItem:e=>(0,ka.CZ)(e)?{isSelectorDisabled:!0,tooltipText:"You don't have permissions to view this item."}:(0,yc.ZP)(e)?{isSelectorDisabled:!0,tooltipText:"This item is archived."}:function isWorklistItemNodeValidForAssembly(e,t){let n
if("ProteinNode"===e.__typename)n=An.Dj.aa_sequence
else{if("SequenceNode"!==e.__typename)return!1
n=e.sequenceType===Sn.uS.ds?An.Dj.dna_sequence:e.sequenceType===Sn.uS.ss?An.Dj.rna_sequence:e.nucleotideType===Sn.Wy.DNA?An.Dj.dna_oligo:An.Dj.rna_oligo}return t.includes(n)}(e,c)?{isSelectorDisabled:!1}:{isSelectorDisabled:!0,tooltipText:getAllowedSubtypesErrorMessage(c)},worklistSummary:g}):d.createElement(FragmentsModalContent,{assemblyId:e,bulkAssemblyMethod:t.type,canSpecifyEndpoints:n,controlledFragmentsData:I,isReadOnly:!1,canUpdateRestrictionEnzymes:a}))}var gx=n(391028),Ex=n(308783)
function useStoreSelector(e,t){const[n,a]=(0,Ex.Z)((()=>t(e))),i=(0,d.useCallback)((()=>{a(t(e))}),[e,a,t])
!function useEventHandler(e,t,n){(0,d.useEffect)((()=>{e.on(t,n)
return()=>{e.off(t,n)}}),[e,t,n])}(e,gx.O,i)
return n}function useFilteredCurrentlyOpenPolymerData(e){var t
const n=useStoreSelector(jA.Z,(0,d.useCallback)((e=>function getPolymerDataFromWorkspaceItems(e){return[e.filter((({fileId:e})=>ea.ZP.isNucleotideSequence(e))).map((({fileId:e,name:t})=>({apiIdentifier:e,name:t}))),e.filter((({fileId:e})=>ea.ZP.isProtein(e))).map((({fileId:e,name:t})=>({apiIdentifier:e,name:t,polymerSubtype:An.Dj.aa_sequence})))]}(e.workspaceItems)),[])),a=(0,Pu.Z)(n),{currentState:i,makeCall:s}=(0,Wr.ZP)((async([t,n])=>{const a=e.includes(An.Dj.aa_sequence)?n:[],i=await Promise.all(t.map((({apiIdentifier:e})=>(0,T.getPolymerSubtypeBySequenceId)(e)))),s=t.map(((e,t)=>({...e,polymerSubtype:i[t]}))).filter((({polymerSubtype:t})=>null!=t&&e.includes(t)))
return a.concat(s)}));(0,d.useEffect)((()=>{Is()(n,a)||s(n)}))
return null!==(t=(0,Wr.yf)(i))&&void 0!==t?t:[]}function AddPolymersMenu({supportedPolymerTypes:e,openAddPolymersSearchModal:t,openAddPolymersWorklistModal:n,openAddPolymerModal:a}){const i=useFilteredCurrentlyOpenPolymerData(e),s={component:"BulkAssemblyAddPolymersMenu",element:"dropdown"}
return d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.MEDIUM},d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:Jt.ZT,isDisabled:0===i.length},"Open sequences",d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.MEDIUM},i.map((({apiIdentifier:e,name:t,polymerSubtype:n})=>d.createElement(N.Z,{key:e,onSelect:a,value:e},d.createElement("div",null,t),d.createElement("div",{className:(0,g.iv)(fx.sequenceType)},(0,Mt.E2)(An.Af[n]))))))),d.createElement(N.Z,{onSelect:t,dataTestAttrs:{...s,key:"search"}},"Search for sequences")),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:n,dataTestAttrs:{...s,key:"worklist"}},"Add from worklist")))}const fx=g.mM.create({sequenceType:{..._n.XI,color:Vt.TG}})
var Sx=n(262660)
function ClickToEditTextField({value:e,sanitize:t,onSaveValue:n,placeholder:a,spellCheck:i,editable:s=!0,isArea:r=!1,disableResize:o=!0,dataTestAttrs:l}){const[c,u]=(0,d.useState)(!1),[m,p]=(0,d.useState)(),h=r?"textarea":or.Z,saveValue=()=>{u(!1)
void 0!==m&&n(m)
p(void 0)}
if(c)return d.createElement(Sx.Z,{onClickOut:saveValue},d.createElement(h,{value:m,onKeyPress:(0,pn.callOnEnter)(saveValue),onChange:e=>{if(null!=t){const n=t(e.target.value)
p(n)}else p(e.target.value)},className:(0,g.iv)(yx.valueFont,o&&yx.disableResize),autoFocus:!0,spellCheck:i,placeholder:a,...(0,ee.Z)(l)}))
{const t=[yx.displayText]
if(s){t.push(yx.clickableText)
t.push(""===e?yx.placeholderFont:yx.valueFont)}else t.push(yx.valueFont)
return d.createElement("div",{className:(0,g.iv)(...t),onClick:()=>{if(s){p(e)
u(!0)}},...(0,ee.Z)(l)},e||(s?a:""))}}const yx=g.mM.create({disableResize:{resize:"none"},displayText:{width:"100%",overflowWrap:"break-word"},clickableText:{":hover":{backgroundColor:Vt.bs,cursor:"pointer"}},valueFont:{..._n.gt,fontWeight:_n.KB},placeholderFont:{..._n.gt,fontWeight:_n.hS}})
var bx=n(517004)
function GibsonBinControls(e){return d.createElement(bx.N,{fragmentProductionMethod:e.fragmentProductionMethod,updateFragmentProductionMethod:e.onChangeFragmentProductionMethod,dropdownMethods:[eO.y0.PRIMER_PAIR,eO.y0.EXISTING_HOMOLOGY_REGIONS],bulkAssemblyMethod:eO.tU.GIBSON,hideLabels:!0,disabled:e.isReadOnly})}function GoldenGateBinControls(e){return d.createElement(bx.N,{fragmentProductionMethod:e.fragmentProductionMethod,updateFragmentProductionMethod:e.onChangeFragmentProductionMethod,dropdownMethods:[eO.y0.EXISTING_CUT_SITES,eO.y0.PRIMER_PAIR],bulkAssemblyMethod:eO.tU.GOLDEN_GATE,hideLabels:!0,disabled:e.isReadOnly})}const Tx=`1px solid ${Vt.tN}`,vx=192
var Cx
!function(e){e.BIN="BIN"
e.SPACER="SPACER"
e.CONSTRUCTS="CONSTRUCTS"}(Cx||(Cx={}))
function isBinCard(e){return e.cardType===Cx.BIN}function isSpacerCard(e){return e.cardType===Cx.SPACER}function isConstructsCard(e){return e.cardType===Cx.CONSTRUCTS}function getConstructsSwatchesStyles(e){const t=100/e.length,n=e.map(((e,n)=>`${e} ${n*t}%, ${e} ${(n+1)*t}%`)),a=n.join(", ")
return g.mM.create({constructsSwatches:{background:`linear-gradient(to right, ${a})`}})}function CardErrors({errors:e,bulkAssemblyMethod:t}){if(0===e.length)return d.createElement(d.Fragment,null)
const n=e.map((e=>(0,sO.HR)(e,t))).join(" ")
return d.createElement(Zo.Z,{text:n},d.createElement(pe.Z,{icon:"warning",altText:n,className:(0,g.iv)(Ix.errorIcon)}))}function EditableCardHeader(e){return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(Ix.header)},d.createElement(CardErrors,{errors:e.errors,bulkAssemblyMethod:e.bulkAssemblyMethod}),d.createElement("span",{className:(0,g.iv)(Ix.headerText)},`${e.heading} ${e.cardTypeIndex+1}`),d.createElement("span",{className:(0,g.iv)(Ix.headerIcons)},(isSpacerCard(e)||!e.hideDeleteButton)&&!e.isReadOnly&&d.createElement(pe.Z,{icon:"delete",onClick:()=>{e.onDelete()},className:(0,g.iv)(Ix.icon,Ix.interactiveIcon)}),e.dragHandleProps&&!e.isReadOnly&&d.createElement(Dw.MW,{className:f()((0,g.iv)(Ix.icon,Ix.interactiveIcon),e.dragHandleProps.className),onMouseDown:e.dragHandleProps.onMouseDown}))))}function ContainableCardFooter(e){const t=isConstructsCard(e)?"construct":"fragment",n=isConstructsCard(e)?"bulk_assembly":e.fragmentIcon
return d.createElement("div",{className:(0,g.iv)(Ix.footer,Ix.row)},d.createElement(pe.Z,{icon:n,className:(0,g.iv)(Ix.sequenceIcon)}),d.createElement("span",null,`${e.numContained} ${(0,de._6)(e.numContained,t)}`),isBinCard(e)&&!e.isReadOnly&&d.createElement(I.ZP,{menu:d.createElement(AddPolymersMenu,{...e}),closeOnInsideClick:!0,closeOnOutsideClick:!0},d.createElement(vy.Z,{altText:"Add new fragment to bin",className:(0,g.iv)(Ix.addFragmentButton),dataTestAttrs:{component:"BulkAssemblyFragmentBinCard",element:"addButton"}})))}function NameField({name:e,onChangeName:t,...n}){return d.createElement(ClickToEditTextField,{value:e,onSaveValue:e=>{const n=e.trim()
""!==n&&t(n)},...n,placeholder:"Enter a name"})}function BinCard(e){const t=g.mM.create({color:{backgroundColor:e.color}})
return d.createElement("div",{...(0,ee.Z)({component:"BulkAssemblyOverviewTab",element:"fragmentBinCard"})},d.createElement("div",{className:(0,g.iv)(Ix.swatch,t.color)}),d.createElement("div",{className:(0,g.iv)(Ix.cardContent)},d.createElement(EditableCardHeader,{...e,heading:e.cardType}),d.createElement("div",{className:(0,g.iv)(Ix.row)},d.createElement(NameField,{name:e.name,onChangeName:e.onChangeName,editable:!(e.lockName||e.isReadOnly),dataTestAttrs:{component:"BulkAssemblyBinCard",element:"nameField"}}),e.bulkAssemblyMethod===eO.tU.GOLDEN_GATE&&d.createElement("div",{className:(0,g.iv)(Ix.row)},d.createElement(GoldenGateBinControls,{fragmentProductionMethod:e.fragmentProductionMethod,onChangeFragmentProductionMethod:e.onChangeFragmentProductionMethod,isReadOnly:e.isReadOnly})),e.bulkAssemblyMethod===eO.tU.GIBSON&&d.createElement("div",{className:(0,g.iv)(Ix.row)},d.createElement(GibsonBinControls,{fragmentProductionMethod:e.fragmentProductionMethod,onChangeFragmentProductionMethod:e.onChangeFragmentProductionMethod,isReadOnly:e.isReadOnly}))),d.createElement(ContainableCardFooter,{...e})))}function SpacerCard(e){const t=e.bulkAssemblyMethod===eO.tU.CONCATENATION&&e.supportedPolymerTypes.includes(An.Dj.aa_sequence)?"Enter residues":"Enter bases"
return d.createElement("div",{className:(0,g.iv)(Ix.cardContent)},d.createElement(EditableCardHeader,{...e,heading:eO.CG[e.bulkAssemblyMethod].toUpperCase()}),d.createElement("div",{className:(0,g.iv)(Ix.row)},d.createElement(NameField,{name:e.name,onChangeName:e.onChangeName,editable:!e.isReadOnly,dataTestAttrs:{component:"BulkAssemblySpacerCard",element:"nameField"}})),d.createElement("div",{className:(0,g.iv)(Ix.row)},d.createElement(ClickToEditTextField,{value:e.residues,onSaveValue:e.onChangeResidues,sanitize:e.sanitizeResidues,placeholder:t,isArea:!0,editable:!e.isReadOnly,spellCheck:!1,dataTestAttrs:{component:"BulkAssemblySpacerCard",element:"basesField"}})))}function ConstructsCard(e){return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(Ix.swatch,getConstructsSwatchesStyles(e.colors).constructsSwatches)}),d.createElement("div",{className:(0,g.iv)(Ix.cardContent)},d.createElement("div",{className:(0,g.iv)(Ix.header)},d.createElement(CardErrors,{errors:e.errors,bulkAssemblyMethod:e.bulkAssemblyMethod})),d.createElement("div",{className:(0,g.iv)(Ix.row)},d.createElement("div",{className:(0,g.iv)(Ix.name)},"Constructs")),d.createElement(ContainableCardFooter,{...e})))}function BulkAssemblyCard(e){const t=isSpacerCard(e)?0===e.residues.length:0===e.numContained,n=e.errors.length>0,a=isConstructsCard(e)||isBinCard(e)
return d.createElement("div",{className:f()((0,g.iv)(Ix.container),{[(0,g.iv)(Ix.errorBorder)]:n,[(0,g.iv)(Ix.dashedBorder)]:t,[(0,g.iv)(Ix.swatchCardBorder)]:a})},isConstructsCard(e)&&d.createElement(ConstructsCard,{...e}),isSpacerCard(e)&&d.createElement(SpacerCard,{...e}),isBinCard(e)&&d.createElement(BinCard,{...e}))}const Ix=g.mM.create({container:{width:"192px",borderRadius:"4px",color:Vt.pp,border:Tx,backgroundColor:Vt.Cj},cardContent:{padding:"8px"},swatch:{height:"4px",borderRadius:"4px 4px 0px 0px"},errorBorder:{borderColor:Vt.hM},dashedBorder:{borderStyle:"dashed"},swatchCardBorder:{borderTop:"none"},header:{display:"flex"},headerText:{fontWeight:_n.KB},errorIcon:{color:Vt.hM,width:"12px",height:"12px",marginRight:"8px"},headerIcons:{marginLeft:"auto"},icon:{color:Vt.TG,width:"16px",height:"16px",marginLeft:"8px"},interactiveIcon:{":hover":{color:Vt.pp,cursor:"pointer"}},name:{..._n.gt,fontWeight:_n.KB},footer:{display:"flex",alignItems:"center"},sequenceIcon:{marginRight:"8px"},addFragmentButton:{color:Vt.t0,height:"16px",width:"16px",flex:"0 0 16px",marginLeft:"8px"},row:{marginTop:"8px"}}),wx={[eO.tU.HOMOLOGY]:128,[eO.tU.CONCATENATION]:128,[eO.tU.GIBSON]:176,[eO.tU.GOLDEN_GATE]:136}
function Arrow(){return d.createElement("span",{className:(0,g.iv)(Rx.arrowContainer)},d.createElement("span",{className:(0,g.iv)(Rx.arrowWrapper)},d.createElement("span",{className:(0,g.iv)(Rx.arrow,Rx.arrowShaft)}),d.createElement("span",{className:(0,g.iv)(Rx.arrow,Rx.arrowHead)})))}function BulkAssemblyCardLayout({cards:e,onMoveItem:t,bulkAssemblyMethod:n,constructBinErrors:a,numFilledOutConstructs:i}){const[s,r]=(0,d.useState)(1),{ref:o,width:l}=(0,ut.Z)();(0,d.useEffect)((()=>{if(null!=l){const t=Math.floor((l-Nx-Lw)/Ax)
r(Math.min(t,e.length))}}),[l,e])
if(0===e.length)return d.createElement("div",null)
const c=wx[n],u=Array.from((0,Jt.yo)(e,s)),m=e.filter((e=>isBinCard(e))).map((e=>e.color)),p=g.mM.create({flexBasis:{flexBasis:`${s*Ax+Lw}px`}})
return d.createElement("div",{ref:o,className:(0,g.iv)(Rx.wrapper)},d.createElement("div",{className:(0,g.iv)(Rx.layoutContainer,p.flexBasis)},d.createElement(DnDCanvas,{blockHeight:c,items:u,maxColumnCount:s,minBlockWidth:vx,onMoveItem:t,renderItem:(e,t)=>d.createElement(BulkAssemblyCard,{...e,dragHandleProps:t})})),d.createElement("div",{className:(0,g.iv)(Rx.arrowAndConstructsContainer)},d.createElement(Arrow,null),d.createElement(BulkAssemblyCard,{cardType:Cx.CONSTRUCTS,colors:m,numContained:i,errors:a,bulkAssemblyMethod:{bulkAssemblyMethod:n}})))}const Nx=233,Ax=204,Rx=g.mM.create({arrowContainer:{display:"flex",alignItems:"flex-start",marginTop:"16px"},arrowWrapper:{display:"flex",alignItems:"center"},arrow:{borderStyle:"solid",borderColor:Vt.Rl,marginRight:"-12px"},arrowShaft:{borderWidth:"2px 0px 0px 0px",height:"0px",width:"28px",flex:"0 0 auto"},arrowHead:{borderWidth:"2px 2px 0px 0px",transform:"rotate(45deg)",width:"12px",height:"12px",marginRight:"12px",flex:"0 0 auto"},wrapper:{display:"flex"},layoutContainer:{flexGrow:0,flexShrink:0},arrowAndConstructsContainer:{display:"flex",alignSelf:"flex-start",flex:`0 0 ${Nx}`,paddingTop:"12px"}})
function AddBinDropdown({onAddNewFragmentBin:e,onAddNewSpacerBin:t,spacerName:n,fragmentIcon:a}){return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.MEDIUM},d.createElement(N.Z,{icon:a,onSelect:e,dataTestAttrs:{component:"BulkAssemblyAddBinDropdown",element:"dropdown",key:"fragmentBin"}},"Add new bin"),null!=n&&d.createElement(N.Z,{icon:"spacer",onSelect:t,dataTestAttrs:{component:"BulkAssemblyAddBinDropdown",element:"dropdown",key:"spacer"}},"Add new ",n)),closeOnInsideClick:!0,closeOnOutsideClick:!0},d.createElement(vy.Z,{altText:null!=n?`Add a new bin or ${n} to the bulk assembly`:"Add a new bin to the bulk assembly",className:(0,g.iv)(Px.addCardButton),dataTestAttrs:{component:"BulkAssemblyAddBinDropdown",element:"button"}}))}const Px=g.mM.create({addCardButton:{marginLeft:"8px",height:"16px",width:"16px"}})
function BulkAssemblyEditConfirmationModal({title:e,warnings:t,onRequestSubmit:n,onRequestClose:a}){(0,S.hu)(t.length>0,"Expected at least one warning")
return d.createElement(et.ZP,{onRequestClose:a,buttons:[{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,onClick:a},{text:"Continue",submit:!0,style:C.ZJ.NEGATIVE,onClick:()=>{n(!0)}}],title:e},d.createElement("div",null,d.createElement("p",null,t[0]),d.createElement("p",null,"Are you sure you want to continue?")))}function getCardProps(e){const{errorsByBin:t}=e.assemblyLayoutValidator.getAssemblyLayoutValidationErrors(),n=e.getBinsForDisplay(),a=n.filter((({binType:e})=>e===eO.Uc.FRAGMENT)).length,i=e.assemblySelector.getMethod(),s=e.supportedPolymerSubtypes()
let r=0,o=0
return n.map(((n,l)=>{const c={cid:n.cid,name:n.name,onChangeName:t=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_BIN_NAME,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})
e.updateBinName(n.cid,t)},index:l,errors:[...t[n.cid]],isReadOnly:e.isReadOnly(),supportedPolymerTypes:s},getOnDeleteCallback=t=>()=>{m.L9(t,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})
e.deleteBin(l)}
if(n.binType===eO.Uc.FRAGMENT){const t=e.enableSelectPreferredPrimers((0,tO.rx)(n.cid))
return{...c,cardTypeIndex:r++,cardType:Cx.BIN,hideDeleteButton:a<=2,lockName:!1,bulkAssemblyMethod:i.type,fragmentProductionMethod:n.fragmentProductionMethod,onChangeFragmentProductionMethod:t=>{!async function onChangeBinFragmentProductionMethod(e,t,n){const a=e.getUpdatedFragmentsOnBinChange({...t,fragmentProductionMethod:n})
if(null!=a){if(!await(0,Xn.Z)(BulkAssemblyEditConfirmationModal,{warnings:a.warnings,title:"Warning"}))return
e.handleTableFragmentsUpdate(a.updatedFragments)}e.updateBinFragmentProductionMethod(t.cid,n)
m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_BIN_SETTINGS,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})}(e,n,t)},numContained:n.numBinFragments,color:n.color,fragmentIcon:e.getFragmentIcon(),supportedPolymerTypes:s,onDelete:getOnDeleteCallback(j.Jg.DELETED_BULK_ASSEMBLY_BIN),openAddPolymerModal:async a=>{const s=await(0,Ic.jI)((0,rO.QS)({polymerId:a,polymerKind:(0,rO.WB)(i)?"protein":"sequence",expectedVersionDbId:null,showPrimerSearch:t,color:n.color,binCid:n.cid,binIndex:e.assemblySelector.getFragmentBins().findIndex((e=>e.cid===n.cid)),canSpecifyEndpoints:e.canSpecifyEndpoints(),canUpdateRestrictionEnzymes:e.canUpdateRestrictionEnzymes(n.cid),isReadOnly:e.isReadOnly(),constructTopology:e.topology,numFragmentBins:e.assemblySelector.getNumFragmentBins(),assemblyMethod:i,fragmentProductionMethod:n.fragmentProductionMethod}))
m.L9(j.Jg.OPENED_BULK_ASSEMBLY_ADD_FRAGMENTS_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId,actionMethod:j.LY.ADD_FROM_RECENT})
const r=await(0,Xn.Z)(AddPolymersModal,{assemblyId:e.assemblyId,bulkAssemblyMethod:i.type,canSpecifyEndpoints:e.canSpecifyEndpoints(),canUpdateRestrictionEnzymes:e.canUpdateRestrictionEnzymes(n.cid),fragmentDatas:[s]})
if(r){e.addFragments(r)
m.L9(j.Jg.ADDED_BULK_ASSEMBLY_FRAGMENTS,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:e.assemblyId,actionMethod:j.LY.ADD_FROM_RECENT,numFragments:r.length})}},openAddPolymersSearchModal:async()=>{m.L9(j.Jg.OPENED_BULK_ASSEMBLY_ADD_FRAGMENTS_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId,actionMethod:j.LY.ADD_FROM_SEARCH});(0,rx.p)(s,ZP.$0.MOLBIO_BULK_ASSEMBLY)
const a=await(0,Xn.Z)(AddPolymersSearchModal,{assemblyId:e.assemblyId,bulkAssemblyMethodData:i,canSpecifyEndpoints:e.canSpecifyEndpoints(),canUpdateRestrictionEnzymes:e.canUpdateRestrictionEnzymes(n.cid),binColor:n.color,enableSelectPreferredPrimers:t,binCid:n.cid,binIndex:e.assemblySelector.getFragmentBins().findIndex((e=>e.cid===n.cid)),polymerSubtypes:s,topology:e.topology,numFragmentBins:e.assemblySelector.getNumFragmentBins(),fragmentProductionMethod:n.fragmentProductionMethod})
if(a){e.addFragments(a)
m.L9(j.Jg.ADDED_BULK_ASSEMBLY_FRAGMENTS,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:e.assemblyId,actionMethod:j.LY.ADD_FROM_SEARCH,numFragments:a.length})}},openAddPolymersWorklistModal:async()=>{m.L9(j.Jg.OPENED_BULK_ASSEMBLY_ADD_FRAGMENTS_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId,actionMethod:j.LY.ADD_FROM_WORKLIST})
const a=await(0,Xn.Z)(AddPolymersWorklistModal,{assemblyId:e.assemblyId,bulkAssemblyMethodData:i,canSpecifyEndpoints:e.canSpecifyEndpoints(),canUpdateRestrictionEnzymes:e.canUpdateRestrictionEnzymes(n.cid),binColor:n.color,enableSelectPreferredPrimers:t,binCid:n.cid,binIndex:e.assemblySelector.getFragmentBins().findIndex((e=>e.cid===n.cid)),polymerSubtypes:s,topology:e.topology,numFragmentBins:e.assemblySelector.getNumFragmentBins(),fragmentProductionMethod:n.fragmentProductionMethod})
if(a){e.addFragments(a)
m.L9(j.Jg.ADDED_BULK_ASSEMBLY_FRAGMENTS,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:e.assemblyId,actionMethod:j.LY.ADD_FROM_WORKLIST,numFragments:a.length})}}}}(0,S.hu)((0,eO.Hz)(i.type),"Received spacer bin for homology assembly")
return{...c,cardType:Cx.SPACER,cardTypeIndex:o++,bulkAssemblyMethod:i.type,residues:n.residues,onChangeResidues:t=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_SPACER_SETTINGS,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})
e.updateSpacerBinBases(n.cid,t)},onDelete:getOnDeleteCallback(j.Jg.DELETED_BULK_ASSEMBLY_SPACER),sanitizeResidues:e=>{if(i.type===eO.tU.CONCATENATION){if(i.parameters.polymerSubtype===An.Dj.aa_sequence)return(0,y.sanitizeAminoAcids)(e)
const t=dt.ZP.MOLBIO_ENABLE_UT_FLEXIBILITY&&(i.parameters.polymerSubtype===An.Dj.dna_oligo||i.parameters.polymerSubtype===An.Dj.rna_oligo)
return(0,y.sanitize)(e,An.Jw[i.parameters.polymerSubtype],t)}return(0,y.stripDegenerate)(e,R.Wy.DNA)}}}))}function BulkAssemblyCardSection({assemblyCoordinator:e}){const t=e.getBinCount(),n=e.isReadOnly(),{otherErrors:a}=e.assemblyLayoutValidator.getAssemblyLayoutValidationErrors(),i=e.assemblySelector.getMethod().type,s=(0,eO.Hz)(i)?eO.CG[i]:void 0
return d.createElement("div",null,d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(Ox.cardLayoutHeader)},null!=s?`Bins & ${(0,de._6)(2,(0,Mt.kC)(s))}`:"Bins",t>0?` (${t})`:"",!n&&d.createElement(AddBinDropdown,{onAddNewFragmentBin:()=>{e.handleAddNewFragmentBin()
m.L9(j.Jg.ADDED_BULK_ASSEMBLY_BIN,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})},onAddNewSpacerBin:()=>{e.handleAddNewSpacerBin()
m.L9(j.Jg.ADDED_BULK_ASSEMBLY_SPACER,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})},fragmentIcon:e.getFragmentIcon(),spacerName:s}))),d.createElement("div",{className:(0,g.iv)(Ox.cardLayoutWrapper)},d.createElement(BulkAssemblyCardLayout,{cards:getCardProps(e),onMoveItem:(t,n)=>{const a=isBinCard(t)?j.Jg.UPDATED_BULK_ASSEMBLY_BIN_NUMBER:j.Jg.UPDATED_BULK_ASSEMBLY_SPACER_NUMBER
m.L9(a,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_BIN_LAYOUT,assemblyId:e.assemblyId})
e.handleMoveBin(t.index,n.index)},bulkAssemblyMethod:e.assemblySelector.getMethod().type,constructBinErrors:a,numFilledOutConstructs:e.getNumFilledOutConstructs()})))}const Ox=g.mM.create({cardLayoutHeader:{..._n.cf,fontWeight:_n.KB,display:"flex",alignItems:"center"},cardLayoutWrapper:{marginLeft:"-12px"}})
function getLocationInfoErrors({locationInfo:e,displayString:t}){var n,a
const i=[],{targetFolderId:s,worklistParams:r}=e
null==s&&i.push(`A folder for ${t} is required.`)
if((null==r?void 0:r.worklistFormType)===Po.mR.NEW){""!==(null===(n=null==r?void 0:r.newWorklistInfo)||void 0===n?void 0:n.name)&&null!=(null===(a=r.newWorklistInfo)||void 0===a?void 0:a.name)||i.push(`A worklist name for ${t} is required.`)
null!=(null==r?void 0:r.targetWorklistId)&&i.push(`Cannot add ${t} to both an existing worklist and a new worklist.`)}else if((null==r?void 0:r.worklistFormType)===Po.mR.EXISTING){null!=(null==r?void 0:r.newWorklistInfo)&&i.push(`Cannot add ${t} to both an existing worklist and a new worklist.`)
null==(null==r?void 0:r.targetWorklistId)&&i.push(`A worklist for ${t} is required.`)}return i}var xx=n(872009)
const _x={worklistParams:null},Dx={worklistFormType:Po.mR.NEW,targetWorklistId:null,newWorklistInfo:null}
function SaveLocationPicker({targetFolderId:e,onTargetFolderIdChange:t,useWorklistCheckboxLabel:n,uniqueId:a,useWorklist:i,onUseWorklistChange:s,worklistFormType:r,onWorklistFormTypeChange:o,newWorklistName:l,onNewWorklistNameChange:c,newWorklistOwnerId:u,onWorklistIdChange:m,required:p=!0}){return d.createElement("div",null,d.createElement(Fr.Z,{label:"Location",isRequired:p}),d.createElement(Ye.Z,{value:e,onChange:t,showInventory:!0,allowNone:!p,enableRedesign:!0,unsetOnFetchFail:!0}),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement(d.Fragment,null,d.createElement(Io.Z,{checked:i,id:`save-location-picker-use-worklist-checkbox-${a}`,label:n,onChange:e=>{s(e.target.checked)},className:(0,g.iv)(Lx.checkbox)}),i&&d.createElement("div",{className:(0,g.iv)(Lx.worklistSection)},d.createElement(Fr.Z,{label:"Worklist",isRequired:!1}),d.createElement(xx.Z,{autoFocus:!1,useFullWidthToggle:!0,ids:[],refreshOptions:{refreshRecentWorklists:!0},worklistType:Po.FN.BIOENTITY,newOrExisting:r,setNewOrExisting:o,newWorklistName:{value:l,onChange:c},newWorklistOwnerId:u,updateWorklistId:m,required:!0}))))}const Lx=g.mM.create({checkbox:{marginTop:16},worklistSection:{marginTop:16}})
function PickLocationStep(e){var t,n,a,i,s,r
const{isRequiredParams:o}=e,l=o.isRequired||o.saveEntities
return d.createElement(d.Fragment,null,!o.isRequired&&d.createElement("div",{className:(0,g.iv)(kx.checkboxWrapper)},d.createElement(Io.Z,{checked:l,id:"save-entities-checkbox",label:null!==(t=o.checkboxLabel)&&void 0!==t?t:"",onChange:e=>{o.onUpdateSaveEntities(e.target.checked)}}),d.createElement("div",{className:(0,g.iv)(kx.checkboxTooltip)},d.createElement(Zo.Z,{text:o.checkboxTooltip},d.createElement(pe.Z,{icon:"info-circle",className:(0,g.iv)(kx.checkboxIcon)})))),l&&d.createElement(SaveLocationPicker,{targetFolderId:e.locationInfo.targetFolderId,onTargetFolderIdChange:t=>{e.onUpdateLocationInfo({...e.locationInfo,targetFolderId:t.target.value})},worklistFormType:null!==(a=null===(n=e.locationInfo.worklistParams)||void 0===n?void 0:n.worklistFormType)&&void 0!==a?a:Po.mR.NEW,onWorklistFormTypeChange:t=>{t===Po.mR.NEW?e.onUpdateLocationInfo((0,tm.Uy)(e.locationInfo,(e=>{e.worklistParams.targetWorklistId=null
e.worklistParams.worklistFormType=Po.mR.NEW}))):e.onUpdateLocationInfo((0,tm.Uy)(e.locationInfo,(e=>{e.worklistParams.newWorklistInfo=null
e.worklistParams.worklistFormType=Po.mR.EXISTING})))},newWorklistName:null!==(r=null===(s=null===(i=e.locationInfo.worklistParams)||void 0===i?void 0:i.newWorklistInfo)||void 0===s?void 0:s.name)&&void 0!==r?r:"",onNewWorklistNameChange:t=>{e.onUpdateLocationInfo((0,tm.Uy)(e.locationInfo,(e=>{t.target.value?e.worklistParams.newWorklistInfo={name:t.target.value}:e.worklistParams.newWorklistInfo=null})))},onWorklistIdChange:t=>{e.onUpdateLocationInfo((0,tm.Uy)(e.locationInfo,(e=>{e.worklistParams.targetWorklistId=null==t?null:t.id})))},newWorklistOwnerId:e.newWorklistOwnerId,required:!0,useWorklistCheckboxLabel:e.useWorklistCheckboxLabel,useWorklist:null!=e.locationInfo.worklistParams,uniqueId:"redesign",onUseWorklistChange:t=>{e.onUpdateLocationInfo((0,tm.Uy)(e.locationInfo,(e=>{e.worklistParams=t?Dx:null})))}}))}const kx=g.mM.create({chevron:{paddingRight:4},checkboxWrapper:{marginTop:16,marginBottom:16,display:"flex"},checkboxIcon:{color:Vt.pp,width:"16px",height:"16px"},checkboxTooltip:{marginLeft:8}})
var Mx,Fx=n(97737)
!function(e){e.SAVE_FRAGMENTS="SAVE_FRAGMENTS"
e.SAVE_CONSTRUCTS="SAVE_CONSTRUCTS"
e.SAVE_PRIMERS="SAVE_PRIMERS"}(Mx||(Mx={}))
const Zx={[Mx.SAVE_FRAGMENTS]:"amplified fragments",[Mx.SAVE_CONSTRUCTS]:"constructs",[Mx.SAVE_PRIMERS]:"primers"}
function getErrorsForStep({stepKey:e,locationInfo:t,saveEntities:n}){let a
if(n){a=getLocationInfoErrors({locationInfo:t,displayString:Zx[e]})}else a=[]
return a}function PerformAssemblyModal(e){var t
const n={..._x,targetFolderId:null!==(t=e.initialFolderId)&&void 0!==t?t:void 0},[a,i]=(0,d.useState)(!1),[s,r]=(0,d.useState)(n),[o,l]=(0,d.useState)(n),[c,u]=(0,d.useState)(!0),[m,p]=(0,d.useState)(n),[h,g]=(0,d.useState)({[Mx.SAVE_FRAGMENTS]:Fx.cV.UNVISITED,[Mx.SAVE_CONSTRUCTS]:Fx.cV.UNVISITED,[Mx.SAVE_PRIMERS]:e.canCreatePrimers?Fx.cV.UNVISITED:null}),E=Mx.SAVE_FRAGMENTS,[f,y]=(0,d.useState)(E)
let b,T
switch(f){case Mx.SAVE_FRAGMENTS:b=s
T=a
break
case Mx.SAVE_CONSTRUCTS:b=o
T=!0
break
case Mx.SAVE_PRIMERS:default:b=m
T=c}(0,d.useEffect)((()=>{const e=h[f],t=getErrorsForStep({stepKey:f,locationInfo:b,saveEntities:T}).length>0?Fx.cV.ERROR:Fx.cV.UNVISITED
e!==t&&g({...h,[f]:t})}),[f,h,g,b,T])
const v=function getStepButtons({stepKey:e,setStepKey:t,statusByStep:n,setStatusByStep:a,locationInfo:i,saveEntities:s,onClickAssemble:r,canCreatePrimers:o}){const l=getErrorsForStep({stepKey:e,locationInfo:i,saveEntities:s}),c=l.length>0,d={text:"Assemble",submit:!0,disabled:c,...c?{tooltipTitle:l.join(" ")}:{},onClick:r}
if(e===Mx.SAVE_FRAGMENTS)return[{text:"Cancel",cancel:!0},{text:"Next",submit:!0,disabled:c,tooltipTitle:c?l.join(" "):void 0,onClick:()=>{t(Mx.SAVE_CONSTRUCTS)
n.SAVE_FRAGMENTS!==Fx.cV.ERROR&&a({...n,[Mx.SAVE_FRAGMENTS]:Fx.cV.DONE})},dataTestAttrs:{component:"PerformAssemblyModal",key:vb.Z.NEXT}}]
if(e===Mx.SAVE_CONSTRUCTS)return[{text:"Back",onClick:()=>{t(Mx.SAVE_FRAGMENTS)
a({...n,[Mx.SAVE_CONSTRUCTS]:Fx.cV.UNVISITED})}},o?{text:"Next",submit:!0,disabled:c,tooltipTitle:c?l.join(" "):void 0,onClick:()=>{n.SAVE_CONSTRUCTS!==Fx.cV.ERROR&&a({...n,[Mx.SAVE_CONSTRUCTS]:Fx.cV.DONE})
t(Mx.SAVE_PRIMERS)},dataTestAttrs:{component:"PerformAssemblyModal",key:vb.Z.NEXT}}:d]
return[{text:"Back",onClick:()=>{t(Mx.SAVE_CONSTRUCTS)
a({...n,[Mx.SAVE_PRIMERS]:Fx.cV.UNVISITED})}},d]}({stepKey:f,setStepKey:y,statusByStep:h,setStatusByStep:g,locationInfo:b,saveEntities:T,onClickAssemble:()=>{var t,n,i,r,l,d,u,p,h,g,E,f,y,b,T;(0,S.hu)(!(null==s.targetFolderId&&a||null==o.targetFolderId||null==m.targetFolderId&&c),"Expected fragment, construct, and primer folders to be specified when saving those entities")
e.onRequestSubmit({fragmentSaveInfo:a?{folderId:s.targetFolderId,worklistId:null!==(n=null===(t=s.worklistParams)||void 0===t?void 0:t.targetWorklistId)&&void 0!==n?n:null,newWorklistName:null!==(l=null===(r=null===(i=s.worklistParams)||void 0===i?void 0:i.newWorklistInfo)||void 0===r?void 0:r.name)&&void 0!==l?l:null}:null,constructSaveInfo:{folderId:o.targetFolderId,worklistId:null!==(u=null===(d=o.worklistParams)||void 0===d?void 0:d.targetWorklistId)&&void 0!==u?u:null,newWorklistName:null!==(g=null===(h=null===(p=o.worklistParams)||void 0===p?void 0:p.newWorklistInfo)||void 0===h?void 0:h.name)&&void 0!==g?g:null},primerSaveInfo:c?{folderId:m.targetFolderId,worklistId:null!==(f=null===(E=m.worklistParams)||void 0===E?void 0:E.targetWorklistId)&&void 0!==f?f:null,newWorklistName:null!==(T=null===(b=null===(y=m.worklistParams)||void 0===y?void 0:y.newWorklistInfo)||void 0===b?void 0:b.name)&&void 0!==T?T:null}:null})},canCreatePrimers:e.canCreatePrimers})
return d.createElement(et.ZP,{title:"Assemble DNA",buttons:v,onRequestClose:e.onRequestClose},d.createElement(Fx.ZP,{steps:[{key:Mx.SAVE_FRAGMENTS,title:"Save fragments"},{key:Mx.SAVE_CONSTRUCTS,title:"Save constructs"},...e.canCreatePrimers?[{key:Mx.SAVE_PRIMERS,title:"Save primers"}]:[]],statusByStep:h,currentStepKey:f,onUpdateCurrentStep:y,variant:Fx.zK.FLAT}),d.createElement(d.Fragment,null,f===Mx.SAVE_FRAGMENTS&&d.createElement(PickLocationStep,{locationInfo:s,onUpdateLocationInfo:r,newWorklistOwnerId:e.currentUserId,isRequiredParams:{isRequired:!1,checkboxLabel:"Create DNA Sequences to represent amplified fragments",checkboxTooltip:"If you deselect this option, Benchling will not create any new amplified fragments as part of this assembly",saveEntities:a,onUpdateSaveEntities:i},useWorklistCheckboxLabel:"Add amplified fragments to a worklist"}),f===Mx.SAVE_CONSTRUCTS&&d.createElement(PickLocationStep,{locationInfo:o,onUpdateLocationInfo:l,newWorklistOwnerId:e.currentUserId,isRequiredParams:{isRequired:!0},useWorklistCheckboxLabel:"Add constructs to a worklist"}),f===Mx.SAVE_PRIMERS&&d.createElement(PickLocationStep,{locationInfo:m,onUpdateLocationInfo:p,newWorklistOwnerId:e.currentUserId,isRequiredParams:{isRequired:!1,checkboxLabel:"Create DNA Oligos to represent newly designed primers",checkboxTooltip:"If you deselect this option, Benchling will not create any new primers as part of this assembly",saveEntities:c,onUpdateSaveEntities:u},useWorklistCheckboxLabel:"Add primers to a worklist"})))}function PerformConcatenationModal(e){var t
const[n,a]=(0,d.useState)({..._x,targetFolderId:null!==(t=e.initialFolderId)&&void 0!==t?t:void 0}),i=function PerformConcatenationModal_getStepButtons({locationInfo:e,onClickFinalize:t}){const n=getLocationInfoErrors({locationInfo:e,displayString:"constructs"}),a=n.length>0
return[{text:"Finalize",submit:!0,disabled:a,tooltipTitle:a?n.join(" "):void 0,onClick:t}]}({locationInfo:n,onClickFinalize:()=>{var t,a,i,s,r;(0,S.hu)(null!=n.targetFolderId,"Expected construct folder to be specified when saving those entities")
e.onRequestSubmit({fragmentSaveInfo:null,constructSaveInfo:{folderId:n.targetFolderId,worklistId:null!==(a=null===(t=n.worklistParams)||void 0===t?void 0:t.targetWorklistId)&&void 0!==a?a:null,newWorklistName:null!==(r=null===(s=null===(i=n.worklistParams)||void 0===i?void 0:i.newWorklistInfo)||void 0===s?void 0:s.name)&&void 0!==r?r:null},primerSaveInfo:null})}})
return d.createElement(et.ZP,{title:"Finalize assembly",buttons:i,onRequestClose:e.onRequestClose},d.createElement("p",null,"Add constructs to a folder"),d.createElement(PickLocationStep,{locationInfo:n,onUpdateLocationInfo:a,newWorklistOwnerId:e.currentUserId,isRequiredParams:{isRequired:!0},useWorklistCheckboxLabel:"Add constructs to a worklist"}))}var Bx=n(318042),qx=n(205892)
async function handleAssembleButtonClick(e){m.L9(j.Jg.OPENED_BULK_ASSEMBLY_FINALIZATION_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:e.assemblyId})
let t
const n={currentUserId:Jn.Z.currentUser().id,initialFolderId:e.folderId,canCreatePrimers:e.canCreatePrimers()}
t=e.assemblySelector.getMethod().type===eO.tU.CONCATENATION?await(0,Xn.Z)(PerformConcatenationModal,n):await(0,Xn.Z)(PerformAssemblyModal,n)
if(null!=t){m.L9(j.Jg.SUBMITTED_BULK_ASSEMBLY_FINALIZATION_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_FINALIZATION_MODAL,assemblyId:e.assemblyId})
const{fragmentSaveInfo:n,constructSaveInfo:a,primerSaveInfo:i}=t,s=(0,iO.oH)(e.state,e.polymerData);(0,S.Gp)(null!=s,"Expected to receive validation input")&&await(0,Ic.jI)(async function finalizeAssemblyFromInput(e,t,n,a,i){try{await(0,dO.zm)({bulkAssemblyId:e.assemblyId,fragmentSaveInfo:t,constructSaveInfo:n,primerSaveInfo:a,bulkAssemblyInput:i,procedureJson:e.state})}catch(t){if(!(0,Cn.d0)(t))throw t
v.ZP.notifyError(t)
await e.doRefetchValidation()
return}m.L9(j.Jg.COMPLETED_BULK_ASSEMBLY_FINALIZATION,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:e.assemblyId,cloningMethod:e.assemblySelector.getMethod().type})
await e.doRefetchAssembly()}(e,n,a,i,s),"Finalizing...")}}function BulkAssemblyHeader({assemblyCoordinator:e,onSetName:t,onSetFolder:n}){const a=function getAssemblyBanners(e){const t=[]
if(e.isArchived)return t
e.isFinalized&&t.push({bannerType:io.ct.INFO,text:"This is a read-only record of a finalized assembly.",dataTestAttrs:{component:"BulkAssemblyOverviewTab",element:"finalizedBanner"}})
const n=e.validationResults.assemblyResult
n&&n!==Go.br&&t.push(...n.validationMessages.filter((e=>e.status===Sn.zc.ERROR||e.status===Sn.zc.WARNING)).map((e=>({bannerType:io.ct[e.status],text:e.text}))))
return t}(e),i=e.getAssemblyFinalizationErrorMessage(),s=e.assemblySelector.getMethod()
let r,o
if(s.type===eO.tU.CONCATENATION){o="Concatenate"
r=`${An.Jw[s.parameters.polymerSubtype]} ${eO.Vk[s.type]}`}else{o="Assemble"
r=eO.Vk[s.type]}return d.createElement(d.Fragment,null,e.isArchived||!e.canEditAssembly&&d.createElement("div",{className:(0,g.iv)(Vx.metadataBanners)},e.isArchived&&d.createElement(BulkAssemblyArchivedBanner,{assemblyId:e.assemblyId}),!e.canEditAssembly&&d.createElement(io.ZP,{bannerType:io.ct.INFO,text:"Editing disabled on read-only entity"})),d.createElement("div",{className:(0,g.iv)(Vx.header)},d.createElement("div",{className:(0,g.iv)(Vx.assemblyInfo)},d.createElement(so.zV,{className:(0,g.iv)(Vx.assemblyName),dataTestAttrs:{component:"BulkAssemblyOverviewTab",element:"nameHeader"}},e.name),d.createElement(pt.Z,{color:pt.J.GRAY,className:(0,g.iv)(Vx.badge),dataTestAttrs:{component:"BulkAssemblyOverviewTab",element:"methodBadge"}},r),d.createElement(pe.Z,{className:(0,g.iv)(Vx.settings),onClick:()=>{!async function handleEditBulkAssemblySettingsClick(e,t,n){const a=e.assemblySelector.getMethod(),i={initialFolderId:e.folderId,initialName:e.name,initialTopology:e.topology,isInitialSetup:!1,initialNumFragmentBins:e.assemblySelector.getNumFragmentBins(),isArchived:e.isArchived,isFinalized:e.isFinalized,actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB}
let s
s=a.type!==eO.tU.CONCATENATION?await(0,Xn.Z)(Bx.h,{...i,initialMethodData:a,fragmentProductionMethodOverride:e.getFragmentProductionMethod(),lockBulkAssemblyMethod:!0}):await(0,Xn.Z)(qx.L,{...i,initialMethodData:a})
if(null!=s){m.L9(j.Jg.SAVED_BULK_ASSEMBLY_SETTINGS,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,topology:s.procedureJson.topology,parameters:s.procedureJson.method,assemblyId:e.assemblyId})
s.name!==e.name&&await t(s.name)
s.folderId!==e.folderId&&n(s.folderId)
e.isReadOnly()||e.updateMethodParametersAndTopology(s.procedureJson.method.parameters,s.procedureJson.topology)}}(e,t,n)},icon:"settings"})),d.createElement("div",{className:(0,g.iv)(Vx.headerButtons)},d.createElement(C.ZP,{text:"Provide feedback",buttonStyle:C.ZJ.LINK,href:"https://forms.gle/X5TKRdYQ7gvLCTD5A",target:"_blank",rel:"noopener noreferrer",className:(0,g.iv)(Vx.provideFeedbackButton)}),!e.isFinalized&&!e.isArchived&&d.createElement(P.ZP,{disabled:null==i,title:i},d.createElement(C.Co,{text:o,buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.MINI,disabled:null!=i,onClick:()=>handleAssembleButtonClick(e),dataTestAttrs:{component:"BulkAssemblyOverviewTab",element:"assembleButton"}})))),a.length>0&&d.createElement("div",{className:(0,g.iv)(Vx.assemblyBanners)},d.createElement(pd.Z,{messages:a})))}const Vx=g.mM.create({header:{display:"flex",marginBottom:"36px",justifyContent:"space-between"},settings:{color:Vt.TG,margin:"auto 0 auto 8px",cursor:"pointer"},badge:{marginLeft:"8px"},assemblyName:{marginBottom:0},metadataBanners:{marginBottom:24},assemblyBanners:{marginBottom:36,width:"fit-content"},headerButtons:{display:"flex",alignItems:"baseline",flex:"0 0 auto"},provideFeedbackButton:{..._n.cf,":focus":{textDecoration:"none"},marginRight:"8px"},assemblyInfo:{display:"flex",alignItems:"baseline"}})
function FragmentModal({assemblyId:e,bulkAssemblyMethod:t,canSpecifyEndpoints:n,initialFragmentData:a,onRequestClose:i,onRequestSubmit:s,isReadOnly:r,canUpdateRestrictionEnzymes:o}){const[l,c]=(0,d.useState)([a]),u=useControlledFragments(l,c,e)
return d.createElement(et.ZP,{...eO.Fs,title:r?"View fragment":"Edit fragment",onRequestClose:i,onRequestSubmit:()=>{r?i():s((0,rO.aj)(u[0]))},buttons:[{text:"Cancel",cancel:!0},{text:"Done",submit:!0,style:C.ZJ.SECONDARY}]},d.createElement(FragmentsModalContent,{assemblyId:e,bulkAssemblyMethod:t,canSpecifyEndpoints:n,controlledFragmentsData:u,isReadOnly:r,canUpdateRestrictionEnzymes:o}))}var Ux=n(862519),Gx=n(709321)
const zx="NAME",$x="STATUS",Wx="CONSTRUCT_TYPE"
function fragmentColumnKey(e){return`BIN:${e}`}function overhangColumnKey(e){return`OVERHANG:${e}`}function overlapLengthColumnKey(e){return`OVERLAP_LENGTH:${e}`}function endpointsColumnKey(e){return`ENDPOINTS:${e}`}function BulkAssemblyConstructsTable_getColumns(e,t,n,a,i,s){var r,o,l
return[{columnKey:zx,structuredTableColumn:(0,GO.Ao)({name:"Name",columnType:zO.TableColumnType.BULK_ASSEMBLY_CONSTRUCT_NAME,isReadOnly:!0,width:null!==(r=a.NAME)&&void 0!==r?r:240})},...n.type===eO.tU.CONCATENATION?[{columnKey:Wx,structuredTableColumn:(0,GO.Ao)({name:"Construct type",columnType:zO.TableColumnType.STRING,width:null!==(o=a.NAME)&&void 0!==o?o:100,isReadOnly:!0})}]:[],...e.flatMap(((r,o)=>function getColumnsForBin(e,t,n,a,i,s,r,o){const l={columnKey:fragmentColumnKey(e.cid),structuredTableColumn:{...(0,GO.Ao)({name:e.name,columnType:zO.TableColumnType.BULK_ASSEMBLY_CONSTRUCT_FRAGMENT_SELECTOR,width:a[fragmentColumnKey(e.cid)]}),columnType:zO.TableColumnType.BULK_ASSEMBLY_CONSTRUCT_FRAGMENT_SELECTOR,fragmentDatas:t[e.cid],binColor:e.color,method:n,assemblyId:i}},c={columnKey:endpointsColumnKey(e.cid),structuredTableColumn:(0,GO.Ao)({name:`${e.name} start / end`,columnType:zO.TableColumnType.STRING,isReadOnly:!0,width:a[endpointsColumnKey(e.cid)]})},d={columnKey:overlapLengthColumnKey(e.cid),structuredTableColumn:(0,GO.Ao)({name:"Overlap length",columnType:zO.TableColumnType.STRING,isReadOnly:!0,width:a[overlapLengthColumnKey(e.cid)]})}
switch(n){case eO.tU.GOLDEN_GATE:return[l,{columnKey:overhangColumnKey(e.cid),structuredTableColumn:(0,GO.Ao)({name:"Overhang",columnType:zO.TableColumnType.STRING,isReadOnly:!0,width:a[overhangColumnKey(e.cid)]})}]
case eO.tU.GIBSON:return[l,...We.Z.get(eO.BO.SHOW_OVERLAP_DETAILS)&&(o===fn.JH.CIRCULAR||s<r-1)?[d]:[]]
case eO.tU.HOMOLOGY:return[l,...We.Z.get(eO.BO.SHOW_FRAGMENT_DETAILS)?[c]:[],...We.Z.get(eO.BO.SHOW_OVERLAP_DETAILS)&&(o===fn.JH.CIRCULAR||s<r-1)?[d]:[]]
default:return[l]}}(r,t,n.type,a,i,o,e.length,s))),{columnKey:$x,structuredTableColumn:(0,GO.Ao)({name:"Status",columnType:zO.TableColumnType.BULK_ASSEMBLY_VALIDATION_STATUS,isReadOnly:!0,width:null!==(l=a.STATUS)&&void 0!==l?l:300})}]}function prepareFragmentCell(e){var t
return null==e?{text:""}:null==e.fragmentCid?{text:null!==(t=null==e?void 0:e.fragmentName)&&void 0!==t?t:"",error:(0,VO.Uf)(null==e?void 0:e.error)}:{text:"",typedValue:{type:zO.BaseTypedValueType.CLIENT_IDENTIFIABLE,id:e.fragmentCid,name:e.fragmentName}}}function BulkAssemblyConstructsTable({assemblyId:e,bulkAssemblyMethodData:t,bins:n,constructs:a,fragmentInfosByBinCid:i,isReadOnly:s,onChangeConstructs:r,onAutopopulate:o,onRequestClear:l,onViewConstruct:c,autopopulateButtonError:u,enableClearButton:p,topology:h}){const g=`${e}-constructsTable`,E=Ux.Z.getAdapter(),[f,S]=(0,d.useState)({}),y=BulkAssemblyConstructsTable_getColumns(n,i,t,f,e,h),b=(0,Jt.m8)(y.map(((e,t)=>[e.columnKey,t]))),T=t.type,[v,C]=(0,Ln.Z)(eO.BO.SHOW_FRAGMENT_DETAILS),[I,w]=(0,Ln.Z)(eO.BO.SHOW_OVERLAP_DETAILS),N={columns:y.map((e=>e.structuredTableColumn)),onAutopopulate:o,onRequestClear:l,onViewConstruct:c,autopopulateButtonError:u,isReadOnly:s,enableClearButton:p,bulkAssemblyMethod:T,showFragmentDetails:v,onToggleFragmentDetails:C,showOverlapDetails:I,onToggleOverlapDetails:w},A=E.createTable({name:"",metadata:N,entryId:null,schemas:[],selectorsById:{}})
function buildStructuredTableRows(e){return e.map(((e,a)=>{const i=E.getBlankRow(N,a,A.columns,{constructCid:e.cid,canPreview:e.canPreview})
return(0,tm.Uy)(i,(a=>{var i,s,r
e.createdSequenceId?a.cells[b.NAME]={text:"",typedValue:{type:zO.BaseTypedValueType.BIOENTITY,bioentitySummary:{name:e.name,id:e.createdSequenceId}}}:a.cells[b.NAME]={text:e.name}
for(const t of n){const n=e.displayConstructFragmentByBinId[t.cid]
a.cells[b[fragmentColumnKey(t.cid)]]=prepareFragmentCell(n)
b.hasOwnProperty(overhangColumnKey(t.cid))&&(a.cells[b[overhangColumnKey(t.cid)]]={text:null!==(i=null==n?void 0:n.overhangBases)&&void 0!==i?i:""})
b.hasOwnProperty(endpointsColumnKey(t.cid))&&(a.cells[b[endpointsColumnKey(t.cid)]]={text:`${null!==(s=null==n?void 0:n.fragmentEndpoints)&&void 0!==s?s:""}`})
b.hasOwnProperty(overlapLengthColumnKey(t.cid))&&(a.cells[b[overlapLengthColumnKey(t.cid)]]={text:null!==(r=null==n?void 0:n.overlapLength)&&void 0!==r?r:""})}if(b.hasOwnProperty(Wx)){const e=t.parameters
a.cells[b.CONSTRUCT_TYPE]={text:(0,Mt.E2)(An.Af[e.polymerSubtype])}}a.cells[b.STATUS]={text:(0,VO.IU)(e.validationMessages)}}))}))}0===a.length?A.rows=buildStructuredTableRows([{cid:(0,gt.Z)(),createdSequenceId:null,name:"",constructFragmentsByBinId:(0,Jt.m8)(n.map((e=>[e.cid,{fragment:tO.zQ}]))),displayConstructFragmentByBinId:(0,Jt.m8)(n.map((e=>[e.cid,{fragmentCid:null,fragmentName:"",fragmentEndpoints:null,overhangBases:"",overlapLength:null}]))),validationMessages:[],canPreview:!1}]):A.rows=buildStructuredTableRows(a)
return d.createElement("div",{...(0,ee.Z)({component:"BulkAssemblyConstructsTable",element:"root"})},d.createElement(UO.Z,{structuredTable:{...A,cid:g},cid:g,updateHandler:function handleConstructsTableChange(t){S((0,Jt.Xc)(b,(e=>t.columns[e].width)))
t.rows.length<A.rows.length&&m.L9(vc.Jg.DELETED_BULK_ASSEMBLY_CONSTRUCT,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,cloningMethod:T,assemblyId:e,numRowsDeleted:A.rows.length-t.rows.length})
1===t.rows.length&&function isEmptyRow(e,t,n){return t.every((({cid:t})=>Gx.Z.isCellEmpty((0,ig.C)(e.cells[n[fragmentColumnKey(t)]],"link"))))}(t.rows[0],n,b)?r([]):r(t.rows.map((e=>({cid:e.metadata.constructCid,constructFragmentsByBinId:(0,Jt.m8)(n.map((t=>{var n
const a=e.cells[b[fragmentColumnKey(t.cid)]],s=null!=a.typedValue&&a.typedValue.type===zO.BaseTypedValueType.CLIENT_IDENTIFIABLE?a.typedValue.id:null
let r
r=null!=s&&null!=(null===(n=i[t.cid])||void 0===n?void 0:n.find((e=>e.fragmentCid===s)))?(0,tO.rx)(s):(0,tO.vW)((0,VO.cm)(a))
return[t.cid,{fragment:r}]})))}))))},includeUnsubmittedStatus:!1,hideColumnHeaderIcons:!0,locked:s,canRename:!1}))}var Hx,jx=n(656311)
!function(e){e.POLYMER="POLYMER"
e.BIN="BIN"
e.START="START"
e.END="END"
e.LENGTH="LENGTH"
e.ORIENTATION="ORIENTATION"
e.TYPE_IIS_ENZYME="TYPE_IIS_ENZYME"
e.FIVE_PRIME_RESTRICTION_ENZYME="FIVE_PRIME_RESTRICTION_ENZYME"
e.THREE_PRIME_RESTRICTION_ENZYME="THREE_PRIME_RESTRICTION_ENZYME"
e.FRAGMENT_PRODUCTION_METHOD="FRAGMENT_PRODUCTION_METHOD"
e.PREFERRED_FIVE_PRIMER="PREFERRED_FIVE_PRIMER"
e.PREFERRED_THREE_PRIMER="PREFERRED_THREE_PRIMER"
e.STATUS="STATUS"}(Hx||(Hx={}))
const Yx=Object.values(Hx)
function getMethodDependentColumns(e,t,n){var a,i,s,r,o,l,c,d
const u=[{columnKey:Hx.START,structuredTableColumn:{...(0,GO.Ao)({name:"Start",columnType:zO.TableColumnType.BULK_ASSEMBLY_FRAGMENT_ENDPOINT,width:null!==(a=n[Hx.START])&&void 0!==a?a:80}),columnType:zO.TableColumnType.BULK_ASSEMBLY_FRAGMENT_ENDPOINT,side:"start"}},{columnKey:Hx.END,structuredTableColumn:{...(0,GO.Ao)({name:"End",columnType:zO.TableColumnType.BULK_ASSEMBLY_FRAGMENT_ENDPOINT,width:null!==(i=n[Hx.END])&&void 0!==i?i:80}),columnType:zO.TableColumnType.BULK_ASSEMBLY_FRAGMENT_ENDPOINT,side:"end"}}],m=[{columnKey:Hx.PREFERRED_FIVE_PRIMER,structuredTableColumn:{...(0,GO.Ao)({name:"Preferred 5' primer",columnType:zO.TableColumnType.BULK_ASSEMBLY_PREFERRED_PRIMER,width:null!==(s=n[Hx.PREFERRED_FIVE_PRIMER])&&void 0!==s?s:135}),columnType:zO.TableColumnType.BULK_ASSEMBLY_PREFERRED_PRIMER}},{columnKey:Hx.PREFERRED_THREE_PRIMER,structuredTableColumn:{...(0,GO.Ao)({name:"Preferred 3' primer",columnType:zO.TableColumnType.BULK_ASSEMBLY_PREFERRED_PRIMER,width:null!==(r=n[Hx.PREFERRED_THREE_PRIMER])&&void 0!==r?r:135}),columnType:zO.TableColumnType.BULK_ASSEMBLY_PREFERRED_PRIMER}}],p={columnKey:Hx.FRAGMENT_PRODUCTION_METHOD,structuredTableColumn:(0,GO.Ao)({name:"Fragment production method",columnType:zO.TableColumnType.STRING,width:null!==(o=n[Hx.FRAGMENT_PRODUCTION_METHOD])&&void 0!==o?o:220,isReadOnly:!0})},h={columnKey:Hx.ORIENTATION,structuredTableColumn:{...(0,GO.Ao)({name:"Orientation",columnType:zO.TableColumnType.OPTION_SELECTOR,width:n[Hx.ORIENTATION]}),columnType:zO.TableColumnType.OPTION_SELECTOR,options:Object.values(tO.ej)}},g=[{columnKey:Hx.FIVE_PRIME_RESTRICTION_ENZYME,structuredTableColumn:(0,GO.Ao)({name:"5' enzyme",columnType:zO.TableColumnType.BULK_ASSEMBLY_RESTRICTION_ENZYME,width:null!==(l=n[Hx.FIVE_PRIME_RESTRICTION_ENZYME])&&void 0!==l?l:135,isReadOnly:!1})},{columnKey:Hx.THREE_PRIME_RESTRICTION_ENZYME,structuredTableColumn:(0,GO.Ao)({name:"3' enzyme",columnType:zO.TableColumnType.BULK_ASSEMBLY_RESTRICTION_ENZYME,width:null!==(c=n[Hx.THREE_PRIME_RESTRICTION_ENZYME])&&void 0!==c?c:135,isReadOnly:!1})}]
switch(e.type){case eO.tU.GOLDEN_GATE:return[...u,{columnKey:Hx.TYPE_IIS_ENZYME,structuredTableColumn:(0,GO.Ao)({name:"Type IIS enzyme",columnType:zO.TableColumnType.STRING,width:null!==(d=n[Hx.TYPE_IIS_ENZYME])&&void 0!==d?d:135,isReadOnly:!0})},p,...t?m:[],h]
case eO.tU.GIBSON:return[...u,p,...dt.ZP.MOLBIO_RESTRICTION_ENZYME_IN_GIBSON?g:[],...t?m:[],h]
case eO.tU.CONCATENATION:return e.parameters.polymerSubtype===An.Dj.dna_sequence?[...u,h]:u
default:return[h]}}function prepareBioentityCell(e){return void 0===e.id?{text:e.text,error:(0,VO.Uf)(e.error),locked:e.locked}:{text:"",typedValue:{type:zO.BaseTypedValueType.BIOENTITY,bioentitySummary:{id:e.id,name:e.text}}}}function parseBioentityCell(e){var t
return(null===(t=e.typedValue)||void 0===t?void 0:t.type)===zO.BaseTypedValueType.BIOENTITY?(0,tO.rx)(e.typedValue.bioentitySummary.id):(0,tO.vW)(e.text)}function parseRestrictionEnzymeCell(e){var t
let n=(0,xe.sD)(e.text)
if(null!=n)return(0,tO.C5)(n.id)
const a=parseInt((null===(t=e.typedValue)||void 0===t?void 0:t.type)===zO.BaseTypedValueType.STRING?e.typedValue.rawValue:e.text,10)
n=(0,xe.Rt)(a)
return a===te.kA||null!=n&&!(0,xe.UG)(n)?(0,tO.C5)(a):(0,tO.vW)(e.text)}function BulkAssemblyFragmentsTable({assemblyId:e,bulkAssemblyMethodData:t,fragments:n,bins:a,isReadOnly:i,canUsePrimers:s,onChangeFragments:r,onViewFragment:o,canSpecifyEndpoints:l,supportedPolymerTypes:c,icon:u}){const m=`${e}-fragmentsTable`,p=jx.Z.getAdapter(),[h,g]=(0,d.useState)({}),E=function BulkAssemblyFragmentsTable_getColumns(e,t,n,a,i){var s,r,o
let l
l=1===i.length?i[0]===An.Dj.dna_oligo?st.DNA_OLIGO_SEARCH_TYPE:i[0]===An.Dj.rna_oligo?st.RNA_OLIGO_SEARCH_TYPE:i[0]===An.Dj.aa_sequence?st.PROTEIN:i[0]===An.Dj.rna_sequence?st.SequenceSubtype.RNA_SEQUENCE:st.SequenceSubtype.SEQUENCE:i.includes(An.Dj.dna_oligo)?st.ALL_DNA_SEARCH_TYPE:st.ALL_RNA_SEARCH_TYPE
const c=[{columnKey:Hx.POLYMER,structuredTableColumn:{...(0,GO.Ao)({name:"Sequence",columnType:zO.TableColumnType.BULK_ASSEMBLY_FRAGMENT_POLYMER,width:null!==(s=a[Hx.POLYMER])&&void 0!==s?s:135}),columnType:zO.TableColumnType.BULK_ASSEMBLY_FRAGMENT_POLYMER,bioentityTypeFilter:l}},{columnKey:Hx.BIN,structuredTableColumn:{...(0,GO.Ao)({name:"Bin",columnType:zO.TableColumnType.BULK_ASSEMBLY_BIN_SELECTOR,width:null!==(r=a[Hx.BIN])&&void 0!==r?r:135}),columnType:zO.TableColumnType.BULK_ASSEMBLY_BIN_SELECTOR,bins:t}},{columnKey:Hx.LENGTH,structuredTableColumn:(0,GO.Ao)({name:"Length",columnType:zO.TableColumnType.STRING,isReadOnly:!0,width:a[Hx.LENGTH]})},{columnKey:Hx.STATUS,structuredTableColumn:(0,GO.Ao)({name:"Status",columnType:zO.TableColumnType.BULK_ASSEMBLY_VALIDATION_STATUS,isReadOnly:!0,width:null!==(o=a[Hx.STATUS])&&void 0!==o?o:300})},...getMethodDependentColumns(e,n,a)]
return(0,hs.Z)(c,[e=>Yx.indexOf(e.columnKey)])}(t,a,s,h,c),f=(0,Jt.m8)(E.map(((e,t)=>[e.columnKey,t]))),S={columns:E.map((e=>e.structuredTableColumn)),onViewFragment:o,isReadOnly:i},y=p.createTable({name:"",metadata:S,entryId:null,schemas:[],selectorsById:{}})
y.rows=function buildStructuredTableRows(){return n.map(((e,n)=>{const a=p.getBlankRow(S,n,y.columns,{fragmentCid:e.cid,polymerVersionId:e.polymerVersionId,enzymeCutsiteData5:e.enzymeCutsiteData5,enzymeCutsiteData3:e.enzymeCutsiteData3})
return(0,tm.Uy)(a,(n=>{var a,i
n.cells[f[Hx.POLYMER]]=prepareBioentityCell(e.polymer)
n.cells[f[Hx.BIN]]={text:e.bin.text,error:(0,VO.Uf)(e.bin.error)}
f.hasOwnProperty(Hx.START)&&(n.cells[f[Hx.START]]={text:e.start.text,locked:e.start.locked,error:(0,VO.Uf)(e.start.error)})
f.hasOwnProperty(Hx.END)&&(n.cells[f[Hx.END]]={text:e.end.text,locked:e.end.locked,error:(0,VO.Uf)(e.end.error)})
n.cells[f[Hx.LENGTH]]={text:e.length.text}
f.hasOwnProperty(Hx.ORIENTATION)&&(n.cells[f[Hx.ORIENTATION]]={text:e.orientation.text,locked:e.orientation.locked,error:(0,VO.Uf)(e.orientation.error)})
f.hasOwnProperty(Hx.TYPE_IIS_ENZYME)&&(n.cells[f[Hx.TYPE_IIS_ENZYME]]={text:t.type===eO.tU.GOLDEN_GATE?(0,xe.Rt)(t.parameters.defaultRestrictionEnzymeId).name:"No enzyme selected",locked:e.restrictionEnzyme5.locked||e.restrictionEnzyme3.locked})
f.hasOwnProperty(Hx.FIVE_PRIME_RESTRICTION_ENZYME)&&(n.cells[f[Hx.FIVE_PRIME_RESTRICTION_ENZYME]]={text:e.restrictionEnzyme5.text,locked:e.restrictionEnzyme5.locked})
f.hasOwnProperty(Hx.THREE_PRIME_RESTRICTION_ENZYME)&&(n.cells[f[Hx.THREE_PRIME_RESTRICTION_ENZYME]]={text:e.restrictionEnzyme3.text,locked:e.restrictionEnzyme3.locked})
f.hasOwnProperty(Hx.FRAGMENT_PRODUCTION_METHOD)&&(n.cells[f[Hx.FRAGMENT_PRODUCTION_METHOD]]={text:null!==(i=null===(a=e.fragmentProductionMethod)||void 0===a?void 0:a.text)&&void 0!==i?i:""})
if(s){n.cells[f[Hx.PREFERRED_FIVE_PRIMER]]=prepareBioentityCell(e.preferredPrimer5)
n.cells[f[Hx.PREFERRED_THREE_PRIMER]]=prepareBioentityCell(e.preferredPrimer3)}n.cells[f[Hx.STATUS]]={text:(0,VO.IU)(e.validationMessages)}}))}))}()
return d.createElement("div",{...(0,ee.Z)({component:"BulkAssemblyFragmentsTable",element:"root"})},d.createElement(UO.Z,{structuredTable:{...y,cid:m},cid:m,updateHandler:function handleFragmentsTableChange(e){g((0,Jt.Xc)(f,(t=>e.columns[t].width)))
r(e.rows.map((e=>{var t,n
return{cid:e.metadata.fragmentCid,polymer:parseBioentityCell(e.cells[f[Hx.POLYMER]]),polymerVersionDbId:e.metadata.polymerVersionId,bin:(0,tO.vW)((0,VO.cm)(e.cells[f[Hx.BIN]])),start:l?(0,tO.vW)((0,VO.cm)(e.cells[f[Hx.START]])):tO.zQ,end:l?(0,tO.vW)((0,VO.cm)(e.cells[f[Hx.END]])):tO.zQ,orientation:f.hasOwnProperty(Hx.ORIENTATION)?(0,tO.vW)((0,VO.cm)(e.cells[f[Hx.ORIENTATION]])):(0,tO.vW)(tO.ij.FORWARD),preferredPrimer5:s?parseBioentityCell(e.cells[f[Hx.PREFERRED_FIVE_PRIMER]]):tO.zQ,preferredPrimer3:s?parseBioentityCell(e.cells[f[Hx.PREFERRED_THREE_PRIMER]]):tO.zQ,restrictionEnzyme5:f.hasOwnProperty(Hx.FIVE_PRIME_RESTRICTION_ENZYME)?parseRestrictionEnzymeCell(e.cells[f[Hx.FIVE_PRIME_RESTRICTION_ENZYME]]):null!=(null===(t=e.metadata.enzymeCutsiteData5)||void 0===t?void 0:t.restrictionEnzymeId)?(0,tO.C5)(e.metadata.enzymeCutsiteData5.restrictionEnzymeId):tO.zQ,restrictionEnzyme3:f.hasOwnProperty(Hx.FIVE_PRIME_RESTRICTION_ENZYME)?parseRestrictionEnzymeCell(e.cells[f[Hx.THREE_PRIME_RESTRICTION_ENZYME]]):null!=(null===(n=e.metadata.enzymeCutsiteData3)||void 0===n?void 0:n.restrictionEnzymeId)?(0,tO.C5)(e.metadata.enzymeCutsiteData3.restrictionEnzymeId):tO.zQ}})))},includeUnsubmittedStatus:!1,hideColumnHeaderIcons:!0,locked:i,iconOverride:u,canRename:!1}))}function BulkAssemblyOverviewTab({assemblyId:e,onSetName:t,onSetFolder:n}){const a=useAssemblyCoordinator(e)
if(null==a)return d.createElement(kl.b,null)
const i=a.isReadOnly()
return d.createElement("div",{...(0,ee.Z)({component:"BulkAssemblyOverviewTab",element:"root"})},d.createElement(BulkAssemblyHeader,{assemblyCoordinator:a,onSetName:t,onSetFolder:n}),d.createElement(BulkAssemblyCardSection,{assemblyCoordinator:a}),d.createElement("div",{className:(0,g.iv)(Qx.fragmentsTableWrapper)},d.createElement(BulkAssemblyFragmentsTable,{assemblyId:e,bulkAssemblyMethodData:a.assemblySelector.getMethod(),fragments:a.getFragmentsForDisplay(),bins:a.assemblySelector.getFragmentBins(),isReadOnly:i,canUsePrimers:eO.y3.includes(a.getFragmentProductionMethod()),onChangeFragments:e=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_FRAGMENTS_TABLE,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
a.handleTableFragmentsUpdate(e)},onViewFragment:async(t,n)=>{m.L9(j.Jg.OPENED_BULK_ASSEMBLY_EDIT_FRAGMENT_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
const i=a.fragmentsByCid[t],s=await(0,Ic.jI)(a.getFragmentModalFragments(i,n)),r=await(0,Xn.Z)(FragmentModal,{assemblyId:e,bulkAssemblyMethod:a.assemblySelector.getMethod().type,canSpecifyEndpoints:a.canSpecifyEndpoints(),initialFragmentData:s,isReadOnly:n,canUpdateRestrictionEnzymes:!!(0,tO._F)(i.bin)&&a.canUpdateRestrictionEnzymes(i.bin.id)})
if(null!=r){m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_FRAGMENT,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
a.updateFragment(r)}},canSpecifyEndpoints:a.canSpecifyEndpoints(),supportedPolymerTypes:a.supportedPolymerSubtypes(),icon:a.getFragmentIcon()})),d.createElement("div",{className:(0,g.iv)(Qx.constructsTableWrapper)},d.createElement(BulkAssemblyConstructsTable,{assemblyId:e,bulkAssemblyMethodData:a.assemblySelector.getMethod(),bins:a.assemblySelector.getFragmentBins(),constructs:a.getConstructsForDisplay(),fragmentInfosByBinCid:a.getSpecifiedFragmentInfosByBinCid(),isReadOnly:i,onChangeConstructs:e=>{m.L9(j.Jg.UPDATED_BULK_ASSEMBLY_CONSTRUCTS_TABLE,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
a.updateConstructs(e)},onAutopopulate:()=>{m.L9(j.Jg.CLICKED_BULK_ASSEMBLY_AUTOPOPULATE_BUTTON,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
a.handleAutopopulateConstructs()},onRequestClear:async()=>{m.L9(j.Jg.CLICKED_BULK_ASSEMBLY_CLEAR_CONSTRUCTS_BUTTON,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
await(0,Xn.Z)(BulkAssemblyEditConfirmationModal,{title:"Clear constructs table",warnings:["You're about to remove all constructs from the table. This action cannot be undone."]})&&a.updateConstructs([])},onViewConstruct:async t=>{m.L9(j.Jg.OPENED_BULK_ASSEMBLY_CONSTRUCT_PREVIEW_MODAL,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY_OVERVIEW_TAB,assemblyId:a.assemblyId})
const n=a.getConstructsByCid()[t]
a.getPreviewConstruct(n)&&await(0,Xn.Z)(ConstructModal,{assemblyId:e,constructData:a.getPreviewConstructs().map((e=>({...e,polymer:a.maybeCreatePreviewConstructPolymer(e.cid)}))),initialConstructCid:t})},autopopulateButtonError:a.getAutopopulateButtonStatus(),enableClearButton:a.getNumConstructs()>0,topology:a.topology})))}const Qx=g.mM.create({fragmentsTableWrapper:{marginTop:12,paddingRight:16},constructsTableWrapper:{marginTop:36,paddingRight:16}})
var Kx=n(19875),Jx=n(19945),Xx=n(76101),e_=n(891945)
function Heading({children:e}){return d.createElement("th",{className:(0,g.iv)(i_.tableHeading)},e)}function Cell({children:e}){return d.createElement("td",{className:(0,g.iv)(i_.tableCell)},e)}function TableTitle({children:e}){return d.createElement("td",{className:(0,g.iv)(i_.tableTitle)},e)}function asPercentage(e){return`${Math.round(100*e).toString()}%`}function codonChange(e,t){return d.createElement("div",{className:(0,g.iv)(i_.codonChange),...(0,ee.Z)({component:"CodonOptimizationTabPreview",element:"codonChange"})},d.createElement("span",{className:(0,g.iv)(i_.codon)},e,d.createElement(pe.Z,{className:(0,g.iv)(i_.icon),icon:"expand"}),Pn.STANDARD_DNA_CODE[e]),t&&d.createElement("span",null,` (${t})`))}class CodonOptimizationTabPreviewConnector extends oi.C{enhanceProps(){const e=new e_.Mu(this.reduxState()).getState(this.props.tabId);(0,S.hu)(null!==e.optimizationStart&&null!==e.optimizationEnd,"Expected optimizationStart and optimizationEnd to be set.")
const t=e.optimizationStart,n=e.optimizationEnd
let a
if(this.props.isBackTranslation)a=null
else{(0,S.hu)(null!==this.props.onReplaceSequence,"onReplaceSequence must be specified when codon optimizing a DNA sequence.")
const i=this.props.onReplaceSequence
a=()=>{(0,S.hu)(!this.props.isBackTranslation,"Cannot save codon optimized sequence from back translation.")
i(t,n,(0,Xx.gE)(e.bases,this.props.result.optimizedBases,this.props.strand))
m.L9(j.Jg.SAVED_CODON_OPTIMIZED_SEQUENCE,{type:"sequence",polymerId:this.props.sequenceId})
this.props.onClose()}}return{optimizationStart:t,optimizationEnd:n,onRequestSubmit:async()=>{var a,i
const[s,r]=T.modelRangeToDisplay(t,n,this.props.seqLength,this.props.startIndex),o=(0,Xx.jZ)({isBackTranslation:this.props.isBackTranslation,originalEntityId:this.props.sequenceId,start:s,end:r,strand:this.props.strand,organism:e.selectedOrganism,gcLevel:e.selectedGCLevel,uridineDepletion:e.uridineDepletion,avoidHairpins:e.avoidHairpins,hairpinStem:e.hairpinStem,hairpinWindow:e.hairpinWindow,protectedRegions:e.protectedRegions,cutsitesToAvoid:e.cutsitesToAvoid,cutsitesToPreserve:e.cutsitesToPreserve,patternsToReduce:e.patternsToReduce,optimizationMetrics:null!==(i=null===(a=e.result)||void 0===a?void 0:a.optimizationMetrics)&&void 0!==i?i:null})
if(this.props.isBackTranslation)NR.Z.openForSelect("append",{showInventory:!0,initialFolderId:Qe.Z.get(Qe.O.INVENTORY)},(async e=>{$e.$Z()
const{folderId:t}=lo.parseFolderValue(e.target.value),n=await gl.Ue({name:`${this.props.name} (codon optimized)`,folder:t,circular:!1,bases:(0,Xx.dI)(this.props.result.optimizedBases,this.props.strand).toUpperCase(),noteParts:o})
await ve.ZP.get().openFolderItem(n.id)
Qe.Z.set(Qe.O.INVENTORY,t)
ze.Z.invalidateFolderContents(t)
$e.Cp()
m.L9(j.Jg.CREATED_CODON_OPTIMIZED_SEQUENCE,{type:"protein",polymerId:this.props.sequenceId})
this.props.onClose()}))
else{const t=this.props.createFromSelection
await Ge.Sequence.saveAndOpenSequence(t((0,Xx.gE)(e.bases,this.props.result.optimizedBases,this.props.strand),`${this.props.name} (codon optimized)`),null,{noteParts:o})
m.L9(j.Jg.CREATED_CODON_OPTIMIZED_SEQUENCE,{type:"sequence",polymerId:this.props.sequenceId})
this.props.onClose()}},onBack:()=>{this.dispatch(Jx.Hm(this.props.tabId))},onSave:a}}}const t_=CodonOptimizationTabPreviewConnector.connect((e=>{const t=e.optimizationStart,n=T.length(t,e.optimizationEnd,e.seqLength)
let a,i
if(!e.isBackTranslation){i=e.result.changes.map((a=>({id:a.location.toString(),data:{location:T.modelToDisplay((t+(1===e.strand||0===e.strand?a.location:n-a.location))%e.seqLength,e.startIndex),original:a.codonFreqs?codonChange(a.codons.original,a.codonFreqs.original):codonChange(a.codons.original,null),optimized:a.codonFreqs?codonChange(a.codons.optimized,a.codonFreqs.optimized):codonChange(a.codons.optimized,null)}})))
a=[{header:"Location",accessorKey:"location",flexGrow:0},{header:"Original",accessorKey:"original",flexGrow:1},{header:"Optimized",accessorKey:"optimized",flexGrow:1}]}return d.createElement("div",{className:(0,g.iv)(i_.tab),...(0,ee.Z)({component:"CodonOptimizationTabPreview",element:"root"})},d.createElement("div",{className:(0,g.iv)(i_.header)},d.createElement(so.Dx,null,"Optimization preview"),d.createElement("p",{className:(0,g.iv)(i_.modifiedText)},"This is a summary of the ",e.isBackTranslation?"back-translated DNA":"optimized"," sequence. You can save this sequence or go back and modify your optimization parameters.")),d.createElement("div",{className:(0,g.iv)(i_.body)},d.createElement("table",{className:(0,g.iv)(i_.table)},d.createElement("thead",null,d.createElement("tr",null,d.createElement(TableTitle,null,"Metric"),!e.isBackTranslation&&d.createElement(Heading,null,"Before"),d.createElement(Heading,null,e.isBackTranslation?"":"After"))),d.createElement("tbody",null,e.result.optimizationMetrics.numRareCodons&&d.createElement("tr",null,d.createElement(Cell,null,d.createElement("div",{className:(0,g.iv)(i_.helperCell)},d.createElement("div",null,"Rare codons"),d.createElement(ih.Z,{className:(0,g.iv)(i_.helperIcon),text:"We define a rare codon as one that accounts for less than 10% of all codons mapping to the corresponding amino acid for a given organism"}))),!e.isBackTranslation&&d.createElement(Cell,null,e.result.optimizationMetrics.numRareCodons.original),d.createElement(Cell,null,e.result.optimizationMetrics.numRareCodons.optimized)),d.createElement("tr",null,d.createElement(Cell,null,"GC content"),!e.isBackTranslation&&d.createElement(Cell,null,asPercentage(e.result.optimizationMetrics.gcContent.original)),d.createElement(Cell,null,asPercentage(e.result.optimizationMetrics.gcContent.optimized))),d.createElement("tr",null,d.createElement(Cell,null,"Uridine content"),!e.isBackTranslation&&d.createElement(Cell,null,asPercentage(e.result.optimizationMetrics.thymineContent.original)),d.createElement(Cell,null,asPercentage(e.result.optimizationMetrics.thymineContent.optimized))),d.createElement("tr",null,d.createElement(Cell,null,d.createElement("div",{className:(0,g.iv)(i_.helperCell)},d.createElement("div",null,"Hairpins"),d.createElement(ih.Z,{className:(0,g.iv)(i_.helperIcon),text:"See previous step for explanation of hairpin parameters"}))),!e.isBackTranslation&&d.createElement(Cell,null,e.result.optimizationMetrics.numHairpins.original),d.createElement(Cell,null,e.result.optimizationMetrics.numHairpins.optimized)),e.result.optimizationMetrics.patterns&&e.result.optimizationMetrics.patterns.map((t=>d.createElement("tr",{key:t.pattern},d.createElement(Cell,null,d.createElement("div",{className:(0,g.iv)(i_.helperCell)},d.createElement("div",null,"Occurrences: ",d.createElement("i",null,t.pattern)),d.createElement(ih.Z,{className:(0,g.iv)(i_.helperIcon),text:"This pattern was specified by the user. The optimization procedure attempted to reduce its occurrence."}))),!e.isBackTranslation&&d.createElement(Cell,null,t.original),d.createElement(Cell,null,t.optimized)))))),d.createElement("br",null),!e.isBackTranslation&&i&&d.createElement(lx.ZP,{columns:a,hasLineBelowHeader:!0,rows:i,getRowContentHeight:()=>15,emptyTableText:"No codons were modified."})),d.createElement("div",{className:(0,g.iv)(i_.buttonContainer)},d.createElement(C.Co,{onClick:e.onBack,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MEDIUM,text:"Back",className:(0,g.iv)(i_.backButton)}),d.createElement(C.Co,{onClick:e.onRequestSubmit,buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,text:"Save as new sequence",className:(0,g.iv)(i_.saveNewButton),dataTestAttrs:{component:"CodonOptimizationTabPreview",element:"saveAsNewSequence"}}),e.isRegionEditable&&!e.isBackTranslation&&d.createElement(C.Co,{onClick:e.onSave,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MEDIUM,text:"Save",className:(0,g.iv)(i_.saveButton)})))})),n_={paddingLeft:10,paddingTop:5,paddingBottom:5},a_={borderBottom:Tx,..._n.c4},i_=g.mM.create({modifiedText:{color:Vt.pp,paddingBottom:20},saveButton:{float:"right",marginTop:10,marginRight:3,marginBottom:10},saveNewButton:{float:"right",marginTop:10,marginLeft:3,marginBottom:10,marginRight:10},backButton:{float:"left",margin:10},tableCell:{..._n.hv,...n_,color:Vt.pp},tableHeading:{...n_,...a_,color:Vt.pp},tableTitle:{...n_,...a_},table:{width:"100%"},codon:{fontFamily:_n.HG,letterSpacing:1.6,fontWeight:"bold"},tab:{width:"100%",height:"100%",padding:"10px",display:"flex",flexDirection:"column"},icon:{height:10,marginLeft:3,marginRight:3},codonChange:{paddingTop:2},header:{height:70},body:{overflowY:"auto"},buttonContainer:{height:50,flex:"none",marginTop:"auto"},helperCell:{display:"flex",alignItems:"center"},helperIcon:{marginLeft:"6px"}})
var s_=n(640562),r_=n(13782),o_=n(952630),l_=n(49109)
const c_=g.mM.create({protectRegions:{height:"100%",width:"100%"},deleteAll:{float:"right"},deleteButton:{color:Vt.pF,":hover":{color:Vt.hM},cursor:"pointer"},buttonText:{marginLeft:5},tableRow:{":hover":{cursor:"pointer"}},deleteCell:{padding:"15px 13px"}}),codon_optimization_CodonOptimizationTabProtectRegionsPicker=e=>{const t=e.protectedRegions.map((t=>{const[n,a]=T.modelRangeToDisplay(t.start,t.end,e.seqLength,e.startIndex)
return{name:t.name,region:t,range:`${n}-${a}`,length:T.length(t.start,t.end,e.seqLength),delete:d.createElement(rc.bL,{className:(0,g.iv)(c_.deleteCell)},d.createElement(pe.Z,{onClick:n=>{n.stopPropagation()
e.onDelete(t)},icon:"delete",className:(0,g.iv)(c_.deleteButton)}))}}))
return d.createElement("div",null,d.createElement("div",null,d.createElement(rc.iA,{numRows:t.length,emptyTableText:"Select a region to protect.",onRowClick:n=>{const{region:a}=t[n]
e.onSetSelection(a.start,a.end)},getRowClassName:e=>(0,g.iv)(c_.tableRow)},d.createElement(rc.sg,{header:"Name",renderCell:e=>(0,Mt.fk)(t[e].name,50)}),d.createElement(rc.sg,{header:"Region",renderCell:e=>t[e].range}),d.createElement(rc.sg,{header:"Length",renderCell:e=>t[e].length}),d.createElement(rc.sg,{header:"Remove",renderCell:e=>t[e].delete}))),d.createElement(P.ZP,{title:null!==e.invalidProtectedRegionMessage?e.invalidProtectedRegionMessage:"",disabled:null===e.invalidProtectedRegionMessage},d.createElement(C.Co,{size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_BLUE_POWDER,text:d.createElement("div",{...(0,ee.Z)({component:"CodonOptimizationTabProtectRegionsPicker",element:"addSelectedRegionButton"})},d.createElement(pe.Z,{icon:"note-text"}),d.createElement("span",{className:(0,g.iv)(c_.buttonText)},"Add selected region")),onClick:e.onAdd,disabled:null!==e.invalidProtectedRegionMessage})),d.createElement(C.Co,{buttonStyle:C.ZJ.NEGATIVE,className:(0,g.iv)(c_.deleteAll),disabled:0===t.length,size:C.qE.SMALL,text:d.createElement("div",null,d.createElement(pe.Z,{icon:"delete"}),d.createElement("span",{className:(0,g.iv)(c_.buttonText)},"Remove all protected regions")),onClick:e.onDeleteAll}))},d_=g.mM.create({header:{borderBottom:Tx,paddingBottom:"20px",fontSize:"14px",position:"relative",height:50},selectionText:{color:Vt.t0,":hover":{color:Vt.Ej},cursor:"pointer",..._n.c4},warning:{float:"right"},warningText:{color:Vt.pp,fontWeight:"bold"},warningIcon:{color:Vt.ud,paddingLeft:6,paddingRight:6}}),codon_optimization_CodonOptimizationTabSelectionHeader=e=>{const[t,n]=T.modelRangeToDisplay(e.optimizationStart,e.optimizationEnd,e.seqLength,e.startIndex),a=1===e.strand?"(Forward Strand)":-1===e.strand?"(Reverse Strand)":""
return d.createElement("div",{className:(0,g.iv)(d_.header)},d.createElement("span",{className:(0,g.iv)(d_.selectionText),onClick:()=>{e.onSetSelection(e.optimizationStart,e.optimizationEnd)}},`Region: ${t}-${n} ${a}`),!y.isOrf(e.bases)&&d.createElement("span",{className:(0,g.iv)(d_.warning)},d.createElement("span",{className:(0,g.iv)(d_.warningIcon)},d.createElement(pe.Z,{icon:"warning"})),d.createElement("span",{className:(0,g.iv)(d_.warningText)},"Region is not an ORF")))}
class CodonOptimizationTabSelectionConnector extends oi.C{enhanceProps(){const e=new e_.Mu(this.reduxState()).getState(this.props.tabId);(0,S.hu)(null!==e.optimizationStart&&null!==e.optimizationEnd,"Expected optimizationStart and optimizationEnd to be set.")
const t=e.optimizationStart,n=e.optimizationEnd
return{optimizationStart:t,optimizationEnd:n,selectedOrganism:e.selectedOrganism,selectedGCLevel:e.selectedGCLevel,isLoading:e.isLoading,error:e.error,bases:e.bases,cutsitesToPreserve:e.cutsitesToPreserve,onPreview:()=>{this.dispatch(Jx.$O(this.props.tabId,this.props.sequenceId,this.props.isBackTranslation,this.props.matchSites,e.cutsitesToPreserve,e.cutsitesToAvoid,t,n,this.props.seqLength,this.props.strand,e.protectedRegions,e.bases,e.selectedOrganism,e.selectedGCLevel,e.uridineDepletion,e.avoidHairpins,e.hairpinStem,e.hairpinWindow,e.patternsToReduce))},onUpdateOrganism:e=>{We.Z.set(On.Qv.ORGANISM,e)
this.dispatch(Jx.bW(e,this.props.tabId))},onUpdateGCLevel:e=>{We.Z.set(On.Qv.GC_LEVEL,e)
this.dispatch(Jx.nu(e,this.props.tabId))},protectedRegions:e.protectedRegions,deleteProtectedRegion:e=>{this.dispatch(Jx.Fr(this.props.tabId,e))},deleteAllProtectedRegions:()=>{this.dispatch(Jx.UI(this.props.tabId))},addProtectedRegion:()=>{const[a,i]=T.modelRangeToDisplay(this.props.currentSelection.start,this.props.currentSelection.end,this.props.seqLength,this.props.startIndex),s=(0,Xx.PJ)(this.props.currentSelection.start,this.props.currentSelection.end,t,n,e.protectedRegions)
null!==s?this.dispatch(Jx.oI(this.props.tabId,s)):this.dispatch(Jx.DU(this.props.tabId,{start:this.props.currentSelection.start,end:this.props.currentSelection.end,name:`${a}-${i}`}))},cutsitesToAvoid:e.cutsitesToAvoid,deleteCutsiteToPreserve:e=>{this.dispatch(Jx.YQ(this.props.tabId,e))},deleteAllCutsitesToPreserve:()=>{this.dispatch(Jx.e3(this.props.tabId))},addCutsiteToPreserve:e=>{const t=te.ZP.enzymes.filter((t=>t.id===e))[0]
this.dispatch(Jx.FO(this.props.tabId,{enzymeName:t.name,id:e,recognitionSite:t.seq}))},addCutsiteToAvoid:e=>{const t=te.ZP.enzymes.filter((t=>t.id===e))[0]
this.dispatch(Jx.YT(this.props.tabId,{enzymeName:t.name,recognitionSite:t.seq,id:e}))},deleteCutsiteToAvoid:e=>{this.dispatch(Jx.W7(this.props.tabId,e))},deleteAllCutsitesToAvoid:()=>{this.dispatch(Jx.VF(this.props.tabId))},uridineDepletion:e.uridineDepletion,onUpdateUridineDepletion:e=>{We.Z.set(On.Qv.URIDINE,e.target.checked)
this.dispatch(Jx.WQ(this.props.tabId,e.target.checked))},avoidHairpins:e.avoidHairpins,onUpdateAvoidHairpins:t=>{this.dispatch(Jx.j6(this.props.tabId,t,e.hairpinStem.value,e.hairpinWindow.value,e.bases.length))},hairpinStem:e.hairpinStem,onUpdateHairpinStem:t=>{this.dispatch(Jx.j6(this.props.tabId,e.avoidHairpins,Number(t),e.hairpinWindow.value,e.bases.length))},hairpinWindow:e.hairpinWindow,onUpdateHairpinWindow:t=>{this.dispatch(Jx.j6(this.props.tabId,e.avoidHairpins,e.hairpinStem.value,Number(t),e.bases.length))},activeTab:e.activeTab,onUpdateActiveTab:e=>{this.dispatch(Jx.wc(this.props.tabId,e))},addPatternToReduce:()=>{this.dispatch(Jx.bS(this.props.tabId))},deleteAllPatternsToReduce:()=>{this.dispatch(Jx.SK(this.props.tabId))},deletePatternToReduce:e=>{this.dispatch(Jx.eF(this.props.tabId,e))},updatePatternToReduce:(e,t)=>{this.dispatch(Jx.ld(this.props.tabId,e,t))},patternsToReduce:e.patternsToReduce}}}const u_=CodonOptimizationTabSelectionConnector.connect((e=>{const{optimizationStart:t,optimizationEnd:n}=e
let a,i,s=[]
if(e.isBackTranslation)i=(0,hs.Z)(e.cutsitesToAvoid.map((e=>({enzymeId:e.id,enzyme:e.enzymeName}))),[{accessor:"enzyme",reversed:!1}])
else{(0,S.hu)(null!==e.matchSites,"Expected matchSites to be set for codon optimizing a DNA sequence.")
a=e.matchSites
s=(0,hs.Z)(e.cutsitesToPreserve.map((e=>({enzymeId:e.id,enzyme:e.enzymeName,cuts:a.filter((t=>t.enzymeName===e.enzymeName)).length}))),[{accessor:"cuts",reversed:!0},{accessor:"enzyme",reversed:!1}])
i=(0,hs.Z)(e.cutsitesToAvoid.map((e=>({enzymeId:e.id,enzyme:e.enzymeName,cuts:a.filter((t=>t.enzymeName===e.enzymeName)).length}))),[{accessor:"cuts",reversed:!0}])}const r=t===e.currentSelection.start&&n===e.currentSelection.end,o=(0,Xx.PJ)(e.currentSelection.start,e.currentSelection.end,t,n,e.protectedRegions),l=(0,Xx.Pq)(e.cutsitesToPreserve,e.cutsitesToAvoid,e.selectedOrganism,e.avoidHairpins,e.hairpinStem,e.hairpinWindow,e.uridineDepletion,e.selectedGCLevel,e.patternsToReduce)
return d.createElement("div",{className:(0,g.iv)(m_.selectionTab),...(0,ee.Z)({component:"CodonOptimizationTabSelection",element:"root"})},d.createElement(codon_optimization_CodonOptimizationTabSelectionHeader,{optimizationStart:t,optimizationEnd:n,seqLength:e.seqLength,startIndex:e.startIndex,onSetSelection:e.onSetSelection,bases:e.bases,strand:e.strand,isOriginalSelection:r}),d.createElement("div",{className:(0,g.iv)(m_.body)},d.createElement("br",null),d.createElement(l_.Z,{selectedOrganism:e.selectedOrganism,selectedGCLevel:e.selectedGCLevel,onUpdateOrganism:e.onUpdateOrganism,onUpdateGCLevel:e.onUpdateGCLevel,uridineDepletion:e.uridineDepletion,onUpdateUridineDepletion:e.onUpdateUridineDepletion,avoidHairpins:e.avoidHairpins,onUpdateAvoidHairpins:e.onUpdateAvoidHairpins,hairpinStem:e.hairpinStem,onUpdateHairpinStem:e.onUpdateHairpinStem,hairpinWindow:e.hairpinWindow,onUpdateHairpinWindow:e.onUpdateHairpinWindow,bases:e.bases}),d.createElement("br",null),d.createElement(sp.Xl,{activeTab:e.activeTab,onRequestTabChange:e.onUpdateActiveTab},d.createElement(sp.OK,{tabKey:On.r9.AVOIDED_CUTSITES,title:`Avoided Cut Sites (${i.length})`},d.createElement("p",{className:(0,g.iv)(m_.explanationText)},"For the specified enzymes, existing cut sites will be removed and no new cut sites will be created."),d.createElement("br",null),d.createElement(r_.Z,{rows:i,isShowingCuts:!e.isBackTranslation,onAdd:e.addCutsiteToAvoid,onDelete:e.deleteCutsiteToAvoid,onDeleteAll:e.deleteAllCutsitesToAvoid,buttonText:"Add cut site to avoid",emptyTableText:"Select an enzyme below to avoid creating its recognition site in the optimized sequence.",availableEnzymes:te.ZP.enzymes})),!e.isBackTranslation&&d.createElement(sp.OK,{tabKey:On.r9.PRESERVED_CUTSITES,title:`Preserved Cut Sites (${s.length})`},d.createElement("p",{className:(0,g.iv)(m_.explanationText)},"Existing cut sites will be protected. No new cut sites will be created."),d.createElement("br",null),d.createElement(r_.Z,{rows:s,isShowingCuts:!0,onAdd:e.addCutsiteToPreserve,onDelete:e.deleteCutsiteToPreserve,onDeleteAll:e.deleteAllCutsitesToPreserve,buttonText:"Add cut site to preserve",emptyTableText:"Select an enzyme below to preserve its cut sites.",availableEnzymes:te.ZP.enzymes.filter((e=>a.some((t=>t.enzymeId===e.id))))})),!e.isBackTranslation&&d.createElement(sp.OK,{tabKey:On.r9.PROTECTED_REGIONS,title:`Protected Regions (${e.protectedRegions.length})`},d.createElement("p",{className:(0,g.iv)(m_.explanationText)},"Selected regions will not be modified by the optimization routine."),d.createElement("br",null),d.createElement(codon_optimization_CodonOptimizationTabProtectRegionsPicker,{protectedRegions:e.protectedRegions,onDelete:t=>{e.deleteProtectedRegion(t)},onDeleteAll:e.deleteAllProtectedRegions,onAdd:e.addProtectedRegion,seqLength:e.seqLength,startIndex:e.startIndex,invalidProtectedRegionMessage:o,onSetSelection:e.onSetSelection})),d.createElement(sp.OK,{tabKey:On.r9.REDUCED_PATTERNS,title:`Patterns to Reduce (${e.patternsToReduce.length})`},d.createElement("p",{className:(0,g.iv)(m_.explanationText)},(e.isBackTranslation?"The optimization procedure will attempt to minimize the usage of the specified nucleotide pattern(s) throughout the back-translated DNA sequence, on the coding strand only.":"The optimization procedure will attempt to reduce the usage of the specified nucleotide pattern(s) throughout the entire sequence length, on the coding strand only.")+' Use the checkbox if you wish to also reduce usage of the reverse complement. The pattern must consist of ATGC bases only, and is case-insensitive ("gat" will reduce usage of "GAT").'),d.createElement("br",null),d.createElement(o_.Z,{rows:e.patternsToReduce,onAdd:e.addPatternToReduce,onDeleteAll:e.deleteAllPatternsToReduce,onDelete:e.deletePatternToReduce,onUpdate:e.updatePatternToReduce})))),null!==e.error&&d.createElement("div",{className:(0,g.iv)(m_.error)},d.createElement(Ff.Z,null,d.createElement(s_.Z,{message:e.error}))),d.createElement("div",{className:(0,g.iv)(m_.navigationButtons)},d.createElement(C.Co,{onClick:e.onClose,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MEDIUM,text:"Cancel",className:(0,g.iv)(m_.cancelButton)}),d.createElement(P.ZP,{title:null!==l?l:"",disabled:null===l},d.createElement(C.Co,{onClick:e.onPreview,buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,text:e.isLoading?"Optimizing...":"Preview optimization",className:(0,g.iv)(m_.previewButton),disabled:null!==l,dataTestAttrs:{component:"CodonOptimizationTabSelection",element:"previewButton"}}))))})),m_=g.mM.create({body:{padding:"10px 0",overflowY:"auto"},cancelButton:{float:"left"},previewButton:{float:"right"},tableTitle:{borderBottom:Tx,..._n.c4},tooltip:{margin:6},explanationText:{color:Vt.pp},selectionTab:{display:"flex",flexDirection:"column",height:"100%",padding:10},title:{paddingBottom:8},navigationButtons:{borderTop:Tx,height:"inherit",flexBasis:0,paddingTop:20,position:"relative",marginTop:"auto"},error:{position:"relative",marginTop:"auto"}})
class CodonOptimizationTabConnector extends oi.C{enhanceProps(){const e=new e_.Mu(this.reduxState()).getState(this.props.tabId)
return{isShowingOptions:e.isShowingOptions,isLoading:e.isLoading,result:e.result}}}const p_=CodonOptimizationTabConnector.connect((e=>{if(e.isShowingOptions)return d.createElement(u_,{onClose:e.onClose,tabId:e.tabId,sequenceId:e.sequenceId,startIndex:e.startIndex,onSetSelection:e.onSetSelection,currentSelection:e.currentSelection,seqLength:e.seqLength,isBackTranslation:e.isBackTranslation,strand:e.strand,matchSites:e.matchSites})
if(e.result)return d.createElement(t_,{result:e.result,onClose:e.onClose,name:e.name,onReplaceSequence:e.onReplaceSequence,startIndex:e.startIndex,tabId:e.tabId,sequenceId:e.sequenceId,circular:e.circular,seqLength:e.seqLength,isRegionEditable:e.isRegionEditable,isBackTranslation:e.isBackTranslation,strand:e.strand,seqEnd:e.seqEnd,createFromSelection:e.createFromSelection});(0,S.Gp)(!1,"Expected isShowingOptions or result to be set.")
return null}))
class CodonOptimizationTabView extends s().View{initialize(){this.listenTo(this.model.polymer().selection(),"change",(()=>this.render()))
if(this.model.polymer()instanceof Ge.Sequence){const e=this.model.polymer()
this.listenTo(e.get("cutsites"),"change",(()=>this.render()))}}render(){const e=this.model.sequence().selection(),t=new e_.Mu((0,Vn.getStore)().getState()).getState(this.model.cid),n=t.strand
if(this.model.sequence()instanceof Ge.Sequence){(0,S.hu)(null!==t.optimizationStart&&null!==t.optimizationEnd,"Expected optimizationStart and optimizationEnd to be set")
const a=this.model.sequence(),i=t.optimizationStart,s=t.optimizationEnd,r=a.length();(0,Me.A9)(d.createElement(p_,{onClose:()=>{this.model.close()},name:a.name(),tabId:this.model.cid,onReplaceSequence:(e,t,n,i)=>{a.exactReplaceBases(e,t,n,i)},startIndex:a.get("_sequence").get("startIndex"),onSetSelection:(t,n)=>{e.setEndpoints(t,n)},currentSelection:{start:e.start(),end:e.end()},seqLength:a.length(),sequenceId:a.id,circular:a.circular(),isBackTranslation:!1,isRegionEditable:a.get("_sequence").isRegionEditable(i,s),strand:n,seqEnd:a.get("_sequence").get("length"),matchSites:a.get("enzymes").map((e=>a.get("_sequence").getCuts(e.toJSON()).map((t=>new Kx.Z({enzyme:e,position:t.position,strand:t.strand}))))).flat().map((e=>T.getMatchSiteInfo(e,r))).filter((e=>T.isRangeOverlap(e.matchStart,e.matchEnd,i,s))),createFromSelection:(e,t)=>a.createFromSelection(i,s,{annotations:!0,notcontained:!0,tags:!1,reverseComplement:!1,bases:e,name:t})}),this.el)}else if(this.model.sequence()instanceof ga.Z){const t=this.model.sequence();(0,Me.A9)(d.createElement(p_,{onClose:()=>{this.model.close()},name:t.name(),tabId:this.model.cid,onReplaceSequence:null,startIndex:Ki.ZP.DEFAULT_START_INDEX,onSetSelection:(t,n)=>{e.setEndpoints(t,n)},currentSelection:{start:e.start(),end:e.end()},seqLength:t.length(),sequenceId:t.id,circular:!1,isBackTranslation:!0,isRegionEditable:!1,strand:n,seqEnd:null,matchSites:null,createFromSelection:null}),this.el)}else(0,S.Gp)(!1,"Unexpected codon optimization input type.",this.model.sequence())
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}CodonOptimizationTabView.prototype.className="buffer-tab"
const h_=CodonOptimizationTabView
var g_=n(115749)
var E_=n(94253)
function _checkInsertionRegion(e,{start:t,end:n},a){if(null==t||null==n){v.ZP.error("Specify insertion region start and end to continue.")
return!1}if(!T.isValidRange(t,n,a.length,a.circular)){v.ZP.error("Insertion region is invalid.")
return!1}return!0}const f_={getAllVectors(){Sa.Z.dispatch({actionType:fa.ZVE});(function getAll(){return Cn.xA("/1/api/crispr-vectors/")})().done((e=>{Sa.Z.dispatch({actionType:fa.iCS,vectors:e.data})})).fail((e=>{v.ZP.notifyError(e)
Sa.Z.dispatch({actionType:fa.EjH})}))},__createVector(e){Sa.Z.dispatch({actionType:fa.P9H})
return function create(e){return Cn.ty({url:"/1/api/crispr-vectors/",data:e})}(e).done((e=>{Sa.Z.dispatch({actionType:fa.zCt,vector:e})})).fail((e=>{v.ZP.notifyError(e)
Sa.Z.dispatch({actionType:fa.OCS})}))},__updateVector(e,t){Sa.Z.dispatch({actionType:fa.SFi})
return function CRISPRVectorDAO_update(e,t){return Cn.Yh({url:`/1/api/crispr-vectors/${e}`,data:t})}(e,t).done((e=>{Sa.Z.dispatch({actionType:fa.DY7,vector:e})})).fail((e=>{v.ZP.notifyError(e)
Sa.Z.dispatch({actionType:fa.h5n})}))},createAssembly(e,t,n){Sa.Z.dispatch({actionType:fa.xlx,analysis:t,assemblyCid:e,assemblies:n})},updateAssembly(e,t){Sa.Z.dispatch({actionType:fa._cs,assemblyCid:e,data:t})},selectVector(e,t){Sa.Z.dispatch({actionType:fa.XvT,assemblyCid:e,vectorId:t})},selectSequence(e,t){Sa.Z.dispatch({actionType:fa.Xhx,assemblyCid:e,sequence:t})},selectExistingSequence(e,t){Sa.Z.dispatch({actionType:fa.AYE,assemblyCid:e,sequence:t})},finalizeSelectedVector(e){let t
const{biojsSequence:n,enzyme:a,existingSequenceInputState:i,fileInputState:s,insertionRegion:r,vectorSelectorState:l,vectorSourceType:c}=g_.Z.getAssemblyState(e)
let d=null,u=null
switch(c){case gi.VECTOR_SOURCE_TYPE.CREATE_FROM_FILE:{const{sequence:e}=s
if(null==e){v.ZP.error("Upload a file to continue.")
return}if(!(s.sequenceName.trim().length>0&&null!=s.folderId)){v.ZP.error("Name and folder must be specified.")
return}if(!_checkInsertionRegion(0,r,e))return;(0,S.hu)(null!=a,"Expected to receive an enzyme when finalizing CRISPR vector");(0,S.hu)(e.id===n.id,"Expected sequence ID to match bioJS sequence ID")
d=eA.SP(e.id,{name:s.sequenceName,folder:s.folderId},{parentFolderId:e.folder.api_identifier})
u=f_.__createVector({sequence:e.id,insertionRegionStart:r.start,insertionRegionEnd:r.end})
break}case gi.VECTOR_SOURCE_TYPE.SELECT_EXISTING_SEQUENCE:{const{sequence:e}=i
if(null==e){v.ZP.error("Select a sequence to continue.")
return}if(!_checkInsertionRegion(0,r,e))return;(0,S.hu)(null!=a,"Expected to receive an enzyme when finalizing CRISPR vector");(0,S.hu)(e.id===n.id,"Expected sequence ID to match bioJS sequence ID")
u=f_.__createVector({sequence:e.id,insertionRegionStart:r.start,insertionRegionEnd:r.end})
break}case gi.VECTOR_SOURCE_TYPE.SELECT_VECTOR:({vector:t}=l)
if(null==t){v.ZP.error("Choose a vector to continue.")
return}if(!_checkInsertionRegion(0,r,t.sequence))return;(0,S.hu)(null!=a,"Expected to receive an enzyme when finalizing CRISPR vector");(0,S.hu)(t.sequence.id===n.id,"Expected sequence ID to match bioJS sequence ID")
u=f_.__updateVector(t.id,{insertionRegionStart:r.start,insertionRegionEnd:r.end})}f_.updateAssembly(e,{finalizingSelectedVector:!0})
o().when(d,u).done((()=>{f_.updateAssembly(e,{assemblyData:{vector:n,enzyme:a,insertionRegion:{start:r.start,end:r.end}},step:gi.ASSEMBLY_STEP.FINALIZE_ASSEMBLIES})})).fail(v.ZP.notifyError).always((()=>{f_.updateAssembly(e,{finalizingSelectedVector:!1})}))},finalizeAssemblies(e){let t,n
const{analysis:a,assemblies:i,assembliesFolder:s,assemblyData:r}=g_.Z.getAssemblyState(e)
if(0===i.length){v.ZP.error('No assemblies to make. Click the "Add" button.')
return}for(let e=0;e<i.length;e++){const t=i[e]
if(0===t.bases.length){v.ZP.error(`Assembly #${e+1} has no bases!`)
return}if(0===t.name.length){v.ZP.error(`Assembly #${e+1} has no name!`)
return}}if(null==s){v.ZP.error("Select a folder for the assemblies.")
return}const l=r.vector,c=r.enzyme.get("offset"),{start:d,end:u}=r.insertionRegion
if(c>0){t=(e,t,n)=>({bases:l.residueSlice(d-c,d)+e,start:T.mod(t-c,n),end:T.mod(t+e.length,n)})
n=(e,t,n)=>({bases:y.revcomp(e+l.residueSlice(u,u+c),R.jb),start:t,end:T.mod(t+e.length+c,n)})}else{t=(e,t,n)=>({bases:e+l.residueSlice(u,u-c),start:t,end:T.mod(t+e.length-c,n)})
n=(e,t,n)=>({bases:l.residueSlice(d+c,d)+e,start:T.mod(t+c,n),end:T.mod(t+e.length,n)})}const m=i.map((({name:e,bases:i})=>{let r
const o=l.clone()
if(g_.Z.shouldPrependG(a)&&"G"!==i.charAt(0).toUpperCase()){i=`G${i}`
r=!0}const c=o.replaceBases(d,u,i),m=o.sequencePrimers()
m.add({...t(i,c,o.length()),strand:1,name:`${e} FWD`,folder_api_id:s})
m.add({...n(i,c,o.length()),strand:-1,name:`${e} REV`,folder_api_id:s})
o.annotations().add({start:c+(r?1:0),end:c+i.length,strand:0,name:"Guide"})
o.set({name:e,folderId:s,circular:!0})
return o}))
f_.updateAssembly(e,{finalizingAssemblies:!0})
const p=m.map((e=>e.save()))
o().when(...p||[]).done((()=>{const t=m[0]
v.ZP.success(`Saved ${i.length} assemblies in "${t.folder().name}".`);(0,$N.Z)(t.folder(),ZN.INVENTORY_SECTION)
f_.updateAssembly(e,{step:gi.ASSEMBLY_STEP.COMPLETED_ASSEMBLY,assemblyPrimers:m.map((e=>e.sequencePrimers().map((e=>({name:e.name(),bases:e.bases()}))))).flat(),assembledVectorIds:m.map((e=>e.id)),assembliesRootFolder:t.folder().source.rootFolder.api_identifier})})).fail(v.ZP.notifyError).always((()=>{f_.updateAssembly(e,{finalizingAssemblies:!1})}))},createEntry(e,t){const{assemblyPrimers:n,assembliesRootFolder:a,assembledVectorIds:i}=g_.Z.getAssemblyState(e);(function createEntry(e){return Cn.ty({url:"/1/api/crispr-assemblies/entry/",data:e}).done((()=>{ze.Z.invalidateFolderContents(e.folder)}))})({assemblyPrimers:n,folder:a,initialDay:E_.p6(Zd()()),name:`${t} Assemblies`,assembledVectorIds:i}).done((({id:e})=>{ve.ZP.get().openFolderItem(e,{open:!0,source:"crispr-assembly-entry"})})).fail(v.ZP.notifyError)}},S_=f_
class CRISPRAssemblyTabState extends nn.Xh{defaults(){return l.default.extend(super.defaults(),{title:"Assemble CRISPR",closeable:!0})}initialize(){this.set("assemblyCid",l.default.uniqueId("crispr-assembly-"))
S_.getAllVectors()
S_.createAssembly(this.assemblyCid(),this.get("analysis"),Array.from(this.get("basesList")).map(((e,t)=>({name:`${this.sequenceName()} Assembly ${t+1}`,bases:e}))))}assemblyCid(){return this.get("assemblyCid")}sequenceName(){return this.get("sequenceName")}}const y_=CRISPRAssemblyTabState
class CompletedAssemblyStep extends d.Component{render(){return d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("h3",{className:"u-spacing-bottom"},"Your assembly is complete!"),d.createElement("div",{className:"well"},d.createElement("p",null,"Open the primers and plasmids from the file browser at the left. You can also"),d.createElement("ul",null,d.createElement("li",{className:"u-small-spacing-bottom"},d.createElement("a",{onClick:()=>{S_.createEntry(this.props.assemblyCid,this.props.sequenceName)
m.j("crispr","created_assembly_entry")}},"create a notebook entry")," with the ",d.createElement("b",null,"cloning protocol")," and the sequences linked."),d.createElement("li",null,d.createElement("a",null,d.createElement(bt.Z,{value:this.props.assemblyPrimers.map((e=>[e.name,e.bases].join("\t"))).join("\n"),notifyCopied:function(){v.ZP.success("Primers have been copied in tab-delimited format.",{duration:6,id:"assembly-primers-copied"})
m.j("crispr","copied_assembly_primers")}},"copy the primer list"))," to your clipboard. (Paste it into Excel or ",d.createElement("a",{href:"http://www.idtdna.com/order/OrderEntry.aspx",target:"_blank",rel:"noopener noreferrer"},"IDT's order form"),".)")))))}}const b_=CompletedAssemblyStep
class AssemblyList extends d.Component{constructor(){super(...arguments)
this.addAssembly=()=>{S_.updateAssembly(this.props.assemblyCid,{assemblies:Q()(this.props.assemblies,{$push:[{name:"",bases:""}]})})}
this.removeAssembly=e=>{S_.updateAssembly(this.props.assemblyCid,{assemblies:Q()(this.props.assemblies,{$splice:[[e,1]]})})}
this._handleChangeAssemblyName=(e,t)=>{const n=l.default.object([[e,{$merge:{name:t}}]])
S_.updateAssembly(this.props.assemblyCid,{assemblies:Q()(this.props.assemblies,n)})}
this._handleChangeAssemblyBases=(e,t)=>{const n=y.sanitize(t,y.NucleotideType.DNA),a=l.default.object([[e,{$merge:{bases:n}}]])
S_.updateAssembly(this.props.assemblyCid,{assemblies:Q()(this.props.assemblies,a)})}}render(){return d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:5},d.createElement(Je.Z,null,"Assembly Name")),d.createElement(p.Z,{sm:5},d.createElement(Je.Z,null,"Guide Sequence ",g_.Z.shouldPrependG(this.props.analysis)?d.createElement(ih.Z,{text:"Assembly will prepend G to guides that do not start with G."}):void 0))),0===this.props.assemblies.length?d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("p",null,'No assemblies to make. Click the "Add" button below.'))):Array.from(this.props.assemblies).map(((e,t)=>d.createElement(h.Z,{key:t},d.createElement(p.Z,{sm:5},d.createElement("input",{type:"text",value:this.props.assemblies[t].name,onChange:e=>{this._handleChangeAssemblyName(t,e.target.value)}})),d.createElement(p.Z,{sm:5},d.createElement("input",{type:"text",value:this.props.assemblies[t].bases,onChange:e=>{this._handleChangeAssemblyBases(t,e.target.value)}})),d.createElement(p.Z,{sm:1},d.createElement("a",{className:"faded u-danger-pointer u-input-line-height",onClick:this.removeAssembly.bind(this,t)},d.createElement(pe.Z,{icon:"xmark-large"})))))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.addAssembly,text:d.createElement("span",null,d.createElement(pe.Z,{icon:"search-filter-add",className:"u-mini-spacing-right"}),"Add")}))))}}const T_=AssemblyList,{ASSEMBLY_STEP:v_}=gi
class FinalizeAssembliesStep extends d.Component{render(){return d.createElement("form",{onSubmit:e=>{e.preventDefault()
S_.finalizeAssemblies(this.props.assemblyCid)
m.j("crispr","finalized_assemblies")}},d.createElement("fieldset",null,d.createElement("legend",null,"Finalize Assemblies"),d.createElement(T_,{analysis:this.props.analysis,assemblyCid:this.props.assemblyCid,assemblies:this.props.assemblies}),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(Je.Z,null,"Folder"))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:5},d.createElement(Ye.Z,{enableRedesign:!0,showInventory:!0,value:this.props.assembliesFolder,onChange:e=>{S_.updateAssembly(this.props.assemblyCid,{assembliesFolder:e.target.value})},unsetOnFetchFail:!0})))),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,className:"pull-right",type:"submit",disabled:this.props.finalizingAssemblies,text:this.props.finalizingAssemblies?"Assembling...":"Assemble"}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:e=>{e.preventDefault()
S_.updateAssembly(this.props.assemblyCid,{step:v_.SELECT_VECTOR})},disabled:this.props.finalizingAssemblies,text:"Previous"})))}}const C_=FinalizeAssembliesStep
var I_=n(840060),w_=n(408783),N_=n(50585),A_=n(121990),R_=n(331404)
const{formatBaseCount:P_}=y,{VECTOR_SOURCE_TYPE:O_}=gi,{SEQUENCE_TYPE:x_}=ZN
function sequencePreviewLink({name:e,length:t,circular:n,id:a},i){const s=n?"circular":"linear",r=d.createElement("span",null,d.createElement("a",{onClick:function(){return ve.ZP.get().openFolderItem(a,{open:!0,source:"crispr-assembly"})}},d.createElement(pe.Z,{icon:"upload"}))," ",d.createElement("span",{className:"faded"},`${P_(t)} · ${s}`))
return d.createElement("small",{className:"u-tiny-spacing-top"},null!=i?d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},r),d.createElement(p.Z,{sm:6,className:"text-right"},d.createElement("span",{className:"faded"},"Addgene: "),d.createElement("a",{href:`https://www.addgene.org/${i}/`,target:"_blank",rel:"noopener noreferrer"},i))):r)}class VectorSelector extends d.Component{constructor(){super(...arguments)
this.vectorOptions=()=>l.default.chain(this.props.vectors).sortBy((e=>e.insertionRegionEnd)).sortBy((e=>e.insertionRegionStart)).sortBy((e=>e.sequence.name)).map((e=>{const t=l.default.compact([e.fullName,e.addgeneId])
return{id:e.id,text:`${e.sequence.name}${t.length?` (${t.join(", ")})`:""}`}})).value()
this.vectorChangeHandler=e=>S_.selectVector(this.props.assemblyCid,e.val)}render(){return d.createElement("div",null,d.createElement(N_.Z,{placeholder:this.props.vectorLoading?"Loading vectors...":"Choose vector",options:this.vectorOptions(),value:null!=(null!=this.props.vectorSelectorState.vector?this.props.vectorSelectorState.vector.id:void 0)?null!=this.props.vectorSelectorState.vector?this.props.vectorSelectorState.vector.id:void 0:null,onChange:this.vectorChangeHandler,disabled:this.props.vectorLoading}),null!=this.props.vectorSelectorState.vector?sequencePreviewLink(this.props.vectorSelectorState.vector.sequence,this.props.vectorSelectorState.vector.addgeneId):void 0)}}class FileInput extends d.Component{constructor(){super(...arguments)
this._getImportErrorLink=e=>({value:this.props.fileInputState.importError,requestChange:e=>{S_.updateAssembly(this.props.assemblyCid,{fileInputState:Q()(this.props.fileInputState,l.default.object([["importError",{$set:e}]]))})}})
this._handleChangeSequenceName=e=>{S_.updateAssembly(this.props.assemblyCid,{fileInputState:Q()(this.props.fileInputState,l.default.object([["sequenceName",{$set:e.target.value}]]))})}
this._handleChangeFolder=e=>{S_.updateAssembly(this.props.assemblyCid,{fileInputState:Q()(this.props.fileInputState,l.default.object([["folderId",{$set:e.target.value}]]))})}}render(){return d.createElement("div",null,null!=this.props.fileInputState.sequence?d.createElement("div",null,d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Sequence Name"),d.createElement("input",{type:"text",value:this.props.fileInputState.sequenceName,onChange:this._handleChangeSequenceName}),sequencePreviewLink(this.props.fileInputState.sequence)),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Folder"),d.createElement(Ye.Z,{showInventory:!0,value:this.props.fileInputState.folderId,onChange:this._handleChangeFolder,unsetOnFetchFail:!0})),d.createElement("hr",{key:"hr"})):void 0,d.createElement(Ke.Z,null,d.createElement(I_.Z,{importErrorLink:this._getImportErrorLink(),multi:!1,updateSequences:(...e)=>{const t=e[0]
S_.selectSequence(this.props.assemblyCid,t)}})))}}class ExistingSequenceInput extends d.Component{constructor(){super(...arguments)
this.onDrop=e=>{const t=(0,A_.Z)(e).getData(A_.Z.FILES_MIME_TYPE)||[],n=l.default.pluck(t,"id")
if(!n.length)return
if(n.length>1){v.ZP.error("Only one file can be selected as a vector.")
return}const[a]=Array.from(n)
ea.ZP.apiIdToType(a)===st.SEQUENCE?gl.U2(a).done((e=>{e.sequence_type!==x_.OLIGO?S_.selectExistingSequence(this.props.assemblyCid,e):v.ZP.error(ExistingSequenceInput.TYPE_ERROR_MESSAGE)})).fail(v.ZP.notifyError):v.ZP.error(ExistingSequenceInput.TYPE_ERROR_MESSAGE)}
this._handleOpenProjects=()=>{w_.GS(ZP.SA.PROJECTS)}
this.clear=()=>{S_.selectExistingSequence(this.props.assemblyCid,null)}}render(){return null!=this.props.existingSequenceInputState.sequence?d.createElement("div",null,d.createElement("p",null,d.createElement("span",{className:"faded u-danger-pointer pull-right",onClick:this.clear},d.createElement(pe.Z,{icon:"xmark-large"})),d.createElement(pe.Z,{className:"faded",icon:rr.m.Sequence})," ",this.props.existingSequenceInputState.sequence.name),sequencePreviewLink(this.props.existingSequenceInputState.sequence)):d.createElement(R_.Z,{shouldCaptureDrop:!0,mimeTypes:[A_.Z.FILES_MIME_TYPE],dropEffect:"link",targetDesc:"CRISPR assembly",onDrop:this.onDrop},d.createElement("div",{className:"drop-help"},"Search for a sequence in the ",d.createElement("a",{onClick:this._handleOpenProjects},"file browser")," and drag it here"))}}ExistingSequenceInput.TYPE_ERROR_MESSAGE="Only a sequence can be selected as a vector."
class SelectVectorStep extends d.Component{constructor(){super(...arguments)
this.selectedSequence=()=>{switch(this.props.vectorSourceType){case O_.SELECT_VECTOR:return null!=this.props.vectorSelectorState.vector?this.props.vectorSelectorState.vector.sequence:void 0
case O_.CREATE_FROM_FILE:return this.props.fileInputState.sequence
case O_.SELECT_EXISTING_SEQUENCE:return this.props.existingSequenceInputState.sequence
default:return}}
this.startIndex=()=>{let e
return null!=(e=SelectVectorStep_guard_(this.selectedSequence(),(e=>e.startIndex)))?e:1}
this.sequenceLength=e=>{let t
return null!=(t=SelectVectorStep_guard_(this.selectedSequence(),(e=>e.length)))?t:e+1}
this.renderVectorSourceTypeChoice=(e,t)=>d.createElement("div",{className:"radio"},d.createElement("label",null,d.createElement("input",{type:"radio",value:e,checked:this.props.vectorSourceType===e,onChange:e=>{S_.updateAssembly(this.props.assemblyCid,{vectorSourceType:e.target.value})}}),t))
this.renderInsertionRegionInput=(e,t)=>{let n
n="start"===e?T.modelStartToDisplay(this.props.insertionRegion.start,this.startIndex()):T.modelEndToDisplay(this.props.insertionRegion.end,this.sequenceLength(this.props.insertionRegion.end),this.startIndex())
return d.createElement("input",{type:"number",placeholder:t,value:null!=n?n:void 0,onChange:t=>{let n=parseInt(t.target.value,10)
if("start"===e)n=isNaN(n)?null:T.displayStartToModel(n,this.startIndex())
else{(0,S.hu)("end"===e,"expected key to be 'start' or 'end'")
n=isNaN(n)?null:T.displayEndToModel(n,this.sequenceLength(n),this.startIndex())}S_.updateAssembly(this.props.assemblyCid,{insertionRegion:Q()(this.props.insertionRegion,l.default.object([[e,{$set:n}]]))})}})}}render(){return d.createElement("fieldset",null,d.createElement("legend",null,"Select Expression Vector"),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{className:"text-right",sm:4},d.createElement(Je.Z,{className:"u-input-line-height"},"Vector Source")),d.createElement(p.Z,{sm:8,lg:6},this.renderVectorSourceTypeChoice(O_.SELECT_VECTOR,"Select one of the bookmarked plasmids"),this.renderVectorSourceTypeChoice(O_.SELECT_EXISTING_SEQUENCE,"Choose a plasmid from your Benchling folders"),this.renderVectorSourceTypeChoice(O_.CREATE_FROM_FILE,"Upload a new plasmid"),(()=>{switch(this.props.vectorSourceType){case O_.SELECT_VECTOR:return d.createElement(VectorSelector,{assemblyCid:this.props.assemblyCid,vectorSelectorState:this.props.vectorSelectorState,vectorLoading:this.props.vectorLoading,vectors:this.props.vectors})
case O_.CREATE_FROM_FILE:return d.createElement(FileInput,{assemblyCid:this.props.assemblyCid,fileInputState:this.props.fileInputState})
case O_.SELECT_EXISTING_SEQUENCE:return d.createElement(ExistingSequenceInput,{assemblyCid:this.props.assemblyCid,existingSequenceInputState:this.props.existingSequenceInputState})
default:return null}})()))),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{className:"text-right",sm:4},d.createElement(Je.Z,null,"Assembly Method")),d.createElement(p.Z,{sm:8},"Type IIS Cloning"))),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{className:"text-right",sm:4},d.createElement(Je.Z,{className:"u-input-line-height"},"Insertion Region")),d.createElement(p.Z,{sm:4,lg:3},this.renderInsertionRegionInput("start","Start")),d.createElement(p.Z,{sm:4,lg:3},this.renderInsertionRegionInput("end","End"))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:4},null),d.createElement(p.Z,{sm:8,lg:6},d.createElement("p",{className:"help-block"},null==this.selectedSequence()?"Select a vector.":null==this.props.biojsSequence?"Loading...":null==this.props.enzyme?"Distinct type IIS enzyme cutsites were not found at the specified start and end.":`Assembly will generate primers that can be annealed and ligated           into the plasmid after digestion with ${this.props.enzyme.get("name")}.`)))),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,className:"pull-right",disabled:this.props.finalizingSelectedVector||null==this.props.enzyme,text:this.props.vectorLoading?"Loading...":"Next",onClick:e=>{let t
e.preventDefault()
S_.finalizeSelectedVector(this.props.assemblyCid)
const{vector:n}=this.props.vectorSelectorState
t=this.props.vectorSourceType===O_.SELECT_VECTOR&&null!=n?{addgeneId:n.addgeneId,name:n.sequence.name}:null
m.j("crispr","selected_assembly_vector",t)}}))}}const __=SelectVectorStep
function SelectVectorStep_guard_(e,t){return null!=e?t(e):void 0}const{ASSEMBLY_STEP:D_}=gi
class CRISPRAssemblyOptions extends d.Component{render(){return d.createElement("ul",{className:"nav navbar-nav form-inline"})}}class CRISPRAssemblyOptionsView extends s().View{static initClass(){this.prototype.className="navbar"}render(){(0,Me.A9)(d.createElement(CRISPRAssemblyOptions,null),this.el)
return this}}CRISPRAssemblyOptionsView.initClass()
class CRISPRAssemblyTabConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[g_.Z]}enhanceProps(){return{...this.crisprAssemblyStore().getAssemblyState(this.props.assemblyCid),...this.crisprAssemblyStore().getState()}}}class CRISPRAssemblyTab extends d.Component{render(){return d.createElement("div",null,(()=>{switch(this.props.step){case D_.SELECT_VECTOR:return d.createElement(__,{assemblyCid:this.props.assemblyCid,vectors:this.props.vectors,vectorLoading:this.props.vectorLoading,biojsSequence:this.props.biojsSequence,enzyme:this.props.enzyme,existingSequenceInputState:this.props.existingSequenceInputState,fileInputState:this.props.fileInputState,finalizingSelectedVector:this.props.finalizingSelectedVector,insertionRegion:this.props.insertionRegion,vectorSelectorState:this.props.vectorSelectorState,vectorSourceType:this.props.vectorSourceType})
case D_.FINALIZE_ASSEMBLIES:return d.createElement(C_,{analysis:this.props.analysis,assemblyCid:this.props.assemblyCid,assemblies:this.props.assemblies,assembliesFolder:this.props.assembliesFolder,finalizingAssemblies:this.props.finalizingAssemblies})
case D_.COMPLETED_ASSEMBLY:return d.createElement(b_,{assemblyCid:this.props.assemblyCid,assemblyPrimers:this.props.assemblyPrimers,sequenceName:this.props.sequenceName})
default:return null}})())}}const L_=CRISPRAssemblyTabConnector.connect(CRISPRAssemblyTab)
class CRISPRAssemblyTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab-reset"}render(){(0,Me.A9)(d.createElement(L_,{assemblyCid:this.model.assemblyCid(),sequenceName:this.model.sequenceName()}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}CRISPRAssemblyTabView.initClass()
var k_=n(84941),M_=n(195300)
const GuidePrimerModal=e=>{const{numSelectedGuides:t,onRequestClose:n,onRequestSubmit:a,hasRNAOligoSchemas:i,hasDNAOligoSchemas:s}=e,[r,o]=(0,d.useState)(null),[l,c]=(0,d.useState)(R.Wy.DNA),[u,m]=(0,d.useState)(void 0),p={autoFocus:!1,ids:[],refreshOptions:{},worklistType:Po.FN.BIOENTITY},h=(0,xx.y)(p),g=e.designType===gi.DESIGN_TYPE.PAIRED
return d.createElement(et.ZP,{title:`Save ${t} ${de._6(t,"Guide")} as\n        ${de._6(t,"Oligo")}`,onRequestClose:n,onRequestSubmit:()=>{(async()=>{const t=await Promise.resolve(e.saveGuidePrimers(r,l,u))
t&&!h.isDisabled&&h.addItems(t.primers.map((e=>e.primer_api_id)))})()
a(!0)},buttons:[{text:"Save",submit:!0,disabled:!r}]},d.createElement(Ke.Z,null,d.createElement(Je.Z,{required:!0},"Location"),d.createElement(Ye.Z,{enableRedesign:!0,showInventory:!0,value:r,onChange:e=>{o(e.target.value)},unsetOnFetchFail:!0})),d.createElement(Ke.Z,null,d.createElement(Je.Z,{required:!0},"Nucleotide Type"),g?d.createElement("p",null,"Primer pairs can only be saved as DNA Oligos"):void 0,d.createElement(kt.Z,{options:[{id:R.Wy.DNA,buttonProps:{text:"DNA"}},{id:R.Wy.RNA,buttonProps:{text:"RNA"}}],disabled:g,selection:l,onChangeSelection:e=>{c(e)
e!==l&&m(void 0)},size:C.qE.SMALL,isFullWidth:!0})),(l===R.Wy.RNA&&i||l===R.Wy.DNA&&s)&&d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Schema"),d.createElement(Ho.ZP,{allowNone:!0,oligoAwareFolderItemTypes:l===R.Wy.DNA?[st.SequenceSubtype.DNA_OLIGO]:[st.SequenceSubtype.RNA_OLIGO],onChange:e=>{m(e?e.id:void 0)},selectedTagSchemaId:u})),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Add to Worklist (optional)"),d.createElement(xx.Z,{...h,...p})))}
const F_=function QueryingGuidePrimerModal(e){return d.createElement(Da.ZP,{query:$o._,renderLoading:()=>null},(t=>{function hasOligoSchemas(e){return(0,Wo.Z)((0,zo.NA)("TagSchema",t.tagSchemas),{oligoAwareFolderItemTypes:e}).length>0}return d.createElement(GuidePrimerModal,{...e,hasRNAOligoSchemas:hasOligoSchemas([st.SequenceSubtype.RNA_OLIGO]),hasDNAOligoSchemas:hasOligoSchemas([st.SequenceSubtype.DNA_OLIGO])})}))}
class GuideGroupTable extends d.Component{constructor(){super(...arguments)
this.getSelectedGuides=()=>l.default.flatten(this.getSortedGuideGroups(this.props.guideGroups.filter((e=>this.isGuideGroupSelected(e)))),!0)
this.getSortedGuideGroups=e=>{const t=l.default.chain(e).sortBy(this.groupPosition).sortBy(this.props.getSortIteratee()).value()
this.props.guideGroupSort.reverse&&t.reverse()
return t}
this.groupPosition=e=>Math.min(...e.map((e=>this.props.getGuidePosition(e))))
this.selectedGuidesToTSV=()=>this.props.guidesToTSV(this.getSelectedGuides())
this.allGuidesToTSV=()=>this.props.guidesToTSV(l.default.flatten(this.getSortedGuideGroups(this.props.guideGroups),!0))
this.notifyGuidesTSVCopied=e=>{v.ZP.success(`${(0,Mt.kC)(e)} guides have been copied in tab-delimited format,\n      which can be pasted into Excel.`,{duration:6,id:`${e}-guides-copied`})}
this.isGuideGroupSelected=e=>Ur.Z.isGuideGroupSelected(this.props.selectedGuideGroups,e)
this.selectGuideGroups=(e,t)=>{Vr.Z.toggleSelectedGuideGroups(this.props.analysis.id,e,t.target.checked)}
this.sortGuideGroups=e=>{this.props.guideGroupSort.key===e?Vr.Z.updateGuideGroupSort(this.props.analysis.id,{reverse:!this.props.guideGroupSort.reverse}):Vr.Z.updateGuideGroupSort(this.props.analysis.id,{key:e,reverse:-1!==[gi.SORT_KEY.SPECIFICITY_SINGLE,gi.SORT_KEY.SPECIFICITY_PAIR,gi.SORT_KEY.EFFICIENCY].indexOf(e)})}
this.guideToPrimer=e=>({start:fi.guideStart(e,this.props.sequence.length,this.props.analysis.isLeftPam),end:fi.guideEnd(e,this.props.sequence.length,this.props.analysis.isLeftPam),strand:e.strand})
this.guideGroupSelectionRange=e=>{if(1===e.length)return(0,he.Z)(this.guideToPrimer(e[0]),"start","end");(0,S.hu)(2===e.length,"expected guideGroup to have length 2")
const t=l.default.min([e,[e[1],e[0]]],(([e,t])=>{const n=fi.guideStart(e,this.props.sequence.length,this.props.analysis.isLeftPam)
if(!this.props.sequence.circular)return n
const a=fi.guideEnd(t,this.props.sequence.length,this.props.analysis.isLeftPam)
return-1*T.distance(n,a,this.props.sequence.length,!0)}))
t[1]&&t[0]||Fe.vU("Forward or reverse guide is undefined in paired guide table",{extra:{guideGroup:e}})
return{start:fi.guideStart(t[0],this.props.sequence.length,this.props.analysis.isLeftPam),end:fi.guideEnd(t[1],this.props.sequence.length,this.props.analysis.isLeftPam)}}
this.guideGroupClickHandler=(e,t)=>{const{start:n,end:a}=this.guideGroupSelectionRange(e)
this.props.setSelection(n,a)}
this.analyticsTrackSavedGuides=e=>{m.j("crispr","saved_guides",{crispr_analysis_id:this.props.analysis.id,nucleotide_type:R.Wy.DNA,num_guides:e,save_destination:"clipboard",sequence_id:this.props.sequence.id})}
this.isGuideGroupActive=e=>Is()(this.guideGroupSelectionRange(e),this.props.selection)
this.isSavedPrimer=e=>e.every((e=>Boolean(l.default.findWhere(this.props.sequencePrimers,this.guideToPrimer(e)))))
this.getNumSelectedGuides=()=>l.default.size(this.props.selectedGuideGroups)*this.props.guideGroupSize
this.runGuidePrimerModal=async()=>{const e={numSelectedGuides:this.getNumSelectedGuides(),designType:this.props.analysis.designType,saveGuidePrimers:(e,t,n)=>this.props.saveGuidePrimers(e,t,n).done((()=>{m.j("crispr","saved_guides",{crispr_analysis_id:this.props.analysis.id,nucleotide_type:t,num_guides:this.getNumSelectedGuides(),save_destination:"benchling",sequence_id:this.props.sequence.id})}))}
await(0,Xn.Z)(F_,e)&&Vr.Z.toggleSelectedGuideGroups(this.props.analysis.id,this.props.guideGroups,!1)}
this.renderColumnNode=(e,t,n,a)=>{const i={[(0,g.iv)(B_.headerCell)]:!0,[(0,g.iv)(B_.sortable)]:null!=e,"u-no-text-decoration":!0,columnNodeHeader:!0,"u-dotted-underline":Boolean(a)},s=a?f()(a.helpClassName,i):f()(i)
return d.createElement("span",{className:s,onClick:()=>{e&&this.sortGuideGroups(e)}},t,n?d.createElement("span",null,d.createElement("br",null),n):null,(()=>this.props.guideGroupSort.key===e?d.createElement("span",null," ",d.createElement(pe.Z,{icon:this.props.guideGroupSort.reverse?"chevron-down":"chevron-up"})):null)())}
this.renderColumnNodeWithHelp=(e,t,n,a)=>d.createElement(Oe.Z,{placement:ne.ZH.TOP,renderContent:()=>d.createElement("div",{className:a.helpClassName},a.content),title:a.title},this.renderColumnNode(e,t,n,a))
this.renderColumnHeader=(e,t,n,a,i)=>d.createElement("th",{className:"u-no-select text-left",key:e},d.createElement("span",null,(()=>i?this.renderColumnNodeWithHelp(t,n,a,i):this.renderColumnNode(t,n,a))()))
this.renderEmptyTable=()=>d.createElement("tbody",null,d.createElement("tr",{className:"faded"},d.createElement("td",{colSpan:6},"No guides found in target regions.")))
this.renderSingleGuidesTable=e=>d.createElement("tbody",{...(0,ee.Z)({component:"GuideGroupTable",element:"root",key:"single"})},e.map((e=>{const t=Ur.Z.guideGroupKey(e)
return this.props.guideGroupComponentsMap[t].map((n=>d.createElement("tr",{key:`${t}`,className:f()({"crispr-guidesTable-row":!0,active:this.isGuideGroupActive(e),success:this.isSavedPrimer(e)}),onClick:t=>{this.guideGroupClickHandler(e,t)},...(0,ee.Z)({component:"GuideGroupTable",element:"row",key:"single"})},d.createElement("td",{rowSpan:this.props.guideGroupSize,key:"checkbox"},d.createElement("input",{type:"checkbox",checked:this.isGuideGroupSelected(e),onChange:t=>{this.selectGuideGroups([e],t)}})),n)))})))
this.renderMultipleGuidesTable=e=>e.map((e=>{const t=Ur.Z.guideGroupKey(e)
return d.createElement("tbody",{className:"crispr-guidesTable-multiple",key:t,...(0,ee.Z)({component:"GuideGroupTable",element:"root",key:"multiple"})},(()=>this.props.guideGroupComponentsMap[t].map(((n,a)=>d.createElement("tr",{key:`${t}-${a}`,className:f()({"crispr-guidesTable-row":!0,active:this.isGuideGroupActive(e),success:this.isSavedPrimer(e)}),onClick:t=>{this.guideGroupClickHandler(e,t)},...(0,ee.Z)({component:"GuideGroupTable",element:"row",key:"multiple"})},(()=>0===a?d.createElement("td",{rowSpan:this.props.guideGroupSize,key:"checkbox"},d.createElement("input",{type:"checkbox",checked:this.isGuideGroupSelected(e),onChange:t=>{this.selectGuideGroups([e],t)}})):null)(),n))))())}))}componentDidUpdate(e){Is()(e.selectedGuideGroups,this.props.selectedGuideGroups)||this.props.showGuidePrimers(this.getSelectedGuides())}render(){const e=this.getSortedGuideGroups(this.props.guideGroups),t=Math.floor(100/this.props.guideGroupSize),n=this.props.guideGroupSort.offset,a=Math.min(this.props.guideGroupSort.offset+t,this.props.guideGroups.length),i=e.slice(n,a),s=n-t,r=n+t,o=s<0,l=r>=this.props.guideGroups.length,c=null!=Jn.Z.currentUser()
return d.createElement("div",null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},this.props.guidesToTSV&&d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},d.createElement(N.Z,{isDisabled:0===this.getNumSelectedGuides(),onSelect:()=>{const e=this.selectedGuidesToTSV();(0,$b.Z)(e,{showToastOnSuccess:!1})
this.notifyGuidesTSVCopied("selected")
this.analyticsTrackSavedGuides(this.getNumSelectedGuides())}},"Export Selected (.tsv)"),d.createElement(N.Z,{onSelect:()=>{const e=this.allGuidesToTSV();(0,$b.Z)(e,{showToastOnSuccess:!1})
this.notifyGuidesTSVCopied("all")
this.analyticsTrackSavedGuides(this.props.guideGroups.length)}},"Export All (.tsv)"))},d.createElement(C.Co,{className:"u-tiny-spacing-right",isDropdown:!0,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:"Export"})),c&&d.createElement(d.Fragment,null,d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,className:"u-tiny-spacing-right",type:"button",disabled:0===this.getNumSelectedGuides(),onClick:()=>this.runGuidePrimerModal(),text:"Save"}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,className:"u-tiny-spacing-right",type:"button",disabled:0===this.getNumSelectedGuides(),onClick:()=>this.props.openAssemblyTab(this.props.analysis,this.getSelectedGuides()),text:"Assemble"})),d.createElement("span",{className:"faded u-input-line-height"}," ",`${this.getNumSelectedGuides()} selected`," ")),d.createElement(p.Z,{className:"text-right",sm:6},d.createElement("span",{className:"faded u-input-line-height u-small-spacing-right"},n*this.props.guideGroupSize+1+"-"+a*this.props.guideGroupSize+" of "+this.props.guideGroups.length*this.props.guideGroupSize),d.createElement("div",{className:"resultsPager u-input-line-height"},d.createElement("ul",{className:"pager"},d.createElement("li",{className:f()({disabled:o,"u-tiny-spacing-right":!0})},(()=>o?d.createElement("span",null,"Prev"):d.createElement("a",{onClick:()=>{Vr.Z.updateGuideGroupSort(this.props.analysis.id,{offset:s})}},"Prev"))()),d.createElement("li",{className:f()({disabled:l})},(()=>l?d.createElement("span",null,"Next"):d.createElement("a",{onClick:()=>{Vr.Z.updateGuideGroupSort(this.props.analysis.id,{offset:r})}},"Next"))()))))),d.createElement("table",{className:f()("table",this.props.tableClassName)},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",{key:"checkbox"},d.createElement(sw.Z,{items:i,selectedMap:this.isGuideGroupSelected,onChange:e=>{this.selectGuideGroups(i,e)}})),(()=>this.props.columns.map((e=>{const t=e.sortKey||`column-${e.header}`
return this.renderColumnHeader(t,e.sortKey,e.header,e.extraHeader,e.help)})))())),(()=>0===i.length?this.renderEmptyTable():1===this.props.guideGroupSize?this.renderSingleGuidesTable(i):this.renderMultipleGuidesTable(i))()))}}const Z_=GuideGroupTable,B_=g.mM.create({headerCell:{color:Vt.t0,":hover":{color:Vt.Ej}},sortable:{cursor:"pointer"}})
function getForwardStrandEditScores(e,t){const n=fi.guideStart(e,t.length),a=e.bases.split("").map(((a,i)=>{if(a.toUpperCase()===gi.FORWARD_STRAND_EDITABLE_BASE){const a=function getUpstreamBase(e,t,n){return 0===e&&1===t||e===n.length-1&&-1===t?"x":1===t?n.bases[e-1]:y.revcomp(n.bases[e+1],R.jb)}(1===e.strand?n+i:n+e.bases.length-i-1,e.strand,t)
return function getEditScore(e,t){return"x"===e?-1:{g:[.2,.4,.5,.8,4.6,13.4,17,2.8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],c:[.5,11,5.7,9.3,20.3,21.4,22.4,8.7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],a:[.8,2.5,5.6,11.6,21.9,13.5,19,6.8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],t:[4.1,6.4,16,21.7,24.2,26.6,25.2,25.4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]}[e.toLowerCase()][t]}(a,i)}return-1}))
return-1===e.strand?a.reverse():a}function getOverlappingTranslationsForGuide(e,t){return t.translations.filter((n=>T.isRangeOverlap(fi.guideStart(e,t.length),fi.guideEnd(e,t.length),n.start,n.end)))}function BaseEditUtil_hasInvalidOverlappingTranslations(e,t){const n=getOverlappingTranslationsForGuide(e,t)
if(0===n.length)return!1
if(n.length>1)return!0
const{strand:a,start:i,end:s}=n[0]
return-1===a||T.isWrap(i,s)}function getForwardStrandEditedBase(e,t){1===t?(0,S.hu)(e.toUpperCase()===gi.FORWARD_STRAND_EDITABLE_BASE,`Cannot edit base ${e} on forward strand.`):(0,S.hu)(e.toUpperCase()===y.revcomp(gi.FORWARD_STRAND_EDITABLE_BASE,R.jb),`Cannot edit base ${e} on reverse strand.`)
return{g:"a",G:"A",c:"t",C:"T"}[e]}class BaseEditNewSequence extends d.Component{constructor(){super(...arguments)
this.getIndexInCDS=(e,t)=>this.getNumCDSBasesBeforeTranslation(e)+t
this.getEditedBase=(e,t)=>{const n=e-fi.guideStart(this.props.guide,this.props.sequence.length),a=this.props.sequence.bases[e]
return n>=0&&n<t.length&&t[n]>0?getForwardStrandEditedBase(a,this.props.guide.strand):a}
this.getTranslationLength=e=>e.end-e.start
this.getIntersectingCodonsRange=(e,t,n,a)=>{const i=e.start-t%3
let s,r,o=Math.min(a,e.end)+T.mod(i-Math.min(a,e.end),3)
if(o>e.end){const t=this.getSortedTranslationsInGroup(e),n=t.indexOf(e)
t.slice(n+1,t.length).reduce(((e,t)=>e+t),0)<o-e.end&&(o-=3)}s=n<i?i:n-(n-i)%3
r=a>o?o:(o-a)%3==0?a:a+(o-a)%3
return{codonsStart:s,codonsEnd:r}}
this.getSortedTranslationsInGroup=e=>e.translationGroupId?l.default.chain(this.props.sequence.translations).filter((t=>t.translationGroupId===e.translationGroupId)).sortBy((e=>e.start)).value():[e]
this.getSortedUpstreamTranslationsInGroup=e=>this.getSortedTranslationsInGroup(e).filter((t=>t.end<=e.start))
this.getNumCDSBasesBeforeTranslation=e=>this.getSortedUpstreamTranslationsInGroup(e).reduce(((e,t)=>e+this.getTranslationLength(t)),0)
this.handleOnClickAminoAcid=(e,t,n)=>{this.props.setSelection(t,n)
e.stopPropagation()}
this.renderBaseInGuide=(e,t)=>{const n=fi.getForwardStrandBases(this.props.guide)[e]
return t[e]>0?d.createElement("span",{className:"baseEdit-guidesTable-base-edited",key:e},getForwardStrandEditedBase(n,this.props.guide.strand)):d.createElement("span",{key:e},n)}
this.renderNewSequenceNoCodons=e=>{const t=getForwardStrandEditScores(this.props.guide,this.props.sequence)
return d.createElement("div",{className:f()("mono text-left",{"baseEdit-guidesTable-unsupported":e})},l.default.range(this.props.guide.bases.length).map((e=>this.renderBaseInGuide(e,t))))}
this.renderSequenceSegment=(e,t,n)=>{if(e>=t)return null
const a=fi.guideStart(this.props.guide,this.props.sequence.length),i=fi.guideEnd(this.props.guide,this.props.sequence.length),s=getForwardStrandEditScores(this.props.guide,this.props.sequence),r=this.props.sequence.bases.slice(e,t),o=r.split("").map(((t,n)=>{const a=e+n
return this.getEditedBase(a,s)})).join("")
return d.createElement("div",{className:"baseEdit-guidesTable-sequenceSegment",key:`segment-${e}`,onClick:n=>{this.handleOnClickAminoAcid(n,e,t)}},d.createElement("div",{key:"bases"},o.split("").map(((t,s)=>{const o=`bases-${s}`,l=e+s
return n&&(l<n.start||n.end<=l)?d.createElement("span",{key:o}," "):l<a||i<=l?d.createElement("span",{key:o,className:"baseEdit-guidesTable-base-notInGuide"},t):t!==r[s]?d.createElement("span",{key:o,className:"baseEdit-guidesTable-base-edited"},t):d.createElement("span",{key:o},t)}))),d.createElement("div",{key:"aminoAcids"},(()=>{if(!n)return null
const t=this.getSortedTranslationsInGroup(n).reduce(((e,t)=>e+this.props.sequence.bases.slice(t.start,t.end)),""),a=r.split("").map(((a,i)=>{const s=e+i,r=this.getIndexInCDS(n,s-n.start);(0,S.hu)(0<=r&&r<t.length,"")
return t[r]})).join(""),i=r.split("").map(((a,i)=>{const r=e+i,o=this.getIndexInCDS(n,r-n.start);(0,S.hu)(0<=o&&o<t.length,"")
return r<n.start||n.end<=r?t[o]:this.getEditedBase(r,s)})).join(""),o=y.translate(a,R.Wy.DNA,R.hR.STANDARD),l=y.translate(i,R.Wy.DNA,R.hR.STANDARD)
return d.createElement("span",{className:f()({"baseEdit-guidesTable-aminoAcid-edited":o!==l})}," ",l," ")})()))}
this.renderSequenceWithTranslation=()=>{const e=getOverlappingTranslationsForGuide(this.props.guide,this.props.sequence)[0],t=fi.guideStart(this.props.guide,this.props.sequence.length),n=fi.guideEnd(this.props.guide,this.props.sequence.length),{codonsStart:a,codonsEnd:i}=this.getIntersectingCodonsRange(e,this.getNumCDSBasesBeforeTranslation(e),t,n),s=[]
let r=a
for(;r<i;){s.push([r,r+3])
r+=3}const o=Math.min(t,a)
return d.createElement("div",{className:"mono baseEdit-guidesTable-flexContainer"},this.renderSequenceSegment(o,e.start,null),s.map((t=>{const[n,a]=t
return this.renderSequenceSegment(n,a,e)})),this.renderSequenceSegment(e.end,n,null))}}render(){const e=BaseEditUtil_hasInvalidOverlappingTranslations(this.props.guide,this.props.sequence),t=getOverlappingTranslationsForGuide(this.props.guide,this.props.sequence)
return e||0===t.length?this.renderNewSequenceNoCodons(e):this.renderSequenceWithTranslation()}}const q_=BaseEditNewSequence
var V_=n(897100),U_=n(794003),G_=n(487585)
const{MAX_OFF_TARGET_GUIDE_LENGTH:z_,OFF_TARGET_SCORE_TYPE:$_,URLS:W_}=gi,H_="asc",j_="desc",Y_="score",Q_="gene",K_="pam",J_="locus"
class OffTargetModal extends d.Component{constructor(){super(...arguments)
this.state={sortKey:Y_,sortOrder:j_,exons:null}
this.getDisplayPosition=e=>T.modelStartToDisplay(e.position,1)
this.getStrandSymbol=e=>1===e.strand?"+":"-"
this.getGeneName=e=>null==e.exon?null:G_.geneToName({name:e.exon.geneName,ensemblId:e.exon.geneEnsemblId})
this.getLocus=e=>`${e.chromosomeName}:${this.getStrandSymbol(e)}${this.getDisplayPosition(e)}`
this.getMismatches=e=>{const t=e.bases.toUpperCase(),n=this.props.guide.bases.toUpperCase(),a={}
for(let i=0,s=e.bases.length,r=0<=s;r?i<s:i>s;r?i++:i--)t[i]!==n[i]&&(a[i]=!0)
return a}
this.getSortableChromosomeName=e=>Number.isNaN(e.chromosomeName)?e.chromosomeName:`0000${e.chromosomeName}`.slice(-4)
this.getSortablePAM=(e,t)=>t.pam.slice(e)
this.isOnTarget=e=>null!=this.props.region.genomeRegionChromosome&&(this.props.region.genomeRegionChromosome.name===e.chromosomeName&&(this.props.region.genomeRegionStart<=e.position&&e.position<this.props.region.genomeRegionEnd))
this.sitesToTSV=e=>{const t=e.map((e=>[e.bases,e.pam,e.score,null!=e.exon?e.exon.geneEnsemblId:void 0,e.chromosomeName,e.strand,this.getDisplayPosition(e),l.default.size(this.getMismatches(e)),Boolean(this.isOnTarget(e))].join("\t")))
return["Sequence\tPAM\tScore\tGene\tChromosome\tStrand\tPosition\tMismatches\tOn-target"].concat(t).join("\n")}
this.sortSites=e=>{this.state.sortKey===e?this.setState({sortOrder:this.state.sortOrder===H_?j_:H_}):this.setState({sortKey:e,sortOrder:e===K_?j_:H_})}
this.renderSiteSequence=e=>{const t=this.getMismatches(e)
return Array.from(e.bases).map(((e,n)=>d.createElement("span",{key:n,className:f()({mismatch:t[n]})},e)))}
this.renderColumnHeader=(e,t)=>d.createElement("th",{className:"u-no-select"},d.createElement("a",{className:"u-no-text-decoration",onClick:()=>{this.sortSites(e)}},t,this.state.sortKey===e?d.createElement(pe.Z,{icon:this.state.sortOrder===H_?"chevron-up":"chevron-down"}):void 0))
this.renderOffTargetScoreText=()=>{switch(this.props.analysis.offTargetScoreType){case $_.MIT:return d.createElement("p",null,"Our scoring calculation follows the method from ",d.createElement("a",{href:W_.HSU_OFF_TARGET_PAPER,rel:"noopener noreferrer",target:"_blank"},"Hsu et al., 2013"),".")
case $_.CFD:return d.createElement("p",null,"Our scoring calculation uses the Cutting Frequency Determination (CFD) score from ",d.createElement("a",{href:W_.CFD_SCORE_PAPER,rel:"noopener noreferrer",target:"_blank"},"Doench, Fusi et al. (2016).")," Scores above 20 indicate a high probability of off-target effects at that site.")
default:throw new Error("Unexpected off-target score type.")}}}componentDidMount(){this.matchExonsPromise=(0,V_.Z)(Promise.resolve(U_.Z.matchExons(this.props.region.id,this.props.guide.sites)))
this.matchExonsPromise.promise.then((({data:e})=>{this.setState({exons:e})})).catch((e=>{e.isCanceled||v.ZP.notifyError(e)}))}componentWillUnmount(){this.matchExonsPromise.cancel()}render(){let{sites:e}=this.props.guide
null!=this.state.exons&&(e=l.default.map(l.default.zip(e,this.state.exons),((...e)=>{const[t,n]=Array.from(e[0])
return Q()(t,{$merge:{exon:n}})})))
let t=0
for(;"N"===this.props.analysis.pam[t];)t++
let n=l.default.chain(e)
n=(()=>{switch(this.state.sortKey){case K_:return n.sortBy("score").sortBy((e=>this.getSortablePAM(t,e)))
case Y_:return n.sortBy("score")
case Q_:return n.sortBy(this.getGeneName)
case J_:return n.sortBy("position").sortBy(this.getSortableChromosomeName)
default:throw new Error("Unexpected sort key")}})()
const a=n.value()
this.state.sortOrder===j_&&a.reverse()
return d.createElement(et.ZP,{enableRedesign:!0,large:!0,title:"Off-Target Sites",onRequestClose:this.props.onRequestClose,wrapInForm:!1},d.createElement("div",{className:"text-right u-small-spacing-bottom"},d.createElement(bt.Z,{value:this.sitesToTSV(a),notifyCopied:()=>{v.ZP.success("Off-targets have been copied in tab-delimited format, which can be pasted                  into Excel.",{duration:6,id:"off-targets-copied"})}},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:"Copy TSV"}))),d.createElement("div",{className:"offtarget-table-container"},d.createElement("table",{className:"table table-condensed table-hover offtarget-table"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Sequence"),this.renderColumnHeader(K_,"PAM"),this.renderColumnHeader(Y_,"Score"),this.renderColumnHeader(Q_,d.createElement("span",null,"Gene",null==this.state.exons?d.createElement("span",{className:"faded"}," (Loading...)"):void 0)),this.renderColumnHeader(J_,"Cut Locus"))),d.createElement("tbody",{className:"selectable"},(()=>{const e=[]
for(const t of Array.from(a))e.push(d.createElement("tr",{key:`site-${t.position}-${t.strand}`,className:f()({faded:this.isOnTarget(t)})},d.createElement("td",null,this.renderSiteSequence(t)),d.createElement("td",null,t.pam),d.createElement("td",null,t.score.toFixed(1)),d.createElement("td",null,this.getGeneName(t)),d.createElement("td",null,this.getLocus(t))))
return e})()))),!this.props.analysis.isLeftPam&&this.renderOffTargetScoreText(),(()=>{switch(this.props.analysis.pam){case"NGG":case"NAG":return d.createElement("p",null,"For SpCas9, we include off-target matches for NAG and NGG since both have measurable\n                    efficiency (",d.createElement("a",{href:W_.NGG_PAM,rel:"noopener noreferrer",target:"_blank"},W_.NGG_PAM),").")
case"NNGRRT":return d.createElement("p",null,"For the NNGRRT PAM, we include off-target matches for NNGRR instead, which has been shown\n                    to have measurable efficiency across both (",d.createElement("a",{href:W_.NNGRRT_PAM,rel:"noopener noreferrer",target:"_blank"},W_.NNGRRT_PAM),").")
default:return null}})(),this.props.guide.bases.length>z_?d.createElement("p",null,d.createElement(pe.Z,{className:"u-warning-color",icon:"warning"}),` The off-target analysis only takes into account the ${z_} bp closest\n              to PAM.`):void 0)}}function OffTargetScore({type:e,offTargetWarning:t}){switch(e){case gi.OFF_TARGET_SCORE_TYPE.MIT:return d.createElement("div",null,d.createElement("a",{href:gi.URLS.HSU_OFF_TARGET_PAPER,target:"_blank",rel:"noopener noreferrer"},"Specificity score")," ","from Hsu et al. (2013).",t,d.createElement("br",null),d.createElement("br",null),"Score is from 0-100. Higher is better.")
case gi.OFF_TARGET_SCORE_TYPE.CFD:return d.createElement("div",null,"Cutting frequency determination (CFD) score from",d.createElement("a",{href:gi.URLS.CFD_SCORE_PAPER,target:"_blank",rel:"noopener noreferrer"},"Doench, Fusi et al. (2016)."),d.createElement("br",null),d.createElement("br",null),"Score is from 0-100. Higher is better.")
default:throw new Error(`Unexpected off target score type: ${e}`)}}function BaseEditScore(){return d.createElement("div",null,"Base edit score is determined by the efficiency of BE1 activity in vitro using an NGG PAM",d.createElement("a",{href:"http://www.nature.com/nature/journal/v533/n7603/full/nature17946.html",target:"_blank",rel:"noopener noreferrer"},"(Komor et al., Nature, 2016, Fig 2b)"),".")}class BaseEditGuideGroupTable extends d.Component{constructor(){super(...arguments)
this.state={offTargetModalGuide:null}
this.getColumnSpec=()=>{const e={title:"Off-Target Score",content:d.createElement(OffTargetScore,{type:gi.OFF_TARGET_SCORE_TYPE.MIT})},t={title:"Base-editing scores",content:d.createElement(BaseEditScore,null)},n={title:"Base Edited DNA",content:"Red bases designate edited bases, and gray bases designate bases that fall outside of the\n          protospacer region."}
return[{sortKey:gi.SORT_KEY.POSITION,header:"Position"},{header:"Guide Strand",help:{title:"sgRNA Sequence Strand",content:"Denotes the strand the guide occurs on. Note that the guide is always displayed in terms of its forward strand bases for consistency with the translations displayed in the table."}},{header:"Base Edited DNA",help:n},{sortKey:gi.SORT_KEY.NUM_BASE_EDITS,header:"# Edits"},{sortKey:gi.SORT_KEY.BASE_EDIT_SCORES,header:"Base-editing Scores",help:t},{sortKey:gi.SORT_KEY.SPECIFICITY_SINGLE,header:"Off‑Target",extraHeader:"Score",help:e}]}
this.getEditScores=e=>getForwardStrandEditScores(e,this.props.sequence).filter((e=>e>0))
this.getNumEdits=e=>this.getEditScores(e).length
this.getGuideGroupComponentsMap=()=>{const e={}
this.props.guideGroups.forEach((t=>{const n=t[0]
e[Ur.Z.guideGroupKey(t)]=[[d.createElement("td",{className:"text-left",key:"position"},T.modelStartToDisplay(this.getGuidePosition(n),this.props.sequence.startIndex)),d.createElement("td",{className:"mono text-left",key:"strand"},fi.renderStrand(n)),d.createElement("td",{key:"bases"},d.createElement(q_,{guide:n,sequence:this.props.sequence,setSelection:this.props.setSelection})),d.createElement("td",{className:"text-left",key:"numEdits"},this.getNumEdits(n)),d.createElement("td",{className:"text-left",key:"baseEditScores"},this.renderEditScores(n)),d.createElement("td",{className:"text-left",key:"offTargetScore"},this.renderOffTargetScore(n))]]}))
return e}
this.getGuidePosition=e=>fi.guideStart(e,this.props.sequence.length)
this.getMaxBaseEditScore=e=>l.default.max(this.getEditScores(e))
this.getSortIteratee=()=>e=>{const t=e[0];(0,S.hu)(1===e.length,"expected guide group to have length 1")
const n=this.props.guideGroupSort.key
switch(n){case gi.SORT_KEY.POSITION:return this.getGuidePosition(t)
case gi.SORT_KEY.NUM_BASE_EDITS:return this.getNumEdits(t)
case gi.SORT_KEY.BASE_EDIT_SCORES:return this.getMaxBaseEditScore(t)
case gi.SORT_KEY.SPECIFICITY_SINGLE:return this.offTargetScore(t)
default:(0,S.Gp)(!1,`Unrecognized key in guide group sorting function: ${n}`)
return this.getGuidePosition(t)}}
this.getEditedForwardStrandBases=e=>{const t=fi.getForwardStrandBases(e),n=getForwardStrandEditScores(e,this.props.sequence)
return t.split("").map(((t,a)=>n[a]>0?getForwardStrandEditedBase(t,e.strand):t)).join("")}
this.guidesToTSV=e=>{const t=[["Position","Guide","Guide Strand","Edited 5'->3' Sequence","Edit Scores","Efficiency Score"].join("\t")],n=e.map((e=>[T.modelStartToDisplay(this.getGuidePosition(e),this.props.sequence.startIndex),e.bases,e.strand,this.getEditedForwardStrandBases(e),this.renderEditScores(e),this.offTargetScore(e)].join("\t")))
return t.concat(n).join("\n")}
this.offTargetScore=e=>e.offTargetScore
this.showOffTargetModal=e=>{this.setState({offTargetModalGuide:e})}
this.renderEditScores=e=>this.getEditScores(e).map((e=>e.toFixed(1))).join(", ")
this.renderOffTargetScore=e=>{const t=this.offTargetScore(e),n=t?t.toFixed(1):null
return d.createElement("a",{onClick:()=>{this.showOffTargetModal(e)}},n)}}render(){(0,S.hu)(this.props.analysis.designType===gi.DESIGN_TYPE.BASE_EDIT,"Cannot render BaseEditGuideGroupTable with non base edit design type")
const e=l.default.extend({},this.props,{guideGroupComponentsMap:this.getGuideGroupComponentsMap(),columns:this.getColumnSpec(),tableClassName:"crispr-guidesTable",getGuidePosition:this.getGuidePosition,getSortIteratee:this.getSortIteratee,guidesToTSV:this.guidesToTSV}),t=this.props.guideGroups.some((e=>BaseEditUtil_hasInvalidOverlappingTranslations(e[0],this.props.sequence)))
return d.createElement("div",null,t?d.createElement("div",{className:"alert alert-warning"},"Guides underlined below overlap with unsupported translations and have been displayed without any translations. Unsupported cases include:",d.createElement("br",null),"(a) Translations on the reverse strand",d.createElement("br",null),"(b) Overlapping translations",d.createElement("br",null),"(c) Guides which effect multiple translations",d.createElement("br",null),"(d) Translations crossing the origin of a circular sequence"):null,(()=>this.state.offTargetModalGuide?d.createElement(OffTargetModal,{analysis:this.props.analysis,guide:this.state.offTargetModalGuide,onRequestClose:()=>{this.setState({offTargetModalGuide:null})},region:l.default.findWhere(this.props.analysis.regions,{id:this.state.offTargetModalGuide.regionId})}):null)(),d.createElement(Z_,{...e}))}}const X_=BaseEditGuideGroupTable
class RegenerateAnalysisPreview extends d.Component{constructor(){super(...arguments)
this.displayRegion=e=>`(${T.modelStartToDisplay(e.start,this.props.sequence.startIndex)}, ${0===e.end?"end":T.modelEndToDisplay(e.end,this.props.sequence.length,this.props.sequence.startIndex)})`
this.formatRegions=(e,t,n)=>{if(0===e.length)return null
const a=Array.from(e).map((e=>this.displayRegion(e))).join(", ")
return d.createElement("p",{className:n,key:t},`${de._6(e.length,"Target region")} ${a} will be ${t}.`)}}shouldComponentUpdate(e,t){return!e.regeneratingAnalysis}render(){const e=[],t=[]
for(const n of Array.from(this.props.regions))fi.canRegenerateRegion(n,this.props.sequence.length)?t.push(n):e.push(n)
return d.createElement("div",null,0===this.props.regions.length?d.createElement("p",{className:"u-primary-color"},"No target regions found in analysis. No changes will be made."):[this.formatRegions(e,"deleted","u-danger-color"),this.formatRegions(t,"kept","u-success-color")])}}class CRISPRAnalysisTabBlocked extends d.Component{constructor(){super(...arguments)
this.state={showRegenerateAnalysisPreview:!1}
this.regenerateAnalysis=()=>{Vr.Z.regenerateAnalysis(this.props.analysis,this.props.sequence,this.props.findGuidesParams)}}componentDidMount(){Vr.Z.fetchOriginalSequenceVersion(this.props.analysis.id)}UNSAFE_componentWillReceiveProps(e){null==this.props.originalSequenceVersion||Array.from(e.versionIds).includes(this.props.originalSequenceVersion.id)||Vr.Z.fetchOriginalSequenceVersion(this.props.analysis.id)}render(){return d.createElement("div",{className:"alert alert-warning"},d.createElement("p",null,"The sequence associated with this analysis has changed."),null!=this.props.originalSequenceVersion?d.createElement("p",null,"Please revert sequence to ",d.createElement("a",{className:"alert-link",onClick:()=>this.props.openSequenceVersion(this.props.originalSequenceVersion.id)},this.props.originalSequenceVersion.name)," to view this analysis, or regenerate analysis with current sequence."):d.createElement("p",null,"Regenerate analysis with current sequence to continue."),this.state.showRegenerateAnalysisPreview?d.createElement("div",{className:"u-tiny-spacing-top"},d.createElement(RegenerateAnalysisPreview,{regions:this.props.analysis.regions,regeneratingAnalysis:this.props.regeneratingAnalysis,sequence:this.props.sequence})):void 0,d.createElement("p",null,this.state.showRegenerateAnalysisPreview?d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,onClick:this.regenerateAnalysis,disabled:this.props.regeneratingAnalysis||!this.props.allowEdits,text:this.props.regeneratingAnalysis?"Regenerating analysis...":"Continue"}):d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,onClick:()=>{this.setState({showRegenerateAnalysisPreview:!0})},disabled:!this.props.allowEdits,text:"Regenerate Analysis"})))}}const eD=CRISPRAnalysisTabBlocked
function OnTargetScore({useAzimuthOnTargetScore:e,onTargetWarning:t}){return e?d.createElement("div",null,"Optimized score from"," ",d.createElement("a",{href:tD.CFD_SCORE_PAPER,target:"_blank",rel:"noopener noreferrer"},"Doench, Fusi et al. (2016)"),". This score is optimized for 20bp guides with NGG PAMs.",t,d.createElement("br",null),d.createElement("br",null),"Score is from 0-100. Higher is better."):d.createElement("div",null,d.createElement("a",{href:tD.DOENCH_ACTIVITY,target:"_blank",rel:"noopener noreferrer"},"Activity score")," ","from Doench et al. (2014). Requires 20 bp guides and is only available for Cas9.",d.createElement("br",null),d.createElement("br",null),"Score is from 0-100. Higher is better.")}const{URLS:tD,MAX_OFF_TARGET_GUIDE_LENGTH:nD,RECOMMENDED_AZIMUTH_ON_TARGET_GUIDE_LENGTH:aD,SORT_KEY:iD}=gi,{DOENCH_GUIDE_SIZE:sD}=Si.Z
class CRISPRGuideGroupTable extends d.Component{constructor(){super(...arguments)
this.state={offTargetModalGuide:null}
this.getGuideSequenceColumnSpec=()=>({header:"Guide Sequence",help:{title:"Guide Sequence Help",content:"Guide sequences are shown as DNA. When you save guides as oligos, you can elect to save your guides as DNA or RNA."}})
this.getOnTargetColumnSpec=()=>fi.isCas9Pam(this.props.analysis.pam)&&this.props.analysis.guideLength>=sD?{header:"On‑Target",extraHeader:"Score",sortKey:iD.EFFICIENCY,help:this.renderOnTargetHelp()}:{header:"On‑Target",extraHeader:"Score",sortKey:iD.EFFICIENCY,help:{title:"On-Target Score is Disabled",content:"On-target scores are only available for Cas9 PAMs and 20 bp or longer guides. Please change your analysis settings to see these scores.",helpClassName:"text-danger"}}
this.getShouldDisplayTier=()=>this.props.analysis.regions.some((e=>null!==e.crisprIaTier))
this.getColumnSpec=()=>{let e
this.props.analysis.isLeftPam?e=d.createElement(d.Fragment,null,"For Cpf1, ",d.createElement("b",null,"we do not apply positional weights"),". More data on Cpf1 is needed to understand how it differs from Cas9."):this.props.analysis.guideLength>nD&&(e=`The off-target analysis only takes into account the ${nD} bp closest to PAM.`)
const t={title:"Off-Target Score",content:d.createElement(OffTargetScore,{type:this.props.analysis.offTargetScoreType,offTargetWarning:e}),helpClassName:f()({"text-danger":this.props.analysis.guideLength>nD||this.props.analysis.isLeftPam})}
let n=[{sortKey:iD.POSITION,header:"Cut Position"},{header:"Strand"},this.getGuideSequenceColumnSpec(),{header:"PAM"},this.getOnTargetColumnSpec()]
n=1===this.props.guideGroupSize?n.concat([{sortKey:iD.SPECIFICITY_SINGLE,header:"Off‑Target",extraHeader:"Score",help:t}]):n.concat([{sortKey:iD.SPECIFICITY_PAIR,header:"Off‑Target",extraHeader:"(Pair)",help:t},{sortKey:iD.SPECIFICITY_SINGLE,header:"Off‑Target",extraHeader:"(Single)",help:t}])
this.getShouldDisplayTier()&&(n=n.concat([{sortKey:iD.CRISPR_IA_TIER,header:"Tier"}]))
return n}
this.getGuideGroupComponentsMap=()=>{const e={}
this.props.guideGroups.forEach((t=>{e[Ur.Z.guideGroupKey(t)]=t.map(((e,n)=>{const a=[d.createElement("td",{className:"text-left",key:"position"},T.modelStartToDisplay(this.getGuidePosition(e),this.props.sequence.startIndex)),d.createElement("td",{className:"mono",key:"strand"},fi.renderStrand(e)),d.createElement("td",{className:"mono",key:"bases"},e.bases),d.createElement("td",{className:"mono",key:"pam"},e.pam),d.createElement("td",{className:"text-left",key:"onTargetScore",...(0,ee.Z)({component:"CRISPRGuideGroupTable",element:"onTargetScore"})},this.renderDoenchScore(e))]
if(0===n){const n=this.groupOffTargetScore(t),i=n?n.toFixed(1):null,s=1===this.props.guideGroupSize
a.push(d.createElement("td",{className:"text-left",rowSpan:this.props.guideGroupSize,key:"groupOffTargetScore"},this.renderOffTargetScore(e,i,s)))}if(this.props.guideGroupSize>1){const t=this.offTargetScore(e),n=t?t.toFixed(1):null,i=!0
a.push(d.createElement("td",{className:"text-left",key:"offTargetScore"},this.renderOffTargetScore(e,n,i)))}if(this.getShouldDisplayTier()){const e=this.crisprIaTier(t),n=e?`Tier ${e}`:"-"
a.push(d.createElement("td",{className:"text-left",key:"crisprIaTier"},n))}return a}))}))
return e}
this.getGuidePosition=e=>e.position
this.getSortIteratee=()=>{const e=this.props.guideGroupSort.key
switch(e){case iD.POSITION:return this.groupPosition
case iD.SPECIFICITY_PAIR:return this.groupOffTargetScore
case iD.SPECIFICITY_SINGLE:return this.minOffTargetScore
case iD.EFFICIENCY:return this.groupDoenchScore
case iD.CRISPR_IA_TIER:return this.crisprIaTier
default:(0,S.Gp)(!1,`Unrecognized key in guide group sorting function: ${e}`)
return this.groupPosition}}
this.doenchScore=e=>this.props.analysis.isLeftPam?null:e.onTargetScore
this.groupDoenchScore=e=>Math.min(...e.map((e=>this.doenchScore(e))))
this.groupOffTargetScore=e=>{if(this.hasNullOffTargetScore(e))return null
let t=100
for(let n=0;n<e.length;n++)t*=this.offTargetScore(e[n])/100
return t}
this.groupPosition=e=>Math.min(...e.map((e=>this.getGuidePosition(e))))
this.crisprIaTier=e=>{const[t]=this.props.analysis.regions.filter((t=>t.id===e[0].regionId))
return t.crisprIaTier}
this.guideGroupSelectionRange=e=>{if(1===e.length)return(0,he.Z)(this.guideToPrimer(e[0]),"start","end");(0,S.hu)(2===e.length,"expected guideGroup to have length 2")
const t=l.default.min([e,[e[1],e[0]]],(([e,t])=>{const n=fi.guideStart(e,this.props.sequence.length,this.props.analysis.isLeftPam)
if(!this.props.sequence.circular)return n
const a=fi.guideEnd(t,this.props.sequence.length,this.props.analysis.isLeftPam)
return-1*T.distance(n,a,this.props.sequence.length,!0)}));(0,S.Gp)(t[1]&&t[0],"Forward or reverse guide is undefined in paired guide table",{extra:{guideGroup:e}})
return{start:fi.guideStart(t[0],this.props.sequence.length,this.props.analysis.isLeftPam),end:fi.guideEnd(t[1],this.props.sequence.length,this.props.analysis.isLeftPam)}}
this.guideGroupClickHandler=(e,t)=>{const{start:n,end:a}=this.guideGroupSelectionRange(e)
this.props.setSelection(n,a)}
this.guideToPrimer=e=>({start:fi.guideStart(e,this.props.sequence.length,this.props.analysis.isLeftPam),end:fi.guideEnd(e,this.props.sequence.length,this.props.analysis.isLeftPam),strand:e.strand})
this.guidesToTSV=e=>{const t=e.map((e=>[T.modelStartToDisplay(e.position,this.props.sequence.startIndex),e.strand,e.bases,e.pam,this.offTargetScore(e),this.doenchScore(e)].join("\t")))
return["Position\tStrand\tSequence\tPAM\tSpecificity Score\tEfficiency Score"].concat(t).join("\n")}
this.hasNullOffTargetScore=e=>e.some((e=>!this.offTargetScore(e)))
this.isGuideGroupSelected=e=>Ur.Z.isGuideGroupSelected(this.props.selectedGuideGroups,e)
this.minOffTargetScore=e=>this.hasNullOffTargetScore(e)?null:Math.min(...e.map((e=>this.offTargetScore(e))))
this.notifyGuidesTSVCopied=e=>{v.ZP.success(`${(0,Mt.kC)(e)} guides have been copied in tab-delimited format,\n      which can be pasted into Excel.`,{duration:6,id:`${e}-guides-copied`})}
this.offTargetScore=e=>e.offTargetScore
this.selectGuideGroups=(e,t)=>{Vr.Z.toggleSelectedGuideGroups(this.props.analysis.id,e,t.target.checked)}
this.showOffTargetModal=e=>{this.setState({offTargetModalGuide:e})}
this.sortGuideGroups=e=>{this.props.guideGroupSort.key===e?Vr.Z.updateGuideGroupSort(this.props.analysis.id,{reverse:!this.props.guideGroupSort.reverse}):Vr.Z.updateGuideGroupSort(this.props.analysis.id,{key:e,reverse:-1!==[iD.SPECIFICITY_SINGLE,iD.SPECIFICITY_PAIR,iD.EFFICIENCY].indexOf(e)})}
this.renderDoenchScore=e=>{const t=this.doenchScore(e)
return t?this.props.analysis.useAzimuthOnTargetScore&&!e.usedFullModel?`${t.toFixed(1)}*`:t.toFixed(1):null}
this.renderOffTargetScore=(e,t,n)=>n?d.createElement("a",{onClick:()=>{this.showOffTargetModal(e)},...(0,ee.Z)({component:"CRISPRGuideGroupTable",element:"offTargetScore"})},t):t
this.renderOnTargetHelp=()=>{if(this.props.analysis.useAzimuthOnTargetScore){let e
this.props.analysis.guideLength!==aD&&(e=d.createElement("span",null,d.createElement("b",null,"Warning:")," the on-target model ",d.createElement("b",null,"does not")," expect non-20bp guides. Results may be inaccurate."))
return{title:"On-Target Score",content:d.createElement(OnTargetScore,{useAzimuthOnTargetScore:!0,onTargetWarning:e})}}return{title:"On-Target Score",content:d.createElement(OnTargetScore,{useAzimuthOnTargetScore:!1})}}}render(){const e=l.default.extend({},this.props,{guideGroupComponentsMap:this.getGuideGroupComponentsMap(),columns:this.getColumnSpec(),tableClassName:"crispr-guidesTable",getGuidePosition:this.getGuidePosition,getSortIteratee:this.getSortIteratee,guidesToTSV:this.guidesToTSV})
return d.createElement("div",null,(()=>this.state.offTargetModalGuide?d.createElement(OffTargetModal,{analysis:this.props.analysis,guide:this.state.offTargetModalGuide,onRequestClose:()=>{this.setState({offTargetModalGuide:null})},region:l.default.findWhere(this.props.analysis.regions,{id:this.state.offTargetModalGuide.regionId})}):null)(),d.createElement(Z_,{...e}))}}const rD=CRISPRGuideGroupTable
var oD=n(505480)
const{locationToName:lD}=G_,cD="NO_CHROMOSOME",dD="MANUAL_CHROMOSOME"
class SetGenomeRegionModal extends d.Component{constructor(){super(...arguments)
this.state={genomeMatches:[],findingGenomeMatches:!1,regionChoice:null!=this.props.region.genomeRegionChromosome?dD:cD,workingChromosome:this.props.region.genomeRegionChromosome,workingStart:this.props.region.genomeRegionStart,workingEnd:this.props.region.genomeRegionEnd}
this.runGenomeMatch=()=>{this.setState({findingGenomeMatches:!0})
an.by({url:"/1/api/match-genomic-region",method:"PUT",contentType:"application/json",data:JSON.stringify({genome_name:this.props.genome.ensemblName,bases:this.props.getRegionBases(this.props.region)})}).fail(v.ZP.notifyError).done((e=>{if(this._isMounted){0===e.length&&v.ZP.warn("No genome matches were found for the current target region.")
this.setState({genomeMatches:e})}})).always((()=>{this._isMounted&&this.setState({findingGenomeMatches:!1})}))}
this.setRegionChoice=e=>{let t=e.target.value
Number.isNaN(t)||(t=Number.parseInt(t,10))
this.setState({regionChoice:t})}
this.setChromosome=e=>{this.setState({workingChromosome:e})
this.setManualChromosome()}
this.setWorkingStart=e=>{let t=Number.parseInt(e.target.value,10)
t=Number.isNaN(t)?null:T.displayStartToModel(t,1)
this.setState({workingStart:t})
this.setManualChromosome()}
this.setWorkingEnd=e=>{let t=Number.parseInt(e.target.value,10)
t=Number.isNaN(t)?null:T.displayEndToModel(t,t+1,1)
this.setState({workingEnd:t})
this.setManualChromosome()}
this.setManualChromosome=()=>{this.setState({regionChoice:dD})}
this.enableSave=()=>this.state.regionChoice!==dD||null!=this.state.workingStart&&null!=this.state.workingEnd&&null!=this.state.workingChromosome&&T.isValidRange(this.state.workingStart,this.state.workingEnd,this.state.workingChromosome.length,!1)
this.saveGenomeRegion=()=>{const e=Q()(this.props.region,{$merge:(()=>{switch(this.state.regionChoice){case dD:return{genomeRegionChromosome:this.state.workingChromosome,genomeRegionStart:this.state.workingStart,genomeRegionEnd:this.state.workingEnd}
case cD:return{genomeRegionChromosome:null,genomeRegionStart:null,genomeRegionEnd:null}
default:{const e=this.state.genomeMatches[Number.parseInt(this.state.regionChoice,10)]
return{genomeRegionChromosome:e.chromosome,genomeRegionStart:e.start,genomeRegionEnd:e.end}}}})()})
this.props.updateRegion(this.props.region.id,e)
this.props.onRequestClose()}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){return d.createElement(et.ZP,{title:"Genome Region",onRequestClose:this.props.onRequestClose,onRequestSubmit:this.saveGenomeRegion,buttons:[{text:"Set Genome Region",submit:!0,disabled:!this.enableSave(),key:vb.Z.APPLY},{text:"Cancel",cancel:!0}]},d.createElement("p",null,"Setting a genome region will remove it from off-target analysis."),d.createElement("div",{className:"radio"},d.createElement("label",null,d.createElement("input",{type:"radio",name:"genomeRegionOptions",value:cD,checked:this.state.regionChoice===cD,onChange:this.setRegionChoice}),"None")),d.createElement("div",{className:"radio"},d.createElement("label",{className:(0,g.iv)(uD.wrapper)},d.createElement("input",{type:"radio",name:"genomeRegionOptions",value:dD,checked:this.state.regionChoice===dD,onChange:this.setRegionChoice}),d.createElement(oD.Z,{className:f()("u-small-spacing-left",(0,g.iv)(uD.childLarge)),onChange:this.setChromosome,value:this.state.workingChromosome,genome:this.props.genome}),d.createElement("input",{className:f()("u-small-spacing-left",(0,g.iv)(uD.childSmall)),type:"number",placeholder:"Start (bp)",value:T.modelStartToDisplay(this.state.workingStart,1),onChange:this.setWorkingStart}),d.createElement("input",{className:f()("u-small-spacing-left",(0,g.iv)(uD.childSmall)),type:"number",placeholder:"End (bp)",value:T.modelEndToDisplay(this.state.workingEnd,this.state.workingEnd+1,1),onChange:this.setWorkingEnd}))),Array.from(this.state.genomeMatches).map(((e,t)=>d.createElement("div",{key:t,className:"radio"},d.createElement("label",null,d.createElement("input",{type:"radio",name:"genomeRegionOptions",value:t,checked:this.state.regionChoice===t,onChange:this.setRegionChoice}),lD(e.chromosome,e.start,e.end,e.strand),` (${e.matches} matches)`)))),d.createElement(Ke.Z,null,d.createElement(C.Co,{dataTestAttrs:{component:"SetGenomeRegionModal",element:"findMatchesButton"},buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:this.runGenomeMatch,disabled:this.state.findingGenomeMatches||null==this.props.genome.ucscName,text:this.state.findingGenomeMatches?"Finding...":"Find Genome Matches"}),null==this.props.genome.ucscName?d.createElement(A.Z,{className:"u-input-line-height u-warning-color u-small-spacing-left",icon:"warning",renderContent:()=>"Matching regions cannot be automatically found for this genome.",placement:ne.ZH.RIGHT}):void 0))}}const uD=g.mM.create({wrapper:{display:"flex",alignItems:"center"},childSmall:{flex:1},childLarge:{flex:3}})
function GenomeRegionLabel({allowEdits:e,...t}){let n
if(null!=t.region.genomeRegionChromosome){const{genomeRegionChromosome:e,genomeRegionStart:a,genomeRegionEnd:i}=t.region
n=lD(e,a,i)}else n="No region set"
return e?d.createElement("a",{onClick:()=>(0,Xn.Z)(SetGenomeRegionModal,t),...(0,ee.Z)({component:"GenomeRegionLabel",element:"regionText"})},n):d.createElement("span",{...(0,ee.Z)({component:"GenomeRegionLabel",element:"regionText"})},n)}class CRISPRRegionTable extends d.Component{constructor(e){super(e)
this.regionStartInputRef=d.createRef()
this.submit=e=>{e.preventDefault()
if(Number.isNaN(this.state.start)||Number.isNaN(this.state.end)){v.ZP.error("Enter a valid start and end position or select it in the sequence map.")
return}const t=T.displayStartToModel(Number.parseInt(this.state.start,10),this.props.sequence.startIndex),n=T.displayEndToModel(Number.parseInt(this.state.end,10),this.props.sequence.length,this.props.sequence.startIndex)
if(!T.doesRangeInclude(0,this.props.sequence.length,[t,n])){v.ZP.error("Enter a valid start and end position or select it in the sequence map.")
return}const a=T.length(t,n,this.props.sequence.length)
if(a>5e3){v.ZP.error("Target region cannot exceed 5000 bp - please try a smaller region.")
return}let i=a
for(const e of Array.from(this.props.regions))e.id!==this.state.editRegionId&&(i+=T.length(e.start,e.end,this.props.sequence.length))
if(i>3e4){v.ZP.error("Target regions cannot exceed 30000 bp combined - please try smaller regions.")
return}const s={start:t,end:n}
if(null!=this.state.editRegionId){Vr.Z.updateRegion(this.props.analysisId,this.state.editRegionId,s,this.props.findGuidesParams)
this.setState({editRegionId:null})}else Vr.Z.createRegion(this.props.analysisId,s,this.props.findGuidesParams)}
this.isRegionSelected=e=>this.props.selectedRegions[e.id]||!1
this.getRegionBases=e=>y.slice(this.props.sequence.bases,e.start,e.end,this.props.sequence.circular)
this.selectRows=(e,t)=>{Vr.Z.toggleSelectedRegions(this.props.analysisId,l.default.pluck(e,"id"),t.target.checked)}
this.editRegion=e=>{const t={editRegionId:e.id,start:T.modelStartToDisplay(e.start,this.props.sequence.startIndex),end:T.modelEndToDisplay(e.end,this.props.sequence.length,this.props.sequence.startIndex)}
this.setState(t,(()=>{u.findDOMNode(this.regionStartInputRef.current).select()}))}
this.deleteRegion=e=>{Vr.Z.deleteRegion(this.props.analysisId,e.id)
this.state.editRegionId===e.id&&this.setState({editRegionId:null})}
this.updateRegion=(e,t)=>{Vr.Z.updateRegion(this.props.analysisId,e,t,this.props.findGuidesParams)}
this.regionClickHandler=(e,t)=>{o()(t.target).is("td")&&this.props.setSelection(e.start,e.end)}
let{start:t,end:n}=e.selection
const{length:a,startIndex:i}=e.sequence;[t,n]=Array.from(T.modelRangeToDisplay(t,n,a,i))
this.state={editRegionId:null,start:null!=n?t:void 0,end:n}}UNSAFE_componentWillReceiveProps(e){let{start:t,end:n}=e.selection
if(!Is()(this.props.selection,e.selection)&&null!=t&&null!=n){const{length:e,startIndex:a}=this.props.sequence;[t,n]=Array.from(T.modelRangeToDisplay(t,n,e,a))
this.setState({start:t,end:n})}}render(){const e=l.default.sortBy(this.props.regions,"start")
return d.createElement("div",{...(0,ee.Z)({component:"CRISPRRegionTable",element:"root"})},0===e.length?this.props.allowEdits?d.createElement("div",{className:"alert alert-info"},"To get started, create a ",d.createElement("strong",null,"target region")," by selecting it on the sequence map and pressing ",d.createElement(pe.Z,{icon:"plus-large"})," ."):d.createElement("div",{className:"alert alert-info"},"No target regions have been created."):void 0,d.createElement("form",{onSubmit:this.submit},d.createElement(h.Z,{className:"u-small-spacing-top"},d.createElement(p.Z,{className:"text-right",sm:3},d.createElement(Je.Z,{className:"u-input-line-height"},"Target Region")),d.createElement(p.Z,{sm:3},d.createElement("input",{type:"text",placeholder:"Start",value:this.state.start,onChange:e=>{this.setState({start:e.target.value})},ref:this.regionStartInputRef,disabled:!this.props.allowEdits,...(0,ee.Z)({component:"CRISPRRegionTable",element:"regionStartInput"})})),d.createElement(p.Z,{sm:3},d.createElement("input",{type:"text",placeholder:"End",value:this.state.end,onChange:e=>{this.setState({end:e.target.value})},disabled:!this.props.allowEdits,...(0,ee.Z)({component:"CRISPRRegionTable",element:"regionEndInput"})})),d.createElement(p.Z,{sm:3},d.createElement(P.ZP,{title:null!=this.state.editRegionId?"Update":"Create",container:"body",placement:P.TQ.BOTTOM},d.createElement("button",{className:"button button--small button--primary",type:"submit",disabled:this.props.regionLoading||!this.props.allowEdits,...(0,ee.Z)({component:"CRISPRRegionTable",element:"createButton"})},d.createElement(pe.Z,{icon:null!=this.state.editRegionId?"refresh":"plus-large"}))),null!=this.state.editRegionId?d.createElement(P.ZP,{title:"Cancel Update",container:"body",placement:P.TQ.BOTTOM},d.createElement("a",{className:"faded u-input-line-height u-primary-pointer u-small-spacing-left",onClick:()=>{this.setState({editRegionId:null})}},d.createElement(pe.Z,{icon:"xmark-large"}))):null))),e.length>0?d.createElement("table",{className:"table u-small-spacing-top"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,d.createElement(sw.Z,{items:e,selectedMap:this.isRegionSelected,onChange:this.selectRows.bind(null,e)})),d.createElement("th",{className:"text-center"},"Start"),d.createElement("th",{className:"text-center"},"End"),d.createElement("th",null,"Annotations"),d.createElement("th",{style:{minWidth:150}},"Genome Region"),d.createElement("th",{style:{minWidth:50}}))),d.createElement("tbody",null,(()=>{const t=[]
for(var n of Array.from(e)){const e=l.default.chain(this.props.annotations).filter((({start:e,end:t})=>T.isRangeWithin(e,t,n.start,n.end))).sortBy((({start:e,end:t})=>-T.length(e,t,this.props.sequence.length))).value(),a=e.slice(0,3).map((({name:e})=>e))
e.length>3&&(a[2]+="...")
t.push(d.createElement("tr",{key:n.id,className:f()({active:this.state.editRegionId===n.id,"u-pointer":!0}),onClick:this.regionClickHandler.bind(null,n)},d.createElement("td",null,d.createElement("input",{type:"checkbox",checked:this.isRegionSelected(n),onChange:this.selectRows.bind(null,[n])})),d.createElement("td",{className:"text-center",...(0,ee.Z)({component:"CRISPRRegionTable",element:"tableRowStartCell"})},T.modelStartToDisplay(n.start,this.props.sequence.startIndex)),d.createElement("td",{className:"text-center"},T.modelEndToDisplay(n.end,this.props.sequence.length,this.props.sequence.startIndex)),d.createElement("td",null,a.join(", ")),d.createElement("td",{style:{whiteSpace:"nowrap"}},d.createElement(GenomeRegionLabel,{allowEdits:this.props.allowEdits,genome:this.props.genome,getRegionBases:this.getRegionBases,region:n,updateRegion:this.updateRegion})),d.createElement("td",null,this.props.allowEdits?[d.createElement("a",{key:"edit",className:"faded u-primary-pointer u-small-spacing-right",onClick:this.editRegion.bind(null,n)},d.createElement(pe.Z,{icon:"edit"})),d.createElement("a",{key:"delete",className:"faded u-danger-pointer",onClick:this.deleteRegion.bind(null,n)},d.createElement(pe.Z,{icon:"trash-can"}))]:void 0)))}return t})())):void 0)}}var mD=n(629061),pD=n(954867)
class SettingsModal extends d.Component{constructor(){super(...arguments)
this.state={submitted:!1,formValidated:!0}
this.settingsFormRef=d.createRef()
this.setDefaultsInputRef=d.createRef()
this.setValid=e=>{this.setState({formValidated:e})}
this.isSaving=()=>this.state.submitted&&this.props.analysisLoading
this.save=()=>{const e=this.settingsFormRef.current.getChangedAnalysisSettings()
this.setDefaultsInputRef.current.setDefaults(this.settingsFormRef.current.getAllSettings())
Vr.Z.update(this.props.analysis.id,e,this.props.findGuidesParams)
this.setState({submitted:!0})}}UNSAFE_componentWillReceiveProps(e){this.isSaving()&&!e.analysisLoading&&this.props.onRequestClose()}render(){return d.createElement(et.ZP,{enableRedesign:!1,title:"CRISPR Analysis Settings"+(this.props.allowEdits?"":" (Read Only)"),onRequestSubmit:this.save,onRequestClose:this.props.onRequestClose,buttons:[{text:this.isSaving()?"Saving...":"Save",submit:!0,disabled:this.isSaving()||!this.state.formValidated||!this.props.allowEdits}],footer:d.createElement(mD.Z,{disabled:!this.props.allowEdits,initialShouldSetDefaults:!1,ref:this.setDefaultsInputRef}),dataTestAttrs:{component:"SettingModal",element:"modal"}},d.createElement(pD.Z,{allowEdits:this.props.allowEdits,analysis:this.props.analysis,setValid:this.setValid,ref:this.settingsFormRef}))}}const hD=SettingsModal,{DESIGN_TYPE:gD,OFF_TARGET_SCORE_TYPE:ED}=gi,{DOENCH_GUIDE_SIZE:fD}=Si.Z
class CRISPRAnalysisConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Ur.Z]}enhanceProps(){const{analyses:e,analysisLoading:t,selectedRegionsMap:n,guideGroupSortMap:a}=this.crisprAnalysisStore().getState(),i=e[this.props.analysisId]
return{analysis:this.crisprAnalysisStore().isFullAnalysis(i)?i:null,analysisLoading:t,selectedRegions:n[this.props.analysisId],guideGroupSort:a[this.props.analysisId]}}}class CRISPRAnalysisOptions extends d.Component{constructor(){super(...arguments)
this.state={name:void 0,showSettingsModal:!1}
this.saveName=e=>{e.preventDefault()
Vr.Z.update(this.props.analysis.id,{name:this.state.name},this.props.findGuidesParams)}
this.isRunningOT=()=>{if(null==this.props.analysis)return!1
for(const e of Array.from(this.props.analysis.regions))if(this.props.selectedRegions[e.id])for(const t of Array.from(e.guides))if(null==t.offTargetScore)return!0
return!1}}componentDidMount(){null!=this.props.analysis&&this.setState({name:this.props.analysis.name})}componentDidUpdate(e,t){null==e.analysis&&null!=this.props.analysis&&this.setState({name:this.props.analysis.name})}render(){return d.createElement("ul",{className:"nav navbar-nav form-inline"},d.createElement("li",null,d.createElement("form",{onSubmit:this.saveName},d.createElement(_t.Z,{style:{width:200},type:"text",required:!0,disabled:null==this.state.name||!this.props.allowEdits,value:this.state.name,onChange:e=>{this.setState({name:e.target.value})}}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,type:"submit",disabled:null==this.state.name||this.props.analysisLoading||!this.props.allowEdits,text:this.props.analysisLoading?"Saving...":"Save"}))),d.createElement("li",{className:"pull-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,onClick:()=>{this.setState({showSettingsModal:!0})},disabled:null==this.props.analysis,text:"Settings",dataTestAttrs:{component:"CRISPRAnalysisTabView",element:"settingsButton"}})),d.createElement("li",{className:"pull-right"},this.isRunningOT()?d.createElement("div",{className:"spinner",...(0,ee.Z)({component:"CRISPRAnalysisTabView",element:"OTRunningSpinner"})}):void 0),d.createElement(M_.Z,{open:this.state.showSettingsModal},d.createElement(hD,{allowEdits:this.props.allowEdits,analysis:this.props.analysis,analysisLoading:this.props.analysisLoading,onRequestClose:()=>{this.setState({showSettingsModal:!1})},findGuidesParams:this.props.findGuidesParams})))}}const SD=CRISPRAnalysisConnector.connect(CRISPRAnalysisOptions)
class CRISPRAnalysisOptionsView extends s().View{static initClass(){this.prototype.className="navbar"}initialize(e){const t=this.model.sequence(),n=t._sequence()
this.listenTo(t,"change:writable change:permissions change:currentVersion",this.render)
this.listenTo(n,"change:locked",this.render)}render(){(0,Me.A9)(d.createElement(SD,{allowEdits:this.model.sequence().allowFeatureEdits(),analysisId:this.model.analysisId(),findGuidesParams:{sequence:this.model.sequence(),search:this.model.search()}}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}CRISPRAnalysisOptionsView.initClass()
class CRISPREnsureScored extends d.Component{componentDidMount(){const e=this.props.analysis.regions.filter((e=>e.guides.some((e=>null==e.onTargetScore)))),t=l.default.pluck(e,"id")
Vr.Z.analyzeOnTargetBulk(this.props.analysis.id,t)
for(const e of Array.from(this.props.analysis.regions)){e.guides.some((e=>null==e.offTargetScore))&&Vr.Z.analyzeRegionOffTarget(this.props.analysis.id,e.id)}}render(){return null}}class CRISPRAnalysisTabConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Ur.Z,k_.Z]}enhanceProps(){const{analyses:e,regionLoading:t,regeneratingAnalysis:n,selectedRegionsMap:a,guideGroupSortMap:i,selectedGuideGroupsMap:s,originalSequenceVersionMap:r}=this.crisprAnalysisStore().getState(),o=e[this.props.analysisId]
return{analysis:this.crisprAnalysisStore().isFullAnalysis(o)?o:null,regionLoading:t,regeneratingAnalysis:n,selectedRegions:a[this.props.analysisId],guideGroupSort:i[this.props.analysisId],selectedGuideGroups:s[this.props.analysisId],originalSequenceVersion:r[this.props.analysisId],genomes:this.genomeStore().getGenomes()}}}class CRISPRAnalysisTab extends d.Component{constructor(){super(...arguments)
this.getGuideGroupSize=()=>{switch(this.props.analysis.designType){case gD.SINGLE:case gD.BASE_EDIT:return 1
case gD.PAIRED:return 2
default:return}}
this.getGuideGroups=()=>{const e=this.getGuideGroupSize(),t=[]
for(var n of Array.from(this.props.analysis.regions))if(this.props.selectedRegions[n.id])for(let a=0,i=n.guides.length,s=e,r=s>0;r?a<i:a>i;a+=s){let i=n.guides.slice(a,a+e)
i=i.map((e=>l.default.extend({},e,{regionId:n.id})))
t.push(i)}return t}
this.genomeFromStore=()=>l.default.findWhere(this.props.genomes,{ensemblName:this.props.analysis.genome.ensemblName})
this.renderWarnings=()=>0===this.props.analysis.regions.length?null:this.props.analysis.regions.some((({genomeRegionChromosome:e})=>null==e))?d.createElement("div",{className:"alert alert-warning",key:"genome-region-warning"},"You don't have a genome region set above, so ",d.createElement("strong",null,"scores may not match scores from other sites"),". Benchling uses the genome region to locate your target region and to ignore potential off-target ","sites in that part of the genome."):this.props.analysis.searchSoftMaskedBases?d.createElement("div",{className:"alert alert-warning",key:"masked-region-warning"},"You included masked regions in the off-target search (under Settings above), so ",d.createElement("strong",null,"scores may not match scores from other sites"),". The common default is to skip repeats / low complexity regions ","when doing off-target search."):null
this.renderAzimuthOnTargetError=()=>this.props.analysis.useAzimuthOnTargetScore&&(this.props.sequence.circular||this.props.analysis.guideLength<fD)?d.createElement("div",{className:"alert alert-danger",key:"azimuth-circular-error"},"The new on-target score from Doench, Fusi et al. (2016) is only defined for non-circular sequences,   non-degenerate guides, and guides 20 bp or longer. To generate on-target activity scores, please   modify your analysis to use the old on-target score."):null
this.shouldRenderOnTargetAzimuthInfo=()=>{if(this.props.analysis.useAzimuthOnTargetScore)for(const e of Array.from(this.props.analysis.regions))for(const t of Array.from(e.guides))if(null!=t.onTargetScore&&!t.usedFullModel)return!0
return!1}
this.renderOnTargetAzimuthInfo=()=>this.shouldRenderOnTargetAzimuthInfo()?d.createElement("div",{className:"alert alert-info",key:"azimuth-on-target-info"},d.createElement("p",null,"The ",d.createElement("a",{href:gi.URLS.CFD_SCORE_PAPER,target:"_blank",rel:"noreferrer"},"Doench, Fusi et al. (2016)")," ","paper publishes two models for scoring guides - one that includes the position of the cut within the translated gene and a simpler model that looks only at the guide sequence."),d.createElement("p",null,"Scores marked with an * below indicate that they were computed using the model without gene position information. To use the model that includes gene position in the scoring function:",d.createElement("li",null,"the guide's cut must be within a translated region of the sequence"),d.createElement("li",null,"all of the translations on the sequence must be in a single ",d.createElement("a",{onClick:this.props.openExpandedTranslationView},d.createElement("strong",null,"translation group"))))):null
this.renderCFDOffTargetInfo=()=>this.props.analysis.offTargetScoreType!==ED.CFD?null:d.createElement("div",{className:"alert alert-info",key:"cfd-off-target-info"},d.createElement("p",null,"When using the CFD score, Benchling uses a different method for ranking and evaluating the ","relative quality of guides from that of ",d.createElement("a",{href:"https://portals.broadinstitute.org/gpp/public/software/sgrna-scoring-help",rel:"noopener noreferrer",target:"_blank"},"the Broad Institute's sgRNA design tool.")),d.createElement("p",null,"The off-target score for a given guide is calculated by aggregating the scores for each of the ",'guide\'s off-targets, using the same "Aggregate Score by Guide" formula from ',d.createElement("a",{href:gi.URLS.HSU_OFF_TARGET_PAPER,rel:"noopener noreferrer",target:"_blank"},"Hsu et al. (2013).")))}render(){return null==this.props.analysis?d.createElement("div",{className:"faded text-center u-small-spacing-top"},"Loading..."):this.props.analysis.originalBases!==this.props.sequence.bases||this.props.regeneratingAnalysis?d.createElement(eD,{allowEdits:this.props.allowEdits,analysis:this.props.analysis,findGuidesParams:this.props.findGuidesParams,openSequenceVersion:this.props.openSequenceVersion,originalSequenceVersion:this.props.originalSequenceVersion,regeneratingAnalysis:this.props.regeneratingAnalysis,sequence:this.props.sequence,versionIds:this.props.versionIds}):d.createElement("div",null,d.createElement(CRISPREnsureScored,{analysis:this.props.analysis}),d.createElement(CRISPRRegionTable,{allowEdits:this.props.allowEdits,analysisId:this.props.analysis.id,annotations:this.props.annotations,findGuidesParams:l.default.extend({},this.props.findGuidesParams,{analysis:this.props.analysis}),genome:this.genomeFromStore(),regionLoading:this.props.regionLoading,regions:this.props.analysis.regions,selectedRegions:this.props.selectedRegions,selection:this.props.selection,sequence:this.props.sequence,setSelection:this.props.setSelection}),(()=>this.props.analysis.designType===gD.BASE_EDIT?[d.createElement("hr",{key:"horizontal-rule"}),d.createElement(X_,{key:"guide-group-table",allowEdits:this.props.allowEdits,analysis:this.props.analysis,guideGroups:this.getGuideGroups(),guideGroupSize:this.getGuideGroupSize(),openAssemblyTab:this.props.openAssemblyTab,sequence:this.props.sequence,sequencePrimers:this.props.sequencePrimers,selection:this.props.selection,setSelection:this.props.setSelection,saveGuidePrimers:this.props.saveGuidePrimers,showGuidePrimers:this.props.showGuidePrimers,guideGroupSort:this.props.guideGroupSort,selectedGuideGroups:this.props.selectedGuideGroups})]:this.props.analysis.regions.length>0?[d.createElement("hr",{key:"horizontal-rule"}),this.renderWarnings(),this.renderCFDOffTargetInfo(),this.renderAzimuthOnTargetError(),this.renderOnTargetAzimuthInfo(),d.createElement(rD,{key:"guide-group-table",allowEdits:this.props.allowEdits,analysis:this.props.analysis,guideGroups:this.getGuideGroups(),guideGroupSize:this.getGuideGroupSize(),openAssemblyTab:this.props.openAssemblyTab,sequence:this.props.sequence,sequencePrimers:this.props.sequencePrimers,selection:this.props.selection,setSelection:this.props.setSelection,saveGuidePrimers:this.props.saveGuidePrimers,showGuidePrimers:this.props.showGuidePrimers,guideGroupSort:this.props.guideGroupSort,selectedGuideGroups:this.props.selectedGuideGroups})]:null)())}}const yD=CRISPRAnalysisTabConnector.connect(CRISPRAnalysisTab)
class CRISPRAnalysisTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}initialize(e){this.setSelection=this.setSelection.bind(this)
this.openAssemblyTab=this.openAssemblyTab.bind(this)
this.openSequenceVersion=this.openSequenceVersion.bind(this)
this.openExpandedTranslationView=this.openExpandedTranslationView.bind(this)
const t=this.model.sequence(),n=t._sequence()
this.listenTo(t,"change:writable change:permissions change:currentVersion",this.render)
this.listenTo(n,"change:annotations change:bases change:locked change:startIndex",this.render)
this.listenTo(n.annotations(),"add remove reset",this.render)
this.listenTo(t.selection(),"change:start change:end",(0,It.D)(this.render,250))
this.listenTo(n.sequencePrimers(),"add remove reset change:start change:end change:strand",this.render)
this.listenTo(t._sequence().translations(),"add change remove reset",this.render)
this.listenTo(t.get("versions"),"sync",this.render)}saveGuidePrimers(e,t,n){const a=this.model.sequence(),i=new Ue.SequencePrimerCollection([],{sequenceID:a.id}),r=Array.from(this.model.guidePrimers())
for(const a of r)i.add({...a.toJSON(),tagSchemaId:n,folder:e,nucleotideType:t})
return s().sync("create",i,{fileUpdate:!0}).done((({primers:e,message:t})=>{const n=e.map((e=>new Ue.SequencePrimer(e)))
a.updateVersions()
this.model.resetGuidePrimers(n,{empty:!0})
const i=dt.ZP.ENABLE_BULK_ASSEMBLY?{actionText:"Open Bulk Assembly",onActionClick:()=>{(0,ac.ZP)("/bulk-workflows/assembly")},duration:10}:{}
v.ZP.success(t,i)}))}showGuidePrimers(e){const t=this.model.sequence(),n=t.name(),a=t.length(),i=t.startIndex(),{analyses:s}=Ur.Z.getState(),r=s[this.model.analysisId()]
this.model.resetGuidePrimers(e.map((e=>{const t=fi.guideStart(e,a,r.isLeftPam),s=fi.guideEnd(e,a,r.isLeftPam)
return new Ue.SequencePrimer({start:t,end:s,strand:e.strand,bases:e.bases,pam:e.pam,name:Ue.SequencePrimer.generateName(n,t,s,1===e.strand?"forward":"reverse",a,i)})})))}setSelection(e,t){const n=this.model.sequence()
n.selection().setEndpoints(e,t)
n.trigger("jump",e)
this.render()}openAssemblyTab(e,t){this.model.sequence().fileState().buffers().addTab(new y_({analysis:e,basesList:Array.from(t).map((e=>e.bases)),sequenceName:this.model.sequence().name()}))
m.j("crispr","started_assembly")}openSequenceVersion(e){const t=this.model.sequence().get("versions").get(e)
null!=t?t.trigger("open",t):this.model.sequence().fileState().get("toolbar").trigger("openHistoryPanel")}openExpandedTranslationView(){this.model.sequence().fileState().openTranslationTabView()}render(){const e=this.model.sequence(),t=e._sequence(),n=e.selection();(0,Me.A9)(d.createElement(yD,{allowEdits:e.allowFeatureEdits(),analysisId:this.model.analysisId(),annotations:e.annotations().map((e=>({start:e.start(),end:e.end(),name:e.name()}))),openAssemblyTab:this.openAssemblyTab,sequencePrimers:t.sequencePrimers().filter((e=>null!=e.id)).map((e=>({start:e.start(),end:e.end(),strand:e.strand()}))),findGuidesParams:{sequence:this.model.sequence(),search:this.model.search()},selection:{start:n.start(),end:n.end()},setSelection:this.setSelection,sequence:{id:e.id,bases:e.bases(),circular:e.circular(),length:e.length(),startIndex:e.startIndex(),translations:e.translations().toReactJSON()},saveGuidePrimers:this.saveGuidePrimers.bind(this),showGuidePrimers:this.showGuidePrimers.bind(this),openSequenceVersion:this.openSequenceVersion,openExpandedTranslationView:this.openExpandedTranslationView,versionIds:e.get("versions").pluck("id")}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}CRISPRAnalysisTabView.initClass()
var bD,TD=n(870707),vD=n(978766),CD=n(758911)
!function(e){e.NO_CHANGE="NO_CHANGE"
e.SUBSTITUTION="SUBSTITUTION"
e.INSERTION="INSERTION"
e.DELETION="DELETION"}(bD||(bD={}))
function extractModifiedRegion(e,t){const n=Math.min(e.length,t.length)
let a=0
for(;e[a]===t[a]&&a<n;)a++
let i=0
for(;e[e.length-i-1]===t[t.length-i-1]&&i<n-a;)i++
return{index:a,original:e.slice(a,e.length-i),final:t.slice(a,t.length-i)}}function canBeCombined(e,t){(0,S.hu)(t.index<=e.index,"Edit index can't be after current index")
return e.action===t.action&&(()=>{switch(t.action){case bD.SUBSTITUTION:case bD.DELETION:return e.index-t.index<=1
case bD.INSERTION:return e.index===t.index
default:return}})()}function getEdits(e,t){let n;({index:n,original:e,final:t}=extractModifiedRegion(e,t))
const{baseEdits:a}=function getBaseEdits(e,t){let n,a,i,s,r,o,l,c
const d=[],u=[]
for(n=0,s=e.length+1,i=0<=s;i?n<s:n>s;i?n++:n--){d[n]=[n]
u[n]=[bD.DELETION]}for(a=0,o=t.length+1,r=0<=o;r?a<o:a>o;r?a++:a--){d[0][a]=a
u[0][a]=bD.INSERTION}for(n=1,c=e.length+1,l=1<=c;l?n<c:n>c;l?n++:n--){var m,p
for(a=1,m=1<=(p=t.length+1);m?a<p:a>p;m?a++:a--)if(e[n-1]===t[a-1]){d[n][a]=d[n-1][a-1]
u[n][a]=bD.NO_CHANGE}else{var h=d[n-1][a-1]+1,g=d[n-1][a]+1,E=d[n][a-1]+1
d[n][a]=Math.min(h,E,g)
u[n][a]=(()=>{switch(d[n][a]){case h:return bD.SUBSTITUTION
case E:return bD.INSERTION
case g:return bD.DELETION
default:return}})()}}const f=[]
n=e.length
a=t.length
for(;n>0||a>0;)switch(u[n][a]){case bD.SUBSTITUTION:n--
a--
f.push({action:bD.SUBSTITUTION,initial:e[n],final:t[a],index:n})
break
case bD.INSERTION:a--
f.push({action:bD.INSERTION,initial:"",final:t[a],index:n})
break
case bD.DELETION:n--
f.push({action:bD.DELETION,initial:e[n],final:"",index:n})
break
case bD.NO_CHANGE:n--
a--}return{baseEdits:f,distance:d[e.length][t.length]}}(e,t)
let i=n
return l.default.sortBy(function convertBaseEditsToEdits(e){if(0===e.length)return[]
e=l.default.sortBy(e,(({index:e})=>-e))
const t=[]
let n=l.default.first(e)
for(const a of Array.from(l.default.rest(e)))if(canBeCombined(n,a)){n.initial=a.initial+n.initial
n.final=a.final+n.final
n.index=Math.min(n.index,a.index)}else{t.push(n)
n=l.default.clone(a)}t.push(n)
return t}(a),"index").map((e=>{const t=Q()(e,{index:{$set:e.index+i}})
i+=e.final.length-e.initial.length
return t}))}class EditsTable extends d.Component{constructor(){super(...arguments)
this.modelToDisplay=e=>T.modelToDisplay(e,this.props.sequence.startIndex())
this.describeEdit=({action:e,initial:t,final:n,index:a})=>{a-=this.props.offset
switch(e){case bD.SUBSTITUTION:return`Changed ${t} to ${n} at ${this.modelToDisplay(a)}`
case bD.INSERTION:return`Inserted ${n} at ${this.modelToDisplay(a)}`
case bD.DELETION:return`Deleted ${t} at ${this.modelToDisplay(a)}`
default:return}}}render(){const e=getEdits(this.props.originalBases,this.props.currentBases)
return d.createElement("div",null,d.createElement("h5",null,"Knock-in Edits"),d.createElement("table",{className:"table table-condensed table-hover"},d.createElement("tbody",null,e.length?l.default.map(e,((e,t)=>d.createElement("tr",{key:`edit-${t}`,onClick:()=>{const t=e.index-this.props.offset
e.final.length?this.props.sequence.selection().setEndpoints(t,t+e.final.length):this.props.sequence.selection().reset(t)
this.props.sequence.trigger("jump",t)}},d.createElement("td",null,this.describeEdit(e))))):d.createElement("tr",null,d.createElement("td",null,"No edits introduced yet.")))))}}EditsTable.defaultProps={offset:0}
const ID=EditsTable
var wD=n(187199)
const{HR_TEMPLATE_STEP:ND,MINIMUM_HR_TEMPLATE_LENGTH:AD,HR_TEMPLATE_TAB_ID:RD}=gi
class IntroduceEditsStep extends d.Component{componentDidMount(){this.props.sequence.removeLockingTab(RD)}render(){return d.createElement("form",{onSubmit:e=>{e.preventDefault()
if(this.props.sequence.length()<AD){v.ZP.error(`Your sequence is less than ${AD} bp.`)
return}const t=l.default.object([[ND.SELECT_ARMS,this.props.sequence.getActiveVersionId()]])
wD.Z.serverUpdate(this.props.sequence.id,{step:ND.SELECT_ARMS,savedVersions:t})
m.j("hr_template","completed_step_introduce_edits")}},d.createElement("fieldset",null,d.createElement("legend",null,"Step 1: Introduce Desired Edits"),d.createElement("div",{className:"alert alert-info"},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("strong",null,"Select and type in the Sequence Map to introduce the changes (e.g. point mutations, ","insertions, deletions) you want to make to the genome.")),d.createElement("div",null,d.createElement("em",null,"Silent mutations to remove the target site will be added in a later step."))),d.createElement(ID,{originalBases:this.props.originalBases,currentBases:this.props.sequence.bases(),sequence:this.props.sequence}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,className:"pull-right",type:"submit",text:"Next"})))}}const PD=IntroduceEditsStep,{isLeftPam:OD}=fi
const xD=function highlightMutant(e,t,n,a,i){const s=1===a.strand&&!OD(i)||-1===a.strand&&OD(i)
function inPAMSite(e){return s?T.baseInRange(e,a.end-i.length,a.end):T.baseInRange(e,a.start,a.start+i.length)}const inTargetSite=e=>T.baseInRange(e,a.start,a.end)
return l.default.map(l.default.zip(e,t),((...e)=>{const[t,a]=Array.from(e[0]),i=e[1]
return d.createElement("span",{key:`char-${t}-${a}-${i}`,className:inTargetSite(n+i)?t!==a?"text-danger":inPAMSite(n+i)?"text-primary":"":"text-muted"},a)}))}
class MutantTable extends d.Component{constructor(){super(...arguments)
this.mutatedBases=(e,t)=>l.default.pluck(this.props.columns,"mutated").join("").slice(e-l.default.first(this.props.columns).start,t-l.default.first(this.props.columns).start)
this.usageScore=e=>null!=this.props.codonUsage?this.props.codonUsage[e]:void 0
this.isSelected=(e,t)=>e===this.props.columns[t].mutated
this.mutantRows=e=>{let t
const n=[[]]
for(t=0;t<e.length;t++){const i=e[t]
if(!i.isCoding){n[0].push(i)
continue}const s=this.props.sequence.residueSlice(i.start,i.end);(0,S.hu)(3===s.length,"expected codon to have length 3")
let r=0
const o=Pn.AMINO_ACID_TO_STANDARD_DNA_CODONS[Pn.STANDARD_DNA_CODE[s.toUpperCase()]]
var a=this.usageScore(s)
for(const e of Array.from(l.default.sortBy(o,(e=>Math.abs(a-this.usageScore(e))))))if(s!==e){null==n[r]&&(n[r]=[])
for(;n[r].length<t;)n[r].push(null)
const a=l.default.clone(i)
a.mutant=e
n[r].push(a)
r++}}for(const e of Array.from(n))for(;e.length<t;)e.push(null)
return n}
this.renderClickableCell=(e,t,n,a,i)=>d.createElement("td",{key:`${t}-${a}`,className:f()({"u-background-active":this.isSelected(t,a),"u-pointer":!0,"text-center":i}),onClick:wD.Z.setMutatedBases.bind(null,this.props.sequence.id,a,t)},d.createElement("div",null,xD(e,t,n,this.props.targetSite,this.props.pam)),i?d.createElement("div",{className:"u-small-text"},function MutantTable_guard_(e,t){return null!=e?t(e):void 0}(this.usageScore(t),(e=>e.toFixed(2)))):void 0)
this.renderIntronInputCell=(e,t,n)=>d.createElement("td",{key:`input-cell-${n}`,className:f()({"u-background-active":!this.isSelected(e,n)})},d.createElement("input",{type:"text",value:t,onChange:e=>wD.Z.setMutatedBases(this.props.sequence.id,n,e.target.value)}))
this.setSelectionEndpoints=(e,t)=>{this.props.sequence.selection().setEndpoints(e,t)
this.props.sequence.trigger("jump",e)}}render(){let e,t
return d.createElement("table",{className:"table table-bordered table-condensed table-valign-middle-cells"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,null),l.default.map(this.props.columns,(({start:e,end:t,isCoding:n},a)=>d.createElement("th",{key:`column-header-${a}`,onClick:this.setSelectionEndpoints.bind(this,e,t),className:f()({"text-center mono":n,"u-normal-font-weight":!0})},d.createElement("a",null,n?y.translate(this.props.sequence.residueSlice(e,t),this.props.sequence.nucleotideType(),R.hR.STANDARD):"Non-coding")))))),d.createElement("tbody",null,d.createElement("tr",null,d.createElement("th",null,"Wildtype"),l.default.map(this.props.columns,(({start:e,end:t,isCoding:n},a)=>{const i=this.props.sequence.residueSlice(e,t)
return this.renderClickableCell(i,i,e,a,n)}))),Array.from(e=this.mutantRows(this.props.columns)).map(((n,a)=>d.createElement("tr",{key:`mutant-row-${a}`},0===a?d.createElement("th",{rowSpan:e.length},"Mutations",d.createElement(P.ZP,{title:"Reset to Defaults",container:"body"},d.createElement("a",{className:"u-tiny-spacing-left",onClick:wD.Z.suggestMutations.bind(null,this.props.sequence.id)},d.createElement(pe.Z,{icon:"undo"})))):void 0,(()=>{const i=[]
for(t=0;t<n.length;t++){const s=n[t]
if(null!=s){const{start:e,end:n,mutant:a,mutated:r,isCoding:o}=s
o?i.push(this.renderClickableCell(this.props.sequence.residueSlice(e,n),a,e,t,o)):i.push(this.renderIntronInputCell(this.props.sequence.residueSlice(e,n),r,t))}else 0===a||null!=e[a-1][t]?i.push(d.createElement("td",{key:`empty-${t}-${a}`,rowSpan:e.length-a},null)):i.push(void 0)}return i})()))),d.createElement("tr",null,d.createElement("th",null,"Final"),l.default.map(this.props.columns,(({start:e,end:t,mutated:n,isCoding:a},i)=>d.createElement("td",{key:`mutated-bases-${i}`,className:f()({"text-center":a})},xD(this.props.sequence.residueSlice(e,t),n,e,this.props.targetSite,this.props.pam)))))))}}const _D=MutantTable
class RemoveTargetSiteStep extends d.Component{constructor(){super(...arguments)
this.setSelectionEndpoints=(e,t)=>{this.props.sequence.selection().setEndpoints(e,t)
this.props.sequence.trigger("jump",e)}}componentDidMount(){wD.Z.setGuide(this.props.sequence.id)
this.props.sequence.addLockingTab({tabId:gi.HR_TEMPLATE_TAB_ID,tabName:"HR template design"})}componentDidUpdate(e){e.pam===this.props.pam&&e.codonUsage===this.props.codonUsage||wD.Z.setGuide(this.props.sequence.id)}render(){return d.createElement("form",{onSubmit:function(e){e.preventDefault()}},d.createElement("fieldset",null,d.createElement("legend",null,"Step 3: Remove Target Site"),(()=>{if(!this.props.guide)return d.createElement("div",{className:"alert alert-info"},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("strong",null,"Input your guide sequence")," (without the PAM) to begin making mutations that remove the target site from your template."),d.createElement("div",null,d.createElement("em",null,"This step is usually required to prevent re-cutting of the repaired genomic DNA. Click           Next to skip it in certain cases (e.g. single nickase with a guide that is sense to           the template).")))
if(null!=this.props.columns){const e=[]
l.default.any(this.props.columns,(e=>e.isCoding))&&e.push("clicking on the synonymous codons")
l.default.any(this.props.columns,(e=>!e.isCoding))&&e.push("editing the input")
return d.createElement("div",{className:"alert alert-info"},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("strong",null,"Confirm the mutated bases")," and click ",d.createElement("em",null,"Next")," to continue. ","Modify the mutations by ",(0,Mt.Dw)(e)," below."),d.createElement("div",null,d.createElement("em",null,`Our default suggestion is to mutate the PAM, unless it occurs in a translation with no           possible silent mutations. In that case, we try to introduce ${gi.DESIRED_HR_MISMATCHES}           mutations in the guide sequence, selecting codons to keep the `,d.createElement("a",{className:"u-text-decoration-underline",href:"https://en.wikipedia.org/wiki/Codon_Adaptation_Index",target:"_blank"},"CAI")," close to the original value.")))}return null})(),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement("input",{type:"text",placeholder:"Guide",value:this.props.guide,onChange:e=>wD.Z.setGuide(this.props.sequence.id,e.target.value)})))),this.props.errorMessage?d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("div",{className:"alert alert-danger"},this.props.errorMessage)))):d.createElement(Ke.Z,null,(()=>null!=this.props.columns?d.createElement("div",null,d.createElement(_D,{sequence:this.props.sequence,pam:this.props.pam,guide:this.props.guide,targetSite:this.props.targetSite,codonUsage:this.props.codonUsage,columns:this.props.columns}),d.createElement("div",null,d.createElement("p",{className:"help-block"},"Bases included to complete triplets are colored ",d.createElement("span",{className:"text-muted"},"grey")," and the PAM site is colored ",d.createElement("span",{className:"text-primary"},"blue"),"."),this.props.warningMessage?d.createElement("div",{className:"alert alert-warning"},this.props.warningMessage):void 0)):this.props.guide?"Loading...":null)()),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,className:"pull-right",disabled:Boolean(this.props.errorMessage||this.props.modifyingSequence||this.props.isHRTemplateLoading||this.props.resettingToVersion),onClick:()=>{if(this.props.warningMessage){v.ZP.error(this.props.warningMessage)
return}wD.Z.saveMutations(this.props.sequence.id)
const e=l.default.object([[gi.HR_TEMPLATE_STEP.SUMMARY,this.props.sequence.getActiveVersionId()]])
wD.Z.serverUpdate(this.props.sequence.id,{step:gi.HR_TEMPLATE_STEP.SUMMARY,savedVersions:e,guide:this.props.guide})
m.j("hr_template","completed_step_remove_target_site")},text:this.props.modifyingSequence||this.props.isHRTemplateLoading?"Loading...":"Next"}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,disabled:this.props.resettingToVersion||this.props.isHRTemplateLoading,onClick:wD.Z.backToStep.bind(null,this.props.sequence.id,gi.HR_TEMPLATE_STEP.SELECT_ARMS),text:this.props.isHRTemplateLoading?"Loading...":this.props.resettingToVersion?"Resetting...":"Back"})))}}const DD=RemoveTargetSiteStep
function isValidRangeAndNotNull(e,t,n){return null!=e&&null!=t&&(0<=e&&e<t&&t<=n)}const{DESIRED_HR_TEMPLATE_LENGTH:LD,HR_TEMPLATE_STEP:kD,MINIMUM_HR_TEMPLATE_LENGTH:MD,HR_TEMPLATE_TAB_ID:FD}=gi
class SelectArmsStep extends d.Component{constructor(){super(...arguments)
this.setArmRegion=(e,t)=>{wD.Z.update(this.props.sequence.id,{armRegion:{start:e,end:t}})
let n=!1
if(isValidRangeAndNotNull(e,t,this.props.sequence.length())){this.props.sequence.selection().setEndpoints(e,t)
n=!0}else if(null==t&&function baseInRangeAndNotNull(e,t,n){return null!=e&&t<=e&&e<n}(e,0,this.props.sequence.length())){this.props.sequence.selection().reset(e)
n=!0}if(n){wD.Z.updatePendingSelection(this.props.sequence.id,{start:e,end:t})
this.props.sequence.trigger("jump",e)}}
this.suggestArms=(e=!0)=>{const t=this.props.savedVersions[kD.INTRODUCE_EDITS].bases,{index:n,original:a,final:i}=extractModifiedRegion(t,this.props.sequence.bases())
if(!a&&!i&&e){v.ZP.warn("Could not detect modified region for arm suggestion.",{id:"no-modifications"})
return}const s=100-i.length/2
let r=Math.floor(n-s),o=Math.floor(n+i.length+s)
if(r<0){o+=-r
r=0}if(o>this.props.sequence.length()){r-=o-this.props.sequence.length()
o=this.props.sequence.length()}r=Math.max(0,r)
o=Math.min(this.props.sequence.length(),o);(0,S.hu)(o-r===LD||this.props.sequence.length()<LD,"expected sequence to have desired HR template length")
this.setArmRegion(r,o)}
this._deleteBases=(e,t)=>e!==t?this.props.sequence.deleteBases(e,t):o().Deferred().resolve().promise()
this.trimTranslations=async(e,t)=>{const{sequence:n}=this.props,a={}
for(const i of n.getTranslationGroups()){let s=0
a[i.id]=[]
for(const r of i.translations){if(T.isRangeOverlap(e,t,r.start,r.end)){let t
const n=s%3,o=r.start+(3-n)%3
if(e<=o)t=o
else{t=e+(3-(e-o)%3)%3}if(t===r.start)break
t<r.end&&a[i.id].push({start:t,end:r.end,strand:r.strand,id:r.id})
break}s+=T.length(r.start,r.end,n.length())}}const i=[]
let s=[]
for(const[e,t]of Object.entries(a)){if(0===t.length)continue
const{translationGroup:a,translationRegions:r}=await(0,gl.rd)(n.id,parseInt(e,10),{regions:t.map((({start:e,end:t,strand:n,id:a})=>({modificationType:gl.u8.UPDATE,start:e,end:t,strand:n,id:a})))})
i.push(a)
s=s.concat(r)}(i.length>0||s.length>0)&&(0,Nn._x)(n,i,s,[])}
this.trimToSelectedRange=async(e,t)=>{if(!isValidRangeAndNotNull(e,t,this.props.sequence.length())){v.ZP.error("Please select a valid range for HR arms.")
return}if(t-e<MD){v.ZP.error(`Your selected arms are less than ${MD} bp.`)
return}const n=this.props.savedVersions[kD.INTRODUCE_EDITS].bases,{index:a,final:i}=extractModifiedRegion(n,this.props.sequence.bases())
if(a<this.props.sequence.length()&&(e>a||t<a+i.length))v.ZP.error("Selected range must contain all modified regions.")
else{t-e<LD&&v.ZP.warn(`Your selected arms are less than ${LD} bp.`)
wD.Z.update(this.props.sequence.id,{modifyingSequence:!0})
try{await this.trimTranslations(e,t)
await this._deleteBases(t,this.props.sequence.length())
await this._deleteBases(0,e)
this.props.sequence.selection().setEndpoints(0,this.props.sequence.length())
this.props.sequence.trigger("jump",0)
const n=l.default.object([[kD.REMOVE_TARGET_SITE,this.props.sequence.getActiveVersionId()]])
wD.Z.serverUpdate(this.props.sequence.id,{step:kD.REMOVE_TARGET_SITE,savedVersions:n,armRegion:{start:e,end:t}})}finally{wD.Z.update(this.props.sequence.id,{modifyingSequence:!1})}}}
this.renderLength=()=>{const{start:e,end:t}=this.props.armRegion
if(null==e||null==t)return"n/a"
return`${T.length(e,t,this.props.sequence.length())} bp`}
this.renderArmLengths=()=>{const{start:e,end:t}=this.props.armRegion
if(null==e||null==t)return d.createElement("div",null)
const n=this.props.savedVersions[kD.INTRODUCE_EDITS].bases,{index:a,final:i}=extractModifiedRegion(n,this.props.sequence.bases())
return d.createElement("div",null,d.createElement("div",null,"Left Arm Length: ",e<a?a-e+" bp":"n/a"),d.createElement("div",null,"Right Arm Length: ",a+i.length<t?t-(a+i.length)+" bp":"n/a"))}}componentDidMount(){const{start:e,end:t}=this.props.armRegion
null==e||null==t?this.suggestArms(!1):this.suggestArms()
this.props.sequence.addLockingTab({tabId:FD,tabName:"HR template design"})}componentDidUpdate(e){const{start:t,end:n}=this.props.selection
if(!Is()(this.props.selection,e.selection)){const e=CD.Z.getPendingSelection(this.props.sequence.id)
null!=e&&e.start===t&&e.end===n?wD.Z.updatePendingSelection(this.props.sequence.id,null):wD.Z.update(this.props.sequence.id,{armRegion:{start:this.props.selection.start,end:this.props.selection.end}})}}render(){const e=T.modelStartToDisplay(this.props.armRegion.start,this.props.sequence.startIndex()),t=T.modelEndToDisplay(this.props.armRegion.end,this.props.sequence.length(),this.props.sequence.startIndex())
return d.createElement("form",{onSubmit:async e=>{e.preventDefault()
m.j("hr_template","completed_step_select_arms")
await this.trimToSelectedRange(this.props.armRegion.start,this.props.armRegion.end)}},d.createElement("legend",null,d.createElement("div",{className:"u-large-text"},"Step 2: Adjust HR Arms")),d.createElement("div",{className:"alert alert-info"},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("strong",null,"Adjust the region to use as the HR template")," by clicking and dragging the ends of the selection on the Sequence Map."),d.createElement("div",null,d.createElement("em",null,`A ${LD} bp region around your mutations has already been selected. `,"At least 50 bp on each side flanking the mutations is recommended."))),d.createElement("legend",null,d.createElement("h5",null,"Template Region")),d.createElement(Ke.Z,null,d.createElement("input",{className:"u-inline-form-input-sm u-small-spacing-right",type:"number",placeholder:"Start",value:null!=e?e:void 0,onChange:e=>{let t=parseInt(e.target.value,10)
t=Number.isNaN(t)?null:T.displayStartToModel(t,this.props.sequence.startIndex())
this.setArmRegion(t,this.props.armRegion.end)}}),"-",d.createElement("input",{className:"u-inline-form-input-sm u-small-spacing-left",type:"number",placeholder:"End",value:null!=t?t:void 0,onChange:e=>{let t=parseInt(e.target.value,10)
t=Number.isNaN(t)?null:T.displayEndToModel(t,this.props.sequence.length(),this.props.sequence.startIndex())
this.setArmRegion(this.props.armRegion.start,t)}}),d.createElement("a",{className:"u-input-line-height u-spacing-left",onClick:()=>{this.suggestArms()}},"Reset to Default")),d.createElement("div",{className:"faded u-spacing-bottom"},d.createElement("div",null,"Template Length: ",this.renderLength()),this.renderArmLengths()),d.createElement(ID,{originalBases:this.props.savedVersions[kD.INTRODUCE_EDITS].bases,currentBases:this.props.savedVersions[kD.SELECT_ARMS].bases,sequence:this.props.sequence}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,type:"submit",className:"pull-right",disabled:this.props.modifyingSequence||this.props.isHRTemplateLoading,text:this.props.modifyingSequence||this.props.isHRTemplateLoading?"Loading...":"Next"}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,disabled:this.props.resettingToVersion||this.props.isHRTemplateLoading,onClick:wD.Z.backToStep.bind(null,this.props.sequence.id,kD.INTRODUCE_EDITS),text:this.props.isHRTemplateLoading?"Loading...":"Back"}))}}const ZD=SelectArmsStep
var BD=n(329786)
function SettingsModal_defineProperty(e,t,n){(t=function SettingsModal_toPropertyKey(e){var t=function SettingsModal_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class SettingsModal_SettingsModal extends d.Component{constructor(e){super(e)
SettingsModal_defineProperty(this,"save",(()=>{const e=this.state.settings,t={}
for(const n in e){const a=e[n]
Is()(this.oldSettings[n],a)||(t[n]=a)}wD.Z.serverUpdate(this.props.sequenceId,t)
this.props.onRequestClose()}))
SettingsModal_defineProperty(this,"handleChangeSettings",(e=>{this.setState({settings:e})}))
const{pam:t,genome:n}=CD.Z.getDesignState(e.sequenceId),a={pam:t,genome:n.ensemblName}
this.oldSettings=a
this.state={settings:a}}render(){return d.createElement(et.ZP,{enableRedesign:!1,title:"HR Template Design Settings",onRequestSubmit:this.save,onRequestClose:this.props.onRequestClose,buttons:[{text:"Save",submit:!0}]},d.createElement(BD.Z,{settings:this.state.settings,onChange:this.handleChangeSettings}))}}SettingsModal_defineProperty(SettingsModal_SettingsModal,"propTypes",{sequenceId:J().string.isRequired,onRequestClose:J().func.isRequired})
const{HR_TEMPLATE_STEP:qD,HR_TEMPLATE_TAB_ID:VD}=gi
class SummaryStep extends d.Component{componentDidMount(){wD.Z.setGuide(this.props.sequence.id)
this.props.sequence.addLockingTab({tabId:VD,tabName:"HR template design"})}render(){let e
const t=this.props.savedVersions[qD.REMOVE_TARGET_SITE].bases
return d.createElement("form",null,d.createElement("fieldset",null,d.createElement("legend",null,"Step 4: Summary"),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(ID,{currentBases:this.props.savedVersions[qD.SELECT_ARMS].bases,originalBases:this.props.savedVersions[qD.INTRODUCE_EDITS].bases,sequence:this.props.sequence,offset:this.props.armRegion.start}))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("dl",{className:"dl-horizontal u-no-spacing-top"},d.createElement("dt",{className:"u-small-spacing-bottom"},"Template Range"),d.createElement("dd",null,T.modelStartToDisplay(this.props.armRegion.start,this.props.sequence.startIndex())," to ",T.modelEndToDisplay(this.props.armRegion.end,this.props.savedVersions[qD.SELECT_ARMS].bases.length,this.props.sequence.startIndex())),this.props.guide.length>0?d.createElement("div",null,d.createElement("dt",{className:"u-small-spacing-bottom"},"Guide"),d.createElement("dd",{className:"mono"},this.props.guide),d.createElement("dt",null,"Original Target Site"),d.createElement("dd",{className:"mono"},null!=this.props.columns?["...",this.props.columns.map((({start:n,end:a},i)=>{e=t.slice(n,a)
return d.createElement("span",{key:`${i}`,className:"u-tiny-spacing-left u-tiny-spacing-right"},xD(e,e,n,this.props.targetSite,this.props.pam))})),"..."]:"Loading..."),d.createElement("dt",null,"After Site Removal"),d.createElement("dd",{className:"mono"},null!=this.props.columns?["...",this.props.columns.map((({start:e,end:n},a)=>d.createElement("span",{key:`${a}`,className:"u-tiny-spacing-left u-tiny-spacing-right"},xD(t.slice(e,n),this.props.sequence.residueSlice(e,n),e,this.props.targetSite,this.props.pam)))),"..."]:"Loading...")):void 0))),d.createElement("div",{className:"well"},d.createElement("p",null,d.createElement(bt.Z,{value:this.props.sequence.bases()},d.createElement("a",null,"Copy the template"))," or its ",d.createElement(bt.Z,{value:y.revcomp(this.props.sequence.bases(),R.jb)},d.createElement("a",null,"reverse complement"))," to your clipboard."),d.createElement("div",null,"To design a template for the same knock-in edits but with a different guide, ",d.createElement("a",{onClick:wD.Z.designWithNewGuide.bind(null,this.props.sequence.id,this.props.originalBases)},"click here"),"."))),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:wD.Z.backToStep.bind(null,this.props.sequence.id,qD.REMOVE_TARGET_SITE),disabled:this.props.isHRTemplateLoading||this.props.resettingToVersion,text:this.props.isHRTemplateLoading?"Loading...":this.props.resettingToVersion?"Resetting...":"Back"})))}}const UD=SummaryStep,{HR_TEMPLATE_STEP:GD,HR_TEMPLATE_TAB_ID:zD}=gi
class HRTemplateOptions extends d.Component{constructor(){super(...arguments)
this.state={showSettingsModal:!1}}render(){return d.createElement("ul",{className:"nav navbar-nav form-inline"},d.createElement("li",{className:"pull-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,disabled:!this.props.allowEdits||this.props.circular,onClick:()=>{this.setState({showSettingsModal:!0})},text:"Settings"})),d.createElement(M_.Z,{open:this.state.showSettingsModal},d.createElement(SettingsModal_SettingsModal,{sequenceId:this.props.sequenceId,onRequestClose:()=>{this.setState({showSettingsModal:!1})}})))}}class HRTemplateOptionsView extends s().View{static initClass(){this.prototype.className="navbar"}initialize(e){this.listenTo(this.model.sequence(),"change:writable change:permissions change:currentVersion",this.render)
this.listenTo(this.model.sequence()._sequence(),"change:locked",this.render)}render(){(0,Me.A9)(d.createElement(HRTemplateOptions,{sequenceId:this.model.sequence().id,allowEdits:this.model.sequence().allowFeatureEdits({tabId:zD}),circular:this.model.sequence().circular()}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}HRTemplateOptionsView.initClass()
class HRTemplateTabConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[CD.Z,vD.Z]}enhanceProps(){let e=this.hrTemplateStore().getDesignState(this.props.sequenceId)||{}
null!=e.organismId&&(e=Q()(e,{codonUsage:{$set:this.organismStore().getCodonUsage(e.organismId)}}))
return e}}class HRTemplateTab extends d.Component{render(){return this.props.allowEdits?this.props.circular?d.createElement("div",null,d.createElement("p",null,"HR Template Design is not yet available for circular sequences."),d.createElement("p",null,"To change a sequence from circular to linear, click the ",d.createElement(pe.Z,{icon:"info-circle"})," in the right sidebar.")):d.createElement("div",null,(()=>{switch(this.props.step){case GD.INTRODUCE_EDITS:return d.createElement(PD,{sequence:this.props.sequence,originalBases:this.props.savedVersions[GD.INTRODUCE_EDITS].bases})
case GD.SELECT_ARMS:return d.createElement(ZD,{sequence:this.props.sequence,savedVersions:this.props.savedVersions,armRegion:this.props.armRegion,resettingToVersion:this.props.resettingToVersion,modifyingSequence:this.props.modifyingSequence,isHRTemplateLoading:this.props.isHRTemplateLoading,selection:this.props.selection})
case GD.REMOVE_TARGET_SITE:return d.createElement(DD,{sequence:this.props.sequence,pam:this.props.pam,guide:this.props.guide,errorMessage:this.props.errorMessage,warningMessage:this.props.warningMessage,targetSite:this.props.targetSite,columns:this.props.columns,resettingToVersion:this.props.resettingToVersion,modifyingSequence:this.props.modifyingSequence,isHRTemplateLoading:this.props.isHRTemplateLoading,codonUsage:this.props.codonUsage})
case GD.SUMMARY:return d.createElement(UD,{sequence:this.props.sequence,pam:this.props.pam,targetSite:this.props.targetSite,savedVersions:this.props.savedVersions,guide:this.props.guide,armRegion:this.props.armRegion,resettingToVersion:this.props.resettingToVersion,isHRTemplateLoading:this.props.isHRTemplateLoading,columns:this.props.columns})
default:return null}})()):d.createElement("div",null,"HR Template Design is disabled on read-only sequences.")}}const $D=HRTemplateTabConnector.connect(HRTemplateTab)
class HRTemplateTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab-reset"}initialize(e){const t=this.model.sequence(),n=t._sequence()
this.listenTo(t,"change:writable change:permissions change:currentVersion",this.render)
this.listenTo(n,"change:bases change:circular change:startIndex change:locked",this.render)
this.listenTo(n.translations(),"add remove change",this.render)
this.listenTo(t.selection(),"change:start change:end",(0,It.D)(this.render,250))
this.listenTo(t.get("versions"),"reloaded sync",this.render)}render(){const e=this.model.sequence();(0,Me.A9)(d.createElement($D,{sequenceId:e.id,tabId:this.model.id,allowEdits:e.allowResidueEdits({tabId:zD}),selection:{start:e.selection().start(),end:e.selection().end()},circular:e.circular()}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}HRTemplateTabView.initClass()
var WD=n(124510)
class NucleotidesTabView extends s().View{initialize(){this.listenTo(this.model.sequence().get("_sequence"),"change:bases",this.render.bind(this))}render(){if(!(this.model.sequence()instanceof Ge.Sequence))throw new Error("Can only open nucleotides tab for sequence")
const e=this.model.sequence();(0,Me.A9)(d.createElement(os.Z,{areEditsEnabled:e.allowResidueEdits(),bases:e.bases(),nucleotideType:e.nucleotideType(),sequenceId:this.model.sequence().id,onUpdateMod:async(t,n,a)=>{(0,S.hu)(a===Un.Zp.PHOSPHATE||null!=n,"Can only specify null monomer for phosphate")
switch(a){case Un.Zp.SUGAR:e.setSugarMod(t,n)
break
case Un.Zp.PHOSPHATE:e.setPhosphateMod(t,n)
break
case Un.Zp.BASE:await e.setBaseMod(t,n)
break
default:(0,S.Gp)(!1,"Unexpected nucleotide component")}},onBulkUpdateMods:t=>{e.bulkSetMods(t)}}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}NucleotidesTabView.prototype.className="buffer-tab"
const HD=NucleotidesTabView
class ExportPNGModal extends d.Component{constructor(){super(...arguments)
this.state={pngURL:null,failed:!1}
this._renderPreview=()=>this.state.failed?d.createElement("div",null,d.createElement("p",null,"Generating the PNG failed. Please try again or ",d.createElement("a",{onClick:()=>{de.bk()}},"contact us"),".")):this.state.pngURL?d.createElement("div",{className:"exportPNGModal-preview"},d.createElement("img",{src:this.state.pngURL})):d.createElement("div",{className:"text-center u-spacing-top u-spacing-bottom"},d.createElement(kl.Z,null))
this._handleDownloadPNG=()=>{window.open(this.state.pngURL)
this.props.onRequestClose()
m.j("protein_alignment","downloaded_png")}
this._getPrimaryButton=()=>this.state.failed?[]:[{disabled:!this.state.pngURL,key:"download",submit:!0,text:this.state.pngURL?"Download PNG":"Generating PNG..."}]}async componentDidMount(){const e=await this.props.renderSVG()
try{const t=await getPNGFileForSVG(e,this.props.downloadName)
this.setState({pngURL:t})}catch(e){this.setState({failed:!0})}m.j("protein_alignment","created_png")}render(){return d.createElement(et.ZP,{title:this.props.title,onRequestClose:this.props.onRequestClose,onRequestSubmit:this.state.failed?null:this._handleDownloadPNG,buttons:this._getPrimaryButton()},this._renderPreview())}}const jD=ExportPNGModal
var YD=n(495547),QD=n(62847)
const{ALIGNMENT_TYPE:KD}=Kt
class ProteinRealignModal extends d.Component{constructor(e){super(e)
this._handleAddProteinSpecifier=e=>{this.setState({proteinSpecifiers:Q()(this.state.proteinSpecifiers,{$push:[e]})})}
this._handleRemoveProteinAt=e=>{this.setState({proteinSpecifiers:Q()(this.state.proteinSpecifiers,{$splice:[[e,1]]})})}
this._handleRealign=()=>{let e
e=this._isTemplate()?this.state.proteinSpecifiers.slice(1):this.state.proteinSpecifiers
QD.Z.realign({alignment:this.props.alignment,proteinSpecifiers:e})
this.props.onRequestClose()}
this._isTemplate=()=>this.props.alignment.alignmentType===KD.TEMPLATE
const t=e.alignment.rows.filter((e=>e.originalProteinId)).map((e=>({name:e.name,id:e.originalProteinId,canBeTemplate:!1})))
this.state={proteinSpecifiers:t}}render(){return d.createElement(et.ZP,{enableRedesign:!1,title:"Realign",onRequestClose:this.props.onRequestClose,buttons:[{text:"Realign",onClick:this._handleRealign,disabled:this.state.proteinSpecifiers.length<=1,style:"primary",key:"download"},{text:"Cancel",cancel:!0,key:"cancel"}]},d.createElement(YD.Z,{proteinSpecifiers:this.state.proteinSpecifiers,templateProteinIndex:this._isTemplate()?0:null,onAddProteinSpecifier:this._handleAddProteinSpecifier,onRemoveProteinAt:this._handleRemoveProteinAt,onSetTemplateProteinAt:()=>{},allowSetTemplate:!1}))}}const JD=ProteinRealignModal
class ProteinAlignmentToolbarConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const e=this.proteinStore().getProteinById(this.props.alignment.proteinId)
return{allowFeatureEdits:e&&e.permissions.polymerFeaturesEditable}}}class ProteinAlignmentToolbar extends d.Component{constructor(){super(...arguments)
this.state={isExportModalOpen:!1,isRealignModalOpen:!1}
this._handleRealign=()=>{this.setState({isRealignModalOpen:!0})}
this._handleCloseRealignModal=()=>{this.setState({isRealignModalOpen:!1})}
this._handleExportPNG=()=>{this.setState({isExportModalOpen:!0})}
this._handleCloseExportModal=()=>{this.setState({isExportModalOpen:!1})}
this._handleExportPDF=async()=>{const e=await async function generateRawSequencesFromProteinAlignment(e,t){const n=e.rows,a=n[0],i=n.map((e=>(0,y.removeGaps)(e.proteinVersion.aminoAcids))),s=shouldShowCDRs(t),r=(s?await jt.Z.getCDRAnnotations(i,getAntibodyVisibilitySettings(t)[1]):[]).map(((e,t)=>{if(!e)return[]
const a=getRealToGapMap(n[t].proteinVersion.aminoAcids)
return l.default.flatten(e.map((e=>e.regions))).map((e=>({name:e.name.includes("CDR")?Ft.p4.CDR:Ft.p4.FRAMEWORK,range:{start:a[e.start],end:a[e.end]}})))}))
return n.map(((e,t)=>0===t?{sequenceName:e.name,residues:e.proteinVersion.aminoAcids.split("").map((e=>({letter:e,format:null}))),cdrAnnotations:s?r[t]:[]}:{sequenceName:e.name,cdrAnnotations:s?r[t]:[],residues:e.proteinVersion.aminoAcids.split("").map(((t,n)=>{const i={letter:t,format:null},s=(0,Ht.A)(a.proteinVersion.aminoAcids,e.proteinVersion.aminoAcids,n,yt.Q6.AA)
s&&(i.format=s)
return i}))}))}(this.props.alignment,this.props.visibilityOptions)
m.KK(j.Jg.OPENED_FORMATTED_PDF_MODAL,{residueType:yt.Q6.AA});(0,Xn.Z)(molbio_AlignmentPDFDownloadModal,{rawAlignmentData:e,alignmentPolymerType:yt.Q6.AA,selection:this.props.selection,alignmentName:this.props.alignment.name,cdrDefinition:getAntibodyVisibilitySettings(this.props.visibilityOptions)[1]})}}getCachedFastaURI(){if(this._cachedAlignment!==this.props.alignment){this._cachedAlignment=this.props.alignment
this._cachedFastaURI=(0,Tt.$y)(function fastaFormat(e){return getNonConsensusRows(e).map((e=>`>${e.name}\n${function fastaFormatRowSequence(e){const t=e.proteinVersion.aminoAcids.match(/.{1,80}/g)
return null==t?"":t.join("\n")}(e)}\n`)).join("\n")}(this.props.alignment))}return this._cachedFastaURI}render(){const e=`${window.location.href}?alignment=${this.props.alignment.id}`
return d.createElement("div",null,d.createElement(M_.Z,{open:this.state.isExportModalOpen},d.createElement(jD,{title:"Export protein alignment",downloadName:`${this.props.alignment.name}.png`,onRequestClose:this._handleCloseExportModal,renderSVG:this.props.renderAlignmentSVG})),d.createElement(M_.Z,{open:this.state.isRealignModalOpen},d.createElement(JD,{alignment:this.props.alignment,onRequestClose:this._handleCloseRealignModal})),d.createElement("div",{className:"navbar nav buffer-options-container"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,disabled:!this.props.allowFeatureEdits,onClick:this._handleRealign,size:C.qE.MINI,text:"Realign"}),d.createElement("div",{className:"buffer-options-item--bannerContainer buffer-options-item--proteinBannerContainer"},d.createElement(wP.Z,{message:"Protein alignments are read-only."})),d.createElement("div",{className:"buttonGroup"},d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:"Export"},d.createElement("div",{className:"buttonGroup"},d.createElement(I.ZP,{menu:d.createElement(w.ZP,{dropLeft:!0,height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.MEDIUM},d.createElement(N.Z,{download:`${this.props.alignment.name}.fasta`,href:this.getCachedFastaURI()},"FASTA"),d.createElement(N.Z,{onSelect:this._handleExportPNG},"PNG"),d.createElement(N.Z,{onSelect:this._handleExportPDF},"PDF"),d.createElement(N.Z,{onSelect:()=>{(0,$b.Z)(e,{showToastOnSuccess:!0,onSuccess:()=>{m.KK(j.Jg.COPIED_ALIGNMENT_URL,{residueType:yt.Q6.AA})}})}},d.createElement("div",null,"Copy Link")))},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"export",isDropdown:!0,size:C.qE.MINI})))),d.createElement(St.Z,{options:this.props.visibilityOptions}))))}}const XD=ProteinAlignmentToolbarConnector.connect(ProteinAlignmentToolbar)
class ProteinAlignmentTabOptionsView extends s().View{initialize(){this._boundRenderAlignmentSVG=this._renderAlignmentSVG.bind(this)
this.listenTo(this.model.get("selection"),"change:start change:end",this.render.bind(this))}_renderAlignmentSVG(){return renderAlignmentSVG(this.model)}render(){const e=this.model.get("visibilityOptions"),t=this.model.get("alignment"),n=this.model.get("selection"),a={start:n?n.start():0,end:n?n.end():null}
let i
i=t?d.createElement(XD,{visibilityOptions:e,alignment:t,renderAlignmentSVG:this._boundRenderAlignmentSVG,selection:a}):d.createElement("div",null);(0,Me.A9)(i,this.el)
return this}}class ProteinAlignmentRowView extends PolymerAlignmentRowView{constructor(){super(...arguments)
this.mapstate=null}initialize(e){super.initialize(e)
this.row=e.row
this.alignmentRowType=e.alignmentType||null
this.tabstate=this.model
dt.ZP.MOLBIO_ENABLE_ANTIBODY_ENGINEERING_TOOLS&&listenToAntibodyVisibilitySettings(this.visibilityOptions,this,this.renderNameInfo.bind(this))
this.listenTo(this.visibilityOptions.getOption(Yt.P$.name),"change:visible",this.renderNameInfo.bind(this))
this.featureCounts={annotations:this.row.proteinVersion.annotations.length}}getRange(){return this.model.get("range")}getAlignmentRowType(){return this.alignmentRowType}renderRowContent(){var e
return d.createElement(AlignmentRow,{alignmentRowType:null!==(e=this.getAlignmentRowType())&&void 0!==e?e:void 0,canEdit:!1})}getSlice(){return this.model.get("slice")}makeSliceView(){return makeSliceView({alignmentRowType:this.alignmentRowType,tabState:this.tabstate,slice:this.tabstate.get("slice"),visibilityOptions:this.visibilityOptions,row:this.row,forAlignmentPNGExport:!1})}getSelection(){return this.model.get("selection")}getResidueSlice(e,t){return T.residueSlice(this.row.proteinVersion.aminoAcids,e,t,!1)}handlePasteText(e){throw new Error("Unexpected call to handlePasteText: protein alignments are read-only")}handleCtrlShiftC(e){e.preventDefault()}isValidCharacter(e){return ns.IJ(e)}showInputBubble(e){throw new Error("Unexpected call to showInputBubble: protein alignments are read-only")}storeRegionInBenchlingClipboard(e){var t
const n=this.getSelection(),a=this.getResidueSlice(n.start(),null!==(t=n.end())&&void 0!==t?t:void 0)
PO.BR.store(a)
const i=`${this.row.proteinVersion.name}: ${n.start()}-${n.end()}aa`
PO.BR.store(a)
return PO.BR.getHash(a,i)}renderNameInfo(){const e=this.model.get("alignment").alignmentType,t=e===yt.N2.TEMPLATE&&this.model.get("alignment").rows[0];(0,Me.A9)(d.createElement(AlignmentRowInfo,{residues:this.row.proteinVersion.aminoAcids,visibilityOptions:this.visibilityOptions,name:this.row.name,canEdit:!1,isProteinAlignment:!0,alignmentType:e,isReferenceRow:Boolean(this.getAlignmentRowType()),templateResidues:t&&t.proteinVersion.aminoAcids}),this.$el.find(".alignment-row-info-section")[0])}handleContextMenu(e){e.preventDefault()}render(){this.featureCounts.annotations=this.row.proteinVersion.annotations.length
super.render()
this.renderNameInfo()
return this}undo(){(0,Jt.ZT)()}}ProteinAlignmentRowView.initClass()
class ProteinAlignmentRowsView extends s().View{static initClass(){this.prototype.className="scrolling-alignment-rows"}update(){this.rowViews&&this.rowViews.forEach((e=>{e.remove()}))
this.rowViews=this.model.get("alignment").rows.map(((e,t)=>({row:e,i:t}))).filter((({i:e})=>0!==e)).map((({row:e,i:t})=>new ProteinAlignmentRowView({model:this.model,row:e,visibilityOptions:this.model.get("localVisibilityOptionsList")[t]})))
this.rowViews.forEach((e=>{this.rowsContainer.appendChild(e.render().el)}))}resizeSVGs(){this.rowViews.forEach((e=>{e.setSVGWidth()}))}showRange(e=null){this.rowViews.forEach((t=>{t.showRange(e)}))}render(){this.rowsContainer=document.createElement("div")
this.el.appendChild(this.rowsContainer)
this.update()
return this}die(){this.rowViews.forEach((e=>{e.die()}))}remove(){this.die()
super.remove()}}ProteinAlignmentRowsView.initClass()
const ProteinAlignmentStats=e=>{const t=getAminoAcidMatrix(getNonConsensusRows(e.alignment),e.selectionStart,e.selectionEnd),n=Math.round(function getPairwisePercentIdentity(e,t){return 100*getSum(e)/getSum(t)}(getNumMatchingPairs(t),getNumNonGapPairs(t)))
return d.createElement("div",{className:"proteinAlignmentStats"},d.createElement("div",{className:"proteinAlignmentStats-text-container"},d.createElement("div",null,d.createElement("strong",null,"Alignment Statistics")),d.createElement("div",null,"Length: ",function getLength(e){return e[0].length}(t),d.createElement("br",null),"Number of Proteins: ",function getNumProteins(e){return e.length}(t),d.createElement("br",null),"Identical Sites: ",function getIdenticalSites(e){return e[0].filter(((t,n)=>e.map((e=>e[n])).every((e=>aminoAcidMatches(e,t))))).length}(t),d.createElement("br",null),"Pairwise Identity: ",`${n}%`)))}
ProteinAlignmentStats.propTypes={alignment:J().object.isRequired,selectionStart:J().number.isRequired,selectionEnd:J().number}
const eL=ProteinAlignmentStats
var tL=n(816558),nL=n(647812),aL=n.n(nL),iL=n(984152)
const sL=[{color:"#3557CA",text:"Very high (pLDDT > 90)"},{color:"#99C7ED",text:"Confident (90 > pLDDT > 70)"},{color:"#F2DC5B",text:"Low (70 > pLDDT > 50)"},{color:"#D68A59",text:"Very low (pLDDT < 50)"}]
function QualityDataLegend(){return d.createElement(d.Fragment,null,d.createElement("p",{className:(0,g.iv)(rL.title)},"Model confidence"),d.createElement("p",{className:(0,g.iv)(rL.plddtDescription)},"AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100. Some regions below 50 pLDDT may be unstructured in isolation."),sL.map((({color:e,text:t},n)=>d.createElement("div",{key:n},d.createElement("div",{className:(0,g.iv)(rL.colorSwatch),style:{backgroundColor:e}}),d.createElement("span",{className:(0,g.iv)(rL.qualityDescription)},t)))))}const rL=g.mM.create({title:{..._n.gt,fontWeight:_n.KB},plddtDescription:{..._n.E0,color:Vt.pp},qualityDescription:{verticalAlign:"middle"},colorSwatch:{width:"14px",height:"14px",display:"inline-block",marginRight:"8px",verticalAlign:"middle"}})
var oL=n(288817)
async function requestRun(e,t){await function runAlphaFold(e){return Cn.s0({url:"/1/api/proteins:alphafold",data:{proteinId:e}})}(e)
Ml.writeQuery({query:pL},{...t,remainingAlphafoldExecutions:t.remainingAlphafoldExecutions-1})
Ml.writeQuery({query:hL},{protein:{__typename:"ProteinNode",id:e,alphafoldPredictionInProgress:!0}},{proteinId:e})}function getStructureInfoFromVersions(e){if(void 0===e||0===e.length)return{structureFile:null,versionId:null}
const t=e[e.length-1].structures
if(t.length){const n=e[e.length-1].id
return{structureFile:t[0].externalFile,structureFileOutOfDate:!1,versionId:n}}const n=e.flatMap((e=>e.structures.map((t=>({structure:t,versionId:e.id})))))
if(n.length){const{versionId:e,structure:t}=n[n.length-1]
return{structureFile:t.externalFile,structureFileOutOfDate:!0,versionId:e}}return{structureFile:null,versionId:null}}const lL=g.mM.create({text:_n.cf}),cL=function RedoPredictionModal({proteinId:e,onRequestClose:t}){const n={title:"Redo structure prediction",onRequestClose:t,medium:!0},a=(0,Da.IJ)(pL)
if(a.type===Da.NI.ERROR){v.ZP.error("Error when loading user details. Please refresh the page.")
t()
return d.createElement(d.Fragment,null)}if(a.type===Da.NI.PENDING)return d.createElement(et.ZP,{...n},d.createElement(kl.b,null))
{const i=dt.ZP.MOLBIO_ALPHAFOLD_EXECUTION_COUNT_LIMIT,s=a.data.remainingAlphafoldExecutions,r=dt.ZP.MOLBIO_ALPHAFOLD_IS_ACADEMIC?`You have ${s} of ${i} requests remaining this year.`:`You have ${s} of ${i} requests remaining this month across ${a.data.currentTenant.displayName}.`
return d.createElement(et.ZP,{...n,buttons:[{text:"Predict 3D structure",disabled:a.data.remainingAlphafoldExecutions<=0,submit:!0,style:C.ZJ.SECONDARY,onClick:()=>{requestRun(e,a.data);(0,m.L9)(j.Jg.CLICKED_ALPHAFOLD_CONFIRM_REDO_RUN)
t()}}]},d.createElement(d.Fragment,null,d.createElement("p",{className:(0,g.iv)(lL.text)},r," Redoing structure prediction will use up one of those requests."),d.createElement("p",{className:(0,g.iv)(lL.text)},"You will still be able to view the current structure while the new one is being generated."),d.createElement("p",{className:(0,g.iv)(lL.text)},"Would you like to proceed?")))}},dL=1500,uL=`This protein contains at least one non-standard amino acid (${Pn.NON_STANDARD_AMINO_ACIDS.join(", ")}) which cannot produce a valid AlphaFold structure prediction.`
function AlphaFoldPaperLink(){return d.createElement("a",{href:"https://www.nature.com/articles/s41586-021-03819-2",target:"_blank",rel:"noopener noreferrer"},"AlphaFold 2")}function AlphaFoldCitation({className:e}){return d.createElement("p",{className:e},"3D structures are predicted using ",d.createElement(AlphaFoldPaperLink,null),".")}function getRunBlockingMessage(e,t,n){return n<=0?"You do not have any AlphaFold runs available currently.":t.polymerFeaturesEditable?(0,y.containsNonStandardAminoAcids)(e)?uL:e.length>dL?"At the moment, you cannot request structures for sequences with over 1500 residues.":0===e.length?"You cannot run AlphaFold on this AA sequence since it does not contain any residues.":null:"You do not have sufficient permissions to request a structure for this AA sequence."}const mL=xa.Ps`
  query UserVerificationStatusQuery @skipAudit @engComponent(name: MOLBIO) {
    currentUser {
      id
      institution {
        id
        verified
      }
      verified
    }
  }
`,pL=xa.Ps`
  query RemainingExecutionsAndTenantNameQuery @skipAudit @engComponent(name: MOLBIO) {
    remainingAlphafoldExecutions
    currentTenant {
      ... on TenantNode {
        id
        displayName
      }
    }
  }
`
function ViewerPane({structureFile:e,structureFileOutOfDate:t,predictionInProgress:n,proteinId:a,structureProteinVersionId:i,aminoAcids:s,permissions:r,selectionStart:o,selectionEnd:l,renderWarningMessage:c}){var u
const p=(0,Pu.Z)(e),[h,E]=(0,d.useState)(null),S=(0,Da.IJ)(mL);(0,d.useEffect)((()=>{if(e&&!Is()(e,p)){(async()=>{const t=await(0,qS.V)(e.id,e.url,a,i)
null==t?v.ZP.error("Error fetching structure file. Please refresh the page."):E(t)})()}}),[e,p,a,i])
if(S.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(S.type===Da.NI.ERROR){v.ZP.error("Error when loading AlphaFold details. Please refresh the page.")
return d.createElement(d.Fragment,null)}if(null==e)return d.createElement("div",{className:(0,g.iv)(gL.smallTabSpacing)},d.createElement("p",{className:(0,g.iv)(gL.largestText)},"Predicting 3D structure..."),d.createElement("p",{className:(0,g.iv)(gL.smallerText)},"This could take some time. You will receive an email when it’s ready."),d.createElement(AlphaFoldCitation,{className:(0,g.iv)(gL.smallerText)}))
{const i=S.data.currentUser
let p=null
if(t){p="This structure is out of sync."
p=n?`${p} You’ll receive an email when your updated structure is ready.`:getRunBlockingMessage(s,r,1)?`${p} ${getRunBlockingMessage(s,r,1)}`:!dt.ZP.MOLBIO_ALPHAFOLD_IS_ACADEMIC||(null===(u=null==i?void 0:i.institution)||void 0===u?void 0:u.verified)&&(null==i?void 0:i.verified)?d.createElement("span",null,p," ",d.createElement(C.Co,{buttonStyle:C.ZJ.LINK,className:(0,g.iv)(gL.buttonLinkText),text:"Redo structure prediction",onClick:()=>{(0,m.L9)(j.Jg.CLICKED_ALPHAFOLD_REDO_RUN);(0,Xn.Z)(cL,{proteinId:a})}}),"."):`${p} AlphaFold is only available to verified academic users from verified institutions.`}return null==h?d.createElement(kl.b,null):d.createElement("div",{className:(0,g.iv)(gL.viewerWrapper)},p&&c(p),d.createElement(oL.Z,{url:h,format:oL.e[e.previewType],className:f()("reset",(0,g.iv)(gL.viewer)),interactionAnalyticsCallback:()=>{(0,m.L9)(j.Jg.INTERACTED_ALPHAFOLD_VIEWER)},residueStart:t?void 0:o,residueEnd:t?void 0:l}))}}const hL=xa.Ps`
  query HasInProgressAlphaFoldPredictionQuery($proteinId: StrictString!) @skipAudit {
    protein(id: $proteinId) {
      ... on ProteinNode {
        id
        alphafoldPredictionInProgress
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class AlphaFoldTabContentConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const e=this.proteinStore(),t=e.getProteinById(this.props.proteinId),{start:n,end:a}=e.getSelection(this.props.proteinId)
return{versions:e.getVersionsById(this.props.proteinId),aminoAcids:t.version.aminoAcids,permissions:t.permissions,selectionStart:n,selectionEnd:a}}}function AlphaFoldLandingPage({aminoAcids:e,permissions:t,predictionInProgress:n,proteinId:a}){var i
const s=(0,Da.IJ)(pL),r=(0,Da.IJ)(mL)
if(s.type===Da.NI.PENDING||r.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(s.type===Da.NI.ERROR||r.type===Da.NI.ERROR){v.ZP.error("Error when loading AlphaFold details. Please refresh the page.")
return d.createElement(d.Fragment,null)}let o="Predict 3D structure",l=d.createElement(d.Fragment,null,"Predict structures of proteins up to ",dL," residues using ",d.createElement(AlphaFoldPaperLink,null))
if(n){o="Predicting 3D structure..."
l="This could take some time. You will receive an email when the structure is ready."}const c=r.data.currentUser
let u=null
u=!dt.ZP.MOLBIO_ALPHAFOLD_IS_ACADEMIC||(null===(i=null==c?void 0:c.institution)||void 0===i?void 0:i.verified)&&(null==c?void 0:c.verified)?getRunBlockingMessage(e,t,s.data.remainingAlphafoldExecutions):"AlphaFold is only available to verified academic users from verified institutions."
return d.createElement(d.Fragment,null,u&&d.createElement("div",{className:(0,g.iv)(gL.largeInlineBannerMargin)},d.createElement(io.ZP,{text:u,bannerType:io.ct.WARNING})),d.createElement("div",{className:(0,g.iv)(gL.centered,gL.imgMargin)},d.createElement("img",{width:255,height:175,src:(0,me.Z)("/static/img/alphafold_example_quality_structure.png")})),d.createElement("p",{className:(0,g.iv)(gL.largestText,gL.centered)},o),d.createElement("p",{className:(0,g.iv)(gL.smallerText,gL.grayDarker,gL.centered)},l),!n&&d.createElement("div",{className:(0,g.iv)(gL.centered)},d.createElement(C.Co,{disabled:null!=u,onClick:()=>{requestRun(a,s.data);(0,m.L9)(j.Jg.REQUESTED_ALPHAFOLD_RUN)},buttonStyle:C.ZJ.SECONDARY,text:"Predict 3D structure",size:C.qE.MEDIUM,className:(0,g.iv)(gL.predictButton)})))}const gL=g.mM.create({grayDarker:{color:Vt.pp},smallTabSpacing:{margin:"16px"},centered:{display:"flex",justifyContent:"center"},largestText:_n.nX,smallerText:_n.cf,imgMargin:{margin:"34px 0px"},predictButton:{margin:"30px 0px 12px"},buttonLinkText:{verticalAlign:"baseline"},viewerWrapper:{display:"flex",flexDirection:"column",height:"100%"},viewer:{borderWidth:"0px",flex:"1 1 auto"},largeInlineBannerMargin:{margin:"18px 11px"},smallInlineBannerMargin:{margin:"4px"}}),EL=AlphaFoldTabContentConnector.connect((function AlphaFoldTabContent({proteinId:e,versions:t,aminoAcids:n,permissions:a,selectionStart:i,selectionEnd:s}){const r=getStructureInfoFromVersions(t),o=(0,Da.IJ)(hL,{variables:{proteinId:e}})
if(o.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(o.type===Da.NI.ERROR){v.ZP.error("Error loading AlphaFold details. Please refresh the page.")
return d.createElement(d.Fragment,null)}const l=o.type===Da.NI.SUCCESS&&!(0,ka.CZ)(o.data.protein)&&o.data.protein.alphafoldPredictionInProgress
return null!=r.structureFile?d.createElement(ViewerPane,{structureFile:r.structureFile,structureFileOutOfDate:Boolean(r.structureFile&&r.structureFileOutOfDate),predictionInProgress:l,proteinId:e,structureProteinVersionId:r.versionId,aminoAcids:n,permissions:a,selectionStart:i,selectionEnd:s,renderWarningMessage:e=>d.createElement("div",{className:(0,g.iv)(gL.smallInlineBannerMargin)},d.createElement(io.ZP,{text:e,bannerType:io.ct.WARNING}))}):d.createElement(AlphaFoldLandingPage,{aminoAcids:n,permissions:a,predictionInProgress:l,proteinId:e})}))
function AlphaFoldTabView_getTooltipText(e){const t=dt.ZP.MOLBIO_ALPHAFOLD_IS_ACADEMIC?"year":"month",n=Zd().tz("America/Los_Angeles").add(1,t).startOf(t),a=dt.ZP.MOLBIO_ALPHAFOLD_IS_ACADEMIC?"":` across ${e}`
return`You have a total of ${dt.ZP.MOLBIO_ALPHAFOLD_EXECUTION_COUNT_LIMIT} requests per ${t}${a}. Requests will reset back to ${dt.ZP.MOLBIO_ALPHAFOLD_EXECUTION_COUNT_LIMIT} on ${n.format("LT z")} at the start of every calendar ${t}.`}class AlphaFoldOptionsConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const{structureFile:e,versionId:t}=getStructureInfoFromVersions(this.proteinStore().getVersionsById(this.props.proteinId))
return{structureFile:e,proteinId:this.props.proteinId,structureProteinVersionId:t}}}const fL=AlphaFoldOptionsConnector.connect((function AlphaFoldOptions({structureFile:e,proteinId:t,structureProteinVersionId:n}){const a=(0,Da.IJ)(pL),[i,s]=(0,d.useState)({isOpen:!0,interaction:ne.x2.CONTROLLED});(0,d.useEffect)((()=>{const e=setTimeout((()=>{s({interaction:ne.x2.HOVER})}),5e3)
return()=>{clearTimeout(e)}}),[])
if(null!=e&&null!=n)return d.createElement("div",{className:(0,g.iv)(SL.optionButtonsLayout)},d.createElement("div",null,d.createElement(Oe.Z,{...i,placement:ne.ZH.RIGHT_START,renderContent:()=>d.createElement(QualityDataLegend,null)},d.createElement(pe.Z,{icon:"info-circle",className:(0,g.iv)(SL.infoIcon)})),d.createElement("span",{className:(0,g.iv)(SL.infoText)},"Model confidence")),d.createElement(C.Co,{className:(0,g.iv)(SL.withoutButtonFocusStyling),text:"Download "+(e.previewType===iL.g.MOLSTAR_MMCIF_VIEWER?"mmCIF (PDBx)":"PDB"),buttonStyle:C.ZJ.PRIMARY,size:C.qE.MINI,onClick:()=>async function downloadStructureFile(e,t,n){const a=await(0,qS.V)(e.id,e.url,t,n)
if(null!=a){window.open(a,"_blank","noopener noreferrer");(0,m.L9)(j.Jg.DOWNLOADED_ALPHAFOLD_STRUCTURE)}}(e,t,n)}))
{const e=dt.ZP.MOLBIO_ALPHAFOLD_EXECUTION_COUNT_LIMIT
return d.createElement("div",{className:(0,g.iv)(SL.optionButtonsLayout)},a.type===Da.NI.SUCCESS&&d.createElement("div",null,d.createElement(P.ZP,{title:AlphaFoldTabView_getTooltipText(a.data.currentTenant.displayName)},d.createElement(pe.Z,{icon:"info-circle",className:(0,g.iv)(SL.infoIcon)})),d.createElement("span",{className:(0,g.iv)(SL.infoText)},a.data.remainingAlphafoldExecutions," of ",e," requests remaining")))}}))
class AlphaFoldOptionsView extends s().View{render(){const e=this.model.protein().id;(0,Me.A9)(d.createElement(fL,{proteinId:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}class AlphaFoldTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){(0,Me.A9)(d.createElement(EL,{proteinId:this.model.protein().id}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}AlphaFoldTabView.initClass()
const SL=g.mM.create({infoIcon:{color:Vt.pp},infoText:{..._n.cf,marginLeft:"8px"},optionButtonsLayout:{padding:"0px 7px",display:"flex",justifyContent:"space-between",alignItems:"center",height:"35px"},largerText:_n.cf,withoutButtonFocusStyling:{":focus":{textDecoration:"none"}}}),yL={tabView:AlphaFoldTabView,optionsView:AlphaFoldOptionsView}
var bL=n(540425),TL=n(485271),vL=n(47550)
function AssemblyHistoryTabContents({polymerId:e,activeVersionId:t,showingCurrentVersion:n}){const a=(0,Da.IJ)(TL.DY,{variables:{entityId:e},renderCachedDataWhenRefetching:!0}),{refetch:i}=a;(0,d.useEffect)((()=>{n&&i()}),[t,n,i])
if(a.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(a.type===Da.NI.ERROR){v.ZP.error("Error fetching assembly history.")
return d.createElement(d.Fragment,null)}return null==a.data.assemblyHistory||(0,ka.CZ)(a.data.assemblyHistory)?d.createElement(io.ZP,{text:"There was an error loading assembly history for this item.",bannerType:io.ct.ERROR}):d.createElement("div",{className:(0,g.iv)(CL.contentsContainer)},d.createElement(vL.ZP,{event:a.data.assemblyHistory,onClickCreatedAt:null,showAsStandalone:!0,index:0}))}const CL=g.mM.create({contentsContainer:{padding:"12px 12px 12px 24px"}})
function VisualHistoryEventList({events:e,onClickVersion:t}){const n=e.map(((e,n)=>d.createElement(vL.ZP,{key:n,event:e,onClickCreatedAt:t,index:n})))
return d.createElement("div",{className:(0,g.iv)(IL.listContainer)},n)}const IL=g.mM.create({listContainer:{borderLeft:`2px solid ${Vt.pp}`,padding:"16px 0","::before":{position:"absolute",left:"29px",top:"6px",content:'""',borderTop:"2px solid transparent",borderBottom:`12px solid ${Vt.pp}`,borderLeft:"6px solid transparent",borderRight:"6px solid transparent"}}})
var wL=n(229164),NL=n(507812)
const AL=xa.Ps`
  query VisualHistoryQuery($entityVersionId: EntityVersionIdInputNode!)
  @engComponent(name: MOLBIO)
  @skipAudit {
    visualHistory(entityVersionId: $entityVersionId) {
      ... on VisualHistoryNode {
        events {
          ...VisualHistoryEventListItemFragment
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${vL.df}
  ${wL.uQ}
  ${NL.j3}
  ${NL.zl}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function VisualHistoryTabContents({entityId:e,entityType:t,entityVersionId:n,onClickVersion:a}){const i=(0,Da.IJ)(AL,{variables:{entityVersionId:{entityId:e,entityType:t,entityVersionId:n.toString()}}})
let s
if(i.type===Da.NI.PENDING)s=d.createElement(kl.Z,null)
else if(i.type===Da.NI.SUCCESS){const e=(0,ka.CZ)(i.data.visualHistory)?null:i.data.visualHistory
s=null!=e?d.createElement(VisualHistoryEventList,{events:e.events,onClickVersion:e=>{a(Number.parseInt(e,10))}}):d.createElement(io.ZP,{text:"You don't have permissions to view visual history for this item.",bannerType:io.ct.WARNING})}else i.type===Da.NI.ERROR&&(s=d.createElement(io.ZP,{text:"There was an error loading visual history for this item.",bannerType:io.ct.ERROR}))
return d.createElement("div",{className:(0,g.iv)(RL.contentsContainer)},s)}const RL=g.mM.create({contentsContainer:{padding:"8px 8px 8px 24px"}})
class VisualHistoryTabView extends Js{constructor(){super(...arguments)
this.viewedEvent=vc.Jg.VIEWED_VISUAL_HISTORY_TAB}initialize(){super.initialize()
this.registerListeners()}afterAttach(){super.afterAttach()
m.L9(this.viewedEvent,{polymerId:this.model.polymer().id})}render(){let e
e=this.getPolymer()instanceof Ge.Sequence?"sequence":"protein";(0,Me.A9)(d.createElement(VisualHistoryTabContents,{entityId:this.getPolymer().id,entityType:e,entityVersionId:this.getPolymer().getActiveVersionId(),onClickVersion:this.onClickVersion.bind(this)}),this.el)
return this}registerListeners(){this.listenTo(this.getPolymer(),"change:activeVersionId change:currentVersion change:protein",this.render.bind(this))}onClickVersion(e){const t=this.getPolymer()
if(t instanceof Ge.Sequence){const n=t.get("versions").findWhere({id:e})
t.viewVersion(n)}else Ea.Z.open(t.id,{versionId:e})}getPolymer(){return this.model.get("polymer")}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}var PL=n(919634)
class VisualHistoryTabState extends PL.Z{onClick(){super.onClick()
m.L9(vc.Jg.CLICKED_VISUAL_HISTORY_TAB,{polymerId:this.polymer().id})}defaults(){return{...super.defaults(),title:"Visual history",closeable:!1,preferenceKey:"visual-history"}}}const OL=VisualHistoryTabState
var xL=n(863017),_L=n(399980),DL=n(944512),LL=n(140985),kL=n(596999),ML=n(990658),FL=n(561887)
class ProtocolViewComponent extends d.Component{componentDidMount(){null!=this.props.protocol&&"function"==typeof this.props.onLoad&&this.props.onLoad()}componentDidUpdate(e,t){const{saving:n}=this.props,a=this.props.savedVersion!==this.props.openVersion,i=this.props.saveSuccess
n||a?i?"function"==typeof this.props.onSaving&&this.props.onSaving():"function"==typeof this.props.onRetrying&&this.props.onRetrying():"function"==typeof this.props.onSaved&&this.props.onSaved()
null!=this.props.protocol&&null==e.protocol&&"function"==typeof this.props.onLoad&&this.props.onLoad()}render(){return null==this.props.protocol?d.createElement("div",null,"Loading..."):d.createElement("div",{className:"protocol-view-component"},d.createElement(FL.Z,{currentVersion:this.props.protocol,historyManager:this.props.historyManager,restoreStateAndSelection:this.props.revertProtocol,renderWith:({metadataForRestore:e,storeState:t,restoreState:n,requestSelection:a,undoStoreState:i})=>d.createElement(kL.Z,{banner:this.props.banner,fileId:this.props.fileId,protocol:this.props.protocol,printHandler:this.props.printHandler,showToolbar:!0,locked:this.props.locked,moreFormats:this.props.moreFormats,printOptions:this.props.printOptions,updateProtocol:this.props.locked?void 0:this.props.updateProtocol,revertProtocol:this.props.locked?void 0:this.props.revertProtocol,openManageSelectorsModal:this.props.openManageSelectorsModal,displayOptions:this.props.displayOptions,spellCheck:this.props.spellCheck,printLayout:this.props.printLayout,showPrintMargins:this.props.showPrintMargins,metadataForRestore:e,storeState:t,undoStoreState:i,restoreState:n,requestSelection:a})}))}}!function ProtocolViewComponent_defineProperty(e,t,n){(t=function ProtocolViewComponent_toPropertyKey(e){var t=function ProtocolViewComponent_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}(ProtocolViewComponent,"propTypes",{banner:J().string,fileId:J().string.isRequired,onSaving:J().func,onRetrying:J().func,onSaved:J().func,locked:J().bool.isRequired,printHandler:J().func,printOptions:J().array,openManageSelectorsModal:J().func.isRequired,historyManager:J().instanceOf(ML.Z),spellCheck:J().bool.isRequired,printLayout:J().bool.isRequired,showPrintMargins:J().bool.isRequired})
const ZL=ProtocolViewComponent
class EntryProtocolTabViewComponent extends d.Component{constructor(e){super(e)
this.toggleManageSelectorsModal=(e,t,n)=>{t.showManageSelectorsModal?Xe.bA(LL.Z,d.createElement(LL.Z,{...n})):e.showManageSelectorsModal&&!t.showManageSelectorsModal&&this.closeManageSelectorsModal()}
this.openManageSelectorsModal=e=>{this.setState({showManageSelectorsModal:!0,initialSelectorId:e})}
this.closeManageSelectorsModal=()=>{this.setState({showManageSelectorsModal:!1,initialSelectorId:null})
Xe.xv(LL.Z)}
this.updateSelectors=e=>{const t=Q()(this.props.protocol,{$merge:{selectors:e}})
this.props.updateProtocol(t)}
this.getMoreFormats=e=>({moreFormats:[{format:"selector",moreKey:"default",tooltip:[e.locked?"Manage Selectors":"View Selectors"],onClick:this.openManageSelectorsModal},{format:"original-protocol",tooltip:["Open Original Protocol"],moreKey:"default",onClick(){null!=e.protocol.originalProtocolId?ve.ZP.get().openFolderItem(e.protocol.originalProtocolId):v.ZP.error("The original protocol was deleted.")}}]})
this.setMoreFormats=e=>{this.setState(this.getMoreFormats(e))}
this.state={historyManager:new ML.Z,showManageSelectorsModal:!1,initialSelectorId:null,...this.getMoreFormats(e)}}UNSAFE_componentWillReceiveProps(e){this.props.protocol.originalProtocolId===e.protocol.originalProtocolId&&this.props.locked===e.locked||this.setMoreFormats(e)}componentDidUpdate(e,t){const n={initialSelectorId:this.state.initialSelectorId,locked:this.props.locked,parentType:"Protocol",selectorsLink:{value:this.props.protocol.selectors,requestChange:this.updateSelectors,selectorUsageCounts:LL.Z.countSelectors(this.props.protocol.steps)},onRequestClose:this.closeManageSelectorsModal}
this.toggleManageSelectorsModal(t,this.state,n)}render(){return d.createElement("div",null,d.createElement(ZL,{...l.default.extend({},this.props,{historyManager:this.state.historyManager,openManageSelectorsModal:this.openManageSelectorsModal,moreFormats:this.state.moreFormats})}))}}class EntryProtocolTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"
this.prototype.printOptions=["protocol","entry"]}initialize(){this.revertProtocol=this.revertProtocol.bind(this)
this.updateProtocol=this.updateProtocol.bind(this)
this.onLoadProtocol=this.onLoadProtocol.bind(this)
this.listenTo(this.model.file(),"change",this.render)
this.listenTo(this.model.get("displayOptions"),"redraw",this.render)}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}revertProtocol(e,t){this.model.revertProtocol(e,t)}updateProtocol(e){this.model.updateProtocol({$merge:e})}onLoadProtocol(){const e=this.$(".protocolEditor-pageContainer")
e.scroll((()=>this.model.set("scrollTop",e.scrollTop())))
l.default.defer((()=>this.$(".protocolEditor-pageContainer").scrollTop(this.model.get("scrollTop"))))}render(){const e=this.model.protocol(),t=this.model.file(),n=this.model.get("displayOptions").getOption(Yt.hC.name),a=d.createElement(EntryProtocolTabViewComponent,{banner:t.getBannerText(),fileId:this.model.file().id,protocol:e,locked:!t.allowEdits(),printHandler:this.model.printHandler,printOptions:this.model.printOptions(),protocolID:e.id,updateProtocol:this.updateProtocol,revertProtocol:this.revertProtocol,displayOptions:this.model.get("displayOptions"),spellCheck:this.model.get("displayOptions").getOption(Yt.Q8.name).get("visible"),printLayout:n.get("visible"),showPrintMargins:n.isSettingChecked(Yt.Ub.name),onLoad:this.onLoadProtocol});(0,Me.A9)(a,this.el)
return this}}EntryProtocolTabView.initClass()
var BL=n(537073),qL=n(95018),VL=n(860811),UL=n(707870),GL=n(142893)
function NoteTabView_ownKeys(e,t){var n=Object.keys(e)
if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e)
t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function NoteTabView_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{}
t%2?NoteTabView_ownKeys(Object(n),!0).forEach((function(t){NoteTabView_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NoteTabView_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function NoteTabView_defineProperty(e,t,n){(t=function NoteTabView_toPropertyKey(e){var t=function NoteTabView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}function NoteTabView_guard_(e,t){return null!=e?t(e):void 0}class NoteTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}initialize(){this.noteOnLoad=this.noteOnLoad.bind(this)
this._getScrollingPerfMetadata=this._getScrollingPerfMetadata.bind(this);(0,as.on)(this.model.get("model"))}render(){this.listenTo(this.model.get("model"),"change",this.rerender)
this.listenTo(this.model.get("displayOptions"),"redraw",this.rerender)
this.rerender()
return this}noteOnLoad(){const e=Li.BL(`${ea.ZP.apiIdToType(this.model.get("fileId"))}_note_view_scroll`,{enabled:!0,getMetadata:this._getScrollingPerfMetadata},{interval:6e4,aggregations:[Li.Pe.MEDIAN,Li.Pe.MAX]})
Li.hY(e)
const t=this.$(".noteEditor-container")
t.scroll((()=>this.model.set({scrollTop:t.scrollTop()},{silent:!0})))
l.default.defer((()=>{t.scrollTop(this.model.get("scrollTop"))
Li.Eb(e)}))}afterAttach(){this.rerender()}getRootFolderId(){var e,t
const{attributes:n}=this.model.get("model")
return null!=(e=null==n||null==(t=n.entry)||null==(t=t.folder)||null==(t=t.source)?void 0:t.id)?e:null}getTemplateCollectionId(){var e,t
const{attributes:n}=this.model.get("model")
return null!=(e=null==(t=n.template)||null==(t=t.templateCollection)?void 0:t.id)?e:null}_getScrollingPerfMetadata(){const{attributes:e}=this.model.get("model")
return e&&e.entry?{entryId:e.entry.entryId}:{}}rerender(){const e=NoteTabView_objectSpread(NoteTabView_objectSpread({},getSharedNoteViewProps(this.model)),{},{onLoad:this.noteOnLoad}),t=this.model.get("displayOptions").getOption(Yt.rB.name).get("visible"),n=this.model.get("displayOptions").getOption(Yt.vJ.name).get("visible"),a=this.model.get("model").getBannerText()
l.default.extend(e,(()=>{switch(this.model.get("model").fileType()){case st.ENTRY:return{banner:a,note:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.note)),structuredTableMappings:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.structuredTableMappings)),dirty:this.model.get("model").isDirty(),isLatest:this.model.get("model").isLatest(),title:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.name)),parentType:"Entry",review:this.model.get("model").review(),printOptions:this.model.get("model").get("entry").entryProtocols.length>0?VA.fF.PRINT_OPTIONS:VA.fF.PRINT_OPTIONS_WITHOUT_PROTOCOLS,collaboratorIds:this.model.get("model").collaboratorIds(),templateId:this.model.get("model").templateId(),lockedFromExternalChange:this.model.get("model").lockedFromExternalChange(),authors:this.model.get("model").authors()}
case st.STAGE_ENTRY:return{banner:a,note:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.entryVersion.note)),isLatest:this.model.get("model").isLatest(),title:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.name)),review:this.model.get("model").review(),parentType:"Workflow Entry",printOptions:this.model.get("model").get("stageEntryDocument").entryVersion.entryProtocols.length>0?VA.fF.PRINT_OPTIONS:VA.fF.PRINT_OPTIONS_WITHOUT_PROTOCOLS,lockedFromExternalChange:this.model.get("model").lockedFromExternalChange()}
case st.TEMPLATE:return{banner:a,note:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.templateVersion.entryVersion.note)),structuredTableMappings:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.templateVersion.entryVersion.structuredTableMappings)),isLatest:this.model.get("model").isLatest(),title:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.name)),parentType:"Template",printOptions:this.model.get("model").get("template").templateVersion.entryVersion.entryProtocols.length>0?VA.j3.PRINT_OPTIONS:VA.j3.PRINT_OPTIONS_WITHOUT_PROTOCOLS,lockedFromExternalChange:this.model.get("model").lockedFromExternalChange()}
case st.SUBTEMPLATE:return{banner:a,note:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.subtemplateVersion.noteVersion)),isLatest:this.model.get("model").isLatest(),title:NoteTabView_guard_(this.model.get("model").proxied(),(e=>e.name)),parentType:"Sub-template",printOptions:VA.xU.PRINT_OPTIONS,lockedFromExternalChange:this.model.get("model").lockedFromExternalChange()}
default:return NoteTabView_objectSpread({},getDedicatedGeneralNoteViewProps(this.model))}})())
const i=(()=>{switch(this.model.get("model").fileType()){case st.ENTRY:return VA.fF
case st.STAGE_ENTRY:return GL.Z
case st.TEMPLATE:return VA.j3
case st.SUBTEMPLATE:return VA.xU
default:return UA}})()
Me.A9(d.createElement(BA.k.Provider,{value:{note:e.note}},d.createElement(BA.q.Provider,{value:{showFormulas:t,highlightCustomColumns:n,rootFolderId:this.getRootFolderId(),fileId:e.fileId,templateCollectionId:this.getTemplateCollectionId()}},d.createElement(i,e))),this.el)}_removeWithoutCleanData(){this.$el.detach()
this.stopListening()}remove(){Li.sT(this.scrollingPerf)
u.unmountComponentAtNode(this.el)
this._removeWithoutCleanData()}}NoteTabView.initClass()
var zL=n(48835),$L=n(707521)
class ProtocolTabViewComponent extends d.Component{constructor(e){super(e)
this.state={showManageSelectorsModal:!1,initialSelectorId:null}
this.toggleManageSelectorsModal=(e,t,n)=>{t.showManageSelectorsModal?Xe.bA(LL.Z,d.createElement(LL.Z,{...n})):e.showManageSelectorsModal&&!t.showManageSelectorsModal&&this.closeManageSelectorsModal()}
this.openManageSelectorsModal=e=>{this.setState({showManageSelectorsModal:!0,initialSelectorId:e})}
this.closeManageSelectorsModal=()=>{this.setState({showManageSelectorsModal:!1,initialSelectorId:null})
Xe.xv(LL.Z)}
this.getMoreFormats=e=>({moreFormats:[{format:"selector",moreKey:"default",tooltip:[e.locked?"View Selectors":"Manage Selectors"],onClick:this.openManageSelectorsModal}]})
this.setMoreFormats=e=>{this.setState(this.getMoreFormats(e))}
this.updateSelectors=e=>{const t=Q()(this.props.protocol,{$merge:{selectors:e}})
this.props.updateProtocol(t)}
this.state={showManageSelectorsModal:!1,initialSelectorId:null,...this.getMoreFormats(e)}}UNSAFE_componentWillReceiveProps(e){this.props.locked!==e.locked&&this.setMoreFormats(e)}componentDidUpdate(e,t){const n={initialSelectorId:this.state.initialSelectorId,locked:this.props.locked,parentType:"Protocol",selectorsLink:{value:this.props.protocol.selectors,requestChange:this.updateSelectors,selectorUsageCounts:LL.Z.countSelectors(this.props.protocol.steps)},onRequestClose:this.closeManageSelectorsModal}
this.toggleManageSelectorsModal(t,this.state,n)}render(){return d.createElement(ZL,{...l.default.extend({},this.props,{openManageSelectorsModal:this.openManageSelectorsModal,moreFormats:this.state.moreFormats})})}}class ProtocolTabView_TabView extends s().View{static initClass(){this.prototype.className="protocol-tab buffer-tab buffer-tab--no-padding"
this.prototype.printOptions=["protocol"]}initialize(){this.updateProtocol=this.updateProtocol.bind(this)
this.revertProtocol=this.revertProtocol.bind(this)
this.printHandler=this.printHandler.bind(this)
this.listenTo(this.model.get("protocol"),"change",this.rerender)
this.listenTo(this.model.get("displayOptions"),"redraw",this.rerender)}render(){this.$el.html('<div class="protocol-mount"></div>')
this.rerender()
return this}updateProtocol(e){$L.Z.update(this.model.get("protocol").proxied().id,{$merge:e})}revertProtocol(e,t){$L.Z.revert(this.model.get("protocol").proxied().id,e,t)}printHandler(){$L.Z.print(this.model.get("protocol").proxied().id)}rerender(){const e=this.model.get("protocol"),t=this.model.get("displayOptions").getOption(Yt.hC.name),n=d.createElement(ProtocolTabViewComponent,{banner:e.getBannerText(),fileId:this.model.get("protocol").proxied().id,protocol:e.proxied(),locked:!e.allowEdits(),saving:e.get("saving"),savedVersion:e.get("savedVersion"),openVersion:e.get("openVersion"),historyManager:e.get("historyManager"),updateProtocol:this.updateProtocol,revertProtocol:this.revertProtocol,printHandler:this.printHandler,printOptions:this.printOptions,displayOptions:this.model.get("displayOptions"),spellCheck:this.model.get("displayOptions").getOption(Yt.Q8.name).get("visible"),printLayout:t.get("visible"),showPrintMargins:t.isSettingChecked(Yt.Ub.name)});(0,Me.A9)(n,this.$(".protocol-mount")[0])
const a=this.$(".protocolEditor-pageContainer")
a.scroll((()=>this.model.set("scrollTop",a.scrollTop())))}afterAttach(){this.$(".protocolEditor-pageContainer").scrollTop(this.model.get("scrollTop"))}remove(){u.unmountComponentAtNode(this.$(".protocol-mount")[0])
return super.remove()}}ProtocolTabView_TabView.initClass()
var WL=n(523670),HL=n(841996),jL=n(643171),YL=n(438089),QL=n(719690),KL=n(126781)
class CheckableReviewCriterionRow extends d.Component{constructor(){super(...arguments)
this.state={savingStatus:null}
this._toggleStatus=async e=>{try{const t=this.props.reviewCriterion.status===e?YL.JY.UNREVIEWED:e
this.setState({savingStatus:t})
await this.props.updateReviewCriterion(this.props.reviewCriterion.id,{status:t})}finally{this.setState({savingStatus:null})}}
this._handleSetStatusFailed=()=>{this._toggleStatus(YL.JY.FAILED)}
this._handleSetStatusPassed=()=>{this._toggleStatus(YL.JY.PASSED)}}render(){const{review:e,reviewCriterion:t}=this.props,n=`criterion-row-${t.id}`,a=e&&e.status===KL.ZP.NEEDS_REVIEW&&this.props.enabled&&null==this.state.savingStatus;(0,S.Gp)(null!=this.props.updateReviewCriterion||!a,"updateReviewCriterion must be specified if pass/fail is settable")
const i=this.state.savingStatus||t.status
return d.createElement("div",{className:"simpleDivTable-row"},d.createElement("div",{className:"checkableCriterionRow-container"},d.createElement("div",{className:"checkableCriterionRow-passFail"},d.createElement("input",{type:"radio",name:n,disabled:!a,checked:i===YL.JY.PASSED,onChange:this._handleSetStatusPassed})),d.createElement("div",{className:"checkableCriterionRow-passFail u-small-spacing-right"},d.createElement("input",{type:"radio",name:n,disabled:!a,checked:i===YL.JY.FAILED,onChange:this._handleSetStatusFailed})),d.createElement("div",{className:"checkableCriterionRow-text"},this.props.reviewCriterion.text)))}}const JL=CheckableReviewCriterionRow
function ReviewCriteriaGroupHeader(e){return d.createElement("div",{className:"simpleDivTable-header"},d.createElement("div",{className:"simpleDivTable-headerCell"},d.createElement("div",{className:"u-spacing-bottom"},e.renderGroupName()),d.createElement("div",{className:"checkableCriterionRow-container"},e.shouldRenderPassFail&&d.createElement("div",{className:"checkableCriterionRow-passFail"},d.createElement(so.As,null,"Pass")),e.shouldRenderPassFail&&d.createElement("div",{className:"checkableCriterionRow-passFail u-small-spacing-right"},d.createElement(so.As,null,"Fail")),d.createElement("div",{className:"checkableCriterionRow-text"},d.createElement(so.As,null,"Criteria ",e.onAddCriterion&&d.createElement(vy.Z,{onClick:e.onAddCriterion}))))),d.createElement("div",{className:"simpleDivTable-headerCell u-text-align-right"},e.renderControls&&e.renderControls()))}ReviewCriteriaGroupHeader.propTypes={onAddCriterion:J().func,renderControls:J().func,renderGroupName:J().func.isRequired,shouldRenderPassFail:J().bool.isRequired}
ReviewCriteriaGroupHeader.defaultProps={shouldRenderPassFail:!0}
function CriterionRow({reviewCriterion:e,isEditing:t,onChangeCriterion:n,onDeleteCriterion:a}){return t?d.createElement("div",{className:"simpleDivTable-row"},d.createElement("div",{className:"u-width-full flex-row-center"},d.createElement(_t.Z,{autoFocus:!1,value:e.text,onChange:n}),d.createElement("a",{className:"faded u-danger-pointer u-small-padding-left",onClick:a},d.createElement(pe.Z,{icon:"delete"})))):d.createElement(JL,{reviewCriterion:e,enabled:!1})}class ReviewCriteriaGroupConfig extends d.Component{constructor(){super(...arguments)
this._handleAddCriterion=()=>{this.props.savingState===YL.Uw.NOT_EDITING&&this.props.onStartEdit(this.props.reviewCriteriaGroup)
this.props.onAddCriterion(this.props.reviewCriteriaGroup.id)}
this._handleCancelEdit=()=>{this.props.onCancelEdit(this.props.reviewCriteriaGroup.id)}
this._handleChangeGroupName=e=>{this.props.onChangeGroupName(this.props.reviewCriteriaGroup.id,e.target.value)}
this._handleDelete=()=>{je.iG("Confirm Delete","Are you sure you wish to delete this review criteria group? This action cannot be undone.","danger").done((()=>this.props.onDeleteReviewCriteriaGroup(this.props.reviewCriteriaGroup.id)))}
this._handleSave=()=>{this.props.onSaveReviewCriteriaGroup(this.props.reviewCriteriaGroup)}
this._handleStartEdit=()=>{this.props.onStartEdit(this.props.reviewCriteriaGroup)}}componentDidMount(){if(this.props.pendingScrollIntoView){u.findDOMNode(this).scrollIntoView()
this.props.onScrollIntoView()}}render(){return d.createElement("div",{className:"reviewCriteriaGroupConfig"},d.createElement("div",{className:"simpleDivTable"},d.createElement(ReviewCriteriaGroupHeader,{onAddCriterion:this.props.writable&&this.props.savingState!==YL.Uw.SAVING?this._handleAddCriterion:null,renderGroupName:()=>this.props.savingState===YL.Uw.EDITING?d.createElement(_t.Z,{placeholder:"Group Name",value:this.props.reviewCriteriaGroup.name,onChange:this._handleChangeGroupName}):d.createElement("div",null,this.props.reviewCriteriaGroup.name),renderControls:()=>this.props.writable&&d.createElement("div",null,this.props.savingState===YL.Uw.NOT_EDITING&&d.createElement(C.Co,{buttonStyle:C.ZJ.NEGATIVE,className:"u-mini-spacing-right",icon:"delete",onClick:this._handleDelete,size:C.qE.MINI}),d.createElement(QL.ZP,{editingState:{[YL.Uw.NOT_EDITING]:QL.jQ.NOT_EDITING,[YL.Uw.EDITING]:QL.jQ.EDITING,[YL.Uw.SAVING]:QL.jQ.SAVING}[this.props.savingState],onCancel:this._handleCancelEdit,onComplete:this._handleSave,onEdit:this._handleStartEdit,saveDisabled:0===this.props.reviewCriteriaGroup.name.trim().length})),shouldRenderPassFail:this.props.savingState!==YL.Uw.EDITING}),this.props.reviewCriteriaGroup.reviewCriteria.map(((e,t)=>d.createElement(CriterionRow,{key:e.id||`new-criterion-${t}`,reviewCriterion:e,isEditing:this.props.savingState===YL.Uw.EDITING,onChangeCriterion:e=>this.props.onChangeCriterion(this.props.reviewCriteriaGroup.id,t,e.target.value),onDeleteCriterion:()=>this.props.onDeleteCriterion(this.props.reviewCriteriaGroup.id,t)})))))}}ReviewCriteriaGroupConfig.defaultProps={pendingScrollIntoView:!1}
const XL=ReviewCriteriaGroupConfig
var ek=n(524238)
const ReviewLabelText=e=>d.createElement("h6",{className:"all-caps faded u-display-inline-block"},e.children)
ReviewLabelText.propTypes={children:J().node.isRequired}
const tk=ReviewLabelText
class ConfigureReviewCriteriaSection extends d.Component{componentDidMount(){this.props.onFetchReviewCriteria()}render(){return d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(tk,null,"Review Criteria Groups"),this.props.writable&&d.createElement(vy.Z,{onClick:this.props.onAddGroup}),d.createElement("div",{className:"configureReviewCriteriaSection"},(()=>this.props.reviewCriteriaGroups?d.createElement("div",null,this.props.reviewCriteriaGroups.map((e=>d.createElement(XL,{key:e.id,reviewCriteriaGroup:e,savingState:e.id&&this.props.savingStateByGroupId?this.props.savingStateByGroupId[e.id]:void 0,writable:this.props.writable,onAddCriterion:this.props.onAddCriterion,onCancelEdit:this.props.onCancelEdit,onChangeGroupName:this.props.onChangeGroupName,onChangeCriterion:this.props.onChangeCriterion,onDeleteCriterion:this.props.onDeleteCriterion,onDeleteReviewCriteriaGroup:this.props.onDeleteReviewCriteriaGroup,onSaveReviewCriteriaGroup:this.props.onUpdateReviewCriteriaGroup,onStartEdit:this.props.onStartEdit}))),this.props.writable&&this.props.newGroup&&d.createElement(XL,{pendingScrollIntoView:this.props.pendingScrollIntoView,reviewCriteriaGroup:this.props.newGroup,savingState:this.props.newGroupSavingState,writable:!0,onAddCriterion:this.props.onAddCriterion,onCancelEdit:this.props.onCancelEdit,onChangeGroupName:this.props.onChangeGroupName,onChangeCriterion:this.props.onChangeCriterion,onDeleteCriterion:this.props.onDeleteCriterion,onSaveReviewCriteriaGroup:this.props.onCreateReviewCriteriaGroup,onScrollIntoView:this.props.onScrollIntoView,onDeleteReviewCriteriaGroup:Jt.ZT,onStartEdit:Jt.ZT})):d.createElement("div",{className:"text-center"},d.createElement(kl.Z,null)))())))}}ConfigureReviewCriteriaSection.propTypes={pendingScrollIntoView:J().bool.isRequired,reviewCriteriaGroups:J().arrayOf(YL.BH.isRequired),savingStateByGroupId:J().objectOf(J().oneOf(l.default.values(YL.Uw)).isRequired),newGroup:YL.BH,newGroupSavingState:J().oneOf(l.default.values(YL.Uw)),writable:J().bool.isRequired,onAddCriterion:J().func.isRequired,onAddGroup:J().func.isRequired,onCancelEdit:J().func.isRequired,onChangeCriterion:J().func.isRequired,onCreateReviewCriteriaGroup:J().func.isRequired,onDeleteCriterion:J().func.isRequired,onChangeGroupName:J().func.isRequired,onDeleteReviewCriteriaGroup:J().func.isRequired,onFetchReviewCriteria:J().func.isRequired,onScrollIntoView:J().func.isRequired,onStartEdit:J().func.isRequired,onUpdateReviewCriteriaGroup:J().func.isRequired}
const nk=(0,_a.$j)((function mapStateToProps(e,{linkedItemId:t,writable:n}){const{reviewCriteriaGroupIdsByLinkedItemId:a}=e.models.reviews,{deletingGroupIds:i,pendingScrollIntoViewByLinkedItemId:s,newGroupSavingStatesByLinkedItemId:r,newGroupsByLinkedItemId:o,reviewCriteriaGroupEditsById:c,reviewCriteriaGroupSavingStatesById:d}=e.ui.reviewCriteriaConfig
let u=a[t]
if(!u)return{pendingScrollIntoView:!1,reviewCriteriaGroups:null,savingStateByGroupId:null,newGroup:null,newGroupSavingState:null,writable:n}
u=l.default.difference(u,i)
const m=(0,jL.LS)(e,t)
return{pendingScrollIntoView:s[t]||!1,reviewCriteriaGroups:u.map(((e,t)=>c[e]||m[t])),savingStateByGroupId:l.default.object(u.map((e=>[e,d[e]||YL.Uw.NOT_EDITING]))),newGroup:o[t],newGroupSavingState:r[t],writable:n}}),(function mapDispatchToProps(e,{linkedItemId:t}){return{onAddCriterion(n){e((0,ek.F_)(t,n))},onAddGroup(){e((0,ek.Rp)(t))},onCancelEdit(n){e((0,ek.nT)(t,n))},onChangeCriterion(n,a,i){e((0,ek.CT)(t,n,a,i))},onChangeGroupName(n,a){e((0,ek.eu)(t,n,a))},onCreateReviewCriteriaGroup(n){e((0,ek.Q_)(t,n))},onDeleteCriterion(n,a){e((0,ek.wm)(t,n,a))},onDeleteReviewCriteriaGroup(n){e((0,ek.tk)(t,n))},onFetchReviewCriteria(){e((0,ek.R5)(t))},onScrollIntoView(){e((0,ek.HB)(t))},onStartEdit(n){e((0,ek.H)(t,n.id,n))},onUpdateReviewCriteriaGroup(n){e((0,ek.Ns)(t,n))}}}))(ConfigureReviewCriteriaSection)
var ak=n(977989),ik=n(732853)
function NoReviewInProgress({linkedItemId:e,writable:t}){return d.createElement("div",null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("div",{className:"u-faded"},"Entry is currently in progress - there is no review yet.",t&&' Click "Send for Review" to start the review process...'))),dt.ZP.ENABLE_ELN_REVIEW_CRITERIA&&d.createElement(nk,{linkedItemId:e,writable:t}))}function CheckableReviewCriteriaGroup({review:e,reviewCriteriaGroup:t,updateReviewCriterion:n,enabled:a}){const{name:i,reviewCriteria:s}=t
return d.createElement("div",{className:"simpleDivTable u-spacing-bottom"},d.createElement(ReviewCriteriaGroupHeader,{renderGroupName:()=>i,onAddCriterion:null}),s.map((t=>d.createElement(JL,{key:t.id,review:e,reviewCriterion:t,updateReviewCriterion:n,enabled:a}))))}function currentUserHandle(){return Jn.Z.currentUser()?Jn.Z.currentUser().handle:void 0}function isReviewer(e){return null!=e.find((e=>e.handle===currentUserHandle()))}const sk=(0,_a.$j)((function ReviewCriteriaSection_mapStateToProps(e,{linkedItemId:t}){return{reviewCriteriaGroups:(0,jL.LS)(e,t)}}),{fetchReviewCriteria:ek.R5,updateReviewCriterion:ek.ZL})((function ReviewCriteriaSection({fetchReviewCriteria:e,linkedItemId:t,review:n,reviewCriteriaGroups:a,updateReviewCriterion:i}){(0,d.useEffect)((()=>{e(t)}),[e,t])
let s=n.auditors
const r=(0,Da.IJ)(pk,{variables:{reviewId:n.id}})
if(r.type===Da.NI.SUCCESS){const e=r.data.review;(0,S.hu)(!(0,ka.CZ)(e),"User shouldn't be able to access a review tab if it's inaccessible")
null!=e.lastUsedReviewLifecycleVersion&&e.reviewers&&(s=e.reviewers.map((e=>e.user)))}return d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(tk,null,"Review"),a&&r.type!==Da.NI.PENDING?d.createElement(d.Fragment,null,a.map((e=>d.createElement(CheckableReviewCriteriaGroup,{key:e.id,review:n,reviewCriteriaGroup:e,updateReviewCriterion:i,enabled:isReviewer(s)})))):d.createElement(kl.b,null)))}))
var rk=n(231088),ok=n(480207)
const lk=J().shape({status:J().string.isRequired,createdAt:J().string.isRequired,url:J().string})
function SnapshotText({snapshot:e}){const{STATUS:t}=rk
switch(e.status){case t.PENDING:case t.RUNNING:return d.createElement("span",null,"Entry snapshot started ",d.createElement(ok.i,{datetime:e.createdAt}),".")
case t.FAILED:return d.createElement("span",null,"Entry snapshot failed.")
case t.SUCCEEDED:return d.createElement("span",null,"Entry snapshot succeeded ",d.createElement(ok.i,{datetime:e.createdAt}),".")
default:throw new Error(`Unexpected snapshot status ${e.status}`)}}SnapshotText.propTypes={snapshot:lk.isRequired}
const ck={[rk.STATUS.PENDING]:"request-in-progress",[rk.STATUS.RUNNING]:"request-in-progress",[rk.STATUS.FAILED]:"request-failed",[rk.STATUS.SUCCEEDED]:"download"}
function SnapshotIcon({snapshot:e,className:t}){const n=ck[e.status]
return d.createElement(pe.Z,{icon:n,className:t})}SnapshotIcon.propTypes={snapshot:lk.isRequired,className:J().string.isRequired}
function SnapshotInfo({snapshot:e}){const t=d.createElement("div",{className:"u-small-spacing-top"},d.createElement(SnapshotIcon,{snapshot:e,className:"icon u-small-spacing-right text-center"}),d.createElement(SnapshotText,{snapshot:e}))
return e.url?d.createElement("a",{href:e.url},t):t}SnapshotInfo.propTypes={snapshot:lk.isRequired}
var dk=n(489833),uk=n(7232),mk=n(376377)
const pk=xa.ZP`
  query ReviewLifecycleReviewersQuery($reviewId: StrictString!) @skipAudit @engComponent(name: NOTEBOOK) {
    review(id: $reviewId) {
      ... on ReviewNode {
        id
        reviewers {
          ... on ReviewerNode {
            id
            isUserValidReviewer
            reviewStatus
            user {
              ... on UserNode {
                id
                name
                email
                handle
              }
            }
          }
        }
        lastUsedReviewLifecycleVersion {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }

  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ApprovedCheckbox({title:e}){return d.createElement(P.ZP,{title:e,container:"body",placement:P.TQ.BOTTOM},d.createElement(pe.Z,{className:"u-success-color",icon:"square-check-outline"}))}ApprovedCheckbox.propTypes={title:K.string.isRequired}
function UnapprovedCheckbox({title:e}){return d.createElement(P.ZP,{title:e,container:"body",placement:P.TQ.BOTTOM},d.createElement(pe.Z,{icon:"square-outline"}))}UnapprovedCheckbox.propTypes={title:K.string.isRequired}
function HistoryItemIcon({historyItem:e,className:t}){switch(e.action){case"UPDATE":return d.createElement(pe.Z,{icon:"edit",className:t})
case"REVIEW":return d.createElement(pe.Z,{icon:e.info.new_status||KL.Ab,className:t})
default:throw new Error(`Unexpected action ${(0,Go.vE)(e).action}`)}}function HistoryItemSummary({apiType:e,historyItem:t,hasReviewLifecycle:n}){var a,i,s,r
const o=(0,Mt.E2)(e),l=t.user.name
switch(t.action){case"UPDATE":return d.createElement(d.Fragment,null,d.createElement("strong",null,l)," made changes to this ",o,".")
case"REVIEW":{const e=null===(i=null===(a=t.reviewLifecycleInfo)||void 0===a?void 0:a.reviewStageInfo)||void 0===i?void 0:i.action,c=uk.Jv[null!=e?e:Sn.OQ.APPROVE].toLowerCase(),u=null===(r=null===(s=t.reviewLifecycleInfo)||void 0===s?void 0:s.reviewStageInfo)||void 0===r?void 0:r.name
switch(t.info.new_status){case KL.ZP.REJECTED:return e&&u?d.createElement(d.Fragment,null,d.createElement("strong",null,l)," requested changes to this ",o,' for stage "',u,'".'):d.createElement(d.Fragment,null,d.createElement("strong",null,l)," requested changes to this ",o,".")
case KL.ZP.REVIEW_SNAPSHOT_IN_PROGRESS:return e&&u?d.createElement(d.Fragment,null,d.createElement("strong",null,l)," ",c,' stage "',u,'" of this ',o," (pending snapshot)."):d.createElement(d.Fragment,null,d.createElement("strong",null,l)," sent this ",o," for ",n?"":"auditor ","review (pending snapshot).")
case KL.ZP.NEEDS_REVIEW:return t.info.wasCreatedBySnapshot?d.createElement(d.Fragment,null,"This ",o," was marked as ready for review."):e&&u?d.createElement(d.Fragment,null,d.createElement("strong",null,l)," ",c,' stage "',u,'" of this ',o,"."):d.createElement(d.Fragment,null,d.createElement("strong",null,l)," sent this ",o," for ",n?"":"auditor ","review.")
case KL.ZP.ACCEPTANCE_SNAPSHOT_IN_PROGRESS:return e&&u?d.createElement(d.Fragment,null,d.createElement("strong",null,l)," ",c,' stage "',u,'" of this ',o," (pending snapshot)."):d.createElement(d.Fragment,null,d.createElement("strong",null,l)," ",c," this ",o," (pending snapshot).")
case KL.ZP.ACCEPTED:return t.info.wasCreatedBySnapshot?d.createElement(d.Fragment,null,"This ",o," was marked as accepted."):e&&u?d.createElement(d.Fragment,null,d.createElement("strong",null,l)," ",c,' stage "',u,'" of this ',o,"."):d.createElement(d.Fragment,null,d.createElement("strong",null,l)," ",c," this ",o,".")
case KL.ZP.RETRACTED:return d.createElement(d.Fragment,null,d.createElement("strong",null,l)," retracted this ",o,".")
case null:return d.createElement(d.Fragment,null,d.createElement("strong",null,l)," made a comment.")
default:throw new Error(`Unexpected status ${t.info.new_status}`)}}default:throw new Error(`Unexpected action ${(0,Go.vE)(t).action}`)}}function Author({author:e,final:t}){return d.createElement("span",null,d.createElement("strong",null,e.name),!t&&", ")}function Authors({authors:e}){const t=Array.from(e).map(((t,n)=>d.createElement(Author,{key:t.email,author:t,final:n>=e.length-1})))
return d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(tk,null,"Authors"),d.createElement("span",{className:"u-spacing-left _test-review-authors"},t)))}function ReviewerItem({reviewer:e,final:t}){const n=e.approved?d.createElement(ApprovedCheckbox,{title:"Approved"}):d.createElement(UnapprovedCheckbox,{title:"Not approved yet"})
return d.createElement("span",null,n," ",d.createElement("strong",null,e.name),!t&&", ")}function Reviewers({review:e,canEditReviewers:t,openUpdateReviewModal:n}){var a
let i=e.auditors
const s=(0,Da.IJ)(pk,{variables:{reviewId:e.id}})
let r=!1
if(s.type===Da.NI.SUCCESS){const e=null===(a=s.data)||void 0===a?void 0:a.review;(0,S.hu)(!(0,ka.CZ)(e),"User shouldn't be able to access a review tab if it's inaccessible")
r=null!=e.lastUsedReviewLifecycleVersion
r&&e.reviewers&&(i=e.reviewers.map((e=>({approved:e.reviewStatus===Sn.np.FINISHED,...e.user}))))}const o=Array.from(i).map(((e,t)=>d.createElement(ReviewerItem,{key:e.email,reviewer:e,final:t>=i.length-1}))),l=r?"Reviewers":"Auditors"
return d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(tk,null,l),d.createElement("span",{className:"u-spacing-left _test-review-auditors"},o,"  ",t&&d.createElement("a",{className:"u-no-text-decoration",onClick:n},d.createElement(pe.Z,{icon:"edit"})))))}function RecentActivity({apiType:e,historyItems:t,historyStartIndex:n,showAllHistory:a,hasReviewLifecycle:i,reviewId:s,fileId:r}){if(!t)return null
let o=!1
const l=t.slice(n).map(((t,n)=>{var a,s
null!=(null===(a=t.info)||void 0===a?void 0:a.snapshot)&&(o=(null===(s=t.info.snapshot)||void 0===s?void 0:s.status)===ak.Q.FAILED)
return d.createElement("div",{className:"u-small-spacing-top browser-history-activity",key:`${t.time}~${n}`,...(0,ee.Z)({component:"HistoryItem",element:"reviewLog"})},d.createElement(HistoryItemIcon,{historyItem:t,className:"icon u-small-spacing-right text-center"}),d.createElement("img",{className:"u-small-spacing-right avatar",src:t.user.avatar_url,width:20,height:20}),d.createElement(HistoryItemSummary,{historyItem:t,apiType:e,hasReviewLifecycle:i}),d.createElement("span",{className:"pull-right faded"},d.createElement(ok.i,{datetime:t.time})),t.info&&t.info.message&&d.createElement("div",{className:"u-small-spacing-top browser-activity-note"},d.createElement("p",{className:"u-no-spacing-bottom",...(0,ee.Z)({component:"HistoryItem",element:"reviewComment"})},t.info.message)),t.info&&t.info.snapshot&&d.createElement(SnapshotInfo,{snapshot:t.info.snapshot}))}))
o&&l.push(d.createElement("div",{className:"u-small-spacing-top browser-history-activity",key:"reset-snap",id:"reset-snap",...(0,ee.Z)({component:"HistoryItem",element:"reviewLog"})},d.createElement(pe.Z,{icon:"request-in-progress",className:"icon u-small-spacing-right text-center"}),d.createElement("span",null,"Latest entry snapshot failed. ",d.createElement("a",{onClick:()=>async function retrySnapshot(e,t){if(t){const{review:n,filePermissions:a,snapshotTask:i}=await(0,mk.ik)(e,t);(0,dk.Z)(e,n,a,i)}}(r,s)},"Retry?"))))
const c=0!==n?d.createElement("div",{className:"browser-history-older-changes text-center"},`${n} older changes are hidden. `,d.createElement("a",{onClick:a},"Show all changes.")):null
return d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(tk,null,"Recent Activity"),c,d.createElement("div",null,l)))}class Review extends d.Component{constructor(e){super(e)
this.showAllHistory=()=>{this.setState({historyStartIndex:0})}
this.openUpdateReviewModal=()=>{ik.Z.open({fileId:this.props.id,review:this.props.review,onUpdate:this.props.onUpdate,isSelfReview:!1})}
this.state={historyStartIndex:this.props.review&&this.props.review.history?Math.max(0,this.props.review.history.length-this.props.initialItemsShowing):0}}render(){var e
const{review:t}=this.props
return t?d.createElement("div",null,d.createElement(Authors,{authors:t.authors}),d.createElement(Reviewers,{review:t,canEditReviewers:!this.props.hasReviewLifecycle&&this.props.permissions.writable,openUpdateReviewModal:this.openUpdateReviewModal}),dt.ZP.ENABLE_ELN_REVIEW_CRITERIA&&(this.props.permissions.canSendForReview?d.createElement(nk,{linkedItemId:this.props.id,writable:this.props.permissions.writable}):d.createElement(sk,{linkedItemId:this.props.id,review:t})),d.createElement(RecentActivity,{apiType:ea.ZP.apiIdToType(this.props.id),historyItems:t.history,historyStartIndex:this.state.historyStartIndex,showAllHistory:this.showAllHistory,hasReviewLifecycle:this.props.hasReviewLifecycle,reviewId:null===(e=this.props.review)||void 0===e?void 0:e.id,fileId:this.props.id})):d.createElement(NoReviewInProgress,{linkedItemId:this.props.id,writable:this.props.permissions.writable})}}Review.propTypes={id:K.string.isRequired,review:K.object,initialItemsShowing:K.number.isRequired,onUpdate:K.func,permissions:K.shape({writable:K.bool.isRequired}).isRequired,hasReviewLifecycle:K.bool}
Review.defaultProps={initialItemsShowing:3}
const hk=Review
var gk=n(827670),Ek=n(840890),fk=n(593382),Sk=n(597963),yk=n(967911),bk=n(593113),Tk=n(866648),vk=n(669574)
function ReviewButton(e){return d.createElement(C.Co,{buttonStyle:cA.fs(e.action),className:e.className,disabled:e.disabled,fullWidth:e.fullWidth,icon:cA.SL(e.action),onClick:()=>{e.onClick(e.action)},size:e.size,text:e.text,dataTestAttrs:e.dataTestAttrs})}xa.ZP`
  query ReviewLegacyOrReviewLifecycleQuery($reviewId: StrictString!) @skipAudit {
    review(id: $reviewId) {
      ... on ReviewNode {
        id
        reviewLifecycleVersion {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }

  ${(0,La.f)("InaccessibleInfo").fragment}
`
class ReviewButtonGroup extends d.Component{constructor(){super(...arguments)
this.onStatusChange=e=>{if((0,S.Gp)(null!=this.props.review&&null!=this.props.reviewCriteriaGroups,"onStatusChange called with null review data",{review:this.props.review,reviewCriteriaGroups:this.props.reviewCriteriaGroups})){if(e===KL.JF.ACCEPT){if(this.props.reviewCriteriaGroups.some((({reviewCriteria:e})=>e.some((e=>e.status===YL.JY.UNREVIEWED))))){v.ZP.error("All review criteria must be marked before accepting.")
return}}Sk.Z.open({onUpdate:this.props.onUpdate,fileId:this.props.fileId,reviewId:this.props.review.id,reviewCriteriaGroups:this.props.reviewCriteriaGroups,action:e})}}
this._handleUpdate=(e,t,n)=>{this.props.onUpdate&&this.props.onUpdate(e,t,n)
ea.ZP.apiIdToType(this.props.fileId)===st.STAGE_ENTRY&&e.status===KL.ZP.ACCEPTED&&bk.fetchInputDataForChildrenRuns(this.props.fileId)}}componentDidMount(){this.props.fetchReviewCriteria(this.props.fileId)}_hasUnsavedChanges(){return Boolean(this.props.entryHasUnsavedChanges||this.props.stageEntryHasUnsavedChanges)}isLockedToOtherClient(){return!!this.props.documentEditorLock&&(0,fk.Y)(this.props.documentEditorLock)}_isUserAuthor(){const e=this.props.entry||this.props.stageEntryDocument
if(!e)return!1
for(const t of e.authors)if(t.handle===Jn.Z.currentUser().handle)return!0
return!1}_renderSelfApproveButton(e,{buttonProps:t,disableButtons:n,tooltipTitle:a,hasLocalSyncFiles:i,review:s}){return e.canAccept&&this._isUserAuthor()?d.createElement(P.ZP,{title:null!=a?a:"",disabled:null==a,key:"selfApproveButton"},d.createElement(C.Co,{...t,className:f()(t.className,{"u-small-spacing-bottom":this.props.isVertical}),disabled:n||i||this._hasUnsavedChanges()||this.isLockedToOtherClient(),buttonStyle:C.ZJ.PRIMARY,onClick:()=>s?Sk.Z.open({reviewId:s.id,fileId:this.props.fileId,reviewCriteriaGroups:this.props.reviewCriteriaGroups,action:KL.JF.ACCEPT,onUpdate:this._handleUpdate,title:"Accepting"}):ik.Z.open({fileId:this.props.fileId,onUpdate:this._handleUpdate,review:this.props.review,isSelfReview:!0}),text:"Approve",dataTestAttrs:{component:"ReviewAction",element:"approve"}})):null}_renderSendForReviewButton({buttonProps:e,disableButtons:t,tooltipTitle:n,hasLocalSyncFiles:a,review:i}){var s
const r=0===(null===(s=this.props.review)||void 0===s?void 0:s.auditors.length)&&this.props.review.status===Sn.CT.RETRACTED
return null==i||r?d.createElement(P.ZP,{title:null!=n?n:"",disabled:null==n,key:"sendForReviewButton"},d.createElement(C.Co,{...e,disabled:t||a||this._hasUnsavedChanges()||this.isLockedToOtherClient(),buttonStyle:C.ZJ.SECONDARY,onClick:()=>{ik.Z.open({fileId:this.props.fileId,onUpdate:this._handleUpdate,review:i,isSelfReview:!1})},text:"Send for review",dataTestAttrs:{component:"ReviewAction",element:"sendForReview"}})):d.createElement(P.ZP,{title:null!=n?n:"",disabled:null==n,key:"sendForReviewButton"},d.createElement(C.Co,{...e,disabled:t||a||this._hasUnsavedChanges(),buttonStyle:C.ZJ.SECONDARY,onClick:()=>{Sk.Z.open({reviewId:i.id,fileId:this.props.fileId,reviewCriteriaGroups:this.props.reviewCriteriaGroups,action:KL.JF.SEND_FOR_REVIEW,onUpdate:this._handleUpdate,title:"Resending for review"})},text:"Resend for review",dataTestAttrs:{component:"ReviewAction",element:"resendForReview"}}))}_renderButtonsForReview(e,{buttonProps:t,disableButtons:n}){const a=[]
e.canAccept&&!this._isUserAuthor()&&a.push(d.createElement(ReviewButton,{...t,key:"approveButton",disabled:n,action:KL.JF.ACCEPT,text:"Approve",onClick:this.onStatusChange,dataTestAttrs:{component:"ReviewAction",element:"approve"}}))
e.canReject&&a.push(d.createElement(d.Fragment,{key:"rejectButton"},d.createElement(ReviewButton,{...t,disabled:n,action:KL.JF.REJECT,text:"Reject",onClick:this.onStatusChange,dataTestAttrs:{component:"ReviewAction",element:"reject"}})))
e.canRetract&&a.push(d.createElement(d.Fragment,{key:"retractButton"},d.createElement(ReviewButton,{...t,disabled:n,action:KL.JF.RETRACT,text:"Retract",onClick:this.onStatusChange,dataTestAttrs:{component:"ReviewAction",element:"retract"}})))
return a.length>0?d.createElement(d.Fragment,{key:"buttonsForReview"},a):null}getButtonsForLegacyReview({review:e,buttonProps:t,disableButtons:n,buttonTooltipTitle:a,hasLocalSyncFiles:i,permissions:s,disableAuthorActions:r}){const o=[]
e&&dt.ZP.ENABLE_ELN_REVIEW_COMMENTS&&o.push(d.createElement(ReviewButton,{...t,key:"commentButton",disabled:n,action:KL.JF.COMMENT,text:"Comment",onClick:this.onStatusChange,dataTestAttrs:{component:"ReviewAction",element:"comment"}}))
const l=this._renderSelfApproveButton(s,{buttonProps:t,disableButtons:n||r,tooltipTitle:a,hasLocalSyncFiles:null!=i&&i,review:e})
l&&o.push(l)
if(s.canSendForReview)o.push(this._renderSendForReviewButton({buttonProps:t,disableButtons:n||r,tooltipTitle:a,hasLocalSyncFiles:null!=i&&i,review:e}))
else if(null!=e){const e=this._renderButtonsForReview(s,{buttonProps:t,disableButtons:n})
null!=e&&o.push(e)}return o}render(){const{review:e,reviewCriteriaGroups:t,entryReviewLifecycleInfo:n}=this.props,a=this.props.entry||this.props.stageEntryDocument
if(null==a)return null
const i=a.permissions,s=this.props.entry&&this.props.entry.note||this.props.stageEntryDocument&&this.props.stageEntryDocument.entryVersion.note,r=s&&l.default.some(s.noteParts,(e=>(0,Ek.Ms)(e.item))),o=null!=e&&null==t,{disableAuthorActions:c,disableAuthorActionsTooltip:u}=(0,vk.l)(s)
let m=u
null==m&&o&&(m=r?"Cannot proceed if a file is checked out with the desktop app. Check in your files to continue.":"The entry has unsaved changes. Please wait.")
const p={className:this.props.buttonClassName,fullWidth:this.props.fullWidth,size:this.props.size},h=this.props.wrapperComponent,g=Boolean(null==n?void 0:n.projectUsesReviewLifecycle)&&cA.bm(null==e?void 0:e.status),E=null!=n&&!n.wasLastSentForLegacyReview&&!cA.bm(null==e?void 0:e.status)
if(g||E)return null==e?d.createElement(h,null,null):d.createElement(h,null,d.createElement("div",{className:this.props.className},d.createElement(ReviewButton,{...p,disabled:o,key:"commentButton",action:KL.JF.COMMENT,text:"Comment",onClick:this.onStatusChange,dataTestAttrs:{component:"ReviewAction",element:"comment"}})))
const f=this.getButtonsForLegacyReview({review:e,permissions:i,buttonTooltipTitle:m,buttonProps:p,disableButtons:o,disableAuthorActions:c,hasLocalSyncFiles:r})
return d.createElement(h,null,f.length>0?d.createElement("div",{className:this.props.className},f):null)}}ReviewButtonGroup.propTypes={className:J().string,buttonClassName:J().string,fileId:J().string.isRequired,fullWidth:J().bool,isVertical:J().bool,onUpdate:J().func,review:YL.r8,reviewCriteriaGroups:J().arrayOf(YL.BH.isRequired),size:J().oneOf(Object.values(C.qE)).isRequired,entry:J().object,entryHasUnsavedChanges:J().bool,stageEntryDocument:J().object,stageEntryHasUnsavedChanges:J().bool,entryReviewLifecycleInfo:J().shape({projectUsesReviewLifecycle:J().bool,wasLastSentForLegacyReview:J().bool}),wrapperComponent:J().func}
ReviewButtonGroup.defaultProps={wrapperComponent:({children:e})=>e}
const Ck=(0,gk.compose)(yk.Z.connect((function mapEntryStoreToProps(e,t){let n=null,a=null
if(e.inStore(t.fileId)){n=e.getEditorState(t.fileId).entry
a=e.hasUnsavedChanges(t.fileId)}return{entry:n,entryHasUnsavedChanges:a}})),Tk.Z.connect((function mapStageEntryStoreToProps(e,t){let n=null,a=null
if(e.inStore(t.fileId)){n=e.getEditorState(t.fileId).stageEntryDocument
a=e.hasUnsavedChanges(t.fileId)}return{stageEntryDocument:n,stageEntryHasUnsavedChanges:a}})),(0,_a.$j)((function ReviewButtonGroup_mapStateToProps(e,{fileId:t}){return dt.ZP.ENABLE_ELN_REVIEW_CRITERIA?{reviewCriteriaGroups:(0,jL.LS)(e,t),...(0,fk.n)(e,t)}:{reviewCriteriaGroups:[],...(0,fk.n)(e,t)}}),{fetchReviewCriteria:ek.R5}))(ReviewButtonGroup)
var Ik=n(391071)
const wk=xa.ZP`
  query ShowReviewViewButtonsQuery($entryId: StrictString!) @skipAudit @engComponent(name: NOTEBOOK) {
    entry(id: $entryId) {
      ... on EntryNode {
        id
        project {
          ... on ProjectNode {
            id
            reviewLifecycle {
              id
            }
          }
        }
        review {
          ... on ReviewNode {
            id
            reviewLifecycleVersion {
              id
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class ReviewTabConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[yk.Z,Tk.Z]}enhanceProps(){let e=null
this.entryStore().inStore(this.props.fileId)?e=this.entryStore().getEditorState(this.props.fileId).entry.review:this.stageEntryStore().inStore(this.props.fileId)&&(e=this.stageEntryStore().getEditorState(this.props.fileId).stageEntryDocument.review)
return{review:e}}}function ReviewTabForEntry({entryId:e,review:t,onReviewUpdate:n,permissions:a,btnGroupClassName:i}){return d.createElement(Da.ZP,{query:wk,variables:{entryId:e},renderLoading:()=>d.createElement(kl.b,null)},(({entry:s})=>d.createElement("div",{className:"_test-review-tab"},d.createElement("div",{className:"buffer-options"},(0,ka.CZ)(s)?null:d.createElement(Ck,{buttonClassName:"u-mini-spacing-left",className:i,fileId:e,review:t,onUpdate:n,size:C.qE.MINI,entryReviewLifecycleInfo:{projectUsesReviewLifecycle:null!=s.project.reviewLifecycle,wasLastSentForLegacyReview:null!=s.review&&null==s.review.reviewLifecycleVersion}}),d.createElement("h5",{className:"u-small-spacing-left u-small-spacing-right u-display-inline-block"},"Status:"),d.createElement(Ik.Z,{review:t})),d.createElement("div",{className:"react-tab-container u-small-padding"},d.createElement(hk,{id:e,review:t,initialItemsShowing:5,onUpdate:n,permissions:a,hasReviewLifecycle:!(0,ka.CZ)(s)&&null!=s.project.reviewLifecycle})))))}class ReviewTab extends d.Component{constructor(){super(...arguments)
this.onReviewUpdate=(e,t,n)=>{this.dispatchPostReviewUpdateAction(e,t)
n&&an.Q5(n.status_url).then((({review:e,filePermissions:t})=>{this.dispatchPostReviewUpdateAction(e,t)}))}
this.dispatchPostReviewUpdateAction=(e,t)=>{const n=ea.ZP.apiIdToType(this.props.fileId)
if(n===st.ENTRY)HL.Z.postServerUpdate(this.props.fileId,{review:e,permissions:t})
else{(0,S.hu)(n===st.STAGE_ENTRY,"unexpected fileType")
bk.updateReview(this.props.fileId,e,t)}}}render(){const e=ea.ZP.apiIdToType(this.props.fileId)
if(cA.Qs(e)){(0,S.Gp)(dt.ZP.ENABLE_ELN_REVIEW_CRITERIA,"Review tab should not be shown for templates if ENABLE_ELN_REVIEW_CRITERIA is not set")
return dt.ZP.ENABLE_ELN_REVIEW_CRITERIA?d.createElement("div",{className:"react-tab-container u-small-padding"},d.createElement(nk,{linkedItemId:this.props.fileId,writable:this.props.permissions.writable})):d.createElement("div",null)}const t="pull-right u-tiny-spacing-bottom u-tiny-spacing-top u-small-spacing-right _test-review-buttons"
return e===st.ENTRY?d.createElement(ReviewTabForEntry,{entryId:this.props.fileId,onReviewUpdate:this.onReviewUpdate,review:this.props.review,permissions:this.props.permissions,btnGroupClassName:t}):d.createElement("div",{className:"_test-review-tab"},d.createElement("div",{className:"buffer-options"},d.createElement(Ck,{buttonClassName:"u-mini-spacing-left",className:t,fileId:this.props.fileId,review:this.props.review,onUpdate:this.onReviewUpdate,size:C.qE.MINI}),d.createElement("h5",{className:"u-small-spacing-left u-small-spacing-right u-display-inline-block"},"Status:"),d.createElement(Ik.Z,{review:this.props.review})),d.createElement("div",{className:"react-tab-container u-small-padding"},d.createElement(hk,{id:this.props.fileId,review:this.props.review,initialItemsShowing:5,onUpdate:this.onReviewUpdate,permissions:this.props.permissions})))}}const Nk=ReviewTabConnector.connect(ReviewTab)
class ReviewTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}initialize(){this.history=[]
this.listenTo(this.model.get("model"),"change",this.rerender)}render(){this.rerender()
return this}rerender(){const e=this.model.get("model").id,t=this.model.get("model").proxied();(0,Me.A9)(d.createElement(Nk,{fileId:e,permissions:t.permissions}),this.el)}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ReviewTabView.initClass()
var Ak=n(994171),Rk=n(840784),Pk=n(980886)
function getCollaborationAnalyticsMetadata(e){if(ea.ZP.isEntry(e))return{actionOrigin:j.D2.NOTEBOOK,itemId:e}}var Ok=n(968953),xk=n(864954)
function ResourcePresenceManager(e){const t=(0,_a.I0)(),n=(0,d.useCallback)((n=>{switch(n.type){case Pk.iZ.ENTER:case Pk.iZ.PRESENT:t(xk.vr(e.fileId,n.userId,n.connectionId))
break
case Pk.iZ.LEAVE:t(xk.M9(e.fileId,n.userId,n.connectionId))}}),[e.fileId,t]);(0,d.useEffect)((()=>{let a=null;(0,Rk.Z)((0,Ok.b)(e.fileId),[Pk.Yu.SUBSCRIBE,Pk.Yu.PRESENCE]).then((i=>{a=i
a.presence.enter((e=>{(0,S.Gp)(null==e,"error entering realtime channel",{err:e})}))
a.presence.subscribe(n)
a.presence.get(((n,a)=>{if(n)Fe.ZK("error retrieving realtime channel presence list",{extra:{err:n}})
else{m.L9(j.YV.ENTERED_PRESENCE,{...getCollaborationAnalyticsMetadata(e.fileId),currentPresentConnections:a.length,currentPresentUsers:new Set(a.map((e=>e.userId))).size})
t(xk.Zv(e.fileId,a.map((e=>({userId:e.userId,ablyConnectionId:e.connectionId})))))}}))})).catch((e=>{if(!(e instanceof Pk.Lr))throw e
Fe.ZK("error connecting to realtime channel",{extra:{err:e}})}))
return()=>{if(a){a.presence.unsubscribe()
a.presence.leave((e=>{(0,S.Gp)(null==e,"error leaving realtime channel",{err:e})}))
m.L9(j.YV.EXITED_PRESENCE,getCollaborationAnalyticsMetadata(e.fileId))
a.stop()
t(xk.Cf(e.fileId))}}}),[e.fileId,t,n])
return null!=e.children?d.createElement(d.Fragment,null,e.children):null}class PresenceManager{constructor(e){(0,S.hu)(e&&1===e.length,"expected realtime presence mount point")
this.mount=e
this.mounted=!1}subscribe(e){if(!function presenceEnabled(){return dt.ZP.ELN_ENABLE_REALTIME_UPDATES_M1&&null!=Jn.Z.currentUser()}()){this.unsubscribe()
return}const t=getResourceIdForRealtime(e)
if(t){(0,Me.A9)(d.createElement(ResourcePresenceManager,{fileId:t}),this.mount[0])
this.mounted=!0}else this.unsubscribe()}unsubscribe(){if(this.mounted){u.unmountComponentAtNode(this.mount[0])
this.mounted=!1}}}function getResourceIdForRealtime(e){let t=null
if(!e)return null
switch(e.fileType()){case st.EntryType.ENTRY:case st.EntryType.TEMPLATE:({id:t}=e.model())
break
default:return null}return t}var _k=n(81818),Dk=n(990697)
var Lk
!function(e){e.ENTRY_UPDATE="entry_update"
e.LOCK_UPDATE="lock_update"}(Lk||(Lk={}))
class DocumentUpdatesManager{constructor(){this.allDocumentConnections=[]}changeActiveDocument(e){if(!dt.ZP.ELN_ENABLE_REALTIME_UPDATES_M1)return
this.markInactive()
const t="string"==typeof e?e:getResourceIdForRealtime(e)
if(t){this.allDocumentConnections.filter((e=>e.fileId===t)).forEach((e=>{e.realtimeChannel.stop()}))
this.allDocumentConnections=this.allDocumentConnections.filter((e=>e.fileId!==t));(0,Rk.Z)((0,Ok.b)(t),[Pk.Yu.SUBSCRIBE,Pk.Yu.PRESENCE]).then((e=>{this.activeDocument={fileId:t,realtimeChannel:e}
e.subscribe(function activeMessageHandler(e){return t=>{var n,a
if(t.name===Lk.ENTRY_UPDATE){fetchAndUpdateFileLockState(e)
if((null===(n=t.data)||void 0===n?void 0:n.clientId)&&!(0,Ok.d)(t.data.clientId)){m.L9(j.YV.RECEIVED_REALTIME_UPDATE,getCollaborationAnalyticsMetadata(e))
if(ea.ZP.isEntry(e)){if(yk.Z.inStore(e)){const t=yk.Z.getEditorState(e)
if(t.openVersionId!==(null===(a=t.metadata)||void 0===a?void 0:a.latestVersionId))return
if(yk.Z.hasUnsavedChanges(e))return}HL.Z.open(e)}}}else t.name===Lk.LOCK_UPDATE&&fetchAndUpdateFileLockState(e)}}(t))
fetchAndUpdateFileLockState(t)})).catch((e=>{if(!(e instanceof Pk.Lr))throw e
Fe.ZK("error connecting to realtime channel",{extra:{err:e}})}))}}markInactive(){if(dt.ZP.ELN_ENABLE_REALTIME_UPDATES_M1&&this.activeDocument){if(this.allDocumentConnections.length>=20){this.allDocumentConnections[0].realtimeChannel.stop()
this.allDocumentConnections.shift()}this.activeDocument.realtimeChannel.unsubscribe()
this.activeDocument.realtimeChannel.subscribe(function inactiveMessageHandler(e){return t=>{var n
t.name===Lk.ENTRY_UPDATE&&ea.ZP.isEntry(e)&&(null===(n=t.data)||void 0===n?void 0:n.clientId)&&!(0,Ok.d)(t.data.clientId)&&HL.Z.postServerUpdate(e,{isStale:!0})}}(this.activeDocument.fileId))
this.allDocumentConnections.push(this.activeDocument)
this.activeDocument=null}}}async function fetchAndUpdateFileLockState(e){const t=await(0,_k.R)(e)
t&&(0,Vn.getStore)().dispatch((0,Dk.ZI)(e,t.userId,t.clientId,t.msUntilExpiration))}var kk=n(243327),Mk=n(200337),Fk=n(656345),Zk=n(557715)
function BaseStatusButton({buttonStyle:e,icon:t,isDropdown:n,menuOptions:a,onClick:i,text:s,disabled:r}){const o=d.createElement(C.Co,{disabled:r,buttonStyle:e,icon:t,isDropdown:n,onClick:i,text:s,size:C.qE.MEDIUM,dataTestAttrs:{component:"BaseStatusButton",element:"button"}})
return null==a?o:d.createElement(I.ZP,{...(0,ee.Z)({component:"BaseStatusButton",element:"dropdown"}),menu:getDropdownMenu(a)},o)}function getDropdownMenu(e){return d.createElement(w.ZP,{className:(0,g.iv)(Bk.dropdown),...(0,ee.Z)({component:"BaseStatusButton",element:"dropdownContent"})},e)}const Bk=g.mM.create({dropdown:{backgroundColor:Vt.Cj,borderRadius:4,boxShadow:"0 2px 4px 0 rgba(0, 0, 0, 0.5)",marginTop:2,padding:14,position:"absolute",minWidth:200,top:"100%",left:"auto",right:0,margin:"auto"}})
function AmendStepModal({onRequestClose:e,onRequestSubmit:t}){return d.createElement(et.ZP,{title:"Amend step",onRequestClose:e,onRequestSubmit:()=>{t()},buttons:[{text:"Submit",submit:!0,dataTestAttrs:{component:"AmendStepModal",element:"submitButton"}}]},d.createElement("span",null,"Please note, previously submitted data ",d.createElement("strong",null,"will not be archived or removed")," from the system."))}var qk=n(186837)
const Vk={[Mk.$n.READY]:{text:"Mark as Completed",buttonStyle:C.ZJ.PRIMARY,isDropdown:!1},[Mk.$n.COMPLETED]:{text:"Completed",buttonStyle:C.ZJ.TERTIARY_WHITE,isDropdown:!0,icon:d.createElement(qk.Z,{status:Mk.$n.COMPLETED})},[Mk.$n.SKIPPED]:{text:"Skipped",buttonStyle:C.ZJ.TERTIARY_WHITE,isDropdown:!0,icon:d.createElement(qk.Z,{status:Mk.$n.SKIPPED})},[Mk.$n.FAILED]:{text:"Failed",buttonStyle:C.ZJ.TERTIARY_WHITE,isDropdown:!0,icon:d.createElement(qk.Z,{status:Mk.$n.FAILED})},[Mk.$n.ACTIVE]:{text:"Active",buttonStyle:C.ZJ.TERTIARY_WHITE,isDropdown:!0,icon:d.createElement(qk.Z,{status:Mk.$n.ACTIVE})}}
function WorksheetStepButton({onClick:e,status:t,lastEditedUser:n,timestamp:a,locked:i}){const s=(0,d.useCallback)((()=>{e(Mk.$n.COMPLETED)}),[e]),r=(0,d.useCallback)((()=>{e(Mk.$n.READY)}),[e])
return d.createElement(BaseStatusButton,{menuOptions:getDropdownMenuOptions(t,null!=n?n:Mk.E0,r,a),onClick:t===Mk.$n.READY?s:void 0,disabled:i,...Vk[t]})}function getDropdownMenuOptions(e,t,n,a){if(e!==Mk.$n.READY)return[d.createElement(N.Z,{isHovered:!1,key:"step-info"},d.createElement("div",{className:(0,g.iv)(Uk.dropdownDetails)},d.createElement("div",{className:(0,g.iv)(Uk.avatar)},d.createElement(fC.Z,{entity:t,size:SC.D.SMALL})),d.createElement("div",{className:(0,g.iv)(Uk.textContainer)},d.createElement("span",{className:(0,g.iv)(Uk.statusLabel)},`Task ${Vk[e].text.toLowerCase()}`),d.createElement("br",null),null!=a?a:d.createElement("span",null,a)))),d.createElement(N.Z,{className:(0,g.iv)(Uk.amendLink),onSelect:()=>{(0,Xn.Z)(AmendStepModal,{onRequestSubmit:n})},key:"label"},d.createElement("span",{className:(0,g.iv)(Uk.amendLinkLabel),...(0,ee.Z)({component:"WorksheetStepButton",element:"amendStepOption"})},"Amend step"))]}const Uk=g.mM.create({dropdownDetails:{display:"flex",alignItems:"flex-end",cursor:"default"},avatar:{alignSelf:"center"},textContainer:{marginLeft:8},statusLabel:{fontSize:"13px",fontWeight:_n.KB,paddingBottom:4},amendLink:{marginTop:"10px",textAlign:"center"},amendLinkLabel:{color:Vt.t0}})
function BaseStatusDropdownButton({buttonStyle:e,menuOptions:t,disabled:n}){return d.createElement(I.ZP,{menu:function getMenu(){return d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FIT_CONTENT,useSelectedIconIfSingleSelect:!1,dropLeft:!0},t)}(),...(0,ee.Z)({component:"BaseStatusDropdownButton",element:"dropdown"})},d.createElement(C.Co,{icon:"caret-down",isDropdown:!1,buttonStyle:e,disabled:n,size:C.qE.MEDIUM,...(0,ee.Z)({component:"BaseStatusDropdownButton",element:"button"})}))}function WorksheetStepDropdownButton({locked:e,onSelect:t}){const n=Object.values(Mk.$n).filter((e=>![Mk.$n.COMPLETED,Mk.$n.READY,Mk.$n.ACTIVE].includes(e))).map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:()=>{t(e)},...(0,ee.Z)({component:"WorksheetStepDropdownButton",element:"option"})},function getOptionLabel(e){return`Mark as ${e.toLocaleLowerCase()}`}(e))))
return d.createElement(BaseStatusDropdownButton,{buttonStyle:C.ZJ.PRIMARY,menuOptions:n,disabled:e})}function WorksheetStepStatusBadge({onSubmit:e,status:t,lastEditedUser:n,timestamp:a,taskId:i,refetch:s,locked:r}){const o=(0,d.useCallback)((t=>{e&&e(t)}),[e]),l=d.createElement(Pr.Z,{...(0,ee.Z)({component:"WorksheetStepStatusBadge",element:"buttonGroup"})},d.createElement(WorksheetStepButton,{onClick:o,status:t,lastEditedUser:n,timestamp:a,locked:r}),t===Mk.$n.READY&&d.createElement(WorksheetStepDropdownButton,{onSelect:o,locked:r}))
return i?d.createElement(Zk.Z,{apiIdToSubscribe:i,refetch:s},l):d.createElement("div",null,l)}function WorksheetStepHeader({name:e,status:t=Mk.$n.READY,lastEditedUser:n,timestamp:a,refetch:i,outStatuses:s,taskId:r,locked:o,documentId:l}){const c=(0,d.useCallback)((e=>{const t=null==s?void 0:s[Mk.t[e].toUpperCase()]
r&&t&&(0,uA.ML)([{id:r,sourceType:"dashboard",statusId:t}]).then((()=>{i()}))}),[r,s,i])
return d.createElement("div",{className:(0,g.iv)(Gk.headerContainer)},d.createElement("div",{className:(0,g.iv)(Gk.headerStepNameContainer)},d.createElement("div",{...(0,ee.Z)({component:"WorksheetStepHeader",element:"name"}),className:(0,g.iv)(Gk.stepName)},e),o&&d.createElement("div",{...(0,ee.Z)({component:"WorksheetStepHeader",element:"icon"})},d.createElement(P.ZP,{title:"Editing is disabled because run has not started. Start run to unlock the Run steps.",placement:P.TQ.TOP,delay:350},d.createElement(pe.Z,{icon:"lock",className:(0,g.iv)(Gk.lockIcon)})))),d.createElement("div",{className:(0,g.iv)(Gk.rightContainer)},d.createElement("div",{className:(0,g.iv)(Gk.resourcePresenceContainer)},d.createElement(Fk.ZP,{resourceId:l})),d.createElement(WorksheetStepStatusBadge,{status:t,taskId:r,onSubmit:c,lastEditedUser:n,timestamp:a,refetch:i,locked:o})))}const Gk=g.mM.create({headerContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",padding:"7px 16px",border:`1px solid ${Vt.pF}`,borderLeft:"0px",background:Vt.Cj},headerStepNameContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px"},stepName:{fontSize:"14px",fontWeight:600},rightContainer:{display:"flex"},lockIcon:{color:Vt.TG,width:"12px"},resourcePresenceContainer:{display:"flex",marginRight:"8px"}})
function WorksheetStepFrame(e){const{stepName:t,document:n,stepTaskData:a,refetch:i,locked:s}=e
return d.createElement(ResourcePresenceManager,{fileId:n.id},d.createElement("div",{className:(0,g.iv)(zk.editorContainer)},d.createElement(WorksheetStepHeader,{name:t,status:a.status,outStatuses:a.outStatuses,lastEditedUser:a.lastEditedUser,timestamp:a.timestamp,refetch:i,taskId:a.taskId,locked:s,documentId:n.id}),d.createElement(kk.Z,{...(0,ee.Z)({component:"WorksheetStepFrame",element:"editor"}),id:n.id,locked:s||(a.status?a.status!==Mk.$n.READY:void 0),isConfig:!1})))}const zk=g.mM.create({editorContainer:{flex:1,overflowY:"auto"}})
var $k=n(7060)
function WorksheetRunCheckbox(e){return d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Bulk Step Update"),d.createElement(Io.Z,{onChange:t=>{e.onChangeSkipCheckbox(t.target.checked)},checked:e.isSkipChecked,id:"worksheets-complete-run-checkbox",label:e.checkboxLabel}))}const Wk={[Mk.$n.COMPLETED]:{text:"Complete run",submit:!0},[Mk.$n.FAILED]:{text:"Fail run",submit:!0,style:C.ZJ.NEGATIVE}}
function WorksheetEndRunModal({onRequestClose:e,onRequestSubmit:t,currentUser:n,name:a,endRunStatus:i}){const[s,r]=d.useState(!0),o=Wk[i]
return d.createElement(et.ZP,{title:o.text,onRequestClose:e,onRequestSubmit:()=>{t(s)},buttons:[o]},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement(io.ZP,{bannerType:io.ct.INFO,text:"Run will be updated to a terminal status upon confirmation. You won’t be able to further modify the Run status or create additional outputs."})),d.createElement("div",{className:(0,g.iv)(Hk.container)},d.createElement("div",{className:(0,g.iv)(Hk.inputSection)},d.createElement("span",{className:(0,g.iv)(Hk.label)},"Unit operation"),d.createElement("span",{className:(0,g.iv)(Hk.inputText)},a)),d.createElement("div",{className:(0,g.iv)(Hk.inputSection)},d.createElement("span",{className:(0,g.iv)(Hk.label)},"User"),d.createElement("span",{className:(0,g.iv)(Hk.inputText)},d.createElement(fC.Z,{entity:n,size:SC.D.XXSMALL})," ",n.name))),d.createElement(WorksheetRunCheckbox,{isSkipChecked:s,onChangeSkipCheckbox:e=>{r(e)},checkboxLabel:"Mark all pending Run steps as skipped"}))}const Hk=g.mM.create({container:{display:"flex",width:"100%",marginBottom:"16px"},inputSection:{flex:1,display:"flex",flexDirection:"column"},label:{fontSize:"13px",fontWeight:_n.KB,lineHeight:"16px",marginBottom:"4px"},inputText:{fontSize:"13px",fontWeight:_n.hS,lineHeight:"16px"}}),jk="Start run"
function WorksheetStartRunModal({onRequestClose:e,onRequestSubmit:t,currentUser:n,name:a}){const[i,s]=d.useState(!0)
return d.createElement(et.ZP,{title:jk,onRequestClose:e,onRequestSubmit:()=>{t(i)},buttons:[{text:jk,submit:!0}]},d.createElement("div",{className:(0,g.iv)(Yk.container)},d.createElement("div",{className:(0,g.iv)(Yk.inputSection)},d.createElement("span",{className:(0,g.iv)(Yk.label)},"Unit operation"),d.createElement("span",{className:(0,g.iv)(Yk.inputText)},a)),d.createElement("div",{className:(0,g.iv)(Yk.inputSection)},d.createElement("span",{className:(0,g.iv)(Yk.label)},"User"),d.createElement("span",{className:(0,g.iv)(Yk.inputText)},d.createElement(fC.Z,{entity:n,size:SC.D.XXSMALL})," ",n.name))),d.createElement(WorksheetRunCheckbox,{isSkipChecked:i,onChangeSkipCheckbox:e=>{s(e)},checkboxLabel:"Mark all pending Pre-run steps as skipped"}))}const Yk=g.mM.create({container:{display:"flex",width:"100%",marginBottom:"16px"},inputSection:{flex:1,display:"flex",flexDirection:"column"},label:{fontSize:"13px",fontWeight:_n.KB,lineHeight:"16px",marginBottom:"4px"},inputText:{fontSize:"13px",fontWeight:_n.hS,lineHeight:"16px"}}),Qk={[Mk.$n.READY]:{text:"Start run",buttonStyle:C.ZJ.TERTIARY_BLUE,isDropdown:!1},[Mk.$n.ACTIVE]:{text:"Complete run",buttonStyle:C.ZJ.TERTIARY_BLUE,isDropdown:!1},[Mk.$n.COMPLETED]:{text:"Run completed",buttonStyle:C.ZJ.TERTIARY_WHITE,isDropdown:!0,icon:d.createElement(qk.Z,{status:Mk.$n.COMPLETED})},[Mk.$n.FAILED]:{text:"Run failed",buttonStyle:C.ZJ.TERTIARY_WHITE,isDropdown:!0,icon:d.createElement(qk.Z,{status:Mk.$n.FAILED})}}
function WorksheetStatusButton({name:e,onClick:t,status:n,lastEditedUser:a,timestamp:i}){const s=(0,d.useCallback)((()=>{n===Mk.$n.READY?(0,Xn.Z)(WorksheetStartRunModal,{onRequestSubmit:e=>{t(Mk.$n.ACTIVE,e)},name:e,currentUser:Jn.Z.currentUser()}):n===Mk.$n.ACTIVE&&(0,Xn.Z)(WorksheetEndRunModal,{onRequestSubmit:e=>{t(Mk.$n.COMPLETED,e)},name:e,currentUser:Jn.Z.currentUser(),endRunStatus:Mk.$n.COMPLETED})}),[e,t,n])
return d.createElement(BaseStatusButton,{menuOptions:WorksheetStatusButton_getDropdownMenuOptions(null!=a?a:Mk.E0,n,i),onClick:n===Mk.$n.READY||n===Mk.$n.ACTIVE?s:void 0,disabled:!n,...n?Qk[n]:Qk[Mk.$n.READY]})}function WorksheetStatusButton_getDropdownMenuOptions(e,t,n){if(t&&t!==Mk.$n.READY&&t!==Mk.$n.ACTIVE)return[d.createElement(N.Z,{isHovered:!1,key:"avatar-info"},d.createElement("div",{className:(0,g.iv)(Kk.dropdownDetails)},d.createElement("div",{className:(0,g.iv)(Kk.avatar)},d.createElement(fC.Z,{entity:e,size:SC.D.SMALL})),d.createElement("div",null,d.createElement("span",{className:(0,g.iv)(Kk.statusText)},Qk[t].text),d.createElement("br",null),d.createElement("span",{className:(0,g.iv)(Kk.timestampText)},n))))]}const Kk=g.mM.create({dropdownDetails:{display:"flex",cursor:"default",alignItems:"center"},avatar:{marginRight:"8px"},statusText:{fontSize:"13px",fontWeight:_n.KB,color:Vt.Rl,marginBottom:4},timestampText:{fontSize:"11px",fontWeight:_n.hS,lineHeight:"14px",color:Vt.hc}})
function WorksheetStatusDropdownButton({name:e,onSelect:t,disabled:n}){const a=[d.createElement(N.Z,{key:"fail-run",onSelect:()=>{(0,Xn.Z)(WorksheetEndRunModal,{onRequestSubmit:e=>{t(Mk.$n.FAILED,e)},name:e,currentUser:Jn.Z.currentUser(),endRunStatus:Mk.$n.FAILED})}},d.createElement("span",{className:(0,g.iv)(Jk.optionText)},"Fail run"))]
return d.createElement(BaseStatusDropdownButton,{buttonStyle:C.ZJ.TERTIARY_BLUE,menuOptions:a,disabled:n})}const Jk=g.mM.create({optionText:{fontSize:"13px",fontWeight:_n.hS,lineHeight:"16px",color:Vt.pp}})
function WorksheetStatusBadge({name:e,onSubmit:t,status:n,lastEditedUser:a,timestamp:i}){return d.createElement(Pr.Z,{...(0,ee.Z)({component:"WorksheetStatusBadge",element:"buttonGroup"})},d.createElement(WorksheetStatusButton,{name:e,onClick:t,status:n,lastEditedUser:a,timestamp:i}),(n===Mk.$n.READY||n===Mk.$n.ACTIVE)&&d.createElement(WorksheetStatusDropdownButton,{name:e,onSelect:t,disabled:!n}))}function WorksheetPageHeader({name:e,id:t,status:n,timestamp:a,onSubmit:i,lastEditedUser:s}){const r=n===Mk.$n.READY?null:n===Mk.$n.ACTIVE?"started":null==n?void 0:n.toLowerCase(),o=r?`Run ${r} on ${a}`:null
return d.createElement("div",{className:(0,g.iv)(Xk.headerContainer)},d.createElement("div",{...(0,ee.Z)({component:"WorksheetPageHeader",element:"name"}),className:(0,g.iv)(Xk.name)},d.createElement("div",null,e),o&&d.createElement("div",{className:(0,g.iv)(Xk.status)},o)),d.createElement("div",{className:(0,g.iv)(Xk.rightContainer)},d.createElement($k.Z,{ids:[t],buttonSize:C.qE.MEDIUM,buttonStyle:C.ZJ.TERTIARY_GRAY}),d.createElement(WorksheetStatusBadge,{name:e,onSubmit:i,timestamp:a,lastEditedUser:s,status:n===Mk.$n.SKIPPED?Mk.$n.COMPLETED:n}),d.createElement("div",null)))}const Xk=g.mM.create({headerContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},name:{display:"flex",flexDirection:"row",gap:"8px",fontSize:13,lineHeight:"16px",color:Vt.pp},rightContainer:{display:"flex",gap:"8px",flexDirection:"row"},buttonWrapper:{marginRight:"8px"},status:{fontSize:12,color:Vt.hc}})
var eM=n(126350),tM=n(157168)
function WorksheetSidepanel({worksheetStepGroups:e,selectedStep:t,setSelectedStep:n,refetch:a,isWorksheetPending:i,onAddStep:s}){const r=(0,d.useCallback)(((t,a)=>{const i=e[t].worksheetSteps[a].document.id
n({stepGroupIndex:t,stepIndex:a,document:{id:i,status:Mk._m.LOADED}})}),[n,e])
return d.createElement("div",{className:(0,g.iv)(nM.sidepanel)},e.map(((n,o)=>{const l=i&&0!==o&&o!==e.length-1,c=t.stepGroupIndex===o?t.stepIndex:void 0
return d.createElement(eM.Z,{key:`worksheet-step-group-${o}`,name:n.name,onAddStep:(e,t)=>{s(e,o,t)},locked:l},n.worksheetSteps.map(((e,t)=>{var n
const{taskId:i,status:s}="ProcessTaskNode"===(null===(n=null==e?void 0:e.task)||void 0===n?void 0:n.__typename)?{taskId:e.task.id,status:Mk.Gq[e.task.status.displayName]}:{taskId:null,status:null}
return d.createElement(tM.Z,{key:`worksheet-step-${t}`,name:e.document.name,isSelected:c===t,onClick:()=>{r(o,t)},processTaskData:null!=i?{taskId:i,status:s,shouldRenderStatusIcon:!l,refetch:a}:null})})))})))}const nM=g.mM.create({sidepanel:{borderRight:`1px solid ${Vt.pF}`,overflowY:"auto"}})
var aM=n(357444)
const iM=(0,Hh.x)((function getWorksheetStepContextFallback(){return{creationContextId:null}}),"WorksheetStepContext")
function convertTransitionsToStatusMap(e){return Object.fromEntries(e.map((e=>[e.outStatus.displayName.toUpperCase(),e.outStatus.id])))}function extractTaskData(e){return"ProcessTaskNode"===(null==e?void 0:e.__typename)?{lastEditedUser:e.lastStatusChange.creator,status:Mk.Gq[e.status.displayName],timestamp:Hr.UT(new Date(e.lastStatusChange.createdAt)),outStatuses:"ProcessTaskSchemaNode"===e.taskSchema.__typename?convertTransitionsToStatusMap(e.taskSchema.statusLifecycle.transitions):void 0,taskId:e.id}:{}}async function addStep(e,t,n,a,i,s){const r=e.worksheetStepGroups[n].worksheetSteps,o=a===Mk.LX.BOTTOM?r.length:0
await function addStepToWorksheet(e){return(0,Ic.jI)((0,Cn.s0)({url:`${(0,dC.Kq)(cC.J.PROCEDURE_METHOD_EXECUTION_INSTANCE)}/add-step-to-worksheet`,data:{data:e}}),"Adding step...")}({worksheetId:e.id,stepGroupIndex:n,stepIndex:o,stepName:t})
await i()
s({stepGroupIndex:n,stepIndex:o,document:{status:Mk._m.LOADING}})
v.ZP.success(`${t} has been added`)}function WorksheetDetails({worksheet:e,refetch:t,initialSelectedStep:n,onSetSelectedStep:a}){const[i,s]=(0,d.useState)(function getSelectedStep(e,t){const n=null==e?void 0:e.stepId
if(n)for(let e=0;e<t.worksheetStepGroups.length;e+=1){const a=t.worksheetStepGroups[e]
for(let t=0;t<a.worksheetSteps.length;t+=1){const{id:i}=a.worksheetSteps[t].document
if(i===n)return{document:{status:Mk._m.LOADED,id:i},stepId:n,stepIndex:t,stepGroupIndex:e}}}return{...e,document:{status:Mk._m.NOT_SELECTED}}}(n,e)),r=(0,d.useRef)(new DocumentUpdatesManager),o=null==i?void 0:i.stepGroupIndex,l=null==i?void 0:i.stepIndex,c=void 0!==o&&void 0!==l?e.worksheetStepGroups[o].worksheetSteps[l]:void 0,u=(0,d.useMemo)((()=>extractTaskData(null==c?void 0:c.task)),[null==c?void 0:c.task]),m=(0,d.useMemo)((()=>extractTaskData(e.task)),[e.task]),p=!m.status||m.status===Mk.$n.READY,h=p&&0!==o&&o!==e.worksheetStepGroups.length-1,E=(0,d.useCallback)((e=>{var t,n
const i=null===(t=e.document)||void 0===t?void 0:t.id
s({...e,stepId:i})
a({...e,stepId:i})
r.current.changeActiveDocument(null===(n=e.document)||void 0===n?void 0:n.id)}),[s,a]),f=(0,d.useCallback)(((n,a)=>{!async function updateTaskStatus(e,t,n,a,i){var s
const r=null===(s=n.outStatuses)||void 0===s?void 0:s[Mk.t[e].toUpperCase()];(0,S.hu)(void 0!==n.taskId&&void 0!==r,"Unable to update worksheet task")
const o=[{id:n.taskId,statusId:r,sourceType:"dashboard"}]
t&&a[e===Mk.$n.ACTIVE?0:1].worksheetSteps.filter((e=>{var t
return"ProcessTaskNode"===(null===(t=e.task)||void 0===t?void 0:t.__typename)&&e.task.status.displayName===aM.xy.READY})).forEach((e=>{var t
if("ProcessTaskNode"===(null===(t=e.task)||void 0===t?void 0:t.__typename)){const t="ProcessTaskSchemaNode"===e.task.taskSchema.__typename?convertTransitionsToStatusMap(e.task.taskSchema.statusLifecycle.transitions):void 0,n=null==t?void 0:t[Mk.$n.SKIPPED];(0,S.hu)(void 0!==n,`Unable to skip step ${e.document.name}`)
o.push({id:e.task.id,statusId:n,sourceType:"dashboard"})}}))
await(0,uA.ML)(o)
await i()}(n,a,m,e.worksheetStepGroups,t)}),[m,t,e.worksheetStepGroups]),y=(0,d.useCallback)(((n,a,i)=>{addStep(e,n,a,i,t,E)}),[e,t,E]);(null==c?void 0:c.document.id)!==i.document.id&&(null==c?void 0:c.document.id)&&E({...i,document:{id:c.document.id,status:Mk._m.LOADED}})
const b=(0,d.useMemo)((()=>({creationContextId:(null==c?void 0:c.creationContextId)||null})),[c]),T=d.createElement(iM.Provider,{value:b},d.createElement(Hl.Z,{backgroundColor:Hl.v.WHITE,header:d.createElement(WorksheetPageHeader,{name:e.name,id:e.id,status:m.status,timestamp:m.timestamp,onSubmit:f,lastEditedUser:m.lastEditedUser})},d.createElement("div",{className:(0,g.iv)(sM.container)},d.createElement(WorksheetSidepanel,{worksheetStepGroups:e.worksheetStepGroups,selectedStep:i,setSelectedStep:E,refetch:t,isWorksheetPending:p,onAddStep:y}),i.document.status===Mk._m.LOADED?d.createElement(WorksheetStepFrame,{stepName:null==c?void 0:c.document.name,document:i.document,stepTaskData:u,refetch:t,locked:h}):i.document.status===Mk._m.LOADING?d.createElement(kl.b,null):void 0)))
return m.taskId?d.createElement(Zk.Z,{apiIdToSubscribe:m.taskId,refetch:t},T):T}const sM=g.mM.create({container:{display:"flex",flexDirection:"row",height:"100%"}}),rM=xa.Ps`
  query WorksheetViewQuery($id: StrictString!) @skipAudit @engComponent(name: NOTEBOOK) {
    worksheet(id: $id) {
      ...WorksheetGraphQL
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("Worksheet").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function WorksheetView({id:e,onSetSelectedStep:t,initialSelectedStep:n}){const[a,i]=(0,d.useState)(),s=(0,Da.IJ)(rM,{variables:{id:e},onCompleted:i})
s.type===Da.NI.SUCCESS&&a!==s.data&&i(s.data)
if(a){if((0,ka.CZ)(a.worksheet))return d.createElement(Ll.Z,{inaccessibleInfo:a.worksheet,modelType:st.WORKSHEET})
{const refetch=async()=>{await s.refetch({id:e})}
return d.createElement(WorksheetDetails,{worksheet:a.worksheet,refetch,onSetSelectedStep:t,initialSelectedStep:n})}}return s.type===Da.NI.PENDING?d.createElement(kl.b,null):null}class WorksheetTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}getSelectedStep(){const e=(0,de.he)(window.location.href).anchor,t=this.model.get("selectedStep")
return e?{...t,stepId:e}:t}setSelectedStep(e){const t=null==e?void 0:e.stepId
t&&(window.location.hash=`#${t}`)
this.model.set("selectedStep",e)}render(){const e=this.model.get("id"),t=this.getSelectedStep();(0,Me.A9)(d.createElement(WorksheetView,{id:e,initialSelectedStep:t,onSetSelectedStep:e=>{this.setSelectedStep(e)}}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}WorksheetTabView.initClass()
var oM=n(486463)
function ProcedureRunDetails({procedureRun:e,reload:t}){return d.createElement("div",{className:"react-tab-container",...(0,ee.Z)({component:"ProcedureRunDetails",element:"root"})},e.id,d.createElement("br",null),e.name)}const lM=xa.Ps`
  query ProcedureRunViewQuery($id: StrictString!) @skipAudit @engComponent(name: PROCEDURES) {
    procedureRun(id: $id) {
      ... on ProcedureRunNode {
        id
        name
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ProcedureRunView({id:e}){(0,S.hu)(dt.ZP.PROCEDURES_ENABLE_M1,"PROCEDURES_ENABLE_M1 is not enabled")
const t=(0,Da.IJ)(lM,{variables:{id:e}})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.SUCCESS){const{data:n}=t
if((0,ka.CZ)(n.procedureRun))return d.createElement(Ll.Z,{inaccessibleInfo:n.procedureRun,modelType:st.PROCEDURE_RUN})
{const reload=()=>{t.refetch({id:e})}
return d.createElement(ProcedureRunDetails,{procedureRun:n.procedureRun,reload})}}return null}class ProcedureRunTabView extends s().View{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){const e=this.model.get("id");(0,Me.A9)(d.createElement(ProcedureRunView,{id:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ProcedureRunTabView.initClass()
var cM=n(112866),dM=n(893342),uM=n(420035)
const mM=(0,_a.$j)((function StructuredTableEditStatusManager_mapStateToProps(e,t){return{editStatus:(0,uM.v)(t.tableCid)}}))((function UnconnectedStructuredTableEditStatusManager(e){const{submitHandler:t,revertHandler:n,table:a,tableCid:i,editStatus:s}=e,[r,o]=(0,d.useState)(a),l=(0,Pu.Z)(e.editStatus),c=(0,d.useCallback)((async()=>{await t()}),[t]),u=(0,d.useCallback)((()=>{n(r)}),[n,r]);(0,d.useEffect)((()=>{if(l!==s){s===dM.V.EDITING&&l!==dM.V.SAVING&&o(a)
s===dM.V.SAVING&&(async()=>{try{await c();(0,uM.sF)(i,dM.V.LOCKED)}catch(e){(0,uM.sF)(i,dM.V.EDITING)
v.ZP.notifyError(e)}})()
if(s===dM.V.REVERTING){u();(0,uM.sF)(i,dM.V.LOCKED)}}}),[l,s,c,u,a,i])
return d.createElement(d.Fragment,null,e.children(s))}))
mM.displayName="StructuredTableEditStatusManager"
const pM=mM
function ToggleEditStructuredTableOutsideNotebook(e){var t
return e.isEditable?d.createElement(pM,{tableCid:e.structuredTable.cid,table:e.structuredTable,submitHandler:e.submit,revertHandler:e.revert},(t=>{var n
return d.createElement(UO.Z,{structuredTable:e.structuredTable,cid:e.structuredTable.cid,updateHandler:e.update,onComputedTableChanged:e.updateComputedTable,disableMaximizedTables:null!==(n=e.disableMaximizedTables)&&void 0!==n&&n,isMaximized:e.isMaximized,setMaximizedTable:e.setIsMaximized,outsideNotebookContext:e.outsideNotebookContext,locked:t===dM.V.LOCKED,hideFormulaBox:t===dM.V.LOCKED,includeUnsubmittedStatus:t===dM.V.EDITING})})):d.createElement(UO.Z,{structuredTable:e.structuredTable,cid:e.structuredTable.cid,updateHandler:e.update,locked:!0,hideFormulaBox:!0,disableMaximizedTables:null!==(t=e.disableMaximizedTables)&&void 0!==t&&t,isMaximized:e.isMaximized,setMaximizedTable:e.setIsMaximized,includeUnsubmittedStatus:!1})}var hM=n(98705),gM=n(970507),EM=n(973538),fM=n(204218),SM=n(908503)
function ArchivePurposeText(e){return d.createElement("div",{className:"faded u-small-spacing-top u-spacing-bottom"},"(",e.purpose,")")}function summarizeTasks(e,t){const n=Object.keys(Sn.HS).sort(((e,t)=>SM._r[e]-SM._r[t])).map((e=>({statusType:e,count:0,displayNamesForThisStatus:new Set})))
for(const t of e){const e=n.find((({statusType:e})=>e===t.status.statusType))
if((0,S.Gp)(null!=e,"Unrecognized status",{type:t.status.statusType})){++e.count
e.displayNamesForThisStatus.add(t.status.displayName)}}return n.filter((({count:e})=>t||e>0)).map((({statusType:e,count:t,displayNamesForThisStatus:n})=>({count:t,statusType:e,label:1===n.size?n.values().next().value:(0,aM.NJ)(e)})))}function TaskStatusSummary(e){return null!=e.archiveRecord?d.createElement(ArchivePurposeText,{purpose:e.archiveRecord.purpose}):d.createElement("div",{className:"u-small-spacing-top u-spacing-bottom "},d.createElement(fM.Z,{statusCounts:summarizeTasks(e.tasks,e.includeZeroCountStatuses)}))}var yM=n(639812),bM=n(733727),TM=n(655964),vM=n(122332),CM=n(166843),IM=n(912478),wM=n(1456)
function updateTaskTable(e,t,n){const a=(0,wM.getStructuredTableAdapters)()[Tb.sl.PROCESS_TASK]
return(0,tm.Uy)(e,(i=>{i.rows=t.map(((t,i)=>({...a.getBlankRow(e.metadata,i,e.columns),...TM.ZP.makeRowFromTask(t,e.columns),isFinalized:!1,metadata:a.getBlankRowMetadata(e.metadata),...n?{lastSyncedUpstreamValues:n[i]}:{}})))}))}var NM=n(619163),AM=n(32297),RM=n(702024)
function ProcessWatchersField_ProcessWatchersField(e){return null==e.processId?d.createElement(kl.Z,null):d.createElement(dA.Z,{value:e.watchers,onChange:e.onChange,isDisabled:e.isDisabled,chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowEmails:!1,allowTeams:!1,allowOrganizations:!1,shouldAllowMultiple:!0,userSearchType:tA.t.NotSuspended,isFullWidth:!1,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0,useAvatars:!0,maxAvatars:2})}var PM=n(863282)
async function submitOutputs({processOutputs:e,processTasks:t,outputTable:n}){const a=await(0,uA.yf)(e,t)
return{newOutputTable:function updateOutputTable(e,t,n){const a=PM.Z.getAdapter()
return(0,tm.Uy)(e,(i=>{i.rows=t.map(((t,i)=>({...a.getBlankRow(e.metadata,i,e.columns),...PM.Z.makeRowFromOutput(t,e.columns),isFinalized:!1,metadata:a.getBlankRowMetadata(e.metadata),...n?{lastSyncedUpstreamValues:n[i]}:{}})))}))}(n,a.processOutputs,a.processOutputs.map((e=>PM.Z.optimisticallyMakeLastSyncedUpstreamValuesFromOutput(e,n.columns)))),serverTasks:a.processTasks,serverOutputs:a.processOutputs}}var OM=n(522872)
const xM=xa.Ps`
  query ProcessManagementDashboardProcessToTasksQuery($processIds: [StrictString!]!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    processes(ids: $processIds) {
      ... on ProcessNode {
        id
        tasks {
          ...ProcessTaskListingGraphQL
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${(0,La.f)("ProcessTaskListing").fragment}
`
function ExecuteTaskGroupsButton({processes:e,isSingleTaskGroupContext:t,onTasksOrOutputsChange:n,actionOrigin:a}){t&&(0,S.hu)(1===e.length,`ExecuteTaskGroupsButton expected one Process but got ${e.length}`)
const i=e.map((e=>e.id)),s=function getExecuteTooltipMessage(e,t){const n=e.reduce(((e,t)=>e+t.pendingTasksCount),0)
return 0===e.length?"No task groups selected":e.some((t=>t.processTaskSchema.id!==e[0].processTaskSchema.id))?"All task groups must have the same task schema":0===n?(t?"Task group does":"Selected task groups do")+" not have any pending tasks":e[0].processTaskSchema.executionType===Sn.Pf.ENTRY&&n>dt.ZP.WORKFLOWS_MAX_TASKS_PER_ENTRY?`You cannot execute more than ${dt.ZP.WORKFLOWS_MAX_TASKS_PER_ENTRY} tasks into a single entry`:null==e[0].processTaskSchema.entryTemplate&&null==e[0].processTaskSchema.outputSchema?"You cannot execute direct execution tasks without an output schema configuration":null}(e,t)
return d.createElement(OM.Z,{getTasksToExecute:async()=>await async function getProcessTasksForProcesses(e){const{processes:t}=await(0,Ml.doQuerySafe)({query:xM},{variables:{processIds:e},fetchPolicy:"network-only"})
return t.filter((e=>!(0,ka.CZ)(e))).map((e=>e.tasks)).flat().filter((e=>e.status.statusType===Sn.HS.PENDING))}(i),disabledMessage:s,onTasksOrOutputsChange:n,actionOrigin:a})}function archiveProcess(e,t){Sc.bA({items:[e],onArchive:async(e,n)=>{await(0,Ic.jI)(async function doArchive(){await(0,uA.uc)(st.PROCESS,e,n)
await t()}(),"Archiving workflow...")}})}async function unarchiveProcess(e,t){await(0,Ic.jI)(async function doUnarchive(){await(0,uA.Re)(st.PROCESS,[e.id])
await t()}(),"Unarchiving task group...")}function ArchiveProcessButton(e){const t=(0,yc.ZP)(e.process)
return d.createElement(P.ZP,{title:t?"Unarchive task group":"Archive task group"},d.createElement(C.Co,{buttonStyle:t?C.ZJ.SECONDARY:C.ZJ.TERTIARY_GRAY,className:f()("u-mini-spacing-left",(0,g.iv)(_M.archiveButton)),disabled:!1,icon:t?"unarchive":"archive",iconAltText:t?"Unarchive":"Archive",onClick:()=>{(t?unarchiveProcess:archiveProcess)(e.process,e.forceRefetch)},size:C.qE.MINI}))}const _M=g.mM.create({archiveButton:{height:"28px",width:"28px"}})
function ProcessActionToolbar(e){return d.createElement("div",{className:(0,g.iv)(DM.toolbarWrapper)},d.createElement(ArchiveProcessButton,{process:e.process,forceRefetch:e.forceRefetch}),e.process.processTaskSchema.executionType!==Sn.Pf.FLOWCHART&&d.createElement("div",{className:f()("buttonGroup",(0,g.iv)(DM.executionButtonWrapper))},d.createElement(ExecuteTaskGroupsButton,{processes:[e.process],isSingleTaskGroupContext:!0,onTasksOrOutputsChange:(t,n)=>{e.onTasksOrOutputsChange(t,n)},actionOrigin:Sn.D2.WORKFLOWS_TASK_GROUP_PAGE})))}const DM=g.mM.create({toolbarWrapper:{display:"flex"},executionButtonWrapper:{marginLeft:"8px"}})
function ProcessNameEditor(e){const{process:t}=e,n=(0,d.useRef)(null)
return d.createElement("div",{className:"metadata-header-section"},d.createElement(uC.Z,{ref:n,initialAlias:e.process.name,isFullWidth:!1,isHeader:!0,isWritable:e.process.permissions.writable,complete:async e=>{var a
const i=t.name
if(i!==e)try{await Rn.Z.renameFileWithDataMods(t.id,!1,{oldName:i,newName:e,parentFolderId:t.folder.id})
m.gx(j.Zm.UPDATED_TASK_GROUP_NAME,j.XC.WORKFLOWS,{action_origin:j.D2.WORKFLOWS_TASK_GROUP_PAGE,old_value:i,new_value:e})}catch(e){null===(a=n.current)||void 0===a||a.reset()}},placeholder:"Name"}))}function ProcessDetailsColumn(e){return d.createElement(p.Z,{sm:4},d.createElement("div",{className:"metadata-section"},d.createElement("div",{className:"metadata-header"},e.title),e.children))}function RootProcessLink(e){const{rootProcess:t}=e
return(0,ka.CZ)(t)?d.createElement(d.Fragment,null,"No access",d.createElement(P.ZP,{title:"Please contact your administrator for access to the parent task group"},d.createElement(pe.Z,{icon:"info-circle",className:(0,g.iv)(LM.iconStyle)}))):d.createElement(uc.Z,{href:de.jp(t.editUrl)},t.name)}async function submitOutputsAndCorrespondingTasksPostConfirmation({process:e,processTasks:t,processOutputs:n,outputTable:a,taskTable:i,setTaskTable:s,setOutputTable:r}){const{newTaskTable:o,newOutputTable:l,serverTasks:c,serverOutputs:d}=await async function submitOutputsWithCorrespondingTaskUpdates({process:e,processOutputs:t,processTasks:n,outputTable:a,taskTable:i}){const s=await submitOutputs({processOutputs:t,processTasks:n,outputTable:a})
let r=i
if(n){const t=(0,Jt.Pe)(s.serverTasks,(e=>e.id)),n=e.tasks.map((e=>{var n
return null!==(n=t[e.id])&&void 0!==n?n:e}))
r=updateTaskTable(i,n,n.map((e=>TM.ZP.optimisticallyMakeLastSyncedUpstreamValuesFromTask(e,i.columns))))}return{newTaskTable:r,...s}}({process:e,processTasks:t,processOutputs:n,outputTable:a,taskTable:i})
s(o)
r(l);(0,RM.x)(e.id,{outputs:d,tasks:c,mergeTasks:!0})
m.L9(j.Zm.CLICKED_OUTPUT_TABLE_SUBMIT)}async function submitOutputTableHandler({process:e,outputTable:t,computedOutputTable:n,taskTable:a,setTaskTable:i,setOutputTable:s}){var r,o
const l=`workspace_tab_${(0,hM.z)(t)}_direct`;(0,S.hu)((null!==(o=null===(r=t.columns)||void 0===r?void 0:r.length)&&void 0!==o?o:0)>1,"Output table must exist and have columns")
if(!(0,S.Gp)(!(0,gM.Z)(n),"Output table has errors"))return
const c=function outputTableToOutputs(e,t,n,a){const i=(0,bM.ZH)({table:e,evaluatedTable:t,creationOriginIds:Array(t.length).fill(a),sourceType:n});(0,S.Gp)(i.length>0,"Expected outputs to submit to be greater than 0.")
return i}(t,n,l,e.id)
await(0,vM.Z)({outputs:c,onRequestSubmit:async({processOutputs:n,processTasks:r})=>{await submitOutputsAndCorrespondingTasksPostConfirmation({processOutputs:n,processTasks:null==r?void 0:r.map((e=>({...e,sourceType:l}))),process:e,outputTable:t,taskTable:a,setTaskTable:i,setOutputTable:s})}})}function ProcessDetails(e){var t,n,a,i
const{process:s,selectors:r}=e,o=(0,d.useMemo)((()=>(0,bb.OU)(r)),[r]),l=(0,EM.k)(s.processTaskSchema),buildTaskTable=e=>(0,yM.Z)({process:e,tableLocation:aM.$o.WORKSPACE_TAB,selectorsById:o,locked:!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT}),isInFlowchartNode:null!=e.rootProcess}),buildOutputTable=e=>function hasOutputSchema(e){return null!=e.processTaskSchema.outputSchema}(e)?(0,AM.ZP)({process:e,metadata:{tableLocation:aM.$o.WORKSPACE_TAB},selectorsById:o,locked:!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})}):null,[c,u]=(0,d.useState)(s.tasks),[E,f]=(0,d.useState)(buildTaskTable(s)),[y,b]=(0,d.useState)(buildOutputTable(s)),[T,C]=(0,d.useState)(),[I,w]=(0,d.useState)(),[N,A]=(0,d.useState)(),R=s.processTaskSchema.executionType===Sn.Pf.DIRECT;(0,d.useEffect)((()=>{u(s.tasks)
f(buildTaskTable(s))
b(buildOutputTable(s))}),[s])
const updateHandlerTaskTable=(t,n)=>{f(t)
if(n){const t=e.process.tasks.map(((e,t)=>(0,$u.Lv)(e,n[t])));(0,RM.x)(e.process.id,{tasks:t})}m.L9(j.Zm.CLICKED_TASK_TABLE_EDIT)},updateHandlerOutputTable=(t,n)=>{b(t)
if(n){const t=e.process.outputs.map(((e,t)=>(0,$u.Lv)(e,n[t])));(0,RM.x)(e.process.id,{outputs:t})}m.L9(j.Zm.CLICKED_OUTPUT_TABLE_EDIT)},submitTaskTableHandler=async()=>{var e,t;(0,S.hu)((null!==(t=null===(e=null==E?void 0:E.columns)||void 0===e?void 0:e.length)&&void 0!==t?t:0)>1,"Generated task table must have columns")
if((0,S.Gp)(!(0,gM.Z)(T),"Task table has errors")){const e=(0,IM.Z)({table:E,evaluatedTable:T,processId:s.id,sourceType:`workspace_tab_${(0,hM.z)(E)}_direct`})
await(0,CM.Z)({taskSchemaId:(0,TM.Ij)(E.schemas).id,tasks:e.map(((e,t)=>{var n,a
return{...e,oldStatusId:null!==(a=null===(n=(0,TM.UW)(E.rows[t]))||void 0===n?void 0:n.id)&&void 0!==a?a:""}})),onRequestSubmit:async()=>{const t=await(0,uA.ML)(e),n=updateTaskTable(E,t.tasks,t.lastSyncedUpstreamValues)
u(t.tasks)
f(n);(0,RM.x)(s.id,{tasks:t.tasks})
m.L9(j.Zm.CLICKED_TASK_TABLE_SUBMIT)}})}}
if(null!=N){if(N===E.cid)return d.createElement(ToggleEditStructuredTableOutsideNotebook,{isEditable:!0,structuredTable:E,update:updateHandlerTaskTable,submit:submitTaskTableHandler,revert:e=>{f(e)},disableMaximizedTables:!1,updateComputedTable:C,isMaximized:!0,setIsMaximized:()=>{A(null)
m.L9(j.Zm.CLICKED_TABLE_COLLAPSE)}})
if(N===(null==y?void 0:y.cid))return d.createElement(ToggleEditStructuredTableOutsideNotebook,{isEditable:R,structuredTable:y,outsideNotebookContext:{taskIds:c.map((({id:e})=>e))},update:updateHandlerOutputTable,submit:async()=>{await submitOutputTableHandler({process:e.process,outputTable:y,taskTable:E,computedOutputTable:I,setTaskTable:f,setOutputTable:b})},revert:e=>{b(e)},disableMaximizedTables:!1,updateComputedTable:w,isMaximized:!0,setIsMaximized:()=>{A(null)
m.L9(j.Zm.CLICKED_TABLE_COLLAPSE)}});(0,S.hu)(!1,"Expanded table must be one of task and output table")}return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(LM.headingWrapper)},d.createElement("div",null,d.createElement(ProcessNameEditor,{process:e.process}),d.createElement(TaskStatusSummary,{tasks:c,archiveRecord:s.archiveRecord})),d.createElement("div",{className:"u-small-padding-right"},d.createElement(ProcessActionToolbar,{process:s,forceRefetch:e.refetch,onTasksOrOutputsChange:(t,n)=>{(0,RM.x)(e.process.id,{tasks:t,outputs:n,mergeTasks:!0,mergeOutputs:!0})}}))),d.createElement("div",{className:(0,g.iv)(LM.detailsRow)},d.createElement(h.Z,null,d.createElement(ProcessDetailsColumn,{title:"Schema"},d.createElement("span",null,s.processTaskSchema.name,s.processTaskSchema.archiveRecord&&" (archived)")),d.createElement(ProcessDetailsColumn,{title:"Execution type"},d.createElement("span",null,aM.TC[s.processTaskSchema.executionType])),e.process.rootProcess&&d.createElement(ProcessDetailsColumn,{title:"Flowchart"},d.createElement(RootProcessLink,{rootProcess:e.process.rootProcess})),d.createElement(ProcessDetailsColumn,{title:"Watchers"},d.createElement("span",{className:(0,g.iv)(LM.watcherListWrapper)},d.createElement(ProcessWatchersField_ProcessWatchersField,{processId:null!==(n=null===(t=e.process)||void 0===t?void 0:t.id)&&void 0!==n?n:null,watchers:null!==(i=null===(a=e.process)||void 0===a?void 0:a.watchers)&&void 0!==i?i:[],onChange:async t=>{const{watchers:n}=await(0,uA.Q3)({id:e.process.id,watcherIds:t.map((({id:e})=>e)),sourceType:"details",actionOrigin:j.D2.WORKFLOWS_TASK_GROUP_PAGE,actionMethod:j.LY.DIRECT_EDIT,eventGroupId:(0,m.Vr)()});(0,RM.x)(e.process.id,{watchers:n})
v.ZP.success("Updated watchers")},isDisabled:!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:s})}))))),dt.ZP.WORKFLOWS_ENABLE_TASK_GROUP_INSTRUCTIONS&&d.createElement("div",{className:(0,g.iv)(LM.detailsRow)},d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("div",{className:"metadata-section"},d.createElement("div",{className:"metadata-header"},"Instructions"),d.createElement(NM.a7,{lines:aM.g$.WORKSPACE_TAB,textValue:e.process.processTaskSchema.taskGroupInstructions,actionOrigin:NM.IU.PROCESS_DETAILS}))))),E&&d.createElement(ToggleEditStructuredTableOutsideNotebook,{isEditable:l,structuredTable:E,update:updateHandlerTaskTable,submit:submitTaskTableHandler,revert:e=>{f(e)},disableMaximizedTables:!1,updateComputedTable:C,isMaximized:!1,setIsMaximized:()=>{A(E.cid)
m.L9(j.Zm.CLICKED_TABLE_EXPAND)}}),y&&d.createElement(ToggleEditStructuredTableOutsideNotebook,{isEditable:R&&l,structuredTable:y,outsideNotebookContext:{taskIds:c.map((({id:e})=>e))},update:updateHandlerOutputTable,submit:async()=>{await submitOutputTableHandler({process:e.process,outputTable:y,taskTable:E,computedOutputTable:I,setTaskTable:f,setOutputTable:b})},revert:e=>{b(e)},disableMaximizedTables:!1,updateComputedTable:w,isMaximized:!1,setIsMaximized:()=>{A(y.cid)
m.L9(j.Zm.CLICKED_TABLE_EXPAND)}}))}function QueryingProcessDetails(e){return d.createElement(Da.ZP,{query:bb.Xk,variables:{includeArchived:!0},renderLoading:()=>d.createElement(kl.b,null)},(t=>{const n=(0,zo.NA)("SchemaFieldSelector",t.schemaFieldSelectors)
return d.createElement(Da.ZP,{query:RM.z,variables:{processId:e.processId},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0,renderLoading:()=>d.createElement(kl.b,null)},((e,{refetch:t})=>{const{process:a}=e
return(0,ka.CZ)(a)?d.createElement(Ll.Z,{inaccessibleInfo:a,modelType:"process"}):d.createElement(Zk.Z,{apiIdToSubscribe:a.id,refetch:t,refetchOnMessagesFromSameClient:!0},d.createElement(ProcessDetails,{process:a,selectors:n,refetch:t}))}))}))}const LM=g.mM.create({headingWrapper:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},detailsRow:{marginTop:"20px"},iconStyle:{marginLeft:"5px",color:Vt.TG},watcherListWrapper:{marginTop:"-6px",display:"flex"}})
class ProcessDetailsTabView extends Js{render(){const e={processId:this.model.get("processId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(QueryingProcessDetails,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ProcessDetailsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var kM=n(944163),MM=n(323199),FM=n(67917),ZM=n(608128)
const BM=xa.Ps`
  query ProcessFlowchartStructureQuery($flowchartIds: [StrictString!]!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    processFlowcharts(ids: $flowchartIds) {
      ... on ProcessFlowchartNode {
        id
        nodeConfigs {
          id
          nodeDetails {
            ... on ProcessTaskNodeDetailsNode {
              id
              type
              schema {
                ... on ProcessTaskSchemaNode {
                  id
                  name
                }
                ...InaccessibleInfoGraphQL
              }
            }
            ... on ProcessRouterNodeDetailsNode {
              ...ProcessRouterNodeDetails
            }
            ... on ProcessRootNodeDetailsNode {
              ...ProcessRootNodeDetailsGraphQL
            }
            ... on ProcessOutputNodeDetailsNode {
              ...ProcessOutputNodeDetailsGraphQL
            }
            ... on ProcessEndNodeDetailsNode {
              ...ProcessEndNodeDetailsGraphQL
            }
          }
          inboundSchemaMappers {
            id
            toNodeConfig {
              id
            }
            schemaMapperConfig {
              id
            }
            schemaMapperDependencies {
              id
              fromNodeConfig {
                id
              }
            }
          }
        }
        edgeConfigs {
          id
          fromNodeConfig {
            id
          }
          toNodeConfig {
            id
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${FM.Ti}
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${(0,La.f)("ProcessRootNodeDetails").fragment}
  ${(0,La.f)("ProcessOutputNodeDetails").fragment}
  ${(0,La.f)("ProcessEndNodeDetails").fragment}
`,qM=xa.Ps`
  fragment ExecutionFlowchartData on ProcessTaskExecutionFlowchartData {
    flowchartProcesses {
      id
      nodeConfig {
        id
      }
    }
    flowchartTasks {
      task {
        id
        process {
          id
        }
        status {
          id
          statusType
        }
        flowchartPredecessorNodes {
          id
        }
      }
      nodeConfig {
        id
        nodeDetails {
          ... on ProcessTaskNodeDetailsNode {
            id
            type
            schema {
              ... on ProcessTaskSchemaNode {
                id
                name
              }
              ...InaccessibleInfoGraphQL
            }
          }
          ... on ProcessRootNodeDetailsNode {
            ...ProcessRootNodeDetailsGraphQL
          }
          ... on ProcessRouterNodeDetailsNode {
            ...ProcessRouterNodeDetails
          }
          ... on ProcessOutputNodeDetailsNode {
            ...ProcessOutputNodeDetailsGraphQL
          }
          ... on ProcessEndNodeDetailsNode {
            ...ProcessEndNodeDetailsGraphQL
          }
        }
      }
    }
  }
`,VM=xa.Ps`
  fragment ProcessFlowchartDataInfo on ProcessTaskNode {
    id
    status {
      id
      statusType
    }
    outputs {
      id
      process {
        id
        nodeConfig {
          id
        }
      }
      flowchartPredecessorNodes {
        id
      }
    }
    executionFlowchartData {
      ...ExecutionFlowchartData
    }
  }
  ${(0,La.f)("ProcessOutputNodeDetails").fragment}
  ${(0,La.f)("ProcessRootNodeDetails").fragment}
  ${(0,La.f)("ProcessEndNodeDetails").fragment}
  ${FM.Ti}
  ${qM}
`,UM=xa.Ps`
  query ProcessFlowchartDataQuery($processTaskIds: [StrictString!]!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    processTasks(ids: $processTaskIds) {
      ... on ProcessTaskNode {
        ...ProcessFlowchartDataInfo
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${VM}
`
function PollingFlowchartWrapper(e){const[t,n]=(0,d.useState)(null),[a,i]=(0,d.useState)(null),s=(0,Da.IJ)(BM,{variables:{flowchartIds:e.flowchartIds}}),r=(0,Da.IJ)(UM,{variables:{processTaskIds:e.processTaskIds},pollInterval:dt.ZP.WORKFLOWS_FLOWCHART_VIEWER_POLL_INTERVAL_MS,renderCachedDataWhenRefetching:!0})
if(s.type!==Da.NI.SUCCESS||r.type!==Da.NI.SUCCESS&&r.networkStatus===ZM.I.refetch)return d.createElement(kl.b,null)
r.type!==Da.NI.SUCCESS||Is()(a,r.data)||i(r.data)
const o=s.data.processFlowcharts.filter((e=>!(0,ka.CZ)(e)))
Is()(t,o)||n(o)
return null==a||null==t?d.createElement(kl.b,null):e.children(t,a,(()=>{n(null)
i(null)
r.client.resetStore()}))}function NonPollingFlowchartWrapper(e){const t=(0,Da.IJ)(BM,{renderCachedDataWhenRefetching:!0,variables:{flowchartIds:e.flowchartIds}}),n=(0,Da.IJ)(UM,{variables:{processTaskIds:e.processTaskIds},renderCachedDataWhenRefetching:!0,fetchPolicy:"network-only"})
if(t.type!==Da.NI.SUCCESS||n.type!==Da.NI.SUCCESS)return d.createElement(kl.b,null)
const a=t.data.processFlowcharts.filter((e=>!(0,ka.CZ)(e)))
return e.children(a,n.data,(()=>{e.refetchParent()
t.refetch()
n.refetch()}))}function LiveUpdatingFlowchartWrapper(e){return dt.ZP.WORKFLOWS_ENABLE_LIVE_UPDATING_UI?d.createElement(NonPollingFlowchartWrapper,{flowchartIds:e.flowchartIds,processTaskIds:e.processTaskIds,refetchParent:e.refetch},((t,n,a)=>d.createElement(Zk.Z,{apiIdToSubscribe:e.parentId,refetch:a,refetchOnMessagesFromSameClient:!0},e.children(t,n,a)))):d.createElement(PollingFlowchartWrapper,{flowchartIds:e.flowchartIds,processTaskIds:e.processTaskIds},((t,n,a)=>e.children(t,n,a)))}var GM=n(422236),zM=n(648214),$M=n(930630),WM=n(213150),HM=n(135117),jM=n(796208),YM=n(724475),QM=n(888666),KM=n(341794)
const JM=g.mM.create({edgeSvg:{overflow:"visible"},edge:{stroke:YM.oq,fill:"none"}}),XM={[YM.mm.STATIC_VIEWER]:function ProcessFlowchartStaticEdgeRenderer({data:e,sourceX:t,sourceY:n,targetX:a,targetY:i,sourcePosition:s,targetPosition:r,markerEnd:o,label:l,...c}){(0,S.hu)(null!=e,"Unable to render a flowchart edge without data")
const u=(0,GM._K)(),m=u.getNode(e.toNodeClientId),p=u.getNode(e.fromNodeClientId),h=u.getNodes(),E=u.getEdges(),{flowchartClientId:f}=jM.Z.useContext(),{edgePath:y,labelX:b,labelY:T}=(0,QM.v)((0,ig.Z)(e,"hasBeenUsedToCreateData"),{sourceX:t,sourceY:n,targetX:a,targetY:i,sourcePosition:s,targetPosition:r},h,E,!1,f,p,m,e.layout)
return d.createElement(d.Fragment,null,d.createElement("svg",{className:(0,g.iv)(JM.edgeSvg)},d.createElement("path",{id:e.clientId,className:(0,g.iv)(JM.edge),d:y,markerEnd:o})),null!=l&&d.createElement(GM.XQ,null,d.createElement(KM.Z,{label:l,labelX:b,labelY:T,labelShowBg:c.labelShowBg,labelStyle:c.labelStyle,labelBgPadding:c.labelBgPadding,labelBgBorderRadius:c.labelBgBorderRadius,labelBgStyle:c.labelBgStyle})))}}
var eF=n(795361),tF=n(703103),nF=n(210347)
function allDataInNodeConfig(e,t){var n,a,i
const s=[],r=new Set
let o=null
for(const l of e){if((0,ka.CZ)(l))continue
const e=l.executionFlowchartData
if(null!=(null==e?void 0:e.flowchartTasks)){for(const a of e.flowchartTasks){if((t.type===Sn.Og.ROOT_NODE_DETAILS&&null==a.nodeConfig||(null===(n=a.nodeConfig)||void 0===n?void 0:n.id)===t.clientId)&&!r.has(a.task.id)){r.add(a.task.id)
s.push(a.task)}}if(null==o)for(const n of e.flowchartProcesses)((null===(a=n.nodeConfig)||void 0===a?void 0:a.id)===t.clientId||t.type===Sn.Og.ROOT_NODE_DETAILS&&null==(null===(i=n.nodeConfig)||void 0===i?void 0:i.id))&&(o=n.id)}}return{processId:o,tasks:s}}function summarizeStatusesAndLinkedProcess(e){const t={}
for(const n of e){const{statusType:e}=n.status
null!=t[e]?++t[e]:t[e]=1}return Object.keys(t).sort(((e,t)=>SM._r[e]-SM._r[t])).map((e=>({statusType:e,count:t[e]})))}function getEdgeHash(e,t){return`${e}-${t}`}function getExecutionFlowchartData(e){return e.executionFlowchartData}function getEdgesUsedInFlowchartRootedAtTask(e){var t,n,a
if((0,ka.CZ)(e)||null==getExecutionFlowchartData(e))return new Set
const i=(null!==(n=null===(t=getExecutionFlowchartData(e))||void 0===t?void 0:t.flowchartTasks)&&void 0!==n?n:[]).map((({task:e,nodeConfig:t})=>({...e,process:{...e.process,nodeConfig:t}}))),s=new Set
for(const t of[...e.outputs,...i]){const e=t.flowchartPredecessorNodes,n=null===(a=t.process.nodeConfig)||void 0===a?void 0:a.id
ps()(null!=n,"Should not be mapping to dummy output node when V2 flowcharts are enabled")
for(const{id:t}of e)s.add(getEdgeHash(t,n))}return s}function getAllEdgesUsedInFlowchartTasksLineage(e){return e.reduce(((e,t)=>new Set([...e,...getEdgesUsedInFlowchartRootedAtTask(t)])),new Set)}function mergeTaskLineageIntoFlowchart({flowchart:e,sourceTasks:t,processBeingViewed:n,shouldLinkProcess:a}){return(0,tm.ZP)(e,(e=>{for(const i of e.nodes){const{processId:e,tasks:s}=allDataInNodeConfig(t,i),r=summarizeStatusesAndLinkedProcess(s),o=i.processId||e,l=o===n
i.statusCounts=r
i.isHighlighted=o===n
a&&!i.isInaccessible&&(i.processId=l?null:o)}const i=getAllEdgesUsedInFlowchartTasksLineage(t)
for(const t of e.edges)t.hasBeenUsedToCreateData=i.has(getEdgeHash(t.fromNodeClientId,t.toNodeClientId))}))}var aF=n(44254)
var iF=n(864430)
const sF=xa.Ps`
  query ProcessFlowchartRootProcessQuery($flowchartProcessId: StrictString!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    process(id: $flowchartProcessId) {
      ... on ProcessNode {
        id
        taskSchemaOrInaccessible {
          ... on ProcessTaskSchemaNode {
            ...ProcessTaskSchemaGraphQL
          }
          ...InaccessibleInfoGraphQL
        }
        tasks {
          ... on ProcessTaskNode {
            id
            name
            executionFlowchart {
              id
            }
          }
        }
        flowchartConfigVersion {
          ... on ProcessFlowchartConfigVersionNode {
            ...ProcessFlowchartConfigVersionGraphQL
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }

  ${(0,La.f)("ProcessTaskSchema").fragment}
  ${(0,La.f)("ProcessFlowchartConfigVersion").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,rF=xa.Ps`
  query ProcessFlowchartModificationSourceDataQuery(
    $flowchartId: StrictString!
    $flowchartTaskIds: [StrictString!]!
    $nodeTaskSchemaIds: [StrictString!]!
  ) @skipAudit @engComponent(name: WORKFLOWS) {
    processFlowchart(id: $flowchartId) {
      ... on ProcessFlowchartNode {
        ...ProcessFlowchartV2GraphQL
      }
      ...InaccessibleInfoGraphQL
    }
    processTasks(ids: $flowchartTaskIds) {
      ... on ProcessTaskNode {
        ...ProcessFlowchartDataInfo
      }
      ...InaccessibleInfoGraphQL
    }
    processTaskSchemas(ids: $nodeTaskSchemaIds) {
      ... on ProcessTaskSchemaNode {
        ...ProcessTaskSchemaGraphQL
      }
    }
  }
  ${(0,La.f)("ProcessFlowchartV2").fragment}
  ${(0,La.f)("ProcessTaskSchema").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${VM}
`
function FlowchartTaskOrSchemaInaccessibleError(){return d.createElement("div",{className:"u-padding u-text-align-center"},"You do not have sufficient permissions to update the flowchart.")}function ProcessUpdateFlowchartModal(e){const[t,n]=(0,d.useState)(null),[a,i]=(0,d.useState)([]),[s,r]=(0,d.useState)(null),[o,l]=(0,d.useState)(null),[c,u]=(0,d.useState)(null),p=null!=t&&0===a.length&&null!=s&&null!=o&&null!=c
return d.createElement(et.ZP,{title:"Update flowchart",buttons:[{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,onClick:()=>{m.gx(j.U9.CLOSED_MODAL,j.XC.WORKFLOWS,{event_group_id:e.eventGroupId,action_origin:e.actionOrigin,action_method:j.LY.POST_CREATION_FLOWCHART_MODIFICATION,task_schema_api_id:null==s?void 0:s.id,close_type:j.ot.CANCEL,error_types:a,modal_type:$M.t1})
e.onRequestClose()}},{text:"Submit",submit:!0,style:C.ZJ.PRIMARY,disabled:!p}],onRequestSubmit:async()=>{(0,S.hu)(null!=t&&null!=c&&null!=s&&null!=o,"Flowchart data must be defined")
const n=function getIsFlowchartModificationValidErrorMessage(e,t){const n=new Set(e.nodes.map((({clientId:e})=>e))),a=new Set((0,Jt.oA)(t.map((e=>{var t,n
return null!==(n=null===(t=getExecutionFlowchartData(e))||void 0===t?void 0:t.flowchartTasks.map((({nodeConfig:e})=>null==e?void 0:e.id)))&&void 0!==n?n:[]})).flat()))
if(!(0,Jt.KX)(a,n))return"Cannot remove nodes which have tasks."
const i=getAllEdgesUsedInFlowchartTasksLineage(t),s=new Set(e.edges.map((e=>getEdgeHash(e.fromNodeClientId,e.toNodeClientId))))
if(!(0,Jt.KX)(i,s))return"Cannot remove edges which are used in the task lineage."
return null}(t,o)
if(null!=n){v.ZP.error(n)
return}const a=(0,nF.Z)(t,c.schemaMapperConfigs.map((({clientId:e,fromTaskSchemas:t,toTaskSchema:n,mapperConfig:a})=>{(0,S.hu)(t.length>0&&null!=n&&null!=a,"Expected schema mapper to be defined")
return{clientId:e,fromTaskSchemaIds:t.map((({id:e})=>e)),toTaskSchemaId:n.id,mapperConfig:a}})),s)
await uA.Q3({id:e.flowchartProcessId,flowchartSpec:a,sourceType:e.sourceType,actionOrigin:e.actionOrigin,actionMethod:j.LY.POST_CREATION_FLOWCHART_MODIFICATION,eventGroupId:e.eventGroupId})
e.onFlowchartModified()
m.gx(j.U9.SUBMITTED_MODAL,j.XC.WORKFLOWS,{event_group_id:e.eventGroupId,action_origin:e.actionOrigin,action_method:j.LY.POST_CREATION_FLOWCHART_MODIFICATION,task_schema_api_id:s.id,modal_type:$M.t1})
e.onRequestSubmit()},onRequestClose:()=>{m.gx(j.U9.CLOSED_MODAL,j.XC.WORKFLOWS,{event_group_id:e.eventGroupId,action_origin:e.actionOrigin,action_method:j.LY.POST_CREATION_FLOWCHART_MODIFICATION,task_schema_api_id:null==s?void 0:s.id,close_type:j.ot.EXIT,error_types:a,modal_type:$M.t1})
e.onRequestClose()},closeableOnEscapeKey:!1,extraLarge:!0,fullHeight:!0,scrollable:!1},d.createElement(QueryingProcessUpdateFlowchartModalContents,{...e,onFlowchartChange:({flowchart:e,flowchartErrors:t,flowchartConfig:a,flowchartTaskSchema:s,flowchartTasks:o})=>{n(e)
i(t)
u(a)
r(s)
l(o)}}))}function QueryingProcessUpdateFlowchartModalContents(e){return d.createElement(Da.ZP,{query:sF,variables:{flowchartProcessId:e.flowchartProcessId},renderLoading:()=>d.createElement(kl.b,null)},(t=>{const n=function validateAndGetFlowchartInfo(e){if((0,ka.CZ)(e.process))return null
const t=e.process.tasks;(0,S.hu)(t.length>0,"Must have at least 1 task")
const n=e.process.taskSchemaOrInaccessible
if((0,ka.CZ)(n))return null
const a=t.map((e=>{var t
return null===(t=e.executionFlowchart)||void 0===t?void 0:t.id}));(0,S.hu)(a.every((e=>null!=e)),"Expected all tasks to have an execution flowchart");(0,S.hu)(a.every((e=>e===a[0])),"Expected all tasks to have same execution flowchart")
const i=e.process.flowchartConfigVersion;(0,S.hu)(null!=i,"Expect flowchart task group to have a flowchart config version")
if(!function isFlowchartConfigVersionFullyAccessible(e){return!e.availableSchemas.some((e=>(0,ka.CZ)(e)))&&!e.schemaMapperConfigs.some((e=>(0,ka.CZ)(e.toSchema)||e.schemaFieldMapperConfigs.some((({fromSchema:e})=>(0,ka.CZ)(e)))))}(i))return null
return{flowchartId:a[0],flowchartTasks:t,flowchartTaskSchema:n,flowchartConfigVersion:i}}(t)
return null==n?d.createElement(FlowchartTaskOrSchemaInaccessibleError,null):d.createElement(Da.ZP,{query:rF,variables:{flowchartId:n.flowchartId,flowchartTaskIds:n.flowchartTasks.map((({id:e})=>e)),nodeTaskSchemaIds:n.flowchartConfigVersion.availableSchemas.map((({id:e})=>e))},renderLoading:()=>d.createElement(kl.b,null)},(t=>{const a=function validateFlowchartStructureData(e){const{processFlowchart:t,processTasks:n,processTaskSchemas:a}=e
return(0,ka.CZ)(t)||!(0,ka.SZ)(n)?null:{processFlowchart:t,processTasks:n,processTaskSchemas:a}}(t)
return null==a?d.createElement(FlowchartTaskOrSchemaInaccessibleError,null):d.createElement(ProcessUpdateFlowchartModalContents,{flowchartBasicInfo:n,flowchartStructureData:a,onFlowchartChange:e.onFlowchartChange,eventGroupId:e.eventGroupId})}))}))}function ProcessUpdateFlowchartModalContents({flowchartStructureData:e,flowchartBasicInfo:t,onFlowchartChange:n,eventGroupId:a}){const{initialFlowchart:i,designSpace:s,flowchartConfig:r}=(0,d.useMemo)((()=>{const n=(0,tF.Q)(t.flowchartConfigVersion,e.processTaskSchemas,t.flowchartTaskSchema),a=(0,aF.Z)(e.processTaskSchemas,n.schemaMapperConfigs,t.flowchartTaskSchema)
return{initialFlowchart:mergeTaskLineageIntoFlowchart({flowchart:(0,iF.$)(e.processFlowchart),sourceTasks:e.processTasks}),designSpace:a,flowchartConfig:n}}),[e.processTaskSchemas,e.processFlowchart,e.processTasks,t.flowchartTaskSchema,t.flowchartConfigVersion])
return d.createElement(eF.ZP,{designSpace:s,flowchart:i,editorEventGroupId:a,actionMethod:j.LY.POST_CREATION_FLOWCHART_MODIFICATION,modalType:$M.t1,onFlowchartChange:(a,i)=>{n({flowchart:a,flowchartErrors:i,flowchartConfig:r,flowchartTaskSchema:t.flowchartTaskSchema,flowchartTasks:(0,ka.nA)(e.processTasks)})}})}var oF=n(468442),lF=n(351687)
const OpenWorkflowIcon=({type:e})=>{const t=e===YM.qc.MIDDLE_NODE?cF.openWorkflowIconRectangleNode:e===YM.qc.START_NODE||e===YM.qc.END_NODE?cF.openWorkflowIconOvalNode:void 0
return d.createElement(pe.Z,{icon:"open",altText:"Open task group",className:(0,g.iv)(cF.openWorkflowIcon,t),dataTestAttrs:{component:"ProcessFlowchartTaskNodeRenderer",element:"openWorkflowIcon"}})}
function ProcessFlowchartTaskNodeRenderer({data:e,type:t,nodeStyles:n}){var a
const i=null!=e.processId,s=t;(0,S.Gp)(s in YM.qc,"Unknown flowchart node type",{type:t,data:e})
const r=(0,Jt.oA)([i?cF.linked:null,...null!=n?n:[]]),o=(0,g.iv)(dF.base,dF.hidden,dF.hiddenSource),l=(0,g.iv)(dF.base,dF.hidden,dF.hiddenTarget)
return d.createElement(lF.Z,{data:e,nodeStyles:r,onClick:t=>{var n,a
if(i){m.L9(j.Zm.CLICKED_FLOWCHART_GRAPH_NODE,{task_group_api_id:e.processId,flowchart_task_group_api_id:null!==(a=null===(n=e.analyticsData)||void 0===n?void 0:n.rootProcessId)&&void 0!==a?a:null})
t.stopPropagation()
t.preventDefault();(0,ac.ZP)((0,uA.Uv)(e.processId))}},showTooltip:!0,isStatic:!0},i&&d.createElement(OpenWorkflowIcon,{type:t}),d.createElement(oF.Z,{statusCounts:null!==(a=e.statusCounts)&&void 0!==a?a:[]}),function hasTargetHandle(e,t){return[YM.qc.END_NODE,YM.qc.MIDDLE_NODE].includes(e)}(s)&&d.createElement(GM.HH,{type:"target",position:GM.Ly.Top,className:l}),function hasSourceHandle(e,t){return[YM.qc.START_NODE,YM.qc.MIDDLE_NODE].includes(e)}(s)&&d.createElement(GM.HH,{type:"source",position:GM.Ly.Bottom,className:o}))}const cF=g.mM.create({linked:{":hover":{cursor:"pointer",background:"rgba(255,255,255,.8)",border:"1px solid rgba(92,124,131,.8)",boxShadow:`0 0 8px ${Vt.pF}`}},openWorkflowIcon:{color:Vt.TG,width:"10px",height:"10px",position:"absolute"},openWorkflowIconRectangleNode:{right:"6px",top:"6px"},openWorkflowIconOvalNode:{right:"14px",top:"10px"},movableNode:{cursor:"move"}}),dF=g.mM.create({base:{width:"7px",height:"7px",background:Vt.pp,borderColor:"rgba(0,0,0,0)"},editableSource:{top:"calc(100% - 4px)"},editableTarget:{top:-4},hidden:{opacity:0,cursor:"default"},hiddenSource:{top:"calc(100% - 6px)"},hiddenTarget:{top:-1}}),uF={[YM.qc.START_NODE]:ProcessFlowchartTaskNodeRenderer,[YM.qc.MIDDLE_NODE]:ProcessFlowchartTaskNodeRenderer,[YM.qc.END_NODE]:ProcessFlowchartTaskNodeRenderer,[YM.qc.DISCONNECTED_NODE]:ProcessFlowchartTaskNodeRenderer}
var mF=n(415033),pF=n(890273),hF=n(638014)
function convertStaticNodeForReactFlow(e){const t=(0,mF.ft)(e,e.layout.position)
return(0,tm.ZP)(t,(t=>{const{data:n,...a}=t
t.data.layout={...a,width:e.instanceData.width,height:e.instanceData.height}}))}function attachLayoutToNodes(e){return e.map((e=>{var t
return{...e,layout:{...null!==(t=e.layout)&&void 0!==t?t:{position:{x:0,y:0}}}}}))}function convertStaticProcessFlowchartForReactFlow(e){const t=[],n=[]
!function validateFlowchartIntegrity(e){(0,S.hu)(e.nodes.length>=2,"Flowchart found with fewer than 2 nodes");(0,S.hu)(e.edges.length>=1,"Flowchart found with no edges")
for(const t of e.nodes){const n=e.edges.find((({fromNodeClientId:e,toNodeClientId:n})=>t.clientId===e||t.clientId===n));(0,S.hu)(null!=n,`Disconnected node found in flowchart: ${t.clientId}`)}for(const t of e.edges)(0,S.hu)(null!=(0,mF.DY)(e.nodes,t.fromNodeClientId)&&null!=(0,mF.DY)(e.nodes,t.toNodeClientId),`Edge found with unknown node id: (${t.fromNodeClientId} -> ${t.toNodeClientId})`)}(e)
const a=function getEdgeLabelDictionary(e){var t,n
const a=(0,Jt.Pe)(e.nodes,(({clientId:e})=>e)),i={}
for(const s of e.edges){const e=(0,pF.Cf)(s.fromNodeClientId,s.toNodeClientId)
i[s.clientId]=(null===(n=null===(t=a[s.fromNodeClientId])||void 0===t?void 0:t.outboundEdgeIdToLabel)||void 0===n?void 0:n[e])||null}return i}(e),i=e.nodes.find((e=>e.type===Sn.Og.ROOT_NODE_DETAILS));(0,S.hu)(null!=i,"Root node must exist")
const s=(0,hF.Z)({...e,nodes:attachLayoutToNodes(e.nodes)},a,{defaultNodeHeight:YM.hj.DEFAULT,defaultNodeWidth:YM.$L.DEFAULT,flowchartEditorPadding:YM.F6})
let r=1/0,o=0
for(const n of s.nodes){const a=n.layout.position
t.push({...convertStaticNodeForReactFlow(n),type:(0,pF.$k)(n,e.edges)})
o=Math.max(o,a.y)
r=Math.min(r,a.y)}for(const e of s.edges){const t=(0,pF.Cf)(e.fromNodeClientId,e.toNodeClientId)
n.push({id:t,data:e,type:YM.mm.STATIC_VIEWER,source:e.fromNodeClientId,target:e.toNodeClientId,markerEnd:(0,YM.a8)(),style:{strokeWidth:"1.5px"},label:a[e.clientId],...YM.h$})}return{nodes:t,edges:n,centersBoundingBox:{top:r,bottom:o}}}var gF=n(541247)
const EF={nodesConnectable:!1,nodesDraggable:!1,nodesFocusable:!1,edgesFocusable:!1,connectOnClick:!1,selectNodesOnDrag:!1,selectionKeyCode:null,zoomOnScroll:!1,panOnScroll:!0,panOnScrollMode:GM.IY.Vertical,zoomOnDoubleClick:!1,panOnDrag:!0}
function EmptyProcessStaticFlowchartViewer(){return d.createElement(WM.Z,{className:"u-padding",width:YM.$L.WIDE},d.createElement(GM.x$,{...EF,proOptions:HM.l,nodes:[],edges:[],nodeTypes:uF}))}function ProcessStaticFlowchartControls(e){const{zoomIn:t,zoomOut:n,fitView:a}=(0,GM._K)()
return d.createElement(zM.Z,{className:(0,g.iv)(fF.controls),style:{left:-e.reactFlowControlsXPosition},showZoom:!1,showFitView:!1,showInteractive:!1,fitViewOptions:YM.DB},d.createElement(P.ZP,{title:"Zoom in"},d.createElement(zM.B,{onClick:()=>{t()}},d.createElement(pe.Z,{icon:"plus"}))),d.createElement(P.ZP,{title:"Zoom out"},d.createElement(zM.B,{onClick:()=>{n()}},d.createElement(pe.Z,{icon:"minus"}))),d.createElement(P.ZP,{title:"Fit to view"},d.createElement(zM.B,{onClick:()=>{a(YM.DB)}},d.createElement(pe.Z,{icon:"square-corners"}))))}function InnerProcessStaticFlowchartViewer(e){const[t,n]=(0,d.useState)(!1)
!function useAutoFitViewOnFlowchartChange(e){const t=(0,Pu.Z)(e),{fitView:n}=(0,GM._K)();(0,d.useEffect)((()=>{if(null!=t&&!Is()(e,t)){const e=setTimeout((()=>{n(YM.DB)}))
return()=>{clearTimeout(e)}}return()=>{}}),[e])}(e.renderData)
const a=(0,d.useCallback)((()=>{n(!0)}),[]),i=(0,d.useCallback)((()=>{n(!1)}),[]),s=(0,d.useCallback)((()=>{n(!0)}),[]),r=(0,d.useCallback)((()=>{n(!1)}),[])
return null==e.reactFlowContainerWidth?d.createElement(EmptyProcessStaticFlowchartViewer,null):d.createElement(jM.Z.Provider,{value:{hideTooltips:t,flowchartClientId:e.flowchartClientId}},d.createElement(WM.Z,{width:e.reactFlowContainerWidth,containerWidthForControls:e.reactFlowContainerWidth},(t=>d.createElement("div",{className:(0,g.iv)(fF.flowchartWrapper)},d.createElement(GM.x$,{nodes:e.renderData.nodes,edges:e.renderData.edges,fitView:!0,minZoom:YM.lg,maxZoom:YM.Fq,fitViewOptions:YM.DB,nodeTypes:uF,edgeTypes:XM,className:(0,g.iv)(fF.flowchart),proOptions:HM.l,onMoveStart:a,onMoveEnd:i,onSelectionDragStart:s,onSelectionDragStop:r,...EF},e.title&&d.createElement("div",{className:(0,g.iv)(fF.heading)},e.title),null!=t&&d.createElement(ProcessStaticFlowchartControls,{reactFlowControlsXPosition:t}),e.allowFlowchartModifications&&d.createElement(P.pf,{tooltipTitle:e.editDisabledMessage},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_WHITE,size:C.qE.MINI,icon:"edit",text:"Edit",className:(0,g.iv)(fF.editButton,null==e.editDisabledMessage&&fF.editButtonActive),disabled:null!=e.editDisabledMessage,onClick:async()=>{const t=(0,m.Vr)(),n=function getActionOrigin(e){if("workspace_tab"===e)return j.D2.WORKFLOWS_TASK_GROUP_FLOWCHART_PANE
return j.D2.UI_UNDETERMINED}(e.sourceType);(0,m.gx)(j.U9.OPENED_MODAL,j.XC.WORKFLOWS,{event_group_id:t,action_origin:n,action_method:j.LY.POST_CREATION_FLOWCHART_MODIFICATION,task_schema_api_id:e.rootProcessTaskSchemaId,modal_type:$M.t1})
await(0,Xn.Z)(ProcessUpdateFlowchartModal,{flowchartProcessId:e.flowchartProcessId,sourceType:e.sourceType,onFlowchartModified:e.onFlowchartModified,eventGroupId:t,actionOrigin:n})},dataTestAttrs:{component:"ProcessStaticFlowchartViewer",element:"openProcessUpdateFlowchartModal"}})))))))}function ProcessStaticFlowchartViewer(e){var t
const{ref:n,width:a}=gF.y(),i=(0,d.useMemo)((()=>convertStaticProcessFlowchartForReactFlow(e.flowchart)),[e.flowchart]),s=e.allowFlowchartModifications?{allowFlowchartModifications:!0,flowchartProcessId:e.flowchartProcessId,rootProcessTaskSchemaId:e.rootProcessTaskSchemaId,sourceType:e.sourceType,onFlowchartModified:e.onFlowchartModified,editDisabledMessage:e.editDisabledMessage}:{allowFlowchartModifications:!1}
return d.createElement("div",{ref:n,className:(0,g.iv)(fF.flowchartWrapper)},d.createElement(GM.tV,null,d.createElement(InnerProcessStaticFlowchartViewer,{renderData:i,reactFlowContainerWidth:a,title:null===(t=e.flowchart.metadata)||void 0===t?void 0:t.title,flowchartClientId:e.flowchart.clientId,...s})))}const fF=g.mM.create({heading:{textAlign:"center",fontSize:"14px",padding:"20px 0 8px 0",position:"absolute",top:0,left:0,width:"100%",zIndex:5,color:Vt.pp,background:Vt.bs},flowchartWrapper:{width:"100%",height:"100%"},flowchart:{overflow:"visible"},controls:{position:"absolute",bottom:"64px"},editButton:{alignItems:"center",position:"absolute",right:"4px",top:"4px",zIndex:5},editButtonActive:{":hover":{color:Vt.t0}}})
function buildStaticFlowchartStructureFromGql({flowchartStructure:e,schema:t,nodeAnalytics:n,metadata:a}){const i=gt.Z()
if(null==e)return{clientId:i,nodes:[],edges:[]}
const s=(0,iF.H)(e),{nodes:r,edges:o}=s
r.forEach((e=>{e.analyticsData={...null!=e.analyticsData?e.analyticsData:{},...null!=n?n:{}}}))
return{clientId:i,nodes:r,edges:o,metadata:a}}const SF=xa.Ps`
  query ProcessFlowchartProcessQuery($processId: StrictString!) @skipAudit @engComponent(name: WORKFLOWS) {
    process(id: $processId) {
      ... on ProcessNode {
        id
        flowchartRootProcess {
          ... on ProcessNode {
            id
            name
            tasks {
              id
              executionFlowchart {
                id
              }
            }
            flowchartConfigVersion {
              id
              isFlowchartModifiableAfterCreation
            }
            processTaskSchema {
              id
              name
              outputSchema {
                id
              }
              statusLifecycle {
                ... on ProcessTaskStatusLifecycleNode {
                  ...ProcessTaskStatusLifecycle
                }
              }
            }
          }
          ...InaccessibleInfoGraphQL
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${FM.e}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function getEditDisabledMessage(e,t,n){return e.nodeConfigs.some((e=>(0,MM.XY)(e.nodeDetails)))?"You cannot edit a flowchart with a router":t.some((e=>(0,ka.CZ)(e)))?"You do not have sufficient permissions to update the flowchart":t.some((e=>(0,SM.CV)(e.status.id,n)))?"You cannot edit a flowchart with tasks in a terminal status":null}const yF=function TaskGroupFlowchartQueryingViewer(e){return d.createElement(Da.ZP,{query:SF,variables:{processId:e.processId},renderLoading:()=>d.createElement(kl.b,null),renderCachedDataWhenRefetching:!0},((t,n)=>{if((0,ka.CZ)(t.process)||null==t.process.flowchartRootProcess||(0,ka.CZ)(t.process.flowchartRootProcess))return null
{const a=t.process.flowchartRootProcess,i=[...new Set((0,Jt.oA)(t.process.flowchartRootProcess.tasks.map((e=>{var t
return null===(t=e.executionFlowchart)||void 0===t?void 0:t.id}))))],s=t.process.flowchartRootProcess.tasks.filter((e=>!(0,ka.CZ)(e))).map((e=>e.id))
return d.createElement(LiveUpdatingFlowchartWrapper,{parentId:a.id,refetch:n.refetch,flowchartIds:i,processTaskIds:s},((t,i,s)=>{var r
if(0===t.length)return null
const o=mergeTaskLineageIntoFlowchart({flowchart:buildStaticFlowchartStructureFromGql({flowchartStructure:t[0],schema:a.processTaskSchema,nodeAnalytics:{rootProcessId:a.id},metadata:{title:a.name}}),sourceTasks:i.processTasks,processBeingViewed:e.processId,shouldLinkProcess:!0}),l=(null===(r=a.flowchartConfigVersion)||void 0===r?void 0:r.isFlowchartModifiableAfterCreation)?{allowFlowchartModifications:!0,flowchartProcessId:a.id,rootProcessTaskSchemaId:a.processTaskSchema.id,sourceType:"workspace_tab",editDisabledMessage:getEditDisabledMessage(t[0],i.processTasks,a.processTaskSchema.statusLifecycle),onFlowchartModified:()=>{n.refetch()
s()}}:{}
return d.createElement(ProcessStaticFlowchartViewer,{flowchart:o,...l})}))}}))}
class ProcessFlowchartTabView extends Js{render(){const e={processId:this.model.get("processId")};(0,Me.A9)(d.createElement("div",{className:f()((0,g.iv)(bF.tabBackground),"react-tab-container")},d.createElement(yF,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ProcessFlowchartTabView.prototype.className="buffer-tab buffer-tab--no-padding"
const bF=g.mM.create({tabBackground:{background:Vt.bs,paddingTop:0,paddingBottom:0,maxHeight:"100%",overflow:"hidden"}})
var TF=n(377894),vF=n(910426),CF=n(241362)
function updateProcessTaskDetailsOutputsQueryCache({taskId:e,updatedStatusAndOutputs:t,archivedOutputs:n,unarchivedOutputs:a,purpose:i}){const s=(0,Ml.readQuerySafe)({query:vF.H5},{variables:{taskId:e}})
if(null==s)return
if((0,ka.CZ)(s.processTask)){(0,S.Gp)(!1,`Cannot update inaccessible response, id: ${s.processTask.invalidId}`)
return}const r=function getTaskWithModifiedOutputArchivePurpose({task:e,archivedOutputs:t,unarchivedOutputs:n,purpose:a}){if(!(0,S.Gp)([...t,...n].every((e=>ea.ZP.isProcessOutput(e))),"IDs passed in to change output archive status are not valid output IDs.",{archivedOutputs:t,unarchivedOutputs:n}))return null
const i=new Set(t),s=new Set(n)
i.size>0&&(0,S.Gp)(null!=a,"Expected to pass in purpose to archive outputs.")
if(!(0,S.Gp)(!t.some((e=>s.has(e))),"Archive output changes must be completely disjoint."))return null
e.outputs=e.outputs.map((e=>i.has(e.id)&&null!=a?(0,$u.Lv)(e,a):s.has(e.id)&&(0,yc.ZP)(e)?{...e,archiveRecord:null}:e))
return e}({task:{...s.processTask,...t},archivedOutputs:null!=n?n:[],unarchivedOutputs:null!=a?a:[],purpose:i})
if(null!=r){(0,DP.W)().writeQuery({query:vF.H5,data:{processTask:r},variables:{taskId:e}})
null!=t.outputs&&(0,CF.mv)(t.outputs)}}function updateProcessTaskDetailsQueryCache(e){const t=(0,Ml.readQuerySafe)({query:vF.A4},{variables:{processTaskId:e.id}})
if(null==t)return
if((0,ka.CZ)(t.processTask)){(0,S.Gp)(!1,`Cannot update inaccessible response, id: ${t.processTask.invalidId}`)
return}const n={...t.processTask,...e};(0,DP.W)().writeQuery({query:vF.A4,data:{processTask:n},variables:{processTaskId:e.id}})}async function updateProcessTaskAndCache(e){try{const t=await async function updateProcessTask({id:e,assigneeId:t,statusId:n,fields:a,scheduledOnDate:i,responsiblePartiesIds:s}){const r={id:e,sourceType:"task_details",...a?{fields:a}:{},...void 0!==t?{assigneeId:t}:{},...null!=n?{statusId:n}:{},...void 0!==i?{scheduledOnDate:i}:{},...void 0!==s?{responsiblePartiesIds:s}:{}},o=await(0,Ic.jI)((0,uA.ML)([r]))
v.ZP.success("Task updated successfully.")
return o.tasks[0]}(e)
updateProcessTaskDetailsQueryCache((0,he.Z)(t,...function getValuesToUpdateInCache(e){return Object.values((0,he.Z)({id:["id"],assigneeId:["assignee"],fields:["fields"],statusId:["status","executionOrigin"],scheduledOnDate:["scheduledOnDate"],responsiblePartiesIds:["responsibleParties"],studyIds:[]},...Object.keys(e))).flat()}(e)))
return t}catch(e){(0,Cn.d0)(e)&&v.ZP.notifyError(e)
return null}}function shouldLockTable(e){var t
const n=(null===(t=(0,SM.WX)(e.status.id,e.schema.statusLifecycle))||void 0===t?void 0:t.statusType)===Sn.HS.PENDING,a=!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})||!(0,EM.k)(e.schema),i=0===e.outputs.length&&(0,SM.CV)(e.status.id,e.schema.statusLifecycle)
return n||a||i}function shouldDisallowAddRows(e){return(0,SM.CV)(e.status.id,e.schema.statusLifecycle)||!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})||!(0,EM.k)(e.schema)}function buildOutputTable(e,t){return(0,AM.BG)({taskId:e.id,outputs:e.outputs,processTaskSchema:{...e.schema,outputSchema:e.schema.outputSchema},selectorsById:t,metadata:{tableLocation:aM.$o.TASK_DETAILS_OUTPUTS_TAB,disallowAddRows:shouldDisallowAddRows(e)},locked:shouldLockTable(e)})}async function ProcessTaskDetailsOutputs_submitOutputTableHandler({processTask:e,outputTable:t,computedOutputTable:n,setOutputTable:a}){var i,s
const r=`task_details_outputs_tab_${(0,hM.z)(t)}_direct`;(0,S.hu)((null!==(s=null===(i=t.columns)||void 0===i?void 0:i.length)&&void 0!==s?s:0)>1,"Output table must exist and have columns")
if(!(0,S.Gp)(!(0,gM.Z)(n),"Output table has errors"))return
const o=function ProcessTaskDetailsOutputs_outputTableToOutputs(e,t,n,a,i){const s=(0,bM.ZH)({table:e,evaluatedTable:t,creationOriginIds:Array(t.length).fill(a),taskIds:Array(t.length).fill(i),sourceType:n});(0,S.Gp)(s.length>0,"Expected outputs to submit to be greater than 0.")
return s}(t,n,r,e.process.id,e.id)
await(0,vM.Z)({outputs:o,onRequestSubmit:async({processOutputs:n,processTasks:i})=>{const{newOutputTable:s,serverOutputs:o}=await submitOutputs({processOutputs:n,processTasks:null==i?void 0:i.map((e=>({...e,sourceType:r}))),outputTable:t})
a(s)
const l=null!=i&&i.length>0?(0,SM.WX)(i[0].statusId,e.schema.statusLifecycle):null
updateProcessTaskDetailsOutputsQueryCache({taskId:e.id,updatedStatusAndOutputs:{...null!=l?{status:(0,he.Z)(l,"__typename","id")}:{},outputs:o}})
updateProcessTaskDetailsQueryCache({id:e.id,...null!=l?{status:l}:{}})}})}function ProcessTaskOutputs(e){const{processTask:t,selectors:n}=e,a=(0,d.useMemo)((()=>(0,bb.OU)(n)),[n]),i=t.schema.executionType===Sn.Pf.DIRECT,[s,r]=(0,d.useState)(buildOutputTable(t,a)),[o,l]=(0,d.useState)(),[c,u]=(0,d.useState)(!1);(0,d.useEffect)((()=>{r(buildOutputTable(t,a))}),[t])
return d.createElement(ToggleEditStructuredTableOutsideNotebook,{isEditable:i,structuredTable:s,disableMaximizedTables:!1,outsideNotebookContext:{taskIds:[t.id]},update:(e,n)=>{r(e)
if(n){const e=t.outputs.map(((e,t)=>(0,$u.Lv)(e,n[t])))
updateProcessTaskDetailsOutputsQueryCache({taskId:t.id,updatedStatusAndOutputs:{outputs:e}})}m.L9(j.Zm.CLICKED_OUTPUT_TABLE_EDIT)},submit:async()=>{await ProcessTaskDetailsOutputs_submitOutputTableHandler({processTask:t,outputTable:s,computedOutputTable:o,setOutputTable:r})},revert:e=>{r(e)},updateComputedTable:l,isMaximized:c,setIsMaximized:()=>{u(!c)
c?m.L9(j.Zm.CLICKED_TABLE_COLLAPSE):m.L9(j.Zm.CLICKED_TABLE_EXPAND)}})}function QueryingProcessTaskOutputs(e){return d.createElement(Da.ZP,{query:bb.Xk,variables:{includeArchived:!0},renderLoading:()=>d.createElement(kl.b,null)},(t=>d.createElement(Da.ZP,{query:vF.H5,variables:{taskId:e.processTaskId},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0,renderLoading:()=>d.createElement(kl.b,null)},((e,n)=>{const{processTask:a}=e
return(0,ka.CZ)(a)?d.createElement(Ll.Z,{inaccessibleInfo:a,modelType:st.PROCESS_TASK}):d.createElement(Zk.Z,{apiIdToSubscribe:a.id,refetch:n.refetch},d.createElement(ProcessTaskOutputs,{processTask:a,selectors:(0,zo.NA)("SchemaFieldSelector",t.schemaFieldSelectors),refetch:n.refetch}))}))))}class ProcessTaskDetailsOutputsTabView extends Js{render(){const e={processTaskId:this.model.get("processTaskId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(QueryingProcessTaskOutputs,{processTaskId:e.processTaskId})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ProcessTaskDetailsOutputsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var IF=n(535047),wF=n(457438)
function TaskStatusEditor(e){const[t,n]=(0,d.useState)(!1),a=e.disabled||(0,SM.CV)(e.status.id,e.statusLifecycle)
return d.createElement(d.Fragment,null,d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},(0,SM.GP)((0,SM.Nu)(e.status,e.statusLifecycle)).map((t=>d.createElement(N.Z,{contentClassName:(0,g.iv)(NF.option),key:t.displayName,value:t,onSelect:e.onSelect},d.createElement(wF.Z,{statusType:t.statusType,displayName:t.displayName,showTerminalStatusTooltip:!1}))))),isOpen:t,onToggle:()=>{a||n(!t)}},d.createElement("div",{className:f()("editableField",(0,g.iv)(!a&&NF.dropdownButton,t&&NF.dropdownButtonOpen)),...(0,ee.Z)({component:"TaskStatusEditor",element:"dropdownButton"})},d.createElement("span",{className:f()("u-lr-split",(0,g.iv)(NF.buttonWrapper))},d.createElement("span",{className:(0,g.iv)(NF.statusWrapper)},d.createElement(wF.Z,{statusType:e.status.statusType,displayName:e.status.displayName,showTerminalStatusTooltip:!1}),d.createElement(P.ZP,{title:`Status last updated on ${e.lastUpdated}`,placement:P.TQ.TOP},d.createElement(pe.Z,{className:f()("infoIcon",(0,g.iv)(NF.infoIcon,t&&NF.infoIconOpen)),icon:"info-circle",...(0,ee.Z)({component:"TaskStatusEditor",element:"infoIcon"})}))),!a&&d.createElement(pe.Z,{className:f()("dropdownIcon",(0,g.iv)(NF.dropdownIcon,t&&NF.dropdownIconOpen)),icon:"chevron-down",...(0,ee.Z)({component:"TaskStatusEditor",element:"dropdownIcon"})})))))}const NF=g.mM.create({dropdownButton:{cursor:"pointer",":hover .dropdownIcon":{visibility:"visible"}},dropdownButtonOpen:{backgroundColor:Vt.bs},dropdownIcon:{visibility:"hidden",marginRight:"8px"},dropdownIconOpen:{visibility:"visible"},infoIcon:{color:Vt.pp,marginLeft:"4px",visibility:"visible"},infoIconOpen:{visibility:"hidden"},option:{paddingLeft:"8px"},buttonWrapper:{width:"100%"},statusWrapper:{display:"inline-flex",alignItems:"center"}})
var AF=n(396669),RF=n(856749),PF=n(688319)
function FormattedTextField({text:e}){return d.createElement("span",{className:(0,g.iv)(OF.rowHeight)},e)}function PlaceholderFieldValue(){return d.createElement(FormattedTextField,{text:"N/A"})}function ScheduledOnField(e){var t,n
return(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:e.processTask})?d.createElement(PF.Z,{onChange:async t=>{(0,Hr.qb)({textValue:t})?await e.onUpdateTask({id:e.processTask.id,scheduledOnDate:(0,Hr._y)(t)}):v.ZP.error("Date entered is invalid. Date must have format of (YYYY-MM-DD). Please try again.")},value:null!==(t=e.processTask.scheduledOnDate)&&void 0!==t?t:"",isDisabled:!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:e.processTask}),placeholder:null}):d.createElement("span",{className:"editableField"},null!==(n=e.processTask.scheduledOnDate)&&void 0!==n?n:"None")}function ProcessTaskDetailsSection(e){return d.createElement("div",{className:(0,g.iv)(OF.sectionWrapper)},d.createElement("div",{className:"metadata-section"},d.createElement(so.zV,{className:(0,g.iv)(OF.sectionHeader)},e.title),e.content.map((({label:e,component:t},n)=>d.createElement(h.Z,{key:n,className:(0,g.iv)(OF.rowWrapper)},d.createElement(p.Z,{className:(0,g.iv)(OF.detailsColumnWrapper),sm:3},d.createElement(Je.Z,{className:(0,g.iv)(OF.rowHeight)},e)),d.createElement(p.Z,{sm:4},t))))))}function ProcessTaskDetailsMetadata(e){const{processTask:t}=e,n=[{label:"Creators",component:d.createElement(AF.X,{avatarInfo:t.creator,size:SC.D.XXSMALL,shape:SC.o.CIRCLE,showTooltip:!0})},{label:"Created on",component:d.createElement(FormattedTextField,{text:Hr.UT(t.createdAt)})},{label:"Creation origin",component:d.createElement(d.Fragment,null,null!=t.creationOrigin.originType?d.createElement(FormattedTextField,{text:aM.xh[t.creationOrigin.originType]}):d.createElement(PlaceholderFieldValue,null))},{label:"Last modified on",component:d.createElement("span",{className:(0,g.iv)(OF.rowHeight)},Hr.UT(t.modifiedAt))},{label:"Sources",component:d.createElement(d.Fragment,null,t.lineageEdgesTo.length>0?t.lineageEdgesTo.map((({fromVertex:e},t)=>d.createElement(sc.Z,{className:(0,g.iv)(OF.chipHeight),key:t,id:e.id,size:Za.TK.TABLE_CELL}))):d.createElement(PlaceholderFieldValue,null))},{label:"Flowchart task",component:d.createElement(d.Fragment,null,null!=t.rootTask?d.createElement(RF.Z,{className:(0,g.iv)(OF.chipHeight),id:t.rootTask.id,size:Za.TK.TABLE_CELL}):t.schema.executionType===Sn.Pf.FLOWCHART?d.createElement(FormattedTextField,{text:"(This is the flowchart task)"}):d.createElement(PlaceholderFieldValue,null))},{label:"Task group",component:d.createElement(uc.Z,{className:(0,g.iv)(OF.rowHeight),href:de.jp(t.process.editUrl)},t.process.name)}],a=dt.ZP.STUDIES_ENABLE?[...n,{label:"Studies",component:d.createElement(KN,{studyable:e.processTask,isWritable:e.processTask.permissions.writable})}]:n
return d.createElement(ProcessTaskDetailsSection,{title:"Metadata",content:a})}function ProcessTaskDetailsSummary(e){const{processTask:t}=e,n=l.default.compact([{label:"Status",component:d.createElement(TaskStatusEditor,{status:t.status,statusLifecycle:t.schema.statusLifecycle,lastUpdated:Hr.UT(e.processTask.lastStatusChange.createdAt),onSelect:async n=>{await(0,CM.Z)({taskSchemaId:t.schema.id,tasks:[{id:t.id,statusId:n.id,oldStatusId:t.status.id,sourceType:"task_details"}],onRequestSubmit:async()=>{await e.onUpdateTask({id:t.id,statusId:n.id})}})},disabled:!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:t})})},{label:"Assigned to",component:d.createElement(dA.Z,{value:t.assignee,onChange:async n=>{var a
await e.onUpdateTask({id:t.id,assigneeId:null!==(a=null==n?void 0:n.id)&&void 0!==a?a:null})},useAvatars:!0,isDisabled:t.schema.executionType===Sn.Pf.FLOWCHART||!(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:t}),chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowEmails:!1,allowTeams:!1,allowOrganizations:!1,shouldAllowMultiple:!1,placeholder:"Search for user",userSearchType:tA.t.NotSuspended,isFullWidth:!1,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0})},{label:"Scheduled on",component:d.createElement(d.Fragment,null,t.schema.executionType!==Sn.Pf.FLOWCHART?d.createElement(ScheduledOnField,{...e}):d.createElement(PlaceholderFieldValue,null))},dt.ZP.WORKFLOWS_ENABLE_COLLABORATORS?{label:"Responsible parties",component:d.createElement(dA.Z,{value:t.responsibleParties,onChange:async n=>{await e.onUpdateTask({id:t.id,responsiblePartiesIds:n.map((({id:e})=>e))})},isDisabled:!1,chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowEmails:!1,allowTeams:!0,allowOrganizations:!1,shouldAllowMultiple:!0,userSearchType:tA.t.NotSuspended,isFullWidth:!0,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0,useAvatars:!0,maxAvatars:2})}:{label:"Responsible team",component:null!=t.process.responsibleTeam?d.createElement(AF.X,{avatarInfo:t.process.responsibleTeam,size:SC.D.XXSMALL,shape:SC.o.CIRCLE,showTooltip:!1}):d.createElement(PlaceholderFieldValue,null)},{label:"Executed by",component:d.createElement(d.Fragment,null,null!=t.executor?d.createElement(AF.X,{avatarInfo:t.executor,size:SC.D.XXSMALL,shape:SC.o.CIRCLE,showTooltip:!1}):d.createElement(PlaceholderFieldValue,null))},{label:"Executed in",component:d.createElement(d.Fragment,null,null!=(null===(a=t.executionOrigin)||void 0===a?void 0:a.executionEntry)?d.createElement(Lb.Z,{className:(0,g.iv)(OF.chipHeight),id:t.executionOrigin.executionEntry.id,size:Za.TK.TABLE_CELL}):(null===(i=t.executionOrigin)||void 0===i?void 0:i.executionType)===Sn.Rp.MODAL?d.createElement(FormattedTextField,{text:"Direct execution pop-up window"}):d.createElement(PlaceholderFieldValue,null))},{label:"Executed on",component:d.createElement(d.Fragment,null,null!=t.executionOrigin?d.createElement(FormattedTextField,{text:Hr.UT(t.executionOrigin.createdAt)}):d.createElement(PlaceholderFieldValue,null))},{label:"Schema",component:d.createElement("span",{className:(0,g.iv)(OF.rowHeight)},t.schema.name)}])
var a,i
return d.createElement(ProcessTaskDetailsSection,{title:"Summary",content:n})}const OF=g.mM.create({detailsColumnWrapper:{paddingLeft:"0px"},rowWrapper:{marginTop:"0px",marginBottom:"0px",paddingLeft:"0px"},sectionWrapper:{paddingLeft:"10px",flex:1,minWidth:"500px"},sectionHeader:{fontWeight:600,fontSize:16},rowHeight:{lineHeight:"24px"},chipHeight:{lineHeight:"20px"}})
var xF=n(120164)
const _F={getOptionDisabledAndTooltip(e,t){const n=!(0,ln.cr)(e)||null!=t&&!t
return{isDisabled:n,tooltipTitle:n?"You don't have permissions to perform this action.":void 0}}}
function ProcessTaskActionToolbar(e){const t=e.processTask,n=function ProcessTaskActionToolbar_getExecuteTooltipMessage(e){return(0,yc.ZP)(e)?"Unarchive this task to execute it.":e.status.statusType!==Sn.HS.PENDING?"Only pending or planned tasks can be executed.":null==e.schema.entryTemplate&&null==e.schema.outputSchema?"You cannot execute a direct execution task without an output schema configuration.":null}(t),a=(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:t})&&t.schema.executionType!==Sn.Pf.FLOWCHART,i=[{isVisible:!0,item:{contents:d.createElement("span",null,"Copy Task"),..._F.getOptionDisabledAndTooltip({feature:on.gx.PROCESSES_CREATE},(0,EM.v)(Sn.Nk.CAN_COPY_TASKS,e.processTask.schema.executionType)),onSelect:async()=>{const e=await xF.GV([t.id])
if(null!=e){(0,S.Gp)(1===e.length,"Expected to only copy one task.")
Rn.Z.openFile(e[0].id)}}}},{isVisible:!(0,yc.ZP)(t),item:{..._F.getOptionDisabledAndTooltip({feature:on.gx.PROCESSES_ARCHIVE,item:t}),contents:d.createElement("span",null,"Archive Task"),onSelect:()=>{!function archiveProcessTask(e,t,n){Sc.bA({items:[e],onArchive:async(a,i)=>{const s=await IR.WL(st.PROCESS_TASK,a,i)
if(s){const a=s.archivedItemIds.filter((e=>ea.ZP.isProcessOutput(e)))
n({taskId:e.id,updatedStatusAndOutputs:{},archivedOutputs:a,purpose:i})
await t()}}})}(t,e.onTaskUpdated,e.updateOutputsCache)}}},{isVisible:(0,yc.ZP)(t),item:{..._F.getOptionDisabledAndTooltip({feature:on.gx.PROCESSES_UNARCHIVE,item:t}),contents:d.createElement("span",null,"Unarchive Task"),onSelect:async()=>{await async function unarchiveProcessTask(e,t,n){await(0,Ic.jI)((async()=>{const a=await IR.YK(st.PROCESS_TASK,[e.id])
if(a){const i=a.unarchivedItemIds.filter((e=>ea.ZP.isProcessOutput(e)))
n({taskId:e.id,updatedStatusAndOutputs:{},unarchivedOutputs:i})
await t()}})(),"Unarchiving task...")}(t,e.onTaskUpdated,e.updateOutputsCache)}}},{isVisible:!0,item:{..._F.getOptionDisabledAndTooltip({feature:on.gx.PROCESSES_EXPORT}),contents:d.createElement("span",null,Tc.QU),onSelect:()=>{bc.dV([t.id])},dataTestAttrs:{component:"ProcessTaskActionToolbar",element:"exportAuditLog"}}}].filter((({isVisible:e})=>e)).map((({item:e})=>e))
return d.createElement("div",{className:(0,g.iv)(DF.toolbarWrapper)},i.length>0&&d.createElement(Cc.Z,{buttonProps:{size:C.qE.SMALL,className:(0,g.iv)(DF.overflowButton)},menuProps:{dropLeft:!0},options:i}),a&&d.createElement("div",{className:f()("buttonGroup")},d.createElement(OM.Z,{actionOrigin:Sn.D2.WORKFLOWS_TASK_DETAILS_PAGE,getTasksToExecute:()=>Promise.resolve([t]),disabledMessage:n,onTasksOrOutputsChange:(n,a)=>{if(!(0,S.Gp)(1===n.length,"Expected to have only updated one task"))return
const i=n[0]
if((0,S.Gp)(i.id===t.id,`Updated task does not match. Expected task id: ${t.id}. Received task id: ${i.id}`)){e.updateCache({id:t.id,status:i.status,executionOrigin:i.executionOrigin})
e.updateOutputsCache({taskId:t.id,updatedStatusAndOutputs:{outputs:null!=a?a:[],status:i.status}})}}})))}const DF=g.mM.create({toolbarWrapper:{display:"flex",gap:"8px"},overflowButton:{height:"28px",width:"28px"}})
function QueryingProcessTaskDetails(e){const t=(0,Da.IJ)(vF.A4,{variables:{processTaskId:e.processTaskId},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load task; try reloading the page.")
return null}const{processTask:n}=t.data
return(0,ka.CZ)(n)?d.createElement(Ll.Z,{inaccessibleInfo:n,modelType:st.PROCESS_TASK}):d.createElement(Zk.Z,{apiIdToSubscribe:n.id,refetch:t.refetch},d.createElement(ProcessTaskDetails,{processTask:n,refetch:t.refetch}))}function ProcessTaskDetailsHeader(e){return d.createElement("div",{className:(0,g.iv)(LF.headingWrapper)},d.createElement("div",null,d.createElement(so.R6,null,e.processTask.name),d.createElement(lC.Z,{item:{id:e.processTask.id,name:e.processTask.name,archiveRecord:e.processTask.archiveRecord}})),d.createElement("div",{className:"u-small-padding-right"},d.createElement(ProcessTaskActionToolbar,{processTask:e.processTask,onTaskUpdated:e.refetch,updateCache:updateProcessTaskDetailsQueryCache,updateOutputsCache:updateProcessTaskDetailsOutputsQueryCache})))}function ProcessTaskDetails(e){const{processTask:t}=e,onUpdateTask=async e=>{const n=await updateProcessTaskAndCache(e)
null!=(null==n?void 0:n.status)&&updateProcessTaskDetailsOutputsQueryCache({taskId:t.id,updatedStatusAndOutputs:{status:(0,he.Z)(n.status,"__typename","id")}})
return n}
return d.createElement(d.Fragment,null,(0,yc.ZP)(e.processTask)&&d.createElement(Fv.Z,{banner:"Editing disabled on archived task."}),d.createElement("div",{className:"react-tab-container",...(0,ee.Z)({component:"ProcessTaskDetails",element:"root"})},d.createElement(ProcessTaskDetailsHeader,{processTask:e.processTask,refetch:e.refetch}),d.createElement("div",{className:(0,g.iv)(LF.detailsWrapper)},d.createElement(ProcessTaskDetailsSummary,{processTask:t,onUpdateTask}),d.createElement(ProcessTaskDetailsMetadata,{processTask:t,onUpdateTask})),d.createElement(EC,{title:"Schema Fields",emptyMessage:"This task has no fields.",fileId:e.processTask.id,initialTags:e.processTask.fields,areTagsEditable:(0,ln.cr)({feature:on.gx.PROCESSES_EDIT,item:t})&&(0,EM.k)(t.schema),showRequiredFieldErrors:!0,updateTags:n=>new Promise((a=>{(0,CM.Z)({taskSchemaId:t.schema.id,tasks:[{id:t.id,fields:n.toSet,sourceType:"task_details",oldStatusId:t.status.id}],onRequestSubmit:async()=>{const i=await updateProcessTaskAndCache({id:t.id,fields:n.toSet})
a(i&&[{id:e.processTask.id,tags:i.fields}])}}).then((()=>{a(null)}))}))})))}const LF=g.mM.create({headingWrapper:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:20},detailsWrapper:{display:"flex",flexFlow:"row wrap",marginLeft:"-10px"}})
class ProcessTaskDetailsTabView extends Js{render(){const e={processTaskId:this.model.get("processTaskId")};(0,Me.A9)(d.createElement(QueryingProcessTaskDetails,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ProcessTaskDetailsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var kF=n(196582)
const MF=xa.Ps`
  query ProcessTaskFlowchartRootTaskQuery($rootTaskId: StrictString!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    processTask(id: $rootTaskId) {
      ... on ProcessTaskNode {
        id
        name
        schema {
          id
          name
          outputSchema {
            id
          }
        }
        executionFlowchart {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
const FF=function ProcessTaskFlowchartQueryingViewer(e){return d.createElement(Da.ZP,{query:MF,variables:{rootTaskId:e.rootTaskId},renderLoading:()=>d.createElement(kl.b,null)},((t,n)=>{const a=t.processTask
if((0,ka.CZ)(a))return d.createElement(Ll.Z,{inaccessibleInfo:a,modelType:st.PROCESS_TASK})
const i=a.executionFlowchart
if(null==i){(0,S.Gp)(!1,"Expected execution flowchart in root task to not be null or undefined",{rootTask:a})
return null}return d.createElement(LiveUpdatingFlowchartWrapper,{parentId:a.id,refetch:n.refetch,flowchartIds:[i.id],processTaskIds:[e.rootTaskId]},((t,n,i)=>{var s,r
if(0===t.length)return null
const o=n.processTasks.find((t=>!(0,ka.CZ)(t)&&t.id===e.rootTaskId)),l=null===(r=null===(s=null==o?void 0:o.executionFlowchartData)||void 0===s?void 0:s.flowchartTasks)||void 0===r?void 0:r.find((t=>t.task.id===e.taskId))
if(null==l)return null
const c=mergeTaskLineageIntoFlowchart({flowchart:buildStaticFlowchartStructureFromGql({flowchartStructure:t[0],schema:a.schema,metadata:{title:a.name}}),sourceTasks:n.processTasks,processBeingViewed:l.task.process.id,shouldLinkProcess:!1})
return d.createElement(ProcessStaticFlowchartViewer,{flowchart:c})}))}))}
class ProcessTaskFlowchartTabView extends Js{render(){const e={rootTaskId:this.model.get("rootTaskId"),executionFlowchartId:this.model.get("executionFlowchartId"),taskId:this.model.get("taskId")};(0,Me.A9)(d.createElement("div",{className:f()((0,g.iv)(ZF.tabBackground),"react-tab-container")},d.createElement(FF,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ProcessTaskFlowchartTabView.prototype.className="buffer-tab buffer-tab--no-padding"
const ZF=g.mM.create({tabBackground:{background:Vt.bs,paddingTop:0,paddingBottom:0,maxHeight:"100%",overflow:"hidden"}})
var BF=n(326957),qF=n(836291),VF=n(840391),UF=n(456148),GF=n(726830),zF=n(627742),$F=n(849607)
class CreateAndRegisterBioentityInputs extends d.Component{constructor(){super(...arguments)
this._handleChangeTagSchema=e=>{(0,S.hu)(null!=e,"TagSchemaSelector returned null for the tagSchema")
this._handleChange({tagSchema:e})}
this._handleChangeLabelingStrategy=e=>{this._handleChange({labelingStrategy:e})}
this._handleChangeCreateBioentityInputArgs=e=>{this._handleChange(zF.D0(e))}}_handleChange(e){this.props.onChange(e)}render(){const{createAndRegisterBioentityArgs:{labelingStrategy:e,tagSchema:t},isOligoSchema:n}=this.props,a=Boolean(e&&tw.LABELING_STRATEGIES_REQUIRING_NAME.includes(e))
return d.createElement("div",{className:(0,g.iv)(HF.wrapper)},this.props.showSchemaSelector&&d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Schema",labelStyle:this.props.labelStyle,isRequired:!0}),d.createElement(Ho.ZP,{onChange:this._handleChangeTagSchema,selectedTagSchemaId:t?t.id:null,isTagSchemaDisabledFn:this.props.isTagSchemaDisabledFn,disabledMessage:this.props.tagSchemaDisabledMessage,requiredPermissions:["objectsCreatable","objectsRegisterable"]})),d.createElement(Ke.Z,null,d.createElement($F.ZP,{labelingStrategy:e,labelStyle:this.props.labelStyle,onChange:this._handleChangeLabelingStrategy,tagSchemaId:t?t.id:null})),d.createElement(GF.Z,{createBioentityArgs:zF.xD(this.props.createAndRegisterBioentityArgs),onChange:this._handleChangeCreateBioentityInputArgs,labelStyle:Mo.gF.LABEL,isOligoSchema:Boolean(n),shouldShowNameField:a}))}}CreateAndRegisterBioentityInputs.propTypes={createAndRegisterBioentityArgs:zF.H.isRequired,labelStyle:K.oneOf(Object.values(Mo.gF)).isRequired,onChange:K.func.isRequired,showSchemaSelector:K.bool.isRequired,isTagSchemaDisabledFn:K.func,tagSchemaDisabledMessage:K.string}
CreateAndRegisterBioentityInputs.defaultProps={showSchemaSelector:!0}
const WF=CreateAndRegisterBioentityInputs,HF=g.mM.create({wrapper:{flex:1,display:"flex",flexDirection:"column"}})
var jF=n(252658)
class CreateAndRegisterBioentityModal extends d.Component{constructor(){super(...arguments)
this.state={createAndRegisterBioentityArgs:this.props.createAndRegisterBioentityArgs,errorMessage:null}
this._updateCreateAndRegisterBioentityArgs=e=>{this.setState((t=>({...t,createAndRegisterBioentityArgs:{...t.createAndRegisterBioentityArgs,...e}})))}
this._createAndRegisterBioentity=async()=>{try{const e=await zF.jD(this.state.createAndRegisterBioentityArgs)
if(null==e)return
Rn.Z.openFile(e.id)
m.KK(j.Dv.CREATED_FILES_IN_REGISTRY_MODAL,{product:j.XC.REGISTRY,entity_id:e.id,entity_type:e.tagSchema.folderItemType,schema_id:e.tagSchema.id})
this.props.onRequestClose()}catch(e){if(!Cn.d0(e)||!v.ZP.getFriendlyError(e))throw e
this.setState({errorMessage:v.ZP.getFriendlyError(e)})}}}render(){const e=this.state.errorMessage?{bannerProps:{bannerType:io.ct.ERROR,text:this.state.errorMessage}}:{},{tagSchema:t}=this.props.createAndRegisterBioentityArgs,n=t.folderItemType===st.MOLECULE,a=d.createElement(WF,{createAndRegisterBioentityArgs:this.state.createAndRegisterBioentityArgs,onChange:this._updateCreateAndRegisterBioentityArgs,labelStyle:Mo.gF.LABEL,showSchemaSelector:!1,isOligoSchema:(0,aw.MR)(t)||(0,aw.Gx)(t)}),i={title:`Create ${t?t.name:""}`,onRequestClose:this.props.onRequestClose,onRequestSubmit:this._createAndRegisterBioentity,scrollable:!0,buttons:[{text:"Register",submit:!0,disabled:!zF.ew(this.state.createAndRegisterBioentityArgs)}],children:a}
return n?d.createElement(jF._,{...i,...e,startMaximized:!0}):d.createElement(et.ZP,{...i,...e})}}const YF=CreateAndRegisterBioentityModal
function PlusButton(e){return d.createElement(P.pf,{tooltipTitle:e.tooltipTitle},d.createElement("a",{onClick:e.onClick},d.createElement(pe.Z,{icon:"compose",className:f()(e.className,"u-mini-spacing-left"),dataTestAttrs:e.dataTestAttrs})))}function DisabledPlusButton(e){return d.createElement(PlusButton,{className:(0,g.iv)(KF.disabled),tooltipTitle:e.tooltipTitle,dataTestAttrs:{component:"PlusButton",element:"compose",key:"disabled"}})}function PresentationalCreateChildEntityButton(e){if(e.parentEntityData.isArchived)return d.createElement(DisabledPlusButton,{tooltipTitle:"Cannot create when entity is archived"})
return d.createElement(PlusButton,{onClick:function runCreateModal(){const t=[{...(0,pC.bt)(e.childEntityLinkField),name:e.childEntityLinkField.name,targetFiles:[{id:e.parentEntityData.id,name:e.parentEntityData.name,url:e.parentEntityData.editUrl}],targetFileTagSchemaId:e.parentEntityData.tagSchemaId}]
e.parentEntityData.isRegistered?(0,Xn.Z)(YF,{createAndRegisterBioentityArgs:{...zF.pk(),tags:t,tagSchema:e.childEntitySchema}}):UF.Z.open(UF.Z,{createBioentityArgs:{...zF.gy(),tagSchema:e.childEntitySchema,folderId:e.parentEntityData.folderId,tags:t}})},tooltipTitle:"Create entity",dataTestAttrs:{component:"PlusButton",element:"compose",key:"createEntity"}})}const QF=xa.Ps`
  query CreateChildEntityButtonQuery($parentEntityId: StrictString!, $childSchemaId: StrictString!)
  @skipAudit
  @engComponent(name: REGISTRY) {
    parentEntity: bioentity(id: $parentEntityId) {
      ... on RegistryItemInterface {
        id
        archiveRecord {
          purpose
        }
        editUrl
        folder {
          id
          source: sourceJson
        }
        name
        tagSchema {
          id
          childEntityLinkConfig(childSchemaId: $childSchemaId) {
            id
            childSchemaLinkField: childSchemaLinkFieldJson
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function CreateChildEntityButton(e){return d.createElement(Da.ZP,{query:QF,renderLoading:()=>d.createElement(DisabledPlusButton,{tooltipTitle:"Loading..."}),variables:{parentEntityId:e.parentEntityId,childSchemaId:e.childEntitySchema.id}},(({parentEntity:t})=>{if((0,ka.CZ)(t)){(0,S.Gp)(!1,"Parent entity should never be inaccessible")
return null}(0,S.hu)(null!=t.tagSchema&&null!=t.tagSchema.childEntityLinkConfig,"Expected parent entity to have schema and child entity link config")
return d.createElement(PresentationalCreateChildEntityButton,{parentEntityData:{id:t.id,editUrl:t.editUrl,isArchived:Boolean(t.archiveRecord),isRegistered:(n=t.folder.source,n.sourceType===DN.REGISTRY_TYPE),name:t.name,tagSchemaId:t.tagSchema.id,folderId:t.folder.id},childEntitySchema:e.childEntitySchema,childEntityLinkField:t.tagSchema.childEntityLinkConfig.childSchemaLinkField})
var n}))}const KF=g.mM.create({disabled:jf.JU})
var JF=n(94222)
function ChildEntityTable(e){const t=e.childEntities.map((e=>(0,JF.B8)(e.tags.filter((e=>(0,VR.Yx)(e))))))
return d.createElement("div",{...(0,ee.Z)({component:"ChildEntityTable",element:"root"})},d.createElement(rc.iA,{emptyTableText:"No entities",numRows:e.childEntities.length,pagination:{offset:e.offset,limit:100,total:e.total},setOffset:e.setOffset},d.createElement(rc.sg,{header:d.createElement(rc.bL,null,"Entity",d.createElement(CreateChildEntityButton,{parentEntityId:e.parentEntityId,childEntitySchema:e.childEntitySchema})),renderCell:t=>d.createElement(rc.bL,null,d.createElement(sc.Z,{id:e.childEntities[t].id,size:Za.TK.SMALL}))}),d.createElement(rc.sg,{header:"Created",renderCell:t=>d.createElement(rc.bL,null,(0,Hr.UT)(e.childEntities[t].createdAt,{showTime:!1}))}),d.createElement(rc.sg,{header:"Authors",renderCell:t=>d.createElement(rc.bL,null,d.createElement(wv.Z,{parties:e.childEntities[t].authors,useAvatar:!0}))}),e.childEntitySchema.fields.map((e=>d.createElement(rc.sg,{header:e.name,key:e.id,renderCell:n=>d.createElement(rc.bL,null,d.createElement(VF.Z,{tag:t[n][e.id]}))})))))}const XF=xa.Ps`
  query GetChildEntitiesQuery(
    $parentEntityId: StrictString!
    $childSchemaId: StrictString!
    $offset: StrictInt!
    $archivePurposes: [StrictString!]
    $queryString: StrictString!
  ) @skipAudit @engComponent(name: REGISTRY) {
    parentEntity: bioentity(id: $parentEntityId) {
      ... on RegistryItemInterface {
        id
        matchingChildEntities(
          childEntitySchemaId: $childSchemaId
          offset: $offset
          archivePurposes: $archivePurposes
          queryString: $queryString
        ) {
          total
          items {
            id
            archiveRecord {
              purpose
            }
            authors: authorsJson
            createdAt
            name
            tags: tagsJson
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
    childEntitySchema: tagSchema(id: $childSchemaId) {
      ...TagSchemaGraphQL
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("TagSchema").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ChildEntityTab(e){const[t,n]=(0,d.useState)([zu.BH]),[a,i]=(0,d.useState)(""),[s,r]=(0,d.useState)(0),o=a.length>0&&a.length<Kn.xv?Kn.SN:""
return d.createElement("div",{...(0,ee.Z)({component:"ChildEntityTab",element:"root"})},d.createElement("div",{className:"u-lr-split u-small-spacing-bottom"},d.createElement(qF.Z,{itemIds:[],onChangePurposes:e=>{n(e)
r(0)},selectedPurposes:t}),d.createElement(P.ZP,{title:o,trigger:"manual",open:""!==o},d.createElement(nc.ZP,{clearType:nc.Nl.X,placeholder:"Search",onChange:e=>{i(e.target.value)
r(0)},onEscape:()=>{i("")
r(0)},value:a}))),d.createElement(Da.ZP,{fetchPolicy:"no-cache",query:XF,renderLoading:()=>d.createElement(kl.b,null),variables:{parentEntityId:e.parentEntityId,childSchemaId:e.childSchemaId,archivePurposes:t,offset:s,queryString:a}},(t=>{if((0,ka.CZ)(t.parentEntity)||(0,ka.CZ)(t.childEntitySchema)){(0,S.hu)(!1,"Parent entity or child entity schema should never be inaccessible")
return null}return d.createElement(ChildEntityTable,{childEntities:t.parentEntity.matchingChildEntities.items,childEntitySchema:(0,zo.tY)("TagSchema",t.childEntitySchema),parentEntityId:e.parentEntityId,offset:s,setOffset:r,total:t.parentEntity.matchingChildEntities.total})})))}class ChildEntityTabView extends s().View{initialize(){this.listenTo(this.model.get("model"),"change:archiveRecord change:folder",(()=>{u.unmountComponentAtNode(this.el)
this.rerender()}))}rerender(){const e=this.model.get("model"),t=this.model.get("childSchemaId");(0,Me.A9)(d.createElement(ChildEntityTab,{childSchemaId:t,parentEntityId:e.id}),this.el)}render(){this.rerender()
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ChildEntityTabView.prototype.className="buffer-tab"
function RelevantItemsView(e){return d.createElement("div",{className:"react-tab-container"},d.createElement(QueryingRelevantItemsSection,{fileId:e.fileId}))}class RelevantItemsTabView extends Js{render(){const e=this.model.get("model")
Me.A9(d.createElement(RelevantItemsView,{fileId:e.id}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}RelevantItemsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var eZ=n(695609),tZ=n(954419),nZ=n(733714),aZ=n(448009),iZ=n(429549),sZ=n(735606),rZ=n(505273),oZ=n(49002),lZ=n(80549)
function getSampleGroupIdsByRequestTaskId(e){return l.default.object(e.map((e=>[e.id,e.sampleGroups.map((e=>e.id))])))}var cZ=n(944969)
function prepareSampleGroupsGraphQLForTable(e){return e.map((({id:e,tagsJson:t,samples:n})=>{const a=l.default.indexBy(n,(e=>e.id))
return{id:e,cid:e,tags:t.map((e=>({...e,targetSamples:e.targetSamples.map((e=>{var t,n
const i=a[e.id],{name:s,url:r}=function getDisplayInfoGraphQL(e){var t
return e.bioentity?{name:e.bioentity.name,url:e.bioentity.editUrl}:e.batch?{name:e.batch.name,url:e.batch.url}:{name:null!==(t=e.name)&&void 0!==t?t:"",url:e.url}}(i),o=i.batch?(0,zo.tY)("BatchSummary",i.batch):null,l=null===(t=i.container)||void 0===t?void 0:t.id,c=null===(n=i.bioentity)||void 0===n?void 0:n.id
return(0,cZ.Z)({batch:o,containerId:l,fileId:c},i.id,s,r)}))})))}}))}const dZ={mapDispatchToProps:e=>({onOpenCreateModal:t=>{m.KK(j.ir.OPENED_COPY_REQUEST_MODAL)
e((0,lZ.Z)(t))}})}
function CopyRequestButton(e){const t=(0,_a.I0)(),{onOpenCreateModal:n}=dZ.mapDispatchToProps(t)
return d.createElement(P.ZP,{title:(0,yc.ZP)(e.request.schema)?"Cannot copy this request because its schema is archived":"Create another"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:"u-mini-spacing-left",disabled:(0,yc.ZP)(e.request.schema),icon:"copy",onClick:()=>{n({inCopyMode:!0,schema:(0,zo.tY)("RequestSchema",e.request.schema),template:null,initialRequestor:Jn.Z.currentUser(),initialAssignees:(0,aR.Z)(e.request.assigneesJson),initialProjectId:e.request.project.id,initialTags:(0,aR.Z)(e.request.tagsJson),initialRequestTasks:(a=(0,aR.Z)((0,zo.NA)("RequestTask",e.request.tasks)),a.map((e=>({cid:e.id,schemaId:e.schemaId,tags:e.tags})))),initialSampleGroups:(t=prepareSampleGroupsGraphQLForTable((0,aR.Z)(e.request.sampleGroups)),t.filter((({id:e})=>null!=e)).map((({id:e,tags:t})=>({cid:e,tags:t})))),initialSampleGroupCidsByRequestTaskCid:getSampleGroupIdsByRequestTaskId(e.request.tasks)})
var t,a},size:C.qE.SMALL}))}var uZ=n(627378),mZ=n(743175),pZ=n(472552)
const hZ={isEditing:!1,isSaving:!1,draftSampleGroups:null,draftSampleGroupIdsByRequestTaskId:null}
var gZ
!function(e){e.RESET_STATE="RESET_STATE"
e.SET_IS_EDITING="SET_IS_EDITING"
e.SET_IS_SAVING="SET_IS_SAVING"
e.SET_DRAFT_SAMPLE_GROUPS="SET_DRAFT_SAMPLE_GROUPS"
e.SET_DRAFT_SAMPLE_GROUP_IDS_BY_REQUEST_TASK_ID="SET_DRAFT_SAMPLE_GROUP_IDS_BY_REQUEST_TASK_ID"
e.MERGE_SAMPLE_GROUP_PROPS="MERGE_SAMPLE_GROUP_PROPS"}(gZ||(gZ={}))
function reducer(e,t){switch(t.type){case gZ.RESET_STATE:return hZ
case gZ.SET_IS_EDITING:{const n=prepareSampleGroupsGraphQLForTable(t.payload.sampleGroups),a=prepareSampleGroupIdsByRequestTaskId(getSampleGroupIdsByRequestTaskId(t.payload.tasks),t.payload.tasks)
getSampleGroupIdsByRequestTaskId(t.payload.tasks)
return{...e,isEditing:!0,draftSampleGroups:n,draftSampleGroupIdsByRequestTaskId:a}}case gZ.SET_IS_SAVING:return{...e,isSaving:!0}
case gZ.SET_DRAFT_SAMPLE_GROUPS:{const{draftSampleGroups:n}=t.payload
return e.isEditing?{...e,draftSampleGroups:n}:e}case gZ.SET_DRAFT_SAMPLE_GROUP_IDS_BY_REQUEST_TASK_ID:{const{draftSampleGroupIdsByRequestTaskId:n}=t.payload
return e.isEditing?{...e,draftSampleGroupIdsByRequestTaskId:n}:e}case gZ.MERGE_SAMPLE_GROUP_PROPS:if(e.isEditing){const n=getSampleGroupIdsByRequestTaskId(t.payload.tasks),a=Object.keys(n).reduce(((t,a)=>{var i
t[a]=null!==(i=e.draftSampleGroupIdsByRequestTaskId[a])&&void 0!==i?i:n[a]
return t}),{})
return{...e,draftSampleGroupIdsByRequestTaskId:a}}return e
default:return e}}function prepareSampleGroupIdsByRequestTaskId(e,t){return t.reduce(((t,n)=>null==e[n.id]?{...t,[n.id]:[]}:t),e)}function DraftableRequestSampleTable(e){const[t,n]=(0,d.useReducer)(reducer,hZ);(0,d.useEffect)((()=>{n({type:gZ.MERGE_SAMPLE_GROUP_PROPS,payload:{tasks:e.request.tasks}})}),[e.request.sampleGroups,e.request.tasks])
const a=t.isEditing?prepareSampleGroupIdsByRequestTaskId(t.draftSampleGroupIdsByRequestTaskId,e.request.tasks):getSampleGroupIdsByRequestTaskId(e.request.tasks),i=t.isEditing?t.draftSampleGroups:prepareSampleGroupsGraphQLForTable(e.request.sampleGroups)
null!=t.draftSampleGroups&&(0,S.Gp)(t.draftSampleGroups.every((e=>null!=e.cid)),"Expected sample groups to have cids")
const resetState=()=>{n({type:gZ.RESET_STATE})},s=function getFulfillmentStatusBySampleGroupId(e){const t={}
e.forEach((e=>{var n
if(null!=e.sampleGroup&&null!=e.task){const a=null!==(n=t[e.sampleGroup.id])&&void 0!==n?n:{}
a[e.task.id]=e.status
t[e.sampleGroup.id]=a}}))
return t}(e.request.fulfillments)
return d.createElement(pZ.Z,{requestId:e.request.id,canToggleEditMode:!0,isWritable:e.isWritable,isEditing:t.isEditing,isSaving:t.isSaving,requestTaskSchemasById:e.requestTaskSchemasById,requestTasks:e.request.tasks,sampleGroupIdsByRequestTaskId:a,sampleGroupSchema:e.request.schema.sampleGroupSchema,sampleGroups:i,fulfillableStatuses:s,onCancelEdit:()=>{resetState()},onEdit:()=>{n({type:gZ.SET_IS_EDITING,payload:{sampleGroups:e.request.sampleGroups,tasks:e.request.tasks}})},onSave:async()=>{try{n({type:gZ.SET_IS_SAVING})
const t=(0,mZ.Z)(i)
await e.onSaveSampleGroups({sampleGroupIdsByRequestTaskId:a,sampleGroupsForServer:t})
v.ZP.success("Updated sample groups successfully.")}finally{resetState()}},onUpdateSampleGroups:e=>{n({type:gZ.SET_DRAFT_SAMPLE_GROUPS,payload:{draftSampleGroups:e}})},onUpdateSampleGroupIdsByRequestTaskId:e=>{n({type:gZ.SET_DRAFT_SAMPLE_GROUP_IDS_BY_REQUEST_TASK_ID,payload:{draftSampleGroupIdsByRequestTaskId:e}})}})}var EZ=n(253955),fZ=n(172459),SZ=n(590441),yZ=n(46538)
class CreateRequestTaskModal extends d.Component{constructor(){super(...arguments)
this.state={isSaving:!1,requestTask:this.props.initialRequestTask}
this._handleSubmit=async()=>{if(pC.$2(this.state.requestTask.tags)){this.setState({isSaving:!0})
try{await this.props.createRequestTask(this.props.requestId,{...this.state.requestTask,tags:pC.UR(this.state.requestTask.tags)})
this.props.onRequestSubmit()}catch(e){this.setState({isSaving:!1})
throw e}}}
this._handleUpdateTags=e=>{this.setState({requestTask:{...this.state.requestTask,tags:e}})}}render(){return d.createElement(et.ZP,{title:"Create task",onRequestClose:this.props.onRequestClose,buttons:[{key:"create",disabled:this.state.isSaving,onClick:this._handleSubmit,style:C.ZJ.PRIMARY,submit:!0,text:this.state.isSaving?"Creating...":"Create"}]},d.createElement(fZ.Z,{itemLinkAllowed:!0,isCreating:!0,isWritable:!0,onUpdateTags:this._handleUpdateTags,tags:this.state.requestTask.tags}))}}CreateRequestTaskModal.propTypes={createRequestTask:J().func.isRequired,initialRequestTask:SZ.Qc.isRequired,requestId:J().string.isRequired,onRequestClose:J().func.isRequired,onRequestSubmit:J().func.isRequired}
const bZ=(0,_a.$j)(null,(function CreateRequestTaskModal_mapDispatchToProps(e){return{createRequestTask(t,n){e((0,yZ.J)(t,n))}}}))(CreateRequestTaskModal)
var TZ=n(483203),vZ=n(292618),CZ=n(13922)
const IZ={showFormulas:!1}
class RequestDetails extends d.Component{constructor(){super(...arguments)
this._handleUpdateAssignees=e=>{this.props.updateRequest(this.props.request.id,{assignees:(0,aZ.Z)(e)})}
this._handleUpdateScheduledOnDate=e=>{(0,Hr.qb)({textValue:e})?this.props.updateRequest(this.props.request.id,{scheduledOn:e}):v.ZP.error("Invalid date.")}
this._handleUpdateProject=e=>{this.props.updateRequest(this.props.request.id,{projectId:e})}
this._handleSaveSampleGroups=async e=>{await this.props.updateRequestSampleGroups({requestId:this.props.request.id,sampleGroupIdsByRequestTaskId:(0,vZ.Z)({requestTasks:(0,zo.NA)("RequestTask",this.props.request.tasks),sampleGroupIdsByRequestTaskId:e.sampleGroupIdsByRequestTaskId,sampleGroupsForServer:e.sampleGroupsForServer}),sampleGroups:e.sampleGroupsForServer})}
this._handleUpdateTags=e=>{const t=pC.UR(e)
this.props.updateRequest(this.props.request.id,{tags:t})}
this._handleOpenAddRequestTaskModal=async e=>{await(0,Xn.Z)(bZ,{initialRequestTask:(0,TZ.En)(e),requestId:this.props.request.id})}
this._handleOpenExecuteRequestFlow=()=>{Xe.bA(HI.ZP,d.createElement(HI.ZP,{requests:[(0,zo.tY)("Request",this.props.request)],initialFilters:[],requestSchemasByRequestId:{[this.props.request.id]:(0,zo.tY)("RequestSchema",this.props.request.schema)},onRequestClose:()=>{Xe.xv(HI.ZP)}}))}}_handleDeleteRequestTask(e){je.iG("Delete task","Are you sure you want to delete the task? This action is not reversible.","danger").done((()=>{this.props.deleteRequestTask(e)}))}_renderScheduledOn(){return d.createElement("div",null,d.createElement(so.Dx,null,"Scheduled on"),d.createElement(PF.Z,{onChange:this._handleUpdateScheduledOnDate,value:this.props.request.scheduledOn,isDisabled:!this._isWritable(),placeholder:null}))}_isWritable(){return this.props.request.permissions.writable}_canExecuteRequest(){return Boolean(this.props.request.permissions.canExecuteRequest)}_renderAssignedTo(){return d.createElement("div",null,d.createElement(so.Dx,null,"Assigned to"),this._isWritable()?d.createElement(nZ.Z,{assignees:this.props.request.assigneesJson,onUpdateAssignees:this._handleUpdateAssignees,organizationId:this.props.request.schema.organizationJson.id,shouldChangeBeConfirmed:!0}):d.createElement(iZ.Z,{assignees:this.props.request.assigneesJson}))}_renderExecuteButton({buttonStyle:e,className:t}){if(!this._isWritable)return null
let n=!1,a=null
if(this._canExecuteRequest()){if(this.props.request.schema.sampleGroupSchema&&0===this.props.request.sampleGroups.length){n=!0
a="No samples specified"}}else{n=!0
a="Requires execute permission"}return d.createElement(sZ.Z,{buttonStyle:e,className:t,disabled:n,onClick:this._handleOpenExecuteRequestFlow,tooltipTitle:a})}_renderExportDropdown(){return d.createElement(P.pf,{tooltipTitle:Tc.QU,tooltipPlacement:P.TQ.TOP},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:()=>{const e=[this.props.request.id];(0,bc.dV)(e)},icon:"audit-trail",dataTestAttrs:{component:"RequestDetails",element:"exportAuditLog"},className:"u-mini-spacing-left"}))}_renderRequestButtons(){return d.createElement("div",{className:"u-flex-display"},d.createElement(uZ.Z,{buttonStyle:C.ZJ.TERTIARY_GRAY,isDisabled:!this._isWritable(),onUpdateRequestStatus:e=>{this.props.updateRequest(this.props.request.id,{requestStatus:e})},requestStatus:this.props.request.requestStatus}),d.createElement(CopyRequestButton,{request:this.props.request}),this._renderExecuteButton({buttonStyle:C.ZJ.SECONDARY,className:"u-mini-spacing-left"}),this._renderExportDropdown())}render(){const e=l.default.indexBy(this.props.request.schema.requestTaskSchemas,(e=>e.id)),t=(0,Jt.Xc)(e,(e=>(0,zo.tY)("RequestTaskSchema",e)))
return d.createElement("div",{className:"react-tab-container"},d.createElement("div",{className:"requestView"},d.createElement("div",null,d.createElement("div",{className:"u-lr-split"},d.createElement(so.R6,null,this.props.request.schema.name," ",this.props.request.name),this._renderRequestButtons())),d.createElement("div",{className:"u-spacing-top"},d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{xs:6},d.createElement(so.Dx,null,"Project"),d.createElement(Xl.N,{onProjectSelected:this._handleUpdateProject,sources:(0,zo.NA)("NavStoreSource",this.props.sources),selectedProjectId:this.props.request.project.id,readOnly:!this._isWritable(),enableRedesign:!0,areSourcesLoading:!1})),d.createElement(p.Z,{xs:6},d.createElement(so.Dx,null,dt.ZP.REQUESTS_ENABLE_REQUESTOR?"Requestor":"Creator"),d.createElement("div",null,d.createElement(fC.Z,{className:"u-mini-spacing-right",size:SC.D.XXSMALL,entity:dt.ZP.REQUESTS_ENABLE_REQUESTOR?this.props.request.requestorJson:this.props.request.creatorJson}),dt.ZP.REQUESTS_ENABLE_REQUESTOR?this.props.request.requestorJson.name:this.props.request.creatorJson.name))),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{xs:6},this._renderScheduledOn()),d.createElement(p.Z,{xs:6},this._renderAssignedTo())),d.createElement("div",{className:"u-spacing-top"},d.createElement(fZ.Z,{className:"bufferRowReset u-small-spacing-top",itemLinkAllowed:!0,isWritable:this._isWritable(),onUpdateTags:this._handleUpdateTags,tags:this.props.request.tagsJson})),this.props.request.schema.requestTaskSchemas.length>0&&d.createElement("div",{className:"u-spacing-top"},d.createElement(so.Dx,null,"Tasks",this._isWritable()&&d.createElement(EZ.Z,{requestTaskSchemasById:t,requestTaskSchemaIds:this.props.request.schema.requestTaskSchemas.map((({id:e})=>e)),onSelectSchema:this._handleOpenAddRequestTaskModal})),this.props.request.tasks.map((e=>d.createElement("div",{key:e.id,className:"u-tiny-spacing-top"},d.createElement(CZ.Z,{initiallyExpanded:!1,isCreating:!1,isWritable:this._isWritable(),requestTask:(0,zo.tY)("RequestTask",e),requestTaskSchema:t[e.schema.id],onRemove:()=>{this._handleDeleteRequestTask(e.id)},onUpdate:this.props.updateRequestTask}))))),this.props.request.schema.sampleGroupSchema&&d.createElement("div",{className:"u-spacing-top"},d.createElement(BA.q.Provider,{value:IZ},d.createElement(DraftableRequestSampleTable,{isWritable:this._isWritable(),request:this.props.request,requestTaskSchemasById:e,onSaveSampleGroups:this._handleSaveSampleGroups}))))))}}const wZ=xa.Ps`
  query RequestDetailsQuery($requestId: StrictString!) @engComponent(name: REQUESTS) {
    request(id: $requestId) @audit(msg: "Opened request {name}") {
      ... on RequestNode {
        name # For auditing
        ...RequestGraphQL
        schema {
          ...RequestSchemaGraphQL
          requestTaskSchemas {
            ...RequestTaskSchemaGraphQL
          }
        }
        fulfillments {
          ...RequestFulfillmentGraphQL
        }
        ...RequestTasks
        ...RequestSampleGroups
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("Request").fragment}
  ${(0,La.f)("RequestFulfillment").fragment}
  ${(0,La.f)("RequestSchema").fragment}
  ${(0,La.f)("RequestTask").fragment}
  ${(0,La.f)("RequestTaskSchema").fragment}
  ${rZ.Cg.fragment}
  ${rZ.eV.fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function QueryingRequestDetails(e){const t=(0,_a.I0)(),{deleteRequestTask:n,updateRequest:a,updateRequestSampleGroups:i,updateRequestTask:s}=function RequestDetails_mapDispatchToProps(e){return{deleteRequestTask:t=>{e(yZ.o9(t))},updateRequest:(t,n)=>{e(oZ.WN(t,n))},updateRequestSampleGroups:async t=>{await e(oZ.D7(t))},updateRequestTask:t=>{e(yZ.Z_(t))}}}(t),r=(0,Da.IJ)(tZ.P),o=(0,Da.IJ)(wZ,{variables:{requestId:e.requestId}})
if(r.type===Da.NI.PENDING||o.type===Da.NI.PENDING)return d.createElement(EN.d,null)
if(r.type===Da.NI.SUCCESS&&o.type===Da.NI.SUCCESS)return(0,ka.CZ)(o.data.request)?d.createElement(Ll.Z,{inaccessibleInfo:o.data.request,modelType:"request"}):d.createElement(RequestDetails,{request:o.data.request,sources:r.data.sources,deleteRequestTask:n,updateRequest:a,updateRequestSampleGroups:i,updateRequestTask:s})
v.ZP.error("An unexpected error occured when loading request details.")
return null}class RequestDetailsTabView extends Js{render(){const e={requestId:this.model.get("requestId")};(0,Me.A9)(d.createElement(QueryingRequestDetails,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}RequestDetailsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var NZ=n(186192),AZ=n(535540),RZ=n(455040),PZ=n(500147),OZ=n(780188)
const xZ=l.default.once((e=>{(0,S.Gp)(!1,e)}))
var _Z=n(328907)
const DZ=xa.Ps`
  fragment AssayRecordOrigin on AssayRecordOriginNode {
    id
    type
    elnOrigin {
      entry {
        id
        editURL
        name
        review {
          id
          status
        }
      }
      tableName
    }
    analysisOrigin {
      analysis {
        id
        name
        url
      }
    }
  }
`,LZ={fragment:DZ,fragmentName:"AssayRecordOrigin"},kZ=xa.Ps`
  query GetAssayRecordOriginLink($resultId: StrictString!) @skipAudit @engComponent(name: RESULTS) {
    result(id: $resultId) {
      ... on ResultNode {
        id
        origin {
          ...AssayRecordOrigin
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${DZ}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function missingEntryMessage(e){return e===_Z.s4.API?"(In Inbox)":"(Deleted)"}const MZ="Loading..."
function getAssayRecordOriginFromCache(e){return(0,Ml.readFragmentFromCache)(LZ,e)}function getOriginText(e){const t=getAssayRecordOriginFromCache(e)
return t?t.elnOrigin.entry?t.elnOrigin.entry.name:missingEntryMessage(t.type):MZ}const FZ=function AssayRecordOriginLink({resultId:e}){return d.createElement(Da.ZP,{query:kZ,variables:{resultId:e},renderLoading:()=>MZ},(e=>{var t
if((0,ka.CZ)(e.result)){xZ("Did not expect inaccessible item.")
return null}{const n=e.result.origin,{entry:a,tableName:i}=n.elnOrigin,s=null===(t=n.analysisOrigin)||void 0===t?void 0:t.analysis
return null!=a?d.createElement("div",null,d.createElement(uc.Z,{fileId:a.id,href:de.jp(a.editURL)},d.createElement(pe.Z,{icon:rr.m.Entry,className:"u-mini-spacing-right"}),a.name),i&&d.createElement("div",null,"(",i,")")):null!=s&&dt.ZP.ENABLE_ANALYSIS_TOOL?d.createElement("div",null,d.createElement(uc.Z,{fileId:s.id,href:de.jp(s.url)},d.createElement(pe.Z,{icon:"analysis",className:"u-mini-spacing-right"}),s.name)):d.createElement("div",null,missingEntryMessage(n.type))}}))}
var ZZ=n(109296)
function _getReviewStatusTextFromOrigin(e){const t=e.elnOrigin.entry
return t&&t.review&&t.review.status===KL.ZP.ACCEPTED?"Yes":"No"}function getReviewStatusText(e){const t=getAssayRecordOriginFromCache(e)
return t?_getReviewStatusTextFromOrigin(t):"Loading..."}const BZ=function ReviewStatusDisplay({resultId:e}){return d.createElement(Da.ZP,{query:kZ,variables:{resultId:e},renderLoading:()=>"Loading..."},(e=>{if((0,ka.CZ)(e.result)){xZ("Did not expect inaccessible item.")
return null}{const t=e.result.origin
return d.createElement("span",null,_getReviewStatusTextFromOrigin(t))}}))}
var qZ=n(181995),VZ=n(348099)
class FilteredAssayResultsConnector extends oi.C{constructor(){super(...arguments)
this.stores=[IN.Z]}renderLoading(){return d.createElement(kl.Z,null)}_getResultsTableSpecs(){const e=(0,qZ.bI)(this.reduxState().models.results,this.props.filters)
if(!e)return this.fallBackToLoading()
const t=this.assayStore().getAssaySchemas(OZ.aJ.ASSAY_RESULT)||[],{assayResultsById:n}=this.reduxState().models.results,a=function adaptResultsTableSpecsFromServer(e,t,n,a,i){const s=l.default.indexBy(n,"id"),r=[]
for(const n of e){const e=s[n.schemaId]
if(!e)continue
if(null!=e.archiveRecord&&!i)continue
const o=[]
for(const e of n.assayResultIds){const t=a[e]
if(!t)return null
o.push(t)}r.push({schema:e,total:n.total,assayResults:o,isOversized:n.isOversized,onDownloadAsCSV:()=>{(0,Zm.p1)(n.schemaId,t)}})}return r}(e,this.props.filters,t,n,this.props.includeResultsAgainstArchivedSchemas)
return a||this.fallBackToLoading()}enhanceProps(){return{resultsTableSpecs:this._getResultsTableSpecs()}}}var UZ=n(911593)
const GZ=J().shape({schema:OZ.Gd.isRequired,total:J().number.isRequired,assayResults:J().arrayOf(_Z.U.isRequired).isRequired,isOversized:J().bool.isRequired,onDownloadAsCSV:J().func})
class StandaloneResultsView extends d.Component{constructor(){super(...arguments)
this.state={tableCidPrefix:l.default.uniqueId("table")}}_getAdditionalColumns(){const e={metadataType:UZ.dD,label:"Source",width:200,render:e=>({formattedValue:d.createElement(ZZ.pc,null,d.createElement(FZ,{resultId:e.id})),text:getOriginText(e.id),align:"left"})}
return dt.ZP.RESULTS_FILTER_TO_REVIEWED_DATA_OUTSIDE_ENTRY?[e]:[{metadataType:UZ.dD,label:"Reviewed",width:UZ.tD,render:e=>({formattedValue:d.createElement(ZZ.pc,null,d.createElement(BZ,{resultId:e.id})),text:getReviewStatusText(e.id)})},e]}render(){const{emptyMessage:e,resultsTableSpecs:t,hideIfEmpty:n}=this.props,a=l.default.sortBy(t,(e=>e.schema.name))
return a.length?d.createElement("div",{className:f()("mediocre","react-tab-container--mediocre-tableWrapper","react-tab-container--mediocre-tableWrapper--noPaddingTop")},a.map((e=>d.createElement("div",{key:e.schema.id,className:"mediocre-item is-table"},d.createElement(Bm.Z,{onDownloadAsCSV:e.onDownloadAsCSV,schema:e.schema,results:e.assayResults,additionalColumns:this._getAdditionalColumns(),forceRowCount:e.isOversized?e.total:void 0,isOversized:e.isOversized,canRename:!1,...km.W9,cid:this.state.tableCidPrefix+e.schema.id,locked:!0,updateDisplayConfigHandler:()=>{}}))))):n?null:d.createElement("div",{className:"u-faded",...(0,ee.Z)({component:"StandaloneResultsView",key:"emptyMessage"})},e)}}StandaloneResultsView.propTypes={emptyMessage:J().string.isRequired,filters:J().shape({bioentityId:J().string,requestId:J().string,storableId:J().string,studyId:J().string}).isRequired,resultsTableSpecs:J().arrayOf(GZ.isRequired).isRequired,includeResultsAgainstArchivedSchemas:J().bool}
const zZ=function withFilteredAssayResultsLoading(e){const t=FilteredAssayResultsConnector.connect(e)
class FetchFilteredAssayResultsWrapper extends d.Component{componentDidMount(){(0,CN.TN)()
this.props.fetchFilteredAssayResults(this.props.filters)}componentDidUpdate(e){Is()(this.props.filters,e.filters)||this.props.fetchFilteredAssayResults(this.props.filters)}render(){return d.createElement(t,{...this.props})}}return(0,_a.$j)(null,{fetchFilteredAssayResults:VZ.W})(FetchFilteredAssayResultsWrapper)}(StandaloneResultsView)
var $Z=n(208029),WZ=n(795110),HZ=n(584651)
function FulfillmentLinks({entrySummaries:e,workflowSummaries:t}){return e&&t?d.createElement("div",null,t.length>0&&d.createElement("div",{className:"u-spacing-top"},d.createElement(so.Dx,null,"Workflows"),d.createElement("div",null,t.map((({id:e,name:t,humanId:n,editURL:a},i)=>d.createElement("span",{key:e},i>0&&", ",d.createElement("a",{onClick:()=>{dc.g(e)}},`${n} • ${t}`)))))),e.length>0&&d.createElement("div",{className:"u-spacing-top"},d.createElement(so.Dx,null,"Entries"),d.createElement("div",null,e.map((({id:e,name:t},n)=>d.createElement("span",{key:e},n>0&&", ",d.createElement("a",{onClick:()=>{Rn.Z.openFile(e)}},t))))))):null}FulfillmentLinks.propTypes={entrySummaries:J().arrayOf(J().object.isRequired),workflowSummaries:J().arrayOf(J().shape({id:J().string.isRequired,humanId:J().string.isRequired,name:J().string.isRequired,editURL:J().string}).isRequired)}
const jZ=(0,_a.$j)((function FulfillmentLinks_mapStateToProps(e,{requestId:t}){const n=new HZ.xT(e.models.workflows),a=l.default.indexBy(n.getAllWorkflowSummaries(),"id"),{fulfillmentsById:i,fulfillmentIdsByRequestId:s}=e.models.requests.fulfillments,{entrySummariesById:r}=e.models,o=s[t].map((e=>i[e])),c=l.default.uniq(l.default.compact(l.default.pluck(o,"entryId"))),d=l.default.uniq(l.default.compact(l.default.pluck(o,"workflowId")))
return c.some((e=>null==r[e]))||d.some((e=>null==a[e]))?{entrySummaries:null,workflowSummaries:null}:{entrySummaries:c.map((e=>r[e])),workflowSummaries:d.map((e=>a[e]))}}))(FulfillmentLinks)
var YZ=n(133832),QZ=n(276281),KZ=n(676159),JZ=n(75804),XZ=n(2634),eB=n(862059),tB=n(978047),nB=n(118559)
function withoutCustomTags(e){return e.filter((e=>VR.Yx(e)))}function ResponseSampleTable(e){(0,S.hu)(e.records.length>0,"Expected records")
const t=l.default.sortBy(e.records,"id"),n=[HR.nK,"Status","Created At",...withoutCustomTags(e.records[0].tags).map((e=>e.tagSchemaField.displayName))]
return d.createElement(tB.E.Provider,{value:{isTableInitiallyCollapsed:!1}},d.createElement(eB.iA,{leftHeader:e.header,headerCells:n},t.map(((e,t)=>d.createElement(eB.X2,{key:t},d.createElement(eB.bL,null,d.createElement(uc.Z,{href:de.jp(e.url)},e.id)),d.createElement(eB.bL,null,nB.a0[e.status]),d.createElement(eB.bL,null,(0,Hr.UT)(e.createdAt)),withoutCustomTags(e.tags).map((e=>d.createElement(eB.bL,{key:e.name},d.createElement(VF.Z,{tag:e})))))))))}ResponseSampleTable.propTypes={header:J().node.isRequired,records:J().arrayOf(J().shape({id:J().string.isRequired,createdAt:J().string.isRequired,status:J().oneOf([nB.oT,nB.sY]).isRequired,tags:J().arrayOf(VR.kY.isRequired).isRequired,url:J().string.isRequired}).isRequired).isRequired}
function TableHeader(e){return d.createElement("span",null,e.schemaName," ",e.sampleType)}TableHeader.propTypes={sampleType:J().oneOf(["Entities","Batches"]).isRequired,schemaName:J().string.isRequired}
function BioentityTable(e){return d.createElement(ResponseSampleTable,{header:d.createElement(TableHeader,{sampleType:"Entities",schemaName:e.schemaName}),records:e.samples.map((({bioentity:e,status:t})=>({id:e.name,createdAt:e.created_at,status:t,tags:e.tags,url:e.editURL})))})}BioentityTable.propTypes={samples:J().arrayOf(PZ.ao.isRequired).isRequired,schemaName:J().string.isRequired}
function BatchTable(e){return d.createElement(ResponseSampleTable,{header:d.createElement(TableHeader,{sampleType:"Batches",schemaName:e.schemaName}),records:e.samples.map((({batch:e,status:t})=>({id:e.name,createdAt:e.createdAt,status:t,tags:[...e.file.tags,...e.tags],url:e.url})))})}BatchTable.propTypes={samples:J().arrayOf(PZ.ao.isRequired).isRequired,schemaName:J().string.isRequired}
function batchSchemaName(e,t,n){var a,i
if(!t[e])return"Loading..."
const s=null===(i=n[null===(a=t[e])||void 0===a?void 0:a.tagSchemaId])||void 0===i?void 0:i.name
return(0,S.Gp)(null!=s,"Did not fetch this batch schema's tag schema")?s:"(Batch name failed to load)"}function Frame(e){return d.createElement("div",{className:"u-spacing-top u-spacing-bottom"},d.createElement(so.Dx,null,(0,XZ.U8)("Legacy workflow output samples","Workflow output samples")),e.children)}Frame.propTypes={children:J().node.isRequired}
class ResponseSamples extends d.Component{componentDidMount(){this._shouldLoadBatchSchemas()&&(0,QZ.$r)()}_shouldLoadBatchSchemas(){return this.props.samples.some((e=>e.batch&&!this.props.batchSchemasById[e.batch.batchSchemaId]))}_renderBioentitySampleTable(e){var t,n
const a=null!==(n=null===(t=e[0].bioentity.tagSchema)||void 0===t?void 0:t.id)&&void 0!==n?n:null,i=null==a||null==this.props.tagSchemasById[a]?"(Unknown)":this.props.tagSchemasById[a].name
return d.createElement(BioentityTable,{key:a,samples:e,schemaName:i})}_renderBatchSampleTable(e,t){const n=e[0].batch.batchSchemaId
return d.createElement(BatchTable,{key:n||`null_${t}`,samples:e,schemaName:batchSchemaName(n,this.props.batchSchemasById,this.props.tagSchemasById)})}render(){if(0===this.props.samples.length)return d.createElement(Frame,null,d.createElement("div",{className:"u-faded"},"No samples in the terminal ",(0,XZ.U8)("legacy workflow","workflow")," stage output table"))
if(this.props.tagSchemasLoading||this._shouldLoadBatchSchemas())return d.createElement(Frame,null,d.createElement(kl.Z,null))
const e=function groupBioentitiesForTables(e,t){const n=e.filter((e=>e.bioentity)),a=l.default.groupBy(n,(({bioentity:e})=>{var t
return null===(t=e.tagSchema)||void 0===t?void 0:t.id}))
return l.default.sortBy(Object.keys(a),(e=>{var n
return null===(n=t[e])||void 0===n?void 0:n.name})).map((e=>a[e]))}(this.props.samples,this.props.tagSchemasById),t=function groupBatchesForTables(e,t,n){if(l.default.isEmpty(t))return[]
const a=e.filter((e=>e.batch)),i=l.default.groupBy(a,(({batch:e})=>e.batchSchemaId))
return l.default.sortBy(Object.keys(i),(e=>batchSchemaName(e,t,n))).map((e=>i[e]))}(this.props.samples,this.props.batchSchemasById,this.props.tagSchemasById)
return d.createElement(Frame,null,e.map((e=>this._renderBioentitySampleTable(e))),t.map(((e,t)=>this._renderBatchSampleTable(e,t))))}}ResponseSamples.propTypes={batchSchemasById:J().objectOf(YZ.ZK).isRequired,batchSchemasLoading:J().bool.isRequired,samples:J().arrayOf(PZ.ao.isRequired).isRequired,tagSchemasById:J().objectOf(VR.cj).isRequired,tagSchemasLoading:J().bool.isRequired}
const aB=(0,gk.compose)(JZ.Z.connect((e=>({tagSchemasById:l.default.indexBy(e.getTagSchemas({includeArchived:!0}),"id"),tagSchemasLoading:!e.getIsInitialized()}))),KZ.Z.connect((e=>({batchSchemasById:l.default.indexBy(e.getAllBatchSchemas(),"id"),batchSchemasLoading:e.loadingAllBatchSchemas}))))(ResponseSamples)
var iB=n(687715)
function RequestResponse_Frame(e){return d.createElement("div",{className:"react-tab-container react-tab-container--mediocre-contentWrapper"},d.createElement("div",null,d.createElement(so.R6,null,e.requestSchema.name," ",e.request.name),e.children))}RequestResponse_Frame.propTypes={children:J().node.isRequired,request:PZ.c8.isRequired,requestSchema:PZ.iQ.isRequired}
class RequestResponse extends d.Component{componentDidMount(){this.props.request&&!this._getRequestSchema()&&CN.TN()
this.props.fetchRequestResponse(this.props.requestId)}componentDidUpdate(e){!this.props.request||e.request||this._getRequestSchema()||CN.TN()}shouldComponentUpdate(e){return!Is()(this.props,e)}_getRequestSchema(){return l.default.findWhere(this.props.requestSchemas,{id:this.props.request.schemaId})}render(){if(!(this.props.fulfillments&&this.props.request&&this.props.requestSchemas&&this.props.response))return d.createElement(EN.d,null)
const e=this._getRequestSchema()
if(!e)return d.createElement(EN.d,null)
return this.props.fulfillments.some((({entryId:e,workflowId:t})=>e||t))?d.createElement(RequestResponse_Frame,{request:this.props.request,requestSchema:e},d.createElement("div",{className:"requestView"},d.createElement(jZ,{requestId:this.props.requestId}),d.createElement(aB,{samples:this.props.response.samples}),d.createElement(so.Dx,null,$Z.D6.Results),d.createElement(zZ,{emptyMessage:"No results were created",filters:{requestId:this.props.requestId},includeResultsAgainstArchivedSchemas:!0}))):d.createElement(RequestResponse_Frame,{request:this.props.request,requestSchema:e},d.createElement("div",{className:"u-spacing-top u-faded"},"This request has not been executed"))}}RequestResponse.propTypes={fulfillments:J().arrayOf(AZ.Fp.isRequired),request:PZ.c8,requestId:J().string.isRequired,response:PZ.n8,requestSchemas:J().arrayOf(PZ.iQ.isRequired),fetchRequestResponse:J().func.isRequired}
const sB=(0,gk.compose)((function withRequestLoading(e){class Component extends d.Component{componentDidMount(){this.props.openRequest(this.props.requestId)}render(){return d.createElement(e,{...this.props})}}Component.propTypes={requestId:J().string.isRequired,openRequest:J().func.isRequired}
return(0,_a.$j)((function mapStateToProps(e,{requestId:t}){return{request:e.models.requests.inputs.requestsById[t]}}),(function mapDispatchToProps(e){return{openRequest(t){e((0,iB.PO)(t))}}}))(Component)}),IN.Z.connect((e=>({requestSchemas:e.getAssaySchemas(OZ.aJ.ASSAY_REQUEST)}))),WZ.Z.connect((e=>({batches:e.getBatches()}))),(0,_a.$j)((function RequestResponse_mapStateToProps(e,t){const{fulfillmentsById:n,fulfillmentIdsByRequestId:a,responsesByRequestId:i}=e.models.requests.fulfillments,{fileSummariesById:s}=e.models,{batches:r}=t,o=i[t.requestId]
if(!o)return{response:null}
const c=o.samples.map((({bioentityId:e,batchId:t,status:n})=>({bioentity:e?s[e]:null,batch:t?l.default.findWhere(r,{id:t}):null,status:n}))),d=a[t.requestId]
return{fulfillments:d?d.map((e=>n[e])):null,response:{samples:c}}}),{fetchRequestResponse:RZ.$Q}))(RequestResponse)
class RequestResponseTabView extends Js{render(){const e={requestId:this.model.get("requestId")};(0,Me.A9)(d.createElement(sB,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}RequestResponseTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var rB=n(571946),oB=n(776105)
function EntityResultsView(e){return d.createElement("div",{className:"react-tab-container react-tab-container--mediocre-contentWrapper"},d.createElement(so.R6,null,$Z.D6.Results),d.createElement("div",{className:"u-small-spacing-top"},d.createElement(uN.I,{fileId:e.entityId},d.createElement(zZ,{emptyMessage:`No ${$Z.D6.results} are linked to this entity${(0,oB.Z)()?" or its batches":""}`,filters:{bioentityId:e.entityId},includeResultsAgainstArchivedSchemas:!1}))))}EntityResultsView.propTypes={entityId:J().string.isRequired}
const lB=EntityResultsView
class EntityResultsTabView extends Js{render(){const e=this.model.get("model")
Me.A9(d.createElement(lB,{entityId:e.id}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}EntityResultsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var cB=n(654610)
function LinkedResultsView(e){return d.createElement("div",{className:"react-tab-container react-tab-container--mediocre-contentWrapper"},d.createElement(so.R6,null,$Z.D6.Results),d.createElement("div",{className:"u-small-spacing-top"},d.createElement(uN.I,{fileId:e.fileId},d.createElement(zZ,{emptyMessage:`No ${$Z.D6.results} are linked to this ${ea.ZP.apiIdToType(e.fileId)}`,filters:e.filters,includeResultsAgainstArchivedSchemas:!1}))))}class LinkedResultsTabView extends Js{render(){const e=this.model.get("fileId"),t=this.model.get("filters")
Me.A9(d.createElement(LinkedResultsView,{fileId:e,filters:t}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}LinkedResultsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var dB=n(582419)
const uB=function StorableResultsView(e){return d.createElement("div",{className:"react-tab-container react-tab-container--mediocre-contentWrapper"},d.createElement(so.R6,null,$Z.D6.Results),d.createElement("div",{className:"u-small-spacing-top"},d.createElement(uN.I,{fileId:e.storableId},d.createElement(zZ,{emptyMessage:`No ${$Z.D6.results} are linked to this ${ea.ZP.apiIdToType(e.storableId)}`,filters:{storableId:e.storableId},includeResultsAgainstArchivedSchemas:!1}))))}
class StorableResultsTabView extends Js{render(){const e=this.model.get("storableId")
Me.A9(d.createElement(uB,{storableId:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}StorableResultsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var mB=n(575209),pB=n(858583),hB=n(725219),gB=n(659392),EB=n(956289)
const fB="Status"
function ResultStatusTabTable_Row({row:e}){const t=e.lastAssayValidationChange.status,n=eB.bL
return d.createElement(eB.X2,null,e.primaryLinkFieldTag&&d.createElement(n,null,pC.PB(e.primaryLinkFieldTag)?d.createElement(VF.Z,{tag:e.primaryLinkFieldTag,chipSize:Za.TK.TABLE_CELL}):d.createElement(hB.Z,null)),d.createElement(n,{"data-test-component":"ResultStatusTabTableCell","data-test-element":"field"},e.fieldName),d.createElement(n,{"data-test-component":"ResultStatusTabTableCell","data-test-element":"value"},e.formattedValue),d.createElement(n,{"data-test-component":"ResultStatusTabTableCell","data-test-element":"status"},d.createElement(P.ZP,{title:EB.rv[t]},d.createElement(gB.Z,{status:t}))),d.createElement(n,{"data-test-component":"ResultStatusTabTableCell","data-test-element":"comment"},e.lastAssayValidationChange.comment),d.createElement(n,null,d.createElement(eB.He,{user:e.lastAssayValidationChange.creator})),d.createElement(n,null,(0,Hr.UT)(e.lastAssayValidationChange.createdAt)))}class ResultStatusTabTable extends d.Component{getHeaderCells(){return(this.tableHasPrimaryLinkField()?["Sample"]:[]).concat(["Field","Value",fB,"Comment","User","Timestamp"])}_getColumns(){return this.getHeaderCells().map((e=>d.createElement("col",{key:e,className:(0,g.iv)(e===fB?SB.statusColumn:SB.nonStatusColumn)})))}tableHasPrimaryLinkField(){return this.props.table.rows.some((e=>Boolean(e.primaryLinkFieldTag)))}render(){return d.createElement(tB.E.Provider,{value:{isTableInitiallyCollapsed:!1}},d.createElement(eB.iA,{columns:this._getColumns(),largerHeader:!0,headerCells:this.getHeaderCells(),leftHeader:this.props.table.tableName,useMinimalMargin:!0},this.props.table.rows.map(((e,t)=>d.createElement(ResultStatusTabTable_Row,{row:e,key:t})))))}}const SB=g.mM.create({statusColumn:{width:60},nonStatusColumn:{width:eB.Q0/2}})
class ResultStatusTabConnector extends oi.C{enhanceProps(){return{tables:(0,pB.K)(this.props.entryFile,(0,pB.t)(this.reduxState()))}}}const yB=ResultStatusTabConnector.connect((function ResultStatusTab(e){return d.createElement("div",{className:"react-tab-container",...(0,ee.Z)({component:"ResultStatusTab",element:"root"})},d.createElement(so.R6,null,$Z.D6.Result," Status"),e.tables.map(((e,t)=>d.createElement(ResultStatusTabTable,{table:e,key:t}))))}))
class ResultStatusTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}initialize(){this.listenTo(this.model.get("model"),"change",(()=>{this.rerender()}))}render(){this.rerender()
return this}rerender(){(0,Me.A9)(d.createElement(yB,{entryFile:this.model.get("model")}),this.el)}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ResultStatusTabView.initClass()
var bB=n(201157),TB=n(180214)
class RunDetailsTabView extends Js{render(){const e={runId:this.model.get("runId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(TB.ZP,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}RunDetailsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var vB=n(880306),CB=n(439454),IB=n(704985),wB=n(599874),NB=n(921177)
const AB=(0,_a.$j)(null,((e,t)=>(0,gk.bindActionCreators)({fetchFilteredAssayResults:()=>(0,VZ.W)({assayRunId:t.run.id})},e)))((function RunResults(e){const t=e.linkedResults.length?`Validation will be set on ${e.linkedResults.length} ${(0,de._6)(e.linkedResults.length,$Z.D6.result)} linked to this ${$Z.D6.run}.`:null
return d.createElement("div",{className:"react-tab-container react-tab-container--mediocre-contentWrapper"},d.createElement(h.Z,{bufferRowReset:!0},d.createElement(p.Z,{xs:6,className:(0,g.iv)(PB.title)},$Z.D6.Results),d.createElement(p.Z,{xs:6},d.createElement("div",{className:"u-justify-content-end"},e.run.permissions.writable&&d.createElement(IB.Z,{modalWarningMessage:t,size:C.qE.SMALL,validatableInputs:(0,wB.Zw)(e.run)}),d.createElement(NB.WZ,{assayRun:e.run,resultSchemasForRun:e.resultSchemas,fetchAssayResultsByRun:e.fetchFilteredAssayResults})))),d.createElement("div",{className:"u-small-spacing-top"},d.createElement(zZ,{emptyMessage:`No ${$Z.D6.results} are linked to this run`,filters:{assayRunId:e.run.id},includeResultsAgainstArchivedSchemas:!1})))})),RB=xa.Ps`
  query RunResultsQuery($runId: StrictString!, $offset: StrictInt!)
  @skipAudit
  @engComponent(name: LAB_AUTOMATION) {
    run(id: $runId) {
      ... on RunNode {
        ...RunGraphQL
        linkedResults(limitOffsetInput: {limit: 100, offset: $offset}) {
          ... on ResultListingNode {
            total
            results {
              ...ResultGraphQL
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
    ...AllResultSchemasGraphQL
  }
  ${(0,La.f)("Run").fragment}
  ${(0,La.f)("Result").fragment}
  ${(0,La.f)("AllResultSchemas").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function QueryingRunResults(e){const t=(0,Da.IJ)(RB,{variables:{runId:e.runId,offset:0},fetchPolicy:"cache-and-network"}),n=(0,d.useRef)();(0,d.useEffect)((()=>{if(t.type===Da.NI.SUCCESS&&t.data&&t.fetchMore){n.current=t
!(0,ka.CZ)(t.data.run)&&t.data.run.linkedResults.results.length<t.data.run.linkedResults.total&&t.fetchMore({variables:{offset:t.data.run.linkedResults.results.length}})}}),[t])
const a=n.current
let i
if(t.type===Da.NI.PENDING&&a&&a.type===Da.NI.SUCCESS)i=a.data
else{if(t.type!==Da.NI.SUCCESS)return d.createElement(EN.d,null)
i=t.data}return(0,ka.CZ)(i.run)?d.createElement(Ll.Z,{inaccessibleInfo:i.run,modelType:"run"}):d.createElement(AB,{...e,run:(0,zo.tY)("Run",i.run),resultSchemas:(0,CB.Z)((0,zo.NA)("ResultSchema",i.resultSchemas),i.run.schema.id),linkedResults:(0,zo.NA)("Result",i.run.linkedResults.results)})}const PB=g.mM.create({title:{fontSize:"17px"}})
class RunResultsTabView extends Js{render(){const e={runId:this.model.get("runId")};(0,Me.A9)(d.createElement("div",{className:"react-tab-container"},d.createElement(QueryingRunResults,{...e})),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}RunResultsTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var OB=n(176133),xB=n(938454),_B=n(57214),DB=n(465342),LB=n(251011),kB=n(647517),MB=n(316887),FB=n(335965)
class ConfirmableMeasurementField extends d.Component{constructor(){super(...arguments)
this.state={isBeingEdited:!1,measurement:this.props.measurement}
this.updateMeasurement=e=>{this.setState({measurement:{...this.state.measurement,...e}})}
this.handleUnitsChange=({val:e})=>{this.updateMeasurement({units:e})}
this.handleValueChange=e=>{this.updateMeasurement({value:e.target.numericValue})}
this.handleComplete=()=>{this.props.onComplete(this.state.measurement)
this.setState({isBeingEdited:!1})}
this.handleEdit=()=>{this.setState({isBeingEdited:!0})}
this.handleEditWithConfirmation=async()=>{(0,S.hu)(null!=this.props.confirmBeforeStartEditing,"Expected confirmBeforeStartEditing to be provided")
await this.props.confirmBeforeStartEditing()&&this.setState({isBeingEdited:!0})}
this.handleCancel=()=>{this.setState({isBeingEdited:!1,measurement:this.props.measurement})}}render(){var e,t
const n=this.props.measurement,a=this.props.isDisabled||null!=this.props.disableEditsWithTooltip
return d.createElement("div",{className:f()("editableField",{"is-beingEdited":this.state.isBeingEdited})},this.state.isBeingEdited?d.createElement(FB.Z,{measurement:this.state.measurement,onChangeUnits:this.handleUnitsChange,onChangeValue:this.handleValueChange,validUnits:this.props.validUnits}):d.createElement(Zo.Z,{text:this.props.disableEditsWithTooltip,isDisabled:null==this.props.disableEditsWithTooltip},d.createElement("div",{className:f()({"u-faded":null==n.value})},MB.wD(n))),!a&&d.createElement(aA.Z,{cancel:this.handleCancel,complete:this.handleComplete,edit:null!=this.props.confirmBeforeStartEditing?this.handleEditWithConfirmation:this.handleEdit,isCompact:!0,isCompleteEnabled:null==(null===(e=this.state.measurement)||void 0===e?void 0:e.value)==(null==(null===(t=this.state.measurement)||void 0===t?void 0:t.units)),isEditing:this.state.isBeingEdited}))}}ConfirmableMeasurementField.defaultProps={isDisabled:!1}
const ZB=ConfirmableMeasurementField
function DetailCell({name:e,value:t,colSpan:n}){return d.createElement("td",{className:"contentDetail",colSpan:n},d.createElement("div",{className:"contentDetail-name"},e),t?d.createElement("div",{className:"u-ellipsis-text"},t):d.createElement("div",{className:"u-faded"},"None"))}DetailCell.defaultProps={colSpan:1}
function NameDetailCell(e){const t=ea.ZP.apiIdToType(e.id)===st.BATCH?"Batch ID":"Name"
return d.createElement(DetailCell,{name:t,key:"contentName",value:d.createElement(uc.Z,{href:de.jp(e.url)},e.name)})}class ContainerContentDetailsTable extends d.Component{constructor(){super(...arguments)
this.state={isExpanded:!0}
this.getDetailRows=e=>{const t=Math.ceil(Number(e.length)/4)
return l.default.times(t,(t=>d.createElement("tr",{className:"gridView-contentDetailsRow",key:t},l.default.times(4,(n=>{const a=4*t+n
return a>=e.length?null:d.createElement(DetailCell,{key:e[a].key,name:e[a].name,value:e[a].value})})))))}
this.toggleExpanded=()=>{this.setState({isExpanded:!this.state.isExpanded})}}render(){const e=[...this.props.containerContent.lotNumber?[{key:"sampleLotNumber",name:"Sample lot number",value:this.props.containerContent.lotNumber}]:[],...this.props.showResidues?[{key:"residues",name:"Sequence",value:d.createElement("span",{className:"u-ellipsis-text selectable mono"},this.props.residues)}]:[],...this.props.tags.map((e=>({key:e.name,name:e.name,value:e.value})))]
return d.createElement("div",{className:f()("gridView-contentDetails",{"gridView-contentDetails--expanded":this.state.isExpanded})},d.createElement("table",{className:"gridView-contentDetailsTable"},d.createElement("tbody",null,d.createElement("tr",{className:"gridView-contentDetailsRow"},d.createElement(NameDetailCell,{id:this.props.containerContent.containedItemId,name:this.props.name,url:this.props.url}),this.props.bioentityName&&d.createElement(DetailCell,{name:"Entity name",key:"bioentityName",value:d.createElement(P.ZP,{title:this.props.bioentityName},d.createElement("div",{className:"u-ellipsis-text"},this.props.bioentityName))}),d.createElement(DetailCell,{colSpan:this.props.bioentityName?2:3,name:"Concentration",value:d.createElement(ZB,{measurement:this.props.containerContent.concentration,onComplete:e=>{xB.updateContainerContentWithDataMods(this.props.containerContent.containerId,this.props.containerContent.containedItemId,e)},isDisabled:null!=this.props.disableEditsWithTooltip,validUnits:kB.fO,confirmBeforeStartEditing:()=>this.props.checkSampleStatus({actionAttempted:"update_concentration",eventGroupId:m.Vr()}),disableEditsWithTooltip:this.props.disableEditsWithTooltip})}),d.createElement("td",{className:"contentDetail-iconCell"},d.createElement(pe.Z,{className:"u-pointer",icon:this.state.isExpanded?"chevron-up":"chevron-down",onClick:this.toggleExpanded}))),this.state.isExpanded&&this.getDetailRows(e))))}}const BB=xa.Ps`
  query ContainerContentTablesLotNumbersQuery($containerIds: [StrictString!]!)
  @skipAudit
  @engComponent(name: INVENTORY) {
    containers(ids: $containerIds) {
      ... on ContainerNode {
        id
        contents {
          id
          lotNumber
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class ContainerContentTablesConnector extends oi.C{constructor(){super(...arguments)
this.stores=[WZ.Z]}enhanceProps(){const e=this.props.containerContents.map((({containedItemId:e})=>e)),t=e.filter((e=>ea.ZP.isBatch(e))),n=e.filter((e=>ea.ZP.isBiologicalEntity(e))),a=this.getOrFetchMultipleMaybeInaccessibleRequired(lA.V.BATCH,t),i=this.getOrFetchMultipleMaybeInaccessibleRequired(lA.V.BIOENTITY_SUMMARY,n)
return{containedBatches:l.default.omit(a,(e=>(0,kN.Eh)(e))),containedBioentities:l.default.omit(i,(e=>(0,kN.Eh)(e)))}}}function ContainerContentTables({containedBatches:e,containedBioentities:t,containerContents:n,checkSampleStatus:a,disableEditsWithTooltip:i}){return d.createElement("div",{className:"u-spacing-bottom"},n.map((n=>{var s
const r=e[n.containedItemId],o=t[n.containedItemId]
if(r)return d.createElement(ContainerContentDetailsTable,{containerContent:n,key:r.id,bioentityName:r.file.name,name:d.createElement("span",null,r.name,d.createElement(lC.Z,{item:r})),residues:r.file.residues,showResidues:r.file.tagSchema.showResidues,tags:[...r.tags,...r.file.tags],url:r.url,checkSampleStatus:a,disableEditsWithTooltip:i})
if(o){let e=null;(0,RR.h6)(o)?e=o.bases:(0,RR.SF)(o)&&(e=o.version&&o.version.aminoAcids)
return d.createElement(ContainerContentDetailsTable,{containerContent:n,key:o.id,name:d.createElement("span",null,o.name,d.createElement(lC.Z,{item:o})),residues:e,showResidues:null===(s=o.tagSchema)||void 0===s?void 0:s.showResidues,tags:o.tags,url:o.editURL,checkSampleStatus:a,disableEditsWithTooltip:i})}return null})))}const qB=ContainerContentTablesConnector.connect((function QueryingContainerContentTables(e){const t=(0,Da.IJ)(BB,{variables:{containerIds:[e.containerId]}}),{containerContents:n,...a}=e
let i=n
if(t.type===Da.NI.SUCCESS){const[e]=t.data.containers
!(0,ka.CZ)(e)&&n.every(((t,n)=>t.id===e.contents[n].id))&&(i=n.map(((t,n)=>({...t,lotNumber:e.contents[n].lotNumber}))))}return d.createElement(ContainerContentTables,{...a,containerContents:i})}))
var VB=n(136765),UB=n(353623),GB=n(273155),zB=n(477956),$B=n(922805),WB=n(849557),HB=n(487761)
function BarcodeValue(e){return e.storable.barcode?dt.ZP.INVENTORY_ENABLE_EDIT_BARCODES&&e.handleBarcodeChange?d.createElement("div",{className:(0,g.iv)(jB.fullWidth)},d.createElement(Iw.Z,{isDisabled:e.isDisabled,emptyValueAllowed:!1,requestChange:e.handleBarcodeChange,value:e.storable.barcode,confirmBeforeStartEditing:e.confirmBeforeStartEditing,disableEditsWithTooltip:e.disableEditsWithTooltip,dataTestAttrs:{component:"Barcode",element:"value"},hasFieldActionButtonsOuterMargin:!1})):d.createElement("span",{...(0,ee.Z)({component:"Barcode",element:"value"})},e.storable.barcode):d.createElement("span",{className:"u-faded"},"None")}const jB=g.mM.create({fullWidth:{maxWidth:"90%"}})
var YB=n(373829),QB=n(726139),KB=n(769264),JB=n(707560)
function supportsValidRestrictionStatus(e){return e.restrictionStatus!==VB.nY.NOT_APPLICABLE}function ConfirmSampleControlsPane(e){var t,n,a,i
const s=e.paneState.selectedInputContainer,r=null!=s?d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Source container",labelStyle:Fr.Z.STYLES.LABEL}),d.createElement(wA.Z,{onChange:Jt.ZT,selectedStorables:[s],disabled:!0})):null,o=null!=s&&supportsValidRestrictionStatus(s),l=function getNumberOfOutputFixedPlateWells(e){return e?e.filter((({outputContainer:e})=>!supportsValidRestrictionStatus(e))).length:0}(e.paneState.confirmTransferQuantitiesData)
return d.createElement("div",null,l>0&&d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement(io.ZP,{bannerType:io.ct.WARNING,text:"Fixed plate wells don't have sample controls and will be excluded from this step."})),d.createElement(Ke.Z,null,d.createElement(mm.Z,{title:"Destination sample controls",options:[{label:o?"Add values from source container":"Keep existing values on destination containers",value:!0},{label:"Manually set values",value:!1}],onChange:t=>{e.onUpdateModalState({useInferredSampleControls:t})},selectedValue:e.paneState.useInferredSampleControls,isVertical:!0})),e.paneState.useInferredSampleControls&&o&&null!=s?d.createElement(JB.Z,{extraFieldElement:r,restrictionStatus:s.restrictionStatus,restrictedSampleUsers:null!==(n=null===(t=s.sampleRoles)||void 0===t?void 0:t.restrictedSampleUsers)&&void 0!==n?n:[],sampleOwners:null!==(i=null===(a=s.sampleRoles)||void 0===a?void 0:a.sampleOwners)&&void 0!==i?i:[],onChangeSampleControls:Jt.ZT,isReadOnly:!0}):e.paneState.useInferredSampleControls?null:d.createElement(JB.Z,{restrictionStatus:e.paneState.restrictionStatus,restrictedSampleUsers:e.paneState.restrictedSampleUsers,sampleOwners:e.paneState.sampleOwners,onChangeSampleControls:e.onUpdateModalState}),e.paneState.errorMessage&&d.createElement("div",null,d.createElement(so.Dx,null,"Errors:"),d.createElement("div",{className:"u-danger-color"},e.paneState.errorMessage)))}var XB=n(870822),eq=n(453657),tq=n(380490),nq=n(654996),aq=n(150126)
function transferContainers(e,t,n){return Cn.ty({url:"/1/api/transfers/actions/transfer-containers",data:{containerTransfers:e,containerContents:t,...n}})}function calculateConcentrations(e,t,n){return Cn.s0({url:"/1/api/transfers:calculate-concentrations",data:{containerTransfers:e,shouldCalculateConcentrations:t,inputContainableConcentration:n}})}function transferGridsWithDataMods(e){var t
const n=[e.inputGridId];(null===(t=e.existingGridParams)||void 0===t?void 0:t.outputGridId)&&n.push(e.existingGridParams.outputGridId);(0,fA.Kz)({changeSummary:(0,yA.P_)({apiIds:n,action:yA.wV.TRANSFER_PLATE}),onRequestClose:()=>{},onRequestSubmit:()=>{!function TransferActions_transferGrids({containerContents:e,inputGridId:t,shouldTransferAllQuantities:n,transferQuantity:a,folderId:i,createGridParams:s,existingGridParams:r,onStart:o=Jt.ZT,onFinish:l=Jt.ZT}){o();(function transferGrids(e,t,n,a,i,s,r){return an.by({contentType:"application/json",data:JSON.stringify({inputGridId:t,containerContents:e,shouldTransferAllQuantities:n,transferQuantity:a,createGridArgs:s,existingGridArgs:r}),type:"POST",dataType:"json",url:"/1/api/transfers/actions/transfer-plate-to-plate"}).done((()=>{i&&ze.Z.invalidateFolder(i)}))})(e,t,n,a,i,s,r).done((({invalidatableBatchIds:e,invalidatableContainedItemIds:t,invalidatableStorableIds:n})=>{v.ZP.success("Plate transfer completed")
l()
Sa.Z.dispatch({actionType:fa.Ud$,invalidatableBatchIds:e,invalidatableContainedItemIds:t,invalidatableStorableIds:n})})).fail((e=>{const t=v.ZP.getFriendlyError(e)
t||v.ZP.notifyError(e)
l(t||aq.q)}))}(e)}},dt.ZP.INVENTORY_ENABLE_DATA_MOD_REASONS,{module:"SAMPLES",actionOrigin:"inventory_registry_search_ui",modifiedAction:yA.wV.TRANSFER_PLATE,numModifiedTotalItems:n.length,entryId:null})}function TransferActions_undoTransfers(e,t,n,a){(function undoTransfers(e){return Cn.ty({url:"/1/api/transfers:undo",data:{undoToken:e}})})(e).done((()=>{Sa.Z.dispatch({actionType:fa.i17,invalidatableBatchIds:t,invalidatableContainedItemIds:n,invalidatableStorableIds:a})
v.ZP.success("Transfer was undone.")})).fail(v.ZP.notifyError)}function dispatchForTransferCompleted({undoToken:e,invalidatableBatchIds:t,invalidatableContainedItemIds:n,invalidatableStorableIds:a},i){i()
Sa.Z.dispatch({actionType:fa.Ud$,invalidatableBatchIds:t,invalidatableContainedItemIds:n,invalidatableStorableIds:a})
v.ZP.success("Successfully performed transfer.",{duration:600,actionText:"Undo",onActionClick:()=>{TransferActions_undoTransfers(e,t,n,a)}})}function dispatchForTransferFailed(e,t){const n=v.ZP.getFriendlyError(e)
n||v.ZP.notifyError(e)
t(n||aq.q)}async function doTransfersWithDataMods(e,t,n,a=Jt.ZT,i=Jt.ZT){const s=[...new Set([...e.flatMap((({inputSampleId:e,outputContainer:t})=>null!=e&&ea.ZP.isContainer(e)?[e,t.id]:[t.id])),...t.map((({containerId:e})=>e))])],r=(0,yA.P_)({apiIds:s,action:yA.wV.TRANSFER,containersMayBeWells:!0})
await(0,fA.GE)({changeSummary:r,onRequestClose:()=>{},onRequestSubmit:()=>{!function doTransfers(e,t,n,a=Jt.ZT,i=Jt.ZT){a()
transferContainers(e,t,n).done((e=>{dispatchForTransferCompleted(e,i)})).fail((e=>{dispatchForTransferFailed(e,i)}))}(e,t,n,a,i)}},dt.ZP.INVENTORY_ENABLE_DATA_MOD_REASONS,{module:"SAMPLES",actionOrigin:"inventory_registry_search_ui",modifiedAction:yA.wV.TRANSFER,numModifiedTotalItems:s.length,entryId:null})}function dispatchForCalculateConcentrationsCompleted({batches:e,containedBioentities:t,containerContents:n,containerTransfers:a},i){(0,Vn.getStore)().dispatch(tq.wb(l.default.indexBy(t,"id")))
Sa.Z.dispatch({actionType:fa.z0Y,batchesById:l.default.indexBy(e,"id")})
i({containerTransfers:a,containerContents:n})}function dispatchForCalculateConcentrationsFailed(e,t){const n=v.ZP.getFriendlyError(e)
n||v.ZP.notifyError(e)
t(n||aq.q)}function TransferActions_calculateConcentrations({containerTransfers:e,shouldCalculateConcentrations:t,inputContainableConcentration:n,onStart:a=Jt.ZT,onComplete:i=Jt.ZT,onFailure:s=Jt.ZT}){a()
calculateConcentrations(e,t,n).then((e=>{dispatchForCalculateConcentrationsCompleted(e,i)})).catch((e=>{dispatchForCalculateConcentrationsFailed(e,s)}))}function TransferActions_calculateConcentrationsGridToGrid(e,t,n,a,i=Jt.ZT,s=Jt.ZT){(function calculateConcentrationsGridToGrid(e,t,n,a){return an.ty({url:"/1/api/transfers/actions/tasks:calculate-concentrations-plate-to-plate",data:{inputGridId:e,outputGridId:t,shouldTransferAllQuantities:n,transferQuantity:a}})})(e,t,n,a).done((e=>{dispatchForCalculateConcentrationsCompleted(e,i)})).fail((e=>{dispatchForCalculateConcentrationsFailed(e,s)}))}var iq=n(452148),sq=n(416320)
const rq={INPUT_TYPE:{preferenceKey:n(334953).t.TRANSFER_MODAL_INPUT_TYPE,stateKey:"inputType"}}
function getTransferOutputPaneState(e){return(0,he.Z)(e,"outputType","outputContainerSummaries","outputPlate","outputCells","selectedInputContainer","outputSampleStatusState","inputSampleStatusState","confirmedOutputContainerIds","createAndRegisterBioentityArgs","inputBioentity","inputContainer","inputType","showNameTemplateBanner")}function getTransferQuantitiesPaneState(e){return(0,he.Z)(e,"confirmTransferQuantitiesData","inputContainable","selectedInputContainer","inputContainableConcentration","errorMessage","initialOutputContainerStateById")}function getTransferConcentrationsPaneState(e){return(0,he.Z)(e,"errorMessage","shouldCalculateConcentrations","confirmConcentrationsData","areSolidUnitsInvolved")}function getTransferSampleControlsPaneState(e){return(0,he.Z)(e,"errorMessage","useInferredSampleControls","restrictionStatus","restrictedSampleUsers","sampleOwners","selectedInputContainer","confirmTransferQuantitiesData")}function getTransferPaneState(e,t){const{inputType:n,inputBioentity:a,createAndRegisterBioentityArgs:i,inputContainer:s,inputContainableConcentration:r,outputType:o,outputContainerSummaries:c,outputPlate:d,outputCells:u,confirmTransferQuantitiesData:m,containerContents:p,containerTransfers:h,errorMessage:g,shouldCalculateConcentrations:E,inputSampleStatusState:f,outputSampleStatusState:y,confirmedOutputContainerIds:b,useInferredSampleControls:T,restrictionStatus:v,restrictedSampleUsers:C,sampleOwners:I,showNameTemplateBanner:w}=t,N=XB.tV.includes(n)?s:null,A=o===st.CONTAINER?c:u.map((e=>e.container)),R=l.default.countBy(A,(e=>e.id));(0,S.hu)(Object.values(R).every((e=>1===e)),"Expected only output container IDs to be unique")
const P=(0,Jt.Xc)((0,Jt.vM)(A,(e=>e.id)),(e=>e[0]))
switch(e){case YZ.RJ.CHOOSE_TRANSFER_INPUT:return{inputType:n,inputBioentity:a,createAndRegisterBioentityArgs:i,inputContainer:s,selectedOutputContainers:A,inputSampleStatusState:f,outputSampleStatusState:y,confirmedOutputContainerIds:b,showNameTemplateBanner:w,outputCells:u,outputContainerSummaries:c,outputType:o}
case YZ.RJ.CHOOSE_TRANSFER_OUTPUT:return{outputType:o,outputContainerSummaries:c,outputPlate:d,outputCells:u,selectedInputContainer:N,outputSampleStatusState:y,inputSampleStatusState:f,confirmedOutputContainerIds:b,createAndRegisterBioentityArgs:i,inputBioentity:a,inputContainer:s,inputType:n,showNameTemplateBanner:w}
case YZ.RJ.CONFIRM_TRANSFER_QUANTITIES:return{confirmTransferQuantitiesData:m,errorMessage:g,inputContainable:eq.bA(a),inputContainableConcentration:r,selectedInputContainer:N,initialOutputContainerStateById:P}
case YZ.RJ.CONFIRM_CONCENTRATIONS:return sq.zR({containerTransfers:h,containerContents:p,shouldCalculateConcentrations:E,inputContainer:s,errorMessage:g})
case YZ.RJ.CONFIRM_SAMPLE_CONTROLS:return{errorMessage:g,useInferredSampleControls:T,restrictionStatus:v,restrictedSampleUsers:C,sampleOwners:I,selectedInputContainer:N,confirmTransferQuantitiesData:m}
default:throw new Error(`Unexpected transfer modal pane ${e}`)}}function isPaneComplete(e,t){switch(e){case YZ.RJ.CHOOSE_TRANSFER_INPUT:return sq._b(t)
case YZ.RJ.CHOOSE_TRANSFER_OUTPUT:return sq.UC(t)
case YZ.RJ.CONFIRM_TRANSFER_QUANTITIES:{const n=getTransferPaneState(e,t)
return sq.ly(n)}case YZ.RJ.CONFIRM_CONCENTRATIONS:return sq.hw(t)
case YZ.RJ.CONFIRM_SAMPLE_CONTROLS:return sq.Je(t)
default:return!1}}function getConfirmedOutputContainers(e,t,n,a){const i=a===st.PLATE?e.map((e=>e.container)):t
return null==n?i:i.filter((e=>new Set(n).has(e.id)))}function getInputTagSchemaId(e,t,n){var a,i,s,r
switch(n){case XB.wD.NEW_BIOENTITY:return null!==(i=null===(a=e.tagSchema)||void 0===a?void 0:a.id)&&void 0!==i?i:null
case XB.wD.EXISTING_BIOENTITY:return null!==(r=null===(s=null==t?void 0:t.tagSchema)||void 0===s?void 0:s.id)&&void 0!==r?r:null
default:return null}}function initialConfirmTransferQuantitiesData(e){const{outputContainers:t,outputCells:n,outputType:a,confirmedOutputContainerIds:i,outputSampleStatusState:s}=e
let r
switch(a){case st.CONTAINER:(0,S.hu)(Boolean(t.length),"Expected at least one output container")
r=t
break
case st.PLATE:(0,S.hu)(Boolean(n.length),"Expected at least one output cell")
r=n.map((({container:e})=>e))
break
default:(0,S.hu)(!1,`Unhandled output type ${a}`)}const o=new Set(i)
return(null!=i&&s.warningInputOutputType!==st.PLATE?r.filter((e=>o.has(e.id))):r).map((e=>({outputContainer:e,transferQuantityValue:null,finalOutputQuantityValue:null})))}function getConfirmConcentrationsArgs(e){const{shouldCalculateConcentrations:t,inputContainableConcentration:n,inputContainer:a}=e,i=function getContainerTransfers(e){var t
const n=[],{inputBioentity:a,inputContainer:i,confirmTransferQuantitiesData:s}=e,r=null===(t=eq.hF(a,i))||void 0===t?void 0:t.id
if(null==r){(0,S.Gp)(!1,"Expected input bioentity, batch or container to be defined")
return[]}(0,S.hu)(null!=s,"expected confirmTransferQuantitiesData to be present")
s.forEach((({outputContainer:e,transferQuantityValue:t,finalOutputQuantityValue:a})=>{var i
n.push({inputSampleId:r,outputContainer:e,quantity:{value:t,units:null==t?null:e.quantity.units}})
const s=null!=t?t:0,o=null!==(i=e.quantity.value)&&void 0!==i?i:0
a&&a>s+o&&n.push({inputSampleId:null,outputContainer:e,quantity:{value:a-s-o,units:e.quantity.units}})}))
return n}(e)
return{containerTransfers:i,shouldCalculateConcentrations:sq.hN(t,i,a),inputContainableConcentration:n}}var oq=n(328867),lq=n(28500)
function isExistingBioentity(e){return XB.iL.includes(e)}function isNewBioentity(e){return XB.p3.includes(e)}function InputTypeOptions({inputType:e,onChange:t}){return d.createElement("span",null,d.createElement(Je.Z,{className:"radio-inline radio-inline--labelAligned u-spacing-right"},d.createElement("input",{type:"radio",name:"findOrCreateBioentity-inputType",value:XB.iL[0],checked:isExistingBioentity(e),onChange:t}),"Search for entity"),d.createElement(Je.Z,{className:"radio-inline radio-inline--labelAligned"},d.createElement("input",{type:"radio",name:"findOrCreateBioentity-inputType",value:XB.p3[0],checked:isNewBioentity(e),onChange:t}),"Register new entity"))}function FindOrCreateBioentity({createAndRegisterBioentityArgs:e,inputBioentity:t,inputType:n,onChangeCreateAndRegisterBioentityArgs:a,onChangeInputBioentity:i,onChangeInputType:s}){return d.createElement("div",null,d.createElement(Ke.Z,null,d.createElement(InputTypeOptions,{inputType:n,onChange:s})),d.createElement(Ke.Z,null,isExistingBioentity(n)?d.createElement(cw.Z,{onChange:e=>{i(e.length?e[0]:null)},selectedItems:t?[t]:[]}):d.createElement("div",{className:"well"},d.createElement(WF,{createAndRegisterBioentityArgs:e,onChange:a,isTagSchemaDisabledFn:e=>e.containableType===tw.TAG_SCHEMA_CONTAINABLE_TYPE.NONE,tagSchemaDisabledMessage:"not containable",labelStyle:Mo.gF.SUBLABEL}))))}const cq=function ChooseInputContainable({createAndRegisterBioentityArgs:e,inputBioentity:t,inputType:n,onUpdateModalState:a}){return d.createElement("div",null,d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Entity"}),d.createElement(FindOrCreateBioentity,{createAndRegisterBioentityArgs:e,inputBioentity:t,inputType:n,onChangeCreateAndRegisterBioentityArgs:function handleChangeCreateAndRegisterBioentityArgs(t){a({createAndRegisterBioentityArgs:{...e,...t}})},onChangeInputBioentity:function handleChangeInputBioentity(e){a({inputBioentity:e})},onChangeInputType:function handleChangeInputType(e){a({inputType:e.target.value})}})))}
var dq=n(804083)
function InputContainerContentsError({inputContainer:e}){return d.createElement("div",{className:"u-small-spacing-top u-small-spacing-bottom"},d.createElement(io.ZP,{bannerType:io.ct.ERROR,text:MB.KG(e)}))}function renderPossibleInputContainerContentsError({inputContainer:e}){return MB.i6(e)?null:d.createElement(InputContainerContentsError,{inputContainer:e})}class ChooseInputContainer extends d.Component{constructor(){super(...arguments)
this.state={containedItemIdsByContainerId:{}}
this.handleSearchSuccess=({storableSummaryExtras:e})=>{const t=e.containedItemsByContainerId
if(t){const e=(0,Jt.Xc)(t,(e=>e.map((({id:e})=>e))))
this.setState((t=>({...t,containedItemIdsByContainerId:{...t.containedItemIdsByContainerId,...e}})))}}
this.handleContainerChange=e=>{var t
const n=e.length?{...e[0],containedItemIds:null!==(t=this.state.containedItemIdsByContainerId[e[0].id])&&void 0!==t?t:[]}:null
this.props.onUpdateModalState({inputContainer:n})
this.updateInputSampleStatusWarnings(n)}
this.updateInputSampleStatusWarnings=e=>{var t
if(null==e){this.props.onUpdateSampleStatusState({shouldShowStatusWarnings:!1,canProceedOnSampleStatus:!1,selectedSampleIds:[]},"inputSampleStatusState")
return}const{shouldShowWarning:n,samples:a}=(0,oq.CC)({samples:[e]})
this.props.onUpdateSampleStatusState({shouldShowStatusWarnings:n,canProceedOnSampleStatus:!1,warningInputOutputType:XB.wD.EXISTING_CONTAINER,samples:null!=a?a:null,selectedSampleIds:null!==(t=null==a?void 0:a.map((({id:e})=>e)))&&void 0!==t?t:[]},"inputSampleStatusState")}
this.setCanProceedOnSampleStatus=e=>{this.props.onUpdateSampleStatusState({canProceedOnSampleStatus:e},"inputSampleStatusState")}}renderPossibleWarning(e){return this.props.inputSampleStatusState.shouldShowStatusWarnings&&null!=this.props.inputSampleStatusState.samples?d.createElement("div",{className:"u-small-spacing-top"},d.createElement(dq.Z,{shouldProceed:this.props.inputSampleStatusState.canProceedOnSampleStatus,canDeselectSamples:!1,onChangeShouldProceed:this.setCanProceedOnSampleStatus,samples:this.props.inputSampleStatusState.samples,setSelectedSampleIds:Jt.ZT,selectedSampleIds:this.props.inputSampleStatusState.selectedSampleIds,trackingParamsWithSampleIds:{...this.props.sampleStatusWarningTrackingParams,sampleIds:[e.id]}})):null}render(){return d.createElement("div",null,d.createElement(wA.Z,{onChange:this.handleContainerChange,registryId:this.props.registryId,selectedStorables:this.props.container?[this.props.container]:[],storableTypes:[st.CONTAINER],onSearchSuccess:this.handleSearchSuccess}),(()=>this.props.container?d.createElement(d.Fragment,null,renderPossibleInputContainerContentsError({inputContainer:this.props.container}),this.renderPossibleWarning(this.props.container),d.createElement(tV,{containerId:this.props.container.id,isWritableOverride:!1,showFullView:!1})):null)())}}const uq=ChooseInputContainer
function getIncompatibleUnitsOutputContainers({inputType:e,inputContainer:t,selectedOutputContainers:n}){if(!XB.tV.includes(e)||null==t)return[]
return n.filter((e=>!(0,kB.V7)([t.quantity.units,e.quantity.units])))}function ChooseInputContainerValidationError({selectedInputContainer:e,incompatibleUnitsOutputContainers:t}){return d.createElement("div",{className:"legacy-font-proxima-13"},d.createElement("p",{className:"u-danger-color"},`Cannot transfer from selected container ${(0,JF.yQ)(e)} into ${t.map((e=>(0,JF.yQ)(e))).join(", ")} because the units are incompatible.`))}const mq=g.mM.create({infoBanner:{marginTop:15}}),pq=function ChooseInputPane({paneState:e,registryId:t,sampleStatusWarningParams:n,onUpdateSampleStatusState:a,onUpdateModalState:i}){(0,Ul.Z)((()=>{e.selectedOutputContainers.length>0&&n.shouldShowOutputWarnings&&function checkForOutputWarnings(){var t
const{shouldShowWarning:n,samples:a}=(0,oq.CC)({samples:e.selectedOutputContainers}),s=null!==(t=null==a?void 0:a.map((({id:e})=>e)))&&void 0!==t?t:[],r={...e.outputSampleStatusState,shouldShowStatusWarnings:n,samples:null!=a?a:null,...null==e.confirmedOutputContainerIds&&{selectedSampleIds:s}},o={outputSampleStatusState:r,...n&&null==e.confirmedOutputContainerIds&&{confirmedOutputContainerIds:s}}
Is()(r,e.outputSampleStatusState)||i({...o})}()}));(0,d.useEffect)((()=>{var t,n;(0,MB._6)(getInputTagSchemaId(e.createAndRegisterBioentityArgs,e.inputBioentity,e.inputType),e.inputType===XB.wD.EXISTING_CONTAINER&&null!==(n=null===(t=e.inputContainer)||void 0===t?void 0:t.id)&&void 0!==n?n:null,getConfirmedOutputContainers(e.outputCells,e.outputContainerSummaries,e.confirmedOutputContainerIds,e.outputType)).then((e=>{i({showNameTemplateBanner:e})}))}),[e.createAndRegisterBioentityArgs,e.inputBioentity,e.inputContainer,e.inputType,e.outputCells,e.outputContainerSummaries,e.confirmedOutputContainerIds,e.outputType,i])
const s=n.shouldShowOutputWarnings&&e.outputSampleStatusState.shouldShowStatusWarnings&&null!=e.outputSampleStatusState.samples&&d.createElement(oq.F,{sampleIds:e.selectedOutputContainers.map((({id:e})=>e)),selectedSampleIds:e.outputSampleStatusState.selectedSampleIds,setSelectedSampleIds:e=>{a({selectedSampleIds:e},"outputSampleStatusState")
i({confirmedOutputContainerIds:e})},shouldProceed:e.outputSampleStatusState.canProceedOnSampleStatus,setShouldProceed:e=>{a({canProceedOnSampleStatus:e},"outputSampleStatusState")},trackingParams:n,samples:e.outputSampleStatusState.samples})
function handleChangeInputType(e){i({inputType:e.target.value})}const{createAndRegisterBioentityArgs:r,inputBioentity:o,inputContainer:l,inputType:c,inputSampleStatusState:u,showNameTemplateBanner:m}=e,p=XB.a2.includes(c),h=XB.tV.includes(c),E=getIncompatibleUnitsOutputContainers(e),f=d.createElement("div",null,d.createElement("div",null,d.createElement(Fr.Z,{label:"Source"}),d.createElement("div",null,d.createElement(Je.Z,{className:"radio-inline radio-inline--labelAligned u-spacing-right"},d.createElement("input",{checked:p,name:"chooseInputPane-inputType",onChange:handleChangeInputType,type:"radio",value:XB.a2[0]}),(0,oB.Z)()?"Add an entity or batch":"Add an entity"),d.createElement(Je.Z,{className:"radio-inline radio-inline--labelAligned"},d.createElement("input",{checked:h,name:"chooseInputPane-inputType",onChange:handleChangeInputType,type:"radio",value:XB.tV[0]}),"Transfer from existing container"))),d.createElement("div",{className:"u-spacing-top"},p?d.createElement(cq,{createAndRegisterBioentityArgs:r,inputBioentity:o,inputType:c,onUpdateModalState:i}):d.createElement(uq,{container:l,registryId:t,inputSampleStatusState:u,sampleStatusWarningTrackingParams:n,onUpdateSampleStatusState:a,onUpdateModalState:i})),null!=l&&E.length>0&&d.createElement(ChooseInputContainerValidationError,{selectedInputContainer:l,incompatibleUnitsOutputContainers:E}),m&&d.createElement("div",{className:(0,g.iv)(mq.infoBanner)},d.createElement(lq.Z,{itemDescription:"container",isPlural:getConfirmedOutputContainers(e.outputCells,e.outputContainerSummaries,e.confirmedOutputContainerIds,e.outputType).length>1})))
return d.createElement(d.Fragment,null,s,(0,oq.RO)(e.outputSampleStatusState.selectedSampleIds,n.shouldShowOutputWarnings&&e.outputSampleStatusState.shouldShowStatusWarnings,e.outputSampleStatusState.canProceedOnSampleStatus)&&f)}
var hq=n(730981)
function ContainerTable({containers:e}){return d.createElement(rc.iA,{className:"u-small-spacing-top",numRows:e.length},d.createElement(rc.sg,{header:"Barcode",renderCell:t=>e[t].barcode}),d.createElement(rc.sg,{header:"Name",renderCell:t=>e[t].name}),d.createElement(rc.sg,{header:"Schema",renderCell:t=>e[t].storableSchema.name}))}class ChooseOutputContainers extends d.Component{constructor(){super(...arguments)
this.handleContainersChange=e=>{const t=this.updateOutputSampleStatusWarnings(e)
this.props.onUpdateModalState({...t,outputContainerSummaries:e})}
this.updateOutputSampleStatusWarnings=e=>{var t
const{shouldShowWarning:n,samples:a}=(0,oq.CC)({samples:e}),i=null!==(t=null==a?void 0:a.map((({id:e})=>e)))&&void 0!==t?t:[]
return{outputSampleStatusState:{...this.props.outputSampleStatusState,shouldShowStatusWarnings:n,canProceedOnSampleStatus:!1,selectedSampleIds:i,samples:null!=a?a:null,warningInputOutputType:st.CONTAINER},confirmedOutputContainerIds:n?i:null}}
this.setCanProceedOnSampleStatus=e=>{this.props.onUpdateSampleStatusState({canProceedOnSampleStatus:e},"outputSampleStatusState")}
this.setSelectedSampleIds=e=>{this.props.onUpdateSampleStatusState({selectedSampleIds:e},"outputSampleStatusState")
this.props.onUpdateModalState({confirmedOutputContainerIds:e})}}componentDidMount(){if(this.props.containers.length>0&&this.props.outputSampleStatusState.warningInputOutputType===st.PLATE){const e=this.updateOutputSampleStatusWarnings(this.props.containers)
this.props.onUpdateModalState(e)}}renderWarningOrContainerTable(){return this.props.outputSampleStatusState.shouldShowStatusWarnings&&this.props.outputSampleStatusState.warningInputOutputType===st.CONTAINER&&null!=this.props.outputSampleStatusState.samples?d.createElement(d.Fragment,null,d.createElement("br",null),d.createElement(oq.F,{sampleIds:this.props.containers.map((({id:e})=>e)),selectedSampleIds:this.props.outputSampleStatusState.selectedSampleIds,setSelectedSampleIds:this.setSelectedSampleIds,shouldProceed:this.props.outputSampleStatusState.canProceedOnSampleStatus,setShouldProceed:this.setCanProceedOnSampleStatus,trackingParams:this.props.sampleStatusWarningTrackingParams,samples:this.props.outputSampleStatusState.samples})):d.createElement(ContainerTable,{containers:this.props.containers})}render(){return d.createElement("div",null,d.createElement(wA.Z,{onChange:this.handleContainersChange,registryId:this.props.registryId,selectedStorables:this.props.containers,shouldAllowMultiple:!0,hideSelectedResults:!0,storableTypes:[st.CONTAINER]}),this.props.containers.length>0&&d.createElement(d.Fragment,null,this.renderWarningOrContainerTable()))}}const gq=ChooseOutputContainers
var Eq=n(847307),fq=n(530271)
class ChooseOutputPlate extends d.Component{constructor(){super(...arguments)
this.handlePlateChange=e=>{const t=e.length?e[0]:null
this.props.onUpdateModalState({outputPlate:t,outputCells:[]})
this.props.onUpdateSampleStatusState({shouldShowStatusWarnings:!1},"outputSampleStatusState")}
this.handleSelectCells=e=>{this.props.onUpdateModalState({outputCells:e})
this.updateOutputSampleStatusWarnings(e)}
this.updateOutputSampleStatusWarnings=e=>{var t
const n=e.map((({container:e})=>e)),a=this.props.outputSampleStatusState.selectedSampleIds,i=n.map((({id:e})=>e))
if(i.length>0&&Is()(a,i)&&this.props.outputSampleStatusState.warningInputOutputType===st.PLATE)return
const{shouldShowWarning:s,samples:r}=(0,oq.CC)({samples:n})
this.props.onUpdateSampleStatusState({shouldShowStatusWarnings:s,canProceedOnSampleStatus:!1,selectedSampleIds:null!==(t=null==r?void 0:r.map((({id:e})=>e)))&&void 0!==t?t:[],samples:null!=r?r:null,warningInputOutputType:st.PLATE},"outputSampleStatusState")}
this.setCanProceedOnSampleStatus=e=>{this.props.onUpdateSampleStatusState({canProceedOnSampleStatus:e},"outputSampleStatusState")}}renderPossibleWarning(){return this.props.outputSampleStatusState.shouldShowStatusWarnings&&this.props.outputSampleStatusState.warningInputOutputType===st.PLATE&&null!=this.props.outputSampleStatusState.samples?d.createElement(d.Fragment,null,d.createElement("br",null),d.createElement(dq.Z,{shouldProceed:this.props.outputSampleStatusState.canProceedOnSampleStatus,canDeselectSamples:!1,onChangeShouldProceed:this.setCanProceedOnSampleStatus,samples:this.props.outputSampleStatusState.samples,setSelectedSampleIds:Jt.ZT,selectedSampleIds:this.props.outputSampleStatusState.selectedSampleIds,trackingParamsWithSampleIds:{...this.props.sampleStatusWarningTrackingParams,sampleIds:this.props.selectedCells.map((({container:e})=>e.id))}})):null}render(){return d.createElement("div",null,d.createElement(wA.Z,{onChange:this.handlePlateChange,registryId:this.props.registryId,selectedStorables:this.props.plate?[this.props.plate]:[],storableTypes:[st.BOX,st.PLATE]}),this.props.plate&&d.createElement(d.Fragment,null,this.renderPossibleWarning(),d.createElement(fq.Z,{checkCell:(e,t)=>!(0,Eq.t1)(e,t),gridId:this.props.plate.id,invalidCellMessage:"Please select a non-empty position.",onSelectCells:this.handleSelectCells,selectedCells:this.props.selectedCells})))}}const Sq=ChooseOutputPlate
function ChooseOutputPane_getIncompatibleUnitsOutputContainers({outputType:e,selectedInputContainer:t,outputContainerSummaries:n,outputCells:a}){const i=e===st.CONTAINER?n:a.map((e=>e.container))
return null==t?[]:i.filter((e=>!(0,kB.V7)([t.quantity.units,e.quantity.units])))}function ChooseOutputValidationError({selectedInputContainer:e,incompatibleUnitsOutputContainers:t}){return d.createElement("div",{className:"legacy-font-proxima-13"},d.createElement("p",{className:"u-danger-color"},`Cannot transfer from ${(0,JF.yQ)(e)} into the selected ${(0,de._6)(t.length,"container")} because their units are incompatible: ${t.map((e=>(0,JF.yQ)(e))).join(", ")}`))}const yq=g.mM.create({infoBanner:{marginTop:15}}),bq=function ChooseOutputPane({paneState:e,registryId:t,sampleStatusWarningParams:n,onUpdateSampleStatusState:a,onUpdateModalState:i}){const s=null!=e.selectedInputContainer&&n.shouldShowInputWarnings;(0,Ul.Z)((()=>{s&&function checkForInputWarnings(){var t
const{shouldShowWarning:n,samples:i}=(0,oq.CC)({samples:[e.selectedInputContainer]}),s={...e.inputSampleStatusState,shouldShowStatusWarnings:n,samples:null!=i?i:null,selectedSampleIds:null!==(t=null==i?void 0:i.map((({id:e})=>e)))&&void 0!==t?t:[]}
Is()(s,e.inputSampleStatusState)||a(s,"inputSampleStatusState")}()}));(0,d.useEffect)((()=>{var t,n;(0,MB._6)(getInputTagSchemaId(e.createAndRegisterBioentityArgs,e.inputBioentity,e.inputType),e.inputType===XB.wD.EXISTING_CONTAINER&&null!==(n=null===(t=e.inputContainer)||void 0===t?void 0:t.id)&&void 0!==n?n:null,getConfirmedOutputContainers(e.outputCells,e.outputContainerSummaries,e.confirmedOutputContainerIds,e.outputType)).then((e=>{i({showNameTemplateBanner:e})}))}),[e.createAndRegisterBioentityArgs,e.inputBioentity,e.inputContainer,e.inputType,e.outputCells,e.outputContainerSummaries,e.confirmedOutputContainerIds,e.outputType,i])
const r=s&&e.inputSampleStatusState.shouldShowStatusWarnings&&null!=e.inputSampleStatusState.samples&&d.createElement("div",{className:"u-small-spacing-top"},d.createElement(oq.F,{sampleIds:[e.selectedInputContainer.id],selectedSampleIds:e.inputSampleStatusState.selectedSampleIds,setSelectedSampleIds:e=>{a({selectedSampleIds:e},"inputSampleStatusState")},shouldProceed:e.inputSampleStatusState.canProceedOnSampleStatus,setShouldProceed:e=>{a({canProceedOnSampleStatus:e},"inputSampleStatusState")},trackingParams:n,samples:e.inputSampleStatusState.samples})),_handleChangeOutputType=e=>{i({outputType:e.target.value})},{selectedInputContainer:o}=e,l=ChooseOutputPane_getIncompatibleUnitsOutputContainers(e),c=d.createElement("div",null,d.createElement("div",null,d.createElement(Fr.Z,{label:"Destination"}),d.createElement("div",null,d.createElement("input",{checked:e.outputType===st.CONTAINER,onChange:_handleChangeOutputType,type:"radio",value:st.CONTAINER}),d.createElement("span",{className:"u-tiny-spacing-left u-spacing-right"},"Container"),d.createElement("input",{checked:e.outputType===st.PLATE,onChange:_handleChangeOutputType,type:"radio",value:st.PLATE}),d.createElement("span",{className:"u-tiny-spacing-left"},"Plate / Box"))),d.createElement("div",{className:"u-small-spacing-top"},e.outputType===st.CONTAINER?d.createElement(gq,{containers:e.outputContainerSummaries,registryId:t,sampleStatusWarningTrackingParams:n,outputSampleStatusState:e.outputSampleStatusState,onUpdateSampleStatusState:a,onUpdateModalState:i}):d.createElement(Sq,{plate:e.outputPlate,registryId:t,selectedCells:e.outputCells,sampleStatusWarningTrackingParams:n,outputSampleStatusState:e.outputSampleStatusState,onUpdateSampleStatusState:a,onUpdateModalState:i})),null!=o&&l.length>0&&d.createElement(ChooseOutputValidationError,{selectedInputContainer:o,incompatibleUnitsOutputContainers:l}),e.showNameTemplateBanner&&d.createElement("div",{className:(0,g.iv)(yq.infoBanner)},d.createElement(lq.Z,{itemDescription:"container",isPlural:getConfirmedOutputContainers(e.outputCells,e.outputContainerSummaries,e.confirmedOutputContainerIds,e.outputType).length>1}))),u=function willImplicitlyModifyDestinationSampleRoles({outputType:e,selectedInputContainer:t,outputContainerSummaries:n,outputCells:a,outputPlate:i}){if(!(0,$B.Eq)(zB.F.V1)||(0,$B.Eq)(zB.F.V3))return!1
if(e===st.PLATE&&(null==i||(null==i?void 0:i.storableSchema.plateSchemaType)===hq.Ch.FIXED_PLATE))return!1
const s=e===st.CONTAINER?n:a.map((e=>e.container))
return MB.Un(t,s)}(e)&&d.createElement("div",{className:"u-small-spacing-top"},d.createElement(SE.Z,{key:"sample-control"},`Any sample owners and ${(0,GB.EX)()} of the source container will be added to those of the destination containers.`))
return d.createElement(d.Fragment,null,s&&renderPossibleInputContainerContentsError({inputContainer:e.selectedInputContainer}),r,(0,oq.RO)(e.inputSampleStatusState.selectedSampleIds,n.shouldShowInputWarnings&&e.inputSampleStatusState.shouldShowStatusWarnings,e.inputSampleStatusState.canProceedOnSampleStatus)&&c,u)}
class ContainerContentConcentrationForm extends d.Component{constructor(){super(...arguments)
this._handleValueChange=e=>{const{containerId:t,containedItemId:n}=this.props
this.props.onChange(t,n,{value:e.target.numericValue})}
this._handleUnitsChange=({val:e})=>{const{containerId:t,containedItemId:n}=this.props
this.props.onChange(t,n,{units:e})}}shouldComponentUpdate(e){return!Is()(this.props,e)}render(){return d.createElement(h.Z,{key:this.props.containedItemId},d.createElement("label",{className:"transferModal-tableForm"},d.createElement(p.Z,{xs:6},this.props.containedItemName),d.createElement(p.Z,{xs:6},d.createElement(FB.Z,{measurement:this.props.concentration,onChangeUnits:this._handleUnitsChange,onChangeValue:this._handleValueChange,validUnits:kB.fO}))))}}const Tq=ContainerContentConcentrationForm,vq=xa.Ps`
  query ContainerBioentitiesQuery($bioentityIds: [StrictString]!) @skipAudit @engComponent(name: INVENTORY) {
    bioentities(ids: $bioentityIds) {
      ...BioentitySummaryOrInaccessibleGraphQL
    }
  }
  ${(0,La.f)("BioentitySummaryOrInaccessible").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function _getShouldCalculateConcentrations(e,t){return!t&&e}const Cq={confirmConcentrationsData:null,shouldCalculateConcentrations:!0,areSolidUnitsInvolved:!1}
class ConfirmConcentrationsPane extends d.Component{constructor(){super(...arguments)
this._handleChangeShouldCalculate=e=>{const{value:t}=e.target;(0,S.hu)(["true","false"].includes(t),"Expected true or false")
const n="true"===t;(0,S.hu)(null!=this.props.onChangeShouldCalculate,"Expected handler for should calc concentrations")
this.props.onChangeShouldCalculate(n)}
this._handleRecalculate=()=>{(0,S.hu)(null!=this.props.getConfirmConcentrationArgsAndCallbacks,"Expected function to get confirm concentration args")
const{shouldCalculateConcentrations:e,areSolidUnitsInvolved:t}=this.props.paneState
TransferActions_calculateConcentrations({...this.props.getConfirmConcentrationArgsAndCallbacks(),shouldCalculateConcentrations:_getShouldCalculateConcentrations(e,t)})}}_getContainedItem(e){const{bioentitySummariesById:t}=this.props
return t[e]}render(){const{confirmConcentrationsData:e,errorMessage:t,areSolidUnitsInvolved:n,shouldCalculateConcentrations:a}=this.props.paneState
return d.createElement("div",null,(()=>t?d.createElement("div",null,d.createElement(so.Dx,null,"Errors:"),d.createElement("div",{className:"u-danger-color"},t)):e?e.length?d.createElement("div",null,d.createElement(so.Dx,null,"Final Concentrations"),d.createElement(h.Z,{className:"transferModal-tableHeader"},d.createElement(p.Z,{xs:2},"Destination"),d.createElement(p.Z,{xs:5},"Name"),d.createElement(p.Z,{xs:5},"Concentration")),d.createElement("div",{className:"transferModal-tableRows"},e.map(((e,t)=>d.createElement(h.Z,{className:"transferModal-tableRow",key:t},d.createElement(p.Z,{xs:2},e.label),d.createElement(p.Z,{xs:10},e.containerContents.map((e=>d.createElement(Tq,{containedItemId:e.containedItemId,containedItemName:this._getContainedItem(e.containedItemId).name,concentration:e.concentration,containerId:e.containerId,key:`${e.containerId}/${e.containedItemId}`,onChange:this.props.onChangeConcentration})))))))),this.props.allowRecalculateConcentrations&&d.createElement("div",null,d.createElement(so.Dx,null,"Recalculate Concentrations"),d.createElement("div",{className:"u-flex-display"},d.createElement("select",{onChange:this._handleChangeShouldCalculate,value:_getShouldCalculateConcentrations(a,n).toString()},!n&&d.createElement("option",{value:"true"},"Calculate based on total ",(0,HB.Z)(!1,!1)),d.createElement("option",{value:"false"},"Do not change original concentrations")),d.createElement("span",{className:"u-small-spacing-left u-tiny-spacing-top u-pointer",onClick:this._handleRecalculate},d.createElement(pe.Z,{icon:"refresh"}))))):"No transfers will be performed.":d.createElement("div",{className:"u-justify-content-center"},d.createElement(kl.Z,null)))())}}ConfirmConcentrationsPane.propTypes={bioentitySummariesById:J().objectOf(J().any.isRequired).isRequired,paneState:J().shape({confirmConcentrationsData:J().arrayOf(J().shape({label:J().string.isRequired,containerContents:J().arrayOf(J().shape({containedItemId:J().string.isRequired,concentration:kB.U5,containerId:J().string.isRequired})).isRequired})),errorMessage:J().string,shouldCalculateConcentrations:J().bool.isRequired}).isRequired}
function QueryingConfirmConcentrationsPane(e){let t=[]
if(e.paneState.confirmConcentrationsData){t=l.default.uniq(e.paneState.confirmConcentrationsData.map((e=>e.containerContents.map((({containedItemId:e})=>e)))).flat()).filter((e=>ea.ZP.isBiologicalEntity(e)))}return d.createElement(Da.ZP,{query:vq,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,variables:{bioentityIds:t}},(t=>d.createElement(ConfirmConcentrationsPane,{...e,bioentitySummariesById:(0,Jt.m8)(t.bioentities.map((e=>[e.id,(0,zo.tY)("BioentitySummary",e)])))})))}var Iq=n(105778),wq=n(338819)
function BulkSetQuantityUnitsDropdown(e){const[t,n]=(0,d.useState)(kB.re)
return d.createElement(Iq.Z,{isDisabled:!1,onSetAll:()=>{e.onSetUnits(t)}},d.createElement(wq.Z,{allowNullUnits:e.allowNullUnits,onChange:n,value:t,allowedUnits:e.allowedUnits}))}function BulkSetValuesDropdown(e){const[t,n]=(0,d.useState)(null),[a,i]=(0,d.useState)(!0)
return d.createElement(Iq.Z,{isDisabled:!a,onSetAll:()=>{e.onSetValue(t)}},d.createElement(AT.Z,{focusOnMount:!0,onChange:e=>{n(e.target.numericValue)
i(e.target.isValid)},value:t}))}var Nq=n(569231)
const Aq=function ConfirmTransferQuantityRow(e){var t,n,a,i
const s=MB.dh(e.outputContainer.quantity.value,e.transferQuantityValue),r=e.outputContainer.quantity.units
return d.createElement(h.Z,{className:"transferModal-tableRow"},d.createElement(p.Z,{xs:2,className:"u-word-break-word"},e.outputContainer.barcode),d.createElement(p.Z,{xs:2},e.outputContainer.name),d.createElement(p.Z,{xs:2},d.createElement(Nq.f,{value:e.outputContainer.quantity.value}),null!=e.outputContainer.quantity.value&&d.createElement("span",null," ",r)),d.createElement(p.Z,{xs:2},d.createElement("input",{min:0,name:"transfer-quantity",onChange:function _handleUpdateTransferQuantity(t){e.onUpdate(e.index,{transferQuantityValue:(0,Jt.p3)(t.target.value)})},step:"any",type:"number",value:null==e.transferQuantityValue?"":e.transferQuantityValue})),d.createElement(p.Z,{xs:2},e.isInputTypeContainer?d.createElement("input",{min:(null!==(t=e.transferQuantityValue)&&void 0!==t?t:0)+(null!==(n=e.outputContainer.quantity.value)&&void 0!==n?n:0),name:"final-quantity",onChange:function _handleUpdateFinalQuantity(t){e.onUpdate(e.index,{finalOutputQuantityValue:(0,Jt.p3)(t.target.value)})},required:Boolean(e.outputContainer.quantity.value),step:"any",type:"number",value:null==e.finalOutputQuantityValue?"":e.finalOutputQuantityValue}):d.createElement(Nq.f,{value:s})),d.createElement(p.Z,{xs:2},d.createElement(wq.Z,{allowNullUnits:(0,Jt.fo)(e.outputContainer.quantity.value),onChange:function _handleUpdateUnits(t){e.onUpdate(e.index,{outputContainer:{...e.outputContainer,volume:MB.OE(e.outputContainer.quantity,t),quantity:MB.OE(e.outputContainer.quantity,t)}})},value:r,allowedUnits:(0,kB.td)(null!==(i=null===(a=e.initialOutputContainerState)||void 0===a?void 0:a.quantity.units)&&void 0!==i?i:null)})))}
class InputContainableConcentrationForm extends d.Component{constructor(){super(...arguments)
this._handleChangeValue=e=>{const t=Q()(this.props.inputContainableConcentration,{value:{$set:e.target.numericValue}})
this.props.onUpdateModalState({inputContainableConcentration:t})}
this._handleChangeUnits=({val:e})=>{const t=Q()(this.props.inputContainableConcentration,{units:{$set:e}})
this.props.onUpdateModalState({inputContainableConcentration:t})}}render(){return d.createElement("div",{className:"u-flex-display"},d.createElement("span",{className:"inputContainableConcentrationForm-text"},`Concentration at which to transfer ${this.props.inputContainable.name}: `),d.createElement(FB.Z,{measurement:this.props.inputContainableConcentration,onChangeUnits:this._handleChangeUnits,onChangeValue:this._handleChangeValue,validUnits:kB.fO}))}}const Rq=InputContainableConcentrationForm
function InputContainerQuantityChange({inputContainer:e,confirmTransferQuantitiesData:t}){if(null==e.quantity.value)return d.createElement("div",{className:"legacy-font-proxima-13"},"Source container has untracked ",(0,HB.Z)(!1,!1),".")
if(t.every((e=>null==e.outputContainer.quantity.units)))return d.createElement("div",{className:"legacy-font-proxima-13"},"No transfer ",(0,HB.Z)(!1,!0)," are specified.")
const n=!(0,kB.V7)([e.quantity.units,...t.map((e=>e.outputContainer.quantity.units))]),{remainingSourceQuantity:a,totalTransferQuantity:i,isValid:s,quantityErrorsAreBlocking:r}=(0,MB.lV)(e,t)
return d.createElement("div",{className:"legacy-font-proxima-13"},d.createElement("span",{className:"inputContainerQuantityChange-text"},`Total ${(0,HB.Z)(!1,!1)} to be removed from ${e.barcode}: ${n?"N/A":(0,MB.wD)(i)} `),d.createElement("span",{className:f()("inputContainerQuantityChange-subtext",{"inputContainerQuantityChange-subtext--warning":!s})},`(${(0,MB.wD)(a)} remaining)`),!s&&d.createElement("div",{className:"u-small-spacing-top"},d.createElement(io.ZP,{bannerType:r?io.ct.ERROR:io.ct.WARNING,text:(0,MB.x8)(e,r)})))}function getIncompatibleUnitsRowInfos({selectedInputContainer:e,confirmTransferQuantitiesData:t,initialOutputContainerStateById:n}){if(null==t)return[]
return t.map(((t,a)=>{var i
const s=null!==(i=null==e?void 0:e.quantity.units)&&void 0!==i?i:null,r=t.outputContainer.quantity.units,o=n[t.outputContainer.id];(0,S.hu)(null!=o,`Cannot find original output container state for ${t.outputContainer.barcode}`)
const l=o.quantity.units
return(0,kB.V7)([s,r,l])?null:{rowIndex:a,inputContainer:e,initialOutputContainerState:o,transferQuantity:{value:t.transferQuantityValue,units:r}}})).flatMap((e=>null!=e?[e]:[]))}function ConfirmTransferQuantitiesIncompatibleUnitsError({incompatibleUnitRowInfos:e}){const t=e.map((({rowIndex:e,inputContainer:t,transferQuantity:n,initialOutputContainerState:a})=>{var i
return`${`Row ${e+1} has incompatible units: Cannot transfer `}${null!=n.units?`${null!==(i=n.value)&&void 0!==i?i:0} ${n.units} `:""}${t?`from ${(0,JF.yQ)(t)} `:""}${`into ${(0,JF.yQ)(a)}`}`}))
return d.createElement("div",{className:`legacy-font-proxima-13 ${(0,g.iv)(Oq.errorMessage)}`},d.createElement("p",{className:"u-danger-color"},t.filter((e=>null!=e)).join("\n")))}const Pq=function ConfirmTransferQuantitiesPane(e){const{confirmTransferQuantitiesData:t,inputContainable:n,inputContainableConcentration:a,selectedInputContainer:i,errorMessage:s,initialOutputContainerStateById:r}=e.paneState
if(!t)return d.createElement("div",{className:"u-spacing-top text-center"},d.createElement(kl.Z,null))
function _handleUpdateAll(n){const a=t.map((e=>n(e)))
e.onUpdateModalState({confirmTransferQuantitiesData:a})}const o=(0,kB.U3)(t.map((({outputContainer:e})=>{var t
return null===(t=r[e.id])||void 0===t?void 0:t.quantity.units}))),l=getIncompatibleUnitsRowInfos(e.paneState)
return d.createElement("div",null,d.createElement(so.Dx,null,"Transfer ",(0,HB.Z)(!0,!0)),d.createElement("br",null),d.createElement(h.Z,{className:"transferModal-tableHeader"},d.createElement(p.Z,{xs:2},"Destination Barcode"),d.createElement(p.Z,{xs:2},"Destination Name"),d.createElement(p.Z,{xs:2},`Initial destination ${(0,HB.Z)(!1,!1)}`),d.createElement(p.Z,{xs:2},d.createElement(d.Fragment,null,`${(0,HB.Z)(!0,!1)} from source`),d.createElement(BulkSetValuesDropdown,{onSetValue:e=>{!function _handleUpdateAllTransferQuantities(e){_handleUpdateAll((t=>({...t,transferQuantityValue:e})))}(e)}})),d.createElement(p.Z,{xs:2},d.createElement(d.Fragment,null,`Final destination ${(0,HB.Z)(!1,!1)}`),!n&&d.createElement(BulkSetValuesDropdown,{onSetValue:e=>{!function _handleUpdateAllFinalQuantities(e){_handleUpdateAll((t=>({...t,finalOutputQuantityValue:e})))}(e)}})),d.createElement(p.Z,{xs:2},d.createElement(d.Fragment,null,"Transfer units"),o.length>0&&d.createElement(BulkSetQuantityUnitsDropdown,{onSetUnits:e=>{!function _handleUpdateAllQuantityUnits(e){_handleUpdateAll((t=>Q()(t,{outputContainer:{volume:{$merge:MB.OE(t.outputContainer.quantity,e)},quantity:{$merge:MB.OE(t.outputContainer.quantity,e)}}})))}(e)},allowNullUnits:t.every((({outputContainer:e})=>(0,Jt.fo)(e.quantity.value))),allowedUnits:o}))),d.createElement("div",{className:"transferModal-tableRows"},t.map(((n,a)=>d.createElement(Aq,{key:a,isInputTypeContainer:Boolean(i),finalOutputQuantityValue:n.finalOutputQuantityValue,index:a,onUpdate:(n,a)=>{!function _handleUpdate(n,a){const i=Q()(t,{[n]:{$merge:a}})
e.onUpdateModalState({confirmTransferQuantitiesData:i})}(n,a)},outputContainer:n.outputContainer,initialOutputContainerState:r[n.outputContainer.id],transferQuantityValue:n.transferQuantityValue})))),n&&a&&d.createElement(Rq,{inputContainable:n,inputContainableConcentration:a,onUpdateModalState:e.onUpdateModalState}),i&&d.createElement(InputContainerQuantityChange,{confirmTransferQuantitiesData:t,inputContainer:i}),s&&d.createElement("div",{className:`legacy-font-proxima-13 ${(0,g.iv)(Oq.errorMessage)}`},d.createElement("p",{className:"u-danger-color"},`Error when attempting transfer: ${s}`)),l.length>0&&d.createElement(ConfirmTransferQuantitiesIncompatibleUnitsError,{incompatibleUnitRowInfos:l}))},Oq=g.mM.create({errorMessage:{paddingTop:"4px",whiteSpace:"pre-line"}}),{CHOOSE_TRANSFER_INPUT:xq,CHOOSE_TRANSFER_OUTPUT:_q,CONFIRM_TRANSFER_QUANTITIES:Dq,CONFIRM_CONCENTRATIONS:Lq}=YZ.f8
function getPaneOrderByFlow(e){const t=(0,$B.Eq)(zB.F.V3)?[YZ.RJ.CONFIRM_SAMPLE_CONTROLS]:[]
switch(e){case YZ.h0.TRANSFER_OUT:return[YZ.RJ.CHOOSE_TRANSFER_OUTPUT,YZ.RJ.CONFIRM_TRANSFER_QUANTITIES,YZ.RJ.CONFIRM_CONCENTRATIONS,...t]
case YZ.h0.TRANSFER_IN:return[YZ.RJ.CHOOSE_TRANSFER_INPUT,YZ.RJ.CONFIRM_TRANSFER_QUANTITIES,YZ.RJ.CONFIRM_CONCENTRATIONS,...t]
case YZ.h0.TRANSFER_GLOBAL:return[YZ.RJ.CHOOSE_TRANSFER_INPUT,YZ.RJ.CHOOSE_TRANSFER_OUTPUT,YZ.RJ.CONFIRM_TRANSFER_QUANTITIES,YZ.RJ.CONFIRM_CONCENTRATIONS,...t]
default:(0,S.hu)(!1,"Unexpected transfer flow")
return[]}}function skipConcentrationPane(e){var t
const n=null!==(t=null==e?void 0:e.confirmTransferQuantitiesData)&&void 0!==t?t:null,a=null==n?void 0:n.map((e=>e.outputContainer))
return null!=a&&a.every((e=>!e.quantity.value&&!e.contents.length))}function shouldSkipSampleControlsPane(e){var t
const n=null!==(t=null==e?void 0:e.confirmTransferQuantitiesData)&&void 0!==t?t:null,a=null==n?void 0:n.map((e=>e.outputContainer))
return null!=a&&a.every((e=>!supportsValidRestrictionStatus(e)))}function getPrevPane(e,t,n){const a=e?getPaneOrderByFlow(t).indexOf(e):-1,i=getPaneOrderByFlow(t)[a-1]
if(i===Lq&&skipConcentrationPane(n))return getPaneOrderByFlow(t)[a-2]
if(i===YZ.RJ.CONFIRM_SAMPLE_CONTROLS&&shouldSkipSampleControlsPane(n)){const e=skipConcentrationPane(n)?3:2
return getPaneOrderByFlow(t)[a-e]}return i}function getNextPane(e,t,n){const a=e?getPaneOrderByFlow(t).indexOf(e):-1,i=getPaneOrderByFlow(t)[a+1]
if(i===Lq&&skipConcentrationPane(n)){const e=shouldSkipSampleControlsPane(n)?3:2
return getPaneOrderByFlow(t)[a+e]}return i===YZ.RJ.CONFIRM_SAMPLE_CONTROLS&&shouldSkipSampleControlsPane(n)?getPaneOrderByFlow(t)[a+2]:i}function closeTransferModal(){Xe.xv(TransferModal)}class TransferModal extends d.Component{constructor(e){var t
super(e)
this.handleClose=()=>{this.props.onRequestClose()}
this.handleGoToPrevPane=()=>{const e=getPrevPane(this.state.pane,this.props.flow,this.state)
this.handleUpdateState({pane:e,errorMessage:null})}
this.baseSampleStatusTrackingParams={actionAttempted:"transfer",actionOrigin:this.props.actionOrigin,eventGroupId:m.Vr()}
this.handleUpdateSampleStatusState=(e,t)=>{this.setState((n=>({[t]:{...n[t],...e}})))}
this.handleUpdateState=e=>{Object.values(rq).forEach((({stateKey:t,preferenceKey:n})=>{void 0!==e[t]&&We.Z.set(n,e[t])}))
this.setState((t=>{var n
const a={...t,...e,inputType:eq.o9({...t,...e})},i=null!==(n=a.pane&&getTransferPaneState(a.pane,a))&&void 0!==n?n:{}
return{...a,...i}}))}
this.handleGoToNextPane=()=>{const e=getNextPane(this.state.pane,this.props.flow,this.state),{outputContainerSummaries:t,outputSampleStatusState:n,confirmedOutputContainerIds:a}=this.state,goToNextPaneFn=()=>{if(e===YZ.f8.CONFIRM_TRANSFER_QUANTITIES)if(t&&t.length){this.handleUpdateState({confirmTransferQuantitiesData:null})
const e=t.map((e=>e.id)),i=new Set(a)
!function bulkFetchContainers(e,t,n){iq.dD(e).done((({containers:e})=>{const a=initialConfirmTransferQuantitiesData({...t,outputContainers:e})
n({outputContainers:e,confirmTransferQuantitiesData:a})})).fail(v.ZP.notifyError)}(null!=a&&n.warningInputOutputType!==st.PLATE?e.filter((e=>i.has(e))):e,this.state,this.handleUpdateState)}else this.handleUpdateState({confirmTransferQuantitiesData:initialConfirmTransferQuantitiesData(this.state)})
e===YZ.f8.CONFIRM_CONCENTRATIONS&&TransferActions_calculateConcentrations({...getConfirmConcentrationsArgs(this.state),onStart:this.handleCalculateConcentrationsStarted,onComplete:this.handleCalculateConcentrationsCompleted,onFailure:this.handleCalculateConcentrationsFailed})
null!=e&&this.handleUpdateState({pane:e})}
this.state.pane===YZ.f8.CHOOSE_TRANSFER_INPUT?async function completeTransferInputPane(e,t,n){try{n(await eq.rK(e))
t()}catch(e){if(!(e instanceof eq.y7))throw e}}(this.state,goToNextPaneFn,this.handleUpdateState):goToNextPaneFn()}
this.shouldBlockForIncompatibleUnits=()=>{const e=getPaneOrderByFlow(this.props.flow).indexOf(this.state.pane)
switch(this.state.pane){case xq:return getPaneOrderByFlow(this.props.flow)[e+1]!==_q&&getIncompatibleUnitsOutputContainers(this.state).length>0
case _q:return ChooseOutputPane_getIncompatibleUnitsOutputContainers(this.state).length>0
case Dq:return getIncompatibleUnitsRowInfos(this.state).length>0
default:return!1}}
this.getButtons=()=>{const e=getPrevPane(this.state.pane,this.props.flow,this.state),t=getNextPane(this.state.pane,this.props.flow,this.state),n=e&&{onClick:this.handleGoToPrevPane,key:`back-${e}`,pullLeft:!0,style:C.ZJ.TERTIARY_GRAY,text:"Back"},a=t?{disabled:!isPaneComplete(this.state.pane,this.state)||this.uncontainableEntityChosen()||!(0,oB.Z)()&&this.wantsBatches()||this.shouldBlockForIncompatibleUnits(),onClick:this.handleGoToNextPane,key:`next-${t}`,style:C.ZJ.PRIMARY,text:this.state.pane===YZ.f8.CHOOSE_TRANSFER_INPUT?eq.Mu(this.state):"Next",dataTestAttrs:{component:"TransferModal",key:vb.Z.NEXT}}:{disabled:this.state.isTransferring||!isPaneComplete(this.state.pane,this.state)||this.shouldBlockForIncompatibleUnits(),style:C.ZJ.PRIMARY,submit:!0,text:this.state.isTransferring?"Transferring...":"Done",dataTestAttrs:{component:"TransferModal",key:vb.Z.DONE}}
return l.default.compact([n,a])}
this.getOutputSampleControlParams=()=>this.state.useInferredSampleControls||!(0,$B.Eq)(zB.F.V3)?{}:{restrictionStatus:this.state.restrictionStatus,sampleRoles:{sampleOwnerIds:this.state.sampleOwners.map((({id:e})=>e)),...this.state.restrictionStatus===VB.nY.RESTRICTED&&{restrictedSampleUserIds:this.state.restrictedSampleUsers.map((({id:e})=>e))}}}
this.calculateAndTransfer=()=>{ma.S8({analyticsMetadata:{actionOrigin:this.props.actionOrigin}},null,(async()=>{await async function calculateConcentrationsAndDoTransfersWithDataMods({containerTransfers:e,inputContainableConcentration:t,outputSampleControls:n,onStart:a=Jt.ZT,onFinish:i=Jt.ZT}){a()
const s=[...new Set(e.flatMap((({inputSampleId:e,outputContainer:t})=>null!=e&&ea.ZP.isContainer(e)?[e,t.id]:[t.id])))],r=(0,yA.P_)({apiIds:s,action:yA.wV.TRANSFER,containersMayBeWells:!0})
await calculateConcentrations(e,!0,t).then((async({containerContents:t})=>{await(0,fA.GE)({changeSummary:r,onRequestClose:()=>{i(!0)},onRequestSubmit:()=>{transferContainers(e,t,n).done((e=>{dispatchForTransferCompleted(e,(()=>{i(!1)}))})).fail((e=>{dispatchForTransferFailed(e,(e=>{i(!1,e)}))}))}},dt.ZP.INVENTORY_ENABLE_DATA_MOD_REASONS,{module:"SAMPLES",actionOrigin:"inventory_registry_search_ui",modifiedAction:yA.wV.TRANSFER,numModifiedTotalItems:s.length,entryId:null})})).catch((e=>{dispatchForCalculateConcentrationsFailed(e,(e=>{i(!1,e)}))}))}({...getConfirmConcentrationsArgs(this.state),outputSampleControls:this.getOutputSampleControlParams(),onStart:this.handleTransferStarted,onFinish:this.handleTransferFinished})}))}
this.transfer=()=>{const{containerTransfers:e,containerContents:t}=this.state;(0,S.hu)(null!=e,"containerTransfers should be defined");(0,S.hu)(null!=t,"containerContents should be defined")
ma.S8({analyticsMetadata:{actionOrigin:this.props.actionOrigin}},null,(async()=>{await doTransfersWithDataMods(e,t,this.getOutputSampleControlParams(),this.handleTransferStarted,(e=>{this.handleTransferFinished(!1,e)}))}))}
this.handleCalculateConcentrationsStarted=()=>{this.handleUpdateState({containerTransfers:null,containerContents:null})}
this.handleCalculateConcentrationsCompleted=e=>{this.handleUpdateState({...e,errorMessage:null})}
this.handleCalculateConcentrationsFailed=e=>{this.handleUpdateState({errorMessage:e,isTransferring:!1})}
this.handleTransferStarted=()=>{this.handleUpdateState({isTransferring:!0,transferCancelled:!1})}
this.handleTransferFinished=(e,t)=>{const n=null!=t?{errorMessage:t}:{}
this.handleUpdateState({...n,isTransferring:!1,transferCancelled:e})}
this.getFinalTransferOrConcentrationPane=()=>(0,$B.Eq)(zB.F.V3)&&!shouldSkipSampleControlsPane(this.state)?getPrevPane(this.state.pane,this.props.flow,this.state):this.state.pane
this.getSubmit=()=>{if(getNextPane(this.state.pane,this.props.flow,this.state))return null
if(this.getFinalTransferOrConcentrationPane()===Dq)return this.calculateAndTransfer
if(this.getFinalTransferOrConcentrationPane()===Lq)return this.transfer
throw new Error("Unexpected pane state")}
this.wantsBatches=()=>{var e,t,n,a
return XB.iL.includes(this.state.inputType)?(null===(t=null===(e=this.state.inputBioentity)||void 0===e?void 0:e.tagSchema)||void 0===t?void 0:t.containableType)===tw.TagSchemaContainableType.BATCH:!!XB.p3.includes(this.state.inputType)&&(null===(a=null===(n=this.state.createAndRegisterBioentityArgs)||void 0===n?void 0:n.tagSchema)||void 0===a?void 0:a.containableType)===tw.TagSchemaContainableType.BATCH}
this.uncontainableEntityChosen=()=>{var e,t
return XB.iL.includes(this.state.inputType)?null!=this.state.inputBioentity&&(null==this.state.inputBioentity.tagSchema||this.state.inputBioentity.tagSchema.containableType===tw.TagSchemaContainableType.NONE):!!XB.p3.includes(this.state.inputType)&&(null===(t=null===(e=this.state.createAndRegisterBioentityArgs)||void 0===e?void 0:e.tagSchema)||void 0===t?void 0:t.containableType)===tw.TagSchemaContainableType.NONE}
this.errorBannerProps=()=>!(0,oB.Z)()&&this.wantsBatches()?{bannerType:io.ct.ERROR,text:"This entity has been configured to use batches in containers, but batches have been disabled. If you wish to store this entity in a container, please contact your admin."}:this.uncontainableEntityChosen()?{bannerType:io.ct.ERROR,text:"This entity has not been configured to be stored in containers. If you wish to store this entity in a container, please contact your admin."}:null
this.handleChangeShouldCalculateConcentrations=e=>{this.handleUpdateState({shouldCalculateConcentrations:e})}
this.handleChangeConcentration=(e,t,n)=>{this.setState((a=>{var i;(0,S.hu)(null!=a.containerContents,"Expected container contents to be non null on concentration pane")
const s=a.containerContents.findIndex((n=>n.containedItemId===t&&n.containerId===e));(0,S.hu)(-1!==s,"Expected container content to be present")
const r={...a.containerContents[s],concentration:{...a.containerContents[s].concentration,...n}},o=[...a.containerContents.slice(0,s),r,...a.containerContents.slice(s+1)],l=null!==(i=a.pane&&getTransferPaneState(a.pane,{...a,containerContents:o}))&&void 0!==i?i:{}
return{...a,containerContents:o,...l}}))}
const n=eq.Fs()
Object.values(rq).forEach((({stateKey:e,preferenceKey:t})=>{const a=We.Z.get(t)
void 0!==a&&(n[e]=a)}))
const a=eq.xD(null===(t=this.props.preselectedInputConfig)||void 0===t?void 0:t.inputContainer),i={...n,...this.props.preselectedInputConfig,...this.props.preselectedOutputConfig,...a,pane:getPaneOrderByFlow(this.props.flow)[0]}
this.state={...i,...getTransferPaneState(i.pane,i)}}componentDidUpdate(e,t){!t.isTransferring||this.state.transferCancelled||this.state.isTransferring||this.state.errorMessage||this.handleClose()}render(){return this.state.pane?d.createElement(et.ZP,{buttons:this.getButtons(),closeableOnEscapeKey:!1,onRequestClose:this.handleClose,onRequestSubmit:this.getSubmit(),title:this.props.title,bannerProps:this.errorBannerProps()},(()=>{switch(this.state.pane){case YZ.f8.CHOOSE_TRANSFER_INPUT:return d.createElement(pq,{paneState:(e=this.state,(0,he.Z)(e,"inputType","inputBioentity","createAndRegisterBioentityArgs","inputContainer","selectedOutputContainers","inputSampleStatusState","outputSampleStatusState","confirmedOutputContainerIds","showNameTemplateBanner","outputCells","outputContainerSummaries","outputType")),registryId:this.props.registryId,sampleStatusWarningParams:{...this.baseSampleStatusTrackingParams,shouldShowOutputWarnings:this.props.flow===YZ.h0.TRANSFER_IN},onUpdateSampleStatusState:this.handleUpdateSampleStatusState,onUpdateModalState:this.handleUpdateState})
case YZ.f8.CHOOSE_TRANSFER_OUTPUT:return d.createElement(bq,{paneState:getTransferOutputPaneState(this.state),registryId:this.props.registryId,sampleStatusWarningParams:{...this.baseSampleStatusTrackingParams,shouldShowInputWarnings:this.props.flow===YZ.h0.TRANSFER_OUT},onUpdateSampleStatusState:this.handleUpdateSampleStatusState,onUpdateModalState:this.handleUpdateState})
case YZ.f8.CONFIRM_TRANSFER_QUANTITIES:return d.createElement(Pq,{paneState:getTransferQuantitiesPaneState(this.state),onUpdateModalState:this.handleUpdateState})
case YZ.f8.CONFIRM_CONCENTRATIONS:return d.createElement(QueryingConfirmConcentrationsPane,{paneState:getTransferConcentrationsPaneState(this.state),onChangeShouldCalculate:this.handleChangeShouldCalculateConcentrations,onChangeConcentration:this.handleChangeConcentration,allowRecalculateConcentrations:!0,getConfirmConcentrationArgsAndCallbacks:()=>({...getConfirmConcentrationsArgs(this.state),onStart:this.handleCalculateConcentrationsStarted,onComplete:this.handleCalculateConcentrationsCompleted,onFailure:this.handleCalculateConcentrationsFailed})})
case YZ.f8.CONFIRM_SAMPLE_CONTROLS:return d.createElement(ConfirmSampleControlsPane,{paneState:getTransferSampleControlsPaneState(this.state),onUpdateModalState:this.handleUpdateState})
default:(0,S.hu)(!1,`Invalid pane: ${this.state.pane}`)
return null}var e})()):null}}TransferModal.defaultProps={title:"Transfer samples"}
const kq=TransferModal
var Mq=n(67382)
const Fq=C.ZJ.TERTIARY_GRAY,Zq=j.D2.INVENTORY_CONTAINER_PAGE_TOOLBAR
class ContainerToolbar extends d.Component{constructor(){super(...arguments)
this.handleSetParentStorable=(e,t,n)=>{ma.gW({analyticsMetadata:{actionOrigin:Zq,eventGroupId:t}},null,(()=>{xB.updateContainerWithDataMods(this.props.container.id,{parentStorableData:e},n)}))}
this.canTransfer=()=>MB.i6({...this.props.container,containedItemIds:this.props.container.contents.map((({containedItemId:e})=>e))})}render(){return d.createElement("div",{className:"u-flex-display"},!JF.UP(this.props.parentStorable)&&d.createElement(Mq.Z,{buttonStyle:Fq,isWritable:this.props.container.permissions.writable,onSetParentStorable:this.handleSetParentStorable,waitForSubmitErrors:!0,storableSchema:this.props.container.storableSchema,sampleStatusWarningParams:{actionAttempted:"move_location",actionOrigin:Zq,sampleIds:[this.props.container.id]}}),this.props.container.permissions.writable&&d.createElement(P.ZP,{title:"Transfer in / out"},d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.MEDIUM},d.createElement(N.Z,{onSelect:()=>{(0,Xn.Z)(kq,{flow:YZ.h0.TRANSFER_IN,actionOrigin:Zq,title:"Fill container",preselectedOutputConfig:{outputType:st.CONTAINER,outputContainerSummaries:[this.props.container],outputPlate:null,outputCells:[]}})}},"Fill container"),this.props.onRequestTransfer&&d.createElement(N.Z,{isDisabled:!this.canTransfer(),onSelect:this.props.onRequestTransfer,tooltipTitle:this.canTransfer()?void 0:"Container is empty"},"Transfer contents"),d.createElement(N.Z,{isDisabled:0===this.props.container.contents.length,tooltipTitle:0===this.props.container.contents.length?"Container is empty":void 0,onSelect:()=>{(0,Xn.Z)(KB.ZP,{containerIds:[this.props.container.id],actionOrigin:Zq})}},"Remove contents"))},d.createElement(C.Co,{icon:"transfer",isDropdown:!0,buttonStyle:Fq,size:C.qE.SMALL,className:"u-no-wrap u-mini-spacing-left"}))),d.createElement(YB.Z,{actionSource:Zq,buttonStyle:Fq,buttonClassName:"u-mini-spacing-left",items:[this.props.container]}),d.createElement(QB.Z,{className:"u-mini-spacing-left",buttonStyle:Fq,itemIds:[this.props.container.id]}),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement(kR.Z,{buttonStyle:Fq,className:"u-mini-spacing-left",ids:[this.props.container.id],refreshOptions:{refreshRecentWorklists:!0}}),(()=>JF.UP(this.props.parentStorable)?null:d.createElement(wR.Z,{buttonStyle:Fq,className:"u-mini-spacing-left",isArchivable:Boolean(this.props.container.permissions.archivable),isUnarchivable:Boolean(this.props.container.permissions.unarchivable),item:this.props.container,onArchive:IR.At,onUnarchive:e=>{ma.gW({analyticsMetadata:{actionOrigin:Zq,eventGroupId:(0,m.Vr)()}},null,(()=>{IR.iA(e)}))},getAnalyticsMetadata:()=>({actionOrigin:Zq,eventGroupId:(0,m.Vr)()})}))(),XA.Z.hasEnterprisePlan()&&(dt.ZP.AUDITING_ENABLE_SAMPLE_CONTAINER_HISTORY_REPORT?d.createElement(P.ZP,{title:"Export report"},d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FIT_CONTENT,dropLeft:!0},d.createElement(N.Z,{onSelect:()=>{(0,bc.Nq)([this.props.container.id])},dataTestAttrs:{component:"ContainerToolbar",element:"dropdownOption",key:"exportReport"}},Tc.n9),d.createElement(N.Z,{onSelect:()=>{(0,bc.dV)([this.props.container.id])}},Tc.QU))},d.createElement(C.Co,{icon:"share-v2",isDropdown:!0,buttonStyle:Fq,size:C.qE.SMALL,className:"u-no-wrap u-mini-spacing-left",dataTestAttrs:{component:"ContainerToolbar",element:"button",key:"exportDropdownToggle"}}))):d.createElement($k.Z,{buttonStyle:Fq,className:"u-mini-spacing-left",ids:[this.props.container.id]})))}}ContainerToolbar.defaultProps={isWritable:!1}
const Bq=ContainerToolbar
function GridPosition({rowIndex:e,columnIndex:t,gridType:n,gridWidth:a}){const i=(0,JF.mk)(e,t),s=(0,JF.KH)(e,t,a)
return d.createElement("span",null,n===YZ.tQ.BOX&&d.createElement("span",{className:"u-small-spacing-right"},s),d.createElement("span",{className:f()({"u-faded":n===YZ.tQ.BOX})},i))}var qq=n(771839)
class ParentStorableBreadcrumbsConnector extends oi.C{constructor(){super(...arguments)
this.stores=[WZ.Z]}enhanceProps(){const e=(0,JF.uZ)(this.props.parentStorable)
return e?{listedLocation:this.storableStore().getListedLocation(e)}:{listedLocation:null}}}class ParentStorableBreadcrumbs extends d.Component{refresh(){const e=(0,JF.uZ)(this.props.parentStorable)
e&&xB.fetchLocation(e)}componentDidMount(){this.refresh()}componentDidUpdate(e){var t,n;(null===(t=this.props.parentStorable)||void 0===t?void 0:t.id)!==(null===(n=e.parentStorable)||void 0===n?void 0:n.id)&&this.refresh()}render(){const e=this.props.parentStorable
if(!e)return d.createElement("div",{className:"u-faded"},"None")
const t=Jn.Z.currentUser()?(0,Cw.Kf)({listed:this.props.listedLocation,openResult:xB.open,shouldLinkLastCrumb:!0,renderIcon:e=>{}}):[]
ea.ZP.isLocation(e.id)||t.push(d.createElement(Cw.Ak,{key:`crumb-${e.id}`,onClick:()=>{xB.open(e)},text:e.name}))
return d.createElement(Cw.ZP,{crumbs:t})}}const Vq=ParentStorableBreadcrumbsConnector.connect(ParentStorableBreadcrumbs),Uq={id:null,gridCellColumnIndex:null,gridCellRowIndex:null}
function ParentStorableDetails({isWritable:e,onSetParentStorable:t,parentStorable:n,confirmBeforeEditing:a}){const i=!dt.ZP.ENABLE_REQUIRED_PARENT_STORABLE&&e&&n,s=d.createElement(Vq,{parentStorable:n})
function handleClearParent(){t(Uq)}return d.createElement("div",{className:"u-flex-display"},n?d.createElement(ParentLink,{icon:"location",onClickParent:()=>{xB.open(n)},parentName:s,tooltipTitle:"Show containing location"}):d.createElement("div",null,"None"),i&&d.createElement("div",{className:"u-mini-spacing-left u-primary-pointer"},d.createElement(P.ZP,{placement:P.TQ.TOP,title:"Unset inventory..."},d.createElement(pe.Z,{className:"containerLocationUnset-icon faded",icon:"close",onClick:null!=a?async function handleClearParentWithConfirmation(){(0,S.hu)(null!=a,"Expected confirmBeforeEditing to be provided")
await a()&&handleClearParent()}:handleClearParent}))))}var Gq=n(826516)
const zq=j.D2.INVENTORY_CONTAINER_PAGE
class ContainerDetailsPane extends d.Component{constructor(){super(...arguments)
this.maxAvatarsForSampleRoles=3
this.getSampleOwnersPopoverPrefix=()=>{var e,t
const n=(null!==(t=null===(e=this.props.container.sampleRoles)||void 0===e?void 0:e.sampleOwners)&&void 0!==t?t:[]).length>this.maxAvatarsForSampleRoles
return(0,DB.V7)(this.props.container)||!n?null:" Sample owners: "}
this.getRestrictedSampleUsersPopoverPrefix=()=>{var e,t
const n=(null!==(t=null===(e=this.props.container.sampleRoles)||void 0===e?void 0:e.restrictedSampleUsers)&&void 0!==t?t:[]).length>this.maxAvatarsForSampleRoles
return(0,DB.Fn)(this.props.container,!1)||!n?null:` ${(0,GB.T3)()}: `}
this.updateContainerWithDataModsWithAnalyticsContext=(e,t,n)=>{ma.gW({analyticsMetadata:{actionOrigin:zq,actionMethod:n}},null,(()=>{xB.updateContainerWithDataMods(e,t)}))}
this.handleUpdateName=e=>{this.updateContainerWithDataModsWithAnalyticsContext(this.props.container.id,{name:e},j.LY.IN_LINE_EDIT)}
this.handleUpdateBarcode=e=>{this.updateContainerWithDataModsWithAnalyticsContext(this.props.container.id,{newBarcode:e},j.LY.IN_LINE_EDIT)}
this.handleSetParentStorable=e=>{this.updateContainerWithDataModsWithAnalyticsContext(this.props.container.id,{parentStorableData:e},j.LY.IN_LINE_EDIT)}
this.handleProjectChange=e=>{this.updateContainerWithDataModsWithAnalyticsContext(this.props.container.id,{sourceId:e},null)}
this.handleUpdateTags=e=>{const t=pC.UR(e)
xB.updateContainerTagsWithDataMods(this.props.container.id,t)}
this.handleUpdateQuantity=e=>{this.updateContainerWithDataModsWithAnalyticsContext(this.props.container.id,{quantity:e},j.LY.IN_LINE_EDIT)}
this.checkSampleStatus=e=>this.props.checkSampleStatus({actionAttempted:e,eventGroupId:m.Vr()})
this.updateSampleControls=({restrictionStatus:e,sampleOwnerIds:t,restrictedSampleUserIds:n})=>{var a
const i={}
void 0!==e&&(i.restrictionStatus=e)
void 0!==t&&(i.sampleRoles={sampleOwnerIds:t})
void 0!==n&&(i.sampleRoles={...null!==(a=i.sampleRoles)&&void 0!==a?a:{},restrictedSampleUserIds:n})
this.updateContainerWithDataModsWithAnalyticsContext(this.props.container.id,i,j.LY.IN_LINE_EDIT)}
this.handleUpdateRestrictionStatus=(e,t)=>{e!==t&&(t===VB.nY.UNRESTRICTED?je.iG("Unrestrict sample?",`${(0,GB.G9)()}`,C.ZJ.NEGATIVE,{acceptText:"Unrestrict",enableRedesign:!0}).done((()=>{this.updateSampleControls({restrictionStatus:t})})):this.updateSampleControls({restrictionStatus:t}))}
this.handleUpdateSampleOwners=e=>{const t=e.map((e=>e.id));(0,DB.O0)(this.props.container)&&0===e.length&&!(0,$B.Eq)(zB.F.V2)?!(0,DB.Fn)(this.props.container,!1)&&(0,DB.nS)(this.props.container)?je.Z9("Insufficient permission","To remove all sample owners from a container, you must also be a sample owner.",C.ZJ.PRIMARY,{enableRedesign:!0}):je.iG("Remove all sample owners?",`${(0,GB.G9)()}`,C.ZJ.NEGATIVE,{acceptText:"Remove",enableRedesign:!0}).done((()=>{this.updateSampleControls({sampleOwnerIds:[],restrictedSampleUserIds:[]})})):this.updateSampleControls({sampleOwnerIds:t})}
this.handleUpdateRestrictedSampleUsers=e=>{(0,S.hu)((0,DB.JK)(this.props.container),`${(0,GB.EX)()} can only be set on restricted containers.`)
const t=e.map((e=>e.id))
this.updateSampleControls({restrictedSampleUserIds:t})}
this.getBarcodeValueProps=()=>dt.ZP.INVENTORY_ENABLE_EDIT_BARCODES?{storable:this.props.container,isDisabled:!this.props.container.permissions.canEditNamesAndBarcodes||this.props.container.isFixedPlateWell,handleBarcodeChange:this.handleUpdateBarcode,confirmBeforeStartEditing:()=>this.checkSampleStatus("update_barcode"),disableEditsWithTooltip:(0,DB.p5)(this.props.container)||JF.fm(this.props.container.permissions.canEditNamesAndBarcodes)||JF.bO(this.props.container.isFixedPlateWell,"barcode")}:{storable:this.props.container}}render(){var e,t,n,a
return d.createElement("div",null,this.props.showFullView&&d.createElement("div",{className:"u-lr-split"},d.createElement(so.R6,null,d.createElement(Iw.Z,{isDisabled:!this.props.container.permissions.canEditNamesAndBarcodes||this.props.container.isFixedPlateWell,requestChange:this.handleUpdateName,value:this.props.container.name,confirmBeforeStartEditing:()=>this.checkSampleStatus("rename"),disableEditsWithTooltip:(0,DB.p5)(this.props.container)||JF.bw(this.props.container.permissions.canEditNamesAndBarcodes)||JF.bO(this.props.container.isFixedPlateWell,"name")}),d.createElement(lC.Z,{item:this.props.container})),d.createElement(Bq,{container:this.props.container,isWritable:this.props.isWritable,isUnarchivable:this.props.isUnarchivable,onRequestTransfer:this.props.onRequestTransfer,parentStorable:this.props.parentStorable})),d.createElement("div",{className:"u-spacing-top"},!(0,$B.Eq)(zB.F.V1)&&!dt.ZP.INVENTORY_ENABLE_CHECK_IN_CHECK_OUT||this.props.container.isFixedPlateWell?null:d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},(0,$B.Eq)(zB.F.V1)?d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,(0,DB.Cm)()),d.createElement(WB.ZP,{item:this.props.container,includeAvailability:!1,includeAuthorization:!0,itemSupportsSampleStatus:!0,includeMessage:!0,renderAllStatuses:!0})):null,(0,$B.Eq)(zB.F.V2)?d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Restriction status"),d.createElement(Oe.Z,{renderContent:()=>d.createElement("p",null,`${(0,DB.Pq)(this.props.container.restrictionStatus,!0)}`),isDisabled:!this.props.isWritable||(0,DB.fs)(this.props.container)},d.createElement("div",{className:(0,g.iv)(Wq.restrictionStatusPopover)},d.createElement(UB.d,{isDisabled:!this.props.isWritable||!(0,DB.fs)(this.props.container),item:this.props.container,onComplete:this.handleUpdateRestrictionStatus})))):null,dt.ZP.INVENTORY_ENABLE_CHECK_IN_CHECK_OUT?d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Availability"),d.createElement(WB.ZP,{item:this.props.container,includeAvailability:!0,includeAuthorization:!1,itemSupportsSampleStatus:!0,includeMessage:!0,renderAllStatuses:!0})):null),(0,$B.Eq)(zB.F.V1)&&!this.props.container.isFixedPlateWell&&d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Sample owners"),d.createElement(dA.Z,{value:null!==(t=null===(e=this.props.container.sampleRoles)||void 0===e?void 0:e.sampleOwners)&&void 0!==t?t:[],onChange:this.handleUpdateSampleOwners,isDisabled:!this.props.isWritable||!(0,DB.V7)(this.props.container),chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowOrganizations:!1,allowBenchlingApps:!1,shouldAllowMultiple:!0,isFullWidth:!1,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0,useAvatars:!0,maxAvatars:this.maxAvatarsForSampleRoles,extraPopoverTextForPartyList:this.props.isWritable&&!(0,DB.V7)(this.props.container)?`${VB.Pi}.`:null,popoverPrefixForPartyList:this.getSampleOwnersPopoverPrefix(),shouldResetEditStateOnComplete:!0,dataTestAttrs:{component:"SampleControlRoles",element:"sampleOwners"}})),(!(0,$B.Eq)(zB.F.V2)||(0,DB.JK)(this.props.container))&&d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,(0,GB.T3)()),d.createElement(Oe.Z,{renderContent:()=>d.createElement("p",null,`${(0,GB.tX)()}.`),isDisabled:!this.props.isWritable||(0,DB.Fn)(this.props.container,!1)||(0,DB.nS)(this.props.container)},d.createElement(dA.Z,{value:null!==(a=null===(n=this.props.container.sampleRoles)||void 0===n?void 0:n.restrictedSampleUsers)&&void 0!==a?a:[],onChange:this.handleUpdateRestrictedSampleUsers,isDisabled:!this.props.isWritable||!(0,DB.Fn)(this.props.container,!1),chipSize:nA.I.SMALL,enableNewEntityInput:!0,allowOrganizations:!1,allowBenchlingApps:!0,shouldAllowMultiple:!0,isFullWidth:!1,initialIsBeingEdited:!1,allowEmptyValue:!0,shouldUseCompactDisplay:!0,useAvatars:!0,maxAvatars:this.maxAvatarsForSampleRoles,extraPopoverTextForPartyList:this.props.isWritable&&!(0,DB.Fn)(this.props.container,!1)?`${(0,GB.tX)()}.`:null,popoverPrefixForPartyList:this.getRestrictedSampleUsersPopoverPrefix(),shouldResetEditStateOnComplete:!0,dataTestAttrs:{component:"SampleControlRoles",element:"restrictedSampleUsers"}})))),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Barcode"),d.createElement(BarcodeValue,{...this.getBarcodeValueProps()})),d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Schema"),d.createElement("div",null,(0,Vw.Z)(this.props.container.storableSchema))),d.createElement(p.Z,{sm:4},d.createElement(Gq.Hn,{isWritable:this.props.isWritable,registryId:this.props.container.storableSchema.registryId,onChange:this.handleProjectChange,selectedSourceId:this.props.container.sourceId,disableEditsWithTooltip:this.props.container.isFixedPlateWell?"Project settings inherited from plate":null}))),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Location"),d.createElement(ParentStorableDetails,{isWritable:this.props.isWritable&&!(0,DB.p5)(this.props.container)&&!this.props.container.isFixedPlateWell,onSetParentStorable:this.handleSetParentStorable,parentStorable:this.props.parentStorable,confirmBeforeEditing:()=>this.checkSampleStatus("move_location")})),d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,(0,HB.Z)()),d.createElement(ZB,{isDisabled:!this.props.isWritable||null!=(0,DB.p5)(this.props.container),measurement:this.props.container.quantity,onComplete:this.handleUpdateQuantity,validUnits:(0,kB.kI)(),confirmBeforeStartEditing:()=>this.checkSampleStatus("update_quantity"),disableEditsWithTooltip:(0,DB.p5)(this.props.container)})),d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Position"),this.props.parentStorable&&(0,JF.ZY)(this.props.parentStorable)?d.createElement(GridPosition,{rowIndex:this.props.container.gridCell.rowIndex,columnIndex:this.props.container.gridCell.columnIndex,gridType:ea.ZP.isBox(this.props.parentStorable.id)?YZ.tQ.BOX:YZ.tQ.PLATE,gridWidth:this.props.parentStorable.storableSchema.width}):d.createElement("span",null,"N/A"))),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Creator"),d.createElement(qq.Z,{creator:this.props.container.creator})),d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Created"),d.createElement("span",null,(0,Hr.UT)(this.props.container.createdAt))),dt.ZP.STUDIES_ENABLE&&(0,WN.Hw)(this.props.container)&&d.createElement(p.Z,{sm:4},d.createElement(so.Dx,null,"Studies"),d.createElement(KN,{studyable:this.props.container,isWritable:this.props.isWritable})))),d.createElement("div",{className:"u-spacing-top"},d.createElement(fZ.Z,{className:"bufferRowReset u-small-spacing-top",itemLinkAllowed:!1,isWritable:this.props.isWritable,onUpdateTags:this.handleUpdateTags,registryId:this.props.container.storableSchema.registryId,tags:this.props.container.tags,confirmBeforeStartEditing:()=>this.checkSampleStatus("update_fields"),disableEditsWithTooltip:(0,DB.p5)(this.props.container)})))}}ContainerDetailsPane.defaultProps={isWritable:!1,showFullView:!0}
const $q=ContainerDetailsPane,Wq=g.mM.create({restrictionStatusPopover:{width:"100%"}})
function StorableBanner(e){if(e.isWritable)return null
const t=(0,JF.Di)(e.storable),n=(0,Mt.E2)(ea.ZP.apiIdToType(e.storable.id))
let a
a=(0,yc.ZP)(e.storable)?`Editing disabled on archived ${n}.`:t?`Some actions are disabled because you have insufficient permissions for this ${n}.`:`Editing disabled on read-only ${n}.`
return d.createElement(Fv.Z,{banner:a})}var Hq=n(318535),jq=n(133240)
function ContainerContentConcentration(e){if(!(e.container&&e.storableSummaryExtras&&e.storableSummaryExtras.containableConcentrationsByContainerId))return null
const t=e.storableSummaryExtras.containableConcentrationsByContainerId[e.container.id]
return t&&0!==Object.keys(t).length?d.createElement(Nq.g,{measurement:t[e.containerContentContainableId]}):null}var Yq=n(282892),Qq=n(106727)
function LinkCell(e){return d.createElement(rc.bL,null,d.createElement("a",{onClick:e.onClick},e.children))}LinkCell.propTypes={children:J().node,onClick:J().func.isRequired}
LinkCell.defaultProps={onClick:()=>{}}
var Kq=n(389528),Jq=n(525999)
function StorableInfoTable_defineProperty(e,t,n){(t=function StorableInfoTable_toPropertyKey(e){var t=function StorableInfoTable_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}function isContainer(e){return ea.ZP.apiIdToType(e.id)===st.CONTAINER}function getTableMessage(e,t,n){const a=e-t
return d.createElement("span",null,a>0&&d.createElement("span",{className:"u-bold-font-weight"},a," hidden. "),e," total ",(0,de._6)(e,n),".")}class StorableInfoTableConnector extends oi.C{constructor(...e){super(...e)
StorableInfoTable_defineProperty(this,"stores",[WZ.Z])}enhanceProps(){if(!this.props.storableSummaryExtras||!this.props.storableSummaryExtras.ancestralStorableIdsByStorableId)return null
const e=[].concat(...this.props.storables.map((e=>this.props.storableSummaryExtras.ancestralStorableIdsByStorableId[e.id]||[])))
return{storableOrInaccessibleInfoById:this.getOrFetchMultipleMaybeInaccessibleRequired(lA.V.STORABLE_SUMMARY,e)}}}function StorableInfoTable({emptyTableText:e,isLoading:t,setOffset:n,itemWord:a,onChangeArchivePurposes:i,selectedArchivePurposes:s,storables:r,storableSummaryExtras:o,pagination:c,storableOrInaccessibleInfoById:u,containerContentContainableId:m,dataTestAttrs:p}){const h=r.some((e=>isContainer(e)))
return d.createElement("div",(0,ee.Z)(p),i&&s&&d.createElement("div",{className:"u-flex-display"},d.createElement(qF.Z,{itemIds:r.map((e=>e.id)),onChangePurposes:i,selectedPurposes:s})),d.createElement(rc.iA,{emptyTableText:e,message:c&&getTableMessage(c.totalWithHidden,c.total,a),numRows:r.length,isLoading:t,pagination:c,setOffset:n},d.createElement(rc.sg,{header:"Barcode",renderCell:e=>d.createElement(LinkCell,{onClick:()=>{xB.open(r[e])}},r[e].barcode)}),d.createElement(rc.sg,{header:"Name",renderCell:e=>d.createElement(rc.bL,null,r[e].name)}),d.createElement(rc.sg,{header:"Created",renderCell:e=>d.createElement(rc.bL,null,(0,Hr.UT)(r[e].createdAt))}),o&&u&&d.createElement(rc.sg,{header:"Location",renderCell:e=>d.createElement(rc.bL,null,d.createElement(Jq.Cf,{noLocationText:"None",storableId:r[e].id,ancestralStorableIds:o.ancestralStorableIdsByStorableId[r[e].id],storableOrInaccessibleInfoById:u,showGridCell:!1,truncate:!1}))}),o&&u&&h&&d.createElement(rc.sg,{header:"Position",renderCell:e=>{const t=r[e],n=o.gridCellsByContainerId[t.id]
if(!t.parentStorableId||!n)return null
const a=o.ancestralStorableIdsByStorableId[r[e].id]
if(a.some((e=>(0,kN.Eh)(u[e]))))return null
const i=a.map((e=>u[e])),s=Yq.o6(t,i)
return d.createElement(rc.bL,null,JF.vZ({gridType:ea.ZP.apiIdToType(s.id),rowIndex:n.rowIndex,columnIndex:n.columnIndex,width:s.storableSchema.width}))}}),h&&d.createElement(rc.sg,{header:(0,HB.Z)(),renderCell:e=>isContainer(r[e])&&d.createElement(rc.bL,null,d.createElement(Nq.g,{measurement:r[e].quantity}))}),h&&m&&d.createElement(rc.sg,{header:"Concentration",renderCell:e=>r[e]&&isContainer(r[e])&&d.createElement(rc.bL,null,d.createElement(ContainerContentConcentration,{container:r[e],storableSummaryExtras:o,containerContentContainableId:m}))}),function getStorableTagColumns(e){return(0,Qq.j)(e).map((({name:t})=>d.createElement(rc.sg,{key:t,header:t,renderCell:n=>{const a=l.default.findWhere(e[n].tags,{name:t})
return d.createElement(rc.bL,null,a&&d.createElement(VF.Z,{tag:a}))}})))}(r)))}StorableInfoTable.propTypes={emptyTableText:J().string.isRequired,itemWord:J().string,storables:J().arrayOf(YZ.df).isRequired,storableSummaryExtras:YZ.KV,isLoading:J().bool.isRequired,onChangeArchivePurposes:J().func,pagination:jq.Tn,selectedArchivePurposes:J().array,setOffset:J().func,storableOrInaccessibleInfoById:J().objectOf(J().oneOfType([YZ.df,Hq.G])),containerContentContainableId:J().string,dataTestAttrs:Kq.Z}
StorableInfoTable.defaultProps={isLoading:!1}
const Xq=StorableInfoTableConnector.connect(StorableInfoTable)
function ContainerTransferInfoDetails(e){return e.containerTransferInfo?d.createElement(h.Z,null,d.createElement(p.Z,{md:6},d.createElement("h3",null,"Transfers to Container"),d.createElement(Xq,{emptyTableText:"No transfers to container",storables:e.containerTransferInfo.inputStorables})),d.createElement(p.Z,{md:6},d.createElement("h3",null,"Transfers from Container"),d.createElement(Xq,{emptyTableText:"No transfers from container",storables:e.containerTransferInfo.outputStorables,dataTestAttrs:{component:"ContainerView",element:"TransfersFromContainer"}}))):null}class ContainerView extends d.Component{constructor(){super(...arguments)
this.state={isTransferModalOpen:!1}
this.handleOpenTransferModal=()=>{this.setState({isTransferModalOpen:!0})}
this.handleCloseTransferModal=()=>{this.setState({isTransferModalOpen:!1})}
this.checkSampleStatus=async({actionAttempted:e,eventGroupId:t})=>{const{shouldProceed:n}=await(0,LB.jT)({sampleIds:this.props.container?[this.props.container.id]:[],trackingParams:{actionOrigin:j.D2.INVENTORY_CONTAINER_PAGE,actionAttempted:e,eventGroupId:t}})
return n}}render(){return this.props.container?d.createElement("div",null,d.createElement(M_.Z,{open:this.state.isTransferModalOpen},d.createElement(kq,{flow:YZ.h0.TRANSFER_OUT,onRequestClose:this.handleCloseTransferModal,registryId:this.props.container.storableSchema.registryId,title:"Add to containers",preselectedInputConfig:{inputType:XB.wD.EXISTING_CONTAINER,inputContainer:{...this.props.container,containedItemIds:this.props.container.contents.map((({containedItemId:e})=>e))}},actionOrigin:j.D2.INVENTORY_CONTAINER_PAGE_TOOLBAR})),this.props.showFullView&&d.createElement(StorableBanner,{isWritable:this.props.isWritable,storable:this.props.container}),d.createElement("div",{className:f()({"react-tab-container":this.props.showFullView})},d.createElement($q,{container:this.props.container,isWritable:this.props.isWritable,isUnarchivable:this.props.isUnarchivable,onRequestTransfer:this.handleOpenTransferModal,parentStorable:this.props.parentStorable,showFullView:this.props.showFullView,checkSampleStatus:this.checkSampleStatus}),d.createElement("div",{className:"u-spacing-top"},d.createElement("h3",null,"Contents"),d.createElement(qB,{containerId:this.props.container.id,containerContents:this.props.container.contents,checkSampleStatus:this.checkSampleStatus,disableEditsWithTooltip:(0,DB.p5)(this.props.container)})),this.props.showFullView&&d.createElement(ContainerTransferInfoDetails,{containerTransferInfo:this.props.containerTransferInfo}))):d.createElement(EN.d,null)}}ContainerView.defaultProps={showFullView:!0,isWritable:!1}
const eV=ContainerView
class ContainerViewContainerConnector extends oi.C{constructor(){super(...arguments)
this.stores=[WZ.Z]}enhanceProps(){var e,t
const n=this.storableStore().getContainer(this.props.containerId)
return{authErrorMessage:this.storableStore().getAuthErrorMessage(this.props.containerId),container:n,containerTransferInfo:this.storableStore().getContainerTransferInfo(this.props.containerId),isWritable:null!==(e=null==n?void 0:n.permissions.writable)&&void 0!==e&&e,isUnarchivable:null!==(t=null==n?void 0:n.permissions.unarchivable)&&void 0!==t&&t,parentStorable:(null==n?void 0:n.parentStorableId)?this.storableStore().getStorableSummary(n.parentStorableId):null}}}class ContainerViewContainer extends d.Component{async componentDidMount(){await xB.fetchContainer(this.props.containerId)
this.props.container&&xB.fetchContainerTransferInfo(this.props.containerId)}componentDidUpdate(e,t){if(e.container&&!this.props.container){xB.fetchContainer(this.props.containerId)
xB.fetchContainerTransferInfo(this.props.containerId)}e.containerTransferInfo&&!this.props.containerTransferInfo&&xB.fetchContainerTransferInfo(this.props.containerId)
const n=WZ.Z.getInaccessibleInfo(this.props.containerId)
if(n&&(0,kN.qg)(n)){(0,kN.do)(n)
Rn.Z.removeFromWorkspace(this.props.containerId)}}render(){const{container:e,isWritable:t,isUnarchivable:n,parentStorable:a}=this.props
return this.props.authErrorMessage?d.createElement(_B.H4,{message:this.props.authErrorMessage}):d.createElement(eV,{container:e,containerTransferInfo:this.props.containerTransferInfo,isWritable:null!=this.props.isWritableOverride?this.props.isWritableOverride:t,isUnarchivable:n,parentStorable:a,showFullView:this.props.showFullView})}}ContainerViewContainer.defaultProps={showFullView:!0}
const tV=ContainerViewContainerConnector.connect(ContainerViewContainer)
class ContainerTabView extends Js{render(){const e={containerId:this.model.get("containerId")};(0,Me.A9)(d.createElement(tV,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}ContainerTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var nV=n(670271),aV=n(561485)
class GridContainerConnector extends oi.C{constructor(){super(...arguments)
this.stores=[xR.Z,WZ.Z]}enhanceProps(){const e=this.storableStore().getGrid(this.props.gridId)
return{authErrorMessage:this.storableStore().getAuthErrorMessage(this.props.gridId),grid:e,parentStorable:e&&e.parentStorableId?this.storableStore().getStorableSummary(e.parentStorableId):null,registry:e&&this.navStore().getSource(e.storableSchema.registryId)}}}class GridContainer extends d.Component{componentDidMount(){xB.fetchGrid(this.props.gridId)}componentDidUpdate(e,t){e.grid&&!this.props.grid&&xB.fetchGrid(this.props.gridId)
const n=WZ.Z.getInaccessibleInfo(this.props.gridId)
if(n&&(0,kN.qg)(n)){(0,kN.do)(n)
Rn.Z.removeFromWorkspace(this.props.gridId)}}render(){var e,t
if(this.props.authErrorMessage)return d.createElement(_B.H4,{message:this.props.authErrorMessage})
if(!this.props.grid)return d.createElement(EN.d,null)
const n={folderId:null!==(t=null===(e=this.props.registry)||void 0===e?void 0:e.rootFolder.api_identifier)&&void 0!==t?t:null,grid:this.props.grid,parentStorable:this.props.parentStorable}
return this.props.children(n)}}const iV=GridContainerConnector.connect(GridContainer)
var sV=n(360680),rV=n(938145),oV=n(554830),lV=n(108958),cV=n(869791)
function AssayRoleGroupDisplay({assayRoleGroup:e}){return d.createElement("div",{className:(0,g.iv)(dV.wellRole)},d.createElement(lV.Z,{radius:8,assayRole:e.assayRole,label:null}),(0,cV.UM)(e))}const dV=g.mM.create({wellRole:{display:"flex",alignItems:"center",gap:8}})
var uV=n(682122),mV=n(252511)
function getNormalizedTagValue(e,t,n){const a=e.find((e=>void 0!==n?e.tagSchemaField.id===n:e.name===t))
return null==(null==a?void 0:a.value)?"":a.value.toUpperCase()}function compareNormalizedTags(e,t,n){if(e===t)return 0
if(e.trim().length>0&&t.trim().length>0&&!Number.isNaN(Number(e))&&!Number.isNaN(Number(t)))return parseFloat(e)<parseFloat(t)?-1:1
if(void 0!==n&&e.split(n).every((e=>!Number.isNaN(Number(e))))&&t.split(n).every((e=>!Number.isNaN(Number(e))))){const a=e.split(n).map((e=>Number(e))),i=t.split(n).map((e=>Number(e)))
for(let e=0;e<a.length;e++){if(!(e<i.length))return 1
if(a[e]<i[e])return-1
if(a[e]>i[e])return 1}return-1}return e<t?-1:1}function compareFunction(e,t,n,a){const i=e.extra.cell,s=t.extra.cell
if(n===uV.bo.COORDINATES&&a===uV.Zj.COLUMN)return function compareCoordinatesColumnMajor(e,t){return e.columnIndex-t.columnIndex||e.rowIndex-t.rowIndex}(i,s)
if(n===uV.bo.COORDINATES)return function compareCoordinatesRowMajor(e,t){return e.rowIndex-t.rowIndex||e.columnIndex-t.columnIndex}(i,s)
if(n===uV.bo.VOLUME)return function compareQuantity(e,t){const n=(0,MB.nG)(e.container.quantity),a=(0,MB.nG)(t.container.quantity)
return null==n&&null==a?0:null==n?-1:null==a?1:n.minus(a).toNumber()}(i,s)
if((0,mV.Gv)(n)){return function compareTag(e,t,n){return compareNormalizedTags(getNormalizedTagValue(e.container.tags,n),getNormalizedTagValue(t.container.tags,n))}(i,s,(0,mV.wS)(n))}if((0,mV.iD)(n)){const a=(0,mV.H$)(n)
return function compareContentsTag(e,t,n){return compareNormalizedTags(getNormalizedTagValue(e,"",n),getNormalizedTagValue(t,"",n),"\n")}(e.extra.containedTags,t.extra.containedTags,a)}(0,S.hu)(!1,`Unsupported sortKey ${n}`)
return 0}function getOrderMenuSection(e,t,n,a){const orderItemIsSelected=e=>We.Z.get(`${a}.${uV.NA.COORDINATES_ORDER_BY_KEY}`)===e.orderKey
return d.createElement(jI.Z,null,e.map((e=>d.createElement(N.Z,{value:{orderKey:e.orderKey},onSelect:()=>{!function handleSetOrder(e,t,n,a){e({tableKey:t,sortKey:n,newCoordinatesOrderingKey:a})}(t,a,e.sortKey,e.orderKey)},key:`sort_${e.orderKey}`,isSelected:orderItemIsSelected(e)},e.orderIcon&&d.createElement(pe.Z,{icon:e.orderIcon,className:f()(n,{"is-sorted":orderItemIsSelected(e)})}),e.orderKeyDisplayName))))}function getSortMenuSection(e,t,n,a){const sortItemIsSelected=e=>We.Z.get(`${a}.${uV.NA.COORDINATES_SORT_DIRECTION}`)===(e.reverse?Tr.Sr.DESCENDING_SORT:Tr.Sr.ASCENDING_SORT)
return d.createElement(jI.Z,null,e.map((e=>d.createElement(N.Z,{value:{sortKey:e.sortKey,reverse:e.reverse},onSelect:()=>{!function handleSetSortDirection(e,t,n,a){e({tableKey:t,sortKey:n,newSortDirection:a})}(t,a,e.sortKey,e.reverse?Tr.Sr.DESCENDING_SORT:Tr.Sr.ASCENDING_SORT)},key:`sort_${e.sortKey}_${e.reverse}`,isSelected:sortItemIsSelected(e)},e.sortIcon&&d.createElement(pe.Z,{icon:e.sortIcon,className:f()(n,{"is-sorted":sortItemIsSelected(e)})}),e.sortKeyDisplayName))))}function GridSortOptions(e){const t=f()("scrollableTable-icon scrollableTable-headerCell-rightIcon","scrollableTable-headerCell-sort",(0,g.iv)(pV.optionIcon)),n=d.createElement(I.ZP,{className:"_sort-order-settings-dropdown",menu:d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},getSortMenuSection(e.gridSortConfig.availableSortOptions,e.onGridSort,t,e.gridSortConfig.tableKey),getOrderMenuSection(e.gridSortConfig.availableCoordinateOrderOptions,e.onGridSort,t,e.gridSortConfig.tableKey))},d.createElement(pe.Z,{className:e.iconClassNames,icon:"triangle-down"}))
if(null!=e.column.sortDirection){const t=We.Z.get(`${e.gridSortConfig.tableKey}.${uV.NA.COORDINATES_ORDER_BY_KEY}`),a=t?`, ordered by ${t}`:""
return d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:`Sorting by ${e.column.header} (${(0,Mt.kC)(e.column.sortDirection)}${a})`},n)}return n}const pV=g.mM.create({optionIcon:{marginLeft:"-7px",marginRight:"7px",marginBottom:"-2px",paddingTop:"4px"}}),hV=xa.Ps`
  query FixedPlateQuery($fixedPlateId: StrictString!) @skipAudit @engComponent(name: INVENTORY) {
    fixedPlate(fixedPlateId: $fixedPlateId) {
      ... on FixedPlateNode {
        id
        wells {
          id
          role {
            assayRole
            subAssayRole
            group
          }
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function useFixedPlateWellsByContainer(e){const t=(0,Da.A4)(hV,{skip:!JF.dV(e),variables:{fixedPlateId:e.id}})
return t.type!==Da.NI.SUCCESS||(0,ka.CZ)(t.data.fixedPlate)?{fixedPlateWellData:null,refetch:t.refetch}:{fixedPlateWellData:(0,Jt.Pe)(t.data.fixedPlate.wells,(e=>e.id)),refetch:t.refetch}}var gV=n(369301),EV=n(648068)
const fV=Za.TK.SMALL,SV=Tr.Uw.GRID_CELL_TABLE,yV=uV.Zj.ROW,bV=uV.bo.COORDINATES,TV=Tr.Sr.ASCENDING_SORT,vV=xa.Ps`
  query GridCellTableEntityFieldsQuery($containerIds: [StrictString!]!)
  @skipAudit
  @engComponent(name: INVENTORY) {
    containers(ids: $containerIds) {
      ... on ContainerNode {
        id
        name
        contents {
          id
          containedItem {
            ...BioentityChipSummaryGraphQL
          }
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("BioentityChipSummary").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,CV="Not specified"
class WellContentConcentrationsCell extends d.Component{extractCellConcentrations(e){const t=e.contents
return!t||t.length<1?[d.createElement(WellContentConcentrationItem,{text:CV,id:e.id,itemId:e.id,faded:!0})]:t.map(((e,t)=>{const n=e.concentration,a=null==n.value||null==n.units,i=a?CV:`${n.value} ${n.units}`
return d.createElement(WellContentConcentrationItem,{text:i,itemId:e.containedItemId,id:`${e.containedItemId}_${t}`,faded:a})}))}render(){return d.createElement(Er.gK,{chips:this.extractCellConcentrations(this.props.well),maxChips:this.props.maxChips,chipSize:this.props.chipSize,viewAllOverflowLink:this.props.viewAllOverflowLink})}}function WellContentConcentrationItem(e){return d.createElement("div",{key:e.id,className:"chip--mini"},d.createElement("span",{className:f()({"u-faded":e.faded})},e.text))}class GridCellTableConnector extends oi.C{constructor(){super(...arguments)
this.stores=[JZ.Z]}enhanceProps(){return{tagSchemasById:this.tagSchemaStore().getTagSchemasById({includeArchived:!0}),isLoading:!this.tagSchemaStore().getIsInitialized()}}}function isCellSelected(e,t){const n=e.filter((e=>null!=e))
return n.some((({rowIndex:e,columnIndex:n})=>e===t.rowIndex&&n===t.columnIndex))}function validGraphQLContainerContentsToREST(e){return(0,YZ.bT)(e.contents).slice(0,3).map((e=>(0,zo.tY)("BioentitySummary",e.containedItem))).filter((e=>null!=e))}class GridCellTable extends d.Component{constructor(){super(...arguments)
this.state={newlySelectedCell:null}
this.handleRowClick=e=>{const{cell:t}=e.extra
isCellSelected(this.props.selectedCells,t)?this.props.onSelectCells(l.default.without(this.props.selectedCells,t)):this.props.onSelectCells(this.props.selectedCells.concat(t))}
this.handleRowsSelect=(e,t)=>{const n=e.map((e=>e.extra.cell))
let a
a=t?l.default.uniq(this.props.selectedCells.concat(n)):this.props.selectedCells.filter((e=>null==e||!n.includes(e)))
this.props.onSelectCells(a)}
this.handleOpenContextMenu=(e,t)=>{gV.b(t.nativeEvent,e.extra.cell.container)}
this.handleOpenContainer=(e,t)=>{e.stopPropagation()
l.default.defer((()=>{Rn.Z.openFile(t.id)}))}
this.getRowContentHeight=e=>{if(e>=this.props.cells.length)return Tr._5
const t=this.props.cells[e].container.contents.length,n=this.getCollapsedChipContainedItemFieldValues(this.props.cells[e].container.id)
return Math.max((0,Er.m2)(Math.min(t,4),fV),mV.NE(this.props.cells[e].container.tags,3),mV.NE(n,1===t?3:t))}}componentDidMount(){l.default.defer((()=>{oV.Z.fetchAll()}))}UNSAFE_componentWillReceiveProps(e){!Is()(this.props.selectedCells,e.selectedCells)&&this.setState({newlySelectedCell:e.cells.find((t=>{const n=isCellSelected(this.props.selectedCells,t),a=isCellSelected(e.selectedCells,t)
return!n&&a}))||null})}getContainedItemTagColumns(){var e
const t=Object.values(null!==(e=this.props.containedEntityFieldData)&&void 0!==e?e:{}).flat(),n=mV.oH(t,{includeCustomTagColumns:!1,mergeBySchemaFieldName:false}),a=t.map((e=>e.tagSchema)).filter((e=>null!=e)),i=l.default.countBy(a,"id"),s=l.default.chain(a).uniq("id").sortBy((e=>i[e.id])).reverse().slice(0,3).map((e=>e.fields.map((()=>e.name)))).flatten().value()
return n.slice(0,s.length).map(((e,t)=>({...e,header:`${e.header} (${s[t]})`,sortKey:`contents_${e.sortKey}:fromSchemaFieldId:${mV.FX(e.columnKey)}`})))}getCollapsedChipContainedItemFieldValues(e){var t,n
const a=(null!==(n=null===(t=this.props.containedEntityFieldData)||void 0===t?void 0:t[e].flatMap((e=>e.tags)))&&void 0!==n?n:[]).flatMap((e=>(0,VR.Yx)(e)?[e]:[])),i=(0,Jt.vM)(a,(({tagSchemaField:e})=>e.id))
return Object.values((0,Jt.Xc)(i,(e=>e.every((e=>EV.ZD(e)))?[e.reduce(((e,t)=>{const n=(0,pC.OU)(e.tagSchemaField.fieldType)
return{...e,[n]:[...e[n],...t[n]]}}))]:e))).flat()}getContainerTagColumns(){return mV.u4(this.props.cells.map((e=>e.container)))}getContainerTagsByColumn(e,t){return mV.MN({tags:t.tags,tagColumns:e,maxChipsPerRow:3}).tagFields}getOrderedRealAndFillerItemTagsForColumns(e,t){return Object.values(t).reduce(((t,n)=>{if(0===n.length)return t
const a=l.default.zip(...n).map((t=>{const n=t.reduce(((e,{itemIndex:t,tag:n})=>({...e,[t]:n})),{}),a={name:t[0].tag.name,tagSchemaField:t[0].tag.tagSchemaField,value:"—",isFiller:!0}
return e.map(((e,t)=>{var i
return null!==(i=n[t])&&void 0!==i?i:{...a,taggedItemName:e.name}}))})).flat()
return[...t,...a]}),[])}getAllContainedItemTags(e){const t=e.reduce(((e,t,n)=>{var a
const i=t.tags.filter((e=>(0,VR.Yx)(e))).map((e=>({tag:{...e,taggedItemName:t.name},itemIndex:n})))
return{...e,[t.tagSchema.id]:[...null!==(a=e[t.tagSchema.id])&&void 0!==a?a:[],i]}}),{})
return this.getOrderedRealAndFillerItemTagsForColumns(e,t)}getContainedItemTagsByColumn(e,t){var n
const a=null===(n=this.props.containedEntityFieldData)||void 0===n?void 0:n[t.id]
let i=[]
void 0!==a&&(i=a.length<=1?a.map((e=>e.tags.filter((e=>(0,VR.Yx)(e))).map((t=>({...t,taggedItemName:e.name}))))).flat():this.getAllContainedItemTags(a))
return mV.MN({tags:i,tagColumns:e,multipleTagsPerColumn:!0,mergeBySchemaFieldName:false,maxChipsPerRow:3,collapsedMultiLinkOverflowElement:e=>d.createElement("div",{className:"chip--mini",key:"overflow_link"},d.createElement("a",{onClick:e=>{this.handleOpenContainer(e,t)}},"View all (",e,")"))}).tagFields}getMergedContainedItemTags(e){const t=l.default.groupBy(this.getAllContainedItemTags(this.props.containedEntityFieldData[e]),(({tagSchemaField:e})=>e.id))
return Object.values((0,Jt.Xc)(t,(e=>e.reduce(((e,t)=>{const n="—"===e.value?t.value:"—"===t.value?e.value:[e.value,t.value].join("\n")
return{...e,value:null==n?void 0:n.trim()}})))))}cellToIndex(e){return e?this.props.cells.findIndex((t=>t.rowIndex===e.rowIndex&&t.columnIndex===e.columnIndex)):null}handleGridSortChangeForCoordinates(e,t){return({tableKey:n,sortKey:a,newCoordinatesOrderingKey:i,newSortDirection:s})=>{const r=e.findIndex((e=>e.sortKey===a))
let o,l=Tr.Ii
r>-1&&({customOrderingBehaviorKey:o,sortDirection:l}=e[r])
const c=e.filter(((e,t)=>t!==r))
c.unshift({sortKey:a,sortDirection:null!=s?s:l,customOrderingBehaviorKey:null!=i?i:o})
i&&i!==o&&We.Z.set(`${n}.${uV.NA.COORDINATES_ORDER_BY_KEY}`,i)
s&&s!==l&&We.Z.set(`${n}.${uV.NA.COORDINATES_SORT_DIRECTION}`,s)
t(c)}}shouldShowWellRoleColumn(){const e=null!=this.props.fixedPlateWellData&&Object.values(this.props.fixedPlateWellData).some((e=>e.role))
return JF.dV(this.props.grid)&&e}getWellRoleColumn(){return{header:"Well role",accessorKey:"wellRole",flexGrow:1,isCollapsible:!1,isSortable:!1}}renderWellRole(e){var t,n
const a=null===(n=null===(t=this.props.fixedPlateWellData)||void 0===t?void 0:t[e])||void 0===n?void 0:n.role
return a?d.createElement(AssayRoleGroupDisplay,{assayRoleGroup:a}):null}render(){var e,t,n
if(this.props.isLoading)return d.createElement(kl.b,null)
const a=this.getContainedItemTagColumns(),i=this.getContainerTagColumns(),s=[{sortKey:uV.bo.COORDINATES,reverse:!1,sortKeyDisplayName:"Sort ascending",sortIcon:"arrow-up"},{sortKey:uV.bo.COORDINATES,reverse:!0,sortKeyDisplayName:"Sort descending",sortIcon:"arrow-down"}],r=[{sortKey:uV.bo.COORDINATES,orderKey:uV.Zj.ROW,orderKeyDisplayName:"Order by rows",orderIcon:"fill-across-rows"},{sortKey:uV.bo.COORDINATES,orderKey:uV.Zj.COLUMN,orderKeyDisplayName:"Order by columns",orderIcon:"fill-down-columns"}],o={tableKey:SV,availableSortOptions:s,availableCoordinateOrderOptions:r},c=l.default.compact([{header:"Position",accessorKey:"coordinates",sortKey:uV.bo.COORDINATES,isCollapsible:!1,isSortable:!0,width:120,isFixed:!0},this.shouldShowWellRoleColumn()&&this.getWellRoleColumn(),!JF.UP(this.props.grid)&&{header:"Container",accessorKey:"container",flexGrow:1,isCollapsible:!1,isSortable:!1},{header:(0,HB.Z)(),accessorKey:"volume",sortKey:uV.bo.VOLUME,isCollapsible:!1,isSortable:!0},{header:"Contents",accessorKey:"contents",flexGrow:1,isCollapsible:!1,isSortable:!1},{header:"Concentration",accessorKey:"concentration",flexGrow:.5,isCollapsible:!0,isSortable:!1}]).concat(i).concat(a),u=this.props.cells.map((e=>{const{rowIndex:t,columnIndex:n,container:s}=e,r=JF.vZ({gridType:this.props.gridType,rowIndex:t,columnIndex:n,width:this.props.grid.cells[0].length}),o={container:d.createElement("div",null,d.createElement(NA.Z,{id:s.id,size:fV,onClick:this.handleOpenContainer})),wellRole:this.renderWellRole(s.id),coordinates:d.createElement(GridPosition,{rowIndex:t,columnIndex:n,gridType:this.props.gridType,gridWidth:this.props.grid.cells[0].length}),volume:d.createElement("span",{className:f()({"u-faded":null==s.quantity.value})},MB.wD(s.quantity)),contents:d.createElement(Er.ZP,{itemIds:s.contents.map((e=>e.containedItemId)),chipSize:fV,maxChips:3,viewAllOverflowLink:d.createElement("div",{className:"chip--mini",key:"overflow_link"},d.createElement("a",{onClick:e=>{this.handleOpenContainer(e,s)}},"View all (",s.contents.length,")"))}),concentration:d.createElement(WellContentConcentrationsCell,{well:s,maxChips:3,chipSize:fV,viewAllOverflowLink:d.createElement("div",{className:"chip--mini",key:"overflow_link"},d.createElement("a",{onClick:e=>{this.handleOpenContainer(e,s)}},"View all (",s.contents.length,")"))}),...this.getContainerTagsByColumn(i,s),...this.getContainedItemTagsByColumn(a,s)},l=this.props.containedEntityFieldData?{cell:e,containedTags:this.getMergedContainedItemTags(s.id)}:{cell:e}
return{id:r,data:o,icon:d.createElement(pe.Z,{className:"scrollableTable-cell-icon",icon:e.container.storableSchema.iconId}),extra:l,isSelected:isCellSelected(this.props.selectedCells,e)}}))
return d.createElement(vr.ZP,{className:(0,g.iv)(IV.table),rowSelectionMode:Tr.rT.MULTIPLE,canResizeColumns:!0,tableKey:SV,columns:c,compareFunction,emptyTableText:`This ${(0,Mt.E2)(this.props.gridType)} is empty.`,getRowContentHeight:this.getRowContentHeight,initialRows:u,initialSort:[{sortKey:bV,sortDirection:null!==(e=We.Z.get(`${SV}.${uV.NA.COORDINATES_SORT_DIRECTION}`))&&void 0!==e?e:TV,customOrderingBehaviorKey:null!==(t=We.Z.get(`${SV}.${uV.NA.COORDINATES_ORDER_BY_KEY}`))&&void 0!==t?t:yV}],getCreateCustomSortElementByColumn:(e,t)=>({coordinates:({column:n,sortIconClassNames:a})=>d.createElement(GridSortOptions,{onGridSort:this.handleGridSortChangeForCoordinates(e,t),gridSortConfig:o,iconClassNames:a,column:n})}),isCompact:!0,matchParentHeight:!0,onRowClick:this.handleRowClick,onRowContextMenu:this.handleOpenContextMenu,onRowsSelect:this.handleRowsSelect,scrollToRow:null!==(n=this.cellToIndex(this.state.newlySelectedCell))&&void 0!==n?n:void 0})}}GridCellTable.propTypes={cells:J().arrayOf(YZ.WV).isRequired,grid:YZ.vl.isRequired,gridType:J().oneOf(YZ.tz).isRequired,onSelectCells:J().func.isRequired,selectedCells:J().arrayOf(YZ.WV).isRequired,isLoading:J().bool.isRequired,tagSchemasById:J().objectOf(tw.TAG_SCHEMA_SHAPE).isRequired}
const IV=g.mM.create({table:{height:"100%"}}),wV=GridCellTableConnector.connect((function QueryingGridCellTable(e){const t=function useEntityFieldsByContainer(e){const t=(0,Da.A4)(vV,{skip:!dt.ZP.INVENTORY_ENABLE_GRID_VIEW_ENTITY_SCHEMA_FIELDS,variables:{containerIds:e}})
let n=null
t.type===Da.NI.SUCCESS&&(n=t.data.containers.reduce(((e,t)=>(0,ka.CZ)(t)?e:{...e,[t.id]:validGraphQLContainerContentsToREST(t)}),{}))
return n}(e.cells.map((e=>e.container.id))),{fixedPlateWellData:n}=useFixedPlateWellsByContainer(e.grid)
return d.createElement(GridCellTable,{...e,containedEntityFieldData:t,fixedPlateWellData:n})}))
var NV=n(282974),AV=n(331845),RV=n(692008),PV=n(15554),OV=n(660957),xV=n(182629),_V=n(636888),DV=n(586874),LV=n(318345)
class StorableToolbarContents extends d.Component{constructor(){super(...arguments)
this._getSelectedStorables=()=>{var e
return l.default.filter(null!==(e=this.props.storables)&&void 0!==e?e:[],(({id:e})=>this.props.selectedIds.includes(e)))}
this._getSelectedCount=e=>this.props.isLoading||null==this.props.storables?0:this.props.storables.filter((t=>this.props.selectedIds.includes(t.id)&&e(t))).length
this._getNumContainers=()=>this._getSelectedCount((e=>ea.ZP.isContainer(e.id)))
this._handleExportContainersToCSV=()=>{xB.exportContainersToCSV(l.default.pluck(this._getSelectedStorables(),"id"))}
this._handleExportAuditLogs=()=>{bc.dV(l.default.pluck(this._getSelectedStorables(),"id"))}
this._handleExportSampleContainerHistoryReport=()=>{bc.Nq(this._getSelectedStorables().map((e=>e.id)))}
this.getSampleContainerHistoryReportTooltipText=(e,t)=>e?t?`Please select at most ${dt.ZP.AUDITING_MAX_NUM_SAMPLE_CONTAINER_HISTORY_REPORT_PER_EXPORT} containers (${this._getNumContainers()} selected).`:"":"Reports can only be exported for containers."
this._getExportMenuItems=()=>{const e=this._getSelectedStorables(),t=e.length,n=this._getNumContainers(),a=t>0&&n===t,i=t>dt.ZP.AUDITING_MAX_NUM_SAMPLE_CONTAINER_HISTORY_REPORT_PER_EXPORT
return[[{name:"Export containers to CSV",handleOnClick:this._handleExportContainersToCSV,disabled:!a||0===t,visible:dt.ZP.ENABLE_EXPORTS,tooltipText:a&&0!==t?void 0:"Please select containers"},...this.props.extraExportMenuItems||[],{name:Tc.QU,handleOnClick:this._handleExportAuditLogs,disabled:0===t,visible:XA.Z.hasEnterprisePlan(),dataTestAttrs:{component:"StorableToolbarContents",element:"exportAuditLogs"}},{name:Tc.n9,handleOnClick:this._handleExportSampleContainerHistoryReport,disabled:!a||0===t||i,visible:XA.Z.hasEnterprisePlan()&&dt.ZP.AUDITING_ENABLE_SAMPLE_CONTAINER_HISTORY_REPORT,tooltipText:this.getSampleContainerHistoryReportTooltipText(a,i),dataTestAttrs:{component:"StorableToolbarContents",element:"exportSampleContainerHistory"}},{name:"Copy barcodes",clipboardData:l.default.pluck(e,"barcode").join("\n"),disabled:0===t,dataTestAttrs:{component:"StorableToolbarContents",key:DV.Z.COPY_BARCODES}}]]}
this._onBulkEditSubmit=(e,t)=>{const n=(0,pC.UR)([e])
return(0,xB.bulkUpdateTagsWithDataMods)(t,n)}
this._shouldEnableTagEditorDropdown=e=>e&&Boolean(e.length)&&e.every((t=>{var n,a
return t.permissions.writable&&(null===(n=t.storableSchema)||void 0===n?void 0:n.id)===(null===(a=e[0].storableSchema)||void 0===a?void 0:a.id)}))
this.render=()=>{var e,t,n
if(this.props.isLoading)return null
const a=(null!==(e=this.props.storables)&&void 0!==e?e:[]).filter((e=>ea.ZP.isContainer(e.id))).length===(null===(t=this.props.storables)||void 0===t?void 0:t.length),i=this._getSelectedStorables(),s=i.length,r=s>0,o=this._getSelectedCount((e=>e.permissions.writable))===s,l=null===(n=this.props.storables)||void 0===n?void 0:n.some((e=>(0,$I.f_)(e.id))),c=i.every((e=>!(0,yc.ZP)(e))),u=i.every((e=>(0,yc.ZP)(e))),m=c&&this._getSelectedCount((e=>Boolean(e.permissions.archivable)))===s,p=u&&this._getSelectedCount((e=>Boolean(e.permissions.unarchivable)))===s,h=dt.ZP.STUDIES_ENABLE&&r&&i.every((e=>(0,WN.Hw)(e)))
return d.createElement("div",{className:"buttonGroup"},d.createElement(xV.ZP,{disabled:!this._shouldEnableTagEditorDropdown(i),results:i,onSubmit:this._onBulkEditSubmit,buttonStyle:this.props.buttonStyle,actionOrigin:this.props.actionOrigin}),!this.props.hideCheckInCheckOut&&d.createElement(YB.Z,{actionSource:this.props.actionOrigin,buttonStyle:this.props.buttonStyle,items:i}),!this.props.hideMove&&d.createElement(LV.Z,{buttonStyle:this.props.buttonStyle,storables:i,defaultParentStorable:this.props.parentStorableForMove}),a&&o&&d.createElement(OV.Z,{buttonStyle:this.props.buttonStyle,disabled:!r,containerIds:i.map((e=>e.id)),actionOrigin:this.props.actionOrigin}),d.createElement(QB.Z,{buttonStyle:this.props.buttonStyle,disabled:!r,itemIds:i.map((e=>e.id))}),(0,ln.cr)({feature:on.gx.PROCESSES_CREATE})&&d.createElement("div",{className:"buttonGroup"},d.createElement(PV.Z,{buttonStyle:this.props.buttonStyle,buttonSize:C.qE.SMALL,items:i,disabled:!r,sourceType:"storables_sidepanel"})),dt.ZP.STUDIES_ENABLE&&d.createElement(_V.Z,{buttonStyle:this.props.buttonStyle,itemIds:i.map((e=>e.id)),disabled:!h}),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&l&&d.createElement(kR.Z,{buttonStyle:this.props.buttonStyle,ids:i.map((({id:e})=>e)),refreshOptions:{refreshRecentWorklists:!0}}),(()=>this.props.hideArchive?null:r?c&&m?d.createElement(NV.Z,{buttonStyle:this.props.buttonStyle,items:i,onArchive:IR.At}):p?d.createElement(AV.Z,{buttonStyle:this.props.buttonStyle,itemIds:i.map((e=>e.id)),onUnarchive:IR.iA}):d.createElement(NV.Z,{buttonStyle:this.props.buttonStyle,disabled:!0,items:[],tooltipTitle:"You do not have permission to archive some of the selected items",onArchive:IR.At}):d.createElement(NV.Z,{buttonStyle:this.props.buttonStyle,disabled:!0,items:[],tooltipTitle:"Select items to archive",onArchive:IR.At}))(),d.createElement(RV.Z,{buttonStyle:this.props.buttonStyle,disabled:!(r||this.props.extraExportMenuItems&&this.props.extraExportMenuItems.length>0),menuItems:this._getExportMenuItems()}))}}}class GridCellToolbarContents extends d.Component{constructor(){super(...arguments)
this._handleExportGridToCSV=()=>{xB.exportGridToCSV(this.props.grid.id)}}_getExportMenuItems(){return[{name:`Export entire ${ea.ZP.apiIdToType(this.props.grid.id)} to CSV`,handleOnClick:this._handleExportGridToCSV,disabled:!1}]}render(){const e=(0,JF.UP)(this.props.grid),t=ea.ZP.apiIdToType(this.props.grid.id)
return d.createElement(StorableToolbarContents,{actionOrigin:t===st.PLATE?j.D2.INVENTORY_PLATE_PAGE_GRID_CELL_TOOLBAR:j.D2.INVENTORY_BOX_PAGE_GRID_CELL_TOOLBAR,buttonStyle:this.props.buttonStyle,storables:this.props.storables,selectedIds:this.props.selectedIds,extraExportMenuItems:this._getExportMenuItems(),parentStorableForMove:this.props.grid,hideCheckInCheckOut:e,hideMove:e,hideArchive:e})}}var kV=n(58498)
function usePlateMapFromGrid(e){const{fixedPlateWellData:t,refetch:n}=useFixedPlateWellsByContainer(e),a=function getPlateMapFromGrid(e,t){const n=[]
e.cells.forEach(((e,a)=>{e.forEach(((e,i)=>{var s
if(null!=e){const r=null===(s=t[e.container.id])||void 0===s?void 0:s.role,o=(0,Jt.m8)(e.container.tags.map((e=>[e.tagSchemaField.systemName,e])))
n.push({position:{row:a,column:i},role:r?(0,ig.C)(r,"__typename"):null,reagents:[],schemaTags:o})}}))}))
return{size:{numRows:e.storableSchema.height,numColumns:e.storableSchema.width},wells:n}}(e,null!=t?t:{})
return{plateMap:a,refetch:n}}var MV=n(319012)
function NumberFieldAssignmentSettings({plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,selectedField:i}){const[s,r]=(0,d.useState)({numericValue:null,stringValue:null}),o=(0,d.useMemo)((()=>i.fieldType===Hn.FieldType.INTEGER),[i.fieldType]);(0,d.useEffect)((()=>{r({numericValue:null,stringValue:null})}),[i])
return d.createElement("div",null,d.createElement("p",{className:(0,g.iv)(FV.helpText)},`Select wells in the plate, then apply ${o?"an integer":"a"} label to them.`),d.createElement(gp.Z,{value:s.stringValue,onChange:e=>{r({numericValue:e.target.numericValue,stringValue:e.target.value})},validateInteger:o}),d.createElement(C.Co,{className:(0,g.iv)(FV.applyButton),text:"Apply",size:C.qE.MEDIUM,buttonStyle:C.ZJ.SECONDARY,onClick:function assignValueToSelected(){const r=o?{integerValue:s.numericValue,value:s.numericValue.toString()}:{floatValue:s.numericValue,value:s.stringValue.trim()},l=(0,MV.cT)(e,i,r,n)
t(l)
a()},disabled:null==s.numericValue||0===n.size}))}const FV=g.mM.create({helpText:{color:Vt.pp},applyButton:{float:"right",marginTop:"16px"}})
var ZV=n(329889)
function SelectorFieldAssignmentSettings({plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,selectedField:i,assignmentGroupsById:s}){const[r,o]=(0,Ex.Z)([]);(0,d.useEffect)((()=>{!async function initializeOptions(){const e=await(0,MV.h$)(i.schemaFieldSelectorId)
o(e.filter((({archiveRecord:e})=>null==e)))}()}),[i.schemaFieldSelectorId,o])
return d.createElement(d.Fragment,null,d.createElement("p",{className:(0,g.iv)(BV.helpText)},"Select wells in the plate, then select ",i.isMulti?"labels":"a label"," to apply to them."),d.createElement("div",{className:f()((0,g.iv)(BV.optionList),"scrollbar-override")},r.map((r=>{var o
return d.createElement("div",{key:r.id,className:(0,g.iv)(BV.selectorOption),onClick:()=>{!function assignValueToSelected(s){let r
r=i.isMulti?(0,tm.ZP)(e,(e=>{[...n].forEach((t=>{var n
const a=e.wells[t].schemaTags[i.systemName],r=new Set([...null!==(n=null==a?void 0:a.schemaFieldSelectorOptionIds)&&void 0!==n?n:[],s])
e.wells[t].schemaTags[i.systemName]={...a,schemaFieldSelectorOptionIds:[...r]}}))})):(0,MV.cT)(e,i,{schemaFieldSelectorOptionIds:[s]},n)
t(r)
a()}(r.id)}},d.createElement(ZV.Z,{cx:6,cy:6,radius:6,colors:[null===(o=s[r.id])||void 0===o?void 0:o.color]}),d.createElement("span",{className:(0,g.iv)(BV.optionName)},r.name))}))))}const BV=g.mM.create({helpText:{color:Vt.pp},optionList:{marginTop:"6px",overflowY:"auto"},selectorOption:{cursor:"pointer",display:"flex",alignItems:"center",padding:"8px 4px",width:"100%",":hover":{backgroundColor:Vt.Ro}},optionName:{marginLeft:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}})
var qV=n(683531),VV=n(253075)
const UV="NEW_OPTION_SENTINEL"
function TextValueOption({assignmentGroup:e,selectedField:t,initialIsEditing:n,existingTextValues:a,deleteOption:i,saveOption:s,assignOptionValue:r,onCancelEditing:o}){const[l,c]=(0,d.useState)(n),[u,m]=(0,d.useState)(e.value),p=u.text!==e.value.text&&a.has(u.text)
return d.createElement("div",{className:(0,g.iv)(GV.textValueOption),onClick:function onOptionClick(){l||r()}},d.createElement("div",{className:(0,g.iv)(GV.textOption)},d.createElement("div",{className:(0,g.iv)(GV.colorCircle)},d.createElement(ZV.Z,{cx:6,cy:6,radius:6,colors:[e.color]})),d.createElement(VV.Z,{editor:d.createElement(qV.Z,{autoFocus:!0,defaultValue:{value:u.text,url:u.url,tagSchemaField:t,name:t.name},itemLinkAllowed:!0,onChange:e=>{m({text:e.value,url:e.url})},placeholder:"Label"}),extraActionButtons:{viewMode:[d.createElement(pe.Z,{key:"delete",className:(0,g.iv)(GV.deleteIcon),icon:"delete",onClick:function onDeleteClick(e){e.stopPropagation()
i()}})],editMode:[]},isBeingEdited:l,isCompleteEnabled:!p&&u.text.length>0,isWritable:!0,viewer:d.createElement("div",{className:(0,g.iv)(GV.optionName)},e.value.url.length>0?d.createElement(uc.Z,{href:e.value.url},e.value.text):d.createElement("span",null,e.value.text)),onCancel:function onClickCancel(){if(null==o){m(e.value)
c(!1)}else o()},onComplete:function onSaveChanges(){if(!p&&u.text.length>0){s(u)
c(!1)}},onEdit:e=>{e.stopPropagation()
c(!0)},isFullWidth:!0})),p&&d.createElement("p",{className:(0,g.iv)(GV.errorMessage)},`Label ${u.text} already exists.`))}function TextFieldAssignmentSettings({plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,selectedField:i,assignmentGroupsById:s,setAssignmentGroupsById:r}){const[o,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)((0,MV.Lq)(s).next().value),[m,p]=(0,d.useState)(new Set);(0,d.useEffect)((()=>{u((0,MV.Lq)(s).next().value)
const e=Object.values(s).map((({value:e})=>e.text))
p(new Set(e))}),[s]);(0,d.useEffect)((()=>{l(!1)}),[i.id])
function getWellIndicesWithValue(t){const n=new Set
e.wells.forEach((({schemaTags:e},a)=>{var s,r
const o=null!==(s=e[i.systemName])&&void 0!==s?s:{}
o.value===t.text&&(null!==(r=o.url)&&void 0!==r?r:"")===t.url&&n.add(a)}))
return n}return d.createElement(d.Fragment,null,d.createElement("p",{className:(0,g.iv)(GV.helpText)},"Select wells in the plate, then select a label to apply to them."),d.createElement("div",{className:f()((0,g.iv)(GV.optionList),"scrollbar-override")},Object.values(s).map((o=>d.createElement(TextValueOption,{key:o.id,assignmentGroup:o,selectedField:i,initialIsEditing:!1,deleteOption:()=>{!async function deleteGroup(n){const a=getWellIndicesWithValue(n.value)
if(a.size>0){if(!await je.iG(`Remove label ${n.name}`,`This label will be removed from ${a.size} wells. Are you sure you want to continue?`,C.ZJ.NEGATIVE,{acceptText:"Remove",rejectText:"Cancel",enableRedesign:!0,promiseCompatible:!0}))return
const s=(0,MV.cT)(e,i,{value:null,url:null},a)
t(s)}r((0,ig.C)(s,n.id))}(o)},saveOption:n=>{!function saveOptionChanges(n,a){const o=(0,MV.Xn)(a.text,a.url)
r({...(0,ig.C)(s,n.id),[o]:{id:o,color:n.color,name:a.text,value:a}})
const l=getWellIndicesWithValue(n.value)
if(l.size>0){const n=(0,MV.cT)(e,i,{value:a.text,url:a.url},l)
t(n)}}(o,n)},assignOptionValue:()=>{!function assignValueToSelected(s){if(0===n.size)return
const r=(0,MV.cT)(e,i,{value:s.text,url:s.url},n)
t(r)
a()}(o.value)},existingTextValues:m}))),o?d.createElement(TextValueOption,{key:UV,assignmentGroup:{id:UV,color:c,name:UV,value:{text:"",url:""}},selectedField:i,initialIsEditing:!0,deleteOption:Jt.ZT,saveOption:function addNewOption(e){const t=(0,MV.Xn)(e.text,e.url)
r({...s,[t]:{id:t,color:c,name:e.text,value:e}})
l(!1)},assignOptionValue:Jt.ZT,onCancelEditing:()=>{l(!1)},existingTextValues:m}):d.createElement(C.Co,{buttonStyle:C.ZJ.TEXT,size:C.qE.SMALL,icon:"compose",text:"Add label",disabled:!1,onClick:()=>{l(!0)}})))}const GV=g.mM.create({helpText:{color:Vt.pp},optionList:{marginTop:"6px",overflowY:"auto"},textValueOption:{cursor:"pointer",width:"100%",padding:"4px 4px",":hover":{backgroundColor:Vt.bs}},textOption:{display:"flex",alignItems:"center"},colorCircle:{marginRight:"4px",display:"inline-flex"},optionName:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},deleteIcon:{color:Vt.TG},errorMessage:{color:Vt.JF,margin:"4px 0 0 16px"}})
var zV=n(579430)
function WellRoleGroupButtons({roleGroups:e,assayRole:t,subAssayRole:n,onAssignGroup:a}){const[i,s]=(0,d.useState)(Math.max(e.length,3));(0,d.useEffect)((()=>{s(Math.max(i,e.length,3))}),[e,i])
return d.createElement("div",{className:(0,g.iv)($V.groupsContainer)},function getGroupOptions(){return[...Array(i)].map(((e,a)=>({assayRole:t,subAssayRole:n,group:a+1})))}().map(((e,t)=>d.createElement("span",{key:t,className:f()((0,g.iv)($V.roleOption),(0,g.iv)($V.groupOption)),onClick:()=>{a(e)}},d.createElement(lV.Z,{radius:10,assayRole:e.assayRole,label:(0,cV.Oy)(e)})))),d.createElement(C.Co,{className:(0,g.iv)($V.groupAddButton),icon:"compose",size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_WHITE,onClick:function addGroupOption(){s(i+1)}}))}const $V=g.mM.create({roleOption:{borderRadius:4,cursor:"pointer",textAlign:"center",border:`1px solid ${Vt.pF}`,":hover":{backgroundColor:Vt.Ro}},groupsContainer:{display:"flex",flexWrap:"wrap"},groupOption:{display:"flex",height:28,padding:3,margin:"4px 8px 4px 0"},groupAddButton:{margin:"4px 0"}}),WV=[{assayRole:Sn.jM.CONTROL,subAssayRole:null,group:null},...Object.keys(zV.hk).map((e=>({assayRole:Sn.jM.CONTROL,subAssayRole:e,group:null})))]
function ControlSubroleButtons(e){return d.createElement("div",{className:(0,g.iv)(HV.groupsContainer)},WV.map((t=>{var n
return d.createElement(Oe.Z,{key:t.subAssayRole,interaction:ne.x2.CLICK,placement:ne.ZH.BOTTOM_START,renderContent:()=>function renderPopoverContent(t){var n,a
return e.groupPopoverDisabled?null:d.createElement("div",{className:(0,g.iv)(HV.subrolePopover)},d.createElement(WellRoleGroupButtons,{assayRole:Sn.jM.CONTROL,subAssayRole:t.subAssayRole,onAssignGroup:e.onAssignGroup,roleGroups:null!==(a=e.groupsBySubrole[null!==(n=t.subAssayRole)&&void 0!==n?n:zV.NL])&&void 0!==a?a:[]}))}(t),isDisabled:e.groupPopoverDisabled},d.createElement("span",{className:f()((0,g.iv)(HV.roleOption),(0,g.iv)(HV.groupOption),{[(0,g.iv)(HV.selectedOption)]:e.groupPopoverDisabled&&e.selectedSubrole===t.subAssayRole}),onClick:()=>{e.groupPopoverDisabled&&e.setSelectedSubrole(t.subAssayRole)}},d.createElement(lV.Z,{radius:10,assayRole:t.assayRole,label:(0,cV.Oy)(t)}),d.createElement("p",{className:(0,g.iv)(HV.subroleOptionText)},(0,Mt.kC)(null!==(n=t.subAssayRole)&&void 0!==n?n:"Control"))))})))}const HV=g.mM.create({roleOption:{borderRadius:4,cursor:"pointer",textAlign:"center",border:`1px solid ${Vt.pF}`,":hover":{backgroundColor:Vt.Ro}},selectedOption:{borderColor:Vt.mu},subrolePopover:{width:200},subroleOptionText:{margin:"auto 2px auto 4px"},groupsContainer:{display:"flex",flexWrap:"wrap"},groupOption:{display:"flex",height:28,padding:3,margin:"4px 8px 4px 0"}})
var jV=n(166115)
function PatternDirectionDropdown({selectedDirection:e,onSelectDirection:t,label:n}){return d.createElement("div",null,d.createElement(Fr.Z,{label:n}),d.createElement($r.ZP,{menu:d.createElement(w.ZP,{value:e,width:Nr.zL.FULL},Object.keys(jV.$d).map((e=>d.createElement(N.Z,{key:e,value:e,icon:jV.fN[e].icon,onSelect:t,iconClassName:(0,g.iv)(YV.optionIcon)},d.createElement("p",{className:(0,g.iv)(YV.fillMenuText)},jV.fN[e].name))))),displayName:d.createElement("span",null,d.createElement(pe.Z,{icon:jV.fN[e].icon,className:(0,g.iv)(YV.selectionIcon)}),jV.fN[e].name),alwaysDropDown:!0}))}const YV=g.mM.create({optionIcon:{marginLeft:8},fillMenuText:{marginLeft:4,marginBottom:0},selectionIcon:{marginRight:8,color:Vt.pF}})
function ReplicatesInput({replicates:e,onChange:t}){return d.createElement("div",null,d.createElement(Fr.Z,{label:"Replicates"}),d.createElement(AT.Z,{value:e,min:1,onChange:e=>{t(e.target.numericValue)}}))}function AssignWellsByPattern({existingGroups:e,patternParams:t,setPatternParams:n}){const{startingGroup:a,fillDirection:i,replicates:s,replicateDirection:r}=t
function onChangeParam(e){n({...t,...e})}return d.createElement("div",{className:(0,g.iv)(QV.patternInputs)},d.createElement("div",null,d.createElement(Fr.Z,{label:"Starting group"}),d.createElement($r.ZP,{menu:d.createElement(w.ZP,{value:a,width:Nr.zL.FULL,scrollable:!0},function getStartingGroupOptions(){let t=[1]
e.length>0&&(t=t.concat(e.filter((e=>null!=e)).map((e=>e+1))))
return t.sort(((e,t)=>e-t))}().map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:()=>{onChangeParam({startingGroup:e})}},e)))),displayName:a,alwaysDropDown:!0})),d.createElement(PatternDirectionDropdown,{selectedDirection:i,onSelectDirection:e=>{onChangeParam({fillDirection:e})},label:"Fill direction"}),d.createElement(ReplicatesInput,{replicates:s,onChange:e=>{onChangeParam({replicates:e})}}),d.createElement(PatternDirectionDropdown,{selectedDirection:r,onSelectDirection:e=>{onChangeParam({replicateDirection:e})},label:"Replicate direction"}))}const QV=g.mM.create({patternInputs:{marginTop:16,display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:16}})
function WellRoleGroupAssignment({assayRole:e,onAssignGroup:t,selectedSubrole:n,setSelectedSubrole:a,groupsPerRole:i,applyPattern:s,assignmentMethod:r,setAssignmentMethod:o,patternParams:l,setPatternParams:c}){var u,m,p,h,E
return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(KV.methodRadioButtons)},d.createElement(mm.t,{isVertical:!0,selectedValue:r,options:[{label:"Specify group",value:jV.MB.SPECIFY_GROUP},{label:"Fill by pattern",value:jV.MB.PATTERN}],onChange:e=>{o(e)}})),r===jV.MB.SPECIFY_GROUP&&d.createElement(d.Fragment,null,e===Sn.jM.CONTROL?d.createElement(ControlSubroleButtons,{groupPopoverDisabled:!1,onAssignGroup:t,groupsBySubrole:null!==(u=i[e])&&void 0!==u?u:{}}):d.createElement(WellRoleGroupButtons,{roleGroups:null!==(p=null===(m=i[e])||void 0===m?void 0:m[zV.NL])&&void 0!==p?p:[],assayRole:e,subAssayRole:null,onAssignGroup:t})),r===jV.MB.PATTERN&&d.createElement("div",null,e===Sn.jM.CONTROL&&d.createElement(ControlSubroleButtons,{groupPopoverDisabled:!0,selectedSubrole:n,setSelectedSubrole:a}),d.createElement(AssignWellsByPattern,{existingGroups:(0,Jt.oA)(null!==(E=null===(h=i[e])||void 0===h?void 0:h[zV.NL])&&void 0!==E?E:[]).map((e=>e.group)),patternParams:l,setPatternParams:c}),d.createElement(C.Co,{className:(0,g.iv)(KV.applyButton),text:"Apply",size:C.qE.MEDIUM,buttonStyle:C.ZJ.SECONDARY,onClick:s,disabled:null==l.replicates})))}function WellRoleAssignmentSettings({plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,setPlateMapWithPreview:i}){const s=(0,cV.uv)((0,Jt.oA)(e.wells.map((e=>e.role)))),[r,o]=(0,d.useState)(null),[l,c]=(0,d.useState)(null),[u,m]=(0,d.useState)(jV.MB.SPECIFY_GROUP),[p,h]=(0,d.useState)(jV.iU),E=u!==jV.MB.PATTERN||null==p.replicates||0===p.replicates||null==r||0===n.size,S=(0,d.useCallback)((()=>E?null:(0,MV.XG)(e,(e=>({role:{assayRole:r,group:e,subAssayRole:l}})),p,n)),[r,E,p,e,n,l]);(0,d.useEffect)((()=>{i(S())}),[i,S])
return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(KV.roleOptionsContainer)},zV.fX.map((e=>d.createElement("div",{key:e,className:f()((0,g.iv)(KV.roleOption),(0,g.iv)(KV.assayRoleOption),{[(0,g.iv)(KV.selectedRoleOption)]:r===e}),onClick:()=>{o(e)
c(null)}},d.createElement(lV.Z,{radius:10,assayRole:e,label:zV.wJ[e].abbreviation}),d.createElement("p",{className:(0,g.iv)(KV.roleText)},zV.wJ[e].displayName))))),null!=r&&d.createElement(WellRoleGroupAssignment,{assayRole:r,groupsPerRole:s,setAssignmentMethod:m,onAssignGroup:function assignRoleToSelected(i){t((0,MV.BU)(e,{role:i},n))
a()},applyPattern:function applyPattern(){const e=S()
if(null!=e){t(e)
a()
i(null)}},assignmentMethod:u,patternParams:p,setPatternParams:h,selectedSubrole:l,setSelectedSubrole:c}))}const KV=g.mM.create({roleOptionsContainer:{display:"flex",gap:8,marginBottom:24},roleOption:{flex:1,borderRadius:4,cursor:"pointer",textAlign:"center",border:`1px solid ${Vt.pF}`,":hover":{backgroundColor:Vt.Ro}},assayRoleOption:{paddingTop:4,width:70},selectedRoleOption:{borderColor:Vt.mu,backgroundColor:Vt.Ro},roleText:{marginBottom:4},methodRadioButtons:{marginBottom:16},applyButton:{marginTop:24,float:"right"}})
var JV=n(682932)
const XV=xa.Ps`
  query ContainerSchemaQuery($storableSchemaId: StrictString!) @skipAudit @engComponent(name: INVENTORY) {
    storableSchema(id: $storableSchemaId) {
      ... on ContainerSchemaNode {
        id
        fieldsJson
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,eU=new Set([Hn.FieldType.TEXT,Hn.FieldType.SELECTOR,Hn.FieldType.INTEGER,Hn.FieldType.FLOAT]),tU={[Hn.FieldType.TEXT]:"text",[Hn.FieldType.FLOAT]:"number",[Hn.FieldType.INTEGER]:"number",[Hn.FieldType.SELECTOR]:"list"},nU={[jV.m0]:{attribute:jV.m0,displayName:"Well role",icon:"text",key:jV.m0},[jV.nq]:{attribute:jV.nq,displayName:"Contents",icon:"flask",key:jV.nq}}
function getSelectedDisplayName(e,t){const n=(0,MV.BV)(e),a=t.find((e=>e.key===n))
return d.createElement("span",null,d.createElement(pe.Z,{className:(0,g.iv)(aU.selectedOptionIcon),icon:a.icon}),d.createElement("span",null,a.displayName))}function PlateMapDisplayLayerDropdown({containerSchemaId:e,selectedAttribute:t,setSelectedAttribute:n,additionalAttributeOptions:a}){return d.createElement(Da.ZP,{query:XV,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,variables:{storableSchemaId:e}},(e=>{const i=function getOptions(e){const t=a.map((e=>nU[e]))
if((0,ka.CZ)(e.storableSchema)||"ContainerSchemaNode"!==e.storableSchema.__typename)return t
const n=e.storableSchema.fieldsJson.filter((e=>eU.has(e.fieldType)&&!(0,JV.m)(e))).map((e=>({attribute:e,displayName:e.displayName,icon:tU[e.fieldType],key:e.systemName})))
return[...t,...n]}(e)
return d.createElement($r.ZP,{menu:d.createElement(w.ZP,{value:t,width:Nr.zL.FULL},i.map((e=>d.createElement(N.Z,{key:e.key,value:e.attribute,onSelect:()=>{n(e.attribute)},icon:e.icon,iconClassName:(0,g.iv)(aU.optionIcon)},d.createElement("span",null,e.displayName))))),displayName:getSelectedDisplayName(t,i),alwaysDropDown:!0})}))}const aU=g.mM.create({selectedOptionIcon:{marginRight:8,color:Vt.pF},optionIcon:{margin:"0 8px"}})
function AnnotatePlateSettings({plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,setPlateMapWithPreview:i,displayLayer:s,selectedAttribute:r,setSelectedAttribute:o,cellContainerSchemaId:l,assignmentGroupsById:c,setAssignmentGroupsForAttribute:u}){return d.createElement("div",{className:(0,g.iv)(iU.assignmentSection)},d.createElement("div",{className:(0,g.iv)(iU.layerDropdown)},d.createElement(PlateMapDisplayLayerDropdown,{containerSchemaId:l,additionalAttributeOptions:[jV.m0],selectedAttribute:r,setSelectedAttribute:o})),function renderSettings(){const o={plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,assignmentGroupsById:c,setAssignmentGroupsById:u,selectedField:r}
switch(s){case jV._i.WELL_ROLE:return d.createElement(WellRoleAssignmentSettings,{plateMap:e,onEditPlateMap:t,selectedWellIndices:n,deselectWells:a,setPlateMapWithPreview:i})
case jV._i.SCHEMA_FIELD_SELECTOR:return d.createElement(SelectorFieldAssignmentSettings,{...o,assignmentGroupsById:c})
case jV._i.SCHEMA_FIELD_TEXT:return d.createElement(TextFieldAssignmentSettings,{...o,assignmentGroupsById:c})
case jV._i.SCHEMA_FIELD_NUMBER:return d.createElement(NumberFieldAssignmentSettings,{...o})
default:return null}}())}const iU=g.mM.create({assignmentSection:{padding:16,width:400,minWidth:400,maxHeight:"calc(100vh - 170px)",display:"flex",flexDirection:"column"},layerDropdown:{marginBottom:16}})
function usePlateMapDisplayAttributeState(e,t,n){const a=(0,Pu.Z)(e),[i,s]=(0,d.useState)(t),[r,o]=(0,Ex.Z)({}),l=(0,d.useMemo)((()=>(0,MV.zG)(i)),[i]);(0,d.useEffect)((()=>{n&&!Is()(a,e)&&o({})}),[n,e,a,o]);(0,d.useEffect)((()=>{const t=(0,MV.BV)(i)
Object.keys(r).includes(t)||(async()=>{const n=await(0,MV.pK)(e,i)
o({...r,[t]:n})})()}),[r,o,e,i])
return{assignmentGroupsPerAttribute:r,setAssignmentGroupsPerAttribute:o,selectedAttribute:i,setSelectedAttribute:s,displayLayer:l}}function NumberPlateMapLegend({legendItems:e}){const t=e[0],n=e[1]
return d.createElement("div",{className:(0,g.iv)(sU.legend)},d.createElement("div",{className:(0,g.iv)(sU.numericLegendLabels)},d.createElement("span",null,t.label),d.createElement("span",null,n.label)),d.createElement("div",{className:(0,g.iv)(sU.gradient)}))}function PlateMapLegend({plateMap:e,displayLayer:t,assignmentGroupsById:n,selectedAttribute:a}){const i=(0,MV.Cv)(e,t,n,a),s=t===jV._i.WELL_ROLE?"group":"well"
return 0===i.length?null:t===jV._i.SCHEMA_FIELD_NUMBER?d.createElement(NumberPlateMapLegend,{legendItems:i}):d.createElement("div",{className:(0,g.iv)(sU.legend)},i.map((({label:e,icon:t,count:n},a)=>d.createElement("span",{className:(0,g.iv)(sU.legendItem),key:a},d.createElement("div",{className:(0,g.iv)(sU.legendItemIcon)},t),d.createElement("div",null,d.createElement("p",{className:(0,g.iv)(sU.legendItemName),title:e},e),d.createElement("p",{className:(0,g.iv)(sU.legendItemSubtext)},`${n} ${(0,de._6)(n,s)}`))))))}const sU=g.mM.create({legend:{padding:8,borderRadius:4,border:`1px solid ${Vt.tN}`,marginTop:8,whiteSpace:"nowrap",overflowY:"hidden",width:"100%"},legendItem:{display:"inline-flex",marginRight:24},legendItemIcon:{margin:"auto"},legendItemName:{fontWeight:_n.KB,marginBottom:0,marginLeft:8,maxWidth:175,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},legendItemSubtext:{color:Vt.pp,marginLeft:8,marginBottom:0},numericLegendLabels:{marginBottom:"4px",display:"flex",justifyContent:"space-between",color:Vt.pp},gradient:{background:"linear-gradient(45deg, rgba(0, 13, 181, 0.1), rgba(0, 13, 181, 1))",height:"20px",width:"100%"}})
function MulticolorStripeWellRenderer({cx:e,cy:t,radius:n,well:a}){var i
return d.createElement(ZV.Z,{cx:e,cy:t,radius:n,colors:a.displayInfo.colors,labelOverride:null!==(i=a.displayInfo.label)&&void 0!==i?i:void 0,fillOpacity:a.displayInfo.opacity})}function EmptyWell({cx:e,cy:t,wellSize:n,isHovered:a,isSelected:i}){return d.createElement("circle",{cx:e,cy:t,r:.5*n,fill:a?Vt.Ro:Vt.Cj,stroke:i?Vt.Ej:Vt.pF,strokeWidth:i?2:1})}function WellRendererWrapper(e){const{cx:t,cy:n,wellSize:a,isHovered:i,isSelected:s,isPreview:r,well:o,renderWell:l}=e
if(null==o.displayInfo)return d.createElement(EmptyWell,{...e})
const c=.5*a,u=i||s||r,m=s?2:0,p=s?r?Vt.t0:Vt.Ej:"none",h=i?.2:r?.35:0
return d.createElement("g",null,l({cx:t,cy:n,radius:s?.8*c:c,well:o}),u&&d.createElement("circle",{cx:t,cy:n,r:c,fill:Vt.Cj,fillOpacity:h,stroke:p,strokeWidth:m}))}const rU={[jV._i.WELL_ROLE]:function WellRoleWellRenderer({cx:e,cy:t,radius:n,well:a}){return d.createElement(lV.Z,{cx:e,cy:t,radius:n,assayRole:a.role.assayRole,label:a.displayInfo.label})},[jV._i.REAGENT]:function MulticolorStripedWellRendererWithSquareListIcon({cx:e,cy:t,radius:n,well:a}){var i
return d.createElement(ZV.Z,{cx:e,cy:t,radius:n,colors:a.displayInfo.colors,labelOverride:null!==(i=a.displayInfo.label)&&void 0!==i?i:void 0,iconOverride:"square-list"})},[jV._i.SCHEMA_FIELD_TEXT]:MulticolorStripeWellRenderer,[jV._i.SCHEMA_FIELD_SELECTOR]:MulticolorStripeWellRenderer,[jV._i.SCHEMA_FIELD_NUMBER]:MulticolorStripeWellRenderer}
function PlateMapWellView({cellSize:e,wellSize:t,isHovered:n,isSelected:a,isPreview:i,well:s,displayLayer:r,handleMouseDown:o,handleMouseUp:l,handleMouseEnter:c}){const{row:u,column:m}=s.position,p={cx:e*(m+.5),cy:e*(u+.5),wellSize:t,isHovered:n,isSelected:a,isPreview:i,well:s},h=rU[r]
return d.createElement("g",{onMouseDown:e=>{e.preventDefault()
o(e)},onMouseUp:l,onMouseEnter:c},d.createElement("rect",{x:e*m,y:e*u,width:e,height:e,fill:n?Vt.tN:Vt.bs}),d.createElement(WellRendererWrapper,{...p,renderWell:e=>d.createElement(h,{...e})}))}const oU=24,lU={dominantBaseline:"central",textAnchor:"middle"}
function PlateMapDimensionLabel({x:e,y:t,label:n,hitboxWidth:a,hitboxHeight:i,onMouseEnter:s,onClick:r}){return d.createElement("g",{transform:`translate(${e}, ${t})`,onMouseEnter:s,onClick:r},d.createElement("rect",{x:-a/2,y:-i/2,width:a,height:i,fill:"none",pointerEvents:"all"}),d.createElement("text",{className:(0,g.iv)(cU.text),x:0,y:0,...lU},n))}function PlateMapView({plateMap:e,isViewOnly:t,selectedWellIndices:n,setSelectedWellIndices:a,assignmentGroupsById:i,displayLayer:s,showSelectedAsPreview:r,selectedAttribute:o}){const{size:l}=e,c=28+2*function getWellPadding(e){return e<=4?8:e>12?1:4}(l.numRows),u=c*l.numColumns+48,m=48+c*l.numRows,[p,h]=(0,d.useState)(new Set),[g,E]=(0,d.useState)(null),f=(0,MV.po)(s,e,i,o)
function selectHoveredWells(){if([...p].every((e=>n.has(e)))){const e=[...n].filter((e=>!p.has(e)))
a(new Set(e))}else a(new Set([...n,...p]))}return d.createElement("svg",{width:"100%",viewBox:`0 0 ${u} ${m}`,style:{minWidth:`${u}px`},cursor:t?"auto":"pointer"},d.createElement("rect",{x:"0",y:"0",width:u,height:m,fill:Vt.bs,onMouseLeave:function clearHoveredWells(){E(null)
h(new Set)}}),d.createElement("g",{transform:"translate(36, 24)"},[...Array(l.numColumns)].map(((e,n)=>d.createElement(PlateMapDimensionLabel,{key:`c${n}`,x:c*(n+.5),y:0,label:(0,JF.mh)(n),hitboxWidth:c,hitboxHeight:oU,onMouseEnter:()=>{!function onHoverColumn(e){if(!t){const t=(0,MV.r9)({row:0,column:e},{row:l.numRows-1,column:e},l)
h(new Set(t))}}(n)},onClick:selectHoveredWells})))),d.createElement("g",{transform:"translate(24, 36)"},[...Array(l.numRows)].map(((e,n)=>d.createElement(PlateMapDimensionLabel,{key:`r${n}`,x:0,y:c*(n+.5),label:(0,JF.mI)(n),hitboxWidth:oU,hitboxHeight:c,onMouseEnter:()=>{!function onHoverRow(e){if(!t){const t=(0,MV.r9)({row:e,column:0},{row:e,column:l.numColumns-1},l)
h(new Set(t))}}(n)},onClick:selectHoveredWells})))),d.createElement("g",{transform:"translate(36,36)"},f.wells.map(((e,a)=>d.createElement(PlateMapWellView,{key:a,cellSize:c,wellSize:28,isHovered:p.has(a),isSelected:n.has(a),isPreview:r&&n.has(a),well:e,displayLayer:s,handleMouseDown:()=>{!function handleWellMouseDown(e){t||E(e)}(a)},handleMouseUp:()=>{!function handleWellMouseUp(e){if(!t){E(null)
selectHoveredWells()
h(new Set([e]))}}(a)},handleMouseEnter:()=>{!function handleMouseEnter(e){if(!t)if(null==g)h(new Set([e]))
else{const t=(0,MV.X1)(g,l),n=(0,MV.X1)(e,l),a=(0,MV.r9)(t,n,l)
h(new Set(a))}}(a)}})))))}const cU=g.mM.create({text:{cursor:"pointer"}})
function AnnotatePlateModal({existingPlateMap:e,initialSelectedWellIndices:t,onRequestClose:n,onRequestSubmit:a,cellContainerSchemaId:i}){var s,r,o
const[l,c]=(0,d.useState)(e),[u,m]=(0,d.useState)(t),[p,h]=(0,d.useState)(null),{assignmentGroupsPerAttribute:E,setAssignmentGroupsPerAttribute:f,selectedAttribute:S,setSelectedAttribute:y,displayLayer:b}=usePlateMapDisplayAttributeState(l,jV.m0,!1)
function deselectWells(){m(new Set)}return d.createElement(et.ZP,{title:"Annotate plate",fullWidth:!0,buttons:[{text:"Save",submit:!0,style:C.ZJ.SECONDARY}],onRequestClose:n,onRequestSubmit:()=>{a(l)}},d.createElement("div",{className:(0,g.iv)(dU.stepContents)},d.createElement("div",{className:(0,g.iv)(dU.previewSection)},d.createElement("div",{className:(0,g.iv)(dU.previewContainer)},d.createElement("div",{className:(0,g.iv)(dU.previewHeader)},d.createElement("p",{className:(0,g.iv)(dU.numSelected)},`${u.size} ${(0,de._6)(u.size,"well")} selected`),d.createElement(C.Co,{icon:"close",size:C.qE.MINI,buttonStyle:C.ZJ.TERTIARY_GRAY,text:"Clear wells",onClick:function handleClickClear(){let e=l
if(b===jV._i.WELL_ROLE)e=(0,MV.BU)(l,{role:null},u)
else if(b===jV._i.SCHEMA_FIELD_SELECTOR)e=(0,MV.cT)(l,S,{schemaFieldSelectorOptionIds:[]},u)
else if(b===jV._i.SCHEMA_FIELD_TEXT)e=(0,MV.cT)(l,S,{value:null,url:null},u)
else{if(b!==jV._i.SCHEMA_FIELD_NUMBER)return
{const t=S.fieldType===Hn.FieldType.INTEGER?{integerValue:null,value:null}:{floatValue:null,value:null}
e=(0,MV.cT)(l,S,t,u)}}c(e)
deselectWells()},disabled:0===u.size})),d.createElement("div",{className:(0,g.iv)(dU.scrollablePlateMap)},d.createElement(PlateMapView,{plateMap:null!=p?p:l,selectedWellIndices:u,setSelectedWellIndices:m,assignmentGroupsById:null!==(s=E[(0,MV.BV)(S)])&&void 0!==s?s:{},isViewOnly:!1,displayLayer:b,showSelectedAsPreview:null!=p,selectedAttribute:S})),d.createElement(PlateMapLegend,{plateMap:l,displayLayer:b,assignmentGroupsById:null!==(r=E[(0,MV.BV)(S)])&&void 0!==r?r:{},selectedAttribute:S}))),d.createElement(AnnotatePlateSettings,{plateMap:l,onEditPlateMap:c,selectedWellIndices:u,deselectWells,setPlateMapWithPreview:h,displayLayer:b,cellContainerSchemaId:i,selectedAttribute:S,setSelectedAttribute:y,assignmentGroupsById:null!==(o=E[(0,MV.BV)(S)])&&void 0!==o?o:{},setAssignmentGroupsForAttribute:function setAssignmentGroupsForSelectedAttribute(e){f({...E,[(0,MV.BV)(S)]:e})}})))}const dU=g.mM.create({stepContents:{display:"flex"},previewSection:{paddingRight:16,borderRight:`1px solid ${Vt.tN}`,flex:1,overflow:"auto"},previewContainer:{maxWidth:900,margin:"auto"},previewHeader:{display:"flex",justifyContent:"space-between",marginBottom:8},scrollablePlateMap:{overflow:"auto"},numSelected:{color:Vt.pp,margin:"auto 0"}})
function ClearWellsDropdownContent({schemas:e,numSources:t}){const n=(0,d.useRef)(null),[a,i]=(0,d.useState)(!1);(0,d.useEffect)((()=>{n.current&&n.current.clientWidth<n.current.scrollWidth&&i(!0)}),[n])
return d.createElement("div",{className:(0,g.iv)(mU.clearReagentOption)},e.map((e=>d.createElement("div",{key:e.id,className:(0,g.iv)(mU.swatch),style:{backgroundColor:e.color}}))),d.createElement("div",{className:(0,g.iv)(mU.schemasWrapper)},d.createElement("div",{className:(0,g.iv)(mU.schemaNamesWrapper)},d.createElement("div",{className:(0,g.iv)(mU.schemaNames),ref:n},e.map((e=>e.name)).join("; ")),a&&d.createElement(Oe.Z,{renderContent:()=>e.map((e=>d.createElement("div",{key:e.id},e.name)))},d.createElement("div",{className:(0,g.iv)(mU.seeMore)},"See more"))),d.createElement("div",{className:(0,g.iv)(mU.sourcesCount)},`${t} ${(0,de._6)(t,"source")}`)))}const uU="CLEAR_ALL_SENTINEL"
function ClearWellsDropdown({selectedWellIndices:e,plateMap:t,reagentGroupsById:n,removeReagentGroups:a,removeAllReagentGroups:i}){var s
const[r,o]=(0,d.useState)(!1),l=[...e].flatMap((e=>t.wells[e].reagents)),c=(0,Jt.m8)(l.map((e=>[e.id,e]))),u={},m={}
for(const e of Object.values(c)){const t=(0,MV.oP)(e),n=(0,Jt.SL)([...t]),a=n.join("-")
null!==(s=u[a])&&void 0!==s||(u[a]=0)
u[a]++
m[a]=n}const p=Object.keys(m)
return d.createElement(I.ZP,{className:(0,g.iv)(mU.clearWellsDropdown),closeOnInsideClick:1===p.length,menu:d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.XXLARGE},d.createElement(jI.Z,null,p.map((e=>d.createElement(N.Z,{value:e,key:e,onSelect:()=>{a(new Set(m[e]))},shouldEllipsize:!0},d.createElement(ClearWellsDropdownContent,{schemas:m[e].map((e=>n[e])),numSources:u[e]}))))),d.createElement(jI.Z,null,d.createElement(N.Z,{value:uU,key:uU,onSelect:()=>{i()
o(!1)}},d.createElement("div",{className:(0,g.iv)(mU.clearAll)},"Remove all sources")))),onToggle:t=>{(!t||0!==e.size&&0!==p.length)&&o(t)},isOpen:r},d.createElement(C.Co,{disabled:0===e.size||0===p.length,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,icon:"xmark",text:`Clear ${(0,de._6)(e.size,"well")}`,isDropdown:!0}))}const mU=g.mM.create({clearWellsDropdown:{width:"120px"},clearReagentOption:{display:"flex",alignItems:"stretch"},swatch:{width:"4px",marginRight:"2px",flex:"0 0 4px"},schemasWrapper:{marginLeft:"6px",minWidth:"0px"},schemaNamesWrapper:{display:"flex",minWidth:"0px"},schemaNames:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},seeMore:{color:Vt.t0,cursor:"pointer"},sourcesCount:{color:Vt.TG},clearAll:{color:Vt.Zl}})
var pU=n(878385)
function SelectItemsFromWorklistModal({onRequestClose:e,onRequestSubmit:t,validateItem:n}){const[a,i]=(0,d.useState)(null),[s,r]=(0,d.useState)([]),o=[{text:"Cancel",cancel:!0},{text:`Add ${s.length} ${(0,de._6)(s.length,"item")}`,style:C.ZJ.SECONDARY,submit:!0,disabled:0===s.length,dataTestAttrs:{component:"AddFromWorklistModal",key:vb.Z.NEXT}}]
return d.createElement(et.ZP,{title:"Add from worklist",onRequestClose:e,buttons:o,onRequestSubmit:()=>{t({worklistSummary:a,selectedWorklistItems:s})}},d.createElement(SelectItemsFromWorklistView,{selectedWorklistItems:s,setSelectedWorklistItems:r,setWorklistSummary:i,validateItem:n,worklistSummary:a}))}function FillPlateFromWorklistModal({onRequestClose:e,onRequestSubmit:t}){return d.createElement(SelectItemsFromWorklistModal,{onRequestClose:e,onRequestSubmit:t,validateItem:function validateFillPlateWorklistItem(e){var t,n
let a,i=!1
if((0,ka.CZ)(e)){i=!0
a="You don't have permissions to view this item."}else if((0,yc.ZP)(e)){i=!0
a="This item is archived."}else if("ContainerNode"===e.__typename);else if("BatchNode"===e.__typename||"PlateNode"===e.__typename){i=!0
a="Plates and batches cannot be used to fill plates."}else if(null===(n=null===(t=e.tagSchema)||void 0===t?void 0:t.isContainable)||void 0===n||!n){i=!0
a="This item is not containable."}return{isSelectorDisabled:i,tooltipText:a}}})}var hU=n(970196),gU=n(391918)
const EU={offset:0,limit:10,sorts:[{key:Kn.bo.SORT_RELEVANCE_KEY,reverse:!1}],context:Kn.ci.FOR_WRITE_ACTION}
var fU
!function(e){e.ENTITIES="ENTITIES"
e.CONTAINERS="CONTAINERS"}(fU||(fU={}))
const SU={name:fU.ENTITIES,value:fU.ENTITIES,disabled:!0},yU={name:fU.CONTAINERS,value:fU.CONTAINERS,disabled:!0}
function FillPlateSearchInputDefaultDropdown({autoFocusOnEmptyQuery:e,setAutoFocusOnEmptyQuery:t,isMenuOpen:n,setIsMenuOpen:a,query:i,setQuery:s,onAddItems:r}){return d.createElement(I.ZP,{isOpen:n,menu:d.createElement(w.ZP,{width:w.ZP.WIDTHS.XLARGE,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(N.Z,{isDisabled:!0},"Type to search"),d.createElement(N.Z,{icon:"worklist-add",onSelect:async function handleFillPlateFromWorklist(){const e=await(0,Xn.Z)(FillPlateFromWorklistModal,{})
if(null!=e){const t=[],n={}
for(const a of e.selectedWorklistItems)if("ContainerNode"===a.__typename){const e={type:jV.W2.CONTAINER,id:a.id,groupId:a.storableSchema.id,contents:[],transferQuantity:{value:null,units:null}}
null==a.parentStorable||(0,ka.CZ)(a.parentStorable)||"PlateNode"!==a.parentStorable.__typename||(e.parentPlateId=a.parentStorable.id)
if(0===a.contents.length)n[a.storableSchema.id]={name:a.storableSchema.name,iconId:a.storableSchema.iconId}
else for(const t of a.contents){e.contents.push({type:jV.W2.BIOENTITY,id:t.containedItem.id,groupId:t.containedItemTagSchema.id,transferQuantity:null,sourceConcentration:t.concentrationJson})
n[t.containedItemTagSchema.id]={name:t.containedItemTagSchema.name,iconId:t.containedItemTagSchema.iconId}}t.push(e)}else if("BatchNode"!==a.__typename&&"PlateNode"!==a.__typename){t.push({type:jV.W2.BIOENTITY,id:a.id,groupId:a.tagSchema.id,transferQuantity:{value:null,units:null},sourceConcentration:null})
n[a.tagSchema.id]={name:a.tagSchema.name,iconId:a.tagSchema.iconId}}r(t,n)}}},"Add from worklist"),d.createElement(N.Z,{icon:"table",onSelect:Jt.ZT},"Add from structured table"))},d.createElement(or.Z,{autoFocus:e,type:Mo.Lq.TEXT,className:(0,g.iv)(bU.input),onBlur:()=>{a(!1)},onChange:({target:{value:e}})=>{a(!1)
t(!0)
s(e)},onFocus:()=>{a(!0)},placeholder:"Search for entities and containers",value:i}))}function getOptionDatasFromResponse(e){const[t,n]=(0,Jt.uK)(e.ids,(e=>ea.ZP.isBiologicalEntity(e))),a=t.map((t=>{const n=e.fileSummariesById[t]
return{name:n.name,icon:n.tagSchema.iconId,value:{item:n,name:n.name,type:ea.ZP.apiIdToType(t),id:t}}})),i=n.map((t=>{var n,a,i,s
const r=e.storableSummariesById[t],o={...r,containedItems:null!==(a=null===(n=e.storableSummaryExtras.containedItemsByContainerId)||void 0===n?void 0:n[t])&&void 0!==a?a:[],containableConcentrations:null!==(s=null===(i=e.storableSummaryExtras.containableConcentrationsByContainerId)||void 0===i?void 0:i[t])&&void 0!==s?s:{}}
return{name:r.name,icon:r.storableSchema.iconId,value:{item:o,name:r.name,type:ea.ZP.apiIdToType(t),id:t}}}))
return[...a.length>0?[SU]:[],...a,...i.length>0?[yU]:[],...i]}function FillPlateSearchInputInner({onRemove:e,onSelect:t,query:n,setQuery:a,selectedApiIds:i}){const s=(0,pU.ww)().filter((e=>e.isContainable)).map((e=>e.id)),r=(0,pU.BR)().map((e=>e.id))
return d.createElement(nx.ZP,{autoFocus:!0,chipClass:sc.Z,className:(0,g.iv)(bU.input),doSearch:nx.Bf,fetchParams:{...EU,filters:[{...(0,Kn.QW)(Kn.Vm.TYPES),value:[...(0,tw.getRegistrySupportedTypes)(),st.CONTAINER]},{...(0,Kn.QW)(Kn.Vm.SCHEMA),value:[...s,...r]}]},getChipProps:e=>({id:e.id,isLink:!1,size:Za.TK.MINI}),getOptionDatasFromResponse,hideChips:!0,isMulti:!0,isValueEqual:(e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id),onQueryChange:e=>{a(e.target.value)},onRemove:t=>{e(t.id)},onSelect:e=>{var n
let a
const i={}
if(ea.ZP.isContainer(e.id)){a={type:jV.W2.CONTAINER,id:e.id,groupId:e.item.storableSchema.id,contents:[],transferQuantity:{value:null,units:null}}
null!=e.item.parentStorableId&&ea.ZP.isPlate(e.item.parentStorableId)&&(a.parentPlateId=e.item.parentStorableId)
if(0===e.item.containedItems.length)i[e.item.storableSchema.id]={name:e.item.storableSchema.name,iconId:e.item.storableSchema.iconId}
else for(const t of e.item.containedItems){a.contents.push({type:jV.W2.BIOENTITY,id:t.id,groupId:t.tagSchema.id,transferQuantity:null,sourceConcentration:null!==(n=e.item.containableConcentrations[t.id])&&void 0!==n?n:null})
i[t.tagSchema.id]={name:t.tagSchema.name,iconId:t.tagSchema.iconId}}}else{a={type:jV.W2.BIOENTITY,id:e.id,groupId:e.item.tagSchema.id,transferQuantity:{value:null,units:null},sourceConcentration:null}
i[e.item.tagSchema.id]={name:e.item.tagSchema.name,iconId:e.item.tagSchema.iconId}}t(a,i)},query:n,placeholder:"",renderOptionContent:e=>Object.values(fU).includes(e.value)?d.createElement(gU.Z,null,e.name):d.createElement(hU.ZP,{optionData:e}),searchOnEmptyQuery:!1,searchURL:Kn.RV,value:i.map((e=>({id:e})))})}function FillPlateSearchInput({onSingleSelect:e,onBulkAdd:t,selectedApiIds:n}){const[a,i]=(0,d.useState)(!1),[s,r]=(0,d.useState)(!1),[o,l]=(0,d.useState)("")
return 0===o.length?d.createElement(FillPlateSearchInputDefaultDropdown,{autoFocusOnEmptyQuery:a,setAutoFocusOnEmptyQuery:i,isMenuOpen:s,setIsMenuOpen:r,query:o,setQuery:l,onAddItems:t}):d.createElement(FillPlateSearchInputInner,{onRemove:Jt.ZT,onSelect:e,query:o,setQuery:l,selectedApiIds:n})}const bU=g.mM.create({input:{flex:1,maxWidth:"300px"}})
function BioentityOrEmptyContainerReagentChip({color:e,onRemove:t,reagent:n}){return d.createElement("div",{className:(0,g.iv)(TU.wrapper)},d.createElement("div",{className:(0,g.iv)(TU.swatch),style:{backgroundColor:e}}),d.createElement(sc.Z,{size:Za.TK.MINI,id:n.id,onRemove:t}))}function ContainerReagentWithContentsChip({onRemove:e,reagent:t,reagentGroupsById:n}){const a=(0,Jt.m8)(t.contents.map((e=>[e.id,e])))
return d.createElement("div",{className:(0,g.iv)(TU.wrapper)},Object.values(a).map((e=>d.createElement("div",{className:(0,g.iv)(TU.swatch),key:e.id,style:{backgroundColor:n[e.groupId].color}}))),d.createElement(NA.Z,{size:Za.TK.MINI,id:t.id,onRemove:e,popoverContainedItemRenderer:e=>{const t=a[e]
return d.createElement("div",{className:(0,g.iv)(TU.popoverChip)},d.createElement(BioentityOrEmptyContainerReagentChip,{color:n[t.groupId].color,reagent:t}))}}))}function ReagentChip({onRemove:e,reagent:t,reagentGroupsById:n}){return d.createElement(d.Fragment,null,t.type===jV.W2.BIOENTITY||0===t.contents.length?d.createElement(BioentityOrEmptyContainerReagentChip,{color:n[t.groupId].color,onRemove:e,reagent:t}):d.createElement(ContainerReagentWithContentsChip,{onRemove:e,reagent:t,reagentGroupsById:n}))}const TU=g.mM.create({swatch:{width:"4px",height:"24px",marginRight:"4px"},wrapper:{display:"flex"},popoverChip:{":not(:last-child)":{paddingBottom:"4px"}}})
function OrderableReagentListItem({isFirstReagent:e,isLastReagent:t,onMoveDown:n,onMoveUp:a,onRemove:i,reagent:s,reagentGroupsById:r,reagentOrdinal:o}){const[l,c]=(0,d.useState)(!1)
return d.createElement("div",{className:(0,g.iv)(vU.reagentOuterWrapper),onMouseEnter:()=>{c(!0)},onMouseLeave:()=>{c(!1)}},d.createElement("div",{className:(0,g.iv)(vU.reagentInnerWrapper)},d.createElement("div",{className:(0,g.iv)(vU.reagentChipWrapper)},d.createElement("div",{className:(0,g.iv)(vU.number)},o),d.createElement(ReagentChip,{onRemove:i,reagent:s,reagentGroupsById:r})),l&&d.createElement("div",{className:(0,g.iv)(vU.iconsWrapper)},d.createElement(pe.Z,{icon:"chevron-up",className:f()((0,g.iv)(vU.icon),{[(0,g.iv)(vU.disabled)]:e}),onClick:a}),d.createElement(pe.Z,{icon:"chevron-down",className:f()((0,g.iv)(vU.icon),{[(0,g.iv)(vU.disabled)]:t}),onClick:n}))))}function OrderableReagentList({onRemoveReagent:e,onReorderReagents:t,previewedReagentsById:n,previewedReagentIdOrdering:a,reagentGroupsById:i}){const[s,r]=(0,d.useState)(!1),o=s?a:a.slice(0,4)
return d.createElement("div",{className:(0,g.iv)(vU.wrapper)},o.map(((s,r)=>d.createElement(OrderableReagentListItem,{key:r,isFirstReagent:0===r,isLastReagent:r===a.length-1,onMoveDown:()=>{r!==a.length-1&&t((0,cm.e6)(a,a[r],r+1))},onMoveUp:()=>{0!==r&&t((0,cm.e6)(a,a[r],r-1))},onRemove:()=>{e(s)},reagent:n[s],reagentGroupsById:i,reagentOrdinal:r+1}))),a.length>4&&d.createElement(C.Co,{buttonStyle:C.ZJ.TEXT,size:C.qE.SMALL,className:(0,g.iv)(vU.button),text:s?"Show less":`+${a.length-4} more`,onClick:()=>{r(!s)}}))}const vU=g.mM.create({wrapper:{minWidth:"300px"},reagentOuterWrapper:{display:"flex",alignItems:"center",marginBottom:"4px",":hover":{backgroundColor:Ab.Il.GRAY_100}},reagentInnerWrapper:{padding:"4px",flex:"1 0 auto",display:"flex",alignItems:"center",justifyContent:"space-between"},reagentChipWrapper:{display:"flex",alignItems:"center"},number:{..._n.cf,fontWeight:_n.KB,marginRight:"8px"},iconsWrapper:{border:`1px solid ${Vt.pF}`,borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:Vt.Cj,color:Vt.pp,padding:"4px",height:"24px",width:"48px"},icon:{height:"16px",width:"16px",cursor:"pointer"},disabled:{color:Vt.pF,cursor:"default"},button:{paddingLeft:"0px",paddingRight:"0px"}})
var CU
!function(e){e.ADD_REAGENTS_AND_SCHEMAS="ADD_REAGENTS_AND_SCHEMAS"
e.APPLY_REAGENTS="APPLY_REAGENTS"
e.REMOVE_ALL_APPLIED_REAGENT_GROUPS="REMOVE_ALL_APPLIED_REAGENT_GROUPS"
e.REMOVE_APPLIED_REAGENT_GROUPS="REMOVE_APPLIED_REAGENT_GROUPS"
e.REMOVE_PREVIEWED_REAGENTS="REMOVE_PREVIEWED_REAGENTS"
e.REORDER_REAGENTS="REORDER_REAGENTS"
e.SET_PATTERN_PARAMS="SET_PATTERN_PARAMS"
e.SET_SELECTED_WELLS="SET_SELECTED_WELLS"
e.SET_WELL_ASSIGNMENT_METHOD="SET_WELL_ASSIGNMENT_METHOD"}(CU||(CU={}))
function updateDependentState(e){return(0,tm.Uy)(e,(e=>{e.previewedReagentsById=function hydrateReagentLabels(e){return e.wellAssignmentMethod===jV.MB.SPECIFY_GROUP?(0,Jt.m8)(Object.values(e.previewedReagentsById).map((e=>[e.id,(0,ig.C)(e,"label")]))):(0,Jt.m8)(e.previewedReagentIdOrdering.map(((t,n)=>[t,{...e.previewedReagentsById[t],label:n+1}])))}(e)
e.reagentGroupsById=function filterUnusedReagentGroups(e){const t=(0,MV.HL)([...e.plateMap.wells.flatMap((e=>e.reagents)),...Object.values(e.previewedReagentsById)]),n={}
for(const a of Object.keys(e.reagentGroupsById))t.has(a)&&(n[a]=e.reagentGroupsById[a])
return n}(e)
e.previewPlateMap=function makePreviewPlateMap(e){return(0,tm.Uy)(e.plateMap,(t=>{if(e.wellAssignmentMethod===jV.MB.SPECIFY_GROUP)for(const n of e.selectedWellIndices)t.wells[n].reagents.push(...Object.values(e.previewedReagentsById))
else if(null!=e.patternParams.replicates&&e.patternParams.replicates>0&&e.selectedWellIndices.size>0){const n=(0,MV.XG)(t,((n,a)=>{if(n>e.previewedReagentIdOrdering.length)return{}
{const i=e.previewedReagentsById[e.previewedReagentIdOrdering[n-1]]
return{reagents:[...t.wells[a].reagents.filter((e=>e.id!==i.id)),i]}}}),e.patternParams,e.selectedWellIndices)
t.wells=n.wells}}))}(e)}))}function useFillPlateModalReducer_reducer(e,t){switch(t.type){case CU.ADD_REAGENTS_AND_SCHEMAS:{const{reagents:n,schemaDataById:a}=t,i=new Set(e.previewedReagentIdOrdering),s=new Set(Object.keys(e.reagentGroupsById)),r=(0,MV.Lq)(e.reagentGroupsById),o={...e.previewedReagentsById,...(0,Jt.m8)(n.map((e=>[e.id,e])))},l=[...e.previewedReagentIdOrdering,...n.map((e=>e.id)).filter((e=>!i.has(e)))],c={...e.reagentGroupsById,...(0,Jt.m8)(Object.keys(a).filter((e=>!s.has(e))).map((e=>[e,{id:e,name:a[e].name,color:r.next().value,value:{id:e,iconId:a[e].iconId}}])))}
return updateDependentState({...e,previewedReagentsById:o,previewedReagentIdOrdering:l,reagentGroupsById:c})}case CU.APPLY_REAGENTS:{const t={...e.previewPlateMap,wells:e.previewPlateMap.wells.map((e=>({...e,reagents:e.reagents.map((e=>(0,ig.C)(e,"label")))})))}
return{...e,previewPlateMap:t,plateMap:t,previewedReagentsById:{},previewedReagentIdOrdering:[],selectedWellIndices:new Set}}case CU.REMOVE_ALL_APPLIED_REAGENT_GROUPS:return updateDependentState({...e,plateMap:(0,MV.BU)(e.plateMap,{reagents:[]},e.selectedWellIndices)})
case CU.REMOVE_APPLIED_REAGENT_GROUPS:{const{reagentGroupIds:n}=t,a={...e.plateMap}
for(const t of e.selectedWellIndices)a.wells[t].reagents=e.plateMap.wells[t].reagents.filter((e=>{const t=(0,MV.oP)(e)
return!(0,Jt.OL)(t,n)}))
return updateDependentState({...e,plateMap:a})}case CU.REMOVE_PREVIEWED_REAGENTS:return updateDependentState({...e,previewedReagentsById:(0,ig.C)(e.previewedReagentsById,...t.reagentIds),previewedReagentIdOrdering:e.previewedReagentIdOrdering.filter((e=>!t.reagentIds.includes(e)))})
case CU.REORDER_REAGENTS:return updateDependentState({...e,previewedReagentIdOrdering:t.reagentIdOrdering})
case CU.SET_PATTERN_PARAMS:return updateDependentState({...e,patternParams:t.patternParams})
case CU.SET_SELECTED_WELLS:return updateDependentState({...e,selectedWellIndices:t.selectedWells})
case CU.SET_WELL_ASSIGNMENT_METHOD:return updateDependentState({...e,wellAssignmentMethod:t.wellAssignmentMethod})
default:return e}}const IU=g.mM.create({semibold:{fontWeight:_n.KB}}),wU={[jV.MB.SPECIFY_GROUP]:d.createElement(d.Fragment,null,"Add ",d.createElement("span",{className:(0,g.iv)(IU.semibold)},"all")," sources to each well"),[jV.MB.PATTERN]:d.createElement(d.Fragment,null,"Add ",d.createElement("span",{className:(0,g.iv)(IU.semibold)},"one")," source to each well by pattern")}
function WellAssignmentMethodSelector({wellAssignmentMethod:e,setWellAssignmentMethod:t}){return d.createElement(kt.Z,{selection:e,onChangeSelection:e=>{t(e)},size:C.qE.LARGE,isFullWidth:!0,options:[{id:jV.MB.SPECIFY_GROUP,buttonProps:{text:wU[jV.MB.SPECIFY_GROUP]}},{id:jV.MB.PATTERN,buttonProps:{text:wU[jV.MB.PATTERN]}}],wrap:!0})}var NU=n(676328)
function FillPlateReagentStep({dispatch:e,initialPlateMap:t,patternParams:n,previewPlateMap:a,previewedReagentsById:i,previewedReagentIdOrdering:s,reagentGroupsById:r,selectedWellIndices:o,wellAssignmentMethod:c}){const[u,m]=(0,d.useState)((()=>t.wells.some((e=>null!=e.role)))),p=(0,d.useMemo)((()=>t.wells.every((e=>null==e.role))),[t]),h=u?jV._i.WELL_ROLE:jV._i.REAGENT,E=u?jV.m0:jV.nq
return d.createElement("div",{className:(0,g.iv)(AU.wrapper)},d.createElement("div",{className:(0,g.iv)(AU.mapPaneWrapper)},d.createElement("div",{className:(0,g.iv)(AU.mapPane)},d.createElement("div",{className:(0,g.iv)(AU.mapHeader)},d.createElement("span",{className:(0,g.iv)(AU.wellsSelectedText)},`${o.size} ${(0,de._6)(o.size,"well")} selected`),d.createElement("div",null,d.createElement(C.Co,{className:(0,g.iv)(AU.previewWellRolesButton),disabled:p,buttonStyle:u?C.ZJ.TERTIARY_BLUE_POWDER:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:()=>{m(!u)},text:"Preview well roles: "+(u?"On":"Off"),icon:"template_collection"}),d.createElement(ClearWellsDropdown,{selectedWellIndices:o,plateMap:t,reagentGroupsById:r,removeReagentGroups:t=>{e({type:CU.REMOVE_APPLIED_REAGENT_GROUPS,reagentGroupIds:t})},removeAllReagentGroups:()=>{e({type:CU.REMOVE_ALL_APPLIED_REAGENT_GROUPS})}}))),d.createElement(PlateMapView,{plateMap:a,isViewOnly:!1,selectedWellIndices:o,setSelectedWellIndices:t=>{e({type:CU.SET_SELECTED_WELLS,selectedWells:t})},assignmentGroupsById:r,displayLayer:h,showSelectedAsPreview:s.length>0,selectedAttribute:E}),d.createElement(PlateMapLegend,{plateMap:t,displayLayer:h,assignmentGroupsById:r,selectedAttribute:E}))),d.createElement("div",{className:(0,g.iv)(AU.border)}),d.createElement("div",{className:(0,g.iv)(AU.reagentSourceView)},d.createElement("div",{className:(0,g.iv)(AU.searchHeaderText)},"Select wells in the plate, then add contents to them by defining a source"),d.createElement(NU.Z,{id:"fill-plate-reagent-search",label:"Add sources",labelStyle:Mo.gF.LABEL},d.createElement(FillPlateSearchInput,{onSingleSelect:(t,n)=>{s.includes(t.id)?e({type:CU.REMOVE_PREVIEWED_REAGENTS,reagentIds:[t.id]}):e({type:CU.ADD_REAGENTS_AND_SCHEMAS,reagents:[t],schemaDataById:n})
m(!1)},onBulkAdd:(t,n)=>{e({type:CU.ADD_REAGENTS_AND_SCHEMAS,reagents:t,schemaDataById:n})
m(!1)},selectedApiIds:s})),d.createElement("div",{className:(0,g.iv)(AU.wellAssignmentMethodSelectorWrapper)},d.createElement(WellAssignmentMethodSelector,{wellAssignmentMethod:c,setWellAssignmentMethod:t=>{m(!1)
e({type:CU.SET_WELL_ASSIGNMENT_METHOD,wellAssignmentMethod:t})
m(!1)}})),c===jV.MB.PATTERN&&d.createElement("div",{className:(0,g.iv)(AU.patternControlsWrapper)},d.createElement(PatternDirectionDropdown,{selectedDirection:n.fillDirection,onSelectDirection:t=>{m(!1)
e({type:CU.SET_PATTERN_PARAMS,patternParams:{...n,fillDirection:t}})},label:"Fill direction"}),d.createElement(ReplicatesInput,{replicates:n.replicates,onChange:t=>{m(!1)
e({type:CU.SET_PATTERN_PARAMS,patternParams:{...n,replicates:t}})}}),d.createElement(PatternDirectionDropdown,{selectedDirection:n.replicateDirection,onSelectDirection:t=>{e({type:CU.SET_PATTERN_PARAMS,patternParams:{...n,replicateDirection:t}})},label:"Replicate direction"})),d.createElement("div",{className:(0,g.iv)(AU.reagentListWrapper)},d.createElement("div",{className:(0,g.iv)(AU.reagentListWrapperHeader)},d.createElement("div",{className:(0,g.iv)(AU.reagentCount)},"SOURCES ",`(${s.length})`),c===jV.MB.PATTERN&&d.createElement(C.Co,{buttonStyle:C.ZJ.LINK,text:"Randomize order",onClick:()=>{e({type:CU.REORDER_REAGENTS,reagentIdOrdering:(t=s,l.shuffle(t))})
var t}})),s.length>0&&d.createElement("div",{className:(0,g.iv)(AU.reagentList)},c===jV.MB.SPECIFY_GROUP&&d.createElement("div",{className:(0,g.iv)(AU.scroll)},s.map((t=>d.createElement("div",{key:t,className:(0,g.iv)(AU.reagentChipWrapper)},d.createElement(ReagentChip,{onRemove:()=>{e({type:CU.REMOVE_PREVIEWED_REAGENTS,reagentIds:[t]})
m(!1)},reagent:i[t],reagentGroupsById:r}))))),c===jV.MB.PATTERN&&d.createElement("div",{className:(0,g.iv)(AU.scroll)},d.createElement(OrderableReagentList,{previewedReagentsById:i,previewedReagentIdOrdering:s,reagentGroupsById:r,onRemoveReagent:t=>{e({type:CU.REMOVE_PREVIEWED_REAGENTS,reagentIds:[t]})
m(!1)},onReorderReagents:t=>{e({type:CU.REORDER_REAGENTS,reagentIdOrdering:t})
m(!1)}})))),d.createElement("div",{className:(0,g.iv)(AU.addReagentButtonWrapper)},d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,onClick:()=>{e({type:CU.APPLY_REAGENTS})
m(!1)},text:`Add ${(0,de._6)(s.length,"source")}`,size:C.qE.MEDIUM,disabled:0===s.length||0===o.size}))))}const AU=g.mM.create({wrapper:{display:"flex",gap:16,maxHeight:"calc(100vh - 280px)"},border:{flex:"0 0 0px",borderRight:`1px solid ${Vt.tN}`,marginTop:"-16px",marginBottom:"-16px"},mapPaneWrapper:{flex:"1 1 auto",overflow:"auto"},mapPane:{paddingTop:"16px",maxWidth:"900px",margin:"auto",display:"flex",flexDirection:"column",overflow:"hidden"},mapHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},wellsSelectedText:{color:Vt.pp},previewWellRolesButton:{marginRight:"8px"},reagentSourceView:{display:"flex",flexDirection:"column",width:"400px",minWidth:"400px"},searchHeaderText:{color:Vt.pp},wellAssignmentMethodSelectorWrapper:{margin:"16px 0px"},patternControlsWrapper:{marginBottom:"16px",display:"grid",gridTemplateColumns:"2fr 1fr 2fr",gridGap:"16px"},reagentListWrapper:{backgroundColor:Vt.bs,paddingTop:"16px",flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},reagentListWrapperHeader:{marginBottom:"16px",padding:"0px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},reagentList:{overflow:"hidden",flex:"1 1 auto"},scroll:{padding:"0px 16px 16px 16px",overflow:"auto",height:"100%"},reagentCount:{color:Vt.pp,fontWeight:_n.KB},reagentChipWrapper:{":not(:last-child)":{marginBottom:"8px"}},addReagentButtonWrapper:{marginTop:"16px",display:"flex",justifyContent:"flex-end"}})
var RU,PU=n(824431),OU=n(599685),xU=n(194170)
!function(e){e.INITIALIZE="INITIALIZE"
e.SET_TOTAL_WELL_VOLUME="SET_TOTAL_WELL_VOLUME"
e.SET_VIEW_MODE="SET_VIEW_MODE"
e.UPDATE_REAGENT_MEASUREMENTS_BY_SCHEMAS="UPDATE_REAGENT_MEASUREMENTS_BY_SCHEMAS"}(RU||(RU={}))
function coerceNumericValue(e){let t
if(null==e.typedValue)t=parseFloat(e.text)
else{if(e.typedValue.type!==zO.BaseTypedValueType.NUMBER)return null
t=e.typedValue.rawValue}return Number.isNaN(t)?null:t}function getContentReagentDataBySchemas(e){var t,n,a,i,s,r,o,l,c,d,u,m,p,h,g,E,f
const S={}
for(const y of e.wells)for(const e of y.reagents){let y=!0
const b=(0,MV.oP)(e),T=(0,Jt.SL)([...b]).join("-")
if(null==S[T]){null!==(t=S[T])&&void 0!==t||(S[T]={transferQuantity:null,transferQuantityUnit:null,schemas:{}})
y=!1}y&&S[T].transferQuantity!==(null!==(a=null===(n=e.transferQuantity)||void 0===n?void 0:n.value)&&void 0!==a?a:null)?S[T].transferQuantity=OU.m:S[T].transferQuantity=null!==(s=null===(i=e.transferQuantity)||void 0===i?void 0:i.value)&&void 0!==s?s:null
y&&S[T].transferQuantityUnit!==(null!==(o=null===(r=e.transferQuantity)||void 0===r?void 0:r.units)&&void 0!==o?o:null)?S[T].transferQuantityUnit=OU.m:S[T].transferQuantityUnit=null!==(c=null===(l=e.transferQuantity)||void 0===l?void 0:l.units)&&void 0!==c?c:null
const v=e.type===jV.W2.BIOENTITY||0===e.contents.length?[e]:e.contents
for(const e of v){let t=!0
if(null==S[T].schemas[e.groupId]){S[T].schemas[e.groupId]={entityIds:new Set,sourceConcentration:null,sourceConcentrationUnit:null}
t=!1}S[T].schemas[e.groupId].entityIds.add(e.id)
if(e.type!==jV.W2.CONTAINER){t&&S[T].schemas[e.groupId].sourceConcentration!==(null!==(u=null===(d=e.sourceConcentration)||void 0===d?void 0:d.value)&&void 0!==u?u:null)?S[T].schemas[e.groupId].sourceConcentration=OU.m:S[T].schemas[e.groupId].sourceConcentration=null!==(p=null===(m=e.sourceConcentration)||void 0===m?void 0:m.value)&&void 0!==p?p:null
t&&S[T].schemas[e.groupId].sourceConcentrationUnit!==(null!==(g=null===(h=e.sourceConcentration)||void 0===h?void 0:h.units)&&void 0!==g?g:null)?S[T].schemas[e.groupId].sourceConcentrationUnit=OU.m:S[T].schemas[e.groupId].sourceConcentrationUnit=null!==(f=null===(E=e.sourceConcentration)||void 0===E?void 0:E.units)&&void 0!==f?f:null}}}return S}function getRowsContents(e,t,n,a){const i=[]
if(a===PU.L.PLATE){const a=function getSchemaGroupings(e,t){const n={}
for(const a of e.wells)for(const e of a.reagents){const a=(0,MV.oP)(e),i=(0,Jt.SL)([...a])
n[i.join("-")]=i.map((e=>t[e]))}return n}(e,t)
for(const[e,s]of Object.entries(a))for(const[a,r]of s.entries()){const{sourceConcentration:o,sourceConcentrationUnit:l}=n[e].schemas[r.id],{transferQuantity:c,transferQuantityUnit:d}=n[e],u={[OU.w.SOURCE_ICON]:r.value.iconId,[OU.w.SOURCE]:{displayNameOverride:`${r.name} (${n[e].schemas[r.id].entityIds.size})`,schemaId:r.id,schemaColor:t[r.id].color},[OU.w.SOURCE_CONCENTRATION]:{text:o===OU.m?OU.m:"",...null!=o&&o!==OU.m?{typedValue:{type:zO.BaseTypedValueType.NUMBER,rawValue:o}}:{}},[OU.w.SOURCE_CONCENTRATION_UNIT]:{text:l===OU.m?OU.m:"",...null!=l&&l!==OU.m?{typedValue:{type:zO.BaseTypedValueType.STRING,rawValue:l}}:{}},[OU.w.TRANSFER_QUANTITY]:{text:c===OU.m?OU.m:"",...null!=c&&c!==OU.m?{typedValue:{type:zO.BaseTypedValueType.NUMBER,rawValue:c}}:{}},[OU.w.TRANSFER_QUANTITY_UNIT]:{text:d===OU.m?OU.m:"",...null!=d&&d!==OU.m?{typedValue:{type:zO.BaseTypedValueType.STRING,rawValue:d}}:{}},schemaGroupingId:e}
if(s.length>1){u[OU.w.SOURCE_ICON]="vial"
0===a&&(u.mergeSpan=s.length)}i.push(u)}}return i}function useFillPlateTransferTableReducer_reducer(e,t){switch(t.type){case RU.INITIALIZE:{const t=getContentReagentDataBySchemas(e.plateMap)
return{...e,rowsContentsByColumnKey:getRowsContents(e.plateMap,e.reagentGroupsById,t,e.viewMode),contentReagentDataBySchemas:t}}case RU.SET_TOTAL_WELL_VOLUME:return{...e,totalWellVolumeAmount:t.totalWellVolumeAmount,totalWellVolumeUnit:t.totalWellVolumeUnit}
case RU.SET_VIEW_MODE:return{...e,rowsContentsByColumnKey:getRowsContents(e.plateMap,e.reagentGroupsById,e.contentReagentDataBySchemas,t.viewMode),viewMode:t.viewMode}
case RU.UPDATE_REAGENT_MEASUREMENTS_BY_SCHEMAS:{const n=function updateReagentMeasurementCellsBySchemas(e,t){return(0,tm.ZP)(e,(e=>{for(const n of e.wells)for(const e of n.reagents){const n=(0,MV.oP)(e),a=(0,Jt.SL)([...n]).join("-"),{transferQuantity:i,transferQuantityUnit:s}=t[a]
e.transferQuantity={value:coerceNumericValue(i),units:null==s.typedValue?s.text:(0,xU.Gh)(s.typedValue)}}}))}(e.plateMap,t.reagentMeasurementCellsBySchemas),a=getContentReagentDataBySchemas(n)
return{...e,plateMap:n,contentReagentDataBySchemas:a,rowsContentsByColumnKey:getRowsContents(n,e.reagentGroupsById,a,e.viewMode)}}default:return e}}const _U=["text","typedValue","error"]
function FillPlateTransferTable({dispatch:e,rowsContentsByColumnKey:t,totalWellVolumeAmount:n,totalWellVolumeUnit:a,viewMode:i}){const s="fill-plate-transfer-table",r=PU.Z.getAdapter(),o=(0,Jt.m8)(Object.values(OU.w).map(((e,t)=>[e,t]))),l={viewMode:i}
const c=r.createTable({name:"",metadata:l,entryId:null,schemas:[],selectorsById:{}})
c.rows=function buildStructuredTableRows(){const e=[]
for(const[n,a]of t.entries()){const t=(0,tm.Uy)(r.getBlankRow(l,n,r._getAllSupportedColumns()),(e=>{e.metadata.schemaGroupingId=a.schemaGroupingId
e.cells[o[OU.w.SOURCE_ICON]]={text:"",typedValue:{type:zO.BaseTypedValueType.STRING,rawValue:a[OU.w.SOURCE_ICON]}}
e.cells[o[OU.w.SOURCE]]={text:"",typedValue:{type:zO.BaseTypedValueType.JSON,jsonValue:a[OU.w.SOURCE]}}
e.cells[o[OU.w.SOURCE_CONCENTRATION]]=a[OU.w.SOURCE_CONCENTRATION]
e.cells[o[OU.w.SOURCE_CONCENTRATION_UNIT]]=a[OU.w.SOURCE_CONCENTRATION_UNIT]
e.cells[o[OU.w.TRANSFER_QUANTITY]]=a[OU.w.TRANSFER_QUANTITY]
e.cells[o[OU.w.TRANSFER_QUANTITY_UNIT]]=a[OU.w.TRANSFER_QUANTITY_UNIT]
if(null!=a.mergeSpan){e.cells[o[OU.w.SOURCE_ICON]].mergeRowSpan=a.mergeSpan
e.cells[o[OU.w.TRANSFER_QUANTITY]].mergeRowSpan=a.mergeSpan
e.cells[o[OU.w.TRANSFER_QUANTITY_UNIT]].mergeRowSpan=a.mergeSpan}}))
e.push(t)}return e}()
return 0===c.rows.length?d.createElement("div",null,"TODO: Error message for when there's no rows"):d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(DU.header)},d.createElement("div",{className:(0,g.iv)(DU.headerInput)},d.createElement(Fr.Z,{label:"Total well volume",htmlFor:"fill-plate-total-well-volume"}),d.createElement("div",{className:(0,g.iv)(DU.totalVolumeInputWrapper)},d.createElement(AT.Z,{className:(0,g.iv)(DU.totalVolumeInput),id:"fill-plate-total-well-volume",onChange:({target:{numericValue:t}})=>{e({type:RU.SET_TOTAL_WELL_VOLUME,totalWellVolumeAmount:t,totalWellVolumeUnit:a})},placeholder:"Enter value",value:n}),d.createElement(wq.Z,{allowNullUnits:!1,onChange:t=>{e({type:RU.SET_TOTAL_WELL_VOLUME,totalWellVolumeAmount:n,totalWellVolumeUnit:t})},allowedUnits:kB.J3,value:a})))),i===PU.L.PLATE&&d.createElement(UO.Z,{canRename:!1,cid:s,hideColumnHeaderIcons:!0,includeUnsubmittedStatus:!1,isCollapsible:!1,structuredTable:{...c,cid:s},suppressTitleBar:!0,updateHandler:function onUpdate(t){const n={}
for(const e of t.rows){const{schemaGroupingId:t}=e.metadata
Object.keys(n).includes(t)||(n[t]={transferQuantity:(0,Jt.ei)(e.cells[o[OU.w.TRANSFER_QUANTITY]],..._U),transferQuantityUnit:(0,Jt.ei)(e.cells[o[OU.w.TRANSFER_QUANTITY_UNIT]],..._U)})}e({type:RU.UPDATE_REAGENT_MEASUREMENTS_BY_SCHEMAS,reagentMeasurementCellsBySchemas:n})}}),i===PU.L.WELL&&d.createElement("div",null,"TODO: Implement Well Mode"))}const DU=g.mM.create({header:{border:`1px solid ${Vt.pF}`,borderTopLeftRadius:"4px",borderTopRightRadius:"4px",display:"flex",justifyContent:"flex-end",marginBottom:"-11px",marginRight:"10px",padding:"12px"},headerInput:{display:"flex",flexDirection:"column",alignItems:"flex-start"},totalVolumeInputWrapper:{display:"flex"},totalVolumeInput:{marginRight:"4px"}})
function FillPlateTransferStep({plateMap:e,reagentGroupsById:t}){const[{rowsContentsByColumnKey:n,contentReagentDataBySchemas:a,totalWellVolumeAmount:i,totalWellVolumeUnit:s,viewMode:r},o]=function useFillPlateTransferTableReducer(e){const[t,n]=(0,d.useReducer)(useFillPlateTransferTableReducer_reducer,e,(e=>useFillPlateTransferTableReducer_reducer(e,{type:RU.INITIALIZE})))
return[t,n]}({plateMap:e,reagentGroupsById:t,rowsContentsByColumnKey:[],contentReagentDataBySchemas:{},totalWellVolumeAmount:null,totalWellVolumeUnit:"uL",viewMode:PU.L.PLATE})
return d.createElement("div",{className:(0,g.iv)(LU.wrapper)},d.createElement(PlateMapView,{plateMap:e,isViewOnly:!0,selectedWellIndices:new Set,setSelectedWellIndices:Jt.ZT,assignmentGroupsById:t,displayLayer:jV._i.REAGENT,showSelectedAsPreview:!1,selectedAttribute:jV.nq}),d.createElement("div",{className:(0,g.iv)(LU.border)}),d.createElement("div",null,d.createElement(FillPlateTransferTable,{plateMap:e,reagentGroupsById:t,rowsContentsByColumnKey:n,contentReagentDataBySchemas:a,totalWellVolumeAmount:i,totalWellVolumeUnit:s,viewMode:r,dispatch:o})))}const LU=g.mM.create({wrapper:{display:"flex",gap:16},border:{flex:"0 0 0px",borderRight:`1px solid ${Vt.tN}`,marginTop:"-16px",marginBottom:"-16px"}})
var kU
!function(e){e.TRANSFER_SOURCES="TRANSFER_SOURCES"
e.TRANSFER_QUANTITIES="TRANSFER_QUANTITIES"}(kU||(kU={}))
const MU=[{key:kU.TRANSFER_SOURCES,title:"Transfer sources"},{key:kU.TRANSFER_QUANTITIES,title:"Transfer quantities"}],FU={[kU.TRANSFER_SOURCES]:"You must add sources to proceed",[kU.TRANSFER_QUANTITIES]:"You must fill in all required information to proceed"}
function getModalButtons(e,t,n){const a=MU.findIndex((t=>t.key===e))
let i,s
i=0===a?{text:"Cancel",cancel:!0}:{text:"Back",style:C.ZJ.TERTIARY_GRAY,dataTestAttrs:{component:"FillPlateModal",key:vb.Z.BACK},onClick:()=>{t(MU[a-1].key)}}
s=a===MU.length-1?{text:"Fill plate",submit:!0,style:C.ZJ.PRIMARY}:{text:"Next",submit:!0,style:C.ZJ.SECONDARY,disabled:n,tooltipTitle:n?FU[MU[a].key]:null,onClick:()=>{t(MU[a+1].key)},dataTestAttrs:{component:"FillPlateModal",key:vb.Z.NEXT}}
return[i,s]}function getStatusByStepKey(e){const t=MU.findIndex((t=>t.key===e))
return(0,Jt.m8)(MU.map(((e,n)=>[e.key,n<t?Fx.cV.DONE:Fx.cV.UNVISITED])))}function FillPlateModal(e){const[t,n]=(0,d.useState)(MU[0].key),[a,i]=(0,d.useState)(getStatusByStepKey(t))
function onSetStepKey(e){n(e)
i(getStatusByStepKey(e))}const[{patternParams:s,plateMap:r,previewPlateMap:o,previewedReagentsById:l,previewedReagentIdOrdering:c,reagentGroupsById:u,selectedWellIndices:m,wellAssignmentMethod:p},h]=function useFillPlateModalReducer(e){const[t,n]=(0,d.useReducer)(useFillPlateModalReducer_reducer,e)
return[t,n]}({patternParams:jV.iU,plateMap:e.initialPlateMap,previewPlateMap:e.initialPlateMap,previewedReagentsById:{},previewedReagentIdOrdering:[],reagentGroupsById:{},selectedWellIndices:new Set(e.selectedWellIndices),wellAssignmentMethod:jV.MB.SPECIFY_GROUP}),E=(0,d.useMemo)((()=>t===kU.TRANSFER_SOURCES&&Is()(e.initialPlateMap,r)),[r,e.initialPlateMap,t])
return d.createElement(et.ZP,{title:"Fill plate",onRequestClose:e.onRequestClose,large:!0,fullWidth:!0,expandHeight:!0,buttons:getModalButtons(t,onSetStepKey,E)},d.createElement(Fx.ZP,{currentStepKey:t,onUpdateCurrentStep:onSetStepKey,steps:MU,statusByStep:a,size:Fx.WP.LARGE,variant:Fx.zK.FLAT}),d.createElement("hr",{className:(0,g.iv)(ZU.horizontalLine)}),t===kU.TRANSFER_SOURCES&&d.createElement(FillPlateReagentStep,{dispatch:h,initialPlateMap:r,patternParams:s,previewPlateMap:o,previewedReagentsById:l,previewedReagentIdOrdering:c,reagentGroupsById:u,selectedWellIndices:m,wellAssignmentMethod:p}),t===kU.TRANSFER_QUANTITIES&&d.createElement(FillPlateTransferStep,{plateMap:r,reagentGroupsById:u}))}const ZU=g.mM.create({horizontalLine:{marginLeft:"-16px",marginRight:"-16px"}})
function GridCellToolbarFixedPlateActionButtons({grid:e,selectedCells:t}){const{plateMap:n,refetch:a}=usePlateMapFromGrid(e)
return d.createElement("div",{className:"buttonGroup"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:async function handleAnnotatePlateModal(){const i=await(0,Xn.Z)(AnnotatePlateModal,{existingPlateMap:n,initialSelectedWellIndices:new Set((0,JF.A0)(t,e)),cellContainerSchemaId:e.storableSchema.containerSchemaId})
if(null!=i)try{const t=await async function saveAnnotations(t){var n
const a=[],i=[]
for(const s of t.wells){const t=null===(n=e.cells[s.position.row][s.position.column])||void 0===n?void 0:n.container.id
if(null!=t){a.push(t)
i.push({containerId:t,role:s.role})}}return await(0,fA.GE)({changeSummary:(0,yA.P_)({apiIds:a,action:yA.wV.MODIFY}),onRequestClose:()=>{},onRequestSubmit:async()=>{await(0,kV.MN)(e.id,{wellRoles:i})}},dt.ZP.INVENTORY_ENABLE_DATA_MOD_REASONS,{module:"SAMPLES",actionOrigin:"inventory_registry_search_ui",modifiedAction:yA.wV.MODIFY,numModifiedTotalItems:a.length,entryId:null})}(i)
if(t){v.ZP.success("Plate annotations saved.")
a()}}catch(e){if((0,Cn.d0)(e)){v.ZP.notifyError(e)
return}throw e}},size:C.qE.SMALL,text:"Annotate plate"}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:()=>{(0,Xn.Z)(FillPlateModal,{initialPlateMap:n,selectedWellIndices:(0,JF.A0)(t,e),onRequestClose:Jt.ZT,onRequestSubmit:Jt.ZT})},size:C.qE.SMALL,text:"Fill wells",dataTestAttrs:{component:"Button",key:"fillWells"}}))}var BU=n(108368),qU=n(552365)
class ExistingPlatePane extends d.Component{constructor(){super(...arguments)
this._handlePlateChange=e=>{const t=e.length?e[0]:null
this.props.onUpdate({selectedGrid:t})}}render(){return d.createElement("div",null,d.createElement(so.Dx,null,"Search for plate"),d.createElement(wA.Z,{onChange:this._handlePlateChange,registryId:this.props.registryId,selectedStorables:this.props.selectedGrid?[this.props.selectedGrid]:[],shouldAllowMultiple:!1,storableTypes:[st.PLATE]}))}}const VU=ExistingPlatePane,UU={TRANSFER_ALL:"TRANSFER_ALL",SPECIFY_QUANTITIES:"SPECIFY_QUANTITIES"}
function InsufficientSourceQuantityError(e){const t=(0,HB.Z)(!1),n=`The ${t} you are trying to transfer exceeds what is available in one or more of the source wells.`,a=e.isBlocking?n:`${n} The full ${t} will be transferred, and these source wells will have their ${(0,HB.Z)(!1,!0)} set to 0.`,i=d.createElement("ul",{className:"u-padding-left"},e.invalidWells.map((e=>d.createElement("li",{key:e.id},`${e.name} (${(0,MB.wD)(e.quantity)})`))))
return d.createElement("div",{className:"u-small-spacing-top"},d.createElement(io.ZP,{bannerType:e.isBlocking?io.ct.ERROR:io.ct.WARNING,text:a,supportingInfo:i,action:{actionType:io.J7.ACCORDION}}))}const GU={shouldTransferAllQuantities:!0,transferQuantity:{value:null,units:null},hasTransferQuantityError:!1,quantityErrorsAreBlocking:!0,wellsWithInsufficientQuantity:[]}
class TransferPlatesQuantityPane extends d.Component{constructor(){super(...arguments)
this.handleChangeValue=e=>{this.props.onChangeTransferQuantity({...this.props.transferQuantity,value:e.target.numericValue})}
this.handleChangeUnits=({val:e})=>{this.props.onChangeTransferQuantity({...this.props.transferQuantity,units:e})}}validateTransferQuantity(e){const{isValid:t,sourcesInViolation:n,quantityErrorsAreBlocking:a}=(0,MB.bC)(this.props.cells.map((({container:t})=>({source:t,transferQuantity:e}))))
!t===this.props.hasTransferQuantityError&&Is()(n,this.props.wellsWithInsufficientQuantity)||this.props.onChangeTransferQuantityErrorState(!t,n,a)}componentDidUpdate(e){Is()(e.transferQuantity,this.props.transferQuantity)||this.validateTransferQuantity(this.props.transferQuantity)}render(){const e=(0,kB.U3)(this.props.cells.map((e=>e.container.quantity.units))),t=e.length>0?e:(0,kB.kI)(),n=!this.props.hasBlockingError&&this.props.hasTransferQuantityError
return d.createElement("div",null,d.createElement(Fr.Z,{label:`Transfer ${(0,HB.Z)(!1)}`}),d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("label",null,d.createElement("input",{autoFocus:!0,type:"radio",value:UU.TRANSFER_ALL,checked:this.props.shouldTransferAllQuantities,onChange:this.props.onChangeShouldTransferAllQuantities}),d.createElement("span",{className:"u-tiny-spacing-left u-spacing-right"},"Transfer all ",(0,HB.Z)(!1,!0))),d.createElement("label",null,d.createElement("input",{type:"radio",value:UU.SPECIFY_QUANTITIES,checked:!this.props.shouldTransferAllQuantities,onChange:this.props.onChangeShouldTransferAllQuantities}),d.createElement("span",{className:"u-tiny-spacing-left"},"Specify transfer ",(0,HB.Z)(!1)))),this.props.shouldTransferAllQuantities?d.createElement("div",null,"The full ",(0,HB.Z)(!1)," will be transferred from each well in the source plate."):d.createElement("div",null,d.createElement("div",{className:"u-tiny-spacing-bottom"},"The following ",(0,HB.Z)(!1)," will be transferred from all wells in the source plate:"),d.createElement(FB.Z,{measurement:this.props.transferQuantity,onChangeUnits:this.handleChangeUnits,onChangeValue:this.handleChangeValue,validUnits:t}),d.createElement("div",null,n&&d.createElement(InsufficientSourceQuantityError,{invalidWells:this.props.wellsWithInsufficientQuantity,transferQuantity:this.props.transferQuantity,isBlocking:this.props.quantityErrorsAreBlocking}))))}}TransferPlatesQuantityPane.QUANTITY_OPTIONS=UU
const zU=TransferPlatesQuantityPane,$U="CREATE_NEW_PLATE"
var WU
!function(e){e.CHOOSE_PLATE="CHOOSE_PLATE"
e.CONFIRM_QUANTITY="CONFIRM_QUANTITY"
e.CONFIRM_CONCENTRATIONS="CONFIRM_CONCENTRATIONS"}(WU||(WU={}))
function closeTransferPlatesModal(){Xe.xv(TransferPlatesModal)}function BlockingError({errorMessage:e}){return d.createElement("div",{className:(0,g.iv)(QU.errorMessage)},d.createElement("p",{className:"u-danger-color"},e))}class TransferPlatesModalConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[xR.Z]}enhanceProps(){return{registry:this.navStore().getSource(this.props.registryId)}}}const HU=xa.Ps`
  query TransferPlatesModalSourcePlateQuery($plateId: StrictString!)
  @skipAudit
  @engComponent(name: INVENTORY) {
    plates(ids: [$plateId]) {
      ... on PlateNode {
        id
        cells {
          ... on GridCellNode {
            container {
              ... on ContainerNode {
                id
                hasNameTemplate
              }
              ... on InaccessibleInfoNode {
                ...InaccessibleInfoGraphQL
              }
            }
          }
        }
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`,jU=xa.Ps`
  query TransferPlatesModalDestinationPlateQuery($plateId: StrictString!)
  @skipAudit
  @engComponent(name: INVENTORY) {
    plates(ids: [$plateId]) {
      ... on PlateNode {
        ...PlateGraphQL
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("Plate").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class TransferPlatesModal extends d.Component{constructor(e){super(e)
this._handleChangeTransferQuantityErrorState=(e,t,n)=>{this.setState((a=>({...a,transferPlatesQuantityPaneState:{...a.transferPlatesQuantityPaneState,hasTransferQuantityError:e,wellsWithInsufficientQuantity:t,quantityErrorsAreBlocking:n}})))}
this._handleChangeConcentration=(e,t,n)=>{(0,S.hu)(null!=this.state.containerContents,"Expected container contents to be non null on concentration pane")
const a=this.state.containerContents.findIndex((n=>n.containedItemId===t&&n.containerId===e));(0,S.hu)(-1!==a,"Expected container batch to be present")
const i={...this.state.containerContents[a],concentration:{...this.state.containerContents[a].concentration,...n}},s=[...this.state.containerContents.slice(0,a),i,...this.state.containerContents.slice(a+1)]
this.setState({containerContents:s})}
this._handleUpdateTransferParams=(e,t)=>{const n=t?{errorMessage:null}:{}
this.setState({...this.state,...n,...e})}
this._handleUpdateErrors=e=>{this.setState({errorMessage:e})}
this.checkForInputWarnings=()=>{var e
const t=this.props.cells.map((({container:e})=>e)),{shouldShowWarning:n,samples:a}=(0,oq.CC)({samples:t,showOnlySamplesWithWarnings:!0})
this.updateSampleStatusState({shouldShowStatusWarnings:n,samples:null!=a?a:null,selectedSampleIds:null!==(e=null==a?void 0:a.map((({id:e})=>e)))&&void 0!==e?e:[]},"inputSampleStatusState")}
this.checkForOutputWarnings=()=>{var e,t,n
const a=(null!==(t=null===(e=this.props.selectedDestinationPlate)||void 0===e?void 0:e.cells)&&void 0!==t?t:[]).flatMap((e=>e.flatMap((e=>{var t
return null!==(t=null==e?void 0:e.container)&&void 0!==t?t:[]})))),{shouldShowWarning:i,samples:s}=(0,oq.CC)({samples:a,showOnlySamplesWithWarnings:!0})
this.updateSampleStatusState({shouldShowStatusWarnings:i,samples:null!=s?s:null,selectedSampleIds:null!==(n=null==s?void 0:s.map((({id:e})=>e)))&&void 0!==n?n:[]},"outputSampleStatusState")}
this.checkForContainerNameTemplates=()=>{var e,t,n,a
const i=(null!==(t=null===(e=this.props.selectedDestinationPlate)||void 0===e?void 0:e.cells)&&void 0!==t?t:[]).flatMap((e=>e.flatMap((e=>{var t
return null!==(t=null==e?void 0:e.container)&&void 0!==t?t:[]})))),s=this.props.sourceCellsWithNameTemplate.flatMap((e=>e.flatMap((e=>e)))),r=this.state.shouldCreatePlate?null===(n=this.state.createPlatePaneState.selectedSchema)||void 0===n?void 0:n.plateSchemaType:null===(a=this.props.selectedDestinationPlate)||void 0===a?void 0:a.storableSchema.plateSchemaType
let o=this.props.grid.storableSchema.plateSchemaType===hq.Ch.MATRIX_PLATE&&r===hq.Ju.MATRIX_PLATE
o&&(o=this.state.shouldCreatePlate?s.some((e=>e)):s.some(((e,t)=>e&&null!=i[t]&&!i[t].contents.length)))
this.setState({shouldShowNameTemplateBanner:o})}
this.updateSampleStatusState=(e,t)=>{const n={...this.state[t],...e}
"inputSampleStatusState"===t?this.setState({inputSampleStatusState:n}):this.setState({outputSampleStatusState:n})}
this.setCanProceedOnSampleStatus=(e,t)=>{this.updateSampleStatusState({canProceedOnSampleStatus:e},t)}
this.sampleStatusWarningTrackingParams={actionAttempted:"transfer_plate",actionOrigin:Sn.D2.UI_UNDETERMINED,eventGroupId:m.Vr()}
this._handleFinishWellSpreadsheetValidation=e=>{const t=null!=e?{formError:e}:{}
this._handleUpdateCreatePlatePane({isValidating:!1,validationErrors:t})}
this._handleStartTransfer=()=>{this.setState({isTransferring:!0})}
this._handleFinishTransfer=e=>{this.setState({isTransferring:!1,errorMessage:null!=e?e:null})}
this.hasBlockingSampleStatusWarnings=()=>this.state.inputSampleStatusState.shouldShowStatusWarnings&&!this.state.inputSampleStatusState.canProceedOnSampleStatus||!this.state.shouldCreatePlate&&this.state.outputSampleStatusState.shouldShowStatusWarnings&&!this.state.outputSampleStatusState.canProceedOnSampleStatus
this.renderPossibleWarning=e=>{const t=this.state[e]
return"inputSampleStatusState"!==e&&null==this.props.selectedDestinationPlate||!t.shouldShowStatusWarnings||null==t.samples?null:d.createElement(oq.F,{sampleIds:t.samples.map((({id:e})=>e)),selectedSampleIds:t.selectedSampleIds,setSelectedSampleIds:Jt.ZT,shouldProceed:t.canProceedOnSampleStatus,setShouldProceed:t=>{this.setCanProceedOnSampleStatus(t,e)},trackingParams:this.sampleStatusWarningTrackingParams,samples:t.samples,canSelectMultiple:!1})}
this.renderPossibleDestinationWarning=()=>{var e,t,n
if(!(0,$B.Eq)(zB.F.V1)||this.props.grid.storableSchema.plateSchemaType===hq.Ch.FIXED_PLATE)return null
if(this.state.shouldCreatePlate&&null!=this.state.createPlatePaneState.selectedSchema&&(null===(e=this.state.createPlatePaneState.selectedSchema)||void 0===e?void 0:e.plateSchemaType)!==hq.Ju.MATRIX_PLATE||!this.state.shouldCreatePlate&&null!=this.props.selectedDestinationPlate&&(null===(t=this.props.selectedDestinationPlate)||void 0===t?void 0:t.storableSchema.plateSchemaType)!==hq.Ju.MATRIX_PLATE)return null
let a=!1
if(null!=this.props.selectedDestinationPlate)for(const{columnIndex:e,rowIndex:t,container:i}of this.props.cells){const s=null===(n=this.props.selectedDestinationPlate.cells[t][e])||void 0===n?void 0:n.container
a=MB.Un(i,null!=s?[s]:[])
if(a)break}return this.state.shouldCreatePlate||a?d.createElement(io.ZP,{bannerType:io.ct.INFO,key:"sample-control",text:`Any sample owners and ${(0,GB.EX)()} of the source containers will be added to ${this.state.shouldCreatePlate?"the created":"those of the destination"} containers.`}):null}
this.state={shouldCreatePlate:!0,shouldShowNameTemplateBanner:!1,step:WU.CHOOSE_PLATE,isTransferring:!1,errorMessage:null,containerContents:null,containerTransfers:null,createPlatePaneState:{...qU.j,registry:e.registry},transferPlatesQuantityPaneState:{...GU,transferQuantity:{value:null,units:e.cells[0].container.quantity.units}},confirmConcentrationsPaneState:Cq,inputSampleStatusState:eq.z_(),outputSampleStatusState:eq.z_()}}componentDidMount(){this.checkForInputWarnings()}componentDidUpdate(e,t){Is()(this._getConcentrationStateDependencies(t),this._getConcentrationStateDependencies(this.state))||this._updateConcentrationPaneState(this.state)
if(this.state.step===WU.CHOOSE_PLATE){t.createPlatePaneState.isValidating&&!this.state.createPlatePaneState.isValidating&&l.default.isEmpty(this.state.createPlatePaneState.validationErrors)&&this.setState({step:WU.CONFIRM_QUANTITY})
Is()(e.selectedDestinationPlate,this.props.selectedDestinationPlate)||this.checkForOutputWarnings()
Is()(t.shouldCreatePlate,this.state.shouldCreatePlate)&&Is()(e.selectedDestinationPlate,this.props.selectedDestinationPlate)&&Is()(t.createPlatePaneState.selectedSchema,this.state.createPlatePaneState.selectedSchema)||this.checkForContainerNameTemplates()}!t.isTransferring||this.state.isTransferring||this.state.errorMessage||this.props.onRequestClose()}_getConcentrationStateDependencies(e){return{containerTransfers:e.containerTransfers,containerContents:e.containerContents,shouldCalculateConcentrations:e.confirmConcentrationsPaneState.shouldCalculateConcentrations}}_updateConcentrationPaneState(e){const t=this._getConcentrationStateDependencies(e),n=sq.zR({containerTransfers:t.containerTransfers,containerContents:t.containerContents,shouldCalculateConcentrations:t.shouldCalculateConcentrations,inputContainer:null,errorMessage:null})
this.setState({confirmConcentrationsPaneState:{...this.state.confirmConcentrationsPaneState,...n}})}_handleUpdateCreatePlatePane(e){this.setState({createPlatePaneState:{...this.state.createPlatePaneState,...e}})}_handleUpdateExistingPlatePane(e){var t
this.props.existingPlatePaneState.setSelectedGrid(null!==(t=e.selectedGrid)&&void 0!==t?t:null)}_handleChangeShouldCreatePlate(e){this.setState({shouldCreatePlate:e.target.value===$U})}_handleChangeShouldTransferAllQuantities(e){this.setState((t=>({...t,transferPlatesQuantityPaneState:{...t.transferPlatesQuantityPaneState,shouldTransferAllQuantities:e.target.value===zU.QUANTITY_OPTIONS.TRANSFER_ALL}})))}_handleChangeTransferQuantity(e){this.setState((t=>({...t,transferPlatesQuantityPaneState:{...t.transferPlatesQuantityPaneState,transferQuantity:e}})))}_getSourcePlateSchema(){return this.props.grid.storableSchema}_getDestinationPlateSchema(){var e
return this.state.shouldCreatePlate?this.state.createPlatePaneState.selectedSchema:(null===(e=this.props.existingPlatePaneState.selectedGrid)||void 0===e?void 0:e.storableSchema)||null}_getTransferToSelfErrorText(){var e
return this.props.grid.id===(null===(e=this.props.existingPlatePaneState.selectedGrid)||void 0===e?void 0:e.id)?"Source and destination plates cannot be the same.":null}_getMismatchedPlateDimensionsErrorText(){const e=this._getSourcePlateSchema(),t=this._getDestinationPlateSchema()
return null==t||e.height===t.height&&e.width===t.width?null:"Source and destination plate dimensions do not match."}_getIncompatibleUnitsErrorTextForWell(e,t,n,a){var i
const s=e&&e.container.quantity.units,r=t&&t.container.quantity.units,o=this.state.transferPlatesQuantityPaneState.shouldTransferAllQuantities?null!==(i=null==e?void 0:e.container.quantity)&&void 0!==i?i:{value:null,units:null}:this.state.transferPlatesQuantityPaneState.transferQuantity
if((0,kB.V7)([s,o.units,r]))return null
return`${`Position ${(0,JF.mk)(n,a)}`}: Cannot transfer ${this.state.step===WU.CHOOSE_PLATE||null==o.units?"":`${o.value} ${o.units} `}${null==e?"":`from ${(0,JF.yQ)(e.container)} `}${null==t?"":`into ${(0,JF.yQ)(t.container)}`} because the units are incompatible.`}_getIncompatibleUnitsErrorText(){var e,t
const n=this.props.grid.cells,a=this.state.shouldCreatePlate?null:null!==(t=null===(e=this.props.selectedDestinationPlate)||void 0===e?void 0:e.cells)&&void 0!==t?t:null;(0,S.hu)(!a||n.length===a.length&&n[0].length===a[0].length,"Expected source and destination plates to have same dimensions")
return n.flatMap(((e,t)=>e.map(((e,n)=>{const i=a&&a[t][n]
return this._getIncompatibleUnitsErrorTextForWell(e,i,t,n)})))).filter((e=>e)).join("\n")}_getBlockingErrorText(){return this._getTransferToSelfErrorText()||this._getMismatchedPlateDimensionsErrorText()||this._getIncompatibleUnitsErrorText()||null}_handleClickBack(){switch(this.state.step){case WU.CONFIRM_QUANTITY:this.setState({step:WU.CHOOSE_PLATE})
break
case WU.CONFIRM_CONCENTRATIONS:this.setState({step:WU.CONFIRM_QUANTITY})
break
default:throw Error("Unexpected step")}}_handleClickNext(){switch(this.state.step){case WU.CHOOSE_PLATE:if(this.state.shouldCreatePlate){const{selectedSchema:e,selectedContainerSchema:t,spreadsheetFile:n,spreadsheetURL:a}=this.state.createPlatePaneState,i=sq.wR(this.state.createPlatePaneState)
this._handleUpdateCreatePlatePane({validationErrors:i})
if(l.default.isEmpty(i))if(n){(0,S.hu)(null!=e,"Expected plate schema to be selected");(0,S.hu)(null!=t,"Expected container schema to be selected");(0,S.hu)(null!=a,"Expected spreadsheetURL to exist")
this._handleUpdateCreatePlatePane({isValidating:!0})
xB.validateWellSpreadsheet(this.props.grid.id,e.id,t.id,n.name,a,this._handleFinishWellSpreadsheetValidation)}else this.setState({step:WU.CONFIRM_QUANTITY})}else this.setState({step:WU.CONFIRM_QUANTITY})
break
case WU.CONFIRM_QUANTITY:if(this.state.shouldCreatePlate){const{containerTransfers:e,containerContents:t}=sq.cu(this.props.cells)
this._handleUpdateTransferParams({containerTransfers:e,containerContents:t})}else{(0,S.hu)(null!=this.props.existingPlatePaneState.selectedGrid,"Expected destination plate to be selected")
this._handleUpdateTransferParams({containerTransfers:null,containerContents:null})
TransferActions_calculateConcentrationsGridToGrid(this.props.grid.id,this.props.existingPlatePaneState.selectedGrid.id,this.state.transferPlatesQuantityPaneState.shouldTransferAllQuantities,this.state.transferPlatesQuantityPaneState.transferQuantity,(e=>{this._handleUpdateTransferParams(e,!0)}),this._handleUpdateErrors)}this.setState({step:WU.CONFIRM_CONCENTRATIONS})
break
default:throw Error("Unexpected step")}}_handleTransferPlates(){(0,S.hu)(null!=this.state.containerContents,"Expected containerContents to be present when transferring")
if(this.state.shouldCreatePlate){const e={...this.state.createPlatePaneState,registry:this.state.createPlatePaneState.registry,selectedSchema:this.state.createPlatePaneState.selectedSchema}
!function transferToNewGrid(e,t,n,a,i,s){const r=t.registry.rootFolder.api_identifier,o=(0,nq.Z)(t),{shouldTransferAllQuantities:l,transferQuantity:c}=n,{containerContents:d}=a
transferGridsWithDataMods({containerContents:d,inputGridId:e,shouldTransferAllQuantities:l,transferQuantity:c,folderId:r,createGridParams:o,onStart:i,onFinish:s})}(this.props.grid.id,e,this.state.transferPlatesQuantityPaneState,{containerContents:this.state.containerContents},this._handleStartTransfer,this._handleFinishTransfer)}else{const e={selectedGrid:this.props.existingPlatePaneState.selectedGrid}
!function transferToExistingPlate(e,t,n,a,i,s){const{selectedGrid:r}=t,{shouldTransferAllQuantities:o,transferQuantity:l}=n,{containerContents:c}=a
transferGridsWithDataMods({containerContents:c,inputGridId:e,shouldTransferAllQuantities:o,transferQuantity:l,existingGridParams:{outputGridId:r.id},onStart:i,onFinish:s})}(this.props.grid.id,e,this.state.transferPlatesQuantityPaneState,{containerContents:this.state.containerContents},this._handleStartTransfer,this._handleFinishTransfer)}}_getChoosePlateButtonText(){return this.props.isLoadingDestinationPlate||sq.Dv(this.state.createPlatePaneState)?"Loading...":this.state.createPlatePaneState.isValidating?"Validating...":"Next"}_getTransferButtonText(){return this.state.isTransferring?"Transferring...":"Done"}_isChoosePlateButtonDisabled(){const{selectedSchema:e,spreadsheetURL:t}=this.state.createPlatePaneState,n=e&&e.plateSchemaType===hq.Ch.MATRIX_PLATE&&!t
return this.state.shouldCreatePlate?n||sq.Dv(this.state.createPlatePaneState)||this.state.createPlatePaneState.isValidating:!sq.cU(this.props.existingPlatePaneState)||this.props.isLoadingDestinationPlate}render(){let e
const{existingPlatePaneState:t}=this.props,{createPlatePaneState:n,transferPlatesQuantityPaneState:a,confirmConcentrationsPaneState:i}=this.state,s=this._getBlockingErrorText(),r=Boolean(s)
e=this.state.step===WU.CHOOSE_PLATE?[{text:this._getChoosePlateButtonText(),onClick:()=>{this._handleClickNext()},style:C.ZJ.SECONDARY,disabled:r||this._isChoosePlateButtonDisabled()||this.hasBlockingSampleStatusWarnings(),dataTestAttrs:{component:"TransferPlatesModal",key:vb.Z.NEXT}}]:this.state.step===WU.CONFIRM_QUANTITY?[{text:"Back",onClick:()=>{this._handleClickBack()}},{text:"Next",onClick:()=>{this._handleClickNext()},style:C.ZJ.SECONDARY,disabled:r||!a.shouldTransferAllQuantities&&(!MB.X9(a.transferQuantity)||a.quantityErrorsAreBlocking&&a.hasTransferQuantityError),dataTestAttrs:{component:"TransferPlatesModal",key:vb.Z.NEXT}}]:[{text:"Back",onClick:()=>{this._handleClickBack()}},{text:this._getTransferButtonText(),onClick:()=>{this._handleTransferPlates()},style:C.ZJ.SECONDARY,disabled:r||!sq.hw(this.state),dataTestAttrs:{component:"TransferPlatesModal",key:vb.Z.DONE}}]
const o=d.createElement("div",null,d.createElement(Fr.Z,{label:"Destination"}),d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{md:6},d.createElement("label",null,d.createElement("input",{type:"radio",checked:this.state.shouldCreatePlate,onChange:e=>{this._handleChangeShouldCreatePlate(e)},value:$U}),d.createElement("span",{className:"u-tiny-spacing-left"},"New plate"))),d.createElement(p.Z,{md:6},d.createElement("label",null,d.createElement("input",{type:"radio",checked:!this.state.shouldCreatePlate,onChange:e=>{this._handleChangeShouldCreatePlate(e)},value:"USE_EXISTING_PLATE",...(0,ee.Z)({component:"TransferPlatesModal",element:"useExistingPlateRadioButton"})}),d.createElement("span",{className:"u-tiny-spacing-left"},"Existing plate"))))),this.state.shouldCreatePlate?d.createElement("div",{className:"well"},d.createElement(qU.Z,{...n,onUpdate:e=>{this._handleUpdateCreatePlatePane(e)},registryId:n.registry?n.registry.id:this.props.registryId,spreadsheetUploadHelpText:'You must upload a spreadsheet to create wells with your matrix plate. All wells on the matrix plate must be filled to allow transfer. To do so, attach a spreadsheet below with each row specifying a "Container Barcode" and "Destination Well"'})):d.createElement(d.Fragment,null,d.createElement("div",{className:"well"},d.createElement(VU,{onUpdate:e=>{this._handleUpdateExistingPlatePane(e)},registryId:this.props.registryId,selectedGrid:t.selectedGrid})),this.renderPossibleWarning("outputSampleStatusState")))
return d.createElement(et.ZP,{buttons:e,onRequestClose:this.props.onRequestClose,title:"Transfer plates",dataTestAttrs:{component:"TransferPlatesModal",element:"root"}},(()=>this.state.step===WU.CHOOSE_PLATE?d.createElement(d.Fragment,null,this.renderPossibleWarning("inputSampleStatusState"),(!this.state.inputSampleStatusState.shouldShowStatusWarnings||this.state.inputSampleStatusState.canProceedOnSampleStatus)&&o,!this.hasBlockingSampleStatusWarnings()&&this.renderPossibleDestinationWarning(),this.state.shouldShowNameTemplateBanner&&d.createElement("div",{className:(0,g.iv)(QU.nameTemplateInfoBanner)},d.createElement(lq.Z,{itemDescription:"container",isPlural:!0}))):this.state.step===WU.CONFIRM_QUANTITY?d.createElement(zU,{cells:this.props.cells,onChangeShouldTransferAllQuantities:e=>{this._handleChangeShouldTransferAllQuantities(e)},onChangeTransferQuantity:e=>{this._handleChangeTransferQuantity(e)},...a,hasBlockingError:r,onChangeTransferQuantityErrorState:this._handleChangeTransferQuantityErrorState}):d.createElement(QueryingConfirmConcentrationsPane,{paneState:{...i,errorMessage:this.state.errorMessage},onChangeConcentration:this._handleChangeConcentration,allowRecalculateConcentrations:!1}))(),s&&d.createElement(BlockingError,{errorMessage:s}))}}const YU=TransferPlatesModalConnector.connect((function QueryingTransferPlatesModal(e){const[t,n]=(0,d.useState)(null),a=(0,Da.A4)(jU,{skip:null==t,variables:{plateId:null==t?void 0:t.id}}),i=(0,Da.IJ)(HU,{variables:{plateId:e.grid.id},fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0})
let s=Array(e.grid.storableSchema.height).fill(Array(e.grid.storableSchema.width).fill(!1))
if(i.type===Da.NI.SUCCESS){const e=i.data.plates[0];(0,S.hu)(!(0,ka.CZ)(e),"Expected source plate to be accessible")
s=e.cells.map((e=>e.map((e=>null!=e&&!(0,ka.CZ)(e.container)&&e.container.hasNameTemplate))))}else i.type===Da.NI.ERROR&&(0,S.Gp)(!1,`TransferPlatesModalSourcePlateQuery failed for plate: ${e.grid.id}`)
if(a.type===Da.NI.SKIPPED)return d.createElement(TransferPlatesModal,{...e,selectedDestinationPlate:null,isLoadingDestinationPlate:!1,existingPlatePaneState:{selectedGrid:t,setSelectedGrid:n},sourceCellsWithNameTemplate:s})
if(a.type===Da.NI.PENDING)return d.createElement(TransferPlatesModal,{...e,selectedDestinationPlate:null,isLoadingDestinationPlate:!0,existingPlatePaneState:{selectedGrid:t,setSelectedGrid:n},sourceCellsWithNameTemplate:s})
if(a.type===Da.NI.ERROR){v.ZP.error("Could not load destination plate details; try reloading the page.")
e.onRequestClose()
return null}const r=a.data.plates[0];(0,S.hu)(!(0,ka.CZ)(r),"Expected selected destination plate to be accessible")
return d.createElement(TransferPlatesModal,{...e,selectedDestinationPlate:(0,zo.tY)("Plate",r),isLoadingDestinationPlate:!1,existingPlatePaneState:{selectedGrid:t,setSelectedGrid:n},sourceCellsWithNameTemplate:s})})),QU=g.mM.create({errorMessage:{paddingTop:"4px",whiteSpace:"pre-line"},nameTemplateInfoBanner:{marginTop:15}})
var KU=n(572578),JU=n(404565),XU=n(578766)
class MatrixInputModal extends d.Component{constructor(){super(...arguments)
this.handleClose=()=>{this.props.onRequestClose()}
this.handleChangeText=e=>this.props.onChangeText(e.target.value)
this.handleChangeContainerSchema=e=>this.props.onChangeContainerSchema(e.id)
this.handleChangeContainerSource=e=>this.props.onChangeContainerSource(e.sourceId)
this.handleOnClick=()=>this.props.onValidateUploadFromPlateMap(this.props.grid.id,this.props.grid.storableSchema.registryId)}componentDidMount(){this.props.onChangeContainerSchema(this.props.grid.storableSchema.containerSchemaId)
const e=dt.ZP.ENABLE_PROJECTS_REQUIRED_FOR_NON_LOCATION_STORABLES?this.props.grid.sourceId:this.props.grid.storableSchema.registryId
this.props.onChangeContainerSource(e)}render(){var e
return d.createElement(et.ZP,{buttons:[{disabled:this.props.isValidating,onClick:this.handleOnClick,style:C.ZJ.SECONDARY,text:this.props.isValidating?"Validating...":"Next",dataTestAttrs:{component:"MatrixInputModal",key:vb.Z.NEXT}}],closeableOnEscapeKey:!1,onRequestClose:this.handleClose,title:this.props.title},d.createElement(KU.Z,{autoFocus:!0,error:this.props.inputTextError,exampleImageURL:"/static/img/spreadsheet-import-example-fill-box.png",helpText:d.createElement("span",null,d.createElement("p",null,"Text should be in a 2D map format, where each comma- or tab-separated value is the barcode of a container that will be added to that position."),d.createElement("p",null,'Each row and column must have the same number of values. Gaps should be marked as "No tube", "No read", "No code", or "Empty" (case-insensitive).')),label:"Scan data",onTextAreaChange:this.handleChangeText,text:this.props.rawText}),!this.props.grid.storableSchema.containerSchemaId&&d.createElement(Ke.Z,null,d.createElement(Fr.Z,{isRequired:!0,label:"Container Schema",labelStyle:Fr.Z.STYLES.LABEL}),d.createElement(JU.ZP,{error:this.props.schemaError,onChange:this.handleChangeContainerSchema,registryId:this.props.grid.storableSchema.registryId,selectedContainerSchemaId:this.props.selectedContainerSchemaId,shouldShowNoSchemaOption:!1})),d.createElement(Gq.p9,{error:this.props.projectError,onStorableChange:this.handleChangeContainerSource,registryId:this.props.grid.storableSchema.registryId,selectedSourceId:null!==(e=this.props.selectedContainerSourceId)&&void 0!==e?e:null}),d.createElement(SE.Z,null,"Only new containers will be moved to the project folder you’ve selected. Any existing containers will not have their project location changed."))}}MatrixInputModal.propTypes={grid:YZ.vl.isRequired,onRequestClose:J().func.isRequired,title:J().string.isRequired,inputTextError:J().string,isValidating:J().bool.isRequired,rawText:J().string.isRequired,schemaError:J().string,projectError:J().string,selectedContainerSchemaId:J().string,selectedContainerSourceId:J().string,onChangeContainerSchema:J().func.isRequired,onChangeContainerSource:J().func.isRequired,onChangeText:J().func.isRequired,onValidateUploadFromPlateMap:J().func.isRequired}
const eG=(0,_a.$j)((function MatrixInputModal_mapStateToProps(e,t){const{inputTextError:n,schemaError:a,projectError:i,isValidating:s,rawText:r,selectedContainerSchemaId:o,selectedContainerSourceId:l}=e.ui.samples.uploadContainersFlow
return{inputTextError:n,schemaError:a,projectError:i,isValidating:s,rawText:r,selectedContainerSchemaId:o,selectedContainerSourceId:l}}),{onChangeText:XU.XW,onChangeContainerSchema:XU.xP,onChangeContainerSource:XU.Hj,onValidateUploadFromPlateMap:XU.bg})(MatrixInputModal)
var tG=n(102591),nG=n(29363),aG=n(49885)
function GridCellLabel({label:e,className:t,dataTestAttrs:n}){return d.createElement("span",{className:"u-vertical-center-items u-small-spacing-bottom u-small-spacing-top",...(0,ee.Z)({component:"GridCellLabel",element:"root",...n})},d.createElement("div",{className:f()("gridCell--legend","u-mini-spacing-right",t)}),e)}function MoveSummaryLegend({changeStats:e}){return d.createElement("div",{...(0,ee.Z)({component:"MoveSummaryLegend",element:"root"})},d.createElement("span",{className:"legacy-font-proxima-14"},"Summary"),aG.bN.map((t=>{var n
return d.createElement(GridCellLabel,{key:aG.Z9[t].name,label:`${aG.Z9[t].name}: ${null!==(n=null==e?void 0:e[t])&&void 0!==n?n:""}`,className:aG.Z9[t].gridCellClassName})})))}const iG=(0,_a.$j)((function MoveSummaryModal_mapStateToProps(e){const{changes:t,changeStats:n,gridPreview:a,gridCellProps:i,isUploading:s}=e.ui.samples.uploadContainersFlow
return{changes:t,changeStats:n,gridCellProps:i,gridPreview:a,isUploading:s}}),{onGoToPrevious:XU.Yz,onGoToNext:XU.Zm,onSubmit:XU.d_})((function MoveSummaryModal({changes:e,changeStats:t,isUploading:n,gridCellProps:a,gridPreview:i,onGoToPrevious:s,onGoToNext:r,onRequestClose:o,onSubmit:l,title:c,sampleStatusWarningParams:u}){(0,Ul.Z)((()=>{const t=(0,nG.O)(null!=e?e:[]).map((e=>e.container))
u.checkForWarnings(t)}))
const m=t&&t.moveOut>0,p=m?{disabled:u.hasBlockingSampleStatusWarnings(),style:C.ZJ.SECONDARY,text:"Next",onClick:()=>{r()},dataTestAttrs:{component:"MoveSummaryModal",key:vb.Z.NEXT}}:{disabled:n||u.hasBlockingSampleStatusWarnings(),style:C.ZJ.PRIMARY,text:n?"Uploading...":"Submit",submit:!0}
return d.createElement(et.ZP,{buttons:[{pullLeft:!0,style:C.ZJ.TERTIARY_GRAY,text:"Back",onClick:s},p],closeableOnEscapeKey:!1,onRequestClose:o,onRequestSubmit:!m&&i?()=>{l(i.id)}:null,title:c,dataTestAttrs:{component:"MoveSummaryModal",element:"root"}},d.createElement(d.Fragment,null,u.renderPossibleWarning(),d.createElement("div",{className:"u-flex-display"},d.createElement(MoveSummaryLegend,{changeStats:t}),d.createElement(tG.ZP,{className:"gridCells-container--white u-flex-grow",grid:i,gridCellProps:a,showFilledCells:!1}))))}))
var sG=n(319889)
class SelectOrphanParentStorableModal extends d.Component{_shouldDisableSave(){const{isUploading:e,numOrphans:t,selectedParent:n}=this.props,{gridCells:a,storable:i}=n
return!(i&&!e)||(0,JF.h)(i.id)&&a.length!==t}render(){const{helpText:e,isUploading:t,onGoToPrevious:n,onRequestClose:a,onLoadGrid:i,onRemove:s,onSelect:r,onSubmit:o,selectedParent:l,storableSchema:c,title:u}=this.props
return d.createElement(et.ZP,{buttons:[{pullLeft:!0,style:C.ZJ.TERTIARY_GRAY,text:"Back",onClick:n},{text:t?"Uploading...":"Submit",disabled:this._shouldDisableSave(),submit:!0,style:C.ZJ.PRIMARY}],closeableOnEscapeKey:!1,onRequestClose:a,onRequestSubmit:o,title:u},d.createElement("div",{className:"u-small-spacing-bottom"},e),d.createElement(sG.eS,{autoFocus:!1,canSelectMultipleGridCells:!0,onLoadGrid:i,onRemove:s,onSelect:r,isRequired:!0,selectedParent:l,storableSchema:c}))}}SelectOrphanParentStorableModal.propTypes={helpText:J().string,isUploading:J().bool.isRequired,numOrphans:J().number.isRequired,onGoToPrevious:J().func.isRequired,onRequestClose:J().func.isRequired,onLoadGrid:J().func.isRequired,onRemove:J().func.isRequired,onSelect:J().func.isRequired,onSubmit:J().func.isRequired,selectedParent:YZ.Hu.isRequired,storableSchema:hq.zx.isRequired,title:J().string.isRequired}
const rG=(0,_a.$j)((function SelectOrphanParentStorableModal_mapStateToProps(e){const{changeStats:t,gridPreview:n,isUploading:a,selectedContainerSchemaId:i,selectedParent:s}=e.ui.samples.uploadContainersFlow;(0,S.hu)(null!=t,"changeStats should be set before rendering SelectOrphanParentStorableModal")
const r=t.moveOut
return{helpText:`${r} containers will be moved out of ${n.barcode}. Select their new location`,isUploading:a,numOrphans:r,selectedParent:s,storableSchema:KZ.Z.getContainerSchema(i)}}),{onGoToPrevious:XU.Yz,onLoadGrid:XU.xG,onRemove:XU.DZ,onSelect:XU.xG,onSubmit:XU.d_})(SelectOrphanParentStorableModal)
function UploadContainersFlow({grid:e,open:t,onRequestClose:n,modalKey:a}){return d.createElement(M_.Z,{open:t},d.createElement(UploadContainersModal,{grid:e,onRequestClose:n,modalKey:a,title:"Set containers from matrix scanner"}))}UploadContainersFlow.propTypes={grid:YZ.vl.isRequired,onRequestClose:J().func.isRequired,modalKey:J().oneOf(Object.values(aG.fm)).isRequired,open:J().bool.isRequired}
function UploadContainersModal({grid:e,onRequestClose:t,modalKey:n,title:a}){const[i,s]=(0,d.useState)(!1),[r,o]=(0,d.useState)([]),[l,c]=(0,d.useState)(!1),[u,p]=(0,d.useState)(null),[h,g]=(0,d.useState)("");(0,d.useEffect)((()=>{g(m.Vr())}),[])
const checkForWarnings=e=>{var t,n
const{shouldShowWarning:a,samples:l}=(0,oq.CC)({samples:e,showOnlySamplesWithWarnings:!0}),d=null!==(t=null==l?void 0:l.map((({id:e})=>e)))&&void 0!==t?t:[]
if(!i||!Is()(d,r)){s(!1)
c(a)
p(null!=l?l:null)
o(null!==(n=null==l?void 0:l.map((({id:e})=>e)))&&void 0!==n?n:[])}},E={actionOrigin:Sn.D2.UI_UNDETERMINED,actionAttempted:"move_location",eventGroupId:h},renderPossibleWarning=()=>l&&null!=u?d.createElement(oq.F,{sampleIds:u.map((({id:e})=>e)),selectedSampleIds:r,setSelectedSampleIds:o,shouldProceed:i,setShouldProceed:s,trackingParams:E,samples:u,canSelectMultiple:!1}):null,hasBlockingSampleStatusWarnings=()=>l&&!i
switch(n){case aG.fm.MATRIX_INPUT:return d.createElement(eG,{grid:e,onRequestClose:t,title:a})
case aG.fm.CHANGE_SUMMARY:return d.createElement(iG,{onRequestClose:t,title:a,sampleStatusWarningParams:{checkForWarnings,renderPossibleWarning,hasBlockingSampleStatusWarnings}})
case aG.fm.SELECT_PARENT:return d.createElement(rG,{title:a,onRequestClose:t})
default:throw new Error(`Unexpected modal key ${n}`)}}UploadContainersModal.propTypes={grid:YZ.vl.isRequired,modalKey:J().oneOf(Object.values(aG.fm)).isRequired,onRequestClose:J().func.isRequired,title:J().string.isRequired}
const oG=(0,_a.$j)((function UploadContainersFlow_mapStateToProps(e){const{open:t,modalKey:n}=e.ui.samples.uploadContainersFlow
return{open:t,modalKey:n}}))(UploadContainersFlow)
class GridActionsDropdown extends d.Component{constructor(){super(...arguments)
this.getActionOrigin=()=>ea.ZP.apiIdToType(this.props.grid.id)===st.PLATE?Sn.D2.INVENTORY_PLATE_PAGE_GRID_CELL_TOOLBAR:Sn.D2.INVENTORY_BOX_PAGE_GRID_CELL_TOOLBAR
this.handleOpenCreateContainers=()=>{BU.bA({initialParentStorable:this.props.grid,initialRegistry:null,actionOrigin:this.getActionOrigin()})}
this.handleTransferPlate=()=>{!function openTransferPlatesModal(e){Xe.bA(TransferPlatesModal,d.createElement(YU,{...e,onRequestClose:closeTransferPlatesModal}))}({cells:this.props.cells,grid:this.props.grid,registryId:this.props.grid.storableSchema.registryId})}}render(){const e=ea.ZP.apiIdToType(this.props.grid.id)===st.PLATE,t=this.props.cells.length>0,{contentsAreValid:n}=e?MB.Bb(this.props.cells.map((({container:e})=>({...e,containedItemIds:e.contents.map((({containedItemId:e})=>e))})))):{contentsAreValid:!0},a=JF.UP(this.props.grid),i=[[{name:"Create containers",icon:"compose",handleOnClick:this.handleOpenCreateContainers,visible:!a,dataTestAttrs:{component:"GridActionsDropdown",key:"createContainers"}},{name:"Set from matrix scanner",icon:"scan",handleOnClick:this.props.openUploadContainersFlow,visible:!a,dataTestAttrs:{component:"GridActionsDropdown",key:"setFromMatrixScanner"}},{name:"Stamp plate",icon:"plate",handleOnClick:this.handleTransferPlate,visible:e&&t,disabled:!n,tooltipText:n?void 0:MB.hN(a),dataTestAttrs:{component:"GridActionsDropdown",key:"stampPlate"}}]]
return d.createElement("div",{className:"buttonGroup"},d.createElement(oG,{grid:this.props.grid,onRequestClose:this.props.closeUploadContainersFlow}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,isDropdown:!0,size:C.qE.SMALL,text:"Actions",dataTestAttrs:{component:"GridActionsDropdown",element:"actionsButton"}}),d.createElement(LR.Z,{className:"dropdown-menu--dropLeft",items:i}))}}const lG=(0,_a.$j)(null,{closeUploadContainersFlow:XU.Sl,openUploadContainersFlow:XU.O_})(GridActionsDropdown)
class GridCellToolbar extends d.Component{constructor(){super(...arguments)
this.state={isTransferModalOpen:!1}
this._handleOpenTransferModal=()=>{this.setState({isTransferModalOpen:!0})}
this._handleCloseTransferModal=()=>{this.setState({isTransferModalOpen:!1})}}render(){const e=ea.ZP.apiIdToType(this.props.grid.id),t=l.default.pluck(this.props.selectedCells,"container"),n=l.default.pluck(t,"id"),a=Boolean(this.props.selectedCells.length),i=e===st.BOX?"Fill containers":"Fill wells"
return d.createElement("div",{className:"buttonToolbar",...(0,ee.Z)({component:"GridCellToolbar",element:"root"})},d.createElement(M_.Z,{open:this.state.isTransferModalOpen},d.createElement(kq,{flow:YZ.h0.TRANSFER_IN,onRequestClose:this._handleCloseTransferModal,registryId:this.props.grid.storableSchema.registryId,title:i,preselectedOutputConfig:{outputType:st.PLATE,outputPlate:this.props.grid,outputCells:this.props.selectedCells},actionOrigin:e===st.BOX?j.D2.INVENTORY_BOX_PAGE_GRID_CELL_TOOLBAR:j.D2.INVENTORY_PLATE_PAGE_GRID_CELL_TOOLBAR})),this.props.isWritable&&d.createElement(d.Fragment,null,(0,JF.dV)(this.props.grid)?d.createElement(GridCellToolbarFixedPlateActionButtons,{grid:this.props.grid,selectedCells:this.props.selectedCells}):d.createElement("div",{className:"buttonGroup"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,disabled:!a,onClick:this._handleOpenTransferModal,size:C.qE.SMALL,text:i,dataTestAttrs:{component:"Button",key:"Fill containers"===i?"fillContainers":"fillWells"}}))),d.createElement(GridCellToolbarContents,{buttonStyle:C.ZJ.TERTIARY_GRAY,storables:l.default.pluck(this.props.cells,"container"),grid:this.props.grid,selectedIds:n}),this.props.isWritable&&d.createElement(lG,{cells:this.props.cells,grid:this.props.grid}))}}const cG=GridCellToolbar
function useGridContentLots(e){const[t,n]=(0,d.useState)(!1);(0,d.useEffect)((()=>{if(!t){!async function bulkPreloadContentLotNumbersForContainers(e){await(0,Ml.doQuerySafe)({query:BB},{variables:{containerIds:e}})}(e.cells.flatMap((e=>e.filter((e=>null!=(null==e?void 0:e.container))).map((e=>e.container.id)))))
n(!0)}}),[t,e.cells])}function GridContents({grid:e}){useGridContentLots(e)
const t=(0,_a.I0)(),n=(0,_a.v9)((t=>{var n,a
return null!==(a=null===(n=t.ui.samples.gridUI[e.id])||void 0===n?void 0:n.selectedCells)&&void 0!==a?a:[]}))
const a=(0,sV.lx)(e.cells),i=ea.ZP.apiIdToType(e.id),s=(0,sV.Pt)(e,n)
return d.createElement("div",{className:(0,g.iv)(dG.tab),...(0,ee.Z)({component:"GridContents",element:"root"})},d.createElement("div",{className:(0,g.iv)(dG.toolbar)},d.createElement(cG,{cells:a,grid:e,isWritable:e.permissions.writable,selectedCells:s})),d.createElement("div",{className:(0,g.iv)(dG.tableContainer)},d.createElement(wV,{cells:a,grid:e,gridType:i,onSelectCells:function handleSelectCells(n){t((0,rV.QB)(e.id,n))},selectedCells:s})))}const dG=g.mM.create({tab:{display:"flex",flexDirection:"column",height:"100%"},toolbar:{display:"flex",justifyContent:"flex-end",margin:"16px 0"},tableContainer:{height:"100%",flex:1}})
var uG=n(831243)
function InlineField({children:e,className:t,label:n}){return d.createElement("div",{className:f()("inlineField",t)},d.createElement("strong",{className:"u-small-spacing-right"},n),e)}InlineField.propTypes={children:J().node.isRequired,className:J().string,label:J().string.isRequired}
function GridToolbar({grid:e,onSetParentStorable:t}){const n=C.ZJ.TERTIARY_BLUE,a=ea.ZP.apiIdToType(e.id),i=(0,Mt.E2)(a)
return d.createElement("div",{className:"buttonToolbar"},e.permissions.writable&&d.createElement("div",{className:"buttonGroup"},d.createElement(Mq.Z,{isWritable:e.permissions.writable,onSetParentStorable:t,waitForSubmitErrors:!0,storableSchema:e.storableSchema})),d.createElement("div",{className:"buttonGroup"},d.createElement(QB.Z,{buttonStyle:n,itemIds:[e.id]}),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&a===st.PLATE&&d.createElement(kR.Z,{className:"u-mini-spacing-left",buttonStyle:C.ZJ.TERTIARY_BLUE,ids:[e.id],refreshOptions:{refreshRecentWorklists:!0}}),d.createElement(wR.Z,{archiveTooltipTitle:`Archive ${i}`,unarchiveTooltipTitle:`Unarchive ${i}`,buttonStyle:n,isArchivable:Boolean(e.permissions.archivable),isUnarchivable:Boolean(e.permissions.unarchivable),item:e,onArchive:IR.At,onUnarchive:IR.iA}),d.createElement($k.Z,{buttonStyle:n,ids:[e.id]})))}class GridHeader extends d.Component{constructor(){super(...arguments)
this.handleSetParentStorable=(e,t,n)=>{xB.updateGridWithDataMods(this.props.grid.id,this.props.folderId,{parentStorableData:e},n)}
this.handleUpdateName=e=>{xB.updateGridWithDataMods(this.props.grid.id,this.props.folderId,{name:e})}
this.handleUpdateBarcode=e=>{xB.updateGridWithDataMods(this.props.grid.id,this.props.folderId,{newBarcode:e})}
this.getBarcodeValueProps=()=>dt.ZP.INVENTORY_ENABLE_EDIT_BARCODES?{storable:this.props.grid,isDisabled:!this.props.grid.permissions.canEditNamesAndBarcodes,handleBarcodeChange:this.handleUpdateBarcode,disableEditsWithTooltip:(0,JF.fm)(this.props.grid.permissions.canEditNamesAndBarcodes)}:{storable:this.props.grid}}render(){return d.createElement("div",{className:"gridHeader"},d.createElement("div",{className:"u-lr-split"},d.createElement("div",{className:"gridHeader-title"},d.createElement(Iw.Z,{isDisabled:!this.props.grid.permissions.canEditNamesAndBarcodes,requestChange:this.handleUpdateName,value:this.props.grid.name,disableEditsWithTooltip:(0,JF.bw)(this.props.grid.permissions.canEditNamesAndBarcodes)}),d.createElement(lC.Z,{item:this.props.grid})),d.createElement(GridToolbar,{grid:this.props.grid,onSetParentStorable:this.handleSetParentStorable})),d.createElement(InlineField,{label:"Barcode"},d.createElement(BarcodeValue,{...this.getBarcodeValueProps()})),this.props.parentStorable&&d.createElement(InlineField,{label:"Location"},d.createElement(ParentStorableDetails,{isWritable:this.props.grid.permissions.writable,onSetParentStorable:this.handleSetParentStorable,parentStorable:this.props.parentStorable})))}}const mG=GridHeader
function GridMetadata({grid:e,folderId:t,parentStorable:n}){const a=e.permissions.writable,i=(0,pC.IT)(e.tags),s=(0,Mt.E2)(ea.ZP.apiIdToType(e.id))
return d.createElement("div",{className:(0,g.iv)(pG.metadataTab),...(0,ee.Z)({component:"GridMetadata",element:"root"})},d.createElement(mG,{folderId:t,grid:e,parentStorable:n}),d.createElement(h.Z,{className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Schema"),d.createElement("div",null,(0,Vw.Z)(e.storableSchema))),d.createElement(p.Z,{sm:6},d.createElement(Gq.Hn,{isWritable:a,registryId:e.storableSchema.registryId,onChange:async function handleProjectChange(n){await xB.updateGridWithDataMods(e.id,t,{sourceId:n})},selectedSourceId:e.sourceId}))),dt.ZP.INVENTORY_ENABLE_LOCATION_CAPACITY&&!(0,JF.UP)(e)&&d.createElement(h.Z,{className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Available space"),d.createElement("div",null,`${(0,sV.Qc)(e)} / ${(0,sV.BR)(e)}`))),dt.ZP.STUDIES_ENABLE&&(0,WN.Hw)(e)&&d.createElement(h.Z,{className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Studies"),d.createElement(KN,{studyable:e,isWritable:e.permissions.writable}))),d.createElement("div",{className:"u-spacing-top"},d.createElement(EC,{emptyMessage:`This ${s} has no schema fields.`,fileId:e.id,itemLinkAllowed:!1,initialTags:i,areTagsEditable:a,title:`${(0,Mt.kC)(s)} field`,updateTags:async function handleUpdateTags(n){const{toSet:a}=n,i=await xB.updateGridWithDataMods(e.id,t,{tags:a})
return i&&[{id:i.id,tags:(null==i?void 0:i.tags)?(0,pC.IT)(i.tags):(0,pC.IT)(e.tags)}]}})))}const pG=g.mM.create({metadataTab:{maxWidth:828,margin:"auto"}})
function GridVisualization({grid:e,selectedCells:t,onSelectCells:n}){var a,i
const{plateMap:s}=usePlateMapFromGrid(e),{assignmentGroupsPerAttribute:r,selectedAttribute:o,setSelectedAttribute:l,displayLayer:c}=usePlateMapDisplayAttributeState(s,jV.nq,!0)
return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(hG.layerDropdown)},d.createElement(PlateMapDisplayLayerDropdown,{containerSchemaId:e.storableSchema.containerSchemaId,additionalAttributeOptions:[jV.nq,jV.m0],selectedAttribute:o,setSelectedAttribute:l})),d.createElement(PlateMapView,{plateMap:s,selectedWellIndices:new Set((0,JF.A0)(t,e)),setSelectedWellIndices:t=>{const a=[...t].map((t=>{const{row:n,column:a}=(0,MV.X1)(t,s.size)
return e.cells[n][a]})).filter((e=>null!=e))
n(a)},assignmentGroupsById:null!==(a=r[(0,MV.BV)(o)])&&void 0!==a?a:{},isViewOnly:!1,displayLayer:c,showSelectedAsPreview:!1,selectedAttribute:o}),d.createElement(PlateMapLegend,{plateMap:s,displayLayer:c,assignmentGroupsById:null!==(i=r[(0,MV.BV)(o)])&&void 0!==i?i:{},selectedAttribute:o}))}const hG=g.mM.create({layerDropdown:{marginBottom:"16px",width:"300px"}})
function OpenContainerLink({container:e}){return d.createElement(P.ZP,{title:"Open container"},d.createElement("a",{className:"u-base-text u-tiny-spacing-left",onClick:()=>{xB.open(e)}},d.createElement(pe.Z,{icon:"upload"})))}async function checkSampleStatus({container:e,actionAttempted:t,eventGroupId:n}){const{shouldProceed:a}=await(0,LB.jT)({sampleIds:e?[e.id]:[],trackingParams:{actionOrigin:j.D2.INVENTORY_REGISTRY_SEARCH_UI,actionAttempted:t,eventGroupId:n}})
return a}function GridCellDetails({gridType:e,grid:t,isWritable:n,cells:a}){const i=t.cells[0].length
return d.createElement("div",{className:"u-padding-top"},a.map(((a,s)=>d.createElement("div",{className:"u-spacing-top",key:s},d.createElement(so.R6,null,JF.vZ({gridType:e,rowIndex:a.rowIndex,columnIndex:a.columnIndex,width:i,includeNoun:!0}),d.createElement(OpenContainerLink,{container:a.container})),d.createElement("div",{className:"u-flex-display"},!JF.UP(t)&&d.createElement(InlineField,{className:"u-flex-grow",label:"Barcode"},a.container.barcode||d.createElement("span",{className:"u-faded"},"No Barcode")),d.createElement(InlineField,{className:"u-flex-grow",label:(0,HB.Z)()},d.createElement(ZB,{isDisabled:!n,measurement:a.container.quantity,onComplete:e=>{xB.updateContainerWithDataMods(a.container.id,{quantity:e})},validUnits:(0,kB.kI)(),confirmBeforeStartEditing:()=>checkSampleStatus({container:a.container,actionAttempted:"update_quantity",eventGroupId:m.Vr()}),disableEditsWithTooltip:(0,DB.p5)(a.container)}))),a.container.contents.length>0?d.createElement(qB,{containerId:a.container.id,containerContents:a.container.contents,checkSampleStatus:({actionAttempted:e,eventGroupId:t})=>checkSampleStatus({container:a.container,actionAttempted:e,eventGroupId:t}),disableEditsWithTooltip:(0,DB.p5)(a.container)}):d.createElement("div",null,"No contents in"," ",JF.vZ({gridType:e,rowIndex:a.rowIndex,columnIndex:a.columnIndex,width:i,includeNoun:!0}),".")))))}function GridView(e){useGridContentLots(e.grid)
const t=(0,_a.I0)(),n=(0,_a.v9)((t=>{var n,a
return null!==(a=null===(n=t.ui.samples.gridUI[e.grid.id])||void 0===n?void 0:n.selectedCells)&&void 0!==a?a:[]}))
function handleSelectCells(n){t((0,rV.QB)(e.grid.id,n))}const a=ea.ZP.apiIdToType(e.grid.id),i=(0,sV.Pt)(e.grid,n),s=i.filter((e=>null!=e)).map((e=>(0,he.Z)(e,"columnIndex","rowIndex")))
return d.createElement("div",{...(0,ee.Z)({component:"GridView",element:"root"})},d.createElement(StorableBanner,{isWritable:e.grid.permissions.writable,storable:e.grid}),d.createElement("div",{className:"react-tab-container tab-fixed-vertical-scroll"},d.createElement("div",{className:(0,g.iv)(gG.container)},d.createElement("h1",{className:(0,g.iv)(gG.gridName)},e.grid.name),(0,JF.dV)(e.grid)?d.createElement("div",{className:(0,g.iv)(gG.plateVisualizationContainer)},d.createElement(GridVisualization,{grid:e.grid,onSelectCells:handleSelectCells,selectedCells:n})):d.createElement(Eq.ZP,{checkCell:(e,t)=>!(0,Eq.t1)(e,t),grid:e.grid,isCompact:!1,onSelectCells:handleSelectCells,selectedCells:s}),e.grid.isLoading?d.createElement("div",{className:"u-padding-top"},d.createElement("div",{className:"text-center u-spacing-top"},d.createElement(kl.Z,null))):i.length>0?d.createElement(GridCellDetails,{cells:i,gridType:a,grid:e.grid,isWritable:e.grid.permissions.writable}):null)))}const gG=g.mM.create({container:{margin:"auto",maxWidth:900},gridName:{marginBottom:16},plateVisualizationContainer:{maxWidth:800}})
class GridTabView extends Js{render(){(0,Me.A9)(d.createElement(iV,{gridId:this.model.get("gridId")},(e=>d.createElement(GridView,{...e}))),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}GridTabView.className="buffer-tab buffer-tab--no-padding"
var EG=n(686096),fG=n(853865)
class PrintLabelIcon extends d.Component{constructor(){super(...arguments)
this.handleOpenPrintBarcodeModal=()=>{(0,Xn.Z)(AR.ZP,{itemIds:this.props.itemIds})}}render(){return(0,ln.cr)({feature:on.TD.INVENTORY_EXPORT})?d.createElement(P.ZP,{title:"Print..."},d.createElement(pe.Z,{className:"u-mini-spacing-left u-pointer",icon:"format-print",onClick:this.handleOpenPrintBarcodeModal})):null}}const SG=PrintLabelIcon,yG=C.ZJ.TERTIARY_GRAY
function LocationToolbar({location:e,onSetParentStorable:t,reload:n}){return d.createElement("div",{className:"buttonToolbar"},e.permissions.writable&&d.createElement("div",{className:"buttonGroup"},d.createElement(Mq.Z,{isWritable:e.permissions.writable,onSetParentStorable:t,storableSchema:e.storableSchema,buttonStyle:yG,initialSelectedParentId:e.parentStorable&&(0,ka.k3)(e.parentStorable),allowNone:!0})),d.createElement("div",{className:"buttonGroup"},d.createElement(QB.Z,{buttonStyle:yG,itemIds:[e.id]}),d.createElement(wR.Z,{archiveTooltipTitle:"Archive location",unarchiveTooltipTitle:"Unarchive location",buttonStyle:yG,isArchivable:Boolean(e.permissions.archivable),isUnarchivable:Boolean(e.permissions.unarchivable),item:e,onArchive:async function handleArchive(e,t,a){await IR.At(e,t,a)
n()},onUnarchive:async function handleUnarchive(e){await IR.iA(e)
n()}}),d.createElement($k.Z,{buttonStyle:yG,ids:[e.id]})))}var bG=n(627287),TG=n(718247),vG=n(649787)
function StorableBreadcrumbs(e){const t=[e.storable,...e.storable.ancestry]
t.reverse()
const n=t.map((e=>{if((0,ka.CZ)(e))return d.createElement(Cw.Ak,{key:`crumb-${e.invalidId}`,text:"(No access)"})
{const t={...e,storableSchema:{registryId:e.storableSchema.registry.id}}
return d.createElement(Cw.Ak,{key:`crumb-${e.id}`,text:e.name,onClick:()=>{xB.open(t)}})}}))
return d.createElement(Cw.ZP,{crumbs:n})}const CG=[{name:"Yes",value:!0},{name:"No",value:!1}]
function getSelectedDisplayText(e){var t
const n=CG.find((t=>t.value===e));(0,S.Gp)(null!=n,`EditableBooleanDropdownField expects selectedValue of type "boolean", not "${typeof e}"`,{selectedValue:void 0===e?"<undefined>":e})
return null!==(t=null==n?void 0:n.name)&&void 0!==t?t:null}function BooleanDropdown(e){const t=getSelectedDisplayText(e.selectedValue)
return d.createElement("div",{className:(0,g.iv)(IG.dropdown)},d.createElement($r.ZP,{disabled:e.disabled,displayName:t,menu:d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.FULL},CG.map(((t,n)=>d.createElement(N.Z,{key:n,onSelect:()=>{e.onChange(t.value)},value:t.value,isSelected:t.value===e.selectedValue},t.name))))}))}function EditableBooleanDropdownField(e){const[t,n]=(0,d.useState)(e.selectedValue),[a,i]=(0,d.useState)(!1),s=getSelectedDisplayText(e.selectedValue);(0,d.useEffect)((()=>{n(e.selectedValue)}),[e.selectedValue])
if(e.isForCreate)return d.createElement(BooleanDropdown,{...e})
return d.createElement(VV.Z,{editor:d.createElement(BooleanDropdown,{...e,onChange:n,selectedValue:t}),isBeingEdited:a,isWritable:!e.disabled,viewer:d.createElement("div",{className:f()({[(0,g.iv)(IG.nonCompactViewer)]:!e.shouldUseCompactDisplay})},s),onCancel:()=>{i(!1)
n(e.selectedValue)},onComplete:()=>{e.onChange(t)
n(e.selectedValue)
i(!1)},onEdit:()=>{i(!0)},isFullWidth:e.isFullWidth,isCompleteEnabled:!0,dataTestAttrs:e.dataTestAttrs})}const IG=g.mM.create({dropdown:{flex:"1",whiteSpace:"normal"},nonCompactViewer:{...Dn.fC}})
function LocationView(e){const t=Sn.D2.INVENTORY_LOCATION_PAGE
async function updateLocationWithDataModsWithAnalyticsContext(n,a){return await ma.S8({analyticsMetadata:{actionOrigin:t,actionMethod:a}},null,(async()=>{const t=await xB.updateLocationWithDataMods(e.location.id,n)
e.reload()
return t}))}async function updateLocationAndReportError(e){try{return await e()}catch(e){const t=v.ZP.getFriendlyError(e)
if(null!=t){v.ZP.error(t)
return null}throw e}}async function updateLocationWithOptimisticUpdate({locationFields:t,actionMethod:n,optimisticData:a,revertData:i}){await updateLocationAndReportError((async()=>await(0,$C.Y)({persistData:async()=>await updateLocationWithDataModsWithAnalyticsContext(t,n),writeDataToCache:t=>{(0,Ml.writeQuery)({query:bG.gn},t,{id:e.location.id})},optimisticData:a,revertData:i})))}async function handleUpdateCapacityConfiguration(t){await updateLocationWithOptimisticUpdate({locationFields:t,actionMethod:Sn.LY.IN_LINE_EDIT,optimisticData:{location:(0,bG.ur)({...e.location,...t})},revertData:{location:(0,bG.ur)(e.location)}})}async function handleUpdateBarcode(t){await updateLocationWithOptimisticUpdate({locationFields:{barcode:t},actionMethod:Sn.LY.IN_LINE_EDIT,optimisticData:{location:(0,bG.ur)({...e.location,barcode:t})},revertData:{location:(0,bG.ur)(e.location)}})}const n=(0,pC.IT)(e.location.tags),a=dt.ZP.INVENTORY_ENABLE_LOCATION_CAPACITY?d.createElement(d.Fragment,null,d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Allows plates, boxes, and containers"),d.createElement(EditableBooleanDropdownField,{selectedValue:e.location.allowsNonLocationChildren,onChange:async function handleUpdateAllowsNonLocationChildren(t){t||null==e.location.capacity&&null==e.location.allowedChildStorableSchemaApiIds?await handleUpdateCapacityConfiguration({allowsNonLocationChildren:t}):je.iG("Disallow plates, boxes, and containers?","This will also clear the specified capacity and allowed inventory schemas.",C.ZJ.NEGATIVE,{acceptText:"Continue",enableRedesign:!0}).done((()=>{handleUpdateCapacityConfiguration({allowsNonLocationChildren:t,capacity:null,allowedChildStorableSchemaApiIds:null})}))},shouldUseCompactDisplay:!0,disabled:!e.location.permissions.writable})),e.location.allowsNonLocationChildren&&d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Allowed inventory schemas"),d.createElement(TG.Z,{selectedSchemaIds:e.location.allowedChildStorableSchemaApiIds,onSetSelectedSchemaIds:async function handleUpdateAllowedChildSchemas(e){await handleUpdateCapacityConfiguration({allowedChildStorableSchemaApiIds:e})},shouldUseCompactDisplay:!0,registryId:e.location.storableSchema.registryId,isDisabled:!e.location.permissions.writable}))),e.location.allowsNonLocationChildren&&d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Inventory capacity"),d.createElement(vG.Z,{capacity:e.location.capacity,onChange:async function handleUpdateCapacity(e){await handleUpdateCapacityConfiguration({capacity:e})},shouldUseCompactDisplay:!0,disabled:!e.location.permissions.writable})),null!=e.location.capacity&&null!=e.location.occupiedCapacity&&d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Available space"),d.createElement("div",null,(0,JF.XF)(e.location.capacity,e.location.occupiedCapacity))))):null
return d.createElement("div",null,d.createElement(StorableBanner,{isWritable:e.location.permissions.writable,storable:e.location}),d.createElement("div",{className:"react-tab-container"},d.createElement("div",{className:"react-tab-container-narrowTab"},d.createElement("div",{className:"u-lr-split"},d.createElement(so.R6,null,d.createElement(Iw.Z,{isDisabled:!e.location.permissions.canEditNamesAndBarcodes,requestChange:async function handleUpdateName(t){await updateLocationWithOptimisticUpdate({locationFields:{name:t},actionMethod:Sn.LY.IN_LINE_EDIT,optimisticData:{location:(0,bG.ur)({...e.location,name:t})},revertData:{location:(0,bG.ur)(e.location)}})},value:e.location.name,disableEditsWithTooltip:JF.bw(e.location.permissions.canEditNamesAndBarcodes)}),d.createElement(lC.Z,{item:e.location})),d.createElement(LocationToolbar,{location:e.location,onSetParentStorable:async function handleSetParentStorable(e){await updateLocationAndReportError((async()=>await updateLocationWithDataModsWithAnalyticsContext({parentStorableData:e},Sn.LY.BUTTON_CLICK)))},reload:e.reload})),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Barcode"),d.createElement("div",{className:"u-vertical-center-items"},d.createElement(BarcodeValue,{...function getBarcodeValueProps(){return dt.ZP.INVENTORY_ENABLE_EDIT_BARCODES?{storable:e.location,isDisabled:!e.location.permissions.canEditNamesAndBarcodes,handleBarcodeChange:handleUpdateBarcode,disableEditsWithTooltip:(0,JF.fm)(e.location.permissions.canEditNamesAndBarcodes)}:{storable:e.location}}()}),d.createElement(SG,{itemIds:[e.location.id]})))),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Location"),e.location.parentStorable&&(0,ka.CZ)(e.location.parentStorable)?d.createElement(d.Fragment,null,"No access"):d.createElement(StorableBreadcrumbs,{storable:e.location})),d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Schema"),d.createElement("div",null,(0,Vw.Z)(e.location.storableSchema)))),d.createElement(h.Z,{bufferRowReset:!0,className:"u-spacing-top"},d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Creator"),d.createElement(qq.Z,{creator:e.location.creator})),d.createElement(p.Z,{sm:6},d.createElement(so.Dx,null,"Created"),d.createElement("span",null,(0,Hr.UT)(e.location.createdAt)))),a,d.createElement("div",{className:"u-spacing-top"},d.createElement(EC,{emptyMessage:"This location has no schema fields.",fileId:e.location.id,itemLinkAllowed:!1,initialTags:n,areTagsEditable:e.location.permissions.writable,title:"Location fields",updateTags:async function handleUpdateTags(t){const{toSet:n}=t,a=await updateLocationAndReportError((async()=>await updateLocationWithDataModsWithAnalyticsContext({tags:n},null)))
return null!=a?[{id:a.id,tags:(null==a?void 0:a.tags)?(0,pC.IT)(null==a?void 0:a.tags):(0,pC.IT)(e.location.tags)}]:null}})))))}function LocationViewContainer(e){const t=(0,Da.IJ)(bG.gn,{variables:{id:e.locationId},renderCachedDataWhenRefetching:!0,fetchPolicy:"cache-and-network"})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.SUCCESS){const n=t.data.location
if((0,ka.CZ)(n))return d.createElement(_B.H4,{message:"Item not found or you may not have permissions to view the item."})
const a=(0,bG.V7)(n),reload=()=>{t.refetch({id:e.locationId})}
return d.createElement(LocationView,{location:a,reload})}return null}class LocationTabView extends s().View{render(){(0,Me.A9)(d.createElement(LocationViewContainer,{locationId:this.model.get("id")}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}LocationTabView.prototype.className="buffer-tab buffer-tab--no-padding"
var wG=n(812455),NG=n(593732)
const AG=function StorableInfoTableFromListing({emptyTableText:e,listing:t,onChangeArchivePurposes:n,selectedArchivePurposes:a,setOffset:i,itemWord:s,containableId:r}){return t?t.loadSuccess?null==t.items?d.createElement(kl.Z,null):d.createElement(Xq,{emptyTableText:e,storables:t.items,storableSummaryExtras:t.storableSummaryExtras,isLoading:t.isLoading,onChangeArchivePurposes:n,pagination:t.pagination,selectedArchivePurposes:a,setOffset:i,itemWord:s,containerContentContainableId:r}):t.isLoading?d.createElement(kl.Z,null):d.createElement("div",{className:"u-faded"},"Data failed to load."):null},RG={includeStorableSummaryExtras:!0}
class ContainableStorageTables extends d.Component{constructor(){super(...arguments)
this.state={containerListingId:this.props._containerListingId||l.default.uniqueId("listingId"),plateListingId:this.props._plateListingId||l.default.uniqueId("listingId"),selectedContainerArchivePurposes:[zu.BH],selectedPlateArchivePurposes:[zu.BH]}
this.handleContainerSetOffset=e=>{xB.listContainableContainers(this.state.containerListingId,this.props.containableId,e,50,{...RG,archivePurposes:this.state.selectedContainerArchivePurposes})}
this.handleOpenCreateContainers=()=>{BU.bA({initialRegistry:null,initialInputContainableId:this.props.containableId,disallowContainableEdit:!0,shouldIncludeStorableSummaryExtrasOnRelist:!0,initialParentStorable:null,actionOrigin:j.D2.REGISTRY_ITEM_PAGE_STORAGE_TAB})}
this.handlePlatesSetOffset=e=>{xB.listContainablePlates(this.state.plateListingId,this.props.containableId,e,50,{...RG,archivePurposes:this.state.selectedPlateArchivePurposes})}
this.handleContainerChangeArchivePurposes=e=>{this.setState({selectedContainerArchivePurposes:e})
xB.listContainableContainers(this.state.containerListingId,this.props.containableId,0,50,{...RG,archivePurposes:e})}
this.handlePlateChangeArchivePurposes=e=>{this.setState({selectedPlateArchivePurposes:e})
xB.listContainablePlates(this.state.plateListingId,this.props.containableId,0,50,{...RG,archivePurposes:e})}}componentDidMount(){l.default.defer((()=>{this.handleContainerSetOffset(0)
this.handlePlatesSetOffset(0)}))}componentWillUnmount(){const{containerListingId:e,plateListingId:t}=this.state
l.default.defer((()=>{xB.clearContainerListing(e)
xB.clearPlateListing(t)}))}UNSAFE_componentWillReceiveProps(e){this.props.containerListings[this.state.containerListingId]&&!this.props.containerListings[this.state.containerListingId].isStale&&e.containerListings[this.state.containerListingId].isStale&&l.default.defer((()=>{this.handleContainerSetOffset(0)}))
this.props.plateListings[this.state.plateListingId]&&!this.props.plateListings[this.state.plateListingId].isStale&&e.plateListings[this.state.plateListingId].isStale&&l.default.defer((()=>{this.handlePlatesSetOffset(0)}))}render(){return d.createElement("div",null,(()=>d.createElement("div",{className:"containableSamples-containers"},d.createElement("div",{className:"u-spacing-bottom"},d.createElement("h3",null,"Containers",!this.props.isReadOnly&&d.createElement(vy.Z,{onClick:this.handleOpenCreateContainers})),d.createElement(AG,{emptyTableText:"No containers",listing:this.props.containerListings[this.state.containerListingId],containableId:this.props.containableId,onChangeArchivePurposes:this.handleContainerChangeArchivePurposes,selectedArchivePurposes:this.state.selectedContainerArchivePurposes,setOffset:this.handleContainerSetOffset,itemWord:"container"})),d.createElement("div",null,d.createElement("h3",null,"Plates"),d.createElement(AG,{emptyTableText:"No plates",listing:this.props.plateListings[this.state.plateListingId],onChangeArchivePurposes:this.handlePlateChangeArchivePurposes,selectedArchivePurposes:this.state.selectedPlateArchivePurposes,setOffset:this.handlePlatesSetOffset,itemWord:"plate"}))))())}}class BioentityStorablesView extends d.Component{constructor(){super(...arguments)
this.state={isTransferModalOpen:!1}
this._handleOpenTransferModal=()=>{this.setState({isTransferModalOpen:!0})}
this._handleCloseTransferModal=()=>{this.setState({isTransferModalOpen:!1})}}componentDidMount(){(0,NG.z)(lA.V.BIOENTITY_SUMMARY,this.props.bioentityId)}render(){return this.props.loading?d.createElement("div",{className:"react-tab-container"},d.createElement("div",{className:"u-spacing-top text-center"},d.createElement(kl.Z,null))):d.createElement("div",{className:"react-tab-container storageView"},d.createElement(M_.Z,{open:this.state.isTransferModalOpen},d.createElement(kq,{flow:YZ.h0.TRANSFER_OUT,onRequestClose:this._handleCloseTransferModal,registryId:this.props.tagSchema.registryId,title:"Add to containers",preselectedInputConfig:{inputType:XB.wD.EXISTING_BIOENTITY,inputBioentity:this.props.bioentitySummary},actionOrigin:j.D2.REGISTRY_ITEM_PAGE_STORAGE_TAB})),d.createElement(P.ZP,{title:"Add to containers"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:"u-no-wrap",disabled:!this.props.bioentitySummary,icon:"transfer",onClick:this._handleOpenTransferModal,size:C.qE.SMALL})),d.createElement(ContainableStorageTables,{containableId:this.props.bioentityId,containerListings:this.props.containerListings,isReadOnly:!this.props.permissions.appendable,plateListings:this.props.plateListings}))}}BioentityStorablesView.propTypes={bioentityId:J().string.isRequired,permissions:LN.OD.isRequired,tagSchema:tw.TAG_SCHEMA_SHAPE,loading:J().bool.isRequired,containerListings:J().objectOf(jq.Kp).isRequired,plateListings:J().objectOf(jq.Kp).isRequired,bioentitySummary:VR.Fl}
const PG=(0,gk.compose)((0,_a.$j)((function BioentityStorablesView_mapStateToProps(e,{bioentityId:t}){return{bioentitySummary:e.models.fileSummariesById[t]}})),WZ.Z.connect((function mapStorableStoreToProps(e,{bioentityId:t}){const n=WZ.Z.getContainableContainerListings(),a=WZ.Z.getContainablePlateListings()
return{loading:!(n&&a),containerListings:n,plateListings:a}})))(BioentityStorablesView)
class StorageTabView extends s().View{render(){const e=this.model.get("model");(0,Me.A9)(d.createElement(PG,{bioentityId:e.id,permissions:e.permissions(),tagSchema:e.tagSchema()}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}StorageTabView.prototype.className="buffer-tab buffer-tab-reset buffer-tab--no-padding"
const OG=StorageTabView
var xG=n(442281),_G=n(414049),DG=n(645773)
const LG=g.mM.create({container:{height:"100%",paddingRight:"calc(calc(100% / 22) + 12px)"}}),kG=(0,UP.ZP)((function StudyItemsListing(e){const[t,n]=(0,d.useState)((0,_G.q)())
return d.createElement("div",{className:(0,g.iv)(LG.container)},d.createElement(BP.ZP,{...e,isExpanded:!0,enableToggleExpanded:!1,activeItemId:null,isCompactDisplay:(0,_G.q)(),setIsCompactDisplay:e=>{n(e)
We.Z.set(ZP.CL.SIDEPANEL_IS_DISPLAY_COMPACT,e)},actionSource:j.D2.STUDY_ITEMS_PAGE,availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_IDENTIFIER_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],availableTypes:(0,WN.Ur)().filter((e=>(0,DG.Z)(e))),extraPrimaryFilterOptions:[],preservedFilterKeys:[Kn.Vm.IN_STUDY],section:ZP.$0.STUDY_ITEMS,dataTestAttrs:{component:"StudyItemsListing",element:"root"}}))}),Kn.Sc.STUDY_ITEMS,ZP.SA.STUDY_ITEMS,{})
class StudyListingTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}render(){const e=this.model.get("studyId")
!function initializeSearchForItemsInStudy(e){(0,Vn.getStore)().dispatch((0,VP._c)(ZP.SA.STUDY_ITEMS,Kn.Sc.STUDY_ITEMS,{offset:0,limit:(0,TN.z3)(),query:"",sorts:(0,qP.i_)(ZP.$0.SEARCH),filters:[{...(0,Kn.QW)(Kn.Vm.IN_STUDY),value:e},{...(0,Kn.QW)(Kn.Vm.TYPES),value:(0,WN.Ur)().filter((e=>(0,DG.Z)(e)))}]},[null,null]))}(e);(0,Me.A9)(d.createElement(kG,{studyId:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}StudyListingTabView.initClass()
var MG=n(771479)
function SetStudyPhaseDropdown({study:e,refetch:t,isDisabled:n}){const[a,i]=(0,d.useState)(!1),setPhase=async n=>{i(!0)
try{await ma.S8({analyticsMetadata:{actionOrigin:Sn.D2.STUDY_OVERVIEW_PAGE}},null,(async()=>{await hR.m9(e.id,{phase:n})
await t()}))}finally{i(!1)}}
switch(e.phase){case Sn.Bf.DESIGN:return d.createElement(C.Co,{disabled:a||n,onClick:()=>{setPhase(Sn.Bf.EXECUTION)},size:C.qE.SMALL,buttonStyle:C.ZJ.PRIMARY,text:"Proceed to execution"})
case Sn.Bf.EXECUTION:return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{width:w.ZP.WIDTHS.MEDIUM},d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{setPhase(Sn.Bf.COMPLETE)}},"Mark study as complete")),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{setPhase(Sn.Bf.DESIGN)}},"Return to design phase")))},d.createElement(C.Co,{disabled:a||n,isDropdown:!0,size:C.qE.SMALL,buttonStyle:C.ZJ.PRIMARY,text:"Proceed to completion"}))
case Sn.Bf.COMPLETE:return d.createElement(I.ZP,{menu:d.createElement(w.ZP,{width:w.ZP.WIDTHS.MEDIUM},d.createElement(N.Z,{onSelect:()=>{setPhase(Sn.Bf.DESIGN)}},"Return to design phase"),d.createElement(N.Z,{onSelect:()=>{setPhase(Sn.Bf.EXECUTION)}},"Return to execution phase"))},d.createElement(C.Co,{disabled:a||n,isDropdown:!0,size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_BLUE,text:"Reopen study"}))
default:(0,S.Gp)(!1,`Unexpected phase: ${(0,Go.vE)(e.phase)}`)
return null}}var FG=n(243908),ZG=n(393686)
function StudyDescriptionEditor({study:e,refetch:t,isWritable:n}){return d.createElement(ZG.ZP,{isBeingCreated:!1,isWritable:n,label:"",name:"description",onChange:n=>{(async n=>{await hR.m9(e.id,{description:n})
await t()})(n)},value:e.description,emptyValueAllowed:!0,textPlaceholder:"This study has no description",type:Iw.T.TEXTAREA,maxLength:FG.Ry})}function StudyDesignOverview({study:e}){let t;(0,ka.CZ)(e.designEntry)||(t=e.designEntry.review?{...e.designEntry.review,authors:e.designEntry.review.authorsJson,auditors:e.designEntry.review.auditorsJson,reviewLifecycleVersion:e.designEntry.review.reviewLifecycleVersion||void 0}:void 0)
return d.createElement("table",{className:(0,g.iv)(BG.designTable)},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",{className:(0,g.iv)(BG.designTableTh)},"Study design entry"),d.createElement("th",{className:(0,g.iv)(BG.designTableTh)},"Status"))),d.createElement("tbody",null,d.createElement("tr",null,d.createElement("td",null,d.createElement(sc.Z,{id:(0,ka.CZ)(e.designEntry)?e.designEntry.invalidId:e.designEntry.id,size:Za.TK.MINI})),d.createElement("td",null,(0,ka.CZ)(e.designEntry)?d.createElement("p",null,"You do not have permission to view the review status of the design entry."):d.createElement(Ik.Z,{review:t})))))}const BG=g.mM.create({designTable:{width:"100%",tableLayout:"fixed"},designTableTh:{paddingBottom:5}})
var qG=n(855917),VG=n(550910),UG=n(549983)
function ExecutionPhaseDropdowns({study:e}){var t,n
const a=(0,VG.fl)(),i=function useTagSchemas(){const e=useStoreSelector(JZ.Z,(0,d.useCallback)((e=>e.getTagSchemas()),[]));(0,d.useEffect)((()=>{oV.Z.fetchAll()}),[])
return e}(),s=null!==(t=Qe.Z.get(Qe.O.NOTEBOOK))&&void 0!==t?t:null,r=null!==(n=Qe.Z.get(Qe.O.INVENTORY))&&void 0!==n?n:null,o=[{id:e.id,name:e.name,humanId:e.humanId}]
return d.createElement("div",{className:(0,g.iv)(GG.executionButtons)},d.createElement(I.ZP,{alwaysDropDown:!0,menu:d.createElement(w.ZP,{width:Nr.zL.MEDIUM,height:w.ZP.HEIGHTS.MEDIUM},dt.ZP.ELN_ENABLE_BLANK_ENTRY_CREATION&&d.createElement(N.Z,{icon:rr.m.Entry,onSelect:()=>{(0,qG.CD)(null,o)}},"Blank entry"),d.createElement(N.Z,{icon:st.TEMPLATE_COLLECTION,onSelect:()=>{(0,qG.RJ)(null,o)}},"Entry from template"))},d.createElement(C.Co,{size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_BLUE_POWDER,icon:rr.m.Entry,isDropdown:!0,text:"Create entry"})),d.createElement(I.ZP,{alwaysDropDown:!0,menu:d.createElement(Ar.Z,{optionDatas:(null!=i?i:[]).filter((e=>e.folderItemType===st.BASIC_FOLDER_ITEM)).map((e=>({name:e.name,value:e,icon:e.iconId}))),selectedValue:null,onSelect:e=>{(0,Xn.Z)(YF,{createAndRegisterBioentityArgs:{...(0,zF.pk)(),tagSchema:e,projectFolderId:r,studySearchItems:o}})}})},d.createElement(C.Co,{size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_BLUE_POWDER,isDropdown:!0,icon:rr.m.BasicFolderItem,text:"Create entity"})),dt.ZP.WORKFLOWS_ENABLE&&(0,ln.cr)({feature:on.gx.PROCESSES_CREATE})&&d.createElement(I.ZP,{alwaysDropDown:!0,menu:d.createElement(Ar.Z,{optionDatas:a.map((e=>({name:e.name,value:e}))),selectedValue:null,onSelect:t=>{(0,VG.w5)(t,"study_overview",s,{[zO.TableColumnType.STUDIES]:{text:"",typedValue:{type:zO.BaseTypedValueType.STUDIES,studies:[{id:e.id,humanId:e.humanId,name:e.name}]}}})}})},d.createElement(C.Co,{size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_BLUE_POWDER,isDropdown:!0,icon:st.PROCESS,text:"Create task"})))}function StudyExecutionToolbar({study:e}){if(!e.permissions.writable)return d.createElement(UG.Z,{value:"Data cannot be assigned to a study that is readonly."})
switch(e.phase){case Sn.Bf.DESIGN:return d.createElement(UG.Z,{value:"Study should be moved to execution before assigning data to it."})
case Sn.Bf.EXECUTION:return d.createElement(ExecutionPhaseDropdowns,{study:e})
case Sn.Bf.COMPLETE:return null
default:(0,S.Gp)(!1,`Unexpected phase: ${(0,Go.vE)(e.phase)}`)
return null}}const GG=g.mM.create({executionButtons:{gap:5,display:"flex"}})
function StudyPhaseOverview({study:e}){return d.createElement(Fx.ZP,{steps:[{key:Sn.Bf.DESIGN,title:"Design"},{key:Sn.Bf.EXECUTION,title:"Execution"}],statusByStep:{[Sn.Bf.DESIGN]:e.phase!==Sn.Bf.DESIGN?Fx.cV.DONE:Fx.cV.UNVISITED,[Sn.Bf.EXECUTION]:e.phase===Sn.Bf.COMPLETE?Fx.cV.DONE:Fx.cV.UNVISITED,[Sn.Bf.COMPLETE]:e.phase===Sn.Bf.COMPLETE?Fx.cV.DONE:Fx.cV.UNVISITED},currentStepKey:e.phase,onUpdateCurrentStep:void 0})}function StudyProductFeedbackLink(){return d.createElement(C.ZP,{text:"Provide feedback",buttonStyle:C.ZJ.LINK,href:"https://airtable.com/shrIplDbQe0fOeNGW",target:"_blank",rel:"noopener noreferrer",className:(0,g.iv)(zG.provideFeedbackButton)})}const zG=g.mM.create({provideFeedbackButton:{..._n.cf,":focus":{textDecoration:"none"}}}),$G=xa.Ps`
  query StudyOverviewViewQuery($id: StrictString!) @skipAudit @engComponent(name: STUDIES) {
    study(id: $id) {
      ... on StudyNode {
        id
        name
        phase
        description
        permissions {
          writable
        }
        humanId
        archiveRecord {
          purpose
        }
        designEntry {
          ... on EntryNode {
            id
            name
            editUrl
            review {
              ...ReviewSummaryGraphQL
            }
          }
          ...InaccessibleInfoGraphQL
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("ReviewSummary").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function StudyOverviewView_Section({title:e,icon:t,children:n}){return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(WG.sectionHeaderContainer)},d.createElement(so.zV,{className:(0,g.iv)(WG.sectionHeader)},t&&d.createElement(pe.Z,{icon:"lock",className:(0,g.iv)(WG.sectionIcon)}),e),d.createElement("hr",{className:(0,g.iv)(WG.sectionHeaderRule)})),n)}function StudyOverview({study:e,refetch:t}){var n
return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(WG.headerSection)},d.createElement("div",{className:(0,g.iv)(WG.headerTitle)},d.createElement(so.R6,null,e.name),d.createElement(lC.Z,{item:{name:e.name,id:e.id,archiveRecord:e.archiveRecord}})),d.createElement("div",{className:(0,g.iv)(WG.headerButtons)},d.createElement(StudyProductFeedbackLink,null),d.createElement(SetStudyPhaseDropdown,{study:e,refetch:t,isDisabled:!e.permissions.writable}))),d.createElement("div",null,d.createElement(StudyDescriptionEditor,{study:e,refetch:t,isWritable:null!==(n=e.permissions.writable)&&void 0!==n&&n})),d.createElement(StudyPhaseOverview,{study:e}),d.createElement(StudyOverviewView_Section,{title:"Design"},d.createElement(StudyDesignOverview,{study:e})),d.createElement(StudyOverviewView_Section,{title:"Execution",icon:e.phase===Sn.Bf.DESIGN?"lock":null},d.createElement(StudyExecutionToolbar,{study:e})))}function StudyOverviewView({id:e}){const t=(0,Da.IJ)($G,{variables:{id:e},renderCachedDataWhenRefetching:!0})
if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
if(t.type===Da.NI.SUCCESS){const{data:e}=t
return(0,ka.CZ)(e.study)?d.createElement(Ll.Z,{inaccessibleInfo:e.study,modelType:st.STUDY}):d.createElement("div",{className:"react-tab-container"},d.createElement("div",{className:"react-tab-container-narrowTab"},d.createElement(StudyOverview,{study:e.study,refetch:t.refetch})))}return null}const WG=g.mM.create({headerSection:{display:"flex",marginBottom:15},headerTitle:{flex:1},headerButtons:{flex:"none",display:"flex",alignItems:"center",gap:18},sectionHeaderContainer:{display:"flex",alignItems:"flex-end",gap:5,marginTop:15,marginBottom:15},sectionHeader:{flex:"none"},sectionHeaderRule:{flex:"1",borderTopWidth:2},sectionIcon:{marginRight:8}})
class StudyOverviewTabView extends s().View{static initClass(){this.prototype.className="buffer-tab"}render(){const e=this.model.get("studyId");(0,Me.A9)(d.createElement(StudyOverviewView,{id:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}StudyOverviewTabView.initClass()
const HG=[{tabState:Xv.Z,tabView:SequenceAlignmentTabView,optionsView:SequenceAlignmentTabOptionsView},{tabState:tL.Z,tabView:yL.tabView,optionsView:yL.optionsView,dataTestAttrs:{component:"ProteinStructureTab",element:"root"}},{tabState:Pl.Z,tabView:AnalysisTabView},{tabState:_C.Z,tabView:AnalyticsDashboardTabView},{tabState:gr,tabView:AnnotationsTableTabView},{tabState:bL.Z,tabView:class AssemblyHistoryTabView extends VisualHistoryTabView{constructor(){super(...arguments)
this.viewedEvent=vc.Jg.VIEWED_ASSEMBLY_HISTORY_TAB}registerListeners(){this.listenTo(this.model.polymer(),"change:activeVersionId change:protein",this.render.bind(this))}render(){(0,Me.A9)(d.createElement(AssemblyHistoryTabContents,{polymerId:this.model.polymer().id,activeVersionId:this.model.polymer().getActiveVersionId(),showingCurrentVersion:this.model.polymer().isLatest()}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}},dataTestAttrs:{component:"AssemblyHistoryTab",element:"root"}},{tabState:kT.Z,tabView:BenchlingAppTabView},{tabState:$n.N,tabView:$n.b},{tabState:xL.Ns,tabView:xL.b7,optionsView:xL.q9},{tabState:nV.Z,tabView:GridTabView},{tabState:KP.Z,tabView:class BulkAssemblyConstructsTabView extends Js{render(){const{id:e}=this.model.bulkAssemblyModel().getBulkAssembly();(0,Me.A9)(d.createElement(BulkAssemblyConstructsTab,{assemblyId:e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}},{tabState:BulkAssemblyFragmentsTabState,tabView:class BulkAssemblyFragmentsTabView extends Js{render(){(0,Me.A9)(d.createElement(so.zV,null,"Fragments"),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}},{tabState:JO.Z,tabView:class BulkAssemblyOverviewTabView extends Js{render(){(0,Me.A9)(d.createElement(BulkAssemblyOverviewTab,{assemblyId:this.model.bulkAssemblyModel().id,onSetName:e=>this.onSetName(e),onSetFolder:e=>{this.onSetFolder(e)}}),this.el)
return this}async onSetName(e){await this.model.bulkAssemblyModel().triggerUpdateNameAction(e)}onSetFolder(e){Rn.Z.moveItemsWithDataMods([this.model.bulkAssemblyModel().id],e,{parentFolderIds:[this.model.bulkAssemblyModel().folder().id],hasRegisteredItems:!1})}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}},{tabState:BF.Z,tabView:ChildEntityTabView},{tabState:eC.Z,tabView:CircularMapTab,optionsView:CircularMapTabOptionsView},{tabState:Ua.Z,tabView:h_},{tabState:lP.Z,tabView:ComplexPolymerMapTabView},{tabState:xP.Z,tabView:ComplexPolymerStructureTabView},{tabState:pN.Z,tabView:ConnectionDataTabView},{tabState:SN.Z,tabView:ConnectionDetailsTabView},{tabState:bN.Z,tabView:ConnectionRunsTabView},{tabState:OB.Z,tabView:ContainerTabView},{tabState:Gr.Z,tabView:CRISPRAnalysisTabView,optionsView:CRISPRAnalysisOptionsView},{tabState:y_,tabView:CRISPRAssemblyTabView,optionsView:CRISPRAssemblyOptionsView},{tabState:oC.Z,tabView:DatasetTabView},{tabState:Yr.Z,tabView:TabView,optionsView:OptionsView},{tabState:sn,tabView:EditPrimerView_TabView,optionsView:EditPrimerView_OptionsView,dataTestAttrs:{component:"EditPrimerTab",element:"root"}},{tabState:cN.Z,tabView:class EmbeddedAnalyticsDashboardTabView extends Js{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){const e={analyticsDashboardLink:this.model.get("analyticsDashboardLink"),itemId:this.model.get("itemId")}
Me.A9(d.createElement(EmbeddedAnalyticsDashboardView,{...e}),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
return super.remove()}}},{tabState:_L.EmptyEntryTabState,tabView:_L.EmptyEntryTabView,optionsView:_L.EmptyEntryOptionsView},{tabState:rB.Z,tabView:EntityResultsTabView},{tabState:DL.Z,tabView:EntryProtocolTabView,optionsView:null},{tabState:BL.ExternalEntryProtocolTabState,tabView:BL.ExternalEntryProtocolTabView,optionsView:BL.ExternalEntryProtocolOptionsView},{tabState:bC.ExternalFileTabState,tabView:bC.ExternalFileTabView,optionsView:bC.ExternalFileOptionsView},{tabState:TC.Z,tabView:FileTabView},{tabState:No.A,tabView:FindPrimersView_TabView,optionsView:FindPrimersOptionsView,dataTestAttrs:{component:"FindPrimersTab",element:"root"}},{tabState:CC.Z,tabView:FormInstanceTabView},{tabState:TT.Z,tabView:class GibsonTabView extends PrimerAssemblyTabView_TabView{},optionsView:class GibsonTabOptionsView extends PrimerAssemblyTabView_OptionsView{},dataTestAttrs:{component:"GibsonAssemblyTab",element:"root"}},{tabState:xT.Z,tabView:GoldenGateTabView,optionsView:class GoldenGateTabOptionsView extends PrimerAssemblyTabView_OptionsView{}},{tabState:aV.Z,tabView:class GridContentsTabView extends Js{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){(0,Me.A9)(d.createElement(iV,{gridId:this.model.get("gridId")},(e=>d.createElement(GridContents,{...e}))),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}},{tabState:uG.Z,tabView:class GridMetadataTabView extends Js{static initClass(){this.prototype.className="buffer-tab buffer-tab--no-padding"}render(){(0,Me.A9)(d.createElement(iV,{gridId:this.model.get("gridId")},(e=>d.createElement(GridMetadata,{...e}))),this.el)
return this}remove(){u.unmountComponentAtNode(this.el)
super.remove()
return this}}},{tabState:TD.Z,tabView:HRTemplateTabView,optionsView:HRTemplateOptionsView},{tabState:yT.Z,tabView:JellyfishTabView},{tabState:fG.Z,tabView:LocationTabView},{tabState:_N.Z,tabView:oP},{tabState:tC.Z,tabView:MiniMap,optionsView:MiniMapTabOptionsView},{tabState:Mv.Z,tabView:MoleculeChemicalStructureTabView},{tabState:$v.Z,tabView:MoleculePhysicochemicalPropertiesTabView},{tabState:qL.NewEntryProtocolTabState,tabView:qL.NewEntryProtocolTabView,optionsView:qL.NewEntryProtocolOptionsView},{tabState:VL.Ns,tabView:VL.b7,optionsView:VL.q9},{tabState:UL.Z,tabView:NoteTabView},{tabState:WD.Z,tabView:HD,dataTestAttrs:{component:"NucleotidesTab",element:"root"}},{tabState:nC.Z,tabView:SequenceLinearMap,optionsView:LinearMapTabOptionsView},{tabState:EG.Z,tabView:GridTabView},{tabState:Vo,tabView:Primer3View_TabView,optionsView:Primer3View_OptionsView,dataTestAttrs:{component:"Primer3ResultsTab",element:"root"}},{tabState:ml.Z,tabView:PrimerWizardTabView,optionsView:PrimerWizardOptionsView,dataTestAttrs:{component:"PrimerWizardTab",element:"root"}},{tabState:oM.Z,tabView:ProcedureRunTabView},{tabState:cM.Z,tabView:ProcessDetailsTabView},{tabState:kM.Z,tabView:ProcessFlowchartTabView},{tabState:TF.Z,tabView:ProcessTaskDetailsOutputsTabView},{tabState:IF.Z,tabView:ProcessTaskDetailsTabView},{tabState:kF.Z,tabView:ProcessTaskFlowchartTabView},{tabState:Qi.Z,tabView:class ProteinAlignmentTabView extends PolymerAlignmentTabView{addPolymersForSearch(){}removePolymersForSearch(){}getType(){return this.model.getType()}setType(e){this.model.setType(e)}getPolymerLength(){return this.model.getPolymerLength()}renderStatsView(){return this.shouldCollapseMiniMap(this.model)?null:d.createElement(eL,{alignment:this.model.get("alignment"),selectionStart:this.model.get("selection").start(),selectionEnd:this.model.get("selection").end()})}makeSummaryMapView(){return new AlignmentSummaryMapView({model:null,tabstate:this.model,topY:["summaryIdentityGraph","line"],middleY:["line"],bottomY:[],padding:172,isCollapsed:this.shouldCollapseMiniMap(this.model)})}makeRowsView(){return new ProteinAlignmentRowsView({model:this.model})}makeTopAlignmentRowView(){return new ProteinAlignmentRowView({model:this.model,row:this.model.get("alignment").rows[0],alignmentType:this.model.get("alignment").alignmentType,visibilityOptions:this.model.get("localVisibilityOptionsList")[0]})}registerListeners(){super.registerListeners()
this.listenTo(this.model,"change:alignment",this.update)}getDefaultSpan(){return dt.ZP.MOLBIO_ENABLE_ANTIBODY_ENGINEERING_TOOLS&&this.model.get("visibilityOptions").getOption(Yt.XH.name).get("visible")?Math.floor(this.mapWidth()/22):super.getDefaultSpan()}getDataTestAttrs(){return{component:"ProteinAlignmentTab",element:"root"}}},optionsView:ProteinAlignmentTabOptionsView},{tabState:ProteinComplexPreviewTabState,tabView:ProteinComplexPreviewTabView},{tabState:ProteinComplexPropertiesTabState,tabView:ProteinComplexPropertiesTabView},{tabState:aC.Z,tabView:ProteinMap,optionsView:ProteinMapOptionsView},{tabState:zL.Z,tabView:ProtocolTabView_TabView,optionsView:null},{tabState:fP.Z,tabView:RelevantItemsTabView},{tabState:eZ.Z,tabView:RequestDetailsTabView},{tabState:NZ.Z,tabView:RequestResponseTabView},{tabState:mB.Z,tabView:ResultStatusTabView},{tabState:WL.Z,tabView:ReviewTabView,optionsView:null},{tabState:iC.Z,tabView:SequenceLinearMap,optionsView:LinearMapTabOptionsView},{tabState:sC.Z,tabView:MiniMap,optionsView:MiniMapTabOptionsView},{tabState:bB.Z,tabView:RunDetailsTabView},{tabState:vB.Z,tabView:RunResultsTabView},{tabState:bo.Z,tabView:SecondaryStructureView_TabView,optionsView:SecondaryStructureView_OptionsView},{tabState:rC.Z,tabView:SequenceLinearMap,optionsView:LinearMapTabOptionsView},{tabState:dB.Z,tabView:StorableResultsTabView},{tabState:wG.Z,tabView:OG},{tabState:cB.Z,tabView:LinkedResultsTabView},{tabState:xG.Z,tabView:StudyListingTabView},{tabState:MG.Z,tabView:StudyOverviewTabView},{tabState:hl.Z,tabView:TranslationTabView},{tabState:Cl.Z,tabView:VirtualDigestView_TabView,optionsView:VirtualDigestView_OptionsView},{tabState:OL,tabView:VisualHistoryTabView},{tabState:Ak.Z,tabView:WorksheetTabView}]
const jG="growth-experiment-share-link-modal"
var YG
!function(e){e.ON="ON"
e.OFF="OFF"}(YG||(YG={}))
function ShareLinkCreationForm(e){const{fileId:t,link:n,metadata:a,userId:i}=e,[s,r]=(0,d.useState)(n.isActive),[o,l]=(0,d.useState)(a.description),c=(0,Su.N)(o,500);(0,d.useEffect)((()=>{try{!function updateShareLinkMetadata(e,t){return Cn.Ry({url:`/1/api/files/${e}/share-link-metadata`,data:{description:t}})}(t,c)}catch(e){if(Cn.d0(e)){v.ZP.notifyError(e)
return}throw e}}),[t,c])
const u=new URL(n.url).origin+(0,de.Dv)(n.url,{m:a.publicIdentifier})
return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(QG.toggleContainer)},d.createElement("span",null,"Link Sharing"),d.createElement(ih.Z,{className:(0,g.iv)(QG.tooltip),text:dt.ZP.ENABLE_SIGNED_OUT_SHARE_LINK_USAGE?"Provide read-only access to anyone with this link.":"Provide read-only access to users in your tenant."}),d.createElement(kt.Z,{options:[{id:YG.ON,buttonProps:{text:"ON"}},{id:YG.OFF,buttonProps:{text:"OFF"}}],size:C.qE.SMALL,selection:s?YG.ON:YG.OFF,onChangeSelection:e=>{const a=e===YG.ON
m.j("share_links",a?"activated_share_link":"deactivated_share_link",{file_id:t,user_id:i,has_metadata:!0})
r(a)
eA.yg(n.shareIdentifier,{isActive:a})}})),d.createElement("div",null,d.createElement("textarea",{className:(0,g.iv)(QG.textarea),disabled:!s,onChange:e=>{l(e.target.value)},value:o,placeholder:"Add optional description"})),d.createElement("div",{className:(0,g.iv)(QG.urlContainer)},d.createElement("input",{className:(0,g.iv)(QG.urlInput),type:"text",readOnly:!0,disabled:!s,value:u,...(0,ee.Z)({component:"ShareLinkCreationModal",element:"shareLinkInput"})}),d.createElement(bt.Z,{value:u,notifyCopied:()=>{m.j("share_links","copied_share_link",{file_id:t,user_id:i,has_metadata:!0})
v.ZP.success("Copied share link to clipboard.")}},d.createElement(C.Co,{className:(0,g.iv)(QG.copyButton),buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,disabled:!s},d.createElement(pe.Z,{icon:"copy"})," Copy"))))}function ShareLinkCreationModal({fileId:e,fileName:t,userId:n}){const[a,i]=(0,d.useState)(!0),[s,r]=(0,d.useState)(null),[o,l]=(0,d.useState)(null);(0,d.useEffect)((()=>{(async()=>{try{const t=await eA.t6(e)
r(t)
const n=await function getOrCreateShareLinkMetadata(e){return Cn.s0({url:`/1/api/files/${e}/share-link-metadata`})}(e)
l(n)
i(!1)}catch(e){if(Cn.d0(e)){v.ZP.notifyError(e)
return}throw e}})()}),[e])
return d.createElement(et.ZP,{title:`Share ${t}`,onRequestClose:()=>{Xe.xv(jG)}},a?d.createElement(kl.b,null):d.createElement(ShareLinkCreationForm,{fileId:e,link:s,metadata:o,userId:n}))}const QG=g.mM.create({urlContainer:{position:"relative",marginTop:"20px"},urlInput:{width:"calc(100% - 65px)"},copyButton:{position:"absolute",right:0,borderRadius:"0 4px 4px 0"},toggleContainer:{display:"flex",alignItems:"center",marginBottom:"20px"},tooltip:{marginLeft:"10px",marginRight:"20px"},textarea:{height:"80px"}})
function ShareBar_CopyButton({fileId:e,onDuplicate:t}){return d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:"Copy to..."},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,icon:"copy",onClick:t,size:C.qE.MINI,disabled:!(0,ln.cr)({feature:rn.N7.CREATE,item:{id:e}})}))}function ShareBar(e){const{fileId:t,fileName:n,fileType:a,onDuplicate:i}=e,s=Jn.Z.currentUser().id,r=dt.ZP.ENABLE_SHARE_LINK&&st.SHARE_LINK_FOLDER_ITEMS.includes(a),o=st.COPYABLE_FOLDER_ITEMS.includes(a)&&i
return d.createElement("div",{className:"buffer-tabs-shareBar",...(0,ee.Z)({component:"ShareBar",element:"root"})},r&&d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,icon:"share-v2",className:"u-mini-spacing-right",size:C.qE.MINI,text:"Share",onClick:()=>{m.L9(j.nn.OPENED_SHARE_LINK_CREATION_MODAL,{file_id:t,user_id:s})
Xe.bA(jG,d.createElement(ShareLinkCreationModal,{fileId:t,fileName:n,userId:s}))},dataTestAttrs:{component:"ShareBar",element:"shareButton"}}),o&&d.createElement(ShareBar_CopyButton,{fileId:t,onDuplicate:i}))}ShareBar.propTypes={fileId:J().string.isRequired,fileName:J().string.isRequired,onDuplicate:J().func}
const KG=ShareBar
var JG=n(138232)
class BufferNavItemView extends s().View{static initClass(){this.prototype.tagName="li"
this.prototype.className="sectionTabs-navItem"
this.prototype.template=ht}toggle(e,t){t?this.$el.addClass("active"):this.$el.removeClass("active")}_renderCloseIcon(){this.model.get("closeable")&&(0,Me.A9)(d.createElement(pe.Z,{icon:"close",className:"sectionTabs-navItem-closeBtn-svg"}),this.$(".js-sectionTabs-close")[0])}renderHtml(){const e={...this.model.toJSON()}
this.$el.attr("data-tab-id",this.model.id)
const t=this.model.attributes.preferenceKey?(0,Mt.UC)(this.model.attributes.preferenceKey):"noPreferenceKey";(0,He.Z)(this.$el,{component:"BufferNavItem",element:"root",key:t})
this.$el.html(o()(this.template(e)).children())
this._renderCloseIcon()}remove(){return super.remove()}render(){const e=this.model
this.renderHtml()
this.model.get("greyTab")&&this.$el.addClass("grey-tab")
this.model.get("active")&&this.$el.addClass("active")
this.model.get("draggable")||this.$el.addClass("no-drag-tab")
this.$el.data("tab",this.model)
this.listenTo(e,"change:title",this.renderHtml)
this.listenTo(e,"change:id",this.renderHtml)
this.listenTo(e,"change:closeable",this.renderHtml)
this.listenTo(this.model,"change:active",this.toggle)
const t=e.get("className")
null!=t&&this.$el.addClass(t)
return this}}BufferNavItemView.initClass()
class BufferNavView extends s().View{static initClass(){this.prototype.events={"click .sectionTabs-navItem":"onClickTab","click .toggle":"toggleDropdown","click .overflow-list a":"hideDropdown"}}initialize(){this.renderItems=this.renderItems.bind(this)
this._eventNamespace=`.bufferNavView-${this.cid}`
this.viewCache=[]
this.$sectionTabs=this.$(".buffer-tabs-sectionTabs")
this.$shareBar=this.$(".buffer-tabs-shareBarMount")
this.ul=this.$sectionTabs.find(".sectionTabs-nav").eq(0)
this.dropDownEl=this.$sectionTabs.find(".sectionTabs-moreDropdown").eq(0)
document.addEventListener("mousedown",(e=>this.closeFromOutside(e)),!0)
const e=this.$nav=this.$(".sectionTabs-nav"),t=this
this.$nav.sortable({placeholder:"sectionTabs-navItemPlaceholder",forcePlaceholderSize:!0,items:"> li:not(.no-drag-tab)",receive(e,t){if(t.item.data("tab")instanceof JG.Z){t.sender.sortable("cancel")
v.ZP.warn("Protocols cannot be moved from the left pane.")}},update(n,a){if(this!==a.item.parent()[0])return
const i=a.item.data("tab"),s=a.item.index()
l.default.defer((()=>{t.buffer.collection.moveTab(i,t.buffer,s)
e.sortable("refresh")}))}})}onClickTab(e){const t=o()(e.currentTarget).attr("data-tab-id"),n=this.tabs.get(t)
o()(e.target).closest(".sectionTabs-navItem-closeBtn").length?n.close():n.set("active",!0)
this.hideDropdown()
n.onClick()
e.preventDefault()}closeFromOutside(e){0===o()(e.target).parents(".sectionTabs-moreDropdown").length&&this.hideDropdown()}hideDropdown(){this.$(".toggle").removeClass("active")
this.$(".overflow-list").hide()}toggleDropdown(){this.$(".toggle").toggleClass("active")
this.$(".overflow-list").toggle()}ulWidth(){let e=0
this.ul.find("li").each((function(){e+=o()(this).outerWidth(!0)}))
return e}renderItems(){for(;this.viewCache.length>0;)this.viewCache.pop().remove()
this.tabs.each((e=>{if(!e.showInNavBar())return
const t=new BufferNavItemView({model:e})
this.viewCache.push(t)
this.ul.append(t.render().el)}))
this.$sectionTabs.removeClass("overflow")
this.$(".overflow-list").empty()
for(;this.ulWidth()>this.$el.width()-this.dropDownEl.width()-this.$shareBar.width()&&this.ul.children().not(".active").length>0;){const e=this.ul.children().not(".active").last().addClass("sectionTabs-navItem--overflow").detach()
this.$(".overflow-list").append(e)}this.$sectionTabs.toggleClass("overflow",this.$(".overflow-list li").length>0)
this.$nav.sortable("refresh")}handleTabDrag(){this.buffer.get("shareTabsWithOtherBuffers")&&this.$nav.sortable({connectWith:".sectionTabs-nav.js-share-tabs"})
this.$nav.toggleClass("js-share-tabs",this.buffer.get("shareTabsWithOtherBuffers"))}remove(){this.unmountShareBar()
o()(window).off(this._eventNamespace)
return super.remove()}mountShareBar(){var e
const t=this.$(".buffer-tabs-shareBarMount")[0]
if(null==t||null==Jn.Z.currentUser())return
const n=this.fileState.fileType()
if(!st.SHARE_LINK_FOLDER_ITEMS.includes(n)&&!st.COPYABLE_FOLDER_ITEMS.includes(n)){this.unmountShareBar()
return}const a=this.fileState.model();(0,Me.A9)(d.createElement(KG,{fileId:a.id,fileName:a.name(),fileType:n,onDuplicate:null===(e=a.duplicate)||void 0===e?void 0:e.bind(a)}),t)
this.shareBarMount=t}unmountShareBar(){null!=this.shareBarMount&&u.unmountComponentAtNode(this.shareBarMount)}mountPresenceView(){const e=this.$(".buffer-tabs-presenceMount")[0]
if(null==e||null==Jn.Z.currentUser()||!dt.ZP.ELN_ENABLE_REALTIME_UPDATES_M1||!st.PRESENCE_ENABLED_FOLDER_ITEMS.includes(this.fileState.fileType())){this.unmountPresenceView()
return}const t=this.fileState.model();(0,Me.A9)(d.createElement(Fk.ZP,{resourceId:t.id}),e)
this.presenceMount=e}unmountPresenceView(){null!=this.presenceMount&&u.unmountComponentAtNode(this.presenceMount)}isRightmostBuffer(){if(null==this.buffer)return!1
const e=this.buffer.collection.where({active:!0}).length,t=this.buffer.collection.indexOf(this.buffer)
return 1===e&&0===t||1===t}isWideBuffer(){return 1===this.buffer.collection.where({active:!0}).length}update(e,t){o()(window).off(this._eventNamespace)
o()(window).on(`resize${this._eventNamespace}`,de.Vx(this.renderItems))
o()(window).on(`buffersResize${this._eventNamespace}`,this.renderItems)
null!=this.buffer&&this.stopListening(this.buffer)
this.buffer=e
this.fileState=t
this.listenTo(this.buffer,"change:shareTabsWithOtherBuffers",this.handleTabDrag)
null!=this.tabs&&this.stopListening(this.tabs)
this.tabs=this.buffer.get("tabs")
this.listenTo(this.tabs,"add remove reset",this.renderItems)
if(this.isRightmostBuffer()){this.mountPresenceView()
this.mountShareBar()}else{this.unmountPresenceView()
this.unmountShareBar()}this.handleTabDrag()
this.renderItems()}}BufferNavView.initClass()
class BufferView extends s().View{initialize(e){this.menu=new BufferNavView({el:this.$(".buffer-tabs")}).render()
this.$bufferOptionsReactMount=this.$(".buffer-options-reactMount")
this.content=new BufferContentView({el:this.$(".buffer-content")})
this.renderedTab=null}renderTabIfActive(e,t=!1){if(null!=e&&e.get("active")&&(t||this.renderedTab!==e)){const t=function getView(e){for(const t of HG)if(e instanceof t.tabState)return{TabView:t.tabView,OptionsView:t.optionsView,dataTestAttrs:t.dataTestAttrs}
throw new Error(`Unexpected tab state: ${e.constructor.name}, please add it in buffers view`)}(e)
this.content.update(e,t.TabView)
null!=t.OptionsView?(0,Me.A9)(d.createElement(TabOptions,{tabState:e,TabOptionsViewCls:t.OptionsView}),this.$bufferOptionsReactMount[0]):(0,Me.A9)(d.createElement(TabOptions,{tabState:null,TabOptionsViewCls:null}),this.$bufferOptionsReactMount[0])
this.$el.toggleClass("grey-tab-view",e.get("greyTab"))
this.$el.toggleClass("hide-options-view",null==t.OptionsView);(0,He.Z)(this.$el,t.dataTestAttrs)
o()(window).trigger("buffersResize")
this.renderedTab=e}}renderEmpty(){0===this.tabs.size()&&this.clearTab()}clearTab(){this.content.update(null,null);(0,Me.A9)(d.createElement(TabOptions,{tabState:null,TabOptionsViewCls:null}),this.$bufferOptionsReactMount[0])
this.renderedTab=null}updateBufferAndActiveClass(e,t,n){this._activeTab(e)!==this.renderedTab&&this.clearTab()
this.$el.removeClass("full-width")
this.$el.removeClass("invisible")
this.$el.removeClass("vertical-split")
if(e.get("active")){1===t?this.$el.addClass("full-width"):2===t&&this.$el.addClass("vertical-split")
o()(window).trigger("buffersResize")}else this.$el.addClass("invisible")
this.update(e,n)}_activeTab(e){return e.get("tabs").find((e=>e.get("active")))}update(e,t){null!=this.tabs&&this.stopListening(this.tabs)
this.tabs=e.get("tabs")
this.menu.update(e,t)
0===this.tabs.size()||this._activeTab(e)||this.tabs.at(0).set("active",!0)
this.listenTo(this.tabs,"add change:active",(e=>{this.renderTabIfActive(e)}))
this.listenTo(this.tabs,"remove reset",this.renderEmpty)
const n=this._activeTab(e)
null!=n?this.renderTabIfActive(n):this.clearTab()}}class BuffersView extends s().View{static initClass(){this.prototype.el="#buffers"}initialize(e){this.bufferViews=Array.from(this.$(".buffer-container")).map((e=>new BufferView({el:e})))
this.hasReactMounted=!1
this.buffers=null
this.fileState=null
this.$tabNavbars=this.$(".buffer-tabs")
this.$containers=this.$(".buffer-container")
this.$reactMount=this.$(".buffer-reactMount")
this.presenceManager=new PresenceManager(this.$(".buffer-presenceManagerMount"))
this.documentUpdatesManager=new DocumentUpdatesManager}update(e,t=null){null!=this.buffers&&this.stopListening(this.buffers)
null==t&&this.hasReactMounted&&u.unmountComponentAtNode(this.$reactMount[0])
if(null==e&&null!=this.buffers)for(const e of this.bufferViews)e.clearTab()
this.presenceManager.unsubscribe()
this.documentUpdatesManager.changeActiveDocument(e)
this.hasReactMounted=null!=t
this.buffers=null!=e?e.buffers():void 0
this.fileState=e
this.$el.toggleClass("empty",null==e&&null==t)
this.$tabNavbars.toggleClass("hidden",null!=e&&e.get("hideTabNav"))
this.$containers.toggleClass("hidden",null==e)
this.$reactMount.toggleClass("hidden",null==t)
if(null!=e){this.listenTo(this.buffers,"change add remove",(()=>this.render()))
this.render()
this.presenceManager.subscribe(this.fileState)}else null!=t&&(0,Me.A9)(t,this.$reactMount[0])}render(){const e=this.buffers.models,t=e.filter((e=>e.get("active"))).length
for(const[n,a]of e.entries())this.bufferViews[n].updateBufferAndActiveClass(a,t,this.fileState)
return this}}BuffersView.initClass()
const XG=BuffersView
var ez=n(924768),tz=n(26481),nz=n(556957),az=n(445881)
class ProteinCtrlFViewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z,nz.Z]}enhanceProps(){return{selectedIndex:this.proteinStore().getSelectedSearchResultIndex(),selectedSearchResult:this.proteinStore().getSelectedSearchResult(),numSearchResults:this.proteinStore().getNumSearchResults(),pendingOpenSearchView:this.proteinStore().getPendingOpenSearchView(),sidepanelIsExpanded:this.sidepanelStore().getIsExpanded()}}}class ProteinCtrlFView extends d.Component{constructor(){super(...arguments)
this.state={query:"",visible:!1}
this.searchRef=d.createRef()
this._handleOpenSearchView=()=>{this.state.visible?this.searchRef.current.focusAndSelect():this.show()}
this._handleQueryChange=e=>{0===e.length?Ea.Z.clearSearchResults():Ea.Z.searchAminoAcids(e)
this.setState({query:e})}
this._handleViewNextResult=()=>{Ea.Z.viewNextSearchResult()}
this._handleViewPreviousResult=()=>{Ea.Z.viewPreviousSearchResult()}
this.hide=()=>{Ea.Z.clearSearchResults()
this.setState({visible:!1})}
this._handleClose=()=>{this.hide()}
this.show=()=>{this.setState({visible:!0})}}componentDidMount(){o()(window).on("keydown.protein-ctrl-f-view",(e=>{if(pn.isCtrlF(e)){if(this.props.sidepanelIsExpanded)return
e.preventDefault()
this._handleOpenSearchView()}}))}componentDidUpdate(e,t){!t.visible&&this.state.visible&&this._handleQueryChange(this.state.query)
const n=!Is()(e.selectedSearchResult,this.props.selectedSearchResult)
null!=this.props.selectedSearchResult&&n&&this.props.jumpToIndex(this.props.selectedSearchResult.index)
if(this.props.pendingOpenSearchView){this._handleOpenSearchView()
Ea.Z.completeOpenSearchView()}}componentWillUnmount(){o()(window).off("keydown.protein-ctrl-f-view")}render(){return!this.state.visible||this.props.sidepanelIsExpanded?null:d.createElement(az.Z,{ref:this.searchRef,onClose:this._handleClose,onQueryChange:this._handleQueryChange,query:this.state.query,onViewNextResult:this._handleViewNextResult,onViewPreviousResult:this._handleViewPreviousResult,selectedIndex:this.props.selectedIndex,numSearchResults:this.props.numSearchResults})}}const iz=ProteinCtrlFViewConnector.connect(ProteinCtrlFView)
var sz=n(250965)
function checkZoom(){if(null==window.getComputedStyle)return
const e=Re().select("#verify-zoom").select("svg").select("text")
if(null==e||null==e.node())return
if(e.attr("font-size")!==window.getComputedStyle(e.node()).getPropertyValue("font-size")){const e=`Your browser's zoom level is not supported. Please reset to the\n            default zoom level by hitting **${pn.ctrl}-0** for the optimal\n            Benchling experience.`
v.ZP.info(e,{closeable:!1,duration:0,id:"bad-zoom"})}else v.ZP.close("bad-zoom")}function unregisterBrowserZoomCheck(){sz(window).off(".bad-zoom-check")
v.ZP.close("bad-zoom")}class FileBarView extends s().View{static initClass(){this.prototype.el="#filebar"}initialize({toolbar:e,statusBar:t,searchDNA:n,buffersView:a,assemblyWizardContainer:i}){this.toolbar=e
this.statusBar=t
this.searchDNA=n
this.buffersView=a
this.assemblyWizardContainer=i
this.files=ve.ZP.get()
this.listenTo(this.files,"no-files",(()=>this.renderNoFiles()))
this.listenTo(this.files,"open",this.openFile)
this.listenTo(this.files,"unmount",(()=>this._clearBackboneViews()))}performUpdates(e){if(null!=e){this.toolbar.update(e.get("toolbar"),e)
this.statusBar.update(e)
this.buffersView.update(e)
this.assemblyWizardContainer.update(e)
tz.Z.openSectionForFileType(e.fileType())
ez.KI()
e instanceof ve.m6||e instanceof ve.x$?function registerBrowserZoomCheck(){checkZoom()
sz(window).on("resize.bad-zoom-check",(0,Ja.Z)(checkZoom,1e3))}():unregisterBrowserZoomCheck()}else this.renderNoFiles()}openSequenceFile(e){const t=e.get("sequence")
e.updateColoredEnzymes()
this.performUpdates(e)
null!=this.selection&&this.stopListening(this.selection)
this.selection=t.get("selection")
this.listenTo(this.selection,"change",(()=>{const e=this.selection.start(),n=this.selection.end()
if(this.selection.isEmpty()){sP.Z5(e,n,0,0)
return}const a=t.get("dna").forwardSlice(e,n).bases,i=t.nucleotideType()===R.Wy.DNA?y.rnaToDNA(a):y.dnaToRNA(a),s=a.length<1e5?(100*y.gc(i,t.nucleotideType())).toFixed(2):null,r=a.length<1e5?y.meltingTemperature(i,t.nucleotideType()).toFixed(1):null
return sP.Z5(e,n,this.selection.length(),s,r)}))
this.stopListening(We.Z)
this.listenTo(We.Z,`change:${tn.gq.MELTING_TEMP_DNA} change:${tn.gq.MELTING_TEMP_RNA}`,(()=>this.selection.trigger("change")))
null!=this.sequence&&this.stopListening(this.sequence.get("dna"))
this.sequence=t
this.listenTo(this.sequence.get("dna"),"change:forward change:reverse",(()=>sP.cj(t.length())))
return this}updateSearchView(e){const t=o()("#protein-search")[0]
null!=t&&(e.fileType()===st.PROTEIN?(0,Me.A9)(d.createElement(iz,{jumpToIndex:function(t){return e.get("protein").trigger("jump",t)}}),t):u.unmountComponentAtNode(t))
e.fileType()===st.SEQUENCE?this.searchDNA.update(e.get("sequence")):this.searchDNA.update(null)}openFile(e){this.updateSearchView(e)
e.fileType()===st.SEQUENCE?this.openSequenceFile(e):this.performUpdates(e)
this.files.cleanUpInactiveNonWorkspaceItems()}_clearBackboneViews(e=null,t){null==t&&(t=!1)
this.searchDNA.update(null)
this.toolbar.update(null,null)
this.statusBar.update(null)
this.buffersView.update(null,e)
this.assemblyWizardContainer.update(null)
t&&this.assemblyWizardContainer.hideWizard()
unregisterBrowserZoomCheck()}renderReact(e,t){!function FileBarView_guard_(e,t){return null!=e?t(e):void 0}(ve.ZP.get().findWhere({active:!0}),(e=>e.set({active:!1})))
this._clearBackboneViews(e,!0)
ve.ZP.get().cleanUpInactiveNonWorkspaceItems()
ez.KI()
w_.GS(t)}renderNoFiles(){de._w("Editor")
this._clearBackboneViews()
tz.Z.openSectionForFileType(null)}render(){0===this.files.size()&&this.renderNoFiles()
return this}}FileBarView.initClass()
const rz=FileBarView
function DNASearchExample({searchQuery:e,explanation:t}){return d.createElement("div",{className:(0,g.iv)(oz.example)},d.createElement("pre",{className:(0,g.iv)(oz.searchQuery)},e),d.createElement("span",{className:(0,g.iv)(oz.explanation)},t))}function DNASearchExamples(){return d.createElement(d.Fragment,null,d.createElement(DNASearchExample,{searchQuery:"GATT",explanation:"Search bases"}),d.createElement(DNASearchExample,{searchQuery:"NGG",explanation:"Search with degenerate bases"}),d.createElement(DNASearchExample,{searchQuery:"Exon 9",explanation:"Annotation/primer name"}),d.createElement(DNASearchExample,{searchQuery:":100",explanation:"Jump to base"}),d.createElement(DNASearchExample,{searchQuery:":100:125",explanation:"Select range"}),d.createElement(DNASearchExample,{searchQuery:":385:385+26*3",explanation:"Select using formula"}))}const oz=g.mM.create({example:{marginBottom:8,marginTop:8},searchQuery:{display:"inline",padding:2},explanation:{..._n.hv,marginLeft:4}})
const lz=(0,be.Z)((function FeatureResult({end:e,name:t,start:n,strand:a}){return d.createElement("li",{className:"feature-result"},d.createElement("a",{href:"#"},d.createElement("div",{className:"feat-swatch pull-left"},a),d.createElement("div",{className:"text"},d.createElement("span",{className:"location pull-right"},d.createElement("span",{className:"start"},n),d.createElement("span",null,"-"),d.createElement("span",{className:"end"},e)),d.createElement("div",{className:"name"},d.createElement("span",null,t[0]),d.createElement("span",{className:"match"},t[1]),d.createElement("span",null,t[2])))))}))
var cz,dz=n(847054)
!function(e){e.BASES="Bases"
e.AMINO_ACIDS="Amino Acids"}(cz||(cz={}))
function SearchSequenceAdvancedOptions(e){const[t,n]=(0,d.useState)(e.searchType),[a,i]=(0,d.useState)(e.searchRegion),[s,r]=(0,d.useState)(e.mismatchesAllowed)
function handleMismatchesAllowedChange(t){const n=t&&t>0?t:0
r(n)
e.onChangeMismatchesAllowed(n)}function incrementMismatchesAllowed(){handleMismatchesAllowedChange((s||0)+1)}function decrementMismatchesAllowed(){handleMismatchesAllowedChange((s||0)-1)}return d.createElement(d.Fragment,null,d.createElement("div",{className:"settings-header"},d.createElement("span",null,"Advanced Settings"),d.createElement(C.Co,{buttonStyle:C.ZJ.LINK,className:"js-close-adv-settings",text:"Close"})),d.createElement("div",{className:"form-horizontal"},d.createElement("div",null,d.createElement(Fr.Z,{className:"control-label",label:"Search"})),d.createElement("div",null,d.createElement(kt.Z,{options:[{id:cz.BASES,buttonProps:{text:cz.BASES,className:"js-search-type-bases"}},{id:cz.AMINO_ACIDS,buttonProps:{text:cz.AMINO_ACIDS,className:"js-search-type-amino-acids"}}],selection:t,onChangeSelection:t=>{n(t)
e.onChangeSearchType(t)},size:C.qE.SMALL})),d.createElement("div",{className:"js-search-region"},d.createElement(Fr.Z,{className:f()("control-label",(0,g.iv)(uz.smallMarginRight)),label:"ORF Region"}),d.createElement(ih.Z,{text:"Restricting search to ORFs requires that each result occurs in-frame with an ORF.",container:"body",className:"js-region-help-enabled"}),d.createElement(ih.Z,{text:"Restricting search to a region is disabled on large sequences.",container:"body",className:"hide js-region-help-disabled"}),d.createElement(C.Co,{buttonStyle:C.ZJ.UNBUTTON,icon:"wrench",className:f()("js-orf-settings",(0,g.iv)(uz.wrenchIcon))})),d.createElement("div",null,d.createElement(Io.Z,{id:"restrictToORF",checked:"orfs"===a,onChange:({target:{checked:t}})=>{const n=t?"orfs":"all"
i(n)
e.onChangeSearchRegion(n)},label:"Only show results in-frame with an ORF"})),t===cz.BASES&&d.createElement(d.Fragment,null,d.createElement("div",{className:"js-search-mismatches"},d.createElement(Fr.Z,{className:f()("control-label",(0,g.iv)(uz.smallMarginRight)),label:"Mismatches allowed"}),d.createElement(ih.Z,{text:"Maximum number of mismatches tolerated between search query and result.",container:"body",className:"js-mismatches-help-enabled"}),d.createElement(ih.Z,{text:"Quick search with mismatches is disabled on large sequences.",container:"body",className:"hide js-mismatches-help-disabled"})),d.createElement("div",{className:"row"},d.createElement("div",{className:f()("col col-xs-5",(0,g.iv)(uz.flex))},d.createElement(C.Co,{icon:"minus",buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.SMALL,onClick:decrementMismatchesAllowed,className:"js-mismatches-controls"}),d.createElement(gp.Z,{min:0,onChange:({target:{value:e,numericValue:t}})=>{handleMismatchesAllowedChange(t)},onKeyDown:e=>{pn.isUpKey(e)?incrementMismatchesAllowed():pn.isDownKey(e)&&decrementMismatchesAllowed()},placeholder:"0",value:s,required:!1,validateInteger:!0,className:f()("js-mismatches",(0,g.iv)(uz.numberInput))}),d.createElement(C.Co,{icon:"plus",buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.SMALL,onClick:incrementMismatchesAllowed,className:"js-mismatches-controls"}))))))}const uz=g.mM.create({flex:{display:"flex",alignItems:"center"},numberInput:{margin:"0px 5px"},smallMarginLeft:{marginLeft:"5px"},smallMarginRight:{marginRight:"5px"},wrenchIcon:{color:Vt.TG}})
var mz=n(121160)
function logUndefinedState(e,t,n,a){(0,S.hu)(null==n[t])
de.Ud||Fe.vU(`${t} is undefined in ${e}`,{extra:{this:Object.keys(n),e:null!=a?{type:a.type,which:a.which,outerHTML:a.target.outerHTML}:null}})}const pz=$a.C.get()
class SearchDNAView extends s().View{static initClass(){this.prototype.el="#seqsearch"}events(){return{"click .feature-result a":"clickFeature","mousedown .js-adv-settings":"toggleSettings","mousedown .js-close-adv-settings":"toggleSettings","change [name=search-region]":"updateSearchRegion","change [name=search-target]":"updateSearchTarget","change [name=mismatches]":()=>{this.doSearch()},"click .js-orf-settings":"showORFSettings"}}handleKeyup(e){if(13===e.which){this.$(".find-next-btn").removeClass("active")
this.$(".find-previous-btn").removeClass("active")}}inputSearch(e=null){if(null!=e){this.$(".seq-search-box").val(e)
this.$(".seq-search-box").select()
this.$(".seq-search-box").trigger("input")}else this.$(".seq-search-box").select()}startIndex(){const e=this.model.get("sequence");(0,S.hu)(null!=e,"Expected sequence to be present when calling SearchDNAView.startIndex().")
return e.startIndex()}inputGoto(e,t){e=T.looseModelToDisplay(e,this.startIndex())
const n=(()=>{if(null!=t){t=T.looseModelEndToDisplay(t,this.startIndex())
return`:${e}:${t}`}return null!=e?`:${e}`:":"})()
this.$(".seq-search-box").val(n)
this.$(".seq-search-box").select()
this.$(".seq-search-box")[0].selectionStart=1
this.$(".seq-search-box")[0].selectionEnd=n.length
n.length>1&&this.$(".seq-search-box").trigger("input")}focusSearch(){this.focused=document.activeElement
this.$(".seq-search-box").focus()}cancelSearch(){"gotobase"===pz.get("mode")&&this.restoreBase()
this.closeSearch()}closeSearch(){null==this.focused||this.focused===this.$(".seq-search-box")[0]?this.$(".seq-search-box").blur():o()(this.focused).focus()
pz.resetSearch()
this.$el.animate({top:"-180px"},200)
pz.set("mode",null)}openSearch(){this.focusSearch()
this.inputSearch("")
pz.set("mode","search")}_searchViewIsVisible(){return 0===o()("#editor .modal-backdrop").length&&!nz.Z.getIsExpanded()}handleKeydown(e){this._searchViewIsVisible()&&null!=pz.get("sequence")&&this.handleKeydownForSequence(e)}_getEvalVars(){return{c:T.looseModelToDisplay(pz.get("gotoFromBase"),this.startIndex()),e:null!=pz.get("gotoFromBaseEnd")?T.looseModelEndToDisplay(pz.get("gotoFromBaseEnd"),this.startIndex()):void 0}}_evaluateExpression(e){const t=`=${e.replace(/\bc\b/g,"A1").replace(/\be\b/g,"A2")}`,{c:n,e:a}=this._getEvalVars(),i=null!=n?mz.Z.util.astValue({rawValue:n,type:zO.BaseTypedValueType.NUMBER}):null,s=null!=a?mz.Z.util.astValue({rawValue:a,type:zO.BaseTypedValueType.NUMBER}):null,r=new mz.Z.Environment
r.currentTable="SearchBox"
const o=null==i?{value:i,error:new mz.Z.util.ReferenceError(""),locked:!1}:{value:i,error:null,locked:!1},l=null==s?{value:s,error:new mz.Z.util.ReferenceError(""),locked:!1}:{value:s,error:null,locked:!1}
r.put({row:0,column:0,table:r.currentTable},o)
r.put({row:1,column:0,table:r.currentTable},l)
return mz.Z.parse(t).eval(r).rawValue}handleKeydownForSequence(e){let t,n
if(pn.isCtrlG(e)){this.focusSearch()
const a=this.model.get("sequence");(0,S.hu)(null!=a,"Expected sequence to be present when calling handleKeydownForSequence.")
t=a.get("selection")
const i=t.start()
n=t.end()
this.inputGoto(i,n)
e.stopPropagation()
e.preventDefault()}else if(pn.isCtrlF(e)||pn.isCtrlShiftF(e)){this.focusSearch()
pz.set({searchAminoAcids:e.shiftKey})
this.focused!==this.$(".seq-search-box")[0]&&(0,as.tK)(this.model.get("sequence"))
if("gotobase"===pz.get("mode")){this.inputSearch("")
pz.set("mode","search")}else this.inputSearch("")
e.stopPropagation()
e.preventDefault()}else if(38!==e.which&&40!==e.which||"gotobase"!==pz.get("mode")){if(13===e.which&&this.$(".seq-search-box").is(":focus")){if("gotobase"===pz.get("mode")){this.doSearch()
this.closeSearch()}else{const t=e.shiftKey?this.$(".find-previous-btn"):this.$(".find-next-btn")
t.click()
t.addClass("active")}e.stopPropagation()
e.preventDefault()}else if(27===e.which&&this.$(".seq-search-box").is(":focus")){e.stopPropagation()
e.preventDefault()
this.cancelSearch()}}else{e.stopPropagation()
e.preventDefault()
const t=this.model.get("sequence");(0,S.hu)(null!=t,"Expected sequence to be present when calling handleKeydownForSequence.")
const a=38===e.which?1:-1
n=this.$(".seq-search-box")[0].selectionEnd
let i=this.$(".seq-search-box").val()
const s=i.split(":"),r=s.length-i.slice(l.default.indexOf(i,":",n)).split(":").length
try{let e,n=T.looseDisplayToModel(this._evaluateExpression(s[1]),this.startIndex())
1===r&&(n+=a)
if(s.length>2){e=T.looseDisplayEndToModel(this._evaluateExpression(s[2]),this.startIndex())
2===r&&(e+=a)}else e=t.length()+1
if(1===r){t.circular()||(n=Math.min(Math.max(0,n),e-1))
s[r]=String(T.looseModelToDisplay(n,this.startIndex()))
i=s.join(":")
this.$(".seq-search-box").val(i)
const a=s[0].length+1
this.$(".seq-search-box")[0].selectionStart=a
this.$(".seq-search-box")[0].selectionEnd=a+s[1].length
this.doSearch("start")}else{if(2!==r)return
{t.circular()||(e=Math.max(n+1,Math.min(t.length(),e)))
s[r]=String(T.looseModelEndToDisplay(e,this.startIndex()))
i=s.join(":")
this.$(".seq-search-box").val(i)
const a=s[0].length+1+s[1].length+1
this.$(".seq-search-box")[0].selectionStart=a
this.$(".seq-search-box")[0].selectionEnd=a+s[2].length
this.doSearch("end")}}}catch(e){this.setGotoInvalid()}}}update(e){this.model.setSequence(e)}jumpToResult(){const e=pz.get("index")
if(e>-1){const t=this.model.get("results").at(e)
t&&t.get("sequence").trigger("jump",t.start(),null,t.end())}}restoreBase(){const e=this.model.get("sequence");(0,S.hu)(null!=e,"Expected sequence to be present when calling restoreBase.")
const t=e.get("selection"),n=pz.get("gotoFromBase"),a=pz.get("gotoFromBaseEnd")
if(null!=a){e.trigger("jump",n,null,a)
t.setEndpoints(n,a)}else if(null!=n){e.trigger("jump",n)
t.reset(n)}}storeBase(){const e=this.model.get("sequence");(0,S.hu)(null!=e,"Expected sequence to be present when calling storeBase.")
const t=e.get("selection")
pz.set("gotoFromBase",t.start())
pz.set("gotoFromBaseEnd",t.end())}setGotoInvalid(){this.$(".seq-search-box").css("border-color","red")
pz.set("gotoMsg","invalid expr.")}doSearch(e){null==e&&(e="start")
this.$(".seq-search-box").css("border","")
const t=this.$(".seq-search-box").val()
let n=pz.get("maxMismatches")
n=n&&n>0?n:0
const a=this.model.get("sequence");(0,S.hu)(null!=a,"Expected sequence to be present when calling doSearch.")
const i=a.get("selection")
0!==t.length&&":"===t.charAt(0)&&":"!==t||"gotobase"!==pz.get("mode")?t.length>0&&":"===t.charAt(0)&&"gotobase"!==pz.get("mode")&&this.storeBase():this.restoreBase()
if(0===t.length){this.$(".seq-search-count").text("")
pz.resetSearch()
return pz.set("mode","search")}if(":"===t.charAt(0)){pz.set("mode","gotobase")
pz.resetSearch()
if(t.split(":").length>3){this.setGotoInvalid()
return!1}if(t.length>1){let n,s,r,o,l
if(!t.match(/^:([^:]+)(:([^:]+)?)?$/)){this.setGotoInvalid()
return!1}try{r=t.match(/:([^:]+)/)[1]
l=T.looseDisplayToModel(this._evaluateExpression(r),this.startIndex())}catch(e){this.setGotoInvalid()
return!1}if("number"!=typeof l){this.setGotoInvalid()
return!1}const c=t.match(/:[^:]+:([^:]+)/)
if(c){try{o=T.looseDisplayEndToModel(this._evaluateExpression(c[1]),this.startIndex())}catch(e){this.setGotoInvalid()
return!1}if("number"!=typeof o){this.setGotoInvalid()
return!1}}const inRange=e=>{n=a.circular()
return n&&-a.length()<=e&&e<2*a.length()||!n&&-a.length()<=e&&e<=a.length()}
if(!inRange(l)||null!=o&&!inRange(o)){this.$(".seq-search-box").css("border-color","red")
const e=T.modelToDisplay(0,this.startIndex()),t=T.modelToDisplay(a.length()-1,this.startIndex())
pz.set("gotoMsg",`must be in range ${e} - ${t}`)
return!1}if(null!=o){s=T.looseModelToDisplay(l,this.startIndex())
const e=T.looseModelEndToDisplay(o,this.startIndex())
pz.set("gotoMsg",`selection (${s}, ${e})`)}else{s=T.looseModelToDisplay(l,this.startIndex())
pz.set("gotoMsg",`go to base (${s})`)}l=T.modInclusive(l,a.length())
if(null!=o){0===o&&(o=a.length())
o=T.modInclusive(o,a.length())
if(!a.circular()&&l>o){this.setGotoInvalid()
return!1}i.setEndpoints(l,o)}else i.reset(l)
null==o||"start"===e?a.trigger("jump",l):a.trigger("jump",o)}else pz.set("gotoMsg",null)}else{pz.set("mode","search")
const e=i.isNotEmpty()?{start:i.start(),end:i.end()}:null
pz.doSearch(t,e,{searchFeatures:!0,maxMismatches:n})
pz.get("results").length>0?pz.changeIndex(0):pz.changeIndex(-1)
pz.set("hasSearched",!0)
this.jumpToResult()}return!0}handleRegionChange(){this.handleBigSequence()
this.updatePlaceHolder()}handleBigSequence(){let e
const t=pz.get("sequence");(0,S.hu)(null!=t,"Expected sequence to be present when calling handleBigSequence().")
const n=t.isReallyBig()
e=t.selection().isEmpty()?t.isReallyBig():t.selection().isReallyBig()
this.$(".js-search-mismatches .js-mismatches-help-enabled").toggleClass("hide",e)
this.$(".js-search-mismatches .js-mismatches-help-disabled").toggleClass("hide",!e)
this.$(".js-mismatches-controls").prop("disabled",e)
this.$(".js-mismatches").prop("disabled",e)
this.$(".js-search-region .js-region-help-enabled").toggleClass("hide",n)
this.$(".js-search-region .js-region-help-disabled").toggleClass("hide",!n)
this.$("#restrictToORF").prop("disabled",n)
if(n){this.$("#restrictToORF").prop("checked",!1)
pz.set("region","all")}if(e){this.$(".js-mismatches").val("")
pz.set("maxMismatches",0)}}sequenceChangeHandler(){if(null!=pz.previous("sequence")){const e=pz.previous("sequence")
this.stopListening(e.get("selection"))
this.stopListening(e.get("_sequence"))}if(null!=pz.get("sequence")){const e=pz.get("sequence")
this.listenTo(e.get("_sequence"),"change:bases",(()=>{this.handleRegionChange()}))
this.listenTo(e.get("selection"),"change:start change:end",(()=>{this.handleRegionChange()}))
this.handleRegionChange()
this.$(".seq-search-box").prop("disabled",!1)}else{this.$(".seq-search-box").prop("disabled",!0)
this.closeSearch()}}toggleSettings(e){e.preventDefault()
pz.set("showSettings",!pz.get("showSettings"))}showSettings(){const e="search"===pz.get("mode")&&pz.get("showSettings")
this.$(".settings").toggleClass("hide",!e)
this.$(".js-adv-settings").toggleClass("active",e)
const t=pz.get("searchAminoAcids")?"amino acids":"bases",n=pz.get("searchAminoAcids"),a=this.$(".js-search-type-bases"),i=this.$(".js-search-type-amino-acids")
if(n){this.$(".js-mismatches").val("")
a.hasClass("button--secondary")&&i.click()}else i.hasClass("button--secondary")&&a.click()
this.$(".js-search-mismatches").toggleClass("hide",n)
this.$("select[name=search-target]").val(t)
const s=pz.get("region"),r="orfs"===s
this.$("select[name=search-region]").val(s)
this.$(".js-orf-settings").toggleClass("hide",!r)}showORFSettings(){var e
const t=Boolean(null===(e=pz.get("sequence"))||void 0===e?void 0:e.isRNASequence())?Yt.gw:Yt.D1
Xe.bA(dz.V,d.createElement(dz.Z,{settings:t.settings}))}updateORFSearch(){"orfs"===pz.get("region")&&this.doSearch()}updatePlaceHolder(){const e=pz.get("sequence");(0,S.hu)(null!=e,"Expected sequence to be present when calling updatePlaceHolder")
const t=e.selection(),n=pz.get("searchAminoAcids")?"amino acids":"bases"
if(t.isNotEmpty()){const a=T.modelStartToDisplay(t.start(),this.startIndex()),i=T.modelEndToDisplay(t.end(),e.length(),this.startIndex())
this.$(".seq-search-box").attr("placeholder",`Search ${n} in selection (${a}-${i})`)}else{this.$(".seq-search-box").attr("placeholder",`Search ${n}, annotations, translations, and primers`);(0,He.Z)(this.$(".seq-search-box"),{component:"SearchDNAView",key:"searchInput"})}}showFeatureResults(){const e=pz.featureResults(),t=this.$(".search-dropdown ul")
t.empty()
pz.get("featCapped")?t.append(`<li class='result-msg'>\n  <span class='result-count'>${e.length}+ feature results</span>\n  <span class='result-info'>Refine search to see all results</span>\n</li>`):t.append(`<li class='result-msg'>\n  <span class="result-count">${e.length} feature results</span>\n</li>`);(0,He.Z)(this.$(".search-dropdown ul"),{component:"SearchDNAView",key:"featureCount"})
e.each((e=>{const n=e.feature(),a=[n.name().slice(0,e.start()),n.name().slice(e.start(),e.end()),n.name().slice(e.end())],i=(()=>{switch(n.strand()){case 1:return"FWD"
case-1:return"REV"
default:return""}})(),s=T.modelToDisplay(n.start(),this.startIndex()),r=T.modelEndToDisplay(n.end(),pz.get("sequence").length(),this.startIndex()),l=o()(lz({name:a,strand:i,start:s,end:r}))
l.find("a").data("feature",n)
l.find(".feat-swatch").css("background-color",function getFeatureColor(e){return"part"===e.type()&&dt.ZP.PARTS_ENABLE_OVERLAPPING_PARTS?vi:e.color()}(n)).toggleClass("striped","primer"===n.type())
t.append(l)}))
this.$(".search-dropdown").toggleClass("open",e.length>0)}clickFeature(e){e.preventDefault()
o()(e.currentTarget).data("feature").click(this.model.get("sequence"))
this.$(".search-dropdown").removeClass("open")
this.closeSearch()}renderAdvancedOptions(){(0,Me.A9)(d.createElement(SearchSequenceAdvancedOptions,{searchType:pz.get("searchAminoAcids")?cz.AMINO_ACIDS:cz.BASES,onChangeSearchType:e=>{pz.set("searchAminoAcids",e===cz.AMINO_ACIDS)},searchRegion:pz.get("region"),onChangeSearchRegion:e=>{pz.set("region",e)},mismatchesAllowed:pz.get("maxMismatches"),onChangeMismatchesAllowed:e=>{const t=e&&e>=0?e:0
pz.set("maxMismatches",t)}}),this.$(".settings")[0])}initialize(e){this.handleKeydown=this.handleKeydown.bind(this)
this.handleKeyup=this.handleKeyup.bind(this)
this.focused=null
o()(window).keydown((e=>{this.handleKeydown(e)}))
o()(window).keyup((e=>{this.handleKeyup(e)}))
this.$(".js-ctrl-f-help.glyphicon-question-sign").popover({placement:"bottom",title:"<b>Examples</b>",trigger:"hover",content:Xt.renderToStaticMarkup(d.createElement(DNASearchExamples,null)),html:!0,delay:100,container:"body"})
this.renderAdvancedOptions()
this.$(".seq-search-box").bind("input",(e=>{this.model.has("sequence")?this.doSearch():logUndefinedState("SearchDNAView","sequence",this,e)}))
this.$(".seq-search-box").blur((()=>{this.focused=null}))
this.$(".seq-search-box").focus((()=>{this.$el.animate({top:"0px"},200)}))
this.$(".close-btn").click((()=>{this.closeSearch()}))
this.$(".find-previous-btn").click((()=>{this.$(".seq-search-box").focus()
if(pz.get("hasSearched")){if(pz.get("index")>=0){pz.changeIndex(Math.max(0,pz.get("index")-1))
this.jumpToResult()}}else this.doSearch()}))
this.$(".find-next-btn").click((()=>{this.$(".seq-search-box").focus()
if(pz.get("hasSearched")){pz.changeIndex(Math.min(pz.get("results").length-1,pz.get("index")+1))
this.jumpToResult()}else this.doSearch()}))
this.listenTo(pz,"basesChanged",(()=>this.doSearch()))
this.listenTo(pz,"change:region change:searchAminoAcids change:maxMismatches",(()=>this.doSearch()))
this.showSettings()
Yt.j2()
this.listenTo(Yt.D1.settings,"change:value",(()=>{this.updateORFSearch()}))
this.listenTo(Yt.gw.settings,"change:value",(()=>{this.updateORFSearch()}))
this.listenTo(pz,"change:showSettings change:mode change:searchAminoAcids change:region",(()=>{this.showSettings()}))
this.listenTo(pz,"change:searchAminoAcids",(()=>{this.updatePlaceHolder()}))
this.listenTo(pz.featureResults(),"add remove reset",(()=>{this.showFeatureResults()}))
this.listenTo(pz,"open",(()=>{this.openSearch()}))
this.listenTo(pz,"close",(()=>{this.cancelSearch()}))
this.listenTo(pz,"change:sequence",(()=>{this.sequenceChangeHandler()}))
this.listenTo(pz,"change:index reset:results change:gotoMsg change:searchMsg change:range change:hasSearched change:mode change:onlyShowSelected",(()=>{let e,t
const n=pz.get("index"),a=pz.get("results").length,i=pz.get("mode"),s=pz.get("hasSearched"),r=pz.get("capped"),l=pz.get("onlyShowSelected")?"(refine search to see all)":""
this.$(".find-next-btn").prop("disabled",n<0)
this.$(".find-previous-btn").prop("disabled",n<0)
o()(".js-adv-settings").addClass("hide")
if("search"===i){const i=s&&r?"+":"",c=null!=pz.get("range")?" (in selection)":""
e=s?`${l} ${n+1} of ${a}${i}${c}`:""
t=pz.get("searchMsg")
if(null!=t){this.$(".seq-search-box").css("border-color","red")
e=t}s?o()(".seq-search-count-row").show():o()(".seq-search-count-row").hide()
o()(".js-adv-settings").removeClass("hide")}else if("gotobase"===i){t=pz.get("gotoMsg")
e=null!=t?t:"go to base"}else e=""
this.$(".seq-search-count").text(e);(0,He.Z)(this.$(".seq-search-count"),{component:"SearchDNAView",key:"count"})
this.$(".seq-search-box").css({"padding-right":this.$(".in-input").width()})}))}}SearchDNAView.initClass()
const hz=SearchDNAView
var gz=n(518155)
const Ez=(0,be.Z)((function SwitcherItem({name:e}){return d.createElement("a",{href:"#"},d.createElement("div",{className:"badge-close pull-right"},"×"),d.createElement("div",{className:"assembly-title"},0===e.length?d.createElement(d.Fragment,null," "):e))}))
class Switcher_SwitcherItem extends s().View{static initClass(){this.prototype.tagName="li"
this.prototype.template=Ez}initialize(e){this.listenTo(this.model,"change:active",this.toggle)
this.listenTo(this.model,"change:name",this.render)}toggle(e,t){this.$el.toggleClass("open",t)}render(){this.$el.html(this.template(this.model.toJSON()))
this.$el.data({assemblyId:this.model.id})
this.toggle(this.model,this.model.get("active"))
return this}}Switcher_SwitcherItem.initClass()
class Switcher extends s().View{static initClass(){this.prototype.el="#assembly-switcher"
this.prototype.events={"click li a":"handleClick","click .statusbar-label":"open"}}initialize(e){this.collection=c.assemblies
this.sequences=ve.ZP.get()
this.listenTo(this.collection,"add",this.add)
this.listenTo(this.collection,"add remove reset finishedFetch",this.renderItems)
this.listenTo(this.collection,"change:name change:parameters",(0,It.D)(this.saveAssembly,500))
this.listenTo(this.sequences,"remove",this.handleClose)
this.listenTo(this.sequences,"reset",this.handleCloseAll)}open(){m.j("assembly","assembly_wizard_click",{product:j.XC.MOLBIO})
this.collection.isLoaded()||this.collection.isFetching()||this.collection.fetch({reset:!0})}saveAssembly(e){e.save(null,{patch:!0,parse:!1})}handleCloseAll(e,t){for(const e of Array.from(t.previousModels))this.handleClose(e)}handleClose(e){const t=e.id
this.collection.each((n=>{const a=n.slots().chain().map((e=>e.fragments().filter((e=>e.sequenceID()===t)))).flatten().value(),i=n.slots().filter((e=>e.fragments().any((e=>e.sequenceID()===t))))
if(a.length&&n.active()){for(let e=0;e<a.length;e++){a[e].destroy({error(){(0,S.Gp)(!1,"fragment.destroy() failed")},silent:e!==a.length-1})}const t=i.map((e=>e.name()))
v.ZP.warn(`**${e.name()}** was removed from **${(0,Mt.Dw)(t)}**\nin the current assembly.`)}}))}handleClick(e){const t=o()(e.currentTarget).parent()
if(t.hasClass("create")){m.j("assembly","create_new_click",{product:j.XC.MOLBIO});(0,Xn.Z)(gz.C,{})
return}if(t.hasClass("create-bulk")){m.j("assembly","create_new_bulk_click",{product:j.XC.MOLBIO});(0,ac.ZP)("/bulk-workflows/assembly")
return}const n=this.collection.get(t.data("assemblyId"))
o()(e.target).hasClass("badge-close")?n.destroy():n.active()?this.collection.toggleActive(n):this.collection.activateAssembly(n)}add(e){this.collection.each((e=>e.set({active:!1})))
this.collection.activateAssembly(e)}renderItems(){if(!this.collection.isLoaded())return
const e=this.collection.map((e=>new Switcher_SwitcherItem({model:e}).render().el))
e.length>0&&e.unshift(o()("<li>").addClass("divider"))
const t=o()("<a>").text("Create New Assembly");(0,He.Z)(t,{component:"Switcher",element:"createAssemblyButton"})
const n=[{html:t,className:"create"}]
dt.ZP.ENABLE_BULK_ASSEMBLY&&n.push({html:o()("<a>").text("Create New Bulk Assembly"),className:"create-bulk"})
e.unshift(...n.map((({html:e,className:t})=>o()("<li>").addClass(t).html(e))))
this.$("ul").html(e)}}Switcher.initClass()
const fz=Switcher
class ProteinStatusBar extends d.Component{constructor(){super(...arguments)
this._renderProteinSelectionStatus=()=>{const e=T.residueSlice(this.props.aminoAcids,this.props.selection.start,this.props.selection.end,!1),[t,n]=T.modelRangeToDisplay(this.props.selection.start,this.props.selection.end,this.props.aminoAcids.length,Ki.ZP.DEFAULT_START_INDEX)
return null!=this.props.selection.end?[d.createElement("div",{className:"statusbar-group",key:"start"},d.createElement("div",{className:"statusbar-label"},"Start"),d.createElement("div",{className:"statusbar-field selectable"},t)),d.createElement("div",{className:"statusbar-group",key:"end"},d.createElement("div",{className:"statusbar-label"},"End"),d.createElement("div",{className:"statusbar-field selectable"},n)),d.createElement("div",{className:"statusbar-group",key:"length"},d.createElement("div",{className:"statusbar-label"},"Length"),d.createElement("div",{className:"statusbar-field selectable"},e.length)),d.createElement("div",{className:"statusbar-group",key:"mw"},d.createElement("div",{className:"statusbar-label"},"MW"),d.createElement("div",{className:"statusbar-field selectable"},ns.LE(e).toFixed((0,Ki.Y4)()))),d.createElement("div",{className:"statusbar-group",key:"pI"},d.createElement("div",{className:"statusbar-label"},"pI"),d.createElement("div",{className:"statusbar-field selectable"},ns.EF(e).toFixed(Ki._o)))]:d.createElement("div",{className:"statusbar-group"},d.createElement("div",{className:"statusbar-label"},"Insert"),d.createElement("div",{className:"statusbar-field selectable"},t))}}render(){return d.createElement("div",null,d.createElement("div",{className:"statusbar-section"},d.createElement("div",{className:"statusbar-group"},d.createElement("div",{className:"statusbar-label"},"Amino Acids"),d.createElement("div",{className:"statusbar-field selectable"},this.props.aminoAcids.length))),d.createElement("div",{className:"statusbar-section"},this._renderProteinSelectionStatus()))}}const Sz=ProteinStatusBar
var yz=n(881202),bz=n(781995),Tz=n(672116),vz=n(645968),Cz=n(13055)
class SequenceNUEModuleConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[bz.Z]}enhanceProps(){var e,t,n,a
const i=this.homeDashboardStore().getNUEModuleState(Qs.ZP.MODULES.SEQUENCE)
return{collapsed:null!==(e=null==i?void 0:i.collapsed)&&void 0!==e&&e,completed:null!==(t=null==i?void 0:i.completed)&&void 0!==t&&t,openIndex:null!==(n=null==i?void 0:i.openIndex)&&void 0!==n?n:null,tasks:null!==(a=null==i?void 0:i.tasks)&&void 0!==a?a:null,visible:!(null==i?void 0:i.acknowledgedCompleted)&&!(null==i?void 0:i.dismissed)}}}function handleChangeCollapsed(e){(0,Cz.F8)(e,vz.dP,vz.zq)}const Iz=SequenceNUEModuleConnector.connect((function SequenceNUEModule({tasks:e,completed:t,visible:n,collapsed:a,openIndex:i}){const s=Jn.Z.currentUser(),r=s&&!yz.U(s)
let o=[]
n&&s&&e&&(o=(0,Cz.lx)(e,null!=t&&t,r))
return d.createElement(d.Fragment,null,0!==o.length&&d.createElement(Tz.Z,{collapsed:a,completed:t,listItems:o,module:Qs.ZP.MODULES.SEQUENCE,openIndex:i,title:"Explore Molecular Biology",onChangeCollapsed:handleChangeCollapsed,fixedSize:!0}))})),StatusBarItem=e=>d.createElement("div",{className:"statusbar-group",key:e.label},d.createElement("span",{className:"statusbar-label"},e.label),d.createElement("span",{className:"statusbar-field selectable"},e.value))
function MeltingTemperature({selectionMeltingTmp:e,isOligo:t,nucleotideType:n}){return d.createElement("div",{className:"statusbar-group",key:"mt"},d.createElement("div",{className:"btn btn-af-default",onClick:()=>{(0,Xn.Z)(MeltingTempModal,{isOligo:t,nucleotideType:n})}},d.createElement("span",{className:"statusbar-label"},"Melting Temp"),d.createElement("span",{className:"statusbar-field selectable"},e&&`${e} °C`||"--")))}function SelectionStatus(e){return e.selectionEnd?d.createElement(d.Fragment,null,d.createElement(StatusBarItem,{label:"Start",value:e.selectionStart}),d.createElement(StatusBarItem,{label:"End",value:e.selectionEnd}),d.createElement(StatusBarItem,{label:"Length",value:e.selectionLength}),d.createElement(StatusBarItem,{label:"GC",value:e.selectionGC&&`${e.selectionGC}%`||"--"}),d.createElement(MeltingTemperature,{selectionMeltingTmp:e.selectionMeltingTmp,isOligo:e.isOligo,nucleotideType:e.nucleotideType})):null!=e.selectionStart?d.createElement(StatusBarItem,{label:"Insert",value:e.selectionStart}):null}function SequenceStatusBar(e){var t
const n=e.isOligo?"Oligo exceeds Benchling's limit of 2,000 bases. This may affect system performance.":"Sequence exceeds Benchling's limit of 10 million bases. This may affect system performance.",a=e.isOligo?fn.GN:fn.ZC
return d.createElement("div",null,d.createElement("div",{className:"statusbar-section always"},d.createElement("div",{className:"statusbar-group"},d.createElement("div",{className:"statusbar-label"},"Bases"),d.createElement("div",{className:"statusbar-field selectable"},null!==(t=e.numBases)&&void 0!==t?t:"--"),dt.ZP.MOLBIO_ENFORCE_SEQUENCE_LENGTH_LIMITS&&null!=e.numBases&&e.numBases>a&&d.createElement(P.ZP,{title:n},d.createElement(pe.Z,{style:{marginLeft:"3px",color:Vt.ud},icon:"warning"})))),d.createElement("div",{className:"statusbar-section"},d.createElement(SelectionStatus,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,selectionLength:e.selectionLength,selectionGC:e.selectionGC,selectionMeltingTmp:e.selectionMeltingTmp,isOligo:e.isOligo,nucleotideType:e.nucleotideType})),d.createElement("div",{className:(0,g.iv)(wz.sequenceNUEModule)},d.createElement(Iz,null)))}const wz=g.mM.create({sequenceNUEModule:{position:"absolute",bottom:"32px",lineHeight:"initial"}})
var Nz=n(621768)
class SidebarStore extends gx.Z{resetState(){this.isOpen=!0
this.section=Nz.Section.BROWSER}getIsOpen(){return this.isOpen}getSection(){return this.section}payloadHandler(e){let t,n
switch(e.actionType){case fa.wXQ:this.isOpen=!0
null!=e.section&&(this.section=e.section)
this.emitChange()
break
case fa.zSv:this.isOpen=!1
this.emitChange()
break
case fa.GSq:{const{fileType:a}=e
if(a===st.TEMPLATE){n=Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE
t=!0}else if(Nz.STANDARD_SECTIONS.includes(this.section)){n=this.section
t=this.isOpen}else{n=Nz.Section.BROWSER
t=this.isOpen}if(n!==this.section||t!==this.isOpen){this.section=n
this.isOpen=t
this.emitChange()}break}}return!0}}const Az=new SidebarStore(Sa.Z)
var Rz=n(846130),Pz=n(428830),Oz=n(525258)
class TimerList extends d.Component{constructor(){super(...arguments)
this.audioPrimed=!1
this.trayAudioRef=d.createRef()
this.playAudio=()=>u.findDOMNode(this.trayAudioRef.current).play()
this.pauseAudio=()=>{u.findDOMNode(this.trayAudioRef.current).pause()}
this.allTrayTimers=()=>{const e=Array.from(this.props.timers).map((e=>l.default.extend({requestChange:Rz.Z.updateTimer.bind(Rz.Z,e,e.id),requestDelete:Rz.Z.removeTimer.bind(Rz.Z,e,e.id)},e)))
return null!=e?e:[]}
this.activeTrayTimer=()=>{let e=null,t=null
for(const a of Array.from(this.allTrayTimers())){var n
if(0!==a.startMS){if(a.startMoment){n=1e3*a.startMoment.unix()+a.startMS
if(null==t||n<t){e=a
t=n}}}else{n=0
if(null==t||n<t||(null==e?void 0:e.inlineCopy)&&!a.inlineCopy){e=a
t=n}}}if(null!=e&&!a&&null!=this.trayAudioRef.current){Pz.F(u.findDOMNode(this.trayAudioRef.current))
var a=!0}return e}
this.timerRunning=()=>this.props.timers.some((e=>null!=e.startMoment))
this.unloadHandler=()=>{window.beforeUnloadType="TimerList"
if(this.timerRunning())return"There is currently a timer running."}
this.msLeft=e=>{let t
t=e.startMoment?Zd()().diff(e.startMoment):0
return Math.max(0,e.startMS-t)}
this.toggleTimer=()=>{const e=this.activeTrayTimer()
e.startMS>0?Rz.Z.updateTimer(e.id,{startMoment:null,startMS:this.msLeft(e)}):Rz.Z.updateTimer(e.id,{startMoment:null,startMS:e.originalMS})}}componentDidMount(){o()(window).on("beforeunload",this.unloadHandler)}componentWillUnmount(){o()(window).off("beforeunload",this.unloadHandler)}render(){const e=this.activeTrayTimer()
return null!=e?d.createElement("div",{className:"statusbar-label btn btn-af-default trayTimer-statusBarLabel"},d.createElement(Pz.w,{ref:this.trayAudioRef}),d.createElement("div",{className:"trayTimer-toolboxActiveTimer",onClick:this.toggleTimer},d.createElement(Oz.Z,{timer:e,onRequestPlayAudio:()=>{null!=this.trayAudioRef.current&&this.playAudio()},onRequestPauseAudio:()=>{null!=this.trayAudioRef.current&&this.pauseAudio()}}))):null}}TimerList.displayName="TimerList"
TimerList.defaultProps={timers:[]}
const xz=TimerList
var _z=n(232196)
class TimerView extends s().View{initialize(e){this.render=this.render.bind(this)
_z.Z.addChangeListener(this.render)}remove(){_z.Z.removeChangeListener(this.render)
u.unmountComponentAtNode(this.el)
return super.remove()}render(){const e=d.createElement(xz,{..._z.Z.getState()});(0,Me.A9)(e,this.el)
return this}}const Dz=TimerView
let Lz
class StatusBarView extends s().View{constructor(){super(...arguments)
this.subels={sequence:"#sequence-statusbar",protein:"#protein-statusbar"}
this.reactSubelsRenderFunctions={protein:this.updateProteinStatusBar,sequence:this.updateSequenceStatusBar}}static initClass(){this.prototype.el="#statusbar"}events(){return{"click .split":"toggleSplit","mouseover .split":"showSplitMessage","mouseout .split":"hideSplitMessage"}}initialize(e){this.toggleMinWidthClasses=this.toggleMinWidthClasses.bind(this)
this.updateSequenceStatusBar=this.updateSequenceStatusBar.bind(this)
this.updateProteinStatusBar=this.updateProteinStatusBar.bind(this)
this.assemblySwitcher=new fz
Az.addChangeListener(this.toggleMinWidthClasses)
this.trayTimerView=new Dz({el:this.$(".trayTimerView")[0]}).render()
this.registerListeners()}showSplitMessage(){this.model.get("splitWorkspace")?sP.qu("Join workspace panes"):sP.qu("Split workspace into two panes")}hideSplitMessage(){sP.nJ()}handleModelChange(){if(!1!==this.model.changedAttributes())if(this.model.changedAttributes().timeoutMessage){const e=this.model.get("timeoutMessage")
this.$el.find(".timeout").text(e).hide().removeClass("hidden").fadeIn("fast")
clearTimeout(Lz)
Lz=setTimeout((()=>this.model.unset("timeoutMessage")),2e3)}else{"timeoutMessage"in this.model.changedAttributes()||this.model.unset("timeoutMessage")
this.$el.find(".timeout").addClass("hidden")
clearTimeout(Lz)}}renderOverlayMessage(){const e=this.model.get("overlayMessage")
e?this.$el.find(".overlay").text(e).removeClass("hidden"):this.$el.find(".overlay").text("").addClass("hidden")}toggleSplit(e){o()(".kill-on-split .js-help-exit-early, .kill-on-split .js-help-done").click()
const t=!this.model.get("splitWorkspace")
this.fileState.setIsWorkspaceSplit(t)
this.fileState.updateWorkspaceSplitPreference(t)
m.j("editor","toggled_split_workspace",{split:t})
Ys.OZ(Qs.ZP.MODULES.SEQUENCE,Qs.ZP.SPLIT_WORKSPACE)
this.showSplitMessage()}toggleMinWidthClasses(){o()("#editor").toggleClass("hasFileBrowserOpen",Az.getIsOpen())}renderSplitWorkspaceButton(){const e=1===this.model.get("numBuffers")
this.$el.find(".split").toggleClass("active",this.model.isWorkspaceSplit()).toggleClass("disabled",e).prop("disabled",e)}commonStatusbarSetup(){this.listenTo(this.model,"change",this.handleModelChange)
this.listenTo(this.model,"change:overlayMessage",this.renderOverlayMessage)
this.listenTo(this.model,"change:splitWorkspace",this.renderSplitWorkspaceButton)
this.renderOverlayMessage()
this.renderSplitWorkspaceButton()}updateSequenceStatusBar(){this.model.set({numBases:this.sequence.get("dna").forward().length})
const[e,t]=T.modelRangeToDisplay(this.model.get("selectionStart"),this.model.get("selectionEnd"),this.sequence.length(),this.sequence.startIndex());(0,Me.A9)(d.createElement(SequenceStatusBar,{numBases:this.model.get("numBases"),selectionStart:e,selectionEnd:t,selectionLength:this.model.get("selectionLength"),selectionGC:this.model.get("selectionGC"),selectionMeltingTmp:this.model.get("selectionMeltingTmp"),isOligo:this.sequence.isOligo(),nucleotideType:this.sequence.nucleotideType()}),this.$(this.subels.sequence)[0])}updateAssemblySwitcher(){const e=(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})&&this.fileState&&this.fileState.fileType()===st.SEQUENCE&&!this.fileState.model().isOligo()&&!this.fileState.model().isRNASequence()
this.assemblySwitcher.$el.toggleClass("hidden",!e)}showSubel(e){for(const t of Object.keys(this.subels)){const n=this.subels[t]
o()(n).toggleClass("hidden",e!==t)
e===t?this.reactSubelsRenderFunctions[t]():u.unmountComponentAtNode(this.$(n)[0])}}hideSubels(){for(const e of Object.keys(this.subels)){const t=this.subels[e]
o()(t).addClass("hidden")
u.unmountComponentAtNode(this.$(t)[0])}}updateProteinStatusBar(){const e=this.fileState.model().id,t=ba.Z.getProteinById(e),n=ba.Z.getSelection(e);(0,Me.A9)(d.createElement(Sz,{aminoAcids:t.version.aminoAcids,selection:n}),this.$(this.subels.protein)[0])}registerListeners(){ba.Z.addChangeListener((()=>{this.fileState&&this.fileState.fileType()===st.PROTEIN&&this.updateProteinStatusBar()}))}update(e){var t
this.fileState=e
const n=null===(t=this.fileState)||void 0===t?void 0:t.get("statusbar")
clearTimeout(Lz)
this.updateAssemblySwitcher()
sP.IW(n)
if(this.model){this.model.unset("timeoutMessage")
this.model.unset("overlayMessage")
this.stopListening(this.model)}this.model=n
this.$el.toggleClass("hidden",!n)
o()("#editor").toggleClass("has-hidden-statusbar",!n)
if(this.fileState&&n){if(this.fileState.fileType()===st.SEQUENCE){this.sequence=this.fileState.model()
this.showSubel("sequence")
this.listenTo(this.model,"change:numBases change:selectionStart change:selectionEnd change:selectionGC change:selectionMeltingTmp",this.updateSequenceStatusBar)}else this.fileState.fileType()===st.PROTEIN?this.showSubel("protein"):this.hideSubels()
this.commonStatusbarSetup()}}}StatusBarView.initClass()
const kz=StatusBarView
var Mz=n(40563),Fz=n(651804)
var Zz=n(933671),Bz=n(20921)
function _resetErrorsOnUpdate(){Sa.Z.dispatch({actionType:fa.JC7,updates:{errors:[]}})}function BulkTranslationActions_update(e){Sa.Z.dispatch({actionType:fa.JC7,updates:e})
!function _fetchSequencesOnUpdate(e){if(!l.default.has(e,"sequenceTagSchemaId")&&!l.default.has(e,"selectedIds"))return
const t=Bz.BN.update(Zz.Z.getBulkTranslation(),e)
if(t.sequenceTagSchemaId)if(t.selectedIds.length){Sa.Z.dispatch({actionType:fa.JC7,updates:{sequencesLoading:!0}})
eo.Z.getNestedFiles(t.selectedIds,{sort:{key:Kn.bo.SORT_NAME_KEY},tagSchema:t.sequenceTagSchemaId}).done((({files:e})=>{Sa.Z.dispatch({actionType:fa.JC7,updates:{sequences:e}})})).fail(v.ZP.notifyError).always((()=>{Sa.Z.dispatch({actionType:fa.JC7,updates:{sequencesLoading:!1}})}))}else Sa.Z.dispatch({actionType:fa.JC7,updates:{sequences:[]}})}(e)
!function _setTranslationSpecsOnUpdate(e){if(!e.sequenceTagSchemaId)return
const t=JZ.Z.getTagSchemaById(e.sequenceTagSchemaId);(0,S.hu)(t,"Sequence tag schema in bulk translation was not found in `TagSchemaStore`")
const n=l.default.where(t.fields,{fieldType:Hn.FIELD_TYPES.TRANSLATION_LINK.type}).map((e=>Bz.CC(e)))
Sa.Z.dispatch({actionType:fa.JC7,updates:{translationSpecs:n}})}(e)
_resetErrorsOnUpdate()}function updateTranslationSpec(e,t){Sa.Z.dispatch({actionType:fa.INW,translationSpecIndex:e,updates:t})
_resetErrorsOnUpdate()}function BulkTranslationActions_run(){const e=Zz.Z.getBulkTranslation();(0,S.hu)(!e.sequencesLoading,"Expected sequences in bulk translation to already be loaded");(0,S.hu)(!e.isRunning,"Expected bulk translation to not already be running")
Sa.Z.dispatch({actionType:fa.JC7,updates:{isRunning:!0}});(function run(e){const t={sequenceIds:e.sequences.map((e=>e.id)),folderId:e.outputFolderId,translationSpecs:e.translationSpecs.filter((e=>e.firstCodonAnnotationName.length>0)).map((e=>({tagSchemaFieldId:e.tagSchemaField.id,firstCodonAnnotationName:e.firstCodonAnnotationName,firstCodonOffset:e.firstCodonOffset})))}
return an.by({contentType:"application/json",data:JSON.stringify(t),dataType:"json",type:"POST",url:"/1/api/bulk-workflows/translation/run"})})(e).done((({api_identifier:t,errors:n})=>{if(n)Sa.Z.dispatch({actionType:fa.JC7,updates:{errors:n}})
else{(0,S.hu)(t,"Expected completed bulk translation to respond with protein folder")
Al.M({type:Rl.pC.INFO,message:"Bulk translation completed.",actionText:"Open",duration:0,onActionClick(){ez.RM()
Rn.Z.openFile(e.outputFolderId)}})
Sa.Z.dispatch({actionType:fa.qK0,outputFolderId:e.outputFolderId,proteinFolderId:t})
ve.ZP.get().updateSequenceVersions(e.sequences.map((e=>e.id)))}})).fail(v.ZP.notifyError).always((()=>{Sa.Z.dispatch({actionType:fa.JC7,updates:{isRunning:!1}})}))}function BulkTranslationActions_reset(){BulkTranslationActions_update(Bz.kb())}var qz=n(13951),Vz=n(98997),Uz=n(674476)
function GetFoldersWrapper_defineProperty(e,t,n){(t=function GetFoldersWrapper_toPropertyKey(e){var t=function GetFoldersWrapper_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class GetFoldersWrapper extends d.Component{constructor(...e){super(...e)
GetFoldersWrapper_defineProperty(this,"state",{folders:null})
GetFoldersWrapper_defineProperty(this,"_handleFoldersInvalidate",(()=>{this._fetchData(this.props.folderFilter)}))
GetFoldersWrapper_defineProperty(this,"_fetchData",(e=>{this._fetchPromise&&this._fetchPromise.cancel()
this._fetchPromise=(0,V_.Z)(Promise.resolve(eo.Z.fetchAll(Uz.an(this.props.folderFilter))))
this._fetchPromise.promise.then((t=>{const n=Uz.tn(e)
this.setState({folders:t.filter((e=>n(e)))})})).catch((e=>{e.isCanceled||v.ZP.notifyError(e)}))}))}componentDidMount(){ze.Z.on(ze.Z.FOLDER_CACHE_INVALIDATE,this._handleFoldersInvalidate)
this._fetchData(this.props.folderFilter)}UNSAFE_componentWillReceiveProps(e){const t=Uz.an(this.props.folderFilter),n=Uz.an(e.folderFilter)
Is()(t,n)||this._fetchData(e.folderFilter)}componentWillUnmount(){ze.Z.off(ze.Z.FOLDER_CACHE_INVALIDATE,this._handleFoldersInvalidate)
this._fetchPromise&&this._fetchPromise.cancel()}render(){return this.props.children(this.state.folders)}}GetFoldersWrapper_defineProperty(GetFoldersWrapper,"propTypes",{children:J().func.isRequired,folderFilter:J().shape({includeHiddenProjects:J().bool.isRequired,showInventory:J().bool.isRequired,showNotebook:J().bool.isRequired,showRegistries:J().bool.isRequired,level:J().string.isRequired})})
const Gz=GetFoldersWrapper,buildFileFilters=(e,t)=>e.concat([{key:Kn.Vm.FOLDER,operator:Kn.EF.IS,value:t},{key:Kn.Vm.ARCHIVE_PURPOSES,operator:Kn.EF.IS_ONE_OF,value:[zu.BH]}]),file_browser_MultipleFilesSelector=e=>{const loadMore=async(t,n)=>{const a={offset:n,limit:e.fetchLimit,sorts:[{key:Kn.bo.SORT_MODIFIED_AT_KEY,reverse:!0}],filters:buildFileFilters(e.fileFilter,t),query:""},i=await qz.k(a,Kn.Sc.GLOBAL)
return{items:Object.values(i.fileSummariesById).map((e=>Uz.vE(e))),more:n+e.fetchLimit<i.total,offset:n}}
return d.createElement(Gz,{folderFilter:e.folderFilter},(t=>t?d.createElement(Vz.Z,{selectedIds:e.value,onChangeSelectedIds:e.onChange,multiple:!0,items:Uz.P7(t),loadMore}):d.createElement("div",{className:"u-small-padding-bottom text-center"},d.createElement(kl.Z,null))))},components_BulkTranslationErrors=({errors:e})=>d.createElement("div",null,e.length>0&&d.createElement(Fz.XO,null,e.map(((e,t)=>d.createElement(Fz.Bc,{key:t},e)))))
class BulkTranslationSummary extends d.Component{constructor(){super(...arguments)
this._handleRun=()=>{BulkTranslationActions_run()}}render(){const{bulkTranslation:e}=this.props
if(e.sequencesLoading)return d.createElement(kl.Z,null)
const t=Bz.Qt(e)
return d.createElement("div",null,d.createElement("p",null,t.length," ",de._6(t.length,"AA sequence")," will be created."),d.createElement(Fz.__,null,"Preview"),d.createElement(rc.iA,{numRows:t.length},d.createElement(rc.sg,{renderCell:e=>d.createElement(rc.bL,null,t[e])})),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,disabled:e.isRunning||e.sequences.length<1,text:e.isRunning?"Translating...":"Next: Translate",onClick:this._handleRun}))}}const zz=BulkTranslationSummary
const $z=function TranslationSpecEditor(e){const{translationSpec:t}=e
return d.createElement("div",null,d.createElement(Fz.__,null,t.tagSchemaField.name),d.createElement(Ke.Z,null,d.createElement(Fz.__,{allCaps:!0,className:"bulkWorkflow-tag-name"},"First codon annotation"),d.createElement(_t.Z,{type:"text",value:t.firstCodonAnnotationName,onChange:t=>{updateTranslationSpec(e.translationSpecIndex,{firstCodonAnnotationName:t.target.value})}})),d.createElement(Ke.Z,null,d.createElement(Fz.__,{allCaps:!0,className:"bulkWorkflow-tag-name"},"Offset from annotation start"),d.createElement(_t.Z,{type:"number",value:t.firstCodonOffset,onChange:t=>{updateTranslationSpec(e.translationSpecIndex,{firstCodonOffset:(0,Jt.Lk)(t.target.value)})}})))}
class BulkTranslationEditor extends d.Component{constructor(){super(...arguments)
this._handleSequenceTagSchemaChange=e=>{(0,S.hu)(null!=e,"TagSchemaSelector returned a null tag schema")
BulkTranslationActions_update({sequenceTagSchemaId:e.id})}
this._handleSelectedIdsChange=e=>{BulkTranslationActions_update({selectedIds:e})}
this._handleOutputFolderChange=e=>{BulkTranslationActions_update({outputFolderId:e.target.value})}}render(){const{bulkTranslation:e}=this.props,t=Bz.FU(e)
return d.createElement(Fz.or,null,d.createElement(Fz.X6,null,d.createElement(Fz.Rg,null,d.createElement(Fz.h8,{text:"Select files to translate"},d.createElement(Ke.Z,null,d.createElement(Fz.__,null,"Sequence Schema",d.createElement(P.ZP,{title:"Only schemas with a translation link field\n                    may be used for bulk translation"},d.createElement(pe.Z,{className:"u-mini-spacing-left",icon:"circle-question"}))),d.createElement(Ho.ZP,{requireTranslationLink:!0,oligoAwareFolderItemTypes:[st.SequenceSubtype.SEQUENCE],onChange:this._handleSequenceTagSchemaChange,selectedTagSchemaId:e.sequenceTagSchemaId})),e.sequenceTagSchemaId?d.createElement(Ke.Z,null,d.createElement(Fz.__,null,"Sequence Files and Folders"),d.createElement(file_browser_MultipleFilesSelector,{value:e.selectedIds,onChange:this._handleSelectedIdsChange,folderFilter:{level:"read",includeHiddenProjects:!1,showInventory:!0,showNotebook:!0,showRegistries:!0},fileFilter:(n=e.sequenceTagSchemaId,[{key:Kn.Vm.TYPES,operator:Kn.EF.IS_ONE_OF,value:[st.SEQUENCE]},{key:Kn.Vm.SCHEMA,operator:Kn.EF.IS_ONE_OF,value:[n]}]),fetchLimit:20})):null),d.createElement(Fz.h8,{text:"Select translation link fields"},d.createElement("p",null,"All translations use the standard genetic code."),e.translationSpecs.map(((e,t)=>d.createElement($z,{key:t,translationSpec:e,translationSpecIndex:t})))),d.createElement(Fz.h8,{text:"Select output folder"},d.createElement(Ye.Z,{requireSubfolderCreatableAuth:!0,showInventory:!0,value:e.outputFolderId,onChange:this._handleOutputFolderChange,unsetOnFetchFail:!0})))),d.createElement("div",{className:(0,g.iv)(Wz.errorsAndSummary)},t.length>0&&d.createElement(Fz.X6,{header:"Translation Errors",className:(0,g.iv)(Wz.errors)},d.createElement(components_BulkTranslationErrors,{errors:t})),d.createElement(Fz.X6,{header:"Translation Summary",className:(0,g.iv)(Wz.summary)},d.createElement(zz,{bulkTranslation:e}))))
var n}}const Wz=g.mM.create({errorsAndSummary:{flex:1,overflow:"hidden",flexDirection:"column",display:"flex"},errors:{flex:1,borderRight:"0px"},summary:{flex:3}}),Hz=BulkTranslationEditor
var jz=n(662909),Yz=n(982899)
function _handleCreate(){jz.create()}function BasicFolderItemPreview({name:e,tags:t}){return d.createElement("div",null,d.createElement("p",null,e),d.createElement("div",{className:"u-overflow-x-hidden"},d.createElement(h.Z,null,Object.entries(t).map((([e,t])=>d.createElement(p.Z,{key:e,sm:6},d.createElement(Fz.__,{allCaps:!0},e),d.createElement("span",null,d.createElement(Nv.Z,{value:t.value}))))))))}BasicFolderItemPreview.propTypes={name:J().string.isRequired,tags:J().object.isRequired}
function BulkAntibodySummary({bulkAntibody:e}){if(e.inputFilesLoading)return d.createElement(kl.Z,null)
const t=Yz.tn(e)
return d.createElement("div",null,d.createElement("p",null,t.length," ",de._6(t.length,"antibody","antibodies")," will be created."),d.createElement(Fz.__,null,"Preview"),d.createElement(rc.iA,{numRows:t.length},d.createElement(rc.sg,{renderCell:e=>d.createElement(rc.bL,null,d.createElement(BasicFolderItemPreview,t[e]))})),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,disabled:e.isCreating,text:e.isCreating?"Creating...":"Create",onClick:_handleCreate}))}BulkAntibodySummary.propTypes={bulkAntibody:Mz.Cq.isRequired}
const Qz=BulkAntibodySummary
function BioentityLinkTable({bioentityLinkSpec:e}){return d.createElement(rc.iA,{numRows:e.files.length},d.createElement(rc.sg,{header:e.tagSchemaField.name,renderCell:t=>d.createElement(rc.bL,null,e.files[t].name)}))}class BulkAntibodyEditor extends d.Component{constructor(){super(...arguments)
this._handleTagSchemaChange=e=>{(0,S.hu)(null!=e,"TagSchemaSelector returned null for our tagSchema")
jz.update({tagSchemaId:e.id})}
this._handleOutputFolderChange=e=>{jz.update({outputFolderId:e.target.value})}}render(){const{bulkAntibody:e}=this.props
return d.createElement(Fz.or,null,d.createElement(Fz.X6,null,d.createElement(Fz.Rg,null,d.createElement(Fz.h8,{text:"Create antibody files"},d.createElement(Ke.Z,null,d.createElement(Fz.__,null,"Antibody Schema"),d.createElement(Ho.ZP,{oligoAwareFolderItemTypes:[st.BASIC_FOLDER_ITEM],requiredPermissions:[LN.cr],onChange:this._handleTagSchemaChange,selectedTagSchemaId:e.tagSchemaId})),d.createElement(Ke.Z,null,d.createElement(Fz.__,null,"Antibody Fields"),e.inputFilesLoading?d.createElement("div",null,d.createElement(kl.Z,null)):e.bioentityLinkSpecs.map(((e,t)=>d.createElement(BioentityLinkTable,{key:t,bioentityLinkSpec:e}))))),d.createElement(Fz.h8,{text:"Select output folder"},d.createElement(Ye.Z,{requireSubfolderCreatableAuth:!0,showInventory:!0,value:e.outputFolderId,onChange:this._handleOutputFolderChange,unsetOnFetchFail:!0})))),d.createElement(Fz.X6,{header:"Antibody Summary"},d.createElement(Qz,{bulkAntibody:e})))}}const Kz=BulkAntibodyEditor
var Jz=n(728115)
class BulkAntibodyPageConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Jz.Z,Zz.Z]}enhanceProps(){return{bulkTranslation:this.bulkTranslationStore().getBulkTranslation(),bulkAntibody:this.bulkAntibodyStore().getBulkAntibody()}}}class BulkAntibodyPage extends d.Component{constructor(){super(...arguments)
this._renderEditor=()=>{const{bulkAntibody:e,bulkTranslation:t}=this.props
if(e.step===Mz.h8.BULK_TRANSLATION)return d.createElement(Hz,{bulkTranslation:t});(0,S.hu)(e.step===Mz.h8.BULK_ANTIBODY,`Expected to render \`STEP.BULK_ANTIBODY\`, not ${e.step}`)
return d.createElement(Kz,{bulkAntibody:e})}
this.render=()=>{const{bulkAntibody:e,bulkTranslation:t}=this.props
return d.createElement(Fz.T3,null,d.createElement(Fz.JL,{header:"Bulk Translate DNA to AA and Create Antibodies"},d.createElement(Fz.LY,{isActive:e.step===Mz.h8.BULK_TRANSLATION,onClick:Jt.ZT,hasErrors:!l.default.isEmpty(Bz.FU(t))},"Translate DNA"),d.createElement(Fz.LY,{isActive:e.step===Mz.h8.BULK_ANTIBODY,onClick:Jt.ZT},"Create Antibodies")),this._renderEditor())}}componentDidMount(){BulkTranslationActions_reset()
jz.reset()}}const Xz=BulkAntibodyPageConnector.connect(BulkAntibodyPage)
var e$=n(826242),t$=n(874952),n$=n(838677),a$=n(746312),i$=n(470294)
function NavigationPreviousButton(e){return d.createElement("div",{className:(0,g.iv)(s$.btn)},i$.$q(e.assembly)&&d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MEDIUM,onClick:n$.au,text:"Previous",dataTestAttrs:{component:"SlotEditor",element:"previousButton"}}))}const s$=g.mM.create({btnWrapper:{display:"flex","justify-content":"space-between","flex-wrap":"wrap"},btn:{margin:"5px 1px"}})
function AssemblyRunner({assembly:e}){var t,n,a,i,s,r,o,l,c,u,m,p,h,E,f
const _getUseWorklistChangeHandler=e=>t=>{switch(e){case e$.zY.GIBSON_PRIMERS:(0,n$.ai)(t)
break
case e$.zY.FRAGMENTS:(0,n$.dl)(t)
break
default:(0,n$.l2)(t)}},_getNewOrExistingChangeHandler=e=>t=>{switch(e){case e$.zY.GIBSON_PRIMERS:(0,n$.BA)(t)
break
case e$.zY.FRAGMENTS:(0,n$.LH)(t)
break
default:(0,n$.Ho)(t)}},S=Jn.Z.currentUser().id,_getNewWorklistNameChangeHandler=e=>t=>{switch(e){case e$.zY.GIBSON_PRIMERS:(0,n$.Qe)({name:t.target.value})
break
case e$.zY.FRAGMENTS:(0,n$.N)({name:t.target.value})
break
default:(0,n$.wX)({name:t.target.value})}},_getWorklistIdChangeHandler=e=>t=>{const n=t?t.id:null
switch(e){case e$.zY.GIBSON_PRIMERS:(0,n$.ep)(n)
break
case e$.zY.FRAGMENTS:(0,n$.Cy)(n)
break
default:(0,n$.gK)(n)}},y=0===i$.FU(e).length&&e.meta.state===e$.rs.VALIDATED&&0===i$.h1(e).length,_getFolderChangeHandler=e=>t=>{switch(e){case e$.zY.GIBSON_PRIMERS:(0,n$.KO)(t.target.value)
break
case e$.zY.FRAGMENTS:(0,n$.gY)(t.target.value)
break
default:(0,n$.Eu)(t.target.value)}}
return d.createElement("div",null,d.createElement(Fz.Rg,null,d.createElement(Fz.h8,{text:"Add sequences to a folder and/or worklist"},d.createElement(SaveLocationPicker,{targetFolderId:e.sequenceSaveInformation.targetFolderId,onTargetFolderIdChange:_getFolderChangeHandler(e$.zY.ASSEMBLED_SEQUENCES),useWorklistCheckboxLabel:"Add sequences to a worklist",uniqueId:e$.zY.ASSEMBLED_SEQUENCES,useWorklist:null!=e.sequenceSaveInformation.worklistParams,onUseWorklistChange:_getUseWorklistChangeHandler(e$.zY.ASSEMBLED_SEQUENCES),worklistFormType:null!==(n=null===(t=e.sequenceSaveInformation.worklistParams)||void 0===t?void 0:t.worklistFormType)&&void 0!==n?n:Po.mR.EXISTING,onWorklistFormTypeChange:_getNewOrExistingChangeHandler(e$.zY.ASSEMBLED_SEQUENCES),newWorklistName:null!==(s=null===(i=null===(a=e.sequenceSaveInformation.worklistParams)||void 0===a?void 0:a.newWorklistInfo)||void 0===i?void 0:i.name)&&void 0!==s?s:"",onNewWorklistNameChange:_getNewWorklistNameChangeHandler(e$.zY.ASSEMBLED_SEQUENCES),onWorklistIdChange:_getWorklistIdChangeHandler(e$.zY.ASSEMBLED_SEQUENCES),newWorklistOwnerId:S})),i$.Zu(e)&&d.createElement(d.Fragment,null,d.createElement(Fz.h8,{text:"Add primers to a folder and/or worklist"},d.createElement(SaveLocationPicker,{targetFolderId:e.primerSaveInformation.targetFolderId,onTargetFolderIdChange:_getFolderChangeHandler(e$.zY.GIBSON_PRIMERS),useWorklistCheckboxLabel:"Add primers to a worklist",uniqueId:e$.zY.GIBSON_PRIMERS,useWorklist:null!=e.primerSaveInformation.worklistParams,onUseWorklistChange:_getUseWorklistChangeHandler(e$.zY.GIBSON_PRIMERS),worklistFormType:null!==(o=null===(r=e.primerSaveInformation.worklistParams)||void 0===r?void 0:r.worklistFormType)&&void 0!==o?o:Po.mR.EXISTING,onWorklistFormTypeChange:_getNewOrExistingChangeHandler(e$.zY.GIBSON_PRIMERS),newWorklistName:null!==(u=null===(c=null===(l=e.primerSaveInformation.worklistParams)||void 0===l?void 0:l.newWorklistInfo)||void 0===c?void 0:c.name)&&void 0!==u?u:"",onNewWorklistNameChange:_getNewWorklistNameChangeHandler(e$.zY.GIBSON_PRIMERS),newWorklistOwnerId:S,onWorklistIdChange:_getWorklistIdChangeHandler(e$.zY.GIBSON_PRIMERS)})),d.createElement(Fz.h8,{text:"Add fragments to a folder and/or worklist (optional)"},d.createElement(SaveLocationPicker,{targetFolderId:e.fragmentSaveInformation.targetFolderId,onTargetFolderIdChange:_getFolderChangeHandler(e$.zY.FRAGMENTS),useWorklistCheckboxLabel:"Add fragments to a worklist",uniqueId:e$.zY.FRAGMENTS,useWorklist:null!=e.fragmentSaveInformation.worklistParams,onUseWorklistChange:_getUseWorklistChangeHandler(e$.zY.FRAGMENTS),worklistFormType:null!==(p=null===(m=e.fragmentSaveInformation.worklistParams)||void 0===m?void 0:m.worklistFormType)&&void 0!==p?p:Po.mR.EXISTING,onWorklistFormTypeChange:_getNewOrExistingChangeHandler(e$.zY.FRAGMENTS),newWorklistName:null!==(f=null===(E=null===(h=e.fragmentSaveInformation.worklistParams)||void 0===h?void 0:h.newWorklistInfo)||void 0===E?void 0:E.name)&&void 0!==f?f:"",onNewWorklistNameChange:_getNewWorklistNameChangeHandler(e$.zY.FRAGMENTS),newWorklistOwnerId:S,onWorklistIdChange:_getWorklistIdChangeHandler(e$.zY.FRAGMENTS),required:!1}))),d.createElement("div",{className:(0,g.iv)(r$.helpText)},"Trying to select a schema? Check the top of the page near the topology selector.")),d.createElement("div",{className:(0,g.iv)(s$.btnWrapper)},d.createElement(NavigationPreviousButton,{assembly:e}),d.createElement("div",{className:(0,g.iv)(s$.btn)},d.createElement(C.Co,{disabled:!y,buttonStyle:C.ZJ.PRIMARY,size:C.qE.MEDIUM,onClick:n$.OA,text:"Assemble",dataTestAttrs:{component:"AssemblyRunner",element:"assembleButton"}}))))}AssemblyRunner.propTypes={assembly:e$.Zf.isRequired}
const r$=g.mM.create({helpText:jf.V6}),o$=AssemblyRunner
function ValidationStatus({assembly:e}){return e.meta.state===e$.rs.UNVALIDATED?d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,onClick:n$.Gu,text:"Re-validate"}):null}function AssemblySummary({assembly:e,onOpenPrimerSettings:t}){const n=[...new Set(i$.FU(e))],a=i$.h1(e)
return d.createElement("div",null,n.length>0&&d.createElement(Fz.XO,null,n.map(((e,t)=>d.createElement(Fz.Bc,{key:t},e)))),d.createElement(ValidationStatus,{assembly:e}),i$.Zu(e)&&a.length>0?d.createElement(Fz.Bc,null,`No Gibson primers could be found for ${a.map((t=>e.slots[t].slotParams.name)).join(", ")}. Try adjusting your `,d.createElement(th.Z,{onClick:t},"primer settings"),"."):0===n.length&&e.meta.summary&&d.createElement("div",null,function getSummaryText(e,t){if(i$.Zu(e)&&t.numPrimerPairs)return`${t.numOutputSequences} ${(0,de._6)(t.numOutputSequences,"sequence")} and ${t.numPrimerPairs} primer ${(0,de._6)(t.numPrimerPairs,"pair")} will be created.`;(0,S.Gp)(!i$.Zu(e),"Expected to receive the number of primer pairs in a Gibson assembly.")
return`${t.numOutputSequences} ${(0,de._6)(t.numOutputSequences,"sequence")} will be created.`}(e,e.meta.summary)))}var l$
!function(e){e.tmAnneal="tmAnneal"
e.tmWhole="tmWhole"
e.tmDiff="tmDiff"
e.minOverlap="minOverlap"}(l$||(l$={}))
const c$={tmAnneal:{paramName:"Min. melting temp. for primer's binding bases",paramDescription:"The minimum melting temperature for the primer's binding bases",minValue:-100,maxValue:200},tmWhole:{paramName:"Min. melting temp. for whole primer",paramDescription:"The minimum melting temperature for the whole primer",minValue:-100,maxValue:200},tmDiff:{paramName:"Max. melting temp. difference for primer pair",paramDescription:"The minimum melting temperature difference for the primer pair",minValue:-100,maxValue:200},minOverlap:{paramName:"Length of homology/binding regions",paramDescription:"The minimum length of the homology/binding region",minValue:10,maxValue:100-e$.ZG}}
function findErrors(e){const t={tmAnneal:null,tmWhole:null,tmDiff:null,minOverlap:null}
Object.values(l$).forEach((n=>{null==e[n]&&(t[n]=`${c$[n].paramDescription} must be a valid ${"minOverlap"===n?"integer":"number"} between ${c$[n].minValue} and ${c$[n].maxValue}.`)}))
return t}function InputCell({value:e,onChange:t,units:n,paramKey:a}){return d.createElement("div",{className:(0,g.iv)(d$.cell)},d.createElement(Fr.Z,{label:c$[a].paramName}),d.createElement("div",{className:(0,g.iv)(d$.inputSection)},d.createElement(AT.Z,{min:c$[a].minValue,max:c$[a].maxValue,value:e,className:(0,g.iv)(d$.input),onChange:e=>{t(e.target.numericValue)},required:!0,validateInteger:"minOverlap"===a}),d.createElement("div",{className:(0,g.iv)(d$.inputText)},n)))}function GibsonParametersModal(e){const[t,n]=(0,d.useState)(We.Z.get(eO.BO.GIBSON_PARAMETERS)),{onRequestClose:a,onRequestSubmit:i}=e
return d.createElement(et.ZP,{title:"Gibson Primer Settings",buttons:[{text:"Save",submit:!0,disabled:Object.values(findErrors(t)).some((e=>null!=e))}],onRequestClose:a,onRequestSubmit:()=>{(0,S.hu)(Object.values(t).every((e=>null!=e)),"Expected to receive non-null Gibson parameters.")
We.Z.set(eO.BO.GIBSON_PARAMETERS,{...t,maxOverlap:t.minOverlap+e$.ZG})
i()},large:!0},d.createElement("div",{className:(0,g.iv)(d$.row)},d.createElement(InputCell,{value:t.tmAnneal,onChange:e=>{n({...t,tmAnneal:e})},units:"° C",paramKey:l$.tmAnneal}),d.createElement(InputCell,{value:t.tmWhole,onChange:e=>{n({...t,tmWhole:e})},units:"° C",paramKey:l$.tmWhole})),d.createElement("div",{className:(0,g.iv)(d$.row)},d.createElement(InputCell,{value:t.tmDiff,onChange:e=>{n({...t,tmDiff:e})},units:"° C",paramKey:l$.tmDiff}),d.createElement(InputCell,{value:t.minOverlap,onChange:e=>{n({...t,minOverlap:e})},units:`to ${s=t.minOverlap,null==s?"??":String(s+e$.ZG)} bases`,paramKey:l$.minOverlap})),Object.values(findErrors(t)).filter((e=>null!=e)).map(((e,t)=>d.createElement(ER.Z,{key:t,error:e}))))
var s}const d$=g.mM.create({row:{display:"flex"},cell:{margin:"10px",flex:"5"},inputSection:{display:"flex"},input:{width:"50px",margin:"5px"},inputText:{marginLeft:"0px",marginTop:"auto",marginBottom:"auto"}})
var u$=n(53190)
async function validateSequenceTypes(e,t,n){const a=e.filter((e=>!ea.ZP.isNucleotideSequence(e)))
if(a.length)return{invalidItemIds:a,errorMessage:t}
const i=e.map((e=>(0,T.evaluateSequenceType)(e,(t=>(0,ka.CZ)(t)?{inaccessible:!0,invalid:!0,sequenceId:e}:{inaccessible:!1,invalid:!n(t),sequenceId:e})))),s=(await Promise.all(i)).filter((({inaccessible:e,invalid:t})=>!e&&t))
return s.length?{invalidItemIds:s.map((({sequenceId:e})=>e)),errorMessage:t}:{invalidItemIds:[],errorMessage:null}}async function validateAllDNASequencesOrOligos(e){return await validateSequenceTypes(e,"All items in worklist must be DNA sequences or oligos. RNA sequences and oligos are not supported.",(e=>e.nucleotideType===Sn.Wy.DNA))}var m$=n(136834),p$=n(42111)
const h$=[{key:Kn.Vm.TYPES,operator:Kn.EF.IS_ONE_OF,value:[st.FOLDER,st.SEQUENCE]},{key:Kn.Vm.ARCHIVE_PURPOSES,operator:Kn.EF.IS_ONE_OF,value:[zu.BH]}],makeFolderFilter=e=>({key:Kn.Vm.FOLDER,operator:Kn.EF.IS,value:e}),SearchableBySequenceFileTree=e=>{const[t,n]=(0,d.useState)(""),a=(0,d.useMemo)((()=>(0,Jt.Pe)(Uz.P7(e.folders),(e=>e.id))),[e.folders]),[i,s]=(0,d.useState)((()=>(0,p$.H9)(Uz.P7(e.folders).filter((e=>!e.parentId))))),[r,o]=(0,d.useState)(),l=(0,d.useCallback)((()=>{const t={}
e.folders.forEach((e=>{t[e.api_identifier]={baseLeafItems:[],childItems:[],isExpanded:!1,leafItems:[],loading:!1,more:!0,offset:0}}))
e.folders.forEach((e=>{var n;(null===(n=e.parent)||void 0===n?void 0:n.api_identifier)&&t[e.parent.api_identifier].childItems.push(a[e.api_identifier])}))
return t}),[e.folders,a]),[c,u]=(0,d.useState)(l),[m,p]=(0,d.useState)([]),[h,g]=(0,d.useState)(0),[E,f]=(0,d.useState)(!1),[S,y]=(0,d.useState)(0),b=(0,d.useCallback)(((t,n,i)=>{const handleSearchResponse=t=>{g(i+e.fetchLimit)
f(i+e.fetchLimit<t.total)
const r=Object.keys(a)
Object.keys(t.foldersById).filter((e=>!r.includes(e))).forEach((e=>{ze.Z.invalidateFolder(e)}))
const o=t.ids.map((e=>ea.ZP.isNucleotideSequence(e)?Uz.vE(t.fileSummariesById[e]):a[e]))
s([...n,...o.filter((e=>e))])}
if(r&&r[1]===t){handleSearchResponse(r[0])
return Jt.ZT}const l={offset:i,limit:e.fetchLimit,sorts:[{key:Kn.bo.SORT_MODIFIED_AT_KEY,reverse:!0}],filters:[...h$],query:t}
y((e=>e+1))
const{promise:c,cancel:d}=(0,V_.Z)(qz.k(l,Kn.Sc.GLOBAL));(async()=>{try{const e=await c
o([e,t])
handleSearchResponse(e)}catch(e){if(!e.isCanceled)throw e}finally{y((e=>e-1))}})()
return d}),[r,e.fetchLimit,a]);(0,d.useEffect)((()=>{u(l())}),[l]);(0,gA.Z)((()=>{let e=Jt.ZT
if(!t||t.length>=3){s([])
g(0)
f(!0)
e=b(t,[],0)}return()=>{e()}}),[t,b])
const loadMoreFromIds=(t,n=c)=>{const i={...n},s=t.map((e=>({id:e,oldItemState:n[e]}))).filter((({id:e,oldItemState:t})=>t&&t.isExpanded&&t.more)).map((({id:t,oldItemState:n})=>{i[t].loading=!0
const a={offset:n.offset,limit:e.fetchLimit,sorts:[{key:Kn.bo.SORT_MODIFIED_AT_KEY,reverse:!0}],filters:[...h$,makeFolderFilter(t)],query:""}
return qz.k(a,Kn.Sc.GLOBAL).then((e=>({folderId:t,searchResponse:e})))}))
u(i)
Promise.allSettled(s).then((t=>{t.forEach((t=>{const{folderId:n,searchResponse:s}=t.value
i[n].loading=!1
i[n].more=i[n].offset+e.fetchLimit<s.total
i[n].offset+=e.fetchLimit
s.ids.forEach((e=>{if(ea.ZP.isNucleotideSequence(e))i[n].leafItems.push(Uz.vE(s.fileSummariesById[e]))
else if(!i[n].childItems.some((t=>t.id===e))){i[n].childItems.push(a[e])
i[e]={baseLeafItems:[],childItems:[],isExpanded:!1,leafItems:[],loading:!1,more:!0,offset:0}}}))}))
u({...i})}))}
return d.createElement("div",null,d.createElement(or.Z,{disabled:!1,onChange:e=>{n(e.target.value)},value:t}),t&&t.length<3?d.createElement("div",null,"Please enter a query with at least 3 characters."):d.createElement(m$.Z,{allowNone:!1,canLoadMore:()=>!0,moreRootItems:E,clickedItems:m,handleClickedItemsChange:e=>{p([...m,e])},hasQuery:!1,itemTypeName:"sequences",itemStateMap:c,isLoadingRootItems:S>0,loadMoreFromIds,multiple:!0,onChangeSelectedIds:e.onChangeSelectedIds,onLoadMoreRootItems:()=>{b(t,i,h)},rootItems:i,selectAllText:"All sequences",selectedIds:e.selectedIds,toggleExpanded:e=>{const t=!c[e].isExpanded,n={...c}
n[e].isExpanded=t
u(n)
t&&c[e].more&&0===c[e].childItems.filter((e=>ea.ZP.isNucleotideSequence(e.id))).length&&loadMoreFromIds([e],n)}}))}
function SearchableBySequenceFileTreeWrapper(e){return d.createElement(Gz,{folderFilter:{...e$.Qn,showNotebook:!0}},(t=>t?d.createElement(SearchableBySequenceFileTree,{folders:t,...e}):d.createElement("div",{className:"u-small-padding-bottom text-center"},d.createElement(kl.Z,null))))}function OtherSlotSource({assembly:e,dataSourceId:t,handleDataSourceChange:n,otherSlotIndices:a,slotIdx:i}){return d.createElement("select",{value:t,onChange:n},a.length?d.createElement("option",{value:g$},"Unlink"):d.createElement("option",{value:t,disabled:!0},"Link To..."),e.dataSources.map((t=>{const n=i$.Ap(e,t,i)
if(0===n.length)return null
const a=(0,Mt.Dw)(n.map((t=>i$.Nc(e,t))))
return d.createElement("option",{key:t.id,value:t.id},a)})))}function WorklistSource({fileIds:e,onUpdateFileIds:t}){return d.createElement("div",{className:(0,g.iv)(f$.worklistSource)},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:e.length?"Select different worklist":"Select worklist",onClick:async()=>{const e=await(0,u$.Z)([Po.FN.BIOENTITY],Po.Wb.BULK_ASSEMBLY,validateAllDNASequencesOrOligos)
e&&t(e.itemIds)},dataTestAttrs:{component:"DataSourceSelector",element:"selectWorklistButton"}}),d.createElement("div",{className:(0,g.iv)(f$.chipList)},e.map((n=>d.createElement(sc.Z,{key:n,id:n,size:Za.TK.MINI,className:(0,g.iv)(f$.chip),onClick:()=>{},onRemove:()=>{t(e.filter((e=>e!==n)))}})))))}const g$="UNLINK"
const E$=function DataSourceSelector({assembly:e,slotIdx:t}){const n=i$.Xn(e,t),a=i$.Ap(e,n,t),i=i$.Rb(e,a),s=(0,Mt.hx)(l.default.countBy(n.fileIds,(e=>ea.ZP.isFolder(e)?"folder":"file")))
return d.createElement("div",{...(0,ee.Z)({component:"DataSourceSelector",element:"root"})},d.createElement("div",{className:(0,g.iv)(f$.selectedFilesSummary)},d.createElement("div",{className:(0,g.iv)(f$.bold)},"Files for ",i$.Nc(e,t)),d.createElement("div",{className:(0,g.iv)(f$.grey)},d.createElement("span",null,s||"No files"),a.length>0&&d.createElement("span",null," shared with ",i))),d.createElement(sp.Xl,{activeTab:e.slots[t].dataSourceType,onRequestTabChange:e=>{n$.HF(t,e)}},d.createElement(sp.OK,{tabKey:e$.ye.FOLDERS,title:"Folders"},d.createElement(SearchableBySequenceFileTreeWrapper,{key:n.id,selectedIds:n.fileIds,onChangeSelectedIds:e=>{n$.oe(n.id,{fileIds:e})},fetchLimit:20})),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement(sp.OK,{tabKey:e$.ye.WORKLIST,title:"Worklist"},d.createElement(WorklistSource,{fileIds:n.fileIds,onUpdateFileIds:e=>{n$.oe(n.id,{fileIds:e})}})),d.createElement(sp.OK,{tabKey:e$.ye.OTHER_SLOT,title:"Another step"},d.createElement(OtherSlotSource,{assembly:e,dataSourceId:n.id,handleDataSourceChange:e=>{const n=e.target.value
n===g$?n$.HF(t,e$.ye.OTHER_SLOT):n$.R6(t,n)},otherSlotIndices:a,slotIdx:t}))))},f$=g.mM.create({worklistSource:{display:"flex",flexDirection:"column"},chipList:{paddingTop:"5px"},chip:{margin:"3px"},selectedFilesSummary:{padding:"8px 0"},bold:{fontWeight:600},grey:{color:Vt.pp}})
var S$=n(891728)
const y$=[3e3,2500,2e3,1500,1e3,500,100],components_HomologyDetectionModal=e=>{const{assembly:t,onRequestClose:n,onRequestSubmit:a,slotIdx:i}=e,[s,r]=(0,d.useState)(3e3),[o,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)(!1),[p,h]=(0,d.useState)([]),[E,f]=(0,d.useState)(null),[S,y]=(0,d.useState)(null),b=(0,i$.ER)(t,i),T=(0,i$.AN)(t,i),v=((e,t,n)=>Array.from(new Set([(0,i$.i3)(e,t)&&t,(0,i$.i3)(e,n)&&n].filter((e=>!1!==e)))))(t,b,T),I=v[0],[A,R]=(0,d.useState)(I);(0,d.useEffect)((()=>{l(!0)
y(null);(0,S$.HC)(t,{slot1Index:i,slot2Index:A,maxRegionLength:s}).then((({bases:e,basesSecondary:t})=>{const n=[]
e&&n.push(e)
t&&n.push(t)
1===n.length?f(n[0]):f(null)
h(n)})).catch((e=>{y(e.userMessage)})).finally((()=>{l(!1)
c?(0,m.KK)(j.Jg.RETRIED_HOMOLOGY_DETECTION):u(!0)}))}),[t,s,A,i])
return d.createElement(et.ZP,{title:"Detect Homology Region",onRequestSubmit:()=>{a(E)},onRequestClose:n,buttons:[{text:"Cancel",cancel:!0,disabled:!1},{text:"Select",submit:!0,disabled:null!=S||o||null===A||null==E,dataTestAttrs:{component:"HomologyDetectionModal",element:"footerButton",key:vb.Z.SUBMIT}}],dataTestAttrs:{component:"HomologyDetectionModal",element:"root"}},v.length>1&&d.createElement("div",{className:"u-flex-display u-vertical-flex u-spacing-bottom"},d.createElement(Fr.Z,{className:"u-small-spacing-bottom",label:"Target Slot"}),d.createElement(kt.Z,{options:[{id:b,buttonProps:{text:(0,i$.Nc)(t,b)}},{id:T,buttonProps:{text:(0,i$.Nc)(t,T)}}],selection:A,onChangeSelection:R,size:C.qE.MEDIUM})),d.createElement("div",{className:"u-flex-display u-vertical-flex u-spacing-bottom"},d.createElement(Fr.Z,{className:"u-small-spacing-bottom",label:"Homology Region Length"}),d.createElement("div",{className:(0,g.iv)(b$.range)},d.createElement($r.ZP,{disabled:o,displayName:`Under ${s} bases`,menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL,value:s},y$.map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:r},`Under ${e} bases`))))}))),d.createElement("hr",null),o?d.createElement(kl.Z,null):null!=S?d.createElement(ER.Z,{error:S}):p.length>0?d.createElement(mm.Z,{options:p.map((e=>({label:d.createElement("span",{className:(0,g.iv)(b$.span)},e),value:e}))),onChange:f,selectedValue:E,title:"Result(s)",isVertical:!0}):"No valid homology regions found.")},b$=g.mM.create({range:{display:"inline"},numericInput:{width:"50px"},span:{wordBreak:"break-word",whiteSpace:"normal"}}),components_DetectHomologyButton=e=>{const{assembly:t,changeBases:n,slotIdx:a}=e,i=(0,i$.i3)(t,a)&&((0,i$.i3)(t,(0,i$.AN)(t,a))||(0,i$.i3)(t,(0,i$.ER)(t,a)))
return d.createElement(P.ZP,{title:i?"Detect":"To use automatic homology detection, you must select input sequences for both the current step and an adjacent step"},d.createElement(pe.Z,{dataTestAttrs:{component:"DetectHomologyButton",element:"root"},className:(0,g.iv)(T$.detectIcon,!i&&T$.detectIconDisabled),icon:"detect",onClick:async()=>{if(!i)return
const e=await(0,Xn.Z)(components_HomologyDetectionModal,{assembly:t,slotIdx:a})
e&&n(e)}}))},T$=g.mM.create({detectIcon:{position:"absolute",right:"8px",top:"8px",cursor:"pointer"},detectIconDisabled:{color:Vt.TG,cursor:"default"}})
function EndpointTypeDropdown({getEndpoint:e,handleEndpointTypeChange:t,index:n}){return d.createElement($r.ZP,{displayName:e$.wI[e(n).type],menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},Object.keys(e$.KP).filter((e=>e!==e$.KP.GIBSON||dt.ZP.MOLBIO_ENABLE_BULK_GIBSON_ASSEMBLY)).map((e=>d.createElement(N.Z,{key:e,value:e,onSelect:e=>{t(n,e)},dataTestAttrs:{component:"EndpointTypeDropdown",key:`${e}`}},d.createElement("div",{className:(0,g.iv)(v$.optionContainer)},d.createElement("div",{className:(0,g.iv)(v$.icon)},d.createElement(pe.Z,{icon:e$.gz[e]})),d.createElement("div",{className:(0,g.iv)(v$.text)},d.createElement("p",{className:(0,g.iv)(v$.header)},e$.wI[e]),d.createElement("p",{className:(0,g.iv)(v$.description)},e$.Q5[e])))))))})}const v$=g.mM.create({optionContainer:{display:"flex"},icon:{flex:1,verticalAlign:"middle",margin:"auto",color:Vt.pp},header:{fontWeight:800,marginBottom:"0px"},description:{color:Vt.pF,marginBottom:"0px"},text:{flex:10,marginLeft:"16px"}})
function PositionalEndpointOptions({endpoint:e,handlePositionalEndpointChange:t}){return d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-optionsContainer"},d.createElement("div",{className:"radio"},d.createElement("label",null,d.createElement("input",{type:"radio",checked:null!=e.position,onChange:()=>{t({position:0})}}),"Start / end of sequence")),d.createElement("div",{className:"u-vertical-center-items radio"},d.createElement("label",null,d.createElement("input",{type:"radio",checked:null!=e.bases,onChange:()=>{t({bases:""})}}),"Search for bases:"),d.createElement("input",{type:"text",className:"u-flex-grow u-small-spacing-left",onChange:e=>{t({bases:e.target.value})},value:e.bases||""})))}const C$=function GibsonSlotEndpoint({endpoint:e,onEndpointChange:t,onOpenPrimerSettings:n}){return d.createElement("div",null,d.createElement(PositionalEndpointOptions,{endpoint:e,handlePositionalEndpointChange:e=>{t(e)}}),d.createElement(th.Z,{onClick:n},"Primer settings"))},I$="LARGE",w$="SMALL",N$="FORWARD",A$="REVERSE"
class SlotEditor extends d.Component{constructor(){super(...arguments)
this._handleRemoveClick=()=>{n$.ac(this.props.slotIdx)}
this._handleFragmentReverseChange=e=>{n$.Af(this.props.slotIdx,{useReverse:e.target.value===A$})}
this._handleFragmentSizeChange=e=>{n$.Af(this.props.slotIdx,{useLargerFragment:e.target.value===I$})}}_getEndpoint(e){return this._getSlot().slotParams.endpoints[e]}_getSchemaField(){if(!this.props.assembly.tagSchemaId||!this._getSlot().slotParams.schemaFieldId)return null
const e=JZ.Z.getTagSchemaById(this.props.assembly.tagSchemaId).fields,t=l.default.filter(e,(e=>e.apiId===this._getSlot().slotParams.schemaFieldId));(0,S.Gp)(1===t.length,`Could not find schema field with ID ${this._getSlot().slotParams.schemaFieldId}`)
return t[0]}_getSlot(){return this.props.assembly.slots[this.props.slotIdx]}_handleEnzymeEndpointChange(e,{enzymeId:t}){const n=this._getEndpoint(e)
this._updateEndpoint(e,{...n,enzymeId:t})}_handleHomologyEndpointChange(e,{bases:t}){const n=this._getEndpoint(e)
this._updateEndpoint(e,{...n,bases:t})}_handlePositionalEndpointChange(e,t){const n=this._getEndpoint(e)
this._updateEndpoint(e,{...n,position:null,bases:null,...t})}_handleGibsonEndpointChange(e,t){const n=this._getEndpoint(e)
this._updateEndpoint(e,{...n,position:null,bases:null,...t})}_handleEndpointTypeChange(e,t){this._updateEndpoint(e,i$.bO(t))}_handleSchemaFieldChange(e){n$.Af(this.props.slotIdx,{schemaFieldId:e})}_createSchemaFieldSelectDropdown(e){const t="Select a schema field..."
return d.createElement($r.ZP,{displayName:this._getSchemaField()?this._getSchemaField().name:t,menu:d.createElement(w.ZP,{scrollable:!0,isMulti:!1,height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},d.createElement(N.Z,{key:"none",value:null,onSelect:()=>{this._handleSchemaFieldChange(null)}},t),e.map((e=>d.createElement(N.Z,{key:e.apiId,value:e.apiId,onSelect:e=>{this._handleSchemaFieldChange(e)}},e.name))))})}_renderEnzymeSuggestions(e){const t=i$.MC(this.props.assembly,this.props.slotIdx,e)
return 0===t.length?null:d.createElement("div",null,"Currently used:"," ",t.map((({enzymeId:t,slotName:n},a)=>d.createElement(d.Fragment,{key:t},a>0&&", ",d.createElement(P.ZP,{title:n},d.createElement("a",{onClick:()=>{this._handleEnzymeEndpointChange(e,{enzymeId:t})}},xe.Rt(t).name))))))}_renderEnzymeEndpoint(e){var t
const n=this._getEndpoint(e)
return d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field",...(0,ee.Z)({component:"SlotEditor",element:"enzymeSelector"})},d.createElement(Fr.Z,{label:"Enzyme"}),d.createElement(ex.L,{allowedRestrictionEnzymeIds:te.ZP.enzymes.filter((e=>!xe.UG(e))).map((e=>e.id)),restrictionEnzymeId:null!==(t=n.enzymeId)&&void 0!==t?t:te.kA,updateRestrictionEnzymeId:t=>{this._handleEnzymeEndpointChange(e,{enzymeId:t})},shouldAllowNull:!1,isDisabled:!1}),this._renderEnzymeSuggestions(e))}_renderHomologyBaseSuggestions(e){const t=i$.Qm(this.props.assembly,this.props.slotIdx,e)
return 0===t.length?null:d.createElement("div",null,"Currently used:"," ",t.map((({bases:t,slotName:n},a)=>d.createElement(d.Fragment,{key:t},a>0&&", ",d.createElement(P.ZP,{title:n},d.createElement("a",{onClick:()=>{this._handleHomologyEndpointChange(e,{bases:t})},...(0,ee.Z)({component:"SlotEditor",element:"homologyRegionSuggestion"})},t))))))}_renderHomologyEndpoint(e){const{assembly:t,slotIdx:n}=this.props,a=this._getEndpoint(e)
return d.createElement(d.Fragment,null,d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field"},d.createElement("label",null,"Bases"),d.createElement("div",{className:"u-position-relative"},d.createElement("input",{type:"text",onChange:t=>{this._handleHomologyEndpointChange(e,{bases:t.target.value})},value:a.bases}),0===a.bases.length&&d.createElement(components_DetectHomologyButton,{assembly:t,slotIdx:n,changeBases:t=>{this._handleHomologyEndpointChange(e,{bases:t})}})),this._renderHomologyBaseSuggestions(e)))}_renderConcatenationEndpoint(e){const t=this._getEndpoint(e)
return d.createElement(PositionalEndpointOptions,{endpoint:t,handlePositionalEndpointChange:t=>{this._handlePositionalEndpointChange(e,t)}})}_renderGibsonEndpoint(e){const t=this._getEndpoint(e)
return d.createElement(C$,{endpoint:t,onEndpointChange:t=>{this._handleGibsonEndpointChange(e,t)},onOpenPrimerSettings:this.props.onOpenPrimerSettings})}_renderEndpointWithType(e){switch(this._getEndpoint(e).type){case e$.KP.ENZYME:return this._renderEnzymeEndpoint(e)
case e$.KP.HOMOLOGY:return this._renderHomologyEndpoint(e)
case e$.KP.CONCATENATION:return this._renderConcatenationEndpoint(e)
case e$.KP.GIBSON:return this._renderGibsonEndpoint(e)
default:throw new Error("Unexpected endpoint type")}}_renderEndpoint(e){return d.createElement("div",{className:"u-vertical-stretch"},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field",...(0,ee.Z)({component:"SlotEditor",element:"endpointTypeField"})},d.createElement("label",null,"Type"),d.createElement(EndpointTypeDropdown,{getEndpoint:e=>this._getEndpoint(e),handleEndpointTypeChange:(e,t)=>{this._handleEndpointTypeChange(e,t)},index:e})),this._renderEndpointWithType(e))}_updateEndpoint(e,t){const n=this._getSlot()
0===e?n$.Af(this.props.slotIdx,{endpoints:[t,n.slotParams.endpoints[1]]}):n$.Af(this.props.slotIdx,{endpoints:[n.slotParams.endpoints[0],t]})}render(){var e
const t=this._getSlot(),n=this.props.assembly.tagSchemaId?null===(e=JZ.Z.getTagSchemaById(this.props.assembly.tagSchemaId))||void 0===e?void 0:e.fields.filter((e=>!e.isComputed&&null!=e.requiredLink&&((0,Hn.isRequiredLinkTagSchema)(e.requiredLink)?null!=e.requiredLink.tagSchema&&"sequence"===e.requiredLink.tagSchema.folderItemType:!!(0,Hn.isRequiredLinkFolderItemType)(e.requiredLink)&&"sequence"===e.requiredLink.folderItemType))):[]
return d.createElement("div",null,d.createElement(Fz.Rg,null,d.createElement(Fz.h8,{text:"Select files to work with"},d.createElement(E$,{assembly:this.props.assembly,slotIdx:this.props.slotIdx})),n&&n.length>0&&d.createElement(Fz.h8,{text:"Select a schema field that this sequence fills (optional)"},this._createSchemaFieldSelectDropdown(n),d.createElement("div",{className:(0,g.iv)(P$.helpText)},"Part link fields are not included here. To use part link fields, use the Autofill Parts feature after bulk assembling sequences.")),d.createElement(Fz.h8,{text:"Select fragment direction"},d.createElement("div",{className:"u-flex-display",...(0,ee.Z)({component:"SlotEditor",element:"fragmentDirection"})},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field"},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-fragment radio",...(0,ee.Z)({component:"SlotEditor",element:"fragmentDirectionOption",key:"forward"})},d.createElement("label",null,d.createElement("input",{type:"radio",checked:!t.slotParams.useReverse,value:N$,onChange:this._handleFragmentReverseChange,...(0,ee.Z)({component:"SlotEditor",element:"fragmentDirectionOptionRadio"})}),"Forward"))),d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field"},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-fragment radio",...(0,ee.Z)({component:"SlotEditor",element:"fragmentDirectionOption",key:"reverse"})},d.createElement("label",null,d.createElement("input",{type:"radio",checked:t.slotParams.useReverse,value:A$,onChange:this._handleFragmentReverseChange,...(0,ee.Z)({component:"SlotEditor",element:"fragmentDirectionOptionRadio"})}),"Reverse"))))),d.createElement(Fz.h8,{text:"Select fragment end #1"},this._renderEndpoint(0)),d.createElement(Fz.h8,{text:"Select fragment end #2"},this._renderEndpoint(1)),d.createElement(Fz.h8,{text:"Select fragment size"},d.createElement("div",{className:"u-flex-display",...(0,ee.Z)({component:"SlotEditor",element:"fragmentSize"})},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field"},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-fragment radio",...(0,ee.Z)({component:"SlotEditor",element:"fragmentSizeOption",key:"large"})},d.createElement("label",null,d.createElement("input",{type:"radio",checked:t.slotParams.useLargerFragment,value:I$,onChange:this._handleFragmentSizeChange,...(0,ee.Z)({component:"SlotEditor",element:"fragmentSizeOptionRadio"})}),"Larger"))),d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-endpoint-field",...(0,ee.Z)({component:"SlotEditor",element:"fragmentSizeOption",key:"small"})},d.createElement("div",{className:"bulkAssemblyEditor-slotEditor-fragment radio"},d.createElement("label",null,d.createElement("input",{type:"radio",checked:!t.slotParams.useLargerFragment,value:w$,onChange:this._handleFragmentSizeChange,...(0,ee.Z)({component:"SlotEditor",element:"fragmentSizeOptionRadio"})}),"Smaller")))))),d.createElement("div",{className:(0,g.iv)(s$.btnWrapper)},d.createElement(NavigationPreviousButton,{assembly:this.props.assembly}),d.createElement("div",{className:(0,g.iv)(s$.btn)},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,onClick:n$.k2,text:"Next",dataTestAttrs:{component:"SlotEditor",element:"nextButton"}}))))}}SlotEditor.propTypes={assembly:e$.Zf.isRequired,slotIdx:J().number.isRequired}
const R$=SlotEditor,P$=g.mM.create({helpText:{color:Vt.pF}})
function GibsonPrimerSummary(e){var t
const{assembly:n,onOpenPrimerSettings:a,slotIdx:i}=e
if(!(0,i$.Zu)(n)||!n.meta.summary)return null
switch(null===(t=n.meta.summary.slots[i])||void 0===t?void 0:t.gibsonStatus){case e$.ni.UNFINALIZED:return null
case e$.ni.SUCCESS:return d.createElement("div",{className:(0,g.iv)(O$.messageContainer)},d.createElement(Fz.kk,null,"Gibson primers have been finalized for this slot."))
case e$.ni.PENDING_ADJACENT:return d.createElement("div",{className:(0,g.iv)(O$.messageContainer)},d.createElement(Fz.v3,null,"The validation of Gibson primers is pending the finalization of adjacent slot(s)."))
case e$.ni.FAILURE:return d.createElement("div",{className:(0,g.iv)(O$.messageContainer)},d.createElement(Fz.Bc,null,"No Gibson primers could be found. Try adjusting your"," ",d.createElement(th.Z,{onClick:a},"primer settings"),"."))
default:return null}}const O$=g.mM.create({messageContainer:{marginBottom:"10px"}}),x$="STICKY",_$="OVERLAP"
function getRightHeaderContents(e){return e===x$?"Right Sticky":e===_$?"Right Overlap":null}function SlotSummary({assembly:e,slotIdx:t,onOpenPrimerSettings:n}){const a=i$.Uo(e,t),i=e.meta.summary&&e.meta.summary.slots[t],s=i?function getLeftType(e){for(const t of e){if(t.fivePrimeSticky)return x$
if(t.fivePrimeOverlap)return _$}return null}(i.sequences):null,r=i?function getRightType(e){for(const t of e){if(t.threePrimeSticky)return x$
if(t.threePrimeOverlap)return _$}return null}(i.sequences):null,o=i?i.warnings:[]
return d.createElement("div",null,a.length>0&&d.createElement(Fz.XO,null,a.map(((e,t)=>d.createElement(Fz.Bc,{key:t},e)))),o.length>0&&d.createElement(Fz.YI,null,e$.v4,o.map(((e,t)=>d.createElement(Fz.v3,{key:t},e)))),d.createElement(GibsonPrimerSummary,{assembly:e,slotIdx:t,onOpenPrimerSettings:n}),d.createElement(ValidationStatus,{assembly:e}),i&&i.sequences.length>0&&d.createElement("div",{className:"bulkAssemblyEditor-slotSummary-tableWrapper"},d.createElement(rc.iA,{numRows:i.sequences.length},d.createElement(rc.sg,{header:d.createElement(rc.bL,null,"Sequence"),renderCell:e=>d.createElement(rc.bL,null,i.sequences[e].name)}),d.createElement(rc.sg,{header:d.createElement(rc.bL,{className:"bulkAssemblyEditor-slotSummary-fragmentCell u-overflow-wrap-break-word"},"Fragment"),renderCell:n=>d.createElement(rc.bL,{className:"bulkAssemblyEditor-slotSummary-fragmentCell u-overflow-wrap-break-word"},function renderSequenceVisualization(e,t){return d.createElement(d.Fragment,null,e.fivePrimeDisplayInfo&&e.threePrimeDisplayInfo&&d.createElement(tx.Z,{sequence:{start:e.start,end:e.end,sequenceLength:e.sequenceLength,strand:e.strand,circular:e.circular,fivePrimeDisplayInfo:e.fivePrimeDisplayInfo,threePrimeDisplayInfo:e.threePrimeDisplayInfo},fragmentColor:t}),e.error&&d.createElement("span",{className:"text-danger"},e.error))}(i.sequences[n],i$.kO(e,t)))}),d.createElement(rc.sg,{header:d.createElement(rc.bL,null,(l=s,l===x$?"Left Sticky":l===_$?"Left Overlap":null)),renderCell:e=>d.createElement(rc.bL,null,function getLeftCellContents(e,t){return t===x$?e.fivePrimeSticky:t===_$?e.fivePrimeOverlap:null}(i.sequences[e],s))}),d.createElement(rc.sg,{header:d.createElement(rc.bL,null,"Length"),renderCell:e=>d.createElement(rc.bL,null,i.sequences[e].length)}),d.createElement(rc.sg,{header:d.createElement(rc.bL,null,getRightHeaderContents(r)),renderCell:e=>d.createElement(rc.bL,null,function getRightCellContents(e,t){return t===x$?e.threePrimeSticky:t===_$?e.threePrimeOverlap:null}(i.sequences[e],r))}))))
var l}SlotSummary.propTypes={assembly:J().object.isRequired,slotIdx:J().number.isRequired}
class BulkAssemblyEditorConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[a$.Z]}enhanceProps(){return{assembly:this.bulkAssemblyStore().getAssembly()}}}class BulkAssemblyEditor extends d.Component{componentDidMount(){n$.mc()
m.KK(j.Jg.OPENED_BULK_ASSEMBLY)}_handleSetTopology(e){n$.DQ(e)}_handleResetClick(){n$.mc()}_handleAddClick(){n$.ii()}_handleFinalizeClick(){n$.bU(e$.Dq)}_handleSlotClick(e,t){n$.bU(t)}getSummaryThrobber(){return this.props.assembly.meta.state===e$.rs.VALIDATING?d.createElement("span",{className:"u-spacing-left"},d.createElement(kl.Z,null)):null}getSummaryHeader(){const e=this.props.assembly
return d.createElement("div",null,`${i$.Nc(e,e.meta.activeSlotIndex)} Summary`,this.getSummaryThrobber())}_handleDeleteClick(e,t){n$.ac(t)}_handleTagSchemaChange(e){(!e||this.props.assembly.tagSchemaId&&e.id!==this.props.assembly.tagSchemaId)&&n$.Em()
n$.lV(e?e.id:null)}async _openGibsonParameters(e){await(0,Xn.Z)(GibsonParametersModal,{})
n$.Gu()}render(){const{assembly:e}=this.props,{activeSlotIndex:t}=e.meta,n=e.slots[t],a=i$.FU(e).length>0,i=e$.fC.includes(e.meta.state)
return d.createElement(Fz.T3,{className:f()({"u-half-opacity u-no-mouse-target":i}),...(0,ee.Z)({component:"BulkAssemblyEditor",element:"root"})},d.createElement(Fz.JL,{header:"Bulk Assemble DNA",headerOptions:d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(D$.headerOption)},d.createElement(kt.Z,{options:[{id:fn.JH.CIRCULAR,buttonProps:{text:"Circular"}},{id:fn.JH.LINEAR,buttonProps:{text:"Linear"}}],selection:e.topology,onChangeSelection:e=>{this._handleSetTopology(e)},size:C.qE.SMALL})),d.createElement("div",{className:(0,g.iv)(D$.headerOption)},d.createElement(Fr.Z,{label:"Schema (optional)",isRequired:!1,className:(0,g.iv)(D$.schema)}),d.createElement("div",{className:(0,g.iv)(D$.tagSchemaSelector,D$.schema)},d.createElement(Ho.ZP,{allowNone:!0,oligoAwareFolderItemTypes:[st.SequenceSubtype.SEQUENCE],selectedTagSchemaId:e.tagSchemaId,requiredPermissions:[LN.cr],onChange:e=>{this._handleTagSchemaChange(e)}})))),banner:dt.ZP.MOLBIO_REDESIGNED_CLONING_FLOW?d.createElement("div",{className:(0,g.iv)(D$.headerBanner)},d.createElement(t$.Ku,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY,text:d.createElement("span",null,"Trying to perform Gibson, Golden Gate, or homology assembly? If so,"," ",d.createElement("a",{onClick:()=>{m.L9(j.Jg.CLICKED_REDESIGNED_BULK_ASSEMBLY_LINK,{actionOrigin:j.D2.MOLBIO_BULK_ASSEMBLY});(0,rO.SN)({previousTool:eO.cH.LEGACY_BULK_ASSEMBLY},j.D2.MOLBIO_BULK_ASSEMBLY)},...(0,ee.Z)({component:"BulkAssemblyBanner",element:"newAssemblyLink"})},"try the new tool here"),".")})):d.createElement(d.Fragment,null)},e.slots.map(((n,a)=>{const i=t===a,s=i$.Nc(e,a),r=i$.Uo(e,a).length>0,o=0!==a
return d.createElement(Fz.LY,{key:a,id:a,isActive:i,onClick:(e,t)=>{this._handleSlotClick(e,t)},hasErrors:r,onDelete:o?(e,t)=>{this._handleDeleteClick(e,t)}:void 0},s)})),d.createElement("div",{className:f()("bulkWorkflow-nav-item",(0,g.iv)(D$.addSlotWrapper)),onClick:()=>{this._handleAddClick()}},d.createElement(pe.Z,{icon:"search-filter-add",className:(0,g.iv)(D$.addSlotPlus)})),d.createElement(Fz.LY,{isActive:t===e$.Dq,onClick:()=>{this._handleFinalizeClick()},hasErrors:a},"Finalize")),n?d.createElement(Fz.or,null,d.createElement(Fz.X6,{className:"bulkWorkflow-pane--narrow"},d.createElement(R$,{assembly:e,slotIdx:t,onOpenPrimerSettings:()=>{this._openGibsonParameters(e)}})),d.createElement(Fz.X6,{header:this.getSummaryHeader()},d.createElement(SlotSummary,{assembly:e,slotIdx:t,onOpenPrimerSettings:()=>{this._openGibsonParameters(e)}}))):d.createElement(Fz.or,null,d.createElement(Fz.X6,{className:"bulkWorkflow-pane--narrow"},d.createElement(o$,{assembly:e})),d.createElement(Fz.X6,{header:d.createElement("div",null,"Assembly Summary",this.getSummaryThrobber())},d.createElement(AssemblySummary,{assembly:e,onOpenPrimerSettings:()=>{this._openGibsonParameters(e)}}))))}}const D$=g.mM.create({addSlotWrapper:{"-webkit-border-radius":"40px","-moz-border-radius":"40px","border-radius":"40px","background-color":Vt.Cj,border:`1px dashed ${Vt.pF}`,"font-size":"32px",height:"80px",width:"80px",":hover":{border:`1px solid ${Vt.t0}`},":hover span":{color:Vt.t0}},addSlotPlus:{margin:"6px 14px",color:Vt.pF},headerOption:{display:"inline-block",verticalAlign:"top",paddingRight:"15px"},headerBanner:{marginBottom:"16px"},schema:{display:"inline-block",paddingRight:"15px"},tagSchemaSelector:{width:"250px"}}),L$=BulkAssemblyEditorConnector.connect(BulkAssemblyEditor)
var k$=n(615109)
function BulkTranslationPage_defineProperty(e,t,n){(t=function BulkTranslationPage_toPropertyKey(e){var t=function BulkTranslationPage_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class BulkTranslationPageConnector extends oi.C{constructor(...e){super(...e)
BulkTranslationPage_defineProperty(this,"shouldSubscribeToRedux",!1)
BulkTranslationPage_defineProperty(this,"stores",[Zz.Z])}enhanceProps(){return{bulkTranslation:this.bulkTranslationStore().getBulkTranslation()}}}class BulkTranslationPage extends d.Component{componentDidMount(){BulkTranslationActions_reset()}render(){const{bulkTranslation:e}=this.props
return d.createElement(Fz.T3,null,d.createElement(Fz.JL,{header:"Bulk Translate DNA to AA"},d.createElement(Fz.LY,{isActive:!0,onClick:Jt.ZT},"Translate DNA")),d.createElement(Hz,{bulkTranslation:e}))}}BulkTranslationPage_defineProperty(BulkTranslationPage,"propTypes",{bulkTranslation:k$.Im.isRequired})
const M$=BulkTranslationPageConnector.connect(BulkTranslationPage)
var F$=n(45219),Z$=n(118664),B$=n(389747),q$=n(465428)
function sendIsLoading(){Sa.Z.dispatch({actionType:fa.k2q})}function sendDoneLoading(){Sa.Z.dispatch({actionType:fa.pSk})}function showScreen(e){const{queryKey:t}=de.he(window.location.href)
if(t.next&&F$.$Y.includes(e)){ez.RM();(0,ac.ZP)(decodeURIComponent(t.next))}else ez.Nc(e)}function hideScreen(){ez.RM()}function showNextScreen(){Sa.Z.dispatch({actionType:fa.E6L})}function makeWelcomeText(){const e=Jn.Z.currentUser();(0,S.Gp)(null!=e,"Expected current user to exist.")
const t=null==e?void 0:e.name
return`Welcome to Benchling${null!=t?`, ${t}`:""}!`}function InfoSidePanel(e){return d.createElement("div",{className:(0,g.iv)(V$.sidePanel)},d.createElement(Je.Z,null,makeWelcomeText()),d.createElement("div",{className:(0,g.iv)(V$.headerText)},e.titleText),d.createElement("div",{className:f()((0,g.iv)(V$.bodyText),"u-faded")},e.bodyText))}const V$=g.mM.create({sidePanel:{paddingTop:"83px"},headerText:{fontSize:"34px",lineHeight:"40px",marginTop:"15px"},bodyText:{fontSize:"18px",lineHeight:"24px",marginTop:"12px"}})
var U$,G$,z$
!function(e){e.AGRICULTURE="Agriculture"
e.ANIMAL_HEALTH="Animal Health"
e.BIOPHARMA="Biopharma"
e.DIAGNOSTICS="Diagnostics"
e.INDUSTRIAL_BIOTECH="Industrial Biotech"
e.CRO="CRO"}(U$||(U$={}))
!function(e){e.BIOCHEMISTRY_AND_CHEMICAL_BIOLOGY="Biochemistry and Chemical Biology"
e.BIOENGINEERING="Bioengineering"
e.ECOLOGY_AND_EVOLUTIONARY_BIOLOGY="Ecology and Evolutionary Biology"
e.GENETICS_AND_GENOMICS="Genetics and Genomics"
e.MICROBIOLOGY="Microbiology"
e.MOLECULAR_AND_CELL_BIOLOGY="Molecular and Cell Biology"
e.SYNTHETIC_BIOLOGY="Synthetic Biology"
e.OTHER="Other"}(G$||(G$={}))
!function(e){e.GRADUATE_STUDENT="Graduate Student"
e.LAB_MANAGER="Lab Manager"
e.POSTDOC="Postdoc"
e.PROFESSOR="Professor"
e.RESEARCH_ASSISTANT="Research Assistant"
e.UNDERGRADUATE="Undergraduate"
e.OTHER="Other"}(z$||(z$={}))
function SignupModal(e){return d.createElement("div",{className:(0,g.iv)($$.modal)},null!=e.children&&e.children)}function SignupScreen(e){return d.createElement("div",{className:f()("container u-flex-grow u-justify-content-center",(0,g.iv)($$.page))},d.createElement(SignupModal,null,e.children))}const $$=g.mM.create({page:{paddingTop:"107px"},modal:{borderTop:"7px solid #2A5CF9",borderRadius:"0px 0px 4px 4px",boxShadow:"0px 2px 6px rgba(162, 185, 190, 0.7)",height:"476px",width:"775px",backgroundColor:Vt.Cj}})
function NextOptions(e){return d.createElement("div",{className:(0,g.iv)(W$.nextOptions)},d.createElement("span",{className:f()((0,g.iv)(W$.skip),"u-pointer"),onClick:()=>{m.j("onboarding_page","clicked",{page:"academic_role_info",objectClicked:"button",objectText:"Skip for now",eventLastModified:"FY22_Q2b3"})
showScreen(F$.Uf)}},"Skip for now"),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,text:"Next",onClick:e.onSubmit,disabled:e.shouldDisableNext}))}function AcademicDropdown(e){var t
const n=e.values.map((e=>({name:e,value:e}))).map((({name:t,value:n})=>d.createElement(N.Z,{key:n,onSelect:()=>{e.onChange(n)},value:n},t)))
return d.createElement("div",{className:"u-position-relative"},e.selectedValue&&d.createElement(pe.Z,{className:(0,g.iv)(W$.dropdownClearIcon),icon:"close",onClick:()=>{e.onChange(null)}}),d.createElement($r.ZP,{buttonClassName:f()(null==e.selectedValue&&"u-faded",(0,g.iv)(W$.dropdown)),menu:d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.FULL},n),displayName:null!==(t=e.selectedValue)&&void 0!==t?t:e.placeholder,alwaysDropDown:!0}))}function InstitutionDropdown(e){var t
return d.createElement("div",{className:(0,g.iv)(W$.institutionSearchInput)},e.selectedValueDisplayString&&d.createElement(pe.Z,{className:(0,g.iv)(W$.dropdownClearIcon),icon:"close",onClick:()=>{e.onChange(null)}}),d.createElement($r.ZP,{buttonClassName:f()(null==e.selectedValueDisplayString&&"u-faded",(0,g.iv)(W$.dropdown)),displayName:null!==(t=e.selectedValueDisplayString)&&void 0!==t?t:e.placeholder,menu:d.createElement(Z$.ZP,{onSelect:e.onChange})}))}const handleSubmitRoleInfo=(e,t,n)=>{m.j("onboarding_page","clicked",{page:"academic_role_info",objectClicked:"button",objectText:"Next",eventLastModified:"FY22_Q2b3",role:t,scientificField:n})
!function submitAcademicRoleInfo({institutionId:e,role:t,field:n},a){sendIsLoading()
q$.Ym({institutionId:e,academicRole:t,scientificField:n}).fail(v.ZP.notifyError).always((()=>{sendDoneLoading()})).done((()=>{a()}))}({institutionId:e,role:t,field:n},(()=>{showScreen(F$.Uf)}))}
function AcademicRoleInfoEditor(){const[e,t]=d.useState(Jn.Z.currentUser().institution),[n,a]=d.useState(null),[i,s]=d.useState(null)
return d.createElement(d.Fragment,null,d.createElement(InstitutionDropdown,{selectedValueDisplayString:null==e?void 0:e.fullName,placeholder:"What’s your institution?",onChange:e=>{t(e)}}),d.createElement(AcademicDropdown,{onChange:e=>{a(e)},placeholder:"What's your current role?",values:Object.values(z$),selectedValue:n}),d.createElement(AcademicDropdown,{onChange:e=>{s(e)},placeholder:"What scientific field do you work in?",values:Object.values(G$),selectedValue:i}),d.createElement(NextOptions,{shouldDisableNext:null==e&&null==n&&null==i,onSubmit:()=>{var t
handleSubmitRoleInfo(null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null,n,i)}}))}function AcademicRoleInfoScreen(){return d.createElement(SignupScreen,null,d.createElement(h.Z,{className:(0,g.iv)(W$.row)},d.createElement(p.Z,{xs:4,sm:6},d.createElement(InfoSidePanel,{titleText:"Now let’s build out your profile",bodyText:"Benchling is designed for academic scientists like you."})),d.createElement(p.Z,{xs:8,sm:6},d.createElement(AcademicRoleInfoEditor,null))))}const W$=g.mM.create({row:{marginLeft:"52px",marginRight:"52px"},mediumText:{fontSize:"18px",lineHeight:"24px",marginBottom:"11px"},dropdown:{position:"relative",minHeight:"40px",marginTop:"8px"},nextOptions:{marginTop:"118px",float:"right"},skip:{marginTop:"134px",fontSize:"13px",marginRight:"22px",color:Vt.t0},institutionSearchInput:{position:"relative",marginTop:"120px"},dropdownClearIcon:{position:"absolute",top:"24px",float:"right",right:"30px",fontSize:"9px",cursor:"pointer",color:Vt.pp,zIndex:1}})
function SignupScreenCard(e){const[t,n]=(0,uT.Z)(),{onClick:a,titleText:i,bodyText:s,imagePath:r,buttonText:o,hoverOn:l,hoverOff:c}=e
d.useEffect((()=>{l&&t&&l()
c&&!t&&c()}),[t,l,c])
return d.createElement("div",{className:f()((0,g.iv)(H$.container),"u-pointer"),onClick:a,...n},d.createElement("span",null,d.createElement("img",{src:r,className:(0,g.iv)(H$.image)})),d.createElement("span",{className:f()("u-flex-grow",(0,g.iv)(H$.textBox))},d.createElement("div",{className:(0,g.iv)(H$.titleText)},i),d.createElement("div",{className:f()((0,g.iv)(H$.bodyText))},s),d.createElement(C.Co,{className:(0,g.iv)(H$.button,t&&H$.hoverButton),text:o,buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.MEDIUM})))}const H$=g.mM.create({container:{height:"184px",width:"340px",border:`1px solid ${Vt.tN}`,borderRadius:"3px",display:"flex",justifyContent:"flex-start",":hover":{boxShadow:"0px 2px 6px rgba(162, 185, 190, 0.7);"}},image:{height:"100px",width:"100px",marginLeft:"21px",marginTop:"42px"},textBox:{marginTop:"33px",marginLeft:"24px",marginRight:"16px"},titleText:{fontSize:"18px",lineHeight:"24px",color:Vt.Rl},bodyText:{fontSize:"12px",color:Vt.pp,lineHeight:"14px",paddingTop:"8px"},button:{marginTop:"8px"},hoverButton:{backgroundColor:Vt.t0,color:Vt.Cj}})
function AffiliationButtonPanel(){return d.createElement("div",{className:(0,g.iv)(j$.buttonPanel)},d.createElement(SignupScreenCard,{titleText:"Academic",bodyText:"I work in a research lab at an academic, non-profit, or government institution",imagePath:"/static/img/new-user-flow/affiliation-academic.png",onClick:()=>{m.j("onboarding_page","clicked",{page:"affiliation",objectClicked:"button",objectText:"Academic",eventLastModified:"FY22_Q2b3"})
showScreen(F$.Cz)},buttonText:"I work in Academia"}),d.createElement(SignupScreenCard,{titleText:"Industry",bodyText:"I work in R&D for a biotech or pharmaceutical company",imagePath:"/static/img/new-user-flow/affiliation-industry.png",onClick:()=>{m.j("onboarding_page","clicked",{page:"affiliation",objectClicked:"button",objectText:"Industry",eventLastModified:"FY22_Q2b3"})
showScreen(F$.J)},buttonText:"I work in Industry"}))}function AffiliationScreen(){return d.createElement(SignupScreen,null,d.createElement(h.Z,{className:(0,g.iv)(j$.row)},d.createElement(p.Z,{xs:4,sm:6},d.createElement(InfoSidePanel,{titleText:"What type of work do you do?",bodyText:"We help scientists across various organizations accelerate their research."})),d.createElement(p.Z,{xs:8,sm:6,className:(0,g.iv)(j$.cardColumn)},d.createElement(AffiliationButtonPanel,null))))}const j$=g.mM.create({row:{marginLeft:"52px",marginRight:"52px",height:"100%"},cardColumn:{height:"100%"},buttonPanel:{display:"flex",flexDirection:"column",justifyContent:"space-evenly",height:"100%",padding:"20px 0"}}),Y$="Please enter a valid phone number."
function AsyncValidatedPhoneNumberInput({className:e,onValidInput:t,onUpdateErrorMessage:a}){const[i,s]=d.useState(""),[r,o]=d.useState(!1)
return d.createElement(d.Fragment,null,d.createElement(or.Z,{className:e,placeholder:"Phone Number",value:i,onChange:e=>{s(e.target.value)},hasError:r,onBlur:()=>{n.e(752).then((e=>{const{PhoneNumberFormat:s,PhoneNumberUtil:r,Error:l}=n(115871),c=r.getInstance()
if(0!==i.length)try{const e=c.parse(i,"US"),n=c.isPossibleNumber(e)
if(c.isValidNumber(e)){t(c.format(e,s.INTERNATIONAL))
o(!1)
a("")}else if(n){o(!0)
a("Non-US numbers must include a country code prefix.")}else{o(!0)
a(Y$)}}catch(e){if(!Object.values(l).includes(e.message))throw e
o(!0)
a(Y$)}else{o(!1)
a("")}}).bind(null,n)).catch((()=>{}))}}))}function NextButton({disabled:e,onSubmit:t}){return d.createElement(C.Co,{className:"pull-right u-large-spacing-top",buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,text:"Next",onClick:t,disabled:e})}function IndustryRoleInfoDescription(){return d.createElement(d.Fragment,null,d.createElement(Je.Z,null,makeWelcomeText()),d.createElement("div",{className:(0,g.iv)(Q$.sidePanelTitleText)},"You’ve signed up for ",d.createElement("span",{className:(0,g.iv)(Q$.highlightedText)},"limited access")," to Benchling’s most popular applications"),d.createElement("div",{className:f()((0,g.iv)(Q$.sidePanelBodyText),"u-faded")},"This free and limited version of Benchling is designed for academics, but our full platform is designed for R&D organizations of all sizes."))}function IndustryDropdown(e){var t
const n=e.values.map((e=>({name:e,value:e}))).map((({name:t,value:n})=>d.createElement(N.Z,{key:n,onSelect:()=>{e.onChange(n)},value:n},t)))
return d.createElement($r.ZP,{buttonClassName:f()(null==e.selectedValue&&"u-faded",(0,g.iv)(Q$.dropdown)),menu:d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,width:Nr.zL.FULL},n),displayName:null!==(t=e.selectedValue)&&void 0!==t?t:e.placeholder,alwaysDropDown:!0})}const IndustryRoleInfoScreen_handleSubmitRoleInfo=(e,t,n,a)=>{m.j("onboarding_page","clicked",{page:"industry_role_info",objectClicked:"button",objectText:"Next",eventLastModified:"FY22_Q2b3",company:e,title:t,phoneNumber:n,industry:a})
!function submitIndustryRoleInfo({company:e,title:t,phoneNumber:n,industry:a},i){sendIsLoading()
q$.Ym({company:e,title:t,phoneNumber:n,industry:a}).fail(v.ZP.notifyError).always((()=>{sendDoneLoading()})).done((()=>{i()}))}({company:e,title:t,phoneNumber:n,industry:a},(()=>{showScreen(F$.JC)}))}
function IndustryRoleInfoTextInput(e){return d.createElement(or.Z,{className:(0,g.iv)(Q$.textInput),placeholder:e.placeholder,value:e.value,onChange:t=>{e.onChange(t.target.value)}})}function IndustryRoleInfoEditor(){const[e,t]=d.useState(""),[n,a]=d.useState(""),[i,s]=d.useState(""),[r,o]=d.useState(null),[l,c]=d.useState("")
return d.createElement(d.Fragment,null,d.createElement("div",{className:f()((0,g.iv)(Q$.mediumText))},"Build out your profile to give it a try."),d.createElement(IndustryRoleInfoTextInput,{placeholder:"Company (required)",value:e,onChange:t}),d.createElement(IndustryRoleInfoTextInput,{placeholder:"Title",value:n,onChange:a}),d.createElement(AsyncValidatedPhoneNumberInput,{className:(0,g.iv)(Q$.textInput),onValidInput:s,onUpdateErrorMessage:c}),d.createElement(IndustryDropdown,{onChange:e=>{o(e)},placeholder:"R&D industry",values:Object.values(U$),selectedValue:r}),d.createElement(ER.Z,{className:(0,g.iv)(Q$.errorMessage),error:l}),d.createElement(NextButton,{disabled:0===e.length||l.length>0,onSubmit:()=>{IndustryRoleInfoScreen_handleSubmitRoleInfo(e,n,i,r)}}))}function IndustryRoleInfoScreen(){return d.createElement(SignupScreen,null,d.createElement(h.Z,{className:(0,g.iv)(Q$.row)},d.createElement(p.Z,{xs:6,className:(0,g.iv)(Q$.industryRoleInfoDescription)},d.createElement(IndustryRoleInfoDescription,null)),d.createElement(p.Z,{xs:6,className:(0,g.iv)(Q$.industryRoleInfoEditor)},d.createElement(IndustryRoleInfoEditor,null))))}const Q$=g.mM.create({row:{marginLeft:"52px",marginRight:"52px"},industryRoleInfoDescription:{marginTop:"76px",paddingRight:"0px"},industryRoleInfoEditor:{marginTop:"117px",paddingLeft:"22px"},sidePanelTitleText:{fontSize:"26px",lineHeight:"30px",marginTop:"10px"},sidePanelBodyText:{fontSize:"18px",lineHeight:"24px",marginTop:"12px"},highlightedText:{color:Vt.t0},mediumText:{fontSize:"18px",lineHeight:"24px",marginBottom:"11px"},textInput:{minHeight:"40px",fontSize:"13px",lineHeight:"16px",borderRadius:"4px",marginBottom:"8px"},dropdown:{minHeight:"40px"},errorMessage:{minHeight:"24px",fontSize:"12px"}})
var K$=n(441116),J$=n(271350)
class EntityName extends d.Component{render(){return d.createElement("a",{href:`/${this.props.entity.url_identifier}/`,target:"_blank",rel:"noopener noreferrer"},this.props.entity.name)}}const X$=EntityName
class OrganizationRequest extends d.Component{constructor(){super(...arguments)
this.renderButtons=()=>[d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,key:"accept",onClick:this.props.accept,text:"Accept",dataTestAttrs:{component:"OrganizationRequest",element:"acceptButton"}})," ",d.createElement(C.Co,{buttonStyle:C.ZJ.NEGATIVE,size:C.qE.SMALL,key:"reject",className:"u-tiny-spacing-left",onClick:this.props.reject,text:"Reject"})]}render(){return d.createElement("div",{className:"organizationInvitesSection-inviteCard",...(0,ee.Z)({component:"OrganizationRequest",element:"root"})},d.createElement("div",{className:"u-overflow-hidden u-small-spacing-bottom"},this.props.children),d.createElement("div",null,this.renderButtons()))}}OrganizationRequest.defaultProps={collapsed:!1}
const eW=OrganizationRequest,InboundRequestCard=({organization:e,user:t})=>{var n
m.j("organizations","viewed_join_organization_request",{user_id:null===(n=Jn.Z.currentUser())||void 0===n?void 0:n.id,organization_id:e.id,requestor_id:t.id})
return d.createElement(eW,{accept:()=>{K$.KT(e.id,t.id)},reject:()=>{K$.Se(e.id,t.id)},collapsed:!1},d.createElement("div",null,d.createElement(X$,{entity:t})," has requested to join ",d.createElement(X$,{entity:e}),"."))},OutboundRequestCard=({organization:e,inviter:t})=>{var n
m.j("organizations","viewed_organization_invite",{user_id:null===(n=Jn.Z.currentUser())||void 0===n?void 0:n.id,organization_id:e.id})
return d.createElement(eW,{accept:()=>{J$.j8(e.id)},reject:()=>{J$.P5(e.id)},collapsed:!1},d.createElement("div",null,d.createElement(X$,{entity:t})," invited you to join ",d.createElement(X$,{entity:e}),"."))},PendingInvitesCard=()=>d.createElement("div",{className:"organizationInvitesSection-inviteCard u-overflow-hidden"},d.createElement("div",{className:"legacy-font-proxima-17 u-small-spacing-bottom u-bold-font-weight"},"You have an organization invite"),d.createElement("div",null,"Accept the invite in your email inbox or verify your email address to see the invite here."))
class OrganizationInvitesSectionConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Jn.Z]}enhanceProps(){const e=this.entityStore().currentUser()
if(!e)return{currentUserInboundRequests:null,userOrgsInboundRequests:null,pendingOrgInvites:0}
const{userOrgsInboundRequests:t,currentUserInboundRequests:n,pendingOrgInvites:a}=e
return{userOrgsInboundRequests:t,currentUserInboundRequests:n,pendingOrgInvites:a}}}class OrganizationInvitesSection extends d.Component{componentDidMount(){J$.zc()}render(){const{currentUserInboundRequests:e,userOrgsInboundRequests:t,pendingOrgInvites:n}=this.props
return Jn.Z.currentUserHasPendingInvites()?d.createElement("div",{className:f()(this.props.className,"organizationInvitesSection")},e&&e.map((({organization:e,inviter:t})=>d.createElement(OutboundRequestCard,{key:`${e.handle}-${t.handle}`,organization:e,inviter:t}))),t&&t.map((({organization:e,user:t})=>d.createElement(InboundRequestCard,{key:`${e.handle}-${t.handle}`,organization:e,user:t}))),n>0&&d.createElement(PendingInvitesCard,null)):null}}const tW=OrganizationInvitesSectionConnector.connect(OrganizationInvitesSection)
var nW=n(579807)
const aW=xa.Ps`
  fragment JoinOrganizationListingOrganization on OrganizationNode {
    id
    avatarUrl
    handle
    members {
      ... on UserNode {
        id
        name
      }
    }
    name
    urlIdentifier
  }
`
function OrganizationAvatarWithName({organization:e}){var t
const n=e.name||e.handle,[a,i]=(0,d.useState)(!1),s=d.useRef(null)
d.useEffect((()=>{s.current&&i(s.current.scrollWidth>s.current.clientWidth)}),[i])
return d.createElement(P.pf,{tooltipTitle:a?n:""},d.createElement(AF.X,{avatarInfo:{...e,avatar_url:null!==(t=e.avatarUrl)&&void 0!==t?t:void 0},shape:SC.o.CIRCLE,size:SC.D.SMALL,showTooltip:!1,nameTextRef:s}))}function getButtonText(e,t){return e?"Already Joined":t?"Request Sent":"Request to Join"}function getButtonStyle(e,t){return e?C.ZJ.TERTIARY_GRAY:t?C.ZJ.TERTIARY_BLUE_POWDER:C.ZJ.SECONDARY}function MemberCount({organization:e,showTooltip:t}){const n=t?function getMemberText(e){const t=e.slice(0,5).join(", "),n=e.length-5
return n>0?`${t} and ${n} ${de._6(n,"other")}`:t}(e.members.map((e=>e.name))):""
return d.createElement(P.pf,{tooltipTitle:n,tooltipPlacement:P.TQ.TOP},d.createElement(p.Z,{className:f()((0,g.iv)(iW.count),"u-flex-display u-small-padding-left u-faded u-italic")},`${e.members.length} members`))}function OrganizationRow({organization:e,canNavigateToOrganizationPage:t,hasRequestedJoinOrg:n,hasJoinedOrg:a,onClickRequestJoinOrganization:i}){return d.createElement(h.Z,{className:f()((0,g.iv)(iW.organizationRow),"u-flex-display")},d.createElement(p.Z,{className:(0,g.iv)(iW.avatarName)},d.createElement("span",{className:"u-pointer",onClick:n=>{t&&((e,t)=>{if(de.Gn(e)){e.preventDefault();(0,ac.ZP)(`organizations/${t.urlIdentifier}`)
nW.Z.closeSearchOrgModal()}})(n,e)}},d.createElement(OrganizationAvatarWithName,{organization:e}))),d.createElement(MemberCount,{organization:e,showTooltip:dt.ZP.GROWTH_ENABLE_ORGANIZATION_RECOMMENDATIONS}),d.createElement(p.Z,{className:(0,g.iv)(iW.buttonContainer)},d.createElement(C.Co,{onClick:()=>{i(e.id)},className:(0,g.iv)(iW.button),disabled:a||n,text:getButtonText(a,n),buttonStyle:getButtonStyle(a,n),size:C.qE.MEDIUM})))}function JoinOrganizationListing(e){return d.createElement("div",{className:"container"},e.organizations.map((t=>{const n=e.requestedJoinOrganizationIds.includes(t.id),a=e.alreadyJoinedOrganizationIds.includes(t.id)
return d.createElement(OrganizationRow,{key:t.id,organization:t,canNavigateToOrganizationPage:Boolean(e.canNavigateToOrganizationPage),hasRequestedJoinOrg:n,hasJoinedOrg:a,onClickRequestJoinOrganization:e.onClickRequestJoinOrganization})})))}const iW=g.mM.create({organizationRow:{display:"flex",alignItems:"center"},count:{alignItems:"center",flexShrink:0,marginRight:"10px"},buttonContainer:{marginLeft:"auto",flexShrink:0},button:{":focus":{outline:"none",boxShadow:"none"}},avatarName:{whiteSpace:"nowrap",overflow:"hidden"}}),sW=xa.Ps`
  query JoinOrganizationRecommendationsQuery @skipAudit @engComponent(name: IDENTITY) {
    currentUser {
      id
      institution {
        id
      }
      organizations {
        id
      }
      recommendations {
        ...JoinOrganizationListingOrganization
      }
      referrers {
        id
      }
    }
  }
  ${aW}
`
function getRecommendationsHeaderText(e,t,n){if(e)return t||n?"Organizations you may be interested in:":"Recently joined organizations:"}function JoinOrganizationRecommendationsListing(e){var t,n,a,i
const s=(0,Da.IJ)(sW,{fetchPolicy:"cache-and-network"})
if(s.type===Da.NI.ERROR){v.ZP.error("Could not load organization recommendations; try reloading the page.")
return null}if(s.type===Da.NI.PENDING)return d.createElement(JoinOrganizationSearchLoading,{...e})
{const r=null!==(n=null===(t=s.data.currentUser)||void 0===t?void 0:t.recommendations)&&void 0!==n?n:[],o=s.data.currentUser,l=null!=(null===(a=s.data.currentUser)||void 0===a?void 0:a.institution),c=null!=o&&o.referrers.length>0,u=0!==r.length
return d.createElement(PresentationalJoinOrganizationSearch,{...e,currentUser:o,organizations:r,isLoading:!1,showInstitutionFilter:null!==(i=e.showInstitutionFilter)&&void 0!==i&&i,headerText:getRecommendationsHeaderText(u,l,c)})}}const rW=xa.Ps`
  query JoinOrganizationSearchQuery(
    $searchInput: OrganizationListingSearchInput!
    $limitOffsetInput: LimitOffsetInput!
  ) @skipAudit @engComponent(name: IDENTITY) {
    currentTenantOrganizationListing(searchInput: $searchInput, limitOffsetInput: $limitOffsetInput) {
      organizations {
        ...JoinOrganizationListingOrganization
      }
    }
    currentUser {
      id
      organizations {
        id
      }
    }
  }
  ${aW}
`
function JoinOrganizationSearchListing(e){var t
const n=(0,Da.IJ)(rW,{fetchPolicy:"network-only",variables:e.queryVariables})
if(n.type===Da.NI.ERROR){v.ZP.error("Could not load organization search; try reloading the page.")
return null}if(n.type===Da.NI.PENDING)return d.createElement(JoinOrganizationSearchLoading,{...e})
{const a=n.data.currentTenantOrganizationListing.organizations,i=n.data.currentUser,s=0!==a.length||0===e.query.length&&0===e.filters.length?void 0:"No organizations found. Try searching for something else or create your own organization."
return d.createElement(PresentationalJoinOrganizationSearch,{...e,currentUser:i,organizations:a,isLoading:!1,showInstitutionFilter:null!==(t=e.showInstitutionFilter)&&void 0!==t&&t,headerText:s})}}const oW={limit:15,offset:0}
function JoinOrganizationSearch(e){var t
const n=(0,Su.N)(e.query,250);(0,d.useEffect)((()=>{var e
n&&m.j("organizations","searched_for_organization",{search_query:n,user_id:null===(e=Jn.Z.currentUser())||void 0===e?void 0:e.id})}),[n])
const a=NN.xb(e.filters,Kn.Vm.INSTITUTION),i={searchInput:{query:n,institutionId:null===(t=null==a?void 0:a.value)||void 0===t?void 0:t.id},limitOffsetInput:oW},handleClickRequestJoinOrganization=t=>{e.onChangeRequestedJoinOrganizationIds([...e.requestedJoinOrganizationIds,t])
try{J$.A$(t)}catch(e){throw e}}
return!e.hasSearched&&e.showRecommendations?d.createElement(JoinOrganizationRecommendationsListing,{...e,onClickRequestJoinOrganization:handleClickRequestJoinOrganization,showInstitutionFilter:e.showInstitutionFilter,filters:e.filters,setFilters:e.setFilters}):d.createElement(JoinOrganizationSearchListing,{...e,queryVariables:i,onClickRequestJoinOrganization:handleClickRequestJoinOrganization,filters:e.filters,setFilters:e.setFilters})}function OrganizationSearchInput(e){return d.createElement(or.Z,{className:f()((0,g.iv)(e.showInstitutionFilter?lW.shortInput:lW.tallInput),"u-small-spacing-bottom"),placeholder:"Search for an organization",size:Mo.$u.MEDIUM,value:e.query,onChange:t=>{e.onChangeQuery(t.target.value)},autoFocus:!0})}function getAlreadyJoinedOrganizationIds(e,t){const n=e.map((e=>e.id))
if(!t)return n
const a=t.organizations.map((e=>e.id))
return n.filter((e=>a.includes(e)))}function JoinOrganizationSearchLoading(e){var t
return d.createElement(PresentationalJoinOrganizationSearch,{...e,currentUser:null,organizations:[],isLoading:!0,showInstitutionFilter:null!==(t=e.showInstitutionFilter)&&void 0!==t&&t})}function PresentationalJoinOrganizationSearch(e){const t=0===e.query.length&&0===e.organizations.length&&null!=e.placeholderBodyText,n=(0,Su.N)(e.headerText,500),a=e.showInstitutionFilter&&(0!==e.query.length||0!==e.filters.length)
return d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(lW.searchBars)},d.createElement(OrganizationSearchInput,{query:e.query,onChangeQuery:e.onChangeQuery,showInstitutionFilter:e.showInstitutionFilter}),e.showInstitutionFilter&&d.createElement("div",{className:(0,g.iv)(lW.filterContainer)},d.createElement(Hu.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.INSTITUTION}],secondaryFilterGroups:[],filters:e.filters,onChangeFilters:e.setFilters,selectedSchema:null}),a&&d.createElement("span",{className:f()((0,g.iv)(lW.clearIcon),"u-no-wrap")},d.createElement(wr.Z,{onClear:()=>{e.onChangeQuery("")
e.setFilters([])}})))),d.createElement("div",{className:(0,g.iv)(lW.listing),style:{height:null!=e.listingHeight?`${e.listingHeight}px`:350}},t?d.createElement("div",{className:f()((0,g.iv)(lW.bodyText),"u-faded")},e.placeholderBodyText):e.isLoading?d.createElement(kl.b,null):d.createElement("div",null,n&&d.createElement("p",null,d.createElement("b",null,n)),d.createElement(JoinOrganizationListing,{organizations:e.organizations,alreadyJoinedOrganizationIds:getAlreadyJoinedOrganizationIds(e.organizations,e.currentUser),requestedJoinOrganizationIds:e.requestedJoinOrganizationIds,onClickRequestJoinOrganization:e.onClickRequestJoinOrganization,canNavigateToOrganizationPage:e.canNavigateToOrganizationPage}))))}const lW=g.mM.create({shortInput:{padding:"10px 10px",borderRadius:5},tallInput:{padding:"20px 10px",borderRadius:5},listing:{"@media (max-height: 640px)":{height:200},overflowY:"auto",marginTop:"20px"},bodyText:{fontSize:"18px",lineHeight:"24px"},searchBars:{display:"flex",gap:"10px"},filterContainer:{display:"flex",gap:"10px",marginRight:"10px"},clearIcon:{fontSize:"12px",marginTop:"2px",lineHeight:"24px"}})
function useJoinOrganizationSearch(e){const[t,n]=(0,d.useState)(""),[a,i]=(0,d.useState)([]),[s,r]=(0,d.useState)(!1),[o,l]=(0,d.useState)([]);(0,d.useEffect)((()=>{if((t.length||a.length)&&!s){r(!0)
e&&e()}}),[t,a,s,e])
return[{query:t,filters:a,hasSearched:s,requestedJoinOrganizationIds:o},{onChangeQuery:n,onChangeFilters:i,onChangeRequestedJoinOrganizationIds:l}]}function JoinOrganizationScreen_NextOptions(e){return d.createElement("div",{className:(0,g.iv)(cW.nextOptions)},d.createElement("span",{className:f()((0,g.iv)(cW.skip),"u-pointer"),onClick:()=>{m.j("onboarding_page","clicked",{page:"join_organization",objectClicked:"button",objectText:"Create or join one later",eventLastModified:"FY22_Q2b3"})
showScreen(F$.JC)}},"Create or join one later"),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,text:"Next",disabled:e.isNextButtonDisabled,onClick:()=>{m.j("onboarding_page","clicked",{page:"join_organization",objectClicked:"button",objectText:"Next",eventLastModified:"FY22_Q2b3"})
showScreen(F$.JC)}}))}function JoinOrganizationPanelOrganizationSearch(e){const[{query:t,filters:n,hasSearched:a,requestedJoinOrganizationIds:i},{onChangeQuery:s,onChangeFilters:r,onChangeRequestedJoinOrganizationIds:o}]=useJoinOrganizationSearch(e.onInitialQueryChange)
return d.createElement("div",{className:(0,g.iv)(cW.joinOrganizationsSection)},d.createElement(JoinOrganizationSearch,{query:t,onChangeQuery:s,filters:n,setFilters:r,requestedJoinOrganizationIds:i,onChangeRequestedJoinOrganizationIds:o,placeholderBodyText:e.placeholderBodyText,listingHeight:148,hasSearched:a,showInstitutionFilter:!0,showRecommendations:!0}))}function JoinOrganizationPanelHeader(){return d.createElement("div",{className:(0,g.iv)(cW.sidePanel)},d.createElement(Je.Z,{className:"u-no-wrap"},makeWelcomeText()),d.createElement("div",{className:(0,g.iv)(cW.headerText)},"See if your lab is already on Benchling"))}function JoinOrganizationScreen(){const e=Jn.Z.currentUserHasPendingInvites(),[t,n]=d.useState(!e)
return d.createElement(SignupScreen,null,d.createElement(h.Z,{className:(0,g.iv)(cW.row)},d.createElement(p.Z,{sm:5},d.createElement(JoinOrganizationPanelHeader,null),d.createElement("div",{className:f()((0,g.iv)(cW.bodyText),"u-faded")},d.createElement("p",null,"Hundreds of labs around the world are using Benchling! Find and join your organization today."))),d.createElement(p.Z,{sm:7,className:(0,g.iv)(cW.rightPanel)},e?d.createElement("div",{className:(0,g.iv)(cW.joinOrganizationsSection)},d.createElement("div",{className:(0,g.iv)(cW.bodyText)},"Pending Invites"),d.createElement("div",{className:(0,g.iv)(cW.invitesSection)},d.createElement(tW,null))):d.createElement(JoinOrganizationPanelOrganizationSearch,{onInitialQueryChange:()=>{n(!1)}}),d.createElement(JoinOrganizationScreen_NextOptions,{isNextButtonDisabled:t}))))}const cW=g.mM.create({row:{marginLeft:"52px",marginRight:"46px"},sidePanel:{paddingTop:"83px"},headerText:{fontSize:"34px",lineHeight:"40px",marginTop:"15px"},bodyText:{fontSize:"18px",lineHeight:"24px",marginTop:"12px"},image:{width:"254px",height:"224px",marginLeft:"48px",marginTop:"77px",marginRight:"16px",marginBottom:"100px"},joinOrganizationsSection:{marginTop:"12px",marginBottom:"40px"},invitesSection:{border:`1px solid ${Vt.pF}`,height:"150px",margin:"10px 0",overflowY:"scroll",padding:"10px"},nextOptions:{float:"right"},skip:{marginTop:"134px",fontSize:"13px",marginRight:"22px",color:Vt.t0},rightPanel:{marginTop:"124px"}})
function ApplicationCardPanel(e){return d.createElement("div",{className:(0,g.iv)(dW.buttonPanel)},d.createElement(SignupScreenCard,{titleText:"Notebook",bodyText:"Plan multi-day experiments, centralize data, and share experimental results.",imagePath:"/static/img/new-user-flow/notebook.png",onClick:()=>{m.j("onboarding_page","clicked",{page:"molbio_or_notebook",objectClicked:"button",objectText:"Notebook",eventLastModified:"FY22_Q2b3"})
hideScreen();(0,Ys.JU)()},buttonText:"Show me an entry",hoverOn:e.hoverNotebook,hoverOff:e.hoverOff}),d.createElement(SignupScreenCard,{titleText:"Molecular Biology",bodyText:"Annotate sequences, perform alignments, and design plasmids, primers, and CRISPR guides.",imagePath:"/static/img/new-user-flow/molbio.png",onClick:()=>{m.j("onboarding_page","clicked",{page:"molbio_or_notebook",objectClicked:"button",objectText:"Molecular Biology",eventLastModified:"FY22_Q2b3"})
hideScreen();(0,Ys.hE)()},buttonText:"Open a sequence",hoverOn:e.hoverMolBio,hoverOff:e.hoverOff}))}function MolBioOrNotebookScreen(e){return d.createElement(SignupScreen,null,d.createElement(h.Z,{className:(0,g.iv)(dW.row)},d.createElement(p.Z,{xs:4,sm:6},d.createElement(InfoSidePanel,{titleText:"Choose what you want to see first",bodyText:"Benchling offers a suite of capabilities for capturing, analyzing, and sharing your data."})),d.createElement(p.Z,{xs:8,sm:6,className:(0,g.iv)(dW.cardColumn)},d.createElement(ApplicationCardPanel,{...e}))))}const dW=g.mM.create({row:{marginLeft:"52px",marginRight:"52px",height:"100%"},cardColumn:{height:"100%"},buttonPanel:{display:"flex",flexDirection:"column",justifyContent:"space-evenly",height:"100%",padding:"20px 0"}})
function JoinOrganizationPage_NextButton(){return d.createElement(C.Co,{className:"pull-right u-spacing-top",buttonStyle:C.ZJ.PRIMARY,size:C.qE.MEDIUM,text:"Next",onClick:()=>{m.j("onboarding_page","clicked",{page:"join_organization_page",objectClicked:"button",objectText:"Next",eventLastModified:"FY21_Q1a2"})
showScreen(F$.j2)}})}function JoinOrganizationPage(){const[{query:e,filters:t,hasSearched:n,requestedJoinOrganizationIds:a},{onChangeQuery:i,onChangeFilters:s,onChangeRequestedJoinOrganizationIds:r}]=useJoinOrganizationSearch()
return d.createElement("div",{className:"container u-flex-grow"},d.createElement("div",{className:"u-text-align-center"},d.createElement("h1",null,"Join an Organization"),d.createElement("p",null,"Organizations are a great way to collaborate and share results with your team or peers")),d.createElement(h.Z,null,d.createElement(p.Z,{lg:6,"lg-offset":3,md:8,"md-offset":2,sm:8,"sm-offset":2,xs:8,"xs-offset":2},d.createElement(JoinOrganizationSearch,{query:e,onChangeQuery:i,requestedJoinOrganizationIds:a,onChangeRequestedJoinOrganizationIds:r,filters:t,setFilters:s,hasSearched:n}),d.createElement(JoinOrganizationPage_NextButton,null))))}function ContinueButton({text:e,onClick:t,primary:n,disabled:a=!1}){return d.createElement("button",{disabled:a,onClick:t,className:f()("button button--large button--success",{"button--tertiaryBlue":!n,"button--primary":n,"is-disabled":a}),type:"button"},e)}const ProductIllustration=({fileName:e})=>d.createElement("center",null,d.createElement("img",{src:`/static/img/enterprise/${e}`,className:"callToActionScreen-productDescription-img"}))
ProductIllustration.propTypes={fileName:J().string.isRequired}
const ProductOverview=({name:e,tagline:t,featureList:n,illustrationFile:a,ctaText:i,ctaFunc:s,highlighted:r,primary:o})=>d.createElement("div",{className:f()("callToActionScreen-productDescription",{"callToActionScreen-productDescription--highlighted":r})},d.createElement("h2",null,e),d.createElement(ProductIllustration,{fileName:a}),d.createElement("div",{className:"callToActionScreen-productFeatureListContainer"},d.createElement("h4",null,t),d.createElement("ul",null,n.map(((e,t)=>d.createElement("li",{key:t},e))))),d.createElement("div",{className:"callToAction-continueButtonContainer"},d.createElement(ContinueButton,{text:i,onClick:s,primary:o})))
ProductOverview.propTypes={ctaFunc:J().func.isRequired,ctaText:J().string.isRequired,featureList:J().arrayOf(J().string).isRequired,highlighted:J().bool,illustrationFile:J().string.isRequired,name:J().string.isRequired,primary:J().bool,tagline:J().string.isRequired}
const openLabNotebook=()=>{!function beginFlow(e){Sa.Z.dispatch({actionType:fa.iyM,flow:e})}(F$.RC)
m.j("onboarding","clicked_cta_modal",{choice:"clicked_open_new_entry"})
m.j("new_user_flow","began_notebook_flow")
m.j("onboarding_page","clicked",{page:"choose_cta",objectClicked:"button",objectText:"Take Notes",eventLastModified:"FY21_Q1a2"})
window.Intercom&&window.Intercom("update",{cta_chosen:"open_entry"})},openPlasmidEditor=()=>{m.j("onboarding","clicked_cta_modal",{choice:"plasmid_and_crispr"})
m.j("onboarding_page","clicked",{page:"choose_cta",objectClicked:"button",objectText:"Start Cloning",eventLastModified:"FY21_Q1a2"})
window.Intercom&&window.Intercom("update",{cta_chosen:"open_sequence"})
showScreen(F$.qk)},PlasmidEditorProduct=()=>d.createElement(ProductOverview,{name:"Molecular Bio & CRISPR",illustrationFile:"bioregistry.png",tagline:"10+ biology tools, one interface.",featureList:["Design primers, align DNA, and more","Design CRISPR gRNAs in seconds","Import from SnapGene, Geneious, etc"],ctaText:"Start Cloning",ctaFunc:openPlasmidEditor}),LabNotebookProduct=()=>d.createElement(ProductOverview,{name:"Lab Notebook",illustrationFile:"lab-notebook.png",tagline:"A notebook built for researchers.",featureList:["Plan multi-day experiments","Easily reference all data","Get PDF exports, fast"],ctaText:"Take Notes",ctaFunc:openLabNotebook,highlighted:!0,primary:!0}),new_user_flow_CallToActionScreen=()=>d.createElement("div",{className:"callToActionScreen"},d.createElement("div",{className:"callToActionScreen-welcome"},d.createElement("h1",null,"Welcome to Benchling"),d.createElement("p",null,"Benchling is an intelligent research platform with tools for note-taking, molecular biology and CRISPR.")),d.createElement("div",{className:"callToActionScreen-productDescriptionContainer"},d.createElement(LabNotebookProduct,null),d.createElement(PlasmidEditorProduct,null))),FeatureText=({active:e,header:t,text:n,sectionIndex:a,updateActiveSection:i})=>d.createElement("div",{onClick:()=>{i(a)},className:f()("entryScreen-featureText",{"entryScreen-featureText--active":e})},d.createElement("h3",null,t),d.createElement("p",null,n))
class FeaturePreviewScreen extends d.Component{constructor(){super(...arguments)
this.state={activeSection:0}
this.updateActiveSection=e=>{this.state.activeSection!==e&&this.props.onChangeActiveSection(this.props.featureInfos[e].header)
this.setState({activeSection:e})}}render(){const e=this.props.featureInfos[this.state.activeSection].imageName,t=`featurePreviewScreen-featureImage-${e.split(".")[0]}`
return d.createElement("div",null,d.createElement("div",{className:"infoScreen-container"},d.createElement("div",{className:"infoScreen-content infoScreen-leftRightScreen-left"},d.createElement("h1",null,this.props.header),d.createElement("p",null,this.props.subheader),this.props.featureInfos.map((({header:e,text:t},n)=>d.createElement(FeatureText,{key:`feature-text-${n}`,header:e,text:t,active:this.state.activeSection===n,sectionIndex:n,updateActiveSection:this.updateActiveSection})))),d.createElement("div",{className:"u-position-relative infoScreen-leftRightScreen-right"},this.props.backgroundImage&&d.createElement("img",{src:`/static/img/new-user-flow/${this.props.backgroundImage}`,className:"infoScreen-previewImage-img"}),d.createElement("img",{src:`/static/img/new-user-flow/${e}`,className:`featurePreviewScreen-featureImage ${t}`}))),d.createElement("div",{className:"infoScreen-nextScreenButtonContainer"},d.createElement("button",{className:"button button--large button--primary infoScreen-nextScreenButton",onClick:this.props.handleClickNextScreen,type:"button"},this.props.nextButtonText)))}}FeaturePreviewScreen.defaultProps={nextButtonText:"Next",onChangeActiveSection:()=>Jt.ZT}
const uW=FeaturePreviewScreen,mW=[{header:"Capture ideas, data, and papers in one place",text:"\n      Drop in images and sequences directly to your entries. Add PDFs or presentations next to your\n      notes to access them from anywhere.\n    ",imageName:"capture-images.gif"},{header:"Find anything—just @-mention it",text:"\n      Instantly reference any of your files and link them to your entry. Start typing @ in any entry to\n      search your files on Benchling.\n    ",imageName:"at-mention.gif"},{header:"Plan your experiment",text:"\n      Break out your to-do list by day and check them off as they get done. See what experiments you have\n      going on this month on the home calendar.\n    ",imageName:"plan-experiment.gif"}],handleClickNextScreen=()=>{m.j("onboarding_page","clicked",{page:"notebook_overview",objectClicked:"button",objectText:"Next",eventLastModified:"FY21_Q1a2"})
hideScreen();(0,Ys.JU)()},handleChangeActiveSection=e=>{m.j("onboarding_page","clicked",{page:"notebook_overview",objectClicked:"button",objectText:e,eventLastModified:"FY21_Q1a2"})},new_user_flow_EntryInfoScreen=()=>d.createElement(uW,{header:"Introducing entries",subheader:d.createElement("span",null,"Projects contain entries used to ",d.createElement("strong",null,"document experiments"),"."),featureInfos:mW,handleClickNextScreen,onChangeActiveSection:handleChangeActiveSection,backgroundImage:"entry-illustration.png"}),pW=[{header:"Share plasmids and oligos with your entire lab",text:"\n      Benchling is built for collaboration. Use shared feature libraries to auto-annotate your sequences\n      and shared oligo folders to design your primers.\n    ",imageName:"sharing.png"},{header:"Easily align your sequences",text:"\n      Use our powerful sequence alignment tool to perform consensus and template alignments. The results are\n      stored alongside your plasmids for ease of use.\n    ",imageName:"alignments.png"},{header:"Never lose data again",text:"\n      All of your files are version controlled and timestamped - just click on the history panel to see\n      your edits. Export all of your data in just a few clicks.\n    ",imageName:"version-history.png"}],MolBioInfoScreen_handleClickNextScreen=()=>{m.j("onboarding_page","clicked",{page:"molecular_biology_overview",objectClicked:"button",objectText:"Next",eventLastModified:"FY21_Q1a2"})
hideScreen();(0,Ys.hE)()},MolBioInfoScreen_handleChangeActiveSection=e=>{m.j("onboarding_page","clicked",{page:"molecular_biology_overview",objectClicked:"button",objectText:e,eventLastModified:"FY21_Q1a2"})},new_user_flow_MolBioInfoScreen=()=>d.createElement(uW,{header:"Molecular Biology Suite",subheader:d.createElement("span",null,"Projects can contain different types of files, like oligos, DNA sequences, and AA sequences."),featureInfos:pW,nextButtonText:"Next",handleClickNextScreen:MolBioInfoScreen_handleClickNextScreen,onChangeActiveSection:MolBioInfoScreen_handleChangeActiveSection})
var hW=n(798540)
class ProclaimedCommercialRoleInfoScreen extends d.Component{constructor(){super(...arguments)
this.state={title:"",teamName:"",phoneNumber:"",company:""}
this.companyInputRef=d.createRef()
this.fieldsValid=()=>void 0!==this.state.company&&""!==this.state.company&&void 0!==this.state.phoneNumber&&""!==this.state.phoneNumber}componentDidMount(){u.findDOMNode(this.companyInputRef.current).focus()}render(){var e,t,n,a
const i=!this.fieldsValid()||this.props.isLoading
return d.createElement("form",{onSubmit:e=>{this.props.handleClickNextScreen(e,this.state)}},d.createElement("label",null,"Company name"),d.createElement("input",{placeholder:"e.g. Benchling",ref:this.companyInputRef,onChange:e=>{this.setState({company:e.target.value})},value:null!==(e=this.state.company)&&void 0!==e?e:void 0,className:"input-lg form-control u-spacing-bottom",name:"company"}),d.createElement("label",null,"Phone number"),d.createElement("input",{placeholder:"e.g. 415-555-5555",onChange:e=>{this.setState({phoneNumber:e.target.value})},value:null!==(t=this.state.phoneNumber)&&void 0!==t?t:void 0,className:"input-lg form-control u-spacing-bottom",name:"phoneNumber"}),d.createElement("label",null,"Team"),d.createElement("input",{placeholder:"e.g. Protein Engineering (optional)",onChange:e=>{this.setState({teamName:e.target.value})},value:null!==(n=this.state.teamName)&&void 0!==n?n:void 0,className:"input-lg form-control u-spacing-bottom",name:"teamName"}),d.createElement("label",null,"Role"),d.createElement("input",{placeholder:"e.g. Senior Scientist (optional)",onChange:e=>{this.setState({title:e.target.value})},value:null!==(a=this.state.title)&&void 0!==a?a:void 0,className:"input-lg form-control u-spacing-bottom",name:"title"}),d.createElement("div",{className:"roleInfoScreen-nextScreenButtonContainer"},d.createElement("button",{className:"button button--large button--primary u-spacing-top pull-right",disabled:i,type:"submit"},this.props.isLoading?"Submitting details...":"Next")))}}const gW=ProclaimedCommercialRoleInfoScreen
class VPCRoleInfoScreen extends d.Component{constructor(){super(...arguments)
this.state={phoneNumber:this.props.initialPhoneNumber||"",teamName:this.props.initialTeamName||"",title:this.props.initialTitle||"",company:null}
this.teamNameInputRef=d.createRef()
this.fieldsValid=()=>void 0!==this.state.teamName&&""!==this.state.teamName&&void 0!==this.state.phoneNumber&&""!==this.state.phoneNumber}componentDidMount(){u.findDOMNode(this.teamNameInputRef.current).focus()}render(){var e,t,n
const a=!this.fieldsValid()||this.props.isLoading
return d.createElement("form",{onSubmit:e=>{this.props.onSubmit(e,this.state)}},d.createElement("label",null,"Team ",d.createElement("span",{className:"u-danger-color"},"*")),d.createElement("input",{name:"teamName",placeholder:"e.g. Protein Engineering",onChange:e=>{this.setState({teamName:e.target.value})},value:null!==(e=this.state.teamName)&&void 0!==e?e:void 0,className:"input-lg form-control u-spacing-bottom",ref:this.teamNameInputRef}),d.createElement("label",null,"Role"),d.createElement("input",{name:"title",placeholder:"e.g. Senior Scientist",onChange:e=>{this.setState({title:e.target.value})},value:null!==(t=this.state.title)&&void 0!==t?t:void 0,className:"input-lg form-control u-spacing-bottom"}),d.createElement("label",null,"Phone number ",d.createElement("span",{className:"u-danger-color"},"*")),d.createElement("input",{name:"phoneNumber",placeholder:"e.g. 415-555-5555",onChange:e=>{this.setState({phoneNumber:e.target.value})},value:null!==(n=this.state.phoneNumber)&&void 0!==n?n:void 0,className:"input-lg form-control u-spacing-bottom"}),d.createElement("div",{className:"roleInfoScreen-nextScreenButtonContainer"},d.createElement("button",{className:"button button--large button--primary u-spacing-top pull-right",disabled:a,type:"submit"},this.props.isLoading?"Submitting details...":"Submit")))}}const EW=VPCRoleInfoScreen
class RoleInfoScreen extends d.Component{constructor(){super(...arguments)
this._handleClickNextScreen=(e,t)=>{e.preventDefault()
!function submitRoleDetails({phoneNumber:e,title:t,teamName:n,company:a},i){sendIsLoading()
q$.Ym({phoneNumber:e,title:t,teamName:n,company:a}).fail(v.ZP.notifyError).always((()=>{sendDoneLoading()})).done((()=>{i?showScreen(F$.O2):(0,ac.ZP)("/editor")}))}({phoneNumber:t.phoneNumber,title:t.title,teamName:t.teamName,company:t.company},this.props.inGettingStartedFlow)}}render(){return d.createElement("div",null,d.createElement("div",{className:"infoScreen-container row"},d.createElement("div",{className:"roleInfoScreen-left col-md-6"},d.createElement("div",{className:"hidden-xs hidden-sm"},d.createElement("img",{src:"/static/img/enterprise/lab-notebook.png",className:"roleInfoScreen-img"}))),d.createElement("div",{className:"roleInfoScreen-right col-md-6"},d.createElement("h1",null,"Set up your profile"),d.createElement("p",null,"Benchling allows you to collaborate with other users in your organization. Let's set up your profile before getting started with Benchling.",dt.ZP.ENABLE_ONBOARDING_ROLE_INFO&&d.createElement("span",null," ","In order to match you with the right team at your company, please fill out the following information.")),dt.ZP.ENABLE_ONBOARDING_ROLE_INFO?d.createElement(EW,{initialPhoneNumber:this.props.initialPhoneNumber,initialTeamName:this.props.initialTeamName,initialTitle:this.props.initialTitle,isLoading:this.props.isLoading,onSubmit:this._handleClickNextScreen}):d.createElement(gW,{isLoading:this.props.isLoading,handleClickNextScreen:this._handleClickNextScreen}))))}}RoleInfoScreen.defaultProps={inGettingStartedFlow:!1}
const fW=RoleInfoScreen
class NewUserFlowViewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[hW.Z]}enhanceProps(){return{isLoading:this.newUserFlowStore().getIsLoading(),projectId:this.newUserFlowStore().getProjectId()}}}var SW
!function(e){e.DEFAULT="DEFAULT"
e.NOTEBOOK="NOTEBOOK"
e.MOLBIO="MOLBIO"}(SW||(SW={}))
const yW="/static/img/new-user-flow/blur-product-1x.png",bW="/static/img/new-user-flow/blur-notebook-1x.png",TW="/static/img/new-user-flow/blur-molbio-1x.png",vW="/static/img/new-user-flow/blur-product-2x.png",CW="/static/img/new-user-flow/blur-notebook-2x.png",IW="/static/img/new-user-flow/blur-molbio-2x.png"
class NewUserFlowView extends d.Component{constructor(e){super(e)
this.nameCustomProject=()=>{!function nameCustomProject({projectName:e}){sendIsLoading()
B$.Z.nameCustomProject({projectName:e}).fail(v.ZP.notifyError).always((()=>{sendDoneLoading()})).done((e=>{const{api_identifier:t}=e.rootFolder
Sa.Z.dispatch({actionType:fa.qqk,projectId:e.id})
Rn.Z.fetchSources()
ze.Z.invalidateFetchAll()
Qe.Z.set(Qe.O.NOTEBOOK,t)
Qe.Z.set(Qe.O.INVENTORY,t)
showNextScreen()}))}({projectName:this.state.projectName})}
this.nameCustomEntry=()=>{!function nameCustomEntry({entryName:e,projectId:t}){sendIsLoading()
B$.Z.nameCustomEntry({entryName:e,projectId:t}).fail(v.ZP.notifyError).always((()=>{sendDoneLoading()})).done((e=>{Rn.Z.openFile(e.id);(0,$N.Z)(e.folder,Wu.$.NOTEBOOK)
showNextScreen()}))}({entryName:this.state.entryName,projectId:this.props.projectId})
m.j("new_user_flow","finished_notebook_flow")}
this.handleSetNotebookBackground=()=>{this.setBackgroundImage(SW.NOTEBOOK)}
this.handleSetMolBioBackground=()=>{this.setBackgroundImage(SW.MOLBIO)}
this.handleSetDefaultBackground=()=>{this.setBackgroundImage(SW.DEFAULT)}
this.state={entryName:"",projectName:"",backgroundImage:SW.DEFAULT}
this.setBackgroundImage=(0,It.D)((e=>{this.setState({backgroundImage:e})}),400)}componentDidMount(){(window.matchMedia(jf.Yq).matches?[vW,CW,IW]:[yW,bW,TW]).forEach((e=>{const t=document.createElement("link")
t.href=e
t.rel="preload"
t.as="image"
document.head.appendChild(t)}))}componentDidUpdate(e){e.currentScreen!==this.props.currentScreen&&Object.keys(F$.Kb).includes(this.props.currentScreen)&&m.j("onboarding_page","viewed",{page:F$.Kb[this.props.currentScreen],eventLastModified:"FY22_Q2b3"})}render(){return d.createElement(d.Fragment,null,d.createElement(d.Fragment,null,d.createElement("div",{className:(0,g.iv)(NW.bgImage,NW.bgDefault),style:{display:this.state.backgroundImage===SW.DEFAULT?"inherit":"none"}}),d.createElement("div",{className:(0,g.iv)(NW.bgImage,NW.bgNotebook),style:{display:this.state.backgroundImage===SW.NOTEBOOK?"inherit":"none"}}),d.createElement("div",{className:(0,g.iv)(NW.bgImage,NW.bgMolbio),style:{display:this.state.backgroundImage===SW.MOLBIO?"inherit":"none"}})),d.createElement("div",{className:"newUserFlow-container",style:{position:"relative",top:"-100%"}},(()=>{switch(this.props.currentScreen){case F$.O2:return d.createElement(JoinOrganizationPage,null)
case F$.j2:return d.createElement(new_user_flow_CallToActionScreen,null)
case F$.ji:return d.createElement(new_user_flow_EntryInfoScreen,null)
case F$.qk:return d.createElement(new_user_flow_MolBioInfoScreen,null)
case F$.QF:return d.createElement(fW,{inGettingStartedFlow:!0,isLoading:this.props.isLoading})
case F$.Lv:{const{phoneNumber:e,teamName:t,title:n}=Jn.Z.currentUser()
return d.createElement(fW,{initialPhoneNumber:e,initialTeamName:t,initialTitle:n,inGettingStartedFlow:!1,isLoading:this.props.isLoading})}case F$.eZ:return d.createElement(AffiliationScreen,null)
case F$.Cz:return d.createElement(AcademicRoleInfoScreen,null)
case F$.J:return d.createElement(IndustryRoleInfoScreen,null)
case F$.Uf:return d.createElement(JoinOrganizationScreen,null)
case F$.JC:return d.createElement(MolBioOrNotebookScreen,{hoverOff:this.handleSetDefaultBackground,hoverMolBio:this.handleSetMolBioBackground,hoverNotebook:this.handleSetNotebookBackground})
case null:return null
default:(0,S.Gp)(!1,`NewUserFlowView called with invalid screen: ${this.props.currentScreen}`)
return null}})()))}}const wW=NewUserFlowViewConnector.connect(NewUserFlowView),NW=g.mM.create({bgImage:{backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"100%"},bgDefault:{backgroundImage:`url(${yW})`,...(0,jf.iK)({backgroundImage:`url(${vW})`})},bgNotebook:{backgroundImage:`url(${bW})`,...(0,jf.iK)({backgroundImage:`url(${CW})`})},bgMolbio:{backgroundImage:`url(${TW})`,...(0,jf.iK)({backgroundImage:`url(${IW})`})}})
var AW=n(468011)
function EntityList({entities:e,onChange:t,type:n,validate:a}){const i=e.map(((e,i)=>d.createElement(EntityRow,{key:e.handle,index:i,entity:e,onChange:t,type:n,validate:a})))
return d.createElement("div",null,i.length>0?i:d.createElement("span",{className:"u-tiny-spacing-top u-small-spacing-left"},d.createElement(kl.Z,null)))}function EntityRow({entity:e,index:t,onChange:n,type:a,validate:i}){const s=i(e.initials)
return d.createElement(h.Z,{className:"membersScreen-list-row"},d.createElement(p.Z,{sm:4,className:"membersScreen-list-handle"},e.handle,d.createElement("div",{className:"membersScreen-member-subtext"},a)),d.createElement(p.Z,{sm:4,className:"membersScreen-list-name"},e.name),d.createElement(p.Z,{sm:4},d.createElement(_t.Z,{className:f()("membersScreen-input",{error:s}),value:e.initials,placeholder:"Enter initials",onChange:e=>n(e.target.value,t)}),d.createElement("div",{className:"membersScreen-input-errorMessage"},s)))}EntityList.propTypes={entities:J().arrayOf(XN.fF).isRequired,onChange:J().func.isRequired,type:J().string.isRequired,validate:J().func.isRequired}
EntityRow.propTypes={index:J().number,entity:XN.fF.isRequired,onChange:J().func.isRequired,type:J().string.isRequired,validate:J().func.isRequired}
const RW=EntityList
var PW=n(824168)
const OW=/^[a-zA-Z]+$/
function getInitials({initials:e,name:t}){if(e)return e
if(t){return t.split(" ").map((e=>e.charAt(0).toUpperCase())).join("")}return""}class MembersScreenConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Jn.Z,PW.Z]}enhanceProps(){const e=this.registryActivationFlowStore().getOrganizationId()
return{membersFromStore:(this.entityStore().getMembersForGroup(null!=e?e:"")||[]).map((e=>{const t=getInitials(e)
return{handle:e.handle,id:e.id,initials:t,name:e.name}}))}}}class MembersScreen extends d.Component{constructor(e){super(e)
this._handleOrgChange=e=>{this.setState({organization:Q()(this.state.organization,{initials:{$set:e}})})}
this._handleMemberChange=(e,t)=>{this.setState({members:Q()(this.state.members,{[t]:{initials:{$set:e}}})})}
this._getInitialsErrorOrg=e=>this._getInitialsError(e)
this._getInitialsErrorMember=e=>{const t=this._getInitialsError(e)
if(t)return t
return l.default.filter(this.state.members,(t=>t.initials.toLowerCase()===e.toLowerCase())).length>1?"Member initials must be unique":null}
this._getInitialsError=e=>e?OW.test(e)?null:"Only letters are allowed":"Required"
this._isSubmissionInvalid=()=>!(!this._getInitialsError(this.state.organization.initials)&&!this.state.members.some((e=>this._getInitialsErrorMember(e.initials))))
this._setInitials=()=>{const e={}
this.state.members.forEach((t=>{e[t.id]=t.initials}))
K$.FH(this.state.organization.id,{orgInitials:this.state.organization.initials,initialsByUserId:e},!1)
this.props.onContinue()}
const t=PW.Z.getOrganizationId(),n=Jn.Z.getEntity(null!=t?t:"")
this.state={organization:{id:n.id,handle:n.handle,initials:getInitials(n),name:n.name},members:e.membersFromStore}}componentDidMount(){var e
K$.Mv(null!==(e=PW.Z.getOrganizationId())&&void 0!==e?e:"")}componentDidUpdate(e){e.membersFromStore!==this.props.membersFromStore&&this.setState({members:this.props.membersFromStore})}render(){return d.createElement("div",{className:"registryActivation-container membersScreen-main"},d.createElement("div",{className:"membersScreen-text-container"},d.createElement("h1",null,"Set up your organization's members"),d.createElement("p",null,"Organizations allow team members to easily share and collaborate in the Bioregistry."),d.createElement("p",null,"Each organization and member requires their own unique set of initials. Add initials for them to the right.")),d.createElement("div",{className:"membersScreen-table-container"},d.createElement("div",{className:"u-spacing-top membersScreen-list"},d.createElement(h.Z,{className:"membersScreen-list-header"},d.createElement(p.Z,{sm:4},"Handle"),d.createElement(p.Z,{sm:4},"Name"),d.createElement(p.Z,{sm:4},"Initials")),d.createElement("div",{className:"membersScreen-list-container"},d.createElement(RW,{entities:[this.state.organization],onChange:this._handleOrgChange,type:"Organization",validate:this._getInitialsErrorOrg}),d.createElement(RW,{entities:this.state.members,onChange:this._handleMemberChange,type:"User",validate:this._getInitialsErrorMember}))),d.createElement("div",{className:"registryActivation-button-container"},d.createElement(ContinueButton,{text:"Complete setup",onClick:this._setInitials,primary:!0,disabled:this._isSubmissionInvalid()||0===this.state.members.length}))))}}const xW=MembersScreenConnector.connect(MembersScreen),OrgElement=({onOrganizationClick:e,organization:t,selectedOrganizationId:n})=>{const a=n===t.id
return d.createElement("button",{onClick:function _handleClick(){e(t)},className:f()("button button--large orgList-org-element-button",{"orgList-org-element-button-selected":a,"orgList-org-element-button-not-selected":!a}),type:"button"},t.name)}
OrgElement.propTypes={selectedOrganizationId:J().string,onOrganizationClick:J().func.isRequired,organization:HT.ORGANIZATION.isRequired}
const OrgList=e=>d.createElement("div",{className:"orgList-container"},e.organizations.map(((t,n)=>d.createElement(OrgElement,{key:t.id,organization:t,onOrganizationClick:e.onOrganizationSelected,selectedOrganizationId:e.selectedOrganizationId}))))
OrgList.propTypes={selectedOrganizationId:J().string,organizations:J().arrayOf(HT.ORGANIZATION),onOrganizationSelected:J().func.isRequired}
const _W=OrgList
var DW=n(259219)
class OrgScreenConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Jn.Z,PW.Z]}_isEntityStoreUser(e){return null!=e.organizations}enhanceProps(){var e
const t=this.entityStore(),n=t.currentUserId?t.getEntity(t.currentUserId):null
return{organizations:null!=n&&this._isEntityStoreUser(n)?n.organizations:void 0,organizationId:null!==(e=this.registryActivationFlowStore().getOrganizationId())&&void 0!==e?e:void 0}}}class OrgScreen extends d.Component{constructor(){super(...arguments)
this.state={newOrganizationName:"",newOrganizationHandle:""}
this._handleOrganizationSelect=e=>{DW.nD(e)}
this._handleOrganizationNameChange=e=>{const t=e.target.value
this.setState({newOrganizationName:t})}
this._handleOrganizationHandleChange=e=>{const t=e.target.value
this.setState({newOrganizationHandle:t})}
this._handleCreateOrganization=()=>{DW.wt()
K$.Ue({name:this.state.newOrganizationName,handle:this.state.newOrganizationHandle})}}componentDidMount(){J$.Hv()
null!=this.props.organizations&&this.props.organizations.length>0&&DW.nD(this.props.organizations[0])}componentDidUpdate(e){e.isLoading&&this.props.organizationId&&this.props.onContinue()
!e.organizationId&&this.props.organizations&&this.props.organizations.length>0&&DW.nD(this.props.organizations[0])}render(){const e=!this.state.newOrganizationName||!this.state.newOrganizationHandle
return d.createElement("div",{className:"registryActivation-main"},d.createElement("div",{className:"orgScreen-container"},d.createElement("div",{className:"orgScreen-org-selection-container"},this.props.organizations&&0===this.props.organizations.length?d.createElement("h1",null,"Create an Organization"):d.createElement("h1",null,"Set up your Organization"),d.createElement("p",null,"Organizations are the perfect solution to managing data across your lab. Inventory files in the Registry are all shared in one location, so team members can easily collaborate."),(()=>this.props.organizations?0===this.props.organizations.length?d.createElement("div",{className:"u-small-padding-top"},d.createElement("h3",{className:"orgScreen-new-org-subheader"},"Organization Name"),d.createElement(_t.Z,{className:"orgScreen-new-org-form-input",onChange:this._handleOrganizationNameChange,placeholder:"Give your team a name (ex. Pasteur Lab)",value:this.state.newOrganizationName}),d.createElement("h3",{className:"orgScreen-new-org-subheader"},"Handle"),d.createElement(_t.Z,{className:"orgScreen-new-org-form-input",onChange:this._handleOrganizationHandleChange,placeholder:"ex. pasteurlab",value:this.state.newOrganizationHandle}),d.createElement("div",{className:"registryActivation-button-container"},d.createElement(ContinueButton,{text:this.props.isLoading?"Creating...":"Create",onClick:this._handleCreateOrganization,primary:!0,disabled:e||this.props.isLoading}))):d.createElement("div",null,d.createElement("p",null,"Select an organization below to begin your Registry."),d.createElement("div",{className:"orgScreen-org-selection-list"},d.createElement(_W,{onOrganizationSelected:this._handleOrganizationSelect,organizations:this.props.organizations,selectedOrganizationId:this.props.organizationId})),d.createElement("div",{className:"registryActivation-button-container"},d.createElement(ContinueButton,{text:"Next: Set up your Members",onClick:this.props.onContinue,primary:!0,disabled:!this.props.organizationId}))):d.createElement(kl.Z,null))())))}}const LW=OrgScreenConnector.connect(OrgScreen)
var kW=n(475242)
class WebinarScreen extends d.Component{constructor(){super(...arguments)
this._handleTutorialClick=()=>{m.j("registry_activation","tutorial",{existing_registry:this.props.existingRegistry})}
this._handleWebinarClick=()=>{m.j("registry_activation","webinar",{existing_registry:this.props.existingRegistry})}}render(){return d.createElement("div",{className:"registryActivation-main"},d.createElement("div",null,d.createElement("h1",{className:"registryActivation-header"},this.props.headerText),d.createElement("div",{className:"webinarScreen-paragraph registryActivation-container-content"},d.createElement("p",null,this.props.paragraphText),d.createElement("p",null,"To learn more about the Registry, visit our tutorials"," ",d.createElement("a",{href:kW.F.REGISTRY_CREATING_NEW_DATA,target:"_blank",rel:"noopener noreferrer",onClick:this._handleTutorialClick},"here")," ","or watch the recording of our Webinar below!"),d.createElement("div",{className:"webinarScreen-buttons"},d.createElement("span",{className:"webinarScreen-sign-up"},d.createElement("a",{className:"button button--large button--tertiaryBlue",href:"https://www.youtube.com/watch?v=F2XyXv1aaiQ",target:"_blank",rel:"noopener noreferrer",onClick:this._handleWebinarClick},"Watch Webinar")),d.createElement("span",{className:"webinarScreen-continue-button"},d.createElement(ContinueButton,{text:"Start using my Registry",onClick:this.props.onContinue,primary:!0}))))))}}const MW=WebinarScreen,Illustration=({fileName:e})=>d.createElement("center",null,d.createElement("img",{src:`/static/img/landing/bioregistry/${e}`,className:"welcomeScreen-img"}))
Illustration.propTypes={fileName:J().string.isRequired}
const WelcomeScreen=({isLoading:e,onContinue:t})=>d.createElement("div",{className:"registryActivation-main"},d.createElement("div",null,d.createElement("h1",{className:"registryActivation-header"},"Welcome to the Registry, your lab's Inventory Management System"),d.createElement("div",{className:"welcomeScreen-paragraph registryActivation-container-content"},d.createElement("span",null,d.createElement("h2",{className:"registryActivation-container-subheader"},"All Your Samples in One Place"),d.createElement("p",null,"Consolidate disparate databases into one centralized platform. Customized for your lab to include info about box location, lineages, and other fields.")),d.createElement("span",null,d.createElement(Illustration,{fileName:"one-place.png"}))),d.createElement("div",{className:"welcomeScreen-paragraph registryActivation-container-content"},d.createElement("span",null,d.createElement("h2",{className:"registryActivation-container-subheader"},"Standardize Data Capture Across the Lab"),d.createElement("p",null,"Establish standard naming schemes to make searching, tracking, and sharing data streamlined.")),d.createElement("span",null,d.createElement(Illustration,{fileName:"data-capture.png"}))),d.createElement("div",{className:"welcomeScreen-paragraph registryActivation-container-content"},d.createElement("span",null,d.createElement("h2",{className:"registryActivation-container-subheader"},"Gain Transparency into your Research"),d.createElement("div",null,d.createElement("p",null,"Reference samples in your notebook in real time. Never miss important details again, so you can answer questions such as:"),d.createElement("ul",null,d.createElement("li",null,"Which plasmid expresses GFP?"),d.createElement("li",null,"What is the lineage of your strain?"),d.createElement("li",null,"Where is an oligo created?"),d.createElement("li",null,"Who created this cell line?")))),d.createElement("span",null,d.createElement(Illustration,{fileName:"transparency.png"})))),d.createElement("div",{className:"pull-right"},e?d.createElement(ContinueButton,{disabled:!0,text:"Loading...",primary:!0}):d.createElement(ContinueButton,{text:"Set up your Registry",onClick:t,primary:!0})))
WelcomeScreen.propTypes={isLoading:J().bool.isRequired,onContinue:J().func.isRequired}
const FW=WelcomeScreen
class RegistryActivationFlowViewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[xR.Z,PW.Z]}enhanceProps(){return{registries:xR.Z.getRegistries(),isLoading:this.registryActivationFlowStore().getIsLoading()}}}class RegistryActivationFlowView extends d.Component{constructor(){super(...arguments)
this.getRegistry=()=>{var e,t
return null!==(t=null===(e=this.props.registries)||void 0===e?void 0:e[0])&&void 0!==t?t:null}
this.getOrganizationNameFromRegistry=()=>{var e
const t=this.getRegistry()
return this.truncateOrganizationName(null!==(e=null==t?void 0:t.s_owner.name)&&void 0!==e?e:"")}
this.truncateOrganizationName=e=>e.length>25?`${e.substring(0,24)}...`:e
this.handleShowMembersScreen=()=>{DW.Nc(AW.ML)}
this.handleShowWebinarScreen=()=>{DW.Nc(AW.dF)}
this.handleStartUsingExistingRegistry=()=>{DW.zF(!0)
w_.GS(ZP.SA.REGISTRIES)}
this.handleStartUsingRegistry=()=>{DW.pd(PW.Z.getOrganizationId())}
this.handleContinueCreatingRegistry=()=>{null==this.getRegistry()?DW.Nc(AW.B2):DW.Nc(AW.hA)}}render(){return d.createElement("div",{className:"registryActivation-container"},(()=>{var e
switch(this.props.currentScreen){case AW.o6:return d.createElement(FW,{isLoading:!this.props.registries,onContinue:this.handleContinueCreatingRegistry})
case AW.B2:return d.createElement(LW,{onContinue:this.handleShowMembersScreen,isLoading:this.props.isLoading})
case AW.ML:return d.createElement(xW,{onContinue:this.handleShowWebinarScreen})
case AW.hA:return d.createElement(MW,{headerText:`You have already been added to the ${this.getOrganizationNameFromRegistry()}\n                  Registry!`,paragraphText:"Organizations are the perfect solution to managing data across your lab.\n                    Inventory files in the Registry are all shared in one location, so team members can\n                    easily collaborate.",existingRegistry:!0,onContinue:this.handleStartUsingExistingRegistry})
case AW.dF:return d.createElement(MW,{headerText:`Congratulations, you finished setting up the\n                    ${this.truncateOrganizationName(null!==(e=PW.Z.getOrganizationName())&&void 0!==e?e:"")}\n                    Registry!`,paragraphText:"You can edit more Registry settings like Schemas and Dropdowns by going to\n                    the settings icon in your Registry sidepanel or expanded view.",existingRegistry:!1,onContinue:this.handleStartUsingRegistry})
default:(0,S.Gp)(!1,`RegistryActivationFlowView called with invalid screen: ${this.props.currentScreen}`)
return null}})())}}const ZW=RegistryActivationFlowViewConnector.connect(RegistryActivationFlowView)
var BW=n(190365),qW=n(319675)
class InviteMembersSection extends d.Component{constructor(){super(...arguments)
this._handleSubmit=({entity:e,email:t})=>{if(e)this.props.onInviteMember(e)
else{(0,S.hu)(t,"SingleEntityInput should return an email or entity.")
this.props.onInviteMember({email:t})}}
this._filterInvites=(e,t)=>t.filter((e=>![Jn.Z.currentUser(),...this.props.members].some((t=>t.email===e.email||t.handle===e.handle))))}render(){return d.createElement("div",null,d.createElement("div",{className:"u-spacing-bottom u-vertical-center-items"},d.createElement("div",{className:"featureBanner-stepNumber"},"2"),d.createElement(so.R6,null,"Invite your organization members")),d.createElement(qW.$,{allowEmails:dt.ZP.ENABLE_USER_SIGNUPS,allowTeams:!1,allowOrganizations:!1,buttonProps:{buttonStyle:C.ZJ.SECONDARY,size:C.qE.LARGE,text:"Invite"},filterOptions:this._filterInvites,onSubmit:this._handleSubmit,size:nA.I.LARGE}),d.createElement("div",{className:"createOrganizationPage-membersList"},[Jn.Z.currentUser()].concat(this.props.members).map(((e,t)=>{var n
return d.createElement("div",{className:"createOrganizationPage-membersList-member",key:`member-${t}`},d.createElement("div",null,d.createElement(fC.Z,{className:"u-small-spacing-right",size:SC.D.SMALL,entity:e}),null!==(n=(0,Qw.a)(e))&&void 0!==n?n:e.email),t>0&&d.createElement(pe.Z,{className:"faded u-pointer",icon:"close",onClick:()=>{this.props.onRemoveInvite(t-1)}}))}))))}}const VW=InviteMembersSection
class CreateOrganizationPage extends d.Component{constructor(e){super(e)
this._updateCurrentOrganization=e=>{this.setState({organization:Q()(this.state.organization,{$merge:e})})}
this._handleCreateOrganization=()=>{const e=l.default.groupBy(this.state.members,(e=>e.handle?"users":"emails")),t=e.users?e.users.map((e=>e.id)):[],n=e.emails?e.emails.map((e=>e.email)).filter((e=>null!=e)):[],a=this.state.organization.institution?this.state.organization.institution.id:null
K$.rY({name:this.state.organization.name,handle:this.state.organization.handle,avatar:this.state.avatar,institution:a},t,n)}
this._handleInviteMember=e=>{this.setState({members:Q()(this.state.members,{$push:[e]})})}
this._handleRemoveInvite=e=>{this.setState({members:Q()(this.state.members,{$splice:[[e,1]]})})}
this._updateInstitution=e=>{this._updateCurrentOrganization({institution:e})}
const t={name:e.organization.name,handle:""}
this.state={avatar:null,members:[],organization:t}}render(){const e=Boolean(this.state.organization.name&&this.state.organization.handle)
return d.createElement(Db.W2,{size:"lg"},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement("div",{className:"createOrganizationPage-title"},"Set up your organization on Benchling"))),d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:9},d.createElement("div",{className:"u-spacing-bottom u-vertical-center-items"},d.createElement("div",{className:"featureBanner-stepNumber"},"1"),d.createElement(so.R6,null,"Tell us a little about your organization")),d.createElement("form",{onSubmit:this._handleCreateOrganization},d.createElement(Ke.Z,{className:"u-spacing-top"},d.createElement(Je.Z,null,"Give your organization a name"),d.createElement(_t.Z,{value:this.state.organization.name,placeholder:"e.g. Haynes Lab (required)",onChange:e=>{this._updateCurrentOrganization({name:e.target.value})},disabled:this.props.isLoading})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Give your organization a handle (no spaces)"),d.createElement(_t.Z,{name:"__createOrgHandle",placeholder:"e.g. hlab (required)",value:this.state.organization.handle,onChange:e=>{this._updateCurrentOrganization({handle:e.target.value})},disabled:this.props.isLoading})),!dt.ZP.PRIVATE_DEPLOY&&d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Add your institute or university name"),d.createElement(BW.Z,{allowUnverified:!1,onChange:this._updateInstitution,placeholder:"Select an institution or university",value:this.state.organization.institution})),d.createElement(Je.Z,null,"Add an avatar to represent your organization"),d.createElement("input",{type:"file",className:"u-spacing-bottom",disabled:this.props.isLoading,onChange:e=>{this.setState({avatar:e.target.files[0]})}}))),d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:9},d.createElement(VW,{members:this.state.members,onInviteMember:this._handleInviteMember,onRemoveInvite:this._handleRemoveInvite}),d.createElement("div",{className:"u-justify-content-end u-spacing-top"},d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,disabled:this.props.isLoading||!e,onClick:this._handleCreateOrganization,size:C.qE.MEDIUM,text:this.props.isLoading?"Creating...":"Next: Share Projects",dataTestAttrs:{component:"CreateOrganizationPage",element:"nextShareProjects"}})))))}}const UW=CreateOrganizationPage
class CreateTeamPage extends d.Component{constructor(){super(...arguments)
this.state={name:""}
this._updateTeamInfo=({name:e})=>{this.setState({name:e})}
this._handleCreateTeam=()=>{K$.Cm({name:this.state.name,organizationId:this.props.organizationId})}}render(){const e=Boolean(this.state.name)
return d.createElement(Db.W2,{size:"lg"},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement("div",{className:"createTeamPage-title"},"Set up your team on Benchling"))),d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:9},d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Give your team a name"),d.createElement(_t.Z,{placeholder:"e.g. Protein Sciences (required)",value:this.state.name,onChange:e=>{this._updateTeamInfo({name:e.target.value})},disabled:this.props.isLoading})))),d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:9},d.createElement("div",{className:"u-spacing-top"},d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,disabled:this.props.isLoading||!e,onClick:this._handleCreateTeam,size:C.qE.MEDIUM,text:this.props.isLoading?"Creating...":"Create Team"})))))}}const GW=CreateTeamPage
var zW=n(505258),$W=n(179957),WW=n(184997),HW=n(579635),jW=n(777599)
const YW=xa.Ps`
  query TenantBreadcrumbsQuery @skipAudit @engComponent(name: TENANCY) {
    currentTenant {
      id
      displayName
    }
    currentUser {
      id
      isTenantAdmin
    }
  }
`
function TenantBreadcrumbs_Divider(){return d.createElement("span",{className:(0,g.iv)(QW.divider)},"›")}function TenantBreadcrumbs({tenant:e,onTenantClick:t,organization:n,onOrganizationClick:a}){const i=[d.createElement(Cw.Ak,{key:"tenant",text:e.displayName,onClick:t})]
null!=n&&i.push(d.createElement(Cw.Ak,{key:"organization",text:n.name,onClick:a}))
return d.createElement(Cw.ZP,{crumbs:i,divider:d.createElement(TenantBreadcrumbs_Divider,null),showTrailingDivider:null==n})}function QueryingTenantBreadcrumbs(e){if(!dt.ZP.ENABLE_TENANT_ADMIN_CONSOLE)return null
const t={onTenantClick:function onTenantClick(e){de.c4(e,"/admin")},onOrganizationClick:function onOrganizationClick(t){e.organization&&(0,ac.ZP)(`organizations/${e.organization.url_identifier}`)}},VerticalSpacer=()=>d.createElement("div",{className:"u-mini-spacing-bottom invisible",...(0,ee.Z)({component:"TenantBreadcrumbs",element:"verticalSpacer"})},d.createElement(TenantBreadcrumbs,{tenant:{displayName:""},...t,...e}))
return d.createElement(Da.ZP,{query:YW,renderLoading:()=>d.createElement(VerticalSpacer,null)},(({currentTenant:n,currentUser:a})=>(null==a?void 0:a.isTenantAdmin)?d.createElement("div",{className:"u-mini-spacing-bottom u-gray-darker"},d.createElement(TenantBreadcrumbs,{tenant:n,...t,...e})):null))}const QW=g.mM.create({divider:{..._n.HW}})
var KW=n(989652)
function AddBenchlingAppInput(e){return d.createElement(qW.$,{addKeys:[13],allowEmails:!1,allowTeams:!1,allowOrganizations:!1,allowBenchlingApps:!0,buttonProps:{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,text:"Add App"},filterOptions:function filterMembersAndUsers(t,n){if(!e.organizationMembers)return n
n=n.filter((e=>e.type===HT.PartyType.APP))
const a=e.organizationMembers.map((e=>e.id))
return n.filter((e=>!a.includes(e.id)))},onSubmit:function handleSubmit({entity:t}){K$.fZ(e.organizationId,t)},size:nA.I.SMALL,placeholder:"Search for an app"})}class AddMemberInput extends d.Component{constructor(){super(...arguments)
this._handleSubmit=({entity:e,email:t})=>{dt.ZP.ENABLE_USER_PROVISIONING?K$.fZ(this.props.organizationId,e):K$.R2(this.props.organizationId,e&&e.handle||t)}
this._filterMembers=(e,t)=>{if(!this.props.organizationMembers||!this.props.organizationMemberInvites||!this.props.organizationMemberRequests)return t
const n=this.props.organizationMembers.concat(this.props.organizationMemberInvites).concat(this.props.organizationMemberRequests.map((({user:e})=>e)))
return l.default.reject(t,(e=>Boolean(l.default.findWhere(n,{email:e.email})||l.default.findWhere(n,{handle:e.handle}))))}}render(){return d.createElement(qW.$,{addKeys:[13],allowEmails:dt.ZP.ENABLE_USER_SIGNUPS&&!dt.ZP.ENABLE_USER_PROVISIONING,allowTeams:!1,allowOrganizations:!1,buttonProps:{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,text:dt.ZP.ENABLE_USER_PROVISIONING?"Add":"Invite"},filterOptions:this._filterMembers,onSubmit:this._handleSubmit,size:nA.I.SMALL})}}const JW=AddMemberInput
var XW=n(671509),eH=n(953403),tH=n(585612)
class GroupRow extends d.Component{constructor(){super(...arguments)
this._handleUpdateRole=e=>{this.props.onUpdate({...this.props.groupRowInfo,role:e})}
this._handleSelectGroup=e=>{this.props.onUpdate({...this.props.groupRowInfo,group:e})}}render(){const e=this.props.groupRowInfo.group
return d.createElement("div",{className:(0,g.iv)(nH.groupRow)},d.createElement(tH.Z,{className:(0,g.iv)(nH.groupRowField),disabled:this.props.disabled,groups:this.props.groups,groupType:this.props.groupType,onSelect:this._handleSelectGroup,selectedGroup:e}),d.createElement($r.ZP,{className:(0,g.iv)(nH.groupRowField),menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL,value:this.props.groupRowInfo.role},l.default.sortBy(Object.keys(this.props.roleToText),(e=>-e)).map((e=>{const t=Number(e)
return d.createElement(N.Z,{key:e,value:t,onSelect:this._handleUpdateRole},this.props.roleToText[t])}))),disabled:this.props.disabled,displayName:this.props.roleToText[this.props.groupRowInfo.role]}),d.createElement("div",{className:(0,g.iv)(nH.groupRowRemoveIcon)},!this.props.disabled&&d.createElement(pe.Z,{icon:"close",className:"u-faded u-pointer",onClick:this.props.onRemove})))}}class GroupsSection extends d.Component{constructor(){super(...arguments)
this._handleAddGroup=()=>{this.props.onUpdate([...this.props.groupRowInfos,this.props.emptyRowInfo])}
this._handleRemoveGroup=e=>{0===e&&1===this.props.groupRowInfos.length?this.props.onUpdate(Q()(this.props.groupRowInfos,{[e]:{$set:this.props.emptyRowInfo}})):this.props.onUpdate(Q()(this.props.groupRowInfos,{$splice:[[e,1]]}))}
this._handleUpdateGroupRow=(e,t)=>{this.props.onUpdate(Q()(this.props.groupRowInfos,{[e]:{$set:t}}))}}render(){const e=this.props.groupRowInfos.filter((e=>null!=e.group)).map((e=>e.group.id))
return d.createElement("div",{className:"u-spacing-top"},d.createElement("div",null,d.createElement(Fr.Z,{label:(0,Mt.kC)((0,Mt.B_)(this.props.groupType))}),!this.props.disabled&&this.props.groups.length>e.length&&d.createElement(vy.Z,{className:"u-mini-spacing-left",onClick:this._handleAddGroup})),this.props.groupRowInfos.map(((t,n)=>d.createElement(GroupRow,{key:n,disabled:this.props.disabled,groups:this.props.groups.filter((t=>!e.includes(t.id))),groupRowInfo:t,onUpdate:e=>{this._handleUpdateGroupRow(n,e)},onRemove:()=>{this._handleRemoveGroup(n)},roleToText:this.props.roleToText,groupType:this.props.groupType}))))}}const nH=g.mM.create({groupRow:{alignItems:"center",display:"flex",marginBottom:12},groupRowField:{flex:1,marginRight:12},groupRowRemoveIcon:{flex:"none"}}),aH={group:null,role:HT.OrganizationPermissionRole.MEMBER},iH={[HT.OrganizationPermissionRole.ADMIN]:"Admin",[HT.OrganizationPermissionRole.MEMBER]:"Member"}
function OrganizationsSection(e){return d.createElement(GroupsSection,{disabled:e.disabled,groups:e.organizations,groupRowInfos:e.organizationRowInfos,onUpdate:e.onUpdate,emptyRowInfo:aH,roleToText:iH,groupType:st.ORGANIZATION})}const sH={group:null,role:HT.TeamPermissionRole.MEMBER},rH={[HT.TeamPermissionRole.ADMIN]:"Admin",[HT.TeamPermissionRole.MEMBER]:"Member"}
function TeamsSection(e){return d.createElement(GroupsSection,{disabled:!1,groups:e.teams,groupRowInfos:e.teamRowInfos,onUpdate:e.onUpdate,emptyRowInfo:sH,roleToText:rH,groupType:st.TEAM})}var oH=n(545082)
const lH=xa.Ps`
  fragment CreateUsersModalFragment on TenantAdminDataNode {
    id
    teams {
      id
      name
      organization {
        id
      }
    }
    organizations {
      id
      name
    }
  }
`
function getInitialOrganizationRowInfo(e,t){const n=e.find((e=>e.id===t))
return n?{group:n,role:HT.OrganizationPermissionRole.MEMBER}:aH}class CreateUsersModal extends d.Component{constructor(e){super(e)
this._handleSubmit=async()=>{let e=null,t=null
if(this.state.showBulkView){const t=(0,Tt.Cb)(this.state.rawText),n=XN.yZ,a=new File([t],n,{type:t.type})
e=await eH.ws(a)}else t=this.state.userRowInfos
const n=this.state.organizationRowInfos.filter((e=>null!=e.group)).map((e=>({organizationId:e.group.id,role:e.role}))),a=this.state.teamRowInfos.filter((e=>null!=e.group)).map((e=>({teamId:e.group.id,role:e.role})))
this.setState({isCreating:!0})
try{await XW.V(e,t,n,a,this.state.shouldSendEmails)
this.props.onSuccess()
this.props.onRequestClose()}catch(e){if(!Cn.d0(e))throw e
this.setState({errorMessage:v.ZP.getFriendlyError(e)})}finally{this.setState({isCreating:!1})}}
this._handleChangeRawText=e=>{this.setState({rawText:e.target.value})}
this._handleToggleView=()=>{this.setState({showBulkView:!this.state.showBulkView})}
this._handleAddUser=()=>{this.setState({userRowInfos:[...this.state.userRowInfos,oH.mn]})}
this._handleUpdateUserRowInfos=e=>{0!==e.length?this.setState({userRowInfos:e}):this.setState({userRowInfos:[oH.mn]})}
this._handleUpdateTeamRowInfos=e=>{this.setState({teamRowInfos:e})}
this._handleUpdateOrganizationRowInfos=e=>{const t=e.filter((e=>null!=e.group)).map((e=>e.group.id)),n=this.state.teamRowInfos.filter((e=>null==e.group||t.includes(e.group.organization.id)))
0===n.length&&n.push(sH)
this.setState({organizationRowInfos:e,teamRowInfos:n})}
this._handleUpdateSendEmails=e=>{this.setState({shouldSendEmails:e.target.checked})}
this._isValid=()=>this.state.showBulkView?this._hasValidSpreadsheetInfo():!this._hasOnlyInitialUserRowInfo()&&!this._hasInvalidEmail()
this._hasOnlyInitialUserRowInfo=()=>1===this.state.userRowInfos.length&&this.state.userRowInfos[0]===oH.mn
this._hasInvalidEmail=()=>l.default.any(this.state.userRowInfos.map((e=>e.hasEmailError)))
this._hasValidSpreadsheetInfo=()=>function validateUserCreationSpreadsheetText(e){const t=e.split(/[\n\r\t]+/g).length,n=e.replace(/[\n\r\t]+/g,",").split(",")
return t<=100&&n.length%3==0&&n.every((e=>Boolean(e)))}(this.state.rawText)
this.state={rawText:"",errorMessage:null,isCreating:!1,userRowInfos:[oH.mn],organizationRowInfos:[getInitialOrganizationRowInfo(e.organizations,e.initialOrganizationId)],teamRowInfos:[sH],shouldSendEmails:!0,showBulkView:!1}}render(){const e=this.state.organizationRowInfos.filter((e=>null!=e.group)).map((e=>e.group.id)),t=this.props.teams.filter((t=>e.includes(t.organization.id)))
return d.createElement("div",null,d.createElement(et.ZP,{onRequestClose:this.props.onRequestClose,onRequestSubmit:this._handleSubmit,title:"Create members",buttons:[{text:this.state.isCreating?"Creating...":"Create",submit:!0,disabled:this.state.isCreating||!this._isValid(),style:C.ZJ.SECONDARY}]},d.createElement("div",{className:"u-lr-split u-small-spacing-bottom"},d.createElement("div",null,d.createElement(Fr.Z,{label:"Users"}),!this.state.showBulkView&&d.createElement(P.ZP,{title:"Use spreadsheet upload to create more than 10 users."},d.createElement(vy.Z,{className:"u-mini-spacing-left",onClick:this._handleAddUser,disabled:this.state.userRowInfos.length>=10}))),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,text:this.state.showBulkView?"Form view":"Upload spreadsheet",onClick:this._handleToggleView,size:C.qE.SMALL})),this.state.showBulkView?d.createElement(NU.Z,{id:"primary-sample-input",label:"Users",labelStyle:Fr.Z.STYLES.HIDDEN,description:"Name, Email, Username (100 max)",descriptionClassName:"u-faded"},d.createElement("textarea",{autoFocus:!0,onChange:this._handleChangeRawText,value:this.state.rawText,rows:8})):d.createElement(oH.ZP,{userRowInfos:this.state.userRowInfos,onUpdate:this._handleUpdateUserRowInfos}),dt.ZP.TENANT_HAS_SAML&&d.createElement("div",null,d.createElement("strong",null,"Note:")," For SAML SSO, user emails and usernames must match your SAML identity provider to ensure they can log in to the correct account."),this.state.errorMessage&&d.createElement("div",{className:(0,g.iv)(dH.errorMessage)},this.state.errorMessage),this.props.organizations&&this.props.organizations.length>0&&d.createElement(OrganizationsSection,{disabled:!this.props.canSelectOrganizations,organizations:this.props.organizations,organizationRowInfos:this.state.organizationRowInfos,onUpdate:this._handleUpdateOrganizationRowInfos}),this.props.teams&&this.props.teams.length>0&&d.createElement(TeamsSection,{teams:t,teamRowInfos:this.state.teamRowInfos,onUpdate:this._handleUpdateTeamRowInfos}),d.createElement("div",{className:"u-spacing-top"},d.createElement(Io.Z,{checked:this.state.shouldSendEmails,onChange:this._handleUpdateSendEmails,id:"send-email",label:"Send an email to new users with instructions on how to activate their account",dataTestAttrs:{component:"CreateUsersModal",element:"checkbox"}}))))}}CreateUsersModal.defaultProps={canSelectOrganizations:!0}
const cH=CreateUsersModal,dH=g.mM.create({errorMessage:{color:Vt.Zl,marginTop:6,whiteSpace:"pre-wrap"},linkText:{..._n.hv,textDecoration:"none"}})
class CreateUsersButton extends d.Component{constructor(){super(...arguments)
this._handleClick=()=>{(0,Xn.Z)(cH,{canSelectOrganizations:!1,initialOrganizationId:this.props.organization.id,organizations:[this.props.organization],teams:this.props.teams?this.props.teams.map((e=>({...e,organization:{id:e.organizationId}}))):[],onSuccess:()=>{K$.Mv(this.props.organization.id)}})}}render(){return d.createElement(C.Co,{className:"u-mini-spacing-left",icon:"compose",size:C.qE.SMALL,buttonStyle:C.ZJ.SECONDARY,text:"Create members",onClick:this._handleClick})}}var uH=n(864480)
function OrganizationBanner_extends(){OrganizationBanner_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]
for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}
return OrganizationBanner_extends.apply(this,arguments)}function OrganizationFeatureBanner({organizationName:e,seenBannerPreference:t}){return d.createElement(uH.Z,{className:"u-lr-split",seenBannerPreference:t},[{title:`Welcome to ${e}`,subtitle:"An easier way to collaborate with your labmates",imageSource:"/static/img/orgs/team-intro.svg",oversized:!0},{title:"Share protocols, sequences, and projects",subtitle:"Create a shared library of resources for your entire team to use\n            by adding your lab as a collaborator.",imageSource:"/static/img/orgs/team-share.svg",oversized:!1},{title:"Collaborate effortlessly",subtitle:"Share context with collaborators faster by @mentioning them in entries\n            for lightweight reviews and references.",imageSource:"/static/img/orgs/team-at-mention.svg",oversized:!1},{title:"See what your team's working on",subtitle:"View the team calendar to track what projects and plasmids\n            your team is working on this month.",imageSource:"/static/img/orgs/team-calendar.svg",oversized:!1}].map(((e,t)=>d.createElement(uH.Q,OrganizationBanner_extends({},e,{key:t})))))}OrganizationFeatureBanner.propTypes={organizationName:J().string.isRequired,seenBannerPreference:J().string.isRequired}
function OrganizationSignInBanner({organizationName:e}){return d.createElement(uH.Z,null,d.createElement("div",{className:"featureBanner-item"},d.createElement("img",{src:"/static/img/orgs/team-intro.svg",className:"featureBanner-icon featureBanner-icon--large"}),d.createElement("div",null,d.createElement(so.R6,null,`Welcome to ${e}`),d.createElement(so.BB,null,"An easier way to collaborate with your labmates"))),d.createElement("div",{className:"featureBanner-item"},d.createElement("div",{className:"organizationPage-featureBannerSubtext"},"Join Benchling to collaborate effortlessly with your teammates. Share protocols and sequences, @mention your teammates in entries, and plan your work out for the month!",d.createElement("form",{className:"inlineForm inlineForm--secondary u-spacing-top",action:"/signup"},d.createElement("input",{type:"text",name:"email",className:"inlineForm-input inlineForm-input--medium"}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,className:"inlineForm-button",size:C.qE.SMALL,text:"Signup"})))))}OrganizationSignInBanner.propTypes={organizationName:J().string.isRequired}
const mH={ADMIN:0,MEMBER:1,NO_PERMISSION:1/0,PERMISSION_LEVEL_TO_DISPLAY:l.default.object([[0,"Admin"],[1,"Member"]])},pH=SC.D.SMALL,{ADMIN:hH,PERMISSION_LEVEL_TO_DISPLAY:gH}=mH,EH="Name",fH="Handle",SH="Email",yH="Role",bH="Last Seen"
function NameCell({member:e}){return d.createElement("div",null,d.createElement(fC.Z,{entity:e,size:pH}),d.createElement("span",{className:"u-small-spacing-left"},e.name))}class RoleCell extends d.Component{_handleChangeRole(e,t){K$.Wd(this.props.groupId,e.id,t)}render(){const e=this.props.member.level,t=gH[e]
if(!this.props.canManageRoles)return d.createElement("div",null,t)
const n=this.props.isLoading||Jn.Z.currentUser().id===this.props.member.id&&this.props.member.level===hH
return d.createElement($r.ZP,{displayName:t,disabled:n,menu:d.createElement(w.ZP,{scrollable:!1,width:w.ZP.WIDTHS.MEDIUM},Object.keys(gH).map((t=>d.createElement(N.Z,{key:t,onSelect:()=>{e!==parseInt(t,10)&&this._handleChangeRole(this.props.member,parseInt(t,10))}},gH[t])))),dataTestAttrs:{component:"RoleCellDropdown",element:"selectDropdown"}})}}class RemoveCell extends d.Component{_handleRemoveMember(e){const t=e?"yourself":this.props.member.name,n=this.props.member.type===LN.El.USER?this.props.member.email:this.props.member.id,a=(0,Mt.kC)(this.props.groupType)
this.props.isLoading||je.iG(e?`Leave ${a}`:`Remove ${a} Member`,`Clicking OK will remove ${t} (${n}) from the\n        ${this.props.groupType}.`,"danger").done((()=>{K$.Ah(this.props.groupId,this.props.member.id)}))}render(){const e=Jn.Z.currentUser().id===this.props.member.id
return this.props.canManageRoles||e?d.createElement("div",{className:"tableRow--visibleOnHover-content"},d.createElement(P.ZP,{container:"body",placement:P.TQ.TOP,title:e?`Leave ${(0,Mt.kC)(this.props.groupType)}`:"Remove Member"},d.createElement("a",{className:f()("u-faded",{"u-danger-pointer":!this.props.isLoading}),onClick:t=>{this._handleRemoveMember(e)
t.stopPropagation()}},d.createElement(pe.Z,{icon:"format-delete"})))):null}}class BaseMembersTable extends d.Component{constructor(){super(...arguments)
this._getSortValue=(e,t)=>{var n
const{member:a}=e.extra
switch(t){case"memberLevel":return gH[a.level]
case"lastSeen":return(null===(n=this.props.userIdToMemberInfo[a.id])||void 0===n?void 0:n.lastSeen)||""
default:return a[t]}}
this._getRowContentHeight=()=>fC.Z.getHeight(pH)}render(){const e=[{header:EH,accessorKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"name"},{header:"ID",accessorKey:"id",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"id"},{header:fH,accessorKey:"handle",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"handle"}]
if(this.props.shouldShowMemberInfo){e.push({header:SH,accessorKey:"email",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"email"})
e.push({header:yH,accessorKey:"memberLevel",isCollapsible:!1,isSortable:!0,sortKey:"memberLevel"})
e.push({header:bH,accessorKey:"lastSeen",isCollapsible:!1,isSortable:!0,sortKey:"lastSeen"})
e.push({header:"",accessorKey:"remove",isCollapsible:!1,isSortable:!1,width:83})}const t=e.filter((e=>this.props.columnsToRender.includes(e.header))),n=this.props.members.map((e=>{const t=this.props.userIdToMemberInfo[e.id]||{lastSeen:null,loading:!0},n=t.lastSeen?(0,Kl.Z)(t.lastSeen,{days:31,showTime:!1}):null
return{id:e.id,data:{id:e.id,name:d.createElement(NameCell,{member:e}),handle:e.handle,email:this.props.shouldShowMemberInfo&&d.createElement("a",{onClick:e=>{e.stopPropagation()},rel:"noreferrer noopener",href:`mailto:${e.email}`},e.email),memberLevel:this.props.shouldShowMemberInfo&&d.createElement(RoleCell,{groupId:this.props.groupId,canManageRoles:this.props.canManageRoles,isLoading:t.loading,member:e}),lastSeen:n,remove:d.createElement(RemoveCell,{canManageRoles:this.props.canManageRoles,isLoading:t.loading,groupId:this.props.groupId,groupType:this.props.groupType,member:e})},extra:{member:e}}})),a=this.props.shouldShowMemberInfo?[{sortKey:"memberLevel"},{sortKey:"name"}]:[{sortKey:"name"}]
return d.createElement(vr.ZP,{columns:t,getSortValue:this._getSortValue,hasLineBelowHeader:!1,initialRows:n,initialSort:a,getRowContentHeight:this._getRowContentHeight,onRowClick:this.props.onRowClick})}}function BenchlingAppsTable(e){return d.createElement(BaseMembersTable,{columnsToRender:[EH,"ID",yH,bH,""],...e})}const TH=function MembersTable(e){return d.createElement(BaseMembersTable,{columnsToRender:[EH,fH,SH,yH,bH,""],...e})}
function OrganizationBenchlingAppMembersTab({organization:e,organizationBenchlingAppMembers:t,isCurrentUserAdmin:n,isCurrentUserMember:a,userIdToMemberInfo:i}){return t&&i?d.createElement(BenchlingAppsTable,{groupId:e.id,groupType:st.ORGANIZATION,canManageRoles:n,members:t,shouldShowMemberInfo:a,userIdToMemberInfo:i}):d.createElement(kl.b,null)}var vH=n(345640),CH=n(213454)
function calendarDidMount(e,t,n={}){l.default.defer((()=>{vH.Z.deselectCalendarItem()
const[a,i]=e
vH.Z.fetchEntries(a,i,n)
dt.ZP.ENABLE_REQUESTS&&vH.Z.fetchRequests(a,i,n);(0,ln.cr)({feature:on.gx.PROCESSES_SHOW_DETAILS})&&vH.Z.fetchProcessTasks(a,i,n)
t!==CH.wr.MONTH_VIEW&&vH.Z.fetchFiles(a,i,n)}))}function calendarDidUpdate(e,t,n,a,i={}){const[s,r]=e,[o,c]=t,d=!s.isSame(o)||!r.isSame(c)
d&&l.default.defer((()=>{vH.Z.fetchEntries(o,c,i)}))
d&&dt.ZP.ENABLE_REQUESTS&&l.default.defer((()=>{vH.Z.fetchRequests(o,c,i)}))
d&&(0,ln.cr)({feature:on.gx.PROCESSES_SHOW_DETAILS})&&l.default.defer((()=>{vH.Z.fetchProcessTasks(o,c,i)}));(d||n!==a)&&a!==CH.wr.MONTH_VIEW&&l.default.defer((()=>{vH.Z.fetchFiles(o,c,i)}))}var IH=n(348049)
class CalendarSidebarFilter extends d.Component{constructor(){super(...arguments)
this.state={maxMembersToShow:3}
this._handleSeeMoreMembers=()=>{this.setState({maxMembersToShow:this.props.members.length})}
this._handleSeeLessMembers=()=>{this.setState({maxMembersToShow:3})}
this._handleAllMembersToggle=()=>{const e=0===this.props.hiddenMemberIds.length,t=this.props.members.map((e=>e.id))
vH.Z.updateFilteredMembers(t,e)}
this._handleMemberToggle=(e,t)=>{vH.Z.updateFilteredMembers([e],t)}
this.renderProjects=()=>{const e=l.default.sortBy(this.props.projects,(e=>e.name.toLowerCase()))
if(0===e.length)return null
const t=IH.ZP.getProjectColorMapping(this.props.projects)
return d.createElement("div",{className:"calendarSidebarFilter-filterContainer"},d.createElement("div",{className:"calendarSidebarFilter-title"},"Projects"),e.map(((e,n)=>{const a=t[e.id],i=this.props.hiddenProjectIds.includes(e.id)
return d.createElement("div",{key:n},d.createElement("div",{className:"calendarSidebarFilter-option u-pointer",onClick:()=>{vH.Z.toggleProjectHidden(e.id)}},d.createElement("span",{className:"calendarSidebarFilter-projectCheckbox u-mini-spacing-right",style:{backgroundColor:i?void 0:a,border:i?`solid 1px ${Vt.pF}`:void 0}}),d.createElement("span",{className:"legacy-font-proxima-11"},e.name)))})))}
this.renderSeeMoreOrLessToggle=()=>this.props.members.length>this.state.maxMembersToShow?d.createElement("a",{onClick:this._handleSeeMoreMembers},d.createElement(pe.Z,{className:"u-mini-spacing-right",icon:"chevron-down"}),"See More"):this.state.maxMembersToShow>3?d.createElement("a",{onClick:this._handleSeeLessMembers},d.createElement(pe.Z,{className:"u-mini-spacing-right",icon:"chevron-up"}),"See Less"):null
this.renderMembers=()=>{if(!this.props.members||0===this.props.members.length)return null
const e=l.default.sortBy(this.props.members,(e=>e.name.toLowerCase())),t=l.default.object(e.map((e=>[e.id,!this.props.hiddenMemberIds.includes(e.id)])))
return d.createElement("div",null,d.createElement("div",{className:"calendarSidebarFilter-title"},"Members"),d.createElement("div",null,d.createElement("label",{className:"u-pointer"},d.createElement(sw.Z,{className:"calendarSidebarFilter-checkbox",items:e,selectedMap:e=>t[e.id],onChange:this._handleAllMembersToggle}),d.createElement("span",null,"All Members"))),e.slice(0,this.state.maxMembersToShow).map((e=>d.createElement("div",{key:e.id},d.createElement("label",{className:"u-pointer"},d.createElement("input",{className:"calendarSidebarFilter-checkbox",type:"checkbox",checked:t[e.id],onChange:()=>{this._handleMemberToggle(e.id,t[e.id])}}),d.createElement("span",null,e.name))))),this.renderSeeMoreOrLessToggle())}}render(){return d.createElement("div",{className:"calendarSidebarFilter"},this.renderProjects(),this.renderMembers())}}const wH=CalendarSidebarFilter
var NH=n(585624)
const AH={[CH.wr.DAY_VIEW]:"Day",[CH.wr.WEEK_VIEW]:"2 Weeks",[CH.wr.MONTH_VIEW]:"Month"}
class CurrentViewSelector extends d.Component{constructor(){super(...arguments)
this._handleViewChange=e=>{vH.Z.changeView(e)}}render(){return d.createElement("div",{className:"currentViewSelector-container buttonGroup"},[CH.wr.DAY_VIEW,CH.wr.WEEK_VIEW,CH.wr.MONTH_VIEW].map((e=>d.createElement(C.Co,{key:e,buttonStyle:C.ZJ.TERTIARY_GRAY,className:f()({"is-active":this.props.currentView===e}),onClick:()=>{this._handleViewChange(e)},size:C.qE.SMALL,text:AH[e]}))))}}class CalendarToolbar extends d.Component{constructor(){super(...arguments)
this._navigateUnit=()=>{switch(this.props.currentView){case CH.EE:return"days"
case CH.KW:return"weeks"
default:(0,S.hu)(this.props.currentView===CH.uB,`Unexpected view: ${this.props.currentView}`)
return"months"}}
this.navigatePreviousMonth=()=>{vH.Z.navigateDate(this.props.visibleDate.clone().subtract(1,this._navigateUnit()))}
this.navigateNextMonth=()=>{vH.Z.navigateDate(this.props.visibleDate.clone().add(1,this._navigateUnit()))}
this.navigateToday=()=>{vH.Z.navigateDate(Zd()())}}render(){const[e,t]=this.props.viewRange,n=!IH.ZP.isDateBetween(this.props.today,e,t)
return d.createElement("div",{className:"u-lr-split"},d.createElement("div",{className:"u-vertical-center-items"},d.createElement("div",{className:"buttonGroup calendarToolbar-pagination u-mini-spacing-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"chevron-left",onClick:this.navigatePreviousMonth,size:C.qE.SMALL}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,icon:"chevron",onClick:this.navigateNextMonth,size:C.qE.SMALL})),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:"u-small-spacing-right",disabled:!n,onClick:this.navigateToday,size:C.qE.SMALL,text:"Today"}),d.createElement("div",{className:"legacy-font-proxima-17 u-mini-spacing-right"},this.props.viewLabel),this.props.isLoadingData&&d.createElement(Lt.Z,{light:!0})),d.createElement(CurrentViewSelector,{currentView:this.props.currentView}))}}const RH=CalendarToolbar
var PH=n(496022),OH=n(250417),xH=n(285355)
class AccessedFile extends d.Component{openFile(){Rn.Z.openFile(this.props.file.id)}render(){const e=d.createElement(pe.Z,{className:f()("dailyFileActivity-icon",{"dailyFileActivity-icon--compact":this.props.compact}),icon:this.props.file.tagSchema&&this.props.file.tagSchema.iconId||(0,ea.qz)(this.props.file.id)})
return d.createElement("div",{className:f()("accessedFile",{"accessedFile--compact":this.props.compact})},this.props.file.deleted?d.createElement("div",null,e,d.createElement("span",{className:f()("dailyFileActivity-file dailyFileActivity-file--deleted",{"legacy-font-proxima-11":this.props.compact})},this.props.file.name)):d.createElement("a",{className:f()("dailyFileActivity-file",{"legacy-font-proxima-11":this.props.compact}),onClick:()=>{this.openFile()}},e,this.props.file.name),!this.props.compact&&d.createElement("div",{className:"dailyFileActivity-accessTime"},this.props.file.wasModified?"Modified ":"Viewed ",Hr.UT(this.props.file.endAccess,{showYear:!1,showDate:!1,showTime:!0})))}}class DailyFileActivity extends d.Component{modifiedFiles(){return this.props.files.filter((e=>e.wasModified))}readOnlyFiles(){return this.props.files.filter((e=>!e.wasModified))}renderInnerContent(e,t){return d.createElement("div",{className:"dailyFileActivity-inner"},e.length>0&&d.createElement("div",{className:f()({"u-small-spacing-bottom":this.props.compact})},this.props.compact&&d.createElement("div",{className:"dailyFileActivity-header"},"Modified",d.createElement(ih.Z,{className:"u-mini-spacing-left",text:"Files you updated or deleted"})),e.map((e=>d.createElement(AccessedFile,{key:e.id,file:e,compact:this.props.compact})))),t.length>0&&d.createElement("div",null,this.props.compact&&d.createElement("div",{className:f()("dailyFileActivity-header",{"u-tiny-spacing-top":e.length>0})},"Viewed",d.createElement(ih.Z,{className:"u-mini-spacing-left",text:"Files you viewed"})),t.map((e=>d.createElement(AccessedFile,{key:e.id,file:e,compact:this.props.compact})))))}render(){const e=IH.ZP.sortFiles(this.modifiedFiles()),t=IH.ZP.sortFiles(this.readOnlyFiles()),n=f()(this.props.className,"dailyFileActivity",{"dailyFileActivity--compact":this.props.compact})
return this.props.renderAsTD?d.createElement("td",{className:n},this.renderInnerContent(e,t)):d.createElement("div",{className:n},this.renderInnerContent(e,t))}}var _H=n(119389)
function ProcessTaskSummary(e){return d.createElement("div",{className:"u-spacing-bottom"},d.createElement("div",{className:f()((0,g.iv)(DH.header),"u-lr-split")},d.createElement("div",{className:"u-pointer",onClick:()=>{Rn.Z.openFile(e.processTask.process.id)
m.L9(j.Zm.OPENED_TASK_FROM_CALENDAR_ITEM_MODAL,{task_group_api_id:e.processTask.process.id,task_api_id:e.processTask.id})}},d.createElement(pe.Z,{icon:"process-task",className:(0,g.iv)(DH.icon)}),e.processTask.humanId),d.createElement(_H.ZP,{size:SC.D.XXSMALL,maxAvatars:3,parties:IH.ZP.getItemParties(e.processTask),tooltipPlacement:P.TQ.TOP})),d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(DH.assigneeText)},null!=e.processTask.assignee?`Assigned to: ${e.processTask.assignee.name}`:"Unassigned")))}const DH=g.mM.create({icon:{marginRight:6},assigneeText:{wordBreak:"break-word",..._n.MU},header:{color:Vt.t0,..._n.c4,marginBottom:4,":hover":{color:Vt.t0}}})
var LH=n(636878),kH=n(932628)
class EntryTask extends d.Component{_handleChange(){vH.Z.updateEntryTask(this.props.date,this.props.entryId,this.props.entryTask.notePartProvenanceId,!this.props.entryTask.completed)}render(){return d.createElement("label",{className:f()("entryExcerpt-entryTask u-pointer",{"u-faded":this.props.entryTask.completed}),style:{marginLeft:(this.props.entryTask.indentation-1)*kH.sh}},d.createElement("input",{type:"checkbox",checked:this.props.entryTask.completed,className:"u-flex-none",disabled:this.props.isLoadingData,onChange:()=>{this._handleChange()}}),d.createElement("div",{className:"u-small-spacing-left",dangerouslySetInnerHTML:{__html:LH.Z.renderHTML(this.props.entryTask.text,this.props.entryTask.formats)}}))}}class EntryExcerpt extends d.Component{constructor(){super(...arguments)
this._handleEntryClick=()=>{Rn.Z.openFile(this.props.entry.id)}}render(){return d.createElement("div",{className:"u-spacing-bottom"},d.createElement("div",{className:"entryExcerpt-header u-lr-split"},d.createElement("div",{className:"u-pointer",onClick:this._handleEntryClick},d.createElement(pe.Z,{icon:rr.m.Entry,className:"u-mini-spacing-right"}),this.props.entry.name),d.createElement(_H.ZP,{size:SC.D.XXSMALL,maxAvatars:3,parties:this.props.entry.collaborators,tooltipPlacement:P.TQ.TOP})),0===this.props.entry.entryTasks.length?d.createElement("div",null,d.createElement("div",{className:"entryExcerpt-previewText"},this.props.entry.previewText),d.createElement("div",{className:"entryExcerpt-entryTask u-faded u-italic"},"Track your to-do's by adding checkboxes to your entry.")):d.createElement("div",null,this.props.entry.entryTasks.map(((e,t)=>d.createElement(EntryTask,{key:`entryTask-${t}`,date:this.props.date,entryId:this.props.entry.id,entryTask:e,isLoadingData:this.props.isLoadingData})))))}}EntryExcerpt.defaultProps={entryTasks:[]}
const MH=EntryExcerpt
var FH=n(846114)
function RequestSummary(e){return d.createElement("div",{className:"u-spacing-bottom"},d.createElement("div",{className:"entryExcerpt-header u-lr-split"},d.createElement("div",{className:"u-pointer",onClick:()=>{Rn.Z.openFile(e.request.id)}},d.createElement(pe.Z,{icon:"request",className:"u-mini-spacing-right"}),e.request.name),d.createElement(_H.ZP,{size:SC.D.XXSMALL,maxAvatars:3,parties:IH.ZP.getItemParties(e.request),tooltipPlacement:P.TQ.TOP})),d.createElement("div",null,d.createElement("div",{className:"entryExcerpt-previewText"},"Assigned to: ",function getAssigneeText(e,t){return e.length>t?`${e.slice(0,t).join(", ")}...`:e.join(", ")}((0,FH.H)(e.request.assignees).map((({name:e})=>e)),5))))}function DailyProjectActivity(e){return IH.ZP.hasCalendarItems(e.entries,e.requests,e.processTasks)?d.createElement(d.Fragment,null,IH.ZP.sortCalendarItems(e.entries).map((t=>d.createElement(MH,{key:t.id,entry:t,date:e.date,isLoadingData:e.isLoadingData}))),dt.ZP.ENABLE_REQUESTS&&IH.ZP.sortCalendarItems(e.requests).map((e=>d.createElement(RequestSummary,{key:e.id,request:e}))),(0,ln.cr)({feature:on.gx.PROCESSES_SHOW_DETAILS})&&IH.ZP.sortCalendarItems(e.processTasks).map((e=>d.createElement(ProcessTaskSummary,{key:e.id,processTask:e})))):d.createElement("div",{className:"calendarDay-noEntries u-spacing-bottom"},function getNoneText(){const e=[{label:"entries",isEnabled:()=>!0},{label:"workflow tasks",isEnabled:()=>(0,ln.cr)({feature:on.gx.PROCESSES_SHOW_DETAILS})},{label:"requests",isEnabled:()=>dt.ZP.ENABLE_REQUESTS}].filter((({isEnabled:e})=>e())).map((({label:e})=>e))
if(1===e.length)return`No ${e[0]}`
const t=e.slice(0,-1).join(", "),n=e[e.length-1]
return`No ${t}${e.length>2?",":""} or ${n}`}())}class CalendarDayConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP]}enhanceProps(){return{projectColorMapping:this.calendarStore().getProjectColorMapping()}}}class CalendarDay extends d.PureComponent{renderProjects(){if(!IH.ZP.hasCalendarItems(this.props.entries,this.props.files,this.props.requests,this.props.processTasks))return d.createElement("div",{className:"calendarDay-noActivity"},"No activity was found on ",this.props.date.format("dddd, MMMM D, YYYY"),".")
const e=(0,Jt.vM)(this.props.entries,(e=>e.source.id)),t=this.props.files.filter((e=>null!=e.source)),n=(0,Jt.vM)(t,(e=>e.source.id)),a=(0,Jt.vM)(this.props.requests,(e=>e.projectId)),i=(0,Jt.vM)(this.props.processTasks,(e=>e.process.folder.sourceJson.id))
return l.default.sortBy(this.props.projects,(t=>{const s=null!=e[t.id],r=null!=n[t.id],o=null!=a[t.id],l=null!=i[t.id]
return s?o?0:1:o?l?2:3:l?r?4:5:r?6:7})).map((t=>{var s,r,o,l
const c=this.props.projectColorMapping[t.id],u=null!==(s=e[t.id])&&void 0!==s?s:[],m=null!==(r=n[t.id])&&void 0!==r?r:[],p=null!==(o=a[t.id])&&void 0!==o?o:[],h=null!==(l=i[t.id])&&void 0!==l?l:[]
return d.createElement("div",{key:t.id},d.createElement("div",{className:"calendarDay-projectName"},d.createElement("div",{style:{backgroundColor:c},className:"calendarDay-projectCircle"}),t.name),d.createElement(Db.X2,{className:"calendarDay-projectContainer"},d.createElement(Db.JX,{lg:15},d.createElement(DailyProjectActivity,{date:this.props.date,entries:u,requests:p,processTasks:h,isLoadingData:this.props.isLoadingData})),d.createElement(Db.JX,{lg:7},d.createElement(DailyFileActivity,{className:"dailyFileActivity--dayView",compact:!1,files:m}))))}))}render(){return d.createElement("div",null,this.renderProjects())}}const ZH=CalendarDayConnector.connect(CalendarDay)
function CalendarWeekHeader(){return d.createElement("table",{className:"calendarTable"},d.createElement("thead",null,d.createElement("tr",null,l.default.range(7).map((e=>d.createElement("th",{key:e,className:"calendarTable-day"},Zd()().day(e).format("ddd")))))))}class CalendarItemModalConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP]}enhanceProps(){return{isLoadingData:this.calendarStore().isLoadingData(),entries:this.calendarStore().getEntries(),files:this.calendarStore().getNonEntryFiles(),requests:this.calendarStore().getRequests(),processTasks:this.calendarStore().getProcessTasks()}}}class CalendarItemModal extends d.Component{constructor(){super(...arguments)
this._handleItemClick=()=>{ez.RM();(0,ac.ZP)(this.props.item.url)}}render(){var e,t,n,a
const i=this.props.date.format("YYYY-MM-DD"),s=(null!==(e=this.props.entries[i])&&void 0!==e?e:[]).filter((e=>e.source.id===this.props.item.id)),r=(null!==(t=this.props.requests[i])&&void 0!==t?t:[]).filter((e=>e.projectId===this.props.item.id)),o=(null!==(n=this.props.files[i])&&void 0!==n?n:[]).filter((e=>e.source&&e.source.id===this.props.item.id)),l=(null!==(a=this.props.processTasks[i])&&void 0!==a?a:[]).filter((e=>e.process.folder.sourceJson.id===this.props.item.id)),c=d.createElement("div",null,d.createElement("a",{className:"calendarItemModal-name",onClick:this._handleItemClick},this.props.item.name),d.createElement("div",{className:"calendarItemModal-date"},Hr.UT(this.props.date,{showTime:!1})))
return d.createElement(et.ZP,{title:c,onRequestClose:this.props.onRequestClose},d.createElement(DailyProjectActivity,{requests:r,entries:s,processTasks:l,date:this.props.date,isLoadingData:this.props.isLoadingData}),d.createElement(DailyFileActivity,{className:"dailyFileActivity--dayView dailyFileActivity--modal",compact:!1,files:o}))}}const BH=CalendarItemModalConnector.connect(CalendarItemModal)
class CalendarItemDayConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP]}enhanceProps(){return{projectColorMapping:this.calendarStore().getProjectColorMapping()}}}class CalendarItemDay extends d.Component{constructor(){super(...arguments)
this.state={isHovered:!1}
this._handleCloseModal=()=>{vH.Z.deselectCalendarItem()}
this._handleClick=()=>{vH.Z.selectCalendarItem(this.props.item.id,this.props.date)}
this._handleMouseOver=()=>{this.setState({isHovered:!0})}
this._handleMouseOut=()=>{this.setState({isHovered:!1})}
this.backgroundColor=()=>{const e=IH.ZP.getCalenderItemProject(this.props.item)
return Re().rgb(this.props.projectColorMapping[e.id]).brighter(.5).toString()}
this.highlightedBackgroundColor=()=>{const e=this.backgroundColor()
return Re().rgb(e).brighter(.1).toString()}}render(){return d.createElement("div",{style:{width:`${this.props.widthPercentage}%`},className:"calendarItemDay-container"},d.createElement("div",{className:"u-pointer calendarItemDay-content",style:{backgroundColor:this.state.isHovered?this.highlightedBackgroundColor():this.backgroundColor()},onClick:this._handleClick,onMouseOver:this._handleMouseOver,onMouseOut:this._handleMouseOut},d.createElement(M_.Z,{open:this.props.selected},d.createElement(BH,{onRequestClose:this._handleCloseModal,item:IH.ZP.getCalenderItemProject(this.props.item),date:this.props.date}))))}}const qH=CalendarItemDayConnector.connect(CalendarItemDay)
class CalendarItem extends d.Component{shouldComponentUpdate(e){return!Is()(this.props,e)}renderCalendarItem(e){return d.createElement("div",{className:"calendarItem-position"},d.createElement("div",{className:"calendarItem-dayContainer"},null!=this.props.numDays&&l.default.range(this.props.numDays).map((t=>{const n=this.props.date.clone().add(t,"days"),a=null!=this.props.interact&&(0,IH.Bq)(this.props.interact)&&this.props.interact.selectedCalendarItemDay.id===e.id&&n.isSame(this.props.interact.selectedCalendarItemDay.date)
return d.createElement(qH,{key:t,date:n,item:e,widthPercentage:100/this.props.numDays,selected:a})}))),d.createElement("div",{className:"calendarItem-content"},d.createElement(_H.ZP,{avatarClassName:"u-valign-top",className:"u-display-inline",maxAvatars:3,parties:IH.ZP.getItemParties(e),size:SC.D.XXSMALL}),d.createElement("span",{className:"calendarItem-name"},e.name)))}render(){return d.createElement("td",{colSpan:this.props.numDays,className:"calendarItem",onMouseDown:this.props.onMouseDown,onMouseOver:this.props.onMouseOver},null!=this.props.item?this.renderCalendarItem(this.props.item):d.createElement("div",{className:"calendarItem-position"}))}}CalendarItem.defaultProps={numDays:1}
const VH=CalendarItem
class HeaderDate extends d.Component{constructor(){super(...arguments)
this.getIsWithinMouseRange=()=>{if((0,IH.rf)(this.props.interact)||(0,IH.UW)(this.props.interact)){const[e,t]=IH.ZP.rangeFromInteract(this.props.interact)
return IH.ZP.isDateBetween(this.props.date,e,t)}return!1}
this.showDate=()=>{vH.Z.navigateDate(this.props.date)
vH.Z.changeView(CH.wr.DAY_VIEW)}}render(){const e=this.getIsWithinMouseRange()
return d.createElement("th",{key:this.props.date.format(),className:"weekComponent-date",onMouseDown:this.props.onMouseDown,onMouseOver:this.props.onMouseOver},d.createElement("span",{onClick:this.showDate,className:f()("weekComponent-date-text",{"is-today":this.props.date.isSame(this.props.today),"is-withinMouseRange":e})},this.props.renderDate(this.props.date)))}}const UH=HeaderDate
class MouseDownCapturer extends d.Component{componentWillUnmount(){this.removeListeners()}onMouseUp(e){this.removeListeners()
vH.Z.dayMouseUp(e.clientX,e.clientY)}onMouseDown(e){if(0===e.button){vH.Z.dayMouseDown(this.props.date)
o()(window).on("mouseup",(e=>{this.onMouseUp(e)}))}}removeListeners(){o()(window).off("mouseup",(e=>{this.onMouseUp(e)}))}render(){return this.props.children((e=>{this.onMouseDown(e)}))}}class MouseOverCapturer extends d.Component{onMouseOver(){vH.Z.dayMouseOver(this.props.date)}render(){return this.props.children((()=>{this.onMouseOver()}))}}class WeekComponent extends d.Component{constructor(){super(...arguments)
this.getDays=()=>[0,1,2,3,4,5,6].map((e=>this.props.weekStart.clone().add(e,"days")))
this.dateFromDayNum=e=>this.props.weekStart.clone().add(e,"days")
this._calendarItem=e=>null!=e.item?d.createElement(VH,{...e,key:e.item.id}):d.createElement(MouseDownCapturer,{key:e.key,date:e.date},(t=>d.createElement(MouseOverCapturer,{date:e.date},(n=>d.createElement(VH,{...e,onMouseDown:t,onMouseOver:n})))))
this.renderCellsFromLayer=e=>{let t=0
const n=[]
let a=0
for(;a<7;){const i=this.dateFromDayNum(a),s=e[t],r=i.format()
if(null==s){n.push(this._calendarItem({key:r,date:i}))
a++
continue}if(IH.ZP.getItemDate(s).isAfter(i)){n.push(this._calendarItem({key:r,date:i}))
a++
continue}let{numDays:o}=s
o-=i.diff(IH.ZP.getItemDate(s),"days")
const l=7-a
o=Math.min(o,l)
n.push(this._calendarItem({key:r,date:i,item:s,numDays:o,interact:this.props.interact}))
t++
a+=o}return n}
this.renderEmptyLayer=e=>d.createElement("tr",{key:e},[0,1,2,3,4,5,6].map((e=>{const t=this.dateFromDayNum(e)
return this._calendarItem({key:t.format(),date:t})})))}render(){let e=0
return d.createElement("div",{className:"weekComponent"},d.createElement("table",{className:"calendarTable"},d.createElement("thead",null,d.createElement("tr",null,this.getDays().map((e=>d.createElement(MouseDownCapturer,{key:e.format(),date:e},(t=>d.createElement(MouseOverCapturer,{date:e},(n=>d.createElement(UH,{date:e,onMouseDown:t,onMouseOver:n,today:this.props.today,interact:this.props.interact,renderDate:this.props.renderDate}))))))))),d.createElement("tbody",null,(()=>{const t=[]
for(let n=0;n<this.props.items.length;n++){const a=this.props.items[n]
if(0!==a.length){e++
t.push(d.createElement("tr",{key:n},this.renderCellsFromLayer(a)))}}return t})(),(()=>{const t=[]
for(;e<3;){e++
t.push(this.renderEmptyLayer(e))}return t})())))}}const GH=WeekComponent
class CalendarMonth extends d.Component{constructor(){super(...arguments)
this.getWeekStarts=()=>{const e=[]
let t=this.props.startDate.clone()
for(;t.isBefore(this.props.endDate);){e.push(t)
t=t.clone().add(1,"weeks")}return e}
this.renderDate=e=>{const t=IH.ZP.isDateBetween(e,this.props.monthStart,this.props.monthStart.clone().add(1,"month"))
return d.createElement("span",{title:e.format("YYYY-MM-DD"),className:f()({"weekComponent-date-text--faded":!t})},e.format("D"))}}render(){return d.createElement("div",{className:"calendarBorderBottom"},d.createElement(CalendarWeekHeader,null),this.getWeekStarts().map((e=>d.createElement(GH,{key:e.format(),weekStart:e,today:this.props.today,items:IH.ZP.calendarItemsInWeek(this.props.items,e),interact:this.props.interact,renderDate:this.renderDate}))))}}const zH=CalendarMonth
function WeeklyFileActivity({files:e,weekStart:t}){return d.createElement("table",{className:"calendarTable"},d.createElement("tbody",null,d.createElement("tr",null,l.default.range(7).map((n=>{const a=t.clone().add(n,"days")
return d.createElement(DailyFileActivity,{key:n,compact:!0,files:e[a.format("YYYY-MM-DD")]||[],renderAsTD:!0})})))))}WeeklyFileActivity.propTypes={files:J().object.isRequired,weekStart:NH.Bv.isRequired}
const $H=WeeklyFileActivity
function CalendarWeek(e){return d.createElement("div",null,d.createElement(GH,{today:e.today,weekStart:e.weekStart,items:e.items,interact:e.interact,renderDate:e=>d.createElement("span",{title:e.format("YYYY-MM-DD")},e.format("D"))}),e.showWeeklyFileActivity&&d.createElement($H,{files:e.files,weekStart:e.weekStart}))}CalendarWeek.propTypes={today:NH.Bv.isRequired,weekStart:NH.Bv.isRequired,items:J().arrayOf(J().array).isRequired,interact:J().shape({selectedCalendarItemDay:J().shape({id:J().string.isRequired,date:NH.Bv.isRequired})}).isRequired,files:J().object.isRequired,showWeeklyFileActivity:J().bool.isRequired}
CalendarWeek.defaultProps={showWeeklyFileActivity:!0}
const WH=CalendarWeek
var HH=n(999053)
class NewEntryPopoverContent extends d.Component{constructor(){super(...arguments)
this.state={name:`${this.props.startDate.toDate().toLocaleDateString()} Entry`,folderId:Qe.Z.get(Qe.O.NOTEBOOK)}
this.nameInputRef=d.createRef()
this.createEntry=()=>{HH.Z.create({name:this.state.name,folder:this.state.folderId,initialDay:this.props.startDate,numDays:this.props.endDate.diff(this.props.startDate,"days")}).fail(v.ZP.notifyError).done((()=>{vH.Z.closeCreatePopover()
vH.Z.fetchEntries(this.props.startDate,this.props.endDate)
Qe.Z.set(Qe.O.NOTEBOOK,this.state.folderId)
Ys.OZ(Qs.ZP.MODULES.ENTRY,Qs.ZP.CREATE_ENTRY)}))}
this.handleKeyDown=e=>{pn.isEscapeKey(e)&&vH.Z.closeCreatePopover()}
this.closePopover=()=>{vH.Z.closeCreatePopover()}
this.canSubmit=()=>this.state.name.length>0&&null!=this.state.folderId
this.handleSubmit=e=>{e.preventDefault()
this.canSubmit()&&this.createEntry()}}componentDidMount(){const e=u.findDOMNode(this.nameInputRef.current)
e.focus()
e.selectionStart=0
e.selectionEnd=e.value.length}render(){return d.createElement("div",{className:"newEntryPopover"},d.createElement("span",{className:"close pull-right",onClick:this.closePopover},"×"),d.createElement("h4",{className:"u-tiny-spacing-top"},"New Entry"),d.createElement("form",{onSubmit:this.handleSubmit},d.createElement("input",{type:"text",placeholder:"Entry Name",value:this.state.name,onChange:e=>{this.setState({name:e.target.value})},ref:this.nameInputRef,onKeyDown:this.handleKeyDown,onMouseDown:e=>{e.stopPropagation()}}),d.createElement("div",{className:"u-small-spacing-top"},d.createElement(Ye.Z,{enableRedesign:!0,showNotebook:!0,value:this.state.folderId,onChange:e=>{this.setState({folderId:e.target.value})},unsetOnFetchFail:!0})),d.createElement("div",{className:"u-small-spacing-top text-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,type:"submit",disabled:!this.canSubmit(),text:"Create"}))))}}const jH=NewEntryPopoverContent
function NewEntryPositionedPopover({left:e,top:t,startDate:n,endDate:a}){return d.createElement(xH.Z,{className:"u-position-fixed",left:e,top:t},d.createElement(jH,{startDate:n,endDate:a}))}NewEntryPositionedPopover.propTypes={left:J().number.isRequired,top:J().number.isRequired,startDate:NH.Bv.isRequired,endDate:NH.Bv.isRequired}
const YH=NewEntryPositionedPopover
class CalendarView extends d.Component{constructor(){super(...arguments)
this.closeCreatePopover=e=>{xH.Z.mouseDownInPopover(e)||vH.Z.closeCreatePopover()}
this.renderCalendarContent=(e,t)=>{var n,a,i,s,r
switch(this.props.currentView){case CH.wr.MONTH_VIEW:return d.createElement(zH,{today:this.props.today,items:this.props.layeredItems,startDate:e,endDate:t,monthStart:this.props.visibleDate.clone().startOf("month"),interact:this.props.interact})
case CH.wr.WEEK_VIEW:{const t=e,n=e.clone().add(1,"weeks")
return d.createElement("div",{className:"calendarBorderBottom"},d.createElement(CalendarWeekHeader,null),d.createElement(WH,{today:this.props.today,weekStart:t,items:IH.ZP.calendarItemsInWeek(this.props.layeredItems,t),files:this.props.files,interact:this.props.interact,showWeeklyFileActivity:this.props.showWeeklyFileActivity}),d.createElement(WH,{today:this.props.today,weekStart:n,items:IH.ZP.calendarItemsInWeek(this.props.layeredItems,n),files:this.props.files,interact:this.props.interact,showWeeklyFileActivity:this.props.showWeeklyFileActivity}))}default:{(0,S.hu)(this.props.currentView===CH.wr.DAY_VIEW,`Unexpected view: ${this.props.currentView}`)
const e=this.props.visibleDate.format("YYYY-MM-DD")
return d.createElement("div",{className:"calendarView-dayView-container"},d.createElement(ZH,{date:this.props.visibleDate,isLoadingData:this.props.isLoadingData,projects:null!==(n=this.props.projects[e])&&void 0!==n?n:[],entries:null!==(a=this.props.entries[e])&&void 0!==a?a:[],files:null!==(i=this.props.files[e])&&void 0!==i?i:[],requests:null!==(s=this.props.requests[e])&&void 0!==s?s:[],processTasks:null!==(r=this.props.processTasks[e])&&void 0!==r?r:[]}))}}}}render(){const[e,t]=this.props.viewRange
return d.createElement("div",{className:f()("preview-card",CalendarView.CLASS_NAME),onMouseDown:(0,IH.UW)(this.props.interact)?this.closeCreatePopover:void 0},(()=>{if((0,IH.UW)(this.props.interact)){const[e,t]=IH.ZP.rangeFromInteract(this.props.interact)
if(dt.ZP.ELN_ENABLE_SCHEMA_ON_ENTRY_CREATE_MODAL)dt.ZP.ELN_ENABLE_BLANK_ENTRY_CREATION?Xe.bA(PH.Z,d.createElement(PH.Z,{onRequestClose:()=>{Xe.xv(PH.Z)},fulfillments:[],initialDay:e,numDays:t.diff(e,"days")})):Xe.bA(OH.ZP,d.createElement(OH.ZP,{onRequestClose:()=>{Xe.xv(OH.ZP)},onRequestSubmit:t=>{HL.Z.createFromTemplate({...t,initialDay:(0,E_.p6)(e),onSuccess:()=>{Xe.xv(OH.ZP)}})},isTemplateSelectorDisabled:!1}))
else if(dt.ZP.ELN_ENABLE_BLANK_ENTRY_CREATION)return d.createElement(YH,{left:this.props.interact.mouseUpCoords.x,top:this.props.interact.mouseUpCoords.y,startDate:e,endDate:t})}return null})(),this.renderCalendarContent(e,t))}}CalendarView.CLASS_NAME="calendarView"
const QH=CalendarView
class OrganizationCalendarTabConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP,Jn.Z]}enhanceProps(){return{allProjects:this.calendarStore().getAllProjects(),currentView:this.calendarStore().getCurrentView(),hiddenProjectIds:this.calendarStore().getHiddenProjectIds(),hiddenMemberIds:this.calendarStore().getHiddenMemberIds(),interact:this.calendarStore().getInteract(),isLoadingData:this.calendarStore().isLoadingData(),today:this.calendarStore().getToday(),viewLabel:this.calendarStore().getViewLabel(),viewRange:this.calendarStore().getViewRange(),visibleDate:this.calendarStore().getVisibleDate(),projects:this.calendarStore().getProjects(),layeredProjects:this.calendarStore().getLayeredProjects(),entries:this.calendarStore().getEntries(),files:this.calendarStore().getNonEntryFiles(),requests:this.calendarStore().getRequests(),processTasks:this.calendarStore().getProcessTasks(),members:this.entityStore().getMembersForGroup(this.props.organizationId)}}}class OrganizationCalendarTab extends d.Component{componentDidMount(){calendarDidMount(this.props.viewRange,this.props.currentView,{organizationId:this.props.organizationId})}componentDidUpdate(e){calendarDidUpdate(e.viewRange,this.props.viewRange,e.currentView,this.props.currentView,{organizationId:this.props.organizationId})}render(){return d.createElement(Db.X2,{className:"u-small-spacing"},d.createElement(Db.JX,{lg:3},d.createElement(wH,{hiddenProjectIds:this.props.hiddenProjectIds,hiddenMemberIds:this.props.hiddenMemberIds,projects:this.props.allProjects,members:this.props.members})),d.createElement(Db.JX,{lg:18},d.createElement(RH,{currentView:this.props.currentView,isLoadingData:this.props.isLoadingData,today:this.props.today,viewRange:this.props.viewRange,viewLabel:this.props.viewLabel,visibleDate:this.props.visibleDate}),d.createElement("div",{className:"organizationCalendar u-spacing-top"},d.createElement(QH,{currentView:this.props.currentView,entries:this.props.entries,requests:this.props.requests,processTasks:this.props.processTasks,files:this.props.files,interact:this.props.interact,isLoadingData:this.props.isLoadingData,layeredItems:this.props.layeredProjects,projects:this.props.projects,showWeeklyFileActivity:!1,today:this.props.today,viewRange:this.props.viewRange,visibleDate:this.props.visibleDate}))))}}const KH=OrganizationCalendarTabConnector.connect(OrganizationCalendarTab),JH=xa.Ps`
  query UserProjectsListingQuery($userId: StrictString!, $limitOffsetInput: LimitOffsetInput!)
  @skipAudit
  @engComponent(name: IDENTITY) {
    user(id: $userId) {
      ... on UserNode {
        id
        userProjectsListing(limitOffsetInput: $limitOffsetInput) {
          ... on PartyPoliceablesListingNode {
            ...PolicyTablePartyPoliceableListing
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${QT}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,XH="user"
function ProjectPolicyTable(e){const[{limit:t,offset:n},{setLimit:a,setOffset:i}]=useLimitOffset(),s=(0,Da.IJ)(JH,{variables:{userId:e.userId,limitOffsetInput:{limit:t,offset:n}},fetchPolicy:"network-only"})
if(s.type===Da.NI.ERROR){v.ZP.error("Could not load projects; try reloading the page.")
return null}if(s.type===Da.NI.PENDING)return d.createElement(PoliceablePolicyTable,{isLoading:!0,resourceType:"project",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:0},principalType:XH});(0,S.hu)(!(0,ka.CZ)(s.data.user),"Expected user currently being viewed to be readable")
return d.createElement(PoliceablePolicyTable,{isLoading:!1,resourceType:"project",icon:"project",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:s.data.user.userProjectsListing.total},policyTemplate:ZT,partyPoliceablesListing:s.data.user.userProjectsListing,openPoliceablePage:e=>{(0,S.hu)("ProjectNode"===e.__typename,"Expected ProjectNode");(0,ac.ZP)(e.url)},openPoliceableSettingsPage:e=>{(0,S.hu)("ProjectNode"===e.__typename,"Expected ProjectNode");(0,Xn.Z)(BT.M,{permissions:e.permissions,sourceId:e.id,onUpdate:()=>{s.refetch()
i(0)}})},principalType:XH})}const ej=xa.Ps`
  query UserRegistriesListingQuery($userId: StrictString!, $limitOffsetInput: LimitOffsetInput!)
  @skipAudit
  @engComponent(name: IDENTITY) {
    user(id: $userId) {
      ... on UserNode {
        id
        userRegistriesListing(limitOffsetInput: $limitOffsetInput) {
          ... on PartyPoliceablesListingNode {
            ...PolicyTablePartyPoliceableListing
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${QT}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,tj="user"
function RegistryPolicyTable(e){const[{limit:t,offset:n},{setLimit:a,setOffset:i}]=useLimitOffset(),s=(0,Da.IJ)(ej,{variables:{userId:e.userId,limitOffsetInput:{limit:t,offset:n}},fetchPolicy:"network-only"})
if(s.type===Da.NI.ERROR){v.ZP.error("Could not load projects; try reloading the page.")
return null}if(s.type===Da.NI.PENDING)return d.createElement(PoliceablePolicyTable,{isLoading:!0,resourceType:"project",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:0},principalType:tj});(0,S.hu)(!(0,ka.CZ)(s.data.user),"Expected user currently being viewed to be readable")
return d.createElement(PoliceablePolicyTable,{isLoading:!1,resourceType:"registry",icon:"registry",setOffset:i,setLimit:a,pagination:{offset:n,limit:t,total:s.data.user.userRegistriesListing.total},policyTemplate:ZT,getPoliceableDisplayName:e=>{(0,S.hu)("RegistryNode"===e.__typename,"Expected RegistryNode")
return`${e.ownerJson.name} ${e.name}`},partyPoliceablesListing:s.data.user.userRegistriesListing,openPoliceablePage:e=>{(0,S.hu)("RegistryNode"===e.__typename,"Expected RegistryNode");(0,ac.ZP)(e.url)},openPoliceableSettingsPage:e=>{(0,S.hu)("RegistryNode"===e.__typename,"Expected RegistryNode");(0,ac.ZP)(lo.getRegistryGeneralSettingsUrl(e.ownerJson.url_identifier,e.id))},principalType:tj})}const nj=xa.Ps`
  query CurrentTenantQuery @skipAudit @engComponent(name: IDENTITY) {
    currentTenant {
      id
      displayName
    }
  }
`
var aj
!function(e){e.PROJECT="PROJECT"
e.REGISTRY="REGISTRY"}(aj||(aj={}))
const ij={[aj.PROJECT]:"Projects",[aj.REGISTRY]:"Registries"}
function UserDataAccessTab_Sidepanel(e){return d.createElement(d.Fragment,null,d.createElement(Db.X2,{className:(0,g.iv)(sj.sidebarTitle)},d.createElement(MT.Z,null),d.createElement("strong",null,"Resource Types")),Object.keys(aj).map((t=>d.createElement(FT.Z,{key:t,active:e.activeResourceType===t,name:ij[t],icon:d.createElement(MT.Z,null),clickHandler:()=>{e.onChangeActiveResourceType(t)}}))))}function UserDataAccessTabSection(e){const t=(0,Da.IJ)(nj)
if(t.type===Da.NI.PENDING)return d.createElement("div",{className:(0,g.iv)(sj.userDataAccessTabSection)},d.createElement(kl.b,null))
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load tenant details; try reloading the page.")
return null}return d.createElement("div",{className:(0,g.iv)(sj.userDataAccessTabSection)},d.createElement("p",{className:(0,g.iv)(sj.description)},"The user has access to the following ",(0,de._6)(2,e.resourceType.toLowerCase())," in"," ",t.data.currentTenant.displayName," that you have access to. You can see which access policies the user has been granted per ",e.resourceType.toLowerCase()," and view more details on their effective permissions."),d.createElement("p",{className:(0,g.iv)(sj.description)},"This view is limited to ",(0,de._6)(2,e.resourceType.toLowerCase())," you can also access. As a result you may not see a complete list of all the ",(0,de._6)(2,e.resourceType.toLowerCase())," for which this user is a collaborator."),e.children)}function UserDataAccessTab_PolicyTable(e){switch(e.resourceType){case aj.PROJECT:return d.createElement(ProjectPolicyTable,{userId:e.userId})
case aj.REGISTRY:return d.createElement(RegistryPolicyTable,{userId:e.userId})
default:(0,S.hu)(!1,`Unexpected resource type ${(0,Go.vE)(e.resourceType)}`)
return d.createElement(d.Fragment,null)}}function UserDataAccessTab(e){(0,Ul.Z)((()=>{m.L9(j.zR.OPENED_PARTY_DATA_ACCESS_TAB,{objectType:"user",objectId:e.userId})}))
const[t,n]=(0,d.useState)(aj.PROJECT)
return d.createElement(Db.W2,{size:"lg",className:(0,g.iv)(sj.container)},d.createElement(Db.X2,{className:(0,g.iv)(sj.containerRow)},d.createElement(Db.JX,{lg:4,className:f()("sidepanel",(0,g.iv)(sj.sidepanelColumn))},d.createElement(UserDataAccessTab_Sidepanel,{activeResourceType:t,onChangeActiveResourceType:n})),d.createElement(Db.JX,{lg:18},d.createElement(UserDataAccessTabSection,{resourceType:t},d.createElement(UserDataAccessTab_PolicyTable,{resourceType:t,userId:e.userId})))))}const sj=g.mM.create({description:{fontSize:"13px",maxWidth:"1000px"},sidepanelColumn:{padding:"0 15px",position:"static"},container:{height:"100%",paddingLeft:0},containerRow:{overflow:"hidden",height:"100%"},sidebarTitle:{padding:"20px 15px 5px 15px"},userDataAccessTabSection:{padding:"35px 29px"}})
function UserAttribute({label:e,value:t}){return d.createElement("div",{className:"u-small-padding-top u-small-padding-left"},d.createElement(Db.X2,null,d.createElement("strong",null,e)),d.createElement(Db.X2,null,t))}function UserBasicSettingsTab(e){(0,Ul.Z)((()=>{m.L9(j.zR.OPENED_PARTY_BASIC_SETTINGS_TAB,{objectType:"user",objectId:e.user.id})}))
const t={Name:e.user.name,Username:e.user.handle,Email:e.user.email}
return d.createElement(Db.W2,{size:"lg",className:(0,g.iv)(rj.container)},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},Object.entries(t).map((([e,t])=>d.createElement(UserAttribute,{key:e,label:e,value:t}))))))}const rj=g.mM.create({container:{paddingTop:20,fontSize:13}})
function navigateToUserPage(e){m.L9(j.zR.CLICKED_PARTY_SETTINGS,{objectType:"user",objectId:e});(0,ac.ZP)(`users/${e}`)}var oj
!function(e){e.SETTINGS_TAB="SETTINGS_TAB"
e.ACCESS_TAB="ACCESS_TAB"}(oj||(oj={}))
const lj={[oj.SETTINGS_TAB]:"Basic Settings",[oj.ACCESS_TAB]:"Access"},cj=xa.Ps`
  query UserPageQuery($userId: StrictString!) @skipAudit @engComponent(name: IDENTITY) {
    user(id: $userId) {
      ... on UserNode {
        id
        name
        handle
        avatarUrl
        email
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function UserPage(e){(0,d.useEffect)((()=>{(0,de._w)(e.user.name)}),[e.user.name])
return d.createElement(Db.W2,{size:"lg",className:(0,g.iv)(dj.container)},d.createElement(Db.X2,{className:"teamPage-container"},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement(QueryingTenantBreadcrumbs,null),d.createElement("div",{className:"u-vertical-center-items u-spacing-bottom"},d.createElement(fC.Z,{size:SC.D.XLARGE,shape:SC.o.CIRCLE,entity:e.user}),d.createElement("div",{className:"u-small-spacing-left"},d.createElement(so.R6,null,e.user.name),d.createElement("span",{className:"u-gray-darker"},"User"))),d.createElement(KW.Z,{tabs:Object.keys(lj).map((t=>({handleClick:()=>{K$.wc(e.user.id,t)},text:lj[t],isActive:e.activeTab===t})))}))),d.createElement(Db.X2,{className:"organizationPage-sectionContainer"},d.createElement(Db.JX,{lg:22},(()=>{switch(e.activeTab){case oj.SETTINGS_TAB:return d.createElement(UserBasicSettingsTab,{user:e.user})
case oj.ACCESS_TAB:return d.createElement(UserDataAccessTab,{userId:e.user.id})
default:return null}})())))}function QueryingUserPage(e){return d.createElement(Da.ZP,{query:cj,renderLoading:()=>d.createElement(kl.b,null),variables:{userId:e.userId}},(({user:t})=>{var n
return(0,ka.CZ)(t)?d.createElement("div",null,d.createElement("div",{className:"u-gray-darker"},"Inaccessible user id")):d.createElement(UserPage,{user:t,activeTab:null!==(n=oj[e.activeTab])&&void 0!==n?n:oj.SETTINGS_TAB})}))}const dj=g.mM.create({container:{height:"100%"}})
var uj=n(677476)
const PendingMemberCell=({pendingMember:e})=>{const t=e.user?e.user.email:e.email,n=(0,Hr.UT)(e.createdAt,{showYear:!0,showTime:!1})
return d.createElement("div",{className:"u-vertical-center-items"},d.createElement(uj.Z,{text:t.charAt(0).toUpperCase(),size:SC.D.SMALL,backgroundColor:Vt.pF}),d.createElement("div",{className:"u-small-spacing-left"},d.createElement("div",null,t),d.createElement("div",{className:"u-faded"},`${e.userAccepted?"Requested to join on":"Invited"} ${n}`)))}
function RequestApprovalButtons({organizationId:e,request:t}){return d.createElement("div",null,d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:()=>K$.Se(e,t.user.id),size:C.qE.SMALL,text:"Reject Request"}),d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,onClick:()=>K$.KT(e,t.user.id),size:C.qE.SMALL,text:"Approve Request",className:"u-mini-spacing-left"}))}function CancelInviteButton({organizationId:e,email:t}){return d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:()=>K$.Bt(e,t),size:C.qE.SMALL,text:"Cancel Invite"})}class PendingMembersTable extends d.Component{constructor(){super(...arguments)
this.state={showAllPending:!1}
this._getRowContentHeight=()=>40
this._getEmail=e=>e.user?e.user.email:e.email
this._renderPendingMemberButtons=e=>this.props.canManageRoles?e.userAccepted?d.createElement(RequestApprovalButtons,{organizationId:this.props.organizationId,request:e}):d.createElement(CancelInviteButton,{organizationId:this.props.organizationId,email:this._getEmail(e)}):null
this._renderPendingMemberCell=e=>d.createElement("div",{className:"u-lr-split"},d.createElement(PendingMemberCell,{pendingMember:e}),this._renderPendingMemberButtons(e))}render(){if(l.default.isEmpty(this.props.invites)&&l.default.isEmpty(this.props.requests))return null
const e=l.default.groupBy(this.props.requests,"userAccepted"),t=e.true||[],n=e.false||[],a=[...t,...this.props.invites,...n],i=(this.state.showAllPending?a:a.slice(0,3)).map((e=>({id:e.user?e.user.email:e.email,data:{member:this._renderPendingMemberCell(e)},extra:{result:e}})))
return d.createElement("div",{className:this.props.className},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement(lx.ZP,{columns:[{header:"Pending Members",accessorKey:"member",flexGrow:1,isCollapsible:!1,isSortable:!1}],hasLineBelowHeader:!1,rows:i,getRowContentHeight:this._getRowContentHeight})),a.length>3&&d.createElement("a",{onClick:()=>{this.setState({showAllPending:!this.state.showAllPending})},className:"organizationPage-pendingMembersTable-showAllLink"},this.state.showAllPending?"Hide":`Show all ${a.length} pending members`))}}PendingMembersTable.defaultProps={canManageRoles:!1}
const mj=PendingMembersTable
function OrganizationMembersTab(e){return e.organizationMembers&&e.userIdToMemberInfo?d.createElement("div",null,d.createElement(mj,{className:"u-large-spacing-bottom",invites:e.organizationMemberInvites,canManageRoles:e.canManageRoles,requests:e.organizationMemberRequests,organizationId:e.organization.id}),d.createElement(TH,{groupId:e.organization.id,groupType:st.ORGANIZATION,canManageRoles:e.canManageRoles,members:e.organizationMembers,shouldShowMemberInfo:e.isCurrentUserMember||e.canManageRoles,userIdToMemberInfo:e.userIdToMemberInfo,onRowClick:function(e){navigateToUserPage(e.id)}})):d.createElement(kl.b,null)}const pj=SC.D.SMALL
class ProjectsTable extends d.Component{constructor(){super(...arguments)
this.state={sourceIdForProjectSettingsModal:null}
this._handleCloseProjectSettingsModal=()=>{this.setState({sourceIdForProjectSettingsModal:null})
this.props.onUpdateProjectSettings()}
this.openProject=e=>{ez.RM();(0,ac.ZP)(e.url)}
this._getSortValue=(e,t)=>{const{project:n}=e.extra
return"s_owner"===t?n[t].name:n[t]}
this._getRowContentHeight=()=>fC.Z.getHeight(pj)
this._renderName=e=>d.createElement("div",null,d.createElement("a",{className:"organization-projectLink",onClick:()=>{this.openProject(e)}},e.name),e.permissions.admin&&d.createElement(yh.Z,{className:"u-mini-spacing-left tableRow--visibleOnHover-content",onClick:()=>{const{id:t}=e
this.setState({sourceIdForProjectSettingsModal:t})}}))}render(){const e=this.props.projects.reduce(((e,t)=>{e[t.id]=t
return e}),{}),t=l.default.compact([{header:"Name",accessorKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"name"},{header:"Created",accessorKey:"createdAt",isCollapsible:!1,isSortable:!0,sortKey:"createdAt"},dt.ZP.ENABLE_PUBLIC_FOLDERS&&{header:"Visibility",accessorKey:"public",isCollapsible:!1,isSortable:!0,sortKey:"public"},this.props.shouldShowOwnerColumn&&{header:"Owner",accessorKey:"s_owner",isCollapsible:!1,isSortable:!0,sortKey:"s_owner"},{header:"Collaborators",accessorKey:"collaborators",flexGrow:1,isCollapsible:!1,isSortable:!1}]),n=this.props.projects.map((e=>({id:e.id,data:{name:this._renderName(e),createdAt:(0,Kl.Z)(e.createdAt,{days:31,showTime:!1}),public:e.public?"Public":"Private",s_owner:d.createElement(fC.Z,{entity:e.s_owner,size:pj,showTooltip:!0}),collaborators:d.createElement(_H.ZP,{maxAvatars:5,parties:e.collaborators,size:pj,tooltipPlacement:P.TQ.TOP})},icon:d.createElement(pe.Z,{className:"scrollableTable-cell-icon",icon:st.PROJECT}),extra:{project:e}})))
return d.createElement("div",null,d.createElement(M_.Z,{open:Boolean(this.state.sourceIdForProjectSettingsModal)},this.state.sourceIdForProjectSettingsModal&&d.createElement(BT.M,{permissions:e[this.state.sourceIdForProjectSettingsModal].permissions,sourceId:this.state.sourceIdForProjectSettingsModal,onRequestClose:this._handleCloseProjectSettingsModal})),d.createElement(vr.ZP,{columns:t,getSortValue:this._getSortValue,hasLineBelowHeader:!1,initialRows:n,initialSort:this.props.overrideInitialSort?[]:[{sortKey:"name"}],getRowContentHeight:this._getRowContentHeight}))}}ProjectsTable.defaultProps={overrideInitialSort:!1}
const hj=ProjectsTable
class OrganizationProjectsTab extends d.Component{constructor(){super(...arguments)
this._handleUpdateProjectSettings=()=>{K$.bl(this.props.organization.id)}}render(){if(null==this.props.organizationProjects)return d.createElement(kl.b,null)
if(0===this.props.organizationProjects.length)return this.props.isCurrentUserMember?d.createElement("div",null,"This organization has no projects yet."):d.createElement("div",null,"This organization does not have any projects that you can view.")
let[e,t]=l.default.partition(this.props.organizationProjects,(e=>e.s_owner.id===this.props.organization.id))
e=l.default.sortBy(e,(e=>e.name.toLowerCase()))
t=l.default.sortBy(t,(e=>e.name.toLowerCase()))
const n=e.concat(t)
return d.createElement(hj,{onUpdateProjectSettings:this._handleUpdateProjectSettings,overrideInitialSort:!0,projects:n,shouldShowOwnerColumn:!this.props.organization.disablePersonalOwnables})}}const gj=OrganizationProjectsTab
var Ej=n(99100),fj=n(457564)
class TombstoneOrganizationModal extends d.Component{constructor(){super(...arguments)
this.state={projects:null}
this._hasLoaded=()=>Boolean(this.state.projects)
this._handleDelete=()=>{this.props.onRequestSubmit(!0)
this.props.onRequestClose()}}async componentDidMount(){const{projects:e}=await jW.Z.fetchProjects(this.props.organization.id),t=e.filter((e=>e.s_owner.id===this.props.organization.id))
this.setState({projects:t})}render(){return d.createElement(et.ZP,{title:"Confirm Delete Organization",onRequestClose:this.props.onRequestClose,buttons:[{text:"Permanently Delete",onClick:this._handleDelete,disabled:!this._hasLoaded(),style:C.ZJ.NEGATIVE}]},this._hasLoaded()?d.createElement("div",null,d.createElement("p",null,d.createElement("strong",null," Clicking Delete will delete ",this.props.organization.name," permanently.")," Please remove all members from the organization and transfer ownership of all objects before deleting your organization."),d.createElement("p",null,"The following projects are currently owned by the organization."," ",d.createElement("strong",null,"If you don't transfer ownership of the following projects before deleting your organization, you will permanently lose access to these projects.")),d.createElement(fj.Z,{columns:[fj.Z.defaultColumn("Name","name",{render:(e,t)=>d.createElement("span",null,t.name,d.createElement(lC.Z,{item:t}))})],rows:this.state.projects})):d.createElement(kl.b,null))}}const Sj=TombstoneOrganizationModal
class OrganizationSettingsTab extends d.Component{constructor(){super(...arguments)
this.state={name:this.props.organization.name,email:this.props.organization.email,location:this.props.organization.location||"",website:this.props.organization.website||"",institution:this.props.organization.institution,disablePublic:this.props.organization.disablePublic}
this._handleSaveOrganizationChanges=e=>{e.preventDefault()
const t={...this.state}
t.institution&&(t.institution=t.institution.id)
K$.Vx(this.props.organization.id,t)}
this._updateCurrentOrganization=e=>{this.setState(e)}
this._avatarChange=e=>{0!==e.target.files.length&&K$.Hu(this.props.organization.id,e.target.files[0])}
this._handleTombstone=async()=>{await(0,Xn.Z)(Sj,{organization:this.props.organization})&&K$.LI(this.props.organization.id)}
this._handleDelete=async()=>{await je.iG("Delete Organization",`Clicking OK will delete ${this.props.organization.name} permanently. Please remove all members from\n        the organization and transfer ownership of all projects before deleting the organization.`,"danger",{promiseCompatible:!0})&&K$.Mz(this.props.organization.id)}}render(){const e=this.props.isLoading||!this.props.isCurrentUserAdmin
return d.createElement(Db.W2,{size:"md"},!this.props.isCurrentUserAdmin&&d.createElement("p",null,"Please contact an organization admin to update the settings."),d.createElement(Db.X2,null,d.createElement(Db.JX,{md:7},d.createElement("form",{onSubmit:this._handleSaveOrganizationChanges},d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Organization Handle"),d.createElement("input",{className:"form-control",value:this.props.organization.handle,readOnly:!0})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Organization Name"),d.createElement("input",{className:"form-control",value:this.state.name,onChange:e=>{this._updateCurrentOrganization({name:e.target.value})},disabled:e})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Organization Email"),d.createElement("input",{className:"form-control",value:this.state.email,onChange:e=>{this._updateCurrentOrganization({email:e.target.value})},disabled:e})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Location"),d.createElement("input",{className:"form-control",value:this.state.location,onChange:e=>{this._updateCurrentOrganization({location:e.target.value})},disabled:e})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"URL"),d.createElement("input",{className:"form-control",value:this.state.website,onChange:e=>{this._updateCurrentOrganization({website:e.target.value})},disabled:e})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Institution"),d.createElement(BW.Z,{allowUnverified:!1,onChange:e=>{this._updateCurrentOrganization({institution:e})},placeholder:"Select an institution or university",value:this.state.institution})),dt.ZP.ENABLE_PUBLIC_FOLDERS&&d.createElement(Ke.Z,null,d.createElement(Je.Z,null,d.createElement("input",{type:"checkbox",checked:this.state.disablePublic,onChange:e=>{this._updateCurrentOrganization({disablePublic:e.target.checked})},disabled:e}),"Disable public projects for all members",d.createElement(De.Z,{className:"u-mini-spacing-left",onClick:ue.B}))),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,disabled:e,size:C.qE.MEDIUM,text:this.props.isLoading?"Loading...":"Save Changes",type:"submit"}))),d.createElement(Db.JX,{md:4},d.createElement("div",null,d.createElement("h5",{className:"u-no-spacing-top"},"Organization Avatar"),d.createElement(fC.Z,{className:"u-small-spacing-bottom",size:SC.D.XLARGE,shape:SC.o.SQUARE,entity:{avatar_url:this.props.organization.avatar_url,handle:this.props.organization.handle,name:this.props.organization.name}}),d.createElement("input",{type:"file",onChange:this._avatarChange,disabled:e})),d.createElement("hr",null),d.createElement("div",null,d.createElement("h5",null,"Security and Backup"),d.createElement("a",{onClick:()=>{Ej.Z.open()}},"Export Data")),!dt.ZP.PRIVATE_DEPLOY&&d.createElement("div",null,d.createElement("hr",null),d.createElement("div",null,"Visit"," ",d.createElement("a",{href:"/enterprise",target:"_blank",rel:"noopener noreferrer"},"Enterprise plans")," to see more features that Benchling can offer you.")),this.props.isCurrentUserAdmin&&d.createElement("div",null,d.createElement("hr",null),d.createElement("div",null,d.createElement("a",{className:"organizationSettings-delete",onClick:dt.ZP.ENABLE_ARCHIVING_V2?this._handleTombstone:this._handleDelete},"Delete Organization"))))))}}const yj=OrganizationSettingsTab,bj=SC.D.SMALL
class OrganizationTeamsTab extends d.Component{constructor(){super(...arguments)
this._getSortValue=(e,t)=>{const{team:n}=e.extra
return n[t]}
this._getRowContentHeight=()=>fC.Z.getHeight(bj)
this._handleOpenTeamPage=e=>{(0,ac.ZP)(`teams/${e}`)}
this._handleRowClick=e=>{const{team:t}=e.extra
this._handleOpenTeamPage(t.id)}}render(){if(null==this.props.organizationTeams)return d.createElement(kl.b,null)
if(0===this.props.organizationTeams.length)return d.createElement("div",null,"This organization has no teams.")
const e=this.props.organizationTeams.map((e=>({id:e.id,data:{name:d.createElement("div",null,d.createElement(fC.Z,{className:"u-mini-spacing-right",shape:SC.o.SQUARE,entity:e,size:bj}),e.name),description:e.description},extra:{team:e}}))),t=this.props.organizationTeams.filter((e=>e.member))
return d.createElement("div",null,d.createElement(so.zV,null,"Your Teams"),0===t.length?"You have not joined any teams.":d.createElement(h.Z,{className:"u-small-spacing-top"},t.map(((e,t)=>d.createElement(p.Z,{sm:4,className:"u-spacing-bottom",key:t},d.createElement("div",{className:"teams-previewCard",onClick:()=>{this._handleOpenTeamPage(e.id)}},d.createElement(fC.Z,{entity:e,size:SC.D.LARGE,shape:SC.o.SQUARE}),d.createElement("div",{className:"teams-previewCard-info"},d.createElement(so.R6,null,e.name),d.createElement("div",{className:"teams-previewCard-subtitle"},`${e.memberCount||0} ${(0,de._6)(e.memberCount,"Member")}`))))))),d.createElement(so.zV,null,"Teams in ",this.props.organizationName),d.createElement("div",{className:"organizationTeams-table u-small-spacing-top"},d.createElement(vr.ZP,{columns:[{header:"Name",accessorKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"name"},{header:"Description",accessorKey:"description",flexGrow:1,isCollapsible:!1,isSortable:!1,sortKey:"description"}],getSortValue:this._getSortValue,hasLineBelowHeader:!1,initialRows:e,initialSort:[{sortKey:"name"}],onRowClick:this._handleRowClick,getRowContentHeight:this._getRowContentHeight})))}}const Tj=OrganizationTeamsTab
var vj=n(319977)
const{APPS_TAB:Cj,PROJECTS_TAB:Ij,CALENDAR_TAB:wj,MEMBERS_TAB:Nj,SETTINGS_TAB:Aj,TEAMS_TAB:Rj}=HT,Pj={[Cj]:"Apps",[Rj]:"Teams",[Ij]:"Projects",[wj]:"Calendar",[Nj]:"Members",[Aj]:"Settings"},Oj=[Rj,Ij,wj,Nj,Cj,Aj]
class OrganizationPage extends d.Component{constructor(){super(...arguments)
this.state={sentRequestToJoin:(0,vj.XC)(this.props.organization.id)}
this._handleCreateProject=()=>{(0,S.hu)(null!=this.props.allDataPolicies,"Expected data policies to be loaded to create project.")
const e=(0,zW.Kh)(this.props.allDataPolicies);(0,Xn.Z)($W.Z,{initialCollaborators:[{...this.props.organization,memberDataPolicyId:e.id,adminDataPolicyId:null}],preferredOwnerId:this.props.organization.id,onCreateComplete:()=>{K$.bl(this.props.organization.id)},navigateOnSuccess:!1})}
this._handleRequestToJoin=()=>{if(Jn.Z.currentUser()){J$.A$(this.props.organization.id)
this.setState({sentRequestToJoin:!0})}else de.rP()}
this._handleViewTemplates=e=>{ez.RM()
de.c4(e)}}componentDidMount(){m.j("organizations","loaded_organization_page",{organization_handle:this.props.organization.handle})}_handleOpenTab(e){m.j("organizations","clicked_organization_page_tab",{tab:e,organization_handle:this.props.organization.handle})
K$.wc(this.props.organization.id,e)}render(){const e=this.props.organization.admin,t=this.props.organization.member,n=null!=this.props.organization.permissions&&this.props.organization.permissions.manageRoles,a=null!=Jn.Z.currentUser()&&Jn.Z.currentUser().isTenantAdmin
let i=Oj
t||(i=l.default.without(i,wj,Aj,Rj))
dt.ZP.ENABLE_TEAMS||(i=l.default.without(i,Rj))
dt.ZP.ENABLE_BENCHLING_APPS||(i=l.default.without(i,Cj))
const s=l.default.filter(this.props.organizationMembers,(e=>e.type===HT.PartyType.USER)),r=l.default.filter(this.props.organizationMembers,(e=>e.type===HT.PartyType.APP))
let o=!1,c="Create project"
if(0===(0,WW.UP)().length){o=!0
c="Please contact your administrator to create a project"}return d.createElement("div",{className:"organizationPage-container",...(0,ee.Z)({component:"OrganizationPage",element:"root"})},d.createElement(Db.W2,{size:"lg"},Jn.Z.currentUser()?d.createElement(OrganizationFeatureBanner,{organizationName:this.props.organization.name,seenBannerPreference:HT.SEEN_FEATURE_BANNER_PREFERENCE}):d.createElement(OrganizationSignInBanner,{organizationName:this.props.organization.name}),d.createElement(Db.X2,{className:"organizationPage-headerContainer"},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement(QueryingTenantBreadcrumbs,null),d.createElement("div",{className:"u-flex-display u-spacing-bottom"},d.createElement(fC.Z,{size:SC.D.XLARGE,shape:SC.o.SQUARE,entity:this.props.organization}),d.createElement("div",{className:"u-justify-content-center u-vertical-flex u-small-spacing-left"},d.createElement("div",{className:"u-tiny-spacing-bottom"},d.createElement(so.R6,null,this.props.organization.name),d.createElement("div",{className:"u-faded"},"Organization",this.props.organization.enableAdminView&&this.props.organization.admin&&d.createElement("span",null," | ",d.createElement("a",{href:`/${this.props.organization.url_identifier}/admin`,target:"_blank",rel:"noopener noreferrer"},dt.ZP.ENABLE_TENANT_ADMIN_CONSOLE?"View Activity":"View Admin Dashboard")))),d.createElement("div",{className:"u-faded"},this.props.organization.institution&&this.props.organization.institution.name),d.createElement("div",{className:"u-faded"},d.createElement("a",{className:"u-faded",href:this.props.organization.website,target:"_blank",rel:"noopener noreferrer"},this.props.organization.website),this.props.organization.website&&this.props.organization.location&&d.createElement("span",null," · "),this.props.organization.location))),d.createElement("div",{className:"u-lr-split"},d.createElement(KW.Z,{tabs:i.map((e=>({handleClick:()=>{this._handleOpenTab(e)},isActive:this.props.activeTab===e,text:Pj[e]})))}),d.createElement("div",{className:"organizationPage-topCta"},(()=>{if(!t&&!n)return d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,disabled:this.state.sentRequestToJoin,onClick:this._handleRequestToJoin,size:C.qE.SMALL,text:this.state.sentRequestToJoin?"Request sent":"Request to join"})
switch(this.props.activeTab){case Ij:return d.createElement("div",null,d.createElement("a",{onClick:this._handleViewTemplates,href:HW.Z.collectionsURL(),className:"u-mini-spacing-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.SMALL,text:"View Templates"})),d.createElement(P.ZP,{title:c,placement:P.TQ.BOTTOM,container:"body"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,onClick:this._handleCreateProject,size:C.qE.SMALL,text:"Create project",disabled:o})))
case Rj:return e?d.createElement("div",null,d.createElement("a",{href:jW.Z.createTeamPageURL(this.props.organization.url_identifier),className:"u-justify-content-end"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,text:"Create Team"}))):null
case Nj:return n?d.createElement("div",{className:"u-flex-display"},d.createElement(JW,{organizationId:this.props.organization.id,organizationMembers:this.props.organizationMembers,organizationMemberInvites:this.props.organizationMemberInvites,organizationMemberRequests:this.props.organizationMemberRequests}),dt.ZP.ENABLE_USER_PROVISIONING&&a&&d.createElement(CreateUsersButton,{organization:this.props.organization,teams:this.props.organizationTeams})):null
case Cj:return e?d.createElement("div",{className:"u-flex-display"},d.createElement(AddBenchlingAppInput,{organizationId:this.props.organization.id,organizationMembers:this.props.organizationMembers})):null
default:return null}})())))),d.createElement(Db.X2,{className:"organizationPage-sectionContainer"},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement("div",{className:"u-padding-top"},(()=>{switch(this.props.activeTab){case Rj:(0,S.hu)(t,"User must be in org to view teams tab.")
return d.createElement(Tj,{organizationId:this.props.organization.id,organizationName:this.props.organization.name,organizationTeams:this.props.organizationTeams})
case Ij:return d.createElement(gj,{isCurrentUserMember:t,organization:this.props.organization,organizationProjects:this.props.organizationProjects})
case wj:(0,S.hu)(t,"User must be in org to view calendar tab.")
return d.createElement(KH,{organizationId:this.props.organization.id})
case Nj:return d.createElement(OrganizationMembersTab,{isCurrentUserMember:t,canManageRoles:n,organization:this.props.organization,organizationMemberInvites:this.props.organizationMemberInvites,organizationMemberRequests:this.props.organizationMemberRequests,organizationMembers:s,userIdToMemberInfo:this.props.userIdToMemberInfo})
case Cj:return d.createElement(OrganizationBenchlingAppMembersTab,{isCurrentUserAdmin:e,isCurrentUserMember:t,organization:this.props.organization,organizationBenchlingAppMembers:r,userIdToMemberInfo:this.props.userIdToMemberInfo})
case Aj:return d.createElement(yj,{isCurrentUserAdmin:e,isLoading:this.props.isLoading,organization:this.props.organization})
default:return null}})())))))}}OrganizationPage.propTypes={activeTab:J().oneOf(Oj).isRequired,isLoading:J().bool.isRequired,organization:HT.ORGANIZATION.isRequired,organizationProjects:J().arrayOf(J().object),organizationMemberInvites:J().arrayOf(HT.MEMBER_INVITE.isRequired),organizationMemberRequests:J().arrayOf(HT.MEMBER_REQUEST.isRequired),organizationMembers:J().arrayOf(HT.MEMBER.isRequired),organizationTeams:J().array,userIdToMemberInfo:J().object,allDataPolicies:J().arrayOf($T.iN.isRequired)}
const xj=(0,_a.$j)((function OrganizationPage_mapStateToProps(e){return{allDataPolicies:e.models.policies.dataPolicies}}))(OrganizationPage)
var _j=n(216090),Dj=n(199821),Lj=n(69934)
const{PROJECT_TYPE:kj}=DN,Mj=xa.Ps`
  query ShareProjectsPageQuery @skipAudit @engComponent(name: IDENTITY) {
    currentTenant {
      id
      dataPolicies {
        id
        name
        isDefault
        isHidden
      }
    }
  }
`
function PermissionsCell({selectedDataPolicyId:e,onSelectDataPolicy:t,dataPolicies:n}){const a=n.find((({id:t})=>t===e))
return d.createElement(tc.Z,{displayName:(0,Dj.Z)(a),items:[n.map((e=>({key:e.id,name:(0,Dj.Z)(e),handleOnClick:()=>{t(e.id)}})))]})}class ShareProjectsPage extends d.Component{constructor(){super(...arguments)
this.state=this.getInitialState()
this._getRowContentHeight=()=>28
this._handleShareProjects=()=>{const e=l.default.filter(this.state.projects,(e=>this.state.projectToSelected[e.id])),t=l.default.map(e,(e=>e.id)),n=l.default.map(e,(e=>this.state.projectToPolicyIds[e.id]))
K$.PR(t,n,this.props.organizationId)}
this._handleToggleSelectProjects=(e,t)=>{let n=this.state.projectToSelected
e.forEach((e=>{n=Object.assign(n,{[e.id]:t})}))
this.setState({projectToSelected:n})}}getInitialState(){const e=xR.Z.getSources().filter((({sourceType:e,owner:t})=>t&&e===kj)),t=(0,zW.Kh)(this.props.userFacingDataPolicies),n=l.default.object(e.map((e=>[e.id,t.id]))),a=l.default.object(e.map((e=>[e.id,!1])))
return{projects:e,projectToPolicyIds:n,projectToSelected:a}}render(){const e=l.default.map(this.state.projects,(e=>({id:e.id,data:{name:e.name,createdAt:(0,Hr.UT)(e.createdAt),permissions:d.createElement(PermissionsCell,{dataPolicies:this.props.userFacingDataPolicies,selectedDataPolicyId:this.state.projectToPolicyIds[e.id],onSelectDataPolicy:t=>{this.setState({projectToPolicyIds:Q()(this.state.projectToPolicyIds,{$merge:{[e.id]:t}}),projectToSelected:Q()(this.state.projectToSelected,{$merge:{[e.id]:!0}})})}})},isSelected:this.state.projectToSelected[e.id]})))
return d.createElement(Db.W2,{size:"lg"},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:20},d.createElement("div",{className:"shareProjectsPage-title u-tiny-spacing-bottom"},"Choose projects to share with your organization"))),d.createElement(Db.X2,{className:"u-spacing-bottom"},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:20},d.createElement("div",{className:"shareProjectsPage-subtitle"},d.createElement(so.R6,null,"Build a library of shared resources to increase collaboration and visibility")),d.createElement(lx.ZP,{rowSelectionMode:Tr.rT.MULTIPLE,columns:[{header:"Project Name",accessorKey:"name",flexGrow:1},{header:"Created",accessorKey:"createdAt",flexGrow:1},{header:"Permissions",accessorKey:"permissions",flexGrow:1}],onRowsSelect:this._handleToggleSelectProjects,getRowContentHeight:this._getRowContentHeight,rows:e}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,onClick:this._handleShareProjects,disabled:this.props.isLoading,className:"pull-right u-small-spacing-top",size:C.qE.MEDIUM,text:this.props.isLoading?"Completing Setup...":"Share and Complete Setup",dataTestAttrs:{component:"ShareProjectsPage",element:"complete"}}))))}}function QueryingShareProjectsPage(e){const t=(0,Da.IJ)(Mj)
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load tenant. Try reloading the page.")
return null}if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null)
{const n=t.data.currentTenant.dataPolicies,a=(0,Lj.Z)(n)
return d.createElement(ShareProjectsPage,{userFacingDataPolicies:a,organizationId:e.organizationId,isLoading:e.isLoading})}}function AddTeamMemberInput({team:e,existingMembers:t,organizationId:n,type:a}){return d.createElement(qW.$,{addKeys:[13],allowEmails:!1,allowTeams:!1,allowOrganizations:!1,size:nA.I.SMALL,allowBenchlingApps:a===HT.PartyType.APP,buttonProps:{buttonStyle:C.ZJ.SECONDARY,size:C.qE.SMALL,text:a===HT.PartyType.APP?"Add App":"Add Member"},filterOptions:function filterExistingMembersAndIncorrectType(e,n){if(!t)return n
n=n.filter((e=>e.type===a))
const i=t.map((e=>e.id))
return n.filter((e=>!i.includes(e.id)))},onSubmit:function handleAddTeamMember({entity:t}){t&&K$.Lt(e.id,t)},organizationIds:[n],placeholder:a===HT.PartyType.APP?"Search for an app":"Search for a user"})}function TeamBenchlingAppMembersTab({team:e,teamBenchlingAppMembers:t,isCurrentUserAdmin:n,shouldShowMemberInfo:a,userIdToMemberInfo:i}){return t&&i?0===t.length?d.createElement("div",null,"No apps yet."):d.createElement(BenchlingAppsTable,{groupId:e.id,groupType:st.TEAM,canManageRoles:n,members:t,shouldShowMemberInfo:a,userIdToMemberInfo:i}):d.createElement(kl.b,null)}class TeamCalendarTabConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP,Jn.Z]}enhanceProps(){return{allProjects:this.calendarStore().getAllProjects(),currentView:this.calendarStore().getCurrentView(),hiddenProjectIds:this.calendarStore().getHiddenProjectIds(),hiddenMemberIds:this.calendarStore().getHiddenMemberIds(),interact:this.calendarStore().getInteract(),isLoadingData:this.calendarStore().isLoadingData(),today:this.calendarStore().getToday(),viewLabel:this.calendarStore().getViewLabel(),viewRange:this.calendarStore().getViewRange(),visibleDate:this.calendarStore().getVisibleDate(),projects:this.calendarStore().getProjects(),layeredProjects:this.calendarStore().getLayeredProjects(),entries:this.calendarStore().getEntries(),files:this.calendarStore().getNonEntryFiles(),requests:this.calendarStore().getRequests(),processTasks:this.calendarStore().getProcessTasks(),members:this.entityStore().getMembersForGroup(this.props.teamId)}}}class TeamCalendarTab extends d.Component{componentDidMount(){calendarDidMount(this.props.viewRange,this.props.currentView,{teamId:this.props.teamId})}componentDidUpdate(e){calendarDidUpdate(e.viewRange,this.props.viewRange,e.currentView,this.props.currentView,{teamId:this.props.teamId})}render(){return d.createElement(Db.X2,{className:"u-small-spacing"},d.createElement(Db.JX,{lg:3},d.createElement(wH,{hiddenProjectIds:this.props.hiddenProjectIds,hiddenMemberIds:this.props.hiddenMemberIds,projects:this.props.allProjects,members:this.props.members})),d.createElement(Db.JX,{lg:18},d.createElement(RH,{currentView:this.props.currentView,isLoadingData:this.props.isLoadingData,today:this.props.today,viewRange:this.props.viewRange,viewLabel:this.props.viewLabel,visibleDate:this.props.visibleDate}),d.createElement("div",{className:"organizationCalendar u-spacing-top"},d.createElement(QH,{currentView:this.props.currentView,entries:this.props.entries,files:this.props.files,processTasks:this.props.processTasks,requests:this.props.requests,interact:this.props.interact,isLoadingData:this.props.isLoadingData,layeredItems:this.props.layeredProjects,projects:this.props.projects,showWeeklyFileActivity:!1,today:this.props.today,viewRange:this.props.viewRange,visibleDate:this.props.visibleDate}))))}}const Fj=TeamCalendarTabConnector.connect(TeamCalendarTab)
function TeamMembersTab({team:e,teamMembers:t,isCurrentUserAdmin:n,shouldShowMemberInfo:a,userIdToMemberInfo:i}){return t&&i?0===t.length?d.createElement("div",null,"No members yet."):d.createElement(TH,{groupId:e.id,groupType:st.TEAM,canManageRoles:n,members:t,shouldShowMemberInfo:a,userIdToMemberInfo:i,onRowClick:function(e){navigateToUserPage(e.id)}}):d.createElement(kl.b,null)}class TeamProjectsTab extends d.Component{constructor(){super(...arguments)
this._handleUpdateProjectSettings=()=>{K$.bl(this.props.teamId)}}render(){return null==this.props.teamProjects?d.createElement(kl.b,null):0===this.props.teamProjects.length?this.props.isCurrentUserMember?d.createElement("div",null,"This team has no projects yet."):d.createElement("div",null,"No projects yet. Projects shared with the team that you have permission to view will show up here."):d.createElement(hj,{onUpdateProjectSettings:this._handleUpdateProjectSettings,projects:this.props.teamProjects,shouldShowOwnerColumn:!1})}}const Zj=TeamProjectsTab
var Bj=n(830893),qj=n(93619)
class DeleteTeamModal extends d.Component{constructor(e){super(e)
this.componentDidMount=async()=>{const{projects:e}=await qj.bl(this.props.team.id),t=e
this.setState({projects:t})}
this._handleDelete=()=>{this.props.onRequestSubmit(!0)
this.props.onRequestClose()}
this.state={projects:null}}_hasLoaded(){return Boolean(this.state.projects)}render(){return d.createElement(et.ZP,{enableRedesign:!0,title:"Confirm Delete Team",onRequestClose:this.props.onRequestClose,buttons:[{text:"Permanently Delete",onClick:this._handleDelete,disabled:!this._hasLoaded(),style:C.ZJ.NEGATIVE}]},this._hasLoaded()?d.createElement("div",null,d.createElement("p",null,d.createElement("strong",null," Are you sure you want to delete ",this.props.team.name,"?")),d.createElement("p",null,"This action is not reversible. The team will be permanently deleted, and all members will be removed."," ",d.createElement("strong",null,"Users in this team may lose access to projects that were shared with this team"),", if the project is not otherwise shared with those users, or shared with a different team or organization that those users are members of."," ")," ",d.createElement("p",null,"The following projects have the team as a collaborator. "),d.createElement(fj.Z,{columns:[fj.Z.defaultColumn("Name","name",{render:(e,t)=>d.createElement("span",null,t.name,d.createElement(lC.Z,{item:t}))})],rows:this.state.projects})):d.createElement(kl.b,null))}}const Vj=DeleteTeamModal,Uj=xa.Ps`
  fragment TeamSettingsTeam on TeamNode {
    id
    avatarUrl
    description
    handle
    isSchemaAdmin
    name
  }
`
class TeamSettingsTab extends d.Component{constructor(){super(...arguments)
this.state={name:this.props.team.name,description:this.props.team.description,isSchemaAdmin:this.props.team.isSchemaAdmin}
this.disableInputs=this.props.isLoading||!this.props.isCurrentUserAdmin
this._handleSaveTeamChanges=e=>{e.preventDefault()
this.disableInputs||K$.fs(this.props.team.id,this.state)}
this._updateCurrentTeam=e=>{this.setState(e)}
this._handleAvatarChange=e=>{K$.q4(this.props.team.id,e.target.files[0])}
this._handleDelete=async()=>{await(0,Xn.Z)(Vj,{team:this.props.team})&&K$.fC(this.props.team.id)}}render(){return d.createElement(Db.W2,{size:"md"},!this.props.isCurrentUserAdmin&&d.createElement("p",null,"Please contact a team admin to update the settings."),d.createElement(Db.X2,null,d.createElement(Db.JX,{md:7},d.createElement("form",{onSubmit:this._handleSaveTeamChanges},d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Team Name"),d.createElement("input",{className:"form-control",value:this.state.name,onChange:e=>{this._updateCurrentTeam({name:e.target.value})},disabled:this.disableInputs})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Team Description"),d.createElement(Bj.Z,{rows:3,value:this.state.description,onChange:e=>{this._updateCurrentTeam({description:e.target.value})},disabled:this.disableInputs})),d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Schema Permissions"),d.createElement(Io.Z,{className:f()("u-flex-display",(0,g.iv)(Gj.checkbox)),id:"is-schema-admin",checked:this.state.isSchemaAdmin,onChange:e=>{this._updateCurrentTeam({isSchemaAdmin:e.target.checked})},label:vj.V$(),disabled:this.disableInputs})),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,disabled:this.disableInputs,size:C.qE.MEDIUM,text:this.props.isLoading?"Loading...":"Save Changes",type:"submit"}))),d.createElement(Db.JX,{md:4},d.createElement("div",null,d.createElement("h5",{className:"u-no-spacing-top"},"Team Avatar"),d.createElement(fC.Z,{className:"u-small-spacing-bottom",size:SC.D.XLARGE,shape:SC.o.SQUARE,entity:this.props.team}),d.createElement("input",{type:"file",onChange:this._handleAvatarChange,disabled:this.disableInputs})),d.createElement("hr",null),(this.props.isCurrentUserAdmin||this.props.isCurrentUserTenantAdmin)&&d.createElement("div",null,d.createElement("a",{className:"organizationSettings-delete",onClick:this._handleDelete},"Delete Team")))))}}const Gj=g.mM.create({checkbox:{whiteSpace:"pre-wrap"}}),zj=TeamSettingsTab,$j=xa.Ps`
  query TeamPageQuery($id: StrictString!) @engComponent(name: EXTERNAL_ADMIN) @skipAudit {
    currentUser {
      id
      isTenantAdmin
    }
    team(id: $id) {
      ... on TeamNode {
        id
        avatarUrl
        handle
        name
        admin
        member
        organization {
          id
          admin
          avatarUrl
          member
          name
          urlIdentifier
          email
        }
        ...TeamSettingsTeam
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${Uj}
  ${(0,La.f)("InaccessibleInfo").fragment}
`,Wj={[HT.PROJECTS_TAB]:"Projects",[HT.CALENDAR_TAB]:"Calendar",[HT.MEMBERS_TAB]:"Members",[HT.APPS_TAB]:"Apps",[HT.SETTINGS_TAB]:"Settings"},Hj=[HT.PROJECTS_TAB,HT.CALENDAR_TAB,HT.MEMBERS_TAB,HT.APPS_TAB,HT.SETTINGS_TAB]
class TeamPage extends d.Component{constructor(){super(...arguments)
this._openOrganizationPage=()=>{(0,ac.ZP)(`organizations/${this.props.team.organization.urlIdentifier}/teams`)}
this._handleOpenTab=e=>{K$.wc(this.props.team.id,e)}}render(){var e,t
let n=Hj
dt.ZP.ENABLE_BENCHLING_APPS||(n=l.default.without(Hj,HT.APPS_TAB))
const a=Sr.u_(this.props.team.name,.9),i=this.props.team.admin||this.props.team.organization.admin,s=this.props.team.member,r=null!==(t=null===(e=this.props.currentUser)||void 0===e?void 0:e.isTenantAdmin)&&void 0!==t&&t,o=r&&dt.ZP.ENABLE_TENANT_ADMIN_CONSOLE
let c,u
if(null!=this.props.teamMembers){c=this.props.teamMembers.filter((e=>e.type===HT.PartyType.USER))
u=this.props.teamMembers.filter((e=>e.type===HT.PartyType.APP))}return d.createElement(Db.W2,{size:"lg"},d.createElement(Db.X2,{className:"teamPage-container",style:{backgroundColor:a,borderBottom:`1px solid ${Sr.u_(this.props.team.name,.4)}`},dataTestAttrs:{component:"TeamPage",element:"root"}},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement(QueryingTenantBreadcrumbs,{organization:{...this.props.team.organization,url_identifier:this.props.team.organization.urlIdentifier}}),d.createElement("div",{className:"u-vertical-center-items u-spacing-bottom"},d.createElement(fC.Z,{size:SC.D.XLARGE,shape:SC.o.SQUARE,entity:this.props.team}),d.createElement("div",{className:"u-small-spacing-left"},d.createElement(so.R6,null,this.props.team.name),d.createElement("div",{className:"teamPage-headerSubtitle"},o?d.createElement("span",{className:"u-gray-darker"},"Team"):d.createElement(d.Fragment,null,d.createElement("span",{className:"u-bold-font-weight"},"Organization "),d.createElement("a",{className:"teamPage-headerLink",onClick:this._openOrganizationPage},this.props.team.organization.name))))),d.createElement("div",{className:"u-lr-split"},d.createElement(KW.Z,{tabs:n.map((e=>({handleClick:()=>{this._handleOpenTab(e)},isActive:this.props.activeTab===e,text:Wj[e]})))}),d.createElement("div",{className:"organizationPage-topCta"},(()=>{switch(this.props.activeTab){case HT.MEMBERS_TAB:return i?d.createElement(AddTeamMemberInput,{existingMembers:c,team:this.props.team,organizationId:this.props.team.organization.id,type:HT.PartyType.USER}):null
case HT.APPS_TAB:return i?d.createElement(AddTeamMemberInput,{existingMembers:u,team:this.props.team,organizationId:this.props.team.organization.id,type:HT.PartyType.APP}):null
default:return null}})())))),d.createElement(Db.X2,{className:"organizationPage-sectionContainer"},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement("div",{className:"u-spacing-top"},(()=>{switch(this.props.activeTab){case HT.PROJECTS_TAB:return d.createElement(Zj,{isCurrentUserMember:s,teamId:this.props.team.id,teamProjects:this.props.teamProjects})
case HT.CALENDAR_TAB:return d.createElement(Fj,{teamId:this.props.team.id})
case HT.MEMBERS_TAB:return d.createElement(TeamMembersTab,{isCurrentUserAdmin:i,shouldShowMemberInfo:this.props.team.organization.member,team:this.props.deprecatedTeam,teamMembers:c,userIdToMemberInfo:this.props.userIdToMemberInfo})
case HT.APPS_TAB:return d.createElement(TeamBenchlingAppMembersTab,{isCurrentUserAdmin:i,shouldShowMemberInfo:this.props.team.organization.member,team:this.props.deprecatedTeam,teamBenchlingAppMembers:u,userIdToMemberInfo:this.props.userIdToMemberInfo})
case HT.SETTINGS_TAB:return d.createElement(zj,{isCurrentUserAdmin:i,isCurrentUserTenantAdmin:r,isLoading:this.props.isLoading,team:this.props.team})
default:return null}})()))))}}function QueryingTeamPage(e){const t=(0,Da.IJ)($j,{fetchPolicy:"cache-and-network",variables:{id:e.deprecatedTeam.id}})
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load team. Try reloading the page.")
return null}if(t.type===Da.NI.PENDING)return d.createElement(kl.b,null);(0,S.hu)(!(0,ka.CZ)(t.data.team),"Team is inaccessible")
return d.createElement(TeamPage,{currentUser:t.data.currentUser,isLoading:e.isLoading,activeTab:e.activeTab,deprecatedTeam:e.deprecatedTeam,team:t.data.team,userIdToMemberInfo:e.userIdToMemberInfo,teamProjects:e.teamProjects,teamMembers:e.teamMembers})}function PartyFullScreenView_defineProperty(e,t,n){(t=function PartyFullScreenView_toPropertyKey(e){var t=function PartyFullScreenView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class PartyFullScreenViewConnector extends oi.C{constructor(...e){super(...e)
PartyFullScreenView_defineProperty(this,"shouldSubscribeToRedux",!1)
PartyFullScreenView_defineProperty(this,"stores",[Jn.Z,_j.Z])}enhanceProps(){const e=this.partyPageStore().getCurrentOrganization(),t=this.partyPageStore().getCurrentTeam()
let n=null
e&&(n=this.entityStore().getMembersForGroup(e.id))
let a=null
t&&(a=this.entityStore().getMembersForGroup(t.id))
return{activeTab:this.partyPageStore().getActiveTab(),isLoading:this.partyPageStore().getIsLoading(),organization:e,organizationMemberInvites:this.partyPageStore().getOrganizationMemberInvites(),organizationMemberRequests:this.partyPageStore().getOrganizationMemberRequests(),organizationMembers:n,organizationProjects:this.partyPageStore().getOrganizationProjects(),organizationTeams:this.partyPageStore().getOrganizationTeams(),team:t,teamMembers:a,teamProjects:this.partyPageStore().getTeamProjects(),userIdToMemberInfo:this.partyPageStore().getUserIdToMemberInfo(),userId:this.partyPageStore().getUserPageUserId()}}}function PartyFullScreenView(e){switch(e.currentScreen){case HT.ORGANIZATION_SCREEN:return d.createElement(xj,{activeTab:e.activeTab,isLoading:e.isLoading,organization:e.organization,organizationMemberInvites:e.organizationMemberInvites,organizationMemberRequests:e.organizationMemberRequests,organizationMembers:e.organizationMembers,organizationProjects:e.organizationProjects,organizationTeams:e.organizationTeams,userIdToMemberInfo:e.userIdToMemberInfo})
case HT.TEAM_SCREEN:return d.createElement(QueryingTeamPage,{activeTab:e.activeTab,isLoading:e.isLoading,deprecatedTeam:e.team,teamMembers:e.teamMembers,teamProjects:e.teamProjects,userIdToMemberInfo:e.userIdToMemberInfo})
case HT.USER_SCREEN:return d.createElement(QueryingUserPage,{activeTab:e.activeTab,userId:e.userId})
case HT.CREATE_ORGANIZATION_SCREEN:return d.createElement(UW,{organization:e.organization,isLoading:e.isLoading})
case HT.CREATE_TEAM_SCREEN:return d.createElement(GW,{organizationId:e.organization.id,isLoading:e.isLoading})
case HT.SHARE_PROJECTS_SCREEN:return d.createElement(QueryingShareProjectsPage,{organizationId:e.organization.id,isLoading:e.isLoading})
default:(0,S.Gp)(!1,`OrganizationView called with invalid screen: ${e.currentScreen}`)
return null}}PartyFullScreenView.propTypes={currentScreen:J().string.isRequired,activeTab:J().oneOf(HT.ALL_TABS),isLoading:J().bool.isRequired,organization:HT.ORGANIZATION,organizationMemberInvites:J().arrayOf(HT.MEMBER_INVITE.isRequired),organizationMemberRequests:J().arrayOf(HT.MEMBER_REQUEST.isRequired),organizationMembers:J().arrayOf(HT.MEMBER.isRequired),organizationProjects:J().arrayOf(J().object),organizationTeams:J().array,team:HT.TEAM,teamMembers:J().arrayOf(HT.MEMBER.isRequired),teamProjects:J().arrayOf(J().object),userIdToMemberInfo:J().object,userId:J().string}
const jj=PartyFullScreenViewConnector.connect(PartyFullScreenView)
var Yj=n(505074),Qj=n(587159),Kj=n(25374),Jj=n(679471)
function LicenseDashboardHeader(e){return d.createElement(d.Fragment,null,d.createElement("h1",null,"Organizations"),d.createElement("ul",null,e.organizations.slice(0,5).map((e=>d.createElement("li",{key:e.id},e.name)))),d.createElement("h1",null,"Teams"),d.createElement("ul",null,e.teams.slice(0,5).map((e=>d.createElement("li",{key:e.id},e.name)))),d.createElement("h1",null,"Applicah1ions"),d.createElement("ul",null,e.applications.slice(0,5).map((e=>d.createElement("li",{key:e.key},e.displayName)))))}function Name({name:e,suspended:t}){return d.createElement(d.Fragment,null,e,t&&d.createElement("span",{className:"u-faded u-mini-spacing-left"},"Suspended"))}var Xj=n(269304)
const eY=xa.Ps`
  fragment UserLicenseTableUser on UserNode {
    id
    name
    suspended
    organizations {
      id
      name
      handle
    }
    teams {
      id
      name
      handle
    }
    capabilities {
      id
      accessLevel
      capability {
        key
      }
    }
  }
`
function UserLicenseCheck({user:e,application:t}){return d.createElement("div",{className:"u-text-align-center"},function userHasLicenseForApplication(e,t){return e.capabilities.some((e=>e.capability.key===t.key&&e.accessLevel!==rn.uv.NO_ACCESS))}(e,t)&&d.createElement(pe.Z,{icon:"check",className:(0,g.iv)(nY.checkIcon)}))}function makeUserColumnData(e,t){return t.reduce(((t,n)=>{t[n.key]=d.createElement(UserLicenseCheck,{user:e,application:n})
return t}),{})}const tY=[{header:"Name",accessorKey:"name",sortKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,disableFiltering:!0},{header:"Organizations",accessorKey:"organizations",isCollapsible:!0,isSortable:!1,disableFiltering:!1},{header:"Teams",accessorKey:"teams",isCollapsible:!0,isSortable:!1,disableFiltering:!1}]
function UserLicenseTable({users:e,applications:t,onChangeSort:n,sortColumn:a,sortDirection:i}){const s=function UserLicenseTable_generateRows(e,t){return e.map(((e,n)=>({id:e.id,icon:d.createElement(fC.Z,{entity:e,shape:SC.o.CIRCLE,size:SC.D.XSMALL}),data:{name:d.createElement(Name,{name:e.name,suspended:e.suspended}),organizations:d.createElement(wv.Z,{parties:(0,hs.Z)(e.organizations,[e=>e.name.toLowerCase()])}),teams:d.createElement(wv.Z,{parties:(0,hs.Z)(e.teams,[e=>e.name.toLowerCase()])}),...makeUserColumnData(e,t)}})))}(e,t),r=function generateApplicationColumns(e){return e.map((e=>({header:e.displayName,accessorKey:e.key,sortKey:e.key,flexGrow:1,isCollapsible:!0,isSortable:!1,disableFiltering:!1})))}(t),o=[...tY,...r].map((e=>({...e,sortDirection:e.accessorKey===a?i:null})))
return d.createElement(Xj.Z,{canFilterColumns:!0,canResizeColumns:!0,tableKey:"UserLicenseTable",className:"u-flex-grow",columns:o,getRowContentHeight:()=>fC.Z.getHeight(SC.D.SMALL),hasLineBelowHeader:!0,rows:s,isCompact:!1,onChangeSort:n})}const nY=g.mM.create({checkIcon:{color:Vt.t0}}),aY="apiKeyCreated",iY={sortKey:Sn.gw.NAME,sortDirection:Sn.Sr.ASCENDING}
function getUpdatedSortForAccessorKey(e,t){const n=sY[t]
return{sortKey:n,sortDirection:n===e.sortKey?function _getReverseDirection(e){return e===Sn.Sr.ASCENDING?Sn.Sr.DESCENDING:Sn.Sr.ASCENDING}(e.sortDirection):e.sortDirection}}const sY={[aY]:Sn.gw.API_KEY_CREATED_AT,name:Sn.gw.NAME,handle:Sn.gw.HANDLE,email:Sn.gw.EMAIL,lastSeen:Sn.gw.LAST_SEEN,passwordLastChangedAt:Sn.gw.PASSWORD_LAST_CHANGED_AT},rY=l.default.invert(sY)
Sn.gw.API_KEY_CREATED_AT,Sn.gw.NAME,Sn.gw.EMAIL,Sn.gw.HANDLE,Sn.gw.LAST_SEEN,Sn.gw.PASSWORD_LAST_CHANGED_AT
function getTableSortDirection(e){return e===Sn.Sr.ASCENDING?Tr.Sr.ASCENDING_SORT:Tr.Sr.DESCENDING_SORT}const oY=xa.Ps`
  query UserLicenseListingQuery(
    $searchInput: UserListingSearchInput!
    $sortInput: UserListingSortInput!
    $limitOffsetInput: LimitOffsetInput!
  ) @skipAudit {
    currentTenantUserListing(
      searchInput: $searchInput
      sortInput: $sortInput
      limitOffsetInput: $limitOffsetInput
    ) {
      ... on UserListingNode {
        users {
          ...UserLicenseTableUser
        }
        total
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${eY}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function UserLicenseListing(e){const t=e.listingParams.sortInput,n=e.listingParams.limitOffsetInput
return d.createElement(Da.ZP,{query:oY,variables:e.listingParams,renderLoading:()=>d.createElement(kl.b,null),fetchPolicy:"network-only"},(({currentTenantUserListing:a},{refetch:i})=>(0,ka.CZ)(a)?d.createElement(Ff.Z,null,"Something has gone wrong: Unauthorized to view this information"):d.createElement("div",{className:"u-spacing-top u-spacing-bottom"},d.createElement(UserLicenseTable,{users:a.users,applications:e.applications,onChangeSort:e.onSortByAccessorKey,sortColumn:rY[t.sortKey],sortDirection:getTableSortDirection(t.sortDirection)}),d.createElement(zT.Z,{isLoading:!1,setOffset:e.onChangeOffset,pagination:{...n,total:a.total}}))))}const lY={query:""}
function getGroupUpdater({organizationId:e,teamId:t,isNotInOrganization:n,isNotInTeam:a,capabilityKeys:i,accountStatus:s}){return r=>function removeEmptyCriteria(e){const t=Object.entries(e).filter((([,e])=>void 0!==e))
return{...lY,...(0,Jt.m8)(t)}}({...r,teamId:t,organizationId:e,isNotInOrganization:n,isNotInTeam:a,capabilityKeys:i,accountStatus:s})}const cY={limit:100,offset:0}
function useUserListing(e){const[t,n]=(0,d.useState)(lY),[a,i]=(0,d.useState)(iY),[s,r]=(0,d.useState)(cY)
function updateOffset(e){r((t=>({...t,offset:e})))}function resetOffset(){updateOffset(cY.offset)}return[{listingCriteria:t,sort:a,limitOffset:s},{onChangeListingCriteria:function handleChangeListingCriteria(t){n(t)
resetOffset()
e()},onChangeOffset:function handleChangeOffset(t){updateOffset(t)
e()},onSortByAccessorKey:function handleSortByAccessorKey(t){i((e=>getUpdatedSortForAccessorKey(e,t)))
resetOffset()
e()},onChangeLimit:function updateLimit(e){r((()=>({limit:e,offset:0})))}}]}function LicenseDashboard(e){const[{listingCriteria:t,sort:n,limitOffset:a},i]=useUserListing((()=>{})),{onSortByAccessorKey:s,onChangeOffset:r,onChangeListingCriteria:o}=i,l={searchInput:t,limitOffsetInput:a,sortInput:n}
return d.createElement(d.Fragment,null,d.createElement(LicenseDashboardHeader,{organizations:e.organizations,teams:e.teams,applications:e.applications}),d.createElement(UserLicenseListing,{applications:e.applications,listingParams:l,onSortByAccessorKey:s,onChangeOffset:r}))}const dY=[on.e2.REGISTRY,on.e2.INVENTORY,on.e2.MOLBIO,"NOTEBOOK","REQUESTS","WORKFLOWS"]
function isLicensableApplication(e){return e.isEnabled&&function isLicensedApplication(e){return dY.includes(e.key)}(e)}const uY=xa.Ps`
  query TenantAdminLicensesTabQuery @skipAudit {
    currentTenant {
      id
      tenantAdminData {
        ... on TenantAdminDataNode {
          id
          organizations {
            ...OrganizationFilterOrganization
            teams {
              ...TeamFilterTeam
            }
          }
        }
        ...InaccessibleInfoGraphQL
      }
    }
    capabilities {
      ...CapabilitiesFilterCapability
    }
  }
  ${Kj.$m.fragment}
  ${Jj.Qp.fragment}
  ${Qj.Fb.fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function TenantAdminLicensesTab(){return d.createElement(Da.ZP,{query:uY,renderLoading:()=>d.createElement(LicenseDashboard,{organizations:[],teams:[],applications:[]})},(({currentTenant:e,capabilities:t})=>(0,ka.CZ)(e.tenantAdminData)?d.createElement(Ff.Z,null,"Something has gone wrong: Unauthorized to view this information"):d.createElement(LicenseDashboard,{organizations:e.tenantAdminData.organizations,teams:e.tenantAdminData.organizations.flatMap((e=>e.teams)),applications:t.filter((e=>isLicensableApplication(e)))})))}var mY=n(988477)
function CapabilityRow(e){return d.createElement(h.Z,{className:(0,g.iv)(pY.row)},d.createElement(p.Z,{xs:6,sm:6,md:6,lg:6},d.createElement("span",{className:(0,g.iv)(pY.text)},e.capability.displayName)),d.createElement(p.Z,{md:6},d.createElement(Io.Z,{className:"u-flex-display",id:"is-capability-enabled",checked:e.capability.isEnabled,onChange:t=>{e.onChangeEnableCapability(t.target.checked)},label:""})))}function CapabilityEnablementListing(e){return d.createElement(Ke.Z,null,d.createElement(h.Z,null,d.createElement(p.Z,{md:6},d.createElement(Je.Z,null,"Application")),d.createElement(p.Z,{md:6},d.createElement(Je.Z,null,"Allow Provisioning"))),(0,mY.Tp)(e.capabilities).map((t=>d.createElement(CapabilityRow,{key:t.key,capability:t,onChangeEnableCapability:n=>{e.onChangeEnableCapability(t,n)}}))))}const pY=g.mM.create({row:{..._n.hv,paddingBottom:10},text:{paddingTop:5}})
function InternalBenchlingBadge(){return d.createElement(pt.Z,{className:"u-mini-spacing-left",color:pt.J.GRAY},d.createElement("div",{className:(0,g.iv)(hY.benchlingBadgeLabel)},d.createElement("span",{className:(0,g.iv)(hY.benchlingBadgeIcon)},d.createElement(pe.Z,{icon:"benchling"})),"Internal Only"))}const hY=g.mM.create({benchlingBadgeLabel:{..._n.cf,padding:"0px 2px",textTransform:"initial"},benchlingBadgeIcon:{paddingRight:6}}),gY=xa.Ps`
  fragment TenantCapabilityConfigurationCapability on CapabilityNode {
    key
    displayName
    isEnabled
  }
`
function TenantCapabilityConfiguration(e){return d.createElement(d.Fragment,null,d.createElement("header",{className:(0,g.iv)(EY.pageName)},d.createElement(so.BB,null,"Application Provisioning"),d.createElement(InternalBenchlingBadge,null)),d.createElement("div",{className:(0,g.iv)(EY.text)},d.createElement("p",null,"Customer admins will be able to manage access to selected applications.")),d.createElement(Ke.Z,null,d.createElement(CapabilityEnablementListing,{capabilities:e.capabilities,onChangeEnableCapability:e.onChangeCapabilityEnabled})))}const EY=g.mM.create({pageName:{alignItems:"baseline",display:"flex"},text:{..._n.hv,paddingBottom:10}}),fY=xa.Ps`
  fragment AdminsInputUser on ActorNode {
    ... on PartyInterface {
      id
      handle
      name
    }
  }
`
function AdminsInput(e){return d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Tenant Admins"),d.createElement(tA.D,{size:nA.I.MEDIUM,onChange:e.onChangeAdmins,userSearchType:tA.t.NotSuspended,allowTeams:!1,allowOrganizations:!1,allowBenchlingApps:!0,value:e.admins,filterOptions:(t,n)=>{const a=e.admins.map((e=>e.id))
return n.filter((e=>!a.includes(e.id)))},placeholder:"Add a new tenant admin"}))}var SY=n(408244)
const yY=xa.Ps`
  fragment ConfigPanelConfig on ConfigOptionNode {
    key
    displayName
    description
    value
    type
    group
    configurableByTenantAdmin
    allowedChoices {
      ... on ConfigChoiceNode {
        value
        displayName
        required
      }
    }
  }
`,bY={fragment:xa.Ps`
  fragment TenantAdminSettingsQueryConfigurationsFragment on Query {
    currentTenant {
      ... on TenantNode {
        id
        tenantAdminData {
          ... on TenantAdminDataNode {
            id
            configOptions {
              ...ConfigPanelConfig
            }
          }
        }
      }
    }
  }
  ${yY}
`,fragmentName:"TenantAdminSettingsQueryConfigurationsFragment"}
function createUpdateTenantConfigurationsQuery(e,t){return function updateTenantConfigurationsQuery(n){const a={__typename:"Query",currentTenant:{__typename:"TenantNode",id:e,tenantAdminData:{__typename:"TenantAdminDataNode",id:t,configOptions:n}}};(0,Ml.writeRootFragment)(bY,a)}}async function updateTenantConfigurations(e,t,n,a){const i=function getChangedTenantConfigurations(e,t){const n=e.reduce(((e,t)=>{e[t.key]=t.value
return e}),{})
return t.filter((e=>e.value!==n[e.key])).reduce(((e,t)=>{e[t.key]=JSON.stringify(t.value)
return e}),{})}(n,a)
0!==Object.keys(i).length&&await(0,$C.Y)({persistData:async()=>await SY.wf({configsToSet:i}),writeDataToCache:createUpdateTenantConfigurationsQuery(e,t),optimisticData:a,revertData:n})}var TY=n(105916)
const vY=xa.Ps`
  fragment ConfigPanelOrganization on OrganizationNode {
    id
    name
  }
`
function ConfigHeader(e){return d.createElement(Je.Z,null,e.displayName,d.createElement(zp.Z,{renderContent:()=>d.createElement("div",{className:"u-pre-wrap u-normal-font-weight"},e.description),iconClassName:"u-mini-spacing-left"}))}function TextConfigField(e){return d.createElement("div",null,d.createElement("input",{className:"form-control u-gray-darker",value:e.value,disabled:e.readOnly}))}function IntegerConfigField(e){return d.createElement(AT.Z,{className:"form-control u-gray-darker",value:e.value,isDisabled:e.readOnly,onChange:t=>{e.onUpdateConfigValue(t.target.numericValue)}})}function ClearableSingleSelectConfigField(e){const t=e.allowedChoices.find((t=>t.value===e.selectedValue)),[n,a]=d.useState(!t)
d.useEffect((()=>{a(!t)}),[t])
return d.createElement(d.Fragment,null,d.createElement(Io.Z,{className:"u-flex-display u-small-spacing-bottom",id:e.configKey,checked:!n,disabled:e.readOnly,onChange:t=>{if(t.target.checked)a(!1)
else{a(!0)
e.onSelect(null)}},label:e.checkboxLabel}),d.createElement(SingleSelectConfigField,{selectedChoice:t,allowedChoices:e.allowedChoices,isDisabled:e.readOnly||n,noValueText:e.noValueText,onSelect:e.onSelect}))}function SingleSelectConfigField(e){return d.createElement($r.ZP,{disabled:e.isDisabled,displayName:e.selectedChoice?e.selectedChoice.displayName:e.noValueText,menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL},e.allowedChoices.map((t=>d.createElement(N.Z,{key:t.value,onSelect:e.onSelect,value:t.value},t.displayName))))})}function AutoAddOrgsField(e){return d.createElement(d.Fragment,null,d.createElement(Db.X2,{key:"header"},d.createElement(Db.JX,{md:8},d.createElement(Je.Z,{className:"u-faded"},"Email domains")),d.createElement(Db.JX,{md:8},d.createElement(Je.Z,{className:"u-faded"},"Organization name"))),e.orgNameToEmailDomains.map((([t,n])=>d.createElement(Db.X2,{className:"u-small-padding-bottom",key:t},d.createElement(Db.JX,{md:8},d.createElement(TextConfigField,{value:n.toString(),readOnly:e.readOnly})),d.createElement(Db.JX,{md:8},d.createElement(TextConfigField,{value:t,readOnly:e.readOnly}))))))}function columnsToSelectTreeItems(e){return e.map((e=>({id:e.value,icon:"minus",forceToTop:void 0,name:e.displayName,parentId:null,user:void 0})))}function MultiSelectConfigField(e){var t
const n=null==e.selectedChoices,[a,i]=d.useState(n)
let s
s=null==e.selectedChoices?e.allowedChoices.map((e=>e.value)):e.selectedChoices
const r=s.length,o=(null===(t=e.allowedChoices)||void 0===t?void 0:t.filter((e=>e.required)).map((e=>e.value)))||[]
s=[...new Set([...s,...o])]
return d.createElement(d.Fragment,null,d.createElement(mm.t,{hasBottomSpacing:!0,selectedValue:a,options:[{label:e.nullStateDisplayString,value:!0},{label:e.configurableStateDisplayString,value:!1}],onChange:t=>{i(t)
t&&e.onChange(null)}}),!a&&d.createElement("div",{className:(0,g.iv)(CY.columnSelectorWrapper)},d.createElement("div",{className:(0,g.iv)(CY.header)},d.createElement("div",{className:(0,g.iv)(CY.title)},"Select ",e.itemTypeDisplayName),d.createElement("div",{className:(0,g.iv)(CY.numSelected)},r," ",(0,de._6)(r,e.itemTypeDisplayName)," selected")),d.createElement(Vz.Z,{allowNone:!1,includeSelectAllItem:!1,className:void 0,items:columnsToSelectTreeItems(e.allowedChoices),multiple:!0,selectAllText:"",selectedIds:s,onChangeSelectedIds:t=>{const n=new Set([...t,...o]);(0,S.Gp)(n.size===t.length,"Required IDs were missing - auto-added.")
e.onChange([...n])},submitHandler:void 0,shouldExpandNewItems:!1,query:void 0,rootItemSortFn:e=>e,requiredRootIds:o})))}const CY=g.mM.create({columnSelectorWrapper:{maxHeight:300,borderRadius:"4px 4px 0px 0px",display:"flex",flexDirection:"column"},header:{flexShrink:0,display:"flex",justifyContent:"space-between",background:Vt.tN,padding:"7px 10px"},title:{..._n.E0,color:Vt.pp,fontWeight:_n.KB,textTransform:"uppercase"},numSelected:{..._n.cf,color:Vt.pp,fontWeight:_n.hS}})
function ConfigOption(e){var t,n
let a
switch(e.configKey){case"EXPORTS_DATE_FORMAT_CONFIGURATION":return d.createElement(ClearableSingleSelectConfigField,{...e,selectedValue:e.value,allowedChoices:e.allowedChoices||[],checkboxLabel:"Use custom date format for audit exports",noValueText:"Select a date format",onSelect:e.onUpdateConfigValue})
case"EXPORTS_TIME_FORMAT_CONFIGURATION":return d.createElement(ClearableSingleSelectConfigField,{...e,selectedValue:e.value,allowedChoices:(i=e.allowedChoices||[],i.map((e=>{if(["USERS_TIMEZONE_24_HOUR","USERS_TIMEZONE_12_HOUR"].includes(e.value)){const t=" / ",n=e.displayName.split(t),a=aL().tz.guess()||"UTC",i="USERS_TIMEZONE_24_HOUR"===e.value?"HH:mm:ss zz":"hh:mm:ss A zz"
n[1]=aL()().tz(a).format(i)
return{...e,displayName:n.join(t)}}return e}))),checkboxLabel:"Use custom time format for audit exports",noValueText:"Select a time format",onSelect:e.onUpdateConfigValue})
case"AUDITING_COLUMNS_INCLUDED_IN_AUDIT_LOG_EXPORT":return d.createElement(MultiSelectConfigField,{selectedChoices:e.value,allowedChoices:null!==(t=e.allowedChoices)&&void 0!==t?t:[],itemTypeDisplayName:"column",nullStateDisplayString:"Export all columns",configurableStateDisplayString:"Select columns for export",onChange:e.onUpdateConfigValue})}var i
switch(e.type){case Yj.J7.CONFIG_MULTI_SELECT:return d.createElement(MultiSelectConfigField,{selectedChoices:e.value,allowedChoices:null!==(n=e.allowedChoices)&&void 0!==n?n:[],itemTypeDisplayName:"item",nullStateDisplayString:"All items",configurableStateDisplayString:"Select items",onChange:e.onUpdateConfigValue})
case Yj.J7.CONFIG_AUTO_ADD_ORG:{const t=function generateOrgNameToEmailDomains(e,t){return l.default.compact(Object.entries(t).map((([t,n])=>{const a=e.find((e=>e.id===t))
return!!a&&[a.name,n]})))}(e.organizations,e.value)
return d.createElement(AutoAddOrgsField,{orgNameToEmailDomains:t,readOnly:e.readOnly})}case Yj.J7.CONFIG_SINGLE_SELECT:return d.createElement(ClearableSingleSelectConfigField,{...e,selectedValue:e.value,allowedChoices:e.allowedChoices||[],checkboxLabel:"Use a custom value",noValueText:"Select an option",onSelect:e.onUpdateConfigValue})
case Yj.J7.CONFIG_FLAG:a=e.value?"Enabled":"Disabled"
break
case Yj.J7.CONFIG_INTEGER:return d.createElement(IntegerConfigField,{value:e.value,readOnly:e.readOnly,onUpdateConfigValue:e.onUpdateConfigValue})
case Yj.J7.CONFIG_OPTION:a=null==e.value?"":e.value.toString()
break
default:a=e.value.toString()}return d.createElement(TextConfigField,{value:a,readOnly:e.readOnly})}function ConfigGroup(e){return d.createElement("div",{className:"u-large-spacing-bottom"},d.createElement(so.BB,null,e.title),e.configOptions.map(((t,n)=>d.createElement(Ke.Z,{key:t.displayName},d.createElement(ConfigHeader,{displayName:t.displayName,description:t.description}),d.createElement(ConfigOption,{...t,configKey:t.key,readOnly:!t.configurableByTenantAdmin,organizations:e.organizations,onUpdateConfigValue:a=>{if(a===t.value)return
const i={...t,value:a}
e.onUpdateConfigOption([...e.configOptions.slice(0,n),i,...e.configOptions.slice(n+1)])}})))))}function ConfigPanel(e){const{data:t,updateDraftData:n,isEditing:a,startEditing:i,stopEditing:s}=(0,hA.Z)({configGroupKeyToOptions:l.default.groupBy(e.configOptions,"group")})
let r=Object.values(l.default.mapObject(t.configGroupKeyToOptions,((a,s)=>({key:Yj.AY[s],title:Yj.AY[s],configOptions:a,organizations:e.organizations,onUpdateConfigOption:e=>{((e,a)=>{i()
n({configGroupKeyToOptions:{...t.configGroupKeyToOptions,[e]:a}})})(s,e)}}))))
r=r.filter((e=>e.key!==Yj.AY.DATA_MODIFICATION))
return d.createElement(d.Fragment,null,a&&d.createElement(TY.Z,{text:"Settings changed",onSave:()=>{const n=Object.values(t.configGroupKeyToOptions).flat()
e.onSave(e.configOptions,n)
s()},onDiscard:s}),r.map((e=>d.createElement(ConfigGroup,{...e}))))}const IY=xa.Ps`
  fragment IPAllowlistsPageIPConfigurationInfo on IPConfigurationInfoNode {
    webIpAllowlist
    warehouseIpAllowlist
    useWebIpAllowlistForWarehouse
  }
`
function IPAllowlistsPage(e){return d.createElement(Db.W2,{size:"lg"},d.createElement(h.Z,null,d.createElement(p.Z,{md:8},d.createElement(so.BB,null,"IP Allowlists"),d.createElement("div",{className:(0,g.iv)(wY.text)},d.createElement("p",null,"Manage which IPs are allowed to access Benchling."))),d.createElement(p.Z,{md:4})))}const wY=g.mM.create({text:{..._n.hv,color:"#979799",paddingBottom:10}}),NY={fragment:xa.Ps`
  fragment TenantAdminSettingsQueryAdminsFragment on Query {
    currentTenant {
      ... on TenantNode {
        id
        tenantAdminData {
          ... on TenantAdminDataNode {
            id
            admins {
              ...AdminsInputUser
            }
          }
        }
      }
    }
  }
  ${fY}
`,fragmentName:"TenantAdminSettingsQueryAdminsFragment"}
function createUpdateAdminsQuery(e,t){return function updateAdminsQuery(n){const a={__typename:"Query",currentTenant:{__typename:"TenantNode",id:e,tenantAdminData:{__typename:"TenantAdminDataNode",id:t,admins:n.map((e=>({...e,__typename:"UserNode"})))}}};(0,Ml.writeRootFragment)(NY,a)}}function getIdsFromAdminsInputUsers(e){return e.map((e=>e.id))}async function updateTenantAdmins(e,t,n,a){const i=function generateIsTenantAdminByUserId(e,t){const n=getIdsFromAdminsInputUsers(e),a=getIdsFromAdminsInputUsers(t)
return l.default.union(l.default.difference(n,a),l.default.difference(a,n)).reduce(((e,t)=>{e[t]=a.includes(t)
return e}),{})}(e,t)
await(0,$C.Y)({persistData:async()=>{await SY.XO(dt.ZP.TENANT_NAME,{isTenantAdminByUserId:i})},writeDataToCache:createUpdateAdminsQuery(n,a),optimisticData:t,revertData:e})}const AY={fragment:xa.Ps`
  fragment TenantAdminSettingsQueryTenantFragment on Query {
    currentTenant {
      ... on TenantNode {
        id
        name
        avatarUrl
        displayName
      }
    }
  }
`,fragmentName:"TenantAdminSettingsQueryTenantFragment"}
function updateTenantQuery(e){(0,Ml.writeRootFragment)(AY,{__typename:"Query",currentTenant:{__typename:"TenantNode",...e}})}async function TenantSettingsTabActions_update(e,t,n,a,i){const s={...a,...n}
if(i){const e=await eH.ws(i)
if(e){s.avatarUrl=e
n.avatarUrl=e}}await(0,$C.Y)({persistData:async()=>await SY.Vx(e,n),writeDataToCache:updateTenantQuery,optimisticData:{...s,id:t,name:e},revertData:{...a,id:t,name:e}})}function AvatarForm(e){const[t,n]=d.useState(!1)
return d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Tenant avatar"}),d.createElement("div",null,d.createElement(fC.Z,{className:"u-small-spacing-bottom",size:SC.D.XLARGE,shape:SC.o.SQUARE,entity:{avatar_url:e.avatarUrl,handle:e.displayName,name:e.displayName}})),d.createElement("input",{className:"u-overflow-wrap-break-word",type:"file",onChange:async t=>{if(null!=t.target.files){n(!0)
await TenantSettingsTabActions_update(e.name,e.tenantId,{},{displayName:e.displayName,avatarUrl:e.avatarUrl},t.target.files[0])
n(!1)}},disabled:t}))}const RY=xa.Ps`
  fragment SettingsPageTenant on TenantNode {
    id
    name
    displayName
    avatarUrl
  }
`
function DisplayNameInput(e){return d.createElement(Jl.Z,{value:e.displayName,onChange:e.onChangeDisplayName,label:"Name",labelStyle:Fr.Z.STYLES.LABEL})}function SettingsPage(e){const{data:t,updateDraftData:n,isEditing:a,startEditing:i,stopEditing:s}=(0,hA.Z)({tenantAdmins:e.initialTenantAdmins,displayName:e.initialDisplayName})
return d.createElement(Db.W2,{size:"md"},d.createElement(h.Z,null,d.createElement(p.Z,{md:10,lg:8},a&&d.createElement(TY.Z,{text:"Settings changed",onSave:()=>{e.onSave({tenantName:e.name,initialAdmins:e.initialTenantAdmins,admins:t.tenantAdmins,initialDisplayName:e.initialDisplayName,displayName:t.displayName,avatarUrl:e.avatarUrl,tenantId:e.tenantId,tenantAdminDataId:e.tenantAdminDataId})
s()},onDiscard:s,disableSave:!t.displayName}),d.createElement(so.BB,null,"Tenant settings"),d.createElement(DisplayNameInput,{displayName:t.displayName,onChangeDisplayName:e=>{i()
n({displayName:e.target.value})}}),d.createElement(AdminsInput,{admins:t.tenantAdmins,onChangeAdmins:e=>{i()
n({tenantAdmins:e})}}),d.createElement(AvatarForm,{name:e.name,tenantId:e.tenantId,avatarUrl:e.avatarUrl,displayName:e.initialDisplayName})),d.createElement(p.Z,null)))}async function handleSave({tenantName:e,initialAdmins:t,admins:n,initialDisplayName:a,displayName:i,avatarUrl:s,tenantId:r,tenantAdminDataId:o}){await updateTenantAdmins(t,n,r,o)
await TenantSettingsTabActions_update(e,r,{displayName:i},{displayName:a,avatarUrl:s})
v.ZP.success("Settings have been updated.")}const admin_SettingsPage=e=>d.createElement(SettingsPage,{...e,onSave:handleSave})
function updateUsersCapabilities(e){return Cn.Ry({url:"/1/api/capabilities:bulk-update-users-capabilities",data:{userIdsCapabilities:e}})}const PY={fragment:xa.Ps`
  fragment TenantAdminSettingsQueryCapabilitiesFragment on Query {
    capabilities {
      key
      displayName
      isEnabled
    }
  }
`,fragmentName:"TenantAdminSettingsQueryCapabilitiesFragment"}
function updateEnabledCapabilitiesCache(e){(0,Ml.writeRootFragment)(PY,{__typename:"Query",capabilities:e.map((e=>({...e,__typename:"CapabilityNode"})))})}async function updateEnabledCapabilitiesAndOptimisticallyCache(e,t){const n=e.reduce(((e,t)=>{e[t.key]=t.isEnabled
return e}),{}),a=t.reduce(((e,t)=>{n[t.key]!==t.isEnabled&&(e[t.key]=t.isEnabled)
return e}),{})
await(0,$C.Y)({persistData:async()=>{await function updateEnabledCapabilities(e){return Cn.Ry({url:"/1/api/capabilities:bulk-update-enabled",data:{isEnabledByCapabilityKey:e}})}(a)},writeDataToCache:updateEnabledCapabilitiesCache,optimisticData:t,revertData:e})}function ApplicationsPage(e){const{data:t,updateDraftData:n,isEditing:a,startEditing:i,stopEditing:s}=(0,hA.Z)({capabilities:e.capabilities})
return d.createElement(Db.W2,{size:"lg"},a&&d.createElement(TY.Z,{text:"Settings changed",onSave:()=>{e.onSave(e.capabilities,t.capabilities)
s()},onDiscard:s}),d.createElement(h.Z,null,d.createElement(p.Z,{xs:11,sm:11,md:8,lg:6},d.createElement(TenantCapabilityConfiguration,{capabilities:t.capabilities,onChangeCapabilityEnabled:(e,a)=>{i()
n(function replaceCapability(e,t,n){return{capabilities:[...e.filter((e=>e.key!==t.key)),{...t,isEnabled:n}]}}(t.capabilities,e,a))}})),d.createElement(p.Z,{xs:1,sm:1,md:4,lg:6})))}async function ApplicationsPage_handleSave(e,t){await updateEnabledCapabilitiesAndOptimisticallyCache(e,t)
v.ZP.success("Settings have been updated.")}const admin_ApplicationsPage=e=>d.createElement(ApplicationsPage,{...e,onSave:ApplicationsPage_handleSave})
function ConfigurationsPage(e){return d.createElement(Db.W2,{size:"lg"},d.createElement(h.Z,null,d.createElement(p.Z,{md:7},d.createElement(ConfigPanel,{configOptions:e.configs,organizations:e.organizations,onSave:(t,n)=>async function handleSaveConfigurations(e,t,n,a){await updateTenantConfigurations(e,t,n,a)
v.ZP.success("Settings have been updated.")}(e.tenantId,e.tenantAdminDataId,t,n)})),d.createElement(p.Z,{md:5})))}var OY=n(741522)
const xY={fragment:xa.Ps`
  fragment DataModsEnabled on ProjectNode {
    id
    dataModsEnabled
  }
`,fragmentName:"DataModsEnabled"}
function updateDataModsEnabledCache(e){for(const[t,n]of e.entries())(0,Ml.writeFragmentsToCache)(xY,[{__typename:"ProjectNode",id:t,dataModsEnabled:n}])}function createProjectEnablementMap(e,t){return e.reduce(((e,n)=>e.set(n,t)),new Map)}function ProjectMovementSettings(){return d.createElement("div",null,d.createElement(so.BB,null,"Moving Items between Projects with Different Data Modifications Rationale Settings"),d.createElement("div",null,d.createElement("p",null,"Allows end users to move items (i.e. entries, containers, entities, etc.) between data modifications enabled and disabled projects."),d.createElement("ul",{className:"u-padding-left"},d.createElement("li",null,d.createElement("b",null,"Enabled projects:")," Projects selected in the specific projects listed above"),d.createElement("li",null,d.createElement("b",null,"Disabled projects:")," Projects unselected in the specific projects listed above"))))}var _Y
!function(e){e.DISABLED="Disabled"
e.ENABLED_FOR_TENANT="Enabled for tenant"
e.ENABLED_FOR_SPECIFIC_PROJECTS="Enabled for specific projects"}(_Y||(_Y={}))
function DataModificationsProjectSelector(e){const t=e.allProjects.filter((t=>e.selectedProjectIds.includes(t.id))).map((e=>e.rootFolder.id))
return d.createElement(Ao.Z,{includeHiddenProjects:!0,onSelectFolders:t=>{const n=t.map((e=>e.api_identifier)),a=e.allProjects.filter((e=>n.includes(e.rootFolder.id)));(0,S.Gp)(t.length===a.length,"Unable to find source for selected root folder")
e.onSelectProjects(a.map((e=>e.id)))},selectedFolderIds:t,showInventory:!1,showNotebook:!1,showRegistries:!1,placeHolderText:"Add projects",tagsInputSize:nA.I.MEDIUM})}function RationaleSetting(e){return d.createElement("div",{className:"u-large-spacing-bottom"},d.createElement(so.BB,null,"Data Modifications Rationale Setting"),d.createElement("div",null,d.createElement("p",null,"Control whether users are required to provide a reason when making data modifications.  ",d.createElement("a",null,"Learn more about the Data Modification Rationale feature."))),d.createElement(mm.t,{options:(t=e.allowedChoices,t.map((e=>({label:e.value,value:e.value})))),selectedValue:e.selectedValue,onChange:t=>{e.onConfigChange(t,LY.AUDITING_DATA_MODIFICATIONS_SETTING)}}),e.selectedValue===_Y.ENABLED_FOR_SPECIFIC_PROJECTS&&(e.projectsLoaded?d.createElement("div",{className:(0,g.iv)(DY.projectSelectorWrapper)},d.createElement(DataModificationsProjectSelector,{onSelectProjects:e.onSelectProjects,allProjects:e.allProjects,selectedProjectIds:e.selectedProjectIds})):d.createElement(kl.Z,null)))
var t}const DY=g.mM.create({projectSelectorWrapper:{marginTop:10}})
var LY
!function(e){e.AUDITING_DATA_MODIFICATIONS_SETTING="AUDITING_DATA_MODIFICATIONS_SETTING"
e.AUDITING_DATA_MODIFICATIONS_ACTIONS="AUDITING_DATA_MODIFICATIONS_ACTIONS"}(LY||(LY={}))
function DataModificationsPanel(e){var t,n,a,i
const s=e.projects.filter((e=>e.dataModsEnabled)).map((e=>e.id)),{data:r,updateDraftData:o,isEditing:c,startEditing:u,stopEditing:m}=(0,hA.Z)({tenantConfigs:l.default.indexBy(e.configs,"key"),enabledProjectIds:s}),p=null===(t=e.configs)||void 0===t?void 0:t.find((e=>e.key===LY.AUDITING_DATA_MODIFICATIONS_SETTING))
return d.createElement(d.Fragment,null,c&&d.createElement(TY.Z,{text:"Settings changed",onSave:()=>{const t=Object.values(r.tenantConfigs)
e.onSave(e.configs,t,s,r.enabledProjectIds)
m()},onDiscard:m}),d.createElement(RationaleSetting,{selectedValue:null!==(a=null===(n=r.tenantConfigs[LY.AUDITING_DATA_MODIFICATIONS_SETTING])||void 0===n?void 0:n.value)&&void 0!==a?a:"",allowedChoices:null!==(i=null==p?void 0:p.allowedChoices)&&void 0!==i?i:[],onConfigChange:(e,t)=>{if(e===r.tenantConfigs[t].value)return
const n={...r.tenantConfigs[t],value:e}
u()
o({...r,tenantConfigs:{...r.tenantConfigs,[t]:n}})},allProjects:e.projects,projectsLoaded:e.projectsLoaded,selectedProjectIds:r.enabledProjectIds,onSelectProjects:e=>{u()
o({...r,enabledProjectIds:e})}}),d.createElement(ProjectMovementSettings,null))}const kY=xa.Ps`
  query DataModsProjectSettingQuery @skipAudit @engComponent(name: AUDITING) {
    sources {
      ... on ProjectNode {
        id
        rootFolder {
          id
        }
        dataModsEnabled
      }
    }
  }
`
function DataModificationsPage(e){const t=(0,Da.IJ)(kY)
let n=[],a=!1
if(t.type===Da.NI.SUCCESS){a=!0
n=t.data.sources.filter((e=>"ProjectNode"===e.__typename))}return d.createElement(Db.W2,{size:"lg"},d.createElement(h.Z,null,d.createElement(p.Z,{md:8},d.createElement(DataModificationsPanel,{configs:e.configs,projects:n,projectsLoaded:a,onSave:(t,n,a,i)=>async function DataModificationsPage_handleSaveConfigurations(e,t,n,a,i,s){await updateTenantConfigurations(e,t,n,a)
await async function updateDataModsEnabledProjects(e,t){const n=t.filter((t=>!e.includes(t))),a=e.filter((e=>!t.includes(e)))
n.length>0&&await(0,$C.Y)({persistData:async()=>{await OY.Z.enableDataMods(n)},writeDataToCache:updateDataModsEnabledCache,optimisticData:createProjectEnablementMap(n,!0),revertData:createProjectEnablementMap(n,!1)})
a.length>0&&await(0,$C.Y)({persistData:async()=>{await OY.Z.disableDataMods(a)},writeDataToCache:updateDataModsEnabledCache,optimisticData:createProjectEnablementMap(a,!1),revertData:createProjectEnablementMap(a,!0)})}(i,s)
v.ZP.success("Settings have been updated.")}(e.tenantId,e.tenantAdminDataId,t,n,a,i)})),d.createElement(p.Z,{md:4})))}function SideNav({tabs:e}){return d.createElement("div",{className:(0,g.iv)(MY.container)},d.createElement("ul",{className:(0,g.iv)(MY.tabList)},e.map(((e,t)=>d.createElement("li",{className:f()((0,g.iv)(MY.tab,e.isActive&&MY.activeTab)),key:t,onClick:e.isActive?void 0:e.handleClick},d.createElement("div",{className:"sectionTabs-navItem-title"},d.createElement("a",{className:(0,g.iv)(MY.navigationLink)},d.createElement("span",{className:"sectionTabs-navItem-title-inner"},e.text))))))))}function SecondaryNavContainer(e){return d.createElement(Db.W2,{size:"lg"},d.createElement(h.Z,null,d.createElement(p.Z,{sm:4,md:3,lg:2},d.createElement(SideNav,{tabs:e.tabs.map((t=>({handleClick:()=>{e.onChangeTab(t)},isActive:t===e.activeTab,text:e.tabsToReadable[t]})))})),d.createElement(p.Z,{sm:8,md:9,lg:10},d.createElement("div",null,e.children))))}const MY=g.mM.create({container:{..._n.hv,backgroundColor:Vt.bs,border:`1px solid ${Vt.tN}`,borderRadius:"4px",marginBottom:10},tabList:{paddingTop:20,paddingLeft:0,paddingBottom:10},tab:{paddingTop:10,paddingBottom:10,paddingLeft:15,alignItems:"flex-start",display:"flex",":hover":{backgroundColor:Vt.tN,cursor:"pointer",fontWeight:"bold"}},activeTab:{backgroundColor:Vt.tN},navigationLink:{color:"inherit",textDecoration:"inherit"}})
function SettingsPageContainer(e){const[t,n]=d.useState(Yj.Lm.GENERAL_SETTINGS_TAB)
let a=dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING&&e.showBenchlingAdminControls?Yj.E1:Yj.E1.filter((e=>e!==Yj.Lm.APPLICATIONS_TAB))
dt.ZP.AUDITING_ENABLE_DATA_MODIFICATIONS_TAC_SETTINGS_PAGE||(a=a.filter((e=>e!==Yj.Lm.DATA_MODIFICATIONS_TAB)))
dt.ZP.IDENTITY_ENABLE_IP_ALLOWLIST_PAGE||(a=a.filter((e=>e!==Yj.Lm.IP_ALLOWLISTS_TAB)))
return d.createElement(SecondaryNavContainer,{tabs:a,tabsToReadable:Yj.UT,activeTab:t,onChangeTab:n},(()=>{switch(t){case Yj.Lm.GENERAL_SETTINGS_TAB:return d.createElement(admin_SettingsPage,{initialTenantAdmins:e.initialTenantAdmins,name:e.name,initialDisplayName:e.initialDisplayName,avatarUrl:e.avatarUrl,tenantId:e.tenantId,tenantAdminDataId:e.tenantAdminDataId})
case Yj.Lm.APPLICATIONS_TAB:return d.createElement(admin_ApplicationsPage,{capabilities:e.capabilities})
case Yj.Lm.CONFIGURATIONS_TAB:return d.createElement(ConfigurationsPage,{configs:e.configs,organizations:e.organizations,tenantId:e.tenantId,tenantAdminDataId:e.tenantAdminDataId})
case Yj.Lm.DATA_MODIFICATIONS_TAB:return d.createElement(DataModificationsPage,{configs:e.configs,organizations:e.organizations,tenantId:e.tenantId,tenantAdminDataId:e.tenantAdminDataId})
case Yj.Lm.IP_ALLOWLISTS_TAB:return d.createElement(IPAllowlistsPage,{ipConfiguration:e.ipConfiguration})
default:(0,S.hu)(!1,`Unexpected tab "${t}"`)
return null}})())}function TenantAdminErrorBanner(){return d.createElement(Ff.Z,null,"Something has gone wrong: Unauthorized to view this information")}const FY=xa.Ps`
  query GetTenantSettingsTab @skipAudit @engComponent(name: IDENTITY) {
    capabilities {
      ...TenantCapabilityConfigurationCapability
    }
    currentUser {
      id
      isBenchlingAdmin
    }
    currentTenant {
      id
      ...SettingsPageTenant
      tenantAdminData {
        ... on TenantAdminDataNode {
          id
          organizations {
            ...ConfigPanelOrganization
          }
          admins {
            ...AdminsInputUser
          }
          configOptions {
            ...ConfigPanelConfig
          }
          ipConfiguration {
            ...IPAllowlistsPageIPConfigurationInfo
          }
        }
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${gY}
  ${RY}
  ${yY}
  ${vY}
  ${fY}
  ${IY}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function TenantAdminSettingsTab(){return d.createElement(Da.ZP,{query:FY,renderLoading:()=>d.createElement(kl.b,null)},(({capabilities:e,currentUser:t,currentTenant:n})=>(0,ka.CZ)(n.tenantAdminData)||!t?d.createElement(TenantAdminErrorBanner,null):d.createElement(SettingsPageContainer,{configs:n.tenantAdminData.configOptions,organizations:n.tenantAdminData.organizations,initialTenantAdmins:n.tenantAdminData.admins,ipConfiguration:n.tenantAdminData.ipConfiguration,name:n.name,initialDisplayName:n.displayName,avatarUrl:n.avatarUrl,capabilities:e,showBenchlingAdminControls:t.isBenchlingAdmin,tenantId:n.id,tenantAdminDataId:n.tenantAdminData.id})))}const ZY=(0,Hh.x)((()=>({isOpen:!1})),"GroupPageSaveBannerStateContext"),BY=(0,Hh.x)((()=>{(0,S.hu)(!1,"useSaveBanner must be used in a descendent of GroupPageSaveBannerProvider")
return{}}),"GroupPageSaveBannerActionsContext")
function GroupPageSaveBannerProvider({children:e}){const t=(0,d.useRef)(),[n,a]=(0,d.useState)({isOpen:!1}),hide=()=>{t.current=void 0
n.isOpen&&a({isOpen:!1})}
return d.createElement(ZY.Provider,{value:n},d.createElement(BY.Provider,{value:{close:e=>{t.current(e)
hide()},hide,show:(e,i)=>{t.current=i
n.isOpen&&n.text===e||a({isOpen:!0,text:e})}}},e))}function GroupPageSaveBanner(){const{isOpen:e,text:t}=ZY.useContext(),{close:n}=BY.useContext()
return e?d.createElement(Db.X2,{className:(0,g.iv)(qY.saveBanner)},d.createElement(TY.Z,{text:t,onSave:()=>{n(!0)},onDiscard:()=>{n(!1)}})):null}function AvatarOrLoading({avatarUrl:e,name:t,groupTypeName:n}){return e&&t?d.createElement("div",{className:"u-flex-display u-spacing-bottom"},d.createElement(fC.Z,{size:SC.D.XLARGE,shape:SC.o.SQUARE,entity:{name:t,avatar_url:e}}),d.createElement("div",{className:"u-justify-content-center u-vertical-flex u-small-spacing-left"},d.createElement("div",{className:"u-tiny-spacing-bottom",...(0,ee.Z)({component:"AvatarOrLoading",element:"container"})},d.createElement("div",{className:"legacy-font-proxima-17"},t),d.createElement("div",{className:"u-faded"},n)))):d.createElement("div",{className:f()("u-spacing-bottom",(0,g.iv)(qY.avatarLoader))},d.createElement(kl.b,null))}function GroupPageContainer(e){var t
return d.createElement("div",{className:f()("groupPage-container expandedContainer",(0,g.iv)(qY.container)),...(0,ee.Z)(null!==(t=e.dataTestAttrs)&&void 0!==t?t:{component:"GroupPageContainer",element:"root"})},d.createElement(Db.W2,{size:"lg"},d.createElement(Db.X2,{className:f()("groupPage-headerContainer",(0,g.iv)(qY.header))},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:20},d.createElement(AvatarOrLoading,{name:e.name,avatarUrl:e.avatarUrl,groupTypeName:e.groupTypeName}),d.createElement("div",{className:"u-lr-split"},d.createElement(KW.Z,{tabs:e.tabs.map((t=>({handleClick:()=>{e.onChangeTab(t)},isActive:t===e.activeTab,text:e.tabsToReadable[t]})))}))),d.createElement(Db.JX,{lg:1})),d.createElement(GroupPageSaveBannerProvider,null,d.createElement(d.Fragment,null,d.createElement(GroupPageSaveBanner,null),d.createElement(Db.X2,{className:f()("groupPage-sectionContainer",(0,g.iv)(qY.sectionContainer)),dataTestAttrs:{component:"GroupPageContainer",element:"section"}},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:20},d.createElement("div",{className:"groupPage-section u-padding-top"},e.children)),d.createElement(Db.JX,{lg:1}))))))}const qY=g.mM.create({avatarLoader:{height:84,display:"flex",alignItems:"center"},container:{backgroundColor:Vt.Cj,fontFamily:_n.I3,height:"100%"},header:{paddingTop:30},sectionContainer:{borderTop:`1px solid ${Vt.tN}`,flex:1,fontFamily:_n.I3},saveBanner:{display:"block"}})
var VY=n(39829)
const UY=xa.Ps`
  fragment TeamSelectMenuOrganization on OrganizationNode {
    id
    name
    teams {
      id
      name
    }
  }
`
function sortGroup(e,t){return(0,hs.Z)(e,[e=>t.includes(e.id)?"b":"a",e=>e.name.toLowerCase()])}function getGroupDisabledInfo(e,t){return e.find((e=>e.id===t))||null}function getOptionDatas(e,t){return sortGroup(e,t.map((e=>e.id))).flatMap((e=>{let n=[]
const a=Boolean(getGroupDisabledInfo(t,e.id)),i=function getOrganizationOptionData(e){return{name:e.name,value:e.id,icon:"organization",disabled:!0}}(e)
a||(n=function getOrganizationTeamOptionDatas(e,t){const n=t.map((e=>e.id))
return sortGroup(e.teams,n).map((e=>function getOrganizationTeamOptionData(e,t){return{name:e.name,value:e.id,icon:"team",disabled:t}}(e,Boolean(getGroupDisabledInfo(t,e.id)))))}(e,t))
return[i,...n]}))}function getOptionContentRenderer(e,t){return n=>{const a=t.find((e=>e.id===n.value)),i=e.map((e=>e.id)).includes(n.value),s={[(0,g.iv)(GY.nonDisabledNonSelectableOption)]:i&&!a,[(0,g.iv)(GY.childOptionContent)]:!i}
return d.createElement(gU.Z,{icon:n.icon,tooltipTitle:a?a.reason:void 0,className:f()(s)},n.name)}}function TeamSelectMenu({organizations:e,onSelectTeam:t,selectedTeamId:n,disabledGroupInfos:a=[]}){return d.createElement(Ar.Z,{scrollable:!0,onSelect:t,optionDatas:getOptionDatas(e,a),renderOptionContent:getOptionContentRenderer(e,a),width:w.ZP.WIDTHS.FULL,height:w.ZP.HEIGHTS.MEDIUM,selectedValue:n})}const GY=g.mM.create({childOptionContent:{paddingLeft:30},nonDisabledNonSelectableOption:{color:Vt.Rl,":hover":{backgroundColor:Vt.Cj}}})
var zY=n(759426),$Y=n(977288),WY=n(61279),HY=n(569535)
function getDisabledGroupsForAddTeamMembers(e,t){return l.default.uniq([...getOrganizationWithoutTeamsIds(t).map((e=>({id:e,reason:"This organization does not have any teams"}))),...getUserOrganizationsSymmetricDifferenceIds(e,t).map((e=>({id:e,reason:"Some of the selected users are not members of this organization"}))),...getUserCommonTeamIds(e).map((e=>({id:e,reason:"All of the selected users are already members of this team"})))],!1,(({id:e})=>e))}function getUserOrganizationsSymmetricDifferenceIds(e,t){const n=l.default.intersection(...e.map((e=>e.organizations.flatMap((e=>e.id)))))
return l.default.difference(t.map((e=>e.id)),n)}function getOrganizationWithoutTeamsIds(e){return e.filter((e=>0===e.teams.length)).map((e=>e.id))}function getUserCommonTeamIds(e){return l.default.intersection(...e.map((e=>e.teams.flatMap((e=>e.id)))))}function getDisabledGroupsForRemoveTeamMembers(e,t){return l.default.uniq([...getOrganizationWithoutTeamsIds(t).map((e=>({id:e,reason:"This organization does not have any teams"}))),...getUserOrganizationsSymmetricDifferenceIds(e,t).map((e=>({id:e,reason:"Some of the selected users are not members of this organization"}))),...getUserTeamsSymmetricDifferenceIds(e,t).map((e=>({id:e,reason:"Some of the selected users are not members of this team"})))],!1,(({id:e})=>e))}function getUserTeamsSymmetricDifferenceIds(e,t){const n=t.flatMap((e=>e.teams.flatMap((e=>e.id)))),a=getUserCommonTeamIds(e)
return l.default.difference(n,a)}function getUserCommonOrganizationIds(e){return l.default.intersection(...e.map((e=>e.organizations.flatMap((e=>e.id)))))}function getDisabledGroupsForRemoveOrganizationMembers(e,t){return l.default.uniq([...getOrganizationsWithoutUsersIds(e,t).map((e=>({id:e,reason:"None of the selected users are members of this organization"})))],!1,(({id:e})=>e))}function getOrganizationsWithoutUsersIds(e,t){const n=l.default.uniq(e.flatMap((e=>e.organizations.flatMap((e=>e.id)))))
return t.map((e=>e.id)).filter((e=>!n.includes(e)))}const jY=xa.Ps`
  fragment OrganizationDropdownOrganization on OrganizationNode {
    id
    name
  }
`
function getDisplayName(e,t,n){const a=t.find((t=>t.id===e))
return a?a.name:n}function OrganizationDropdown(e){const{disabledInfos:t=[]}=e,n=function sortOrganizations(e,t){return(0,hs.Z)(e,[e=>t.includes(e.id)?"b":"a",e=>e.name.toLowerCase()])}(e.organizations,t.map((e=>e.id))).map((e=>{const n=t.find((t=>t.id===e.id))
return{name:e.name,value:e.id,disabled:Boolean(n)}}))
return d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Organization",isRequired:e.isRequired}),d.createElement($r.ZP,{disabled:0===e.organizations.length,displayName:getDisplayName(e.organizationId,e.organizations,e.defaultTitle),menu:d.createElement(Ar.Z,{scrollable:!0,onSelect:e.onSelectOrganizationId,optionDatas:n,renderOptionContent:e=>{const n=t.find((t=>t.id===e.value))
return n?d.createElement(gU.Z,{tooltipTitle:n?n.reason:void 0},d.createElement("div",{className:"u-faded"}," ",e.name," ")):d.createElement(RA.mp,{optionData:e})},height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.FULL,selectedValue:e.organizationId})}))}function OrganizationSelectionModal(e){const[t,n]=(0,d.useState)(null)
return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:()=>{e.onRequestSubmit(e.organizations.find((e=>e.id===t)))},title:e.title,footer:e.footerMessageFunc&&t?e.footerMessageFunc(t):"",footerPullRight:!0,buttons:[{submit:!0,text:e.buttonTitle,style:e.buttonStyle,disabled:!t}]},d.createElement(OrganizationDropdown,{organizationId:t,organizations:e.organizations,onSelectOrganizationId:n,disabledInfos:e.disabledInfos,defaultTitle:"Select an organization..."}))}var YY
!function(e){e.ADD_MEMBER="ADD_MEMBER"
e.REMOVE_MEMBER="REMOVE_MEMBER"}(YY||(YY={}))
async function updateOrganizationMembers(e,t,n){await HY.dQ(e.map((e=>e.id)),t.id,n)
v.ZP.success("Succesfully updated organization members.")}async function TenantActorsActions_updateTeamMembers(e,t,n){await function updateTeamMembers(e,t,n){return Cn.Ry({url:`/1/api/teams/${t}/members`,data:{updates:e.map((e=>({userId:e,operation:n})))}})}(e.map((e=>e.id)),t.id,n)
v.ZP.success("Succesfully updated team members.")}const QY=xa.Ps`
  fragment UsersOrganizationMembershipDropdownUser on UserNode {
    id
    organizations {
      id
      name
    }
  }
`,KY=xa.Ps`
  fragment BenchlingAppsOrganizationMembershipDropdownApp on BenchlingAppNode {
    id
    organizations {
      id
      name
    }
  }
`
function DropdownMenu({actors:e,organizations:t,actorString:n,onOrganizationMembershipChange:a}){return d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(N.Z,{onSelect:()=>{(0,Xn.Z)(OrganizationSelectionModal,{organizations:t,disabledInfos:(i=e,l.default.uniq([...getUserCommonOrganizationIds(i).map((e=>({id:e,reason:"All of the selected users are members of this organization"})))],!1,(({id:e})=>e))),title:`Add ${n}s to organization`,buttonTitle:"Add",buttonStyle:C.ZJ.PRIMARY,footerMessageFunc:t=>`${e.filter((e=>!e.organizations.find((e=>e.id===t)))).length} ${n}s will be added`,onRequestSubmit:async t=>{await updateOrganizationMembers(e,t,HY.Y0.ADD_MEMBER)
a()}})
var i}},"Add to organization"),d.createElement(N.Z,{onSelect:()=>{(0,Xn.Z)(OrganizationSelectionModal,{organizations:t,disabledInfos:getDisabledGroupsForRemoveOrganizationMembers(e,t),title:`Remove ${n}s from organization`,buttonTitle:"Remove",buttonStyle:C.ZJ.NEGATIVE,footerMessageFunc:t=>{const a=e.filter((e=>e.organizations.find((e=>e.id===t))))
return`${a.length} ${(0,de._6)(a.length,n)} will be removed`},onRequestSubmit:async t=>{await updateOrganizationMembers(e,t,HY.Y0.REMOVE_MEMBER)
a()}})}},"Remove from organization"))}function ActorsOrganizationMembershipDropdown({actors:e,button:t,organizations:n,actorString:a,onOrganizationMembershipChange:i}){return d.createElement(I.ZP,{className:f()((0,g.iv)(JY.dropdown),"dropdown-menu--dropLeft"),closeOnInsideClick:!0,closeOnOutsideClick:!0,menu:d.createElement(DropdownMenu,{actors:e,organizations:n,onOrganizationMembershipChange:i,actorString:a})},t)}const JY=g.mM.create({dropdown:{width:195}})
function TeamSelectionModal(e){const[t,n]=(0,d.useState)(null)
function getSelectedTeam(){const n=e.organizations.flatMap((e=>e.teams)).find((e=>e.id===t));(0,S.hu)(Boolean(n),"Selected team does not exist in the list of teams")
return n}return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:()=>{null!=t&&e.onRequestSubmit(getSelectedTeam())},title:e.title,footer:e.footerMessageFunc(t),footerPullRight:!0,buttons:[{text:e.buttonTitle,style:e.buttonStyle,submit:!0,disabled:!t}]},d.createElement($r.ZP,{displayName:t?getSelectedTeam().name:"Select a team...",menu:d.createElement(TeamSelectMenu,{selectedTeamId:t,organizations:e.organizations,onSelectTeam:n,disabledGroupInfos:e.disabledGroupInfos})}))}const XY=xa.Ps`
  fragment UsersTeamMembershipDropdownUser on UserNode {
    id
    organizations {
      id
      name
      teams {
        id
        name
      }
    }
    teams {
      id
      name
    }
  }
`,eQ=xa.Ps`
  fragment BenchlingAppTeamMembershipDropdownApp on BenchlingAppNode {
    id
    organizations {
      id
      name
      teams {
        id
        name
      }
    }
    teams {
      id
      name
    }
  }
`
function ActorsTeamMembershipDropdown_DropdownMenu({actors:e,organizations:t,actorString:n,onTeamMembershipChange:a}){return d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(N.Z,{onSelect:async()=>{const i=await(0,Xn.Z)(TeamSelectionModal,{organizations:t,disabledGroupInfos:getDisabledGroupsForAddTeamMembers(e,t),onRequestClose:()=>{},title:`Add ${n}s to team`,buttonTitle:"Add",buttonStyle:C.ZJ.PRIMARY,footerMessageFunc:t=>{if(!t)return null
const a=function getActorsNotInTeam(e,t){return e.filter((e=>!e.teams.map((e=>e.id)).includes(t)))}(e,t)
return`${a.length} ${(0,de._6)(a.length,n)} will be added`}})
if(i){await TenantActorsActions_updateTeamMembers(e,i,YY.ADD_MEMBER)
a()}}},"Add to team"),d.createElement(N.Z,{onSelect:async()=>{const i=await(0,Xn.Z)(TeamSelectionModal,{organizations:t,disabledGroupInfos:getDisabledGroupsForRemoveTeamMembers(e,t),onRequestClose:()=>{},title:`Remove ${n}s from team`,buttonTitle:"Remove",buttonStyle:C.ZJ.NEGATIVE,footerMessageFunc:t=>{if(!t)return null
const a=function getActorsInTeam(e,t){return e.filter((e=>e.teams.map((e=>e.id)).includes(t)))}(e,t)
return`${a.length} ${(0,de._6)(a.length,n)} will be removed`}})
if(i){await TenantActorsActions_updateTeamMembers(e,i,YY.REMOVE_MEMBER)
a()}}},"Remove from team"))}function ActorsTeamMembershipDropdown({actors:e,button:t,organizations:n,actorString:a,onTeamMembershipChange:i}){return d.createElement(I.ZP,{className:f()((0,g.iv)(tQ.dropdown),"dropdown-menu--dropLeft"),closeOnInsideClick:!0,closeOnOutsideClick:!0,menu:d.createElement(ActorsTeamMembershipDropdown_DropdownMenu,{actors:e,actorString:a,organizations:n,onTeamMembershipChange:i})},t)}const tQ=g.mM.create({dropdown:{width:195}})
function BenchlingAppOverflowDropdown_DropdownMenu({apps:e,disableArchive:t,disableUnarchive:n,onRefreshAppListing:a}){return d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{(0,Cv.lf)(e,a)},isDisabled:t},(0,de._6)(e.length,"Archive app")),d.createElement(N.Z,{onSelect:()=>{(0,Cv.nL)(e,a)},isDisabled:n},(0,de._6)(e.length,"Unarchive app"))),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{const t=e.map((e=>e.id))
bc.dV(t)}},"Export audit logs")))}function BenchlingAppOverflowDropdown({apps:e,icon:t,disableArchive:n,disableUnarchive:a,onRefreshAppListing:i}){return d.createElement(OverflowDropdown,{menu:d.createElement(BenchlingAppOverflowDropdown_DropdownMenu,{apps:e,disableArchive:n,disableUnarchive:a,onRefreshAppListing:i}),icon:t})}const nQ=[50,100,500],aQ=xa.Ps`
  fragment UserListingCriteriaFormOrganization on OrganizationNode {
    id
    teams {
      ...TeamFilterTeam
    }
  }
  ${Jj.cp}
`
function getOrganizationById(e,t){const n=e.find((e=>e.id===t));(0,S.hu)(Boolean(n),`Selected organization ("${t}") should exist in organizations list`)
return n}function computeNewGroupCriteria(e,t){let n=e;(function shouldClearTeamFilter(e,t){const n=(0,NN.$V)(e,Kn.Vm.TEAM),a=(0,NN.$V)(e,Kn.Vm.ORGANIZATION)
if(!n||!a)return!1
if(a===Kj.$p.value)return!0
const i=getOrganizationById(t,a)
if(0===i.teams.length)return!0
if(n===Jj.$p.value)return!1
const s=n
return!i.teams.some((e=>e.id===s))})(n,t)&&(n=(0,NN.sg)(n,{key:Kn.Vm.TEAM,operator:Kn.EF.IS,value:null}))
return function getGroupCriteriaFromFilters(e){const t=(0,NN.$V)(e,Kn.Vm.ORGANIZATION)||void 0,n=(0,NN.$V)(e,Kn.Vm.TEAM)||void 0,a=(0,NN.$V)(e,Kn.Vm.CAPABILITIES)||void 0,i=(0,NN.$V)(e,Kn.Vm.ACCOUNT_STATUS)||void 0
return{...t===Kj.$p.value?{isNotInOrganization:!0}:{organizationId:t},...n===Jj.$p.value?{isNotInTeam:!0}:{teamId:n},capabilityKeys:a,accountStatus:i}}(n)}function UserListingCriteriaForm({listingCriteria:e,organizations:t,capabilities:n,onChange:a,showBenchlingAdminControls:i,limit:s,onChangeLimit:r}){const{isNotInOrganization:o,organizationId:c}=e,u=o?[]:function getTeamsForOrganization(e,t){return e?getOrganizationById(t,e).teams:function getAllTeams(e){return e.flatMap((e=>e.teams))}(t)}(c,t),m=n.filter((e=>e.isEnabled||i)),p=function makeFiltersFromCriteria({organizationId:e,isNotInOrganization:t,teamId:n,isNotInTeam:a,capabilityKeys:i,accountStatus:s}){const r=s&&{key:Kn.Vm.ACCOUNT_STATUS,operator:Kn.EF.IS_ONE_OF,value:s}
return l.default.compact([e&&{key:Kn.Vm.ORGANIZATION,operator:Kn.EF.IS,value:e},t&&{key:Kn.Vm.ORGANIZATION,operator:Kn.EF.IS,value:Kj.$p.value},n&&{key:Kn.Vm.TEAM,operator:Kn.EF.IS,value:n},a&&{key:Kn.Vm.TEAM,operator:Kn.EF.IS,value:Jj.$p.value},i&&{key:Kn.Vm.CAPABILITIES,operator:Kn.EF.IS_ONE_OF,value:i},r])}(e),h=[{filterKey:Kn.Vm.ORGANIZATION,extraProps:{organizations:t,shouldIncludeNone:!0}},{filterKey:Kn.Vm.TEAM,extraProps:{teams:u,shouldIncludeNone:!0}},...dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING?[{filterKey:Kn.Vm.CAPABILITIES,extraProps:{capabilities:m}}]:[],{filterKey:Kn.Vm.ACCOUNT_STATUS}]
return d.createElement("div",{className:"u-flex-display"},d.createElement(nc.ZP,{className:f()("u-mini-spacing-right u-mini-spacing-bottom",(0,g.iv)(iQ.queryInput)),placeholder:"Search for users",onChange:function handleQueryChange(e){a(function getQueryUpdater(e){return t=>({...t,query:e})}(e.target.value))},value:e.query}),d.createElement(Hu.Z,{primaryFilterOptions:h,secondaryFilterGroups:[],selectedSchema:null,filters:p,onChangeFilters:function handleFiltersChange(e){const n=computeNewGroupCriteria(e,t)
a(getGroupUpdater(n))}}),d.createElement(qT.Z,{pageSizeConfig:{availablePageSizes:nQ,pageSize:s,onSetPageSize:e=>{r(e)}}}))}const iQ=g.mM.create({queryInput:{width:267}})
var sQ,rQ
!function(e){e.USERS="users_modal"
e.TEAMS="teams_modal"
e.ORGANIZATIONS="organizations_modal"}(sQ||(sQ={}))
!function(e){e.OPENED="opened"
e.EDITED="edited"
e.COMPLETED="completed"
e.CLOSED="closed"}(rQ||(rQ={}))
function trackCapabilityAccessChange(e,t,n,a){t.forEach((t=>{const i=n.find((e=>e.key===t.key))
t.accessLevel!==i.accessLevel&&m.j("capability_management",rQ.EDITED,{page:e,currentUser:Jn.Z.currentUser().id,affectedEntities:a.map((e=>e.id)),application:t.key,previousAccess:i.accessLevel,newAccess:t.accessLevel,eventLastModified:"FY21_Q4b2"})}))}function trackCapabilityManagementModalAction(e,t,n){m.j("capability_management",e,{page:t,currentUser:Jn.Z.currentUser().id,affectedEntities:n.map((e=>e.id)),eventLastModified:"FY21_Q4b2"})}function SuspendUserConfirmationModal(e){const t="Suspend "+(e.suspendMultiple?"these users":"this user")
return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,title:"Suspend users?",buttons:[{text:t,style:C.ZJ.NEGATIVE,onClick:()=>{e.onSuspend()
e.onRequestClose()},dataTestAttrs:{component:"Modal",element:"footerButton",key:"confirmSuspend"}}],footer:d.createElement("span",{className:"u-faded"}," ",e.warningText," "),footerPullRight:!0},d.createElement("div",null,d.createElement("p",null,"Users will be logged out of current sessions and locked out of Benchling.")))}const oQ={fragment:xa.Ps`
  fragment UserIsSuspended on UserNode {
    id
    suspended
  }
`,fragmentName:"UserIsSuspended"}
function updateUserIsSuspended(e){Object.entries(e).forEach((([e,t])=>{(0,Ml.writeFragmentsToCache)(oQ,[{__typename:"UserNode",id:e,suspended:t}])}))}function makeIsSuspendedByUserId(e,t){return e.reduce(((e,n)=>({...e,[n]:t})),{})}function verifySuspendedUsers(e,t){const n=Jn.Z.currentUser()
let a
if(t&&e.includes(n.id)){a="Your own user will not be suspended"
if(!(e=l.default.without(e,n.id)).length){v.ZP.warn("You cannot suspend yourself.")
return}}t?(0,Xn.Z)(SuspendUserConfirmationModal,{suspendMultiple:e.length>1,onSuspend:()=>updateSuspendedUsers(e,t),warningText:a||void 0}):updateSuspendedUsers(e,t)}async function updateSuspendedUsers(e,t){const n=makeIsSuspendedByUserId(e,t),a=makeIsSuspendedByUserId(e,!t)
await(0,$C.Y)({persistData:async()=>{try{await q$.f1(n)
const a=`Successfully ${t?"suspended":"unsuspended"} ${(0,de._6)(e.length,"user")}.`
v.ZP.success(a)}catch(n){if(400!==n.status){const n=`Could not ${t?"suspend":"unsuspend"} ${(0,de._6)(e.length,"user")}.`
v.ZP.error(n)
return}throw n}},writeDataToCache:updateUserIsSuspended,optimisticData:n,revertData:a})}const lQ={fragment:xa.Ps`
  fragment UserUpdateProfile on UserNode {
    id
    name
    handle
    email
  }
`,fragmentName:"UserUpdateProfile"}
function writeUserProfileToCache(e){(0,Ml.writeFragmentsToCache)(lQ,[{__typename:"UserNode",id:e.id,name:e.name,handle:e.handle,email:e.email}])}async function updateUserProfile(e,t){const n=(0,jc.Z)(t,"name","handle","email")
await(0,$C.Y)({persistData:async()=>{try{await q$.Nq(t.id,n)
v.ZP.success("Successfully updated user information.")}catch(e){if(400!==e.status){v.ZP.error("Could not update user information.")
return}throw e}},writeDataToCache:writeUserProfileToCache,optimisticData:t,revertData:e})}const cQ={[on.e2.NOTEBOOK]:[],[on.e2.MOLBIO]:[],[on.e2.REGISTRY]:[],[on.e2.RESULTS]:[on.e2.REGISTRY],[on.e2.INVENTORY]:[on.e2.REGISTRY],[on.e2.REQUESTS]:[on.e2.NOTEBOOK,on.e2.REGISTRY,on.e2.RESULTS],[on.e2.WORKFLOWS]:[on.e2.NOTEBOOK,on.e2.REGISTRY,on.e2.RESULTS],[on.e2.LAB_AUTOMATION]:[on.e2.NOTEBOOK,on.e2.REGISTRY],[on.e2.INSIGHTS]:[],[on.e2.DEVELOPER_PLATFORM]:[],[on.e2.PROCESSES]:[]},dQ=new Map(Object.entries(cQ)),uQ=Array.from(dQ.keys()).reduce(((e,t)=>{e.set(t,[])
dQ.get(t).forEach((n=>{e.set(n,[...e.get(n),t])}))
return e}),new Map)
function getCapabilityKeyToParentCapabilitiesPreventingHigherAccess(e,t){const n=e.reduce(((t,n)=>{const a=dQ.get(n.key).map((t=>e.find((e=>e.key===t))))
t.set(n.key,a)
return t}),new Map)
if(![...n.values()].flat().every((e=>e))){v.ZP.warn("Your tenant is missing one or more required applications. Please contact Benchling support to configure.")
throw new Error("Missing required parent application accesses")}return e.reduce(((e,a)=>{const i=function getParentCapabilitiesPreventingHigherAccess(e,t){const n=function mapMultipleValuesAccessLevelToLowest(e,t){return e.map((e=>e.accessLevel===rn.dm?{...e,accessLevel:getLowestAccessLevel([...t.get(e.key)])}:e))}(e,t),a=getLowestAccessLevel(n.map((e=>e.accessLevel)))
return a!==rn.uv.FULL_ACCESS?n.filter((e=>e.accessLevel===a)):[]}(n.get(a.key),t)
e.set(a.key,i)
return e}),new Map)}function getLowestAccessLevel(e){return e.reduce(((e,t)=>(0,mY.$6)(e,t)?t:e),rn.uv.FULL_ACCESS)}function adjustCapabilitiesToSatisfyDependenciesAfterUpdate(e,t,n){var a
const i=function getCapabilitiesInvalidatedByAccessDecrease(e,t,n){if(!(0,mY.$6)(e.accessLevel,t))return[]
return l.default.compact(uQ.get(e.key).map((e=>n.find((t=>t.key===e))))).filter((e=>(0,mY.$6)(e.accessLevel,t)))}(e,t,n),s=i.map((e=>e.key))
return{invalidCapabilities:i,adjustedCapabilities:[...n.map((e=>s.includes(e.key)?{...e,accessLevel:sanitizeAccessLevel(e,t)}:e)),{...e,accessLevel:t,edited:null!==(a=e.edited)&&void 0!==a&&a}]}}function sanitizeAccessLevel(e,t){return t===rn.uv.READ_ACCESS&&on.L7.includes(e.key)?rn.uv.NO_ACCESS:t}function BenchlingTooltip({content:e}){return d.createElement(P.ZP,{title:e},d.createElement("span",{className:f()((0,g.iv)(mQ.benchlingIconContainer),"u-mini-spacing-left")},d.createElement(pe.Z,{className:"helpIcon",icon:"benchling"})))}function getDisabledAccessTooltipText(e,t,n,a){if(a)return"Only Full Access supported"
let i="access"
if(dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING_READ_ACCESS){i="Full or Read Access";(on.L7.includes(e.key)||n)&&(i="Full Access")}const s=(0,mY.Tp)(t).map((e=>e.displayName))
return`Requires ${i} to ${(0,Mt.Dw)(s)}`}function CapabilityListing_CapabilityRow(e){const t=rn.ji.filter((t=>function shouldShowAccessLevelForCapability(e,t){return e!==rn.uv.READ_ACCESS||dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING_READ_ACCESS&&!on.L7.includes(t.key)}(t,e.capability))),n=function highestAllowedAccessLevelForCapability(e,t){return 0===t.length?rn.uv.FULL_ACCESS:sanitizeAccessLevel(e,t[0].accessLevel)}(e.capability,e.restrictingParentCapabilities),a=d.createElement(w.ZP,{height:Nr.Bl.MEDIUM,value:e.capability.accessLevel,width:Nr.zL.FULL},t.reverse().map((t=>{const a=(0,mY.$6)(t,n)
return d.createElement(N.Z,{key:t,onSelect:e.onChangeAccessLevel,shouldEllipsize:!0,value:t,isDisabled:a,tooltipTitle:a?getDisabledAccessTooltipText(e.capability,e.restrictingParentCapabilities,!0):"",tooltipPlacement:P.TQ.RIGHT},rn.hN[t])}))),i=on.Bz.includes(e.capability.key),s=i||n===rn.uv.NO_ACCESS
return d.createElement(h.Z,{className:(0,g.iv)(mQ.row),dataTestAttrs:{component:"CapabilityRow",element:"root"}},d.createElement(p.Z,{xs:6,sm:6,md:6,lg:6},d.createElement("span",{className:(0,g.iv)(mQ.text)},e.capability.displayName,!e.capability.isEnabled&&e.tooltipText&&d.createElement(BenchlingTooltip,{content:e.tooltipText}))),d.createElement(p.Z,{xs:6,sm:6,md:6,lg:6},d.createElement(P.pf,{tooltipTitle:s?getDisabledAccessTooltipText(e.capability,e.restrictingParentCapabilities,!1,i):"",tooltipPlacement:P.TQ.RIGHT},d.createElement($r.ZP,{menu:a,displayName:rn.hN[e.capability.accessLevel],disabled:s,buttonClassName:e.capability.edited?(0,g.iv)(mQ.editedDropdown):void 0}))))}function CapabilityListing(e){(0,S.hu)(e.capabilities.every((e=>null!=e.accessLevel)),"Expected every capability to have a defined access level.")
const t=e.capabilityKeyToDistinctAccessLevels?getCapabilityKeyToParentCapabilitiesPreventingHigherAccess(e.capabilities,e.capabilityKeyToDistinctAccessLevels):new Map,n=(0,hs.Z)((0,mY.Tp)(e.capabilities),[{accessor:"isEnabled",reversed:!0}])
return d.createElement(Ke.Z,null,d.createElement(h.Z,{className:(0,g.iv)(mQ.headerRow)},d.createElement(p.Z,{md:6},d.createElement(Je.Z,null,"Application")),d.createElement(p.Z,{md:6},d.createElement(Je.Z,null,"Access"))),n.map((n=>{var a
return(n.isEnabled||e.showDisabledCapabilities)&&d.createElement(CapabilityListing_CapabilityRow,{key:n.key,capability:n,onChangeAccessLevel:t=>{n.edited=!0
e.onChangeAccessLevel(n,t)},tooltipText:e.tooltipText,restrictingParentCapabilities:null!==(a=t.get(n.key))&&void 0!==a?a:[]})})))}const mQ=g.mM.create({headerRow:{paddingBottom:3},row:{..._n.hv,paddingBottom:10},text:{paddingTop:5},benchlingIconContainer:{alignItems:"center",backgroundColor:Vt.Ej,borderRadius:"50%",display:"inline-flex",height:"14px",justifyContent:"center",width:"14px"},editedDropdown:{borderColor:Vt.t0}})
function getButtonsForAction(e,t){const n={text:"Continue",submit:!0,style:C.ZJ.NEGATIVE},a={text:"Override",submit:!0,style:C.ZJ.SECONDARY},i={text:"Do not Override",style:C.ZJ.SECONDARY,onClick:t},s={text:"Remove",submit:!0,style:C.ZJ.NEGATIVE}
switch(e){case rn.so.DIRECT_REMOVAL:return[s]
case rn.so.INDIRECT_REDUCTION:return[i,a]
case rn.so.INDIRECT_REMOVAL:case rn.so.INDIRECT_MIXED:return[n]
default:return[]}}function makeWarningMessage(e,t){const n=function getActionText(e){switch(e){case rn.so.DIRECT_REMOVAL:case rn.so.INDIRECT_REMOVAL:return"remove"
case rn.so.INDIRECT_REDUCTION:return"reduce"
case rn.so.INDIRECT_MIXED:return"reduce and/or remove"
default:return null}}(t);(0,S.hu)(null!=n,"Expected a valid action.")
return`This change will ${n} access for ${1===e.length?`${e[0].name}`:`${e.length} users`}. Do you want to continue with the change?`}function AccessChangeWarningModal(e){(0,S.hu)(e.users.length>0,"Expected at least one user.")
e.action===rn.so.INDIRECT_REDUCTION&&(0,S.hu)(null!=e.onDoNotOverride,"Expected onDoNotOverride function to be defined.")
const t=makeWarningMessage(e.users,e.action),cancelAndClose=()=>{e.onCancel()
e.onRequestClose()}
return d.createElement(et.ZP,{onRequestClose:cancelAndClose,onRequestSubmit:()=>{e.onSubmit()
e.onRequestClose()},title:"Warning",medium:!0,buttons:[{text:"Go Back",cancel:!0,style:C.ZJ.TERTIARY_GRAY,onClick:cancelAndClose},...getButtonsForAction(e.action,(()=>{e.onDoNotOverride&&e.onDoNotOverride()
e.onRequestClose()}))]},d.createElement("p",{className:"u-spacing-bottom"},t))}function getUserIdToChangedCapabilities(e,t,n){return e.reduce(((e,a)=>{e.set(a.id,a.capabilities.filter((e=>function isChangedCapability(e,t,n){if(n.INITIAL.includes(e.accessLevel)){const a=t.find((t=>t.key===e.capability.key))
if(a&&n.FINAL.includes(a.accessLevel))return!0}return!1}(e,t,n))))
return e}),new Map)}function getIndirectAccessChangeAction(e,t){return e&&t?rn.so.INDIRECT_MIXED:e?rn.so.INDIRECT_REMOVAL:t?rn.so.INDIRECT_REDUCTION:null}function joinRemovedAndReducedCapabilities(e,t){return Array.from(e.keys()).reduce(((n,a)=>{const i=e.get(a),s=t.get(a)
n.set(a,[...i,...s])
return n}),new Map)}async function saveUsersCapabilitiesWithoutOverride(e,t,n){const a=e.map((e=>({userId:e.id,capabilities:getCapabilitiesWithoutOverride(e,t,n.get(e.id))})))
await updateUsersCapabilities(a)}function getCapabilitiesWithoutOverride(e,t,n){return t.map((e=>{const t=n.find((t=>t.capability.key===e.key))
return{key:e.key,accessLevel:t?t.accessLevel:e.accessLevel}}))}function AppDependencyWarningModal(e){const t=function AppDependencyWarningModal_makeWarningMessage(e,t,n){return d.createElement(d.Fragment,null,d.createElement("p",null,"Setting ",e.displayName," access to"," ",d.createElement("strong",null,rn.hN[t])," will change the following:"),d.createElement("ul",null,(0,mY.Tp)(n).map((e=>d.createElement("li",{key:e.displayName},e.displayName,": ",rn.hN[e.accessLevel]," to"," ",d.createElement("strong",null,rn.hN[sanitizeAccessLevel(e,t)]))))),d.createElement("p",null,"Continue with these changes?"))}(e.updatedCapability,e.newAccessLevel,e.invalidCapabilities),n=dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING_READ_ACCESS?"Reduce":"Remove"
return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:()=>{e.onSubmit()
e.onRequestClose()},title:`${n} access`,medium:!0,buttons:[{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,onClick:e.onRequestClose},{text:`${n} Access`,submit:!0,style:C.ZJ.NEGATIVE}]},t)}const pQ=xa.Ps`
  fragment CapabilityManagementViewCapability on CapabilityNode {
    key
    displayName
    isEnabled
  }
`
function CapabilityManagementView(e){return d.createElement(d.Fragment,null,e.descriptionText&&d.createElement("p",{className:(0,g.iv)(hQ.descriptionText)},e.descriptionText),d.createElement(CapabilityListing,{capabilities:e.capabilities,onChangeAccessLevel:e.onChangeCapabilityAccessLevel,showDisabledCapabilities:e.showBenchlingAdminControls,capabilityKeyToDistinctAccessLevels:e.capabilityKeyToDistinctAccessLevels}))}const hQ=g.mM.create({descriptionText:{paddingBottom:16}})
function UnsavedChangesWarningModal(e){return d.createElement(et.ZP,{onRequestClose:()=>{e.onCancel()
e.onRequestClose()},onRequestSubmit:()=>{e.onSubmit()
e.onRequestClose()},title:"Exit without saving?",medium:!0,buttons:[{text:"Go Back",cancel:!0,style:C.ZJ.TERTIARY_GRAY},{text:"Exit",submit:!0,style:C.ZJ.SECONDARY}]},"You've made changes to application access without saving. Unsaved changes will be lost.")}const gQ=xa.Ps`
  fragment UserCapabilitiesModalUser on UserNode {
    id
    name
    capabilities {
      id
      capability {
        ...CapabilityManagementViewCapability
      }
      accessLevel
    }
  }
  ${pQ}
`
async function handleUpdateUsersCapabilities(e,t){const n=(0,mY.KV)(t).map((e=>({key:e.key,accessLevel:e.accessLevel}))),a=e.map((e=>({userId:e.id,capabilities:n})))
await updateUsersCapabilities(a)}function UserCapabilitiesModal(e){(0,S.hu)(e.users.length>0,"Expected at least one user.")
const[t,n]=d.useState(!0),a=e.users.flatMap((e=>e.capabilities)),i=(0,mY.Mr)(e.capabilities,a,e.users.length),s=(0,mY.vy)(i,e.capabilities,e.showBenchlingAdminControls),[r,o]=d.useState(!1),[c,u]=d.useState(s),setCapabilitiesAndTrackChanges=t=>{trackCapabilityAccessChange(sQ.USERS,t,c,e.users)
u(t)},updateUsersCapabilities=async()=>{o(!0)
await handleUpdateUsersCapabilities(e.users,c)
trackCapabilityManagementModalAction(rQ.COMPLETED,sQ.USERS,e.users)
o(!1)
e.onRefreshUserListing()
v.ZP.success("Successfully updated application access.")
e.onRequestClose()},m=`Manage application access: ${e.users.length>1?`${e.users.length} selected users`:e.users[0].name}`
return d.createElement(d.Fragment,null,t&&d.createElement(et.ZP,{onRequestClose:()=>{(()=>{if((0,mY.P1)(c,s)){n(!1);(0,Xn.Z)(UnsavedChangesWarningModal,{onSubmit:()=>{e.onRequestClose()},onCancel:()=>{n(!0)}})}else e.onRequestClose()})()},onRequestSubmit:()=>{(()=>{const t=getUserIdToChangedCapabilities(e.users,c,rn.bG.REMOVAL),a=e.users.filter((e=>t.get(e.id).length>0))
if(a.length>0){n(!1);(0,Xn.Z)(AccessChangeWarningModal,{users:a,action:rn.so.DIRECT_REMOVAL,onSubmit:updateUsersCapabilities,onCancel:()=>{n(!0)}})}else updateUsersCapabilities()})()},title:m,medium:!0,buttons:[{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,disabled:r},{text:"Save",submit:!0,style:C.ZJ.SECONDARY,disabled:r}]},d.createElement(CapabilityListing,{capabilities:c,capabilityKeyToDistinctAccessLevels:i,onChangeAccessLevel:(e,t)=>{const[n,a]=l.default.partition(c,(t=>t.key===e.key)),{invalidCapabilities:i,adjustedCapabilities:s}=adjustCapabilitiesToSatisfyDependenciesAfterUpdate(n[0],t,a)
i.length>0?(0,Xn.Z)(AppDependencyWarningModal,{updatedCapability:n[0],newAccessLevel:t,invalidCapabilities:i,onSubmit:()=>{setCapabilitiesAndTrackChanges(s)}}):setCapabilitiesAndTrackChanges(s)},showDisabledCapabilities:e.showBenchlingAdminControls,tooltipText:"Only Benchling admins are allowed to manage access to this application."})))}function ConfirmRemoveAPIKeyModal(e){return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:async function handleSubmit(){await function revokeAPIKeys({userId:e}){return Cn.WY({url:`/1/api/users/${e}/keys`})}({userId:e.user.id})
e.onRefreshUserListing()
v.ZP.success(`Successfully removed ${e.user.name}'s API Key.`)
e.onRequestSubmit()},title:"Confirm API key removal",buttons:[{text:"Remove Key",submit:!0,style:C.ZJ.NEGATIVE}]},"Confirm you’d like to remove ",e.user.name,"'s API key. The user can visit their User Settings page to regenerate a key.")}function ManageAPIKeyModal(e){var t
return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:()=>{!function handleSubmit(){e.onRequestSubmit();(0,Xn.Z)(ConfirmRemoveAPIKeyModal,{user:e.user,onRefreshUserListing:e.onRefreshUserListing})}()},title:`Manage API Key: ${e.user.name}`,buttons:[{text:"Remove Key",submit:!0,style:C.ZJ.NEGATIVE}]},d.createElement(h.Z,null,d.createElement(p.Z,{md:8},d.createElement(d.Fragment,null,"Manage ",e.user.name,"'s API Key access."))),d.createElement(h.Z,{className:"u-spacing-top"},d.createElement(p.Z,{md:8},d.createElement(pe.Z,{icon:"key",className:(0,g.iv)(EQ.keyIcon)}),d.createElement("span",{className:"u-bold-font-weight u-mini-spacing-left"},e.user.name,"’s API Key"),d.createElement("div",null,"Created: ",(null===(t=e.user.apiKey)||void 0===t?void 0:t.createdAt)?(0,Hr.UT)(e.user.apiKey.createdAt):null))))}const EQ=g.mM.create({keyIcon:{color:Vt.TG}})
function UserOverflowDropdown_DropdownMenu({users:e,capabilities:t,disableSuspend:n,disableUnsuspend:a,showBenchlingAdminControls:i,onRefreshUserListing:s}){var r,o
const[l,c]=d.useState(!1),u=e.map((e=>e.id)),m=e.length>1,p="Suspend user",h="Unsuspend user",handleSuspendUsers=e=>{c(!0)
verifySuspendedUsers(u,e)
c(!1)},g=!m,E=We.Z.get(Yj.oI)&&!m
return d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},!m&&d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{navigateToUserPage(e[0].id)}},"View user details")),dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING&&d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{trackCapabilityManagementModalAction(rQ.OPENED,sQ.USERS,e);(0,Xn.Z)(UserCapabilitiesModal,{users:e,capabilities:t,showBenchlingAdminControls:i,onRefreshUserListing:s,onRequestClose:()=>{trackCapabilityManagementModalAction(rQ.CLOSED,sQ.USERS,e)}})},isDisabled:l,dataTestAttrs:{component:"UserOverflowDropdown",element:"option",key:"manageApplicationAccess"}},"Manage application access")),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{handleSuspendUsers(!0)},isDisabled:l||n},m?(0,de._6)(2,p):p),d.createElement(N.Z,{onSelect:()=>{handleSuspendUsers(!1)},isDisabled:l||a},m?(0,de._6)(2,h):h)),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{bc.dV(e.map((e=>e.id)))},dataTestAttrs:{component:"UserOverflowDropdown",element:"option",key:"exportAuditLogs"}},Tc.QU)),d.createElement(jI.Z,null,g&&d.createElement(N.Z,{onSelect:()=>{(0,Xn.Z)(ManageAPIKeyModal,{user:e[0],onRefreshUserListing:s})},isDisabled:null==(null===(o=null===(r=e[0])||void 0===r?void 0:r.apiKey)||void 0===o?void 0:o.createdAt)},"Manage API Key"),E&&d.createElement(N.Z,{onSelect:()=>(0,$b.Z)(u[0],{showToastOnSuccess:!0,toastText:"Copied API ID to clipboard."})},"Copy user API ID")))}function UserOverflowDropdown({users:e,capabilities:t,icon:n,disableSuspend:a,disableUnsuspend:i,showBenchlingAdminControls:s,onRefreshUserListing:r}){return d.createElement(OverflowDropdown,{menu:d.createElement(UserOverflowDropdown_DropdownMenu,{users:e,capabilities:t,disableSuspend:a,disableUnsuspend:i,showBenchlingAdminControls:s,onRefreshUserListing:r}),icon:n})}function ToolbarButton(e){const t=(e.disabled?e.disabledTooltipTitle:e.tooltipTitle)||"",n=Boolean(t)
return d.createElement(P.ZP,{disabled:!n,title:t},d.createElement(C.Co,{className:(0,g.iv)(fQ.toolbarSpacing),size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_GRAY,...e}))}function Toolbar({organizations:e,teams:t,selectedUsers:n,capabilities:a,showBenchlingAdminControls:i,onRefreshUserListing:s}){const r=n.length>0
return d.createElement("div",{className:"u-vertical-center-items u-mini-spacing-bottom"},d.createElement(C.Co,{className:(0,g.iv)(fQ.toolbarSpacing),size:C.qE.SMALL,buttonStyle:C.ZJ.SECONDARY,text:"Create users",onClick:function handleCreateUsersClick(){(0,Xn.Z)(cH,{teams:t,organizations:e,showBenchlingAdminControls:i,onSuccess:()=>{s()}})},dataTestAttrs:{component:"UserListingHeader",element:"button",key:"createUsers"}}),d.createElement(ToolbarButton,{icon:"export",onClick:async function handleExport(){const e=await function getUserExportFileURL(){return Cn.sM("/1/api/users:export")}()
window.location.href=e},tooltipTitle:"Export all users"}),d.createElement("div",{className:(0,g.iv)(fQ.verticalSeparator,fQ.toolbarSpacing)}),d.createElement(ActorsTeamMembershipDropdown,{button:d.createElement(ToolbarButton,{icon:"add-to-team",disabled:!r,tooltipTitle:"Add or remove team members",disabledTooltipTitle:"Add or remove team members (Please select users)"}),actors:n,actorString:"user",organizations:e,onTeamMembershipChange:()=>{s()}}),d.createElement(ActorsOrganizationMembershipDropdown,{button:d.createElement(ToolbarButton,{icon:"add-to-org",disabled:!r,tooltipTitle:"Add or remove organization members",disabledTooltipTitle:"Add or remove organization members (Please select users)"}),actorString:"user",actors:n,organizations:e,onOrganizationMembershipChange:()=>{s()}}),d.createElement(UserOverflowDropdown,{users:n,capabilities:a,icon:d.createElement(ToolbarButton,{icon:"overflow",disabled:!r,tooltipTitle:"More options"}),disableSuspend:!1,disableUnsuspend:!1,showBenchlingAdminControls:i,onRefreshUserListing:s}))}function UserListingHeader(e){return d.createElement("header",{className:f()("u-small-padding-bottom u-lr-split",(0,g.iv)(fQ.header))},d.createElement(UserListingCriteriaForm,{listingCriteria:e.listingCriteria,organizations:e.organizations,capabilities:e.capabilities,onChange:e.onChangeListingCriteria,showBenchlingAdminControls:e.showBenchlingAdminControls,limit:e.limit,onChangeLimit:e.onChangeLimit}),d.createElement(Toolbar,{organizations:e.organizations,teams:e.teams,selectedUsers:e.selectedUsers,capabilities:e.capabilities,showBenchlingAdminControls:e.showBenchlingAdminControls,onRefreshUserListing:e.onRefreshUserListing}))}const fQ=g.mM.create({header:{alignItems:"flex-start"},toolbarSpacing:{margin:"0 3px",flexShrink:0},verticalSeparator:{backgroundColor:Vt.pF,width:2,height:16}})
function BenchlingAppsListingHeader({organizations:e,selectedApps:t,onRefreshAppListing:n}){const a=t.length>0
return d.createElement("div",{className:"u-vertical-center-items u-mini-spacing-bottom"},d.createElement(ActorsTeamMembershipDropdown,{button:d.createElement(ToolbarButton,{icon:"add-to-team",disabled:!a,tooltipTitle:"Add or remove team members",disabledTooltipTitle:"Add or remove team members (Please select apps)"}),actors:t,organizations:e,onTeamMembershipChange:()=>{n()},actorString:"app"}),d.createElement(ActorsOrganizationMembershipDropdown,{button:d.createElement(ToolbarButton,{icon:"add-to-org",disabled:!a,tooltipTitle:"Add or remove organization members",disabledTooltipTitle:"Add or remove organization members (Please select apps)"}),actors:t,actorString:"app",organizations:e,onOrganizationMembershipChange:()=>{n()}}),d.createElement(BenchlingAppOverflowDropdown,{apps:t,icon:d.createElement(ToolbarButton,{icon:"overflow",disabled:!a,tooltipTitle:"More options"}),disableArchive:t.every((e=>e.archived)),disableUnarchive:t.every((e=>!e.archived)),onRefreshAppListing:n}))}const SQ=xa.Ps`
  fragment BenchlingAppTableApp on BenchlingAppNode {
    id
    description
    handle
    name
    url
    lastSeen
    archived
    archiveRecord {
      purpose
    }
    organizations {
      id
      name
      handle
    }
    teams {
      id
      name
      handle
    }
    lifecycleManagement
    features {
      id
      name
      type
    }
  }
`
function BenchlingAppTable_generateRows(e,t,n){return e.map(((e,a)=>({id:e.id,icon:d.createElement(fC.Z,{entity:e,shape:SC.o.CIRCLE,size:SC.D.XSMALL}),data:{name:e.name,id:e.id,organizations:d.createElement(wv.Z,{parties:(0,hs.Z)(e.organizations,[e=>e.name.toLowerCase()])}),teams:d.createElement(wv.Z,{parties:(0,hs.Z)(e.teams,[e=>e.name.toLowerCase()])}),lastSeen:e.lastSeen?(0,Kl.Z)(e.lastSeen):null,overflow:d.createElement("div",{className:"u-text-align-right"},d.createElement(BenchlingAppOverflowDropdown,{apps:[e],icon:d.createElement(ExpandedClickableIcon,{icon:d.createElement(pe.Z,{icon:"overflow"})}),disableArchive:e.archived,disableUnarchive:!e.archived,onRefreshAppListing:n}))},extra:{app:e},isSelected:t.includes(e.id),isFaded:e.archived})))}const yQ=[{header:"Name",accessorKey:"name",flexGrow:1,sortKey:"name",isCollapsible:!1,isSortable:!0},{header:"ID",accessorKey:"id",width:300,sortKey:"id",isCollapsible:!1,isSortable:!0},{header:"Organizations",accessorKey:"organizations",isCollapsible:!0,isSortable:!1},{header:"Teams",accessorKey:"teams",isCollapsible:!0,isSortable:!1},{header:"Last Seen",accessorKey:"lastSeen",sortKey:"lastSeen",isCollapsible:!0,isSortable:!1},{header:"",accessorKey:"overflow",width:100,isCollapsible:!1,isSortable:!1,disableFiltering:!0}]
function getSortValueFromApp(e,t){const n=e.extra.app
switch(t){case"name":default:return n.name
case"id":return n.id}}function BenchlingAppTable({apps:e,onRefreshBenchlingAppListing:t,selectedAppIds:n,onAppSelectChange:a}){return d.createElement(UQ.Consumer,null,(()=>d.createElement(vr.ZP,{className:"u-flex-grow",hasLineBelowHeader:!0,rowSelectionMode:Tr.rT.MULTIPLE,columns:yQ,emptyTableText:"No apps",initialSort:[{sortKey:"name"}],initialRows:BenchlingAppTable_generateRows(e,n,t),onRowsSelect:(e,t)=>{a(e.map((e=>e.id)),t)},getRowContentHeight:()=>fC.Z.getHeight(SC.D.SMALL),getSortValue:getSortValueFromApp,onRowClick:({extra:e})=>{(0,ac.ZP)(e.app.url)}})))}const bQ=xa.Ps`
  query AppListingQuery($limitOffsetInput: LimitOffsetInput!) @skipAudit @engComponent(name: BENCHLING_APPS) {
    benchlingAppListing(limitOffsetInput: $limitOffsetInput) {
      ... on BenchlingAppListingNode {
        benchlingApps {
          ...BenchlingAppTableApp
          ...BenchlingAppTeamMembershipDropdownApp
          ...BenchlingAppsOrganizationMembershipDropdownApp
        }
        total
      }
    }
  }

  ${SQ}
  ${eQ}
  ${KY}
`
function BenchlingAppsTabFilterContainer(e){return d.createElement(Hu.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.ORGANIZATION,extraProps:{organizations:e.organizations}},{filterKey:Kn.Vm.TEAM,extraProps:{teams:e.teams}},{filterKey:Kn.Vm.ARCHIVE_PURPOSES,extraProps:{archivePurposes:dt.ZP.ARCHIVE_NON_DATA_PURPOSES}}],secondaryFilterGroups:[],filters:e.filters,onChangeFilters:e.onChangeFilters,selectedSchema:null})}function BenchlingAppHeader(e){const t=d.createElement(nc.ZP,{className:"u-flex-grow",placeholder:"Search for apps",value:e.searchQuery,onChange:t=>{e.onSetSearchQuery(t.target.value)}}),n=d.createElement(BenchlingAppsTabFilterContainer,{teams:e.teams,organizations:e.organizations,filters:e.filters,onChangeFilters:e.onChangeFilters})
return d.createElement(h.Z,null,d.createElement(p.Z,{md:10},d.createElement($Y.Z,{isExpanded:!0,queryInput:t,filtersContainer:n})),d.createElement(p.Z,{md:2},d.createElement(BenchlingAppsListingHeader,{organizations:e.organizations,selectedApps:e.selectedApps,onRefreshAppListing:e.onRefreshBenchlingAppListing})))}function BenchlingAppsListing({teams:e,organizations:t}){const[n,a]=d.useState([]),[i,s]=d.useState(""),[r,o]=d.useState([])
function handleAppSelectChange(e,t){o((n=>(0,WY.sv)(n,e,t,Tr.rT.MULTIPLE)))}return d.createElement(Da.ZP,{query:bQ,variables:{limitOffsetInput:{limit:250,offset:0}},renderLoading:()=>d.createElement(kl.b,null),fetchPolicy:"network-only"},((o,{refetch:l})=>{const c=(0,NN.$V)(n,Kn.Vm.ORGANIZATION),u=(0,NN.$V)(n,Kn.Vm.TEAM),m=(0,NN.$V)(n,Kn.Vm.ARCHIVE_PURPOSES),p=function filterApps(e,t,n,a,i){const s=e.filter((e=>(null==n||e.organizations.some((e=>e.id===n)))&&(null==a||e.teams.some((e=>e.id===a)))&&mo.Z.caseInsensitiveContains(e.name,t)))
return zY.F(s,i)||[]}(o.benchlingAppListing.benchlingApps,i,c,u,m)
return d.createElement(d.Fragment,null,d.createElement(BenchlingAppHeader,{selectedApps:function getSelectedApps(e){return e.filter((e=>r.includes(e.id)))}(p),organizations:t,teams:e,filters:n,onChangeFilters:a,searchQuery:i,onSetSearchQuery:s,onRefreshBenchlingAppListing:l}),d.createElement("div",{className:"u-spacing-top u-spacing-bottom"},d.createElement(BenchlingAppTable,{apps:p,selectedAppIds:r,onAppSelectChange:handleAppSelectChange,onRefreshBenchlingAppListing:l})))}))}const TQ=xa.Ps`
  query TenantAdminBenchlingAppsTabQuery @skipAudit @engComponent(name: BENCHLING_APPS) {
    currentTenant {
      id
      tenantAdminData {
        ... on TenantAdminDataNode {
          id
          organizations {
            ...OrganizationFilterOrganization
            ...OrganizationDropdownOrganization
            ...TeamSelectMenuOrganization
          }
          teams {
            ...TeamFilterTeam
          }
        }
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${Kj.Px}
  ${UY}
  ${jY}
  ${Jj.cp}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function TenantAdminBenchlingAppsTab(){return d.createElement(Da.ZP,{query:TQ,renderLoading:()=>d.createElement(BenchlingAppsListing,{teams:[],organizations:[]})},(({currentTenant:e})=>(0,ka.CZ)(e.tenantAdminData)?d.createElement(TenantAdminErrorBanner,null):d.createElement(BenchlingAppsListing,{organizations:e.tenantAdminData.organizations,teams:e.tenantAdminData.teams})))}function CreateOrganizationModal_NameField(e){return d.createElement(Ke.Z,null,d.createElement(Jl.Z,{label:"Name",value:e.organizationName,onChange:t=>{e.onChangeName(t.target.value)},isRequired:!0,dataTestAttrs:{component:"CreateOrganizationModal",element:"nameTextField"}}))}function HandleField(e){return d.createElement(Ke.Z,null,d.createElement(Jl.Z,{label:"Handle",value:e.organizationHandle,onChange:t=>{e.onChangeHandle(t.target.value)},isRequired:!0,dataTestAttrs:{component:"CreateOrganizationModal",element:"handleTextField"}}))}function CreateOrganizationModal(e){const[t,n]=d.useState({name:"",handle:""})
return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:async function handleSubmit(){try{await K$.Ue({name:t.name,handle:t.handle,redirectOnSuccess:!0})}finally{e.onRequestClose()}},title:"Create organization",medium:!0,buttons:[{text:"Create",submit:!0,style:C.ZJ.SECONDARY,disabled:!function requiredFieldsNonEmpty(){return t.name.length>0&&t.handle.length>0}()}],dataTestAttrs:{component:"CreateOrganizationModal",element:"root"}},d.createElement(CreateOrganizationModal_NameField,{organizationName:t.name,onChangeName:e=>{n((t=>({...t,name:e})))}}),d.createElement(HandleField,{organizationHandle:t.handle,onChangeHandle:e=>{n((t=>({...t,handle:e})))}}))}const vQ=xa.Ps`
  fragment OrganizationCapabilitiesModalOrganization on OrganizationNode {
    id
    members {
      ... on UserNode {
        id
        name
        capabilities {
          id
          capability {
            ...CapabilityManagementViewCapability
          }
          accessLevel
        }
      }
    }
    name
    autoProvisionedCapabilities {
      id
      capability {
        ...CapabilityManagementViewCapability
      }
      accessLevel
    }
  }
  ${pQ}
`
async function saveOrganizationsCapabilities(e,t){const n=getOrganizationIdsCapabilities(e,t)
await function updateOrganizationsCapabilities(e){return Cn.Ry({url:"/1/api/capabilities:bulk-update-organizations-capabilities",data:{organizationIdsCapabilities:e}})}(n)}async function saveOrganizationsProvisionedCapabilities(e,t){const n=getOrganizationIdsCapabilities(e,t)
await function updateOrganizationsProvisionedCapabilities(e){return Cn.Ry({url:"/1/api/capabilities:bulk-update-organizations-provisioned-capabilities",data:{organizationIdsCapabilities:e}})}(n)}function getOrganizationIdsCapabilities(e,t){const n=(0,mY.KV)(t).map((e=>({key:e.key,accessLevel:e.accessLevel})))
return e.map((e=>({organizationId:e.id,capabilities:n})))}function OrganizationCapabilitiesModal(e){(0,S.hu)(e.organizations.length>0,"Expected at least one organization.")
const t=e.organizations.flatMap((e=>e.autoProvisionedCapabilities)),n=(0,mY.Mr)(e.capabilities,t,e.organizations.length),a=(0,mY.vy)(n,e.capabilities,e.showBenchlingAdminControls),[i,s]=d.useState(!1),[r,o]=d.useState(a),[c,u]=d.useState(!0),m=e.organizations.flatMap((e=>e.members)),p=getUserIdToChangedCapabilities(m,r,rn.bG.REMOVAL),h=getUserIdToChangedCapabilities(m,r,rn.bG.REDUCTION),g=joinRemovedAndReducedCapabilities(p,h),setCapabilitiesAndTrackChanges=t=>{trackCapabilityAccessChange(sQ.ORGANIZATIONS,t,r,e.organizations)
o(t)},handleDoNotOverride=async()=>{s(!0)
await saveUsersCapabilitiesWithoutOverride(m,r,g)
await saveOrganizationsProvisionedCapabilities(e.organizations,r)
trackCapabilityManagementModalAction(rQ.COMPLETED,sQ.ORGANIZATIONS,e.organizations)
s(!1)
e.refreshOrganizationListing()
v.ZP.success("Successfully updated application access, without overriding.")
e.onRequestClose()},updateOrganizationsCapabilities=async()=>{s(!0)
const t=r.filter(((e,t)=>e.edited))
await saveOrganizationsCapabilities(e.organizations,t)
await saveOrganizationsProvisionedCapabilities(e.organizations,t)
trackCapabilityManagementModalAction(rQ.COMPLETED,sQ.ORGANIZATIONS,e.organizations)
s(!1)
e.refreshOrganizationListing()
v.ZP.success("Successfully updated application access.")
e.onRequestClose()},E=`Manage application access: ${e.organizations.length>1?"Selected organizations":e.organizations[0].name}`
return d.createElement(d.Fragment,null,c&&d.createElement(et.ZP,{onRequestClose:()=>{(()=>{if((0,mY.P1)(r,a)){u(!1);(0,Xn.Z)(UnsavedChangesWarningModal,{onSubmit:()=>{e.onRequestClose()},onCancel:()=>{u(!0)}})}else e.onRequestClose()})()},onRequestSubmit:()=>{(()=>{const e=getIndirectAccessChangeAction(Array.from(p.values()).some((e=>e.length>0)),Array.from(h.values()).some((e=>e.length>0)))
if(e){u(!1);(0,Xn.Z)(AccessChangeWarningModal,{users:m.filter((e=>g.get(e.id).length>0)),action:e,onSubmit:updateOrganizationsCapabilities,onDoNotOverride:handleDoNotOverride,onCancel:()=>{u(!0)}})}else updateOrganizationsCapabilities()})()},title:E,medium:!0,buttons:[{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,disabled:i},{text:"Save",submit:!0,style:C.ZJ.SECONDARY,disabled:i}]},d.createElement(CapabilityManagementView,{capabilities:r,capabilityKeyToDistinctAccessLevels:n,showBenchlingAdminControls:!1,onChangeCapabilityAccessLevel:(e,t)=>{const[n,a]=l.default.partition(r,(t=>t.key===e.key)),{invalidCapabilities:i,adjustedCapabilities:s}=adjustCapabilitiesToSatisfyDependenciesAfterUpdate(n[0],t,a)
i.length>0?(0,Xn.Z)(AppDependencyWarningModal,{updatedCapability:n[0],newAccessLevel:t,invalidCapabilities:i,onSubmit:()=>{setCapabilitiesAndTrackChanges(s)}}):setCapabilitiesAndTrackChanges(s)},descriptionText:"Changed settings will apply to all current members. Future members of the organization will only be granted access to the applications enabled for the organization."})))}function OrganizationOverflowDropdown_DropdownMenu({organizations:e,capabilities:t,showBenchlingAdminControls:n,refreshOrganizationListing:a}){return d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING&&d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{trackCapabilityManagementModalAction(rQ.OPENED,sQ.ORGANIZATIONS,e);(0,Xn.Z)(OrganizationCapabilitiesModal,{organizations:e,capabilities:t,showBenchlingAdminControls:n,refreshOrganizationListing:a,onRequestClose:()=>{trackCapabilityManagementModalAction(rQ.CLOSED,sQ.ORGANIZATIONS,e)}})}},"Manage application access")),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{bc.dV(e.map((e=>e.id)))},dataTestAttrs:{component:"OrganizationOverflowDropdown",element:"exportAuditLogs"}},Tc.QU)),We.Z.get(Yj.oI)&&1===e.length&&d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>(0,$b.Z)(e[0].id,{showToastOnSuccess:!0,toastText:"Copied API ID to clipboard."})},"Copy organization API ID")))}function OrganizationOverflowDropdown({organizations:e,capabilities:t,icon:n,showBenchlingAdminControls:a,refreshOrganizationListing:i}){return d.createElement(OverflowDropdown,{menu:d.createElement(OrganizationOverflowDropdown_DropdownMenu,{organizations:e,capabilities:t,showBenchlingAdminControls:a,refreshOrganizationListing:i}),icon:n})}const CQ=xa.Ps`
  fragment OrganizationTableOrganization on OrganizationNode {
    id
    adminsJson
    handle
    name
    urlIdentifier
    ...OrganizationCapabilitiesModalOrganization
  }
  ${vQ}
`
function OrganizationTable_OrganizationAvatarWithName({org:e}){return d.createElement(AF.X,{avatarInfo:{name:e.name,handle:e.handle},shape:SC.o.SQUARE,size:SC.D.SMALL,showTooltip:!1})}function OrganizationTable_generateRows(e,t,n,a){return e.map((e=>({id:e.id,data:{name:d.createElement(OrganizationTable_OrganizationAvatarWithName,{org:e}),handle:e.handle,admins:d.createElement(wv.Z,{parties:e.adminsJson,useAvatar:!0}),overflow:d.createElement(OrganizationOverflowDropdown,{organizations:[e],capabilities:t,showBenchlingAdminControls:n,refreshOrganizationListing:a,icon:d.createElement(ExpandedClickableIcon,{icon:d.createElement(pe.Z,{icon:"overflow"})})})},extra:{organization:e}})))}function getSortValueFromOrganization({extra:{organization:e}},t){return"name"===t?e.name:e.handle}const IQ=[{header:"Name",accessorKey:"name",sortKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0},{header:"Handle",accessorKey:"handle",sortKey:"handle",flexGrow:1,isCollapsible:!1,isSortable:!0},{header:"Admins",accessorKey:"admins",flexGrow:1,isCollapsible:!1,isSortable:!1},{header:"",accessorKey:"overflow",width:100,isCollapsible:!1,isSortable:!1,disableFiltering:!0}]
function OrganizationTable({organizations:e,showBenchlingAdminControls:t,capabilities:n,refreshOrganizationListing:a}){return d.createElement(vr.ZP,{className:"u-flex-grow",columns:IQ,getRowContentHeight:()=>fC.Z.getHeight(SC.D.SMALL),getSortValue:getSortValueFromOrganization,hasLineBelowHeader:!0,isCompact:!1,initialSort:[{sortKey:"name"}],initialRows:OrganizationTable_generateRows(e,n,t,a),onRowClick:({extra:e})=>{(0,ac.ZP)(`organizations/${e.organization.urlIdentifier}`)}})}const wQ=xa.Ps`
  query GetTenantAdminOrganizationsTab @skipAudit @engComponent(name: IDENTITY) {
    currentUser {
      id
      isBenchlingAdmin
    }
    currentTenant {
      id
      tenantAdminData {
        ... on TenantAdminDataNode {
          id
          organizations {
            ...OrganizationTableOrganization
          }
        }
        ...InaccessibleInfoGraphQL
      }
    }
    capabilities {
      ...CapabilityManagementViewCapability
    }
  }
  ${CQ}
  ${pQ}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function Header(e){const t=d.createElement(nc.ZP,{className:"u-flex-grow",placeholder:"Search for organizations",value:e.searchQuery,onChange:t=>{e.onSetSearchQuery(t.target.value)}})
return d.createElement(h.Z,{className:(0,g.iv)(NQ.header)},d.createElement(p.Z,{md:10},d.createElement($Y.Z,{isExpanded:!0,queryInput:t})),d.createElement(p.Z,{md:2},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,onClick:()=>{(0,Xn.Z)(CreateOrganizationModal,{})},size:C.qE.SMALL,text:"Create organization",dataTestAttrs:{component:"TenantAdminOrganizationsTab",element:"createOrganizationButton"}})))}function TenantAdminOrganizationsTab(){const[e,t]=d.useState("")
return d.createElement(Da.ZP,{query:wQ,renderLoading:()=>d.createElement(kl.b,null),fetchPolicy:"network-only"},(({currentUser:n,currentTenant:a,capabilities:i},{refetch:s})=>{if((0,ka.CZ)(a.tenantAdminData)||!n)return d.createElement(TenantAdminErrorBanner,null)
const r=function filterOrganizations(e,t){return e.filter((e=>mo.Z.caseInsensitiveContains(e.name,t)))}(a.tenantAdminData.organizations,e)
return d.createElement(d.Fragment,null,d.createElement(Header,{searchQuery:e,onSetSearchQuery:t}),d.createElement(OrganizationTable,{organizations:r,capabilities:i,showBenchlingAdminControls:n.isBenchlingAdmin,refreshOrganizationListing:s}))}))}const NQ=g.mM.create({header:{paddingBottom:6}}),AQ=xa.Ps`
  fragment TeamCapabilitiesModalTeam on TeamNode {
    id
    name
    autoProvisionedCapabilities {
      id
      capability {
        ...CapabilityManagementViewCapability
      }
      accessLevel
    }
    members {
      ... on UserNode {
        id
        name
        capabilities {
          id
          capability {
            ...CapabilityManagementViewCapability
          }
          accessLevel
        }
      }
    }
  }
  ${pQ}
`
async function saveTeamsCapabilities(e,t){const n=getTeamIdsCapabilities(e,t)
await function updateTeamsCapabilities(e){return Cn.Ry({url:"/1/api/capabilities:bulk-update-teams-capabilities",data:{teamIdsCapabilities:e}})}(n)}async function saveTeamsProvisionedCapabilities(e,t){const n=getTeamIdsCapabilities(e,t)
await function updateTeamsProvisionedCapabilities(e){return Cn.Ry({url:"/1/api/capabilities:bulk-update-teams-provisioned-capabilities",data:{teamIdsCapabilities:e}})}(n)}function getTeamIdsCapabilities(e,t){const n=(0,mY.KV)(t).map((e=>({key:e.key,accessLevel:e.accessLevel})))
return e.map((e=>({teamId:e.id,capabilities:n})))}function TeamCapabilitiesModal(e){(0,S.hu)(e.teams.length>0,"Expected at least one team.")
const t=e.teams.flatMap((e=>e.autoProvisionedCapabilities)),n=(0,mY.Mr)(e.capabilities,t,e.teams.length),a=(0,mY.vy)(n,e.capabilities,e.showBenchlingAdminControls),[i,s]=d.useState(!1),[r,o]=d.useState(a),[c,u]=d.useState(!0),m=e.teams.flatMap((e=>e.members)),p=getUserIdToChangedCapabilities(m,r,rn.bG.REMOVAL),h=getUserIdToChangedCapabilities(m,r,rn.bG.REDUCTION),g=joinRemovedAndReducedCapabilities(p,h),setCapabilitiesAndTrackChanges=t=>{trackCapabilityAccessChange(sQ.TEAMS,t,r,e.teams)
o(t)},handleDoNotOverride=async()=>{s(!0)
await saveUsersCapabilitiesWithoutOverride(m,r,g)
await saveTeamsProvisionedCapabilities(e.teams,r)
trackCapabilityManagementModalAction(rQ.COMPLETED,sQ.TEAMS,e.teams)
s(!1)
e.refreshTeamListing()
v.ZP.success("Successfully updated application access, without overriding.")
e.onRequestClose()},updateTeamsCapabilities=async()=>{s(!0)
const t=r.filter(((e,t)=>e.edited))
await saveTeamsCapabilities(e.teams,t)
await saveTeamsProvisionedCapabilities(e.teams,t)
trackCapabilityManagementModalAction(rQ.COMPLETED,sQ.TEAMS,e.teams)
s(!1)
e.refreshTeamListing()
v.ZP.success("Successfully updated application access.")
e.onRequestClose()},E=`Manage application access: ${e.teams.length>1?"Selected teams":e.teams[0].name}`
return d.createElement(d.Fragment,null,c&&d.createElement(et.ZP,{onRequestClose:()=>{(()=>{if((0,mY.P1)(r,a)){u(!1);(0,Xn.Z)(UnsavedChangesWarningModal,{onSubmit:()=>{e.onRequestClose()},onCancel:()=>{u(!0)}})}else e.onRequestClose()})()},onRequestSubmit:()=>{(()=>{const e=getIndirectAccessChangeAction(Array.from(p.values()).some((e=>e.length>0)),Array.from(h.values()).some((e=>e.length>0)))
if(e){u(!1);(0,Xn.Z)(AccessChangeWarningModal,{users:m.filter((e=>g.get(e.id).length>0)),action:e,onSubmit:updateTeamsCapabilities,onDoNotOverride:handleDoNotOverride,onCancel:()=>{u(!0)}})}else updateTeamsCapabilities()})()},title:E,medium:!0,buttons:[{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,disabled:i},{text:"Save",submit:!0,style:C.ZJ.SECONDARY,disabled:i}]},d.createElement(CapabilityManagementView,{capabilities:r,capabilityKeyToDistinctAccessLevels:n,showBenchlingAdminControls:!1,onChangeCapabilityAccessLevel:(e,t)=>{const[n,a]=l.default.partition(r,(t=>t.key===e.key)),{invalidCapabilities:i,adjustedCapabilities:s}=adjustCapabilitiesToSatisfyDependenciesAfterUpdate(n[0],t,a)
i.length>0?(0,Xn.Z)(AppDependencyWarningModal,{updatedCapability:n[0],newAccessLevel:t,invalidCapabilities:i,onSubmit:()=>{setCapabilitiesAndTrackChanges(s)}}):setCapabilitiesAndTrackChanges(s)},descriptionText:"Changed settings will apply to all current members. Future members of the team will only be granted access to the applications enabled for the team."})))}function TeamOverflowDropdown_DropdownMenu({teams:e,capabilities:t,showBenchlingAdminControls:n,refreshTeamListing:a}){return d.createElement(w.ZP,{width:w.ZP.WIDTHS.LARGE,height:w.ZP.HEIGHTS.MEDIUM},dt.ZP.IDENTITY_ENABLE_CAPABILITY_PROVISIONING&&d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{trackCapabilityManagementModalAction(rQ.OPENED,sQ.TEAMS,e);(0,Xn.Z)(TeamCapabilitiesModal,{teams:e,capabilities:t,showBenchlingAdminControls:n,refreshTeamListing:a,onRequestClose:()=>{trackCapabilityManagementModalAction(rQ.CLOSED,sQ.TEAMS,e)}})}},"Manage application access")),d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>{bc.dV(e.map((e=>e.id)))},dataTestAttrs:{component:"TeamOverflowDropdown",element:"exportAuditLogs"}},Tc.QU)),We.Z.get(Yj.oI)&&1===e.length&&d.createElement(jI.Z,null,d.createElement(N.Z,{onSelect:()=>(0,$b.Z)(e[0].id,{showToastOnSuccess:!0,toastText:"Copied API ID to clipboard."})},"Copy team API ID")))}function TeamOverflowDropdown({teams:e,capabilities:t,icon:n,showBenchlingAdminControls:a,refreshTeamListing:i}){return d.createElement(OverflowDropdown,{menu:d.createElement(TeamOverflowDropdown_DropdownMenu,{teams:e,capabilities:t,showBenchlingAdminControls:a,refreshTeamListing:i}),icon:n})}const RQ=xa.Ps`
  query TeamListingQuery(
    $searchInput: TeamListingSearchInput!
    $sortInput: TeamListingSortInput!
    $limitOffsetInput: LimitOffsetInput!
  ) @skipAudit @engComponent(name: IDENTITY) {
    currentTenantTeamListing(
      searchInput: $searchInput
      sortInput: $sortInput
      limitOffsetInput: $limitOffsetInput
    ) {
      ... on TeamListingNode {
        teams {
          id
          name
          handle
          avatarUrl
          organization {
            id
            name
          }
          adminsJson
          ...TeamCapabilitiesModalTeam
        }
        total
      }
    }
  }
  ${AQ}
`
function TeamAvatarWithName({team:e}){return d.createElement(AF.X,{avatarInfo:{...e,avatar_url:e.avatarUrl||void 0},shape:SC.o.SQUARE,size:SC.D.SMALL,showTooltip:!1})}function TeamListView_generateRows(e,t,n,a){return e.map((e=>({id:e.id,data:{name:d.createElement(TeamAvatarWithName,{team:e}),organization:d.createElement("span",null,e.organization.name),admins:d.createElement(wv.Z,{parties:e.adminsJson,useAvatar:!0}),overflow:d.createElement(TeamOverflowDropdown,{teams:[e],capabilities:t,showBenchlingAdminControls:n.isBenchlingAdmin,refreshTeamListing:a,icon:d.createElement(ExpandedClickableIcon,{icon:d.createElement(pe.Z,{icon:"overflow"})})})},extra:e})))}const PQ={name:Sn.rp.NAME,organization:Sn.rp.ORGANIZATION_NAME},OQ=l.default.invert(PQ),xQ=[{header:"Name",accessorKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"name"},{header:"Organization",accessorKey:"organization",flexGrow:1,isCollapsible:!1,isSortable:!0,sortKey:"organization"},{header:"Admins",accessorKey:"admins",flexGrow:1,isCollapsible:!1,isSortable:!1},{header:"",accessorKey:"overflow",width:100,isCollapsible:!1,isSortable:!1,disableFiltering:!0}]
function TeamListView({teams:e,currentUser:t,capabilities:n,refreshTeamListing:a,sort:i,onChangeSort:s}){const r=xQ.map((e=>{const t=i.sortDirection===Sn.Sr.ASCENDING?Tr.Ii:Tr.B3
return{...e,sortDirection:e.sortKey===OQ[i.sortKey]?t:null}}))
return d.createElement(Xj.Z,{className:"u-flex-grow u-spacing-top",tableKey:"TeamListView",hasLineBelowHeader:!0,columns:r,onRowClick:function handleRowClick(e){(0,ac.ZP)(`teams/${e.extra.id}`)},emptyTableText:"No teams",rows:TeamListView_generateRows(e,n,t,a),getRowContentHeight:()=>fC.Z.getHeight(SC.D.SMALL),isCompact:!1,canResizeColumns:!0,onChangeSort:e=>{const t=PQ[e]
let n=Sn.Sr.ASCENDING
i.sortKey===t&&(n=i.sortDirection===Sn.Sr.ASCENDING?Sn.Sr.DESCENDING:Sn.Sr.ASCENDING)
s({sortKey:t,sortDirection:n})}})}function QueryingTeamListView(e){const t=(0,NN.$V)(e.filters,Kn.Vm.ORGANIZATION)
return d.createElement(Da.ZP,{query:RQ,variables:{searchInput:{query:e.searchQuery,organizationId:t},limitOffsetInput:e.limitOffset,sortInput:e.sort},renderLoading:()=>d.createElement(kl.b,null),fetchPolicy:"network-only"},((t,{refetch:n})=>d.createElement(d.Fragment,null,d.createElement(TeamListView,{teams:t.currentTenantTeamListing.teams,currentUser:e.currentUser,capabilities:e.capabilities,refreshTeamListing:n,sort:e.sort,onChangeSort:e.onChangeSort}),d.createElement(zT.Z,{isLoading:!1,setOffset:e.onChangeOffset,pagination:{...e.limitOffset,total:t.currentTenantTeamListing.total}}))))}function CreateTeamModal_NameField(e){return d.createElement(Ke.Z,null,d.createElement(Jl.Z,{label:"Name",value:e.teamName,onChange:t=>{e.onChangeName(t.target.value)},isRequired:!0,dataTestAttrs:{component:"CreateTeamModal",element:"nameTextField"}}))}function DescriptionField(e){return d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Description"),d.createElement("textarea",{placeholder:"Team description",name:"description",value:e.description,onChange:t=>{e.onChangeDescription(t.target.value)},rows:3}))}function SchemaPermissionsCheckbox(e){return d.createElement(Ke.Z,null,d.createElement(Je.Z,null,"Schema Permissions"),d.createElement(Io.Z,{className:(0,g.iv)(_Q.checkbox),checked:e.isSchemaAdmin,label:(0,vj.V$)(),onChange:t=>{e.onChangeSchemaAdmin(t.target.checked)},id:"SchemaPermissions"}))}function CreateTeamModal(e){const[t,n]=d.useState({name:"",organizationId:null,description:"",isSchemaAdmin:!1})
function updateTeamField(e,t){n((n=>({...n,[e]:t})))}return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:async function handleSubmit(){try{await K$.Cm(t)}finally{e.onRequestClose()}},title:"Create team",medium:!0,buttons:[{text:"Create",submit:!0,style:C.ZJ.SECONDARY,disabled:!function requiredFieldsAreNonEmpty(){return t.name.length>0&&null!=t.organizationId}()}],dataTestAttrs:{component:"CreateTeamModal",element:"root"}},d.createElement(CreateTeamModal_NameField,{teamName:t.name,onChangeName:e=>{updateTeamField("name",e)}}),d.createElement(OrganizationDropdown,{organizationId:t.organizationId,onSelectOrganizationId:e=>{updateTeamField("organizationId",e)},organizations:e.organizations,defaultTitle:"Select an organization...",isRequired:!0}),d.createElement(DescriptionField,{description:t.description,onChangeDescription:e=>{updateTeamField("description",e)}}),d.createElement(SchemaPermissionsCheckbox,{isSchemaAdmin:t.isSchemaAdmin,onChangeSchemaAdmin:e=>{updateTeamField("isSchemaAdmin",e)}}))}const _Q=g.mM.create({checkbox:{whiteSpace:"pre-wrap"}}),DQ=xa.Ps`
  query GetTenantTeamsTab @skipAudit @engComponent(name: IDENTITY) {
    currentUser {
      id
      organizations {
        id
      }
      isBenchlingAdmin
    }
    currentTenant {
      id
      tenantAdminData {
        ... on TenantAdminDataNode {
          id
          organizations {
            ...OrganizationDropdownOrganization
            ...OrganizationFilterOrganization
          }
        }
        ...InaccessibleInfoGraphQL
      }
    }
    capabilities {
      ...CapabilityManagementViewCapability
    }
  }
  ${jY}
  ${Kj.Px}
  ${pQ}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function TeamsTabFilterContainer(e){return d.createElement(Hu.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.ORGANIZATION,extraProps:{organizations:e.organizations}}],secondaryFilterGroups:[],filters:e.filters,onChangeFilters:e.onChangeFilters,selectedSchema:null})}function TenantAdminTeamsTab_Header(e){const t=d.createElement(nc.ZP,{className:"u-flex-grow",placeholder:"Search for teams",value:e.searchQuery,onChange:t=>{e.onSetSearchQuery(t.target.value)}}),n=d.createElement(TeamsTabFilterContainer,{organizations:e.organizations,filters:e.filters,onChangeFilters:e.onChangeFilters})
return d.createElement(h.Z,{className:"u-small-padding-bottom"},d.createElement(p.Z,{md:10},d.createElement($Y.Z,{isExpanded:!0,queryInput:t,filtersContainer:n})),d.createElement(p.Z,{md:2},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,onClick:()=>{(0,Xn.Z)(CreateTeamModal,{organizations:e.organizations})},size:C.qE.SMALL,text:"Create team",dataTestAttrs:{component:"TenantAdminTeamsTab",element:"createTeamButton"}})))}function TenantAdminTeamsTab(){const[e,t]=d.useState(""),[n,a]=d.useState([]),[i,s]=d.useState({limit:100,offset:0}),[r,o]=d.useState({sortKey:Sn.rp.NAME,sortDirection:Sn.Sr.ASCENDING})
return d.createElement(Da.ZP,{query:DQ,renderLoading:()=>d.createElement(kl.b,null),fetchPolicy:"network-only"},(l=>{const c=(0,ka.CZ)(l.currentTenant)||(0,ka.CZ)(l.currentTenant.tenantAdminData)?[]:l.currentTenant.tenantAdminData.organizations;(0,S.hu)(null!=l.currentUser,"User must be logged in to view team listing")
return d.createElement(d.Fragment,null,d.createElement(TenantAdminTeamsTab_Header,{organizations:c,filters:n,onChangeFilters:e=>{a(e)
s({...i,offset:0})},searchQuery:e,onSetSearchQuery:t}),d.createElement(QueryingTeamListView,{currentUser:l.currentUser,capabilities:l.capabilities,searchQuery:e,filters:n,limitOffset:i,onChangeOffset:e=>{s({...i,offset:e})},sort:r,onChangeSort:e=>{o(e)
s({...i,offset:0})}}))}))}const LQ=xa.Ps`
  fragment UserRolesListingUser on UserNode {
    id
    teamRoles {
      team {
        id
        name
      }
      role
    }
    organizationRoles {
      organization {
        id
        name
        teams {
          id
        }
      }
      role
    }
    isTenantAdmin
  }
`,kQ=[Sn.UD.ADMIN,Sn.qm.ADMIN]
function roleToDisplay(e){return kQ.includes(e)?"Admin":"Member"}function TeamRow(e){return d.createElement(d.Fragment,null,e.teamRole&&d.createElement(h.Z,{className:"u-small-padding-bottom u-small-padding-left"},d.createElement(p.Z,{md:8},d.createElement("div",{className:(0,g.iv)(MQ.teamRow)},e.teamRole.team.name)),d.createElement(p.Z,{md:4,className:"u-faded"},roleToDisplay(e.teamRole.role))))}function CollapsableOrganizationRow(e){const t=e.organizationRole.organization,n=function getTeamRolesForOrganization(e,t){const n=e.map((e=>e.id)),a=t.filter((e=>n.includes(e.team.id)))
return(0,hs.Z)(a,[e=>e.team.name])}(t.teams,e.teamRoles),a=n.length>0,[i,s]=d.useState(!1)
return d.createElement(d.Fragment,null,d.createElement(h.Z,{className:"u-small-padding-bottom u-small-padding-left"},d.createElement("div",{className:a?"u-pointer":void 0,onClick:()=>{s(!i)}},d.createElement(p.Z,{md:8,className:(0,g.iv)(MQ.row)},d.createElement("div",{className:(0,g.iv)(MQ.caret)},d.createElement(pe.Z,{className:a?"faded":"invisible",icon:i?"caret-right":"caret-down"})),d.createElement("div",null,d.createElement("strong",null,t.name))),d.createElement(p.Z,{md:4,className:"u-faded"},roleToDisplay(e.organizationRole.role)))),!i&&n.map((e=>d.createElement(TeamRow,{key:e.team.id,teamRole:e}))))}function TenantRow({isTenantAdmin:e,tenantDisplayName:t}){return d.createElement(h.Z,{className:"u-small-padding-bottom u-tiny-padding-top u-small-padding-left"},d.createElement(p.Z,{md:8},d.createElement("strong",null,t)),d.createElement(p.Z,{md:4,className:"u-faded"},e?"Admin":"Member"))}function UserRolesListing({user:e,tenantDisplayName:t}){const n=(0,hs.Z)(e.organizationRoles,[e=>e.organization.name])
return d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Roles"}),d.createElement("div",{className:(0,g.iv)(MQ.container)},d.createElement(h.Z,{className:"u-faded u-small-padding-left"},d.createElement(p.Z,{md:8},d.createElement("strong",null,"Tenant / Organization / Team")),d.createElement(p.Z,{md:4},d.createElement("strong",null,"Role"))),d.createElement("hr",{className:(0,g.iv)(MQ.hr)}),d.createElement(TenantRow,{isTenantAdmin:e.isTenantAdmin,tenantDisplayName:t}),n.map((t=>d.createElement(CollapsableOrganizationRow,{key:t.organization.name,organizationRole:t,teamRoles:e.teamRoles})))))}const MQ=g.mM.create({hr:{marginTop:9,marginBottom:6,borderWidth:1,borderColor:Vt.pF},container:{padding:"16px 11px",borderRadius:6,backgroundColor:Vt.bs},caret:{width:16},teamRow:{paddingLeft:35},row:{display:"flex",flexDirection:"row"}}),FQ=xa.Ps`
  fragment UserSettingsModalUser on UserNode {
    id
    name
    email
    handle
    suspended
    ...UserRolesListingUser
  }
  ${LQ}
`
function UserTextField({label:e,text:t,onChangeText:n}){return d.createElement(Ke.Z,null,d.createElement(Jl.Z,{label:e,value:t,onChange:e=>{n(e.target.value)}}))}function UserSettingsModal(e){const[t,n]=d.useState(e.user)
function updateUserField(e,t){n((n=>({...n,[e]:t})))}return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,onRequestSubmit:()=>{e.onSave(e.user,t)
e.onRequestClose()},title:"User settings",medium:!0,buttons:[{text:t.suspended?"Unsuspend":"Suspend",style:t.suspended?C.ZJ.TERTIARY_GRAY:C.ZJ.NEGATIVE,pullLeft:!0,onClick:()=>{e.onSave(e.user,t)
e.onChangeSuspended(t.id,!t.suspended)
e.onRequestClose()},dataTestAttrs:{component:"Modal",element:"footerButton",key:t.suspended?"unsuspend":"suspend"}},{text:"Save",submit:!0,style:C.ZJ.SECONDARY}]},d.createElement(UserTextField,{label:"Name",text:t.name,onChangeText:e=>{updateUserField("name",e)}}),d.createElement(UserTextField,{label:"Username",text:t.handle,onChangeText:e=>{updateUserField("handle",e)}}),d.createElement(UserTextField,{label:"Email",text:t.email,onChangeText:e=>{updateUserField("email",e)}}),d.createElement(UserRolesListing,{user:t,tenantDisplayName:e.tenantDisplayName}))}const admin_UserSettingsModal=e=>d.createElement(UserSettingsModal,{...e,onChangeSuspended:(e,t)=>{verifySuspendedUsers([e],t)},onSave:updateUserProfile}),ZQ=xa.Ps`
  fragment UserTableUser on UserNode {
    ...UserSettingsModalUser
    ...UserCapabilitiesModalUser
    id
    avatarUrl
    email
    handle
    lastSeen
    name
    suspended
    passwordLastChangedAt
    organizations {
      id
      name
      handle
    }
    teams {
      name
      handle
    }
    apiKey {
      createdAt
    }
  }
  ${FQ}
  ${gQ}
`
function EmailLink({email:e}){return d.createElement("a",{onClick:e=>{e.stopPropagation()},href:`mailto:${e}`,rel:"noreferrer noopener"},e)}const BQ=[{header:"Name",accessorKey:"name",sortKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,disableFiltering:!0},{header:"Username",accessorKey:"handle",sortKey:"handle",isCollapsible:!1,isSortable:!0,disableFiltering:!1},{header:"Email",accessorKey:"email",sortKey:"email",isCollapsible:!1,isSortable:!0,disableFiltering:!1},{header:"Organizations",accessorKey:"organizations",isCollapsible:!0,isSortable:!1,disableFiltering:!1},{header:"Teams",accessorKey:"teams",isCollapsible:!0,isSortable:!1,disableFiltering:!1},{header:"Last Seen",accessorKey:"lastSeen",sortKey:"lastSeen",isCollapsible:!0,isSortable:!0,disableFiltering:!1},...dt.ZP.IDENTITY_ENABLE_DISPLAY_PASSWORD_LAST_CHANGED?[{header:"Password Set",accessorKey:"passwordLastChangedAt",sortKey:"passwordLastChangedAt",isCollapsible:!0,isSortable:!0,disableFiltering:!1}]:[],{header:"API Key Created",accessorKey:aY,sortKey:aY,isCollapsible:!0,isSortable:!0,disableFiltering:!1},{header:"",accessorKey:"overflow",width:100,isCollapsible:!1,isSortable:!1,disableFiltering:!0}]
function UserTable({users:e,capabilities:t,selectedUserIds:n,onUserSelectChange:a,onChangeSort:i,sortColumn:s,sortDirection:r,showBenchlingAdminControls:o,onRefreshUserListing:l}){const c=e.some((e=>null!=e.apiKey)),u=BQ.filter((e=>!(e.accessorKey===aY&&!c))).map((e=>({...e,sortDirection:e.accessorKey===s?r:null})))
return d.createElement(UQ.Consumer,null,(({displayName:s})=>{const r=function UserTable_generateRows(e,t,n,a,i,s){return e.map(((e,r)=>{var o
return{id:e.id,icon:d.createElement(fC.Z,{entity:e,shape:SC.o.CIRCLE,size:SC.D.XSMALL}),data:{name:d.createElement(Name,{name:e.name,suspended:e.suspended}),handle:e.handle,email:d.createElement(EmailLink,{email:e.email}),organizations:d.createElement(wv.Z,{parties:(0,hs.Z)(e.organizations,[e=>e.name.toLowerCase()])}),teams:d.createElement(wv.Z,{parties:(0,hs.Z)(e.teams,[e=>e.name.toLowerCase()])}),lastSeen:e.lastSeen?(0,Kl.Z)(e.lastSeen):null,passwordLastChangedAt:e.passwordLastChangedAt?(0,Kl.Z)(e.passwordLastChangedAt):null,[aY]:(null===(o=e.apiKey)||void 0===o?void 0:o.createdAt)?(0,Kl.Z)(e.apiKey.createdAt):null,overflow:d.createElement("div",{className:"u-lr-split"},d.createElement(ExpandedClickableIcon,{icon:d.createElement(pe.Z,{icon:"edit"}),onClick:t=>{(0,Xn.Z)(admin_UserSettingsModal,{user:e,tenantDisplayName:a})
t.stopPropagation()}}),d.createElement(UserOverflowDropdown,{users:[e],capabilities:t,icon:d.createElement(ExpandedClickableIcon,{icon:d.createElement(pe.Z,{icon:"overflow"})}),disableSuspend:e.suspended,disableUnsuspend:!e.suspended,showBenchlingAdminControls:i,onRefreshUserListing:s}))},extra:{user:e},isSelected:n.includes(e.id)}}))}(e,t,n,s,o,l)
return d.createElement(Xj.Z,{canFilterColumns:!0,rowSelectionMode:Tr.rT.MULTIPLE,canResizeColumns:!0,tableKey:"UserTable",className:"u-flex-grow",columns:u,getRowContentHeight:()=>fC.Z.getHeight(SC.D.SMALL),hasLineBelowHeader:!0,rows:r,isCompact:!1,onRowsSelect:(e,t)=>{a(e.map((e=>e.id)),t)},onRowClick:function(e){navigateToUserPage(e.id)},onChangeSort:i})}))}const qQ=xa.Ps`
  query UserListingQuery(
    $searchInput: UserListingSearchInput!
    $sortInput: UserListingSortInput!
    $limitOffsetInput: LimitOffsetInput!
  ) @skipAudit @engComponent(name: IDENTITY) {
    currentTenantUserListing(
      searchInput: $searchInput
      sortInput: $sortInput
      limitOffsetInput: $limitOffsetInput
    ) {
      ... on UserListingNode {
        users {
          ...UserTableUser
          ...UserSettingsModalUser
          ...UsersTeamMembershipDropdownUser
          ...UsersOrganizationMembershipDropdownUser
          ...UserCapabilitiesModalUser
        }
        total
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${XY}
  ${QY}
  ${ZQ}
  ${FQ}
  ${gQ}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function UserListing({teams:e,organizations:t,capabilities:n,showBenchlingAdminControls:a}){const[i,s]=d.useState([])
function handleUserSelectChange(e,t){s((n=>(0,WY.sv)(n,e,t,Tr.rT.MULTIPLE)))}const[{listingCriteria:r,sort:o,limitOffset:l},c]=useUserListing((function onListingParamsUpdate(){s([])})),u=(0,Su.N)(r,250)
const{onSortByAccessorKey:m,onChangeOffset:p,onChangeListingCriteria:h,onChangeLimit:g}=c,E={teams:e,organizations:t,selectedUserIds:i,listingCriteria:r,onChangeListingCriteria:h,onChangeLimit:g,showBenchlingAdminControls:a,limit:l.limit}
const f={searchInput:u,limitOffsetInput:l,sortInput:o}
return d.createElement(Da.ZP,{query:qQ,variables:f,renderLoading:({refetch:e})=>d.createElement(d.Fragment,null,d.createElement(UserListingHeader,{selectedUsers:[],capabilities:n,onRefreshUserListing:e,...E}),d.createElement(kl.b,null)),fetchPolicy:"network-only"},(({currentTenantUserListing:e},{refetch:t})=>{return(0,ka.CZ)(e)?d.createElement(Ff.Z,null,"Something has gone wrong: Unauthorized to view this information"):d.createElement(d.Fragment,null,d.createElement(UserListingHeader,{...E,selectedUsers:(s=e.users,s.filter((e=>i.includes(e.id)))),capabilities:n,showBenchlingAdminControls:a,onRefreshUserListing:t}),d.createElement("div",{className:"u-spacing-top u-spacing-bottom"},d.createElement(UserTable,{users:e.users,capabilities:n,sortColumn:rY[o.sortKey],sortDirection:getTableSortDirection(o.sortDirection),onChangeSort:m,selectedUserIds:i,onUserSelectChange:handleUserSelectChange,showBenchlingAdminControls:a,onRefreshUserListing:t}),d.createElement(zT.Z,{isLoading:!1,setOffset:p,pagination:{...l,total:e.total}})))
var s}))}const VQ=xa.Ps`
  query TenantAdminUsersTabQuery @skipAudit @engComponent(name: IDENTITY) {
    currentUser {
      id
      isBenchlingAdmin
    }
    currentTenant {
      id
      tenantAdminData {
        ... on TenantAdminDataNode {
          id
          organizations {
            ...OrganizationFilterOrganization
            ...OrganizationDropdownOrganization
            ...UserListingCriteriaFormOrganization
            ...TeamSelectMenuOrganization
          }
          ...CreateUsersModalFragment
        }
        ...InaccessibleInfoGraphQL
      }
    }
    capabilities {
      ...CapabilityManagementViewCapability
    }
  }
  ${Kj.Px}
  ${jY}
  ${aQ}
  ${lH}
  ${UY}
  ${pQ}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function TenantAdminUsersTab(){return d.createElement(Da.ZP,{query:VQ,renderLoading:()=>d.createElement(UserListing,{teams:[],organizations:[],capabilities:[],showBenchlingAdminControls:!1})},(({currentUser:e,currentTenant:t,capabilities:n})=>(0,ka.CZ)(t.tenantAdminData)?d.createElement(TenantAdminErrorBanner,null):d.createElement(UserListing,{organizations:t.tenantAdminData.organizations,teams:t.tenantAdminData.teams,capabilities:n,showBenchlingAdminControls:!!e&&e.isBenchlingAdmin})))}const UQ=(0,Hh.x)((()=>({displayName:"",avatarUrl:""})),"TenantContext"),GQ=xa.Ps`
  query TenantAdminPageQuery @skipAudit @engComponent(name: IDENTITY) {
    currentTenant {
      id
      displayName
      avatarUrl
    }
    currentUser {
      id
      isTenantAdmin
    }
  }
`
class TenantAdminPageConnector extends oi.C{enhanceProps(){return{activeTab:new VY.Yv(this.reduxState()).getActiveTab()}}}function TenantAdminPageBody({activeTab:e,tenantDisplayName:t,tenantAvatarUrl:n}){(0,d.useEffect)((()=>{(0,de._w)(t||"Tenant")}),[t])
return d.createElement(GroupPageContainer,{tabs:Yj.Sf,tabsToReadable:Yj.V8,activeTab:e,onChangeTab:function handleChangeTab(e){(0,ac.ZP)(`/admin/${Yj.pY[e]}`)},name:t,groupTypeName:"Tenant",avatarUrl:n,dataTestAttrs:{component:"TenantAdminPage",element:"root"}},(()=>{switch(e){case Yj.WG.ORGANIZATIONS_TAB:return d.createElement(TenantAdminOrganizationsTab,null)
case Yj.WG.TEAMS_TAB:return dt.ZP.ENABLE_TEAMS?d.createElement(TenantAdminTeamsTab,null):null
case Yj.WG.USERS_TAB:return d.createElement(TenantAdminUsersTab,null)
case Yj.WG.LICENSES_TAB:return dt.ZP.EXTERNAL_ADMIN_ENABLE_LICENSE_MANAGEMENT?d.createElement(TenantAdminLicensesTab,null):null
case Yj.WG.SETTINGS_TAB:return d.createElement(TenantAdminSettingsTab,null)
case Yj.WG.BENCHLING_APPS_TAB:return dt.ZP.ENABLE_BENCHLING_APPS?d.createElement(TenantAdminBenchlingAppsTab,null):null
default:(0,S.hu)(!1,`Unexpected tab "${e}"`)
return null}})())}const zQ=TenantAdminPageConnector.connect((function TenantAdminPage({activeTab:e}){return d.createElement(Da.ZP,{query:GQ,renderLoading:()=>d.createElement(TenantAdminPageBody,{activeTab:e})},(({currentTenant:t,currentUser:n})=>(null==n?void 0:n.isTenantAdmin)?d.createElement(UQ.Provider,{value:{displayName:t.displayName,avatarUrl:t.avatarUrl}},d.createElement(TenantAdminPageBody,{activeTab:e,tenantAvatarUrl:t.avatarUrl,tenantDisplayName:t.displayName})):d.createElement(TenantAdminErrorBanner,null)))}))
function TenantFullScreenView(e){if(e.currentScreen===Yj.UA.TENANT_ADMIN_SCREEN)return d.createElement(zQ,null);(0,S.Gp)(!1,`TenantFullScreenView called with invalid screen: ${e.currentScreen}`)
return null}TenantFullScreenView.propTypes={currentScreen:J().string.isRequired}
const $Q=TenantFullScreenView
var WQ=n(402427),HQ=n(744898)
class FullScreenConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[HQ.Z]}enhanceProps(){return{currentScreen:this.fullScreenStore().getCurrentScreen()}}}class FullScreen extends d.Component{componentDidMount(){this.setBodyClass()}componentDidUpdate(){this.setBodyClass()}setBodyClass(){o()(document.body).toggleClass("has-shown-full-screen",null!=this.props.currentScreen)
o()("#wrapper").toggleClass("signup-flow-v2",null!=this.props.currentScreen&&F$.Jt.includes(this.props.currentScreen))}render(){if(null==this.props.currentScreen)return d.createElement("div",null)
if((0,WQ.Ok)(this.props.currentScreen,F$.Jt))return d.createElement(wW,{currentScreen:this.props.currentScreen})
if((0,WQ.Ok)(this.props.currentScreen,AW.Jt))return d.createElement(ZW,{currentScreen:this.props.currentScreen})
if((0,WQ.Ok)(this.props.currentScreen,HT.ALL_SCREENS))return d.createElement(jj,{currentScreen:this.props.currentScreen})
if((0,WQ.Ok)(this.props.currentScreen,Yj.Jt))return d.createElement($Q,{currentScreen:this.props.currentScreen})
if(this.props.currentScreen===WQ.dG)return d.createElement(EN.Z,null)
if(this.props.currentScreen===Mz.Kb)return d.createElement(Fz.bA,null,d.createElement(Xz,null))
if(this.props.currentScreen===e$.YZ)return d.createElement(Fz.bA,null,d.createElement(L$,null))
if(this.props.currentScreen===k$.Yc)return d.createElement(Fz.bA,null,d.createElement(M$,null));(0,S.Gp)(!1,`FullScreen called with unsupported screen: ${this.props.currentScreen}`)
return null}}const jQ=FullScreenConnector.connect(FullScreen),YQ="/zendesk-jwt-sso"
const QQ=g.mM.create({wrapper:{alignItems:"center",background:Vt.Rl,borderRadius:"50%",bottom:25,display:"flex",fontSize:11,justifyContent:"center",height:20,left:25,position:"absolute",width:20}}),KQ=function IntercomBadge(e){return null==e.numUnreadMessages||0===e.numUnreadMessages?null:d.createElement("div",{className:(0,g.iv)(QQ.wrapper)},e.numUnreadMessages)}
function HelpContainer_HelpButton(){return d.createElement("div",{className:"helpContainer"},d.createElement("a",{href:dt.ZP.ENABLE_ZENDESK_GUIDE?YQ:dt.ZP.SUPPORT_SITE_URL,target:"_blank",rel:"noopener noreferrer"},d.createElement("span",{className:"helpContainer-icon"},d.createElement(pe.Z,{icon:"question"}))))}class HelpContainerConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[nz.Z]}enhanceProps(){return{isIntercomWindowOpen:this.sidepanelStore().getIsIntercomWindowOpen(),numUnreadIntercomMessages:this.sidepanelStore().getNumUnreadIntercomMessages()}}}var JQ
!function(e){e.CUSTOM_HELP="custom_help"
e.CHAT="chat"
e.HELP_CENTER="help_center"}(JQ||(JQ={}))
function trackHelpEvent(e){m.KK(j.P6.CLICKED_HELP_BUTTON,e)}class HelpContainer extends d.Component{constructor(e){super(e)
this.state={isHelpContainerOpen:!1}}_handleToggleOpenContainer(){this.props.isIntercomWindowOpen?w_.nu():this.setState({isHelpContainerOpen:!this.state.isHelpContainerOpen})}_handleOpenIntercom(){w_.f1()
this.setState({isHelpContainerOpen:!1})}render(){const e=this.state.isHelpContainerOpen||this.props.isIntercomWindowOpen,t=d.createElement("span",{className:f()("helpContainer-icon",{"helpContainer-icon--open":e,"helpContainer-icon--shadow":this.props.isIntercomWindowOpen})},d.createElement(pe.Z,{icon:e?"close":"question"}),!this.state.isHelpContainerOpen&&d.createElement(KQ,{numUnreadMessages:this.props.numUnreadIntercomMessages}))
return d.createElement("div",{className:"helpContainer"},d.createElement("div",{className:"helpContainer-mainIcon",onClick:()=>{this._handleToggleOpenContainer()}},t),this.state.isHelpContainerOpen&&d.createElement("span",{className:"helpContainer-extraIcons"},dt.ZP.SUPPORT_CUSTOM_HELP_OPTION&&d.createElement(P.ZP,{container:"body",placement:P.TQ.LEFT,title:dt.ZP.SUPPORT_CUSTOM_HELP_OPTION.label},d.createElement("a",{className:"helpContainer-icon",href:dt.ZP.SUPPORT_CUSTOM_HELP_OPTION.url,target:"_blank",rel:"noopener noreferrer",onClick:()=>{trackHelpEvent({helpType:JQ.CUSTOM_HELP})}},d.createElement(pe.Z,{icon:"docs"}))),d.createElement(P.ZP,{container:"body",placement:P.TQ.LEFT,title:"Chat"},d.createElement("span",{className:"helpContainer-icon intercomLauncher",onClick:()=>{this._handleOpenIntercom()
trackHelpEvent({helpType:JQ.CHAT})}},d.createElement(pe.Z,{icon:"chat"}))),d.createElement(P.ZP,{container:"body",placement:P.TQ.LEFT,title:"Help Center"},d.createElement("a",{className:"helpContainer-icon",href:dt.ZP.SUPPORT_SITE_URL,rel:"noopener noreferrer",target:"_blank",onClick:()=>{trackHelpEvent({helpType:JQ.HELP_CENTER})}},d.createElement(pe.Z,{icon:"tutorial"})))))}}HelpContainer.propTypes={isIntercomWindowOpen:J().bool.isRequired,numUnreadIntercomMessages:J().number}
const XQ=HelpContainerConnector.connect(HelpContainer),eK=[st.SEQUENCE,st.PROTEIN,st.ENTRY,st.PROTOCOL,st.BASIC_FOLDER_ITEM],tK=[st.SEQUENCE,st.PROTEIN,st.ENTRY,st.PROTOCOL],showValueMessagingForSharedFile=()=>{var e,t
return Boolean(!window.user&&(null===(e=window.bootstrap)||void 0===e?void 0:e.sharedFolderItemAPIId)&&eK.includes(ea.ZP.apiIdToType(null===(t=window.bootstrap)||void 0===t?void 0:t.sharedFolderItemAPIId)))}
var nK=n(549663),aK=n(640598)
var iK
!function(e){e.BROWSER_STATE="browser_state"
e.CACHED_ENDPOINTS="cached_endpoints"}(iK||(iK={}))
function openEndpointsDataStore(e){return e.transaction([iK.CACHED_ENDPOINTS],"readwrite").objectStore(iK.CACHED_ENDPOINTS)}function wait(e){return new Promise(((t,n)=>{e.onsuccess=function onSuccess(){t(this.result)}
e.onerror=function onError(){n(this.error)}}))}function dbConnect(e){return wait(e.indexedDB.open("dev_cache",2))}function dbGet(e,t){return wait(e.get(t))}async function dbGetAll(e){const t=await function dbGetAllKeys(e){return wait(e.getAllKeys())}(e)
return await Promise.all(t.map((async t=>({id:t,...await dbGet(e,t)}))))}function dbPut(e,t,n){return wait(e.put(n,t))}async function openEndpointsStore(){return openEndpointsDataStore(await dbConnect(window))}const sK="https://local.bnch.us:5000",rK=[{method:"POST",url:`${sK}/1/api/analytics/track`}]
function CachedEndpointsTable(e){const t=e.endpoints.filter((e=>!rK.some((t=>t.url===e.url&&t.method===e.method)))).sort(((e,t)=>{var n,a
return(null!==(n=e.requestBody)&&void 0!==n?n:"").localeCompare(null!==(a=t.requestBody)&&void 0!==a?a:"")})).sort(((e,t)=>e.url.localeCompare(t.url)))
return d.createElement("div",{className:(0,g.iv)(oK.endpointTableContainer)},d.createElement("h4",{className:(0,g.iv)(oK.endpointTableTitle)},"Cached URLs"),d.createElement(zp.Z,{title:"Caching Strategy",renderContent:()=>"Endpoints are cached using a hash of the method, URL, and request body. This means that two POST requests with the same path but different request bodies will be cached separately.",interaction:ne.x2.HOVER}),d.createElement("table",null,d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Disable"),d.createElement("th",null),d.createElement("th",{className:(0,g.iv)(oK.endpointCenteredCell)},"Status"),d.createElement("th",null,"Endpoint"),d.createElement("th",null,"Request Data"))),d.createElement("tbody",null,t.map(((t,n)=>{const a=t.cacheHitClientIds.includes(e.clientId)
return d.createElement("tr",{key:n,className:f()((0,g.iv)(oK.endpointRow),{[(0,g.iv)(oK.endpointCacheHitRow)]:a})},d.createElement("td",{className:(0,g.iv)(oK.endpointDisableCacheCell)},d.createElement("input",{type:"checkbox",checked:t.bypassCache,onChange:async n=>{const a=n.target.checked
await async function toggleEndpointDisabled(e,t){const n=await dbGet(await openEndpointsStore(),e)
if(n){n.bypassCache=t
await dbPut(await openEndpointsStore(),e,n)}else(0,aK.Y)("Endpoint store was cleared before it could be updated")}(t.id,a)
e.onUpdateEndpointsData()}})),d.createElement("td",{className:(0,g.iv)(oK.endpointCenteredCell)},d.createElement(C.Co,{text:"Clear",buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,onClick:async()=>{await function dbDelete(e,t){return wait(e.delete(t))}(await openEndpointsStore(),t.id)
e.onUpdateEndpointsData()}})),d.createElement("td",{className:(0,g.iv)(oK.endpointCenteredCell)},t.bypassCache?"Disabled":a?"Cache Hit":"Cached"),d.createElement("td",{className:(0,g.iv)(oK.endpointPathCell)},d.createElement("code",null,`${t.method} ${t.url.replace(sK,"")}`)),d.createElement("td",{className:(0,g.iv)(oK.endpointRequestDataCell)},t.requestBody?d.createElement("pre",{className:(0,g.iv)(oK.endpointRequestData)},t.requestBody):"N/A"))})))),d.createElement("h4",null,"Always Cached Endpoints"),d.createElement("ul",null,rK.map(((e,t)=>d.createElement("li",{key:t},d.createElement("code",null,`${e.method} ${e.url.replace(sK,"")}`))))))}const oK=g.mM.create({endpointTableTitle:{display:"inline-block",paddingRight:10},endpointTableContainer:{maxHeight:"75vh",overflowY:"scroll"},endpointRow:{borderColor:Vt.bs,borderStyle:"solid",borderWidth:0,borderTopWidth:1,borderBottomWidth:1},endpointCacheHitRow:{background:"rgba(30, 228, 207, 0.33)"},endpointCenteredCell:{paddingRight:15,textAlign:"center"},endpointDisableCacheCell:{paddingTop:5,paddingBottom:5,paddingLeft:10},endpointPathCell:{paddingRight:15},endpointRequestDataCell:{paddingTop:8,paddingBottom:8},endpointRequestData:{maxHeight:100,overflowY:"scroll",margin:0}})
async function getCachedEndpoints(){return dbGetAll(openEndpointsDataStore(await dbConnect(window)))}function FastRefreshSettingsModal(e){const[t,n]=(0,d.useState)(null);(0,d.useEffect)((()=>{t||getCachedEndpoints().then((e=>{n(e)}))}),[t])
return d.createElement(et.ZP,{enableRedesign:!0,title:"Dev Cache Settings",fullWidth:!0,large:!0,wrapInForm:!1,onRequestClose:()=>{e.onRequestClose()},closeableOnBackgroundClick:!0,buttons:[{text:"Clear Cache",onClick:async()=>{await function dbDeleteAll(e){return wait(e.clear())}(await openEndpointsStore())
n(await getCachedEndpoints())}},{text:"Close",cancel:!0}]},null!=t?t.length?d.createElement(CachedEndpointsTable,{clientId:e.clientId,endpoints:t,onUpdateEndpointsData:async()=>{n(await getCachedEndpoints())}}):d.createElement("strong",null,"Dev cache is empty."):d.createElement(kl.b,null))}var lK=n(38012),cK=n(541813)
function getNavbarColor(){var e
return null===(e=window.bootstrap)||void 0===e?void 0:e.navbarColor}function isNavbarColored(){return""!==getNavbarColor()&&!window.impersonating}function makeNavbarBackgroundStyles(e){if(!isNavbarColored())return{}
const t=getNavbarColor();(0,S.hu)(void 0!==t,"navbarColor should be defined on window.bootstrap, but is not")
return""===t?{backgroundColor:""}:{backgroundColor:(0,Sr.ub)(...t.split(","))}}var dK=n(209501)
function getIconStyles(e){return[isNavbarColored()?gK.coloredItem:gK.item,e&&(isNavbarColored()?gK.coloredActive:gK.active),window.impersonating&&gK.impersonating,window.impersonating&&e&&gK.impersonatingActive]}class NavBarIcon extends d.Component{constructor(){super(...arguments)
this._handleSectionClick=e=>{this.props.link&&this.props.onSectionClick&&e.preventDefault()
this.props.onSectionClick&&this.props.onSectionClick(e,this.props.section)}}render(){const e=this.props.hasActivity&&!this.props.isActive,t=d.createElement("div",{className:(0,g.iv)(gK.inner)},d.createElement(pe.Z,{className:f()((0,g.iv)(gK.icon),this.props.className),icon:this.props.icon}),e&&d.createElement("div",{className:f()((0,g.iv)(gK.activityIndicator),"_test-navBarIcon-activityIndicator")})),n=getIconStyles(this.props.isActive)
return d.createElement(P.ZP,{container:"body",disabled:this.props.isActive,placement:P.TQ.RIGHT,title:(0,_G.U)(this.props.section)},(()=>{const e={component:"NavBarIcon",key:(0,Mt.i3)(this.props.section.toLowerCase())}
return this.props.link?d.createElement("a",{href:this.props.link,onClick:this._handleSectionClick,className:(0,g.iv)(n),...(0,ee.Z)(e)},t):d.createElement("div",{onClick:this._handleSectionClick,className:(0,g.iv)(n),...(0,ee.Z)(e)},t)})())}}NavBarIcon.defaultProps={hasActivity:!1,isActive:!1}
const uK=NavBarIcon,mK={backgroundColor:Vt.G$,color:Vt.Cj,textDecoration:"none"},pK={backgroundColor:Vt.JF},hK={backgroundColor:"rgba(0,0,0,0.1)"},gK=g.mM.create({coloredItem:{color:Vt.tN,cursor:"pointer",display:"block",height:Dn.kR,position:"relative",...(0,dK.Z)(hK)},item:{color:Vt.tN,cursor:"pointer",display:"block",height:Dn.kR,position:"relative",...(0,dK.Z)(mK)},active:mK,coloredActive:hK,impersonating:(0,dK.Z)(pK),impersonatingActive:pK,icon:{fontSize:14},inner:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",width:"100%"},activityIndicator:{borderColor:Vt.Yb,borderRadius:4,borderStyle:"solid",borderWidth:4,height:8,width:8,position:"absolute",top:23,right:4}})
function handleMessageError(e){(0,lK.Z)("Failed to message service worker",{errors:[new Error(`Service worker message error: ${e.toString()}`)]})}function handleControllerChange(e){(0,aK.Y)("Dev service worker has been updated, please reload.")}function DevToolsMenu({clientId:e}){const t=d.createElement(N.Z,{icon:"fast-forward",onSelect:()=>{(0,nK.Z)()}},"Fast Refresh (Ctrl+Shift+R)"),n=e?d.createElement(N.Z,{icon:"settings",onSelect:async()=>{await(0,Xn.Z)(FastRefreshSettingsModal,{clientId:e})}},"Cache Settings"):d.createElement(N.Z,null,"Loading...")
return d.createElement(w.ZP,{className:(0,g.iv)(EK.menu),height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},d.createElement(YI.Z,null,"Internal Admin"),d.createElement(N.Z,{icon:"add-to-team",href:"/internal-admin"},"Home"),d.createElement(N.Z,{icon:"checklist",href:"/internal-admin/configs"},"Configs"),d.createElement(YI.Z,null,"Dev Service Worker"),t,n)}function DevToolsIcon(e){const[t,a]=(0,d.useState)(!1),[i,s]=(0,d.useState)(null);(0,d.useEffect)((()=>{const e=function createMessageHandler({setClientId:e}){return({data:t})=>{t.messageType===cK.Cs.READY_FOR_FAST_REFRESH?window.location.reload():t.messageType===cK.Cs.CLIENT_ID_RESPONSE&&e(t.clientId)}}({setClientId:s})
navigator.serviceWorker.addEventListener("message",e)
navigator.serviceWorker.addEventListener("messageerror",handleMessageError)
navigator.serviceWorker.addEventListener("controllerchange",handleControllerChange)
return()=>{navigator.serviceWorker.removeEventListener("message",e)
navigator.serviceWorker.removeEventListener("messageerror",handleMessageError)
navigator.serviceWorker.removeEventListener("controllerchange",handleControllerChange)}}),[]);(0,d.useEffect)((()=>{const e=n.g.__activeDevServiceWorker
e&&(0,cK.Qs)(e,{messageType:cK.Cs.CLIENT_ID_REQUEST})}),[])
return d.createElement(Hy.ZP,{shouldCloseOnInsideClick:!0,menu:d.createElement(DevToolsMenu,{clientId:i}),onRequestClose:()=>{a(!1)},open:t},d.createElement("div",{className:e.withUserMenuOffset?(0,g.iv)(EK.itemOffset):(0,g.iv)(EK.itemBottom)},d.createElement(uK,{icon:"brackets",isActive:t,onSectionClick:()=>{a(!t)},section:ZP.SA.DEVELOPER})))}const EK=g.mM.create({itemBottom:{bottom:0,width:Dn.kR,height:Dn.kR,position:"fixed"},itemOffset:{bottom:Dn.kR,width:Dn.kR,height:Dn.kR,position:"fixed"},menu:{bottom:"0",left:"100%",position:"absolute",top:"auto"}})
class OutboundOrganizationRequest extends d.Component{constructor(){super(...arguments)
this.accept=()=>{J$.j8(this.props.request.organization.id)
"function"==typeof this.props.onAccept&&this.props.onAccept()}
this.reject=()=>{J$.P5(this.props.request.organization.id)
"function"==typeof this.props.onReject&&this.props.onReject()}}render(){return d.createElement(eW,{avatarEntity:this.props.request.organization,accept:this.accept,reject:this.reject,collapsed:this.props.collapsed},d.createElement("div",null,"You were invited to join ",d.createElement(X$,{entity:this.props.request.organization},".")),d.createElement("div",{className:"faded"},"Invited by ",d.createElement(X$,{entity:this.props.request.inviter})))}}const fK=OutboundOrganizationRequest
class PendingInvites extends d.Component{constructor(){super(...arguments)
this.dismissOrgInvites=()=>{J$.oq()}}render(){return d.createElement("div",{className:"alert alert-info u-no-spacing-bottom"},this.props.showDismiss?d.createElement(P.ZP,{title:"Click to hide forever"},d.createElement("button",{type:"button",className:"close",onClick:this.dismissOrgInvites},"×")):void 0,d.createElement("strong",null,"You have pending invites!")," Look for an email from ",this.props.inviteEmail,' and click "Join" to accept.')}}PendingInvites.defaultProps={showDismiss:!0}
const SK=PendingInvites
function CreateOrganizationFooter(e){return d.createElement("div",{className:"text-center u-small-padding-top u-tiny-padding-left"},d.createElement("a",{style:{fontSize:"14px"},onClick:()=>{(e=>{const t={name:e}
K$.fq(t)})(e.query)},...(0,ee.Z)({component:"SearchOrganizationModal",element:"create"})},"Create an organization"))}function SearchOrganizationModal(e){var t
const[{query:n,filters:a,hasSearched:i,requestedJoinOrganizationIds:s},{onChangeQuery:r,onChangeFilters:o,onChangeRequestedJoinOrganizationIds:l}]=useJoinOrganizationSearch();(0,d.useEffect)((()=>{e.currentUser.currentUserOutboundRequests&&l((e=>[...e,...(0,vj.Ph)()]))}),[e.currentUser.currentUserOutboundRequests,l])
m.j("onboarding","opened_search_organization_modal");(0,d.useEffect)((()=>{J$.zc()}),[])
const c=dt.ZP.GROWTH_ENABLE_ORGANIZATION_RECOMMENDATIONS,u=dt.ZP.GROWTH_ENABLE_ORGANIZATION_RECOMMENDATIONS,p=!dt.ZP.PRIVATE_DEPLOY||e.currentUser.isTenantAdmin
return d.createElement(et.ZP,{onRequestClose:()=>{e.onRequestClose()
K$.Hh()},closeable:!0,title:"Search for an organization to join",wrapInForm:!1,footer:p?d.createElement(CreateOrganizationFooter,{query:n}):void 0,showFooterBorder:!0,footerPullRight:!0,buttons:p?[]:void 0},(Boolean(null===(t=e.currentUser.currentUserInboundRequests)||void 0===t?void 0:t.length)||Boolean(e.currentUser.pendingOrgInvites))&&d.createElement("div",null,(h=e.currentUser,[d.createElement("h4",{className:"u-no-spacing-top",key:"invites-title"},"Pending Invites"),null!=h.currentUserInboundRequests?Array.from(h.currentUserInboundRequests).map((e=>d.createElement("div",{className:"u-small-spacing-top",key:`invites-${e.organization.id}`},d.createElement(fK,{request:e,collapsed:!1})))):void 0,h.pendingOrgInvites?d.createElement("div",{className:"u-small-spacing-top",key:"invites-pending"},d.createElement(SK,{inviteEmail:dt.ZP.INVITE_EMAIL})):void 0]),d.createElement("hr",null)),d.createElement("p",null,"Organizations are a great way to collaborate with people on Benchling.   Search for the name of your organization to get started."),d.createElement(JoinOrganizationSearch,{query:n,onChangeQuery:r,filters:a,setFilters:o,requestedJoinOrganizationIds:s,onChangeRequestedJoinOrganizationIds:l,canNavigateToOrganizationPage:!0,showInstitutionFilter:c,hasSearched:i,showRecommendations:u}))
var h}const _handleCloseSearchOrgModal=()=>nW.Z.closeSearchOrgModal(),AnchorModalsForOnboarding=({openModal:e,searchOrgModalState:t})=>d.createElement("div",null,Jn.Z.currentUser()&&d.createElement("div",null,d.createElement(M_.Z,{open:e===bz.Z.SEARCH_ORGANIZATION_MODAL_KEY},d.createElement(SearchOrganizationModal,{currentUser:Jn.Z.currentUser(),modalState:t,onRequestClose:_handleCloseSearchOrgModal}))))
AnchorModalsForOnboarding.propTypes={openModal:J().string,searchOrgModalState:J().object}
const yK=AnchorModalsForOnboarding
function ChecklistMenu(){const e=bz.Z.getNUEModuleState(Qs.ZP.MODULES.GETTING_STARTED),t=bz.Z.getNUEModuleState(Qs.ZP.MODULES.ENTRY),n=bz.Z.getNUEModuleState(Qs.ZP.MODULES.SEQUENCE),a=d.createElement(N.Z,{className:"u-pointer",onSelect:()=>{(0,Cz.O8)(vz.qh,"navbar_icon")
w_.GS(ZP.SA.HOME)}},"Get started with Benchling"),i=d.createElement(N.Z,{className:"u-pointer",onSelect:()=>{(0,Cz.O8)(vz.dP,"navbar_icon");(0,Ys.lm)(Qs.ZP.MODULES.SEQUENCE);(0,Ys.hE)()}},"Explore Molecular Biology"),s=d.createElement(N.Z,{className:"u-pointer",onSelect:()=>{(0,Cz.O8)(vz.t8,"navbar_icon");(0,Ys.lm)(Qs.ZP.MODULES.ENTRY);(0,Ys.JU)()}},"Explore the Notebook")
return d.createElement(w.ZP,{className:(0,g.iv)(bK.menu),height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},d.createElement(YI.Z,{className:(0,g.iv)(bK.sectionHeader)},"Checklists"),dt.ZP.ENABLE_GETTING_STARTED_FLOW&&!(null==e?void 0:e.completed)&&a,!(null==n?void 0:n.completed)&&i,!(null==t?void 0:t.completed)&&s)}function NotificationIcon(){return d.createElement("div",{className:(0,g.iv)(bK.notification)})}function ChecklistMenuIcon(e){const[t,n]=(0,d.useState)(!1)
return d.createElement(Hy.ZP,{shouldCloseOnInsideClick:!0,menu:d.createElement(ChecklistMenu,null),onRequestClose:()=>{n(!1)},open:t},d.createElement("div",{className:f()((0,g.iv)(bK.item),(0,g.iv)(e.shouldAlignBottom?bK.itemAlignBottom:bK.itemAlignRelative))},d.createElement(uK,{icon:"checklist",isActive:t,onSectionClick:()=>{n(!t)},section:ZP.SA.ONBOARDING_CHECKLISTS}),e.shouldShowNotification&&d.createElement(NotificationIcon,null)))}const bK=g.mM.create({item:{width:Dn.kR,height:Dn.kR},itemAlignRelative:{position:"relative"},itemAlignBottom:{position:"fixed",bottom:Dn.kR},menu:{margin:"0px",bottom:"-40px",left:"100%",position:"absolute",top:"auto"},sectionHeader:{backgroundColor:Vt.t0,marginTop:"-2px",borderRadius:"4px 4px 0px 0px",color:Vt.Cj},notification:{position:"absolute",left:"16px",bottom:"28px",height:"8px",width:"8px",backgroundColor:Vt.hM,border:`1px solid ${Vt.Cj}`,borderRadius:"50%"}})
var TK=n(845627)
class CreateIcon extends d.Component{constructor(){super(...arguments)
this._handleToggleCreateMenu=()=>{this.props.isCreateMenuOpen?w_.AQ():w_.N1()}
this._handleCloseCreateMenu=()=>{this.props.isCreateMenuOpen&&w_.AQ()}}render(){const e=getIconStyles(this.props.isCreateMenuOpen)
return d.createElement(Sx.Z,{shouldCloseOnInsideClick:!1,onClickOut:this._handleCloseCreateMenu},d.createElement(P.ZP,{container:"body",disabled:this.props.isCreateMenuOpen,placement:P.TQ.RIGHT,title:"Create"},d.createElement("div",{className:f()((0,g.iv)(e),this.props.isCreateMenuOpen&&"open"),style:makeNavbarBackgroundStyles()},d.createElement("div",{className:f()((0,g.iv)(gK.inner),"_test-createIcon-inner"),onClick:this._handleToggleCreateMenu},d.createElement(pe.Z,{icon:"compose",className:(0,g.iv)(gK.icon)})),d.createElement("div",{onClick:this._handleCloseCreateMenu,className:f()(this.props.isCreateMenuOpen&&"open")},this.props.createMenu))))}}const vK=CreateIcon
var CK=n(168490)
function HomeIcon(e){let t=!1
if(null!=e.currentUser){const{currentUserInboundRequests:n,pendingOrgInvites:a,userOrgsInboundRequests:i}=e.currentUser
t=Boolean(n&&n.length>0||i&&i.length>0||a&&a>0)}return d.createElement(uK,{className:(0,g.iv)(IK.icon),icon:e.icon,isActive:e.isActive,link:"/",onSectionClick:e.onHomeIconClick,section:ZP.SA.HOME,hasActivity:t})}const IK=g.mM.create({icon:{fontSize:20,height:20,width:20}})
class RegistryIcon extends d.Component{_shouldHideForAcademicUser(){if(!(this.props.currentUser&&!XA.Z.hasEnterprisePlan()&&this.props.currentUser.proclaimed===XN.ZP.PROCLAIMED_ACADEMIC))return!1
let e=!1
if(this.props.areSourcesLoading)e=We.Z.get(tw.RegistryPreferences.DENORMALIZE_ACADEMIC_HAS_REGISTRY)
else{e=Boolean(this.props.registries&&this.props.registries.length>0)
We.Z.set(tw.RegistryPreferences.DENORMALIZE_ACADEMIC_HAS_REGISTRY,e)}return!(e||We.Z.get(tw.RegistryPreferences.REGISTRY_ACTIVATION_COMPLETE)||We.Z.get(tw.RegistryPreferences.ENABLE_REGISTRY_ACTIVATION))}render(){const e={icon:"registry",isActive:this.props.isActive,section:this.props.section,hasActivity:!1},t=this.props.registries&&this.props.registries.length>0||We.Z.get(tw.RegistryPreferences.REGISTRY_ACTIVATION_COMPLETE)
return d.createElement("span",{className:(0,g.iv)(NK.icon)},(()=>this._shouldHideForAcademicUser()?null:TK.Z.isEnabled(this.props.currentUser)&&!t?d.createElement(uK,{...e,className:(0,g.iv)(TK.Z.hasRequested()&&$K.disabledIcon),onSectionClick:()=>{TK.Z.open(TK.l.REGISTRY)}}):d.createElement(uK,{...e,onSectionClick:this.props.onSectionClick}))())}}RegistryIcon.propTypes={isActive:J().bool.isRequired,currentUser:J().shape(FN.Q),onSectionClick:J().func.isRequired,section:J().oneOf(Object.values(ZP.SA)).isRequired,registries:J().arrayOf(tw.REGISTRY_SHAPE.isRequired).isRequired,areSourcesLoading:J().bool.isRequired}
const wK=xR.Z.connect((e=>({registries:e.getRegistries(),areSourcesLoading:e.isLoading()})))(RegistryIcon),NK=g.mM.create({icon:{position:"relative"}})
var AK=n(479977),RK=n(277542),PK=n(748048),OK=n(925256),xK=n(508085),_K=n(485992),DK=n(361038),LK=n(52145),kK=n(456765),MK=n(276637),FK=n(433888)
function shouldShowDeveloperConsole(e){const t=(0,ln.cr)({feature:on.jE.DEVELOPER_PLATFORM_DISCOVER}),n=dt.ZP.EVENTS_ENABLE_UI&&e,a=dt.ZP.ENABLE_BENCHLING_APPS
return t&&(n||a)}function DeveloperConsoleSettings(e){const t=Jn.Z.currentUser()
return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Developer Console"),dt.ZP.ENABLE_BENCHLING_APPS&&d.createElement(FT.Z,{active:e.section===Nz.Section.BENCHLING_APPS_SETTINGS,icon:d.createElement(MT.Z,null),name:"Apps",clickHandler:function handleOpenBenchlingAppsSection(){(0,ac.ZP)(RK.TC)}}),dt.ZP.ENABLE_BENCHLING_APPS&&dt.ZP.ENABLE_BENCHLING_APPS_CANVAS_BUILDER&&d.createElement(FT.Z,{active:e.section===Nz.Section.BENCHLING_APP_CANVAS_BUILDER,icon:d.createElement(MT.Z,null),name:"App Canvas Builder",clickHandler:function handleOpenBenchlingAppCanvasBuilderSection(){(0,ac.ZP)(RK.bc)}}),dt.ZP.EVENTS_ENABLE_UI&&(null==t?void 0:t.isTenantAdmin)&&d.createElement(FT.Z,{active:e.section===Nz.Section.EVENT_SUBSCRIPTIONS,icon:d.createElement(MT.Z,null),name:"Events",clickHandler:function handleOpenEventSubscriptionsSection(){(0,ac.ZP)(PK.WC)}}))}var ZK=n(389595),BK=n(361154)
function Detail(e){return d.createElement("div",{className:(0,g.iv)(qK.detail)},d.createElement("strong",null,e.name,":")," ",d.createElement("span",{className:(0,g.iv)(qK.valueText)},e.value))}function AboutBenchlingModal(e){return d.createElement(et.ZP,{onRequestClose:e.onRequestClose,suppressHeader:!0,wrapInForm:!1,small:!0},d.createElement("div",{className:"u-small-spacing-bottom u-lr-split"},d.createElement("img",{className:(0,g.iv)(qK.wordmark),src:"/static/img/gradient_wordmark_500.png"}),d.createElement(pe.Z,{className:"close",icon:"close","data-dismiss":"modal"})),d.createElement(Detail,{name:"Version",value:dt.ZP.VALIDATED_CLOUD_VERSION}),d.createElement(Detail,{name:"Product",value:"Validated Cloud"}),d.createElement(Detail,{name:"Tenant ID",value:dt.ZP.TENANT_NAME}))}const qK=g.mM.create({detail:{..._n.cf,marginBottom:10},wordmark:{width:140},valueText:{color:Vt.pp}}),VK=xa.Ps`
  query UserMenuQuery @skipAudit @engComponent(name: NAVIGATION) {
    currentTenant {
      id
      avatarUrl
    }
    currentUser {
      id
      isTenantAdmin
    }
  }
`
function getGroupMenuItems(e,t,n,a){const i=e.map((e=>({avatarUrl:e.avatar_url,handleOnClick:e=>{de.c4(e)},link:a(e),name:e.name,dataTestAttrs:{component:"GroupMenu",element:"item"}})))
return e.length>3?[{icon:t,name:n,dropup:!0,submenu:[i]}]:i}class PresentationalUserMenu extends d.Component{constructor(){super(...arguments)
this._handleClickCreateOrg=e=>{if(de.Gn(e)){e.preventDefault()
nW.Z.openSearchOrgModal()}}
this._renderUserItem=()=>d.createElement("li",{className:(0,g.iv)(GK.userInfo)},d.createElement(fC.Z,{entity:this.props.currentUser,className:(0,g.iv)(GK.avatar),size:SC.D.LARGE}),d.createElement("div",{className:(0,g.iv)(GK.userText)},d.createElement("div",{className:(0,g.iv)(GK.header),...(0,ee.Z)({component:"UserMenu",element:"userText"})},(0,Qw.a)(this.props.currentUser)),d.createElement("div",{className:f()((0,g.iv)(GK.subheader),"_test-userMenu-subheader")},d.createElement("a",{className:(0,g.iv)(GK.link),href:`/${this.props.currentUser.url_identifier}/settings`,...(0,ee.Z)({component:"UserMenu",element:"settings"})},"Settings"))))}render(){var e
const t=getGroupMenuItems(this.props.currentUser.organizations,st.ORGANIZATION,"Organizations",(e=>jW.Z.organizationURL(e.url_identifier))),n=getGroupMenuItems(this.props.currentUser.teams,st.TEAM,"Teams",(e=>qj.dn(e.id))),a={name:dt.ZP.INVITE_SCIENTISTS_EXTERNALLY?"Refer a peer":"Invite scientists",icon:"invite",link:dt.ZP.INVITE_SCIENTISTS_EXTERNALLY?"https://www.benchling.com/referral-program/?utm_source=product&utm_medium=web&utm_campaign=referral_product_button":"/invite",visible:dt.ZP.ENABLE_GLOBAL_INVITE_SCIENTISTS},i=this.props.currentTenant,s=[...[[{avatarUrl:null!==(e=null==i?void 0:i.avatarUrl)&&void 0!==e?e:fC.O,name:"Tenant admin console",handleOnClick:e=>{de.c4(e)},link:"/admin",visible:dt.ZP.ENABLE_TENANT_ADMIN_CONSOLE&&Jn.Z.currentUser().isTenantAdmin,dataTestAttrs:{component:"TenantAdminConsole",element:"item"}}]],t,n,[{name:"Feature settings",icon:"settings",dropup:!0,generateLinkFromSubmenu:!0,handleOnClick:e=>{de.c4(e)},submenu:[[{name:"Registry settings",icon:st.REGISTRY,handleOnClick:e=>{de.c4(e)},link:this.props.registrySettingsURL,visible:(0,ln.cr)({feature:on.ed.REGISTRY_ADMIN})&&Boolean(this.props.registrySettingsURL)},{name:"Schema interfaces",icon:st.SCHEMA_INTERFACE,handleOnClick:e=>{de.c4(e)},link:(0,FK.cV)(),visible:dt.ZP.SCHEMAS_ENABLE_INTERFACES},{name:"Inventory settings",icon:"location",handleOnClick:e=>{de.c4(e)},link:(0,OK.gc)(),visible:(0,ln.cr)({feature:on.TD.INVENTORY_ADMIN})},{name:"Monomer library",icon:"monomer",handleOnClick:e=>{de.c4(e)},link:_K.HL,visible:(0,vn.cR)()},{name:"Unit dictionary",icon:"ruler",handleOnClick:e=>{de.c4(e)},link:BK.OF,visible:dt.ZP.UNITS_ENABLE_UNIT_DICTIONARY},{name:"Template collections",icon:"template_collection",handleOnClick:e=>{de.c4(e)},link:HW.Z.collectionsURL()},{name:"Entry review processes",icon:"review_lifecycles",handleOnClick:e=>{de.c4(e)},link:DK.Fj(),visible:(0,LK.yR)()},{name:"Run schemas",icon:st.RUN_SCHEMA,handleOnClick:e=>{de.c4(e)},link:MK.VO(OZ.aJ.ASSAY_RUN),visible:(0,ln.or)([{feature:on.d$.LAB_AUTOMATION_ADMIN}])},{name:$Z.Z5,icon:st.RESULT_SCHEMA,handleOnClick:e=>{de.c4(e)},link:MK.VO(OZ.aJ.ASSAY_RESULT),visible:(0,ln.cr)({feature:on.gm.RESULTS_ADMIN})},{name:"Request schemas",icon:st.REQUEST_SCHEMA,handleOnClick:e=>{de.c4(e)},link:MK.VO(OZ.aJ.ASSAY_REQUEST),visible:dt.ZP.ENABLE_REQUESTS},{name:"Study schemas",icon:"study",handleOnClick:e=>{de.c4(e)},link:(0,ZK.$_)(),visible:dt.ZP.STUDIES_ENABLE},{name:"Workflow schemas",icon:"process",handleOnClick:e=>{de.c4(e)},link:kK.Lv(),visible:(0,ln.cr)({feature:on.gx.PROCESSES_ADMIN})},{name:"Access policies",icon:"lock",handleOnClick:e=>{de.c4(e)},link:AK.z8(),visible:dt.ZP.ENABLE_POLICY_UI},{name:"Developer console",icon:"console",handleOnClick:e=>{de.c4(e)},link:dt.ZP.ENABLE_BENCHLING_APPS?RK.TC:PK.WC,visible:shouldShowDeveloperConsole(this.props.currentUser.isTenantAdmin)}]],dataTestAttrs:{component:"FeatureSettings",element:"item"}},{name:"Molecular biology settings",icon:"wrench",dropup:!0,generateLinkFromSubmenu:!0,submenu:[[{name:"Enzyme lists",icon:"enzyme",link:`/${this.props.currentUser.url_identifier}/enzyme-lists`,visible:(0,ln.cr)({feature:on.Ot.MOLBIO_ADMIN})},{name:"Feature libraries",icon:"feature-libraries",link:`/${this.props.currentUser.url_identifier}/feature-libraries`,visible:(0,ln.cr)({feature:on.Ot.MOLBIO_ADMIN})},{name:"Ladders",icon:"ladder",link:`/${this.props.currentUser.url_identifier}/ladders`,visible:(0,ln.cr)({feature:on.Ot.MOLBIO_ADMIN})}]]},{name:"Data export",icon:"export",extraClasses:"js-create-new-export",visible:dt.ZP.ENABLE_EXPORTS}],[{name:"Help",icon:"more-info",link:dt.ZP.ENABLE_ZENDESK_GUIDE?YQ:dt.ZP.SUPPORT_SITE_URL,submenu:[l.default.compact([Boolean(dt.ZP.VALIDATED_CLOUD_VERSION)&&{name:"About Benchling",icon:"benchling",handleOnClick:()=>{(0,Xn.Z)(AboutBenchlingModal,{})}},{name:"Help center",icon:"more-info",link:dt.ZP.ENABLE_ZENDESK_GUIDE?YQ:dt.ZP.SUPPORT_SITE_URL},{name:"Ask the community",icon:"team",link:"https://community.benchling.com/"}])]},a],[{name:"Upgrade account",icon:"star",handleOnClick:()=>{TK.Z.open()},visible:TK.Z.isEnabled(this.props.currentUser),extraIconClasses:"navDropdownMenu-item-icon--green"},{name:"Create or join organization",handleOnClick:this._handleClickCreateOrg,icon:"compose",extraClasses:"legacy-font-proxima-title js-createOrganizationButton",link:"/organizations/create",extraIconClasses:"navDropdownMenu-item-icon--blue",visible:!dt.ZP.PRIVATE_DEPLOY||this.props.currentUser.isTenantAdmin},{name:"Sign out",icon:"sign-out",extraClasses:"legacy-font-proxima-title",link:"/signout",dataMethod:"POST",extraIconClasses:"navDropdownMenu-item-icon--red",handleOnClick:xK._9}]],r=d.createElement("form",{className:(0,g.iv)(GK.container)},this._renderUserItem())
return d.createElement(LR.Z,{className:"dropdown-menu--dropRightUp",extraElement:r,items:s,...(0,ee.Z)({component:"UserMenu",element:"dropdownMenu"})})}}PresentationalUserMenu.propTypes={currentUser:J().shape({avatar_url:J().string.isRequired,handle:J().string.isRequired,isTenantAdmin:J().bool,organizations:J().array.isRequired,teams:J().array.isRequired,url_identifier:J().string.isRequired,email:J().string.isRequired,name:J().string.isRequired}).isRequired,registrySettingsURL:J().string,currentTenant:J().object}
function getRegistrySettingsURL(e){const t=e.flatMap((e=>"RegistryNode"===e.__typename?[e]:[]))[0]
return t?lo.getRegistrySettingsUrl(t.ownerJson.url_identifier,t.id):null}function UserMenu(e){const t={...e,registrySettingsURL:null,currentTenant:null}
return d.createElement(Da.F,{query:VK},(({data:e,loading:n})=>d.createElement(Da.F,{query:tZ.P},(({data:n,loading:a})=>{var i
return d.createElement(PresentationalUserMenu,{...t,currentTenant:null!==(i=null==e?void 0:e.currentTenant)&&void 0!==i?i:null,registrySettingsURL:a?null:getRegistrySettingsURL(n.sources)})}))))}const UK={color:Vt.tN,textDecoration:"none"},GK=g.mM.create({container:{borderRadius:"inherit"},userText:{overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-evenly"},userInfo:{backgroundColor:Vt.G$,borderRadius:"inherit",color:Vt.Cj,cursor:"default",display:"flex",padding:Dn.br},header:{...jf.wj,fontSize:16,lineHeight:"24px",marginBottom:6},subheader:{fontSize:12,lineHeight:"16px",marginBottom:3},link:{color:Vt.Cj,fontWeight:_n.KB,":hover":UK,":focus":UK,":active":{color:Vt.pF,textDecoration:"none"}},avatar:{marginRight:14}})
function UserIcon(e){return e.currentUser?d.createElement("div",{className:f()((0,g.iv)(getIconStyles(e.isActive),zK.item),"dropdown")},d.createElement("div",{className:f()((0,g.iv)(gK.inner),"dropdown-toggle js-userDropdownButton"),"data-toggle":"dropdown",...(0,ee.Z)({component:"UserIcon",element:"userDropdownButton"})},d.createElement(fC.Z,{entity:e.currentUser,size:SC.D.SMALL}),Boolean(dt.ZP.VALIDATED_CLOUD_VERSION)&&d.createElement(pe.Z,{className:(0,g.iv)(zK.validatedBadge),icon:"validated-cloud"})),d.createElement(UserMenu,{currentUser:e.currentUser})):null}const zK=g.mM.create({item:{bottom:0,position:"fixed",width:Dn.kR},validatedBadge:{position:"absolute",bottom:7,right:7,height:20,width:20,fill:Vt.Cj}})
function NavBarContents(e){const t=e.section===ZP.SA.HOME||dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&(e.section===ZP.SA.WORKLISTS||e.section===ZP.SA.WORKLIST_ITEMS)
return d.createElement("div",{className:f()((0,g.iv)($K.navbar,window.impersonating&&$K.impersonating),"js-navTour-nav _test-navBarContents"),style:makeNavbarBackgroundStyles(),...(0,ee.Z)({component:"NavBarContents",element:"root"})},d.createElement("div",null,d.createElement(HomeIcon,{currentUser:e.currentUser,icon:"benchling",isActive:t,onHomeIconClick:e.onSectionClick}),d.createElement(uK,{icon:"source",isActive:e.section===ZP.SA.PROJECT_ITEMS||e.section===ZP.SA.PROJECTS,onSectionClick:e.onSectionClick,section:ZP.SA.PROJECTS,className:"_test-navDropdownMenu-item-projects"}),dt.ZP.STUDIES_ENABLE&&d.createElement(uK,{icon:"study",isActive:e.section===ZP.SA.STUDIES,onSectionClick:e.onSectionClick,section:ZP.SA.STUDIES}),d.createElement(uK,{icon:"search",isActive:e.section===ZP.SA.SEARCH,onSectionClick:e.onSectionClick,section:ZP.SA.SEARCH}),d.createElement(vK,{createMenu:d.createElement(CK.ZP,null),isCreateMenuOpen:e.isCreateMenuOpen}),d.createElement("div",{className:(0,g.iv)($K.spacer)}),(0,ln.cr)({feature:on.ed.REGISTRY_DISCOVER})&&d.createElement(wK,{currentUser:e.currentUser,onSectionClick:e.onSectionClick,isActive:e.section===ZP.SA.REGISTRIES,section:ZP.SA.REGISTRIES}),(0,ln.cr)({feature:on.TD.INVENTORY_DISCOVER})&&d.createElement(uK,{icon:st.LOCATION,isActive:e.section===ZP.SA.STORAGE,onSectionClick:e.onSectionClick,section:ZP.SA.STORAGE}),dt.ZP.LEGACY_WORKFLOWS_ENABLE?d.createElement(uK,{icon:"workflow",isActive:e.section===ZP.SA.WORKFLOWS,onSectionClick:e.onSectionClick,section:ZP.SA.WORKFLOWS}):TK.Z.isEnabled(e.currentUser)?d.createElement(uK,{icon:"workflow",className:(0,g.iv)(TK.Z.hasRequested()&&$K.disabledIcon),isActive:e.section===ZP.SA.WORKFLOWS,onSectionClick:()=>{TK.Z.open(TK.l.WORKFLOWS)},section:ZP.SA.WORKFLOWS}):null,(0,ln.cr)({feature:on.gx.PROCESSES_DISCOVER})&&d.createElement(uK,{icon:"process",isActive:e.section===ZP.SA.PROCESSES,onSectionClick:e.onSectionClick,section:ZP.SA.PROCESSES}),dt.ZP.ENABLE_REQUESTS?d.createElement(uK,{icon:"request",isActive:e.section===ZP.SA.REQUESTS,onSectionClick:e.onSectionClick,section:ZP.SA.REQUESTS}):TK.Z.isEnabled(e.currentUser)?d.createElement(uK,{icon:"request",className:(0,g.iv)(TK.Z.hasRequested()&&$K.disabledIcon),isActive:e.section===ZP.SA.REQUESTS,onSectionClick:()=>{TK.Z.open(TK.l.REQUESTS)},section:ZP.SA.REQUESTS}):null,(0,ln.cr)({feature:on.sZ.INSIGHTS_DISCOVER})&&d.createElement(uK,{icon:"analyze",isActive:e.section===ZP.SA.ANALYTICS,onSectionClick:e.onSectionClick,section:ZP.SA.ANALYTICS}),(dt.ZP.TFI_ENABLE||(0,ln.Oj)({feature:on.d$.LAB_AUTOMATION_DISCOVER}))&&d.createElement(uK,{icon:"external-files",isActive:e.section===ZP.SA.TFI||e.section===ZP.SA.BENCHLING_APPS||e.section===ZP.SA.CONNECTIONS,onSectionClick:e.onSectionClick,section:(0,ln.Oj)({feature:on.d$.LAB_AUTOMATION_DISCOVER})?ZP.SA.CONNECTIONS:ZP.SA.TFI}),dt.ZP.APP_CORE_ENABLE_FAKE_ITEM_TYPE&&d.createElement(uK,{icon:"core-object",isActive:e.section===ZP.SA.JELLYFISH,onSectionClick:e.onSectionClick,section:ZP.SA.JELLYFISH}),window.debug&&d.createElement(DevToolsIcon,{withUserMenuOffset:!0}),(0,Cz.Rw)()&&d.createElement(ChecklistMenuIcon,{shouldAlignBottom:!window.debug,shouldShowNotification:!0}),d.createElement(UserIcon,{currentUser:e.currentUser,isActive:e.isUserIconActive}),e.homeDashboardState&&d.createElement(yK,{...e.homeDashboardState})))}NavBarContents.defaultProps={isCreateMenuOpen:!1,isUserIconActive:!1}
const $K=g.mM.create({navbar:{...!isNavbarColored()&&{backgroundColor:Vt.Ej},bottom:0,position:"absolute",top:0,width:Dn.kR,zIndex:Dn.W1},impersonating:{backgroundColor:Vt.Zl},disabledIcon:{color:Vt.Cj,opacity:.4},spacer:{height:20}})
function SettingsNavBarContents(e){return d.createElement("div",{style:makeNavbarBackgroundStyles(),className:f()((0,g.iv)($K.navbar,window.impersonating&&$K.impersonating),"js-navTour-nav")},d.createElement(HomeIcon,{icon:"benchling",isActive:!1,onHomeIconClick:t=>{de.c4(t,"/editor")
e.onClickHome(t)}}),window.debug&&d.createElement(DevToolsIcon,null))}var WK=n(815949)
class SignedOutNavBarContents extends d.Component{componentDidMount(){WK.he()}render(){return d.createElement("div",{className:f()((0,g.iv)($K.navbar),"js-navTour-nav"),style:makeNavbarBackgroundStyles()},d.createElement(HomeIcon,{icon:"benchling",isActive:!0,onHomeIconClick:(e,t)=>{w_.sQ(t)}}))}}const HK=SignedOutNavBarContents
class NavBarConnector extends oi.C{constructor(){super(...arguments)
this.stores=[Jn.Z,HQ.Z,bz.Z,nz.Z]
this.shouldSubscribeToRedux=!1}enhanceProps(){const e=this.fullScreenStore().getCurrentScreen()===HT.ORGANIZATION_SCREEN
return{currentUser:this.entityStore().currentUser(),homeDashboardState:this.homeDashboardStore().getState(),isCreateMenuOpen:this.sidepanelStore().getIsCreateMenuOpen(),isOpen:this.sidepanelStore().getIsOpen(),section:this.sidepanelStore().getSection(),organizationPageOpen:e,newUserFlowOpen:this.fullScreenStore().isNewUserFlowActive()}}}class NavBar extends d.PureComponent{setSection(e){w_.GS(e)}_handleSectionClick(e,t){this.props.isOpen&&t===this.props.section?w_.xv():this.setSection(t)}render(){return this.props.currentUser?this.props.section&&!(0,Jt.q9)(Object.values(ZP.SA),this.props.section)?d.createElement(SettingsNavBarContents,{onClickHome:e=>{this._handleSectionClick(e,ZP.$0.HOME)}}):this.props.newUserFlowOpen?null:d.createElement(NavBarContents,{currentUser:this.props.currentUser,homeDashboardState:this.props.homeDashboardState,isCreateMenuOpen:this.props.isCreateMenuOpen,isUserIconActive:this.props.organizationPageOpen,onSectionClick:(e,t)=>{this._handleSectionClick(e,t)},section:this.props.section}):showValueMessagingForSharedFile()?null:d.createElement(HK,null)}}const jK=NavBarConnector.connect(NavBar)
var YK=n(301288),QK=n(402337),KK=n(831144)
function EditableTentaclesTable({tentacles:e,onAddTentacle:t,onRemoveTentacle:n,onUpdateTentacle:a,onUpdateTentacles:i}){return d.createElement("div",null,d.createElement(Fr.Z,{label:"Tentacles",isRequired:!0}),d.createElement(KK.Z,{isDraggingDisabled:e.length<=1,headerCells:[{key:"name",contents:"Name",cellClassName:(0,g.iv)(JK.nameCell)}],noRowsText:"No tentacles.",onReorderRow:(t,n)=>{i(function arrayMove(e,t,n){const a=[...e],[i]=a.splice(t,1)
a.splice(n,0,i)
return a}(e,e.findIndex((e=>e.id===t)),n))},rows:e.map((t=>({id:t.id,cells:[{key:"name",contents:d.createElement(Jl.Z,{value:t.name,onChange:e=>{const n=e.target.value
a(t.id,{name:n})},onBlur:e=>{const n=e.target.value.trim()
a(t.id,{name:n})},labelStyle:Mo.gF.HIDDEN}),cellClassName:(0,g.iv)(JK.nameCell)}],actionGroup:e.length>0&&d.createElement(C.Co,{buttonStyle:C.ZJ.CIRCLE_ICON,size:C.qE.SMALL,icon:"delete",isDropdown:!1,iconAltText:"Remove tentacle",onClick:()=>{n(t.id)}}),rowClassName:(0,g.iv)(JK.sectionsTableRow)}))),footerCells:[{key:"add",contents:d.createElement(C.Co,{className:(0,g.iv)(JK.addButton),buttonStyle:C.ZJ.TEXT,size:C.qE.SMALL,icon:"compose",text:"Add tentacle",onClick:t}),cellClassName:(0,g.iv)(JK.addButtonCell)}]}))}const JK=g.mM.create({sectionsTableRow:{padding:"7px 14px"},addButtonCell:{margin:"-4px auto"},addButton:{marginLeft:"-10px"},nameCell:{flexGrow:2}}),XK={id:"blank",name:""}
function validateCreateJellyfishParams(e){return e.name.length>0&&null!=e.folderId&&null!=e.tentacles&&e.tentacles.every((({name:e})=>e.length>0))}function CreateJellyfishModal(e){const[t,n]=(0,d.useState)("Untitled"),[a,i]=(0,d.useState)(Qe.Z.get(Qe.O.JELLYFISH)),[s,r]=(0,d.useState)([]),o={name:t,folderId:a,tentacles:s.map((({name:e})=>({name:e}))),description:null}
return d.createElement(et.ZP,{buttons:[{disabled:!validateCreateJellyfishParams(o),submit:!0,text:"Create",style:C.ZJ.SECONDARY}],title:d.createElement("span",null,"Create jellyfish"),onRequestClose:e.onRequestClose,onRequestSubmit:async()=>{(0,S.hu)(validateCreateJellyfishParams(o),"Errors in create jellyfish params")
await(0,Ic.jI)(async function onCreateJellyfish(e){const t=await(0,YK.M)(e)
Rn.Z.openFile(t.createdIds[0]);(0,Vn.getStore)().dispatch((0,VP.KM)(ZP.$0.JELLYFISH))
return t}(o),"Creating jellyfish...")
e.onRequestSubmit()
Qe.Z.set(Qe.O.JELLYFISH,o.folderId)}},d.createElement(QK.Y,{name:t,setName:n,modelType:st.JELLYFISH,folderId:a,setFolderId:i,showInventory:!0,setTemplateCollection:Jt.ZT,tagSchema:null,updateTagSchema:Jt.ZT,updateSchemaTag:Jt.ZT,schemaTags:[],errorsByFieldId:{}}),d.createElement(EditableTentaclesTable,{tentacles:s,onUpdateTentacles:r,onAddTentacle:()=>{r((0,tm.ZP)(s,(e=>{e.push({...XK,id:(0,gt.Z)()})})))},onRemoveTentacle:e=>{const t=s.findIndex((t=>t.id===e));(0,S.hu)(-1!==t,`Couldn't find tentacle with id '${e}'`)
r((0,tm.ZP)(s,(e=>{e.splice(t,1)})))},onUpdateTentacle:(e,t)=>{const n=s.findIndex((t=>t.id===e));(0,S.hu)(-1!==n,`Couldn't find tentacle with id '${e}'`)
r((0,tm.ZP)(s,(e=>{e[n]={...e[n],...t}})))}}))}function handleClickNewJellyfish(){(0,Xn.Z)(CreateJellyfishModal,{})}function CreateJellyfishButton(){return d.createElement(Zo.Z,{text:"Add jellyfish",placement:ne.ZH.BOTTOM},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,icon:"compose",onClick:handleClickNewJellyfish,size:C.qE.SMALL}))}var eJ=n(749334)
function JellyfishSidepanelCrumbs(e){return e.activeSavedSearch?d.createElement(Cw.bJ,{crumbs:[d.createElement(Cw.Ak,{key:"jellyfish",text:"Jellyfish",onClick:()=>{e.onSearch(RN._j(e.searchParams,[],JellyfishSidepanel_getDefaultFilters()))
e.onSelectSavedSearch(void 0)}}),d.createElement(Cw.Ak,{key:"root",text:e.activeSavedSearch.name})],settingsIcon:e.settingsComponents}):d.createElement(Cw.bJ,{crumbs:[d.createElement("span",{key:"root"},"Jellyfish")],settingsIcon:e.settingsComponents})}function JellyfishSidepanel_getDefaultFilters(){const e=(0,qP.hN)(ZP.$0.JELLYFISH)
e.find((e=>e.key===Kn.Vm.TYPES))||e.push({...(0,Kn.QW)(Kn.Vm.TYPES),value:[st.JELLYFISH]})
return e}const tJ=(0,UP.ZP)((function JellyfishSidepanelListing(e){return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,actionSource:j.D2.JELLYFISH_SIDEPANEL,savedSearchSection:Sn.yd.JELLYFISH,additionalHeaderButtons:d.createElement(CreateJellyfishButton,null),availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],availableTypes:[st.JELLYFISH],makeCrumbs:t=>d.createElement(JellyfishSidepanelCrumbs,{activeSavedSearch:e.activeSavedSearch,onSelectSavedSearch:e.onSelectSavedSearch,onSearch:e.onSearch,searchParams:e.searchParams,settingsComponents:t}),extraPrimaryFilterOptions:[],getSecondaryFilterGroups:()=>[{name:"General",filterOptions:[{filterKey:Kn.Vm.NAMES},{filterKey:Kn.Vm.CREATED_AT},{filterKey:Kn.Vm.MODIFIED_AT},{filterKey:Kn.Vm.STARRED},{filterKey:Kn.Vm.ARCHIVE_PURPOSES,extraProps:{archivePurposes:(0,$u.Nu)()}}]}],preservedFilterKeys:[],section:ZP.$0.JELLYFISH}))}),Kn.Sc.JELLYFISH,ZP.SA.JELLYFISH,{defaultSearchParams:function getDefaultSearchParams(){return{filters:JellyfishSidepanel_getDefaultFilters(),offset:0,limit:(0,TN.z3)(),query:"",sorts:(0,qP.i_)(ZP.$0.JELLYFISH)}}(),getNavigationUpdate:function getURL(e,t){return t.isExpanded?{url:(0,eJ.q7)("/jellyfish/listing",t.searchParams,t.filterErrors),options:{replace:e.isExpanded===t.isExpanded}}:null}})
var nJ=n(89682),aJ=n(498571),iJ=n(882101),sJ=n(562859)
function handleClickCreateDashboard(){(0,Xn.Z)(sJ.Z,{})}function CreateDashboardButton({className:e}){return d.createElement(P.ZP,{title:"Create dashboard",placement:P.TQ.BOTTOM},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:e,icon:"compose",onClick:handleClickCreateDashboard,size:C.qE.SMALL,dataTestAttrs:{component:"CreateAnalyticsDashboardButton",element:"button"}}))}function CreateDashboardOrAnalysisDropdown({className:e}){const t=d.createElement(w.ZP,{dropLeft:!0,width:w.ZP.WIDTHS.MEDIUM,height:w.ZP.HEIGHTS.MEDIUM},d.createElement(N.Z,{icon:"analytics_dashboard",onSelect:handleClickCreateDashboard},"Dashboard"),d.createElement(N.Z,{icon:"analysis",onSelect:()=>{(0,Xn.Z)(aJ.default,{})}},"Analysis"))
return d.createElement(I.ZP,{menu:t},d.createElement("span",null,d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:e,icon:"compose",size:C.qE.SMALL})))}function CreateAnalyticsDashboardButton(e){return(0,iJ.Z)()?d.createElement(CreateDashboardOrAnalysisDropdown,{className:e.className}):d.createElement(CreateDashboardButton,{className:e.className})}var rJ=n(467412),oJ=n(232125)
function ListingCrumbs(e){return e.activeSavedSearch?d.createElement(Cw.bJ,{crumbs:[d.createElement(Cw.Ak,{key:"insights",text:nJ.c,onClick:()=>{e.onSearch(RN._j(e.searchParams,[],(0,rJ.t)().filters))
e.onSelectSavedSearch(void 0)}}),d.createElement(Cw.Ak,{key:"root",text:e.activeSavedSearch.name})],settingsIcon:e.settingsComponents}):d.createElement(Cw.bJ,{crumbs:[d.createElement("span",{key:"root"},nJ.c)],settingsIcon:e.settingsComponents})}const lJ=(0,UP.ZP)((function AnalyticsSidepanelListing(e){(0,Ul.Z)((()=>{(0,m.KK)(j.JG.OPENED_INSIGHTS_MODULE)}))
return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,actionSource:j.D2.INSIGHTS_SIDEPANEL,savedSearchSection:Sn.yd.ANALYTICS,additionalHeaderButtons:(0,ln.cr)({feature:on.sZ.INSIGHTS_CREATE})?d.createElement(CreateAnalyticsDashboardButton,{className:"u-mini-spacing-left"}):null,availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],availableTypes:(0,oJ.Z)()?[st.ANALYTICS_DASHBOARD,st.ANALYSIS]:[st.ANALYTICS_DASHBOARD],makeCrumbs:t=>d.createElement(ListingCrumbs,{activeSavedSearch:e.activeSavedSearch,onSelectSavedSearch:e.onSelectSavedSearch,onSearch:e.onSearch,searchParams:e.searchParams,settingsComponents:t}),extraPrimaryFilterOptions:[{filterKey:Kn.Vm.ANCESTOR_FOLDER,extraProps:{onlyProjects:!0}}],preservedFilterKeys:[],section:ZP.$0.ANALYTICS,dataTestAttrs:{component:"AnalyticsSidepanelListing",element:"root"}}))}),Kn.Sc.ANALYSES_AND_ANALYTICS_DASHBOARDS,ZP.SA.ANALYTICS,{defaultSearchParams:(0,rJ.t)(),getNavigationUpdate:function getAnalyticsSearchURL(e,t){return t.isExpanded?{url:(0,eJ.q7)("/analytics",t.searchParams,t.filterErrors),options:{replace:e.isExpanded===t.isExpanded}}:null},filterKeysToRemember:[Kn.Vm.TYPES]})
var cJ=n(923058)
function Carousel(e){const[t,n]=(0,d.useState)(0),[a,i]=(0,d.useState)(!1),s=e.items.length-1,r=e.imageWidth+8
return d.createElement("div",{onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},className:(0,g.iv)(dJ.container),style:{height:e.imageHeight+48,width:r}},a&&d.createElement(pe.Z,{icon:"chevron-left",className:(0,g.iv)(dJ.navArrows),style:{left:10},onClick:()=>{n((e=>0===e?s:e-1))}}),d.createElement("ol",{className:(0,g.iv)(dJ.slides)},e.items.map(((n,a)=>d.createElement("li",{className:(0,g.iv)(dJ.slide),key:a,style:{left:(a-t)*r,width:r}},d.createElement("span",{className:(0,g.iv)(dJ.description)},n.description),d.createElement("img",{className:(0,g.iv)(dJ.image),width:e.imageWidth,height:e.imageHeight,src:(0,me.Z)(n.imageSrc)}))))),a&&d.createElement(pe.Z,{icon:"chevron-right",className:(0,g.iv)(dJ.navArrows),style:{right:10},onClick:()=>{n((e=>e===s?0:e+1))}}),d.createElement("div",{className:"u-flex-display"},e.items.map(((e,a)=>d.createElement("div",{key:a,className:(0,g.iv)(dJ.dot,a===t&&dJ.activeDot),onClick:()=>{n(a)}})))))}const dJ=g.mM.create({container:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative"},slides:{position:"relative",display:"flex",overflow:"hidden",listStyle:"none",width:"100%",height:"100%"},slide:{position:"absolute",transition:"left 0.5s"},navArrows:{position:"absolute",zIndex:5,color:"white",backgroundColor:"black",opacity:.7,borderRadius:"10px",cursor:"pointer"},image:{boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)",margin:"4px"},dot:{width:"7px",height:"7px",backgroundColor:Vt.pp,borderRadius:"5px",margin:"2px",cursor:"pointer"},activeDot:{backgroundColor:Vt.t0},description:{..._n.XI,color:Vt.pp,paddingLeft:"5px",letterSpacing:"-.01em"}}),uJ={[st.SEQUENCE]:[{icon:"alignment",title:"Create an alignment",carouselItems:[{description:"Create alignments with both DNA and AA sequences.",imageSrc:"/static/img/shared_file_messaging/DNA-1-A.png"},{description:"Bulk-align multiple sequences at once.",imageSrc:"/static/img/shared_file_messaging/DNA-1-B.png"},{description:"Powerful visualization tool to inspect alignments in detail.",imageSrc:"/static/img/shared_file_messaging/DNA-1-C.png"}]},{icon:"sequence_primer",title:"Design a primer",carouselItems:[{description:"Create primers manually, or using a wizard.",imageSrc:"/static/img/shared_file_messaging/DNA-2-A.png"},{description:"Attach primers to a DNA sequence of interest.",imageSrc:"/static/img/shared_file_messaging/DNA-2-B.png"},{description:"Review and fine-tune primer properties.",imageSrc:"/static/img/shared_file_messaging/DNA-2-C.png"}]},{icon:"protein-alternative",title:"Create a translation",carouselItems:[{description:"Create and visualize AA sequences.",imageSrc:"/static/img/shared_file_messaging/DNA-3-A.png"},{description:"Attach translations to a DNA sequence of interest.",imageSrc:"/static/img/shared_file_messaging/DNA-3-B.png"},{description:"Annotate translations using custom labels and colors.",imageSrc:"/static/img/shared_file_messaging/DNA-3-C.png"}]},{icon:"crispr",title:"Design a CRISPR guide",carouselItems:[{description:"Create CRISPR guides for a variety of use cases.",imageSrc:"/static/img/shared_file_messaging/DNA-4-A.png"},{description:"Evaluate guides using off-target and on-target scores.",imageSrc:"/static/img/shared_file_messaging/DNA-4-B.png"},{description:"Find matching genome regions automatically.",imageSrc:"/static/img/shared_file_messaging/DNA-4-C.png"}]},{icon:"assembly-v2",title:"Assemble and transform a sequence",carouselItems:[{description:"Clone sequences using the digest & ligate wizard.",imageSrc:"/static/img/shared_file_messaging/DNA-5-A.png"},{description:"Create Gibson & Golden Gate assemblies.",imageSrc:"/static/img/shared_file_messaging/DNA-5-B.png"},{description:"Visualize and annotate constructs.",imageSrc:"/static/img/shared_file_messaging/DNA-5-C.png"}]}],[st.PROTEIN]:[{icon:"sequence_primer",title:"Explore an AA sequence",carouselItems:[{description:"Automatically calculate common biochemical properties.",imageSrc:"/static/img/shared_file_messaging/AA-1-A.png"},{description:"Preview liability sites for each sequence.",imageSrc:"/static/img/shared_file_messaging/AA-1-B.png"},{description:"Identify complementarity-determining (CDR) regions.",imageSrc:"/static/img/shared_file_messaging/AA-1-C.png"}]},{icon:"alignment",title:"Create an alignment",carouselItems:[{description:"Create alignments with both DNA and AA sequences.",imageSrc:"/static/img/shared_file_messaging/AA-2-A.png"},{description:"Bulk-align multiple sequences at once.",imageSrc:"/static/img/shared_file_messaging/AA-2-B.png"},{description:"Powerful visualization tool to inspect alignments in detail.",imageSrc:"/static/img/shared_file_messaging/AA-2-C.png"}]},{icon:"helix",title:"Create back translations",carouselItems:[{description:"Optimize codons using DNAChisel.",imageSrc:"/static/img/shared_file_messaging/AA-3-A.png"},{description:"Specify cut sites to avoid.",imageSrc:"/static/img/shared_file_messaging/AA-3-B.png"},{description:"Minimize the usage of specified patterns.",imageSrc:"/static/img/shared_file_messaging/AA-3-C.png"}]}],[st.ENTRY]:[{icon:"eln-timestamp",title:"Track every step of your experiment",carouselItems:[{description:"Add new dates for every day your experiment runs.",imageSrc:"/static/img/shared_file_messaging/NB-entry-1-A.png"},{description:"Capture protocols, observations, and tasks.",imageSrc:"/static/img/shared_file_messaging/NB-entry-1-B.png"},{description:"Automatically keep a detailed history of your work.",imageSrc:"/static/img/shared_file_messaging/NB-entry-1-C.png"},{description:"Auto-populate your calendar with Notebook entries.",imageSrc:"/static/img/shared_file_messaging/NB-entry-1-D.png"}]},{icon:"computed-value",title:"Insert tables with calculations",carouselItems:[{description:"Add tables alongside your notes.",imageSrc:"/static/img/shared_file_messaging/NB-entry-2-A.png"},{description:"Use formulas to calculate master mixes.",imageSrc:"/static/img/shared_file_messaging/NB-entry-2-B.png"},{description:"Capture results from your experiments.",imageSrc:"/static/img/shared_file_messaging/NB-entry-2-C.png"}]},{icon:"at-mention",title:"Link sequences directly in your entry",carouselItems:[{description:"@mention sequences relevant to your experiments.",imageSrc:"/static/img/shared_file_messaging/NB-entry-3-A.png"},{description:"Visualize sequences alongside your notes.",imageSrc:"/static/img/shared_file_messaging/NB-entry-3-B.png"},{description:"Go to Molecular Biology to design & analyze sequences.",imageSrc:"/static/img/shared_file_messaging/NB-entry-3-C.png"}]},{icon:"attachment",title:"Attach images and results",carouselItems:[{description:"Upload experimental results to Benchling.",imageSrc:"/static/img/shared_file_messaging/NB-entry-4-A.png"},{description:"Attach and preview other file types.",imageSrc:"/static/img/shared_file_messaging/NB-entry-4-B.png"},{description:"Link your cloud storage platforms to Benchling.",imageSrc:"/static/img/shared_file_messaging/NB-entry-4-C.png"}]},{icon:"share-v2",title:"Share data with your collaborators",carouselItems:[{description:"Create projects, and share them with your lab.",imageSrc:"/static/img/shared_file_messaging/NB-entry-5-A.png"},{description:"Share entries with individual collaborators.",imageSrc:"/static/img/shared_file_messaging/NB-entry-5-B.png"},{description:"@mention collaborators in your Notebook entries.",imageSrc:"/static/img/shared_file_messaging/NB-entry-5-C.png"}]}],[st.PROTOCOL]:[{icon:"note",title:"Capture context, materials, and steps",carouselItems:[{description:"Document a list of materials.",imageSrc:"/static/img/shared_file_messaging/Protocol-1-A.png"},{description:"Add individual steps in the protocol.",imageSrc:"/static/img/shared_file_messaging/Protocol-1-B.png"},{description:"Add timers directly within your protocol.",imageSrc:"/static/img/shared_file_messaging/Protocol-1-C.png"}]},{icon:"folder-open",title:"Create protocol repositories for your lab",carouselItems:[{description:"Create projects to house protocols for your lab.",imageSrc:"/static/img/shared_file_messaging/Protocol-2-A.png"},{description:"Share and collaborate on protocols with your lab.",imageSrc:"/static/img/shared_file_messaging/Protocol-2-B.png"},{description:"Share protocols with individual collaborators.",imageSrc:"/static/img/shared_file_messaging/Protocol-2-C.png"}]},{icon:"computed-value",title:"Insert tables with calculations",carouselItems:[{description:"Add tables alongside your notes.",imageSrc:"/static/img/shared_file_messaging/Protocol-3-A.png"},{description:"Set up and follow along with recipes.",imageSrc:"/static/img/shared_file_messaging/Protocol-3-B.png"},{description:"Perform calculations within and across tables.",imageSrc:"/static/img/shared_file_messaging/Protocol-3-C.png"}]},{icon:"attachment",title:"Attach protocols to Notebook entries",carouselItems:[{description:"Link protocols to relevant experiments.",imageSrc:"/static/img/shared_file_messaging/Protocol-4-A.png"},{description:"Search all of your protocols at once.",imageSrc:"/static/img/shared_file_messaging/Protocol-4-B.png"},{description:"Follow along with protocols and entries side-by-side.",imageSrc:"/static/img/shared_file_messaging/Protocol-4-C.png"}]}],[st.BASIC_FOLDER_ITEM]:[{icon:"note",title:"Take notes on your experiments",carouselItems:[{description:"Capture protocols, observations, and tasks.",imageSrc:"/static/img/shared_file_messaging/Custom-1-A.png"},{description:"Add new dates for every day your experiment runs.",imageSrc:"/static/img/shared_file_messaging/Custom-1-B.png"},{description:"Capture results from your experiments.",imageSrc:"/static/img/shared_file_messaging/Custom-1-C.png"}]},{icon:rr.m.Sequence,title:"Design and analyze sequences",carouselItems:[{description:"Create and visualize DNA sequences.",imageSrc:"/static/img/shared_file_messaging/Custom-2-A.png"},{description:"Attach primers to a DNA sequence of interest.",imageSrc:"/static/img/shared_file_messaging/Custom-2-B.png"},{description:"Create and visualize AA sequences.",imageSrc:"/static/img/shared_file_messaging/Custom-2-C.png"},{description:"Create alignments with both DNA and AA sequences.",imageSrc:"/static/img/shared_file_messaging/Custom-2-D.png"}]},{icon:"folder-open",title:"Organize your work",carouselItems:[{description:"Create projects and share them for your lab.",imageSrc:"/static/img/shared_file_messaging/Custom-3-A.png"},{description:"Organize your data into folders.",imageSrc:"/static/img/shared_file_messaging/Custom-3-B.png"},{description:"Search across all your sequences and experiments.",imageSrc:"/static/img/shared_file_messaging/Custom-3-C.png"}]},{icon:"attachment",title:"Track all your data",carouselItems:[{description:"Automatically keep a detailed version history of your work.",imageSrc:"/static/img/shared_file_messaging/Custom-4-A.png"},{description:"Control permissions for viewing and editing.",imageSrc:"/static/img/shared_file_messaging/Custom-4-B.png"}]}]}
function CollapsibleSection(e){return d.createElement("div",{className:(0,g.iv)(pJ.sectionContainer)},d.createElement("div",{className:(0,g.iv)(pJ.itemTitleBlock),onClick:e.onClick},d.createElement(pe.Z,{icon:e.icon}),d.createElement("h4",{className:(0,g.iv)(pJ.sectionTitle)},e.title),d.createElement(pe.Z,{icon:e.isExpanded?"chevron-down":"chevron-right"})),e.isExpanded&&e.children)}const mJ=jA.Z.connect(((e,t)=>({entityTypeFromWorkspace:e.getState().activeFileType})))((function EntityDescription({entityTypeFromApiId:e,entityTypeFromWorkspace:t}){const n=null!=t?t:e
switch(n){case st.SEQUENCE:return d.createElement("p",{className:(0,g.iv)(pJ.panelDescription)},"You're looking at a ",d.createElement(pe.Z,{icon:"helix"})," DNA Sequence. Here are some things you can do with it:")
case st.OLIGO:return d.createElement("p",{className:(0,g.iv)(pJ.panelDescription)},"You're looking at an ",d.createElement(pe.Z,{icon:rr.m.OligoV2})," Oligo. Oligos can be created in Benchling Molecular Biology. Here are some things you can do with our toolset:")
case st.PROTEIN:return d.createElement("p",{className:(0,g.iv)(pJ.panelDescription)},"You're looking at an ",d.createElement(pe.Z,{icon:"protein"})," AA Sequence. Here are some things you can do with it:")
case st.ENTRY:return d.createElement("p",{className:(0,g.iv)(pJ.panelDescription)},"You're looking at a ",d.createElement(pe.Z,{icon:rr.m.Entry})," Notebook entry. Here are some things you can do with it:")
case st.PROTOCOL:return d.createElement("p",{className:(0,g.iv)(pJ.panelDescription)},"You're looking at a ",d.createElement(pe.Z,{icon:"protocol"})," Protocol. Here are some things you can do with it:")
case st.BASIC_FOLDER_ITEM:return d.createElement("p",{className:(0,g.iv)(pJ.panelDescription)},"You're looking at a ",d.createElement(pe.Z,{icon:"asterisk"})," Custom entity. Here are some things you can do with Benchling:")
default:(0,S.Gp)(!n,`Unexpected entity type for SharedFileSidepanel: ${n}`)
return null}}))
function SharedFileSidepanel(){const[e,t]=(0,d.useState)(""),[n,a]=(0,d.useState)(0),i=ea.ZP.apiIdToType(window.bootstrap.sharedFolderItemAPIId)
return d.createElement("div",{className:f()((0,g.iv)(pJ.panel),"sidepanel")},d.createElement("h3",null,"Welcome to Benchling!"),d.createElement(mJ,{entityTypeFromApiId:i}),uJ[i].map(((e,t)=>d.createElement(CollapsibleSection,{key:e.title,title:e.title,icon:e.icon,isExpanded:n===t,onClick:()=>{a(n===t?null:t)}},d.createElement("div",{className:(0,g.iv)(pJ.carouselContainer)},d.createElement(Carousel,{items:e.carouselItems,imageWidth:300,imageHeight:115}))))),d.createElement("div",{className:(0,g.iv)(pJ.signupSection)},d.createElement("h4",null,"Create account"),d.createElement("div",{className:"u-flex-display u-small-spacing-bottom"},d.createElement("input",{className:(0,g.iv)(pJ.emailInput),type:"email",placeholder:"Enter your email",value:e,onChange:e=>{t(e.target.value)}}),d.createElement(C.Co,{className:(0,g.iv)(pJ.emailSubmitButton),size:C.qE.SMALL,buttonStyle:C.ZJ.SECONDARY,onClick:()=>{m.j("benchling","initiated_signup",{email:e,signup_source:"signed out view",source_component:"SharedSequenceSidepanel"})
window.location.href=(0,de.Dv)("/signup",{next:(0,de.YW)(),email:(0,cJ.Z)(e)?e:""})}},"Get started")),d.createElement("div",{className:"u-lr-split"},d.createElement("a",{href:(0,de.Dv)("/ext/google-oauth/begin",{next:(0,de.YW)()})},"Sign up with Google"),d.createElement("a",{href:(0,de.Dv)("/signin",{next:(0,de.YW)()})},"I already have an account"))))}const pJ=g.mM.create({panel:{display:"flex",flexDirection:"column",background:Vt.bs,left:0,padding:"0 20px"},panelDescription:{..._n.H5,color:Vt.pp},itemTitleBlock:{display:"flex",alignItems:"center",justifyContent:"space-between",color:Vt.t0,..._n.H5,cursor:"pointer"},sectionContainer:{margin:"15px 0"},sectionTitle:{marginRight:"auto",marginLeft:"5px"},signupSection:{marginTop:"auto",marginBottom:"30px"},emailInput:{height:"40px",padding:"10px 16px",borderRadius:"4px 0 0 4px",fontSize:"16px",lineHeight:1.5},emailSubmitButton:{width:"140px",height:"40px",borderRadius:"0 4px 4px 0",fontSize:"15px"},carouselContainer:{marginLeft:"15px"}})
var hJ=n(785718),gJ=n(57985),EJ=n(727311),fJ=n(318311),SJ=n(648913),yJ=n(959194)
function areSelectedTypesExactly(e,t){return e.length===t.length&&e.every((e=>t.includes(e)))}function areSelectedTypesSubset(e,t){return e.every((e=>t.includes(e)))}var bJ=n(410968),TJ=n(271112),vJ=n(204940)
function NewProcessDropdown(e){return d.createElement(vJ.Z,{schemas:e.processTaskSchemas,onSelect:e=>{const t=(0,m.Vr)()
m.gx(j.U9.OPENED_MODAL,j.XC.WORKFLOWS,{event_group_id:t,action_origin:j.D2.WORKFLOWS_SIDEPANEL_CREATE,default_task_creation_view:TJ.PL[(0,bJ.H$)(e.id)[0]],modal_type:$M.Wk});(0,Xn.Z)(TJ.ZP,{processTaskSchemaId:e.id,processTaskSchemaName:e.name,initialFolderId:null,taskGroupInstructions:null,sourceType:"dashboard",analyticsEventGroupId:t})}})}var CJ=n(303165)
const IJ={filterKey:Kn.Vm.ANY_LINK_SCHEMA_FIELD},wJ=[{filterKey:Kn.Vm.NAMES},{filterKey:Kn.Vm.CREATED_AT},{filterKey:Kn.Vm.MODIFIED_AT},{filterKey:Kn.Vm.CREATOR},{filterKey:Kn.Vm.ARCHIVE_PURPOSES,extraProps:{archivePurposes:(0,$u.FH)(Wu.$.NOTEBOOK)}}],NJ=[{filterKey:Kn.Vm.PROCESS_STATUS},{filterKey:Kn.Vm.PROCESS_WATCHER},{filterKey:Kn.Vm.PROCESS_EXECUTION_TYPE}],AJ=[...NJ,{filterKey:Kn.Vm.PROCESS_RESPONSIBLE_TEAM}],RJ=[{filterKey:Kn.Vm.PROCESS},{filterKey:Kn.Vm.PROCESS_TASK_STATUS},{filterKey:Kn.Vm.PROCESS_TASK_ASSIGNEE},{filterKey:Kn.Vm.PROCESS_TASK_EXECUTION_ORIGIN_ENTRY},{filterKey:Kn.Vm.PROCESS_TASK_SCHEDULED_ON_DATE},{filterKey:Kn.Vm.PROCESS_TASK_RESPONSIBLE_PARTIES}],PJ=[{filterKey:Kn.Vm.CREATION_ORIGIN_ENTRY},{filterKey:Kn.Vm.PROCESS_TASK}],OJ=[{filterKey:Kn.Vm.ROOT_PROCESS},{filterKey:Kn.Vm.ROOT_PROCESS_TASK_SCHEMA,extraProps:{schemaExecutionTypes:[Sn.Pf.FLOWCHART]}},{filterKey:Kn.Vm.ROOT_PROCESS_CREATOR},{filterKey:Kn.Vm.ROOT_PROCESS_WATCHER},{filterKey:Kn.Vm.PROCESS_TASK_HAS_FAILED_MAPPINGS}]
function getAvailablePrimaryFilters(e,t){switch(e){case Sn.Lt.PROCESSES:return t.map((e=>(0,CJ.eO)(e))).flat().includes(Kn.Vm.ANCESTOR_FOLDER)?[{filterKey:Kn.Vm.ANCESTOR_FOLDER}]:[]
case Sn.Lt.RECIPES:return[]
default:(0,S.hu)(!1,`Unexpected value for client origin '${(0,Go.vE)(e)}'`)
return[]}}function getAvailableSecondaryFilters(e){switch(e){case Sn.Lt.PROCESSES:return function getSecondaryFiltersForProcesses(){return e=>[{name:"General",filterOptions:(0,Jt.oA)([...wJ,IJ,null!=e?{filterKey:Kn.Vm.SCHEMA_FIELD,extraProps:{schemaFields:e.fields}}:null])},{name:"Workflow task group",filterOptions:dt.ZP.WORKFLOWS_ENABLE_COLLABORATORS?NJ:AJ},{name:"Workflow task",filterOptions:RJ},{name:"Workflow output",filterOptions:PJ},{name:"Flowchart",filterOptions:OJ}]}()
case Sn.Lt.RECIPES:return function getSecondaryFiltersForRecipes(){return e=>[{name:"General",filterOptions:wJ},{name:"Bioprocessing task",filterOptions:[{filterKey:Kn.Vm.PROCESS_TASK_STATUS},{filterKey:Kn.Vm.PROCESS_TASK_ASSIGNEE},{filterKey:Kn.Vm.PROCESS_TASK_SCHEDULED_ON_DATE}]},{name:"Unit operation",filterOptions:[{filterKey:Kn.Vm.PROCEDURE_RUN_TASKS}]}]}()
default:(0,S.hu)(!1,`Unexpected value for client origin '${(0,Go.vE)(e)}'`)
return()=>[]}}var xJ=n(521222),_J=n(176065),DJ=n(671513),LJ=n(254680),kJ=n(579324),MJ=n(756881),FJ=n(27208),ZJ=n(821186)
function propagateTypedValueToTableColumn(e,t,n,a){return(0,tm.Uy)(a,(i=>{const s=(0,tm.Uy)(a.rows[t],(t=>{t.cells[n]={text:"",typedValue:e}}))
i.rows=[s]}))}function getStructuredTable(e,t,n){return ea.ZP.isProcessTaskSchema(e.id)?(0,ZJ.S)({name:e.name,numRows:t,taskSchema:{...e,statusLifecycle:null},tableLocation:aM.$o.FIELD_MAPPING_MODAL,locked:!1,selectorsById:n}):(0,AM._i)({numRows:t,outputSchema:e,metadata:{tableLocation:aM.$o.FIELD_MAPPING_MODAL},selectorsById:n})}function FixFailedMappingSelectErrorsPane(e){(0,S.hu)(e.failedRecords.every((e=>e.status===Sn._2.FAILED)),"Expected all records to have a FAILED status")
const t={}
for(const n of e.failedRecords){const e=n.asyncData.schemaMapper.id
null==t[e]&&(t[e]=n)}return d.createElement("div",{className:(0,g.iv)(BJ.description)},"Fix the following error(s) so the next task in the workflow can be created.",d.createElement("div",{className:(0,g.iv)(BJ.banners),...(0,ee.Z)({component:"FixFailedMappingSelectErrorsPane",element:"root"})},d.createElement(pd.Z,{messages:Object.keys(t).map((n=>{var a
const i=t[n],s=i.asyncData.schemaMapper.toSchema
return{text:`${(0,kN.Eh)(s)?"":`Mapping to ${s.name}: `}${null!==(a=i.details)&&void 0!==a?a:"Mapping has failed unexpectedly"}`,bannerType:io.ct.ERROR,action:{actionText:"Fix error",actionType:io.J7.CUSTOM,actionOnClick:()=>{e.onClickSelectedError(i)}}}}))})))}const BJ=g.mM.create({description:{marginTop:"24px",marginRight:"6px"},banners:{marginTop:"16px",marginRight:"16px"}})
function FixFailedMappingTableReviewPane(e){return d.createElement("div",{className:(0,g.iv)(qJ.description)},e.description,d.createElement("div",{className:(0,g.iv)(qJ.table)},d.createElement(UO.Z,{onComputedTableChanged:e.setComputedTable,structuredTable:e.table,cid:e.table.cid,updateHandler:e.setTable,hasPrimarySamples:!1})))}const qJ=g.mM.create({description:{marginTop:"24px",marginRight:"6px"},table:{marginTop:"12px",marginRight:"16px"}})
var VJ=n(183990)
const UJ=xa.Ps`
  query FixFailedMappingModalQuery($processTaskIds: [StrictString!]!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    processTasks(ids: $processTaskIds) {
      ... on ProcessTaskNode {
        id
        rootTask {
          id
          process {
            id
          }
        }
        process {
          id
        }
        taskSchema {
          ... on ProcessTaskSchemaNode {
            id
            statusLifecycle {
              id
              schemaExecutionType
            }
          }
          ...InaccessibleInfoGraphQL
        }
        processAsyncRecords {
          id
          status
          details
          asyncData {
            ... on ProcessFlowchartSchemaMappingRecordNode {
              id
              schemaMapper {
                id
                toNodeConfig {
                  id
                }
                toSchema {
                  ... on ProcessTaskSchemaNode {
                    id
                    name
                  }
                  ... on ProcessOutputSchemaNode {
                    id
                    name
                  }
                  ...InaccessibleInfoGraphQL
                }
              }
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
var GJ
!function(e){e.SELECT_ERRORS="SELECT_ERRORS"
e.TABLE_REVIEW="TABLE_REVIEW"}(GJ||(GJ={}))
const zJ=[{key:GJ.SELECT_ERRORS,title:"Select mapping error(s)"},{key:GJ.TABLE_REVIEW,title:"Review"}],$J={[GJ.SELECT_ERRORS]:Fx.cV.UNVISITED,[GJ.TABLE_REVIEW]:Fx.cV.UNVISITED}
function FixFailedMappingModal(e){const[t,n]=(0,d.useState)(0),[a,i]=(0,d.useState)(),[s,r]=(0,d.useState)(),[o,l]=(0,d.useState)([[]]),[c,u]=(0,d.useState)(),p=zJ[t].key,onSubmit=async()=>{var t,n
try{await async function submitTable({sourceItem:e,table:t,computedTable:n,nodeConfigId:a,schemaMapperId:i}){var s,r,o,l
if(t.kind===Tb.sl.PROCESS_TASK){const s=(0,IM.Z)({table:t,evaluatedTable:n,sourceType:"continue_flowchart_dashboard"}).map((t=>({...t,nodeConfigId:a,fromItemId:e.id,schemaMapperId:i}))),r=await(0,uA.ML)(s)
de.c4(null,(0,FJ.RY)(r.tasks.map((e=>e.humanId))))}else if(t.kind===Tb.sl.PROCESS_OUTPUT){const a=(0,bM.n4)({table:t,evaluatedTable:n,creationOriginIds:[null!==(r=null===(s=e.rootTask)||void 0===s?void 0:s.process.id)&&void 0!==r?r:e.process.id],sourceType:"continue_flowchart_dashboard",debugInfo:{sourceItemIds:[e.id]},taskIds:[null!==(l=null===(o=e.rootTask)||void 0===o?void 0:o.id)&&void 0!==l?l:e.id],fromItemIds:[e.id],schemaMapperId:i}),c=await(0,uA.yf)(a)
de.c4(null,(0,FJ.vI)(c.processOutputs.map((e=>e.humanId))))}}({sourceItem:e.selectedItems[0],table:c,computedTable:o,nodeConfigId:null!==(n=null===(t=a.asyncData.schemaMapper.toNodeConfig)||void 0===t?void 0:t.id)&&void 0!==n?n:null,schemaMapperId:a.asyncData.schemaMapper.id})
!function trackAnalytics(e){var t,n
for(const a of e){const e=a.rootTask;(0,S.hu)(!(0,ka.CZ)(a.taskSchema),"Inaccessible task schema in FFM analytics")
m.L9(j.Zm.CORRECTED_FAILED_AUTOMATED_MAPPING,{output_api_id:null,task_api_id:a.id,task_group_api_id:a.process.id,flowchart_task_api_id:null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null,flowchart_task_group_api_id:null!==(n=null==e?void 0:e.process.id)&&void 0!==n?n:null,task_schema_type:a.taskSchema.statusLifecycle.schemaExecutionType})}}(e.selectedItems)
e.onRequestClose()}catch(e){v.ZP.notifyError(e)}}
return d.createElement(jF._,{title:"Fix failed mapping errors",onRequestClose:e.onRequestClose,buttons:(()=>{switch(p){case GJ.SELECT_ERRORS:return[]
case GJ.TABLE_REVIEW:return[{key:"back",text:"Back",dataTestAttrs:{component:"FixFailedMappingModal",element:"backButton",key:vb.Z.BACK},onClick:()=>{n(t-1)}},{key:"submit",text:"Submit",dataTestAttrs:{component:"FixFailedMappingModal",element:"submitButton",key:vb.Z.SUBMIT},style:C.ZJ.PRIMARY,onClick:onSubmit,disabled:(0,gM.Z)(o)}]
default:(0,S.hu)(!1,`Unexpected type ${(0,Go.vE)(p)}`)
return[]}})(),expandHeight:!0,large:!0,modalKey:"fixFailedMapping",rememberExpandedSetting:!0},d.createElement(Fx.ZP,{steps:zJ,statusByStep:$J,currentStepKey:zJ[t].key,onUpdateCurrentStep:()=>{},variant:Fx.zK.FLAT}),(()=>{var o,m
if(e.isLoading)return d.createElement(kl.b,null)
const h=e.selectedItems[0]
switch(p){case GJ.SELECT_ERRORS:return d.createElement(FixFailedMappingSelectErrorsPane,{failedRecords:h.processAsyncRecords.filter((e=>e.status===Sn._2.FAILED&&(0,VJ.l)(e))),onClickSelectedError:async a=>{try{i(a)
const s=await uA.LD({automatedMappingInputs:[{taskId:h.id,mapperId:a.asyncData.schemaMapper.id}]});(0,S.hu)(1===s.results.length,"Expected exactly one automated mapping result")
r(s.results[0].toSchema)
u(function buildTableForAutomatedMappingResult(e,t,n){let a=getStructuredTable(e,1,n)
for(const{schemaField:e,value:n}of t){const t=a.columns.findIndex((t=>t.schemaFieldApiId===e.apiId));(0,S.hu)(t>=0,`Expected table to have ${e.apiId}`)
a=propagateTypedValueToTableColumn(n,0,t,a)}return a}(s.results[0].toSchema,s.results[0].fields,e.selectorsById))
n(t+1)}catch(e){v.ZP.notifyError(e)}}})
case GJ.TABLE_REVIEW:(0,S.hu)(null!=s,"Expected mapping result to return the next schema")
return d.createElement(FixFailedMappingTableReviewPane,{description:null!==(o=null==a?void 0:a.details)&&void 0!==o?o:"Mapping failed unexpectedly. Create the next "+(ea.ZP.isProcessTaskSchema(null!==(m=s.id)&&void 0!==m?m:"")?"task":"output"),table:c,setTable:u,setComputedTable:l})
default:(0,S.hu)(!1,`Unexpected type ${(0,Go.vE)(p)}`)
return null}})())}function QueryingFixFailedMappingModal(e){(0,S.hu)(1===e.selectedIds.length&&ea.ZP.isProcessTask(e.selectedIds[0]),"Unable to run FFM on multiple items")
const t=(0,Da.IJ)(bb.Xk,{variables:{includeArchived:!0}}),n=(0,Da.IJ)(UJ,{variables:{processTaskIds:e.selectedIds}}),a=(0,zo.NA)("SchemaFieldSelector",t.type===Da.NI.SUCCESS?t.data.schemaFieldSelectors:[]),i=(0,bb.OU)(a),s=n.type!==Da.NI.SUCCESS?[]:function getInaccessibleItems(e){const t=[]
for(const n of e.processTasks)if((0,ka.CZ)(n))t.push(n)
else{(0,ka.CZ)(n.taskSchema)&&t.push(n.taskSchema)
for(const e of n.processAsyncRecords){(0,S.hu)((0,VJ.l)(e),"Expected errors to be legacy schema mapping records")
const n=e.asyncData.schemaMapper.toSchema;(0,ka.CZ)(n)&&t.push(n)}}return t}(n.data)
if(s.length>0)return d.createElement(Ll.Z,{inaccessibleInfo:s[0],modelType:st.PROCESS_TASK})
return t.type!==Da.NI.SUCCESS||n.type!==Da.NI.SUCCESS?d.createElement(FixFailedMappingModal,{isLoading:!0,selectorsById:null,selectedItems:null,onRequestClose:e.onRequestClose}):d.createElement(FixFailedMappingModal,{isLoading:!1,selectorsById:i,selectedItems:n.data.processTasks,onRequestClose:e.onRequestClose})}function isAsyncDataExecuteSchemaMapper(e){return null!=e.schemaMapper}function isAsyncDataStartAutomatedMapping(e){return!isAsyncDataExecuteSchemaMapper(e)}function isAsyncRecordRoutingRecord(e){return isAsyncDataStartAutomatedMapping(e.asyncData)}var WJ=n(317255)
function PerformManualMappingSection(e){const t=e.mappingData.some((({computedTable:e})=>(0,gM.Z)(e)))?HJ.accordionSectionIncomplete:HJ.accordionSectionCompleted
return d.createElement(WJ.Z,{isOpenByDefault:e.isOpenByDefault,dataTestAttrs:{component:"PerformManualMappingSection",element:"root",key:e.fromItemId},header:d.createElement(d.Fragment,null,d.createElement("span",{className:(0,g.iv)(HJ.accordionHeaderName)},d.createElement("strong",null,e.fromItemName)),d.createElement(pe.Z,{icon:"done",className:(0,g.iv)(t)}))},d.createElement(d.Fragment,null,0===e.mappingData.length?d.createElement(io.ZP,{bannerType:io.ct.INFO,text:"There is nothing to review for this task/output because only end nodes were selected as the next step."}):e.mappingData.map((({structuredTable:t,mapper:n},a)=>d.createElement(UO.Z,{key:`manual-mapping-${e.fromItemId}-${n.id}`,cid:`manual-mapping-${e.fromItemId}-${n.id}`,structuredTable:t,updateHandler:t=>{e.onChangeMappingData((0,tm.ZP)(e.mappingData,(e=>{e[a].structuredTable=t})))},onComputedTableChanged:t=>{e.onChangeMappingData((0,tm.ZP)(e.mappingData,(e=>{e[a].computedTable=t})))},hasPrimarySamples:!1,hideFormulaBox:!0})))))}function PerformManualMappingPane(e){if(null==e.fromItemIdsToTables)return d.createElement(kl.b,null)
const t=(0,Jt.Pe)(e.fromItems,(({id:e})=>e))
return d.createElement("div",{...(0,ee.Z)({component:"PerformManualMappingPane",element:"root"})},Object.keys(e.fromItemIdsToTables).sort(((e,n)=>t[e].humanId.localeCompare(t[n].humanId))).map(((n,a)=>d.createElement(PerformManualMappingSection,{key:n,isOpenByDefault:0===a,fromItemId:n,fromItemName:t[n].humanId,mappingData:e.fromItemIdsToTables[n],onChangeMappingData:t=>{e.onChangeFromItemIdsToTables((0,tm.ZP)(e.fromItemIdsToTables,(e=>{e[n]=t})))}}))))}const HJ=g.mM.create({accordionSectionCompleted:{color:Vt.t0},accordionSectionIncomplete:{color:Vt.pF},accordionHeaderName:{marginLeft:"8px",marginRight:"8px"}})
var jJ,YJ=n(289670),QJ=n(135099),KJ=n(709348),JJ=n(379112),XJ=n(921531)
!function(e){e.DEFAULT_EXPRESSION="DEFAULT_EXPRESSION"
e.NO_BLOCKING_ROUTERS="NO_BLOCKING_ROUTERS"
e.INACCESSIBLE="INACCESSIBLE"}(jJ||(jJ={}))
const eX={[jJ.DEFAULT_EXPRESSION]:"Otherwise",[jJ.NO_BLOCKING_ROUTERS]:"Always",[jJ.INACCESSIBLE]:"No access"}
function NonFunctionExpressionDisplay(e){var t
switch(e.expression.type){case nR.p.SCHEMA_LOOKUP:return d.createElement(XJ.bF,{baseSchema:e.baseSchemaForLookup,lookupConfig:e.expression.lookupConfig,context:{flowchartTaskSchema:e.flowchartTaskSchema}})
case nR.p.CONTEXT_VARIABLE:return d.createElement(d.Fragment,null,e.expression.contextKey)
case nR.p.CONSTANT_VALUE:{const n=e.expression.itemType
if(n.name===JJ.V6.LIST){(0,S.hu)(Array.isArray(e.expression.value),"Expected the value of a list type constant value to be an array")
return d.createElement(d.Fragment,null,e.expression.value.map(((t,a)=>d.createElement(d.Fragment,{key:a},d.createElement(NonFunctionExpressionDisplay,{baseSchemaForLookup:e.baseSchemaForLookup,expression:{type:nR.p.CONSTANT_VALUE,value:t,itemType:{name:n.ofType,selectorId:n.selectorId}},selectorOptionsById:e.selectorOptionsById,flowchartTaskSchema:e.flowchartTaskSchema})," "))))}if((0,Hd.Y6)(n.name)){if((0,Hd.ho)(n.name))return d.createElement(d.Fragment,null,e.expression.itemType.name===Hd.i0.TEXT?`'${e.expression.value}'`:e.expression.value)
if(n.name===Hd.i0.DROPDOWN_OPTION){const n=null===(t=e.selectorOptionsById[e.expression.value])||void 0===t?void 0:t.name
return null!=n?d.createElement(d.Fragment,null,"'",n,"'"):d.createElement(d.Fragment,null,"No access")}}(0,S.hu)(!1,"Unexpected constant value type",{expression:e.expression})
return null}default:(0,S.hu)(!1,`Unexpected expression ${(0,Go.vE)(e.expression)}`)
return null}}function ExpressionComparisonDisplay(e){(0,S.hu)(2===e.expression.parameters.length,"Expected expression to have exactly two parameters")
const t=e.expression.parameters[0].expression,n=e.expression.parameters[1].expression;(0,S.hu)(t.type!==nR.p.FUNCTION&&n.type!==nR.p.FUNCTION,"Functions cannot be nested",{expression:e.expression})
return d.createElement(d.Fragment,null,d.createElement(NonFunctionExpressionDisplay,{baseSchemaForLookup:e.baseSchemaForLookup,expression:t,selectorOptionsById:e.selectorOptionsById,flowchartTaskSchema:e.flowchartTaskSchema})," ",(0,KJ.Gu)(e.allowedRoutingFunctionsByName[e.expression.name])," ",d.createElement(NonFunctionExpressionDisplay,{baseSchemaForLookup:e.baseSchemaForLookup,expression:n,selectorOptionsById:e.selectorOptionsById,flowchartTaskSchema:e.flowchartTaskSchema}))}function ExpressionDisplay(e){var t,n
const a=e.mapperOrEndNodeAndBlockingExpression,i=function isMapperAndBlockingExpression(e){return e.isSchemaMapper}(a),s=i?a.schemaMapper:a.endNode.id
let r
if(i){const n=a.schemaMapper
r=null==n.fromSchemas[0]||(0,ka.CZ)(n.fromSchemas[0])?null:null!==(t=e.allSchemasById[n.fromSchemas[0].id])&&void 0!==t?t:null}else r=null==a.fromSchemas[0]||(0,ka.CZ)(a.fromSchemas[0])?null:null!==(n=e.allSchemasById[a.fromSchemas[0].id])&&void 0!==n?n:null
const o=i?"process":"do-not-enter"
return d.createElement("div",{className:(0,g.iv)(tX.routingRoute),...(0,ee.Z)({component:"RoutingRoutesDisplay",element:"comparison",key:`${s}`,index:`${e.idx}`})},function isBenchlingExpression(e){return null!=e.type}(e.mapperOrEndNodeAndBlockingExpression.expression)?d.createElement(d.Fragment,null,d.createElement("span",null,"If "),d.createElement(ExpressionComparisonDisplay,{baseSchemaForLookup:r,expression:e.mapperOrEndNodeAndBlockingExpression.expression,selectorOptionsById:e.selectorOptionsById,allowedRoutingFunctionsByName:e.allowedRoutingFunctionsByName,flowchartTaskSchema:e.flowchartTaskSchema}),d.createElement("span",null,", then go to ")):d.createElement("span",null,eX[e.mapperOrEndNodeAndBlockingExpression.expression]," go to "),d.createElement(Za.ZP,{size:Za.TK.TABLE_CELL,text:i?e.mapperIdsToDownstreamSchemaName[a.schemaMapper.id]:a.endNode.name,icon:o}))}function RoutingRoutesDisplay(e){const t=(0,d.useMemo)((()=>(0,Jt.Pe)(Object.values(e.selectorsById).map((e=>e.allSchemaFieldSelectorOptions)).flat(),(({id:e})=>e))),[e.selectorsById]),n=(0,d.useMemo)((()=>(0,tm.ZP)(e.mapperOrEndNodeAndBlockingExpressions,(t=>{t.sort(((t,n)=>t.expression===jJ.DEFAULT_EXPRESSION?1:t.expression===jJ.NO_BLOCKING_ROUTERS||n.expression===jJ.DEFAULT_EXPRESSION?-1:n.expression===jJ.NO_BLOCKING_ROUTERS?1:(t.isSchemaMapper?e.mapperIdsToDownstreamSchemaName[t.schemaMapper.id]:t.endNode.id).localeCompare(n.isSchemaMapper?e.mapperIdsToDownstreamSchemaName[n.schemaMapper.id]:n.endNode.id)))}))),[e.mapperOrEndNodeAndBlockingExpressions,e.mapperIdsToDownstreamSchemaName])
return d.createElement("div",null,n.map(((n,a)=>d.createElement(ExpressionDisplay,{mapperOrEndNodeAndBlockingExpression:n,key:a,idx:a,allSchemasById:e.allSchemasById,mapperIdsToDownstreamSchemaName:e.mapperIdsToDownstreamSchemaName,allowedRoutingFunctionsByName:e.allowedRoutingFunctionsByName,selectorOptionsById:t,flowchartTaskSchema:e.flowchartTaskSchema}))))}const tX=g.mM.create({routingRoute:{display:"flex",alignItems:"center",background:Vt.bs,padding:12,marginBottom:8}})
function getExpressionFunctionOrSpecialType(e){if((0,ka.CZ)(e))return jJ.INACCESSIBLE
if(null==e.expressionJson)return jJ.DEFAULT_EXPRESSION;(0,S.hu)(e.expressionJson.type===nR.p.FUNCTION,"Expected top level expression to be a function")
return e.expressionJson}function RouteItemSection(e){var t
const n=new Set(e.asyncRecord.asyncData.blockedEndNodesAndExpressions.map((({blockedEndNode:e})=>e))),a=[...n].reduce(((e,{id:t,name:n})=>{e[t]=n
return e}),{}),i=0===e.selectedMapperIds.length&&0===e.selectedEndNodeIds.length?"":[...e.selectedMapperIds.map((t=>e.mapperIdsToDownstreamSchemaName[t])),e.selectedEndNodeIds.map((e=>a[e]))].join(", "),s=(0,d.useMemo)((()=>"ProcessTaskNode"===e.item.__typename?function createTableForTask(e,t){return(0,yM.O)({tasks:[{...e,schema:{...(0,ka.i2)(e.taskSchema),statusLifecycle:void 0}}],tableLocation:aM.$o.FIELD_MAPPING_MODAL,locked:!0,selectorsById:t})}(e.item,e.selectorsById):function createTableForOutput(e,t,n){const a=(0,ka.i2)(t.taskSchema);(0,S.hu)(null!=a.outputSchema,"Cannot make output table for task schema without output schema")
return(0,AM.Xk)({processTaskSchema:{...a,outputSchema:a.outputSchema},outputs:[{...e,task:{id:t.id,humanId:t.humanId}}],metadata:{tableLocation:aM.$o.FIELD_MAPPING_MODAL},locked:!0,selectorsById:n})}(e.item,e.task,e.selectorsById)),[e.item,e.task,e.selectorsById])
let r=null
if(null!=e.task.rootTask){const n=e.task.rootTask.taskSchema;(0,ka.CZ)(n)||(r=null!==(t=e.allSchemasById[n.id])&&void 0!==t?t:null)}const o=(0,d.useMemo)((()=>e.asyncRecord.asyncData.blockedMappersAndExpressions.map((({schemaMapper:e,blockingExpressions:t,blockingRouters:n})=>{(0,S.hu)(t.length<=1,"Expected only one expression to block a mapper")
return 0===t.length?{isSchemaMapper:!0,schemaMapper:e,expression:jJ.NO_BLOCKING_ROUTERS,blockingRouters:n}:{isSchemaMapper:!0,schemaMapper:e,expression:null!=r?getExpressionFunctionOrSpecialType(t[0]):jJ.INACCESSIBLE,blockingRouters:n}}))),[e.asyncRecord,r]),l=(0,d.useMemo)((()=>e.asyncRecord.asyncData.blockedEndNodesAndExpressions.map((({blockedEndNode:e,blockingExpression:t,fromSchemas:n})=>({isSchemaMapper:!1,endNode:{id:e.id,name:e.name},expression:null!=r?getExpressionFunctionOrSpecialType(t):jJ.INACCESSIBLE,fromSchemas:n})))),[e.asyncRecord,r]),c=o.map((e=>e.blockingRouters.length>1)).includes(!0),u=[...e.asyncRecord.asyncData.blockedMappersAndExpressions.map((({schemaMapper:t,blockingRouters:n})=>d.createElement(N.Z,{key:t.id,value:t.id,onSelect:t=>{e.onChangeSelectedMapperIds((0,tm.ZP)(e.selectedMapperIds,(e=>{const n=e.findIndex((e=>e===t))
n>=0?e.splice(n,1):e.push(t)})))}},e.mapperIdsToDownstreamSchemaName[t.id]))),[...n].map((t=>d.createElement(N.Z,{key:t.id,value:t.id,onSelect:t=>{e.onChangeSelectedEndNodeIds((0,tm.ZP)(e.selectedEndNodeIds,(e=>{const n=e.findIndex((e=>e===t))
n>=0?e.splice(n,1):e.push(t)})))}},t.name)))]
return d.createElement("div",null,c&&d.createElement("div",{className:(0,g.iv)(nX.containsChainedRoutersInfo)},d.createElement(io.ZP,{bannerType:io.ct.INFO,hideIcon:!0,text:"Review the flowchart to ensure the selected node(s) match the intended path.",supportingInfo:"Selecting the next node(s) may skip over several routers that are in sequence.",action:{actionType:io.J7.CUSTOM,actionText:"View flowchart",actionOnClick:()=>window.open((0,uA.Uv)(e.task.process.id))}})),d.createElement("div",{className:(0,g.iv)(nX.selectNodeDropdownSection)},d.createElement("div",null,d.createElement("strong",null,"Select step(s):")),d.createElement("div",{className:(0,g.iv)(nX.nodeDropdown)},d.createElement($r.ZP,{displayName:i,closeOnInsideClick:!1,menu:d.createElement(w.ZP,{isMulti:!0,value:[...e.selectedMapperIds,...e.selectedEndNodeIds],width:Nr.zL.FULL},u),dataTestAttrs:{component:"RouteItemSection",element:"selectNodesDropdown"}}))),d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(nX.fieldsHeaderText)},"Fields for ",d.createElement(sc.Z,{id:e.item.id,size:Za.TK.SMALL,isLink:!1})),d.createElement(YJ.Z,{cid:`routing-decision-${e.item.id}`,structuredTable:s,updateHandler:()=>{},locked:!0,hasPrimarySamples:!1})),d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(nX.routingRoutesHeader)},d.createElement("span",{className:(0,g.iv)(nX.routingRoutesHeaderText)},"Conditional logic"),d.createElement(Zo.Z,{text:`This logic is applied to the ${ea.ZP.isProcessTaskSchema(e.baseSchema.id)?"task":"output"} fields`},d.createElement(pe.Z,{className:(0,g.iv)(nX.infoIcon),icon:"info-circle"}))),d.createElement(RoutingRoutesDisplay,{mapperOrEndNodeAndBlockingExpressions:[...o,...l],mapperIdsToDownstreamSchemaName:e.mapperIdsToDownstreamSchemaName,selectorsById:e.selectorsById,allSchemasById:e.allSchemasById,allowedRoutingFunctionsByName:QJ.io,flowchartTaskSchema:r})))}function FixRoutingErrorAccordion(e){const t=e.selectedMapperIds.length>0||e.selectedEndNodeIds.length>0?nX.accordionSectionCompleted:nX.accordionSectionIncomplete
return d.createElement(WJ.Z,{isOpenByDefault:e.isOpenByDefault,header:d.createElement(d.Fragment,null,d.createElement("span",{className:(0,g.iv)(nX.accordionHeaderName)},d.createElement("strong",null,e.item.humanId)),d.createElement(pe.Z,{icon:"done",className:(0,g.iv)(t)})),dataTestAttrs:{component:"FixRoutingErrorAccordion",element:"root",key:e.item.id}},d.createElement(RouteItemSection,{item:e.item,task:e.task,selectorsById:e.selectorsById,asyncRecord:e.asyncRecord,selectedMapperIds:e.selectedMapperIds,selectedEndNodeIds:e.selectedEndNodeIds,mapperIdsToDownstreamSchemaName:e.mapperIdsToDownstreamSchemaName,onChangeSelectedMapperIds:e.onChangeSelectedMapperIds,onChangeSelectedEndNodeIds:e.onChangeSelectedEndNodeIds,baseSchema:e.baseSchema,allSchemasById:e.allSchemasById}))}function SelectDownstreamNodesPane(e){var t,n
const a=(0,ka.nA)(null!==(n=null===(t=e.asyncRecord.asyncData.blockedMappersAndExpressions[0])||void 0===t?void 0:t.schemaMapper.fromSchemas)&&void 0!==n?n:[]);(0,S.hu)(1===a.length,"Expected routers to only route from a single node")
const i=e.allSchemasById[a[0].id];(0,S.hu)(null!=i,"Expected schema to be fetched");(0,S.hu)(e.asyncRecord.asyncData.blockedMappersAndExpressions.every((({schemaMapper:e})=>1===e.fromSchemas.length&&(0,ka.i2)(e.fromSchemas[0]).id===i.id)),"Expected all mappers to have the same base schema")
return d.createElement("div",{...(0,ee.Z)({component:"SelectDownstreamNodesPane",element:"root"})},e.itemsToMap.map(((t,n)=>{var a,s
return d.createElement(FixRoutingErrorAccordion,{key:t.id,isOpenByDefault:0===n,item:t,task:e.task,selectorsById:e.selectorsById,asyncRecord:e.asyncRecord,selectedMapperIds:null!==(a=e.itemIdsToSelectedMapperIds[t.id])&&void 0!==a?a:[],selectedEndNodeIds:null!==(s=e.itemIdsToSelectedEndNodeIds[t.id])&&void 0!==s?s:[],mapperIdsToDownstreamSchemaName:e.mapperIdsToDownstreamSchemaName,allSchemasById:e.allSchemasById,baseSchema:i,onChangeSelectedMapperIds:n=>{e.onChangeItemIdsToSelectedMapperIds((0,tm.ZP)(e.itemIdsToSelectedMapperIds,(e=>{e[t.id]=n})))},onChangeSelectedEndNodeIds:n=>{e.onChangeItemIdsToSelectedEndNodeIds((0,tm.ZP)(e.itemIdsToSelectedEndNodeIds,(e=>{e[t.id]=n})))}})})))}const nX=g.mM.create({individualErrorSection:{borderBottom:`1px solid ${Vt.tN}`,":last-child":{borderBottom:"none"}},accordion:{width:"100%",boxShadow:"none"},accordionIcon:{color:Vt.TG},accordionSectionCompleted:{color:Vt.t0},accordionSectionIncomplete:{color:Vt.pF},accordionHeaderText:{marginTop:"16px",marginBottom:"16px",display:"flex",flexDirection:"row",alignItems:"center"},accordionHeaderName:{marginLeft:"8px",marginRight:"8px"},fieldsHeaderText:{marginBottom:"8px"},nodeDropdown:{marginTop:"4px",width:"50%"},selectNodeDropdownSection:{marginBottom:"16px"},routingRoutesHeader:{marginTop:16,marginBottom:8},infoIcon:{color:Vt.pF},routingRoutesHeaderText:{marginRight:4},containsChainedRoutersInfo:{marginBottom:16}})
function SelectErrorPane(e){const t=e.asyncRecords.filter((({status:e})=>e===Sn._2.FAILED))
return d.createElement("div",{className:(0,g.iv)(aX.description)},"Fix the following ",(0,de._6)(t.length,"error")," so the next task(s) or output(s) in the workflow can be created.",d.createElement("div",{className:(0,g.iv)(aX.banners),...(0,ee.Z)({component:"SelectErrorPane",element:"root"})},t.length>0?d.createElement(pd.Z,{messages:t.map((t=>{var n
let a=""
if(isAsyncDataExecuteSchemaMapper(t.asyncData)){const e=t.asyncData.schemaMapper.toSchema
a=`Mapping to ${(0,ka.i2)(e).name}: `}return{text:`${a}${null!==(n=t.details)&&void 0!==n?n:"Mapping has failed unexpectedly"}`,bannerType:io.ct.ERROR,action:{actionText:"Fix error",actionType:io.J7.CUSTOM,actionOnClick:()=>{e.onSelectError(t)}}}}))}):d.createElement(d.Fragment,null,"The selected task does not have any mapping errors.")))}const aX=g.mM.create({description:{marginTop:24,marginRight:6},banners:{marginTop:16,marginRight:16}}),iX=xa.Ps`
  fragment FixFailedRoutingAndMappingSchemaMapper on ProcessFlowchartSchemaMapperNode {
    id
    toNodeConfig {
      id
    }
    fromSchemas {
      ... on ProcessTaskSchemaNode {
        id
        name
      }
      ... on ProcessOutputSchemaNode {
        id
        name
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
    toSchema {
      ... on ProcessTaskSchemaNode {
        id
        name
      }
      ... on ProcessOutputSchemaNode {
        id
        name
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
`,sX=xa.Ps`
  query FixFailedRoutingAndMappingModalQuery($processTaskId: StrictString!)
  @skipAudit
  @engComponent(name: WORKFLOWS) {
    processTask(id: $processTaskId) {
      ... on ProcessTaskNode {
        id
        humanId
        rootTask {
          id
          process {
            id
          }
          taskSchema {
            ... on ProcessTaskSchemaNode {
              id
            }
            ... on InaccessibleInfoNode {
              ...InaccessibleInfoGraphQL
            }
          }
        }
        process {
          id
        }
        fields
        outputs {
          id
          humanId
          fields
          ...HasArchiveRecordGraphQL
        }
        taskSchema {
          ... on ProcessTaskSchemaNode {
            id
            name
            fields
            allFields
            outputSchema {
              id
              name
              fields
              allFields
            }
            statusLifecycle {
              id
              schemaExecutionType
            }
          }
          ... on InaccessibleInfoNode {
            ...InaccessibleInfoGraphQL
          }
        }
        processAsyncRecords {
          id
          status
          details
          asyncData {
            ... on ProcessStartAutomatedMappingRecordNode {
              id
              blockedEndNodesAndExpressions {
                blockedEndNode {
                  ... on ProcessEndNodeDetailsNode {
                    ...ProcessEndNodeDetailsGraphQL
                  }
                }
                blockingExpression {
                  ... on BenchlingExpressionNode {
                    expressionJson
                  }
                  ... on InaccessibleInfoNode {
                    ...InaccessibleInfoGraphQL
                  }
                }
                fromSchemas {
                  ... on ProcessTaskSchemaNode {
                    id
                    name
                  }
                  ... on ProcessOutputSchemaNode {
                    id
                    name
                  }
                  ... on InaccessibleInfoNode {
                    ...InaccessibleInfoGraphQL
                  }
                }
              }
              blockedMappersAndExpressions {
                schemaMapper {
                  ... on ProcessFlowchartSchemaMapperNode {
                    ...FixFailedRoutingAndMappingSchemaMapper
                  }
                }
                blockingExpressions {
                  ... on BenchlingExpressionNode {
                    expressionJson
                  }
                  ... on InaccessibleInfoNode {
                    ...InaccessibleInfoGraphQL
                  }
                }
                blockingRouters {
                  ... on ProcessRouterNodeDetailsNode {
                    id
                  }
                }
              }
            }
            ... on ProcessFlowchartSchemaMappingRecordNode {
              id
              schemaMapper {
                ... on ProcessFlowchartSchemaMapperNode {
                  ...FixFailedRoutingAndMappingSchemaMapper
                }
              }
            }
            ... on ProcessFlowchartExecuteSchemaMapperRecordNode {
              id
              schemaMapper {
                ... on ProcessFlowchartSchemaMapperNode {
                  ...FixFailedRoutingAndMappingSchemaMapper
                }
              }
            }
          }
        }
        ...StudyableTypedValueDataGraphQL
      }
      ...HasArchiveRecordGraphQL
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("StudyableTypedValueData").fragment}
  ${(0,La.f)("HasArchiveRecord").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
  ${(0,La.f)("ProcessEndNodeDetails").fragment}
  ${iX}
`,rX=xa.Ps`
  query FixFailedRoutingAndMappingAllSchemasQuery @skipAudit @engComponent(name: WORKFLOWS) {
    ...AllStorableSchemasGraphQL
    ...AllTagSchemasGraphQL
    ...AllResultSchemasGraphQL
    ...AllProcessTaskSchemasGraphQL
  }
  ${(0,La.f)("AllStorableSchemas").fragment}
  ${(0,La.f)("AllTagSchemas").fragment}
  ${(0,La.f)("AllResultSchemas").fragment}
  ${(0,La.f)("AllProcessTaskSchemas").fragment}
`
var oX
!function(e){e.SELECT_ERRORS="SELECT_ERRORS"
e.SELECT_DOWNSTREAM_NODES="SELECT_DOWNSTREAM_NODES"
e.TABLE_REVIEW="TABLE_REVIEW"}(oX||(oX={}))
const lX={key:oX.SELECT_ERRORS,title:"Select error(s)"},cX={key:oX.SELECT_DOWNSTREAM_NODES,title:"Select next step(s) in workflow"},dX={key:oX.TABLE_REVIEW,title:"Review"},uX={[oX.SELECT_ERRORS]:Fx.cV.UNVISITED,[oX.SELECT_DOWNSTREAM_NODES]:Fx.cV.UNVISITED,[oX.TABLE_REVIEW]:Fx.cV.UNVISITED}
function getFixFailedRoutingAndMappingModalSteps(e){return null!=e&&isAsyncRecordRoutingRecord(e)?[lX,cX,dX]:[lX,dX]}function getSchemaMappers(e){return isAsyncDataStartAutomatedMapping(e.asyncData)?e.asyncData.blockedMappersAndExpressions.map((({schemaMapper:e})=>e)):[e.asyncData.schemaMapper]}function FixFailedRoutingAndMappingModal(e){const[t,n]=(0,d.useState)(oX.SELECT_ERRORS),[a,i]=(0,d.useState)(null),[s,r]=(0,d.useState)(null),[o,l]=(0,d.useState)({}),[c,u]=(0,d.useState)({}),[p,h]=(0,d.useState)(null),g=(0,d.useMemo)((()=>null!=a&&null!=e.selectedItem?function getMapperIdtoDownstreamSchemaName(e,t){return getSchemaMappers(e).reduce(((e,t)=>{e[t.id]=(0,ka.CZ)(t.toSchema)?"Inaccessible schema":t.toSchema.name
return e}),{})}(a,e.selectedItem):null),[a,e.selectedItem]),E=(0,d.useMemo)((()=>null!=a?(0,Jt.Pe)(getSchemaMappers(a),(({id:e})=>e)):null),[a]);(0,d.useEffect)((()=>{const loadAutomatedMappingResults=async()=>{const t=await uA.LD({automatedMappingInputs:Object.entries(o).map((([e,t])=>t.map((t=>({mapperId:t,...ea.ZP.isProcessTask(e)?{taskId:e}:{outputId:e}}))))).flat(1)}),n=(0,Jt.vM)(t.results,(({fromItemId:e})=>e)),a=Object.entries(n).reduce(((t,[n,a])=>{const i=(0,Jt.vM)(a,(e=>e.mapperId))
t[n]=Object.entries(i).map((([t,n])=>{const a=n.map((({fields:e})=>e)),i=function buildTableForAutomatedMappingResults(e,t,n){let a=getStructuredTable(e,t.length,n)
t.forEach(((e,t)=>{for(const{schemaField:n,value:i}of e){const e=a.columns.findIndex((e=>e.schemaFieldApiId===n.apiId));(0,S.hu)(e>=0,`Expected table to have ${n.apiId}`)
a=propagateTypedValueToTableColumn(i,t,e,a)}}))
return a}(n[0].toSchema,a,e.selectorsById)
return{structuredTable:i,computedTable:new Array(i.rows.length).fill([]),mapper:E[t]}}))
return t}),{})
if(null!=s)for(const e of s)null==a[e.id]&&(a[e.id]=[])
h(a)}
t===oX.TABLE_REVIEW&&loadAutomatedMappingResults()}),[t,e.selectorsById,o,E,s])
const resetFlow=()=>{i(null)
r(null)
l({})
u({})
h(null)
n(oX.SELECT_ERRORS)},handleSelectedRecord=t=>{(0,S.hu)(null!=e.selectedItem,"Expected item to be selected")
let a
const s={},o={}
let c
if(isAsyncRecordRoutingRecord(t)&&t.asyncData.blockedMappersAndExpressions.some((({blockingExpressions:e})=>e.length>0))){c=function getItemsToMapFromRoutingError(e,t){(0,S.hu)(e.asyncData.blockedMappersAndExpressions.length>0,"Expected at least one router on the path")
const n=(0,ka.nA)(e.asyncData.blockedMappersAndExpressions.map((({schemaMapper:e})=>{(0,S.hu)(1===e.fromSchemas.length,"Expected routers to block non-merging mappers")
return e.fromSchemas[0]})));(0,S.hu)(n.every((({id:e})=>e===n[0].id)),"Expected all blocked mappers to be from the same schema")
const a=n[0].id
return ea.ZP.isProcessOutputSchema(a)?t.outputs:[t]}(t,e.selectedItem)
a=oX.SELECT_DOWNSTREAM_NODES
for(const e of c){s[e.id]=[]
o[e.id]=[]}}else{const n=isAsyncDataStartAutomatedMapping(t.asyncData)?t.asyncData.blockedMappersAndExpressions.map((({schemaMapper:e})=>e.id)):[t.asyncData.schemaMapper.id]
a=oX.TABLE_REVIEW
c=[e.selectedItem]
s[e.selectedItem.id]=n}i(t)
n(a)
r(c)
l(s)
u(o)},f={key:vb.Z.SUBMIT,text:"Submit",dataTestAttrs:{component:"FixFailedRoutingAndMappingModal",element:"submitButton",key:vb.Z.SUBMIT},style:C.ZJ.PRIMARY,onClick:async()=>{var t
const n=[],i=[],s=null!==(t=e.selectedItem.rootTask)&&void 0!==t?t:e.selectedItem
if(null!=p)for(const[e,t]of Object.entries(p))for(const a of t)a.structuredTable.kind===Tb.sl.PROCESS_TASK?n.push(...(0,IM.Z)({table:a.structuredTable,evaluatedTable:a.computedTable,sourceType:"continue_flowchart_dashboard"}).map((t=>({...t,nodeConfigId:a.mapper.toNodeConfig.id,fromItemId:e,schemaMapperId:a.mapper.id})))):a.structuredTable.kind===Tb.sl.PROCESS_OUTPUT&&i.push(...(0,bM.n4)({table:a.structuredTable,evaluatedTable:a.computedTable,sourceType:"continue_flowchart_dashboard",schemaMapperId:a.mapper.id,taskIds:new Array(a.structuredTable.rows.length).fill(s.id),fromItemIds:new Array(a.structuredTable.rows.length).fill(e),creationOriginIds:new Array(a.structuredTable.rows.length).fill(s.process.id)}))
const r=a?Object.entries(c).map((([e,t])=>t.length>0?{endNodeIds:t,asyncJobRecordId:a.id}:null)).filter((e=>null!=e)):[],o=[...n.length>0?[(0,de._6)(n.length,"task")]:[],...i.length>0?[(0,de._6)(i.length,"output")]:[]].join(" and "),l=await(0,Ic.jI)(uA.Hp({tasks:n,outputs:i,taskId:e.selectedItem.id,endNodes:r}),o.length>0?`Creating new ${o}`:"Performing routing")
n.length>0?(0,de.c4)(null,(0,FJ.RY)(l.createdTasks.map((e=>e.humanId)))):i.length>0?(0,de.c4)(null,(0,FJ.vI)(l.createdOutputs.map((e=>e.humanId)))):(0,de.c4)(null,(0,FJ.RY)([l.routedTask.humanId]))
v.ZP.success(o.length>0?`Created new ${o}.`:"Routing complete.")
!function FixFailedRoutingAndMappingModal_trackAnalytics(e,t){var n,a
const i=e.rootTask;(0,S.hu)(!(0,ka.CZ)(e.taskSchema),"Inaccessible task schema in FFM analytics")
m.L9(j.Zm.CORRECTED_FAILED_AUTOMATED_MAPPING,{output_api_id:null,task_api_id:e.id,task_group_api_id:e.process.id,flowchart_task_api_id:null!==(n=null==i?void 0:i.id)&&void 0!==n?n:null,flowchart_task_group_api_id:null!==(a=null==i?void 0:i.process.id)&&void 0!==a?a:null,task_schema_type:e.taskSchema.statusLifecycle.schemaExecutionType,is_routing_failure:t})}(e.selectedItem,Boolean(a&&isAsyncRecordRoutingRecord(a)))
e.onRequestClose()},disabled:null==p||Object.values(p).some((e=>e.some((({computedTable:e})=>(0,gM.Z)(e)))))}
return d.createElement(jF._,{title:"Fix failed mapping errors",onRequestClose:e.onRequestClose,buttons:(()=>{switch(t){case oX.SELECT_ERRORS:return[]
case oX.SELECT_DOWNSTREAM_NODES:return[{key:vb.Z.BACK,text:"Back",dataTestAttrs:{component:"FixFailedRoutingAndMappingModal",element:"backButton",key:vb.Z.BACK},onClick:()=>{resetFlow()}},{key:vb.Z.NEXT,text:"Next",dataTestAttrs:{component:"FixFailedRoutingAndMappingModal",element:"nextButton",key:vb.Z.NEXT},style:C.ZJ.PRIMARY,onClick:()=>{n(oX.TABLE_REVIEW)},disabled:Object.entries(o).some((([e,t])=>0===t.length&&0===c[e].length))}]
case oX.TABLE_REVIEW:return[{key:vb.Z.BACK,text:"Back",dataTestAttrs:{component:"FixFailedRoutingAndMappingModal",element:"backButton",key:vb.Z.BACK},onClick:()=>{null!=a&&isAsyncDataStartAutomatedMapping(a.asyncData)?n(oX.SELECT_DOWNSTREAM_NODES):resetFlow()}},f]
default:(0,S.hu)(!1,`Unexpected type ${(0,Go.vE)(t)}`)
return[]}})(),expandHeight:!0,large:!0,modalKey:"fixFailedMapping",rememberExpandedSetting:!0,wrapInForm:!1},d.createElement(Fx.ZP,{steps:getFixFailedRoutingAndMappingModalSteps(a),statusByStep:uX,currentStepKey:t,onUpdateCurrentStep:()=>{},variant:Fx.zK.FLAT}),(()=>{if(e.isLoading)return d.createElement(kl.b,null)
switch(t){case oX.SELECT_ERRORS:return d.createElement(SelectErrorPane,{asyncRecords:e.selectedItem.processAsyncRecords,onSelectError:handleSelectedRecord})
case oX.SELECT_DOWNSTREAM_NODES:(0,S.hu)(null!=s&&null!=a&&null!=g,"Expected record to be selected and mappable items to be defined");(0,S.hu)(isAsyncRecordRoutingRecord(a),"Expected selected record to be a routing error")
return d.createElement(SelectDownstreamNodesPane,{itemIdsToSelectedMapperIds:o,itemIdsToSelectedEndNodeIds:c,itemsToMap:s,mapperIdsToDownstreamSchemaName:g,asyncRecord:a,selectorsById:e.selectorsById,task:e.selectedItem,onChangeItemIdsToSelectedMapperIds:l,onChangeItemIdsToSelectedEndNodeIds:u,allSchemasById:e.allSchemasById})
case oX.TABLE_REVIEW:(0,S.hu)(null!=g&&null!=s,"Expected flowchart data to be defined")
return d.createElement(PerformManualMappingPane,{fromItems:s,mapperIdsToDownstreamSchemaName:g,fromItemIdsToTables:p,onChangeFromItemIdsToTables:h})
default:(0,S.hu)(!1,`Unexpected type ${(0,Go.vE)(t)}`)
return null}})())}function QueryingFixFailedRoutingAndMappingModal(e){const t=(0,Da.IJ)(rX),n=(0,Da.IJ)(bb.Xk,{variables:{includeArchived:!0}}),a=(0,Da.IJ)(sX,{variables:{processTaskId:e.selectedId}}),i=(0,zo.NA)("SchemaFieldSelector",n.type===Da.NI.SUCCESS?n.data.schemaFieldSelectors:[]),s=(0,bb.OU)(i),r=a.type!==Da.NI.SUCCESS?[]:function FixFailedRoutingAndMappingModal_getInaccessibleItems(e){const t=[],n=e.processTask
if((0,ka.CZ)(n))return[n];(0,ka.CZ)(n.taskSchema)&&t.push(n.taskSchema)
for(const e of n.processAsyncRecords){const n=getSchemaMappers(e)
for(const e of n)(0,ka.CZ)(e.toSchema)&&t.push(e.toSchema)}return t}(a.data)
if(r.length>0)return d.createElement(Ll.Z,{inaccessibleInfo:r[0],modelType:st.PROCESS_TASK})
return n.type!==Da.NI.SUCCESS||a.type!==Da.NI.SUCCESS||t.type!==Da.NI.SUCCESS?d.createElement(FixFailedRoutingAndMappingModal,{isLoading:!0,onRequestClose:e.onRequestClose}):d.createElement(FixFailedRoutingAndMappingModal,{isLoading:!1,selectorsById:s,selectedItem:(0,ka.i2)(a.data.processTask),onRequestClose:e.onRequestClose,allSchemasById:(0,Jt.Pe)([...Object.values(t.data).flat(),...(0,Jt.oA)(t.data.processTaskSchemas.map((({outputSchema:e})=>e)))],(({id:e})=>e))})}function FixFailedMappingButton(e){const t=function getTooltipErrorMessage(e){if(0===e.length)return"No items selected"
if(e.length>1)return"Only one item can be selected at a time"
const t=e[0],n=(0,_J.vQ)(t)?t:t.task
return n.schema.clientOrigin!==Sn.Lt.PROCESSES?"Only supported for workflows tasks":n.processAsyncRecords.every((e=>e.status===Sn._2.ACTIVE))?"Item must have at least one failed mapping":null}(e.selectedItems)
return d.createElement(P.pf,{tooltipTitle:null!=t?t:"Fix failed mapping"},d.createElement(C.Co,{disabled:null!=t,size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_WHITE,onClick:async()=>{if(dt.ZP.WORKFLOWS_ENABLE_ROUTERS){(0,S.hu)(1===e.selectedItems.length,"Expected exactly one item to be selected",{selectedItems:e.selectedItems})
const t=e.selectedItems[0]
await(0,Xn.Z)(QueryingFixFailedRoutingAndMappingModal,{selectedId:(0,_J.vQ)(t)?t.id:t.task.id})}else await(0,Xn.Z)(QueryingFixFailedMappingModal,{selectedIds:e.selectedItems.map((e=>(0,_J.vQ)(e)?e.id:e.task.id))})},icon:Sn.CT.REJECTED,dataTestAttrs:e.dataTestAttrs}))}function UndoExecutionButton(e){const t=function getUndoExecutionErrorMessage(e){return 0===e.length?"No tasks selected to undo execution":e.some((e=>e.status.statusType!==Sn.HS.IN_PROGRESS))?`All selected tasks must be ${(0,aM.NJ)(Sn.HS.IN_PROGRESS).toLocaleLowerCase()} to undo execution`:e.some((t=>t.schema.id!==e[0].schema.id))?"All selected tasks must have the same schema to undo execution":e.some((e=>null==e.executionOrigin))?"All selected tasks must be previously executed to undo execution":null!=e[0].schema.entryTemplate&&e.some((t=>t.executionOrigin.executionEntry.id!==e[0].executionOrigin.executionEntry.id))?"All selected tasks must be executed into the same entry to undo execution":null}(e.tasks)
return d.createElement(P.pf,{tooltipTitle:null!=t?t:"Undo execution"},d.createElement(C.Co,{disabled:null!=t,size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_WHITE,icon:"undo",onClick:async()=>{const t=null!=e.tasks[0].schema.entryTemplate?uA.iI:uA.bJ
await(0,Ic.jI)((async()=>{const{tasks:n}=await t({taskIds:e.tasks.map((({id:e})=>e))});(0,xF.UF)(n)
v.ZP.success("Cancelled task execution")})(),"Cancelling task execution...")},dataTestAttrs:{component:"ProcessManagementToolbar",element:"UndoExecutionButton"}}))}function ArchiveToolbarButtons(e){const t=e.selectedItems.every((e=>(0,yc.ZP)(e)&&e.permissions.unarchivable)),n=e.selectedItems.every((e=>!(0,yc.ZP)(e)&&e.permissions.archivable)),a=e.selectedItems.length>0
let i=a?ea.ZP.apiIdToMaybeType(e.selectedItems[0].id):null
e.selectedItems.every((e=>ea.ZP.apiIdToMaybeType(e.id)===i))||(i=null)
const s=null!=i&&areSelectedTypesSubset([i],(0,xJ.rB)(Sn.Lt.PROCESSES)),r=(0,de._6)(e.selectedItems.length,null!=i?(0,Mt.E2)(i):"item")
return t?d.createElement(d.Fragment,null,(0,ln.cr)({feature:on.gx.PROCESSES_UNARCHIVE})&&d.createElement(AV.Z,{buttonStyle:C.ZJ.TERTIARY_WHITE,itemIds:e.selectedItems.map((e=>e.id)),onUnarchive:async e=>{await IR.YK(i,e)},tooltipTitle:`Unarchive ${r}`,disabled:!a||!s})):d.createElement(d.Fragment,null,(0,ln.cr)({feature:on.gx.PROCESSES_ARCHIVE})&&d.createElement(NV.Z,{buttonStyle:C.ZJ.TERTIARY_WHITE,disabled:!a||!n||!s,items:e.selectedItems,onArchive:async(e,t)=>{await IR.WL(i,e,t)},tooltipTitle:`Archive ${r}`}))}function CopyProcessTasksButton(e){const t=e.selectedItems,n=t.length>0
return d.createElement(P.ZP,{title:`Copy ${(0,de._6)(t.length,"task")}`,disabled:!n},d.createElement(C.Co,{disabled:!n,size:C.qE.SMALL,buttonStyle:C.ZJ.TERTIARY_WHITE,onClick:async()=>{await xF.GV(t.map((({id:e})=>e)))},icon:"copy"}))}function ProcessMoveButton(e){var t
const n=e.selectedItems,a=n.length>0
return d.createElement(LJ.Z,{disabled:!a||!e.selectedItems.every((e=>e.permissions.movable)),files:e.selectedItems,finderId:ZP.zn,initialSelectedFolderId:null===(t=n[0])||void 0===t?void 0:t.folder.id})}function ProcessOutputEditorDropdown(e){return d.createElement(xV.ZP,{disabled:!(t=e.selectedItems,t.length>0&&t.every((e=>e.permissions.writable&&e.schema.id===t[0].schema.id&&(0,EM.k)(e.schema)))),results:e.selectedItems.map((e=>({...e,tags:e.fields}))),onSubmit:async t=>{await xF.JZ(e.selectedType,e.selectedItems,t,"dashboard")},buttonStyle:C.ZJ.TERTIARY_WHITE,dropLeft:!0,actionOrigin:j.D2.WORKFLOWS_EXPANDED_SEARCH_TOOLBAR})
var t}function ProcessManagementEditButton(e){return areSelectedTypesSubset(e.selectedTypes,[st.PROCESS_TASK,st.RECIPE_RUN_TASK,st.RECIPE_UNIT_OPERATION_TASK,st.RECIPE_STEP_TASK])?d.createElement(kJ.Z,{items:e.selectedItems}):areSelectedTypesExactly(e.selectedTypes,[st.PROCESS_OUTPUT])?d.createElement(ProcessOutputEditorDropdown,{...e,selectedItems:e.selectedItems,selectedType:st.PROCESS_OUTPUT}):null}function ProcessManagementToolbar(e){const t=e.selectedItems.length>0,n=function getCsvExportType(){return areSelectedTypesSubset(e.selectedTypes,[st.RECIPE_RUN_TASK,st.RECIPE_UNIT_OPERATION_TASK,st.RECIPE_STEP_TASK])||e.selectedTypes.length>1?null:function ensureSingleProcessOriginType(){(0,S.hu)(e.selectedClientOrigin===Sn.Lt.PROCESSES,"Expected processes to be selected.");(0,S.hu)(1===e.selectedTypes.length,"Expected only one type to be selected.");(0,S.hu)(areSelectedTypesSubset(e.selectedTypes,[st.PROCESS,st.PROCESS_TASK,st.PROCESS_OUTPUT]),"Expected only processes to be selected.")
return e.selectedTypes[0]}()}()
return d.createElement("div",{className:"u-flex-display"},d.createElement("div",{className:"buttonGroup"},(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})&&d.createElement(ProcessManagementEditButton,{...e}),areSelectedTypesExactly(e.selectedTypes,[st.PROCESS])&&(0,ln.cr)({feature:on.gx.PROCESSES_MOVE})&&d.createElement(ProcessMoveButton,{...e}),areSelectedTypesExactly(e.selectedTypes,[st.PROCESS_TASK])&&(0,ln.cr)({feature:on.gx.PROCESSES_CREATE})&&e.selectedItems.every((e=>(0,EM.v)(Sn.Nk.CAN_COPY_TASKS,e.schema.executionType)))&&d.createElement(CopyProcessTasksButton,{...e}),areSelectedTypesExactly(e.selectedTypes,[st.PROCESS_TASK])&&(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})&&d.createElement(UndoExecutionButton,{tasks:e.selectedItems}),e.selectedClientOrigin===Sn.Lt.PROCESSES&&d.createElement(ArchiveToolbarButtons,{...e}),areSelectedTypesSubset(e.selectedTypes,[st.PROCESS_TASK,st.PROCESS_OUTPUT])&&(0,ln.cr)({feature:on.gx.PROCESSES_CREATE})&&d.createElement(FixFailedMappingButton,{selectedItems:e.selectedItems,dataTestAttrs:{component:"ProcessManagementToolbar",element:"fixFailedMappingButton"}}),areSelectedTypesExactly(e.selectedTypes,[st.PROCESS_TASK])&&dt.ZP.STUDIES_ENABLE&&d.createElement(_V.Z,{itemIds:e.selectedItems.map((e=>e.id)),disabled:!(t&&e.selectedItems.every((e=>(0,WN.Hw)(e)))),buttonStyle:C.ZJ.TERTIARY_WHITE}),(0,ln.cr)({feature:on.gx.PROCESSES_EXPORT})&&d.createElement(RV.Z,{buttonStyle:C.ZJ.TERTIARY_WHITE,disabled:!t,menuItems:[(0,Jt.oA)([null!=n?{name:"Export selection to CSV",handleOnClick:async()=>{await xF.GS(n,e.selectedItems.map((({id:e})=>e)))},disabled:!t,visible:dt.ZP.ENABLE_EXPORTS}:null,{name:Tc.QU,handleOnClick:()=>{const t=e.selectedItems.map((e=>e.id))
bc.dV(t)},disabled:!t,dataTestAttrs:{component:"ProcessManagementToolbar",element:"exportAuditLog"}}])]})),function areItemsExecutableAsTasks(){const t=areSelectedTypesSubset(e.selectedTypes,[st.PROCESS_TASK,st.RECIPE_STEP_TASK,st.RECIPE_UNIT_OPERATION_TASK]),n=areSelectedTypesExactly(e.selectedTypes,(0,xJ.rB)(Sn.Lt.RECIPES))
return!(!t&&!n)&&(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})}()&&d.createElement("div",{className:f()("buttonGroup",(0,g.iv)(mX.executeButtonWrapper))},d.createElement(MJ.ZP,{selectedItems:e.selectedItems,actionOrigin:j.D2.SIDEPANEL_UNDETERMINED})),areSelectedTypesExactly(e.selectedTypes,[st.PROCESS])&&(0,ln.cr)({feature:on.gx.PROCESSES_EDIT})&&d.createElement("div",{className:f()("buttonGroup",(0,g.iv)(mX.executeButtonWrapper))},d.createElement(ExecuteTaskGroupsButton,{processes:e.selectedItems,isSingleTaskGroupContext:!1,actionOrigin:j.D2.SIDEPANEL_UNDETERMINED})))}const mX=g.mM.create({executeButtonWrapper:{marginLeft:"8px"}}),pX=[Kn.bo.SORT_CREATED_AT_KEY,Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_IDENTIFIER_KEY]
function getSelectedClientOrigin(e){const t=NN.$V(e.filters,Kn.Vm.PROCESS_CLIENT_ORIGIN);(0,S.hu)(Object.values(Sn.Lt).includes(t),`Expected client origin to be one of ${Object.values(Sn.Lt)}`,{selectedClientOrigin:t})
return t}function getSelectedTypes(e){return NN.$V(e.filters,Kn.Vm.TYPES)}function ProcessManagementSidepanelCrumbs(e){const t={key:"root",text:"Workflows"}
null!=e.activeSavedSearch&&(t.onClick=()=>{e.onSearch(RN._j(e.searchParams,[],(0,yJ.s2)().filters))
e.onSelectSavedSearch(void 0)})
return d.createElement(Cw.bJ,{crumbs:e.activeSavedSearch?[d.createElement(Cw.Ak,{...t}),d.createElement(Cw.Ak,{key:"root",text:e.activeSavedSearch.name})]:[d.createElement(Cw.Ak,{...t})],settingsIcon:d.createElement(d.Fragment,null,d.createElement(SJ.Z,{options:[[{name:"Workflow schemas",handleOnClick:()=>{de.c4(null,kK.Lv())}}]]}),e.settingsComponents)})}function renderProcessManagementToolbar(e,t,n){var a
const i=getSelectedTypes(n),s=null!==(a=null==e?void 0:e.filter((e=>t.includes(e.id))))&&void 0!==a?a:[],r=getSelectedClientOrigin(n)
return d.createElement(ProcessManagementToolbar,{selectedTypes:i,selectedItems:s,selectedClientOrigin:r})}const hX=(0,UP.ZP)((function ProcessManagementSidepanel(e){var t
const n=getSelectedTypes(e.searchParams),a=getSelectedClientOrigin(e.searchParams),i=(0,d.useMemo)((()=>areSelectedTypesExactly(n,[st.PROCESS])?[fJ.dC.PROCESS_NAME]:areSelectedTypesExactly(n,[st.PROCESS_TASK])?[fJ.dC.NAME]:[]),[n]);(0,S.hu)((0,_J.dB)(a,n),"Expected the selected types to be a supported by the selected view",{selectedClientOrigin:a,selectedTypes:n,searchParams:e.searchParams})
return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,savedSearchSection:Sn.yd.PROCESSES,onUpdateFilters:t=>{if(a===Sn.Lt.PROCESSES){const a=getSelectedTypes({...e.searchParams,filters:t})
areSelectedTypesExactly(a,n)||DJ.RG(a)}const i=getSelectedClientOrigin({...e.searchParams,filters:t})
i!==a&&(t=(0,yJ.KJ)(i))
e.onUpdateFilters(t)},actionSource:j.D2.WORKFLOWS_EXPANDED_SEARCH,availableTypes:(0,xJ.rB)(a),defaultTypes:(0,xJ.W8)(a),isTypeRequired:(0,xJ.cD)(a),makeCrumbs:t=>d.createElement(ProcessManagementSidepanelCrumbs,{activeSavedSearch:e.activeSavedSearch,onSelectSavedSearch:e.onSelectSavedSearch,onSearch:e.onSearch,searchParams:e.searchParams,settingsComponents:t}),additionalHeaderButtons:d.createElement(NewProcessDropdown,{processTaskSchemas:null!==(t=e.schemasByType[st.PROCESS_TASK_SCHEMA])&&void 0!==t?t:null}),primaryFilterOptionsBeforeTypeFilter:(0,aM.F0)().length>1?[{filterKey:Kn.Vm.PROCESS_CLIENT_ORIGIN}]:[],extraPrimaryFilterOptions:getAvailablePrimaryFilters(a,n),getSecondaryFilterGroups:getAvailableSecondaryFilters(a),availableSortKeys:pX,preservedFilterKeys:[Kn.Vm.TYPES,Kn.Vm.PROCESS_CLIENT_ORIGIN],section:ZP.$0.PROCESSES,dataTestAttrs:{component:"ProcessManagementSidepanel",element:"root"},renderToolbar:renderProcessManagementToolbar,defaultHiddenColumnKeys:i}))}),Kn.Sc.PROCESS_MANAGEMENT,ZP.$0.PROCESSES,{defaultSearchParams:(0,yJ.s2)(),getNavigationUpdate:function getProcessManagementURL(e,t){return t.isExpanded?{url:(0,eJ.q7)("/workflows",t.searchParams,t.filterErrors),options:{replace:e.isExpanded===t.isExpanded}}:null},savedSearchPreferenceKey:qP.eP(ZP.$0.PROCESSES),filterKeysToRemember:[Kn.Vm.PROCESS_CLIENT_ORIGIN,Kn.Vm.TYPES]})
var gX=n(286708),EX=n(951663),fX=n(789917)
function NewStudyDropdown({actionOrigin:e}){const t=d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE,className:"dropdown-menu pull-right"},(0,fX.Sj)(null,e).map((e=>d.createElement(N.Z,{key:e.name,value:e.value,onSelect:e.handleClick},e.name))))
return d.createElement(I.ZP,{menu:t,className:"u-display-inline-block dropdown"},d.createElement("div",null,d.createElement(Zo.Z,{text:"Create...",placement:ne.ZH.BOTTOM},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,icon:"compose",size:C.qE.SMALL}))))}function StudiesSidepanelCrumbs(e){return e.activeSavedSearch?d.createElement(Cw.bJ,{crumbs:[d.createElement(Cw.Ak,{key:"studies",text:"Studies",onClick:()=>{e.onSearch(RN._j(e.searchParams,[],getDefaultStudiesSearchParams().filters))
e.onSelectSavedSearch(void 0)}}),d.createElement(Cw.Ak,{key:"root",text:e.activeSavedSearch.name})],settingsIcon:e.settingsComponents}):d.createElement(Cw.bJ,{crumbs:[d.createElement("span",{key:"root"},"Studies")],settingsIcon:e.settingsComponents})}function getDefaultStudiesSearchParams(){return{filters:[{...(0,Kn.QW)(Kn.Vm.TYPES),value:[st.STUDY]}],offset:0,limit:(0,TN.z3)(),query:"",sorts:(0,qP.i_)(ZP.$0.STUDIES)}}const SX=(0,UP.ZP)((function StudiesSidepanel(e){return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,actionSource:j.D2.STUDIES_SIDEPANEL,savedSearchSection:Sn.yd.STUDIES,additionalHeaderButtons:d.createElement(NewStudyDropdown,{actionOrigin:j.D2.STUDIES_SIDEPANEL}),availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_IDENTIFIER_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],makeCrumbs:t=>d.createElement(StudiesSidepanelCrumbs,{activeSavedSearch:e.activeSavedSearch,onSelectSavedSearch:e.onSelectSavedSearch,onSearch:e.onSearch,searchParams:e.searchParams,settingsComponents:t}),availableTypes:[st.STUDY],extraPrimaryFilterOptions:[],preservedFilterKeys:[],section:ZP.$0.STUDIES}))}),Kn.Sc.STUDIES,ZP.SA.STUDIES,{defaultSearchParams:getDefaultStudiesSearchParams(),getNavigationUpdate:function getStudiesURL(e,t){return t.isExpanded?{url:(0,eJ.q7)("/studies/listing",t.searchParams,t.filterErrors),options:{replace:e.isExpanded===t.isExpanded}}:null}})
var yX=n(767077)
class TaggedNodeGraph{constructor(){this.isValidNodeId=l.default.memoize(this.isValidNodeId)
this.getNodeIds=l.default.memoize(this.getNodeIds)
this.getParentNodeIds=l.default.memoize(this.getParentNodeIds)
this.getTag=l.default.memoize(this.getTag)
this.getNodeIds=l.default.memoize(this.getNodeIds)
this.getPrimaryChildNodeIds=l.default.memoize(this.getPrimaryChildNodeIds)
this.getSecondaryChildNodeIds=l.default.memoize(this.getSecondaryChildNodeIds)
this.getInitialNodeIds=l.default.memoize(this.getInitialNodeIds)
this.getPrimaryAncestorNodeIds=l.default.memoize(this.getPrimaryAncestorNodeIds)
this.isLastDescendantWithTag=l.default.memoize(this.isLastDescendantWithTag)
this.getSiblingsAboveNode=l.default.memoize(this.getSiblingsAboveNode)}isValidNodeId(e){return this.getNodeIds().includes(e)}getNodeIds(){throw new Error("Must be implemented by a subclass.")}getParentNodeIds(e){throw new Error("Must be implemented by a subclass.")}getTag(e){throw new Error("Must be implemented by a subclass.")}getTags(){throw new Error("Must be implemented by a subclass.")}getPrimaryParentNodeId(e){return this.getParentNodeIds(e)[0]}getNodeIdsByTag(e){return this.getNodeIds().filter((t=>this.getTag(t)===e))}getPrimaryChildNodeIds(e){return this.getNodeIds().filter((t=>this.getPrimaryParentNodeId(t)===e))}getSecondaryChildNodeIds(e){return this.getNodeIds().filter((t=>this.getParentNodeIds(t).slice(1).includes(e)))}getInitialNodeIds(){return this.getNodeIds().filter((e=>0===this.getParentNodeIds(e).length))}getPrimaryAncestorNodeIds(e){const t=this.getPrimaryParentNodeId(e)
return t?[...this.getPrimaryAncestorNodeIds(t),e]:[e]}isLastDescendantWithTag(e){const t=this.getTag(e)
return this.getPrimaryChildNodeIds(e).every((e=>this.getTag(e)!==t))}getDescendantNodeIds(e){return this.getNodeIds().filter((t=>this.isDescendant(t,e)))}isPrimaryDescendant(e,t){if(e===t)return!0
const n=this.getPrimaryParentNodeId(e)
return!!n&&this.isPrimaryDescendant(n,t)}isDescendant(e,t){return e===t||this.getParentNodeIds(e).some((e=>this.isDescendant(e,t)))}getSiblingsAboveNode(e){const t=this.getPrimaryParentNodeId(e),n=t?this.getPrimaryChildNodeIds(t):this.getInitialNodeIds(),a=n.indexOf(e);(0,S.hu)(a>-1,"Node not found in array of siblings")
return n.slice(0,a)}getLinksAcrossTag(e){const t=[]
for(const n of l.default.range(e+1))for(const a of this.getNodeIdsByTag(n)){const n=this.getPrimaryChildNodeIds(a)
if(0===n.length)t.push({parentId:a,childId:null})
else for(const i of n)this.getTag(i)>e&&t.push({parentId:a,childId:i})}const n=this.getInitialNodeIds().filter((t=>this.getTag(t)>e)).map((e=>({parentId:null,childId:e})))
return[...t,...n]}}class StageFlowNodeGraph extends TaggedNodeGraph{constructor(e,t){super()
this.stageFlowNodes=e
this.stageConfigurations=t
this.getStageConfiguration=l.default.memoize(this.getStageConfiguration)
this.getStageFlowNode=l.default.memoize(this.getStageFlowNode)}getNodeIds(){return l.default.pluck(this.stageFlowNodes,"id")}getParentNodeIds(e){return this.getStageFlowNode(e).parentIds}getTag(e){return this.getStageConfiguration(e).index}getTags(){return l.default.pluck(this.stageConfigurations,"index")}getStageConfiguration(e){const t=this.stageConfigurations.find((t=>l.default.pluck(t.stageFlowNodes,"id").includes(e)));(0,S.hu)(null!=t,`No stage configuration found corresponding to node ${e}`,{stageConfigurations:this.stageConfigurations})
return t}getStageFlowNode(e){const t=l.default.findWhere(this.stageFlowNodes,{id:e});(0,S.hu)(null!=t,`No stage flow node found corresponding to node ${e}`)
return t}getName(e){return null}getExperimentalConditionValues(e){return this.getStageFlowNode(e).experimentalConditionValues}getStatus(e){return null}}class StageRunGraph extends TaggedNodeGraph{constructor(e,t){super()
this.stageRuns=l.default.sortBy(e,"createdAt")
this.stageFlowNodeGraph=new StageFlowNodeGraph(l.default.pluck(e,"stageFlowNode"),t)
this.getStageFlowNodeId=l.default.memoize(this.getStageFlowNodeId)
this.getStageRunIdFromStageFlowNodeId=l.default.memoize(this.getStageRunIdFromStageFlowNodeId)
this.getStageRun=l.default.memoize(this.getStageRun)}getNodeIds(){return l.default.pluck(this.stageRuns,"id")}getParentNodeIds(e){return this.stageFlowNodeGraph.getParentNodeIds(this.getStageFlowNodeId(e)).map((e=>this.getStageRunIdFromStageFlowNodeId(e)))}getTag(e){return this.stageFlowNodeGraph.getTag(this.getStageFlowNodeId(e))}getTags(){return this.stageFlowNodeGraph.getTags()}getStageFlowNodeId(e){return this.getStageRun(e).stageFlowNode.id}getStageRunIdFromStageFlowNodeId(e){const t=this.stageRuns.find((t=>t.stageFlowNode.id===e));(0,S.hu)(null!=t,"No stage run found corresponding to stage flow node",{numStageFlowNodes:this.stageFlowNodeGraph.stageFlowNodes.length,numStageRuns:this.stageRuns.length,stageFlowNodeId:e,stageFlowNodeGraphStageFlowNodes:this.stageFlowNodeGraph.stageFlowNodes,stageRuns:this.stageRuns})
return t.id}getStageRun(e){const t=l.default.findWhere(this.stageRuns,{id:e});(0,S.hu)(null!=t,`No stage run found corresponding to node ${e}`)
return t}getName(e){return this.getStageRun(e).name}getExperimentalConditionValues(e){return this.getStageRun(e).stageFlowNode.experimentalConditionValues}getStatus(e){return this.getStageRun(e).status}getDefaultStageEntry(e){const t=this.getNodeIdsByTag(e).map((e=>this.getStageRun(e)))
return t.length>0?t[0].stageEntry:null}}function DeletableTextFieldRow(e){return d.createElement("div",{className:"workflowConfigureScreen-deletable-row u-flex-display u-tiny-spacing-bottom"},d.createElement("div",{className:"u-flex-grow"},d.createElement("input",{className:"fieldInput-input",value:e.value,onChange:t=>{e.onEditValue(t.target.value)},placeholder:e.placeholder,type:"text"})),d.createElement("div",{className:"u-flex-none u-vertical-center-items u-justify-content-center u-tiny-spacing-left",style:{width:30}},d.createElement(pe.Z,{className:"workflowConfigureScreen-delete faded u-danger-pointer",icon:"delete",onClick:e.onDeleteValue})))}DeletableTextFieldRow.propTypes={value:K.string.isRequired,placeholder:K.string.isRequired,onEditValue:K.func.isRequired,onDeleteValue:K.func.isRequired}
function ExperimentalConditionTable(e){return d.createElement("div",{className:"workflowConfigureScreen-groupBox"},d.createElement(Fr.Z,{label:"Name"}),d.createElement(DeletableTextFieldRow,{value:e.experimentalCondition.name,placeholder:"Enter condition name here",onEditValue:e.onEditName,onDeleteValue:e.onDeleteCondition}),d.createElement("div",{className:"u-spacing-top"},d.createElement(Fr.Z,{label:d.createElement("div",null,d.createElement("span",null,"Options"),d.createElement(pe.Z,{className:"workflowConfigureScreen-compose u-pointer",icon:"compose",onClick:()=>{e.onCreateValue()}}))})),e.experimentalCondition.values.map(((t,n)=>d.createElement(DeletableTextFieldRow,{key:n,value:t.textValue,placeholder:"Enter value name here",onEditValue:t=>{e.onEditValue(n,t)},onDeleteValue:()=>{e.onDeleteValue(n)}}))))}ExperimentalConditionTable.propTypes={experimentalCondition:HR.FB,onEditName:K.func.isRequired,onDeleteCondition:K.func.isRequired,onCreateValue:K.func.isRequired,onDeleteValue:K.func.isRequired,onEditValue:K.func.isRequired}
const bX=ExperimentalConditionTable
var TX=n(210554)
class ConfigureStageModal extends d.Component{constructor(){super(...arguments)
this.state={stageName:this.props.stageConfiguration?this.props.stageConfiguration.stageName:"",experimentalConditions:this.getInitialExperimentalConditions(),baseStageConfigurationSummary:this.props.stageConfiguration}
this._handleStageNameChange=e=>{this.setState({stageName:e.target.value})}
this._handleDelete=()=>{const e=this.props.stageConfiguration
e&&je.iG("Confirm Delete Stage","Are you sure you want to delete this stage? This action cannot be undone.","danger").done((()=>{TX.xt(e.id)
this.props.onRequestClose()}))}
this._handleSubmit=()=>{const e=this.state.experimentalConditions.filter((e=>""!==e.name.trim())).map((e=>({...e,values:e.values.filter((e=>""!==e.textValue.trim()))}))),t={stageName:this.state.stageName,experimentalConditions:e,stageConfigurationIdForEntryTemplate:this.state.baseStageConfigurationSummary?this.state.baseStageConfigurationSummary.id:null}
this.props.stageConfiguration?TX.v0(this.props.stageConfiguration.id,t):TX.mG({workflowTemplateVersionId:this.props.workflowTemplateVersionId,entryTemplateName:this.state.stageName,index:this.props.index,...t})
this.props.onRequestClose()}
this._handleCreateExperimentalCondition=()=>{this.setState(Q()(this.state,{experimentalConditions:{$push:[{id:null,name:"",values:[{id:void 0,name:"",textValue:""}]}]}}))}}getInitialExperimentalConditions(){let e=this.props.stageConfiguration?this.props.stageConfiguration.experimentalConditions:[]
0===e.length&&(e=[{id:null,name:"",values:[]}])
return e}async componentDidMount(){if(this.props.baseWorkflowTemplateVersionId&&!this.props.baseWorkflowTemplateVersion)try{await TX.lL(this.props.baseWorkflowTemplateVersionId)}catch(e){if(404!==e.status)throw e}}_isStageNamed(){return""!==this.state.stageName.trim()}_areConditionsNamed(){const e=this.state.experimentalConditions.filter((e=>e.values.some((e=>(e=>""!==e.textValue.trim())(e)))))
return e.every((e=>(e=>""!==e.name.trim())(e)))}_isSubmitEnabled(){return this._isStageNamed()&&this._areConditionsNamed()}_getButtons(){return l.default.compact([this.props.stageConfiguration&&{text:"Delete stage",style:C.ZJ.NEGATIVE,pullLeft:!0,onClick:this._handleDelete},{text:this.props.stageConfiguration?"Save":"Create stage",style:C.ZJ.PRIMARY,disabled:!this._isSubmitEnabled(),onClick:this._handleSubmit}])}_handleCreateExperimentalConditionValue({conditionIndex:e}){this.setState(Q()(this.state,{experimentalConditions:{[e]:{values:{$push:[{id:void 0,name:"",textValue:""}]}}}}))}_handleEditExperimentalConditionName({conditionIndex:e,name:t}){this.setState(Q()(this.state,{experimentalConditions:{[e]:{$merge:{name:t}}}}))}_handleEditExperimentalConditionValue({conditionIndex:e,valueIndex:t,textValue:n}){this.setState(Q()(this.state,{experimentalConditions:{[e]:{values:{[t]:{$merge:{textValue:n}}}}}}))}_handleDeleteExperimentalCondition({conditionIndex:e}){this.setState(Q()(this.state,{experimentalConditions:{$splice:[[e,1]]}}))}_handleDeleteExperimentalConditionValue({conditionIndex:e,valueIndex:t}){this.setState(Q()(this.state,{experimentalConditions:{[e]:{values:{$splice:[[t,1]]}}}}))}_getEntryTemplateDropdownDisplayName(){return this.state.baseStageConfigurationSummary?this.state.baseStageConfigurationSummary.entryTemplateName:"None"}_getEntryTemplateDropdownItems(){return[[this._getNewEntryTemplateItem(),...this._getBaseEntryTemplateItems()]]}_getNewEntryTemplateItem(){return{name:"None",handleOnClick:()=>{this.setState({baseStageConfigurationSummary:null})}}}_getBaseEntryTemplateItems(){const e=this.props.baseWorkflowTemplateVersion?this.props.baseWorkflowTemplateVersion:this.props.workflowTemplateVersion,makeItem=e=>({name:e.entryTemplateName,handleOnClick:()=>{this._setBaseStageConfigurationSummary(e)}})
return e.stageConfigurations.map((e=>makeItem(e)))}_setBaseStageConfigurationSummary(e){this.setState({baseStageConfigurationSummary:e})}render(){return d.createElement(et.ZP,{title:this.props.stageConfiguration?"Edit stage":"Create stage",onRequestClose:this.props.onRequestClose,buttons:this._getButtons()},d.createElement("div",null,d.createElement("div",{className:"u-spacing-bottom"},d.createElement(Jl.Z,{autoFocus:!0,type:Mo.Lq.TEXT,label:"Stage name",labelStyle:Jl.Z.LABEL_STYLES.LABEL,value:this.state.stageName,onChange:this._handleStageNameChange,placeholder:"Enter stage name here"})),d.createElement("div",{className:"u-spacing-bottom"},d.createElement(Fr.Z,{label:"Entry template"}),d.createElement(tc.Z,{displayName:this._getEntryTemplateDropdownDisplayName(),items:this._getEntryTemplateDropdownItems()})),d.createElement(Fr.Z,{label:d.createElement("div",{className:"u-verticallyCenterItems"},d.createElement("span",null,"Experimental conditions"),d.createElement(pe.Z,{className:"workflowConfigureScreen-compose u-pointer",icon:"compose",onClick:this._handleCreateExperimentalCondition}))}),this.state.experimentalConditions.map(((e,t)=>d.createElement("div",{key:t},d.createElement(bX,{experimentalCondition:e,onEditName:e=>{this._handleEditExperimentalConditionName({conditionIndex:t,name:e})},onDeleteCondition:()=>{this._handleDeleteExperimentalCondition({conditionIndex:t})},onCreateValue:()=>{this._handleCreateExperimentalConditionValue({conditionIndex:t})},onDeleteValue:e=>{this._handleDeleteExperimentalConditionValue({conditionIndex:t,valueIndex:e})},onEditValue:(e,n)=>{this._handleEditExperimentalConditionValue({conditionIndex:t,valueIndex:e,textValue:n})}}))))))}}ConfigureStageModal.propTypes={baseWorkflowTemplateVersionId:K.string,stageConfiguration:HR.po,workflowTemplateVersionId:K.string.isRequired,onRequestClose:K.func.isRequired,index:K.number,baseWorkflowTemplateVersion:HR.pd,workflowTemplateVersion:HR.pd.isRequired}
const vX=(0,_a.$j)((function ConfigureStageModal_mapStateToProps(e,{baseWorkflowTemplateVersionId:t,workflowTemplateVersionId:n}){const a=new HZ.xT(e.models.workflows)
return{baseWorkflowTemplateVersion:t?a.getWorkflowTemplateVersion(t):null,workflowTemplateVersion:a.getWorkflowTemplateVersion(n)}}))(ConfigureStageModal)
var CX=n(488423),IX=n(372721),wX=n(890711),NX=n(251647)
class BulkAddWorkflowInputsModal extends d.Component{constructor(){super(...arguments)
this.state={isUploading:!1,importedSamples:null}
this._isMounted=!1
this._handleSubmit=()=>{this.props.onRequestSubmit(this.state.importedSamples)}
this._handleSelectFile=async e=>{this.setState({isUploading:!0})
try{const t=await eH.ws(e),{samples:n}=await NX.zV(t,e.name)
this._isMounted&&n&&this.setState({importedSamples:n})}finally{this._isMounted&&this.setState({isUploading:!1})}}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}_getButtons(){return[{key:"add",onClick:this._handleSubmit,style:C.ZJ.PRIMARY,disabled:!this.state.importedSamples||0===this.state.importedSamples.length,submit:!0,text:"Add to workflow"}]}_renderInputsFoundText(){return d.createElement("span",null,function _getInputsFoundText(e){const t=e.filter((e=>null!=e.batchSummary)).length,n=e.filter((e=>null!=e.entitySummary)).length
if(0===t&&0===n)return"No valid batches or entities found.";(0,S.hu)(0===t||0===n,"Either batches or entities are expected, but not both.")
if(t>0)return`${t} ${1===t?"batch":"batches"} found.`
return`${n} ${1===n?"entity":"entities"} found.`}(this.state.importedSamples))}render(){return d.createElement(et.ZP,{className:"bulkAddWorkflowInputsModal",title:"Add input samples from spreadsheet",onRequestClose:this.props.onRequestClose,buttons:this._getButtons()},(()=>this.state.isUploading?d.createElement("div",{className:"text-center u-padding-top u-padding-bottom"},d.createElement(kl.Z,null)):this.state.importedSamples?this._renderInputsFoundText():d.createElement("div",null,d.createElement("span",null,"Upload a spreadsheet of sample names with a single column called"," ",dt.ZP.ENABLE_BATCHES?"either 'Batch' or ":"","'Entity'."),d.createElement(wX.Z,{accept:IX.xF,multiple:!1,onSelectFiles:this._handleSelectFile})))())}}BulkAddWorkflowInputsModal.propTypes={onRequestClose:J().func.isRequired,onRequestSubmit:J().func.isRequired}
const AX=BulkAddWorkflowInputsModal
var RX=n(837677)
class WorkflowInputTable extends d.Component{constructor(){super(...arguments)
this.state={isAddDropdownOpen:!1}
this._handleOpenAddDropdown=()=>{this.setState({isAddDropdownOpen:!0})}
this._handleCloseAddDropdown=()=>{this.setState({isAddDropdownOpen:!1})}
this._handleBulkAddWorkflowInputs=async()=>{const e=await(0,Xn.Z)(AX,{})
if(e){const t=e.map((e=>e.batchSummary?{inputType:RX.n$.BATCH,batch:e.batchSummary}:{inputType:RX.n$.FILE,file:e.entitySummary})),n=this.props.initialStageRunRows.filter((({batch:e,file:t})=>null!=e||null!=t))
this.props.initialStageRunRowsChanged([...n,...t])}}}_handleRowAdded(e){const t={inputType:e}
this.props.initialStageRunRowsChanged([...this.props.initialStageRunRows,t])}_handleBatchChanged(e,t){(0,S.Gp)(this.props.initialStageRunRows[e].inputType===RX.n$.BATCH,"Row is for selecting batch")
const n=this.props.initialStageRunRows.map(((n,a)=>a===e?{...n,batch:t}:n))
this.props.initialStageRunRowsChanged(n)}_handleFileChanged(e,t){(0,S.Gp)(this.props.initialStageRunRows[e].inputType===RX.n$.FILE,"Row is for selecting entity")
const n=this.props.initialStageRunRows.map(((n,a)=>a===e?{...n,file:t}:n))
this.props.initialStageRunRowsChanged(n)}_handleRowDeleted(e){const t=this.props.initialStageRunRows.filter(((t,n)=>n!==e))
this.props.initialStageRunRowsChanged(t)}_getAddMenuItems(){const e=[]
dt.ZP.ENABLE_BATCHES&&e.push({name:"Add batch",icon:"compose",handleOnClick:()=>{this._handleRowAdded(RX.n$.BATCH)}})
e.push({name:"Add entity",icon:"compose",handleOnClick:()=>{this._handleRowAdded(RX.n$.FILE)}})
e.push({name:"Import from spreadsheet",icon:"upload",handleOnClick:this._handleBulkAddWorkflowInputs})
return[e]}_renderHeader(){return d.createElement("div",{className:"simpleDivTable-headerCell"},d.createElement("div",{className:"u-small-spacing-bottom u-vertical-center-items"},d.createElement("span",null,"Input Samples"),d.createElement(Hy.ZP,{menu:d.createElement(LR.Z,{items:this._getAddMenuItems(),className:"workflowTable-addDropdown"}),onRequestClose:this._handleCloseAddDropdown,open:this.state.isAddDropdownOpen,shouldCloseOnInsideClick:!0},d.createElement(pe.Z,{className:"workflowInputTable-addButton u-small-spacing-left",icon:"compose",onClick:this._handleOpenAddDropdown}))))}_renderDeleteButtonHeader(){return d.createElement("div",{className:"workflowInputTable-deleteIcon-placeholder"})}_renderRow(e,t){return d.createElement("div",{className:"simpleDivTable-row workflowConfigureScreen-deletable-row",key:e},d.createElement("div",{className:"simpleDivTable-cell"},t.inputType===RX.n$.BATCH?d.createElement(CX.Z,{autoFocus:!1,onChange:t=>{this._handleBatchChanged(e,t.length?t[0]:null)},selectedBatches:t.batch?[t.batch]:[]}):d.createElement(cw.Z,{onChange:t=>{this._handleFileChanged(e,t.length?t[0]:null)},selectedItems:t.file?[t.file]:[]})),d.createElement("div",{className:"workflowInputTable-deleteIcon-placeholder u-flex-display"},d.createElement(pe.Z,{className:"workflowConfigureScreen-delete faded u-danger-pointer",icon:"delete",onClick:()=>{this._handleRowDeleted(e)}})))}render(){return d.createElement("div",{className:"metadata-table simpleDivTable workflowInputTable"},d.createElement("div",{className:"simpleDivTable-header"},this._renderHeader(),this._renderDeleteButtonHeader()),(()=>this.props.initialStageRunRows.map(((e,t)=>this._renderRow(t,e))))())}}WorkflowInputTable.propTypes={initialStageRunRows:K.arrayOf(K.shape({batch:YZ.lD,file:K.shape({id:K.string.isRequired,name:K.string.isRequired}),inputType:K.oneOf([RX.n$.BATCH,RX.n$.FILE]).isRequired}).isRequired).isRequired,initialStageRunRowsChanged:K.func.isRequired}
const PX=WorkflowInputTable
function ConfigureStep(e){return d.createElement("div",{className:"configureStep-container"},d.createElement("div",{className:"configureStep-header"},d.createElement("div",{className:"configureStep-step"},e.stepNumber),d.createElement("div",{className:"configureStep-title"},e.title)),d.createElement("div",null,e.children))}ConfigureStep.propTypes={stepNumber:K.number.isRequired,title:K.string,children:K.node}
const OX=ConfigureStep
function StageEntryTemplateLink(e){return d.createElement("span",{className:"workflows-internalLinkContainer"},d.createElement("span",{className:"internalLink internalLink-content"},d.createElement("a",{onClick:e.onClick},d.createElement(pe.Z,{icon:(0,ea.qz)(e.stageConfiguration.id)}),e.stageConfiguration.entryTemplateName)))}StageEntryTemplateLink.propTypes={stageConfiguration:HR.m_.isRequired,onClick:K.func}
const xX=StageEntryTemplateLink
var _X,DX=n(114550),LX=n(237609),kX=n(442285),MX=n(364612),FX=n(816456),ZX=n(66584)
!function(e){e.NOTES_TAB="NOTES_TAB"
e.METADATA_TAB="METADATA_TAB"
e.REVIEW_TAB="REVIEW_TAB"}(_X||(_X={}))
class WorkflowEntryTemplateModalConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[FX.Z]}enhanceProps(){if(!this.workflowEntryTemplateStore().inStore(this.props.entryTemplate.id))return{templateVersionFromStore:null}
const{entryTemplate:e}=this.workflowEntryTemplateStore().getEditorState(this.props.entryTemplate.id)
return{templateVersionFromStore:e?e.templateVersion:null}}}class WorkflowEntryTemplateModal extends d.PureComponent{constructor(){super(...arguments)
this._isMounted=!1
this.state={activeTab:_X.NOTES_TAB,historyManager:new ML.Z,name:this._getInitialEntryTemplateName(),note:this._transformNoteFromStoreForState(),templateVersion:this.props.templateVersionFromStore}
this._getIdFromCid=e=>FX.Z.getIdFromCid(this.props.entryTemplate.id,e)
this._registerObjects=e=>{MX.Ws(this.props.entryTemplate.id,e)}
this._restoreStateAndSelection=({note:e,title:t},n)=>{DX.Z(n)
this.setState({note:e,name:t})}
this._updateNote=e=>{const t=this.state.note,n=kX.hT(e,t),a=this._getUpdater().run(n,t)
this.setState({note:a})}
this._updateTitle=e=>{this.setState({name:e})}
this._handleClose=()=>{(this._hasUnsavedChanges()?je.iG("Discard Changes?","There are unsaved changes to your workflow template. Are you sure you would like to discard them?","danger",{acceptText:"Discard",rejectText:"Cancel"}):new Promise((e=>{e()}))).then(this.props.onClose)}
this._handleSubmit=()=>{const{note:e,name:t}=this.state
MX.di(this.props.entryTemplate.id,e,t,{onSuccess:this.props.onClose})}}componentDidMount(){this._isMounted=!0
this.state.templateVersion||MX.jX(this.props.entryTemplate.id)}componentWillUnmount(){MX.C2(this.props.entryTemplate.id)
this._isMounted=!1}componentDidUpdate(e){if(this.props.entryTemplate.id!==e.entryTemplate.id)throw new Error("Can't change the template while editing")
if(!this.state.templateVersion&&!Is()(this.props.templateVersionFromStore,e.templateVersionFromStore)){const e=this.props.templateVersionFromStore
this.setState({templateVersion:e,note:this._getNote(e)})}}_getUpdater(){return new LX.Z(this.props.entryTemplate.id,(()=>this.state.note),(e=>{this._isMounted&&this._updateNote(e)}))}_transformNoteFromStoreForState(){const e=this._getNote(this.props.templateVersionFromStore)
return e?this._getUpdater().run(e,null):null}_getNote(e){return e?e.entryVersion.note:null}_getInitialNote(){return this._getNote(this.state.templateVersion)}_hasUnsavedChanges(){return this.state.note!==this._getInitialNote()}_handleSetActiveTab(e){this.setState({activeTab:e})}_getButtons(){if(this.props.isReadonly)return[{style:C.ZJ.TERTIARY_GRAY,text:"Done",cancel:!0}]
return[{text:"Save",style:C.ZJ.PRIMARY,submit:!0,disabled:null===this.state.templateVersion}]}_getEntryTemplateName(e){return e[ZX.CC(e.id)]}_getInitialEntryTemplateName(){return this._getEntryTemplateName(this.props.entryTemplate)}_renderNoteView(){var e
return d.createElement(BA.k.Provider,{value:{note:null!==(e=this.state.note)&&void 0!==e?e:void 0}},d.createElement(VA.WP,{fileId:this.props.entryTemplate.id,fileType:this.props.fileType,note:this.state.note,title:this.state.name,updateNote:this._updateNote,updateTitle:this._updateTitle,restoreStateAndSelection:this._restoreStateAndSelection,historyManager:this.state.historyManager,preview:{showOpenLink:!0,followLink:!0},disableFormatting:!1,disableMaximizedTables:!0,parentType:"Workflow Entry Template",locked:this.props.isReadonly,banner:this.props.isReadonly?"Editing disabled on read-only template.":null,printOptions:[],showTimestamps:!1,spellCheck:!1,printLayout:!0,showTableOfContents:!1,showPrintMargins:!1,registerObjects:this._registerObjects,getIdFromCid:this._getIdFromCid,permissions:this.props.entryTemplate.permissions}))}_renderMetadataView(){const e=this.props.entryTemplate,t=e.permissions,n=l.default.sortBy(e.tags,"name")
return d.createElement(JR,{banner:this.props.isReadonly?"Editing disabled on read-only template.":null,fileId:this.props.entryTemplate.id,fileName:e.stageName,updateName:async()=>{},permissions:t,isRegistryWritable:t.writable,tags:n,hasCustomTagSupport:!0,hasFileSchemaSupport:!0,hasRegistrySupport:!1,tagSchema:e.tagSchema,shouldAllowChangeCollection:!1,onAnalyzeProteins:()=>{}})}_renderTemplate(){const e=this.props.entryTemplate.id,t=ea.ZP.apiIdToType(e),n=[_X.NOTES_TAB]
dt.ZP.ENABLE_ENTRY_SCHEMAS&&aw.DN(e)&&n.push(_X.METADATA_TAB)
dt.ZP.ENABLE_ELN_REVIEW_CRITERIA&&cA.Qs(t)&&n.push(_X.REVIEW_TAB)
return 1===n.length?this._renderNoteView():d.createElement("div",{className:"workflowEntryTemplateModal-tabContainer u-flex-grow"},d.createElement(KW.Z,{tabs:n.map((e=>({handleClick:()=>{this._handleSetActiveTab(e)},isActive:this.state.activeTab===e,text:{[_X.NOTES_TAB]:"Notes",[_X.METADATA_TAB]:"Metadata",[_X.REVIEW_TAB]:"Review"}[e]})))}),d.createElement("div",{className:"workflowEntryTemplateModal-tabPane"},d.createElement(BA.q.Provider,{value:{showFormulas:!1,fileId:e}},(()=>{switch(this.state.activeTab){case _X.NOTES_TAB:return this._renderNoteView()
case _X.METADATA_TAB:return this._renderMetadataView()
case _X.REVIEW_TAB:return d.createElement(Nk,{fileId:e,permissions:{writable:!this.props.isReadonly}})
default:throw new Error(`Invalid tab "${this.state.activeTab}"`)}})())))}render(){return d.createElement(et.ZP,{className:"modal--mediocre",fullWidth:!0,title:this.props.isReadonly?this._getInitialEntryTemplateName():"Edit Template",onRequestClose:this._handleClose,onRequestSubmit:this.props.isReadonly?null:this._handleSubmit,buttons:this._getButtons(),wrapInForm:!1,closeableOnEscapeKey:!1},null!=this.state.templateVersion?this._renderTemplate():d.createElement("div",{className:"text-center u-padding-top"},d.createElement(kl.Z,null)))}}WorkflowEntryTemplateModal.propTypes={entryTemplate:HR.kK.isRequired,isReadonly:J().bool.isRequired,fileType:J().oneOf(HR.AD),onClose:J().func,templateVersionFromStore:J().object}
const BX=WorkflowEntryTemplateModalConnector.connect(WorkflowEntryTemplateModal)
var qX=n(886150)
class StageConfigurationTable extends d.Component{constructor(){super(...arguments)
this.state={editingStageEntryTemplate:null}
this._handleStageEntryTemplateClicked=e=>{this.setState({editingStageEntryTemplate:e})}
this._handleCloseStageEntryTemplateModal=()=>{this.setState({editingStageEntryTemplate:null})}
this._handleDeleteStageConfiguration=e=>{je.iG("Confirm Delete Stage",`Are you sure you want to delete the stage ${e.stageName}? This action cannot be undone.`,"danger").done((()=>{TX.xt(e.id)}))}
this._handleReorderStageConfiguration=(e,t)=>{TX.ny(e,t)}}UNSAFE_componentWillReceiveProps(e){const{editingStageEntryTemplate:t}=this.state
if(!t)return
const n=e.stageConfigurations.find((e=>e.id===t.id))
n&&this.setState({editingStageEntryTemplate:{...t,tags:n.tags,tagSchema:n.tagSchema}})}_getHeaderCells(){return[{key:"stage",contents:d.createElement("div",{className:"u-vertical-center-items"},d.createElement("span",null,"Stage"),this.props.isEditable&&d.createElement(vy.Z,{onClick:this.props.onCreateStageConfiguration}))},{key:"template",contents:"Entry Template"},{key:"conditions",contents:"Experimental Conditions"},{key:"hover icons",contents:""}]}_getRows(){return this.props.stageConfigurations.map((e=>{const t=l.default.flatten(e.experimentalConditions.map((e=>e.values))),n=this.props.isEditable&&d.createElement("div",{className:"stageConfigurationTable-hoverIcons"},d.createElement(xI.Z,{key:`edit-${e.id}`,icon:"edit",onClick:this.props.onEditStageConfiguration,result:e}),d.createElement(xI.Z,{key:`delete-${e.id}`,icon:"delete",onClick:this._handleDeleteStageConfiguration,result:e}))
return{id:e.id,cells:[{key:"name",contents:e.stageName},{key:"template",contents:d.createElement(xX,{stageConfiguration:e,onClick:()=>{this._handleStageEntryTemplateClicked(e)}})},{key:"conditions",contents:t.length?d.createElement(Oe.Z,{renderContent:()=>d.createElement(qX.bR,{experimentalConditions:e.experimentalConditions})},d.createElement("span",null,(0,qX.yZ)(t))):d.createElement("span",{className:"u-faded"},"None")},{key:"hover icons",contentsClassName:"u-justify-content-end",contents:n}]}}))}render(){return d.createElement("div",null,this.state.editingStageEntryTemplate&&d.createElement(M_.Z,{open:!0},d.createElement(BX,{entryTemplate:this.state.editingStageEntryTemplate,fileType:st.STAGE_CONFIGURATION,isReadonly:!this.props.isEditable,onClose:this._handleCloseStageEntryTemplateModal})),d.createElement(KK.Z,{headerCells:this._getHeaderCells(),isDraggingDisabled:!this.props.isEditable,noRowsText:"No stages",onReorderRow:this._handleReorderStageConfiguration,rows:this._getRows()}))}}StageConfigurationTable.propTypes={isEditable:K.bool.isRequired,onCreateStageConfiguration:K.func,onEditStageConfiguration:K.func,stageConfigurations:K.arrayOf(HR.po.isRequired).isRequired}
const VX=StageConfigurationTable
class CrumbLink extends d.Component{render(){return this.props.isLoading?d.createElement("span",{className:this.props.className},"..."):d.createElement("a",{className:this.props.className,onClick:this.props.onClick},this.props.children)}}CrumbLink.defaultProps={className:"genericBreadcrumbs-link"}
class Breadcrumbs_Breadcrumbs extends d.Component{constructor(){super(...arguments)
this._renderCrumbs=e=>0===e.length?[]:1===e.length?e.concat(" / "):[e[0]," / ",d.createElement("span",{key:"sub-crumbs"},this._renderCrumbs(e.slice(1)))]}render(){const e=d.Children.toArray(this.props.children)
return d.createElement("div",{className:f()(this.props.className,"legacy-font-proxima-13")},this._renderCrumbs(e))}}Breadcrumbs_Breadcrumbs.defaultProps={className:"genericBreadcrumbs"}
const UX=Breadcrumbs_Breadcrumbs
function showWorkflowAuthorsHelp(e){(0,ue._8)(e,"Workflow Authors",d.createElement("div",null,"Workflow authors only affect the workflow itself, and do not affect the entries inside the workflow."))}class WorkflowSettingsModal extends d.Component{constructor(){super(...arguments)
this.state={description:this.props.workflow.description,rootFolderId:this._getRootFolderId(),nameInputValue:this.props.workflow.name,authors:this.props.workflow.authors}
this._handleSetNameInputValue=({target:{value:e}})=>{this.setState({nameInputValue:e})}
this._handleChangeProject=({target:{value:e}})=>{this.setState({rootFolderId:e})}
this._handleChangeDescription=({target:{value:e}})=>{this.setState({description:e})}
this._handleChangeAuthors=e=>{this.setState({authors:e})}
this._handleDeleteWorkflow=()=>{let e,t
const n="Are you sure you want to delete this workflow? This action cannot be undone."
if(this.props.workflow.initializationDatas.length>0){e="Confirm delete workflow that fulfills requests"
t=d.createElement("span",null,d.createElement("strong",null,"This workflow fulfills requests.")," ",n)}else{e="Confirm delete workflow"
t=d.createElement("span",null,n)}je.iG(e,t,"danger").done((()=>{dc._I(this.props.workflow.id)
this.props.onRequestClose()}))}
this._handleRequestSubmit=()=>{const e={}
this.props.workflow.name!==this.state.nameInputValue&&(e.name=this.state.nameInputValue)
null!=this.state.description&&this.props.workflow.description!==this.state.description&&(e.description=this.state.description)
this._getRootFolderId()!==this.state.rootFolderId&&(e.rootFolderId=this.state.rootFolderId)
Is()(l.default.pluck(this.props.workflow.authors,"id"),l.default.pluck(this.state.authors,"id"))||(e.authorIds=l.default.pluck(this.state.authors,"id"))
dc.X$(this.props.workflow.id,e)
this.props.onRequestClose()}}_getRootFolderId(){return this.props.workflow.folder?this.props.workflow.folder.api_identifier:this.props.workflow.source.rootFolder.api_identifier}_getAuthorTags(){return this.state.authors.map((({handle:e,id:t})=>({id:t,handle:e,text:e})))}_getButtons(){const e=[{text:"Save",style:C.ZJ.PRIMARY,disabled:0===this.state.nameInputValue.length,submit:!0,key:"save"}]
dt.ZP.LEGACY_WORKFLOWS_ALLOW_DELETION&&e.push({text:"Delete workflow",style:C.ZJ.NEGATIVE,pullLeft:!0,onClick:this._handleDeleteWorkflow,key:"delete"})
return e}render(){return d.createElement(et.ZP,{title:`Manage ${this.props.workflow.humanId}`,onRequestClose:this.props.onRequestClose,onRequestSubmit:this._handleRequestSubmit,buttons:this._getButtons()},d.createElement(h.Z,null,d.createElement(p.Z,{xs:6},d.createElement(Jl.Z,{autoFocus:!0,label:"Name",labelStyle:Jl.Z.LABEL_STYLES.LABEL,value:this.state.nameInputValue,onChange:this._handleSetNameInputValue})),this.props.workflow.permissions.writable&&d.createElement(p.Z,{xs:6},d.createElement(Fr.Z,{label:"Folder"}),d.createElement(Ye.Z,{noFolderText:"Choose Folder",value:this.state.rootFolderId,onChange:this._handleChangeProject,showInventory:!1,showNotebook:!0,showRegistries:!1,unsetOnFetchFail:!0}))),d.createElement(h.Z,null,d.createElement(p.Z,{xs:12},d.createElement(Fr.Z,{label:"Authors"}),d.createElement("a",{onClick:showWorkflowAuthorsHelp,className:"u-tiny-spacing-left"},d.createElement(pe.Z,{icon:"circle-question"})),d.createElement(tA.D,{allowAdjustInputWidth:!1,allowTeams:!1,allowOrganizations:!1,onChange:this._handleChangeAuthors,organizationIds:Jn.Z.currentUser().organizations.map((({id:e})=>e)),size:nA.I.SMALL,value:this._getAuthorTags()}))),d.createElement(h.Z,null,d.createElement(p.Z,{xs:12},d.createElement(Fr.Z,{label:"Description"}),d.createElement("textarea",{className:"workflowSettingsModal-description",value:this.state.description||"",onChange:this._handleChangeDescription,rows:3}))))}}WorkflowSettingsModal.propTypes={onRequestClose:J().func.isRequired,workflow:HR.bn.isRequired}
const GX=WorkflowSettingsModal
var zX
!function(e){e.WORKFLOW_STAGE_FLOW_NODE_FETCH_COMPLETED="WORKFLOW_STAGE_FLOW_NODE_FETCH_COMPLETED"
e.WORKFLOW_WORKFLOW_TEMPLATE_VERSION_DETAILS_FETCH_COMPLETED="WORKFLOW_WORKFLOW_TEMPLATE_VERSION_DETAILS_FETCH_COMPLETED"
e.WORKFLOW_STAGE_CONFIGURATION_FETCH_COMPLETED="WORKFLOW_STAGE_CONFIGURATION_FETCH_COMPLETED"}(zX||(zX={}))
function StageFlowNodeActions_editStageFlowNode(e,{parentIds:t,experimentalConditionValueIds:n}){$e.$Z();(function editStageFlowNode(e,{parentIds:t,experimentalConditionValueIds:n}){return Cn.Yh({url:`/1/api/workflows/stage-flow-nodes/${e}`,data:{parentIds:t,experimentalConditionValueIds:n}})})(e,{parentIds:t,experimentalConditionValueIds:n}).done((({stageFlowNode:e,stageRun:t})=>{(0,Vn.getStore)().dispatch({type:zX.WORKFLOW_STAGE_FLOW_NODE_FETCH_COMPLETED,stageFlowNode:e,stageRun:t})})).fail(v.ZP.notifyError).always((()=>{$e.Cp()}))}function StageFlowNodeActions_deleteStageFlowNode(e,{shouldDeleteDownstreamNodes:t}){$e.$Z();(function deleteStageFlowNode(e,{shouldDeleteDownstreamNodes:t}){return Cn.$v({url:`/1/api/workflows/stage-flow-nodes/${e}`,data:{shouldDeleteDownstreamNodes:t}})})(e,{shouldDeleteDownstreamNodes:t}).done((({workflowTemplateVersion:e,stageConfigurations:t,stageFlowNodes:n})=>{(0,Vn.getStore)().dispatch({type:zX.WORKFLOW_WORKFLOW_TEMPLATE_VERSION_DETAILS_FETCH_COMPLETED,workflowTemplateVersion:e,stageConfigurations:t,stageFlowNodes:n})})).fail(v.ZP.notifyError).always((()=>{$e.Cp()}))}function StageFlowNodeActions_createStageFlowNode({stageConfigurationId:e,parentIds:t}){$e.$Z();(function createStageFlowNode({stageConfigurationId:e,parentIds:t}){return Cn.ty({url:"/1/api/workflows/stage-flow-nodes",data:{stageConfigurationId:e,parentIds:t}})})({stageConfigurationId:e,parentIds:t}).done((({stageConfiguration:e,stageFlowNode:t})=>{(0,Vn.getStore)().dispatch({type:zX.WORKFLOW_STAGE_FLOW_NODE_FETCH_COMPLETED,stageFlowNode:t});(0,Vn.getStore)().dispatch({type:zX.WORKFLOW_STAGE_CONFIGURATION_FETCH_COMPLETED,stageConfiguration:e})})).fail(v.ZP.notifyError).always((()=>{$e.Cp()}))}function StageFlowNodeActions_duplicateStageFlowNodeTree({stageFlowNodeId:e}){$e.$Z();(function duplicateStageFlowNodeTree({stageFlowNodeId:e}){return Cn.ty({url:`/1/api/workflows/stage-flow-nodes/${e}:duplicate`})})({stageFlowNodeId:e}).done((({workflowTemplateVersion:e,stageConfigurations:t,stageFlowNodes:n})=>{(0,Vn.getStore)().dispatch({type:zX.WORKFLOW_WORKFLOW_TEMPLATE_VERSION_DETAILS_FETCH_COMPLETED,workflowTemplateVersion:e,stageConfigurations:t,stageFlowNodes:n})})).fail(v.ZP.notifyError).always((()=>{$e.Cp()}))}function StageFlowNodeActions_explodeStageFlowNodeTree({stageFlowNodeId:e}){$e.$Z();(function explodeStageFlowNodeTree({stageFlowNodeId:e}){return Cn.ty({url:`/1/api/workflows/stage-flow-nodes/${e}:explode`})})({stageFlowNodeId:e}).done((({workflowTemplateVersion:e,stageConfigurations:t,stageFlowNodes:n})=>{(0,Vn.getStore)().dispatch({type:zX.WORKFLOW_WORKFLOW_TEMPLATE_VERSION_DETAILS_FETCH_COMPLETED,workflowTemplateVersion:e,stageConfigurations:t,stageFlowNodes:n})})).fail(v.ZP.notifyError).always((()=>{$e.Cp()}))}const $X="virtual_node_"
class VirtualNodeGraph extends TaggedNodeGraph{constructor(e,t){super()
this.nodes=t
this.originalGraph=e}getNodeIds(){return l.default.pluck(this.nodes,"id")}getNode(e){return l.default.findWhere(this.nodes,{id:e})}getParentNodeIds(e){return this.getNode(e).parentIds}getTag(e){return this.getNode(e).stageIndex}getTags(){return this.originalGraph.getTags()}getOriginalNodeIds(){return this.originalGraph.getNodeIds()}getOriginalParentNodeIds(e){return this.originalGraph.getParentNodeIds(e)}getVirtualNodeIds(){return l.default.pluck(this.nodes.filter((e=>!this.originalGraph.getNodeIds().includes(e.id))),"id")}isVirtual(e){return this.getVirtualNodeIds().includes(e)}getExperimentalConditionValues(e){return this.isVirtual(e)?[]:this.originalGraph.getExperimentalConditionValues(e)}getName(e){return this.isVirtual(e)?null:this.originalGraph.getName(e)}getStatus(e){return this.isVirtual(e)?nB._A:this.originalGraph.getStatus(e)}setParentNodeIds(e,t){const n=this.nodes.map((n=>n.id===e?{...n,parentIds:t}:n))
return new VirtualNodeGraph(this.originalGraph,n)}addVirtualNodes(e){return new VirtualNodeGraph(this.originalGraph,[...this.nodes,...e])}addNodesOnLinks(e){const t=e.map((e=>({id:l.default.uniqueId($X),parentIds:e.parentId?[e.parentId]:[],stageIndex:e.stageIndex,link:e}))),newParentIds=n=>{const a=l.default.findWhere(e,{parentId:null,childId:n})
return a?[l.default.findWhere(t,{link:a}).id]:[]},n=this.nodes.map((n=>({...n,parentIds:[...n.parentIds.map((a=>((n,a)=>{const i=l.default.findWhere(e,{parentId:n,childId:a})
return i?l.default.findWhere(t,{link:i}).id:n})(a,n.id))),...newParentIds(n.id)]})))
return new VirtualNodeGraph(this.originalGraph,[...n,...t])}}function createVirtualNodeGraph(e){const t=e.getNodeIds().map((t=>({id:t,parentIds:e.getParentNodeIds(t),stageIndex:e.getTag(t)})))
return new VirtualNodeGraph(e,t)}const WX=236,HX=J().shape({x:J().number.isRequired,y:J().number.isRequired})
function GraphLayout_getSum(e){return e.reduce(((e,t)=>e+t),0)}class GraphLayout{constructor(e,t){this.graph=e
this.stageRunRadius=t
this.verticalSpacing=3*t
this.getNodePosition=l.default.memoize(this.getNodePosition)
this.getX=l.default.memoize(this.getX)
this.getY=l.default.memoize(this.getY)
this.getSubtreeHeight=l.default.memoize(this.getSubtreeHeight)
this.getTreeHeight=l.default.memoize(this.getTreeHeight)
this.getRelativeX=l.default.memoize(this.getRelativeX)
this.getTagWidth=l.default.memoize(this.getTagWidth)
this.getLinks=l.default.memoize(this.getLinks)}getNodePosition(e){return{x:this.getX(e),y:this.getY(e)}}getX(e){const t=this.graph.getTag(e)
return GraphLayout_getSum(l.default.range(t).map((e=>this.getTagWidth(e))))+this.getRelativeX(e)}getY(e){const t=this.graph.getPrimaryParentNodeId(e)
return(t?this.getY(t):this.verticalSpacing)+GraphLayout_getSum(this.graph.getSiblingsAboveNode(e).map((e=>this.getSubtreeHeight(e))))}getSubtreeHeight(e){const t=this.graph.getPrimaryChildNodeIds(e)
return t.length?GraphLayout_getSum(t.map((e=>this.getSubtreeHeight(e)))):this.verticalSpacing}getTreeHeight(){return GraphLayout_getSum(this.graph.getInitialNodeIds().map((e=>this.getSubtreeHeight(e))))+this.verticalSpacing}getRelativeX(e){const t=this.graph.getTag(e),n=this.graph.getPrimaryParentNodeId(e)
if(n){if(this.graph.getTag(n)===t){return this.getRelativeX(n)+2*this.stageRunRadius+8}}return this.stageRunRadius+8}getTagWidth(e){const t=this.graph.getNodeIdsByTag(e).map((e=>this.getRelativeX(e))),n=Math.max(...t)+this.stageRunRadius+60
return Math.max(150,n)}getLinks({leftBoundary:e,rightBoundary:t}){return[...this.graph.getInitialNodeIds().map((t=>{const n=this.getNodePosition(t)
return{key:`beginning - ${t}`,leftPosition:{x:e,y:n.y},rightPosition:n,parentNodeId:null,childNodeId:t,isSecondary:!1}})),...l.default.flatten(this.graph.getNodeIds().map((e=>{const n=this.getNodePosition(e),a=this.graph.getPrimaryChildNodeIds(e),i=this.graph.getSecondaryChildNodeIds(e)
if(a.length>0||i.length>0){return[...a.map((t=>({key:`${e} - ${t}`,leftPosition:n,rightPosition:this.getNodePosition(t),parentNodeId:e,childNodeId:t,isSecondary:!1}))),...i.map((t=>({key:`${e} - ${t}`,leftPosition:n,rightPosition:this.getNodePosition(t),parentNodeId:e,childNodeId:t,isSecondary:!0})))]}return[{key:`${e} - end`,leftPosition:n,rightPosition:{x:t,y:n.y},parentNodeId:e,childNodeId:null,isSecondary:!1}]})))]}isTallVisualization(){return this.getTreeHeight()+84>WX}getTotalWidthIgnoringScrollbar(e){const t=GraphLayout_getSum(this.graph.getTags().map((e=>this.getTagWidth(e))))
return Math.max(e,t+150)}getTotalHeightIgnoringScrollbar(){return this.isTallVisualization()?Math.max(WX,this.getTreeHeight()+42):WX}overflowsHorizontally(e){return e<this.getTotalWidthIgnoringScrollbar(e)}overflowsVertically(){return WX<this.getTotalHeightIgnoringScrollbar()}getTotalWidth(e){const t=this.getTotalWidthIgnoringScrollbar(e)
return this.overflowsVertically()?t-8:t}getTotalHeight(e){const t=this.getTotalHeightIgnoringScrollbar()
return this.overflowsHorizontally(e)?t-8:t}}var jX
!function(e){e.HIGHLIGHTED="HIGHLIGHTED"
e.DEFAULT="DEFAULT"
e.DEHIGHLIGHTED="DEHIGHLIGHTED"}(jX||(jX={}))
function getNodeHighlightMode(e,{clickedUpstreamNodeId:t,clickedDownstreamNodeId:n,taggedNodeGraph:a}){const i=null!=t&&a.isValidNodeId(t),s=null!=n&&a.isValidNodeId(n)
return i||s?i&&a.isDescendant(t,e)||s&&a.isDescendant(e,n)?jX.HIGHLIGHTED:jX.DEHIGHLIGHTED:jX.DEFAULT}function getLinkHighlightMode(e,t,{clickedUpstreamNodeId:n,clickedDownstreamNodeId:a,taggedNodeGraph:i}){const s=null!=n&&i.isValidNodeId(n),r=null!=a&&i.isValidNodeId(a)
return s||r?s&&t&&i.isDescendant(n,t)||r&&e&&i.isDescendant(e,a)||e===n&&t===a?jX.HIGHLIGHTED:jX.DEHIGHLIGHTED:jX.DEFAULT}function StageRunLinkVisualization({highlightMode:e,isDiscarded:t,onClick:n,leftPosition:a,rightPosition:i}){(0,S.Gp)(a.x<=i.x,"Expected leftPosition to be left of rightPosition");(0,S.Gp)(a.y<=i.y,"Expected leftPosition to be above rightPosition")
const s=Math.min(4,i.x-a.x,i.y-a.y),r=function getArc({rx:e,ry:t,xAxisRotation:n,largeArcFlag:a,sweepFlag:i,x:s,y:r}){return`A ${e} ${t} ${n} ${a} ${i} ${s} ${r}`}({rx:s,ry:s,xAxisRotation:0,largeArcFlag:0,sweepFlag:0,x:a.x+s,y:i.y}),o=`\n    M ${a.x} ${a.y}\n    V ${i.y-s}\n    ${r}\n    H ${i.x}\n  `
return d.createElement("g",null,d.createElement("path",{className:f()("stageRunLinkVisualization-line",{"stageRunLinkVisualization-line--discarded":t,"is-dehighlighted":e===jX.DEHIGHLIGHTED}),d:o}),n&&d.createElement("path",{className:"stageRunLinkVisualization-clickTarget",d:o,onClick:n}))}StageRunLinkVisualization.propTypes={highlightMode:J().oneOf(Object.values(jX)).isRequired,isDiscarded:J().bool.isRequired,onClick:J().func,leftPosition:HX,rightPosition:HX}
function StageRunCircle(e){const{className:t,stageRunStatus:n,position:a,radius:i,highlightMode:s,isHovered:r}=e,o=i/2
return d.createElement("g",null,d.createElement("circle",{className:f()(t,"stageRunVisualization",{"stageRunVisualization--initialized":n===nB.Ov.INITIALIZED,"stageRunVisualization--completed":n===nB.Ov.COMPLETED,"stageRunVisualization--discarded":n===nB.Ov.DISCARDED,"stageRunVisualization--virtual":n===nB._A,"is-dehighlighted":s===jX.DEHIGHLIGHTED,"is-hovered":r}),cx:a.x,cy:a.y,r:i}),(()=>{switch(n){case nB.Ov.DISCARDED:return d.createElement("path",{className:f()(t,"stageRunVisualization--discarded","stageRunVisualization-x"),d:`M ${a.x+o} ${a.y+o}\n                    L ${a.x-o} ${a.y-o}\n                    M ${a.x-o} ${a.y+o}\n                    L ${a.x+o} ${a.y-o}`})
case nB.Ov.COMPLETED:return d.createElement("path",{className:"stageRunVisualization-check",d:`M ${a.x-o} ${a.y}\n                    L ${a.x-i/3} ${a.y+3*i/8}\n                    L ${a.x+o} ${a.y-3*i/8}`})
default:return null}})())}StageRunCircle.propTypes={className:J().string,highlightMode:J().oneOf(Object.values(jX)).isRequired,isHovered:J().bool.isRequired,position:HX.isRequired,radius:J().number.isRequired,stageRunStatus:J().oneOf([...Object.values(nB.Ov),nB._A]).isRequired}
StageRunCircle.defaultProps={className:"stageFlowNodeVisualization--default"}
function StageFlowNodeSecondaryLinkVisualization(e){const{highlightMode:t,isDiscarded:n,onClick:a,leftPosition:i,rightPosition:s}=e,r=`\n    M ${i.x} ${i.y}\n    L ${s.x} ${s.y}\n  `
return d.createElement("g",null,d.createElement("path",{className:f()("stageFlowNodeSecondaryLinkVisualization",{"stageRunLinkVisualization-line--discarded":n,"is-default":t===jX.DEFAULT,"is-dehighlighted":t===jX.DEHIGHLIGHTED}),d:r}),a&&d.createElement("path",{className:"stageRunLinkVisualization-clickTarget",d:r,onClick:a}))}StageFlowNodeSecondaryLinkVisualization.propTypes={highlightMode:J().oneOf(Object.values(jX)).isRequired,isDiscarded:J().bool.isRequired,onClick:J().func,leftPosition:HX,rightPosition:HX}
StageFlowNodeSecondaryLinkVisualization.defaultProps={isDiscarded:!1}
class StageFlowNodeVisualization extends d.Component{_renderNode(){const{isNodeClickable:e,onClick:t,onRightClick:n,onHover:a,onUnhover:i,position:s,className:r,highlightMode:o,isHovered:l,stageRunStatus:c}=this.props
return d.createElement("g",{className:f()({"u-pointer":e}),onClick:t,onContextMenu:n,onMouseEnter:a,onMouseLeave:i},d.createElement("circle",{className:"stageRunVisualization-background",cx:s.x,cy:s.y,r:6}),d.createElement(StageRunCircle,{className:r,highlightMode:o,isHovered:l,position:s,radius:6,stageRunStatus:c||nB.Ov.INITIALIZED}))}_renderTooltipNode(){return d.createElement(P.pf,{tooltipTitle:this.props.tooltipTitle},this._renderNode())}render(){const{shouldShowExperimentalCondition:e,experimentalConditionValues:t,position:n,stageWidth:a,relativeX:i}=this.props
return d.createElement("g",null,this._renderTooltipNode(),e&&t.length>0&&d.createElement("foreignObject",{x:n.x+6+5,y:n.y-14,height:20,width:a-i-12},d.createElement("div",{className:"stageFlowNodeVisualization-experimentalCondition u-ellipsis-text"},(0,qX.yZ)(t))))}}StageFlowNodeVisualization.propTypes={className:J().string,experimentalConditionValues:J().arrayOf(HR.aB.isRequired).isRequired,highlightMode:J().oneOf(Object.values(jX)).isRequired,isHovered:J().bool.isRequired,isNodeClickable:J().bool.isRequired,onClick:J().func,onHover:J().func,onRightClick:J().func,onUnhover:J().func,position:HX.isRequired,relativeX:J().number.isRequired,shouldShowExperimentalCondition:J().bool.isRequired,stageRunStatus:J().oneOf([...Object.values(nB.Ov),nB._A]),stageWidth:J().number.isRequired,tooltipTitle:J().string}
StageFlowNodeVisualization.defaultProps={isHovered:!1}
const YX=StageFlowNodeVisualization
function StageVisualization({name:e,height:t,width:n,icon:a}){return d.createElement("div",{className:"workflowVisualization-stage",style:{width:n,height:t}},d.createElement("div",{className:"workflowVisualization-stage-header"},d.createElement("span",{className:"workflowVisualization-stage-name"},e),a))}StageVisualization.propTypes={name:J().string.isRequired,height:J().number.isRequired,width:J().number.isRequired,icon:J().node}
class VirtualNodeGraphVisualization extends d.Component{_handleClick(e,t){e.stopPropagation()
t&&!this.props.clickableNodeIds.includes(t)||(pn.isOSCtrlKey(e)?this.props.onCtrlClickNode(t):this.props.onClickNode(t))}_renderStages(e){const t=e.getTotalHeight(this.props.containerWidth)
return d.createElement("div",{className:"workflowVisualization-stages"},this.props.stageConfigurations.map((n=>d.createElement(StageVisualization,{key:n.id,name:n.stageName,height:t,width:e.getTagWidth(n.index)}))))}_renderLinks(e){const t=e.getTotalWidth(this.props.containerWidth),n=e.getLinks({leftBoundary:0,rightBoundary:t}),a=[...this.props.virtualNodeGraph.getVirtualNodeIds(),...this.props.nodeIdsToEdit]
return n.map((e=>{const{key:t,leftPosition:n,rightPosition:i,parentNodeId:s,childNodeId:r,isSecondary:o}=e,l=o?StageFlowNodeSecondaryLinkVisualization:StageRunLinkVisualization
return d.createElement(l,{key:t,highlightMode:jX.DEFAULT,isDiscarded:!a.includes(s)&&!a.includes(r),leftPosition:n,rightPosition:i})}))}_renderNodes(e){const{nodeIdsToEdit:t,virtualNodeGraph:n}=this.props,a=n.getVirtualNodeIds(),i=[...a,...t]
return n.getNodeIds().map((s=>{const r=e.getNodePosition(s),o=n.getTag(s),l=e.getTagWidth(o),c=a.includes(s),u=[...n.getPrimaryChildNodeIds(s),...n.getSecondaryChildNodeIds(s)].some((e=>i.includes(e)))
return d.createElement(YX,{key:s,className:f()({"stageFlowNodeVisualization--default":i.includes(s),"stageFlowNodeVisualization--orange":!c&&u,"stageFlowNodeVisualization--gray":!c&&!u&&!t.includes(s)}),experimentalConditionValues:n.getExperimentalConditionValues(s),highlightMode:jX.DEFAULT,isNodeClickable:this.props.clickableNodeIds.includes(s),onClick:e=>{this._handleClick(e,s)},position:r,relativeX:e.getRelativeX(s),shouldShowExperimentalCondition:n.isLastDescendantWithTag(s),stageRunStatus:n.getStatus(s),stageWidth:l,tooltipTitle:n.getName(s)})}))}render(){const e=new GraphLayout(this.props.virtualNodeGraph,6),t=e.getTreeHeight(),n=e.getTotalWidth(this.props.containerWidth),a=e.getTotalHeight(this.props.containerWidth)
return d.createElement("div",{onClick:e=>{this._handleClick(e,null)},style:{width:n,height:a}},this._renderStages(e),d.createElement("div",{className:f()("workflowVisualization-arms",{"is-tall":e.isTallVisualization()})},d.createElement("svg",{width:n,height:t},this._renderLinks(e),this._renderNodes(e))))}}VirtualNodeGraphVisualization.propTypes={containerWidth:J().number.isRequired,clickableNodeIds:J().arrayOf(J().string.isRequired).isRequired,nodeIdsToEdit:J().arrayOf(J().string.isRequired).isRequired,onClickNode:J().func.isRequired,onCtrlClickNode:J().func.isRequired,virtualNodeGraph:J().object.isRequired,stageConfigurations:J().arrayOf(HR.po.isRequired).isRequired}
const QX=VirtualNodeGraphVisualization
class ConfigureStageFlowNodeModal extends d.Component{constructor(){super(...arguments)
this.state={parentIds:this.props.stageFlowNode?this.props.stageFlowNode.parentIds:[]}
this._handleClickParentNode=e=>{this.setState({parentIds:e?[e]:[]})}
this._handleCtrlClickParentNode=e=>{if(e){const t=this.state.parentIds.includes(e)?this.state.parentIds.filter((t=>t!==e)):[...this.state.parentIds,e]
this.setState({parentIds:t})}}
this._handleSubmit=()=>{this.props.stageFlowNode?StageFlowNodeActions_editStageFlowNode(this.props.stageFlowNode.id,{parentIds:this.state.parentIds}):StageFlowNodeActions_createStageFlowNode({stageConfigurationId:this.props.stageConfigurations.find((e=>e.index===this.props.stageConfigurationIndex)).id,parentIds:this.state.parentIds})
this.props.onRequestClose()}}static open(e){const t={...e,onRequestClose:()=>{Xe.xv(ConfigureStageFlowNodeModal)}}
Xe.bA(ConfigureStageFlowNodeModal,d.createElement(ConfigureStageFlowNodeModal,{...t}))}_createVirtualNodeGraph(){const e=l.default.flatten(Object.values(this.props.stageConfigurationIdToStageFlowNodes))
let t=createVirtualNodeGraph(new StageFlowNodeGraph(e,this.props.stageConfigurations))
t=this.props.stageFlowNode?t.setParentNodeIds(this.props.stageFlowNode.id,this.state.parentIds):t.addVirtualNodes([{id:l.default.uniqueId($X),parentIds:this.state.parentIds,stageIndex:this.props.stageConfigurationIndex}])
return t}_getClickableNodeIds(){const e=this._createVirtualNodeGraph()
return e.getNodeIds().filter((t=>{const n=this.props.stageFlowNode?this.props.stageFlowNode.id:e.getVirtualNodeIds()[0]
return!e.isDescendant(t,n)&&!(e.getTag(t)>e.getTag(n))}))}_getButtons(){return[{key:"save",onClick:this._handleSubmit,style:C.ZJ.PRIMARY,submit:!0,text:"Save"}]}render(){const e=this._createVirtualNodeGraph()
return d.createElement(et.ZP,{large:!0,title:this.props.stageFlowNode?"Update node":"Create node",onRequestClose:this.props.onRequestClose,buttons:this._getButtons()},d.createElement(h.Z,null,d.createElement("div",{className:"configureStageFlowNodeModal-selectInputSource"},d.createElement(Fr.Z,{label:"Select input source"})),d.createElement("div",{className:"configureParentNodeVisualization-container"},d.createElement(WC.ZP,{disableHeight:!0},(({width:t})=>d.createElement(QX,{containerWidth:t,clickableNodeIds:this._getClickableNodeIds(),nodeIdsToEdit:this.props.stageFlowNode?[this.props.stageFlowNode.id]:[],onClickNode:this._handleClickParentNode,onCtrlClickNode:this._handleCtrlClickParentNode,virtualNodeGraph:e,stageConfigurations:this.props.stageConfigurations}))))))}}ConfigureStageFlowNodeModal.propTypes={onRequestClose:J().func.isRequired,stageFlowNode:HR.UP,stageConfigurationIndex:J().number.isRequired,stageConfigurations:J().arrayOf(HR.po.isRequired).isRequired,stageConfigurationIdToStageFlowNodes:J().objectOf(J().arrayOf(HR.UP.isRequired)).isRequired}
const KX=ConfigureStageFlowNodeModal,JX="_NO_VALUE"
class SetExperimentalConditionsModal extends d.Component{constructor(){super(...arguments)
this.state={experimentalConditionValues:this.props.stageFlowNode.experimentalConditionValues}
this._handleSubmit=()=>{this.props.onRequestSubmit(this.state.experimentalConditionValues.map((e=>e.id)))}}_getButtons(){return[{text:"Save",style:C.ZJ.PRIMARY,onClick:this._handleSubmit,key:"save"}]}_ecValueSelected(e,t){let n=l.default.reject(this.state.experimentalConditionValues,(t=>t.name===e.name))
t!==JX&&(n=[...n,l.default.findWhere(e.values,{textValue:t})])
this.setState({experimentalConditionValues:n})}render(){return d.createElement(et.ZP,{title:"Set experimental conditions",onRequestClose:this.props.onRequestClose,buttons:this._getButtons()},this.props.stageConfiguration.experimentalConditions.map((e=>0===e.values.length?null:d.createElement("div",{key:e.name,className:"workflowConfigureScreen-groupBox"},d.createElement("div",{className:"u-tiny-spacing-bottom"},d.createElement(Fr.Z,{label:d.createElement("span",null,e.name)})),e.values.map(((t,n)=>d.createElement("div",{key:`${e.name}:value${n}`,className:"radio"},d.createElement(Je.Z,null,d.createElement("input",{type:"radio",checked:null!=l.default.findWhere(this.state.experimentalConditionValues,{name:t.name,textValue:t.textValue}),value:t.textValue,onChange:({target:{value:t}})=>{this._ecValueSelected(e,t)}}),t.textValue)))),d.createElement("div",{key:`${e.name}:None`,className:"radio"},d.createElement(Je.Z,null,d.createElement("input",{type:"radio",checked:null==l.default.findWhere(this.state.experimentalConditionValues,{name:e.name}),value:JX,onChange:({target:{value:t}})=>{this._ecValueSelected(e,t)}}),"None"))))))}}SetExperimentalConditionsModal.propTypes={onRequestClose:J().func.isRequired,onRequestSubmit:J().func.isRequired,stageFlowNode:HR.UP.isRequired,stageConfiguration:HR.po.isRequired}
const XX=SetExperimentalConditionsModal
function StageFlowNodeDropdownMenu(e){const{onClickSetParent:t,onRemoveNode:n,onRemoveNodeAndDownstreamNodes:a,onClickDuplicateTree:i,onClickExplodeTree:s,onClickSetExperimentalCondition:r,openSetExperimentalConditionDisabled:o}=e,l=[[{name:"Set experimental conditions",handleOnClick:r,disabled:o},{name:"Select input source",handleOnClick:t}],[{name:"Duplicate branch",handleOnClick:i},{name:"Split by conditions",handleOnClick:s}],[{name:"Delete run",handleOnClick:n},{name:"Delete this and all downstream runs",handleOnClick:a}]]
return d.createElement(LR.Z,{items:l,menuStyle:LR.Z.STYLES.COMPACT})}StageFlowNodeDropdownMenu.propTypes={onClickSetParent:J().func.isRequired,onRemoveNode:J().func.isRequired,onClickDuplicateTree:J().func.isRequired,onClickExplodeTree:J().func.isRequired,onRemoveNodeAndDownstreamNodes:J().func.isRequired,onClickSetExperimentalCondition:J().func.isRequired,openSetExperimentalConditionDisabled:J().bool.isRequired}
var e0=n(626334)
class WorkflowConfigurationVisualization extends d.Component{_handleClickSetParent(e){const t=this.props.stageConfigurations.find((t=>l.default.findWhere(t.stageFlowNodes,{id:e.id})))
KX.open({stageFlowNode:e,stageConfigurationIndex:t.index,stageConfigurations:this.props.stageConfigurations,stageConfigurationIdToStageFlowNodes:this.props.stageConfigurationIdToStageFlowNodes})}async _handleOpenSetExperimentalCondition(e,t){await(0,Xn.Z)(XX,{stageFlowNode:e,stageConfiguration:t,onRequestSubmit:t=>{StageFlowNodeActions_editStageFlowNode(e.id,{experimentalConditionValueIds:t})}})}_handleDeleteNode(e,{shouldDeleteDownstreamNodes:t}){StageFlowNodeActions_deleteStageFlowNode(e.id,{shouldDeleteDownstreamNodes:t})}_handleCreateNode(e){KX.open({stageConfigurationIndex:e.index,stageConfigurations:this.props.stageConfigurations,stageConfigurationIdToStageFlowNodes:this.props.stageConfigurationIdToStageFlowNodes})}render(){const{containerWidth:e,isEditable:t,stageConfigurations:n,rightClickedNodeId:a,onReset:i,onRightClickNode:s,hoveredNodeId:r,onHoverNode:o,onUnhoverNode:c,stageConfigurationIdToStageFlowNodes:u,onClearRightClick:m,clickedUpstreamNodeId:p,clickedDownstreamNodeId:h,onClickNode:g,onClickLink:E}=this.props,S=l.default.flatten(Object.values(u)),y=new StageFlowNodeGraph(S,n),b=new GraphLayout(y,6),T=b.getTreeHeight(),v=b.getTotalWidth(e),C=b.getTotalHeight(e),I=b.getLinks({leftBoundary:0,rightBoundary:v})
return n.length?d.createElement("div",{style:{width:v,height:C},onClick:i},d.createElement("div",{className:"workflowVisualization-stages"},n.map((e=>d.createElement(StageVisualization,{key:e.id,name:e.stageName,height:C,width:b.getTagWidth(e.index),icon:this.props.isEditable?d.createElement(vy.Z,{className:"stageVisualization-icon",onClick:t=>{this._handleCreateNode(e)}}):null})))),d.createElement("div",{className:f()("workflowVisualization-arms",{"is-tall":b.isTallVisualization()})},d.createElement("svg",{width:v,height:T},I.map((({key:e,leftPosition:t,rightPosition:n,parentNodeId:a,childNodeId:i,isSecondary:s})=>{const r=s?StageFlowNodeSecondaryLinkVisualization:StageRunLinkVisualization
return d.createElement(r,{key:e,highlightMode:getLinkHighlightMode(a,i,{clickedUpstreamNodeId:p,clickedDownstreamNodeId:h,taggedNodeGraph:y}),onClick:e=>{e.stopPropagation()
E(a,i)},isDiscarded:!1,leftPosition:t,rightPosition:n})})),y.getNodeIds().map((e=>{const n=getNodeHighlightMode(e,{clickedUpstreamNodeId:p,clickedDownstreamNodeId:h,taggedNodeGraph:y}),i=y.getStageFlowNode(e),l=y.getStageConfiguration(e)
return d.createElement(Hy.ZP,{key:i.id,menu:d.createElement(StageFlowNodeDropdownMenu,{onClickDuplicateTree:e=>{StageFlowNodeActions_duplicateStageFlowNodeTree({stageFlowNodeId:i.id})},onClickExplodeTree:e=>{StageFlowNodeActions_explodeStageFlowNodeTree({stageFlowNodeId:i.id})},onClickSetParent:e=>{this._handleClickSetParent(i)},onRemoveNode:e=>{this._handleDeleteNode(i,{shouldDeleteDownstreamNodes:!1})},onRemoveNodeAndDownstreamNodes:e=>{this._handleDeleteNode(i,{shouldDeleteDownstreamNodes:!0})},onClickSetExperimentalCondition:e=>{this._handleOpenSetExperimentalCondition(i,l)},openSetExperimentalConditionDisabled:!(0,qX.mY)(l)}),onRequestClose:m,open:i.id===a,shouldCloseOnInsideClick:!0},d.createElement(YX,{highlightMode:n,isNodeClickable:!0,experimentalConditionValues:i.experimentalConditionValues,position:b.getNodePosition(i.id),stageWidth:b.getTagWidth(y.getTag(e)),relativeX:b.getRelativeX(e),isHovered:i.id===r,onHover:()=>{o(i.id)},onUnhover:()=>{c(i.id)},onClick:e=>{e.stopPropagation()
g(i.id)},onRightClick:e=>{e.preventDefault()
if(t){n!==jX.HIGHLIGHTED&&this.props.onClickNode(i.id)
s(i.id)}},shouldShowExperimentalCondition:y.isLastDescendantWithTag(i.id)}))}))))):d.createElement("div",{style:{width:v,height:C}},d.createElement("div",{className:"workflowVisualization-stages"},d.createElement("div",{className:"u-position-relative",style:{width:150,height:C}},d.createElement("div",{className:"workflowVisualization-stage-header"},d.createElement("div",{className:"workflowVisualization-stage-name"},"No stages")))),d.createElement("div",{className:"workflowVisualization-arms"},d.createElement("svg",{width:v,height:1},d.createElement("path",{className:"stageRunLinkVisualization-line",d:`M 0 0 H ${v}`}))))}}WorkflowConfigurationVisualization.propTypes={containerWidth:J().number.isRequired,isEditable:J().bool.isRequired,stageConfigurations:J().arrayOf(HR.po.isRequired).isRequired,stageConfigurationIdToStageFlowNodes:J().objectOf(J().arrayOf(HR.UP.isRequired)).isRequired,clickedUpstreamNodeId:J().string,clickedDownstreamNodeId:J().string,hoveredNodeId:J().string,rightClickedNodeId:J().string,onReset:J().func.isRequired,onClickNode:J().func.isRequired,onClickLink:J().func.isRequired,onRightClickNode:J().func.isRequired,onClearRightClick:J().func.isRequired,onHoverNode:J().func.isRequired,onUnhoverNode:J().func.isRequired}
const t0=(0,_a.$j)((function WorkflowConfigurationVisualization_mapStateToProps(e){return{clickedUpstreamNodeId:e.ui.workflowVisualization.clickedUpstreamNodeId,clickedDownstreamNodeId:e.ui.workflowVisualization.clickedDownstreamNodeId,rightClickedNodeId:e.ui.workflowVisualization.rightClickedNodeId,hoveredNodeId:e.ui.workflowVisualization.hoveredNodeId}}),(function WorkflowConfigurationVisualization_mapDispatchToProps(e){return{onReset(){e(e0.mc())},onClickNode(t){e(e0.mP(t))},onClickLink(t,n){e(e0.iw(t,n))},onRightClickNode(t){e(e0.UH(t))},onClearRightClick(){e(e0.UH(null))},onHoverNode(t){e(e0.Vl(t))},onUnhoverNode(t){e(e0.oC(t))}}}))(WorkflowConfigurationVisualization)
function WorkflowsCrumbLink(e){return d.createElement(CrumbLink,{className:f()(e.className,"legacy-font-proxima-subtitle"),onClick:()=>{dc.KI()}},(0,XZ.U8)("Legacy Workflows","Workflows"))}WorkflowsCrumbLink.propTypes={className:K.string}
function WorkflowTemplatesCrumbLink(){return d.createElement(CrumbLink,{className:"workflows-workflowHeader-workflowTemplatesCrumbLink",onClick:()=>{dc.Ds()}},"Templates")}const n0=/((?:http(?:s)?:\/\/.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_+.~#?&//=]*)/
function WorkflowDescription(e){const t=e.description||"",{parts:n,truncated:a}=function truncateIfTooLong(e,t){const n=[]
let a=0
for(;e.length>0&&a<t;){n.push(e[0])
a+=e[0].text.length
e=e.slice(1)}const i=a>t
if(i){const e=n.pop()
if(e){e.text=e.text.slice(0,e.text.length-(a-t))
n.push(e)}}return{parts:n,truncated:i}}(function getParts(e){return e.split(n0).map((e=>{return{text:e,url:(n=e,n0.test(n)?(t=e,t.startsWith("http")?t:`http://${t}`):void 0)}
var t,n}))}(t),116)
return d.createElement("div",{className:"u-word-break-word"},n.map((({text:e,url:t},n)=>d.createElement(LinkOrText,{key:n,text:e,url:t}))),a?["...",d.createElement("a",{onClick:e.onClickMore},"More")]:null)}WorkflowDescription.propTypes={description:K.string,onClickMore:K.func.isRequired}
const a0=WorkflowDescription
function LinkOrText(e){return e.url?d.createElement("a",{href:e.url},e.text):d.createElement("span",null,e.text)}LinkOrText.propTypes={text:K.string,url:K.string}
class WorkflowConfigurationHeader extends d.Component{constructor(){super(...arguments)
this.state={isSettingsModalOpen:!1}
this._handleClickSettingsIcon=()=>{this.setState({isSettingsModalOpen:!0})}
this._handleRequestCloseModal=()=>{this.setState({isSettingsModalOpen:!1})}}_shouldShowSettings(){return this.props.workflow.permissions.writable}render(){return d.createElement("div",{className:"workflows-workflowDetailsHeader"},d.createElement("div",{className:"workflows-workflowDetailsHeader-column is-expanded"},d.createElement("div",{className:"workflows-workflowDetailsHeader-row1"}),d.createElement(UX,null,d.createElement(WorkflowsCrumbLink,{className:"workflows-workflowDetailsHeader-workflowsCrumbLink"})),d.createElement("div",null,d.createElement(M_.Z,{open:this.state.isSettingsModalOpen},d.createElement(GX,{onRequestClose:this._handleRequestCloseModal,workflow:this.props.workflow})),d.createElement("span",{className:"workflows-workflowHeader-header"},d.createElement(so.R6,{className:"workflows-workflowDetailsHeader-workflowHumanId"},this.props.workflow.humanId),this._shouldShowSettings()&&d.createElement(yh.Z,{onClick:this._handleClickSettingsIcon})),d.createElement("div",{className:"workflows-workflowDetailsHeader-workflowName"},this.props.workflow.name),d.createElement(a0,{description:this.props.workflow.description,onClickMore:this._handleClickSettingsIcon}))),d.createElement("div",{className:"workflows-workflowDetailsHeader-right"},d.createElement(WC.ZP,{disableHeight:!0},(({width:e})=>d.createElement("div",{className:"workflows-workflowDetailsHeader-workflowVisualizationContainer"},d.createElement(t0,{containerWidth:e,isEditable:this.props.workflow.permissions.writable,stageConfigurations:this.props.stageConfigurations,stageConfigurationIdToStageFlowNodes:this.props.stageConfigurationIdToStageFlowNodes}))))))}}WorkflowConfigurationHeader.propTypes={workflow:HR.bn.isRequired,stageConfigurations:K.arrayOf(HR.po.isRequired).isRequired,stageConfigurationIdToStageFlowNodes:K.objectOf(K.arrayOf(HR.UP.isRequired)).isRequired}
const i0=WorkflowConfigurationHeader
class WorkflowConfigureScreen extends d.Component{constructor(){super(...arguments)
this.state={isConfigureStageModalOpen:!1,editingStageConfiguration:null,initialStageRunRows:[{inputType:dt.ZP.ENABLE_BATCHES?RX.n$.BATCH:RX.n$.FILE}]}
this._handleOpenCreateStageConfigurationModal=()=>{this.setState({isConfigureStageModalOpen:!0})}
this._handleCloseConfigureStageModal=()=>{this.setState({isConfigureStageModalOpen:!1,editingStageConfiguration:null})}
this._handleEditStageConfiguration=e=>{this.setState({editingStageConfiguration:e})}
this._handleInitializeWorkflow=()=>{const e=[]
for(const t of this.state.initialStageRunRows)null!=t.batch?e.push({batchId:t.batch.id}):null!=t.file&&e.push({fileId:t.file.id})
dc.gg({workflowId:this.props.workflow.id,initialStageRunParams:e})}
this._handleBack=()=>{dc.KI()}
this._handleInitializationRowsChanged=e=>{this.setState({initialStageRunRows:e})}}componentDidMount(){w_.jn()}_isConfigureWorkflowStageModalOpen(){return Boolean(this.state.editingStageConfiguration||this.state.isConfigureStageModalOpen)}_isInitializeWorkflowEnabled(){for(const e of this.props.stageConfigurations)if(e.stageFlowNodes.length>0)return!0
return!1}_wasInitializedFromRequest(){return 0!==this.props.workflow.initializationDatas.length}render(){return d.createElement(Db.W2,{size:"lg",className:"workflows-configuration-container"},d.createElement(M_.Z,{open:this._isConfigureWorkflowStageModalOpen()},d.createElement(vX,{baseWorkflowTemplateVersionId:this.props.workflow.baseWorkflowTemplateVersionId,stageConfiguration:this.state.editingStageConfiguration,workflowTemplateVersionId:this.props.workflowTemplateVersion.id,onRequestClose:this._handleCloseConfigureStageModal})),d.createElement(i0,{workflow:this.props.workflow,stageConfigurations:this.props.stageConfigurations,stageConfigurationIdToStageFlowNodes:this.props.stageConfigurationIdToStageFlowNodes}),d.createElement(Db.X2,{className:"u-padding-bottom"},d.createElement(Db.JX,{lg:22},d.createElement("div",{className:"workflowConfigureScreen-body"},d.createElement("div",{className:"workflowConfigureScreen-configureStepContainer"},d.createElement(OX,{stepNumber:1,title:"Edit stages"},d.createElement("div",{className:"workflowConfigureScreen-configureStepContent"},d.createElement(VX,{isEditable:this.props.workflow.permissions.writable,onCreateStageConfiguration:this._handleOpenCreateStageConfigurationModal,onEditStageConfiguration:this._handleEditStageConfiguration,stageConfigurations:this.props.stageConfigurations})))),d.createElement("div",{className:"workflowConfigureScreen-configureStepContainer"},!this._wasInitializedFromRequest()&&d.createElement(OX,{stepNumber:2,title:(0,XZ.U8)("Select legacy workflow inputs","Select workflow inputs")},d.createElement("div",{className:"workflowConfigureScreen-configureStepContent"},d.createElement(h.Z,{className:"u-spacing-top"},d.createElement(p.Z,{md:4},d.createElement(PX,{initialStageRunRows:this.state.initialStageRunRows,initialStageRunRowsChanged:this._handleInitializationRowsChanged})))))),d.createElement("div",{className:"u-lr-split"},d.createElement("div",null,d.createElement(C.Co,{key:"back",className:"u-tiny-spacing-right",buttonStyle:C.ZJ.TERTIARY_GRAY,disabled:!1,onClick:this._handleBack,size:C.qE.MEDIUM,text:"Back"}),d.createElement(C.Co,{key:"start",buttonStyle:C.ZJ.SECONDARY,disabled:!this._isInitializeWorkflowEnabled(),onClick:this._handleInitializeWorkflow,size:C.qE.MEDIUM,text:(0,XZ.U8)("Start Legacy Workflow","Start Workflow")})))))))}}WorkflowConfigureScreen.propTypes={workflow:HR.bn.isRequired,workflowTemplateVersion:HR.pd.isRequired,stageConfigurations:J().arrayOf(HR.po.isRequired).isRequired,stageConfigurationIdToStageFlowNodes:J().objectOf(J().arrayOf(HR.UP.isRequired)).isRequired}
const s0=WorkflowConfigureScreen
function ExpandedTabContainer(e){return d.createElement("div",{className:"expandedTabContainer u-flex-full-height"},d.createElement(sp.Xl,{isFullHeight:!0,...e}))}var r0=n(182242)
class NewWorkflowButton extends d.Component{constructor(){super(...arguments)
this.state={isCreateWorkflowModalOpen:!1}
this._handleCreateNewWorkflow=()=>{this.setState({isCreateWorkflowModalOpen:!0})}
this._handleCloseCreateWorkflowModal=()=>{this.setState({isCreateWorkflowModalOpen:!1})}}render(){return d.createElement("div",null,d.createElement(M_.Z,{open:this.state.isCreateWorkflowModalOpen},this.state.isCreateWorkflowModalOpen&&d.createElement(r0.Z,{initialWorkflowTemplateId:this.props.workflowTemplateId,initialWorkflowTemplateVersionId:this.props.workflowTemplateVersionId,onRequestClose:this._handleCloseCreateWorkflowModal})),d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,className:this.props.className,icon:"compose",onClick:this._handleCreateNewWorkflow,size:C.qE.SMALL,text:(0,XZ.U8)("New Legacy Workflow","New Workflow")}))}}NewWorkflowButton.propTypes={className:K.string,workflowTemplateId:K.string,workflowTemplateVersionId:K.string}
const o0=NewWorkflowButton
var l0=n(626054)
class WorkflowTemplateBaseSettingsModal extends d.Component{constructor(){super(...arguments)
this.state={prefix:this.props.existingOwnable?this.props.existingOwnable.prefix:"PD"}
this._handleChangePrefix=e=>{this.setState({prefix:e.target.value})}
this._handleSubmit=e=>this.props.doSubmit({...e,prefix:this.state.prefix})}_isValidInput(){return this.state.prefix.length>0}_isReadOnly(){return!!this.props.existingOwnable&&!this.props.existingOwnable.permissions.admin}render(){return d.createElement(l0.Z,{title:this.props.title,ownableType:st.WORKFLOW_TEMPLATE,ownableId:this.props.ownableId,existingOwnable:this.props.existingOwnable,onRequestClose:this.props.onRequestClose,doSubmit:this._handleSubmit,doDelete:this.props.doDelete,enableDescription:!1,disableSave:!this._isValidInput(),isReadOnly:this._isReadOnly(),customSettingsComponent:()=>d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement(Ke.Z,null,d.createElement(Je.Z,{className:"required"},"Workflow ID prefix"),d.createElement(_t.Z,{name:"prefix",type:"text",value:this.state.prefix,onChange:this._handleChangePrefix,readOnly:this._isReadOnly()}))))})}}WorkflowTemplateBaseSettingsModal.propTypes={existingOwnable:J().object,ownableId:J().string,onRequestClose:J().func.isRequired,doDelete:J().func,doSubmit:J().func.isRequired,title:J().string}
const c0=WorkflowTemplateBaseSettingsModal
var d0=n(781024),u0=n(817285),m0=n(14436),p0=n(652201),h0=n(320176),g0=n(399649),E0=n(795424)
class WorkflowTable extends d.Component{constructor(){super(...arguments)
this._handleOpenWorkflow=e=>{(0,E0.KN)(e.id,this.props.searchResults)
dc.Su(e.id)}
this._handleSetSort=e=>{const t=(0,WY.dt)(this.props.sorts,e)
this.props.onSetColumnHeaderSort(t)}}render(){const{columns:e,rowDataByItemId:t,iconsByItemId:n}=(0,p0.ZP)(this.props.workflows,this.props.sorts,{workflowIdToDashboardDetails:this.props.workflowIdToDashboardDetails})
return d.createElement(h0.ZP,{...(0,g0.B8)()},d.createElement(Xj.Z,{canFilterColumns:!0,className:"u-flex-grow u-flex-full-height",matchParentHeight:!0,columns:e,onRowClick:this._handleOpenWorkflow,emptyTableText:this.props.emptyMessage,rows:this.props.workflows.map((e=>({id:e.id,data:t[e.id],icon:n[e.id]}))),isCompact:!1,hasLineBelowHeader:!1,tableKey:Tr.Uw.EXPANDED_WORKFLOW_TABLE,onChangeSort:this._handleSetSort}))}}WorkflowTable.propTypes={workflows:K.arrayOf(HR.UV).isRequired,workflowIdToDashboardDetails:K.objectOf(HR.mZ).isRequired}
const f0=WorkflowTable
var S0=n(751006)
const workflows_WorkflowsFiltersContainer=e=>d.createElement(S0.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.WORKFLOW_TEMPLATE},{filterKey:Kn.Vm.AUTHOR},{filterKey:Kn.Vm.WORKFLOW_STATUS}],secondaryFilterGroups:[],filters:e.filters,filterErrors:e.filterErrors,onChangeFilters:t=>{e.onChangeFilters(t)},selectedSchema:null,clearButton:e.clearButton})
var y0=n(542506)
class WorkflowDashboardScreenConnector extends oi.C{renderLoading(){return d.createElement(WorkflowDashboardScreen,{...this.props,workflows:null,workflowIdToDashboardDetails:null,workflowTemplates:null,isLoading:!0})}enhanceProps(){const e={workflows:null,workflowIdToDashboardDetails:null,workflowTemplates:null,isLoading:!0}
if(!this.props.searchResults)return e
const t=this.reduxState(),n=new HZ.xT(t.models.workflows),a=this.props.searchResults.ids.map((e=>n.getWorkflowSummary(e))),i=this.getOrFetchMultipleRequired(lA.V.WORKFLOW_DASHBOARD_DETAILS,this.props.searchResults.ids),s=n.getAllWorkflowTemplates()
return{...e,workflows:a.every((e=>Boolean(e)))?a:null,workflowIdToDashboardDetails:i,workflowTemplates:s,isLoading:!1}}}class WorkflowDashboardScreen extends d.Component{constructor(){super(...arguments)
this._handleSearch=e=>{this.props.onSearch(e)
qP.WN(ZP.$0.WORKFLOWS,e.sorts)}
this._handleSetSort=e=>{this.props.onUpdateSortOrder([e])}
this._handleClear=()=>{this._handleSearch(RN._j(this.props.searchParams,[Kn.Vm.TYPES]))}
this._getEmptyMessage=()=>this.props.loadingState===d0.Gu.FAILED?Kn.Jc:"No workflows"}render(){const e={offset:this.props.searchParams.offset,limit:this.props.searchParams.limit,total:this.props.searchResults?this.props.searchResults.total:0,isExact:!this.props.searchResults||this.props.searchResults.isExact}
return d.createElement("div",{className:"u-flex-full-height"},d.createElement("div",{className:"u-flex-full-height"},d.createElement($Y.Z,{isExpanded:!0,queryInput:d.createElement(m0.Z,{onUpdateQuery:this.props.onUpdateQueryString,query:this.props.searchParams.query}),filtersContainer:d.createElement(workflows_WorkflowsFiltersContainer,{filters:this.props.searchParams.filters,filterErrors:this.props.filterErrors,onChangeFilters:this.props.onUpdateFilters,workflowTemplates:this.props.workflowTemplates,clearButton:RN.yE(this.props.searchParams,[],[st.WORKFLOW])?d.createElement(wr.Z,{onClear:this._handleClear}):null})}),d.createElement("div",{className:"u-flex-display"},d.createElement(zT.Z,{isLoading:!this.props.searchResults,setOffset:this.props.onUpdateOffset,pagination:e}),d.createElement(qT.Z,{sortConfig:{availableSortOptions:(0,u0.vy)(this.props.searchParams,[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_CREATED_AT_KEY,Kn.bo.SORT_IDENTIFIER_KEY]),sorts:this.props.searchParams.sorts,onSetSort:(e,t)=>{this._handleSetSort({key:e,reverse:t})}},pageSizeConfig:{pageSize:this.props.searchParams.limit,availablePageSizes:TN.x_,onSetPageSize:this.props.onUpdatePageSize}})),!this.props.isLoading&&this.props.workflows&&this.props.workflowTemplates&&this.props.workflowIdToDashboardDetails&&this.props.workflows.every((e=>null!=this.props.workflowIdToDashboardDetails[e.id]))?d.createElement(f0,{workflows:this.props.workflows,workflowIdToDashboardDetails:this.props.workflowIdToDashboardDetails,emptyMessage:this._getEmptyMessage(),searchResults:this.props.searchResults,sorts:this.props.searchParams.sorts,onSetColumnHeaderSort:this._handleSetSort}):d.createElement(kl.b,null)))}}const b0=(0,UP.ZP)(WorkflowDashboardScreenConnector.connect(WorkflowDashboardScreen),Kn.Sc.WORKFLOW,ZP.$0.WORKFLOWS,{defaultSearchParams:(0,y0.r)(),getNavigationUpdate:function getWorkflowsURL(e,t){return{url:(0,eJ.q7)((0,XZ.oN)(),t.searchParams,t.filterErrors)}}})
class WorkflowDashboardTemplateTable extends d.Component{constructor(){super(...arguments)
this._handleOpenWorkflowTemplate=e=>{TX.kf(e.id)}
this._getRowContentHeight=e=>{if(0===this.props.workflowTemplates.length)return Tr._5
const t=l.default.sortBy(this.props.workflowTemplates,"name")[e]
return Math.ceil(t.name.length/45)*Tr._5}}render(){return d.createElement(Xj.Z,{className:"u-flex-grow",matchParentHeight:!0,columns:[{accessorKey:"name",header:"Name",width:300},{accessorKey:"prefix",header:"Workflow ID Prefix",width:300},{accessorKey:"versions",header:"Versions",flexGrow:1}],onRowClick:this._handleOpenWorkflowTemplate,emptyTableText:"No templates",getRowContentHeight:this._getRowContentHeight,rows:l.default.sortBy(this.props.workflowTemplates,"name").map((e=>({id:e.id,data:{name:e.name,prefix:e.prefix,versions:e.workflowTemplateVersions.length},classNames:{name:"workflowDashboardTemplateTable-cell",versions:"workflowDashboardTemplateTable-cell"}}))),isCompact:!1})}}WorkflowDashboardTemplateTable.propTypes={workflowTemplates:K.arrayOf(HR.yr).isRequired}
const T0=WorkflowDashboardTemplateTable
function WorkflowDashboardTemplatesScreen({workflowTemplates:e}){return d.createElement("div",{className:"u-flex-full-height"},e?d.createElement(T0,{workflowTemplates:e}):d.createElement("div",{className:"text-center"},d.createElement(kl.Z,null)))}WorkflowDashboardTemplatesScreen.propTypes={workflowTemplates:J().arrayOf(HR.yr)}
class WorkflowDashboardContainer extends d.Component{constructor(){super(...arguments)
this.state={isCreateWorkflowTemplateModalOpen:!1}
this._handleCreateNewWorkflowTemplate=({name:e,owner:t,ownerInfo:n,prefix:a,collaborators:i})=>TX.B0({name:e,owner:t,ownerInfo:n,prefix:a,collaborators:(0,WW.fr)(i)})
this._handleOpenCreateWorkflowTemplateModal=()=>{this.setState({isCreateWorkflowTemplateModalOpen:!0})}
this._handleCloseCreateWorkflowTemplateModal=()=>{this.setState({isCreateWorkflowTemplateModalOpen:!1})}
this._handleSetActiveTab=e=>{e===HR.PC.WORKFLOW_DASHBOARD?dc.KI():dc.Ds()}}_renderHeaderButton(){if(this.props.screen===HR.PC.WORKFLOW_DASHBOARD)return d.createElement(o0,null)
{const e=0===(0,WW.UP)().length
return d.createElement(P.ZP,{title:e?"Please contact your administrator to create a workflow template":"New Template",placement:P.TQ.BOTTOM,container:"body"},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,icon:"compose",onClick:this._handleOpenCreateWorkflowTemplateModal,size:C.qE.SMALL,text:"New Template",disabled:e}))}}render(){return d.createElement("div",null,this.state.isCreateWorkflowTemplateModalOpen&&d.createElement(M_.Z,{open:!0},d.createElement(c0,{onRequestClose:this._handleCloseCreateWorkflowTemplateModal,doSubmit:this._handleCreateNewWorkflowTemplate})),d.createElement(Db.W2,{className:"expandedContainer expandedContainer--fullScreen",size:"lg",dataTestAttrs:{component:"WorkflowDashboardContainer",element:"root",key:"expanded"}},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},d.createElement($Y.Z,{isExpanded:!0,buttons:this._renderHeaderButton(),crumbs:d.createElement(Cw.wn,{text:(0,XZ.U8)("Legacy Workflows","Workflows")}),showShadow:!1}))),d.createElement(Db.X2,{fluid:!0},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21,className:"u-flex-display u-vertical-flex"},d.createElement(ExpandedTabContainer,{activeTab:this.props.screen,className:"u-flex-full-height",onRequestTabChange:this._handleSetActiveTab},d.createElement(sp.OK,{tabKey:HR.PC.WORKFLOW_DASHBOARD,title:(0,XZ.U8)("Legacy Workflows","Workflows")},d.createElement(b0,null)),d.createElement(sp.OK,{tabKey:HR.PC.WORKFLOW_DASHBOARD_TEMPLATES,title:"Templates"},d.createElement(WorkflowDashboardTemplatesScreen,{workflowTemplates:this.props.workflowTemplates})))))))}}WorkflowDashboardContainer.propTypes={workflowTemplates:J().arrayOf(HR.yr),screen:J().oneOf([HR.PC.WORKFLOW_DASHBOARD,HR.PC.WORKFLOW_DASHBOARD_TEMPLATES]).isRequired}
const v0=WorkflowDashboardContainer
var C0=n(897171),I0=n(779954)
var w0=n(38209)
const ConfigureStageRunHeader=e=>d.createElement("div",{className:"simpleDivTable-headerCell"},d.createElement("div",{className:"u-small-spacing-bottom"},d.createElement("div",null,e.text)))
ConfigureStageRunHeader.propTypes={text:J().string.isRequired}
const N0=ConfigureStageRunHeader
class ConfigureStageRunRow extends d.Component{_renderEntryInput(){const e={name:"New Entry from Template",handleOnClick:()=>{this.props.onSelectStageEntry(null)}},t=this.props.stageEntries.map((e=>({name:e.name,handleOnClick:()=>{this.props.onSelectStageEntry(e)}})))
return d.createElement(tc.Z,{displayName:this.props.stageEntry?this.props.stageEntry.name:e.name,items:[[e,...t]]})}_renderInputSamples(){if(0===this.props.inputSampleIds.length)return this.props.isInitialStageRun?d.createElement("span",null,"None"):d.createElement("span",null,"Pending")
if(this.props.inputSampleIds.some((e=>!this.props.stageRunSampleById[e])))return d.createElement("span",{className:"u-faded u-italic"},"Loading")
return this.props.inputSampleIds.map((e=>this.props.stageRunSampleById[e].name)).join(", ")}_renderStageRunName(){return this.props.isEditingStageRun?dt.ZP.LEGACY_WORKFLOWS_ENABLE_STAGE_RUN_RENAME?d.createElement("div",{className:"u-small-spacing-right"},d.createElement(Jl.Z,{label:"Name",labelStyle:Jl.Z.LABEL_STYLES.HIDDEN,value:this.props.name,onChange:this.props.onEditName})):this.props.name:"New"}render(){return d.createElement("div",{className:"simpleDivTable-row"},d.createElement("div",{className:"simpleDivTable-cell"},d.createElement("div",{className:"u-small-spacing-right u-ellipsis-text"},this.props.stageName)),d.createElement("div",{className:"simpleDivTable-cell"},this._renderInputSamples()),d.createElement("div",{className:"simpleDivTable-cell"},this._renderStageRunName()),d.createElement("div",{className:"simpleDivTable-cell"},this._renderEntryInput()))}}ConfigureStageRunRow.propTypes={isEditingStageRun:J().bool.isRequired,stageName:J().string.isRequired,name:J().string,onEditName:J().func,stageEntry:HR.Ks,stageEntries:J().arrayOf(HR.Ks.isRequired).isRequired,onSelectStageEntry:J().func.isRequired,inputSampleIds:J().arrayOf(J().string.isRequired).isRequired,isInitialStageRun:J().bool.isRequired,stageRunSampleById:J().objectOf(HR.Lv).isRequired}
const A0=ConfigureStageRunRow
const R0=J().arrayOf(J().string.isRequired)
class ConfigureStageRunsModal extends d.Component{constructor(){super(...arguments)
this.state=this.getInitialState()
this._handleClickNode=e=>{this.props.nodeIdToSetParent&&this.setState({virtualNodeGraph:this.state.virtualNodeGraph.setParentNodeIds(this.props.nodeIdToSetParent,e?[e]:[])})}
this._handleCtrlClickNode=e=>{if(this.props.nodeIdToSetParent&&e){const t=this.state.virtualNodeGraph.getParentNodeIds(this.props.nodeIdToSetParent),n=t.includes(e)?t.filter((t=>t!==e)):[...t,e]
this.setState({virtualNodeGraph:this.state.virtualNodeGraph.setParentNodeIds(this.props.nodeIdToSetParent,n)})}}
this._isNodeClickable=e=>{const{nodeIdToSetParent:t}=this.props,{virtualNodeGraph:n}=this.state
return!!t&&(!n.isDescendant(e,t)&&!(n.getTag(e)>n.getTag(t)))}
this._getParentSpecifier=e=>this.state.virtualNodeGraph.isVirtual(e)?{clientStageRunId:e}:{existingStageRunId:e}
this._handleSubmit=async()=>{const e=this.props.virtualNodeGraph.getVirtualNodeIds().length,t=this.props.nodeIdsToEdit.length,n=this._getCreateSpecifiers(),a=this._getEditSpecifiers()
await w0.vg({createSpecifiers:n,editSpecifiers:a})
this.props.onRequestSubmit(e+t)
this.props.onRequestClose()}
this._renderRow=e=>{const{workflowStages:t}=this.props,{virtualNodeGraph:n}=this.state,a=n.getTag(e),i=t.find((e=>e.stageConfiguration.index===a)),s=0===n.getParentNodeIds(e).length,r={inputSampleIds:this.state.rowsByNodeId[e].inputSampleIds,isInitialStageRun:s,key:e,stageName:i.name,stageEntry:this.state.rowsByNodeId[e].stageEntry,stageEntries:i.stageEntries,stageRunSampleById:this.props.stageRunSampleById,onSelectStageEntry:t=>{this._handleSelectStageEntry(t,e)}}
return n.isVirtual(e)?d.createElement(A0,{isEditingStageRun:!1,...r}):d.createElement(A0,{isEditingStageRun:!0,name:this.state.rowsByNodeId[e].name,onEditName:t=>{this._handleEditName(t,e)},...r})}}getInitialState(){const{nodeIdToInputSampleIds:e,virtualNodeGraph:t}=this.props,n={}
for(const a of t.getVirtualNodeIds()){const i=t.getTag(a)
n[a]={stageEntry:t.originalGraph.getDefaultStageEntry(i),inputSampleIds:e&&e[a]||[]}}for(const t of this.props.nodeIdsToEdit){const a=this.props.virtualNodeGraph.originalGraph.getStageRun(t)
n[t]={stageEntry:a.stageEntry,inputSampleIds:e&&e[t]||a.inputSampleIds,name:a.name}}return{rowsByNodeId:n,virtualNodeGraph:t}}_getButtonText(){const e=this.props.virtualNodeGraph.getVirtualNodeIds().length,t=this.props.nodeIdsToEdit.length
return 0===e?0===t?"No stage runs to update":`Edit ${t} ${de._6(t,"run")}`:`Create ${e} ${de._6(e,"run")}`}_getButtons(){return[{text:this._getButtonText(),style:C.ZJ.PRIMARY,onClick:this._handleSubmit,disabled:this._getCreateSpecifiers().length+this._getEditSpecifiers().length===0,key:"create"}]}_handleSelectStageEntry(e,t){this.setState(Q()(this.state,{rowsByNodeId:{[t]:{$merge:{stageEntry:e}}}}))}_handleEditName(e,t){this.setState(Q()(this.state,{rowsByNodeId:{[t]:{$merge:{name:e.target.value}}}}))}_getInputSampleSpecifiers(e){return e.map((e=>({stageRunSampleId:e})))}_getCreateSpecifiers(){const{virtualNodeGraph:e}=this.state
return e.getVirtualNodeIds().map((t=>{const n=e.getTag(t),a=this.props.workflowStages.find((e=>e.stageConfiguration.index===n)),{stageEntry:i,inputSampleIds:s}=this.state.rowsByNodeId[t]
return{clientStageRunId:t,inputSampleSpecifiers:this._getInputSampleSpecifiers(s),workflowStageId:a.id,stageEntryId:i?i.id:null,experimentalConditionValueIds:[],parentSpecifiers:e.getParentNodeIds(t).map((e=>this._getParentSpecifier(e)))}}))}_getSetParentPatch(e){const t=this.state.virtualNodeGraph.getParentNodeIds(e),n=this.state.virtualNodeGraph.getOriginalParentNodeIds(e)
return Is()(t,n)?{}:{stageRunId:e,parentSpecifiers:t.map((e=>this._getParentSpecifier(e)))}}_getSetRowPatch(e){if(this.props.nodeIdsToEdit.includes(e)){const{stageEntry:t,inputSampleIds:n,name:a}=this.state.rowsByNodeId[e]
return{stageRunId:e,name:a,inputSampleSpecifiers:this._getInputSampleSpecifiers(n),stageEntryId:t?t.id:null}}return{}}_getEditSpecifiers(){return this.state.virtualNodeGraph.getOriginalNodeIds().map((e=>({...this._getSetParentPatch(e),...this._getSetRowPatch(e)}))).filter((e=>!Is()(e,{})))}render(){const{nodeIdsToEdit:e,onRequestClose:t,stageConfigurations:n}=this.props,{virtualNodeGraph:a}=this.state,i=l.default.sortBy([...e,...a.getVirtualNodeIds()],(e=>a.getTag(e)))
return d.createElement(et.ZP,{className:"createStageRunModal",large:!0,title:"Update stage runs",onRequestClose:t,buttons:this._getButtons()},d.createElement(h.Z,null,d.createElement("div",{className:"configureParentNodeVisualization-container"},d.createElement(WC.ZP,{disableHeight:!0},(({width:t})=>d.createElement(QX,{containerWidth:t,clickableNodeIds:a.getNodeIds().filter((e=>this._isNodeClickable(e))),nodeIdsToEdit:e,onClickNode:this._handleClickNode,onCtrlClickNode:this._handleCtrlClickNode,stageConfigurations:n,virtualNodeGraph:a}))))),d.createElement("div",{className:"metadata-table simpleDivTable createStageRunModal-stageRunTable"},d.createElement("div",{className:"simpleDivTable-header"},d.createElement(N0,{text:"Stage"}),d.createElement(N0,{text:"Input"}),d.createElement(N0,{text:"Run"}),d.createElement(N0,{text:"Entry"})),i.map((e=>this._renderRow(e)))))}}ConfigureStageRunsModal.propTypes={onRequestClose:J().func.isRequired,nodeIdsToEdit:J().arrayOf(J().string.isRequired).isRequired,nodeIdToSetParent:J().string,nodeIdToInputSampleIds:J().objectOf(R0.isRequired),virtualNodeGraph:J().object.isRequired,workflowId:J().string.isRequired,stageConfigurations:J().arrayOf(HR.po.isRequired).isRequired,stageRunSampleById:J().objectOf(HR.Lv).isRequired,workflowStages:J().arrayOf(HR.kv.isRequired).isRequired}
const P0=(0,_a.$j)((function ConfigureStageRunsModal_mapStateToProps(e,{workflowId:t}){const n=new HZ.xT(e.models.workflows),a=n.getWorkflow(t)
return{stageConfigurations:n.getStageConfigurations(a.workflowTemplateVersion.id),stageRunSampleById:n.getStageRunSampleById(),workflowStages:n.getWorkflowStages(t)}}))(ConfigureStageRunsModal)
function openConfigureStageRunsModal(e){const t={...e,onRequestSubmit:e.onRequestSubmit?e.onRequestSubmit:Jt.ZT,onRequestClose:()=>{Xe.xv(P0)}}
Xe.bA(P0,d.createElement(P0,{...t}))}function openConfigureStageRunsModalToBulkCreateStageRuns(e,t,n){const a=e.getLinksAcrossTag(t).map((e=>({...e,stageIndex:t}))).filter((t=>function isLinkValidForNode(e,{parentId:t,childId:n}){const a=[nB.Ov.INITIALIZED,nB.Ov.COMPLETED]
return!(n&&e.getStageRun(n).status!==nB.Ov.INITIALIZED||t&&!a.includes(e.getStageRun(t).status))}(e,t)))
openConfigureStageRunsModal({...n,virtualNodeGraph:createVirtualNodeGraph(e).addNodesOnLinks(a),nodeIdsToEdit:[]})}function openConfigureStageRunsModalToEditStageRun(e,t,n){const a=createVirtualNodeGraph(e),i=l.default.object(e.getNodeIds().map((t=>[t,e.getStageRun(t).inputSampleIds])))
openConfigureStageRunsModal({...n,virtualNodeGraph:a,nodeIdsToEdit:[t.id],nodeIdToSetParent:t.id,nodeIdToInputSampleIds:i})}function openConfigureStageRunsModalToDuplicateBranch(e,t,n){const a=createVirtualNodeGraph(e),{newVirtualNodeGraph:i,newRootNodeId:s}=function duplicateBranch(e,t){const n=e.getDescendantNodeIds(t),a=new Map,i=new Map
for(const e of n){const t=l.default.uniqueId($X)
a.set(e,t)
i.set(t,e)}const getClonedParentNodeIds=t=>{const n=i.get(t)
return e.getParentNodeIds(n).map((e=>a.has(e)?a.get(e):e))},s=Array.from(i.keys()).map((t=>({id:t,parentIds:getClonedParentNodeIds(t),stageIndex:e.getTag(i.get(t))})))
return{newVirtualNodeGraph:e.addVirtualNodes(s),newRootNodeId:a.get(t)}}(a,t.id)
openConfigureStageRunsModal({...n,virtualNodeGraph:i,nodeIdsToEdit:[],nodeIdToSetParent:s,nodeIdToInputSampleIds:l.default.object(e.getNodeIds().map((t=>[t,e.getStageRun(t).inputSampleIds])))})}function openConfigureStageRunsModalToCreateStageRun(e,t,n){const a=createVirtualNodeGraph(e).addVirtualNodes([{id:l.default.uniqueId($X),parentIds:[],stageIndex:t}])
openConfigureStageRunsModal({...n,virtualNodeGraph:a,nodeIdsToEdit:[],nodeIdToSetParent:a.getVirtualNodeIds()[0]})}var O0=n(997461),x0=n(691383)
class UpdateStageRunStatusModal extends d.Component{constructor(e){super(e)
this._isStageRunSelectedByDefault=e=>{const t=!this._isStageRunReviewed(e.id)
return e.status===nB.Ov.INITIALIZED&&t}
this._handleSubmit=async()=>{const e=this._getStageRunUpdateStatusSpecifiers()
e.length>0&&await w0.On({updateStatusSpecifiers:e})
this.props.onRequestClose()}
this._renderColumn=(e,t)=>t.data[e.accessorKey]
this.state={selectedStageRunIds:e.stageRuns.filter((e=>this._isStageRunSelectedByDefault(e))).map((e=>e.id)),statusByStageRunId:{},statusChanged:!1}}_isStageRunReviewed(e){const t=this.props.stageRunsById[e],n=this.props.stageEntriesById[t.stageEntry.id];(0,S.Gp)(Boolean(n),`Stage entry ${t.stageEntry.id} not found in store.`)
return Boolean(n&&n.review&&n.review.status===KL.ZP.ACCEPTED)}_getStageRunUpdateStatusSpecifiers(){const e=[]
for(const t of this.props.stageRuns){const n=this.state.statusByStageRunId[t.id]
n&&t.status!==n&&e.push({stageRunId:t.id,status:n})}return e}_areAnyStageRunsDiscarded(){return null!=this._getStageRunUpdateStatusSpecifiers().find((({status:e})=>e===nB.Ov.DISCARDED))}_isStageRunSelected(e){return this.state.selectedStageRunIds.includes(e)}_getCurrentStatus(e){return this.state.statusByStageRunId[e.id]||e.status}_getParentsIdsInSameStage(e){return this.props.stageRunsById[e].stageFlowNode.parentIds.map((e=>this.props.stageRunIdByStageFlowNodeId[e])).filter((e=>l.default.identity(e)))}_getIncompatibleSelection(){for(const e of this.props.stageRuns){const t=e.id
if(!this._isStageRunSelected(t))continue
const n=this._getParentsIdsInSameStage(t)
for(;n.length>0;){const e=n.pop()
if(this._isStageRunSelected(e))return[e,t]
n.push(...this._getParentsIdsInSameStage(e))}}return null}_renderIncompatibleSelectionsError(){const e=this._getIncompatibleSelection()
if(!e)return null
const[t,n]=e.map((e=>this.props.stageRunsById[e].name))
return d.createElement("div",{className:"alert alert-danger u-small-spacing"},"Cannot update both ",t," and ",n," ","as ",n," is downstream from ",t,".")}_getNumOfSelectedStageRuns(){return this.state.selectedStageRunIds.length}_getNumOfStageRunsText(){const e=this._getNumOfSelectedStageRuns()
if(0===e){const e=this.props.stageRuns.length
return`${e} stage ${(0,de._6)(e,"run")}`}return`${e} stage ${(0,de._6)(e,"run")} selected`}_handleChangeSelection(e){this.setState({selectedStageRunIds:e})}_handleSetStatus(e){const t=l.default.object(this.state.selectedStageRunIds.map((t=>[t,e])))
this.setState({statusChanged:!0,statusByStageRunId:{...this.state.statusByStageRunId,...t}})}_getButtons(){return[{text:"Update",style:C.ZJ.SECONDARY,disabled:!this.state.statusChanged||Boolean(this._getIncompatibleSelection()),onClick:this._handleSubmit,key:"update"}]}_fadeIfReviewed(e,t){return d.createElement("div",{className:f()({"u-faded":this._isStageRunReviewed(e.id)})},t)}render(){const e=[nB.Ov.INITIALIZED,nB.Ov.COMPLETED,nB.Ov.DISCARDED].map(((e,t)=>({name:nB.a0[e],key:e,sortOrder:t,submenu:null,handleOnClick:()=>{this._handleSetStatus(e)}}))),t=[fj.Z.defaultColumn("Stage run name","stageRunName",{render:this._renderColumn,sortable:!1}),fj.Z.defaultColumn("Status","status",{render:this._renderColumn,sortable:!1})],n=this.props.stageRuns.map((e=>({data:{stageRunName:this._fadeIfReviewed(e,e.name),status:this._fadeIfReviewed(e,nB.a0[this._getCurrentStatus(e)])},id:e.id,onClick:Jt.ZT,onDoubleClick:Jt.ZT,checked:this._isStageRunSelected(e.id)})))
return d.createElement(et.ZP,{title:"Update status for stage runs",onRequestClose:this.props.onRequestClose,buttons:this._getButtons()},d.createElement("div",null,d.createElement(h.Z,{className:"u-vertical-center-items u-small-spacing"},d.createElement(p.Z,{md:4}),d.createElement(p.Z,{md:4,className:"u-text-align-right"},this._getNumOfStageRunsText()),d.createElement(p.Z,{md:4},d.createElement(tc.Z,{displayName:"Set status",items:[e],disabled:0===this._getNumOfSelectedStageRuns()}))),d.createElement(h.Z,{className:"updateStageRunStatusModal-bodyContainer"},d.createElement(p.Z,{md:12},d.createElement(x0.Z,{columns:t,rows:n,onChangeChecks:e=>{this._handleChangeSelection(e)}}))),this._areAnyStageRunsDiscarded()&&d.createElement("div",{className:"alert alert-warning u-small-spacing"},"Discarding a stage run will also delete all downstream stage runs. This action is not reversible."),this._renderIncompatibleSelectionsError()))}}UpdateStageRunStatusModal.propTypes={workflowStageId:J().string.isRequired,onRequestClose:J().func.isRequired,stageRuns:J().arrayOf(HR.Sd),stageRunsById:J().objectOf(HR.Sd),stageEntriesById:J().objectOf(HR.Tw),stageRunIdByStageFlowNodeId:J().objectOf(J().string)}
const _0=(0,_a.$j)((function UpdateStageRunStatusModal_mapStateToProps(e,{workflowStageId:t}){const n=new HZ.xT(e.models.workflows),a=n.getWorkflowStage(t),i=n.getStageEntries(a),s=l.default.indexBy(i,"id"),r=n.getStageRunsForStageId(t),o=l.default.object(r.map((e=>[e.id,e]))),c=l.default.object(r.map((e=>[e.stageFlowNode.id,e.id])))
return{stageRuns:r,stageRunsById:o,stageEntriesById:s,stageRunIdByStageFlowNodeId:c}}))(UpdateStageRunStatusModal)
class StageMenu extends d.Component{constructor(){super(...arguments)
this.state={isDropdownOpen:!1,isUpdateStageRunStatusModalOpen:!1,isConfigureStageModalOpen:!1,editedStageConfiguration:null,index:null}
this._handleOpenDropdown=()=>{this.setState({isDropdownOpen:!0})}
this._handleCloseDropdown=()=>{this.setState({isDropdownOpen:!1})}
this._handleOpenUpdateStageRunStatusModel=()=>{this.setState({isUpdateStageRunStatusModalOpen:!0})}
this._handleCloseUpdateStageRunStatusModel=()=>{this.setState({isUpdateStageRunStatusModalOpen:!1})}
this._handleEditStage=()=>{this.setState({isConfigureStageModalOpen:!0,editedStageConfiguration:this.props.stageConfiguration})}
this._handleAddStage=()=>{this.setState({isConfigureStageModalOpen:!0,editedStageConfiguration:null,index:this.props.stageConfiguration.index+1})}
this._handleCloseConfigureStageModal=()=>{this.setState({isConfigureStageModalOpen:!1})}}render(){const{onBulkCreateStageRuns:e,onBulkSplitStageRuns:t,onCreate:n,workflowStage:a,stageConfiguration:i,className:s}=this.props
return d.createElement("span",{className:s},d.createElement(Hy.ZP,{menu:d.createElement(LR.Z,{items:[[{name:"Update status",handleOnClick:this._handleOpenUpdateStageRunStatusModel}],[{name:"Add run",handleOnClick:()=>{n(a)}},{name:"Add runs inline",handleOnClick:()=>{e(i)}},{name:"Split by inputs",handleOnClick:()=>{t(a)}}],[{name:"Edit stage",handleOnClick:this._handleEditStage},{name:"Insert stage after",handleOnClick:this._handleAddStage}]],menuStyle:LR.Z.STYLES.COMPACT}),onRequestClose:this._handleCloseDropdown,open:this.state.isDropdownOpen,shouldCloseOnInsideClick:!0},d.createElement(pe.Z,{className:"scrollableTable-headerCell-rightIcon scrollableTable-headerCell-compose",icon:"chevron-down",onClick:this._handleOpenDropdown})),d.createElement(M_.Z,{open:this.state.isUpdateStageRunStatusModalOpen},this.state.isUpdateStageRunStatusModalOpen&&d.createElement(_0,{onRequestClose:this._handleCloseUpdateStageRunStatusModel,workflowStageId:this.props.workflowStage.id})),d.createElement(M_.Z,{open:this.state.isConfigureStageModalOpen},this.state.isConfigureStageModalOpen&&d.createElement(vX,{baseWorkflowTemplateVersionId:this.props.baseWorkflowTemplateVersionId,stageConfiguration:this.state.editedStageConfiguration,onRequestClose:this._handleCloseConfigureStageModal,workflowTemplateVersionId:this.props.stageConfiguration.workflowTemplateVersion.id,index:this.state.index})))}}StageMenu.propTypes={baseWorkflowTemplateVersionId:K.string,className:K.string,onBulkCreateStageRuns:K.func.isRequired,onBulkSplitStageRuns:K.func.isRequired,onCreate:K.func.isRequired,stageConfiguration:HR.po.isRequired,workflowStage:HR.kv.isRequired}
const D0=StageMenu
function StageHeaderCell(e){return d.createElement("div",{className:"workflowDetailsTable-stageHeaderCell"},d.createElement("div",{className:"stageHeaderCell-name",onClick:t=>{e.onSetIsStageCollapsed(!e.isStageCollapsed)}},e.workflowStage.name),e.workflowStage.permissions.writable&&d.createElement(D0,{...e}))}StageHeaderCell.propTypes={baseWorkflowTemplateVersionId:K.string,onBulkCreateStageRuns:K.func.isRequired,onBulkSplitStageRuns:K.func.isRequired,onCreate:K.func.isRequired,onSetIsStageCollapsed:K.func,isStageCollapsed:K.bool,stageConfiguration:HR.po.isRequired,workflowStage:HR.kv.isRequired}
const L0=StageHeaderCell
class StageRunMenu extends d.Component{constructor(){super(...arguments)
this._handleClickDeleteStageRun=()=>{w0.vM(this.props.stageRun,{shouldDeleteDownstreamRuns:!1})}
this._handleClickDeleteStageRunAndDownstreamRuns=()=>{w0.vM(this.props.stageRun,{shouldDeleteDownstreamRuns:!0})}
this._handleRerunStageRun=()=>{w0.MP(this.props.stageRun.id)}
this._handleDuplicateBranch=()=>{this.props.onCopySelectedPath()
m.KK(j.G$.DUPLICATED_BRANCH)}}_updateStageRunStatus(e){w0.On({updateStatusSpecifiers:[{stageRunId:this.props.stageRun.id,status:e}]})}_handleSelect(e){e===nB.Ov.DISCARDED?je.iG("Confirm discard stage run",`Discard the ${this.props.stageRun.name} stage run and delete all downstream stage runs?            This action is not reversible.`,"danger",{acceptText:"Discard",rejectText:"Cancel"}).done((()=>{this._updateStageRunStatus(e)})):this._updateStageRunStatus(e)}render(){const{onEditStageRun:e,onOpenSetExperimentalCondition:t,stageRun:n,isStageEditable:a,isWorkflowEditable:i,openSetExperimentalConditionDisabled:s}=this.props,r=n.stageEntry.permissions.writable,o=l.default.compact([r&&[{name:"Update status",submenu:[[{name:"Initialized",handleOnClick:()=>{this._handleSelect(nB.Ov.INITIALIZED)}},{name:"Completed",handleOnClick:()=>{this._handleSelect(nB.Ov.COMPLETED)}},{name:"Discarded",handleOnClick:()=>{this._handleSelect(nB.Ov.DISCARDED)}}]]}],l.default.compact([r&&{name:"Edit run",handleOnClick:e},r&&{name:"Set experimental conditions",handleOnClick:t,disabled:s},a&&{name:"Delete run",handleOnClick:this._handleClickDeleteStageRun},i&&{name:"Delete this and all downstream runs",handleOnClick:this._handleClickDeleteStageRunAndDownstreamRuns}]),l.default.compact([a&&{name:"Repeat run",handleOnClick:this._handleRerunStageRun},i&&{name:"Duplicate branch",handleOnClick:this._handleDuplicateBranch}])])
return d.createElement(LR.Z,{items:o,menuStyle:LR.Z.STYLES.COMPACT})}}StageRunMenu.propTypes={onEditStageRun:K.func.isRequired,onOpenSetExperimentalCondition:K.func.isRequired,openSetExperimentalConditionDisabled:K.bool.isRequired,onCopySelectedPath:K.func.isRequired,stageRun:HR.Sd.isRequired,isStageEditable:K.bool.isRequired,isWorkflowEditable:K.bool.isRequired}
const k0=StageRunMenu
var M0=n(41936)
class StageRunDescription extends d.Component{constructor(){super(...arguments)
this.state={isDropdownOpen:!1}
this._handleOpenDropdown=()=>{this.setState({isDropdownOpen:!0})}
this._handleCloseDropdown=()=>{this.setState({isDropdownOpen:!1})}
this._handleEditStageRun=()=>{this.props.onEditStageRun(this.props.stageRun)}
this._handleOpenSetExperimentalCondition=()=>{this.props.onOpenSetExperimentalCondition(this.props.stageRun)}
this._handleEntryClick=e=>{de.c4(e)}}render(){const e=this.props.stageRun.status,t=this.props.stageEntry
return d.createElement("div",{className:"stageRunDescription u-lr-split"},d.createElement("div",{className:"u-min-width-zero"},d.createElement("div",{className:"stageRunDescription-header"},d.createElement("svg",{width:12,height:12},d.createElement(StageRunCircle,{highlightMode:jX.DEFAULT,isHovered:this.props.isHovered,position:{x:6,y:6},radius:5,stageRunStatus:e})),d.createElement("div",{className:"stageRunDescription-name"},this.props.stageRun.name)),d.createElement("div",{className:"stageRunDescription-entry u-ellipsis-text"},d.createElement("a",{onClick:this._handleEntryClick,href:this.props.stageEntry.editURL},d.createElement(pe.Z,{className:"u-tiny-spacing-right",icon:(0,ea.qz)(this.props.stageEntry.id)}),d.createElement("span",{className:"u-tiny-spacing-right"},this.props.stageEntry.name),this.props.hasImportant&&d.createElement(pe.Z,{icon:Sn.CT.REJECTED,className:"u-dark-warning-color"})),d.createElement("span",{className:"u-success-color u-tiny-spacing-left"},"review"in t&&t.review&&t.review.status===KL.ZP.ACCEPTED&&"Reviewed"))),this.props.stageEntry.permissions.writable&&!(0,M0.Rk)(this.props.stageEntry)&&d.createElement(Hy.ZP,{menu:d.createElement(k0,{onCopySelectedPath:this.props.onCopySelectedPath,onEditStageRun:this._handleEditStageRun,onOpenSetExperimentalCondition:this._handleOpenSetExperimentalCondition,openSetExperimentalConditionDisabled:this.props.openSetExperimentalConditionDisabled,stageRun:this.props.stageRun,isStageEditable:this.props.isStageEditable,isWorkflowEditable:this.props.isWorkflowEditable}),onRequestClose:this._handleCloseDropdown,open:this.state.isDropdownOpen,shouldCloseOnInsideClick:!0},d.createElement(xI.Z,{className:f()("workflowDetailsTable-hoverIcon",{"is-active":this.state.isDropdownOpen}),icon:"chevron-down",onClick:this._handleOpenDropdown})))}}StageRunDescription.propTypes={isHovered:K.bool.isRequired,onEditStageRun:K.func.isRequired,onCopySelectedPath:K.func.isRequired,onOpenSetExperimentalCondition:K.func.isRequired,openSetExperimentalConditionDisabled:K.bool.isRequired,stageEntry:HR.Tw.isRequired,hasImportant:K.bool.isRequired,stageRun:HR.Sd.isRequired,isStageEditable:K.bool.isRequired,isWorkflowEditable:K.bool.isRequired}
const F0=StageRunDescription
var Z0=n(793326)
function StructuredFieldHeader({fieldDefinition:e}){return d.createElement(P.ZP,{title:e.tableName},d.createElement("span",null,e.name))}StructuredFieldHeader.propTypes={fieldDefinition:K.shape({tableName:K.string.isRequired,name:K.string.isRequired})}
const B0=StructuredFieldHeader
class WorkflowDetailsTable extends d.Component{constructor(){super(...arguments)
this._handleOpenCreateStageRunModal=e=>{openConfigureStageRunsModalToCreateStageRun(this.props.stageRunGraph,e.stageConfiguration.index,{workflowId:this.props.workflow.id})}
this._handleOpenEditStageRunModal=e=>{openConfigureStageRunsModalToEditStageRun(this.props.stageRunGraph,e,{workflowId:this.props.workflow.id})}
this._handleBulkCreateStageRuns=e=>{openConfigureStageRunsModalToBulkCreateStageRuns(this.props.stageRunGraph,e.index,{workflowId:this.props.workflow.id})}
this._handleBulkSplitStageRuns=e=>{w0.wc(e)}
this._handleRowMouseEnter=e=>{this.props.onHoverNode&&e.stageRun&&this.props.onHoverNode(e.stageRun.id)}
this._handleRowMouseLeave=e=>{this.props.onUnhoverNode&&e.stageRun&&this.props.onUnhoverNode(e.stageRun.id)}}componentDidMount(){(0,XZ.DQ)(this.props.stageIdToStageRuns)?this.props.expandStages([this.props.workflowStages[0].id]):this.props.expandStages(l.default.pluck(this.props.workflowStages,"id"))}_handleSetIsStageCollapsed(e,t){e?this.props.collapseStages([t]):this.props.expandStages([t])}async _handleOpenSetExperimentalCondition(e,t){await(0,Xn.Z)(XX,{stageFlowNode:t.stageFlowNode,stageConfiguration:this.props.stageIdToStageConfiguration[e.id],onRequestSubmit:e=>{w0.vg({editSpecifiers:[{stageRunId:t.id,experimentalConditionValueIds:e}]})}})}_renderSamples(e,t){if(e.length>0){for(const t of e)if(null==this.props.stageRunSampleById[t])return d.createElement(Z0.Z,{sample:null})
return d.createElement("span",null,d.createElement(Z0.Z,{sample:this.props.stageRunSampleById[e[0]],key:e[0]}),l.default.rest(e,1).map((e=>d.createElement("span",{key:e},d.createElement("span",null,", "),d.createElement(Z0.Z,{sample:this.props.stageRunSampleById[e]})))))}return d.createElement("div",{className:"workflowDetailsTable-missingCellValue"},t)}_getExperimentalConditionValueNames(e){return(0,qX.Z)(this.props.stageIdToStageRuns[e])}_getFieldDefinitions(e){return(0,O0.Gf)(this.props.stageIdToStructuredData[e])}_getAdditionalHeaderCells(e){return[...this._getExperimentalConditionValueNames(e),...this._getFieldDefinitions(e).map((e=>d.createElement(B0,{fieldDefinition:e})))]}_getAdditionalRowCells(e,t){const n=this._getExperimentalConditionValueNames(e).map((e=>{const n=t.stageFlowNode.experimentalConditionValues.filter((t=>t.name===e))
return n.length>0?(0,qX.yZ)(n):d.createElement("span",{className:"u-faded"},"None")})),a=(0,O0.cz)(this.props.stageIdToStructuredData[e],t.id)
return[...n,...this._getFieldDefinitions(e).map((e=>{const t=l.default.filter(a,(t=>t.tableName===e.tableName&&t.name===e.name))
return d.createElement(C0.vj,{tag:{value:l.default.pluck(t,"value").join(", ")},className:l.default.any(l.default.pluck(t,"important"))?"u-background-active":""})}))]}_getAdditionalColumnsCount(){return Math.max(...this.props.workflowStages.map((e=>this._getExperimentalConditionValueNames(e.id).length+this._getFieldDefinitions(e.id).length)))}_getColumns(){const e=[{header:"",accessorKey:"stageRun",isCollapsible:!1,isSortable:!1,width:307,isFixed:!0}]
if(this.props.isExpanded){e.push({header:"",accessorKey:"input",isCollapsible:!1,isSortable:!1,width:250})
e.push({header:"",accessorKey:"output",isCollapsible:!1,isSortable:!1,flexGrow:1,width:200})
for(let t=0;t<this._getAdditionalColumnsCount();t++)e.push({header:"",accessorKey:`field${t}`,isCollapsible:!1,isSortable:!1,flexGrow:1})}return e}_renderStageHeaderCell(e,{isStageCollapsed:t}){const n=this.props.stageIdToStageConfiguration[e.id]
return d.createElement(L0,{baseWorkflowTemplateVersionId:this.props.workflow.baseWorkflowTemplateVersionId,onBulkCreateStageRuns:this._handleBulkCreateStageRuns,onBulkSplitStageRuns:this._handleBulkSplitStageRuns,onCreate:this._handleOpenCreateStageRunModal,onSetIsStageCollapsed:t=>{this._handleSetIsStageCollapsed(t,e.id)},isStageCollapsed:t,stageConfiguration:n,workflowStage:e})}_getHeaderRowForWorkflowStage(e){const t=l.default.chain(this._getAdditionalHeaderCells(e.id)).map(((e,t)=>[`field${t}`,e])).object().value(),n={stageRun:this._renderStageHeaderCell(e,{isStageCollapsed:!1}),input:"Input",output:"Output",...t}
return{id:e.id,data:n,className:"workflowDetailsTable-headerRow"}}_getCollapsedHeaderRowForWorkflowStage(e){const t=function getSummaryStats(e){const t=e.filter((e=>e.status===nB.Ov.INITIALIZED)).length,n=e.filter((e=>e.status===nB.Ov.COMPLETED)).length,a=e.filter((e=>e.status===nB.Ov.DISCARDED)).length,i=t?`${t} initialized`:null,s=n?`${n} completed`:null,r=a?`${a} discarded`:null
return l.default.compact([s,i,r]).join(" · ")}(this.props.stageIdToStageRuns[e.id])
return{id:e.id,data:{stageRun:this._renderStageHeaderCell(e,{isStageCollapsed:!0}),input:d.createElement("div",{className:"workflowDetailsTable-summaryStats"},t)},className:"workflowDetailsTable-headerRow workflowDetailsTable-headerRow--collapsed"}}_handleCopySelectedPath(e){openConfigureStageRunsModalToDuplicateBranch(this.props.stageRunGraph,e,{workflowId:this.props.workflow.id})}_getRowForStageRun({workflowStage:e,stageRun:t,isLastRow:n}){const a=null==this.props.entryIdToSummaryData?null:this.props.entryIdToSummaryData[t.stageEntry.id],i=null!=a&&a.hasImportant
let s
s=0===t.stageFlowNode.parentIds.length?"None":"Pending"
const r=l.default.chain(this._getAdditionalRowCells(e.id,t)).map(((e,t)=>[`field${t}`,e])).object().value(),o={stageRun:d.createElement(F0,{isHovered:t.id===this.props.hoveredNodeId,onEditStageRun:this._handleOpenEditStageRunModal,onCopySelectedPath:()=>{this._handleCopySelectedPath(t)},onOpenSetExperimentalCondition:t=>{this._handleOpenSetExperimentalCondition(e,t)},openSetExperimentalConditionDisabled:!(0,qX.mY)(this.props.stageIdToStageConfiguration[e.id]),stageEntry:l.default.findWhere(this.props.stageIdToStageEntries[e.id],{id:t.stageEntry.id}),hasImportant:i,stageRun:t,isStageEditable:e.permissions.writable,isWorkflowEditable:this.props.isWorkflowEditable}),input:this._renderSamples(t.inputSampleIds,s),output:this._renderSamples(t.outputSampleIds,"None"),...r}
return{id:t.id,className:f()("workflowDetailsTable-row",{"workflowDetailsTable-lastRow":n}),data:o,isSelected:t.id===this.props.hoveredNodeId,stageRun:t}}_getRowsForWorkflowStage(e){const t=l.default.sortBy(this.props.stageIdToStageRuns[e.id],"createdAt")
if(!t||0===t.length)return[{id:`${e.id}: NO_STAGE_RUNS`,data:{stageRun:d.createElement("div",{className:"workflowDetailsTable-noStageRuns"},d.createElement("div",{className:"stageRunDescription-stageRunLinkVisualization"}),d.createElement("span",{className:"workflowDetailsTable-noStageRuns-text"},"No stage runs")),input:d.createElement("span",{className:"u-faded"},"—"),output:d.createElement("span",{className:"u-faded"},"—"),entry:d.createElement("span",{className:"u-faded"},"—")},className:"workflowDetailsTable-row workflowDetailsTable-lastRow"}]
const n=t.filter((e=>getNodeHighlightMode(e.id,{clickedUpstreamNodeId:this.props.clickedUpstreamNodeId,clickedDownstreamNodeId:this.props.clickedDownstreamNodeId,taggedNodeGraph:this.props.stageRunGraph})!==jX.DEHIGHLIGHTED))
return n.map(((t,a)=>this._getRowForStageRun({workflowStage:e,stageRun:t,isLastRow:a===n.length-1})))}_getRows(){return l.default.flatten(this.props.workflowStages.map(((e,t)=>{if(!this.props.isStageExpandedById[e.id]){return[this._getCollapsedHeaderRowForWorkflowStage(e)]}const n=this._getRowsForWorkflowStage(e)
if(n.length){return[this._getHeaderRowForWorkflowStage(e),...n]}return[]})))}render(){return d.createElement(Xj.Z,{allowOverflow:!1,className:f()("workflowDetailsTable",{"is-collapsed":!this.props.isExpanded}),columns:this._getColumns(),hasLineBelowHeader:!1,isCompact:!1,matchParentHeight:!0,onRowMouseEnter:this._handleRowMouseEnter,onRowMouseLeave:this._handleRowMouseLeave,rows:this._getRows()})}}WorkflowDetailsTable.propTypes={isExpanded:K.bool.isRequired,stageIdToStageEntries:K.objectOf(K.arrayOf(HR.Tw.isRequired).isRequired).isRequired,stageIdToStageRuns:K.objectOf(K.arrayOf(HR.Sd)).isRequired,stageIdToStageConfiguration:K.objectOf(HR.po).isRequired,stageRunSampleById:K.objectOf(HR.Lv).isRequired,stageIdToStructuredData:K.objectOf(HR.SE).isRequired,stageRunGraph:K.object.isRequired,workflowStages:K.arrayOf(HR.kv).isRequired,workflow:HR.bn.isRequired,isWorkflowEditable:K.bool.isRequired,entryIdToSummaryData:K.objectOf(HR.sr.isRequired),clickedUpstreamNodeId:K.string,clickedDownstreamNodeId:K.string,collapseStages:K.func.isRequired,expandStages:K.func.isRequired,hoveredNodeId:K.string,isStageExpandedById:K.objectOf(K.bool.isRequired).isRequired,onHoverNode:K.func,onUnhoverNode:K.func}
const q0=(0,_a.$j)((function WorkflowDetailsTable_mapStateToProps(e,{stageIdToStageRuns:t}){const n=(0,XZ.hu)(t)?null:e.ui.workflowVisualization.hoveredNodeId
return{clickedUpstreamNodeId:e.ui.workflowVisualization.clickedUpstreamNodeId,clickedDownstreamNodeId:e.ui.workflowVisualization.clickedDownstreamNodeId,hoveredNodeId:n,isStageExpandedById:e.ui.workflowDetailsTable.isStageExpandedById}}),(function WorkflowDetailsTable_mapDispatchToProps(e,{stageIdToStageRuns:t}){return(0,XZ.hu)(t)?{onHoverNode:null,onUnhoverNode:null,expandStages(t){e(I0.e1(t))},collapseStages(t){e(I0.k_(t))}}:{onHoverNode(t){e(e0.Vl(t))},onUnhoverNode(t){e(e0.oC(t))},expandStages(t){e(I0.e1(t))},collapseStages(t){e(I0.k_(t))}}}))(WorkflowDetailsTable)
var V0=n(377145),U0=n(697162),G0=n(584890)
function openMetadataTabForError(e,t){Rn.Z.openFile(e,{onOpen(e){e.activateTab(_N.Z)}})
v.ZP.warn(t,{id:"BulkCreateStageEntryReviewModal:openMetadataTabForError"})}async function fetchValidation(e){const t=await WA.WS(e)
for(const e of Object.keys(t))if(t[e].length){QA.X(t[e]);(0,Vn.getStore)().dispatch(U0.C(e,!0))
openMetadataTabForError(e,"Fix schema errors to send for review.")
return!1}return!0}class BulkCreateStageEntryReviewModal extends d.Component{constructor(){super(...arguments)
this.textareaRef=d.createRef()
this.state={error:"",submitting:!1,selectedAuditors:[],message:cA.ql(KL.JF.SEND_FOR_REVIEW)}
this._isMounted=!1
this.handleCommentChange=e=>{this.setState({message:e.target.value})}
this.handleAuditorChange=e=>{this.setState({selectedAuditors:this._ensureTextField(e)})}}static close(){Xe.xv(BulkCreateStageEntryReviewModal)}static async open({stageEntryIds:e,workflowId:t}){const[n,a]=await(0,Ic.jI)(Promise.all([mk.gT(t),fetchValidation(e)]))
a&&Xe.bA(BulkCreateStageEntryReviewModal,d.createElement(BulkCreateStageEntryReviewModal,{stageEntryIds:e,auditors:n}))}componentDidMount(){this._isMounted=!0
if(this.textareaRef.current){const e=u.findDOMNode(this.textareaRef.current)
oo.vq(e,{start:e.value.length,end:e.value.length})}let e=[]
1===this.props.auditors.length&&(e=this.props.auditors)
this.setState({selectedAuditors:this._ensureTextField(e)})}componentWillUnmount(){this._isMounted=!1}onReviewUpdate(e,t,n,a){bk.updateReview(e,t,n)
a&&(0,an.Q5)(a.status_url).then((t=>{if(mk.HG(t)){const{review:n,filePermissions:a}=t
bk.updateReview(e,n,a)}}))}_submitReviewChange(){const e=this.state.selectedAuditors.map((e=>e.handle))
return mk.qK({auditorHandles:e,message:this.state.message,reviewableIds:this.props.stageEntryIds,action:KL.JF.SEND_FOR_REVIEW})}handleSubmit(){this.setState({submitting:!0})
this._submitReviewChange().then((({reviewUpdatedResponseByReviewableId:e})=>{v.ZP.success("Successfully created reviews",{duration:5})
for(const t of Object.keys(e)){const n=e[t]
this.onReviewUpdate(t,n.review,n.filePermissions,n.snapshotTask)}BulkCreateStageEntryReviewModal.close()})).catch((e=>{const t=v.ZP.getFriendlyError(e)
t&&this._isMounted?this.setState({error:t}):v.ZP.notifyError(e)})).finally((()=>{this._isMounted&&this.setState({submitting:!1})}))}_ensureTextField(e){return e.map((e=>({...e,text:(0,Qw.a)(e)})))}render(){const e={enableRedesign:!0,title:"Bulk create reviews",showFooterBorder:!1,buttons:[{submit:!0,text:this.state.submitting?"Creating...":"Bulk create reviews",disabled:this.state.submitting}],closeable:!this.state.submitting,onRequestSubmit:()=>{this.handleSubmit()},onRequestClose:()=>{BulkCreateStageEntryReviewModal.close()}}
return d.createElement(et.ZP,{...e},d.createElement(G0.Z,{ref:this.textareaRef,auditors:this._ensureTextField(this.props.auditors),isSelfReview:!1,shouldRenderCommentBox:!0,esigText:null,error:this.state.error,selectedAuditors:this.state.selectedAuditors,comment:this.state.message,handleCommentChange:this.handleCommentChange,handleAuditorChange:this.handleAuditorChange}))}}const z0=BulkCreateStageEntryReviewModal
var $0=n(930113),W0=n(657929),H0=n(986298),j0=n(976880)
const Y0=K.shape({fulfillment:AZ.Fp.isRequired,request:PZ.c8.isRequired,sampleGroup:HR.rd,requestTask:SZ.Qc,requestSchema:PZ.iQ.isRequired,taskSchema:SZ.eM})
function SampleGroupFieldCell(e){const t=e.sampleGroup.tags.find((({name:t})=>t===e.field.name))
return d.createElement(rc.bL,null,t&&d.createElement(H0.Z,{samples:t.targetSamples,tagSchemaField:e.field}))}SampleGroupFieldCell.propTypes={field:Hn.SCHEMA_FIELD_SHAPE.isRequired,sampleGroup:HR.rd.isRequired}
function FulfillmentStatusTable(e){return d.createElement(rc.iA,{numRows:e.hydratedFulfillments.length,onRowClick:t=>{e.toggleRowSelected(e.rowStates[t].id)}},d.createElement(rc.sg,{header:d.createElement(rc.bL,{className:"simpleTable-checkboxCell"},d.createElement(sw.Z,{items:l.default.pluck(e.rowStates,"id"),selectedMap:t=>l.default.findWhere(e.rowStates,{id:t}).selected,onChange:e.toggleAllRowsSelected})),renderCell:t=>d.createElement(rc.bL,{className:"simpleTable-checkboxCell"},d.createElement("input",{type:"checkbox",checked:e.rowStates[t].selected,onChange:()=>{e.toggleRowSelected(e.rowStates[t].id)}}))}),j0.L7(e.hydratedFulfillments,{renderSampleGroupField:(t,n)=>[d.createElement(rc.sg,{key:`sampleGroupField-${t.name}`,header:t.displayName,renderCell:a=>{const i=e.hydratedFulfillments[a]
return i.sampleGroup&&n.id===i.requestSchema.sampleGroupSchema.id?d.createElement(SampleGroupFieldCell,{field:t,sampleGroup:i.sampleGroup}):null}})],renderRequestID:()=>d.createElement(rc.sg,{key:"requestId",header:"Request ID",renderCell:t=>d.createElement(rc.bL,null,e.hydratedFulfillments[t].request.name)}),renderTask:()=>null,renderStatus:()=>d.createElement(rc.sg,{key:"status",header:"Status",renderCell:t=>{const n=e.hydratedFulfillments[t],a=e.fulfillmentIdToNewStatus[n.fulfillment.id],i=n.fulfillment.status
return d.createElement(rc.bL,null,AZ.r9[a||i])}}),renderRequestField:(t,n)=>d.createElement(rc.sg,{key:`requestField-${t.name}`,header:t.displayName,renderCell:a=>{const i=e.hydratedFulfillments[a]
return d.createElement(rc.bL,null,n.id===i.requestSchema.id&&d.createElement(VF.Z,{tag:i.request.tags.find((({name:e})=>e===t.name))}))}}),renderRequestTaskField:()=>null}))}FulfillmentStatusTable.propTypes={hydratedFulfillments:J().arrayOf(Y0.isRequired).isRequired,fulfillmentIdToNewStatus:J().objectOf(J().oneOf(Object.values(AZ.lG))).isRequired,rowStates:J().arrayOf(J().shape({id:J().string.isRequired,selected:J().bool.isRequired}).isRequired).isRequired,toggleRowSelected:J().func.isRequired,toggleAllRowsSelected:J().func.isRequired}
class MissingDataError extends kg.Z{}function getRequiredFromMap(e,t){(0,S.hu)(null!=e,"id should not be null")
if(t[e])return t[e]
throw new MissingDataError}function getOptionalFromMap(e,t){return null!=e?getRequiredFromMap(e,t):null}function hydrateFulfillmentInputs(e,t,n,a,i,s){return e.map((e=>{(0,S.hu)(null!=e.requestId,`fulfillment.requestId should not be null. fulfillment.id=${e.id}`)
const r=getRequiredFromMap(e.requestId,t)||null,o=getOptionalFromMap(e.requestTaskId,a)||null
return{fulfillment:e,request:r,sampleGroup:getOptionalFromMap(e.sampleGroupId,n)||null,requestTask:o,requestSchema:getRequiredFromMap(r.schemaId,i),requestTaskSchema:o&&getRequiredFromMap(o.schemaId,s)}}))}class UpdateFulfillmentStatusModal extends d.Component{constructor(){super(...arguments)
this.state={isSubmitting:!1}
this._handleSubmit=async()=>{try{this.setState({isSubmitting:!0})
await(0,Ic.jI)(this.props.bulkUpdateFulfillments(this.props.rowStates.filter((e=>null!=e.newStatus)).map((e=>({fulfillmentId:e.id,status:e.newStatus})))),"Updating requests")
this.props.onRequestClose()}finally{this.setState({isSubmitting:!1})}}}componentDidMount(){CN.TN()
this.props.fetchRequestTaskSchemas()
this.props.fetchRequestFulfillments(this.props.fulfillmentIds)}_getStatusMenu(){return d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.MEDIUM},Object.values(AZ.lG).map((e=>e!==AZ.lG.PENDING&&d.createElement(N.Z,{key:e,value:e,onSelect:this.props.setNewStatusForSelectedRows},AZ.r9[e]))))}render(){const e=!this.props.hydratedFulfillments
return d.createElement(et.ZP,{large:!0,title:"Update request status",onRequestClose:this.props.onRequestClose,buttons:[{text:this.state.isSubmitting?"Updating...":"Update",style:C.ZJ.SECONDARY,disabled:this.state.isSubmitting||this.props.rowStates.every((e=>null==e.newStatus)),onClick:this._handleSubmit}]},d.createElement(h.Z,{className:"u-vertical-center-items u-small-spacing"},d.createElement(p.Z,{md:4}),d.createElement(p.Z,{md:4,className:"u-text-align-right"},(()=>{const e=this.props.rowStates.filter((e=>e.selected)).length
return e>0&&`${e} selected`})()),d.createElement(p.Z,{md:4},d.createElement($r.ZP,{displayName:"Set status",disabled:this.props.rowStates.every((e=>!e.selected)),menu:this._getStatusMenu()}))),d.createElement(h.Z,{className:"u-small-spacing-top"},d.createElement(p.Z,{md:12},e?d.createElement(kl.b,null):d.createElement(FulfillmentStatusTable,{hydratedFulfillments:this.props.hydratedFulfillments,fulfillmentIdToNewStatus:l.default.object(this.props.rowStates.map((e=>[e.id,e.newStatus]))),rowStates:this.props.rowStates.map((({id:e,selected:t})=>({id:e,selected:t}))),toggleRowSelected:this.props.toggleRowSelected,toggleAllRowsSelected:this.props.toggleAllRowsSelected}))))}}UpdateFulfillmentStatusModal.propTypes={fulfillmentIds:J().arrayOf(J().string.isRequired).isRequired,hydratedFulfillments:J().arrayOf(Y0.isRequired),bulkUpdateFulfillments:J().func.isRequired,fetchRequestFulfillments:J().func.isRequired,fetchRequestTaskSchemas:J().func.isRequired,onRequestClose:J().func.isRequired,rowStates:J().arrayOf(J().shape({id:J().string.isRequired,selected:J().bool.isRequired,newStatus:J().oneOf(Object.values(AZ.lG))}).isRequired).isRequired,setNewStatusForSelectedRows:J().func.isRequired,toggleRowSelected:J().func.isRequired,toggleAllRowsSelected:J().func.isRequired}
const Q0=(0,W0.Z)({defaultState:{selected:!1,newStatus:null},mapPropsToOrderedIds:e=>e.hydratedFulfillments?e.hydratedFulfillments.map((e=>e.fulfillment.id)):[],mapStateToProps:(e,t,n)=>({rowStates:e,setNewStatusForSelectedRows(e){n((t=>t.selected?{...t,newStatus:e}:t))},toggleRowSelected(e){t(e,(e=>({...e,selected:!e.selected})))},toggleAllRowsSelected(){const t=e.every((e=>e.selected))
n((e=>({...e,selected:!t})))},updateRowState:t,updateEachRowState:n})})
const K0=IN.Z.connect((e=>({requestSchemas:e.getRequestSchemas()})))((0,_a.$j)((function UpdateFulfillmentStatusModal_mapStateToProps(e,{requestSchemas:t,workflow:n}){const{sampleGroupsById:a}=e.models.sampleGroups,{requestsById:i,requestTasksById:s}=e.models.requests.inputs,{requestTaskSchemasById:r}=e.models.requests.schemas,{fulfillmentIds:o,fulfillments:c}=function getFulfillments(e,t){const{fulfillmentsById:n}=e.models.requests.fulfillments,a=l.default.compact(t.initializationDatas.map((e=>e.requestFulfillmentId)));(0,S.hu)(a.length>0,"Should not open fulfillment status modal when there are no fulfillments")
const i=a.every((e=>null!=n[e]))?a.map((e=>n[e])):null
return{fulfillmentIds:a,fulfillments:i}}(e,n),d={fulfillmentIds:o,hydratedFulfillments:null}
if(null==c)return d
try{return{fulfillmentIds:o,hydratedFulfillments:hydrateFulfillmentInputs(c,i,a,s,l.default.indexBy(t,"id"),r)}}catch(e){if(e instanceof MissingDataError)return d
throw e}}),(function UpdateFulfillmentStatusModal_mapDispatchToProps(e){return{async bulkUpdateFulfillments(t){await e((0,RZ.O3)(t))},fetchRequestFulfillments(t){e((0,RZ.qI)(t))},fetchRequestTaskSchemas(){e($0.Qd())}}}))(Q0(UpdateFulfillmentStatusModal)))
class AggregatedNodeGraph extends TaggedNodeGraph{constructor(e){super()
this.unaggregatedGraph=e
this.getAggregatedNodeId=l.default.memoize(this.getAggregatedNodeId)
this.getNodeIdsByAggregatedNodeId=l.default.memoize(this.getNodeIdsByAggregatedNodeId)}getAggregatedNodeId(e){throw new Error("Must be implemented by a subclass.")}getNodeIds(){return l.default.uniq(this.unaggregatedGraph.getNodeIds().map((e=>this.getAggregatedNodeId(e))))}getParentNodeIds(e){return l.default.chain(this.getNodeIdsByAggregatedNodeId(e)).map((e=>this.unaggregatedGraph.getParentNodeIds(e))).flatten().map((e=>this.getAggregatedNodeId(e))).uniq().value()}getTag(e){return this.unaggregatedGraph.getTag(this.getNodeIdsByAggregatedNodeId(e)[0])}getTags(){return this.unaggregatedGraph.getTags()}getNodeIdsByAggregatedNodeId(e){return this.unaggregatedGraph.getNodeIds().filter((t=>this.getAggregatedNodeId(t)===e))}}class AggregatedStageRunGraph extends AggregatedNodeGraph{constructor(e){super(e)
this._getDefiningObject=l.default.memoize(this._getDefiningObject)
this._getAggregatedStageRun=l.default.memoize(this._getAggregatedStageRun)}getAggregatedNodeId(e){return`agg_${JSON.stringify(this._getDefiningObject(e))}`}_getDefiningObject(e){return this.unaggregatedGraph.getPrimaryAncestorNodeIds(e).map((e=>{const t=this.unaggregatedGraph.getStageRun(e),n=t.stageFlowNode.experimentalConditionValues
return{stageIndex:this.unaggregatedGraph.getTag(e),conditionName:(0,qX.yZ)(n),status:t.status}}))}_getAggregatedStageRun(e){(0,S.Gp)("agg_"===e.slice(0,4),`Invalid aggregated node ID ${e}`)
return JSON.parse(e.slice(4))}getAggregatedStageRunStatus(e){return this._getAggregatedStageRun(e).slice(-1)[0].status}}function AggregatedStageRunVisualization(e){const{numStageRuns:t,onClick:n,position:a,stageRunStatus:i}=e
return d.createElement("g",null,d.createElement("circle",{className:f()("stageRunLinkVisualization-line",{"stageRunLinkVisualization-line--discarded":i===nB.Ov.DISCARDED}),cx:a.x,cy:a.y,r:10}),d.createElement(P.ZP,{title:`${t} ${1===t?"stage run":"stage runs"}`,trigger:"hover"},d.createElement("g",{className:"u-pointer",onClick:n},d.createElement("circle",{className:"stageRunVisualization-background",cx:a.x,cy:a.y,r:8}),d.createElement(StageRunCircle,{highlightMode:jX.DEFAULT,isHovered:!1,position:a,radius:8,stageRunStatus:i}))))}AggregatedStageRunVisualization.propTypes={numStageRuns:J().number.isRequired,onClick:J().func.isRequired,position:HX.isRequired,stageRunStatus:J().oneOf(Object.values(nB.Ov)).isRequired}
class WorkflowVisualization extends d.Component{constructor(){super(...arguments)
this._handleOpenCreateStageRunModal=e=>{openConfigureStageRunsModalToCreateStageRun(this.props.stageRunGraph,e.stageConfiguration.index,{workflowId:this.props.workflow.id})}
this._handleBulkCreateStageRuns=e=>{openConfigureStageRunsModalToBulkCreateStageRuns(this.props.stageRunGraph,e.index,{workflowId:this.props.workflow.id})}
this._handleBulkSplitStageRuns=e=>{w0.wc(e)}}_handleClickStageRun(e,t){e.stopPropagation()
this.props.onClickNode(t.id)}_getWorkflowStage(e){const t=l.default.findKey(this.props.stageIdToStageRuns,(t=>t.includes(e)))
return this.props.workflowStages.find((e=>e.id===t))}_handleClickEditStageRun(e){openConfigureStageRunsModalToEditStageRun(this.props.stageRunGraph,e,{workflowId:this.props.workflow.id})}async _handleClickSetExperimentalCondition(e){await(0,Xn.Z)(XX,{stageFlowNode:e.stageFlowNode,stageConfiguration:this.props.stageIdToStageConfiguration[this._getWorkflowStage(e).id],onRequestSubmit:t=>{w0.vg({editSpecifiers:[{stageRunId:e.id,experimentalConditionValueIds:t}]})}})}_handleCopySelectedPath(e){openConfigureStageRunsModalToDuplicateBranch(this.props.stageRunGraph,e,{workflowId:this.props.workflow.id})}_renderStageMenu(e){if(!this.props.workflow.permissions.writable)return null
const t=this.props.workflowStages.find((t=>t.stageConfiguration.id===e.id))
return d.createElement(D0,{baseWorkflowTemplateVersionId:this.props.workflow.baseWorkflowTemplateVersionId,className:"stageVisualization-icon",onBulkCreateStageRuns:this._handleBulkCreateStageRuns,onBulkSplitStageRuns:this._handleBulkSplitStageRuns,onCreate:this._handleOpenCreateStageRunModal,stageConfiguration:e,workflowStage:t})}render(){const{containerWidth:e,stageIdToStageRuns:t,clickedDownstreamNodeId:n,clickedUpstreamNodeId:a,onReset:i,rightClickedNodeId:s,onRightClickNode:r,onClearRightClick:o,hoveredNodeId:c,onClickLink:u,onHoverNode:m,onUnhoverNode:p,stageConfigurations:h}=this.props,g=XZ.P7(t),E=l.default.flatten(Object.values(t))
let y,b
if(g){y=new AggregatedStageRunGraph(new StageRunGraph(E,h))
b=new GraphLayout(y,10)}else{y=new StageRunGraph(E,h)
b=new GraphLayout(y,6)}const T=b.getTreeHeight(),v=b.getTotalWidth(e),C=b.getTotalHeight(e),I=b.getLinks({leftBoundary:0,rightBoundary:v})
return d.createElement("div",{className:"workflowVisualization",style:{width:v,height:C},onClick:i},d.createElement("div",{className:"workflowVisualization-stages"},h.map((e=>d.createElement(StageVisualization,{key:e.id,name:e.stageName,height:C,width:b.getTagWidth(e.index),icon:this._renderStageMenu(e)})))),d.createElement("div",{className:f()("workflowVisualization-arms",{"is-tall":b.isTallVisualization()})},d.createElement("svg",{width:v,height:T},I.map((({key:e,leftPosition:t,rightPosition:i,parentNodeId:s,childNodeId:r,isSecondary:o})=>{const l=r||s
let c
c=g?y.getAggregatedStageRunStatus(l):y.getStageRun(l).status
const m=o?StageFlowNodeSecondaryLinkVisualization:StageRunLinkVisualization
return d.createElement(m,{key:e,highlightMode:getLinkHighlightMode(s,r,{clickedUpstreamNodeId:a,clickedDownstreamNodeId:n,taggedNodeGraph:y}),isDiscarded:c===nB.Ov.DISCARDED,onClick:e=>{e.stopPropagation()
u(s,r)},leftPosition:t,rightPosition:i})})),y.getNodeIds().map((e=>{const t=getNodeHighlightMode(e,{clickedUpstreamNodeId:a,clickedDownstreamNodeId:n,taggedNodeGraph:y}),i=this.props.workflowStages.find((t=>t.stageConfiguration.index===y.getTag(e)));(0,S.hu)(Boolean(i),`No stage found at index ${y.getTag(e)}`)
if(g)return d.createElement(AggregatedStageRunVisualization,{key:e,numStageRuns:y.getNodeIdsByAggregatedNodeId(e).length,onClick:e=>{e.stopPropagation()
this.props.toggleStage(i.id)},position:b.getNodePosition(e),stageRunStatus:y.getAggregatedStageRunStatus(e)})
{const n=b.getTagWidth(y.getTag(e)),a=y.getStageRun(e),i=this._getWorkflowStage(a)
return d.createElement(Hy.ZP,{key:e,menu:d.createElement(k0,{stageRun:a,onEditStageRun:()=>{this._handleClickEditStageRun(a)},onOpenSetExperimentalCondition:()=>{this._handleClickSetExperimentalCondition(a)},openSetExperimentalConditionDisabled:!(0,qX.mY)(this.props.stageIdToStageConfiguration[i.id]),onCopySelectedPath:()=>{this._handleCopySelectedPath(a)},isStageEditable:i.permissions.writable,isWorkflowEditable:this.props.isWorkflowEditable}),onRequestClose:o,open:e===s,shouldCloseOnInsideClick:!0},d.createElement(YX,{highlightMode:t,experimentalConditionValues:a.stageFlowNode.experimentalConditionValues,isNodeClickable:!0,isHovered:e===c,onClick:e=>{this._handleClickStageRun(e,a)},onHover:()=>{m(e)},onUnhover:()=>{p(e)},onRightClick:n=>{n.preventDefault()
t!==jX.HIGHLIGHTED&&this.props.onClickNode(e)
r(e)},position:b.getNodePosition(e),stageWidth:n,relativeX:b.getRelativeX(e),stageRunStatus:a.status,shouldShowExperimentalCondition:y.isLastDescendantWithTag(e),tooltipTitle:a.name}))}})))))}}WorkflowVisualization.propTypes={containerWidth:J().number.isRequired,workflowStages:J().arrayOf(HR.kv.isRequired).isRequired,stageIdToStageRuns:J().objectOf(J().arrayOf(HR.Sd)).isRequired,stageIdToStageConfiguration:J().objectOf(HR.po).isRequired,stageRunGraph:J().object.isRequired,workflowId:J().string.isRequired,clickedUpstreamNodeId:J().string,clickedDownstreamNodeId:J().string,rightClickedNodeId:J().string,hoveredNodeId:J().string,onReset:J().func.isRequired,onClickNode:J().func.isRequired,onClickLink:J().func.isRequired,onRightClickNode:J().func.isRequired,onClearRightClick:J().func.isRequired,onHoverNode:J().func.isRequired,onUnhoverNode:J().func.isRequired,isWorkflowEditable:J().bool.isRequired,toggleStage:J().func,stageConfigurations:J().arrayOf(HR.po.isRequired).isRequired,workflow:HR.bn.isRequired}
const J0=(0,_a.$j)((function WorkflowVisualization_mapStateToProps(e,{workflowId:t}){const n=new HZ.xT(e.models.workflows),a=n.getWorkflow(t)
return{clickedUpstreamNodeId:e.ui.workflowVisualization.clickedUpstreamNodeId,clickedDownstreamNodeId:e.ui.workflowVisualization.clickedDownstreamNodeId,rightClickedNodeId:e.ui.workflowVisualization.rightClickedNodeId,hoveredNodeId:e.ui.workflowVisualization.hoveredNodeId,stageConfigurations:n.getStageConfigurations(a.workflowTemplateVersion.id),workflow:a}}),(function WorkflowVisualization_mapDispatchToProps(e){return{onReset(){e(e0.mc())},onClickNode(t){e(e0.mP(t))},onClickLink(t,n){e(e0.iw(t,n))},onRightClickNode(t){e(e0.UH(t))},onClearRightClick(){e(e0.UH(null))},onHoverNode(t){e(e0.Vl(t))},onUnhoverNode(t){e(e0.oC(t))},toggleStage(t){e(I0.qI(t))}}}))(WorkflowVisualization)
class WorkflowDetailsHeader extends d.Component{constructor(){super(...arguments)
this.state={isSettingsModalOpen:!1}
this._handleClickSettingsIcon=()=>{this.setState({isSettingsModalOpen:!0})}
this._handleRequestCloseModal=()=>{this.setState({isSettingsModalOpen:!1})}
this._handleUpdateFulfillmentStatuses=async()=>{await(0,Xn.Z)(K0,{workflow:this.props.workflow})}}_shouldShowSettings(){return this.props.workflow.permissions.writable}_getAllStageEntryIds(){return[].concat(...this.props.workflowStages.map((e=>e.stageEntries))).map((e=>e.id))}_wasInitializedFromRequest(){return 0!==this.props.workflow.initializationDatas.length}render(){return d.createElement("div",{className:"workflows-workflowDetailsHeader"},d.createElement("div",{className:f()("workflows-workflowDetailsHeader-column",{"is-expanded":this.props.isExpanded})},d.createElement("div",{className:"workflows-workflowDetailsHeader-row1"},!this.props.isExpanded&&d.createElement(V0.Z,{className:"u-position-absolute",expanded:!1})),d.createElement(UX,null,d.createElement(WorkflowsCrumbLink,{className:"workflows-workflowDetailsHeader-workflowsCrumbLink"})),d.createElement("div",null,d.createElement(M_.Z,{open:this.state.isSettingsModalOpen},d.createElement(GX,{onRequestClose:this._handleRequestCloseModal,workflow:this.props.workflow})),d.createElement("span",{className:"workflows-workflowHeader-header"},d.createElement(P.ZP,{placement:P.TQ.BOTTOM,title:this.props.workflow.humanId},d.createElement(so.R6,{className:"workflows-workflowDetailsHeader-workflowHumanId"},this.props.workflow.humanId)),this._shouldShowSettings()&&d.createElement(yh.Z,{onClick:this._handleClickSettingsIcon})),d.createElement(P.ZP,{placement:P.TQ.BOTTOM,title:this.props.workflow.name},d.createElement("div",{className:"workflows-workflowDetailsHeader-workflowName"},this.props.workflow.name)),d.createElement(P.ZP,{placement:P.TQ.BOTTOM,title:this.props.workflow.description||""},d.createElement(a0,{description:this.props.workflow.description,onClickMore:this._handleClickSettingsIcon}))),d.createElement("div",{className:"u-vertical-flex u-justify-content-end u-flex-grow"},d.createElement("div",{className:"workflows-workflowDetailsHeader-buttonRow"},this._wasInitializedFromRequest()&&d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:this._handleUpdateFulfillmentStatuses,size:C.qE.SMALL,text:"Update Requests"}),dt.ZP.LEGACY_WORKFLOWS_ENABLE_BULK_SEND_STAGE_ENTRIES_FOR_REVIEW&&!dt.ZP.ENABLE_ELN_ESIGNATURE&&d.createElement(C.Co,{disabled:!this._getAllStageEntryIds().length,buttonStyle:C.ZJ.SECONDARY,size:C.qE.MEDIUM,onClick:()=>z0.open({stageEntryIds:this._getAllStageEntryIds(),workflowId:this.props.workflow.id}),text:"Send all entries for review"})))),d.createElement("div",{className:"workflows-workflowDetailsHeader-right"},d.createElement(WC.ZP,{disableHeight:!0},(({width:e})=>d.createElement("div",{className:"workflows-workflowDetailsHeader-workflowVisualizationContainer"},d.createElement(J0,{containerWidth:e,workflowStages:this.props.workflowStages,workflowId:this.props.workflow.id,stageIdToStageRuns:this.props.stageIdToStageRuns,stageIdToStageConfiguration:this.props.stageIdToStageConfiguration,stageRunGraph:this.props.stageRunGraph,isWorkflowEditable:this.props.workflow.permissions.writable})))),d.createElement("div",{className:"workflows-workflowDetailsHeader-toggleCollapseArrow"},this.props.isExpanded&&d.createElement(V0.Z,{expanded:!0}))))}}WorkflowDetailsHeader.propTypes={workflow:HR.bn.isRequired,workflowStages:J().arrayOf(HR.kv.isRequired).isRequired,stageRunGraph:J().object.isRequired,stageIdToStageRuns:J().objectOf(J().arrayOf(HR.Sd)).isRequired,stageIdToStageConfiguration:J().objectOf(HR.po).isRequired,isExpanded:J().bool.isRequired}
const X0=WorkflowDetailsHeader
function WorkflowDetailsScreen(e){return d.createElement(Db.W2,{className:"expandedContainer--fullScreen",size:"lg"},d.createElement(X0,{workflow:e.workflow,workflowStages:e.workflowStages,stageIdToStageRuns:e.stageIdToStageRuns,stageIdToStageConfiguration:e.stageIdToStageConfiguration,stageRunGraph:e.stageRunGraph,isExpanded:e.isExpanded}),d.createElement(Db.X2,{fluid:!0},d.createElement(Db.JX,{className:"u-flex-display u-vertical-flex",lg:22},d.createElement(q0,{isExpanded:e.isExpanded,stageIdToStageEntries:e.stageIdToStageEntries,stageIdToStageRuns:e.stageIdToStageRuns,stageIdToStageConfiguration:e.stageIdToStageConfiguration,stageIdToStructuredData:e.stageIdToStructuredData,stageRunGraph:e.stageRunGraph,stageRunSampleById:e.stageRunSampleById,workflowStages:e.workflowStages,workflow:e.workflow,isWorkflowEditable:e.workflow.permissions.writable,entryIdToSummaryData:e.entryIdToSummaryData}))))}WorkflowDetailsScreen.propTypes={isExpanded:J().bool.isRequired,stageIdToStageEntries:J().objectOf(J().arrayOf(HR.Tw.isRequired).isRequired).isRequired,stageIdToStageRuns:J().objectOf(J().arrayOf(HR.Sd)).isRequired,stageIdToStageConfiguration:J().objectOf(HR.po.isRequired).isRequired,stageIdToStructuredData:J().objectOf(HR.SE.isRequired).isRequired,stageRunGraph:J().object.isRequired,stageRunSampleById:J().objectOf(HR.Lv.isRequired).isRequired,workflow:HR.bn.isRequired,workflowStages:J().arrayOf(HR.kv.isRequired).isRequired,entryIdToSummaryData:J().objectOf(HR.sr.isRequired)}
class WorkflowTemplateSettingsModal extends d.Component{constructor(){super(...arguments)
this._handleDeleteWorkflowTemplate=()=>TX.wS(this.props.workflowTemplate.id)
this._handleRequestSubmit=({name:e,prefix:t,owner:n,ownerInfo:a,collaborators:i})=>TX.e6(this.props.workflowTemplate.id,{name:e,owner:n,ownerInfo:a,prefix:t,collaborators:i})}componentDidMount(){null==this._getExistingOwnable()&&TX.U5(this.props.workflowTemplate.id,{onFailure:this.props.onRequestClose})}_getExistingOwnable(){return null==this.props.collaborators?null:{name:this.props.workflowTemplate.name,prefix:this.props.workflowTemplate.prefix,description:"",owner:this.props.workflowTemplate.owner,ownerInfo:this.props.workflowTemplate.ownerInfo,collaborators:this.props.collaborators.filter((({owner:e})=>!e)),permissions:this.props.workflowTemplate.permissions}}render(){const e=this._getExistingOwnable()
return null==e?null:d.createElement(c0,{ownableId:this.props.workflowTemplate.id,existingOwnable:e,onRequestClose:this.props.onRequestClose,doSubmit:this._handleRequestSubmit,doDelete:this._handleDeleteWorkflowTemplate})}}WorkflowTemplateSettingsModal.propTypes={onRequestClose:J().func.isRequired,workflowTemplate:HR.yr.isRequired,collaborators:J().arrayOf(LN.fN.isRequired)}
const e1=(0,_a.$j)((function WorkflowTemplateSettingsModal_mapStateToProps(e,{workflowTemplate:t}){return{collaborators:e.models.collaboratorsByOwnableId[t.id]}}))(WorkflowTemplateSettingsModal)
var t1=n(344462)
class WorkflowTemplateViewScreen extends d.Component{constructor(){super(...arguments)
this._isMounted=!1
this.state={isConfigureStageModalOpen:!1,isSettingsModalOpen:!1,editingStageConfiguration:null,isEditingVersionDescription:!1,versionDescription:this.props.workflowTemplateVersion.description,isCreateWorkflowTemplateModalOpen:!1}
this._handleOpenCreateStageConfigurationModal=()=>{this.setState({isConfigureStageModalOpen:!0})}
this._handleOpenEditStageConfigurationModal=e=>{this.setState({isConfigureStageModalOpen:!0,editingStageConfiguration:e})}
this._handleCloseConfigureStageModal=()=>{this.setState({isConfigureStageModalOpen:!1,editingStageConfiguration:null})}
this._handleOpenSettingsModal=()=>{this.setState({isSettingsModalOpen:!0})}
this._handleCloseSettingsModal=()=>{this._isMounted&&this.setState({isSettingsModalOpen:!1})}
this._handlePublishDraft=()=>{TX.oi(this.props.workflowTemplateVersion.id)}
this._handleEditWorkflowTemplate=()=>{TX.w2(this.props.workflowTemplateVersion)}
this._handleChangeVersionDescription=({target:{value:e}})=>{this.setState({versionDescription:e})}
this._handleClickEditVersionDescription=e=>{this.setState({isEditingVersionDescription:!0})}
this._handleSaveVersionDescription=e=>{TX.sv(this.props.workflowTemplateVersion.id,{description:this.state.versionDescription})
this.setState({isEditingVersionDescription:!1})}
this._handleCancelVersionDescription=e=>{this.setState({isEditingVersionDescription:!1,versionDescription:this.props.workflowTemplateVersion.description})}
this._handleOpenCreateWorkflowTemplateModal=()=>{this.setState({isCreateWorkflowTemplateModalOpen:!0})}
this._handleCloseCreateWorkflowTemplateModal=()=>{this._isMounted&&this.setState({isCreateWorkflowTemplateModalOpen:!1})}
this._handleCreateNewWorkflowTemplate=({name:e,owner:t,ownerInfo:n,prefix:a,collaborators:i})=>TX.B0({name:e,owner:t,ownerInfo:n,collaborators:i.map((e=>(0,LN.Ne)(e)?(0,jc.Z)(e,"id","dataPolicyId"):(0,jc.Z)(e,"id","memberDataPolicyId","adminDataPolicyId"))),prefix:a,workflowTemplateVersionId:this.props.workflowTemplateVersion.id})}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}_isDraft(){return null==this.props.workflowTemplateVersion.version}_isEditable(){return this._isDraft()&&this.props.workflowTemplateVersion.permissions.writable}_renderHeaderButtons(){return this._isDraft()?this.props.workflowTemplateVersion.permissions.writable?d.createElement("div",{className:"u-spacing-bottom"},d.createElement(C.Co,{className:"u-tiny-spacing-left",buttonStyle:C.ZJ.SECONDARY,onClick:this._handlePublishDraft,size:C.qE.SMALL,text:"Publish"})):null:d.createElement("div",{className:"u-spacing-bottom"},d.createElement(o0,{workflowTemplateId:this.props.workflowTemplate.id,workflowTemplateVersionId:this.props.workflowTemplateVersion.id}))}_renderVersionHeader(){return d.createElement("div",{className:"u-lr-split"},d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE,scrollable:!0},this.props.workflowTemplate.workflowTemplateVersions.map(((e,t)=>d.createElement(N.Z,{key:t,onSelect:()=>{TX.Ul(e.id)}},t1.p(e)))))},d.createElement(C.Co,{isDropdown:!0,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:t1.p(this.props.workflowTemplateVersion)})),!this._isDraft()&&d.createElement("div",null,d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:this._handleEditWorkflowTemplate,size:C.qE.SMALL,text:"Edit"}),d.createElement(C.Co,{className:"u-tiny-spacing-left",buttonStyle:C.ZJ.TERTIARY_GRAY,onClick:this._handleOpenCreateWorkflowTemplateModal,size:C.qE.SMALL,text:"Save as..."})))}render(){return d.createElement("div",null,d.createElement(M_.Z,{open:this.state.isConfigureStageModalOpen},d.createElement(vX,{workflowTemplateVersionId:this.props.workflowTemplateVersion.id,stageConfiguration:this.state.editingStageConfiguration,onRequestClose:this._handleCloseConfigureStageModal})),d.createElement(M_.Z,{open:this.state.isSettingsModalOpen},d.createElement(e1,{onRequestClose:this._handleCloseSettingsModal,workflowTemplate:this.props.workflowTemplate})),d.createElement(M_.Z,{open:this.state.isCreateWorkflowTemplateModalOpen},d.createElement(c0,{title:`Save ${t1.p(this.props.workflowTemplateVersion)} as...`,onRequestClose:this._handleCloseCreateWorkflowTemplateModal,doSubmit:this._handleCreateNewWorkflowTemplate})),d.createElement(Db.W2,{size:"lg"},d.createElement("div",{className:"workflows-workflowDetailsHeader"},d.createElement("div",{className:"workflows-workflowDetailsHeader-column is-expanded"},d.createElement("div",{className:"workflows-workflowDetailsHeader-row1"}),d.createElement(UX,null,d.createElement(WorkflowTemplatesCrumbLink,null)),d.createElement("div",{className:"u-flex-grow"},d.createElement("span",{className:"workflows-workflowHeader-header"},d.createElement(so.R6,null,`${this.props.workflowTemplate.name}${this._isDraft()?" (Draft)":""}`),this.props.workflowTemplate.permissions.readable&&d.createElement(yh.Z,{onClick:this._handleOpenSettingsModal}))),this._renderHeaderButtons()),d.createElement("div",{className:"workflows-workflowDetailsHeader-right"},d.createElement(WC.ZP,{disableHeight:!0},(({width:e})=>d.createElement("div",{className:"workflows-workflowDetailsHeader-workflowVisualizationContainer"},d.createElement(t0,{containerWidth:e,isEditable:this._isEditable(),stageConfigurations:this.props.stageConfigurations,stageConfigurationIdToStageFlowNodes:this.props.stageConfigurationIdToStageFlowNodes})))))),d.createElement(Db.X2,null,d.createElement(Db.JX,{className:"workflowTemplateViewScreen-row",lg:22},this._renderVersionHeader())),d.createElement(Db.X2,null,d.createElement(Db.JX,{className:"workflowTemplateViewScreen-row",lg:11},d.createElement("div",null,d.createElement("span",{className:"legacy-font-proxima-title"},"Description"),this._isEditable()&&(this.state.isEditingVersionDescription?d.createElement("span",null,d.createElement(pe.Z,{className:"u-tiny-spacing-left faded u-primary-pointer metadata-action-icon--complete",icon:"check",onClick:this._handleSaveVersionDescription}),d.createElement(pe.Z,{className:"u-tiny-spacing-left faded u-danger-pointer",icon:"close",onClick:this._handleCancelVersionDescription})):d.createElement(pe.Z,{className:"u-tiny-spacing-left faded u-primary-pointer",icon:"edit",onClick:this._handleClickEditVersionDescription}))),this.state.isEditingVersionDescription?d.createElement("textarea",{autoFocus:!0,value:this.state.versionDescription||"",onChange:this._handleChangeVersionDescription,rows:3}):d.createElement("div",null,this.props.workflowTemplateVersion.description))),d.createElement(Db.X2,null,d.createElement(Db.JX,{className:"workflowTemplateViewScreen-row",lg:22},d.createElement(VX,{isEditable:this._isEditable(),onCreateStageConfiguration:this._handleOpenCreateStageConfigurationModal,onEditStageConfiguration:this._handleOpenEditStageConfigurationModal,stageConfigurations:this.props.stageConfigurations})))))}}WorkflowTemplateViewScreen.propTypes={workflowTemplate:HR.yr.isRequired,workflowTemplateVersion:HR.pd.isRequired,stageConfigurations:K.arrayOf(HR.po.isRequired).isRequired,stageConfigurationIdToStageFlowNodes:K.objectOf(K.arrayOf(HR.UP.isRequired)).isRequired}
const n1=WorkflowTemplateViewScreen,a1={[HR.JY.WORKFLOW_DASHBOARD]:{fetch(){},readFromStore:()=>({}),title:()=>(0,XZ.U8)("Legacy Workflows","Workflows"),getUrlParam:()=>null,render:e=>d.createElement(v0,{...e,screen:HR.JY.WORKFLOW_DASHBOARD})},[HR.JY.WORKFLOW_DASHBOARD_TEMPLATES]:{fetch(){TX.ll()},readFromStore:e=>({workflowTemplates:e.getAllWorkflowTemplates()}),title:()=>(0,XZ.U8)("Legacy Workflow Templates","Workflow Templates"),getUrlParam:()=>null,render:({workflowTemplates:e})=>d.createElement(v0,{workflowTemplates:e,screen:HR.JY.WORKFLOW_DASHBOARD_TEMPLATES})},[HR.JY.WORKFLOW_DETAILS]:{async fetch({workflowId:e}){try{await dc.T9(e)}catch(e){if(!Cn.d0(e))throw e
if((0,kN.qg)(e.responseJSON)){(0,kN.do)(e.responseJSON)
dc.KI()}else v.ZP.notifyError(e)}},readFromStore(e,{workflowId:t}){const n=e.getWorkflow(t)
return{workflowTemplateVersion:n?e.getWorkflowTemplateVersion(n.workflowTemplateVersion.id):null,stageConfigurations:n?e.getStageConfigurations(n.workflowTemplateVersion.id):null,stageConfigurationIdToStageFlowNodes:n?e.getStageConfigurationIdToStageFlowNodes(n.workflowTemplateVersion.id):null,stageIdToStageEntries:e.getStageIdToStageEntries(t),stageIdToStageRuns:e.getStageIdToStageRuns(t),stageIdToStageConfiguration:e.getStageIdToStageConfiguration(t),stageIdToStructuredData:e.getStageIdToStructuredData(t),stageRunSampleById:e.getStageRunSampleById(),workflow:n,workflowStages:e.getWorkflowStages(t),entryIdToSummaryData:e.getEntryIdToSummaryData()}},title:({workflow:e})=>e?e.humanId:(0,XZ.U8)("Legacy Workflow","Workflow"),getUrlParam:e=>e.workflowId,render({workflowTemplateVersion:e,stageConfigurations:t,stageConfigurationIdToStageFlowNodes:n,workflow:a,workflowStages:i,stageIdToStageRuns:s,stageIdToStructuredData:r,isExpanded:o,stageIdToStageConfiguration:c,stageRunSampleById:u,stageIdToStageEntries:m,entryIdToSummaryData:p}){if(a&&i){if((0,XZ.X9)(a)){const e=l.default.flatten(Object.values(s)),n=new StageRunGraph(e,t)
return d.createElement(WorkflowDetailsScreen,{isExpanded:o,stageIdToStageEntries:m,stageIdToStageRuns:s,stageIdToStageConfiguration:c,stageIdToStructuredData:r,stageRunGraph:n,stageRunSampleById:u,workflow:a,workflowStages:i,entryIdToSummaryData:p})}return d.createElement(s0,{workflow:a,workflowTemplateVersion:e,stageConfigurations:t,stageConfigurationIdToStageFlowNodes:n})}return d.createElement("div",{className:"text-center u-padding-top"},d.createElement(kl.Z,null))}},[HR.JY.WORKFLOW_TEMPLATE_VIEW]:{fetch({workflowTemplateId:e}){TX.x1(e)},readFromStore:(e,{workflowTemplateId:t,selectedWorkflowTemplateVersionId:n})=>({workflowTemplate:e.getWorkflowTemplate(t),workflowTemplateVersion:n?e.getWorkflowTemplateVersion(n):null,stageConfigurations:n?e.getStageConfigurations(n):null,stageConfigurationIdToStageFlowNodes:e.getStageConfigurationIdToStageFlowNodes(n)}),title:({workflowTemplate:e})=>e?e.name:"Workflow Template",getUrlParam:e=>e.workflowTemplateId,render(e){const{workflowTemplate:t,workflowTemplateVersion:n,stageConfigurations:a,stageConfigurationIdToStageFlowNodes:i}=e
return t&&n&&a?d.createElement(n1,{workflowTemplate:t,workflowTemplateVersion:n,stageConfigurations:a,stageConfigurationIdToStageFlowNodes:i}):d.createElement("div",{className:"text-center u-padding-top"},d.createElement(kl.Z,null))}}}
class WorkflowsSidepanel extends d.Component{componentDidMount(){const{screen:e,params:t}=this.props.viewState
a1[e].fetch(t)
this._goToScreen(e)}componentDidUpdate(e){const{screen:t,params:n}=e.viewState,{screen:a,params:i}=this.props.viewState
t===a&&this.getDocumentURL({screen:t,params:n})===this.getDocumentURL({screen:a,params:i})||a1[a].fetch(i)
this._goToScreen(a)}getDocumentURL({screen:e,params:t}){let n
const a=(0,XZ.oN)()
switch(e){case HR.PC.WORKFLOW_DASHBOARD:n=a
break
case HR.PC.WORKFLOW_DASHBOARD_TEMPLATES:n=`${a}/templates`
break
case HR.PC.WORKFLOW_DETAILS:n=`${a}/view`
break
case HR.PC.WORKFLOW_TEMPLATE_VIEW:n=`${a}/templates/view`
break
default:throw new Error(`Unexpected screen: ${e}`)}const i=a1[e].getUrlParam(t)
i&&(n=`${n}/${i}`)
return n}_goToScreen(e){const t=a1[e]
if(this.props.isExpanded){de._w(t.title(this.props.screenProps))
if(e!==HR.PC.WORKFLOW_DASHBOARD){const e=this.getDocumentURL(this.props.viewState);(0,ac.ZP)(e,{skipTrigger:!0,replace:!1})}}HR.KS.includes(e)||this.props.isExpanded||w_.jn()}render(){const e={...this.props.screenProps,isExpanded:this.props.isExpanded}
return d.createElement("div",{className:"sidepanel"},a1[this.props.viewState.screen].render(e))}}WorkflowsSidepanel.propTypes={isExpanded:J().bool.isRequired,viewState:J().shape({screen:J().string.isRequired,params:J().object}).isRequired,screenProps:J().object.isRequired}
const i1=(0,_a.$j)((function WorkflowsSidepanel_mapStateToProps(e){const t=new HZ.xT(e.models.workflows),n=t.getViewState()
return{viewState:n,screenProps:a1[n.screen].readFromStore(t,n.params)}}))(WorkflowsSidepanel)
var s1=n(335685),r1=n(23127),o1=n(375619),l1=n(971466),c1=n(797431)
function ExpandedSidepanelSkeleton({header:e,content:t,dataTestAttrs:n}){return d.createElement(Db.W2,{className:"sidepanel expandedContainer",size:"lg",dataTestAttrs:null!=n?n:{component:"ExpandedSidepanel",element:"root",key:"expanded"}},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},e)),d.createElement(Db.X2,{fluid:!0},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21,className:"u-flex-display u-vertical-flex"},t)))}var d1=n(825309)
const u1=6,m1=6
function DeleteWorklistsModal(e){return d.createElement(et.ZP,{buttons:[{submit:!0,text:"Delete worklists",style:C.ZJ.NEGATIVE}],onRequestClose:e.onRequestClose,onRequestSubmit:()=>{!function deleteWorklists(){(0,d1.tx)(e.worklists.map((e=>e.id)),e.refreshOptions)}()
e.onRequestSubmit()},title:"Delete worklists",titleIcon:"worklist"},d.createElement(d.Fragment,null,d.createElement(h.Z,{key:"title"},d.createElement(p.Z,{sm:u1},d.createElement("h5",null,"Name")),d.createElement(p.Z,{sm:m1},d.createElement("h5",null,"Type"))),e.worklists.map((e=>d.createElement(h.Z,{className:(0,g.iv)(p1.tableRow),key:e.id},d.createElement(p.Z,{sm:u1},e.name),d.createElement(p.Z,{sm:m1},(0,Mt.kC)((0,Po.My)(e.itemType))))))))}const p1=g.mM.create({tableRow:{marginBottom:0,padding:"5px 0",display:"flex",justifyContent:"center",alignItems:"center",borderTop:`1px solid ${Vt.tN}`}})
function DeleteWorklistsButton(e){const t=0===e.selectedWorklists.length,n=0===e.selectedWorklists.length?"Must select worklists":"Delete worklists"
return d.createElement(P.ZP,{title:n},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_WHITE,className:e.className,disabled:t,icon:"delete",onClick:()=>{(0,Xn.Z)(DeleteWorklistsModal,{worklists:e.selectedWorklists,refreshOptions:e.refreshOptions})},size:C.qE.SMALL}))}var h1=n(467097)
function ExpandedWorklistsTable(e){if(!e.worklists)return d.createElement(kl.b,null)
if(0===e.worklists.length)return d.createElement("div",{className:"sidepanel-fadedMessage expandedBrowser-emptyMessage"},"No worklists found.")
const{columns:t,rowDataByItemId:n,iconsByItemId:a,rowContentHeightByItemId:i}=(0,p0.ZP)(e.worklists,e.sorts,{}),s=e.worklists.map((t=>({id:t.id,data:n[t.id],icon:a[t.id],isSelected:e.selectedWorklistIds.includes(t.id),extra:{worklist:t}})))
return d.createElement(Xj.Z,{canFilterColumns:!0,canResizeColumns:!0,rowSelectionMode:Tr.rT.MULTIPLE,className:"u-flex-grow",columns:(0,WY.Y3)(t),getRowContentHeight:t=>e.worklists?i[s[t].id]:Tr._5,isCompact:e.isCompact,matchParentHeight:!0,onChangeSort:function handleSetSort(t){const n=(0,WY.dt)(e.sorts,t)
e.setSort(n.key,n.reverse)},onRowClick:function handleRowClick(t){const n=t.extra.worklist
e.onOpenWorklist(n)},onRowsSelect:(t,n)=>{e.onToggleSelectedWorklistIds(t.map((e=>e.id)),n)},rows:s,tableKey:Tr.Uw.EXPANDED_WORKLIST_TABLE})}var g1=n(225512)
function WorklistsSidepanelList(e){return null==e.worklists?d.createElement(kl.b,null):0===e.worklists.length?d.createElement("div",{className:"sidepanel-fadedMessage"},"No worklists found."):d.createElement("div",null,e.worklists.map((t=>d.createElement(WorklistSidepanelRow,{onClick:()=>{e.onOpenWorklist(t)},key:t.id,worklist:t,isCompact:e.isCompact,isChild:!1}))))}const WorklistSidepanelRow=e=>{const t=(0,$I.n1)(e.worklist.modifiedAt,e.isCompact)
return d.createElement(g1.Z,{active:!1,className:"sidepanelItem--noIcon",faded:!1,icon:d.createElement(pe.Z,{icon:(0,ea.qz)(e.worklist.id)}),isCompact:e.isCompact,onClick:e.onClick,showStar:!1,starred:!1,subTitle:t,title:{text:e.worklist.name,node:d.createElement(WorklistSidepanelTitle,{worklist:e.worklist})},isExpandable:!1,isChild:e.isChild})}
function WorklistSidepanelTitle(e){return d.createElement("span",null,d.createElement("span",{className:"sidepanel-primaryLabel"},e.worklist.name),d.createElement("span",{className:"sidepanel-secondaryLabel"}," ",(0,Mt.kC)((0,Po.My)(e.worklist.itemType))))}function CreateWorklistWithCollaboratorsModal(e){const t={title:`Create new ${(0,Po.My)(e.worklistType)} worklist`,ownableType:st.WORKLIST,onRequestClose:e.onRequestClose,navigateOnSuccess:!1,doSubmit:function createWorklistWithCollaborators(t){var n,a
const i=null!==(n=t.collaborators)&&void 0!==n?n:(0,LN.AX)((null!==(a=t.collaborations)&&void 0!==a?a:[]).filter((e=>!e.fromOwnership))),s=(0,WW.fr)(i)
return(0,Ic.XP)((0,d1.YM)(t.name,e.worklistType,[],e.refreshOptions,s,(0,Vn.getStore)().dispatch.bind((0,Vn.getStore)())))},enableDescription:!1,requiresCreatorOwnership:!0,initialCollaborators:[]}
return dt.ZP.PERMISSIONS_ENABLE_NEW_COLLABORATION_UI?d.createElement(l0.R,{...t}):d.createElement(l0.Z,{...t})}var E1=n(270741)
function WorklistCreateButton(e){const[t,n]=(0,d.useState)(!1)
return d.createElement(I.ZP,{className:(0,g.iv)(f1.dropdown),isOpen:t,onToggle:e=>{n(e)},menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE,onMouseLeave:()=>{n(!1)},dropLeft:!0},(0,E1.$)({onSelectWorklistType:t=>{(0,Xn.Z)(CreateWorklistWithCollaboratorsModal,{refreshOptions:e.refreshOptions,worklistType:t})},getOptionText:e=>`Create ${(0,Po.My)(e)} worklist`}))},d.createElement(P.ZP,{title:"New worklist",placement:P.TQ.BOTTOM,container:"body",disabled:!1},d.createElement(C.Co,{onClick:()=>{n(!0)},buttonStyle:e.buttonStyle,size:C.qE.SMALL,icon:"compose",dataTestAttrs:{component:"WorklistCreateButton",element:"button"}})))}const f1=g.mM.create({dropdown:{marginTop:1}})
var S1=n(443240)
class WorklistsSidepanelConnector extends oi.C{enhanceProps(){if(!this.props.searchResults)return{worklists:null}
const e=this.props.searchResults.ids,t=this.getOrFetchMultipleRequired(lA.V.WORKLIST_SUMMARIES_BY_ID,e)
return{worklists:e.map((e=>t[e]))}}}const y1=(0,UP.ZP)(WorklistsSidepanelConnector.connect((function WorklistsSidepanel(e){var t
const n=d.createElement(Cw.bJ,{crumbs:[d.createElement(Cw.Ak,{key:"breadcrumbs-home",text:"Home",onClick:e=>{e.preventDefault()
w_.GS(ZP.$0.HOME)}}),d.createElement(Cw.wn,{key:"breadcrumbs-worklists",text:"Worklists"})]}),a=d.createElement(u0.ZP,{onSetSortOrder:e.onUpdateSortOrder,onSetPageSize:e.onUpdatePageSize,searchParams:e.searchParams,availableSortKeys:[Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_NAME_KEY],displaySettingsConfig:{isCompact:e.isCompactDisplay,setIsCompactDisplay:e.setIsCompactDisplay}}),i=d.createElement(S0.Z,{primaryFilterOptions:[{filterKey:Kn.Vm.WORKLIST_TYPE}],secondaryFilterGroups:[],filters:e.searchParams.filters,selectedSchema:null,onChangeFilters:e.onUpdateFilters}),s=d.createElement($Y.Z,{isExpanded:e.isExpanded,buttons:d.createElement("div",null,d.createElement(V0.Z,{className:"u-mini-spacing-right",expanded:e.isExpanded}),d.createElement(h1.Z,{className:"u-mini-spacing-right"}),d.createElement(WorklistCreateButton,{buttonStyle:C.ZJ.TERTIARY_BLUE,refreshOptions:{refreshWorklistItemsSearch:!1,refreshWorklistsSearch:!0,refreshRecentWorklists:!1}})),queryInput:d.createElement(m0.Z,{onUpdateQuery:e.onUpdateQueryString,query:e.searchParams.query}),settingsDropdown:a,filtersContainer:i,crumbs:n,showShadow:!0}),r={offset:e.searchParams.offset,limit:e.searchParams.limit,total:e.searchResults?e.searchResults.total:0,isExact:!e.searchResults||e.searchResults.isExact},o=(0,g0.B8)()
return e.isExpanded?d.createElement(ExpandedSidepanelSkeleton,{header:s,content:d.createElement(d.Fragment,null,d.createElement("div",{className:"u-lr-split"},d.createElement("div",{className:"u-flex-display"},d.createElement(zT.Z,{setOffset:e.onUpdateOffset,isLoading:!e.searchResults,pagination:r,subtext:null}),a),d.createElement(l1.Z,null,d.createElement(c1.Z,{numSelected:e.selectedIds.length}),d.createElement("div",{className:"buttonToolbar"},d.createElement("div",{className:"buttonGroup"},d.createElement(DeleteWorklistsButton,{selectedWorklists:e.worklists?e.worklists.filter((t=>e.selectedIds.includes(t.id))):[],refreshOptions:{refreshRecentWorklists:!0,refreshWorklistsSearch:!0}}),d.createElement($k.Z,{buttonStyle:C.ZJ.TERTIARY_WHITE,ids:null!==(t=e.selectedIds)&&void 0!==t?t:[]}))))),d.createElement("div",{className:"u-flex-grow u-flex-display u-justify-content-center u-small-spacing-top"},d.createElement(h0.ZP,{...o},d.createElement(ExpandedWorklistsTable,{worklists:e.worklists,isCompact:e.isCompactDisplay,selectedWorklistIds:e.selectedIds,onOpenWorklist:e.onOpenWorklist,onToggleSelectedWorklistIds:(t,n)=>{const a=n?[...e.selectedIds,...t]:e.selectedIds.filter((e=>!l.default.contains(t,e)))
e.onSelectIds(a)},setSort:(t,n)=>{e.onUpdateSortOrder([{key:t,reverse:n}])},sorts:e.searchParams.sorts})))),dataTestAttrs:{component:"WorklistSidepanel",element:"root",key:"expanded"}}):d.createElement(Db.W2,{className:"sidepanel",size:"sidepanel",dataTestAttrs:{component:"WorklistSidepanel",element:"root",key:"collapsed"}},d.createElement(Db.X2,null,s),d.createElement(Db.X2,{fluid:!0,className:"u-vertical-flex"},d.createElement("div",{className:"u-flex-grow u-position-relative"},d.createElement("div",{className:"u-absolute-scroll-container"},d.createElement(o1.Z,{pagination:r,setOffset:e.onUpdateOffset},d.createElement(h0.ZP,{...o},d.createElement(WorklistsSidepanelList,{onOpenWorklist:e.onOpenWorklist,worklists:e.worklists,isCompact:e.isCompactDisplay})))))))})),Kn.Sc.WORKLIST,ZP.$0.WORKLISTS,{defaultSearchParams:(0,S1.K)(),getNavigationUpdate:function getWorklistsURL(e,t){return t.isExpanded?{url:eJ.q7("/worklists",t.searchParams,t.filterErrors)}:null}})
var b1=n(140474),T1=n(663961),v1=n(553811)
class SidepanelHeader extends d.Component{constructor(){super(...arguments)
this._getBreadcrumbs=()=>{const e=this.props.crumbs,t=this.props.compact?1:e.length-1
return{sourceBreadcrumbs:d.createElement(Cw.ZP,{className:f()({"breadcrumbs--large":this.props.compact,"breadcrumbs--gray":!this.props.compact}),crumbs:e.slice(0,Math.max(1,t)),settingsIcon:e.length<=1?this.props.settingsIcon:null,showTrailingDivider:!this.props.compact}),listedBreadcrumbs:e.length>1&&d.createElement(Cw.ZP,{className:f()("u-tiny-spacing-top","u-flex-display",{"breadcrumbs--large":!this.props.compact}),crumbs:e.slice(t),settingsIcon:this.props.settingsIcon})}}}render(){const{sourceBreadcrumbs:e,listedBreadcrumbs:t}=this._getBreadcrumbs()
return d.createElement("div",{className:"u-width-full"},d.createElement("div",{className:"u-flex-display"},d.createElement("div",{className:"u-flex-grow u-vertical-center-items"},e),this.props.headerButtons),t)}}const C1=SidepanelHeader
var I1=n(462836),w1=n(295178),N1=n(733754)
class TFIIcon extends d.Component{render(){return d.createElement("img",{className:"tfi-addAccountRow-icon u-spacing-right",src:(()=>{switch(this.props.accountType){case N1.ZP.ACCOUNT_TYPE.BOX:return(0,me.Z)("/static/img/tfi/box.png")
case N1.ZP.ACCOUNT_TYPE.DROPBOX:return(0,me.Z)("/static/img/tfi/dropbox.png")
case N1.ZP.ACCOUNT_TYPE.EGNYTE:return(0,me.Z)("/static/img/tfi/egnyte.png")
case N1.ZP.ACCOUNT_TYPE.GDRIVE:return(0,me.Z)("/static/img/tfi/gdrive.png")
case N1.ZP.ACCOUNT_TYPE.ONEDRIVE:return(0,me.Z)("/static/img/tfi/onedrive.png")
default:return}})()})}}const A1=TFIIcon
var R1=n(629947)
class AddAccountRow extends d.Component{constructor(){super(...arguments)
this.state={eventNamespace:l.default.uniqueId("tfiOAuth-")}
this._connectAccount=()=>{const e=(()=>{switch(this.props.accountType){case N1.Qm.BOX:return"/ext/tfi/box-oauth/start"
case N1.Qm.DROPBOX:return"/ext/tfi/dropbox-oauth/start"
case N1.Qm.EGNYTE:return"/ext/tfi/egnyte-oauth/start"
case N1.Qm.GDRIVE:return"/ext/tfi/gdrive-oauth/start"
case N1.Qm.ONEDRIVE:return"/ext/tfi/onedrive-oauth/start"
default:return}})(),t=window.open(e,"_blank","height=500,width=600")
this.setState({oauthWindow:t})}}componentDidMount(){o()(window).on(`message.${this.state.eventNamespace}`,(e=>{const{tfiData:t}=e.originalEvent.data
if(void 0===t)return
if(null==this.state.oauthWindow||e.originalEvent.source!==this.state.oauthWindow){null!=e.originalEvent.source&&e.originalEvent.source.close()
return}const{account:n,message:a,severity:i}=t
if(null!=a)switch(i){case"SUCCESS":v.ZP.success(a)
w1.Z.addAccount(n)
m.j("tfi","added_account",{accountType:null==n?void 0:n.accountType})
break
case"WARN":v.ZP.warn(a)
break
case"ERROR":v.ZP.error(a)}this.state.oauthWindow.close()
this.props.onRequestClose()}))}componentWillUnmount(){o()(window).off(`message.${this.state.eventNamespace}`)}render(){return d.createElement("div",{className:"tfi-addAccountRow"},d.createElement(A1,{accountType:this.props.accountType}),d.createElement("div",{className:"tfi-addAccountRow-label"},d.createElement("div",null,R1.Z.readableAccountType(this.props.accountType)),d.createElement("div",{className:"tfi-addAccountRow-count"},(()=>{if(null!=this.props.connectedCount){return`${this.props.connectedCount>0?this.props.connectedCount:"No"} ${(0,de._6)(this.props.connectedCount,"account")} connected`}return null})())),d.createElement("div",{className:"pull-right"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,onClick:this._connectAccount,size:C.qE.SMALL,text:"Connect"})))}}AddAccountRow.propTypes={accountType:J().string.isRequired,connectedCount:J().number,onRequestClose:J().func.isRequired}
function TFIAddAccountModal(e){const t=(0,d.useRef)(null)
return d.createElement(et.ZP,{ref:t,title:"Add account",onRequestClose:e.onRequestClose,buttons:[{text:"Done",submit:!0,onClick:e.onRequestClose,style:C.ZJ.PRIMARY}]},(()=>{const t=[]
for(const n of Array.from(R1.Z.getAllowedAccountTypes())){let a
a=null!=e.tfiAccounts?l.default.where(e.tfiAccounts,{accountType:n}).length:null
t.push(d.createElement(AddAccountRow,{key:n,accountType:n,connectedCount:a,onRequestClose:e.onRequestClose}))}return t})())}TFIAddAccountModal.propTypes={tfiAccounts:J().array,onRequestClose:J().func.isRequired}
const P1=TFIAddAccountModal
class SearchButton_SearchButton extends d.Component{render(){return this.props.compact?d.createElement(P.ZP,{title:"Search",placement:P.TQ.BOTTOM},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_WHITE,icon:"search",onClick:this.props.onClick,size:C.qE.SMALL})):d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,icon:"search",onClick:this.props.onClick,size:C.qE.SMALL,text:"Search"})}}SearchButton_SearchButton.defaultProps={compact:!0}
const O1=SearchButton_SearchButton,x1={[N1.Qm.BOX]:"color--tfi-accountIcon-box",[N1.Qm.DROPBOX]:"color--tfi-accountIcon-dropbox",[N1.Qm.EGNYTE]:void 0,[N1.Qm.GDRIVE]:void 0,[N1.Qm.ONEDRIVE]:"color--tfi-accountIcon-onedrive",[N1.Qm.HOSTED_S3]:void 0}
function TFIAccountIcon_TFIAccountIcon({accountType:e}){const t=N1.J$[e],n=x1[e]
return d.createElement(Ab.TR,{className:n,name:t})}class TFIAccountItem extends d.Component{constructor(){super(...arguments)
this.handleOpen=()=>{w1.Z.listFolder(this.props.account.id,this.props.account.id)
m.j("tfi","listed_folder",{accountType:this.props.account.accountType})}}render(){return d.createElement(g1.Z,{icon:d.createElement(TFIAccountIcon_TFIAccountIcon,{accountType:this.props.account.accountType}),isCompact:!1,title:{text:R1.Z.readableAccountType(this.props.account.accountType)},subTitle:this.props.account.name,onClick:this.handleOpen,isExpandable:!1,isChild:this.props.isChild})}}function TFIAccountList(e){return d.createElement(Db.X2,{fluid:!0,className:"u-position-relative test"},e.accounts?0===e.accounts.length?d.createElement("div",{className:"sidepanel-fadedMessage"},"Add ",R1.Z.getAllowedAccountsString()," accounts."):d.createElement(Db.JX,{sm:6,className:"u-absolute-scroll-container"},e.accounts.map((e=>d.createElement(TFIAccountItem,{key:e.id,account:e,isChild:!1})))):d.createElement("div",{className:"u-absolute-scroll-container"},d.createElement(kl.b,null)))}const{TFI_MIME_TYPE:_1}=A_.Z
class TFIDragTarget extends d.Component{constructor(){super(...arguments)
this.dragStartHandler=e=>{const t=(0,A_.Z)(e)
e.dataTransfer.effectAllowed="all"
e.dataTransfer.dropEffect="move"
const n={id:this.props.tfiObject.id,accountId:this.props.tfiObject.accountId,name:this.props.tfiObject.name,accountType:this.props.tfiObject.accountType}
t.setData(_1,n)}}render(){return d.createElement("div",{...l.default.extend({},l.default.omit(this.props,"tfiObject"),{draggable:!0,onDragStart:this.dragStartHandler})},this.props.children)}}const D1=TFIDragTarget
var L1=n(786328),k1=n(422665)
const M1="TFIPreviewModal"
class TFIPreviewModal extends d.Component{constructor(){super(...arguments)
this.state={loading:!0}
this.addOverlay=()=>{const e=o()("<div>").addClass("overlay")
o()("body").append(e)
return e}
this.getPreview=()=>{L1.Z.previewFile(this.props.tfiFile.accountId,this.props.tfiFile.id).done((e=>{this.setState({loading:null!=e.url,previewUrl:e.url,mimetype:e.mimetype})}))}
this.renderModalHeader=()=>d.createElement("div",{className:"tfi-modalHeader"},d.createElement("span",{className:"tfi-modalClose",onClick:this.props.onRequestClose},"×"),d.createElement(I1.Z,{className:"tfi-accountIcon",accountType:this.props.tfiFile.accountType}),d.createElement("div",{className:"tfi-modalTitle"},d.createElement("h4",null,this.props.tfiFile.name),d.createElement("span",null,`Last modified ${(0,Kl.Z)(this.props.tfiFile.modifiedAt)}`),d.createElement("div",null,"To import this file, drag from the sidebar into an entry.")))}static open({tfiFile:e}){return Xe.bA(M1,d.createElement(TFIPreviewModal,{onRequestClose:function(){Xe.xv(M1)},tfiFile:e}))}componentDidMount(){const e=this.addOverlay()
this.setState({$overlay:e})
this.getPreview()}componentWillUnmount(){return null!=this.state.$overlay?this.state.$overlay.remove():void 0}render(){return d.createElement("div",{className:"tfi-modalContainer"},d.createElement(et.ZP,{enableRedesign:!1,modalBodyBgColor:et.bl.TRANSPARENT,onRequestClose:this.props.onRequestClose,large:!0,suppressHeader:!0,wrapInForm:!1},this.renderModalHeader(),this.state.loading?d.createElement("div",{className:"text-center tfi-modalSpinner"},d.createElement(k1.Z,null)):void 0,(()=>null!=this.state.previewUrl?null!=this.state.mimetype&&-1!==this.state.mimetype.indexOf("image/")?d.createElement("img",{className:"tfi-modalImage",src:this.state.previewUrl,onLoad:()=>{this.setState({loading:!1})}}):d.createElement("iframe",{sandbox:"allow-scripts",src:this.state.previewUrl,width:"100%",height:700,style:this.state.loading?void 0:{backgroundColor:"white"},onLoad:()=>{this.setState({loading:!1})}}):this.state.loading?null:d.createElement("div",{className:"tfi-modalNoPreview"},d.createElement(pe.Z,{className:"tfi-modalNoPreviewIcon",icon:"file"}),d.createElement("div",null,`${(0,Mt.td)(this.props.tfiFile.fileSize)} • Last modified ${(0,Kl.Z)(this.props.tfiFile.modifiedAt)}`)))()))}}const F1=TFIPreviewModal
class TFIObjectItem extends d.Component{constructor(){super(...arguments)
this.openTFIFolder=()=>{m.j("tfi","listed_folder",{accountType:this.props.tfiObject.accountType})
w1.Z.listFolder(this.props.tfiObject.accountId,this.props.tfiObject.id)}
this.openTFIFile=()=>{m.j("tfi","previewed_file",{accountType:this.props.tfiObject.accountType})
F1.open({tfiFile:this.props.tfiObject})}}renderSidepanelItem(){return d.createElement(g1.Z,{icon:d.createElement(pe.Z,{icon:this.props.tfiObject.isFolder?"folder":"file"}),isCompact:!1,title:{text:this.props.tfiObject.name},subTitle:R1.Z.isTFIFile(this.props.tfiObject)&&this.props.tfiObject.modifiedAt?(0,Kl.Z)(this.props.tfiObject.modifiedAt,{days:7,showTime:!1,compact:!0}):null,onClick:this.props.tfiObject.isFolder?this.openTFIFolder:this.openTFIFile,isExpandable:!1,isChild:this.props.isChild})}render(){return this.props.tfiObject.isFolder?this.renderSidepanelItem():d.createElement(D1,{tfiObject:this.props.tfiObject},this.renderSidepanelItem())}}class TFIObjectList extends d.Component{render(){return d.createElement(Db.X2,{fluid:!0,className:"u-position-relative"},(()=>this.props.tfiObjects?0===this.props.tfiObjects.length?d.createElement("div",{className:"sidepanel-fadedMessage"},"No files found."):d.createElement(Db.JX,{sm:6,className:"u-absolute-scroll-container"},this.props.tfiObjects.map((e=>d.createElement(TFIObjectItem,{key:e.id,tfiObject:e,isChild:!1})))):d.createElement("div",{className:"sidepanel-fadedMessage"},"Loading..."))())}}const Z1=TFIObjectList
class TFISearchInput extends d.Component{constructor(){super(...arguments)
this.plainSearchInputRef=d.createRef()
this.componetDidUpdate=()=>{this.handleSearchInputPendingFocus()}
this.handleSearch=e=>{w1.Z.setTFIAccountFilter(this.props.listedFolder?this.props.listedFolder.accountId:null)
w1.Z.setQuery(e.target.value)}
this.handleClearSearch=()=>{w1.Z.clearSearch()}
this.handleSearchInputPendingFocus=()=>{if(this.props.searchInputPendingFocus){this.plainSearchInputRef.current.focus()
this.props.onSearchInputReceivedFocus()}}}componentDidMount(){this.handleSearchInputPendingFocus()}render(){let e
e=this.props.listedFolder?[this.props.listedFolder.accountType]:this.props.accounts?this.props.accounts.map((e=>e.accountType)):[]
const t=e.length?(0,Mt.Dw)(l.default.uniq(e).map((e=>R1.Z.readableAccountType(e)))):"external files"
return d.createElement("div",{className:"tfi-searchInput"},d.createElement(nc.ZP,{className:"u-width-full",clearType:nc.Nl.CANCEL,value:this.props.query,onChange:this.handleSearch,onEscape:this.handleClearSearch,placeholder:`Search ${t}`,ref:this.plainSearchInputRef}))}}class TFISettingsIcon extends d.Component{constructor(){super(...arguments)
this.state={isDropdownOpen:!1}
this.handleOpenDropdown=()=>{this.setState({isDropdownOpen:!0})}
this.handleCloseDropdown=()=>{this.setState({isDropdownOpen:!1})}
this.deleteAccount=e=>{je.iG("Unlink Account",d.createElement("div",null,d.createElement("p",null,"Are you sure you want to unlink your",` ${R1.Z.readableAccountType(e.accountType)} `,"account ",d.createElement("strong",null,e.name),"?"),d.createElement("p",null,"All files you've imported from the account into Benchling projects will remain there, but you'll lose the ability to resync them.")),"success",{acceptText:"Yes, unlink",rejectText:"No, never mind"}).done(w1.Z.deleteAccount.bind(null,e.id))}}render(){if(!this.props.accounts||0===this.props.accounts.length)return null
const e=this.props.accounts.map((e=>({name:`Unlink ${R1.Z.readableAccountType(e.accountType)}`,handleOnClick:this.deleteAccount.bind(null,e)})))
return d.createElement(Hy.ZP,{onRequestClose:this.handleCloseDropdown,open:this.state.isDropdownOpen,menu:d.createElement(LR.Z,{items:[e]}),shouldCloseOnInsideClick:!0},d.createElement(yh.Z,{className:"u-small-spacing-left",onClick:this.handleOpenDropdown}))}}const B1=TFISettingsIcon
class TFISidepanel extends d.Component{constructor(){super(...arguments)
this.state={searchInputPendingFocus:!1}
this.handleTFIAddModalOpen=()=>{w1.Z.toggleTFIAddModal(!0)}
this.handleTFIAddModalClose=()=>{w1.Z.toggleTFIAddModal(!1)}
this.handleGoToRoot=()=>{w1.Z.listAccounts()}
this.handleTriggerTFISearch=()=>{w1.Z.setQuery("")
this.setState({searchInputPendingFocus:!0})}
this.handleSearchInputReceivedFocus=()=>{this.setState({searchInputPendingFocus:!1})}
this.handleOpenResult=e=>{w1.Z.listFolder(e.accountId,e.id)}
this.renderTFIIcon=e=>e?e.parent?d.createElement(pe.Z,{icon:"folder"}):d.createElement(I1.Z,{accountType:e.accountType}):d.createElement(pe.Z,{icon:"external-files"})
this.getCrumbs=()=>(0,Cw.Kf)({listed:TFISidepanel.getListed(this.props.listedFolder),openResult:this.handleOpenResult,onGoToRoot:this.handleGoToRoot,rootText:dt.ZP.ENABLE_BENCHLING_APPS?"Connections":"External Files",renderIcon:this.renderTFIIcon})
this.renderTFIObjects=()=>this.props.search.isActive?d.createElement(Z1,{tfiObjects:this.props.search.tfiData.isSearching?null:this.props.search.tfiData.results}):this.props.listedFolder?[d.createElement(Db.X2,{key:"sidepanel-header-row"},d.createElement(Db.JX,{sm:6},d.createElement("div",{className:"sidepanel-header"},d.createElement(C1,{crumbs:this.getCrumbs(),headerButtons:d.createElement(O1,{onClick:this.handleTriggerTFISearch}),compact:!0,rootText:dt.ZP.ENABLE_BENCHLING_APPS?"Connections":"External Files",onGoToRoot:this.handleGoToRoot})))),d.createElement("div",{key:"tab-container"},this.props.connectionsTab),d.createElement(Z1,{key:"folder-listing",tfiObjects:this.props.listedFolder.children})]:[d.createElement(Db.X2,{className:"u-position-relative",key:"sidepanel-header-row"},d.createElement(Db.JX,{sm:6},d.createElement("div",{className:"sidepanel-header"},d.createElement(C1,{crumbs:this.getCrumbs(),compact:!0,headerButtons:d.createElement("div",{className:"sidepanel-header-buttons u-vertical-center-items"},d.createElement(O1,{onClick:this.handleTriggerTFISearch}),d.createElement(P.ZP,{title:"Add Account",placement:P.TQ.BOTTOM,container:"body"},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,icon:"compose",onClick:this.handleTFIAddModalOpen,size:C.qE.SMALL}))),settingsIcon:d.createElement(B1,{accounts:this.props.accounts}),rootText:dt.ZP.ENABLE_BENCHLING_APPS?"Connections":"External Files",onGoToRoot:this.handleGoToRoot})))),d.createElement("div",{key:"tab-container"},this.props.connectionsTab),d.createElement(TFIAccountList,{key:"account-list",accounts:this.props.accounts}),d.createElement(M_.Z,{key:"add-account-modal-anchor",open:this.props.showTFIAddModal},d.createElement(P1,{tfiAccounts:this.props.accounts,onRequestClose:this.handleTFIAddModalClose}))]}static getListed(e){const t={}
let n=t,a=e
if(!a)return null
for(;a;){(0,S.hu)(a.isFolder,"TFI file cannot be a parent of TFI folder")
Object.assign(n,a,{api_identifier:a.id},a.parent?{name:a.name,parent:{}}:{name:R1.Z.readableAccountType(a.accountType),parent:null})
n=n.parent
a=a.parent}return t}componentDidMount(){w1.Z.fetchAccounts()}render(){return d.createElement(Db.W2,{className:"sidepanel",size:"sidepanel",dataTestAttrs:{component:"TFISidepanel",element:"root",key:"collapsed"}},d.createElement(Db.X2,null,d.createElement(Db.JX,{sm:6,className:"sidepanel-search"},this.props.search.isActive&&d.createElement(TFISearchInput,{accounts:this.props.accounts,listedFolder:this.props.listedFolder,onSearchInputReceivedFocus:this.handleSearchInputReceivedFocus,query:this.props.search.query,searchInputPendingFocus:this.state.searchInputPendingFocus}))),this.renderTFIObjects())}}const q1=TFISidepanel
function ConnectionsSidepanel(e){const t=[];(0,ln.Oj)({feature:on.d$.LAB_AUTOMATION_DISCOVER})&&t.push({handleClick:()=>{w_.GS(ZP.$0.CONNECTIONS)},isActive:e.activeSection===ZP.$0.CONNECTIONS,text:"Connections"})
t.push({handleClick:()=>{w_.GS(ZP.$0.TFI)},isActive:e.activeSection===ZP.$0.TFI,text:"External Files"})
dt.ZP.ENABLE_BENCHLING_APPS&&t.push({handleClick:()=>{w_.GS(ZP.$0.BENCHLING_APPS)},isActive:e.activeSection===ZP.$0.BENCHLING_APPS,text:"Apps"})
const n=t.length>1?d.createElement(KW.Z,{className:(0,g.iv)(V1.sectionTabs),tabs:t}):d.createElement(d.Fragment,null)
switch(e.activeSection){case ZP.$0.BENCHLING_APPS:return d.createElement(T1.ZP,{isCompactDisplay:e.isCompactDisplay,setIsCompactDisplay:e.setIsCompactDisplay,isExpanded:e.isExpanded,activeItemId:e.activeItemId,connectionsTab:n})
case ZP.$0.CONNECTIONS:return d.createElement(v1.ZP,{isCompactDisplay:e.isCompactDisplay,setIsCompactDisplay:e.setIsCompactDisplay,isExpanded:e.isExpanded,activeItemId:e.activeItemId,connectionsTab:n})
default:return d.createElement(q1,{...e.tfi,connectionsTab:n})}}const V1=g.mM.create({sectionTabs:{borderBottomColor:Vt.pF,borderBottomWidth:1,borderBottomStyle:"solid",margin:"0 -12px"}})
class CalendarFilterConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP]}enhanceProps(){return{hiddenProjectIds:this.calendarStore().getHiddenProjectIds(),projects:this.calendarStore().getAllProjects()}}}class CalendarFilter extends d.Component{constructor(){super(...arguments)
this._handleToggleProject=e=>{vH.Z.toggleProjectHidden(e)}}render(){const e=l.default.sortBy(this.props.projects,(e=>e.name.toLowerCase())),t=e.filter((e=>!this.props.hiddenProjectIds.includes(e.id)))
if(0===e.length)return d.createElement("div",null,"No activity was found in this date range.")
const n=IH.ZP.getProjectColorMapping(this.props.projects)
return d.createElement("div",{className:"calendarFilter u-small-spacing-top"},e.map(((e,t)=>{if(-1!==this.props.hiddenProjectIds.indexOf(e.id))return null
const a={title:e.name,placement:P.TQ.BOTTOM,trigger:"hover",container:"body"}
return d.createElement(P.ZP,{...a,key:t},d.createElement("div",{className:(0,g.iv)(U1.swatch),style:{backgroundColor:n[e.id]},...(0,ee.Z)({component:"CalendarFilter",element:"swatch"})}))})),d.createElement(I.ZP,{closeOnInsideClick:!1,menu:d.createElement(w.ZP,{value:t,height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},e.map(((e,t)=>{const a=n[e.id]
return d.createElement(N.Z,{key:t,value:e.id,onSelect:this._handleToggleProject},d.createElement("div",{className:(0,g.iv)(U1.swatch),style:{backgroundColor:-1!==this.props.hiddenProjectIds.indexOf(e.id)?void 0:a,border:`solid 1px ${a}`}}),e.name)})))},d.createElement("span",{className:(0,g.iv)(U1.button)},"Filter ",d.createElement(pe.Z,{icon:"chevron-down"}))))}}const U1=g.mM.create({button:{color:Vt.t0,cursor:"pointer",":hover":{color:Vt.Ej}},swatch:{borderRadius:"50%",display:"inline-block",height:"12px",marginRight:"4px",width:"12px"}}),G1=CalendarFilterConnector.connect(CalendarFilter)
class EntryCalendarConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP]}enhanceProps(){return{currentView:this.calendarStore().getCurrentView(),interact:this.calendarStore().getInteract(),isLoadingData:this.calendarStore().isLoadingData(),today:this.calendarStore().getToday(),viewLabel:this.calendarStore().getViewLabel(),viewRange:this.calendarStore().getViewRange(),visibleDate:this.calendarStore().getVisibleDate(),projects:this.calendarStore().getProjects(),layeredItems:this.calendarStore().getLayeredItems(),entries:this.calendarStore().getEntries(),files:this.calendarStore().getNonEntryFiles(),requests:this.calendarStore().getRequests(),processTasks:this.calendarStore().getProcessTasks()}}}class EntryCalendar extends d.Component{componentDidMount(){calendarDidMount(this.props.viewRange,this.props.currentView)}componentDidUpdate(e){calendarDidUpdate(e.viewRange,this.props.viewRange,e.currentView,this.props.currentView)}render(){return d.createElement("div",{className:"u-small-spacing-top u-spacing-left",...(0,ee.Z)({component:"EntryCalendar",element:"root"})},d.createElement(RH,{currentView:this.props.currentView,isLoadingData:this.props.isLoadingData,today:this.props.today,viewLabel:this.props.viewLabel,viewRange:this.props.viewRange,visibleDate:this.props.visibleDate}),d.createElement("div",{className:"u-spacing-bottom"},d.createElement(G1,null)),d.createElement(Db.X2,null,d.createElement(Db.JX,{md:16},d.createElement(QH,{currentView:this.props.currentView,entries:this.props.entries,requests:this.props.requests,files:this.props.files,processTasks:this.props.processTasks,interact:this.props.interact,isLoadingData:this.props.isLoadingData,layeredItems:this.props.layeredItems,projects:this.props.projects,showWeeklyFileActivity:!0,today:this.props.today,viewRange:this.props.viewRange,visibleDate:this.props.visibleDate}))))}}const z1=EntryCalendarConnector.connect(EntryCalendar)
function ChecklistPanelLink(e){var t
return d.createElement("div",{className:f()((0,g.iv)($1.checklistPanelLink),(0,g.iv)($1.newFont)),onClick:e.onClick},e.displayText,d.createElement(pe.Z,{icon:null!==(t=e.icon)&&void 0!==t?t:"open",className:f()("pull-right",(0,g.iv)($1.icon))}))}const $1=g.mM.create({checklistPanelLink:{backgroundColor:Vt.t0,borderRadius:"4px",cursor:"pointer",lineHeight:"24px",padding:"12px",marginTop:"12px"},font:{fontSize:"15px",fontWeight:600},newFont:{fontSize:"16px"},icon:{marginTop:"4px"}})
class GettingStartedPanel extends d.Component{constructor(){super(...arguments)
this.state={isOpen:!0}
this._handleToggleOpen=()=>{const e=!this.state.isOpen
this.setState({isOpen:e})
const t=e?"expanded":"minimized"
m.j("onboarding_checklist",t,{checklist:"sidepanel",checklistTitle:"Getting Started",checklistReward:"1GB_earned",numberOfTasks:5,eventLastModified:"FY21_Q1a2"})}}render(){const{tasks:e,completed:t,hasSpace:n}=this.props
return d.createElement("div",{style:{position:"relative",marginTop:"12px"}},d.createElement(Tz.Z,{title:"Get started with Benchling",module:Qs.ZP.MODULES.GETTING_STARTED,listItems:(0,Cz.GN)(e,t,!n),collapsed:!this.state.isOpen,onChangeCollapsed:this._handleToggleOpen,collapsedNode:d.createElement(ChecklistPanelLink,{displayText:"Get started with Benchling",icon:"chevron-right",onClick:this._handleToggleOpen}),completed:t,fixedSize:!1,openIndex:null}))}}const W1=GettingStartedPanel
var H1=n(883777)
function RecentWorklistsHomeListing(){const{queryResultType:e,recentWorklists:t}=(0,H1.ZP)()
if(e===Da.NI.ERROR)return null
const n=[]
if(e===Da.NI.PENDING)n.push(d.createElement(Db.X2,{key:"loading-worklists"},d.createElement("div",{className:"homeSidepanel-today-item"},"Loading worklists...")))
else if(0===t.length)n.push(d.createElement(Db.X2,{key:"no-worklists"},d.createElement("div",{...(0,ee.Z)({component:"RecentWorklistRow",element:"noRecentWorklist"}),className:"homeSidepanel-today-item"},"You have no recent worklists.")))
else{for(const[e,a]of t.entries())n.push(d.createElement(RecentWorklistRow,{key:e,worklist:a}))
n.push(d.createElement("a",{key:n.length,href:"",className:"whiteLink",onClick:e=>{e.preventDefault()
w_.GS(ZP.$0.WORKLISTS)},...(0,ee.Z)({component:"RecentWorklistRow",element:"seeMore"})},"See more..."))}return d.createElement(RecentWorklistsContainer,{worklistRows:n})}function RecentWorklistsContainer(e){return d.createElement(Db.W2,{size:"sidepanel",className:"homeSidepanel-today-itemSummary"},d.createElement(Db.X2,{className:"homeSidepanel-today-sectionHeader u-pointer"},d.createElement("div",{className:"homeSidepanel-today-sectionHeader-content",onClick:()=>{w_.GS(ZP.$0.WORKLISTS)},...(0,ee.Z)({component:"RecentWorklistsTitleContainer",element:"worklistTitle"})},"Recent worklists"),d.createElement(WorklistCreateButton,{buttonStyle:C.ZJ.TERTIARY_WHITE_TRANSPARENT})),d.createElement("div",{...(0,ee.Z)({component:"RecentWorklistsContainer",element:"worklistRows"})},e.worklistRows))}function RecentWorklistRow(e){const t=(0,$I.n1)(e.worklist.modifiedAt,!0)
return d.createElement(Db.X2,{className:"homeSidepanel-today-item"},d.createElement("div",{className:"homeSidepanel-today-item-icon"},d.createElement(pe.Z,{icon:st.WORKLIST})),d.createElement("div",{className:"homeSidepanel-today-item-title whiteLink",onClick:t=>{(0,b1.vS)((0,zo.tY)("WorklistSummary",e.worklist))},...(0,ee.Z)({component:"RecentWorklistRow",element:"worklistTitle"})},e.worklist.name),d.createElement("div",{className:"homeSidepanel-today-item-subtitle u-small-spacing-left"},t))}var j1=n(659133)
const Y1=dt.ZP.WORKLISTS_ENABLE_WORKLISTS?10:20
class FileSummary extends d.Component{constructor(){super(...arguments)
this._openFile=e=>{Rn.Z.openFile(e.id)}}render(){const e=l.default.sortBy(this.props.files,(e=>Zd()(e.endAccess))).reverse().slice(0,Y1)
return d.createElement(Db.W2,{size:"sidepanel",className:"homeSidepanel-today-itemSummary"},d.createElement(Db.X2,{className:"homeSidepanel-today-sectionHeader u-pointer"},d.createElement("div",{className:"homeSidepanel-today-sectionHeader-content"},this.props.headerText)),(()=>0===this.props.files.length?d.createElement(Db.X2,{className:"homeSidepanel-today-item"},d.createElement("div",{...(0,ee.Z)({component:"FileSummary",element:"noRecentEntityRow"})},this.props.emptyText)):e.map(((e,t)=>{let n
n=e.endAccess?(0,Kl.Z)(e.endAccess,{showYear:!1,showWeekday:!0,compact:!0}):null
return d.createElement(Db.X2,{className:f()("homeSidepanel-today-item",{"homeSidepanel-today-item--active":e.id===this.props.activeItemId}),key:t},d.createElement("div",{className:"homeSidepanel-today-item-content u-pointer u-flex-display",onClick:()=>{this._openFile(e)}},d.createElement("div",{className:"homeSidepanel-today-item-icon"},d.createElement(pe.Z,{icon:j1.Z.getFileIconName(e)})),d.createElement("div",{className:"homeSidepanel-today-item-title whiteLink"},e.name),d.createElement("div",{className:"homeSidepanel-today-item-subtitle u-small-spacing-left"},n)))})))())}}const Q1=FileSummary
var K1=n(54503),J1=n(392113)
const ReviewSummaryItem=({icon:e,iconClassName:t,count:n,text:a,reviewStatus:i,onClick:s})=>d.createElement("div",{className:"homeSidepanel-today-review-item",onClick:s},d.createElement(pe.Z,{className:`homeSidepanel-today-review-icon ${t}`,icon:e}),d.createElement("span",{className:"whiteLink",...(0,ee.Z)({component:"ReviewSummaryItem",element:"root",key:i})},`${n} ${a}`))
class ReviewSummary extends d.Component{constructor(){super(...arguments)
this._setReviewFilter=(e,t)=>{(0,Vn.getStore)().dispatch(J1.openListing(ZP.$0.SEARCH,RN.WN((0,K1.v)(),[{...(0,Kn.QW)(Kn.Vm.TYPES),value:[st.ENTRY,st.STAGE_ENTRY].filter((e=>(0,DG.Z)(e)))},{...(0,Kn.QW)(Kn.Vm.REVIEW),value:{review_status:e,role:t}}])))
w_.jn()}
this._handleFilterNeedsRevisionEntries=()=>{this._setReviewFilter(KL.ZP.REJECTED,KL.ZP.ROLE_FILTERS.AUTHOR_OR_AUDITOR)}
this._handleFilterNeedsReviewEntries=()=>{this._setReviewFilter(KL.ZP.NEEDS_REVIEW,KL.ZP.ROLE_FILTERS.AUDITOR)}
this._handleFilterSentForReviewEntries=()=>{this._setReviewFilter(KL.ZP.NEEDS_REVIEW,KL.ZP.ROLE_FILTERS.AUTHOR)}
this._handleFilterAcceptedEntries=()=>{this._setReviewFilter(KL.ZP.ACCEPTED,KL.ZP.ROLE_FILTERS.AUTHOR_OR_AUDITOR)}
this._handleFilterInProgressEntries=()=>{this._setReviewFilter(KL.ZP.IN_PROGRESS_FILTER,KL.ZP.ROLE_FILTERS.AUTHOR_OR_AUDITOR)}}render(){const e=this.props.reviewSummary.rejected,t=this.props.reviewSummary.needsReview,n=this.props.reviewSummary.sentForReview,a=this.props.reviewSummary.accepted,i=this.props.reviewSummary.inProgress+this.props.reviewSummary.retracted
return d.createElement("div",{className:"homeSidepanel-today-review"},d.createElement("div",{className:"u-flex-display u-small-spacing-bottom"},d.createElement(ReviewSummaryItem,{count:i,icon:KL.kN,iconClassName:"homeSidepanel-today-review-icon--inProgress",onClick:this._handleFilterInProgressEntries,text:"in progress",reviewStatus:KL.ZP.IN_PROGRESS_FILTER}),d.createElement(ReviewSummaryItem,{count:e,icon:Sn.CT.REJECTED,iconClassName:"homeSidepanel-today-review-icon--rejected",onClick:this._handleFilterNeedsRevisionEntries,text:1===e?"needs revision":"need revision",reviewStatus:KL.ZP.REJECTED})),d.createElement("div",{className:"u-flex-display u-small-spacing-bottom"},d.createElement(ReviewSummaryItem,{count:t,icon:Sn.CT.NEEDS_REVIEW,iconClassName:"homeSidepanel-today-review-icon--review",onClick:this._handleFilterNeedsReviewEntries,text:"to review",reviewStatus:KL.ZP.NEEDS_REVIEW}),d.createElement(ReviewSummaryItem,{count:n,icon:KL.P5,onClick:this._handleFilterSentForReviewEntries,text:"sent for review",reviewStatus:KL.ZP.SENT_FOR_REVIEW})),d.createElement("div",{className:"u-flex-display"},d.createElement(ReviewSummaryItem,{count:a,icon:Sn.CT.ACCEPTED,iconClassName:"homeSidepanel-today-review-icon--accepted",onClick:this._handleFilterAcceptedEntries,text:dt.ZP.ENABLE_ENTRY_REVIEW_PROCESSES?"completed":"accepted",reviewStatus:KL.ZP.ACCEPTED})))}}const X1=ReviewSummary
function NotificationBanner({children:e,onCloseBanner:t,imageURL:n,title:a}){return d.createElement("div",{className:"u-flex-display homeSidepanel-notifications"},d.createElement("img",{className:"homeSidepanel-notification-icon",src:n}),d.createElement("div",{className:"homeSidepanel-notification-text"},d.createElement("a",{className:"homeSidepanel-notification-close close pull-right",onClick:t},d.createElement(pe.Z,{icon:"close"})),d.createElement("div",{className:"u-small-spacing-bottom"},a),e))}NotificationBanner.propTypes={children:J().node.isRequired,onCloseBanner:J().func.isRequired,imageURL:J().string.isRequired,title:J().node.isRequired}
function AcademicReferralBanner(e){return d.createElement(NotificationBanner,{onCloseBanner:e.onCloseBanner,imageURL:(0,me.Z)("/static/img/benchling_gold_image.png"),title:d.createElement("b",null,"Get Benchling Gold")},d.createElement("a",{href:"/invite",rel:"noopener noreferrer",target:"_blank"},"Invite your colleagues")," ","to Benchling! When five of your referrals sign up, you'll receive extra space and exclusive access to an enterprise feature, Benchling Sync.")}AcademicReferralBanner.propTypes={onCloseBanner:J().func.isRequired}
function UpgradeAccountBanner({onCloseBanner:e}){return d.createElement(NotificationBanner,{onCloseBanner:e,imageURL:(0,me.Z)("/static/img/upgrade_account.png"),title:"Want to get more out of Benchling?"},d.createElement("div",null,d.createElement("a",{onClick:()=>TK.Z.open()},"Upgrade your Benchling account")),"to get enterprise-grade security, witness & review, workflow management, sample tracking, and more.")}UpgradeAccountBanner.propTypes={onCloseBanner:J().func.isRequired}
const e2={ACADEMIC_REFERRAL:"ACADEMIC_REFERRAL",UPGRADE_ACCOUNT:"UPGRADE_ACCOUNT"},t2={[e2.ACADEMIC_REFERRAL]:{isEnabled:e=>dt.ZP.ENABLE_USER_SIGNUPS&&dt.ZP.ENABLE_GLOBAL_INVITE_SCIENTISTS&&e.status!==XN.ZP.STATUS_GOLD&&!yz.U(e)&&!XA.Z.hasEnterprisePlan()&&Zd()().diff(Zd()(e.joinedOn),"days")>=7,preferenceKey:"bannerLastDismissed.referrals",bannerClass:AcademicReferralBanner},[e2.UPGRADE_ACCOUNT]:{isEnabled:e=>TK.Z.isEnabled(e),preferenceKey:"bannerLastDismissed.upgradeAccount",bannerClass:UpgradeAccountBanner}}
class SidepanelNotificationsSection extends d.Component{constructor(e){super(e)
this._handleCloseBanner=e=>{We.Z.set(t2[e].preferenceKey,(new Date).toISOString())
this.setState({displayedBannerKey:null})}
let t=null
const n={}
for(const e of Object.values(e2)){const t=We.Z.get(t2[e].preferenceKey),a=t?Zd()(t):null
n[e]=a}Object.values(n).some((e=>e&&e.isAfter(Zd()().subtract(1,"weeks"))))||(t=l.default.find(Object.keys(n),(t=>{const a=n[t]
return t2[t].isEnabled(e.currentUser)&&(!a||a.isBefore(Zd()().subtract(4,"weeks")))})))
this.state={displayedBannerKey:t}}render(){if(!this.props.currentUser)return null
if(Jn.Z.currentUserHasPendingInvites())return d.createElement(tW,{className:"homeSidepanel-notifications"})
if(this.state.displayedBannerKey){const e=t2[this.state.displayedBannerKey].bannerClass
return d.createElement(e,{onCloseBanner:()=>{this._handleCloseBanner(this.state.displayedBannerKey)}})}return null}}const n2=SidepanelNotificationsSection
class HomeSidepanelSignedOut extends d.Component{constructor(){super(...arguments)
this.state={email:""}
this._handleEmailChange=e=>{this.setState({email:e.target.value})}
this._handleSubmit=e=>{"Enter"===e.key&&this._handleClickSignup()}
this._handleClickSignup=()=>{m.j("benchling","initiated_signup",{email:this.state.email,signup_source:"signed out view"})
window.location.href=`/signup?email=${this.state.email}`}
this._handleClickLogin=()=>{window.location.href=`/signin?username=${this.state.email}`}}render(){return d.createElement(Db.X2,{className:"homeSidepanel-signedOut"},d.createElement(Db.JX,{sm:6},d.createElement("h1",null,"Welcome to Benchling"),d.createElement("p",{className:"homeSidepanel-signedOut-description"},"Benchling is an intelligent research platform with tools for note-taking, molecular biology, and sample tracking."),d.createElement("h3",null,"Create an account"),d.createElement("div",{className:"homeSidepanel-signedOut-signupForm"},d.createElement("div",null,"Email"),d.createElement("input",{value:this.state.email,onChange:this._handleEmailChange,onKeyUp:this._handleSubmit})),d.createElement("div",{className:"u-lr-split"},d.createElement("div",null,d.createElement("div",{className:"homeSidepanel-signedOut-loginDesc"},"Already have an account?"),d.createElement("div",null,d.createElement("a",{className:"homeSidepanel-signedOut-login",onClick:this._handleClickLogin},"Sign in"))),d.createElement("div",null,d.createElement("button",{className:"button button--medium button--primary",onClick:this._handleClickSignup,type:"button"},"Sign up")))))}}const a2=HomeSidepanelSignedOut
class HomeSidepanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[NH.ZP,Jn.Z,bz.Z]}enhanceProps(){var e,t
const n=this.calendarStore().getToday(),a=this.calendarStore().getFiles()[n.format("YYYY-MM-DD")]||[],i=bz.Z.getNUEModuleState(Qs.ZP.MODULES.ENTRY),s=bz.Z.getNUEModuleState(Qs.ZP.MODULES.SEQUENCE)
return{files:a,todayDate:n,currentUser:this.entityStore().currentUser(),gettingStarted:this.homeDashboardStore().getNUEModuleState(Qs.ZP.MODULES.GETTING_STARTED),hasIncompleteEntryChecklist:null!==(e=i&&!i.completed)&&void 0!==e&&e,hasIncompleteSequenceChecklist:null!==(t=s&&!s.completed)&&void 0!==t&&t,hasGettingStartedSpace:this.homeDashboardStore().getHasGettingStartedSpace(),reviewSummary:this.homeDashboardStore().getReviewSummary()}}}class HomeSidepanel extends d.Component{constructor(){super(...arguments)
this._handleExpand=()=>{w_.jn()}}componentDidMount(){this.props.currentUser&&l.default.defer((()=>{XA.Z.hasLicense("LICENSE_REVIEWS")&&nW.Z.fetchReviewSummary()
J$.zc()
const e=NH.ZP.getToday(),t=e.clone().add(2,"days")
vH.Z.fetchFiles(e,t);(dt.ZP.ENABLE_NUE_MODULES||dt.ZP.ENABLE_GETTING_STARTED_FLOW)&&Ys.HY()}))}render(){var e,t
const n=null===(t=null===(e=this.props.gettingStarted)||void 0===e?void 0:e.tasks)||void 0===t?void 0:t.some((e=>!e.completed)),a=dt.ZP.ENABLE_NUE_MODULES
return d.createElement(Db.W2,{className:"sidepanel",size:this.props.isExpanded?"lg":"sidepanel",dataTestAttrs:{component:"HomeSidepanel",element:"root",key:this.props.isExpanded?"expanded":"collapsed"}},d.createElement(Db.X2,{className:"homeSidepanel js-navTour-home"},d.createElement(Db.W2,{className:"homeSidepanel-today",size:"sidepanel"},this.props.currentUser?d.createElement("div",null,d.createElement(Db.X2,null,d.createElement(Db.JX,{sm:6},d.createElement("div",{className:"homeSidepanel-today-header u-lr-split"},d.createElement("div",{className:"homeSidepanel-today-date whiteLink",onClick:this._handleExpand},d.createElement("div",{className:"homeSidepanel-today-date-month"},this.props.todayDate.format("MMMM")),d.createElement("div",{className:"homeSidepanel-today-date-day"},this.props.todayDate.format("DD"))),!this.props.isExpanded&&d.createElement("div",null,d.createElement(V0.Z,{expanded:!1,buttonStyle:C.ZJ.TERTIARY_WHITE_TRANSPARENT}))))),XA.Z.hasLicense("LICENSE_REVIEWS")&&!l.default.isEmpty(this.props.reviewSummary)&&d.createElement(X1,{reviewSummary:this.props.reviewSummary}),dt.ZP.ENABLE_GETTING_STARTED_FLOW&&n&&d.createElement(Db.X2,null,d.createElement(Db.JX,{sm:6},d.createElement(W1,{currentUser:this.props.currentUser,tasks:this.props.gettingStarted.tasks,completed:this.props.gettingStarted.completed,hasSpace:this.props.hasGettingStartedSpace||yz.U(this.props.currentUser)}))),a&&d.createElement(d.Fragment,null,this.props.hasIncompleteSequenceChecklist&&d.createElement(Db.X2,null,d.createElement(Db.JX,{sm:6},d.createElement(ChecklistPanelLink,{checklistKey:vz.dP,displayText:"Explore Molecular Biology",onClick:()=>{(0,Cz.O8)(vz.dP,"sidepanel");(0,Ys.hE)()}}))),this.props.hasIncompleteEntryChecklist&&d.createElement(Db.X2,null,d.createElement(Db.JX,{sm:6},d.createElement(ChecklistPanelLink,{displayText:"Explore the Notebook",onClick:()=>{(0,Cz.O8)(vz.t8,"sidepanel");(0,Ys.JU)()}})))),d.createElement(Db.X2,null,d.createElement(Q1,{emptyText:"You have no recently opened entities.",files:this.props.files,headerText:"Recently opened",activeItemId:this.props.activeItemId})),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&(0,ln.cr)({feature:on.ed.REGISTRY_WORKLISTS})&&d.createElement(Db.X2,null,d.createElement(RecentWorklistsHomeListing,null)),d.createElement(n2,{currentUser:this.props.currentUser})):d.createElement(a2,null)),this.props.isExpanded&&d.createElement(Db.W2,{size:"md",className:"homeSidepanel-calendar-container expandedContainer"},d.createElement(Db.X2,null,d.createElement(Db.JX,{md:16,className:"expandedBrowser-toggleCollapseArrowWrapper"},d.createElement(V0.Z,{className:"js-navTour-calendar",expanded:!0}))),d.createElement("div",{className:"homeSidepanel-calendar"},d.createElement(z1,null)))))}}const i2=HomeSidepanelConnector.connect(HomeSidepanel,{throttleUpdates:!0})
var s2=n(979313),r2=n(347246),o2=n(351319),l2=n(959042),c2=n(286291),d2=n(470755),u2=n(89635)
function ExpandedProjectTable(e){if(e.areProjectsLoading)return d.createElement("div",null,d.createElement("span",{className:"faded"},"Loading..."))
if(0===e.items.length)return d.createElement("div",null,d.createElement("span",{className:"faded"},"None found."))
const t=[{header:(0,u2.o7)(Kn.bo.SORT_NAME_KEY),accessorKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!0,sortDirection:(0,WY.Op)(e.sorts,Kn.bo.SORT_NAME_KEY),sortKey:Kn.bo.SORT_NAME_KEY},{header:(0,u2.o7)(Kn.bo.SORT_CREATED_AT_KEY),accessorKey:"date",isCollapsible:!1,isSortable:!0,sortDirection:(0,WY.Op)(e.sorts,Kn.bo.SORT_CREATED_AT_KEY),sortKey:Kn.bo.SORT_CREATED_AT_KEY},{header:"Description",accessorKey:"description",flexGrow:1,isCollapsible:!1,isSortable:!1}],n=e.items.map((e=>{if(ea.ZP.isSource(e.id)){const t=e
return{id:t.id,isFaded:Boolean(t.archiveRecord)||Boolean(t.hidden),data:{date:Hr.UT(t.createdAt,{showTime:!1}),name:d.createElement("span",null,t.name,d.createElement(lC.Z,{item:t}),d.createElement("span",{className:"u-mini-spacing-left"},d.createElement(d2.Z,{onClick:async()=>{await Rn.Z.toggleProjectStar(t)
await(0,Ml.doQuerySafe)({query:o2.Ox},{variables:{ids:[t.rootFolder.api_identifier]},fetchPolicy:"network-only"});(0,r2.Z)()},starred:t.starred}))),description:t.description},icon:d.createElement(pe.Z,{className:"scrollableTable-cell-icon",icon:st.PROJECT}),extra:{result:t,targetFolder:c2.Z.sourceToRootFolder(t)}}}{const t=e
return{id:t.id,isFaded:Boolean(t.archiveRecord),data:{date:Hr.UT(t.created_at,{showTime:!1}),name:d.createElement("span",null,t.name,d.createElement(lC.Z,{item:t})),description:t.description},icon:d.createElement(pe.Z,{className:"scrollableTable-cell-icon",icon:st.FOLDER}),extra:{result:t,targetFolder:t}}}}))
return d.createElement(Xj.Z,{className:"u-flex-grow",columns:t,isCompact:!1,matchParentHeight:!0,onRowClick:t=>{t.extra&&e.openResult(t.extra.targetFolder)},onRowContextMenu:(t,n)=>{t.extra&&l2.Z.open(n,{file:t.extra.result,finderId:e.finderId,isListing:!0})},rows:n,onChangeSort:e.onChangeSort})}class NewProjectButton extends d.Component{constructor(){super(...arguments)
this._handleNewProject=()=>{(0,Xn.Z)($W.Z,{navigateOnSuccess:!1,successCallback:this._handleOpenProject})}
this._handleOpenProject=e=>{this.props.openResult({...e,api_identifier:e.id})}}render(){const e=0===(0,WW.UP)().length
return d.createElement(P.ZP,{title:e?"Please contact your administrator to create a project":"Create project",placement:P.TQ.BOTTOM,container:"body"},d.createElement(C.Co,{buttonStyle:this.props.compact?C.ZJ.TERTIARY_BLUE:C.ZJ.SECONDARY,icon:"compose",disabled:e,onClick:this._handleNewProject,size:C.qE.SMALL,className:"_test-new-project-button"}))}}const m2=NewProjectButton
var p2=n(969156),h2=n(431072),g2=n(9397),E2=n(683376),f2=n(182028),S2=n(339866)
function isProject(e){return e.sourceType===DN.PROJECT_TYPE}class SourceSidepanelItem extends d.PureComponent{constructor(){super(...arguments)
this._isMounted=!1
this.state={isMenuOpen:!1}
this.handleOpen=()=>{lo.isRegistry(this.props.source)&&(0,f2.P)(this.props.source.id)
const e=c2.Z.sourceToRootFolder(this.props.source)
this.props.openResult(e)}
this.handleContextMenuClose=()=>{this._isMounted&&this.setState({isMenuOpen:!1})}
this.handleShowMenuOptions=e=>{l2.Z.open(e,{file:this.props.source,finderId:this.props.finderId,isListing:!0,closeCallback:this.handleContextMenuClose})
this.setState({isMenuOpen:!0})}
this.handleClickStar=async()=>{if(isProject(this.props.source)){await Rn.Z.toggleProjectStar(this.props.source)
await(0,Ml.doQuerySafe)({query:o2.Ox},{variables:{ids:[this.props.source.rootFolder.api_identifier]},fetchPolicy:"network-only"});(0,r2.Z)()}}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}renderTitle(){const{source:e,showOwner:t}=this.props,n=Jn.Z.currentUser(),a=n&&n.handle===e.s_owner.handle
if(lo.isRegistry(e))return d.createElement("span",null,e.s_owner.name)
const i=e.s_owner&&(0,Qw.a)(e.s_owner)||e.creator&&(0,Qw.a)(e.creator)||e.creator_handle,s=!(0,E2.F)()&&t&&!a&&i
return d.createElement("span",null,s&&d.createElement("span",{className:"faded"},i," / "),e.name)}render(){const{source:e}=this.props
let t=e.collaborators||[]
isProject(e)&&(t=t.filter((e=>e.type===st.TEAM)))
return d.createElement(S2.Z,{canInteract:this.state.isMenuOpen,finderId:this.props.finderId,result:this.props.source,shouldCaptureDrop:isProject(e)},d.createElement(g1.Z,{active:!1,className:"sidepanelItem--dnd",faded:isProject(e)&&(e.archived||e.hidden||Boolean(e.archiveRecord)),handleClickStar:this.handleClickStar,icon:isProject(e)?d.createElement(pe.Z,{icon:"project"}):null,isCompact:!1,onClick:this.handleOpen,onContextMenu:this.handleShowMenuOptions,parties:t,showStar:this.props.showStar,starred:e.starred,subTitle:this.props.showCreator&&e.creator?e.creator.name:"",title:{text:this.props.source.name,node:this.renderTitle()},isExpandable:!1,isChild:this.props.isChild}))}}class TopLevelFolderSidepanelItem extends d.PureComponent{constructor(){super(...arguments)
this._isMounted=!1
this.state={isMenuOpen:!1}
this.handleOpen=()=>{this.props.openResult(this.props.folder)}
this.handleContextMenuClose=()=>{this._isMounted&&this.setState({isMenuOpen:!1})}
this.handleShowMenuOptions=e=>{(0,S.Gp)(null!=this.props.finderId,"Expected a non-null finderId")
l2.Z.open(e,{file:this.props.folder,finderId:this.props.finderId,isListing:this.props.isListing,closeCallback:this.handleContextMenuClose})
this.setState({isMenuOpen:!0})}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}renderTitle(){return d.createElement("span",{key:"name"},this.props.folder.name)}renderSubTitle(){if(this.props.isCompact||!this.props.folder.source||!this.props.folder.source.alwaysShowAncestorFolderNames)return""
let e=this.props.folder
const t=[e.name]
for(;e.parent;){e=(0,s2.Z)(e.parent)
t.push(e.name)}t.reverse()
return d.createElement(Oe.Z,{renderContent:()=>t.map(((e,t,n)=>d.createElement("span",{key:t},d.createElement(pe.Z,{icon:0===t?"project":"folder"})," ",e," ",t<n.length-1&&d.createElement(pe.Z,{icon:"chevron-right"})," "))),placement:ne.ZH.BOTTOM},d.createElement("span",null,this.props.folder.source.name))}render(){(0,S.Gp)(null!=this.props.finderId,"Expected a non-null finderId")
return d.createElement(S2.Z,{canInteract:this.state.isMenuOpen,finderId:this.props.finderId,result:this.props.folder,shouldCaptureDrop:!0},d.createElement(g1.Z,{active:!1,className:"sidepanelItem--dnd",icon:d.createElement(pe.Z,{icon:"folder"}),isCompact:this.props.isCompact,faded:Boolean(this.props.folder.archiveRecord),onClick:this.handleOpen,onContextMenu:this.handleShowMenuOptions,subTitle:this.renderSubTitle(),title:{text:this.props.folder.name,node:this.renderTitle()},tooltipText:void 0,isExpandable:!1,isChild:this.props.isChild}))}}function ProjectList(e){return e.areProjectsLoading?d.createElement(kl.b,null):0===e.items.length?d.createElement("div",{className:"sidepanel-fadedMessage",...(0,ee.Z)({component:"ProjectList",element:"emptyMessage"})},"None found."):d.createElement("div",null,e.items.map((t=>ea.ZP.isSource(t.id)?d.createElement(SourceSidepanelItem,{finderId:e.finderId,key:t.id,openResult:e.openResult,showCreator:!0,showOwner:!1,showStar:!0,source:t,isChild:!1}):d.createElement(TopLevelFolderSidepanelItem,{key:t.id,finderId:e.finderId,isCompact:!1,isListing:!0,openResult:e.openResult,folder:t,isChild:!1}))))}var y2=n(204333)
const b2=xa.Ps`
  query ProjectsListingQuery($projectIds: [StrictString!]!, $folderIds: [StrictString!]!) @skipAudit {
    projects(ids: $projectIds) {
      ...ProjectSummaryGraphQL
      ... on ProjectNode {
        id
        permissions {
          admin
          appendable
          archivable
          readable
          unarchivable
          writable
        }
        collaboratorsJson
        description
      }
      ...InaccessibleInfoGraphQL
    }
    folders(ids: $folderIds) {
      ...FolderWithPermissionsGraphQL
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("ProjectSummary").fragment}
  ${(0,La.f)("FolderWithPermissions").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class ProjectsListing extends d.Component{constructor(){super(...arguments)
this.state={filters:(0,h2.v5)().filters}
this._handleSearch=e=>{this.props.onSearch(e)
qP.WN(ZP.SA.PROJECTS,e.sorts)}
this._rememberProjectFilters=e=>{var t
const n=e.find((e=>e.key===Kn.Vm.SHARED_WITH))
n?We.Z.set(p2.gC.LAST_SELECTED_PROJECT_FILTER,n.value):We.Z.set(p2.gC.LAST_SELECTED_PROJECT_FILTER,null)
const a=e.find((e=>e.key===Kn.Vm.PROJECT_ATTRIBUTE))
a?We.Z.set(p2.gC.LAST_SELECTED_PROJECT_ATTRIBUTE_FILTER,null!==(t=a.value)&&void 0!==t?t:null):We.Z.set(p2.gC.LAST_SELECTED_PROJECT_ATTRIBUTE_FILTER,null)}
this._handleChangeHeaderSort=e=>{const t=(0,WY.dt)(this.props.searchParams.sorts,e)
this._updateSortParams(t.key,t.reverse)}
this._updateSortParams=(e,t)=>{this.props.onUpdateSortOrder([{key:e,reverse:t}])}}_handleChangeFilters(e){this.setState({filters:e})
this._rememberProjectFilters(e)
this.props.onUpdateFilters((0,y2.E)(e))}render(){var e,t
const n=Jn.Z.currentUser(),a=n.teams?n.teams:[],i=n.organizations?n.organizations:[],s={offset:this.props.searchParams.offset,limit:this.props.searchParams.limit,total:null!==(t=null===(e=this.props.searchResults)||void 0===e?void 0:e.total)&&void 0!==t?t:0},r=d.createElement(qT.Z,{sortConfig:{availableSortOptions:(0,u0.G6)(this.props.availableSortKeys),sorts:this.props.searchParams.sorts,onSetSort:this._updateSortParams},pageSizeConfig:{pageSize:this.props.searchParams.limit,availablePageSizes:TN.x_,onSetPageSize:this.props.onUpdatePageSize}}),o=d.createElement($Y.Z,{isExpanded:this.props.isExpanded,buttons:d.createElement("div",null,d.createElement(V0.Z,{className:"u-mini-spacing-right",expanded:this.props.isExpanded}),d.createElement(m2,{compact:!this.props.isExpanded,openResult:this.props.onListFolder})),crumbs:d.createElement(Cw.wn,{text:"Projects"}),filtersContainer:d.createElement(Hu.Z,{primaryFilterOptions:l.default.compact([{filterKey:Kn.Vm.SHARED_WITH,extraProps:{organizations:i,teams:a,showMyProjects:!0,showSharedWithMe:!0}},{filterKey:Kn.Vm.PROJECT_ATTRIBUTE}]),secondaryFilterGroups:[],filters:this.state.filters,onChangeFilters:e=>{this._handleChangeFilters(e)},selectedSchema:null}),queryInput:d.createElement(m0.Z,{query:this.props.searchParams.query,onUpdateQuery:this.props.onUpdateQueryString}),showShadow:!0,settingsDropdown:r,showSettingsDropdownInlineInExpandedView:!1,savedSearchHeader:d.createElement(g2.Z,{searchSection:Sn.yd.PROJECT_ITEMS,onSelectSavedSearch:this.props.onSelectSavedSearch,activeSavedSearch:this.props.activeSavedSearch,key:"saved-searches-dropdown",onSearch:this.props.onSearch,searchParams:this.props.searchParams,isExpanded:this.props.isExpanded})}),c=(0,g0.B8)()
return this.props.isExpanded?d.createElement(Db.W2,{className:"sidepanel expandedContainer _test-projects-listing",size:"lg",dataTestAttrs:{component:"ProjectListing",element:"root",key:"expanded"}},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},o)),d.createElement(Db.X2,{fluid:!0},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21,className:"u-flex-display u-vertical-flex"},this.props.didLoadingError?d.createElement("div",{className:"sidepanel-fadedMessage"},Kn.Jc):d.createElement(d.Fragment,null,d.createElement("div",{className:"u-flex-display"},d.createElement(zT.Z,{isLoading:this.props.areProjectsLoading,pagination:s,setOffset:this.props.onUpdateOffset}),r),d.createElement("div",{className:"u-flex-grow u-flex-display u-justify-content-center"},d.createElement(h0.ZP,{...c},d.createElement(ExpandedProjectTable,{finderId:ZP.JL,openResult:this.props.onListFolder,items:this.props.items,areProjectsLoading:this.props.areProjectsLoading,sorts:this.props.searchParams.sorts,onChangeSort:this._handleChangeHeaderSort}))))))):d.createElement(Db.W2,{className:"sidepanel _test-projects-listing",size:"sidepanel",dataTestAttrs:{component:"ProjectListing",element:"root",key:"collapsed"}},d.createElement(Db.X2,null,o),d.createElement(Db.X2,{fluid:!0,className:"u-position-relative"},d.createElement("div",{className:"u-absolute-scroll-container"},this.props.didLoadingError?d.createElement("div",{className:"sidepanel-fadedMessage"},Kn.Jc):d.createElement(o1.Z,{pagination:s,setOffset:this.props.onUpdateOffset},d.createElement(h0.ZP,{...c},d.createElement(ProjectList,{finderId:ZP.JL,openResult:this.props.onListFolder,items:this.props.items,areProjectsLoading:this.props.areProjectsLoading}))))))}}const T2=(0,UP.ZP)((function QueryingProjectsListing(e){const t=e.searchResults?e.searchResults.ids:[],n=(0,Da.IJ)(b2,{variables:{projectIds:t.filter((e=>ea.ZP.apiIdToType(e)===st.SOURCE)),folderIds:t.filter((e=>ea.ZP.apiIdToType(e)===st.FOLDER))}})
if(n.type===Da.NI.ERROR||e.loadingState===d0.Gu.FAILED)return d.createElement(ProjectsListing,{...e,items:[],areProjectsLoading:!1,didLoadingError:!0})
if(n.type===Da.NI.PENDING||e.loadingState===d0.Gu.LOADING)return d.createElement(ProjectsListing,{...e,items:[],areProjectsLoading:!0,didLoadingError:!1})
const a=n.data.projects.filter((e=>!(0,ka.CZ)(e))),i=n.data.folders.filter((e=>!(0,ka.CZ)(e))),s=[...a.map((e=>({...(0,zo.tY)("ProjectSummary",e),permissions:e.permissions,collaborators:e.collaboratorsJson,description:e.description?e.description:void 0}))),...i.map((e=>({...(0,s2.Z)((0,zo.tY)("FolderWithPermissions",e)),permissions:{...e.permissions,batchesWritable:Boolean(e.permissions.batchesWritable),bioentitiesAppendable:Boolean(e.permissions.bioentitiesAppendable),canCreateRequest:Boolean(e.permissions.canCreateRequest),movable:Boolean(e.permissions.movable),subfolderCreatable:Boolean(e.permissions.subfolderCreatable)}})))],r=l.default.indexBy(s,"id")
return d.createElement(ProjectsListing,{...e,didLoadingError:!1,areProjectsLoading:!1,items:t.filter((e=>r[e])).map((e=>r[e]))})}),Kn.Sc.PROJECTS,ZP.SA.PROJECTS,{defaultSearchParams:{...(0,h2.v5)(),filters:(0,y2.E)((0,h2.v5)().filters)},getNavigationUpdate:function getProjectsURL(e,t){return t.isExpanded?{url:eJ.q7("/projects",t.searchParams,t.filterErrors)}:null}})
var v2=n(170025)
function trackCreateSequence(e){m.j("sequence","open_create_sequence_modal",{product:j.XC.MOLBIO,createdFrom:us.Tg.PROJECT,initialImportFlow:e})}function getFolderCreateDropdownOptions(e,t,n,a,i,s,r,o){const l=t&&t.subfolderCreatable,c=dt.ZP.ENABLE_PROTOCOLS,d=(0,oB.Z)(),u=(0,ln.cr)({feature:on.ed.REGISTRY_CREATE}),p=u&&(0,ln.cr)({feature:on.ed.REGISTRY_MIXTURES}),h=(0,ln.cr)({feature:on.gx.PROCESSES_CREATE}),g=dt.ZP.STUDIES_ENABLE,E=dt.ZP.MODBIO_ENABLE_COMPOSITE_ENTITIES,f=[...d?[{name:"Import batches",value:"more-import-batches",icon:"table",handleClick:()=>{(0,qG.BL)(e)}},{name:"Update batches",value:"more-update-batches",icon:"table",handleClick:()=>{(0,qG.T3)(e)}}]:[],...u?[{name:"Import entities",value:"more-import-entities",icon:"table",handleClick:()=>{(0,qG.df)(e)},dataTestAttrs:{component:"CreateMenu",element:"importEntities"}}]:[],...u?[{name:"Update entities",value:"more-update-entities",icon:"table",handleClick:()=>{(0,qG.h9)(e)}}]:[]],S=function _getSequenceSubmenu(e){return[(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.CREATE})&&{name:"New DNA / RNA sequence",value:"dna-sequence-new-dna-sequence",icon:st.SEQUENCE,handleClick:()=>{(0,qG.Nt)(e.id)
trackCreateSequence(us._p.RAW)}},(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.IMPORT})&&{name:"Import DNA / RNA sequences",value:"dna-sequence-import-dna-sequences",icon:"import",handleClick:()=>{(0,qG.JM)(e.id)
trackCreateSequence(us._p.FILE)}},(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.IMPORT})&&{name:"Import DNA / RNA sequences from spreadsheet",value:"sequence-import-sequences-from-spreadsheet",icon:"import",handleClick:()=>{(0,qG.Rw)(e.id)}},(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.IMPORT})&&{name:"Reimport DNA / RNA sequences",value:"sequence-reimport-sequences",icon:"import",handleClick:()=>{(0,qG.qv)(e.id)}},(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.IMPORT})&&{name:"Bulk import DNA / RNA from genome",value:"dna-sequence-bulk-import-dna-from-genome",icon:"import",handleClick:()=>{(0,qG.TU)(e.id)}},(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})&&{name:"Assemble DNA / RNA sequences by concatenation",value:"sequence-assemble-by-concatenation",icon:"assembly",handleClick:()=>{(0,rO.g3)({initialMethodData:{type:eO.tU.CONCATENATION,parameters:{polymerSubtype:An.Dj.dna_sequence,defaultFragmentProductionMethod:eO.y0.SLICE,applyDefaultNullTerminalPhosphate:!0}},initialFolderId:e.id},j.D2.MOLBIO_BULK_ASSEMBLY_SETTINGS_MODAL)}},(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})&&{name:"Assemble DNA sequences by cloning",value:"dna-sequence-bulk-assemble-dna",icon:"assembly",handleClick:()=>{(0,qG.Qx)()}}].filter((e=>Boolean(e)))}(e),y=function _getOligoSubmenu(e){return[(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.CREATE})&&{name:"New oligo",value:"oligo-new-oligo",icon:st.OLIGO,handleClick:()=>{(0,as.Be)(us.Tg.PROJECT_SIDEBAR_CREATE_BUTTON,us.Gp.MODAL);(0,qG.pf)(e.id)}},(0,ln.cr)({itemType:st.SEQUENCE,feature:rn.N7.IMPORT})&&{name:"Import DNA / RNA oligos from spreadsheet",value:"oligo-import-oligos",icon:"import",handleClick:()=>{(0,as.Be)(us.Tg.PROJECT_SIDEBAR_CREATE_BUTTON,us.Gp.SPREADSHEET);(0,qG.QF)(e.id)}},(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})&&{name:"Assemble DNA / RNA oligos by concatenation",value:"oligo-assemble-by-concatenation",icon:"assembly",handleClick:()=>{(0,rO.g3)({initialMethodData:{type:eO.tU.CONCATENATION,parameters:{polymerSubtype:An.Dj.dna_oligo,defaultFragmentProductionMethod:eO.y0.SLICE,applyDefaultNullTerminalPhosphate:!0}},initialFolderId:e.id},j.D2.MOLBIO_BULK_ASSEMBLY_SETTINGS_MODAL)}}].filter((e=>Boolean(e)))}(e),b=function _getProteinSubmenu(e){return[(0,ln.cr)({itemType:st.PROTEIN,feature:rn.N7.CREATE})&&{name:"New AA sequence",value:"aa-sequence-new-aa-sequence",icon:st.PROTEIN,handleClick:()=>{(0,qG.Sc)(e.id)}},(0,ln.cr)({itemType:st.PROTEIN,feature:rn.N7.IMPORT})&&{name:"Import AA sequences",value:"aa-sequence-import-aa-sequences",icon:"import",handleClick:()=>{m.j("protein","open_import_aa_modal",{product:j.XC.MOLBIO,createdFrom:us.Tg.PROJECT});(0,v2.g)({initialFolderId:e.id})}},(0,ln.cr)({itemType:st.PROTEIN,feature:rn.N7.IMPORT})&&{name:"Import AA sequences from spreadsheet",value:"aa-sequence-import-aa-sequences-from-spreadsheet",icon:"import",handleClick:()=>{(0,qG.pn)(e.id)}},(0,ln.cr)({itemType:st.PROTEIN,feature:rn.N7.IMPORT})&&{name:"Reimport AA sequences",value:"aa-sequence-reimport-aa-sequences",icon:"import",handleClick:()=>{(0,qG._q)(e.id)}},(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})&&{name:"Assemble AA sequences by concatenation",value:"aa-assemble-by-concatenation",icon:"assembly",handleClick:()=>{(0,rO.g3)({initialMethodData:{type:eO.tU.CONCATENATION,parameters:{polymerSubtype:An.Dj.aa_sequence,defaultFragmentProductionMethod:eO.y0.SLICE,applyDefaultNullTerminalPhosphate:!0}},initialFolderId:e.id},j.D2.MOLBIO_BULK_ASSEMBLY_SETTINGS_MODAL)}},(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})&&{name:"Bulk translate DNA to AA",value:"aa-sequence-bulk-translate-dna-to-aa",icon:st.PROTEIN,handleClick:()=>{(0,qG.G9)()}}].filter((e=>Boolean(e)))}(e),T=function _getMoleculeSubmenu(e){return[dt.ZP.CHEMISTRY_ENABLE_MOLECULE&&{name:"New molecule",value:"molecule-new-molecule",icon:st.MOLECULE,handleClick:()=>{(0,qG.bR)(e.id)}},dt.ZP.CHEMISTRY_ENABLE_MOLECULE&&{name:"Import molecules",value:"molecule-import-molecules-spreadsheet",icon:"import",handleClick:()=>{(0,qG.J5)(e.id)}}].filter((e=>Boolean(e)))}(e),v=function _getEntrySubmenu(e){return[{name:"Blank entry",value:"entry-blank-entry",icon:rr.m.Entry,handleClick:()=>{dt.ZP.ELN_ENABLE_SCHEMA_REQUIRED_FOR_REVIEW&&dt.ZP.ELN_ENABLE_SCHEMA_ON_ENTRY_CREATE_MODAL?(0,qG.CD)(e.id):(0,qG.Yo)(e.id)}},{name:"Entry from template",value:"entry-entry-from-template",icon:"template",handleClick:()=>{(0,qG.RJ)(e.id)}}]}(e)
return[...l?[{name:"Folder",value:"folder",icon:"folder",handleClick:()=>{(0,qG.Gw)(e.id,Wu.Dy.ARBITRARY,n)}}]:[],{name:dt.ZP.ELN_ENABLE_BLANK_ENTRY_CREATION?"Entry":"Entry from Template",value:"entry",icon:rr.m.Entry,handleClick:()=>{dt.ZP.ELN_ENABLE_BLANK_ENTRY_CREATION?dt.ZP.ELN_ENABLE_SCHEMA_REQUIRED_FOR_REVIEW&&dt.ZP.ELN_ENABLE_SCHEMA_ON_ENTRY_CREATE_MODAL?(0,qG.CD)(e.id):(0,qG.Yo)(e.id):(0,qG.RJ)(e.id)},...dt.ZP.ELN_ENABLE_BLANK_ENTRY_CREATION?{menu:v}:{}},...c?[{name:"Protocol",value:"protocol",icon:st.PROTOCOL,handleClick:()=>{(0,qG.Qp)(e.id)}}]:[],...S.length>0?[{name:"DNA / RNA sequence",value:"dna-sequence",icon:"helix",handleClick:()=>{},menu:S}]:[],...b.length>0?[{name:"AA sequence",value:"aa-sequence",icon:"protein",handleClick:()=>{},menu:b}]:[],...y.length>0?[{name:"Oligo",value:"oligo",icon:"oligo",handleClick:()=>{},menu:y}]:[],...E?[{name:"Complex polymer",value:"complex-polymer",icon:"oligo",handleClick:()=>{},menu:o}]:[],...(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})?[{name:"CRISPR",value:"crispr",icon:"crispr",handleClick:()=>{},menu:[{name:"CRISPR guides",value:"crispr-crispr-guides",icon:"crispr",handleClick:()=>{(0,qG.Xz)(e.id)}},{name:"HR template",value:"crispr-hr-template",icon:"hr-template",handleClick:()=>{(0,qG.Xi)(e.id)}}]}]:[],...u&&a.length>0?[{name:"Entity from schema",value:"entity-from-schema",icon:rr.m.BasicFolderItem,handleClick:()=>{},menu:a,dataTestAttrs:{component:"CreateMenu",element:"entityFromSchema"}}]:[],...p&&i.length>0?[{name:"Mixture",value:"mixture",icon:rr.m.Mixture,handleClick:()=>{},menu:i}]:[],...T.length>0?[{name:"Molecule",value:"molecule",icon:rr.m.Molecule,handleClick:()=>{},menu:T}]:[],...g?[{name:"Study",value:"study",icon:st.STUDY,menu:r,handleClick:()=>{}}]:[],...h?[{name:"Workflow tasks",value:"process",icon:st.PROCESS,handleClick:()=>{},menu:s}]:[],...f.length>0?[{name:"More",value:"more",handleClick:()=>{},menu:f,dataTestAttrs:{component:"CreateMenu",element:"more"}}]:[]]}var C2=n(883136)
const I2=xa.Ps`
  query CreateModalOligoConjugateQuery($id: StrictString!)
  @skipAudit
  @engComponent(name: MODIFIED_BIOLOGICS) {
    tagSchema(id: $id) {
      ... on TagSchemaNode {
        ...TagSchemaGraphQL
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("TagSchema").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function CreateOligoConjugateModal({initialFolderId:e,schemaId:t,onRequestClose:n,onRequestSubmit:a}){const[i,s]=(0,d.useState)(""),[r,o]=(0,d.useState)(null!=e?e:Qe.Z.get(Qe.O.INVENTORY)),[l,c]=(0,d.useState)([]),[u,m]=(0,d.useState)(!1),g=0===i.trim().length||null==r||u,E=(0,Da.IJ)(I2,{fetchPolicy:"cache-and-network",renderCachedDataWhenRefetching:!0,variables:{id:t}}),f=E.type!==Da.NI.SUCCESS||(0,ka.CZ)(E.data.tagSchema)?null:{id:E.data.tagSchema.id,name:E.data.tagSchema.name,fields:E.data.tagSchema.fieldsJson}
return d.createElement(et.ZP,{title:"Create Oligo Conjugate",buttons:[{disabled:g,submit:!0,text:"Create"}],onRequestClose:n,onRequestSubmit:async function createOligoConjugate(){(0,S.hu)(null!=r,"Unexpected creating oligo conjugate with null folderId")
m(!0)
try{await(0,Ic.jI)(ComplexPolymerActions_createOligoConjugate(i,r,f.id,(0,pC.UR)(l)),"Creating oligo conjugate...")
ze.Z.invalidateFolderContents(r)
a()}catch(e){m(!1)
if(!Cn.d0(e))throw e
v.ZP.notifyError(e)}}},d.createElement(h.Z,null,d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Entity Name",isRequired:!0}),d.createElement("input",{autoFocus:!0,type:"text",value:i,placeholder:"Untitled oligo conjugate",onChange:e=>{s(e.target.value)}}))),d.createElement(p.Z,{sm:6},d.createElement(Ke.Z,null,d.createElement(Fr.Z,{label:"Folder",isRequired:!0}),d.createElement(Ye.Z,{enableRedesign:!0,showInventory:!0,value:r,onChange:e=>{o(e.target.value)},unsetOnFetchFail:!0})))),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},f?d.createElement(C2.Z,{labelStyle:Mo.gF.LABEL,onChange:c,schema:f,tags:l,showFieldDescription:dt.ZP.SCHEMAS_ENABLE_SCHEMA_FIELD_DESCRIPTION_FOR_TAG_SCHEMAS}):d.createElement(kl.Z,null))))}const w2=xa.Ps`
  query CreateMenuComplexPolymersQuery @skipAudit @engComponent(name: MODIFIED_BIOLOGICS) {
    complexPolymerSchemas {
      id
      name
      archived
    }
  }
`,N2={name:"No complex polymer schemas",value:"complex-polymer-schema-none",disabled:!0},A2={name:"Loading...",value:"complex-polymer-schema-loading",disabled:!0},R2={name:"Error loading complex polymer schemas",value:"complex-polymer-schema-error",disabled:!0,icon:"error"}
var P2=n(332753)
class FolderCreateDropdownDataConnector extends oi.C{constructor(){super(...arguments)
this.stores=[JZ.Z]
this._handleFetchStarredTagSchemas=()=>{this.dispatch((0,P2.V3)())}
this._handleToggleTagSchemaStar=e=>{this.dispatch((0,P2.Xb)(e))}}enhanceProps(){let e=this.props.folder
if(e){e=(0,s2.Z)(e)
const t=this.getOrFetchOptional(lA.V.PERMISSIONS_BY_ITEM_ID,e.id)
t&&(e={...e,permissions:t})}const t=null!=this.props.folder&&lo.isRegistry(this.props.folder.source)
return{folder:e,fetchStarredTagSchemas:this._handleFetchStarredTagSchemas,toggleTagSchemaStar:this._handleToggleTagSchemaStar,starredSchemaIds:this.reduxState().models.stars.tagSchemaIds,tagSchemas:this.tagSchemaStore().getTagSchemas({oligoAwareFolderItemTypes:(0,tw.getRegistrySupportedOligoAwareTypes)(),registryId:t?this.props.folder.source.id:null})}}}var O2=n(227277)
function getTagSchemaMenuOptions(e,t,n){if(!t)return[]
const a=t.filter((t=>t.folderItemType===e&&t.permissions.objectsCreatable)).map((e=>({name:e.name,value:e.id,icon:e.iconId,className:"scrollable newDropdown-schemaOption",starrable:!0,handleClick:()=>{UF.Z.open(UF.Z,{createBioentityArgs:{...zF.gy(),tagSchema:e,folderId:Qe.Z.get(Qe.O.INVENTORY)}})}})))
return n?(0,hs.Z)(a,[e=>n.includes(e.value)?"a":"b"]):a}function makeOptionData(e){return{name:e.name,value:e.value,disabled:e.disabled,icon:e.icon,submenu:e.menu?[e.menu.map((e=>makeOptionData(e)))]:void 0,className:e.className,extra:{unstarrable:!e.starrable},dataTestAttrs:e.dataTestAttrs}}function mapOptionValuesToClickHandlers(e){return e.reduce(((e,t)=>{const n=function mapOptionValueToClickHandler(e){return e.handleClick?{[e.value]:()=>{e.handleClick()}}:{}}(t)
return{...e,...n,...t.menu?mapOptionValuesToClickHandlers(t.menu):{}}}),{})}function useRefetchTagSchemas(e,t){d.useEffect((()=>{t()}),[t])
d.useEffect((()=>{null==e&&WK.he()}),[e])}const x2=FolderCreateDropdownDataConnector.connect((function FolderCreateDropdown(e){useRefetchTagSchemas(e.tagSchemas,e.fetchStarredTagSchemas)
const t=(0,VG.fl)(),n=(0,fX.Sj)(e.folder.id,Sn.D2.PROJECTS_SIDEPANEL),a=function useComplexPolymerSchemasAsCreateDropdownOptions(e){const t=(0,Da.IJ)(w2,{fetchPolicy:"cache-and-network"})
switch(t.type){case Da.NI.PENDING:return[A2]
case Da.NI.ERROR:return[R2]
case Da.NI.SUCCESS:{const n=t.data.complexPolymerSchemas.filter((e=>!1===e.archived))
return 0===n.length?[N2]:n.map((t=>({name:t.name,handleClick:()=>{(0,Xn.Z)(CreateOligoConjugateModal,{schemaId:t.id,initialFolderId:e})},value:`${t.id}complex-polymer`})))}default:(0,S.Gp)(!1,`Unexpected result type: ${(0,Go.vE)(t).type}`)
return[]}}(e.folder.id),i=function getPermissions(e){if(!e||!e.source)return null;(0,S.hu)(!lo.isRegistry(e.source),"Did not expect folder to be in the Registry. FolderCreateDropdown doesn't support the Registry yet.")
let t
e.permissions&&(t=e.permissions)
return t||null}(e.folder),s=e.tagSchemas||[],r=getFolderCreateDropdownOptions((0,s2.Z)(e.folder),i,e.onOpenFolder,getTagSchemaMenuOptions(st.BASIC_FOLDER_ITEM,s,e.starredSchemaIds),(0,ln.cr)({feature:on.ed.REGISTRY_MIXTURES})?getTagSchemaMenuOptions(st.MIXTURE,s,e.starredSchemaIds):[],(0,VG.gb)(t,e.folder.id),n,a),o=mapOptionValuesToClickHandlers(r),l=r.map((e=>makeOptionData(e))),c=d.createElement(Ar.Z,{onSelect:(u=o,e=>{(0,S.hu)(e in u,`${e} has no associated click handler.`)
u[e]()}),optionDatas:l,renderOptionContent:(0,O2.V)(e.toggleTagSchemaStar,e.starredSchemaIds,{getId:e=>e.value}),height:Nr.Bl.LARGE,width:Nr.zL.LARGE,dropLeft:e.dropLeft})
var u
return d.createElement(I.ZP,{closeOnInsideClick:!0,closeOnOutsideClick:!0,menu:c},d.createElement(C.Co,{className:"u-mini-spacing-left",buttonStyle:C.ZJ.TERTIARY_BLUE,icon:"compose",size:C.qE.SMALL,disabled:!i||!i.appendable}))}),{throttleUpdates:!0,shouldPropagateNextState:(e,t)=>!Is()(e,t)})
var _2=n(791442)
function RequestAccessLink({resourceId:e}){return d.createElement(th.Z,{onClick:()=>{_2.d(e)
v.ZP.success("Access requested.")}},"Request Access")}var D2=n(659031),L2=n(852375),k2=n(33572),M2=n(4908),F2=n(231708)
class FolderSettingsIcon extends d.Component{constructor(){super(...arguments)
this._handleOpenExportModal=()=>{Ej.Z.openForFolder(this.props.folder)}
this._getRegistrySettingsURL=()=>{const e=this.props.folder.source
return lo.getRegistrySettingsUrl(e.s_owner.url_identifier,e.id)}
this._handleOpenProjectSettings=()=>{(0,S.hu)(null!=this.props.folder.permissions,"Expected project to have permissions");(0,Xn.Z)(BT.M,{permissions:this.props.folder.permissions,sourceId:this.props.folder.source.id,onDelete:this.props.onNavigateToRoot})}
this._handleOpenFolderSettings=()=>{var e,t;(0,Xn.Z)(M2.kH,{folderId:this.props.folder.id,isReadOnly:!(null===(t=null===(e=this.props.folder.permissions)||void 0===e?void 0:e.writable)||void 0===t||t)})}
this._handleOpenCollaborationManangement=()=>{const e=this.props.folder
null==e.parent?(0,Xn.Z)(L2.o,{policeableId:e.source.id,onRequestSubmit:t=>F2.Ii(e.source.id,t).then((()=>{}))}):k2.ZN(e.id)}
this._handleExportAuditLogs=()=>{const e=null!=this.props.folder.parent?this.props.folder.id:this.props.folder.source.id
bc.dV([e])}
this._handleCopyLink=()=>{const e=de.jp(this.props.folder.url);(0,$b.Z)(e,{showToastOnSuccess:!0})}}render(){if(!(null!=Jn.Z.currentUser()))return null
let e
if(lo.isRegistryFolder(this.props.folder)){e=[{name:"Registry settings",handleOnClick:e=>{de.c4(e)},link:this._getRegistrySettingsURL(),dataTestAttrs:{component:"FolderSettingsIcon",element:"registrySettings"}}]
dt.ZP.ENABLE_EXPORTS&&e.push({name:"Export registry",handleOnClick:this._handleOpenExportModal})}else if(this.props.folder.parent){e=[{name:"Folder settings",handleOnClick:this._handleOpenFolderSettings}]
dt.ZP.PERMISSIONS_ENABLE_GRANULAR_FOLDER_PERMISSIONS&&e.push({name:"Manage access",handleOnClick:this._handleOpenCollaborationManangement})
dt.ZP.ENABLE_EXPORTS&&e.push({name:"Export folder",handleOnClick:this._handleOpenExportModal})
e.push({name:Tc.QU,handleOnClick:this._handleExportAuditLogs,dataTestAttrs:{component:"FolderSettingsIcon",element:"exportAuditLogOption"}})
e.push({name:"Copy folder link",handleOnClick:this._handleCopyLink})}else e=l.default.compact([{name:"Project settings",handleOnClick:this._handleOpenProjectSettings,dataTestAttrs:{component:"FolderSettingsIcon",element:"projectSettingOption"}},dt.ZP.PERMISSIONS_ENABLE_NEW_COLLABORATION_UI&&{name:"Manage access",handleOnClick:this._handleOpenCollaborationManangement},dt.ZP.ENABLE_EXPORTS&&{name:"Export project",handleOnClick:this._handleOpenExportModal},{name:Tc.QU,handleOnClick:this._handleExportAuditLogs,dataTestAttrs:{component:"FolderSettingsIcon",element:"exportAuditLogOption"}},{name:"Copy project link",handleOnClick:this._handleCopyLink}])
return d.createElement(SJ.Z,{dropdownClassName:"_test-folder-settings-dropdown",options:[e]})}}const Z2=FolderSettingsIcon
function getFolderCrumbLink(e){var t
function handleClick(){!e.isDisabled&&e.onOpenFolder&&e.onOpenFolder(e.folder,RN.WN((0,D2.m)(e.folder),[{key:Kn.Vm.FOLDER,operator:Kn.EF.IS,value:e.folder.id}]))}const n={icon:e.readable||(null===(t=e.folder.source)||void 0===t?void 0:t.alwaysShowAncestorFolderNames)?void 0:d.createElement(pe.Z,{icon:"lock"}),text:lo.isRegistryFolder(e.folder)?j1.Z.getRegistryName(e.folder.source):e.folder.name}
if(e.showSectionDropdown){(0,S.hu)(Boolean(e.section&&e.onChangeSection),"section and onChangeSection must be defined if showSectionDropdown is enabled")
return d.createElement(Cw.Xi,{...n,onClick:handleClick,key:e.folder.id,section:e.section,onChangeSection:e.onChangeSection})}return d.createElement(Cw.Ak,{...n,onClick:e.isDisabled?null:handleClick,key:e.folder.id})}function maybeAddRequestAccessPopover(e,t,n,a){return n&&!a?d.createElement(Oe.Z,{key:t,renderContent:()=>d.createElement("div",{className:"u-text-align-center u-base-text"},d.createElement("p",null,"You do not have access to open this folder."),d.createElement(RequestAccessLink,{resourceId:t}))},e):e}function PresentationalFolderListingCrumbs(e){var t
const n=[],a=null!=Jn.Z.currentUser()
n.push(d.createElement(Cw.Ak,{key:"root",text:e.sectionName,onClick:a?e.onNavigateToRoot:null}))
const i=e.ancestralFolders.findIndex((e=>!e.currentUserPermissions.readable)),s=e.ancestralFolders[0],r=!(null===(t=s.source)||void 0===t?void 0:t.alwaysShowAncestorFolderNames)&&i>-1?e.ancestralFolders.slice(0,i+1).reverse():e.ancestralFolders.slice().reverse()
for(let t=0;t<r.length;t++){const i=r[t],s=i.currentUserPermissions.readable,o=getFolderCrumbLink({folder:i,searchParams:e.searchParams,isDisabled:!s||!e.activeSavedSearch&&t===r.length-1,showSectionDropdown:e.showSectionDropdown&&0===t,section:e.section,onChangeSection:e.onChangeSection,onOpenFolder:e.onOpenFolder,readable:s})
n.push(maybeAddRequestAccessPopover(o,i.id,a,s))}e.activeSavedSearch&&n.push(d.createElement(Cw.Ak,{key:"savedSearch",text:e.activeSavedSearch.name}))
let o
a&&(o=d.createElement(d.Fragment,null,s?d.createElement(Z2,{folder:s,onNavigateToRoot:e.onNavigateToRoot}):void 0,e.settingsComponents))
return d.createElement(Cw.bJ,{crumbs:n,settingsIcon:o})}const B2=xa.Ps`
  query FolderListingCrumbsQuery($id: StrictString!) @skipAudit @engComponent(name: CORE_OBJECT) {
    folder(id: $id) {
      ... on FolderNode {
        ...FolderWithPermissionsGraphQL
        parentFolders {
          id
          currentUserPermissions {
            readable
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("FolderWithPermissions").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function QueryingFolderListingCrumbs(e){return d.createElement(Da.ZP,{query:B2,variables:{id:e.folderId},renderLoading:()=>d.createElement(kl.Z,null)},(t=>{if((0,ka.CZ)(t.folder))return null
const n=function graphqlFolderToAncestralFolders(e){var t
const n=[],a=e.parentFolders.reduce(((e,t)=>{e.set(t.id,t.currentUserPermissions.readable)
return e}),new Map)
a.set(e.id,e.permissions.readable)
let i=(0,zo.tY)("FolderWithPermissions",e)
for(;null!=i;){const e=(0,s2.Z)(i)
n.push({...e,currentUserPermissions:{readable:null!==(t=a.get(e.id))&&void 0!==t&&t}})
i=i.parent}return n}(t.folder)
return d.createElement(PresentationalFolderListingCrumbs,{...e,ancestralFolders:n})}))}class ProjectsSidepanelListing extends d.Component{constructor(){super(...arguments)
this._handleSearch=e=>{const t=(0,h2.VI)(e)
this.props.onSearch(t)}
this._handleUpdateFilters=e=>{const t={...this.props.searchParams,filters:e},n=(0,h2.VI)(t)
this.props.onUpdateFilters(n.filters)}
this._handleUpdateQueryString=e=>{const t={...this.props.searchParams,query:e},n=(0,h2.VI)(t)
this.props.onUpdateQueryString(n.query)
this.props.onUpdateFilters(n.filters)}
this._getSearchResultsSubtext=()=>this.props.searchParams.filters.some((e=>e.key===Kn.Vm.ANCESTOR_FOLDER&&null!=e.value))?"including items in subfolders":null
this._handleChangeSection=e=>{if(e===NN.$V(this.props.searchParams.filters,Kn.Vm.FOLDER_SECTION))return
if(null==this.props.folder){v.ZP.warn("Please wait until folder is loaded before switching sections.")
return}We.Z.set(Wu.hV.DEFAULT_SECTION,e)
const t=e===Wu.$.INVENTORY?h2.H:h2.wZ,n=c2.Z.sourceToRootFolder(this.props.folder.source),a=(0,h2.pr)(n)
this.props.onOpenFolder(n,RN.WN(a,[t,{...(0,Kn.QW)(Kn.Vm.TYPES),value:(0,h2.Hi)(e)}]))}}render(){const e=NN.xb(this.props.searchParams.filters,Kn.Vm.FOLDER_SECTION);(0,S.Gp)(Boolean(e),"Expected sectionFilter to exist in projects listing")
const t=Wu.$.ALL,n=e?e.value:t,a=(0,h2.Hi)(n)
!function assertAllTypesSupportRequiredFilters(e){const t=[];(0,S.Gp)(e.every((e=>{const n=(0,CJ.eO)(e),a=n.includes(Kn.Vm.ANCESTOR_FOLDER)&&n.includes(Kn.Vm.FOLDER)&&n.includes(Kn.Vm.FOLDER_SECTION)
a||t.push(e)
return a})),`All availableTypes for ProjectsSidepanelListing must support the ANCESTOR_FOLDER, FOLDER, and FOLDER_SECTION filters. Types missing filters: ${t}`)}(a)
return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{actionSource:j.D2.PROJECTS_SIDEPANEL,savedSearchSection:Sn.yd.PROJECT_ITEMS,...l.default.omit(this.props,"folder"),onSearch:this._handleSearch,onUpdateFilters:this._handleUpdateFilters,onUpdateQueryString:this._handleUpdateQueryString,availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],availableTypes:a,sectionTabs:void 0,hideSectionTabsWhenExpanded:!0,makeCrumbs:e=>d.createElement(QueryingFolderListingCrumbs,{folderId:(0,s2.Z)(this.props.folder).id,onNavigateToRoot:this.props.onNavigateToRoot,sectionName:"Projects",showSectionDropdown:!1,section:n,searchParams:this.props.searchParams,onChangeSection:this._handleChangeSection,onOpenFolder:this.props.onOpenFolder,activeSavedSearch:this.props.activeSavedSearch,settingsComponents:e}),additionalHeaderButtons:d.createElement(x2,{dropLeft:this.props.isExpanded,folder:this.props.folder,onOpenFolder:this.props.onOpenFolder}),preservedFilterKeys:h2.Ou,extraPrimaryFilterOptions:[],section:ZP.$0.PROJECT_ITEMS,searchResultsSubtext:this._getSearchResultsSubtext()}))}}const q2=(0,UP.ZP)(ProjectsSidepanelListing,Kn.Sc.FOLDERS_AND_ITEMS,ZP.SA.PROJECT_ITEMS,{getNavigationUpdate:eJ.Lt})
class ProjectsSidepanelConnector extends oi.C{constructor(){super(...arguments)
this.stores=[nz.Z]
this.onListFolder=(e,t)=>{this.dispatch(J1.listFolder(e,t))}
this.onListAllSources=()=>{w_.V5(ZP.$0.PROJECTS)}}enhanceProps(){const e=this.sidepanelStore().getSection()
return{onListFolder:this.onListFolder,onListAllSources:this.onListAllSources,listedFolder:e?this.sidepanelStore().getListedFolder(e):null}}}const V2=ProjectsSidepanelConnector.connect((function ProjectsSidepanel(e){return null==e.listedFolder?d.createElement(T2,{isExpanded:e.isExpanded,onListFolder:e.onListFolder,availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_CREATED_AT_KEY],areProjectsLoading:!1,didLoadingError:!1,items:[]}):d.createElement(q2,{isCompactDisplay:e.isCompactDisplay,setIsCompactDisplay:e.setIsCompactDisplay,isExpanded:e.isExpanded,activeItemId:e.activeItemId,onNavigateToRoot:e.onListAllSources,onOpenFolder:e.onListFolder,folder:e.listedFolder})}),{throttleUpdates:!0,shouldPropagateNextState:(e,t)=>!Is()(e,t)})
var U2=n(74161),G2=n(252394),z2=n(539317),$2=n(336489),W2=n(378045),H2=n(113505),j2=n(661978),Y2=n(749278),Q2=n(939092),K2=n(344991)
function getLabelColumns({inOrgCollection:e,inUserCollection:t,labelingStrategy:n}){return n===tw.LABELING_STRATEGIES.CONVERT_IDS?l.default.compact([t&&IX.BA.MY_COLLECTION_ID,e&&IX.BA.ORG_COLLECTION_ID]):null!=n&&tw.LABELING_STRATEGIES_REQUIRING_NAME.includes(n)?[IX.BA.FILENAME]:[]}class BulkCreateRegistryEntitiesFlow extends d.Component{constructor(){super(...arguments)
this._getPanes=()=>l.default.compact([{paneKey:IX.y$.SET_IMPORT_SETTINGS_FOR_REGISTRY,configuration:null},{paneKey:IX.y$.UPLOAD_SPREADSHEET,configuration:H2.Z.configure({getExampleImageURL({selectedSchemaIds:e}){const t=Q2.My(e)
return Q2.oW(t)}})},{paneKey:IX.y$.MAP_COLUMN_NAMES,configuration:$2.Z.configure({getValidColumnTypes({registryImportSettings:e,options:t,selectedSchemaIds:n}){const a=getLabelColumns(e),i=t[IX.JY.IMPORT_CONTAINERS]?[...IX.V9,IX.BA.NUMBER_OF_CONTAINERS,IX.BA.CONTAINER_SCHEMA_FIELD,...IX.At,...U2.PZ()]:[]
return l.default.compact([...a,...Q2.Oo(Q2.A(n),(0,G2.ij)(Q2.My(n))),...Q2.jD(Q2.Ek(n)),...IX.p5,t[IX.JY.IMPORT_BATCHES]&&IX.BA.BATCH_SCHEMA_FIELD,...i])},getRequiredColumnsError(e,{selectedSchemaIds:t,registryImportSettings:n}){const a=Q2.xR(e,Q2.A(t),(0,G2.ij)(Q2.My(t)))
if(a)return a
const i=l.default.compact(getLabelColumns(n)),s=K2.Js(e,!1)
if(s)return s
const r=Q2.Vp(e,Q2.Ek(t),!0)
return r||Q2.lx(i,e,t,!0)},onValidateSpreadsheet:j2.A1,customHandleGoToNextPaneFn:e=>{if(Q2.IN(e.fileData.columns)){j2.jB()
j2.mX()}else{e.onValidateSpreadsheet()
j2.bm(IX.y$.SHOW_ERRORS)}},savedMappingsConfig:{enableSavedMappings:!0,uploadFlow:Sn.A$.BULK_CREATE_AND_REGISTER_ENTITIES}})},{paneKey:IX.y$.MAP_DERIVED_COLUMNS,configuration:{columnTransformConfigs:IX.MW,derivedColumnsKey:IX.ju.BULK_CREATE,onUpdateDerivedColumns:j2.Xx,onValidateSpreadsheet:j2.A1}},{paneKey:IX.y$.SHOW_ERRORS,configuration:W2.Z.configure({customHandleGoToPrevPaneFn:e=>{e.derivedColumnsData.state===IX.PX.COMPLETED&&e.derivedColumnsData.derivedColumns&&e.derivedColumnsData.derivedColumns.length>0?j2.$s():j2.bm(IX.y$.MAP_COLUMN_NAMES)},enableReplaceLinkWithText:!0,enableSkipErrors:!0})}])}static open(e){Xe.bA(IX.qF,d.createElement(BulkCreateRegistryEntitiesFlow,{...e,onRequestClose:j2.Mr}))}render(){return d.createElement(Y2.Z,{footer:d.createElement(z2.Z,null),importType:IX.pt.REGISTRY_ENTITIES,initialSettings:{initialRegistry:this.props.initialRegistry},onImportFromSpreadsheet:j2.Zv,onRequestClose:this.props.onRequestClose,panes:this._getPanes(),title:"Import entities from spreadsheet"})}}const J2=BulkCreateRegistryEntitiesFlow
const X2=FolderCreateDropdownDataConnector.connect((function RegistryCreateMenu(e){var t
useRefetchTagSchemas(e.tagSchemas,e.fetchStarredTagSchemas)
const n=(null!==(t=e.folder.permissions)&&void 0!==t?t:e.folder.source.permissions)||{},a=["objectsCreatable","objectsRegisterable"],i=(0,O2.V)(e.toggleTagSchemaStar,e.starredSchemaIds,{getId:e=>e.value.id})
function createAndRegisterBioentity(e){(0,Xn.Z)(YF,{createAndRegisterBioentityArgs:{...zF.pk(),tagSchema:e}})}function getTagSchemaOption(t,n,s,r){var o
const l=null===(o=e.tagSchemas)||void 0===o?void 0:o.filter((e=>(s?s(e):e.folderItemType===n)&&a.every((t=>e.permissions[t]))))
if(e.starredSchemaIds&&l&&l.length>0){const a=(0,hs.Z)(l,[t=>e.starredSchemaIds.includes(t.id)?0:1]).map((e=>({icon:e.iconId,name:e.name,value:e})))
return d.createElement(N.Z,{icon:null!=r?r:n,dataTestAttrs:{component:"RegistryCreateMenu",element:"createSchemaMenuItem"}},t,d.createElement(w.ZP,null,a.map((e=>d.createElement(PA.Z,{className:"schema-option",key:e.value.id,onSelect:createAndRegisterBioentity,value:e.value,dataTestAttrs:{component:"RegistryCreateMenu",element:"createSchemaSubMenuItem"}},i(e,!1))))))}return null}const s={width:w.ZP.WIDTHS.MEDIUM,height:w.ZP.HEIGHTS.MEDIUM,dropLeft:e.dropLeft},r=d.createElement(w.ZP,{...s},d.createElement(jI.Z,null,n.appendable&&d.createElement(N.Z,{icon:"table",key:"importEntities",onSelect:function handleOpenBulkCreateRegistryEntitiesFlow(){const t=xR.Z.getSource(e.folder.source.id)
J2.open({initialRegistry:t})},dataTestAttrs:{component:"RegistryMenu",element:"dropdownItem",key:"importEntities"}},"Import entities"),n.writable&&d.createElement(N.Z,{icon:"table",onSelect:function handleOpenBulkUpdateBioentitiesModal(){(0,qG.h9)(e.folder)}},"Update entities"),(0,ln.cr)({feature:on.ed.REGISTRY_MIXTURES})&&n.writable&&d.createElement(N.Z,{icon:"table",onSelect:function handleOpenBulkUpdateMixtureIngredientsModal(){(0,qG.Bt)(e.folder)}},"Import mixture ingredients"),n.writable&&d.createElement(N.Z,{icon:"import",onSelect:function handleOpenBulkReimportSequences(){(0,qG.qv)(e.folder.id)}},"Reimport DNA/RNA sequences"),n.writable&&d.createElement(N.Z,{icon:"import",onSelect:function handleOpenBulkReimportProteins(){(0,qG._q)(e.folder.id)}},"Reimport AA sequences")),n.appendable&&d.createElement(jI.Z,null,getTagSchemaOption("AA sequence",st.PROTEIN),getTagSchemaOption("DNA Sequence",st.SEQUENCE,aw.Zy),getTagSchemaOption("RNA Sequence",st.SEQUENCE,aw.p,"rna-sequence"),getTagSchemaOption("DNA oligo",st.OLIGO,aw.MR),getTagSchemaOption("RNA oligo",st.OLIGO,aw.Gx),getTagSchemaOption("Custom entity",st.BASIC_FOLDER_ITEM),(0,ln.cr)({feature:on.ed.REGISTRY_MIXTURES})&&getTagSchemaOption("Mixture",st.MIXTURE),dt.ZP.CHEMISTRY_ENABLE_MOLECULE&&getTagSchemaOption("Molecule",st.MOLECULE)))
return d.createElement("div",{...(0,ee.Z)({component:"RegistryCreateMenu",element:"dropdown"})},d.createElement(I.ZP,{menu:r},d.createElement("div",null,d.createElement(P.ZP,{title:"Create...",placement:P.TQ.BOTTOM,container:"body"},d.createElement(C.Co,{buttonStyle:e.dropLeft?C.ZJ.SECONDARY:C.ZJ.TERTIARY_BLUE,icon:"compose",size:C.qE.SMALL,text:e.dropLeft?"Create":null})))))}))
function WrappedConnectedRegistryCreateMenu(e){return d.createElement(X2,{...e,onOpenFolder:Jt.ZT})}var e3=n(389752)
const t3=(0,tw.getRegistrySupportedOligoAwareTypes)().filter((e=>(0,DG.Z)(e))),n3=[Kn.Vm.FOLDER,Kn.Vm.FOLDER_SECTION,Kn.Vm.REGISTRY_COLLECTION_OWNER]
class BioentityListingConnector extends oi.C{constructor(e){super(e)
this.uncachedEnhanceProps=()=>({registry:this.currentRegistry()})
this.enhanceProps=(0,e3.Z)(this.uncachedEnhanceProps)}currentRegistry(){return{...this.props.folder.source,rootFolder:this.props.folder}}}const a3=BioentityListingConnector.connect((function BioentityListing(e){const t=e.registry,n={...t.rootFolder,source:t,id:t.rootFolder.api_identifier},a=(0,d.useMemo)((()=>function getSchemasRegistryFilter(e){return t=>{const n={},a=new Set
for(const i of Object.keys(t)){const s=t[i].filter((t=>{var n
return(null===(n=t.registry)||void 0===n?void 0:n.id)===e}))
n[i]=s
s.forEach((e=>a.add(e.id)))}return n}}(t.id)),[t.id]),i=NN.xb(e.searchParams.filters,Kn.Vm.FOLDER)
return i&&e.folder.api_identifier===i.value?d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,actionSource:j.D2.REGISTRY_EXPANDED_SEARCH,savedSearchSection:Sn.yd.REGISTRIES,availableTypes:(0,tw.getRegistrySupportedOligoAwareTypes)().filter((e=>(0,DG.Z)(e))),defaultTypes:t3,makeCrumbs:t=>d.createElement(PresentationalFolderListingCrumbs,{ancestralFolders:[{...n,currentUserPermissions:{readable:!0}}],onNavigateToRoot:e.onNavigateToRoot,onOpenFolder:(t,n)=>{e.onSelectSavedSearch(void 0)
e.onSearch(n)},searchParams:e.searchParams,sectionName:"Registries",activeSavedSearch:e.activeSavedSearch,settingsComponents:t}),additionalHeaderButtons:d.createElement(WrappedConnectedRegistryCreateMenu,{dropLeft:e.isExpanded,folder:n}),extraPrimaryFilterOptions:(0,Jt.oA)([t.disablePersonalCollections?null:{filterKey:Kn.Vm.REGISTRY_COLLECTION_OWNER,extraProps:{registry:t}}]),getSecondaryFilterGroups:e=>[{name:"General",filterOptions:(0,Jt.oA)([{filterKey:Kn.Vm.NAMES},{filterKey:Kn.Vm.CREATED_AT},{filterKey:Kn.Vm.MODIFIED_AT},dt.ZP.ENABLE_ARCHIVING_V2?{filterKey:Kn.Vm.ARCHIVE_PURPOSES,extraProps:{archivePurposes:(0,$u.FH)(ZN.INVENTORY_SECTION)}}:null,{filterKey:Kn.Vm.SCHEMA_FIELD,extraProps:{schemaFields:e?e.fields:[]}},dt.ZP.ENABLE_AUTHORS?null:{filterKey:Kn.Vm.CREATOR},{filterKey:Kn.Vm.PROJECT_FOLDER},{filterKey:Kn.Vm.NOTE_REFERENCE}])},{name:"Entity",filterOptions:(0,Jt.oA)([{filterKey:Kn.Vm.BIOENTITY_LABELS},dt.ZP.ENABLE_AUTHORS?{filterKey:Kn.Vm.AUTHOR}:null,{filterKey:Kn.Vm.CUSTOM_TAG},{filterKey:Kn.Vm.ANNOTATION},{filterKey:Kn.Vm.SEQUENCE_BASES},dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES?{filterKey:Kn.Vm.OLIGO_HELM_DNA}:null,dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES?{filterKey:Kn.Vm.OLIGO_HELM_RNA}:null,dt.ZP.MOLBIO_ENABLE_MODIFIED_NUCLEOTIDES?{filterKey:Kn.Vm.MONOMER}:null,{filterKey:Kn.Vm.PROTEIN_AMINO_ACIDS},(0,ln.cr)({feature:on.ed.REGISTRY_MIXTURES})?{filterKey:Kn.Vm.INGREDIENTS}:null,{filterKey:Kn.Vm.PART_SEQUENCE},dt.ZP.MOLBIO_ENABLE_ALPHAFOLD_GA&&{filterKey:Kn.Vm.ALPHAFOLD_STRUCTURE}])},{name:"Entity Validation",filterOptions:[{filterKey:Kn.Vm.SCHEMA_VALIDATION_STATUS},{filterKey:Kn.Vm.SCHEMA_VALIDATION_ERROR_LABEL},{filterKey:Kn.Vm.REGISTRATION_STATUS}]}],availableSortKeys:[Kn.bo.SORT_REGISTRY_IDENTIFIER_KEY,Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],preservedFilterKeys:n3,section:ZP.$0.REGISTRIES,dataTestAttrs:{component:"BioentityListing",element:"root"},filterSchemas:a})):d.createElement(kl.b,null)}))
class ExpandedRegistryTable_ExpandedProjectTable extends d.Component{constructor(){super(...arguments)
this._handleOpenRegistry=e=>{this.props.openResult(e.extra.rootFolder);(0,f2.P)(e.id)}
this._handleContextMenu=(e,t)=>{l2.Z.open(t,{file:e.extra.result,finderId:this.props.finderId,isListing:!0})}}render(){if(this.props.areRegistriesLoading)return d.createElement("div",null,d.createElement("span",{className:"faded"},"Loading..."))
if(0===this.props.registries.length)return d.createElement("div",null,d.createElement("span",{className:"faded"},"None found."))
const e=this.props.registries.map((e=>({id:e.id,data:{createdAt:Hr.UT(e.createdAt,{showTime:!1}),name:j1.Z.getRegistryName(e),description:e.description},icon:d.createElement(pe.Z,{className:"scrollableTable-cell-icon",icon:st.REGISTRY}),extra:{result:e,rootFolder:c2.Z.sourceToRootFolder(e)}})))
return d.createElement(Xj.Z,{className:this.props.className,columns:[{header:"Name",accessorKey:"name",flexGrow:1,isCollapsible:!1,isSortable:!1},{header:"Created",accessorKey:"createdAt",isCollapsible:!1,isSortable:!1},{header:"Description",accessorKey:"description",flexGrow:1,isCollapsible:!1,isSortable:!1}],isCompact:!1,matchParentHeight:!0,onRowClick:this._handleOpenRegistry,onRowContextMenu:this._handleContextMenu,rows:e})}}const i3=ExpandedRegistryTable_ExpandedProjectTable
function SourceList(e){return e.areSourcesLoading?d.createElement("div",{className:e.className},d.createElement(kl.b,null)):0===e.sources.length?d.createElement("div",{className:e.className},d.createElement("span",{className:"sidepanel-fadedMessage"},"None found.")):d.createElement("div",{className:e.className},e.sources.map(((t,n)=>d.createElement(SourceSidepanelItem,{finderId:e.finderId,key:n,openResult:e.openResult,showCreator:!1,showOwner:!0,showStar:!1,source:t,isChild:!1}))))}class RegistriesListing extends d.Component{constructor(e){super(e)
1===e.registries.length&&this.props.onListSource(c2.Z.sourceToRootFolder(e.registries[0]))}componentDidUpdate(e){this.props.registries.length!==e.registries.length&&1===this.props.registries.length&&this.props.onListSource(c2.Z.sourceToRootFolder(this.props.registries[0]))}render(){const e=d.createElement($Y.Z,{isExpanded:this.props.isExpanded,buttons:d.createElement("div",null,d.createElement(V0.Z,{expanded:this.props.isExpanded})),crumbs:d.createElement(Cw.wn,{text:this.props.sectionName}),showShadow:!1})
return this.props.isExpanded?d.createElement(Db.W2,{className:"sidepanel expandedContainer",size:"lg",dataTestAttrs:{component:"RegistriesListing",element:"root",key:"expanded"}},d.createElement(Db.X2,null,d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21},e)),d.createElement(Db.X2,{fluid:!0},d.createElement(Db.JX,{lg:1}),d.createElement(Db.JX,{lg:21,className:"u-flex-display u-vertical-flex"},d.createElement("div",{className:"u-flex-grow u-flex-display u-justify-content-center u-small-spacing-top"},d.createElement(i3,{className:"u-flex-grow",finderId:ZP.sr,openResult:this.props.onListSource,registries:this.props.registries,areRegistriesLoading:this.props.areRegistriesLoading}))))):d.createElement(Db.W2,{className:"sidepanel",size:"sidepanel",dataTestAttrs:{component:"RegistriesListing",element:"root",key:"collapsed"}},d.createElement(Db.X2,null,e),d.createElement(Db.X2,{fluid:!0,className:"u-position-relative"},d.createElement(SourceList,{className:"u-absolute-scroll-container",finderId:ZP.sr,openResult:this.props.onListSource,sources:this.props.registries,areSourcesLoading:this.props.areRegistriesLoading})))}}function QueryingRegistriesListing(e){var t,n
const a=(0,Da.A4)(tZ.P,{skip:!Jn.Z.currentUser(),renderCachedDataWhenRefetching:!0})
if(a.type===Da.NI.ERROR)return d.createElement(RegistriesListing,{...e,registries:[],areRegistriesLoading:!1})
if(a.type===Da.NI.PENDING)return d.createElement(RegistriesListing,{...e,registries:[],areRegistriesLoading:!0})
if(a.type===Da.NI.SKIPPED)return d.createElement(RegistriesListing,{...e,registries:[],areRegistriesLoading:!1})
{const i=(0,zo.NA)("NavStoreRegistry",null!==(n=null===(t=a.data)||void 0===t?void 0:t.sources.filter((e=>"RegistryNode"===e.__typename)))&&void 0!==n?n:[])
return d.createElement(RegistriesListing,{...e,registries:i,areRegistriesLoading:!1})}}class RegistriesSidepanelConnector extends oi.C{constructor(){super(...arguments)
this.stores=[nz.Z]
this.onListSource=e=>{this.dispatch(J1.listFolder(e))}
this.onListAllSources=()=>{w_.V5(ZP.$0.REGISTRIES)}}enhanceProps(){return{listedFolder:this.sidepanelStore().getListedFolder(ZP.$0.REGISTRIES),onListSource:this.onListSource,onListAllSources:this.onListAllSources}}}const s3=(0,UP.ZP)(a3,Kn.Sc.BIOENTITIES_AND_BATCHES,ZP.$0.REGISTRIES,{getNavigationUpdate:eJ.Lt})
const r3=RegistriesSidepanelConnector.connect((function RegistriesSidepanel(e){return null==e.listedFolder?d.createElement(QueryingRegistriesListing,{isExpanded:e.isExpanded,onListSource:e.onListSource,sectionName:"Registries"}):d.createElement(s3,{isCompactDisplay:e.isCompactDisplay,setIsCompactDisplay:e.setIsCompactDisplay,isExpanded:e.isExpanded,activeItemId:e.activeItemId,onNavigateToRoot:e.onListAllSources,folder:e.listedFolder})}))
function SearchSidepanelCrumbs(e){return e.activeSavedSearch?d.createElement(Cw.bJ,{crumbs:[d.createElement(Cw.Ak,{key:"Search",text:"Search",onClick:()=>{e.onSearch(RN._j(e.searchParams,[],(0,K1.v)().filters))
e.onSelectSavedSearch(void 0)}}),d.createElement(Cw.Ak,{key:"root",text:e.activeSavedSearch.name})],settingsIcon:e.settingsComponents}):d.createElement(Cw.bJ,{crumbs:[d.createElement(Cw.Ak,{key:"root",text:"Search"})],settingsIcon:e.settingsComponents})}const o3=(0,UP.ZP)((function SearchSidepanelListing(e){return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,actionSource:j.D2.SEARCH_SIDEPANEL,savedSearchSection:Sn.yd.GLOBAL,availableTypes:Kn.qi.filter((e=>(0,DG.Z)(e))),makeCrumbs:t=>d.createElement(SearchSidepanelCrumbs,{activeSavedSearch:e.activeSavedSearch,onSelectSavedSearch:e.onSelectSavedSearch,onSearch:e.onSearch,searchParams:e.searchParams,settingsComponents:t}),extraPrimaryFilterOptions:[{filterKey:Kn.Vm.ANCESTOR_FOLDER}],availableSortKeys:[Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_IDENTIFIER_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],preservedFilterKeys:[],section:ZP.$0.SEARCH,dataTestAttrs:{component:"SearchSidepanel",element:"root",key:e.isExpanded?"expanded":"collapsed"}}))}),Kn.Sc.GLOBAL,ZP.SA.SEARCH,{defaultSearchParams:(0,K1.v)(),getNavigationUpdate:function getSearchURL(e,t){return t.isExpanded?{url:(0,eJ.q7)("/search",t.searchParams,t.filterErrors),options:{replace:e.isExpanded===t.isExpanded}}:null}})
var l3=n(229828),c3=n(880759),d3=n(42305),u3=n(765549),m3=n(177157)
class BulkTransferStorablesFlow extends d.Component{static open(){Xe.bA(IX.qF,d.createElement(BulkTransferStorablesFlow,{onRequestClose:j2.Mr}))}_getPanes(){return[{paneKey:IX.y$.UPLOAD_SPREADSHEET,configuration:H2.Z.configure({getExampleImageURL:()=>"/static/img/spreadsheet-import-example-fill-plates.png"})},{paneKey:IX.y$.MAP_COLUMN_NAMES,configuration:$2.Z.configure({getValidColumnTypes:()=>[...IX.Xf,...(0,U2.PZ)(),IX.BA.IGNORE],getRequiredColumnsError(e){const t=K2.s(e,!0),n=K2.ZR(e,!0),a=K2.Js(e,!0)
return t||n||a},onValidateSpreadsheet:j2.C0})},{paneKey:IX.y$.SHOW_ERRORS,configuration:W2.Z.configure({enableReplaceLinkWithText:!0,enableSkipErrors:!0})}]}render(){return d.createElement(Y2.Z,{importItemWord:"container transfer",importType:IX.pt.TRANSFER_STORABLES,onImportFromSpreadsheet:j2.fD,onRequestClose:this.props.onRequestClose,panes:this._getPanes(),title:"Import transfer data"})}}var p3=n(639292),h3=n(111489),g3=n(319168),E3=n(54491),f3=n(545549),S3=n(208713),y3=n(994401)
const b3=function StorableCreateMenu(e){const t=j.D2.INVENTORY_SIDEPANEL_CREATE,n={width:w.ZP.WIDTHS.MEDIUM,height:w.ZP.HEIGHTS.MEDIUM,dropLeft:e.isExpanded},a=e.registry&&e.registry.permissions&&e.registry.permissions.locationsCreatable,i=d.createElement(w.ZP,{...n},d.createElement(jI.Z,null,d.createElement(N.Z,{icon:st.LOCATION},"Location",d.createElement(w.ZP,{dropLeft:n.dropLeft},a&&d.createElement(N.Z,{onSelect:function handleOpenCreateLocation(){S3.Z.open({initialRegistry:e.registry,initialParentStorable:e.listedLocation,actionOrigin:t})}},"Create location"),a&&d.createElement(N.Z,{onSelect:function handleOpenBulkCreateLocations(){u3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Import locations"),d.createElement(N.Z,{onSelect:function handleOpenBulkUpdateLocations(){(0,g3._)({initialRegistry:e.registry,actionOrigin:t})}},"Update locations"))),d.createElement(N.Z,{icon:st.BOX},"Box",d.createElement(w.ZP,{dropLeft:n.dropLeft},d.createElement(N.Z,{onSelect:function handleOpenCreateBox(){f3.Z.open({initialRegistry:e.registry,initialParentStorable:e.listedLocation,actionOrigin:t})}},"Create box"),d.createElement(N.Z,{onSelect:function handleOpenBulkCreateBoxes(){c3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Import boxes"),d.createElement(N.Z,{onSelect:function handleOpenBulkUpdateBoxes(){p3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Update boxes"))),d.createElement(N.Z,{icon:st.PLATE},"Plate",d.createElement(w.ZP,{dropLeft:n.dropLeft},d.createElement(N.Z,{onSelect:function handleOpenCreatePlate(){y3.Z.open({initialRegistry:e.registry,initialParentStorable:e.listedLocation,actionOrigin:t})}},"Create plate"),d.createElement(N.Z,{onSelect:function handleOpenBulkCreatePlates(){m3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Import plates"),d.createElement(N.Z,{onSelect:function handleOpenBulkUpdatePlates(){E3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Update plates"))),d.createElement(N.Z,{icon:st.CONTAINER},"Container",d.createElement(w.ZP,{dropLeft:n.dropLeft},d.createElement(N.Z,{onSelect:function handleOpenCreateContainer(){BU.bA({initialRegistry:e.registry,initialParentStorable:e.listedLocation,actionOrigin:t})}},"Create containers"),d.createElement(N.Z,{onSelect:function handleOpenBulkCreateContainers(){d3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Import containers"),d.createElement(N.Z,{onSelect:function handleOpenBulkUpdateContainers(){h3.Z.open({initialRegistry:e.registry,actionOrigin:t})}},"Update containers")))),e.registry&&d.createElement(N.Z,{icon:st.SAMPLE,onSelect:function handleOpenTransferModal(){var n
!function openTransferModal(e){Xe.bA(TransferModal,d.createElement(TransferModal,{...e,onRequestClose:closeTransferModal}))}({flow:YZ.h0.TRANSFER_GLOBAL,registryId:null===(n=e.registry)||void 0===n?void 0:n.id,actionOrigin:t})}},"Transfer samples"),d.createElement(N.Z,{icon:"tube",onSelect:function handleOpenBulkTransferStorables(){BulkTransferStorablesFlow.open()}},"Import transfer data"))
return d.createElement("div",null,d.createElement(I.ZP,{menu:i},d.createElement("div",null,d.createElement(P.ZP,{title:"Create...",placement:P.TQ.BOTTOM,container:"body"},d.createElement(C.Co,{buttonStyle:e.isExpanded?C.ZJ.SECONDARY:C.ZJ.TERTIARY_BLUE,disabled:!e.registry,icon:"compose",size:C.qE.SMALL,text:e.isExpanded?"Create":null})))))},T3=xa.Ps`
  query StorableCreateMenuQuery($listedLocationId: StrictString!) @skipAudit @engComponent(name: INVENTORY) {
    location(id: $listedLocationId) {
      ... on LocationNode {
        ...LocationSummaryGraphQL
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("LocationSummary").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function QueryingStorableCreateMenu(e){const{listedLocationId:t}=e,n=(0,Da.A4)(T3,{skip:null==t,variables:{listedLocationId:t}})
let a=null
n.type!==Da.NI.SUCCESS||(0,ka.CZ)(n.data.location)||(a=(0,zo.tY)("LocationSummary",n.data.location))
return d.createElement(b3,{listedLocation:a,...e})}function StorableToolbar({isLoading:e,storables:t,selectedIds:n}){return d.createElement("div",{className:"buttonToolbar"},d.createElement(StorableToolbarContents,{actionOrigin:j.D2.INVENTORY_EXPANDED_SEARCH_TOOLBAR,buttonStyle:C.ZJ.TERTIARY_WHITE,isLoading:e,storables:t,selectedIds:n}))}StorableToolbar.propTypes={isLoading:J().bool.isRequired,storables:J().arrayOf(YZ.df),selectedIds:J().array.isRequired}
var v3=n(726456)
class StorableSettingsIcon extends d.Component{constructor(){super(...arguments)
this.handleOpenExportModal=()=>{Ej.Z.open({exportType:rk.TYPE.REGISTRY,registry:this.props.registry})}
this.getRegistrySettingsURL=()=>lo.getRegistrySettingsUrl(this.props.registry.s_owner.url_identifier,this.props.registry.id)
this.handleOpenRegistrySettings=()=>{const e=this.getRegistrySettingsURL();(0,ac.ZP)(e)}
this.handleUnarchive=()=>{IR.iA([this.props.location.id])}
this.handleOpenArchiveModal=()=>{(0,Xn.Z)(Sc.ZP,{items:[this.props.location],onArchive:IR.At})}
this.handleOpenPrintBarcodesModal=()=>{(0,Xn.Z)(AR.ZP,{itemIds:[this.props.location.id]})}}render(){const e=[]
if(this.props.location){const t=this.props.location.permissions
e.push({name:"Open location",handleOnClick:()=>{Rn.Z.openFile(this.props.location.id)}})
t.archivable&&!(0,yc.ZP)(this.props.location)&&e.push({name:"Archive location",handleOnClick:this.handleOpenArchiveModal});(0,yc.ZP)(this.props.location)&&this.props.location.permissions.unarchivable&&e.push({name:"Unarchive location",handleOnClick:this.handleUnarchive});(0,ln.cr)({feature:on.TD.INVENTORY_EXPORT})&&e.push({name:"Print label",handleOnClick:this.handleOpenPrintBarcodesModal})}e.push({name:"Registry settings",handleOnClick:this.handleOpenRegistrySettings,link:this.getRegistrySettingsURL()})
dt.ZP.ENABLE_EXPORTS&&e.push({name:"Export registry",handleOnClick:this.handleOpenExportModal})
return d.createElement(SJ.Z,{options:[e]})}}const C3=StorableSettingsIcon
class StorableListingCrumbsConnector extends oi.C{constructor(){super(...arguments)
this.stores=[WZ.Z]}enhanceProps(){this.props.storableId&&v3.Z.requestFetch(this.props.storableId)
const e=this.storableStore().getStorableSummaryExtras()
if(this.props.storableId&&e.ancestralStorableIdsByStorableId&&e.ancestralStorableIdsByStorableId[this.props.storableId]){const t=e.ancestralStorableIdsByStorableId[this.props.storableId]
return{ancestralStorableIds:t,storableOrInaccessibleInfoById:this.getOrFetchMultipleMaybeInaccessibleRequired(lA.V.STORABLE_SUMMARY,t),permissionsByStorableId:this.getOrFetchMultipleRequired(lA.V.PERMISSIONS_BY_ITEM_ID,[this.props.storableId])}}return{ancestralStorableIds:null,storableOrInaccessibleInfoById:{},permissionsByStorableId:{}}}}function getStorableCrumbLink(e){return d.createElement(Cw.Ak,{key:e.storable.id,text:e.storable.name,onClick:function handleClick(){e.onNavigateToStorable(NN.sg(e.searchParams.filters,{key:Kn.Vm.PARENT_STORABLE,operator:Kn.EF.IS,value:e.storable.id}))}})}const I3=StorableListingCrumbsConnector.connect((function StorableListingCrumbs(e){if(null!=e.storableId&&!e.ancestralStorableIds)return d.createElement(kl.Z,null)
const t=[d.createElement(Cw.Ak,{key:"root",text:"Inventory",onClick:e.onNavigateToRoot})]
e.registry&&t.push(d.createElement(Cw.Ak,{key:"registry",text:j1.Z.getRegistryName(e.registry),onClick:e.onNavigateToRegistry}))
if(e.storableId){(0,S.hu)(Boolean(e.ancestralStorableIds),"Expected ancestralStorableIds to be fetched")
for(const n of e.ancestralStorableIds.slice().reverse()){const a=e.storableOrInaccessibleInfoById[n]
if(!(0,kN.Eh)(a)){const n=a
t.push(getStorableCrumbLink({storable:n,onNavigateToStorable:e.onNavigateToStorable,searchParams:e.searchParams}))}}}e.activeSavedSearch&&t.push(d.createElement(Cw.Ak,{key:"savedSearch",text:e.activeSavedSearch.name}))
const n=e.storableId&&!(0,kN.Eh)(e.storableOrInaccessibleInfoById[e.storableId])?{...e.storableOrInaccessibleInfoById[e.storableId],permissions:e.permissionsByStorableId[e.storableId]}:null
return d.createElement(Cw.bJ,{crumbs:t,settingsIcon:d.createElement(d.Fragment,null,d.createElement(C3,{registry:e.registry,location:n}),e.settingsComponents)})}))
var w3=n(681002)
function renderStorableToolbar(e,t){return d.createElement(StorableToolbar,{isLoading:null==e,storables:e,selectedIds:t})}const N3=(0,UP.ZP)((function StorablesListing(e){const _handleChangeFilters=t=>{const n={...e.searchParams,filters:t}
e.onUpdateFilters((0,w3.kJ)(n).filters)},t=(0,d.useMemo)((()=>function StorablesListing_getSchemasRegistryFilter(e){return t=>{const n={}
for(const a of Object.keys(t)){const i=t[a]
n[a]=i.filter((t=>{var n
return(null===(n=t.registry)||void 0===n?void 0:n.id)===e}))}return n}}(e.registry.id)),[e.registry.id]),n=(0,w3.P1)(e.searchParams.filters)
return d.createElement("div",{className:"sidepanel"},d.createElement(BP.ZP,{...e,onSearch:t=>{const n=(0,w3.kJ)(t)
e.onSearch(n)
qP.WN(ZP.$0.STORAGE,n.sorts)},onUpdateQueryString:t=>{const n={...e.searchParams,query:t},a=(0,w3.kJ)(n)
e.onUpdateQueryString(a.query)
e.onUpdateFilters(a.filters)},onUpdateFilters:_handleChangeFilters,actionSource:j.D2.INVENTORY_EXPANDED_SEARCH_TABLE,savedSearchSection:Sn.yd.STORAGE,availableTypes:[st.CONTAINER,st.BOX,st.PLATE,st.LOCATION],defaultTypes:w3.E5.value,makeCrumbs:t=>d.createElement(I3,{registry:e.registry,onNavigateToRegistry:()=>{e.onListRegistryFolder(c2.Z.sourceToRootFolder(e.registry))},onNavigateToRoot:e.onNavigateToRoot,onNavigateToStorable:_handleChangeFilters,searchParams:e.searchParams,storableId:n,activeSavedSearch:e.activeSavedSearch,settingsComponents:t}),additionalHeaderButtons:d.createElement(QueryingStorableCreateMenu,{registry:e.registry,isExpanded:e.isExpanded,listedLocationId:n}),extraPrimaryFilterOptions:[{filterKey:Kn.Vm.BARCODES}],getSecondaryFilterGroups:e=>[{name:"Container",filterOptions:[{filterKey:Kn.Vm.NAMES},{filterKey:Kn.Vm.CREATED_AT},{filterKey:Kn.Vm.MODIFIED_AT},{filterKey:Kn.Vm.CREATOR},{filterKey:Kn.Vm.SCHEMA_FIELD,extraProps:{schemaFields:e?e.fields:[]}},{filterKey:Kn.Vm.CONTAINER_QUANTITY},...(0,l3.e)(),{filterKey:Kn.Vm.STARRED},{filterKey:Kn.Vm.ARCHIVE_PURPOSES,extraProps:{archivePurposes:(0,$u.FH)(Wu.$.INVENTORY)}},{filterKey:Kn.Vm.SAMPLE_RESTRICTION_ACCESS},{filterKey:Kn.Vm.SAMPLE_RESTRICTION_STATUS},{filterKey:Kn.Vm.SAMPLE_AUTHORIZED_USERS},{filterKey:Kn.Vm.SAMPLE_OWNERS}]},{name:"Container contents",filterOptions:[{filterKey:Kn.Vm.CONTAINER_CONTENTS},{filterKey:Kn.Vm.CONTAINER_CONTENT_SCHEMA}]},{name:"Box",filterOptions:[{filterKey:Kn.Vm.GRID_EMPTY_CONTAINERS},{filterKey:Kn.Vm.GRID_EMPTY_POSITIONS}]},{name:"Check-out",filterOptions:[{filterKey:Kn.Vm.CONTAINER_CHECK_OUT_STATUS},{filterKey:Kn.Vm.CONTAINER_CHECK_OUT_ASSIGNEE}]},...dt.ZP.INVENTORY_ENABLE_LOCATION_CAPACITY?[{name:"Location validation",filterOptions:[{filterKey:Kn.Vm.INVENTORY_VALIDATION_STATUS},{filterKey:Kn.Vm.INVENTORY_VALIDATION_ERROR_LABEL}]}]:[]],availableSortKeys:[Kn.bo.SORT_BARCODE_KEY,Kn.bo.SORT_NAME_KEY,Kn.bo.SORT_MODIFIED_AT_KEY,Kn.bo.SORT_CREATED_AT_KEY],preservedFilterKeys:w3.Ou,section:ZP.$0.STORAGE,dataTestAttrs:{component:"StorablesListing",element:"root"},renderToolbar:renderStorableToolbar,filterSchemas:t}))}),Kn.Sc.STORABLE,ZP.$0.STORAGE,{getNavigationUpdate:function getStorablesURL(e,t){return t.isExpanded?{url:eJ.q7("/storage",t.searchParams,t.filterErrors)}:null}}),A3=xa.Ps`
  query StorablesSidepanelQuery($registryId: StrictString!) @skipAudit @engComponent(name: SIGHTGLASS) {
    registry(id: $registryId) {
      ... on RegistryNode {
        ...NavStoreRegistryGraphQL
      }
      ... on InaccessibleInfoNode {
        ...InaccessibleInfoGraphQL
      }
    }
  }
  ${(0,La.f)("NavStoreRegistry").fragment}
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class StorablesSidepanelConnector extends oi.C{constructor(){super(...arguments)
this.stores=[nz.Z]
this._handleListRegistryFolder=e=>{const t={...e.source,rootFolder:e}
w_.p(t.id)
this.dispatch(J1.openListing(ZP.$0.STORAGE,(0,w3.Ib)(t.id)))}
this._handleListAllSources=()=>{w_.p(null)}}enhanceProps(){return{registryId:this.sidepanelStore().getStorablesSidepanelRegistryId(),onListRegistryFolder:this._handleListRegistryFolder,onListAllSources:this._handleListAllSources}}}const R3=StorablesSidepanelConnector.connect((function StorablesSidepanel(e){const t=(0,Da.A4)(A3,{variables:{registryId:e.registryId},skip:null==e.registryId})
if(null==e.registryId)return d.createElement(QueryingRegistriesListing,{isExpanded:e.isExpanded,onListSource:e.onListRegistryFolder,sectionName:"Inventory"})
if(t.type===Da.NI.ERROR){v.ZP.error("Could not load registry details; try reloading the page.")
return null}if(t.type===Da.NI.PENDING)return d.createElement("div",{className:"sidepanel"},d.createElement(kl.b,null))
const n=t.data.registry
if((0,ka.CZ)(n)){v.ZP.error("You do not have permission to access this registry")
return d.createElement(d.Fragment,null)}return d.createElement(N3,{activeItemId:e.activeItemId,isCompactDisplay:e.isCompactDisplay,setIsCompactDisplay:e.setIsCompactDisplay,isExpanded:e.isExpanded,onListRegistryFolder:e.onListRegistryFolder,onNavigateToRoot:e.onListAllSources,registry:(0,zo.tY)("NavStoreRegistry",n)})}))
var P3=n(392911)
function InventorySettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Inventory Settings"),d.createElement(FT.Z,{active:e.section===Nz.Section.TENANT_LEVEL_INVENTORY_SETTINGS,icon:d.createElement(MT.Z,null),name:"General",link:(0,OK.gc)()}),d.createElement(FT.Z,{active:e.section===Nz.Section.TENANT_LEVEL_LABEL_PRINTING_SETTINGS,icon:d.createElement(pe.Z,{className:"result-icon",icon:"format-print"}),name:"Label printing",link:(0,P3.qe)()}))}function MonomerSettings({section:e}){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Monomer Settings"),d.createElement(FT.Z,{active:e===Nz.Section.MONOMERS,icon:d.createElement(pe.Z,{className:"result-icon",icon:"monomer"}),name:"Monomer library",link:_K.HL}))}class NotebookSettings extends d.Component{constructor(){super(...arguments)
this.breadcrumbTemplateCollection=()=>{switch(this.props.section){case Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE:return null!=this.props.template?this.props.template.templateCollection:void 0
case Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE_COLLECTION:return this.props.templateCollection
default:return null}}}render(){const e=this.breadcrumbTemplateCollection()
return d.createElement("div",{className:"u-spacing-top"},d.createElement("div",{className:"browser-nav-header"},"Lab Notebook Settings"),d.createElement(FT.Z,{active:this.props.section===Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE_COLLECTIONS,icon:d.createElement(pe.Z,{className:"result-icon",icon:st.TEMPLATE_COLLECTION}),name:"Template collections",link:HW.Z.collectionsURL()}),null!=e?d.createElement(FT.Z,{active:this.props.section===Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE_COLLECTION,icon:d.createElement(MT.Z,null),name:e.name,link:this.breadcrumbTemplateCollection().url}):void 0,(0,LK.yR)()?d.createElement(FT.Z,{active:this.props.section===Nz.Section.REVIEW_LIFECYCLES,icon:d.createElement(MT.Z,null),name:"Entry review processes",link:DK.Fj()}):void 0)}}const O3=NotebookSettings
function PolicySettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Permissions Settings"),d.createElement(FT.Z,{active:e.section===Nz.Section.DATA_POLICIES,icon:d.createElement(MT.Z,null),name:dt.ZP.PERMISSIONS_ENABLE_SCHEMA_POLICY_CONFIGURATION?"General access policies":"Access policies",link:AK.z8()}),dt.ZP.PERMISSIONS_ENABLE_SCHEMA_POLICY_CONFIGURATION&&d.createElement(FT.Z,{active:e.section===Nz.Section.SCHEMA_POLICIES,icon:d.createElement(MT.Z,null),name:"Schema access policies",link:AK.N0()}))}function ProcessSchemaSettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Workflow Schemas"),d.createElement(FT.Z,{active:e.section===Nz.Section.PROCESS_SCHEMAS,icon:d.createElement(MT.Z,null),name:"Task schemas",link:kK.Lv()}))}var x3=n(559945),_3=n(837127)
function RequestSchemaSettings({section:e}){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Request Schemas"),d.createElement(FT.Z,{active:e===Nz.Section.REQUEST_SCHEMAS,icon:d.createElement(MT.Z,null),name:"Request schemas",link:MK.VO(OZ.aJ.ASSAY_REQUEST)}),d.createElement(FT.Z,{active:e===Nz.Section.REQUEST_TASK_SCHEMAS,icon:d.createElement(MT.Z,null),name:"Task schemas",link:_3.k4()}))}function ResultSchemaSettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},$Z.Z5),d.createElement(FT.Z,{active:e.section===OZ.j_[OZ.aJ.ASSAY_RESULT],icon:d.createElement(MT.Z,null),name:`${$Z.D6.Result} schemas`,link:MK.VO(OZ.aJ.ASSAY_RESULT)}))}var D3=n(908318),L3=n(22422)
function RunSchemaSettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Automation Schemas"),(0,ln.Oj)({feature:on.d$.LAB_AUTOMATION_ADMIN})&&d.createElement(d.Fragment,null,d.createElement(FT.Z,{active:e.section===Nz.Section.CONNECTION_SCHEMAS,icon:d.createElement(MT.Z,null),name:"Connection schemas",link:(0,D3.j1)(),dataTestAttrsKey:"connectionSchemaList"}),d.createElement(FT.Z,{active:e.section===Nz.Section.INSTRUMENT_GATEWAYS,icon:d.createElement(MT.Z,null),name:"Instrument gateways",link:(0,L3.$K)(),dataTestAttrsKey:"instrumentGatewayList"})),d.createElement(FT.Z,{active:e.section===OZ.j_[OZ.aJ.ASSAY_RUN],icon:d.createElement(MT.Z,null),name:`${$Z.D6.Run} schemas`,link:MK.VO(OZ.aJ.ASSAY_RUN),dataTestAttrsKey:"runSchemaList"}))}function SchemaInterfaceSettings({section:e}){return d.createElement("div",{...(0,ee.Z)({component:"SchemaInterfaceSettings",element:"sidebar"})},d.createElement("div",{className:"browser-nav-header"},"Schema Interfaces"),d.createElement(FT.Z,{active:e===Nz.Section.SCHEMA_INTERFACE_SETTINGS,icon:d.createElement(MT.Z,null),name:"Schema interfaces",link:(0,FK.cV)(),dataTestAttrsKey:"schemaInterfaces"}))}function StudySchemaSettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Study Schemas"),d.createElement(FT.Z,{active:e.section===Nz.Section.STUDY_SCHEMAS,icon:d.createElement(MT.Z,null),name:"Study schemas",link:(0,ZK.$_)()}))}var k3=n(221109)
function ToolsSettings(e){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Tools"),d.createElement(FT.Z,{active:e.section===Nz.Section.CONFIG_MIGRATION,icon:d.createElement(MT.Z,null),name:"Configuration migration",link:k3.aN()}))}function UnitDictionarySettings({section:e}){return d.createElement("div",null,d.createElement("div",{className:"browser-nav-header"},"Unit Dictionary"),d.createElement(FT.Z,{active:e===Nz.Section.UNIT_DICTIONARY,icon:d.createElement(pe.Z,{className:"result-icon",icon:"ruler"}),name:"Unit Dictionary",link:BK.OF}))}const handleCollapseButtonClick=()=>{const e=nz.Z.getExpansionState()
switch(e){case ZP.KE.COLLAPSED:w_.Cv()
break
case ZP.KE.SEMI_EXPANDED:w_.wo()
break
default:throw new Error(`Unexpected SidepanelExpansionState ${e}`)}}
function SidepanelCollapseButton(e){return d.createElement(C.Co,{className:(0,g.iv)(M3.collapseButton),buttonStyle:C.ZJ.TERTIARY_WHITE,icon:e.expansionState===ZP.KE.COLLAPSED?"chevron-right":"chevron-left",size:C.qE.SMALL,onClick:handleCollapseButtonClick})}function SettingsSidepanelHeader(e){return d.createElement($Y.Z,{buttons:d.createElement("div",{className:"u-mini-spacing-right"},d.createElement(SidepanelCollapseButton,{expansionState:e.expansionState})),crumbs:e.expansionState===ZP.KE.COLLAPSED?void 0:d.createElement(Cw.wn,{text:"Settings"}),isExpanded:!1})}function SettingsSidepanelBody(e){return d.createElement(Db.X2,{fluid:!0,className:"u-position-relative"},d.createElement(Db.JX,{sm:6,className:"u-absolute-scroll-container u-overflow-x-hidden"},d.createElement("div",{className:"u-spacing-top u-spacing-bottom",...(0,ee.Z)({component:"SettingsSidepanel",element:"root"})},((0,ln.cr)({feature:on.ed.REGISTRY_ADMIN})||(0,ln.cr)({feature:on.TD.INVENTORY_ADMIN}))&&d.createElement("div",{className:"u-spacing-top"},d.createElement(x3.ZP,{activeRegistryId:e.activeRegistryId,section:e.section})),dt.ZP.SCHEMAS_ENABLE_INTERFACES&&d.createElement("div",{className:"u-spacing-top"},d.createElement(SchemaInterfaceSettings,{section:e.section})),(0,ln.cr)({feature:on.TD.INVENTORY_ADMIN})&&d.createElement("div",{className:"u-spacing-top"},d.createElement(InventorySettings,{section:e.section})),dt.ZP.UNITS_ENABLE_UNIT_DICTIONARY&&d.createElement("div",{className:"u-spacing-top"},d.createElement(UnitDictionarySettings,{section:e.section})),(0,vn.cR)()&&d.createElement("div",{className:"u-spacing-top"},d.createElement(MonomerSettings,{section:e.section})),d.createElement(O3,{section:e.section,template:e.template,templateCollection:e.templateCollection}),dt.ZP.STUDIES_ENABLE&&d.createElement("div",{className:"u-spacing-top"},d.createElement(StudySchemaSettings,{section:e.section})),(0,ln.or)([{feature:on.d$.LAB_AUTOMATION_ADMIN}])&&d.createElement("div",{className:"u-spacing-top"},d.createElement(RunSchemaSettings,{section:e.section})),(0,ln.cr)({feature:on.gm.RESULTS_ADMIN})&&d.createElement("div",{className:"u-spacing-top"},d.createElement(ResultSchemaSettings,{section:e.section})),dt.ZP.ENABLE_REQUESTS&&d.createElement("div",{className:"u-spacing-top"},d.createElement(RequestSchemaSettings,{section:e.section})),(0,ln.cr)({feature:on.gx.PROCESSES_ADMIN})&&d.createElement("div",{className:"u-spacing-top"},d.createElement(ProcessSchemaSettings,{section:e.section})),dt.ZP.ENABLE_POLICY_UI&&d.createElement("div",{className:"u-spacing-top",...(0,ee.Z)({component:"PolicySettings",element:"root"})},d.createElement(PolicySettings,{section:e.section})),function isToolsSectionEnabled(){return dt.ZP.MIGRATION_ENABLE_CONFIG_MIGRATION}()&&d.createElement("div",{className:"u-spacing-top"},d.createElement(ToolsSettings,{section:e.section})),shouldShowDeveloperConsole(e.currentUser.isTenantAdmin)&&d.createElement("div",{className:"u-spacing-top"},d.createElement(DeveloperConsoleSettings,{section:e.section})))))}function SettingsSidepanel(e){return d.createElement(Db.W2,{className:f()("sidepanel",{[(0,g.iv)(M3.collapsedSidepanel)]:e.expansionState===ZP.KE.COLLAPSED}),size:"sidepanel"},d.createElement(Db.X2,null,d.createElement(SettingsSidepanelHeader,{expansionState:e.expansionState})),e.expansionState===ZP.KE.SEMI_EXPANDED&&d.createElement(SettingsSidepanelBody,{...e,currentUser:Jn.Z.currentUser()}))}const M3=g.mM.create({collapsedSidepanel:{width:"60px"},collapseButton:{":focus":{boxShadow:"none"}}})
var F3=n(385659)
const Z3={[ZP.KE.CLOSED]:"closed",[ZP.KE.COLLAPSED]:"collapsed",[ZP.KE.SEMI_EXPANDED]:"semi-expanded",[ZP.KE.FULLY_EXPANDED]:"fully-expanded"}
function convertExpansionStateToCssClass(e){return`expansion-state--${Z3[e]}`}class SidepanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!0
this.stores=[gX.Z,nz.Z,hJ.Z,gJ.Z,EJ.Z,jA.Z]}enhanceProps(){return{activeRegistryId:this.registryStore().getActiveRegistryId(),isExpanded:this.sidepanelStore().getIsExpanded(),isOpen:this.sidepanelStore().getIsOpen(),expansionState:this.sidepanelStore().getExpansionState(),section:this.sidepanelStore().getSection(),tfiSearch:{query:this.tfiStore().getQuery(),isActive:this.tfiStore().getSearchActive(),tfiData:this.tfiStore().getTFIData()},templateCollection:this.templateStore().getCollection(),template:this.templateStore().getTemplate(),subtemplate:this.subtemplateStore().getSubtemplate(),tfi:{listedFolder:this.tfiStore().getListedFolder(),accounts:this.tfiStore().getAccounts(),showTFIAddModal:this.tfiStore().getShowTFIAddModal()},workspace:this.workspaceStore().getState(),worklistSidepanelState:new s1.T(this.reduxState()).getSidepanelState()}}}class Sidepanel_Sidepanel extends d.Component{static init(){const e=o()(".sidepanel-mount");(0,Me.A9)(d.createElement(QueryingSidepanel,{renderExpansionChange:(t,n,a)=>{!function setSidepanelExpansionStateClassName(e,t){Object.values(ZP.KE).forEach((t=>{e.removeClass(convertExpansionStateToCssClass(t))}))
e.addClass(convertExpansionStateToCssClass(t))}(e,t);(0,He.Z)(e,{component:"Sidepanel",element:"root",key:t===ZP.KE.FULLY_EXPANDED?"expanded":"collapsed"})
!function callbackOnTransitionEnd(e,t,n){let a=!1
const run=()=>{if(!a){a=!0
e.off(".sidepaneltransition")
t()}}
e.one("transitionend.sidepaneltransition",run)
setTimeout(run,n)}(e,n,a)}}),e[0])}constructor(e){super(e)
this._setIsCompactDisplay=e=>{this.setState({isCompactDisplay:e})
We.Z.set(ZP.CL.SIDEPANEL_IS_DISPLAY_COMPACT,e)}
this.render=()=>{if(showValueMessagingForSharedFile())return d.createElement(SharedFileSidepanel,null)
switch(this.props.section){case ZP.$0.ANALYTICS:return d.createElement(lJ,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.HOME:return d.createElement(i2,{isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.JELLYFISH:return d.createElement(tJ,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.PROJECTS:case ZP.$0.PROJECT_ITEMS:return d.createElement(V2,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,projects:this.props.projects,activeItemId:this.props.workspace.activeId,areProjectsLoading:this.props.areSourcesLoading})
case ZP.$0.PROCESSES:return d.createElement(hX,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.REGISTRIES:return d.createElement(r3,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.STORAGE:return d.createElement(R3,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.REQUESTS:return d.createElement(EX.ZP,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.TFI:case ZP.$0.BENCHLING_APPS:case ZP.$0.CONNECTIONS:return d.createElement(ConnectionsSidepanel,{activeSection:this.props.section,tfi:{...this.props.tfi,search:this.props.tfiSearch},isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case dt.ZP.STUDIES_ENABLE&&ZP.$0.STUDIES:return d.createElement(SX,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.SEARCH:return d.createElement(o3,{isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,isExpanded:this.props.isExpanded,activeItemId:this.props.workspace.activeId})
case ZP.$0.WORKFLOWS:return d.createElement(i1,{isExpanded:this.props.isExpanded})
case dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&ZP.$0.WORKLISTS:return d.createElement(y1,{isExpanded:this.props.isExpanded,isExpanding:this.state.isExpanding,isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,onOpenWorklist:b1.vS})
case dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&ZP.$0.WORKLIST_ITEMS:return d.createElement(r1.ZP,{activeItemId:this.props.workspace.activeId,isExpanded:this.props.isExpanded,isExpanding:this.state.isExpanding,isCompactDisplay:this.state.isCompactDisplay,setIsCompactDisplay:this._setIsCompactDisplay,clearSelectedWorklist:b1.Sl,selectedWorklistId:this.props.worklistSidepanelState.selectedWorklistId})
case Nz.Section.REGISTRY_SETTINGS_BOX_SCHEMAS:case Nz.Section.REGISTRY_SETTINGS_CONTAINER_SCHEMAS:case Nz.Section.REGISTRY_SETTINGS_GENERAL:case Nz.Section.REGISTRY_SETTINGS_LABEL_PRINTING:case Nz.Section.REGISTRY_SETTINGS_LOCATION_SCHEMAS:case Nz.Section.REGISTRY_SETTINGS_PLATE_SCHEMAS:case Nz.Section.REGISTRY_SETTINGS_SCHEMAS:case Nz.Section.REGISTRY_SETTINGS_SELECTORS:case Nz.Section.SCHEMA_INTERFACE_SETTINGS:case Nz.Section.TAG_SCHEMA_SETTINGS:case Nz.Section.TENANT_LEVEL_LABEL_PRINTING_SETTINGS:case Nz.Section.TENANT_LEVEL_INVENTORY_SETTINGS:case Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE:case Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE_COLLECTION:case Nz.Section.NOTEBOOK_SETTINGS_TEMPLATE_COLLECTIONS:case Nz.Section.REQUEST_SCHEMAS:case Nz.Section.REQUEST_TASK_SCHEMAS:case Nz.Section.ASSAY_RESULT_SCHEMAS:case Nz.Section.CONNECTION_SCHEMAS:case Nz.Section.INSTRUMENT_GATEWAYS:case Nz.Section.PROCESS_SCHEMAS:case Nz.Section.DATA_POLICIES:case Nz.Section.SCHEMA_POLICIES:case Nz.Section.BENCHLING_APPS_SETTINGS:case Nz.Section.EVENT_SUBSCRIPTIONS:case Nz.Section.BENCHLING_APP_CANVAS_BUILDER:case Nz.Section.CONFIG_MIGRATION:case Nz.Section.ASSAY_RUN_SCHEMAS:case Nz.Section.MONOMERS:case Nz.Section.REVIEW_LIFECYCLES:case Nz.Section.STUDY_SCHEMAS:case Nz.Section.UNIT_DICTIONARY:return d.createElement(SettingsSidepanel,{activeRegistryId:this.props.activeRegistryId,expansionState:this.props.expansionState,section:this.props.section,template:this.props.template||this.props.subtemplate,templateCollection:this.props.templateCollection})
default:return null}}
this.state={isExpanding:!1,isCompactDisplay:(0,_G.q)()}}componentDidMount(){this._renderExpansionChangeAndTrack(this.props.expansionState)}componentDidUpdate(e){this.props.expansionState!==e.expansionState&&this._renderExpansionChangeAndTrack(this.props.expansionState)
this.props.isExpanded&&this._setWindowTitle()
!e.isOpen&&this.props.isOpen&&Jn.Z.currentUser()&&this.props.refetchSources()
e.isOpen!==this.props.isOpen&&l.default.delay((()=>o()(window).trigger("buffersResize")),yX.bQ)}_renderExpansionChangeAndTrack(e){this.setState({isExpanding:!0},(()=>{this.props.renderExpansionChange(e,(()=>{this.setState({isExpanding:!1})}),500)}))}_setWindowTitle(){switch(this.props.section){case ZP.$0.ANALYTICS:de._w(nJ.c)
break
case ZP.$0.BENCHLING_APPS:de._w("Apps")
break
case ZP.$0.CONNECTIONS:de._w("Connections")
break
case ZP.$0.STORAGE:de._w("Inventory")
break
case ZP.$0.REQUESTS:de._w("Requests")
break
case ZP.$0.PROJECTS:case ZP.$0.PROJECT_ITEMS:de._w("Projects")
break
case ZP.$0.PROCESSES:de._w("Workflows")
break
case ZP.$0.REGISTRIES:de._w("Registries")
break
case ZP.$0.SEARCH:de._w("Search")
break
case ZP.$0.STUDIES:de._w("Studies")}}}const B3=SidepanelConnector.connect(Sidepanel_Sidepanel,{throttleUpdates:!0,shouldPropagateNextState:(e,t)=>!Is()(e,t)})
function adaptGraphQLSourcesToProps(e){if(l.default.isEmpty(e))return{projects:[]}
const t=e.sources
return{projects:(0,zo.NA)("NavStoreProject",t.flatMap((e=>"ProjectNode"===e.__typename?[e]:[])))}}function QueryingSidepanel(e){return d.createElement(Da.F,{query:F3.h},(()=>d.createElement(Da.F,{query:F3.G},(()=>d.createElement(Da.F,{query:tZ.P,skip:!0},(({data:t,refetch:n,loading:a})=>d.createElement(B3,{...e,...adaptGraphQLSourcesToProps(t),refetchSources:n,areSourcesLoading:a})))))))}var q3=n(805208),V3=n(788927)
function EditNowButton(){return d.createElement(P.ZP,{title:"Ready to edit? Just sign in or create an account.",placement:P.TQ.BOTTOM},d.createElement(C.Co,{className:(0,g.iv)(U3.shareLinkEditButton),size:C.qE.SMALL,buttonStyle:C.ZJ.SECONDARY,onClick:()=>{m.j("benchling","initiated_signup",{signup_source:"signed out view",source_component:"EditNowButton"})
window.location.href=(0,de.Dv)("/signup",{shareIdToClone:(0,V3.vV)(),next:window.location.href})}},"Edit now"))}const U3=g.mM.create({shareLinkEditButton:{margin:"5px 10px 5px 5px"}})
var G3
!function(e){e.CLOSE_SELF="CLOSE_SELF"
e.CLOSE_ALL="CLOSE_ALL"
e.CLOSE_OTHERS="CLOSE_OTHERS"
e.CLOSE_RIGHT="CLOSE_RIGHT"}(G3||(G3={}))
class WorkspaceItemTab extends d.Component{constructor(){super(...arguments)
this.state={isCloseButtonVisible:!1}
this.tabRef=d.createRef()
this._handleContextMenu=e=>{const t=[{name:"Close",click:()=>{this.props.onClearWorkspace&&this.props.onClearWorkspace(G3.CLOSE_SELF,this.props.item.fileId)}},{name:"Close Other Tabs",click:()=>{this.props.onClearWorkspace&&this.props.onClearWorkspace(G3.CLOSE_OTHERS,this.props.item.fileId)},disabled:0===this.props.index&&this.props.isLastTab},{name:"Close Tabs to the Right",click:()=>{this.props.onClearWorkspace&&this.props.onClearWorkspace(G3.CLOSE_RIGHT,this.props.item.fileId)},disabled:this.props.isLastTab},"-",{name:"Move to New Browser Tab",click:()=>{this._handleOpenNewBrowserTab()}}]
ta.e.open(e.nativeEvent,t,!0)}
this._handleOpenNewBrowserTab=()=>{this.props.openFile&&this.props.openFile(this.props.item.fileId,{onOpen:e=>{e&&window.open(e.editURL(),"_blank")
this._handleCloseSelf()}})}
this._handleCloseSelf=()=>{this.props.onClearWorkspace&&this.props.onClearWorkspace(G3.CLOSE_SELF,this.props.item.fileId)}
this._handleCloseMouseDown=e=>{e.stopPropagation()}
this._handleMouseEnter=()=>{this.setState({isCloseButtonVisible:!0})}
this._handleMouseMove=()=>{this.setState({isCloseButtonVisible:!0})}
this._handleMouseLeave=()=>{this.setState({isCloseButtonVisible:!1})}
this._handleMouseDown=e=>{if(mr.Dt(e))this._handleCloseSelf()
else if(de.Gn(e)){const{index:t,onDragStart:n}=this.props
if(!(0,S.Gp)(null!=t,"Cannot start dragging on a dragged tab."))return
const a=this.tabRef.current.getBoundingClientRect()
n&&null!=t&&n(e,t,a.width)}}}_renderIcon(e){return(0,KA.gO)(e.schemaValidationState)?d.createElement(pe.Z,{icon:Sn.CT.REJECTED,className:"u-danger-color"}):d.createElement(pe.Z,{icon:j1.Z.getFileIconName(e,"fileId")})}render(){const{dragLayoutParams:e,forceMinWidth:t,isActive:n,item:a,isInvisible:i,isOverflowTab:s}=this.props,r=null!=e
let o={}
r&&(o={transform:`translateX(${e.translateX}px)`,width:e.width})
return d.createElement(P.ZP,{container:"body",placement:s?P.TQ.LEFT:P.TQ.BOTTOM,title:$u.H3({...a,id:a.fileId}),disabled:i||r,delay:{show:250}},d.createElement("div",{className:f()("workspace-itemTab",{"is-active":n,"is-dragging":r,"is-invisible":i,"workspace-itemTab--overhead":!s,"workspace-itemTab--overflow":s,"workspace-itemTab--faded":Boolean(a.archiveRecord)||(0,KA.gO)(a.schemaValidationState)&&!n,"is-min-width":t,"is-failed":(0,KA.gO)(a.schemaValidationState)}),onMouseDown:r?void 0:this._handleMouseDown,onMouseEnter:r?void 0:this._handleMouseEnter,onMouseLeave:r?void 0:this._handleMouseLeave,onMouseMove:r?void 0:this._handleMouseMove,onContextMenu:r?void 0:this._handleContextMenu,style:o,ref:this.tabRef,...(0,ee.Z)({component:"WorkspaceItemTab",element:"root"})},d.createElement("div",{className:"workspace-itemTab-icon"},this._renderIcon(a)),d.createElement("div",{className:"workspace-itemTab-text",...(0,ee.Z)({component:"WorkspaceItemTab",element:"text"})},a.name,d.createElement(lC.Z,{item:{...a,id:a.fileId}})),(n||this.state.isCloseButtonVisible)&&d.createElement("div",{className:"workspace-itemTab-close",onClick:r?void 0:this._handleCloseSelf,onMouseDown:r?void 0:this._handleCloseMouseDown},d.createElement(pe.Z,{dataTestAttrs:{component:"WorkspaceItemTab",key:"close"},icon:"close"}))))}}WorkspaceItemTab.defaultProps={isInvisible:!1}
const z3=WorkspaceItemTab
class WorkspaceTabDropdown extends d.Component{constructor(){super(...arguments)
this.state={isOpen:!1}
this._handleToggleDropdown=()=>{this.setState({isOpen:!this.state.isOpen})}
this._handleCloseDropdown=()=>{this.state.isOpen&&this.setState({isOpen:!1})}
this._handleDragStart=(e,t)=>{const{openFile:n,overflowItems:a}=this.props
n(a[t].fileId)
this._handleCloseDropdown()}}render(){const{activeId:e,onClearWorkspace:t,overflowItems:n}=this.props,{isOpen:a}=this.state,i=n.map(((n,a)=>d.createElement(z3,{item:n,isOverflowTab:!0,isLastTab:!1,forceMinWidth:!1,onDragStart:this._handleDragStart,onClearWorkspace:t,index:a,isActive:e===n.fileId}))),s=l.default.any(n,(t=>t.fileId===e))
return d.createElement("span",{className:"workspace-overflowIcon fatDropdown workspace-overflowMenu"},d.createElement(Sx.Z,{shouldCloseOnInsideClick:!1,onClickOut:this._handleCloseDropdown},d.createElement("div",{className:f()("buttonGroup",{open:a})},d.createElement("div",{className:f()("moreDropdownBtn",{active:s||this.state.isOpen})},d.createElement(pe.Z,{icon:"overflow",onClick:this._handleToggleDropdown})),d.createElement("ul",{className:"dropdown-menu pull-right workspace-overflowDropdown"},d.createElement("div",{className:"workspace-overflowDropdown-scrollContainer"},i.map(((e,t)=>d.createElement("li",{key:t},e)))),d.createElement("li",{className:"divider"}),d.createElement("li",{className:"workspace-itemTab",onClick:()=>{this.props.onClearWorkspace(G3.CLOSE_ALL)}},d.createElement("span",{className:"workspace-itemTab-closeAll"},"Close All Tabs"))))))}}const $3=WorkspaceTabDropdown
class WorkspaceConnector extends oi.C{constructor(){super(...arguments)
this.stores=[jA.Z,nz.Z]}enhanceProps(){return{maxOverheadTabs:this.workspaceStore().getMaxOverheadTabs()}}}var W3
!function(e){e[e.LEFT=-1]="LEFT"
e[e.RIGHT=1]="RIGHT"}(W3||(W3={}))
class Workspace extends d.Component{constructor(){super(...arguments)
this.state={intendedActiveId:this.props.activeId,dragParams:null,dragState:null}
this._isMounted=!1
this._throttledUpdateWidth=null
this.tabContainerRef=d.createRef()
this._updateWidth=()=>{this._isMounted&&this.props.onUpdateWorkspaceWidth(this._getWidth())}
this._handleDragStart=(e,t,n)=>{const a=this.props.workspaceItems[t]
this.props.openFile(a.fileId)
this.setState({intendedActiveId:a.fileId})
if(null!=this.state.dragParams||this.props.workspaceItems.length<=1)return
const i=t*n,s=e.pageX,r=this._getWidth()-n,computeTranslateFromMouseX=e=>{const t=e-s
return(0,Jt.uZ)(0,r,i+t)}
this._attachDragListeners()
this.setState({dragParams:{tabId:a.fileId,tabWidth:n,computeTranslateFromMouseX},dragState:{translateX:computeTranslateFromMouseX(e.pageX),dragIndex:t}})}
this._handleDragMove=e=>{if(null==this.state.dragParams)return
const{computeTranslateFromMouseX:t,tabId:n,tabWidth:a}=this.state.dragParams,{dragIndex:i}=this.state.dragState,s=t(e.pageX),r=s+a/2,o=Math.floor(r/a)
o!==i&&this.props.moveWorkspaceTab(n,o)
this.setState({dragState:{translateX:s,dragIndex:o}})}
this._handleDragEnd=()=>{this.setState({dragParams:null,dragState:null})
this._detachDragListeners()}
this._handleKeyDown=e=>{if(!(0,q3.Z)()&&!nz.Z.getIsExpanded()&&null==HQ.Z.getCurrentScreen()){(function isSwitchTabLeft(e){return"Ctrl + Shift + 9"===(0,pn.getNormalizedShortcut)(e)})(e)&&this._handleSwitchTab(W3.LEFT);(function isSwitchTabRight(e){return"Ctrl + Shift + 0"===(0,pn.getNormalizedShortcut)(e)})(e)&&this._handleSwitchTab(W3.RIGHT)}}
this.getOverflowItems=()=>this.props.workspaceItems.slice(this.props.maxOverheadTabs)
this.onClearWorkspace=(e,t)=>{!function handleClearWorkspaceAction(e,t,n){const{workspaceItemIds:a,onClearWorkspace:i}=t
e===G3.CLOSE_SELF&&null!=n?i(a.filter((e=>e!==n))):e===G3.CLOSE_OTHERS&&null!=n?i([n]):e===G3.CLOSE_RIGHT&&null!=n?i(a.slice(0,a.indexOf(n)+1)):e===G3.CLOSE_ALL&&i([])}(e,{workspaceItemIds:this.props.workspaceItems.map((({fileId:e})=>e)),overflowItemIds:this.getOverflowItems().map((({fileId:e})=>e)),onClearWorkspace:this.props.onClearWorkspace},t)}}componentDidMount(){this._isMounted=!0
this._throttledUpdateWidth=de.Vx(this._updateWidth)
o()(window).on("resize",this._throttledUpdateWidth)
o()(window).on("buffersResize",this._updateWidth)
l.default.defer((()=>{this._updateWidth()}))
document.addEventListener("keydown",this._handleKeyDown)}UNSAFE_componentWillReceiveProps(e){this.props.activeId!==e.activeId&&this.setState({intendedActiveId:e.activeId})}componentWillUnmount(){this._isMounted=!1
o()(window).off("resize",this._throttledUpdateWidth)
o()(window).off("buffersResize",this._updateWidth)
document.removeEventListener("keydown",this._handleKeyDown)
this._detachDragListeners()}_getWidth(){return o()(this.tabContainerRef.current).width()}_attachDragListeners(){window.addEventListener("mousemove",this._handleDragMove)
window.addEventListener("mouseup",this._handleDragEnd)}_detachDragListeners(){window.removeEventListener("mousemove",this._handleDragMove)
window.removeEventListener("mouseup",this._handleDragEnd)}_getModulo(e,t){return(e%t+t)%t}_handleSwitchTab(e){const t=this.props.workspaceItems.findIndex((e=>e.fileId===this.state.intendedActiveId)),n=Math.min(this.props.workspaceItems.length,this.props.maxOverheadTabs),a=this.props.workspaceItems[this._getModulo(t+e,n)]
this.props.openFile(a.fileId)
this.setState({intendedActiveId:a.fileId})}render(){const{openFile:e,maxOverheadTabs:t,workspaceItems:n}=this.props,a=n.slice(0,t),i=this.getOverflowItems(),s=i.length>0
let r=null
null!=this.state.dragParams&&(r=l.default.findWhere(n,{fileId:this.state.dragParams.tabId})||null)
const o=a.map(((t,a)=>d.createElement(z3,{key:t.id,item:t,isActive:this.state.intendedActiveId===t.fileId,isLastTab:a===n.length-1,isOverflowTab:!1,forceMinWidth:s,openFile:e,onClearWorkspace:this.onClearWorkspace,onDragStart:this._handleDragStart,index:a,isInvisible:null!=r&&r.id===t.id})))
null!=r&&o.unshift(d.createElement(z3,{key:"draggedItem",item:r,isActive:!0,isLastTab:!1,isOverflowTab:!1,forceMinWidth:!1,dragLayoutParams:{translateX:this.state.dragState.translateX,width:this.state.dragParams.tabWidth}}))
return d.createElement("div",{className:"workspace"},d.createElement("div",{className:"workspace-tabContainer js-navTour-workspace",ref:this.tabContainerRef},o),s&&d.createElement($3,{activeId:this.state.intendedActiveId,openFile:e,onClearWorkspace:this.onClearWorkspace,overflowItems:i}),dt.ZP.ENABLE_SHOW_USERNAME_IN_WORKSPACE&&this.props.currentUser&&d.createElement("div",{className:"workspace-usernameContainer"},d.createElement("a",{href:`/${this.props.currentUser.url_identifier}/settings`,className:"workspace-usernameContainer-username"},d.createElement("strong",null,this.props.currentUser.name||this.props.currentUser.email))),Boolean(dt.ZP.GROWTH_ENABLE_CLONING_SHARED_FILES_INTO_NEW_ACCOUNT&&!window.user&&(null===(c=window.bootstrap)||void 0===c?void 0:c.sharedFolderItemAPIId)&&tK.includes(ea.ZP.apiIdToType(null===(u=window.bootstrap)||void 0===u?void 0:u.sharedFolderItemAPIId)))&&d.createElement(EditNowButton,null))
var c,u}}const H3=WorkspaceConnector.connect(Workspace,{throttleUpdates:!0,shouldPropagateNextState:(e,t)=>!Is()(e,t)})
class WorkspaceContainerConnector extends oi.C{constructor(){super(...arguments)
this.stores=[HQ.Z,nz.Z,jA.Z]}enhanceProps(){return{sidepanelSection:this.sidepanelStore().getSection(),workspace:this.workspaceStore().getState(),fullScreenOpen:Boolean(this.fullScreenStore().getCurrentScreen())}}}class WorkspaceContainer extends d.Component{componentDidMount(){this.setBodyClass()}componentDidUpdate(){this.setBodyClass()}setBodyClass(){o()(document.body).toggleClass("has-shown-workspace",!this._getIsWorkspaceHidden())}_getIsWorkspaceHidden(){const{fullScreenOpen:e,sidepanelSection:t,workspace:n}=this.props
return 0===n.workspaceItems.length||t&&!(0,Jt.q9)(ZP.Ku,t)||e}render(){return d.createElement("div",null,!this._getIsWorkspaceHidden()&&d.createElement(H3,{openFile:Rn.Z.openFile,moveWorkspaceTab:Rn.Z.moveWorkspaceTab,onClearWorkspace:Rn.Z.clearWorkspace,onUpdateWorkspaceWidth:Rn.Z.updateWorkspaceWidth,currentUser:Jn.Z.currentUser(),...this.props.workspace}))}}const j3=WorkspaceContainerConnector.connect(WorkspaceContainer,{throttleUpdates:!0,shouldPropagateNextState:(e,t)=>!Is()(e,t)})
var Y3=n(875091),Q3=n(578401),K3=n(595177),J3=n(747286)
class ReactPanelContainer extends d.Component{constructor(){super(...arguments)
this.state={activeKey:this.props.subpanels[0].key}
this.onTabClick=e=>{this.setState({activeKey:e})}}render(){return d.createElement("div",null,d.createElement("div",{className:"panel-title"},d.createElement(KW.Z,{tabs:this.props.subpanels.map((({key:e,title:t})=>({handleClick:this.onTabClick.bind(this,e),isActive:this.state.activeKey===e,text:t})))})),d.createElement("div",{className:"panel-content"},d.createElement("div",{className:"panel-container"},this.props.subpanels.find((e=>e.key===this.state.activeKey)).component)))}}class ReactPanelBaseView extends s().View{initialize(){this.closePanel=this.closePanel.bind(this)}bindListeners(e,t){null!=this.panelState&&this.stopListening(this.panelState)
this.panelState=e
this.listenTo(e,"change",(()=>{this.render()}))
null!=this.model&&this.stopListening(this.model)
this.model=t
this.listenTo(t,"change",(()=>{this.render()}))}update(e,t){this.bindListeners(e,t)
this.render()}closePanel(){this.panelState.trigger("close")}render(){const e=this.$(".react-panel-mount")[0]
if(this.panelState.get("active")){const t=d.createElement(ReactPanelContainer,{subpanels:this.getSubpanels()})
Me.A9(t,e)}else u.unmountComponentAtNode(e)
return this}}const X3=ReactPanelBaseView
var e5=n(680544)
const t5=xa.ZP`
  query MoleculeVersionQuery($moleculeId: StrictString!) @skipAudit @engComponent(name: CHEMISTRY) {
    molecule(id: $moleculeId) {
      ... on MoleculeNode {
        id
        versions {
          id
          name
          creator {
            id
            name
          }
          modifiedAt
          parentId
        }
        currentVersion {
          id
          name
          creator {
            id
            name
          }
          modifiedAt
          parentId
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
class MoleculeHistoryPanelConnector extends oi.C{enhanceProps(){return{openMoleculeVersionId:this.reduxState().ui.chemistry.moleculeVersionUIs[this.props.id].moleculeVersionId}}}class MoleculeHistoryPanel extends d.Component{constructor(){super(...arguments)
this.openVersion=e=>{(0,Vn.getStore)().dispatch((0,K3.h)(this.props.id,e))
m.L9(j.Cj.VIEWED_MOLECULE,{moleculeId:this.props.id,moleculeVersionId:e})}
this.resetToVersion=()=>{Q3.Gi(this.props.id,this.props.openMoleculeVersionId)}
this.cloneFromVersion=()=>{(0,Xn.Z)(J3.ZP,{modelType:st.MOLECULE,id:this.props.id,versionId:this.props.openMoleculeVersionId,initialName:`${this.props.name} (new)`,initialFolderId:this.props.folderId})}
this.formatVersions=e=>{const t=[]
for(const n of e)t.push({...n,fetching:!1})
return t}}render(){return d.createElement(Da.ZP,{query:t5,renderLoading:()=>d.createElement(kl.b,null),variables:{moleculeId:this.props.id}},((e,t)=>{(0,S.hu)(!(0,ka.CZ)(e.molecule),"Molecule must be accessible.")
return d.createElement(e5.Z,{openVersion:this.openVersion,resetToVersion:this.resetToVersion,cloneFromVersion:this.cloneFromVersion,versions:this.formatVersions(e.molecule.versions),openVersionId:this.props.openMoleculeVersionId,isLatest:e.molecule.currentVersion.id===this.props.openMoleculeVersionId,unsaved:!1,showNames:!0,showSeconds:!0,hasParent:!1,parent:null,permissions:this.props.permissions,disableHistoryChanges:!dt.ZP.CHEMISTRY_ENABLE_MOLECULE})}))}}const n5=MoleculeHistoryPanelConnector.connect(MoleculeHistoryPanel)
const a5=class MoleculeHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(n5,{id:this.model.id,name:this.model.name(),folderId:this.model.folder().id,permissions:this.model.permissions()})}]}}
var i5=n(107098),s5=n(709524),r5=n(184353)
function ProteinAlignmentPanelTable_defineProperty(e,t,n){(t=function ProteinAlignmentPanelTable_toPropertyKey(e){var t=function ProteinAlignmentPanelTable_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class ProteinAlignmentPanelTable extends d.Component{constructor(...e){super(...e)
ProteinAlignmentPanelTable_defineProperty(this,"_mapAlignments",((e,t)=>l.default.object(l.default.pluck(e,"id"),e.map((e=>t(e))))))
ProteinAlignmentPanelTable_defineProperty(this,"_emptyRowUiState",(e=>({isEditing:!1,inputValue:e.name})))
ProteinAlignmentPanelTable_defineProperty(this,"_isNotEditingAnyRow",(()=>!Object.values(this.state.rowUiState).some((e=>e.isEditing))))
ProteinAlignmentPanelTable_defineProperty(this,"_handleClickRow",(e=>{if(this._isNotEditingAnyRow()){QD.Z.open({proteinId:e.proteinId,alignmentId:e.id})
this.props.closePanel()}}))
ProteinAlignmentPanelTable_defineProperty(this,"_deleteAlignmentHandler",(e=>t=>{t.stopPropagation()
je.iG("Confirm Delete",d.createElement("span",null,"Are you sure you want to delete the alignment ",d.createElement("strong",null,e.name),"? This action is not reversible."),"danger").done((()=>{QD.Z.delete(e.proteinId,e.id)}))}))
ProteinAlignmentPanelTable_defineProperty(this,"_getInputValue",(e=>this.state.rowUiState[e].inputValue))
ProteinAlignmentPanelTable_defineProperty(this,"_getIsEditing",(e=>this.state.rowUiState[e].isEditing))
ProteinAlignmentPanelTable_defineProperty(this,"_setRowUiState",((e,t)=>{const n=Q()(this.state,{rowUiState:{[e]:{$merge:t}}})
this.setState(n)}))
ProteinAlignmentPanelTable_defineProperty(this,"_editHandler",(e=>t=>{t.stopPropagation()
this._setRowUiState(e,{isEditing:!0})}))
ProteinAlignmentPanelTable_defineProperty(this,"_cancelHandler",((e,t)=>n=>{this._setRowUiState(e,{isEditing:!1,inputValue:t})}))
ProteinAlignmentPanelTable_defineProperty(this,"_completeEditing",(e=>{const t=this._getInputValue(e.id)
QD.Z.rename(e.id,t)
this._setRowUiState(e.id,{isEditing:!1})}))
ProteinAlignmentPanelTable_defineProperty(this,"_completeEditingHandler",(e=>t=>{this._completeEditing(e)}))
ProteinAlignmentPanelTable_defineProperty(this,"_isCompleteEnabled",(e=>Boolean(this._getInputValue(e))))
ProteinAlignmentPanelTable_defineProperty(this,"_onChangeHandler",(e=>t=>{this._setRowUiState(e,{inputValue:t.target.value})}))
ProteinAlignmentPanelTable_defineProperty(this,"_keyDownHandler",(e=>t=>{if(pn.isEnterKey(t)){t.preventDefault()
this._isCompleteEnabled(e.id)&&this._completeEditing(e)}else if(pn.isEscapeKey(t)){t.preventDefault()
t.stopPropagation()
this._setRowUiState(e.id,{isEditing:!1})}}))
ProteinAlignmentPanelTable_defineProperty(this,"_handleOnFocus",(e=>{const t=e.target
t.setSelectionRange(0,t.value.length)}))
ProteinAlignmentPanelTable_defineProperty(this,"_renderNameColumn",((e,t)=>{const n=t.id
return this._getIsEditing(n)?d.createElement(_t.Z,{autoFocus:!0,onFocus:this._handleOnFocus,value:this._getInputValue(n),onChange:this._onChangeHandler(n),onKeyDown:this._keyDownHandler(t)}):t.name}))
ProteinAlignmentPanelTable_defineProperty(this,"_renderActionButtonColumn",((e,t)=>{const n=t.id
return this.props.showActionButtons&&d.createElement(aA.Z,{isEditing:this._getIsEditing(n),cancel:this._cancelHandler(n,t.name),complete:this._completeEditingHandler(t),isCompleteEnabled:this._isCompleteEnabled(n),remove:this._deleteAlignmentHandler(t),edit:this._editHandler(n),className:"alignmentPanel-actionButtons"})}))
ProteinAlignmentPanelTable_defineProperty(this,"state",{rowUiState:this._mapAlignments(this.props.alignments,this._emptyRowUiState)})}UNSAFE_componentWillReceiveProps(e){this.setState({rowUiState:this._mapAlignments(e.alignments,(e=>this.state.rowUiState[e.id]||this._emptyRowUiState(e)))})}render(){return d.createElement(fj.Z,{columns:[fj.Z.defaultColumn("Name","name",{render:this._renderNameColumn}),fj.Z.defaultColumn("Created","created",{render:(e,t)=>(0,Hr.UT)(t.createdAt,{showTime:!1})}),{header:"",sortable:!1,render:this._renderActionButtonColumn}],rows:this.props.alignments,onClickRow:this._handleClickRow,clickable:this._isNotEditingAnyRow(),verticalAlignMiddle:!0,className:"u-small-spacing-top panel-container-table alignmentPanel-table",dataTestAttrs:this.props.dataTestAttrs})}}ProteinAlignmentPanelTable_defineProperty(ProteinAlignmentPanelTable,"propTypes",{alignments:J().arrayOf(J().shape({id:J().string.isRequired,name:J().string.isRequired,createdAt:J().string.isRequired})).isRequired,showActionButtons:J().bool.isRequired,closePanel:J().func.isRequired,dataTestAttrs:Kq.C})
const o5=ProteinAlignmentPanelTable
function ProteinAlignmentPanel_defineProperty(e,t,n){(t=function ProteinAlignmentPanel_toPropertyKey(e){var t=function ProteinAlignmentPanel_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}class ProteinAlignmentPanelConnector extends oi.C{constructor(...e){super(...e)
ProteinAlignmentPanel_defineProperty(this,"shouldSubscribeToRedux",!1)
ProteinAlignmentPanel_defineProperty(this,"stores",[r5.Z])}_sortByCreatedAt(e){return l.default.sortBy(e,"createdAt").reverse()}enhanceProps(){return{alignments:this._sortByCreatedAt(this.proteinAlignmentStore().getAlignments(this.props.proteinId)),linkedAlignments:this._sortByCreatedAt(this.proteinAlignmentStore().getLinkedAlignments(this.props.proteinId))}}}class ProteinAlignmentPanel extends d.Component{constructor(...e){super(...e)
ProteinAlignmentPanel_defineProperty(this,"_allowFeatureEdits",(()=>ba.Z.getProteinById(this.props.proteinId).permissions.polymerFeaturesEditable))
ProteinAlignmentPanel_defineProperty(this,"_onCreateAlignment",(()=>{const e=ba.Z.getProteinById(this.props.proteinId)
i5.Z.openWithTemplateSpecifier((0,s5.Z)(e))}))
ProteinAlignmentPanel_defineProperty(this,"_renderAlignments",(()=>d.createElement("div",null,d.createElement("h5",{className:"u-spacing-top"},"Saved Alignments"),this.props.alignments.length?d.createElement(o5,{alignments:this.props.alignments,showActionButtons:this._allowFeatureEdits(),closePanel:this.props.closePanel,dataTestAttrs:{component:"ProteinAlignmentPanel",element:"proteinAlignmentTable"}}):d.createElement("div",{className:"u-small-spacing-top u-small-spacing-bottom"},"No saved protein alignments."))))
ProteinAlignmentPanel_defineProperty(this,"_renderLinkedAlignments",(()=>d.createElement("div",null,d.createElement("h5",{className:"u-spacing-top"},"Linked Alignments"),this.props.linkedAlignments.length?d.createElement(o5,{alignments:this.props.linkedAlignments,showActionButtons:!1,closePanel:this.props.closePanel}):d.createElement("div",{className:"u-small-spacing-top u-small-spacing-bottom"},"No linked protein alignments."))))}render(){return d.createElement("div",(0,ee.Z)({component:"ProteinAlignmentPanel",element:"root"}),d.createElement("button",{className:"btn btn-af-primary btn-block u-small-spacing-top",onClick:this._onCreateAlignment,disabled:!this._allowFeatureEdits(),type:"button"},"Create New Alignment"),this._renderAlignments(),this._renderLinkedAlignments())}}ProteinAlignmentPanel_defineProperty(ProteinAlignmentPanel,"propTypes",{proteinId:J().string.isRequired,closePanel:J().func.isRequired,alignments:J().arrayOf(J().shape({id:J().string.isRequired,name:J().string.isRequired,createdAt:J().string.isRequired})).isRequired,linkedAlignments:J().arrayOf(J().shape({id:J().string.isRequired,name:J().string.isRequired,createdAt:J().string.isRequired})).isRequired})
const l5=ProteinAlignmentPanelConnector.connect(ProteinAlignmentPanel)
const c5=class ProteinAlignmentPanelView extends X3{getSubpanels(){return[{key:"proteinAlignmentPanel",title:"Alignments",component:d.createElement(l5,{proteinId:this.model.id,closePanel:this.closePanel})}]}}
var d5=n(383296)
class ProteinAnnotationEditor extends d.Component{constructor(){super(...arguments)
this.nameInputRef=d.createRef()
this.trackEditField=e=>{m.j("protein",e,{product:j.XC.MOLBIO,protein_id:this.props.proteinId})}
this._handleSetName=e=>{Ca.setName(this.props.proteinId,e.target.value)}
this._handleSetType=e=>{Ca.setType(this.props.proteinId,e.target.value)}
this._handleSetDisplayStart=e=>{Ca.setDisplayStart(this.props.proteinId,e.target.value)}
this._handleSetDisplayEnd=e=>{Ca.setDisplayEnd(this.props.proteinId,e.target.value)}
this._handleSetColor=e=>{Ca.setColor(this.props.proteinId,e)}
this._handleSaveClick=()=>{this._submitChanges()}
this._handleCancelClick=()=>{Ca.cancel(this.props.proteinId)}
this._handleKeyDown=e=>{pn.isEnterKey(e)&&this.props.isInputValid&&this._submitChanges()}}componentDidMount(){this._maybeSetEditorFocus()}componentDidUpdate(){this._maybeSetEditorFocus()}_maybeSetEditorFocus(){this.props.pendingEditorFocus&&setTimeout((()=>{if(this.nameInputRef.current){this.nameInputRef.current.focus()
Ca.pendingFocusCompleted(this.props.proteinId)}}),0)}_submitChanges(){Ca.save(this.props.proteinId)}render(){const{name:e,type:t,displayStart:n,displayEnd:a,color:i,isAnnotationSelected:s,isInputValid:r}=this.props,o=s?"Edit annotation":"New annotation"
return d.createElement("div",{onKeyDown:this._handleKeyDown,...(0,ee.Z)({component:"ProteinAnnotationEditor",element:"root"})},d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement("span",{className:"proteinAnnotationsPanel-editorTitle"},o))),d.createElement(h.Z,null,d.createElement(p.Z,{md:6},"Name"),d.createElement(p.Z,{md:6},d.createElement("input",{...(0,ee.Z)({component:"ProteinAnnotationEditor",element:"input",key:"annotationName"}),ref:this.nameInputRef,type:"text",placeholder:"Annotation name",value:e,onChange:this._handleSetName,onBlur:()=>{this.trackEditField("edited_name")}}))),d.createElement(h.Z,null,d.createElement(p.Z,{md:6},"Annotation type"),d.createElement(p.Z,{md:6},d.createElement("input",{type:"text",placeholder:"Annotation type",value:t,onChange:this._handleSetType,onBlur:()=>{this.trackEditField("edited_annotation_type")}}))),d.createElement(h.Z,null,d.createElement(p.Z,{md:6},"Position"),d.createElement(p.Z,{md:3},d.createElement("input",{type:"text",placeholder:"Start",value:n,onChange:this._handleSetDisplayStart})),d.createElement(p.Z,{md:3},d.createElement("input",{type:"text",placeholder:"End",value:a,onChange:this._handleSetDisplayEnd}))),d.createElement(h.Z,null,d.createElement(p.Z,{md:6},"Color"),d.createElement(p.Z,{md:6},d.createElement(PopoverColorPicker,{selectedColor:i,onSelectColor:this._handleSetColor}))),d.createElement(h.Z,null,d.createElement(p.Z,{md:6},d.createElement("button",{className:f()("button button--primary button--small proteinAnnotationsPanel-editorButton",{"is-disabled":!r}),onClick:this._handleSaveClick,disabled:!r,type:"button",...(0,ee.Z)({component:"ProteinAnnotationEditor",element:"button",key:"save"})},"Save annotation")),d.createElement(p.Z,{md:6},d.createElement("button",{className:"button button--tertiaryGray button--small proteinAnnotationsPanel-editorButton",onClick:this._handleCancelClick,type:"button"},"Cancel"))),!r&&d.createElement(h.Z,null,d.createElement("span",{className:"proteinAnnotationsPanel-errorMessage"},`Please enter a valid name (<= ${ba.P} chars.) and position.`)))}}ProteinAnnotationEditor.propTypes={proteinId:K.string.isRequired,name:K.string.isRequired,displayStart:K.string.isRequired,displayEnd:K.string.isRequired,color:K.string.isRequired,isAnnotationSelected:K.bool.isRequired,pendingEditorFocus:K.bool.isRequired,isInputValid:K.bool.isRequired}
const u5=ProteinAnnotationEditor
class ProteinAnnotationRow extends d.Component{constructor(){super(...arguments)
this._handleDelete=e=>{e.stopPropagation()
Ca.delete(this.props.proteinId,this.props.id)}
this._handleClick=()=>{Ea.Z.selectAnnotation(this.props.proteinId,this.props.id)}
this._handleMouseEnter=()=>{Ea.Z.hoverAnnotation(this.props.proteinId,this.props.id)}
this._handleMouseLeave=()=>{Ea.Z.unhoverAnnotation(this.props.proteinId,this.props.id)}}render(){const{name:e,displayStart:t,displayEnd:n,length:a,color:i,selected:s,hover:r,disabled:o}=this.props
return d.createElement("tr",{className:f()({"proteinAnnotationsPanel-row--selected":s,"proteinAnnotationsPanel-row--hover":r}),onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave},d.createElement("td",{className:"proteinAnnotationsPanel-cell"},e),d.createElement("td",{className:"proteinAnnotationsPanel-cell"},t," - ",n),d.createElement("td",{className:"proteinAnnotationsPanel-cell"},a),d.createElement("td",{className:"proteinAnnotationsPanel-cell"},d.createElement("div",{className:"swatch",style:{backgroundColor:i}})),d.createElement("td",{className:"proteinAnnotationsPanel-cell"},d.createElement("a",{className:f()("faded u-danger-pointer",{"proteinAnnotationsPanel-deleteButton--notHover":!r||o}),onClick:this._handleDelete},d.createElement(pe.Z,{icon:"delete"}))))}}const protein_ProteinAnnotationsTable=({protein:e,selectedAnnotationId:t,hoverAnnotationId:n})=>{const a=e.version.aminoAcids.length,i=e.version.annotations.map((({id:e,name:t,start:n,end:i,color:s})=>({id:e,name:t,displayStart:T.modelToDisplay(n,1),displayEnd:T.modelEndToDisplay(i,a,1),length:T.length(n,i,a),color:s}))),s=(0,hs.Z)(i,["displayStart","displayEnd"]).map((({id:a,name:i,displayStart:s,displayEnd:r,length:o,color:l})=>d.createElement(ProteinAnnotationRow,{key:a,proteinId:e.id,id:a,name:i,displayStart:s,displayEnd:r,length:o,color:l,selected:t===a,hover:n===a,disabled:!e.permissions.polymerFeaturesEditable})))
return d.createElement("div",{className:"scroll",...(0,ee.Z)({component:"ProteinAnnotationsTable",element:"root"})},d.createElement("table",{className:"proteinAnnotationsPanel-table u-width-full"},d.createElement("thead",{className:"proteinAnnotationsPanel-header"},d.createElement("tr",null,d.createElement("th",{className:"proteinAnnotationsPanel-cell"},"Name"),d.createElement("th",{className:"proteinAnnotationsPanel-cell"},"Location"),d.createElement("th",{className:"proteinAnnotationsPanel-cell"},"Length"),d.createElement("th",{className:"proteinAnnotationsPanel-cell"}),d.createElement("th",{className:"proteinAnnotationsPanel-cell"}))),d.createElement("tbody",null,s)),0===s.length&&d.createElement("span",{className:"proteinAnnotationsPanel-emptyMessage"},"No annotations."))}
class ProteinAnnotationsPanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const{proteinId:e}=this.props
return{protein:this.proteinStore().getProteinById(e),selectedAnnotationId:this.proteinStore().getSelectedAnnotationId(e),hoverAnnotationId:this.proteinStore().getHoveredAnnotationId(e),editorData:this.proteinStore().getAnnotationEditorData(e)}}}class ProteinAnnotationsPanel extends d.Component{constructor(){super(...arguments)
this._handleNewAnnotation=()=>{m.j("protein","new_annotation_click",{product:j.XC.MOLBIO,protein_id:this.props.proteinId})
Ca.newAnnotation(this.props.proteinId)}
this._handleAutoAnnotate=async()=>{m.j("protein","clicked_auto_annotate",{product:j.XC.MOLBIO,protein_id:this.props.proteinId})
const e=await(0,Xn.Z)(d5.Z,{})
m.j("protein","add_auto_annotations_click",{product:j.XC.MOLBIO,protein_id:this.props.proteinId,featureLibraryIds:e})
null!=e&&Ea.Z.autoAnnotate(this.props.proteinId,e)}}render(){const{protein:e,selectedAnnotationId:t,hoverAnnotationId:n,editorData:a}=this.props,i=Jn.Z.currentUser(),s=i&&`/${i.url_identifier}/feature-libraries/`,r=e.permissions&&e.permissions.polymerFeaturesEditable&&e.isLatest
return d.createElement("div",{className:"proteinAnnotationsPanel",...(0,ee.Z)({component:"ProteinAnnotationPanel",element:"root"})},r&&d.createElement("div",{className:"proteinAnnotationsPanel-newAnnotation u-small-spacing-bottom"},d.createElement("a",{onClick:this._handleNewAnnotation},"New annotation")),d.createElement(protein_ProteinAnnotationsTable,{protein:e,selectedAnnotationId:t,hoverAnnotationId:n}),r&&a&&[d.createElement("div",{key:"divider",className:"panel-divider"}),d.createElement(u5,{key:"editor",proteinId:e.id,name:a.name,type:a.type,displayStart:a.displayStart,displayEnd:a.displayEnd,color:a.color,pendingEditorFocus:a.pendingEditorFocus,isInputValid:a.isInputValid,isAnnotationSelected:null!=t})],r&&[d.createElement("div",{key:"divider",className:"panel-divider"}),d.createElement(h.Z,{key:"row"},d.createElement(p.Z,{md:6},d.createElement("button",{className:"button button--secondary button--small proteinAnnotationsPanel-autoAnnotate",onClick:this._handleAutoAnnotate,type:"button"},"Auto-annotate")),d.createElement(p.Z,{md:6},s&&d.createElement("div",{className:"proteinAnnotationsPanel-editFeatureLibraries"},d.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},"Edit Feature Libraries"))))])}}const m5=ProteinAnnotationsPanelConnector.connect(ProteinAnnotationsPanel)
const p5=class ProteinAnnotationsPanelView extends X3{getSubpanels(){return[{key:"proteinAnnotationsPanel",title:"Annotations",component:d.createElement(m5,{proteinId:this.model.id})}]}}
var h5=n(261575),g5=n(986565)
function InformationPanelNameInput(e){return d.createElement("div",null,e.isWritable?d.createElement("input",{id:"info-name",type:"text",className:"info-name-input",onChange:e.onChange,value:e.name}):e.name,d.createElement(lC.Z,{item:{id:e.id,archiveRecord:e.archiveRecord,name:e.name}}))}class InformationSubpanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Jn.Z]}enhanceProps(){const e=this.entityStore().currentUser()
return{userMetadata:e?e.metadata:null}}}const E5=xa.ZP`
  query EntryReviewLifecycleQuery($entryId: StrictString!) @skipAudit {
    entry(id: $entryId) {
      ... on EntryNode {
        id
        review {
          id
          status
          reviewLifecycleVersion {
            id
          }
        }
        project {
          ... on ProjectNode {
            id
            reviewLifecycle {
              id
            }
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ReviewButtonGroupWrapper({children:e}){return null!=e?d.createElement(d.Fragment,null,d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},e)),d.createElement("div",{className:"panel-divider"})):d.createElement(d.Fragment,null,e)}function ReviewButtonSection({fileType:e,fileId:t,review:n,entryReviewLifecycleInfo:a}){return d.createElement(Ck,{fileId:t,review:n,fullWidth:!0,isVertical:!0,onUpdate:(n,a,i)=>{!function onReviewUpdate({fileId:e,fileType:t,review:n,permissions:a}){if(t===st.ENTRY)HL.Z.postServerUpdate(e,{review:n,permissions:a})
else{(0,S.hu)(t===st.STAGE_ENTRY,"unexpected fileType")
bk.updateReview(e,n,a)}}({fileType:e,fileId:t,review:n,permissions:a})},size:C.qE.SMALL,className:"informationSubpanel-reviewButtonGroup",entryReviewLifecycleInfo:a,wrapperComponent:ReviewButtonGroupWrapper})}function ReviewButtonsForEntry({fileType:e,fileId:t,review:n}){return d.createElement(Da.ZP,{query:E5,variables:{entryId:t},renderLoading:()=>d.createElement(d.Fragment,null,d.createElement("div",null,d.createElement(kl.b,{suppressPadding:!0,className:(0,g.iv)(S5.customPaddingTop)})),d.createElement("div",{className:"panel-divider"}))},(({entry:a})=>(0,ka.CZ)(a)?null:d.createElement(ReviewButtonSection,{fileType:e,fileId:t,review:n,entryReviewLifecycleInfo:{projectUsesReviewLifecycle:null!=a.project.reviewLifecycle,wasLastSentForLegacyReview:null!=a.review&&null==a.review.reviewLifecycleVersion}})))}function ReviewButtons({fileId:e,fileType:t,review:n}){return cA.p8(t)?cA.fD(t)?t===st.ENTRY?d.createElement(ReviewButtonsForEntry,{fileType:t,fileId:e,review:n}):d.createElement(ReviewButtonSection,{fileType:t,fileId:e,review:n}):TK.Z.isEnabled()?d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,fullWidth:!0,icon:"star",onClick:()=>{TK.Z.open(TK.l.REVIEWS)},size:C.qE.SMALL,text:"Send for review"}))):null:null}class InformationSubpanel extends d.Component{constructor(e,t){super(e,t)
this._getFolderId=e=>{e||(e=this.props)
return e.folder?e.folder.api_identifier:null}
this._handleChangeFolderId=e=>{this.setState({folderId:e.target.value})}
this._isRegistered=()=>null!=this.props.folder&&lo.isRegistry(this.props.folder.source)
this._getPartialFeatureDefinition=()=>({item:{id:this.props.fileId,permissions:this.props.permissions},itemState:{isRegistered:this._isRegistered()}})
this.saveModel=async()=>{const{folderId:e,tagSchemaId:t}=lo.parseFolderValue(this.state.folderId),{writable:n,movable:a}=this.props.permissions
if(n)await this.props.saveModel(this.state.name,e,t)
else{(0,S.hu)(Boolean(a),"User attempted to save changes to a file without authorized WRITE / MOVE")
Rn.Z.moveItemsWithDataMods([this.props.fileId],e,{parentFolderIds:[this._getFolderId()],hasRegisteredItems:this._isRegistered()})}}
this.showContainingFolder=()=>{const e=Array.from(st.NOTEBOOK_ITEMS).includes(this.props.fileType)?ZN.NOTEBOOK_SECTION:ZN.INVENTORY_SECTION;(0,S.hu)(null!=this.props.folder,"Folder cannot be null when showing containing folder.");(0,$N.Z)(this.props.folder,e)}
this.submitHandler=async e=>{e.preventDefault()
this.props.permissions.writable&&await this.saveModel()}
this._hasEdits=()=>this._getFolderId()!==this.state.folderId||this.props.name!==this.state.name
this._requestPatentsafeExport=()=>{h5.Z.requestPatentsafeExport(this.props.fileId)}
this._exportAuditLogs=()=>{bc.dV([this.props.fileId])}
this._getPatentSafeMessage=()=>this.props.thirdPartyStorageServiceData.isSendingToPatentsafe?"Sending to PatentSafe...":"Send to PatentSafe"
this._renderPatentsafeExportButton=()=>d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:"patentsafeExportButton",disabled:this.props.thirdPartyStorageServiceData.isSendingToPatentsafe,fullWidth:!0,onClick:this._requestPatentsafeExport,size:C.qE.SMALL,text:this._getPatentSafeMessage()}),(()=>{if(null!=this.props.thirdPartyStorageServiceData.lastSentTimestamp){const e=this.props.thirdPartyStorageServiceData.lastSentUser,t=(0,Kl.Z)(this.props.thirdPartyStorageServiceData.lastSentTimestamp),n=`Last sent ${null!=e?`by ${(0,Qw.a)(e)} `:""}${t}`
return d.createElement("div",{className:"patentsafeLastSentMsg faded text-center u-tiny-spacing-top"},n)}return null})()))
this._getDownloadInfo=()=>"function"==typeof this.props.getDownloadInfo?this.props.getDownloadInfo():void 0
this._renderDownloadButtonLink=(e,t)=>d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.ZP,{buttonStyle:C.ZJ.SECONDARY,href:e,fullWidth:!0,size:C.qE.SMALL,text:t,dataTestAttrs:{component:"InformationSubpanel",element:"downloadButton"}}),(0,ln.cr)({feature:rn.N7.EDIT,...this._getPartialFeatureDefinition()})&&d.createElement("div",{className:"panel-divider"})))
this._renderDownloadButtons=()=>{const e=this._getDownloadInfo()
if(!e)return null
if(Array.isArray(e)){const t=e[this.state.selectedDownloadInfoIndex]
return d.createElement(d.Fragment,null,d.createElement(h.Z,{className:(0,g.iv)(S5.centerVertically)},d.createElement(p.Z,{md:6},"Export Data"),d.createElement(p.Z,{md:6},d.createElement("select",{value:this.state.selectedDownloadInfoIndex,onChange:e=>{this.setState({selectedDownloadInfoIndex:e.target.value})},...(0,ee.Z)({component:"InformationSubpanel",element:"exportFormatDropdown"})},e.map(((e,t)=>d.createElement("option",{value:t,key:t},e.title)))))),this._renderDownloadButtonLink(t.url,"Download"))}return this._renderDownloadButtonLink(e.url,e.title)}
this._handleChangeName=e=>{this.setState({name:e.target.value})}
const n=this._getDownloadInfo()
this.state={name:e.name,folderId:this._getFolderId(),selectedDownloadInfoIndex:n&&Array.isArray(n)?0:null}}componentDidMount(){this.props.userMetadata||null==Jn.Z.currentUser()||J$.Zq()}UNSAFE_componentWillReceiveProps(e){e.name!==this.props.name&&this.setState({name:e.name})
this._getFolderId(e)!==this._getFolderId()&&this.setState({folderId:this._getFolderId(e)})}render(){const{readable:e}=this.props.permissions,t=(0,ln.cr)({feature:rn.N7.EDIT,...this._getPartialFeatureDefinition()}),n=(0,ln.cr)({feature:rn.N7.MOVE,...this._getPartialFeatureDefinition()}),a=(0,ln.cr)({feature:rn.N7.DELETE,...this._getPartialFeatureDefinition()}),i=null!=Jn.Z.currentUser()&&null!=this.props.requestExport,s="entry"===this.props.friendlyFileType
return d.createElement("div",{...(0,ee.Z)({component:"InformationSubpanel",element:"root"})},d.createElement("form",{onSubmit:this.submitHandler},d.createElement("div",{className:"form-group u-small-spacing-top"},d.createElement(h.Z,null,d.createElement(p.Z,{md:4},d.createElement("h5",null,"Name")),d.createElement(p.Z,{md:8},d.createElement(InformationPanelNameInput,{archiveRecord:this.props.archiveRecord,id:this.props.fileId,isWritable:t,name:this.state.name,onChange:this._handleChangeName}))),e&&null!=this.props.folder&&!lo.isRegistry(this.props.folder.source)&&d.createElement(h.Z,null,d.createElement(p.Z,{md:4},d.createElement("h5",null,"Folder",d.createElement(P.ZP,{title:"Show containing folder",container:"body"},d.createElement("a",{className:"u-tiny-spacing-left",onClick:this.showContainingFolder},d.createElement(pe.Z,{icon:"upload"}))))),d.createElement(p.Z,{md:8},d.createElement(Ye.Z,{currentTagSchema:this.props.currentTagSchema,readOnly:!n,showInventory:Array.from((0,tw.getRegistrySupportedTypes)()).includes(this.props.fileType),showNotebook:Array.from(st.NOTEBOOK_ITEMS).includes(this.props.fileType),value:this.state.folderId,onChange:this._handleChangeFolderId,unsetOnFetchFail:!0})))),d.createElement("div",null,(t||n)&&d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,disabled:!this._hasEdits(),fullWidth:!0,onClick:this.saveModel,size:C.qE.SMALL,text:"Update information",type:"button"}))))),d.createElement("div",{className:"panel-divider"}),d.createElement(ReviewButtons,{fileId:this.props.fileId,fileType:this.props.fileType,review:this.props.review}),this._renderDownloadButtons(),dt.ZP.ENABLE_DELETE&&null!=this.props.deleteModel&&d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(P.ZP,{title:a?"Delete":g5.M({isArchived:(0,yc.ZP)({id:this.props.fileId,name:this.props.name,archiveRecord:this.props.archiveRecord})})},d.createElement(C.Co,{buttonStyle:C.ZJ.NEGATIVE,disabled:!a,fullWidth:!0,onClick:this.props.deleteModel,size:C.qE.SMALL,text:`Delete ${this.props.friendlyFileType}`})))),dt.ZP.ENABLE_ARCHIVING_V2&&d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(wR.Z,{fullWidth:!0,isArchivable:(0,ln.cr)({feature:rn.N7.ARCHIVE,...this._getPartialFeatureDefinition()})&&(!ea.ZP.isMolecule(this.props.fileId)||dt.ZP.CHEMISTRY_ENABLE_MOLECULE),isUnarchivable:(0,ln.cr)({feature:rn.N7.UNARCHIVE,...this._getPartialFeatureDefinition()}),item:{id:this.props.fileId,name:this.props.name,archiveRecord:this.props.archiveRecord,folder:this.props.folder},onArchive:IR.ap,onUnarchive:IR.yg,showText:!0}))),i||this.props.showPatentsafeExport&&d.createElement("div",{className:"panel-divider"}),i&&d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,className:"__exportFileButton",fullWidth:!0,onClick:this.props.requestExport,size:C.qE.SMALL,text:`Export ${this.props.friendlyFileType}`,dataTestAttrs:{component:"InformationSubpanel",element:"exportFileButton"}}))),this.props.showPatentsafeExport&&this._renderPatentsafeExportButton(),this.props.additionalPanelContent,s&&d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,fullWidth:!0,onClick:this._exportAuditLogs,size:C.qE.SMALL,text:Tc.QU,dataTestAttrs:{component:"InformationSubpanel",element:"exportAuditLogButton"}}))))}}InformationSubpanel.defaultProps={showPatentsafeExport:!1}
const f5=InformationSubpanelConnector.connect(InformationSubpanel),S5=g.mM.create({centerVertically:{display:"flex",alignItems:"center"},customPaddingTop:{paddingTop:"5px"}}),{apiIdToType:y5}=ea.ZP
class TagsSubpanel extends d.Component{constructor(){super(...arguments)
this.state={tagName:"",tagValue:"",updatedTag:null}
this.setTagState=e=>{this.setState({tagName:(null!=e?e.name:void 0)||"",tagValue:(null!=e?e.value:void 0)||""})}
this.onTagClick=e=>{this.setTagState(e.name===this.state.tagName?null:e)}
this.submitTag=e=>{e.preventDefault()
this._updateModelTags(l.default.object([[this.state.tagName,{value:this.state.tagValue,url:""}]]),[],[],{})}
this.removeTag=(e,t)=>{t.stopPropagation()
this._updateModelTags({},[],[e.name],{})}
this._updateModelTags=(e,t,n,a)=>{BN.Z.updateTagsWithDataMods([this.props.id],this.props.isRegistered,{toSet:e,toAdd:t,toRemove:n,toRename:a},{})}}UNSAFE_componentWillReceiveProps(e){let t=null
for(const n of Array.from(e.tags))if(!Is()(n,l.default.findWhere(this.props.tags,{name:n.name}))){t=n
break}if(null!=t){t.name===this.state.tagName&&this.setTagState(null)
this.setState({updatedTag:t})
setTimeout((()=>{Is()(t,this.state.updatedTag)&&this.setState({updatedTag:null})}),500)}}render(){const e=l.default.findWhere(this.props.tags,{name:this.state.tagName}),t=!this.state.tagName||((null!=e?e.name:void 0)||"")===this.state.tagName&&((null!=e?e.value:void 0)||"")===this.state.tagValue
return d.createElement("div",{className:"tag-editor"},this.props.allowEdits?d.createElement("form",{className:"tag-form no-gap",onSubmit:this.submitTag},d.createElement(h.Z,null,d.createElement(p.Z,{sm:5},d.createElement(Ke.Z,null,d.createElement(_t.Z,{className:"tag-name",type:"text",placeholder:"Tag",value:this.state.tagName,onChange:e=>{this.setState({tagName:e.target.value})}}))),d.createElement(p.Z,{sm:5},d.createElement(Ke.Z,null,d.createElement(_t.Z,{className:"tag-value",type:"text",placeholder:"Value (optional)",value:this.state.tagValue,onChange:e=>{this.setState({tagValue:e.target.value})}}))),d.createElement(p.Z,{className:"add-tag-col",sm:2},d.createElement(P.ZP,{title:null!=e?"Update":"Create",container:"body",placement:P.TQ.BOTTOM},d.createElement("button",{className:"btn btn-af-success",type:"submit",disabled:t},d.createElement(pe.Z,{icon:null!=e?"refresh":"plus-large"})))))):void 0,d.createElement("table",{className:"table tag-table"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Tag",this.props.allowEdits?d.createElement("a",null,d.createElement(A.Z,{className:"u-tiny-spacing-left",title:"Using Tags",renderContent:()=>'Add tags such as "phagemid" to organize your data. Values can also be attached to tags such as "AmpR" for "resistance".',icon:"circle-question",placement:ne.ZH.LEFT})):void 0),d.createElement("th",null,"Value"))),d.createElement("tbody",null,this.props.tags.length>0?Array.from(this.props.tags).map((e=>d.createElement("tr",{key:e.name,className:f()({active:e.name===this.state.tagName,success:e.name===(null!=this.state.updatedTag?this.state.updatedTag.name:void 0)}),onClick:this.onTagClick.bind(this,e)},d.createElement("td",{className:"tag-name"},d.createElement("div",{className:"tag-name-wrapper"},e.name,this.props.allowEdits?d.createElement("div",{className:"tag-manage-buttons"},d.createElement("span",{className:"tag-delete",onClick:this.removeTag.bind(this,e)},"×")):void 0)),d.createElement("td",null,e.value)))):d.createElement("tr",null,d.createElement("td",{colSpan:2},`This ${(0,Mt.E2)(y5(this.props.id))} has no tags.`)))))}}const b5=TagsSubpanel
class BasicInformationPanelView extends X3{friendlyFileType(){return(0,Mt.E2)(this.model.fileState().fileType())}folderDefaultsKey(){return Qe.O.INVENTORY}initialize(){this.deleteModal=this.deleteModal.bind(this)
this.deleteModel=this.deleteModel.bind(this)
this._saveModelIfNeededAndNotifySuccess=this._saveModelIfNeededAndNotifySuccess.bind(this)
this.saveChangesToModel=this.saveChangesToModel.bind(this)
this.saveModel=this.saveModel.bind(this)
this.onSaveSuccess=this.onSaveSuccess.bind(this)
this.onDeleteSuccess=this.onDeleteSuccess.bind(this)}deleteModal(){new Ot.I4({title:`Delete ${(0,Mt.co)(this.friendlyFileType())}`,msg:`Are you sure you want to delete the ${this.friendlyFileType()}? It cannot be recovered.`}).choice("Cancel","btn-af-default").choice("Delete","btn-af-danger",this.deleteModel).show()}deleteModel(){this.model.destroy().fail(v.ZP.notifyError).done(this.onDeleteSuccess)}_saveModelIfNeededAndNotifySuccess(e){l.default.isEmpty(e)?this.onSaveSuccess():this.saveModel(e)}async saveChangesToModel(e,t,n){var a,i
const s=this.model.id,r=this.model.name(),o={};(null==(a=this.model.folder())?void 0:a.api_identifier)!==t&&(o.folder_id=t);(null==(i=this.model.tagSchema())?void 0:i.id)!==n&&(o.tagSchemaId=n)
if(r!==e)try{await Rn.Z.renameFileWithDataMods(s,this.isRegistered(),{oldName:r,newName:e,notifyOnSuccess:!1})
this._saveModelIfNeededAndNotifySuccess(o)}catch(e){v.ZP.notifyError(e)}else this._saveModelIfNeededAndNotifySuccess(o)}saveModel(e){this.model.save(e,{patch:!0,wait:!0}).fail(v.ZP.notifyError).done(this.onSaveSuccess)}onSaveSuccess(){v.ZP.success(`${(0,Mt.kC)(this.friendlyFileType())} successfully updated.`)
this.model.fileState().isFolderItem()&&null!=this.model.folder()&&this.model.folder().source.sourceType!==DN.REGISTRY_TYPE&&Qe.Z.set(this.folderDefaultsKey(),this.model.folder().api_identifier)
this.render()}onDeleteSuccess(){v.ZP.success(`${(0,Mt.kC)(this.friendlyFileType())} successfully deleted.`)
Rn.Z.removeFromWorkspace(this.model.id)
this.model.fileState().isFolderItem()&&ze.Z.invalidateFolderContents(this.model.folder().api_identifier)}getPermissions(){return this.model.permissions()}isRegistered(){return null!=this.model.folder()&&lo.isRegistry(this.model.folder().source)}getSubpanels(){return l.default.compact([{key:"information",title:"Information",component:d.createElement(f5,{additionalPanelContent:"function"==typeof this.getAdditionalPanelContent?this.getAdditionalPanelContent():void 0,archiveRecord:this.model.archiveRecord(),name:this.model.name(),folder:this.model.folder(),fileType:this.model.fileState().fileType(),friendlyFileType:this.friendlyFileType(),fileId:this.model.id,permissions:this.getPermissions(),review:"function"==typeof this.model.review?this.model.review():void 0,saveModel:this.saveChangesToModel,requestExport:this.requestExport,getDownloadInfo:this.getDownloadInfo,deleteModel:dt.ZP.ENABLE_DELETE?this.deleteModal:void 0,showPatentsafeExport:this.showPatentsafeExport,thirdPartyStorageServiceData:"function"==typeof this.model.thirdPartyStorageServiceData?this.model.thirdPartyStorageServiceData():void 0,currentTagSchema:this.model.tagSchema()})},this.model.fileState().isFolderItem()?{key:"tags",title:"Tags",component:d.createElement(b5,{id:this.model.id,allowEdits:this.model.allowEdits()&&(0,ln.cr)({feature:rn.N7.EDIT,item:{id:this.model.id},itemState:{isRegistered:this.isRegistered()}}),tags:this.model.tags(),isRegistered:this.isRegistered()})}:void 0])}}BasicInformationPanelView._InformationSubpanel=f5
const T5=BasicInformationPanelView
const v5=class ProteinInformationPanelView extends T5{constructor(...e){super(...e)
this.saveModel=this.saveModel.bind(this)
this.deleteModel=this.deleteModel.bind(this)
this.getDownloadInfo=this.getDownloadInfo.bind(this)}saveModel(e){Ea.Z.update(this.model.id,e,{success:this.onSaveSuccess})}deleteModel(){Ea.Z.delete(this.model.id,{success:this.onDeleteSuccess})}getDownloadInfo(){const e=this.model.editURL()
S.Gp("/edit"===e.slice(-5),"Expected edit URL to end with /edit.")
return[{url:e.replace(/\/edit$/,".fasta"),title:"FASTA (.fasta)"},{url:e.replace(/\/edit$/,".gp"),title:"GenPept (.gp)"}]}}
class ProteinHistoryPanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[ba.Z]}enhanceProps(){const e=this.proteinStore().getProteinById(this.props.id),t=this.proteinStore().getVersionsById(this.props.id),n=e.version.id,{isLatest:a}=e
return{versions:t,openVersionId:n,isLatest:a}}}class ProteinHistoryPanel extends d.Component{constructor(){super(...arguments)
this.openVersion=e=>{Ea.Z.open(this.props.id,{versionId:e})}
this.resetToVersion=()=>{Ea.Z.revert(this.props.id,this.props.openVersionId)}}render(){return d.createElement(e5.Z,{openVersion:this.openVersion,resetToVersion:this.resetToVersion,versions:this.props.versions,openVersionId:this.props.openVersionId,isLatest:this.props.isLatest,unsaved:!1,showNames:!0,showSeconds:!0,hasParent:!1,parent:null,permissions:this.props.permissions,dirty:!1})}}const C5=ProteinHistoryPanelConnector.connect(ProteinHistoryPanel)
const I5=class ProteinHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(C5,{id:this.model.id,permissions:this.model.permissions()})}]}}
var w5=n(154378)
class SubtemplateHistoryPanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[hJ.Z]}enhanceProps(){return{versionState:this.subtemplateStore().getVersionState(this.props.id),collection:this.subtemplateStore().getCollection()}}}class SubtemplateHistoryPanel extends d.Component{constructor(){super(...arguments)
this.openVersion=e=>{w5.Z.loadVersion(this.props.id,e)}
this.resetToVersion=()=>{w5.Z.resetToOpenVersion(this.props.id)}
this.cloneFromVersion=()=>{(0,Xn.Z)(J3.ZP,{modelType:st.SUBTEMPLATE,id:this.props.id,versionId:this.props.versionState.openVersionId,initialName:`${this.props.name} (new)`,initialTemplateCollection:this.props.collection})}}render(){return d.createElement(e5.Z,{openVersion:this.openVersion,resetToVersion:this.resetToVersion,cloneFromVersion:this.cloneFromVersion,versions:this.props.versionState.versions,openVersionId:this.props.versionState.openVersionId,isLatest:this.props.versionState.isLatest,unsaved:this.props.versionState.unsaved,hasParent:this.props.versionState.hasParent,parent:this.props.versionState.parent,permissions:this.props.permissions})}}const N5=SubtemplateHistoryPanelConnector.connect(SubtemplateHistoryPanel)
const A5=class SubtemplateHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(N5,{id:this.model.id,name:this.model.name(),permissions:this.model.permissions()})}]}}
var R5=n(955080),P5=n(131892),O5=n(751693)
class BaseTemplateInformationSubpanel extends d.Component{constructor(){super(...arguments)
this.state={name:this.props.initialName,collection:this.props.initialCollection}
this._handleChangeCollection=e=>{this.setState({collection:e})}
this.saveModel=()=>{this.props.saveModel(this.state.name,this.state.collection.id)}
this._exportAuditLogs=()=>{bc.dV([this.props.templateId])}
this.handleDelete=async()=>{await(0,Zb.Z)({typeName:"template"})&&this.props.deleteModel()}
this._handleCreateEntryFromTemplate=({entryName:e,folderId:t,templateId:n,tagSchemaId:a,schemaTags:i,initialDay:s})=>{HL.Z.createFromTemplate({entryName:e,folderId:t,templateId:n,tagSchemaId:a,schemaTags:i,initialDay:s,onSuccess:P5.Z.close})}
this.showCreateEntryFromTemplateModal=()=>{dt.ZP.ELN_ENABLE_SCHEMA_ON_ENTRY_CREATE_MODAL?(0,Xn.Z)(OH.ZP,{initialTemplateId:this.props.templateId,initialFolderId:Qe.Z.get(Qe.O.NOTEBOOK),onRequestClose:()=>{},onRequestSubmit:this._handleCreateEntryFromTemplate,isTemplateSelectorDisabled:!1}):P5.Z.open({initialTemplateId:this.props.templateId,initialFolderId:Qe.Z.get(Qe.O.NOTEBOOK),onRequestSubmit:this._handleCreateEntryFromTemplate})}}render(){const e=ea.ZP.apiIdToMaybeType(this.props.templateId),{writable:t,archivable:n,unarchivable:a}=this.props.permissions
return d.createElement("form",null,d.createElement("div",{className:"form-group u-small-spacing-top"},d.createElement(h.Z,null,d.createElement(p.Z,{md:4},d.createElement("h5",null,"Name")),d.createElement(p.Z,{md:8},d.createElement("input",{type:"text",disabled:!t||null!=this.props.archiveRecord,value:this.state.name,onChange:e=>{this.setState({name:e.target.value})}}))),d.createElement(h.Z,null,d.createElement(p.Z,{md:4},d.createElement("h5",null,"Collection")),d.createElement(p.Z,{md:8},d.createElement(R5.Z,{value:this.state.collection,onChange:this.props.permissions.writable?this._handleChangeCollection:Jt.ZT})))),t&&d.createElement(h.Z,{key:"update-btn"},d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,fullWidth:!0,size:C.qE.SMALL,disabled:null!=this.props.archiveRecord,onClick:this.saveModel,text:"Update Information"}))),d.createElement("div",{className:"panel-divider",key:"update-create-divider"}),e===st.TEMPLATE&&d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,fullWidth:!0,size:C.qE.SMALL,disabled:null!=this.props.archiveRecord,onClick:this.showCreateEntryFromTemplateModal,text:"Create entry"}))),dt.ZP.ELN_ENABLE_TEMPLATE_ARCHIVING?d.createElement(h.Z,{key:"archive-btn"},d.createElement(p.Z,{md:12},d.createElement(wR.Z,{fullWidth:!0,isArchivable:Boolean(n),isUnarchivable:Boolean(a),item:{id:this.props.templateId,name:this.props.initialName,archiveRecord:this.props.archiveRecord},onArchive:(e,t,n)=>{IR.ap(e,t,n)},onUnarchive:e=>{IR.yg(e,{})},showText:!0}))):t&&dt.ZP.ENABLE_DELETE&&d.createElement(h.Z,{key:"delete-btn"},d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.NEGATIVE,fullWidth:!0,size:C.qE.SMALL,onClick:this.handleDelete,text:e===st.SUBTEMPLATE?"Delete sub-template":"Delete template"}))),d.createElement("div",{className:"panel-divider",key:"archive-audit-divider"}),d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,fullWidth:!0,onClick:this._exportAuditLogs,size:C.qE.SMALL,text:Tc.QU,dataTestAttrs:{component:"TemplateInformationPanelView",element:"exportAuditLogButton"}}))))}}const x5=class TemplateInformationPanelView extends X3{constructor(){super(...arguments)
this.saveModel=(e,t)=>{O5.Z.saveFileData(this.model.id,{data:{name:e,templateCollection:t},success:this.onSaveSuccess})}
this.onSaveSuccess=()=>{v.ZP.success("Template successfully updated.")}
this.deleteModel=()=>{O5.Z.delete(this.model.id,this.model.templateCollection().id)}
this.getSubpanels=()=>[{key:"information",title:"Information",component:d.createElement(BaseTemplateInformationSubpanel,{templateId:this.model.id,initialName:this.model.name(),initialCollection:this.model.templateCollection(),archiveRecord:this.model.archiveRecord(),permissions:this.model.permissions(),saveModel:this.saveModel,deleteModel:this.deleteModel})}]}}
const _5=class SubtemplateInformationPanelView extends X3{constructor(){super(...arguments)
this.saveModel=(e,t)=>{w5.Z.saveFileData(this.model.id,{data:{name:e,templateCollection:t},success:this.onSaveSuccess})}
this.onSaveSuccess=()=>{v.ZP.success("Sub-template successfully updated.")}
this.deleteModel=()=>{w5.Z.delete(this.model.id,this.model.templateCollection().id)}
this.getSubpanels=()=>[{key:"information",title:"Information",component:d.createElement(BaseTemplateInformationSubpanel,{templateId:this.model.id,initialName:this.model.name(),initialCollection:this.model.templateCollection(),archiveRecord:this.model.archiveRecord(),permissions:this.model.permissions(),saveModel:this.saveModel,deleteModel:this.deleteModel})}]}}
class TemplateHistoryPanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[gJ.Z]}enhanceProps(){return{versionState:this.templateStore().getVersionState(this.props.id),collection:this.templateStore().getCollection()}}}class TemplateHistoryPanel extends d.Component{constructor(){super(...arguments)
this.openVersion=e=>{O5.Z.loadVersion(this.props.id,e)}
this.resetToVersion=()=>{O5.Z.resetToOpenVersion(this.props.id)}
this.cloneFromVersion=()=>{(0,Xn.Z)(J3.ZP,{modelType:st.TEMPLATE,id:this.props.id,versionId:this.props.versionState.openVersionId,initialName:`${this.props.name} (new)`,initialTemplateCollection:this.props.collection})}}render(){return d.createElement(e5.Z,{openVersion:this.openVersion,resetToVersion:this.resetToVersion,cloneFromVersion:this.cloneFromVersion,versions:this.props.versionState.versions,openVersionId:this.props.versionState.openVersionId,isLatest:this.props.versionState.isLatest,unsaved:this.props.versionState.unsaved,hasParent:this.props.versionState.hasParent,parent:this.props.versionState.parent,permissions:this.props.permissions})}}const D5=TemplateHistoryPanelConnector.connect(TemplateHistoryPanel)
const L5=class TemplateHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(D5,{id:this.model.id,name:this.model.name(),permissions:this.model.permissions()})}]}}
const k5=(0,be.Z)((function AlignmentProgress({algorithm:e,created:t,numSequences:n}){return d.createElement("tr",null,d.createElement("td",null,e," with ",n," sequences, started at ",t))}))
const M5=(0,be.Z)((function AlignmentRowTemplate_AlignmentRow({name:e,time:t}){return d.createElement(d.Fragment,null,d.createElement("td",{className:"name"},d.createElement("div",null,e)),d.createElement("td",{className:"time"},d.createElement("div",null,t,d.createElement("span",{className:"glyphicon glyphicon-trash delete"}))))}))
function ToolbarSignupMessage({action:e}){return d.createElement("div",{className:(0,g.iv)(F5.container)},d.createElement(pe.Z,{icon:"info-circle",className:(0,g.iv)(F5.icon)}),d.createElement("span",null,d.createElement("a",{href:(0,de.Dv)("/signup",{next:(0,de.YW)()})},"Sign up")," for a Benchling account to ",e,"."))}const F5=g.mM.create({container:{backgroundColor:Vt.bs,padding:"10px",display:"flex",marginTop:"10px"},icon:{marginRight:"5px",marginTop:"3px",flexShrink:0,color:Vt.pp}})
function renderPanelTabs(e,t,n){(0,Me.A9)(d.createElement(KW.Z,{tabs:t.map((([t,n])=>({handleClick(){e.set("activeSubPanel",t)},isActive:e.get("activeSubPanel")===t,text:n})))}),n)}class AlignmentItemView extends s().View{static initClass(){this.prototype.template=M5
this.prototype.tagName="tr"
this.prototype.className="panel-library-row"
this.prototype.events={click:"openAlignment","click .delete":"deleteAlignment"}}initialize(e){return({checkDelete:this.checkDelete}=e)}openAlignment(e){if(!o()(e.target).hasClass("delete"))return this.model.trigger("openAlignment",this.model)}deleteAlignment(){const e=this.checkDelete(this.model),t=l.default.escape(this.model.get("name"))
function destroyCallback(){m.j("alignment","delete_alignment")
return this.model.destroy().fail((()=>v.ZP.error("An error occurred while trying to delete the alignment."))).done((()=>{v.ZP.success(`Sequence alignment **${t}** successfully deleted.`)
this.remove()
if(null!=e)return e.close()}))}destroyCallback=l.default.bind(destroyCallback,this)
const n=null==e?`Are you sure you want to delete <b>${t}</b>?`:`<b>${t}</b> is currently open in a tab - are you sure you want to delete it and close its tab?`
return new Ot.I4({title:"Confirm Deleting Alignment",msg:n}).choice("Delete","btn-af-danger",destroyCallback).choice("Cancel","btn-af-default").show()}render(){const e=new Date(this.model.get("created_at"))
this.$el.html(this.template({name:this.model.get("name"),time:Hr.UT(e)}))
return this}}AlignmentItemView.initClass()
class AlignmentPanelView extends s().View{static initClass(){this.prototype.el="#alignment-panel"
this.prototype.events={"click .new-alignment-btn":"openModal","click .js-alignment-sort":"sortAlignments"}}initialize(){return this.sort=this.sortByName}openModal(){if(null!=window.user){(0,m.j)("alignment","openModal",{source:"alignment-panel"});(0,Xn.Z)(Et.Z,{initialInputs:[{type:ft.n$.BIOENTITY,name:this.sequence.name(),id:this.sequence.get("id"),canBeTemplate:this.sequence.permissions().polymerFeaturesEditable,useCurrentVersion:!0,nucleotideType:this.sequence.nucleotideType()}]})}else window.location="/signup"}update(e,t){if(null!=this.panelState){this.stopListening(this.panelState)
this.stopListening(this.panelState.get("alignmentsInProgress"))}if(null!=this.sequence){this.stopListening(this.sequence.get("_sequence"))
this.stopListening(this.sequence.get("analyses"))}this.panelState=e
this.listenTo(this.panelState.get("alignmentsInProgress"),"add remove change",this.renderInProgress)
null!=this.sequence&&this.stopListening(this.sequence.get("analyses"))
this.sequence=t
this.buffers=e.get("buffers")
this.listenTo(this.sequence,"change:writable change:permissions change:currentVersion",this.render)
this.listenTo(this.sequence.get("_sequence"),"change:finalized",this.render)
this.listenTo(this.sequence.get("analyses"),"add remove change reset",this.render)
this.listenTo(this.sequence.get("analyses"),"openAlignment",this.openAlignment)
this.listenTo(this.sequence.get("analyses"),"newAlignment",this.newAlignment)
return this.render()}sortByName(e,t){const n=e.get("name").localeCompare(t.get("name"))
return 0!==n?n:t.get("id")-e.get("id")}sortByDate(e,t){return t.get("id")-e.get("id")}sortAlignments(e){const t=this.$(e.currentTarget)
t.addClass("hidden")
if(t.hasClass("js-sort-name")){this.$(".js-sort-time").removeClass("hidden")
this.sort=this.sortByDate}else{this.$(".js-sort-name").removeClass("hidden")
this.sort=this.sortByName}this.renderLibrary()}openAlignment(e){m.j("alignment","open_saved_alignment")
let t=this.sequence.fileState().findAlignmentTab(e)
if(null!=t){this.$el.find(".library-opening-spinner").removeClass("hidden")
setTimeout((()=>{this.sequence.fileState().setIsWorkspaceSplit(!1)
t.set("active",!0)
this.$el.find(".library-opening-spinner").addClass("hidden")
this.panelState.trigger("close")}),10)}else{this.$el.find(".library-opening-spinner").removeClass("hidden")
t=new Xv.Z({sequence:this.sequence,analysisId:e.id,alignmentId:e.get("apiId")})
this.sequence.fileState().setIsWorkspaceSplit(!1)
this.buffers.addTab(t)
e.fetch({parse:!0}).done((()=>{t.loadAnalysis(e)
this.$el.find(".library-opening-spinner").addClass("hidden")
this.panelState.trigger("close")})).fail((e=>{v.ZP.notifyError(e)
this.$el.find(".library-opening-spinner").addClass("hidden")
t.close()}))}}renderInProgress(){const e=this.panelState.get("alignmentsInProgress").map((e=>k5({algorithm:e.get("algorithm"),numSequences:e.get("numSequences"),created:Hr.UT(e.get("created"))})))
this.$(".in-progress").toggleClass("hidden",0===e.length)
return this.$(".in-progress-library tbody").html(e)}renderLibrary(){const e=this.$el.find("table.alignment-library"),t=this.sequence.get("analyses").filter((e=>e.get("analysis_type")===Y3.xy))
t.sort(this.sort)
const checkDelete=e=>this.sequence.fileState().findAlignmentTab(e),n=Array.from(t).map((e=>new AlignmentItemView({model:e,checkDelete}).render().el))
n.length>0?e.find("tbody").html(n):e.find("tbody").html(o()("<tr>").append("<td>").text("No sequence alignments."))
return this.$el.find(".panel-library-row .delete").toggleClass("hidden",!function _canDeleteAlignments(e){return e.get("permissions").polymerFeaturesEditable}(this.sequence))}render(){!function renderSinglePanelTab(e,t){(0,Me.A9)(d.createElement(KW.Z,{tabs:[{handleClick:Jt.ZT,isActive:!0,text:e}]}),t)}("Sequence Alignments",this.$(".panel-title")[0])
const e=this.$el.find(".new-alignment-btn")
null==e.data("text")&&e.data("text",e.text())
e.toggleClass("disabled",!this.sequence.allowFeatureEdits({ignoreLocked:!0})||this.sequence.isReallyBig()||!this.sequence.finalized())
if(showValueMessagingForSharedFile()){e.addClass("hide");(0,Me.A9)(d.createElement(ToolbarSignupMessage,{action:"create an alignment"}),this.$el.find(".share-link-message-react-mount")[0])}else if(null==window.user)e.text("Sign up to Create Alignment").removeClass("disabled",!1)
else if(this.sequence.allowFeatureEdits({ignoreLocked:!0})){e.text(e.data("text"))
this.sequence.isReallyBig()?this.$(".new-alignment-btn").parent().tooltip({placement:"bottom",container:"body",title:"Alignments are not currently supported for large sequences."}):this.sequence.finalized()?this.$(".new-alignment-btn").parent().tooltip("destroy"):this.$(".new-alignment-btn").parent().tooltip({placement:"bottom",container:"body",title:"Finalize the sequence from the Assembly tab to enable alignments."})}else e.text("Create Alignment Disabled when Read-Only")
this.$(".js-alignment-sort").tooltip({container:"body"})
this.renderLibrary()
this.renderInProgress()
return this}}AlignmentPanelView.initClass()
const Z5=AlignmentPanelView
var B5=n(194119),q5=n(63066)
const V5=43
const U5=g.mM.create({rowHeaderContainer:{paddingLeft:"12px",cursor:"pointer",":hover":{backgroundColor:Vt.bs}},hoveredRow:{backgroundColor:Vt.bs},activeRow:{backgroundColor:Vt.Ro},rowHeaderContent:{display:"flex",padding:"12px 4px 12px 0",borderBottom:`1px solid ${Vt.tN}`},featureName:{marginRight:"8px",maxWidth:"40%",overflow:"hidden",whiteSpace:"nowrap"},featureRange:{color:Vt.pp,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"50%"},visibilityToggle:{margin:"auto 4px auto auto"},rowCaret:{margin:"auto 0",color:Vt.pp,marginRight:"12px"},rowColorSwatch:{margin:"auto 8px auto 0"},selectedSection:{borderLeft:`2px solid ${Vt.mu}`},editForm:{borderBottom:`1px solid ${Vt.tN}`}}),G5=function FeatureRowItem({feature:e,editForm:t,contextMenuOptions:n,getFeatureName:a,getLocationString:i,onToggleVisibility:s,onHover:r,onSelect:o,rowRef:l}){const[c,u]=(0,d.useState)(!1)
return d.createElement("div",{className:f()({[(0,g.iv)(U5.selectedSection)]:e.selected}),...(0,ee.Z)({component:"SequenceFeatureRowItem",element:"root"}),ref:l},d.createElement("div",{className:f()("feature-panel-row-header",(0,g.iv)(U5.rowHeaderContainer),{[(0,g.iv)(U5.hoveredRow)]:e.hover||c,[(0,g.iv)(U5.activeRow)]:e.selected}),onClick:()=>{o(e.cid,!e.selected)},onMouseEnter:()=>{null==r||r(e.cid,!0)},onMouseLeave:()=>{null==r||r(e.cid,!1)},onContextMenu:function onShowContextMenu(e){u(!0)
ta.e.open(e.nativeEvent,n,!0,(()=>{u(!1)}))}},d.createElement("div",{className:(0,g.iv)(U5.rowHeaderContent)},d.createElement(pe.Z,{className:(0,g.iv)(U5.rowCaret),icon:e.selected?"chevron-down":"chevron-right"}),d.createElement("div",{className:(0,g.iv)(U5.rowColorSwatch)},d.createElement(ColorSwatch,{color:e.color,small:!0})),d.createElement("span",{className:(0,g.iv)(U5.featureName)},a?a(e):e.name),d.createElement("span",{className:(0,g.iv)(U5.featureRange),...(0,ee.Z)({component:"SequenceFeatureRowItem",element:"locationString"})},i(e)),null!=e.visible&&d.createElement("div",{className:(0,g.iv)(U5.visibilityToggle)},d.createElement(VisibilityToggle,{isVisible:e.visible,onClick:t=>{t.stopPropagation()
null==s||s([e.cid],!e.visible)}})))),e.selected&&d.createElement("div",{className:(0,g.iv)(U5.editForm)},t))}
var z5=n(195309)
function IndexSelectionGroup({updateEndIndex:e,updateStartIndex:t,disabled:n,endIndex:a,endPlaceholder:i,sequenceLength:s,sequenceStartIndex:r,startIndex:o,startPlaceholder:l}){var c,u
return d.createElement("div",{className:(0,g.iv)($5.positionFields)},d.createElement(or.Z,{placeholder:l||"Start",className:(0,g.iv)($5.positionInput),value:null!==(c=(0,T.modelStartToDisplay)(o,r))&&void 0!==c?c:"",onChange:e=>{t(Number.isNaN(parseInt(e.target.value,10))?null:(0,T.displayStartToModel)(parseInt(e.target.value,10),r))},disabled:n,dataTestAttrs:{component:"IndexSelectionGroup",element:"startInput"}}),d.createElement("h3",{className:(0,g.iv)($5.positionDash)},"-"),d.createElement(or.Z,{className:(0,g.iv)($5.positionInput),placeholder:i||"End",value:null!==(u=(0,T.modelEndToDisplay)(a,s,r))&&void 0!==u?u:"",onChange:t=>{e(Number.isNaN(parseInt(t.target.value,10))?null:(0,T.displayEndToModel)(parseInt(t.target.value,10),s,r))},disabled:n,dataTestAttrs:{component:"IndexSelectionGroup",element:"endInput"}}))}const $5=g.mM.create({positionDash:{margin:"auto 12px"},positionFields:{display:"flex"},positionInput:{width:"72px"}})
function AddCustomFieldMenu({onAddField:e,allCustomFieldKeyOptions:t}){const[n,a]=(0,d.useState)(!1),[i,s]=(0,d.useState)(""),r=t.map((e=>({name:e,value:e})))
return d.createElement(I.ZP,{alwaysDropDown:!0,isOpen:n,menu:d.createElement(Ar.Z,{width:Nr.zL.MEDIUM,height:Nr.Bl.MEDIUM,onSelect:function handleSelectKey(t){e(0===t.length?i:t)},optionDatas:r,selectedValue:null,getMatchingOptionDatas:(e,n)=>function getMatchingOptionDatas(e,n){const a=e.trim()
s(a)
return 0===a.length?r:/\s/.test(a)||t.includes(a)?n.filter((({value:e})=>e.includes(a))):[...n.filter((({value:e})=>e.includes(a))),{name:d.createElement("p",{className:(0,g.iv)(W5.createNewOption)},`Create new '${a}' field`),value:""}]}(e,n)}),onToggle:e=>{a(e)}},d.createElement(vy.Z,{className:(0,g.iv)(W5.addIcon),onClick:()=>{a(!0)}}))}function CustomFieldItem({fieldName:e,fieldValue:t,onUpdateCustomField:n,onRemoveCustomField:a,isReadOnly:i}){return d.createElement(Ke.Z,{className:(0,g.iv)(W5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(W5.fieldText),label:e}),i?d.createElement("p",{className:(0,g.iv)(W5.fieldText)},t):d.createElement("div",{className:(0,g.iv)(W5.fieldValueContainer)},d.createElement(or.Z,{value:t,onChange:t=>{n({name:e,value:t.target.value})},placeholder:"Enter value"}),d.createElement(pe.Z,{className:(0,g.iv)(W5.deleteIcon),icon:"close",onClick:()=>{a()}})))}function CustomFieldList({customFields:e,onUpdateCustomField:t,onRemoveCustomField:n,emptyFieldsMessage:a,isReadOnly:i}){return 0===e.length?d.createElement("div",{className:(0,g.iv)(W5.emptyListRow)},a):d.createElement("div",{className:(0,g.iv)(W5.fieldsContainer)},e.map((({name:e,value:a},s)=>d.createElement(CustomFieldItem,{key:s,fieldName:e,fieldValue:a,onUpdateCustomField:e=>{t(s,e)},onRemoveCustomField:()=>{n(s)},isReadOnly:i}))))}const W5=g.mM.create({formContainer:{border:`1px solid ${Vt.tN}`,borderRadius:"4px"},formHeader:{..._n.sE,display:"flex",backgroundColor:Vt.bs,borderBottom:`1px solid ${Vt.tN}`,padding:"8px"},addIcon:{marginTop:"2px",marginLeft:"8px"},emptyListRow:{display:"flex",alignItems:"center",padding:"8px"},fieldsContainer:{padding:"4px 8px"},fieldRow:{display:"flex",justifyContent:"space-between",margin:"8px 0"},fieldText:{marginBottom:"0",marginTop:"4px"},fieldValueContainer:{display:"flex"},deleteIcon:{marginLeft:"12px",marginTop:"8px",width:"12px",height:"12px",color:Vt.pp,cursor:"pointer"},createNewOption:{color:Vt.Ej,marginBottom:"0"}}),H5=function CustomFieldsForm({className:e,customFields:t,setCustomFields:n,allCustomFieldKeys:a,emptyFieldsMessage:i,isReadOnly:s}){return d.createElement("div",{className:f()((0,g.iv)(W5.formContainer),e)},d.createElement("div",{className:(0,g.iv)(W5.formHeader)},d.createElement("div",null,"Custom fields"),!s&&d.createElement(AddCustomFieldMenu,{onAddField:function onAddCustomField(e){n([...t,{name:e,value:""}])},allCustomFieldKeyOptions:a})),d.createElement(CustomFieldList,{customFields:t,onUpdateCustomField:function onUpdateCustomField(e,a){n([...t.slice(0,e),a,...t.slice(e+1)])},onRemoveCustomField:function onRemoveCustomField(e){n(t.filter(((t,n)=>n!==e)))},emptyFieldsMessage:i,isReadOnly:s}))},j5={mapDispatchToProps:e=>({updateEditFormData:(t,n)=>{e((0,B5.BE)(t,n))}})}
const Y5=g.mM.create({newAnnotationTitle:{marginBottom:"16px"},formContainer:{padding:"12px"},buttonRow:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${Vt.tN}`,paddingTop:"16px"},fieldRow:{display:"flex",justifyContent:"space-between"},fieldInput:{width:"172px"},fieldInputLabel:{margin:"auto 0"},notesLabel:{marginTop:6}}),Q5=function CreateEditAnnotationForm({initialAnnotationData:e,sequenceId:t,sequenceStartIndex:n,sequenceLength:a,isSingleStranded:i,allAnnotationTypes:s,allAnnotationFieldKeys:r,onClickSave:o,onClickCancel:l,isReadOnly:c}){const{isCreateActive:u,shouldFocus:p,...h}=(0,z5.z4)(t),E=(0,_a.I0)(),{updateEditFormData:f}=j5.mapDispatchToProps(E),S=(0,d.useRef)(null);(0,d.useEffect)((()=>{setTimeout((()=>{if(S.current&&p){S.current.focus()
E((0,B5.mw)(t))}}),0)}),[p,E,t])
return d.createElement("div",{className:(0,g.iv)(Y5.formContainer),onKeyDown:e=>{!c&&(0,pn.isEnterKey)(e)&&o(h)},...(0,ee.Z)({component:"CreateEditAnnotationForm",element:"root"})},u&&d.createElement(Fr.Z,{className:(0,g.iv)(Y5.newAnnotationTitle),label:"New annotation"}),d.createElement(Ke.Z,{className:(0,g.iv)(Y5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(Y5.fieldInputLabel),label:"Name"}),d.createElement(or.Z,{className:(0,g.iv)(Y5.fieldInput),placeholder:"Annotation name",value:h.name,onChange:e=>{f(t,{name:e.target.value})},onBlur:()=>{(null==e?void 0:e.name)!==h.name&&m.j("annotation","edited_name",{product:j.XC.MOLBIO,sequence_id:t})},ref:S,disabled:c,dataTestAttrs:{component:"CreateEditAnnotationForm",element:"nameInput"}})),d.createElement(Ke.Z,{className:(0,g.iv)(Y5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(Y5.fieldInputLabel),label:"Position"}),d.createElement(IndexSelectionGroup,{endIndex:h.end,sequenceLength:a,sequenceStartIndex:n,startIndex:h.start,updateEndIndex:e=>{f(t,{end:e})},updateStartIndex:e=>{f(t,{start:e})},disabled:c})),d.createElement(Ke.Z,{className:(0,g.iv)(Y5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(Y5.fieldInputLabel),label:"Annotation type"}),d.createElement(AnnotationTypeDropdownInput,{className:(0,g.iv)(Y5.fieldInput),type:h.annotationType,allTypes:s,onChangeType:e=>{f(t,{annotationType:e})},onBlur:()=>{(null==e?void 0:e.annotation_type)!==h.annotationType&&m.j("annotation","edited_annotation_type",{product:j.XC.MOLBIO,sequence_id:t})},disabled:c})),d.createElement(Ke.Z,{className:(0,g.iv)(Y5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(Y5.fieldInputLabel),label:"Color"}),d.createElement(PopoverColorPicker,{selectedColor:h.color,onSelectColor:e=>{f(t,{color:e})},asDropdown:!0,disabled:c})),d.createElement(Ke.Z,{className:(0,g.iv)(Y5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(Y5.fieldInputLabel),label:"Strand"}),d.createElement(Mr,{className:(0,g.iv)(Y5.fieldInput),strand:h.strand,onSelectStrand:e=>{f(t,{strand:e})},disabled:i||c})),d.createElement(Ke.Z,{className:(0,g.iv)(Y5.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(Y5.notesLabel),label:"Notes"}),d.createElement("textarea",{className:(0,g.iv)(Y5.fieldInput),placeholder:"Notes",maxLength:fn.nZ,value:h.notes,onChange:e=>{f(t,{notes:e.target.value})},rows:h.notes?3:1,disabled:c})),d.createElement(H5,{customFields:h.customFields,setCustomFields:e=>{f(t,{customFields:e})},allCustomFieldKeys:r,emptyFieldsMessage:"This annotation has no custom fields",isReadOnly:c}),d.createElement("div",{className:(0,g.iv)(Y5.buttonRow)},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.SMALL,onClick:l,text:"Cancel"}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,onClick:()=>{o(h)},text:"Save",disabled:c,dataTestAttrs:{component:"CreateEditAnnotationForm",element:"saveButton"}})))}
function AnnotationPanelRow({index:e,data:t,style:n}){const a=t.sortedAnnotationsData[e],i=t.canEditSequenceFeatures&&a.editable,s={...n,maxHeight:n.height,overflow:"auto"},r=[{name:"Remove annotation",click:()=>{t.onDeleteAnnotation(a.cid)},hide:!i},{name:"Expand annotation",click:()=>{t.openExpandedAnnotations()}}]
return d.createElement("div",{style:s},d.createElement(G5,{key:a.cid,feature:a,getLocationString:e=>`${e.displayStart}-${e.displayEnd}`,onToggleVisibility:t.onToggleVisibility,onHover:t.onAnnotationHover,onSelect:t.onSelectAnnotation,editForm:d.createElement(Q5,{initialAnnotationData:a,onClickSave:e=>{t.onSaveAnnotation(a.cid,e)},onClickCancel:()=>{t.onSelectAnnotation(a.cid,!1)},sequenceId:t.sequenceId,sequenceStartIndex:t.sequenceStartIndex,sequenceLength:t.sequenceLength,isSingleStranded:t.isSingleStranded,allAnnotationTypes:t.allAnnotationTypes,allAnnotationFieldKeys:t.allCustomFieldKeys,isReadOnly:!t.canEditSequenceFeatures||!a.editable}),contextMenuOptions:r}))}function AnnotationPanelContent({sortedAnnotationsData:e,canEditSequenceFeatures:t,sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,hasDuplicateAnnotations:r,onToggleVisibility:o,onAnnotationHover:l,onSelectAnnotation:c,onSaveAnnotation:u,onClickAutoAnnotate:p,onDeleteAnnotation:h,onOpenCleanDuplicates:E,openExpandedAnnotations:f,className:S}){const{isCreateActive:y}=(0,z5.z4)(n),b=(0,_a.I0)(),T=Jn.Z.currentUser(),v=T&&`/${T.url_identifier}/feature-libraries/`,I=getUniqueNonEmptyAnnotationTypes(e),w=[...new Set(e.flatMap((e=>e.custom_fields.map((({name:e})=>e)))))],N=e.findIndex((e=>e.selected)),A=(0,d.useRef)(null);(0,d.useEffect)((()=>{var e,t
null===(e=A.current)||void 0===e||e.resetAfterIndex(0);-1!==N&&(null===(t=A.current)||void 0===t||t.scrollToItem(N,"start"))}),[N])
return d.createElement("div",{className:S,...(0,ee.Z)({component:"AnnotationPanelContent",element:"root"})},d.createElement("div",null,d.createElement("div",{className:(0,g.iv)(K5.buttonRow)},d.createElement(AnnotationTypeVisibilityDropdown,{annotations:e,onToggleVisibility:o,useCompactSize:!0}),t&&d.createElement(C.Co,{className:(0,g.iv)(K5.createNewButton),buttonStyle:C.ZJ.SECONDARY,size:C.qE.MINI,onClick:function onClickCreateNew(){m.j("annotation","new_annotation_click",{product:j.XC.MOLBIO,sequence_id:n});-1!==N&&c(e[N].cid,!1)
b((0,B5.ml)(n))},text:"Create new",dataTestAttrs:{component:"AnnotationPanelContent",element:"createNewButton"}})),d.createElement("div",{className:(0,g.iv)(K5.countRow)},d.createElement("p",null,e.length," total"),d.createElement("p",null,e.filter((({visible:e})=>!e)).length," hidden"))),d.createElement("div",{className:(0,g.iv)(K5.annotationRowsSection)},d.createElement(q5.S_,{ref:A,itemData:{sortedAnnotationsData:e,onAnnotationHover:l,onToggleVisibility:o,onSaveAnnotation:u,sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,canEditSequenceFeatures:t,onDeleteAnnotation:h,openExpandedAnnotations:f,allAnnotationTypes:I,allCustomFieldKeys:w,onSelectAnnotation:c},height:-1===N?200:590,width:"100%",itemCount:e.length,overscanCount:20,itemSize:function getAnnotationPanelRowHeight(t){var n
return(null===(n=e[t])||void 0===n?void 0:n.selected)?258+(e[t].notes?80:50)+(35+44*Math.max(e[t].custom_fields.length,1))+(e[t].editable?45:0)+20:V5},estimatedItemSize:V5,itemKey:t=>`annotationPanelRow-${e[t].cid}`},AnnotationPanelRow)),y&&t&&d.createElement(Q5,{initialAnnotationData:null,onClickSave:e=>{u(null,e)},onClickCancel:()=>{b((0,B5.WJ)(n))},sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,allAnnotationTypes:I,allAnnotationFieldKeys:w,isReadOnly:!1}),r&&t&&d.createElement(aN.Z,null,"Duplicate annotations found.",d.createElement(C.Co,{className:(0,g.iv)(K5.cleanDuplicatesButton),buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.MINI,onClick:E,text:"Clean duplicates"})),(!y||!t)&&d.createElement("div",null,d.createElement(C.Co,{className:(0,g.iv)(K5.expandedViewButton),buttonStyle:C.ZJ.LINK,disabled:!1,onClick:f,text:"Show expanded view",dataTestAttrs:{component:"AnnotationPanelContent",element:"expandedAnnotationsLink"}}),t&&d.createElement("div",{className:(0,g.iv)(K5.buttonRow)},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MINI,onClick:p,text:"Auto-annotate",dataTestAttrs:{component:"AnnotationPanelContent",element:"autoAnnotateButton"}}),(0,ln.cr)({feature:on.Ot.MOLBIO_ADMIN})&&d.createElement(C.ZP,{buttonStyle:C.ZJ.LINK,href:v,target:"_blank",text:"Edit feature libraries"}))))}const K5=g.mM.create({buttonRow:{display:"flex",justifyContent:"space-between",padding:"8px 12px"},countRow:{display:"flex",justifyContent:"space-between",color:Vt.pp,paddingLeft:"12px",paddingRight:"12px"},annotationRowsSection:{borderTop:`1px solid ${Vt.tN}`,borderBottom:`1px solid ${Vt.tN}`},expandedViewButton:{width:"100%",padding:"8px 0",borderBottom:`1px solid ${Vt.tN}`},cleanDuplicatesButton:{marginLeft:"8px"},createNewButton:{marginTop:"2px"}})
var J5=n(285290)
const X5=g.mM.create({selectedFieldRow:{backgroundColor:Vt.Ro,padding:"4px 12px",marginBottom:"11px"},positionFields:{display:"flex"},deleteIcon:{marginTop:"8px",marginLeft:"10px",width:"10px",height:"10px",color:Vt.pp,cursor:"pointer"}}),e6=function TranslationPositionInputGroup({label:e,modelRange:t,setStart:n,setEnd:a,disabled:i,sequenceStartIndex:s,sequenceLength:r,regionLabelClassName:o,onDeleteRegion:l}){return d.createElement(Ke.Z,{className:f()((0,g.iv)(s6.fieldRow),{[(0,g.iv)(X5.selectedFieldRow)]:t.selected})},d.createElement(Fr.Z,{className:o,label:e}),d.createElement("div",{className:(0,g.iv)(X5.positionFields)},d.createElement(IndexSelectionGroup,{updateEndIndex:a,updateStartIndex:n,disabled:i,endIndex:t.end,startIndex:t.start,sequenceLength:r,sequenceStartIndex:s}),null!=l&&d.createElement(pe.Z,{className:(0,g.iv)(X5.deleteIcon),icon:"close",onClick:()=>{l(t.id)}})))}
function translationPositionToString(e,t,n){return e.translations.map((({start:e,end:a})=>`${(0,T.modelStartToDisplay)(e,t)}-${(0,T.modelEndToDisplay)(a,n,t)}`)).join(", ")}function getTranslationPanelProps(e,t){if(!e.supportsTranslations())return null
const n=(0,Jt.Pe)(e.translations().models,(e=>e.id)),a=(0,Nn.KB)(e),i=(0,Jt.Pe)(a,(e=>e.cid))
return{sortedTranslationRegionGroups:(0,hs.Z)(a,[e=>e.translations[0].start]),canEditSequenceFeatures:e.allowFeatureEdits(),sequenceId:e.id,sequenceLength:e.length(),sequenceStartIndex:e.startIndex(),isSingleStranded:e.isSingleStranded(),isCircularSequence:e.circular(),onSelectTranslation:(t,a)=>{const s=i[t]
if(a){const t=n[s.translations[0].id]
e.selection().select(t)
e.trigger("jump",t.start())}else for(const e of s.translations){n[e.id].set({selected:!1})}},deleteTranslationRegionGroup:async t=>{const a=i[t]
if(await(0,Nn.am)(e.tagSchema(),!1,a.codonTranslationTable!==R.hR.STANDARD,1)){if(a.hasGroup)e.deleteTranslationGroup(parseInt(t,10))
else{const t=n[a.translations[0].id]
e.deleteFeature(t)}v.ZP.success("Successfully deleted translation")
m.j("translation","deleted_translations",{product:j.XC.MOLBIO,sequence_id:e.id,source:"translations-panel",translation_ids:a.translations.map((({id:e})=>e))})}},editTranslationRegionGroup:async(t,a)=>{const{hasGroup:s,translations:r}=i[t]
let o
if(s)o=await(0,gl.rd)(e.id,parseInt(t,10),a)
else{const t={modificationType:gl.u8.UPDATE,id:r[0].id},n=a.regions.filter((({modificationType:e})=>e===gl.u8.UPDATE)),i={...a,regions:n.length>0?a.regions:[...a.regions,t]}
o=await(0,gl.NG)(e.id,i)}const{translationGroup:l,translationRegions:c}=o,d=r.map((({id:e})=>n[e]));(0,Nn._x)(e,[l],c,d);(0,Vn.getStore)().dispatch((0,B5.xe)(e.id))
v.ZP.success(`Successfully saved translation ${l.name}`)
m.j("translation","updated_translations",{product:j.XC.MOLBIO,sequence_id:e.id,source:"translations-panel",translation_group_ids:[l.id],translation_ids:c.map((({id:e})=>e))})},createNewTranslationRegionGroup:async t=>{const{translationGroup:n,translationRegions:a}=await(0,gl.NG)(e.id,{properties:{name:t.name,notes:t.notes,customFields:t.customFields,codonTranslationTable:t.codonTranslationTable,color:t.color},regions:[{modificationType:gl.u8.CREATE,start:t.start,end:t.end,strand:t.strand}]});(0,Nn._x)(e,[n],a,[]);(0,Vn.getStore)().dispatch((0,B5.xe)(e.id))
v.ZP.success(`Successfully saved translation ${n.name}`)
m.j("translation","created_translation",{product:j.XC.MOLBIO,sequence_id:e.id,source:"translations-panel",translation_group_ids:[n.id],translation_ids:a.map((({id:e})=>e))})},openExpandedTranslations:()=>{e.fileState().openTranslationTabView()
t.trigger("close")},tagSchema:e.tagSchema()}}const t6=[1,-1,0]
const n6=g.mM.create({optionSubtext:{..._n.XI,color:Vt.TG,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginBottom:"0"}}),a6=function TranslationsDropdown({selectedTranslation:e,onChangeSelectedTranslation:t,allTranslationData:n,sequenceStartIndex:a,sequenceLength:i,selectedStrand:s,region:r}){const[o,l]=(0,d.useState)({}),[c,u]=(0,d.useState)(t6);(0,d.useEffect)((()=>{l((0,Jt.vM)(n,(e=>e.strand)))}),[n]);(0,d.useEffect)((()=>{u([s,...t6.filter((e=>e!==s))])}),[s])
return d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{label:"Add as region to"}),d.createElement($r.ZP,{className:(0,g.iv)(s6.fieldInput),displayName:null==e?"Select translation":(0,Nn.j5)(e,a,i),alwaysDropDown:!0,menu:d.createElement(w.ZP,{value:null==e?void 0:e.cid,width:Nr.zL.FULL,scrollable:!0},c.map((e=>{var n
return d.createElement(jI.Z,{key:e},d.createElement(YI.Z,null,(0,An.FC)(e)),(null!==(n=o[e])&&void 0!==n?n:[]).map((e=>d.createElement(N.Z,{onSelect:()=>{t(e)},value:e.cid,key:e.cid,isDisabled:e.strand!==s||(0,Nn.pN)(e,r.start,r.end),tooltipTitle:(0,Nn.pN)(e,r.start,r.end)?"Translation regions cannot overlap":""},(0,Nn.j5)(e,a,i),d.createElement("p",{className:(0,g.iv)(n6.optionSubtext)},translationPositionToString(e,a,i))))))})))}))}
var i6
!function(e){e.NEW="NEW"
e.EXISTING="EXISTING"}(i6||(i6={}))
function getFormDataFromTranslation(e,t){var n,a,i,s,r,o
return{addingNew:!0,name:null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"",strand:null!==(a=null==e?void 0:e.strand)&&void 0!==a?a:1,notes:null!==(i=null==e?void 0:e.notes)&&void 0!==i?i:"",customFields:null!==(s=null==e?void 0:e.customFields)&&void 0!==s?s:[],codonTranslationTable:null!==(r=null==e?void 0:e.codonTranslationTable)&&void 0!==r?r:t,color:null!==(o=null==e?void 0:e.color)&&void 0!==o?o:Nn.aP}}function getAllUniqueCustomFieldKeys(e){return[...new Set(e.flatMap((({customFields:e})=>e.map((({name:e})=>e)))))]}const s6=g.mM.create({fieldRow:{display:"flex",justifyContent:"space-between",padding:"0 12px"},inputLabel:{margin:"auto 0"},fieldInput:{width:"172px"}}),r6=g.mM.create({createNewToggle:{padding:"0 12px"},newTranslationTitle:{marginBottom:"16px"},formContainer:{padding:"12px 0"},buttonRow:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${Vt.tN}`,padding:"16px 10px 0"},regionsSectionLabel:{color:Vt.pp,borderBottom:`1px solid ${Vt.tN}`,width:"calc(100% - 24px)",margin:"0 12px 12px",paddingBottom:"8px"},regionsLabel:{fontWeight:_n.hS,margin:"auto 0"},customFields:{margin:"16px 12px"},notesLabel:{marginTop:6}}),o6=function CreateEditTranslationForm({allTranslationData:e,editedTranslationData:t,sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,isCircularSequence:r,onClickCancel:o,deleteTranslationRegionGroup:l,editTranslationRegionGroup:c,createNewTranslationRegionGroup:u,isReadOnly:p,tagSchema:h}){const[E,f]=(0,Ln.Z)(R.BU),[S,y]=(0,d.useState)(getFormDataFromTranslation(t,E)),[b,I]=(0,d.useState)(t),[w,N]=(0,d.useState)([]),[A,P]=(0,d.useState)(null),[O,x]=(0,d.useState)(null),{translationPanelState:_,selectionStart:D,selectionEnd:L}=(0,z5.Jv)(n),{isCreateActive:k,initialStrand:M}=_,F=k&&!S.addingNew,Z=k&&S.addingNew,B=F&&!b||k&&(null==A||null==O)||p;(0,d.useEffect)((()=>{if(k){P(D)
x(L)}}),[k,D,L,P,x]);(0,d.useEffect)((()=>{var e
const t=null!==(e=null==b?void 0:b.translations.map((e=>({start:e.start,end:e.end,id:e.id}))))&&void 0!==e?e:[]
N(k?[...t,{start:A,end:O}]:t)}),[b,A,O,k]);(0,d.useEffect)((()=>{k||I(t)}),[t,k]);(0,d.useEffect)((()=>{if(k){y((e=>({...e,strand:null!=M?M:1})))
I(null)}}),[k,M]);(0,d.useEffect)((()=>{k&&I(null)}),[k,S.strand])
function updateFormData(e){y({...S,...e})}function translationGroupRange(){const e=w.filter((({start:e,end:t})=>null!=e&&null!=t))
return 0===e.length?{start:A,end:O}:{start:e[0].start,end:e[e.length-1].end}}function trackOnClickSave(e,t){let a={translation_group_id:null,translation_id:null}
"create_new"!==e&&(a={translation_group_id:b.hasGroup?parseInt(b.cid,10):null,translation_id:b.hasGroup?null:null==b?void 0:b.translations[0].id})
m.j("translation","on_click_save",{product:j.XC.MOLBIO,sequence_id:n,action:e,edited_fields:null!=t?t:[],...a})}async function onClickSave(){const e={name:S.name,notes:S.notes,customFields:S.customFields,codonTranslationTable:S.codonTranslationTable,color:S.color},n=O===i?0:O,s={start:A,end:n,strand:S.strand}
if(w.length>0){const e=(0,Nn.vj)({name:S.name,translationRegionGroup:b,isCreateActive:k,start:A,end:n,customFields:S.customFields},a,i,r)
if(null!=e){v.ZP.error(e)
return}}if(Z){u({...e,...s})
trackOnClickSave("create_new")
f(e.codonTranslationTable)}else if(F){c(b.cid,{regions:[{modificationType:gl.u8.CREATE,...s}]})
trackOnClickSave("add_to_existing")}else if(0===w.length){await l(b.cid)
trackOnClickSave("delete")}else{const n=Nn.GX.filter((e=>S[e]!==b[e])),a=n.includes("codonTranslationTable"),i=a&&(null==t?void 0:t.codonTranslationTable)!==R.hR.STANDARD
if(!await(0,Nn.am)(h,i,!1,1))return
c(b.cid,{regions:b.translations.map((({id:e})=>function getModificationSpec(e){const t=w.map((({id:e})=>e))
return t.includes(e)?S.strand!==b.strand?{modificationType:gl.u8.UPDATE,id:e,strand:S.strand}:null:{modificationType:gl.u8.DELETE,id:e}}(e))).filter((e=>null!=e)),properties:e})
trackOnClickSave("edit",n)
a&&f(e.codonTranslationTable)}}return d.createElement("div",{className:(0,g.iv)(r6.formContainer),onKeyDown:e=>{!B&&(0,pn.isEnterKey)(e)&&onClickSave()},...(0,ee.Z)({component:"CreateEditTranslationForm",element:"root"})},k&&d.createElement(Ke.Z,{className:(0,g.iv)(r6.createNewToggle)},d.createElement(Fr.Z,{className:(0,g.iv)(r6.newTranslationTitle),label:"Create translation"}),d.createElement(kt.Z,{options:[{id:i6.NEW,buttonProps:{text:"Add new"}},{id:i6.EXISTING,buttonProps:{text:"Add to existing"}}],selection:S.addingNew?i6.NEW:i6.EXISTING,onChangeSelection:e=>{updateFormData({addingNew:e===i6.NEW})
e===i6.NEW&&I(null)},size:C.qE.MEDIUM,isFullWidth:!0,disabled:0===e.length})),F&&d.createElement(d.Fragment,null,null==b&&d.createElement(e6,{label:"Position",modelRange:translationGroupRange(),setStart:P,setEnd:x,disabled:!1,sequenceStartIndex:a,sequenceLength:i}),d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(s6.inputLabel),label:"Strand"}),d.createElement(Mr,{className:(0,g.iv)(s6.fieldInput),strand:S.strand,onSelectStrand:e=>{updateFormData({strand:e})},disabled:s,allowNone:!1})),d.createElement(a6,{selectedTranslation:b,onChangeSelectedTranslation:function onChangeExistingTranslation(e){I(e)
y({...getFormDataFromTranslation(e,E),addingNew:!1})},allTranslationData:e.filter((({editable:e})=>e)),sequenceStartIndex:a,sequenceLength:i,selectedStrand:S.strand,region:{start:A,end:O}})),!F&&d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(s6.inputLabel),label:"Name"}),d.createElement(or.Z,{className:(0,g.iv)(s6.fieldInput),placeholder:"Translation name",value:S.name,onChange:e=>{updateFormData({name:e.target.value})},disabled:F||p,dataTestAttrs:{component:"CreateEditTranslationForm",element:"nameInput"}})),!(F&&null==b)&&d.createElement(d.Fragment,null,d.createElement(e6,{label:"Position",modelRange:translationGroupRange(),setStart:P,setEnd:x,disabled:!Z,sequenceStartIndex:a,sequenceLength:i}),d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(s6.inputLabel),label:"# of AA's"}),d.createElement(or.Z,{className:(0,g.iv)(s6.fieldInput),value:function aaLengthOfRegions(){const e=(0,de.Sm)(w.map((({start:e,end:t})=>null!=e&&null!=t?(0,T.length)(e,t,i):0)))
return Math.floor(e/3)}(),disabled:!0}))),!(F&&null==b)&&d.createElement(d.Fragment,null,d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(s6.inputLabel),label:"Genetic code"}),d.createElement(fl.Z,{className:(0,g.iv)(s6.fieldInput),geneticCode:S.codonTranslationTable,onSelectGeneticCode:e=>{updateFormData({codonTranslationTable:e})
m.j("translation","changed_genetic_code",{product:j.XC.MOLBIO,sequence_id:n})},disabled:F||p})),d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(s6.inputLabel),label:"Color"}),d.createElement(PopoverColorPicker,{selectedColor:S.color,onSelectColor:e=>{updateFormData({color:e})},asDropdown:!0,disabled:p||F}))),!F&&d.createElement(d.Fragment,null,d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(s6.inputLabel),label:"Strand"}),d.createElement(Mr,{className:(0,g.iv)(s6.fieldInput),strand:S.strand,onSelectStrand:e=>{updateFormData({strand:e})},disabled:s||p,allowNone:!1})),d.createElement(Ke.Z,{className:(0,g.iv)(s6.fieldRow)},d.createElement(Fr.Z,{className:(0,g.iv)(r6.notesLabel),label:"Notes"}),d.createElement("textarea",{className:(0,g.iv)(s6.fieldInput),placeholder:"Notes",maxLength:fn.o$,value:S.notes,onChange:e=>{updateFormData({notes:e.target.value})},rows:S.notes?3:1,disabled:p}))),!(F&&null==b)&&d.createElement(H5,{className:(0,g.iv)(r6.customFields),customFields:S.customFields,setCustomFields:e=>{updateFormData({customFields:e})},allCustomFieldKeys:getAllUniqueCustomFieldKeys(e),emptyFieldsMessage:"This translation has no custom fields",isReadOnly:F||p}),!Z&&null!=b&&d.createElement(d.Fragment,null,d.createElement(Fr.Z,{className:(0,g.iv)(r6.regionsSectionLabel),label:"Regions"}),w.map(((e,t)=>d.createElement(e6,{key:t,regionLabelClassName:(0,g.iv)(r6.regionsLabel),label:`Region ${t+1}`,modelRange:e,setStart:P,setEnd:x,disabled:!k||t<w.length-1,sequenceStartIndex:a,sequenceLength:i,onDeleteRegion:k||p?null:e=>{N(w.filter((({id:t})=>t!==e)))}})))),d.createElement("div",{className:(0,g.iv)(r6.buttonRow)},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_BLUE,size:C.qE.SMALL,onClick:o,text:"Cancel"}),d.createElement(C.Co,{buttonStyle:C.ZJ.PRIMARY,size:C.qE.SMALL,onClick:onClickSave,text:"Save",disabled:B,dataTestAttrs:{component:"CreateEditTranslationForm",element:"saveButton"}})))}
function TranslationPanelRow({index:e,data:t,style:n}){const a=t.sortedTranslationRegionGroups[e],i={...n,maxHeight:n.height,overflow:"auto"},s=[{name:"Remove translation",click:()=>{t.deleteTranslationRegionGroup(a.cid)},hide:!t.canEditSequenceFeatures||!a.editable},{name:"Expand translation",click:t.openExpandedTranslations}]
return d.createElement("div",{style:i},d.createElement(G5,{key:a.cid,feature:a,getFeatureName:e=>(0,Nn.j5)(e,t.sequenceStartIndex,t.sequenceLength),getLocationString:e=>translationPositionToString(e,t.sequenceStartIndex,t.sequenceLength),editForm:d.createElement(o6,{allTranslationData:t.sortedTranslationRegionGroups,editedTranslationData:a,sequenceId:t.sequenceId,sequenceStartIndex:t.sequenceStartIndex,sequenceLength:t.sequenceLength,isSingleStranded:t.isSingleStranded,isCircularSequence:t.isCircularSequence,onClickCancel:()=>{t.onSelectTranslation(a.cid,!1)},editTranslationRegionGroup:t.editTranslationRegionGroup,createNewTranslationRegionGroup:t.createNewTranslationRegionGroup,deleteTranslationRegionGroup:t.deleteTranslationRegionGroup,isReadOnly:!t.canEditSequenceFeatures||!a.editable,tagSchema:t.tagSchema}),contextMenuOptions:s,onSelect:t.onSelectTranslation}))}function TranslationPanelContent({sortedTranslationRegionGroups:e,canEditSequenceFeatures:t,sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,isCircularSequence:r,onSelectTranslation:o,deleteTranslationRegionGroup:l,editTranslationRegionGroup:c,createNewTranslationRegionGroup:u,openExpandedTranslations:m,tagSchema:p,className:h}){const{translationPanelState:E}=(0,z5.Jv)(n),f=(0,_a.I0)(),S=e.findIndex((e=>e.selected)),y=(0,d.useRef)(null),b=(0,d.useRef)(null);(0,d.useEffect)((()=>{var e,t
null===(e=y.current)||void 0===e||e.resetAfterIndex(0);-1!==S&&(null===(t=y.current)||void 0===t||t.scrollToItem(S,"start"))}),[S]);(0,d.useEffect)((()=>{null!=b.current&&E.isCreateActive&&(b.current.scrollTop=b.current.scrollHeight)}),[E.isCreateActive])
return d.createElement("div",{ref:b,className:h,...(0,ee.Z)({component:"TranslationPanelContent",element:"root"})},t&&d.createElement("div",{className:(0,g.iv)(l6.createButton)},d.createElement(C.Co,{buttonStyle:C.ZJ.SECONDARY,size:C.qE.MINI,onClick:function onClickCreate(){-1!==S&&o(e[S].cid,!1)
f((0,B5.$d)(n))},text:"Create new",dataTestAttrs:{component:"TranslationPanelContent",element:"createNewButton"}})),d.createElement("div",{className:(0,g.iv)(l6.translationRowsSection)},d.createElement(q5.S_,{ref:y,itemData:{sortedTranslationRegionGroups:e,canEditSequenceFeatures:t,sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,isCircularSequence:r,onSelectTranslation:o,deleteTranslationRegionGroup:l,editTranslationRegionGroup:c,createNewTranslationRegionGroup:u,openExpandedTranslations:m,tagSchema:p},height:-1===S?200:590,width:"100%",itemCount:e.length,overscanCount:20,itemSize:function getTranslationPanelRowHeight(t){var n
return(null===(n=e[t])||void 0===n?void 0:n.selected)?301+(e[t].notes?80:50)+(e[t].codonTranslationTable===R.hR.STANDARD?0:30)+(56+44*Math.max(e[t].customFields.length,1))+(38+43*e[t].translations.length)+(e[t].editable?45:0)+28:V5},estimatedItemSize:V5,itemKey:t=>`translationPanelRow-${e[t].cid}`},TranslationPanelRow)),E.isCreateActive&&t?d.createElement(o6,{allTranslationData:e,editedTranslationData:null,sequenceId:n,sequenceStartIndex:a,sequenceLength:i,isSingleStranded:s,isCircularSequence:r,onClickCancel:()=>{f((0,B5.xe)(n))},deleteTranslationRegionGroup:l,editTranslationRegionGroup:c,createNewTranslationRegionGroup:u,isReadOnly:!1,tagSchema:p}):d.createElement(C.Co,{className:(0,g.iv)(l6.expandedViewButton),buttonStyle:C.ZJ.LINK,onClick:m,text:"Show expanded view",dataTestAttrs:{component:"TranslationPanelContent",element:"expandedTranslationsLink"}}))}const l6=g.mM.create({createButton:{display:"flex",justifyContent:"flex-end",padding:"8px 12px"},translationRowsSection:{borderTop:`1px solid ${Vt.tN}`,borderBottom:`1px solid ${Vt.tN}`},expandedViewButton:{width:"100%",padding:"8px 0",borderBottom:`1px solid ${Vt.tN}`}})
const c6=g.mM.create({featurePanelWrapper:{maxHeight:"inherit"},tabContainer:{display:"flex",flexDirection:"column",maxHeight:"inherit"},paneContainer:{marginTop:"0"},navTabs:{padding:"12px 12px 6px",marginBottom:"0"},panelContents:{overflowY:"auto"}}),d6=function FeaturePanel({activeTab:e=J5.NK,setActiveTab:t,annotationPanelProps:n,translationPanelProps:a,sequenceId:i}){return d.createElement("div",{className:(0,g.iv)(c6.featurePanelWrapper),...(0,ee.Z)({component:"SequenceFeaturePanel",element:"root"})},a?d.createElement(sp.Xl,{className:(0,g.iv)(c6.tabContainer),navClassName:(0,g.iv)(c6.navTabs),paneClassName:(0,g.iv)(c6.paneContainer),activeTab:e,onRequestTabChange:function handleChangeTab(e){const n={[J5.NK]:"annotation",[J5.t]:"translation"}
m.j(n[e],"click_feature_panel_tab",{product:j.XC.MOLBIO,sequence_id:i})
t(e)},isFullHeight:!0},d.createElement(sp.OK,{tabKey:J5.NK,title:"Annotations"},d.createElement(AnnotationPanelContent,{...n,className:(0,g.iv)(c6.panelContents)})),d.createElement(sp.OK,{tabKey:J5.t,title:"Translations"},d.createElement(TranslationPanelContent,{...a,className:(0,g.iv)(c6.panelContents)}))):d.createElement(AnnotationPanelContent,{...n,className:(0,g.iv)(c6.panelContents)}))}
var u6=n(947216),m6=n(751805),p6=n(178132)
class LibrarySearchResults extends s().Collection{static initClass(){this.prototype.url="/1/api/minimal-folders"}}LibrarySearchResults.initClass()
const h6=class SequenceAndLibrarySearchView extends hn{initialize(e){super.initialize(e);({selectLibrary:this.selectLibrary,libraryType:this.libraryType}=e)
this.libraryResults=new LibrarySearchResults}updateSearchResults(){this.hideSpinner()
this.$(".search-results").empty()
if(this.libraryResults.length+this.sequenceResults.length===0){this.showNoResultsMessage()
return}const e=this.libraryResults.map((e=>o()(this.resultRowTemplate({name:this._getLibraryLabel(e),path:e.get("owner_handle")})).data("result",e).data("result_type","library")))
this.$(".search-results").append(e)
const t=this.sequenceResults.map((e=>o()(this.resultRowTemplate({name:e.get("name"),path:this._getSequencePath(e)})).data("result",e).data("result_type","sequence")))
this.$(".search-results").append(t)
this.$(".search-results").show()}_getLibraryLabel(e){return`${e.get("name")} (folder)`}fetchResults(e){const t={query:e}
this.libraryType&&(t.type=this.libraryType)
return[this.libraryResults.fetch({data:t}),this.sequenceResults.fetch({data:{q:e}})]}selectResult(e){const t=e.data("result_type"),n=e.data("result")
this.clearSearchAfterClick&&this.clearSearch()
"sequence"!==t?"library"===t&&this.selectLibrary(n):this.selectSequence(n)}render(){this.$el.html(this.template({searchLibrary:!0}))
this.alwaysDisplayResults&&this.showNoResultsMessage()
return this}}
const g6=(0,be.Z)((function AnnotationRow({annotation:e,sequence:t}){const n=e.start(),a=e.end(),i=T.length(n,a,t.length()),s=T.modelStartToDisplay(n,t.startIndex()),r=T.modelEndToDisplay(a,t.length(),t.startIndex())
return d.createElement(d.Fragment,null,d.createElement("td",null,d.createElement("input",{type:"checkbox",className:"visibility-toggle",defaultChecked:e.get("visible"),value:e.cid})),d.createElement("td",{className:"annotation-name"},e.name()),d.createElement("td",{...(0,ee.Z)({component:"AnnotationRow",element:"location"})},s,"-",r),d.createElement("td",null,i),d.createElement("td",null,d.createElement("div",{style:{backgroundColor:e.color()},className:"swatch"})))}))
function AutoAnnotationModalContent(){return d.createElement("div",{id:"auto-annotation",...(0,ee.Z)({component:"AutoAnnotationModalContent",element:"root"})},d.createElement("form",null,d.createElement("div",{className:"form-group"},d.createElement("p",null,"Auto-annotation will add annotations to the current sequence based on matching features."),d.createElement("div",{className:"row"},d.createElement("div",{className:"col-md-8"},d.createElement("select",{multiple:!0,className:"feature-library"})),d.createElement("div",{className:"col-md-4"},d.createElement("button",{type:"button",className:"button button--secondary button--small search-all-libraries-btn",...(0,ee.Z)({component:"AutoAnnotationModalContent",element:"searchAllLibrariesButton"})},"Search all libraries")))),d.createElement("div",{className:"form-group"},d.createElement("p",null,"Or choose a sequence or sequence folder instead. (Features will be extracted from all annotations of 3 or more bases on the selected sequence or sequences in the selected library.)"),d.createElement("div",{className:"sequence-search"})),d.createElement("div",{className:"annotation-results well well-sm hidden"},d.createElement("p",{className:"summary"}),d.createElement("table",{className:"table table-hover"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,d.createElement("input",{type:"checkbox",className:"global-visibility-toggle"})),d.createElement("th",null,"Name"),d.createElement("th",null,"Location"),d.createElement("th",null,"Length"))),d.createElement("tbody",null))),d.createElement("div",{className:"search-throbber hidden"})))}const{setTimeout:E6}=window
class AutoAnnotationResults extends s().Collection{static initClass(){this.prototype.model=m6.Z}url(){return`/1/api/sequences/${this.sequenceID}/auto-annotations`}initialize(e,{sequenceID:t,sequence_length:n,annotations:a,startIndex:i}){this.sequenceID=t
this.sequence_length=n
this.annotations=a
this.startIndex=i}comparator(e,t){const n=T.length(e.start(),e.end(),this.sequence_length),a=T.length(t.start(),t.end(),this.sequence_length)
return e.visible()!==t.visible()?t.visible()-e.visible():a!==n?a-n:t.start()!==e.start()?T.modelToDisplay(e.start(),this.startIndex)-T.modelToDisplay(t.start(),this.startIndex):T.modelEndToDisplay(e.end(),this.sequence_length,this.startIndex)-T.modelEndToDisplay(t.end(),this.sequence_length,this.startIndex)}parse(e){const t=l.default.countBy(e,(e=>e.name))
return l.default.map(e,(e=>{const n=null!=this.annotations.findWhere({name:e.name,start:e.start,end:e.end,strand:e.strand})
return{_annotation:new Ue.Annotation(e,{parse:!0}),visible:!n&&t[e.name]<=100}}))}fetch(e){return an.by({url:this.url(),data:e.data}).done((e=>{this.set(this.parse(e),{silent:!0})
this.trigger("sync",this)}))}}AutoAnnotationResults.initClass()
class AutoAnnotationView extends s().View{static initClass(){this.prototype.events={"change .feature-library":"selectFeatureLibrary","change .visibility-toggle":"toggleVisibility","change .global-visibility-toggle":"toggleAll","click .search-all-libraries-btn":"toggleSearchAll"}}initialize(e){this.selectSequence=this.selectSequence.bind(this)
this.selectLibrary=this.selectLibrary.bind(this)
this.sequenceSearchView=new h6({selectSequence:this.selectSequence,selectLibrary:this.selectLibrary})
this.autoAnnotationResults=new AutoAnnotationResults([],{sequenceID:e.sequence.id,sequence_length:e.sequence.length(),annotations:e.sequence.get("_sequence").annotations(),startIndex:e.sequence.startIndex()})
this.listenTo(this.autoAnnotationResults,"change:visible",this.updateVisible)
this.sequence=e.sequence}fetchResults(e){this.timeout=E6((()=>{this.$el.find(".search-throbber").removeClass("hidden")}),100)
this.autoAnnotationResults.fetch({data:e}).done((()=>{this.updateAnnotationResults(this.autoAnnotationResults)})).fail((e=>{v.ZP.notifyError(e)})).always((()=>{clearTimeout(this.timeout)
this.$el.find(".search-throbber").addClass("hidden")}))}trackChangeSearchCriteria(e){m.j("annotation","auto_annotate_search_criteria",{product:j.XC.MOLBIO,polymer_id:this.sequence.id,criteria:e})}addAnnotationsToSequence(){m.j("annotation","add_auto_annotations_click",{product:j.XC.MOLBIO,sequence_id:this.sequence.id})
const e=this.autoAnnotationResults.filter((e=>e.get("visible"))),t=new Ue.AnnotationCollection(l.default.map(e,(e=>e.get("_annotation"))),{sequenceID:this.sequence.id})
s().sync("create",t,{fileUpdate:!0}).done((e=>{const t=l.default.map(e.added,(e=>new Ue.Annotation(e,{parse:!0}))),n=l.default.map(t,(e=>new m6.Z({_annotation:e})))
this.sequence.get("_sequence").annotations().batchModify((function(){return this.add(t)}))
this.sequence.updateVersions()
v.ZP.success(e.message)
Ys.OZ(Qs.ZP.MODULES.SEQUENCE,Qs.ZP.AUTO_ANNOTATE)
m.j("annotation","completed_auto_annotate",{product:j.XC.MOLBIO,sequence_id:this.sequence.id,annotation_count:n.length})})).fail((e=>{v.ZP.notifyError(e)
m.j("annotation","auto_annotate_fail",{product:j.XC.MOLBIO,sequence_id:this.sequence.id,error:v.ZP.getFriendlyError(e)})}))}toggleAll(e){const t=o()(e.currentTarget).prop("checked")
this.autoAnnotationResults.each((e=>e.set({visible:t})))
this.$el.find(".visibility-toggle").prop("checked",t)}toggleVisibility(e){const t=o()(e.target).val()
this.autoAnnotationResults.get(t).set("visible",e.target.checked)}updateAnnotationResults(e){this.$el.find(".annotation-results").removeClass("hidden")
if(e.length>0){const t=e.map((e=>o()("<tr>").append(g6({annotation:e,sequence:this.sequence,sequtil:T}))))
this.$el.find(".annotation-results .table").removeClass("hidden")
this.$el.closest(".modal-content").find(".modal-footer .button").removeClass("disabled")
this.$el.find(".annotation-results .summary").text(`${e.length} matching features found. Select the features you'd like to add to the sequence.`)
this.$el.find(".annotation-results tbody").html(t)
this.$el.find(".annotation-results .summary").attr("data-test-component","AutoAnnotationView")
this.$el.find(".annotation-results .summary").attr("data-test-element","summaryMessage")}else{this.$el.find(".annotation-results .table").addClass("hidden")
this.$el.closest(".modal-content").find(".modal-footer .button").addClass("disabled")
this.$el.find(".annotation-results .summary").text("No matching features were found.")}}selectSequence(e){this.trackChangeSearchCriteria("sequence")
this.sequenceSearchView.setInputValue(e.get("name"))
this.$(".feature-library").select2("val","")
this.fetchResults({type:"sequence",reference_id:e.id})}selectLibrary(e){this.trackChangeSearchCriteria("folder")
this.sequenceSearchView.setInputValue(e.get("name"))
this.$(".feature-library").select2("val","")
this.fetchResults({type:"sequence_folder",reference_id:e.get("api_identifier")})}selectFeatureLibrary(e){const t=o()(e.target).val()
if((null!=t?t.length:void 0)>0){this.trackChangeSearchCriteria("feature_library")
this.sequenceSearchView.clearSearch()
this.fetchResults({type:"library",reference_id:t.join(",")})}}toggleSearchAll(e){this.trackChangeSearchCriteria("search_all")
const t=o()(e.currentTarget)
t.button("toggle")
this.$(".feature-library").select2("enable",!t.hasClass("active"))
t.hasClass("active")&&this.fetchResults({type:"library",reference_id:"ALL"})}updateVisible(e){const t=this.autoAnnotationResults.every((e=>e.get("visible"))),n=this.autoAnnotationResults.some((e=>e.get("visible")))
this.$el.find(".global-visibility-toggle").prop({checked:n,indeterminate:!t&&n})}render(){(0,Me.A9)(d.createElement(AutoAnnotationModalContent,null),this.$el[0],(()=>{this.sequenceSearchView.setElement(this.$(".sequence-search"))
this.sequenceSearchView.render()
this.model.fetch().done((()=>{const e=this.$el.find(".feature-library")
let t=this.model.map((e=>window.user.handle===e.get("owner_handle")?new Option(e.get("name"),e.id):new Option(`${e.get("owner_handle")} / ${e.get("name")}`,e.id)))
t=l.default.sortBy(t,(e=>e.text))
e.append(t)
e.select2({placeholder:"Choose one or more feature libraries"})
e.attr("data-test-component","AutoAnnotationView")
e.attr("data-test-element","librarySelect")}))}))
return this}}AutoAnnotationView.initClass()
const f6=AutoAnnotationView,annotationIdentityKeyFn=e=>`${e.strand()}-${e.start()}-${e.end()}-${e.name()}`
function findDuplicateAnnotations(e){const t=l.default.groupBy(e,annotationIdentityKeyFn),n=(0,Jt.DZ)(t,(e=>e.length>1)),a=[]
let i=0
for(const e of Object.values(n)){const[t,n]=l.default.partition(e,(e=>!e.get("_annotation").fromSubPart()))
if(0===t.length){i+=1
continue}const s=(n.length>0?t:t.slice(0,t.length-1)).map((e=>e.get("id"))),r=e[0].strand()
a.push({name:e[0].name(),start:e[0].start(),end:e[0].end(),strand:-1===r?Xi.AI:1===r?"+":"",colors:e.slice(0,4).map((e=>e.color())),count:e.length,deleteIds:s})}return{resolvableGroups:a,numUnresolvableGroups:i}}function CleanDuplicateAnnotationsModal({resolvableGroups:e,numUnresolvableGroups:t,onRequestClose:n,onRequestSubmit:a}){const[i,s]=(0,d.useState)(e.map((()=>!0))),r=i.filter((e=>e)).length,o=e.filter(((e,t)=>i[t])).flatMap((e=>e.deleteIds))
return d.createElement(et.ZP,{title:"Clean Duplicate Annotations",onRequestClose:n,onRequestSubmit:()=>{a(o)},buttons:[{text:"Cancel",cancel:!0},{text:"Submit",submit:!0,disabled:0===o.length}]},d.createElement("div",{className:"clean-duplicate-annotations"},d.createElement("p",null,"The following duplicate annotation groups were found."," ",d.createElement("strong",null,r," ",(0,de._6)(r,"group")," ")," ","will be cleaned (all but one annotation will be removed).",t>0&&d.createElement("span",null," ","An additional ",t," ",(0,de._6)(t,"group")," composed entirely of annotations from parts will be ignored.")),d.createElement("ul",{className:"list-group"},e.map(((e,t)=>d.createElement("li",{key:t,onClick:()=>{s((e=>{const n=e.slice()
n[t]=!e[t]
return n}))},className:f()("list-group-item",{active:i[t]})},d.createElement("span",{className:"badge"},e.count),d.createElement("div",{className:"pull-right duplicate-colors"},e.count>4&&d.createElement("div",{className:"more-colors"},"…"),e.colors.map(((e,t)=>d.createElement("div",{key:t,style:{backgroundColor:e},className:"duplicate-color"})))),d.createElement("strong",null,e.name),"  (",e.strand," ",e.start,"-",e.end,")"))))))}function getAnnotationPanelProps(e,t){const n=(0,Jt.Pe)(e.annotations().models,(e=>e.cid)),{resolvableGroups:a}=findDuplicateAnnotations(e.annotations().models)
return{sortedAnnotationsData:(0,hs.Z)(e.annotations().models.map((t=>getAnnotationData(t,e))),["displayStart","displayEnd"]),canEditSequenceFeatures:e.allowFeatureEdits(),sequenceId:e.id,sequenceStartIndex:e.startIndex(),sequenceLength:e.length(),isSingleStranded:e.isSingleStranded(),hasDuplicateAnnotations:a.length>0,onToggleVisibility:(t,a)=>{m.j("annotation","toggled_visibility",{source:"annotations-panel",sequence_id:e.id,annotation_count:t.length,visible:a})
e.annotations().batchModify((()=>{for(const e of t)n[e].set({visible:a})}))},onAnnotationHover:e.annotations().length>100?void 0:(e,t)=>{n[e].set({hover:t})},onSelectAnnotation:(t,a)=>{const i=n[t]
if(a){i.click(e,!1)
e.trigger("jump",i.start())}else i.set("selected",!1)},onSaveAnnotation:(t,a)=>{!async function saveAnnotation(e,t,n){const a=(null!=e?e:new m6.Z({_annotation:new u6.q6})).get("_annotation"),i=n.end===t.length()?0:n.end,{name:s,notes:r,annotationType:o,start:l,color:c,strand:d,customFields:u}=n
if(a.set({name:s,notes:r,annotation_type:o,start:l,end:i,color:c,strand:d,custom_fields:u},{validate:!0,sequence:t})){await t.get("_sequence").annotations().betterCreate(a,{validate:!1,fileUpdate:!0})
t.updateVersions()
v.ZP.success(`Annotation **${s}** saved successfully.`)
null==e?(0,Vn.getStore)().dispatch((0,B5.WJ)(t.id)):e.set("selected",!1)}else v.ZP.error(a.validationError)
null!=e?m.j("annotation","updated_annotations",{source:"annotations-panel",sequence_api_id:t.id,annotation_count:1}):m.j("annotation","created_annotation",{strand:d,color:c,sequence_id:t.id,product:j.XC.MOLBIO})}(null!=t?n[t]:null,e,a)},onClickAutoAnnotate:()=>{!function openAutoAnnotate(e){const t=new p6.FE,n=new f6({model:t,sequence:e}),a=new Ot.I4({title:"Auto-annotate sequence",msg:n.render().el}).choice("Add annotations","button button--medium button--primary",(()=>{n.addAnnotationsToSequence()}),!0,{component:"AnnotationPanelUtil",element:"addAnnotationsButton"})
a.show()
a.$el.find(".modal-footer button").addClass("disabled")
m.j("annotation","clicked_auto_annotate",{product:j.XC.MOLBIO,sequence_id:e.get("id")})}(e)},onDeleteAnnotation:t=>{n[t].destroy().done((()=>{e.updateVersions()}))
m.j("annotation","deleted_annotation",{source:"annotations-panel"})},onOpenCleanDuplicates:()=>{!async function openDuplicateModal(e){const{resolvableGroups:t,numUnresolvableGroups:n}=findDuplicateAnnotations(e.annotations().models),a=await(0,Xn.Z)(CleanDuplicateAnnotationsModal,{resolvableGroups:t,numUnresolvableGroups:n})
null!=a&&async function cleanDuplicates(e,t){const n=[]
for(const a of e.annotations().models)t.includes(a.id)&&n.push(a.get("_annotation"))
try{const t=await e.annotations()._annotations.bulkDelete(n,{fileUpdate:!0})
e.updateVersions()
v.ZP.success(t.message)}catch(e){v.ZP.notifyError(e)}}(e,a)}(e)},openExpandedAnnotations:()=>{let n=t.get("buffers").getTabByClass(gr)
if(null!=n)n.set({active:!0})
else{const a=new(s().Model)
n=new gr({analysis:a,sequence:e})
t.get("buffers").addTab(n)}t.trigger("close")}}}class FeaturePanelView extends s().View{static initClass(){this.prototype.el="#feature-panel"}handleSelectedChange(e){(0,Vn.getStore)().dispatch(B5.XD(this.sequence.id,{isCreateActive:!1,name:e.name(),annotationType:e.annotationType(),start:e.start(),end:e.end(),color:e.color(),strand:e.strand(),notes:e.notes(),customFields:e.customFields()}))}update(e,t){null!=this.panelState&&this.stopListening(this.panelState)
this.panelState=e
null!=this.sequence&&this.stopListening(this.sequence.get("_sequence"))
this.sequence=t
this.listenTo(this.sequence.get("_sequence"),"change:circular",(function(){return Array.from(this.annotations.where({selected:!0})).map((e=>e.set({selected:!1})))}))
null!=this.annotations&&this.stopListening(this.annotations)
null!=this.translations&&this.stopListening(this.translations)
this.annotations=t.get("annotations")
this.translations=t.get("translations")
this.selection=t.get("selection")
this.listenTo(this.annotations,"change:selected",this.handleSelectedChange)
const n=this.annotations.find((e=>e.selected()))
null!=n&&this.handleSelectedChange(n)
this.updateRedesignedFeaturePanelView()}updateRedesignedFeaturePanelView(){this.renderRedesignedPanel()
this.batchedRenderRows=this.listenToBatch(this.annotations,this.renderRedesignedPanel)
this.listenTo(this.annotations,"change:selected",((e,t)=>{t&&this.setActiveTab(J5.NK)}))
this.listenTo(this.translations,"change:selected",((e,t)=>{t&&this.setActiveTab(J5.t)}))
this.listenTo(this.annotations,"add remove change reset",(()=>{if(this.panelState.get("activeSubPanel")===J5.NK)return this.annotations.inBatch()?this.batchedRenderRows():this.renderRedesignedPanel()}))
this.listenTo(this.translations,"add remove change reset",this.updateTranslationsTab)
this.listenTo(this.sequence._translations,"change",this.updateTranslationsTab)
this.listenTo(this.sequence,"change:translationGroups",this.updateTranslationsTab)
this.listenTo(this.translations,"change:selected",((e,t)=>{t&&(0,Vn.getStore)().dispatch(B5.xe(this.sequence.id))}))
this.listenTo(this.panelState,"change:activeSubPanel",this.renderRedesignedPanel)}updateTranslationsTab(){this.panelState.get("activeSubPanel")===J5.t&&this.renderRedesignedPanel()}setActiveTab(e){this.panelState.set({activeSubPanel:e})}renderRedesignedPanel(){(0,Me.A9)(d.createElement(d6,{activeTab:this.panelState.get("activeSubPanel"),setActiveTab:this.setActiveTab.bind(this),annotationPanelProps:getAnnotationPanelProps(this.sequence,this.panelState),translationPanelProps:getTranslationPanelProps(this.sequence,this.panelState),sequenceId:this.sequence.id}),this.$el.find(".panel-content")[0])
return this}}FeaturePanelView.initClass()
const S6=FeaturePanelView,y6=n(369718).Z
const b6=class EntryHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(y6,{id:this.model.id,folderId:this.model.folder().api_identifier,name:this.model.name(),permissions:this.model.permissions()})}]}}
class EntryInformationPanelView extends T5{static initClass(){this.prototype.showPatentsafeExport=dt.ZP.ENABLE_PATENTSAFE&&null!=Jn.Z.currentUser()}initialize(){this.saveModel=this.saveModel.bind(this)
this.deleteModel=this.deleteModel.bind(this)
this.requestExport=this.requestExport.bind(this)
super.initialize(...arguments)}folderDefaultsKey(){return Qe.O.NOTEBOOK}saveModel(e){HL.Z.saveFileData(this.model.id,{data:e,success:this.onSaveSuccess})}deleteModel(){HL.Z.delete(this.model.id,{success:this.onDeleteSuccess})}requestExport(){h5.Z.requestExportFile(this.model.id)}}EntryInformationPanelView.initClass()
const T6=EntryInformationPanelView
var v6=n(612105),C6=n(457112)
function redirectToSignUp(){window.location.href="/signup"}class CRISPRPanelViewConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[Ur.Z,CD.Z]}enhanceProps(){return{analyses:this.crisprAnalysisStore().getAnalysesForSequence(this.props.sequenceId),analysisLoading:this.crisprAnalysisStore().getState().analysisLoading,hrTemplateDesignState:this.hrTemplateStore().getDesignState(this.props.sequenceId)}}}class CRISPRPanelView extends d.Component{constructor(){super(...arguments)
this.isHRTemplateLoading=()=>(null!=this.props.hrTemplateDesignState?this.props.hrTemplateDesignState.isHRTemplateLoading:void 0)||!1
this.allowHRTemplateEdits=()=>this.props.allowEdits||function GenomeEngineeringPanelView_guard_(e,t){return null!=e?t(e):void 0}(null!=this.props.hrTemplateDesignState?this.props.hrTemplateDesignState.sequence:void 0,(e=>e.allowResidueEdits({tabId:gi.HR_TEMPLATE_TAB_ID})))||!1
this.deleteAnalysis=(e,t)=>{t.stopPropagation()
this.props.closeAnalysis(e)
Vr.Z.delete(e)}
this._openCRISPRModal=()=>{(0,v6.G)({sequenceId:this.props.sequenceId})
this.props.closePanel()}}componentDidMount(){Vr.Z.fetchForSequence(this.props.sequenceId)
wD.Z.fetchForSequence(this.props.sequenceId)}render(){const e=null!=Jn.Z.currentUser()
return d.createElement("div",{className:"u-small-spacing-top",...(0,ee.Z)({component:"CRISPRPanel",element:"root"})},e?d.createElement("button",{className:"btn btn-af-primary btn-block",onClick:this._openCRISPRModal,disabled:!this.props.allowEdits,type:"button",...(0,ee.Z)({component:"CRISPRPanel",element:"guideDesignButton"})},this.props.allowEdits?"Design and analyze guides":"Guide Design Disabled When Read-Only"):showValueMessagingForSharedFile()?d.createElement(ToolbarSignupMessage,{action:"create a guide"}):d.createElement("button",{className:"btn btn-af-primary btn-block",onClick:redirectToSignUp,type:"button"},"Sign up to design guides"),d.createElement(h.Z,null,d.createElement(p.Z,{sm:12},d.createElement("h5",{className:"u-spacing-top"},"Saved Guide Analyses"),null!=this.props.analyses&&d.createElement("span",null,this.props.analyses.length)?d.createElement("table",{className:"table table-striped table-condensed table-hover",...(0,ee.Z)({component:"CRISPRPanelView",element:"savedGuideAnalysesTable"})},d.createElement("tbody",null,Array.from(this.props.analyses).map((e=>d.createElement("tr",{className:"panel-library-row",onClick:this.props.openAnalysis.bind(null,e.id),key:e.id},d.createElement("td",null,e.name),d.createElement("td",null,this.props.allowEdits?d.createElement("span",{className:"glyphicon glyphicon-trash delete pull-right",onClick:this.deleteAnalysis.bind(null,e.id)}):null,Hr.UT(e.modifiedAt))))))):this.props.analysisLoading?d.createElement("div",{className:"loading-spinner-background u-small-padding"}):d.createElement("span",null,"No guide analyses."))),!showValueMessagingForSharedFile()&&d.createElement("div",{className:"u-spacing-top"},d.createElement("div",{className:"panel-divider"}),e?d.createElement("button",{className:"btn btn-af-primary btn-block",onClick:()=>{CD.Z.containsDesign(this.props.sequenceId)?this.props.openHRTemplate():this.props.createHRTemplate()},disabled:!this.allowHRTemplateEdits()||this.isHRTemplateLoading(),type:"button"},this.allowHRTemplateEdits()?this.isHRTemplateLoading()?"Loading...":CD.Z.containsDesign(this.props.sequenceId)?"Open HR Template Design":"Design HR Template (ssODN)":"HR Template Design Disabled When Read-Only"):d.createElement("button",{className:"btn btn-af-primary btn-block",onClick:redirectToSignUp,type:"button"},"Sign up to Design HR Template")))}}const I6=CRISPRPanelViewConnector.connect(CRISPRPanelView)
const w6=class GenomeEngineeringPanelView extends X3{constructor(){super(...arguments)
this.getSubpanels=()=>[{title:"CRISPR",key:"genome-engineering",component:d.createElement(I6,{allowEdits:this.model.allowFeatureEdits(),sequenceId:this.model.id,openAnalysis:this.openAnalysis,closeAnalysis:this.closeAnalysis,closePanel:this.closePanel,createHRTemplate:()=>{this.closePanel()
m.j("hr_template","open_modal_from_genome_panel")
Xe.bA(C6.Z,d.createElement(C6.Z,{onRequestClose:()=>{Xe.xv(C6.Z)},sequence:{id:this.model.id,name:this.model.name(),activeVersionId:this.model.getActiveVersionId(),folderId:this.model.folder().api_identifier}}))},openHRTemplate:()=>{let e
this.closePanel()
if(null!=(e=this._findExistingHRTemplateTab()))e.set({active:!0})
else{this.model.fileState().buffers().addTab(new TD.Z({sequence:this.model}))}}})}]
this.closePanel=()=>{this.panelState.trigger("close")}
this.openAnalysis=e=>{const t=this.model.fileState(),n=this._findExistingTab(e,t)
null!=n?n.set({active:!0}):t.buffers().addTab(new Gr.Z({analysisId:e,sequence:this.model}))
this.panelState.trigger("close")}
this.closeAnalysis=e=>{const t=this.model.fileState(),n=this._findExistingTab(e,t)
null!=n&&n.close()}}_findExistingTab(e,t){return t.findTab(Gr.Z,(t=>t.analysisId()===e))}_findExistingHRTemplateTab(){return this.model.fileState().findTab(TD.Z,(e=>e.sequence().id===this.model.id))}}
const N6=(0,be.Z)((function Lineage({hasAssemblyHistory:e}){return e?d.createElement("p",{className:"u-small-spacing-top"},"View lineage information in the ",d.createElement("a",{className:"assembly-history-link"},"Assembly History tab"),"."):d.createElement(d.Fragment,null,d.createElement("p",{className:"u-small-spacing-top"},"No lineage information available."),d.createElement("p",null,"Create plasmids using the assembly wizard"," ",dt.ZP.MOLBIO_REDESIGNED_CLONING_FLOW&&"or combinatorial assembly tool ","to store lineage information."))}))
const A6=(0,be.Z)((function Version({active:e,id:t,name:n,time:a,user:i,reverted:s}){return d.createElement("tr",{"version-id":t,className:f()({active:e,"is-reverted":s,faded:s},"version-row"),...(0,ee.Z)({component:"Version",element:"root"})},d.createElement("td",{className:"name",title:n},d.createElement("div",null,n)),d.createElement("td",{className:"user",title:i},d.createElement("div",{className:"text-center"},i)),d.createElement("td",{className:"time",title:a},d.createElement("div",{className:"text-right"},a)))}))
var R6=n(970211)
class EditVersion extends s().View{static initClass(){this.prototype.el="#edit-version"
this.prototype.events={"change .clone-name":"changeCloneName","click .clone":"cloneVersion","click .reset":"resetToVersion"}}changeCloneName(){this.editState.set("cloneName",this.$el.find(".clone-name").val())}close(){this.$el.addClass("hide")
null!=this.editState&&this.editState.clear().set(this.editState.defaults())}cloneVersion(){if(!this.editState.get("cloneName")){v.ZP.error("Please enter a valid name.")
return}const e=this.$(".clone-folder").val()
if(e){this.sequence.duplicate({name:this.editState.get("cloneName"),version:this.editState.get("version").get("id"),folderId:e,skipPrompt:!0})
m.j("editor","cloned_sequence_version")}else v.ZP.error("Please select a folder.")}resetToVersion(){if(this.sequence.get("currentVersion"))v.ZP.error("You cannot reset to the current version.")
else{const e=this.editState.get("version"),{sequence:t}=this
e.cleanMetadata().fail(v.ZP.notifyError).done((n=>{if(n.all_valid){t.resetToVersion(e)
t.selection().clampToSequence()
return}const a=o()("<div>").html('<p>The selected version has primers attached that no longer exist in your folders. Resetting will restore the version with these primers omitted:</p><ul class="removed-primers list-group"></ul>')
for(const e of n.invalid_primers){const t=o()('<li class="list-group-item">').text(e.name)
a.find(".removed-primers").append(t)}new Ot.I4({title:"Reset Warning",msg:a}).choice("OK","btn-af-primary",(()=>t.resetToVersion(e))).choice("Cancel","btn-af-default").show()}))}}renderFolderSelector(e){const t=null!=e?e:Qe.Z.get(Qe.O.INVENTORY)
null!=this.selectorView&&this.selectorView.remove()
this.selectorView=new to.Z({initialFolderId:t,inputClassName:"clone-folder",props:{showInventory:!0,readOnly:!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE})}})
this.$(".folder-selector-container").html(this.selectorView.render().el)}update(e,t){this.editState=e
this.sequence=t
null!=this.version&&this.stopListening(this.version)
this.version=this.editState.get("version")
if(this.version){this.$el.find(".clone-name").val(this.editState.get("cloneName"))
this.$el.removeClass("hide")}else this.$el.addClass("hide")
this.$(".reset").prop("disabled",this.sequence.get("currentVersion")||!this.sequence.allowResidueEdits({ignoreVersion:!0}))
this.$(".clone").prop("disabled",!(0,ln.cr)({feature:on.Ot.MOLBIO_CREATE}))
this.renderFolderSelector()}}EditVersion.initClass()
class SequenceHistoryPanelView extends s().View{static initClass(){this.prototype.el="#history-panel"
this.prototype.events={"click .js-history-subpanel .version-row":"clickVersionRow","click .js-title":"titleClickHandler","click .js-fragment-pair":"openPair","click .js-fragment-primer":"openPrimer","click .js-fragment-sequence-name":"openFragmentSequence","click .show-all-versions":"toggleShowAllVersions","click .assembly-history-link":"openAssemblyHistory"}}initialize(){this.showAllVersions=!1
this.edit=new EditVersion
this.enzymes=X.ZP.getCommonEnzymes()
this.sequences=ve.ZP.get()}_versionsMetadata(){return this.versions.sortBy((e=>e.get("id"))).map((e=>({id:e.get("id"),parentId:e.get("parentId")})))}titleClickHandler(e){this.panelState.set("activeSubPanel",o()(e.currentTarget).attr("data-panel"))}showSubPanel(){const e=this.panelState.get("activeSubPanel"),t=[[J5._R,"History"]]
this.sequence.isOligo()||t.push([J5.Nn,"Lineage"])
renderPanelTabs(this.panelState,t,this.$(".panel-title")[0])
this.$el.find(".js-title").parent().removeClass("active")
this.$el.find(`.js-title[data-panel='${e}']`).parent().addClass("active")
this.$el.find(".panel-container").parent().hide()
this.$el.find(`.js-${e}-subpanel`).show()
this.$el.find(".panel-content").scrollTop(0)
this.panelState.trigger("resize")}clickVersionRow(e){const t=o()(e.currentTarget)
this.openVersion(this.versions.get(t.attr("version-id")))}openVersion(e){if(this.sequence.getActiveVersionId()===e.id)this.showEdit(e)
else{m.j("editor","changed_sequence_version")
this.sequence.viewVersion(e).done((()=>{this.showEdit(e)}))}}showEdit(e){this.editState.set({version:e,cloneName:`${this.sequence.get("_sequence").get("name")} - ${e.get("name")}`})
this.edit.update(this.editState,this.sequence)}renderRows(){var e,t
this.$el.find("#version-rows").empty()
this.$el.find(".show-all-versions").toggleClass("hidden",!R6.yW(this._versionsMetadata()))
const n=this.sequence.getActiveVersion(),a=R6.Hj(this._versionsMetadata())
for(const i of this.versions.sortBy((e=>e.get("id"))).reverse()){let s
const r=new Date(i.get("created_at")),o=null!==(t=null===(e=i.get("user"))||void 0===e?void 0:e.name)&&void 0!==t?t:""
s=r.getFullYear()===(new Date).getFullYear()?Hr.UT(r,{showYear:!1,showTime:!0,showSeconds:!0}):Hr.UT(r,{showYear:!0,showTime:!0,showSeconds:!0})
const l=n===i,c=a[i.get("id")]
if(!c||this.showAllVersions){const e=A6({id:i.get("id"),name:i.get("name"),time:s,active:l,user:o,reverted:c})
this.$el.find("#version-rows").append(e)}l&&this.$el.find(`[version-id=${i.get("id")}]`).click()}}selectRow(e){this.$(".js-history-subpanel .version-row").removeClass("active")
this.$(`.js-history-subpanel .version-row[version-id=${e}]`).addClass("active")}openAssemblyHistory(){this.sequences.get(this.sequence.id).buffers().getTabByClass(bL.Z).set({active:!0})}renderLineage(){const e=this.sequences.get(this.sequence.id).buffers().getTabByClass(bL.Z)
this.$(".js-lineage-subpanel .panel-container").html(N6({hasAssemblyHistory:null!=e}))
this.checkLineageVersions()}checkLineageVersions(){this.sequence.get("_sequence").fragmentResults().each(((e,t)=>{if(null!=e.parent()&&null!=e.parentVersion()){const n=e.parent().id,a=new Ge.Versions([],{sequenceID:n})
a.fetch({data:{max:!0}}).done((()=>{e.parentVersion().id===a.at(0).id&&this.$(".js-fragment-sequence-version").eq(t).text("Current")}))}}))}openPair(e){const t=o()(e.currentTarget).data("pairId")
this.sequence.selectPrimerPair(t)}openPrimer(e){const t=o()(e.currentTarget).data("primerId")
this.sequence.sequencePrimers().get(t).dblClick(this.sequence,e.shiftKey)}openFragmentSequence(e){const t=o()(e.currentTarget).data("fragment-sequence-id")
Rn.Z.openFile(t)}toggleShowAllVersions(e){this.showAllVersions=o()(e.target).is(":checked")
this.renderRows()}update(e,t){null!=this.panelState&&this.stopListening(this.panelState)
null!=this.sequence&&this.stopListening(this.sequence)
this.panelState=e
this.sequence=t
this.listenTo(this.panelState,"change:activeSubPanel",(()=>{this.showSubPanel()}))
null!=this.versions&&this.stopListening(this.versions)
this.versions=t.get("versions")
null!=this.editState&&this.stopListening(this.editState)
this.editState=this.panelState.get("editState")
this.sequence.get("writable")?this.edit.update(this.editState,this.sequence):this.edit.$el.addClass("hide")
this.renderRows()
this.listenTo(this.versions,"reloaded change:name",(()=>{this.renderRows()}))
this.listenTo(this.sequence,"change:activeVersionId",((e,t)=>{this.selectRow(t)}))
this.listenTo(this.versions,"open",(e=>{this.openVersion(e)}))
this.renderLineage()
this.showSubPanel()}}SequenceHistoryPanelView.initClass()
const P6=SequenceHistoryPanelView
var O6=n(764556),x6=n(811599)
const RangeFeatureTable=({features:e})=>d.createElement("div",{className:"scroll"},d.createElement("table",{className:"table table-condensed"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Name"),d.createElement("th",null,"Start"),d.createElement("th",null,"End"),d.createElement("th",null,"Length"))),d.createElement("tbody",null,e.map(((e,t)=>d.createElement("tr",{key:t},d.createElement("td",null,e.name),d.createElement("td",null,e.start),d.createElement("td",null,e.end),d.createElement("td",null,e.length)))))))
function ConversionWarningModal({annotations:e,onRequestClose:t,onRequestSubmit:n,pairs:a,parts:i}){const s=e.length+a.length+i.length
return d.createElement(et.ZP,{buttons:[{text:"Cancel",cancel:!0},{text:"OK",submit:!0}],onRequestClose:t,onRequestSubmit:()=>{n(!0)},title:"Conversion Warning"},s>0&&d.createElement("p",null,"In converting the sequence from circular to linear, the following features will be lost. If you wish to keep these features on your sequence, you can try reindexing the sequence so that they do not cross the origin."),e.length>0&&d.createElement(d.Fragment,null,d.createElement("p",null,"Annotations"),d.createElement(RangeFeatureTable,{features:e})),i.length>0&&d.createElement(d.Fragment,null,d.createElement("p",null,"Parts"),d.createElement(RangeFeatureTable,{features:i})),a.length>0&&d.createElement(d.Fragment,null,d.createElement("p",null,"Primer pairs (pairs will be unlinked but individual primers will be preserved)"),d.createElement("div",{className:"scroll"},d.createElement("table",{className:"table table-condensed"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"Forward Primer"),d.createElement("th",null),d.createElement("th",null,"Reverse Primer"),d.createElement("th",null))),d.createElement("tbody",null,a.map(((e,t)=>d.createElement("tr",{key:t},d.createElement("td",null,e.forwardName),d.createElement("td",null,e.forwardLocation),d.createElement("td",null,e.reverseName),d.createElement("td",null,e.reverseLocation)))))))),d.createElement("p",null,"Proceed with the conversion anyway?"))}class TagEditorSubpanel extends s().View{initialize(){this.activeTag=null}update(e,t){null!=this.model&&this.stopListening(this.model)
this.panelState=e
this.model=t
this.listenTo(this.model,"change",this.render.bind(this))
this.render()}render(){const e={id:this.model.id,allowEdits:this.model.allowEdits(),tags:this.model.tags(),isRegistered:this.model.isRegistered()};(0,Me.A9)(d.createElement(b5,{...e}),this.el,(()=>{this.panelState.trigger("resize")}))
return this}}const SequenceLockingHelp=()=>d.createElement("div",null,d.createElement("p",null,O6.k))
class SequenceInformationPanelView extends s().View{static initClass(){this.prototype.el="#information-panel"
this.prototype.events={"click .information-title":"showInformation","click .tags-title":"showTags","change .info-locked input":"updateState","change .info-circular":"updateCircular","keyup .js-start-index":"updateState","click .update-information":"saveInformation","click .info-parent a":"openParentVersion","change .info-export-format":"updateDownloadState","click .info-export-link":"performDownload","mousedown .info-export-link":"updateExportLink","dragstart .info-export-link":"updateExportDragURL","dragend .info-export-link":"resetExportDragText","click .delete button":"deleteSequence","click .locked-help a":"showSequenceLockingHelp","click .js-show-containing-folder":"showContainingFolder"}}initialize(){this.tagsView=new TagEditorSubpanel({el:this.$el.find(".tags-subpanel .panel-container")})
this.trackedFields=["name","folder_api_id","tagString","circular","startIndex","locked"]
this.serializeFuncs={name:()=>this._sequence.get("name"),folder_api_id:()=>this._sequence.folder().api_identifier,circular:()=>this._sequence.get("circular"),startIndex:()=>this._sequence.get("startIndex"),tagString:()=>l.default.sortBy(this.tags.models.map((e=>e.display())),l.default.identity.bind(this)).join(","),locked:()=>this._sequence.get("locked")}
this.validateFuncs={name:()=>null!=this.panelState.get("name")&&this.panelState.get("name").length>0,folder_api_id:()=>!0,circular:()=>null!=this.panelState.get("circular"),startIndex:()=>{const e=this.panelState.get("startIndex")
return!Number.isNaN(e)&&parseInt(e,10)>=1},tagString:()=>null!=this.tags,locked:()=>null!=this._sequence.get("locked")}
this.svgCSS=null
this.svgFont=null
const e=We.Z.get(rk.GBPreferences.EXPORT_ANNOTATION_COLORS),t=We.Z.get(rk.GBPreferences.CONVERT_NON_STANDARD_ANNOTATIONS)
this.$el.find('.export .gb-options input[name="gb-export-colors"]').prop("checked",e)
this.$el.find('.export .gb-options input[name="gb-restrict-feature-type"]').prop("checked",t)}deleteSequence(){new Ot.I4({title:"Delete Sequence",msg:"Are you sure you want to delete the sequence? It cannot be recovered."}).choice("Cancel","btn-af-default").choice("Delete","btn-af-danger",(()=>{this._sequence.destroy().done((()=>{Rn.Z.removeFromWorkspace(this._sequence.get("id"))
ze.Z.invalidateFolderContents(this._sequence.folder().api_identifier)})).fail(v.ZP.notifyError)})).show()}isRegistered(){var e
return null!=(null===(e=this._sequence.folder())||void 0===e?void 0:e.source)&&lo.isRegistry(this._sequence.folder().source)}getPartialFeatureDefinition(e){return{item:{id:this._sequence.get("id"),permissions:e},itemState:{isRegistered:this.isRegistered()}}}showContainingFolder(){const e=this._sequence.folder();(0,S.hu)(null!=(null==e?void 0:e.api_identifier),"Expected there to be a folder");(0,$N.Z)(e,ZN.INVENTORY_SECTION)}showSequenceLockingHelp(e){(0,ue._8)(e,"Sequence Locking",d.createElement(SequenceLockingHelp,null))}showSubPanel(){const e=this.panelState.get("activeSubPanel")
renderPanelTabs(this.panelState,[[J5.D3,"Sequence Info"],[J5.G2,"Tags"]],this.$(".panel-title")[0])
this.$el.find('h4[class*="-title"]').parent().removeClass("active")
this.$el.find(`.${e}-title`).parent().addClass("active")
this.$el.find(".panel-container").parent().hide()
this.$el.find(`.${e}-subpanel`).show()
this.$el.find(".panel-content").scrollTop(0)
this.panelState.trigger("resize")}showInformation(){this.panelState.set("activeSubPanel",J5.D3)}showTags(){this.panelState.set("activeSubPanel",J5.G2)}openParentVersion(e){e.preventDefault()
const t=this._sequence.get("parent_version_id")
m.j("editor","open_sequence",{source:"panel-parent",sequence_api_id:this._sequence.get("parent_id")});(0,x6.mx)(this._sequence.get("parent_id"),t)}cacheSVGResources(){null==this.svgCSS&&o().get((0,me.Z)("/static/build/svg.css")).done((e=>{this.svgCSS=e})).fail((()=>{this.svgCSS=null}))
null==this.svgFont&&o().ajax({url:(0,me.Z)("/static/fonts/inconsolata-400.svg"),dataType:"xml"}).done((e=>{const t=o()(e).find("font")
t.find("font-face").attr("font-family","Inconsolata").attr("font-weight",400)
t.find("glyph:not([d])").remove()
this.svgFont=t.get(0)})).fail((()=>{this.svgFont=null}))}updateDownloadState(){const e=this.$(".info-export-format").val()
this.$(".info-export-link").attr("disabled",""===e||"svg"===e&&this.sequence.isOligo())
"svg"===e&&this.cacheSVGResources()
this.$(".gb-options").toggleClass("hidden","gb"!==e)}updateExportLink(){var e,t
const n=this.$el.find(".info-export-format").val(),a=this.$el.find(".info-export-link").get(0);(""===n||"svg"===n&&this.sequence.isOligo())&&a.setAttribute("disabled",!0)
let i="text/plain"
const s=(0,Hs.Z)(this._sequence.get("name"),n)
switch(n){case"gb":{const e=this.$el.find('.export .gb-options input[name="gb-export-colors"]').is(":checked")
We.Z.set(rk.GBPreferences.EXPORT_ANNOTATION_COLORS,e)
const t=this.$el.find('.export .gb-options input[name="gb-restrict-feature-type"]').is(":checked")
We.Z.set(rk.GBPreferences.CONVERT_NON_STANDARD_ANNOTATIONS,t)
a.href=RR.M7(this._sequence.get("editURL"),"gb",{dl:!0,nocol:!e,restrictFeatType:t})
a.download=null
break}case"fasta":a.href=RR.M7(this._sequence.get("editURL"),"fasta",{dl:!0})
a.download=null
break
case"rdf":a.href=RR.M7(this._sequence.get("editURL"),"rdf",{dl:!0})
a.download=null
break
case"svg":this.cacheSVGResources()
if(null==this.svgCSS){v.ZP.error("SVG CSS Missing (Benchling Internal Error)")
a.setAttribute("disabled",!0)}else if(null==this.svgFont){v.ZP.error("SVG Font Missing (Benchling Internal Error)")
a.setAttribute("disabled",!0)}else{let n=o()("#circular-map svg, #mini-map svg").get(0)
if(null==n){const e=this.panelState.get("buffers").getTab((e=>e instanceof tC.Z||e instanceof eC.Z))
null!=e&&e.set({active:!0})
n=o()("#circular-map, #mini-map").get(0)}if(n){a.removeAttribute("disabled")
const r=serialize(n,this.svgCSS,this.svgFont)
i="image/svg+xml"
const o=new Blob([r],{type:i})
a.download=s;/Safari/i.test(navigator.userAgent)?a.href=`data:image/svg+xml,${encodeURIComponent(r)}`:a.href=null!==(t=null===(e=window.webkitURL)||void 0===e?void 0:e.createObjectURL(o))&&void 0!==t?t:window.URL.createObjectURL(o)}else{v.ZP.error("Unable to locate map for export (Benchling Internal Error)")
a.setAttribute("disabled",!0)}}break
default:a.setAttribute("disabled",!0)}this.exportDownloadURL=[i,s,a.href].join(":")}performDownload(e){if("svg"!==this.$el.find(".info-export-format").val()){e.preventDefault()
Cn.e7("POST",this.$el.find(".info-export-link").attr("href"),{target:"_blank"})}}updateExportDragURL(e){this.updateExportLink()
this.$el.find(".info-export-link").removeClass("button--secondary").addClass("button--primary")
this.$el.find(".info-export-text").text("Drag to Desktop")
e.originalEvent.dataTransfer.setData("DownloadURL",this.exportDownloadURL)}resetExportDragText(e){this.$el.find(".info-export-link").removeClass("button--primary").addClass("button--secondary")
this.$el.find(".info-export-text").text("Download")}_asyncRename(e,t){return Rn.Z.renameFileWithDataMods(this._sequence.get("id"),this.isRegistered(),{oldName:e,newName:t,notifyOnSuccess:!1})}_asyncSaveSequence(){const e={circular:this.panelState.get("circular"),startIndex:parseInt(this.panelState.get("startIndex"),10),locked:this.panelState.get("locked")},t=this.panelState.get("folder_api_id")
null==t||lo.isRegistryFolder(this._sequence.folder())||this._sequence.folder()&&t===this._sequence.folder().api_identifier||(e.folder_api_id=this.panelState.get("folder_api_id"))
return this._sequence.save(e,{patch:!0,respondDiff:!0,fileUpdate:!0,wait:!0}).fail(v.ZP.notifyError)}_onSaveSuccess(e){for(const e of this.trackedFields)this.panelState.set(e,this.serializeFuncs[e]())
this.sequence.get("tags").reset(this.sequence.get("_sequence").get("tags"))
this.sequence.updateVersions()
if(e){const e=this.sequence.selection().start(),t=this.sequence.selection().end()
T.isWrap(e,t)&&this.sequence.selection().reset(0)}this.updateDownloadState()
v.ZP.success("Information updated successfully.")}saveInformation(){let e
if(!this.panelState.get("circular")&&!this._sequence.finalized()){v.ZP.warn("Please finalize this assembly before changing the topology.")
return}const doSave=async()=>{const e=!this.panelState.get("circular")&&this._sequence.get("circular"),t=this.$el.find(".update-information")
m.j("editor","saved_sequence_information")
this._sequence.folder().source.sourceType!==DN.REGISTRY_TYPE&&Qe.Z.set(Qe.O.INVENTORY,this.panelState.get("folder_api_id"))
const n=[]
this.sequence.allowResidueEdits({ignoreLocked:!0})&&(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()})&&n.push(this._asyncSaveSequence())
const a=this._sequence.get("name"),i=this.panelState.get("name")
a!==i&&n.push(this._asyncRename(a,i));(0,S.Gp)(n.length>0,'Expected at least one update. The "Update Information" button should likely be disabled and prevent update calls in this state.')
try{t.attr("disabled",!0)
this.$el.find(".update-information-text").text("Saving")
await Promise.all(n)
this._onSaveSuccess(e)}finally{this.renderUpdateButton()}},t=this._sequence.annotations().chain().filter((e=>T.isWrap(e.start(),e.end()))).sortBy((e=>e.end())).sortBy((e=>e.start())).value(),n=this._sequence.sequencePrimers(),a=this._sequence.primerPairs().filter((e=>{const[t,a]=e.getPrimers(n)
return t.end()>a.end()})),i=this._sequence.parts().filter((e=>T.isWrap(e.start(),e.end()))).sort((e=>e.end())).sort((e=>e.start()))
if(!this.panelState.get("circular")&&this._sequence.get("circular")&&(t.length>0||a.length>0||i.length>0)){let s
const r=[]
for(const e of t){s=e.name()
s.length>10&&(s=`${s.slice(0,10)}...`)
const t=e.start(),n=e.end(),a=n===t?this.sequence.length():(n-t+this._sequence.length())%this._sequence.length()
r.push({name:s,start:t,end:n,length:a})}const o=[]
for(e of a){const[t,a]=e.getPrimers(n)
o.push({forwardName:t.name(),forwardLocation:`+/${t.bindPosition(this._sequence)}`,reverseName:a.name(),reverseLocation:`–/${a.bindPosition(this._sequence)}`})}const l=i.map((e=>({name:e.name(),start:e.start(),end:e.end(),length:T.length(e.start(),e.end(),this._sequence.length())})));(0,Xn.Z)(ConversionWarningModal,{annotations:r,pairs:o,parts:l}).then((e=>{e&&doSave.call(this)}))}else doSave.call(this)}updateCircular(e){if(null==this.panelState){logUndefinedState("SequenceInformationPanelView","panelState",this,e)
return}m.j("editor","changed_topology",{type:o()(e.currentTarget).val()})
const t="1"===o()(e.currentTarget).val()
this.$(".js-start-index").val(t?1:this._sequence.get("startIndex")).attr("disabled",t)
this.updateState()
this.renderStartIndexHelp()}updateState(e){null!=this.panelState?this.panelState.set({circular:"1"===this.$(".info-circular").val(),startIndex:this.$(".js-start-index").val(),locked:"1"===this.$(".info-locked :checked").val()}):logUndefinedState("SequenceInformationPanelView","panelState",this,e)}updateFolder(){m.j("editor","changed_library",{folder_api_id:this._sequence.folder().api_identifier})
this.updateState()}renderUpdateButton(){const e=this.trackedFields.map((e=>this.panelState.get(e)!==this.serializeFuncs[e]())),t=this.trackedFields.map((e=>this.validateFuncs[e]()))
this.$(".update-information-text").text("Update Information")
this.$(".update-information").attr("disabled",!l.default.all(t)||!l.default.any(e))}_disableFolderSelector(){return!this._sequence.get("writable")}renderFolderSelector(){if(this._sequence.get("shared")||lo.isRegistryFolder(this._sequence.get("folder")))this.$el.find(".folder-selector-container").closest(".row").addClass("hidden")
else{this.$el.find(".folder-selector-container").closest(".row").removeClass("hidden")
const e=this.panelState.get("folder_api_id");(0,Me.A9)(d.createElement(Ye.Z,{value:e,onChange:e=>{this.panelState.set({folder_api_id:e.target.value})
this.updateFolder()},readOnly:this._disableFolderSelector(),showInventory:!0,currentTagSchema:this.sequence.tagSchema(),unsetOnFetchFail:!0}),this.$el.find(".folder-selector-container")[0])}}renderStartIndexHelp(){let e
this.$(".js-start-index-help").tooltip("destroy")
e=this.panelState.get("circular")?"The index of the first base cannot be changed for circular sequences.":"The index of the first base in the sequence. Must be greater than 0."
this.$(".js-start-index-help").tooltip({title:e,container:"body"})}renderUndeletableHelp(e){this.$(".js-delete-help").tooltip("destroy")
if(e){const e=g5.M({isArchived:this.sequence.isArchived()})
this.$(".js-delete-help").tooltip({title:e,container:"body"})}}renderDeleteButton(){if(dt.ZP.ENABLE_DELETE){const e=!this._sequence.get("permissions").deletable
this.renderUndeletableHelp(e)
this.$el.find(".delete button").prop("disabled",e)
this.$el.find(".info-delete-text").text(`Delete ${(0,Mt.E2)(this.sequence.subtype())}`)}else this.$el.find(".delete").hide()}_handleChangeName(e){this.panelState.set({name:e.target.value})}renderName(){const e=this.$el.find(".info-name")[0];(0,Me.A9)(d.createElement(InformationPanelNameInput,{archiveRecord:this._sequence.get("archiveRecord"),id:this._sequence.get("id"),isWritable:this._sequence.get("writable")&&(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()}),name:this.panelState.get("name"),onChange:this._handleChangeName.bind(this)}),e,(()=>{this.panelState.trigger("resize")}))}renderArchiveButton(){if(!dt.ZP.ENABLE_ARCHIVING_V2)return
const e=this.$el.find(".archive")[0],t=this._sequence.get("permissions"),n=t&&(0,ln.cr)({feature:rn.N7.UNARCHIVE,...this.getPartialFeatureDefinition(t)}),a=t&&(0,ln.cr)({feature:rn.N7.ARCHIVE,...this.getPartialFeatureDefinition(t)});(0,Me.A9)(d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement(wR.Z,{archiveRecord:this._sequence.get("archiveRecord"),fullWidth:!0,isArchivable:a,isUnarchivable:n,item:{id:this._sequence.get("id"),name:this._sequence.get("name"),archiveRecord:this._sequence.get("archiveRecord"),folder:this._sequence.folder(),projectFolder:this._sequence.get("projectFolder")},onArchive:IR.ap,onUnarchive:IR.yg,showText:!0}))),e,(()=>{this.panelState.trigger("resize")}))}render(){this.showSubPanel()
const e=(0,Kl.Z)(this._sequence.get("created_at"))
this.$el.find(".info-creator").text(this._sequence.get("creator"))
this.$el.find(".info-created").text(e)
this.$el.find(".info-length").text(Ue.util.formatBaseCount(this._sequence.length()))
const t=this.$el.find(".info-export-format option[value=svg]")
this._sequence.get("circular")?t.text("Vector Plasmid Map (.svg)"):t.text("Vector Linear Map (.svg)")
this.updateDownloadState()
this._sequence.get("shared")||null==this._sequence.get("parent_id")?this.$el.find(".info-parent").closest(".row").addClass("hidden"):this.$el.find(".info-parent a").attr("href",this._sequence.get("parent_url")).text(`${this._sequence.get("parent")} ("${this._sequence.get("parent_version_name")}")`).closest(".row").removeClass("hidden")
this.renderName()
this.renderFolderSelector()
this.renderArchiveButton()
const n=this._sequence.get("circular")
this.$el.find(".info-circular").val(Number(n))
this.$el.find(".js-start-index").val(this._sequence.get("startIndex"))
this.renderStartIndexHelp()
const a=Number(this._sequence.get("locked"))
this.$el.find(`.info-locked input[value=${a}]`).prop("checked",!0)
this.renderDeleteButton()
const i=(0,ln.cr)({feature:rn.N7.EDIT,...this.getPartialFeatureDefinition()})
if(this._sequence.get("writable")&&i){this.$el.find('input[type="text"], textarea').prop("readonly",!1)
this.$el.find('input[type="radio"]').prop("disabled",!1)
this.$el.find("select").prop("disabled",!1)
this.$el.find(".update-information").show()
this.renderUpdateButton()}else{this.$el.find('input[type="text"], textarea').prop("readonly",!0)
this.$el.find('input[type="radio"]').prop("disabled",!0)
this.$el.find("select").prop("disabled",!0)
this.$el.find(".export select").prop("disabled",!1)
this.$el.find(".update-information").hide()}if(this.sequence.allowResidueEdits()&&i&&!this.sequence.isOligo()&&!this.sequence.isRNASequence()){this.$el.find("select.info-circular").prop("disabled",!1)
this.$el.find(".js-start-index").prop("readonly",n)}else{this.$el.find("select.info-circular").prop("disabled",!0)
this.$el.find(".js-start-index").prop("readonly",!0)}this.sequence.allowResidueEdits({ignoreLocked:!0})&&i&&!this.sequence.isOligo()||this.$el.find(".info-locked input").prop("disabled",!0)
const s=this.$(".js-show-containing-folder"),r=this._sequence.has("folder")&&!lo.isRegistryFolder(this._sequence.get("folder"))
s.toggleClass("hidden",!r)
r?s.tooltip({container:"body"}):s.tooltip("destroy")
return this}update(e,t){this.panelState=e
this.sequence=t
null!=this._sequence&&this.stopListening(this._sequence)
this._sequence=t.get("_sequence")
this.tags=t.get("tags")
this.tagsView.update(this.panelState,t)
for(const t of this.trackedFields)null==e.get(t)&&this.panelState.set(t,this.serializeFuncs[t]())
this.listenTo(this.panelState,"change:activeSubPanel",this.showSubPanel.bind(this))
this.listenTo(this._sequence,"change:writable",this.render.bind(this))
this.listenTo(this._sequence,"change:circular",this.render.bind(this))
this.listenTo(this._sequence,"change:startIndex",this.render.bind(this))
this.listenTo(this._sequence,"change:bases",this.render.bind(this))
this.listenTo(this._sequence,"change:locked",this.render.bind(this))
this.listenTo(this.sequence,"change:currentVersion",this.render.bind(this))
this.listenTo(this._sequence,"change",this.renderUpdateButton.bind(this))
this.listenTo(this.panelState,"change",this.renderUpdateButton.bind(this))
this.listenTo(this.panelState,"change:name",this.renderName.bind(this))
this.listenTo(this.panelState,"change:folder_api_id",this.renderFolderSelector.bind(this))
this.listenTo(this._sequence,"change:name",this.renderName.bind(this))
this.listenTo(this._sequence,"change:folder",this.renderFolderSelector.bind(this))
this.listenTo(this.tags,"change add remove",this.renderUpdateButton.bind(this))
this.listenTo(this._sequence,"change:archiveRecord",this.renderDeleteButton.bind(this))
this.render()}}SequenceInformationPanelView.initClass()
const _6=SequenceInformationPanelView
var D6=n(269623)
const L6=class ProtocolInformationPanelView extends T5{folderDefaultsKey(){return Qe.O.NOTEBOOK}initialize(){this.saveModel=this.saveModel.bind(this)
this.deleteModel=this.deleteModel.bind(this)
this.requestExport=this.requestExport.bind(this)
super.initialize(...arguments)}saveModel(e){D6.Z.update(this.model.id,e,{success:this.onSaveSuccess})}deleteModel(){D6.Z.delete(this.model.id,{success:this.onDeleteSuccess})}requestExport(){h5.Z.requestExportFile(this.model.id)}}
var k6=n(608886)
class ProtocolHistoryPanelConnector extends oi.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[k6.Z]}enhanceProps(){return{versionState:k6.Z.getVersionState(this.props.id)}}}class ProtocolHistoryPanel extends d.Component{constructor(){super(...arguments)
this.openVersion=e=>{this.props.activate()
$L.Z.loadVersion(this.props.id,e)}
this.resetToVersion=()=>{$L.Z.resetToOpenVersion(this.props.id)}
this.cloneFromVersion=()=>{(0,Xn.Z)(J3.ZP,{modelType:st.PROTOCOL,id:this.props.id,versionId:this.props.versionState.openVersionId,initialName:`${this.props.name} (new)`,initialFolderId:this.props.folderId})}}render(){return d.createElement(e5.Z,{openVersion:this.openVersion,resetToVersion:this.resetToVersion,cloneFromVersion:this.cloneFromVersion,versions:this.props.versionState.versions,openVersionId:this.props.versionState.openVersionId,isLatest:this.props.versionState.isLatest,unsaved:this.props.versionState.unsaved,parent:this.props.versionState.parent,hasParent:this.props.versionState.hasParent,permissions:this.props.permissions})}}const M6=ProtocolHistoryPanelConnector.connect(ProtocolHistoryPanel)
const F6=class ProtocolHistoryPanelView extends X3{activate(){return this.model.fileState().findTab(zL.Z).set({active:!0})}getSubpanels(){return[{key:"history",title:"History",component:d.createElement(M6,{id:this.model.id,activate:this.activate.bind(this),name:this.model.name(),folderId:this.model.folder().api_identifier,permissions:this.model.permissions()})}]}}
const Z6=(0,be.Z)((function LinksInformation({allowFeatureEdits:e,allowUnlink:t,existing:n,forward:a,linkable:i,productLength:s,reverse:r,tmDiff:o}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("h5",null,e&&d.createElement("div",{className:"pull-right"},d.createElement("a",{className:"edit-pair"},"Edit"),n&&t&&d.createElement(d.Fragment,null," · ",d.createElement("a",{className:"unlink-primers"},"Unlink"))),"Primer Pair Information"))),i&&d.createElement("button",{type:"button",className:"btn-block btn btn-af-success link-primers"},"Link Primers"),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("table",{className:"table link-info-table"},d.createElement("thead",null,d.createElement("th",null),d.createElement("th",null,"Name"),d.createElement("th",null,"T",d.createElement("sub",null,"m"))),d.createElement("tbody",null,d.createElement("tr",null,d.createElement("td",null,"Forward Primer"),d.createElement("td",null,d.createElement("span",{className:"forward-name"},a.name)),d.createElement("td",null,d.createElement("span",{className:"forward-tm"},a.tm.toFixed(1),"°C"))),d.createElement("tr",null,d.createElement("td",null,"Reverse Primer"),d.createElement("td",null,d.createElement("span",{className:"reverse-name"},r.name)),d.createElement("td",null,d.createElement("span",{className:"reverse-tm"},r.tm.toFixed(1),"°C"))))))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("dl",{className:"dl-horizontal"},d.createElement("dt",null,"Product Size"),d.createElement("dd",null,s," bp"),d.createElement("dt",null,"T",d.createElement("sub",null,"m")," Difference"),d.createElement("dd",null,o,"° C")))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("button",{type:"button",className:"btn btn-af-default pull-right check-secondary"},"Secondary Structure"),d.createElement("button",{type:"button",className:f()({disabled:!window.user},"btn","btn-af-success","create-sequence")},"Create PCR Product"))))}))
const B6=(0,be.Z)((function LinksRow({primerFwd:e,primerRev:t,productLength:n,sequence:a}){return d.createElement(d.Fragment,null,d.createElement("tr",null,d.createElement("td",null,e.name()),d.createElement("td",null,"+ / ",T.modelToDisplay(e.bindPosition(a),a.startIndex())),d.createElement("td",{rowSpan:2},n)),d.createElement("tr",null,d.createElement("td",null,t.name()),d.createElement("td",null,"– / ",T.modelToDisplay(t.bindPosition(a),a.startIndex()))))}))
function PrimerRow_PrimerRow({meltingTemp:e,nucleotideType:t,name:n,position:a,strand:i,active:s,selected:r,partnerSelected:l,onPrimerRowClick:c,checked:u,onPrimerToggleCheck:m,displayLabel:p}){const h=(0,d.useRef)(!1),g=(0,d.useCallback)((e=>{e.stopPropagation()}),[]),E=(0,d.useCallback)((e=>{m(e.target.checked)}),[m])
return d.createElement("tr",{className:f()("selectable",{active:s,selected:r,"partner-selected":l&&!r}),onClick:e=>{c(e.shiftKey)},onMouseDown:e=>{h.current=!0
e.shiftKey&&e.preventDefault()},onMouseLeave:()=>{if(h.current){o()(window).one("mouseup",(()=>{h.current=!1}))
"function"==typeof window.getSelection&&window.getSelection().removeAllRanges()
h.current=!1}}},d.createElement("td",null,d.createElement("input",{type:"checkbox",checked:u,onClick:g,onChange:E})),d.createElement("td",{className:"name",...(0,ee.Z)({component:"PrimerRow",element:"name"})},p),d.createElement("td",null,t),d.createElement("td",null,i===Sn.u0.FORWARD?"+":d.createElement(d.Fragment,null,"–"),"/ ",a),d.createElement("td",null,d.createElement("div",null,e)),d.createElement("td",null))}var q6=n(82721),V6=n(467248)
function Validations({oligos:e,setCanSubmit:t}){const[n,a]=(0,Jt.uK)(e,(e=>!(0,ka.CZ)(e))),[i,s]=(0,Jt.uK)(n,(e=>e.permissions.writable)),[r,o]=(0,Jt.uK)(i,(e=>lo.isRegistered(e))),l=o.filter((e=>e.tagSchema)),c=0===r.length&&0===a.length&&0===s.length;(0,d.useEffect)((()=>{c&&t(!0)}),[c,t])
return d.createElement(d.Fragment,null,a.length>0&&d.createElement(d.Fragment,null,d.createElement(Ff.Z,null,d.createElement("span",null,"Cannot proceed because you lack permission to access the following primers."),d.createElement("div",{className:(0,g.iv)(G6.spacer)}),d.createElement(Er.ZP,{itemIds:a.map((e=>e.invalidId)),chipSize:Za.TK.MINI,isVertical:!1,showChipsAsLinks:!1}))),s.length>0&&d.createElement(d.Fragment,null,d.createElement(Ff.Z,null,d.createElement("span",null,"Cannot proceed because you lack permission to modify the following primers."),d.createElement("div",{className:(0,g.iv)(G6.spacer)}),d.createElement(Er.ZP,{itemIds:s.map((e=>e.id)),chipSize:Za.TK.MINI,isVertical:!1}))),r.length>0&&d.createElement(d.Fragment,null,d.createElement(Ff.Z,null,d.createElement("span",null,"Cannot proceed because the primers below are already registered."),d.createElement("div",{className:(0,g.iv)(G6.spacer)}),d.createElement(Er.ZP,{itemIds:r.map((e=>e.id)),chipSize:Za.TK.MINI,isVertical:!1}))),c&&l.length>0&&d.createElement(d.Fragment,null,d.createElement(aN.Z,null,d.createElement("span",null,"The primers below already have a schema set. If you proceed, existing schema fields will be preserved as custom fields."),d.createElement("div",{className:(0,g.iv)(G6.spacer)}),d.createElement(Er.ZP,{itemIds:l.map((e=>e.id)),chipSize:Za.TK.MINI,isVertical:!1}))))}const U6=xa.Ps`
  query PrimerSchemaSelectorModalQuery($oligoIds: [StrictString!]!) @skipAudit @engComponent(name: MOLBIO) {
    oligos(ids: $oligoIds) {
      ... on SequenceNode {
        id
        name
        permissions {
          readable
          writable
        }
        folder {
          id
          sourceJson
        }
        tagSchema {
          id
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function SchemaSelectorModal(e){const{oligoIds:t,oligoNucleotideTypes:n}=e,[a,i]=(0,d.useState)(void 0),[s,r]=(0,d.useState)(!1),o=Array.from(n).map((e=>st.OLIGO_NUCLEOTIDE_TYPE_TO_SEQUENCE_SUBTYPE[e]))
return d.createElement(et.ZP,{buttons:[{submit:!0,text:"Save Primers",disabled:!a||!s}],onRequestClose:e.onRequestClose,onRequestSubmit:()=>{!async function updateOligoSchemas(e,t){try{await V6.Z.bulkUpdateTagSchema(e,t,!1)
v.ZP.success("Saved primers.")
ve.ZP.get().updateSequenceVersions(e,{})}catch(e){if((0,Cn.d0)(e)){v.ZP.notifyError(e)
return}throw e}}(e.oligoIds,a)
e.onRequestSubmit()},title:"Select a schema",titleIcon:st.SEQUENCE_PRIMER},d.createElement(Da.ZP,{query:U6,variables:{oligoIds:t},renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,fetchPolicy:"network-only"},(e=>d.createElement(Validations,{oligos:e.oligos,setCanSubmit:r}))),d.createElement("div",{className:(0,g.iv)(G6.spacer)}),d.createElement(Ho.ZP,{allowNone:!0,onChange:e=>{i(null==e?void 0:e.id)},selectedTagSchemaId:a,tagSchemaFilterFn:e=>o.every((t=>(0,aw.Kc)(t,e)))}))}const G6=g.mM.create({spacer:{marginBottom:"10px"}})
function SelectedOligoActionsRow({primers:e,sequenceName:t,oligoSchemaFields:n,addPrimersToField:a}){const i=e.map((e=>({name:e.name,bases:e.bases,nucleotideType:e.nucleotideType}))),s=Uo.FC(t),r=e.map((e=>e.oligoId)),o=n.filter((t=>e.every((e=>t.eligibleNucleotideTypes.has(e.nucleotideType))))),l=d.createElement("div",null,d.createElement("p",null,"Use the Pairs tab above or link primers directly on the sequence map:"),d.createElement("p",null,"1. Click the first primer (either on the sequence map or in this list)"),d.createElement("p",null,"2. Shift-click the second primer (either on the sequence map or in this list)"),d.createElement("p",null,"3. Right-click the selected region on the sequence map to bring up the context menu"),d.createElement("p",null,"4. Select option to 'Link Primers'"),d.createElement("p",null,"Please note that RNA primers cannot be linked currently."),d.createElement("img",{src:"/static/img/primer_pair_selection.png",height:125}))
return d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-6"},d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},d.createElement(N.Z,{onSelect:()=>{Uo.ov({oligos:i,filename:s})}},"Download to CSV"),d.createElement(N.Z,{onSelect:()=>{(0,$b.Z)(Uo.mT(i,"tsv"),{showToastOnSuccess:!0,toastText:Uo.UK})}},"Copy Primers to Clipboard"),d.createElement(N.Z,{isDisabled:!(0,ln.cr)({feature:rn.N7.EDIT,itemType:st.OLIGO}),onSelect:()=>{(0,Xn.Z)(SchemaSelectorModal,{oligoIds:r,oligoNucleotideTypes:new Set(e.map((e=>e.nucleotideType)))})}},"Set Schema"),dt.ZP.WORKLISTS_ENABLE_WORKLISTS&&d.createElement(N.Z,{onSelect:()=>{(0,Xn.Z)(q6.Z,{ids:r,worklistType:(0,$I.mK)(r),refreshOptions:{refreshWorklistItemsSearch:!0,refreshWorklistsSearch:!0,refreshRecentWorklists:!0}})}},"Add to Worklist"))},d.createElement(C.Co,{isDropdown:!0,disabled:0===e.length,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:"Bulk Actions"}))),d.createElement("div",{className:f()("col","col-md-6",(0,g.iv)(z6.rightDropdownContainer))},d.createElement(zp.Z,{renderContent:()=>l,title:"Looking for Link Primers?",interaction:ne.x2.HOVER,placement:ne.ZH.LEFT,iconClassName:(0,g.iv)(z6.icon)}),n.length>0&&d.createElement(I.ZP,{menu:d.createElement(w.ZP,{height:w.ZP.HEIGHTS.MEDIUM,width:w.ZP.WIDTHS.LARGE},o.map(((t,n)=>d.createElement(N.Z,{key:n,onSelect:()=>{a(t.id,e.map((({oligoId:e})=>e)))}},t.name))))},d.createElement(C.Co,{isDropdown:!0,disabled:0===e.length||0===o.length,buttonStyle:C.ZJ.TERTIARY_GRAY,size:C.qE.SMALL,text:"Add to field"}))))}const z6=g.mM.create({rightDropdownContainer:{display:"flex",alignItems:"center",justifyContent:"flex-end",minHeight:"28px"},icon:{marginRight:"6px"}}),$6=xa.Ps`
  query PrimerTableQuery($sequenceId: StrictString!) {
    componentSequence(id: $sequenceId) @client {
      bases @client
      id @client
      name @client
      startIndex @client
      sequencePrimers @client {
        active @client
        bases @client
        checked @client
        displayLabel @client
        displayMeltingTemperature @client
        end @client
        id @client
        isNew @client
        isArchived @client
        modifiedNucleotides @client {
          position @client
          sugarMonomerId @client
          baseMonomerId @client
          phosphateMonomerId @client
        }
        name @client
        nucleotideType @client
        oligoId @client
        partnerSelected @client
        selected @client
        start @client
        strand @client
      }
    }
  }
`
function _filterAndTransformPrimers(e,t,n){return e.sequencePrimers.filter((e=>!e.isNew&&!e.isArchived&&e.oligoId)).map((a=>({...a,bases:(0,yn.dA)(a.bases,a.modifiedNucleotides,a.nucleotideType,fn.uS.OLIGO),checked:Boolean(a.checked),oligoId:a.oligoId,meltingTemp:a.displayMeltingTemperature,nucleotideType:a.nucleotideType,position:T.modelToDisplay(T.primerBindPosition((0,An.Ie)(a.strand),a.start,a.end,e.bases.length),e.startIndex),onPrimerRowClick:e=>{t(a.id,e)},onPrimerToggleCheck:e=>{n(a.id,e)},displayLabel:a.displayLabel})))}function PrimerTable({toggleAllChecked:e,sequenceId:t,oligoSchemaFields:n,addPrimersToField:a,onPrimerToggleCheck:i,onPrimerRowClick:s}){return d.createElement(Da.ZP,{query:$6,renderLoading:Da.ZP.DEFAULT_RENDER_LOADING,variables:{sequenceId:t},fetchPolicy:"cache-only"},(t=>null==t.componentSequence?null:d.createElement(PrimerTableContents,{toggleAllChecked:e,oligoSchemaFields:n,addPrimersToField:a,primers:_filterAndTransformPrimers(t.componentSequence,s,i),sequenceName:t.componentSequence.name,numArchived:t.componentSequence.sequencePrimers.filter((e=>e.isArchived)).length})))}function PrimerTableContents({primers:e,toggleAllChecked:t,numArchived:n,sequenceName:a,oligoSchemaFields:i,addPrimersToField:s}){const r=l.default.uniq(e.filter((e=>e.checked)),!1,(e=>e.oligoId))
return 0===e.length?d.createElement("div",{className:"row u-small-spacing-top"},d.createElement("div",{className:"col col-md-12"},"No primers attached to sequence")):d.createElement(d.Fragment,null,d.createElement("div",{className:"row u-tiny-spacing-top"},d.createElement("div",{className:"col col-md-12"},d.createElement("div",{className:"scroll"},d.createElement("table",{className:"table table-condensed table-hover primers-table"},d.createElement("colgroup",null,d.createElement("col",null),d.createElement("col",null),d.createElement("col",null),d.createElement("col",{className:"icon"})),d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,d.createElement(sw.Z,{items:e,selectedMap:e=>e.checked,disabled:!1,onChange:e=>{t(e.target.checked)}})),d.createElement("th",null,"Name"),d.createElement("th",null,"Nucleotide Type"),d.createElement("th",null,"Position"),d.createElement("th",null,"T",d.createElement("sub",null,"m")))),d.createElement("tbody",null,e.map(((e,t)=>d.createElement(PrimerRow_PrimerRow,{key:t,...e})))))))),n>0&&d.createElement("div",{className:"archived-primers-info u-faded u-italic u-small-spacing-bottom"},n," archived ",(0,de._6)(n,"primer")," not shown"),!showValueMessagingForSharedFile()&&d.createElement(SelectedOligoActionsRow,{oligoSchemaFields:i,primers:r,sequenceName:a,addPrimersToField:s}))}function PrimerInformation({allowFeatureEdits:e}){return d.createElement(d.Fragment,null,d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("h5",null,e&&d.createElement("div",{className:"pull-right"},d.createElement("a",{className:"edit-primer",...(0,ee.Z)({component:"PrimerInformation",element:"editPrimer"})},"Edit"),d.createElement("div",{className:"js-detach pull-right"}," · ",d.createElement("a",{className:"detach-primer"},"Detach"))),"Additional Information"))),d.createElement("div",{className:"sequence-primer-bases"},d.createElement("div",{className:"sequence-primer-bases-inner selectable mono"})),d.createElement("table",{className:"table primer-info-table"},d.createElement("colgroup",null,d.createElement("col",null),d.createElement("col",{className:"value"})),d.createElement("tbody",null,d.createElement("tr",null,d.createElement("td",null,"Name"),d.createElement("td",{className:"selectable"},d.createElement("span",{className:"name"}))),d.createElement("tr",null,d.createElement("td",null,"Folder"),d.createElement("td",null,d.createElement("a",{className:"library"}))),d.createElement("tr",null,d.createElement("td",null,"Length"),d.createElement("td",{className:"length selectable"})),d.createElement("tr",null,d.createElement("td",null,"GC Content"),d.createElement("td",{className:"gc selectable"})),d.createElement("tr",null,d.createElement("td",null,"Melting Temp."," ",d.createElement("a",{className:"adjust-tm"},"T",d.createElement("sub",null,"m")," Params")),d.createElement("td",{className:"melting-temp selectable"})),d.createElement("tr",null,d.createElement("td",null,"Color"),d.createElement("td",null,d.createElement("div",{className:"swatch-big"}))))),d.createElement("div",{className:"row"},d.createElement("div",{className:"col col-md-12"},d.createElement("div",{className:"btn-group btn-block dropup"},d.createElement("button",{type:"button","data-toggle":"dropdown",className:"btn btn-af-default btn-block tm-params"},"Analyze",d.createElement("span",{className:"caret"})),d.createElement("ul",{className:"dropdown-menu pull-right"},d.createElement("li",null,d.createElement("a",{className:"secondary-analyze"},"Check Secondary Structure"),d.createElement("a",{className:"other-binding"},"Check Specificity"),dt.ZP.MOLBIO_ENABLE_EXTERNAL_BLAST&&d.createElement("a",{className:"blast-primer"},"NCBI BLAST")))))))}async function PrimerActions_addPrimersToField(e,t){try{const n=await async function addPrimersToField(e,t){return await Cn.s0({url:`/1/api/sequences/${e}/add-oligos-to-field`,data:t})}(e,t)
v.ZP.success("Added oligos to field")
return n.tags}catch(e){if(Cn.d0(e)){v.ZP.stickyNotifyForFriendlyError(e,"add-oligos-to-schema-field")
return null}throw e}}function getOligoFieldProps(e){const t=e.tagSchema()
return t?t.fields.map((e=>({id:e.apiId,name:e.name,eligibleNucleotideTypes:(0,aw.rV)(e)}))).filter((e=>0!==e.eligibleNucleotideTypes.size)):[]}class InsertBase extends s().View{insert(e){this.panelState.get("buffers").addTab(e)
return this.panelState.trigger("close")}}class PrimerInfoView extends InsertBase{static initClass(){this.prototype.template=e=>Xt.renderToStaticMarkup(d.createElement(PrimerInformation,{allowFeatureEdits:e}))
this.prototype.events={"click .detach-primer":"deleteActivePrimer","click .adjust-tm":"adjustMeltingTemperature","click .secondary-analyze":"analyzeSecondary","click .other-binding":"findOtherBinding","click .edit-primer":"editPrimer","click .blast-primer":"blastPrimer"}}deleteActivePrimer(){return this.panelState.trigger("deleteActive")}findOtherBinding(){No.A.insert(this.sequence,{findType:2},this.selectedPrimer.get("_primer"))
return this.panelState.trigger("close")}analyzeSecondary(){sn.edit(this.selectedPrimer.get("_primer"),this.sequence,!0)
return this.panelState.trigger("close")}blastPrimer(){return blastPrimer(this.selectedPrimer)}adjustMeltingTemperature(){(0,Xn.Z)(MeltingTempModal,{})}editPrimer(){sn.edit(this.selectedPrimer.get("_primer"),this.sequence)
return this.panelState.trigger("close")}render(){if(null==this.selectedPrimer||this.selectedPrimer.isNew()){this.$el.hide()
this.panelState.trigger("resize")
return this}this.$el.show()
const e=this.selectedPrimer.bindingBases()
this.$(".name").text(this.selectedPrimer.name())
const t=this.selectedPrimer.get("_primer")
if(null!=t.get("folder")){this.$(".library").click((()=>{ve.ZP.get().openFolder(t.get("folder_api_id"),t.get("folder_url"))}))
this.$(".library").text(`${t.get("owner")}/${t.get("folder")}`)}else this.$(".library").text("None").addClass("disabled")
this.$(".sequence-primer-bases-inner").html(this.selectedPrimer.basesHtml(this.sequence))
this.$(".length").text(this.selectedPrimer.bases().length)
this.$(".gc").text(`${(100*y.gc(e,this.selectedPrimer.nucleotideType())).toFixed(1)}%`)
this.$(".melting-temp").text(this.selectedPrimer.displayMeltingTemperature())
const n=this.sequence.allowFeatureEdits()&&this.selectedPrimer.editable()
this.$(".edit-primer").toggleClass("hidden",!n)
this.$(".js-detach").toggleClass("hidden",!n||null==t.get("folder_api_id")||ye.Z.of(this.sequence._sequence()).isFlankingPrimer(this.sequence._sequence(),this.selectedPrimer))
this.updateColor()
this.panelState.trigger("resize")
return this}updatePrimerListeners(){null!=this.selectedPrimer&&this.stopListening(this.selectedPrimer.get("_primer"))
this.selectedPrimer=this.sequence.sequencePrimers().findWhere({active:!0})
this.render()
this.allowSpecificityCheck()
if(this.selectedPrimer){this.listenTo(this.selectedPrimer.get("_primer"),"change:bases",l.default.bind(this.update,this,this.panelState,this.sequence))
this.listenTo(this.selectedPrimer.get("_primer"),"change:name",(function(e){return this.$el.find(".name").text(e.get("name"))}))
this.listenTo(this.selectedPrimer.get("_primer"),"change:color",this.updateColor)
this.listenTo(this.selectedPrimer.get("_primer"),"change:nucleotideType",this.allowSpecificityCheck)}}updateColor(){return this.$el.find(".swatch-big").css("background-color",this.selectedPrimer.color()).toggleClass("disabled",!this.sequence.allowFeatureEdits())}allowSpecificityCheck(){return this.sequence.get("currentVersion")?this.$el.find(".other-binding").removeClass("disabled").tooltip("destroy"):this.$el.find(".other-binding").addClass("disabled").tooltip({placement:"left",title:"Specificity cannot be checked when on a historical version. (Feedback welcome.)"})}update(e,t){null!=this.panelState&&this.stopListening(this.panelState)
this.panelState=e
this.stopListening(We.Z)
this.listenTo(We.Z,`change:${tn.gq.MELTING_TEMP_DNA} change:${tn.gq.MELTING_TEMP_RNA}`,this.render)
null!=this.sequence&&this.stopListening(this.sequence)
this.sequence=t
this.listenTo(this.sequence.sequencePrimers(),"change:active reset",this.updatePrimerListeners)
this.$el.html(this.template(this.sequence.allowFeatureEdits()))
this.allowSpecificityCheck()
this.listenTo(this.sequence,"change:currentVersion",this.allowSpecificityCheck)
this.updatePrimerListeners()
return this.render()}}PrimerInfoView.initClass()
class LinksRowView extends s().View{static initClass(){this.prototype.template=B6
this.prototype.tagName="tbody"
this.prototype.events={click:"makeSelection"}}initialize({collection:e,sequence:t}){this.collection=e
this.sequence=t
this.listenTo(this.sequence.selection(),"change",this.toggleSelected)}makeSelection(){const e=this.sequence.selection(),[t,n]=Array.from(this.model.getPrimers(this.collection))
return e.selectPair(t,n)}toggleSelected(){const[e,t]=Array.from(this.model.getPrimers(this.collection)),n=this.sequence.selection(),a=n.getStartState("primer")===e&&n.getEndState("primer")===t
return this.$el.find("tr").toggleClass("active",a)}render(){const[e,t]=Array.from(this.model.getPrimers(this.collection))
this.$el.html(this.template({sequence:this.sequence.get("_sequence"),primerFwd:e,primerRev:t,productLength:this.model.productLength(this.collection,this.sequence.circular(),this.sequence.length()),sequtil:T}))
this.toggleSelected()
return this}}LinksRowView.initClass()
class LinksInformationView extends s().View{static initClass(){this.prototype.template=Z6
this.prototype.events={"click .unlink-primers":"destroyPair","click .edit-pair":"editPair","click .create-sequence":"createSequence","click .check-secondary":"checkSecondary"}}destroyPair(){const e=this.existingPair
return e.destroy({wait:!0}).fail(v.ZP.notifyError).done(l.default.bind((function done(){v.ZP.success("Primers successfully unlinked.")
this.sequence.updateVersions()
this.render()
return m.j("primer","unlinked_primers",{forward_primer_id:e.forwardPrimerId(),reverse_primer_id:e.reversePrimerId(),sequence_id:this.sequence.get("id")})}),this))}createSequence(){m.j("primer","create_sequence",{sequence_id:this.sequence.get("id")})
return this.sequence.handleCreateFromSelectionClick(this.sequence.type(),this.sequence.type()===fn.uS.SINGLE_STRANDED?1:null)}checkSecondary(){const[e,t]=Array.from(this.existingPair.getPrimers(this.sequence.get("_sequence").sequencePrimers()))
sn.editPair(e,t,this.sequence,!0)
return this.panelState.trigger("close")}editPair(){const[e,t]=Array.from(this.existingPair.getPrimers(this.sequence.get("_sequence").sequencePrimers()))
sn.editPair(e,t,this.sequence)
return this.panelState.trigger("close")}render(){this.existingPair=null
if(this.selection.canPCR()){let e=this.selection.getStartState("primer"),t=this.selection.getEndState("primer");(0,S.Gp)(e.strand()===-t.strand(),`Primers ${e.name()} and ${t.name()} selected and canPCR(), but different strands!`)
if(-1===e.strand()){t=e
e=t}const n=e.get("_primer").meltingTemperature(),a=t.get("_primer").meltingTemperature(),i=a-n,s={primer_fwd_id:e.id,primer_rev_id:t.id}
this.existingPair=this.pairs.findWhere(s)||new Ue.PrimerPair(s,{primers:this.primers})
const r=this.existingPair.productLength(this.primers,this.sequence.circular(),this.sequence.length())
let o=!0
if(null!=this.existingPair&&!this.sequence.finalized()){o=null==this.sequence.fragmentResults().find((e=>e.primerPairID()===this.existingPair.id))}this.$el.html(this.template({forward:{name:e.name(),tm:n},reverse:{name:t.name(),tm:a},tmDiff:i>0?`+${i.toFixed(1)}`:i.toFixed(1),productLength:r,existing:!this.existingPair.isNew(),linkable:null!=this.existingPair&&this.sequence.allowFeatureEdits()&&!e.fromSubPart()&&!t.fromSubPart(),allowFeatureEdits:this.sequence.allowFeatureEdits(),allowUnlink:o}))
this.$(".link-primers").toggleClass("disabled",!this.existingPair.isNew())}this.$el.toggleClass("hidden",!this.selection.canPCR())
this.panelState.trigger("resize")
return this}update(e,t){this.panelState=e
this.sequence=t
this.primers=this.sequence.sequencePrimers()
null!=this.pairs&&this.stopListening(this.pairs)
this.pairs=this.sequence.get("_sequence").primerPairs()
this.listenTo(this.pairs,"change:id",this.render)
null!=this.selection&&this.stopListening(this.selection)
this.selection=this.sequence.selection()
this.listenTo(this.selection,"change",this.render)
return this.render()}}LinksInformationView.initClass()
class LinksView extends s().View{initialize(){this.infoView=new LinksInformationView({el:this.$el.find(".link-info")})
return this.infoView}render(){let e
if(null!=this.rowViews)for(e of Array.from(this.rowViews))e.remove()
this.rowViews=Array.from(this.pairs.models).map((e=>new LinksRowView({model:e,collection:this.primers,sequence:this.sequence}).render()))
const t=(()=>{const t=[]
for(e of Array.from(this.rowViews))t.push(e.el)
return t})()
this.$el.find(".primer-links-table").find("tbody").remove()
if(t.length>0)this.$el.find(".primer-links-table").append(t)
else{const e=o()("<tr>").append(o()('<td colspan="3">').html("No linked primers"))
this.$el.find(".primer-links-table").append(o()("<tbody>").append(e))}return this}update(e,t){null!=this.primers&&this.stopListening(this.primers)
null!=this.sequence&&this.stopListening(this.sequence.get("_sequence"))
this.sequence=t
this.primers=t.sequencePrimers()
const listenToPairs=e=>{null!=this.pairs&&this.stopListening(this.pairs)
this.pairs=t.get("_sequence").primerPairs()
this.listenTo(this.pairs,"add remove reset",this.render)
e&&this.render()}
this.listenTo(t.get("_sequence"),"change:primerPairs",(()=>listenToPairs(!0)))
listenToPairs(!1)
this.infoView.update(e,t)
return this.render()}}class PrimerPanelView extends InsertBase{static initClass(){this.prototype.el="#primer-panel"
this.prototype.events={"click .primers-title":"showPrimers","click .links-title":"showLinks","click .create-manual":"createPrimer","click .create-wizard":"generatePrimers","click .js-attach-existing":"searchPrimers","click .link-primers":"linkPrimers","click .js-detach-all-primers":"deleteAllPrimers","click .create-primers":"trackCreatePrimers"}}initialize(){this.infoView=new PrimerInfoView({el:this.$el.find(".additional-primer-info")})
this.linkView=new LinksView({el:this.$el.find(".links-subpanel .panel-container")})
return this.linkView}trackCreatePrimers(){m.j("primer","create_primers_clicked",{product:j.XC.MOLBIO,sequence_id:this.sequence.get("id")})}showSubPanel(){const e=this.panelState.get("activeSubPanel")
renderPanelTabs(this.panelState,[[J5.R,"Primers"],[J5.Rj,"Pairs"]],this.$(".panel-title")[0])
this.$el.find('h4[class*="-title"]').parent().removeClass("active")
this.$el.find(`.${e}-title`).parent().addClass("active")
this.$el.find(".panel-container").parent().hide()
this.$el.find(`.${e}-subpanel`).show()
this.$el.find(".panel-content").scrollTop(0)
this.panelState.trigger("resize")}showPrimers(){return this.panelState.set("activeSubPanel",J5.R)}showLinks(){return this.panelState.set("activeSubPanel",J5.Rj)}createPrimer(e){e.preventDefault()
this.insert(new sn({sequence:this.sequence}))
m.j("primer","open_edit_primer_tab",{product:j.XC.MOLBIO,createdFrom:"toolbar",direction:null,sequence_id:this.sequence.get("id")})}generatePrimers(e){e.preventDefault()
const t=new ml.Z({sequence:this.sequence,buffers:this.panelState.get("buffers")})
this.insert(t)
m.j("primer","open_primer_wizard",{product:j.XC.MOLBIO,sequence_id:this.sequence.get("id")})}searchPrimers(){m.j("primer","attach_existing_click",{product:j.XC.MOLBIO,sequence_id:this.sequence.get("id")})
No.A.insert(this.sequence,{findType:1})
return this.panelState.trigger("close")}upsert(e){const t=this.panelState.get("buffers"),n=t.getTab((t=>t.get("title")===e.get("title")))
null!=n?n.set({active:!0}):t.addTab(e)
return this.panelState.trigger("close")}linkPrimers(){this.$(".link-primers").button("loading")
createPrimerPair(this.sequence,(()=>{this.$(".link-primers").button("reset")
l.default.defer((()=>this.renderLinkButton()))}))}async deleteAllPrimers(){if(this.sequence.allowFeatureEdits()&&await(0,Zb.Z)({typeName:"primers",message:"Are you sure you want to remove all primers from the sequence?"})){m.j("primer","deleted_all_primers",{sequence_id:this.sequence.get("id")})
const e=this.sequence._primers,[t,n]=Array.from(l.default.partition(e.models,(e=>e.fromSubPart()))),[a,i]=Array.from(l.default.partition(n,(e=>e.isNew())))
if(t.length&&!n.length){v.ZP.warn("Primers that belong to sequence parts must be detached from that part.")
return}const s=i.length?e.bulkDelete(i,{fileUpdate:!0}).fail(v.ZP.notifyError):null
o().when(s).done((()=>{e.remove(a)
t.length?v.ZP.success("All non-part primers detached successfully."):v.ZP.success("All primers detached successfully.")}))}}deleteActivePrimer(){const e=this.primers.findWhere({active:!0})
if(null==e)return
let t=0
for(let n=0;n<this.primers.models.length;n++){if(this.primers.models[n].id===e.id){t=n
break}}e.destroy().done((()=>{m.j("primer","deleted_primer",{sequence_id:this.sequence.get("id")})
const n=Math.min(t,this.primers.length-1)
n>=0&&this.primers.at(n).set({active:!0})
v.ZP.success(`Primer **${e.name()}** detached successfully.`)
this.renderLibrary()
this.sequence.updateVersions()})).fail(v.ZP.notifyError)}addLibraryListeners(){const e=this.sequence
this.listenTo(We.Z,`change:${tn.gq.MELTING_TEMP_DNA} change:${tn.gq.MELTING_TEMP_RNA}`,this.renderLibrary)
this.listenTo(e._sequence(),"change:startIndex",this.renderLibrary)}renderLibrary(){(0,S.Gp)(this.sequence.sequencePrimers()===this.primers,"Primers out of sync with sequence.sequencePrimers")
const e=function getPrimerTableProps(e){const t=e.sequencePrimers().models,n={}
for(const e of t)n[e.cid]=e
return{toggleAllChecked:e=>{let n=!1
for(const a of t)a?a.set(Ai.Q,e):n=!0
n&&(0,S.Gp)(!1,"Primers were stale")},onPrimerToggleCheck:(e,t)=>{const a=n[e]
a?a.set(Ai.Q,t):(0,S.Gp)(!1,"Primers were stale")},onPrimerRowClick:(t,a)=>{const i=n[t]
i?i.click(e,a):(0,S.Gp)(!1,"Primers were stale")},sequenceName:e.name(),sequenceId:e.get("id"),oligoSchemaFields:getOligoFieldProps(e),addPrimersToField:async(t,n)=>{const a=await PrimerActions_addPrimersToField(e.get("_sequence").get("id"),{schemaFieldId:t,oligoIds:n})
if(a){e.setTags(a)
e.fileState().activateTab(_N.Z)}}}}(this.sequence);(0,Me.A9)(d.createElement(PrimerTable,e),this.$el.find(".primers-table-container").get(0))
this.$(".js-detach-all-primers-section").toggleClass("hidden",!this.primers.length)}renderLinkButton(){return this.$(".link-primers").toggleClass("disabled",!canCreatePrimerPair(this.sequence))}_updateListener(e,t){null!=this[e]&&this.stopListening(this[e])
this[e]=t}render(){this.showSubPanel()
this.renderLibrary()
this.addLibraryListeners()
this.renderLinkButton()
this.$(".js-disable-readonly .btn").toggleClass("disabled",!this.sequence.allowFeatureEdits())
if(showValueMessagingForSharedFile()){this.$(".js-hide-for-share-link").addClass("hide");(0,Me.A9)(d.createElement(ToolbarSignupMessage,{action:"add a primer"}),this.$el.find(".share-link-message-react-mount")[0])}else if(this.sequence.allowFeatureEdits())this.$(".js-disable-readonly").tooltip("destroy")
else{this.$(".js-disable-readonly").tooltip({title:"Enabled on writable sequences only",placement:"bottom",container:"body"})
this.$(".js-detach-all-primers").addClass("disabled")}this.$(".link-primers").toggleClass("hidden",!this.sequence.allowFeatureEdits())
return this}update(e,t){this._updateListener("panelState",e)
this.listenTo(this.panelState,"change:activeSubPanel",this.showSubPanel)
this.listenTo(this.panelState,"deleteActive",this.deleteActivePrimer)
this._updateListener("sequence",t)
this._updateListener("primers",t.sequencePrimers())
this._updateListener("pairs",t.primerPairs())
this.listenTo(this.primers,"change remove add reset saved",this.render)
this.listenTo(this.primers,"change:strand change:nucleotideType change:fromSubPart change:selected",this.renderLinkButton)
this.listenTo(this.pairs,"remove add reset saved",this.renderLinkButton)
this.infoView.update(e,t)
this.linkView.update(e,t)
this.$(".js-detach-all-primers").toggleClass("disabled",!this.sequence.get("_sequence").finalized())
return this.render()}}PrimerPanelView.initClass()
const W6=PrimerPanelView
var H6=n(426178),j6=n(292132)
function ActiveEnzymeItem({color:e,onClick:t,onMouseOut:n,onMouseOver:a,name:i}){const s=(0,d.useRef)(null)
return d.createElement("tr",{onClick:t,onMouseOut:n,onMouseOver:()=>{null!=s.current&&null!=s.current.offsetParent&&a(s.current.offsetTop-s.current.offsetParent.scrollTop)},ref:s,...(0,ee.Z)({component:"ActiveEnzymeItem",element:"row"}),className:(0,g.iv)(Y6.wrapper)},d.createElement("td",{className:f()("mono",(0,g.iv)(Y6.enzymeNameCell))},i),d.createElement("td",{className:(0,g.iv)(Y6.swatchCell)},d.createElement("div",{className:f()("swatch",(0,g.iv)(Y6.swatch)),style:{backgroundColor:e}})))}const Y6=g.mM.create({wrapper:{cursor:"pointer"},enzymeNameCell:{width:"120px",textAlign:"left"},swatchCell:{width:"80px"},swatch:{marginTop:"5px"}})
function DeleteDigestConfirmationModal({digest:e,onRequestClose:t,onRequestSubmit:n}){return d.createElement(et.ZP,{buttons:[{text:"Confirm",submit:!0,style:C.ZJ.PRIMARY,onClick:n},{text:"Cancel",cancel:!0,style:C.ZJ.TERTIARY_GRAY,onClick:t}],onRequestClose:t,title:"Confirm Deleting Digest"},d.createElement("div",null,d.createElement("b",null,l.default.escape(e.get("name")))," is currently open in a tab - are you sure you want to delete it and close its tab?"))}function DigestLibraryItem({disableDelete:e,enzymeNamesDisplay:t,name:n,onClick:a,onClickDelete:i}){return d.createElement("tr",{className:(0,g.iv)(Q6.wrapper),onClick:a},d.createElement("td",{className:"name"},n),d.createElement("td",null,t,!e&&d.createElement("span",{className:"glyphicon glyphicon-trash delete pull-right",onClick:e=>{e.stopPropagation()
i()}})))}const Q6=g.mM.create({wrapper:{cursor:"pointer"}})
function DigestLibrary({digests:e,disableDelete:t,enzymes:n,onClickItem:a,onDeleteItem:i}){return 0===e.length?d.createElement("tr",null,d.createElement("td",{colSpan:2},"You don't have any saved digests yet.")):d.createElement(d.Fragment,null,e.map((e=>{const s=e.get("enzymes").map((e=>n.get(e).get("name")))
return d.createElement(DigestLibraryItem,{disableDelete:t,enzymeNamesDisplay:s.join(", "),key:e.id,name:e.get("name"),onClick:()=>{a(e)},onClickDelete:()=>{i(e)}})})))}function EnzymeCatalogItem({active:e,catalogVisible:t,hideCutPositions:n,highlight:a,name:i,onClick:s,onMouseOver:r,sites:o}){return t?d.createElement("tr",{className:f()((0,g.iv)(K6.wrapper),{active:e,[(0,g.iv)(K6.highlight)]:a}),onMouseOver:r,onClick:s,...(0,ee.Z)({component:"EnzymeCatalogItem",element:"row"})},d.createElement("td",{className:f()("mono",(0,g.iv)(K6.enzymeNameCell)),...(0,ee.Z)({component:"EnzymeRow",element:"name"})},i),!n&&d.createElement("td",{...(0,ee.Z)({component:"EnzymeRow",element:"sites"}),className:(0,g.iv)(K6.cutsiteCountCell)},o)):d.createElement(d.Fragment,null)}const K6=g.mM.create({wrapper:{cursor:"pointer"},highlight:{fontWeight:"bold"},enzymeNameCell:{width:"120px",textAlign:"left"},cutsiteCountCell:{width:"80px"}})
const J6=(0,be.Z)((function EnzymePreview({enzyme:e,hideJump:t,providedEnzyme:n}){return d.createElement("div",null,d.createElement("div",null,d.createElement("span",{className:"close"},"×")),d.createElement("h5",null,"Enzyme ",e.name),d.createElement("div",{className:"cut-info-wrapper"},d.createElement("div",{className:"cut-info mono"})),d.createElement("div",{className:"js-enzyme-provider"}),d.createElement("dl",{className:"enzyme-popover-info"},n.url&&d.createElement(d.Fragment,null,d.createElement("dt",null,"Link"),d.createElement("dd",null,d.createElement("a",{href:n.url,rel:"noopener noreferrer",target:"_blank",className:"enzyme-link"},n.baseName))),d.createElement("dt",null,"Inactivation"),d.createElement("dd",null,null!=n.inactivationTemperature?d.createElement(d.Fragment,null,n.inactivationTemperature,"°C"):"N/A"),d.createElement("dt",null,"Incubation"),d.createElement("dd",null,null!=n.incubationTemperature?d.createElement(d.Fragment,null,n.incubationTemperature,"°C"):"N/A"),d.createElement("dt",null,"Activity"),d.createElement("dd",null,d.createElement("table",{className:"table table-condensed table-bordered enzyme-preview-table"},n.activityRows.map(((e,t)=>d.createElement(d.Fragment,{key:t},d.createElement("tr",null,e.map(((e,t)=>d.createElement("th",{key:t,className:f()({"is-highlighted":e.highlighted})},e.buffer)))),d.createElement("tr",null,e.map(((e,t)=>d.createElement("td",{key:t,className:f()({success:e.highlighted})},e.value))))))))),d.createElement("dt",null,"Isos."),d.createElement("dd",null,e.isoschizomers.length>0?d.createElement("ul",{className:"enzyme-isoschizomers"},e.isoschizomers.map((e=>d.createElement("li",{key:e.id},d.createElement("a",{"data-enzymeId":e.id},e.name))))):"None"),e.cutPositions.length>0&&!t&&d.createElement(d.Fragment,null,d.createElement("dt",null,"Jump to Cut Site"),d.createElement("div",{className:"cut-positions"},d.createElement("table",{className:"table table-condensed table-hover"})))))}))
const X6=class CallQueuer{constructor(e){null==e&&(e=3)
this.batch=e
this.tasks=[]
this.id=null}process(e){const t=this.tasks.splice(0,e)
return t.length>0?Array.from(t).map((e=>e.func())):this.stop()}resume(){if(null==this.id)return this.id=setInterval(l.default.bind(this.process,this),17,this.batch)}stop(){if(null!=this.id){clearInterval(this.id)
return this.id=null}}add(e,t){this.remove(e)
return this.tasks.push({id:e,func:t})}stack(e,t){this.remove(e)
return this.tasks.unshift({id:e,func:t})}remove(e){if(null==e)return
const t=this.find(e)
return t>-1?this.tasks.splice(t,1)[0]:void 0}purge(){this.tasks=[]
return this.stop()}find(e){return l.default.indexOf(l.default.map(this.tasks,(e=>e.id)),e)}restack(e){const t=this.remove(e)
if(null!=t)return this.stack(t.id,t.func)}}
class RestrictionPanelView extends s().View{static initClass(){this.prototype.el="#restriction-panel"
this.prototype.events={"click .new-digest-title":"showNewDigest","keyup .search":"filter","change .search":"filter","change .enzyme-lists":"changeViewEnzymes","click .my-digests-title":"showMyDigests","change .view-enzymes":"changeViewEnzymes","click .run-digest":"runDigest","click .cut-position":"jumpToPosition","click .close":"closeSidebar","click .enzyme-link":"trackEnzymeLinkClick","click .checkbox label":"changeCompatible","change .cut-region select":"changeCutRegion","click a[data-enzymeId]":"clickEnzymeHandler","click .js-clear-selected":function(e){e.preventDefault()
this.clearEnzymes()}}
this.prototype.trackSearch=(0,Ja.Z)((e=>{e.length>1&&m.j("digest","search_enzymes",{query:e})}),5e3)}initialize(){this.providerChangeHandler=this.providerChangeHandler.bind(this)
this.$el.find(".my-digests-subpanel").hide()
this.callQueuer=new X6(1)}changeCutRegion(e){null!=this.panelState?this.panelState.set({cutRegion:e.target.value}):logUndefinedState("RestrictionPanelView","panelState",this,e)}trackEnzymeLinkClick(e){const t=o()(e.currentTarget).attr("href")
m.j("digest","clicked_enzyme_link",{url:t})}getOtherSubPanel(e){return e===J5.n?J5.Vb:J5.n}findOpenTab(e){for(const t of Array.from(this.buffers.models))for(const n of Array.from(t.tabs().models))if(n.get("analysis")===e)return n
return null}showSubPanel(){const e=this.panelState.get("activeSubPanel"),t=this.getOtherSubPanel(e)
this.$el.find(`.${e}-title`).parent().addClass("active")
this.$el.find(`.${t}-title`).parent().removeClass("active")
renderPanelTabs(this.panelState,[[J5.n,"New Digest"],[J5.Vb,"Saved Digests"]],this.$(".panel-title")[0])
this.$el.find(`.${e}-subpanel`).show()
this.$el.find(".panel-content").scrollTop(0)
this.$el.find(`.${t}-subpanel`).hide()
this.panelState.trigger("resize")}showNewDigest(){this.panelState.set("activeSubPanel",J5.n)}showMyDigests(){this.panelState.set("activeSubPanel",J5.Vb)}clickEnzymeHandler(e){const t=o()(e.target).attr("data-enzymeId"),n=this.enzymes.get(t)
n.trigger("zoomTo",{offset:0,enzyme:n})
n.trigger("showDetail",n)}setupEnzymes(e){let t,n
const a=this.$el.find(".view-enzymes").val()
this.panelState.set({viewEnzymes:a})
We.Z.set({[te.n$.VIEW_ENZYMES]:a})
const i=this.$el.find(".enzyme-lists"),s=JSON.parse(i.val())
t=We.Z.get(te.n$.ENZYME_LIST_ID)===s?We.Z.get(te.n$.PROVIDER):null!=(n=xe.Pg(s))?n.defaultProvider.name:te.ZP.baseProviders[0].name
this.panelState.set({enzymeListId:s,enzymesProvider:t})
We.Z.set({[te.n$.ENZYME_LIST_ID]:s,[te.n$.PROVIDER]:t})
if(e){this.enzymes.each((e=>{this.panelState.changeViewEnzyme(e,null,{trigger:!1})}))
this.sequence.get("cutsites").trigger("cutsitesChanged")}this.filter()}changeViewEnzymes(e){null!=this.panelState?this.setupEnzymes(!0):logUndefinedState("RestrictionPanelView","panelState",this,e)}renderEnzymeCatalog(){(0,Me.A9)(d.createElement(d.Fragment,null,this.enzymes.models.map((e=>d.createElement(EnzymeCatalogItem,{active:e.get("active"),catalogVisible:e.get("catalogVisible"),hideCutPositions:this.sequence.isReallyBig(),highlight:e.highlight(),key:e.id,name:e.get("name"),onClick:()=>{m.j("digest","select_enzyme",{enzyme:e.get("name")})
const t=!e.get("active")
e.set("active",t)},onMouseOver:()=>{e.trigger("showDetail",e)},sites:e.get("cutPositions").length})))),this.$el.find("table.catalogue tbody")[0])}renderActiveEnzymes(){(0,Me.A9)(d.createElement(d.Fragment,null,this.panelState.get("selectedEnzymes").map((e=>d.createElement(ActiveEnzymeItem,{color:e.color(),key:e.id,onClick:()=>{e.set({active:!1,highlight:!1})},onMouseOver:t=>{e.trigger("zoomTo",{offset:t,enzyme:e})
e.trigger("showDetail",e)
e.set("highlight",!0)},onMouseOut:()=>{e.set("highlight",!1)},name:e.name()})))),this.$el.find("table.active-enzymes tbody")[0])}renderEnzymes(){this.renderEnzymeCatalog()
this.renderActiveEnzymes()
this.setupEnzymes(!1)}closeSidebar(){this.$el.find(".panel").removeClass("show-sidebar")
this.callQueuer.purge()
this.sidebarEnzyme=null}providerChangeHandler(e){this.panelState.set("enzymesProvider",e.name)
We.Z.set(te.n$.PROVIDER,e.name)}renderSidebar(e=this.sidebarEnzyme){let t
if(null==e)return
this.sidebarEnzyme=e
const n=this.sequence.isReallyBig(),a=this.panelState.get("enzymesProvider"),i=xe.p_([e.id],a),s=xe.fW(i.name),r=e.get("providedEnzymes"),c=r[i.name],u=i.buffers.filter((e=>e in c.activities)),m=xe.yX([e.id],i.name),p=u.map((e=>({buffer:xe.Dc(e),value:c.activities[e],highlighted:Array.from(m).includes(e)}))),h=p.length%3==0&&p.length%4!=0?3:4,g=(()=>{const e=[]
for(t=0;t<p.length/h;t++)e.push(p.slice(h*t,h*(t+1)))
return e})(),E=o()(J6({hideJump:n,enzyme:l.default.extend(e.toJSON(),{isoschizomers:this.enzymes.getEnzymesJSON(e.get("isoschizomers"))}),providedEnzyme:{activityRows:g,url:c.url,baseName:s.name,inactivationTemperature:c.inactivationTemperature,incubationTemperature:c.incubationTemperature}})),f=d.createElement(Le,{providers:Object.keys(r).map((e=>xe.VH(e))),value:i,onChange:this.providerChangeHandler});(0,Me.A9)(f,E.find(".js-enzyme-provider")[0])
const S=E.find(".cut-positions table")
if(!n){const t=this.sequence.startIndex()
this.callQueuer.purge()
l.default.chain(e.get("cutPositions")).groupBy(((e,t)=>Math.floor(t/100))).values().each((function(e){return this.callQueuer.add(null,(()=>S.append(l.default.map(e,(e=>`<tr><td class='cut-position'>${T.modelToDisplay(e.position,t)}</td></tr>`)))))}),this)
this.callQueuer.resume()}const y=E.find(".cut-info"),b=e.get("cut"),v=e.get("seq"),C=b+e.get("offset")
let I=b-v.length
const w=I+e.get("offset")
let N=0
const A=o()("<div>").html(l.default.map(v.split(""),(e=>o()(`<span>${e}</span>`)))).addClass("enzyme-top").attr("data-test-component","PanelSidebar").attr("data-test-element","recognitionSiteForward"),P=o()("<div>").html(l.default.map(Ue.util.complement(v,R.jb).split(""),(e=>o()(`<span>${e}</span>`)))).addClass("enzyme-bottom").attr("data-test-component","PanelSidebar").attr("data-test-element","recognitionSiteReverse")
y.append(A).append(P)
const O=o()("<span>").addClass("cut-symbol"),render=(e,t,n,a)=>{if(1===n){e.append("<span>N</span>")
return e.append(O.clone())}if(n>1){e.append(`<span>(N)<sub>${n}</sub></span>`)
return e.append(O.clone())}if(-1===t){e.prepend("<span>N</span>")
e.prepend(O.clone())
return N+=Number(a)}if(t<-1){e.prepend(`<span><sub>${-t}</sub>(N)</span>`)
e.prepend(O.clone())
return N+=a*(-t+"(N)").length}return t===v.length?e.append(O.clone()):e.find("span").eq(t).before(O.clone())}
render(A,b,I,1)
render(P,C,w,-1)
if(e.doubleCutter()){I=e.get("cut2")-v.length
render(A,null,I,1)
render(P,null,I+e.get("offset2"))}N>0?y.addClass("text-right"):N<=0&&y.addClass("text-left")
this.$el.find(".new-digest-subpanel .panel-sidebar").html(E)
this.$el.find(".panel").addClass("show-sidebar")}jumpToPosition(e){const t=T.displayToModel(parseInt(o()(e.currentTarget).html(),10),this.sequence.startIndex()),n=this.sidebarEnzyme
if(0===this.sequence.get("cutsites").filter((e=>e.get("position")===t&&e.get("enzyme")===n)).length){const e=new Kx.Z({enzyme:n,position:t,fontColor:"blue"})
this.sequence.get("cutsites").add(e)
const a=l.default.bind((function(){return this.sequence.get("cutsites").remove(e)}),this)
l.default.delay(a,1e3)}this.sequence.get("selection").reset(t)
this.sequence.trigger("cursorJump",t)}runDigest(){const e=this.panelState.get("selectedEnzymes")
if(0===e.length){v.ZP.error("You must select at least one enzyme.")
return}const t=l.default.bind((function(){Ys.OZ(Qs.ZP.MODULES.SEQUENCE,Qs.ZP.RUN_DIGEST)
const t=Array.from(e.models).map((e=>e.id)),n=new j6.DO({analysis_type:Y3.Nu,enzymes:t,name:"Digest"}),a=new Yr.Z({analysis:n,sequence:this.sequence}),i=this.panelState.get("buffers")
0===i.length&&i.add(new nn.aL)
i.addTab(a,{side:"right"})
H6.Z.get().add(a)
a.set({active:!0})
this.clearEnzymes()
v.ZP.success("Digest successfully created.")
this.panelState.trigger("close")}),this),n=l.default.map(e.models,(e=>e.toJSON())),a=this.sequence.get("_sequence").enzymeOverlap(n)
if(a.length>0){let e="<p>The resulting digest may be inaccurate, as the following enzymes have overlapping cutsites:</p>\n<div class='scroll'>\n<table class=\"table table-condensed\">\n  <thead>\n    <tr><th>Start</th><th>End</th><th>Enzymes</th></tr>\n  </thead>\n  <tbody>"
for(const t of Array.from(a)){const n=l.default.chain(t.enzymes).countBy((e=>e)).pairs().map((e=>e[0]+(e[1]>1?"*":""))).value().join(", ")
e+=`    <tr>\n  <td>${t.start}</td>\n  <td>${t.end}</td>\n  <td>${n}</td>\n</tr>`}e+="  </tbody>\n</table>\n</div>\n<p class='table-note'>* The enzyme has multiple cutsites in the same region.</p>\n<p>Proceed with digest anyway?</p>"
new Ot.I4({title:"Conflicting Enzymes",msg:e}).choice("OK","btn-af-primary",t).choice("Cancel","btn-af-default").show()}else t()
m.j("digest","ran_digest",{enzyme_count:e.length})}clearEnzymes(){Array.from(this.panelState.get("selectedEnzymes").models.slice()).map((e=>e.set({active:!1,color:null})))}async deleteDigest(e){var t
try{await e.destroy()
v.ZP.success(`Digest **${e.get("name")}** successfully deleted.`)
m.j("digest","deleted_digest")
null===(t=this.findOpenTab(e))||void 0===t||t.close()}catch(e){v.ZP.error("An error occurred while trying to delete the digest.")}}renderLibrary(){(0,Me.A9)(d.createElement(DigestLibrary,{digests:this.sequence.get("analyses").filter((e=>e.get("analysis_type")===Y3.Nu)),disableDelete:!this.sequence.allowFeatureEdits({ignoreVersion:!0}),enzymes:this.sequence.get("enzymes"),onClickItem:async e=>{m.j("digest","opened_digest")
const t=this.findOpenTab(e)
if(null!=t)t.set({active:!0})
else{await e.fetch()
const t=new Yr.Z({analysis:e,sequence:this.sequence})
this.panelState.get("buffers").addTab(t)
H6.Z.get().add(t)
this.panelState.trigger("close")}},onDeleteItem:e=>{null==this.findOpenTab(e)?this.deleteDigest(e):(0,Xn.Z)(DeleteDigestConfirmationModal,{digest:e,onRequestClose:Jt.ZT,onRequestSubmit:()=>{this.deleteDigest(e)}})}}),this.$el.find("table.digest-library tbody")[0])}filter(){this.panelState.set("search",this.$el.find(".search").val())
const e=this.panelState.get("search").toLowerCase()
this.trackSearch(e)
this.enzymes.batchModify((()=>{this.enzymes.each((e=>{this.filterEnzyme(e)}))}))}filterEnzyme(e){const t=this.panelState.get("search").toLowerCase(),n=t.split(" "),a=this.sequence.isReallyBig()
if(xe.H5(this.panelState.get("enzymeListId"),e.id)){const i=this.panelState.get("cutRegion")
if((()=>{if("anywhere"===i)return!0
{const t=e.get("cutPositions").map((t=>{if(0===this.selection.length())return!1
if(0===e.get("offset"))return T.baseInRange(t.position,this.selection.start(),this.selection.end())
let n=t.position,a=T.mod(n+e.get("offset"),this.sequence.length())
e.get("offset")<0&&([n,a]=Array.from([a,n]))
return T.isRangeOverlap(n,a,this.selection.start(),this.selection.end())}))
switch(i){case"inselection":return l.default.any(t)
case"exceptselection":return!l.default.any(t)
case"onlyselection":return l.default.all(t)&&0!==t.length}}})()){const i=[e.id,...Array.from(e.get("isoschizomers"))].map((e=>this.enzymes.get(e).get("name").toLowerCase()))
if(Number.isNaN(parseInt(t,10))||a){let t=!0
for(const s of n){const n=parseInt(s,10)
if(Number.isNaN(n)||a)t=t&&i.some((e=>e.indexOf(s)>=0))
else{const a=n===e.get("cutPositions").length||i.some((e=>e.indexOf(s)>=0))
t=t&&a}}e.set("catalogVisible",t)}else e.set("catalogVisible",e.get("cutPositions").length===parseInt(t,10))}else e.set("catalogVisible",!1)}else e.set("catalogVisible",!1)}restoreState(){this.$el.find(".search").val(this.panelState.get("search"))
this.$el.find(".view-enzymes").val(this.panelState.get("viewEnzymes"))
this.$el.find(".enzymes_list").val(JSON.stringify(this.panelState.get("enzymeListId")))
this.$el.find(".panel").removeClass("show-sidebar")}showEnzymeLists(){const e=this.$el.find(".enzyme-lists")
e.empty()
const t=o()("<optgroup>").attr("label","Commercial")
for(const{id:e,name:n}of te.ZP.providerLists)t.append(new Option(n,JSON.stringify(e)))
const n=o()("<optgroup>").attr("label","Custom Lists")
for(const e of Array.from(window.bootstrap.enzyme_lists)){let t
t=e.owner_handle===window.user.handle?e.name:`${e.owner_handle} / ${e.name}`
n.append(new Option(t,JSON.stringify(e.id)))}e.append(t)
e.append(n)
const a=this.panelState.get("enzymeListId")
if(xe.Uk(a))e.val(JSON.stringify(a))
else{this.panelState.set("enzymeListId",te.ZP.DEFAULT_ENZYMES_LIST_ID)
e.val(JSON.stringify(te.ZP.DEFAULT_ENZYMES_LIST_ID))}}updateHighlightCompatible(e,t){this.$el.find(".checkbox input").prop("checked",t)}changeCompatible(){this.panelState.set({highlightCompatible:this.$el.find(".checkbox input").prop("checked")})}updateCutRegion(){this.sequence.isReallyBig()?this.$(".cut-region select").prop("disabled",!0).val("anywhere"):this.$(".cut-region select").prop("disabled",!1)}update(e,t){if(showValueMessagingForSharedFile()){this.$el.find(".run-digest").addClass("disabled");(0,Me.A9)(d.createElement(ToolbarSignupMessage,{action:"run a digest"}),this.$el.find(".share-link-message-react-mount")[0])}null!=this.panelState&&this.stopListening(this.panelState)
this.panelState=e
this.buffers=e.get("buffers")
this.listenTo(this.panelState,"change:activeSubPanel",this.showSubPanel)
this.listenTo(this.panelState,"change:enzymeListId",((e,t)=>{m.j("digest","changed_enzyme_list",{custom:-1!==t,id:t})}))
this.listenTo(this.panelState,"change:viewEnzymes",((e,t)=>{m.j("digest","changed_enzyme_visibility",{visible:t})}))
this.listenTo(this.panelState,"change:highlightCompatible",l.default.bind(this.updateHighlightCompatible,this))
this.updateHighlightCompatible(this.panelState,this.panelState.get("highlightCompatible"))
this.listenTo(this.panelState,"change:cutRegion",this.filter)
this.listenTo(this.panelState.get("selectedEnzymes"),"add remove reset",(()=>{this.renderActiveEnzymes()}))
this.listenTo(this.panelState,"change:enzymesProvider",(()=>{this.renderSidebar()}))
null!=this.enzymes&&this.stopListening(this.enzymes)
this.enzymes=t.get("enzymes")
this.listenTo(this.enzymes,"showDetail",this.renderSidebar)
this.listenTo(this.enzymes,"change:cutPositions",this.filterEnzyme)
const n=this.listenToBatch(this.enzymes,(()=>{this.renderEnzymeCatalog()}))
this.listenTo(this.enzymes,"change",(()=>{n()}))
this.listenTo(this.enzymes,"zoomTo",(({offset:e,enzyme:t})=>{const n=this.enzymes.filter((e=>e.get("catalogVisible"))).indexOf(t)
if(-1===n)return
const a=this.$el.find("table.catalogue tbody").children()[n]
this.$el.find("table.catalogue tbody").stop().animate({scrollTop:a.offsetTop-e},200)}))
if(null!=this.sequence){this.stopListening(this.sequence._sequence())
this.stopListening(this.sequence.get("analyses"))}this.sequence=t
this.listenTo(this.sequence._sequence(),"change:bases change:startIndex",(()=>{this.renderSidebar()}))
this.listenTo(this.sequence.get("analyses"),"add remove change",(()=>{this.renderLibrary()}))
null!=this.selection&&this.stopListening(this.selection)
this.selection=t.get("selection")
this.listenTo(this.selection,"change:start change:end",l.default.bind((function(){this.updateCutRegion()
return this.filter()}),this))
this.updateCutRegion()
this.restoreState()
this.render()}sequenceSizeSetup(){const e=this.sequence.isReallyBig(),t=['.view-enzymes option[value="single"]','.view-enzymes option[value="double"]','.view-enzymes option[value="singleanddouble"]'].join(","),n=this.$(t)
n.prop("disabled",e)
n.filter(":selected").length>0&&e&&this.$(".view-enzymes").val("none")
e?this.$("#enzymes-header .cut-header").hide():this.$("#enzymes-header .cut-header").show()
e?this.$(".search").attr("placeholder","Search by name"):this.$(".search").attr("placeholder","Search by name or number of cuts")
e?this.$(".filter-message").text("Filtering by cutsites is temporarily disabled on large sequences."):this.$(".filter-message").text("")}toggleNucleotideTypeDependentElements(){const e=this.panelState.get("sequence").isRNASequence()
this.$(".dna-none").toggle(!e)
this.$(".rna-none").toggle(e)
this.$(".panel-title").toggle(!e)
this.$(".find-enzyme").toggle(!e)}render(){this.sequenceSizeSetup()
this.showEnzymeLists()
this.filter()
this.toggleNucleotideTypeDependentElements()
if(!this.panelState.get("sequence").isRNASequence()){this.showSubPanel()
this.renderEnzymes()
this.renderLibrary()}return this}}RestrictionPanelView.initClass()
const e4=xa.ZP`
  query ComplexPolymerVersionQuery($complexPolymerId: StrictString!)
  @skipAudit
  @engComponent(name: MODIFIED_BIOLOGICS) {
    complexPolymer(id: $complexPolymerId) {
      ... on OligoConjugateNode {
        id
      }
      ... on ComplexPolymerNode {
        id
      }
      ... on ComplexPolymerInterface {
        versions {
          id
          name
          creator {
            id
            name
          }
          modifiedAt
          parent {
            id
          }
        }
        currentVersion {
          id
          name
          creator {
            id
            name
          }
          modifiedAt
          parent {
            id
          }
        }
      }
      ...InaccessibleInfoGraphQL
    }
  }
  ${(0,La.f)("InaccessibleInfo").fragment}
`
function ComplexPolymerHistoryPanel(e){const t=(0,_a.v9)((t=>t.ui.modbio.complexPolymerVersionUIs[e.id].complexPolymerVersionId)),n=(0,_a.I0)(),cloneFromVersion=()=>{(0,Xn.Z)(J3.ZP,{modelType:st.BASIC_FOLDER_ITEM,id:e.id,versionId:t,initialName:`${e.name} (new)`,initialFolderId:e.folderId})}
return d.createElement(Da.ZP,{query:e4,renderLoading:()=>d.createElement(kl.b,null),variables:{complexPolymerId:e.id}},(a=>{(0,S.hu)(!(0,ka.CZ)(a.complexPolymer),"Complex polymer must be accessible.");(0,S.hu)(null!=a.complexPolymer.currentVersion,"Expected complex polymer to have current version")
const i=a.complexPolymer.currentVersion
return d.createElement(e5.Z,{openVersion:t=>{((t,a)=>{n((0,kP.ME)(e.id,t))
e.setIsLatest(t===a)})(t,i.id)},resetToVersion:()=>{n=i.id,ComplexPolymerActions_resetOligoConjugateVersion(e.id,t,n)
var n},versions:a.complexPolymer.versions.map((e=>{var t,n
return{...e,parentId:null!==(n=null===(t=e.parent)||void 0===t?void 0:t.id)&&void 0!==n?n:null,fetching:!1}})),cloneFromVersion,openVersionId:t,isLatest:i.id===t,unsaved:!1,showNames:!0,showSeconds:!0,hasParent:!1,parent:null,permissions:e.permissions})}))}const t4=class ComplexPolymerHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(ComplexPolymerHistoryPanel,{id:this.model.id,name:this.model.name(),permissions:this.model.permissions(),setIsLatest:e=>{this.model.setIsLatest(e)},folderId:this.model.folder().id})}]}}
class StageEntryInformationPanelView extends T5{initialize(e){super.initialize(e)
this.requestExport=this.requestExport.bind(this)}handleOpenWorkflow(){w_.GS(ZP.SA.WORKFLOWS)
dc.Su(this.model.get("stageEntryDocument").workflowId)}getPermissions(){const e=super.getPermissions(),t=this.model.review(),n=e.writable&&Boolean(!t||e.canSendForReview)
return{...e,writable:n}}getAdditionalPanelContent(){return d.createElement(h.Z,null,d.createElement(p.Z,{md:12},d.createElement(C.Co,{buttonStyle:C.ZJ.TERTIARY_GRAY,fullWidth:!0,onClick:this.handleOpenWorkflow.bind(this),size:C.qE.SMALL,text:"Open workflow"})))}isDeleteEnabled(){return!1}saveChangesToModel(e){bk.saveFileData(this.model.id,e,{success:this.onSaveSuccess})}requestExport(){h5.Z.requestExportFile(this.model.id)}}class StageEntryHistoryPanelConnector extends oi.C{constructor(){super(...arguments)
this.stores=[Tk.Z]}enhanceProps(){return Tk.Z.getVersionState(this.props.id)}}class StageEntryHistoryPanel extends d.Component{constructor(){super(...arguments)
this.openVersion=e=>{bk.loadVersion(this.props.id,e)}}componentDidMount(){bk.fetchVersions(this.props.id)}componentDidUpdate(e){e.savedVersion===this.props.savedVersion&&e.id===this.props.id||l.default.defer((()=>{bk.fetchVersions(this.props.id)}))}render(){const e=Tk.Z.getEntry(this.props.id)
return d.createElement(e5.Z,{openVersion:this.openVersion,versions:this.props.versions,openVersionId:this.props.openVersionId,dirty:this.props.dirty,isLockedForReview:!!e.review&&KL.ZP.LOCKED_STATUSES.includes(e.review.status),isLatest:this.props.isLatest,isFirstTrackedVersion:M0.Hy,unsaved:this.props.unsaved,hasParent:this.props.hasParent,parent:this.props.parent,permissions:this.props.permissions})}}const n4=StageEntryHistoryPanelConnector.connect(StageEntryHistoryPanel)
const a4=class StageEntryHistoryPanelView extends X3{getSubpanels(){return[{key:"history",title:"History",component:d.createElement(n4,{id:this.model.id,permissions:this.model.permissions()})}]}}
class MoleculeInformationPanelView extends T5{initialize(e){super.initialize(e)}async saveChangesToModel(e,t){var n
const{writable:a,movable:i}=this.model.permissions()
a&&this.model.name()!==e?await Rn.Z.renameFileWithDataMods(this.model.id,this.isRegistered(),{oldName:this.model.name(),newName:e,parentFolderId:this.model.folder().id}):(0,S.Gp)(a,"User attempted to save changes to a molecule without authorized WRITE")
i&&t!==this.model.folder().id?Rn.Z.moveItemsWithDataMods([this.model.id],t,{parentFolderIds:[this.model.folder().id],hasRegisteredItems:(null===(n=this.model.folder().source)||void 0===n?void 0:n.sourceType)===DN.REGISTRY_TYPE}):(0,S.Gp)(i,"User attempted to move a molecule between folders without authorized MOVE")}}function ToolbarView_defineProperty(e,t,n){(t=function ToolbarView_toPropertyKey(e){var t=function ToolbarView_toPrimitive(e,t){if("object"!=typeof e||!e)return e
var n=e[Symbol.toPrimitive]
if(void 0!==n){var a=n.call(e,t||"default")
if("object"!=typeof a)return a
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n
return e}const i4={featurePanel:{id:"feature-panel",isMolbioOnlyTool:!0},restrictionPanel:{id:"restriction-panel",isMolbioOnlyTool:!0},primerPanel:{id:"primer-panel",isMolbioOnlyTool:!0},informationPanel:{id:"information-panel"},historyPanel:{id:"history-panel",isMolbioOnlyTool:!0},alignmentPanel:{id:"alignment-panel",isMolbioOnlyTool:!0},genomeEngineeringPanel:{id:"genome-engineering-panel",isMolbioOnlyTool:!0},entryInformationPanel:{id:"entry-information-panel"},entryHistoryPanel:{id:"entry-history-panel"},protocolInformationPanel:{id:"protocol-information-panel"},protocolHistoryPanel:{id:"protocol-history-panel"},subtemplateHistoryPanel:{id:"subtemplate-history-panel"},subtemplateInformationPanel:{id:"subtemplate-information-panel"},templateHistoryPanel:{id:"template-history-panel"},templateInformationPanel:{id:"template-information-panel"},basicFolderItemInformationPanel:{id:"basic-folder-item-information-panel"},complexPolymerHistoryPanel:{id:"complex-polymer-history-panel"},proteinAnnotationsPanel:{id:"protein-annotations-panel",isMolbioOnlyTool:!0},proteinHistoryPanel:{id:"protein-history-panel",isMolbioOnlyTool:!0},proteinInformationPanel:{id:"protein-information-panel"},proteinAlignmentPanel:{id:"protein-alignment-panel",isMolbioOnlyTool:!0},stageEntryInformationPanel:{id:"stage-entry-information-panel"},stageEntryHistoryPanel:{id:"stage-entry-history-panel"},moleculeHistoryPanel:{id:"molecule-history-panel"},moleculeInformationPanel:{id:"molecule-information-panel"}}
function getToolbarSelector(e){return`#${i4[e].id}`}class ToolbarView extends s().View{constructor(...e){super(...e)
ToolbarView_defineProperty(this,"_handleWindowClick",(e=>{const t=this.$el.find(".panel-wrapper.active").get(0)
!t||t.contains(e.target)||0!==o()(".modal-open").length||0!==o()("#context-menu:visible").length||o()(e.target).hasClass("backdrop")||0!==o()(e.target).parents(".absoluteDropdownContainer").length||this.closeAndDeactivate()}))}static initClass(){this.prototype.el="#toolbar"
this.prototype.events={"click .js-toolbarBtn":"iconClick","click .js-sequence-nue-button":"sequenceNUEButtonClick"}}initialize(e){this.resizePanel=this.resizePanel.bind(this)
this.featurePanel=new S6
this.restrictionPanel=new RestrictionPanelView
this.primerPanel=new W6
this.informationPanel=new _6
this.historyPanel=new P6
this.alignmentPanel=new Z5
this.genomeEngineeringPanel=new w6({el:getToolbarSelector("genomeEngineeringPanel")})
this.entryInformationPanel=new T6({el:getToolbarSelector("entryInformationPanel")})
this.entryHistoryPanel=new b6({el:getToolbarSelector("entryHistoryPanel")})
this.protocolInformationPanel=new L6({el:getToolbarSelector("protocolInformationPanel")})
this.protocolHistoryPanel=new F6({el:getToolbarSelector("protocolHistoryPanel")})
this.subtemplateHistoryPanel=new A5({el:getToolbarSelector("subtemplateHistoryPanel")})
this.subtemplateInformationPanel=new _5({el:getToolbarSelector("subtemplateInformationPanel")})
this.templateHistoryPanel=new L5({el:getToolbarSelector("templateHistoryPanel")})
this.templateInformationPanel=new x5({el:getToolbarSelector("templateInformationPanel")})
this.proteinAnnotationsPanel=new p5({el:getToolbarSelector("proteinAnnotationsPanel")})
this.proteinHistoryPanel=new I5({el:getToolbarSelector("proteinHistoryPanel")})
this.proteinInformationPanel=new v5({el:getToolbarSelector("proteinInformationPanel")})
this.proteinAlignmentPanel=new c5({el:getToolbarSelector("proteinAlignmentPanel")})
this.basicFolderItemInformationPanel=new T5({el:getToolbarSelector("basicFolderItemInformationPanel")})
this.complexPolymerHistoryPanel=new t4({el:getToolbarSelector("complexPolymerHistoryPanel")})
this.stageEntryInformationPanel=new StageEntryInformationPanelView({el:getToolbarSelector("stageEntryInformationPanel")})
this.stageEntryHistoryPanel=new a4({el:getToolbarSelector("stageEntryHistoryPanel")})
this.moleculeHistoryPanel=new a5({el:getToolbarSelector("moleculeHistoryPanel")})
this.moleculeInformationPanel=new MoleculeInformationPanelView({el:getToolbarSelector("moleculeInformationPanel")})
this.handleHomeDashboardStoreChangeListener=null
return this.$el.find(".js-toolbarBtn-tooltipWrapper").tooltip({placement:"left",delay:{show:500,hide:100},container:"body"})}trackIconClick(e){const t=this.fileState.model().get("id")
switch(e){case"primer-panel":m.j("primer","open_primer_panel",{product:j.XC.MOLBIO,sequence_id:t})
break
case"feature-panel":m.j("annotation","open_annotation_panel",{product:j.XC.MOLBIO,openedFrom:"toolbar",sequence_id:t})
break
case"protein-annotations-panel":m.j("protein","open_annotation_panel",{product:j.XC.MOLBIO,openedFrom:"toolbar",protein_id:t})}}iconClick(e){const t=o()(e.target).closest(".panel-wrapper")
t.find(".js-toolbarBtn-tooltipWrapper").tooltip("hide")
if(t.hasClass("active"))this.closeAndDeactivate()
else{const e=t.attr("id")
this.trackIconClick(e)
this.activateAndOpen(e)}}sequenceNUEButtonClick(e){const t=function ToolbarView_guard_(e,t){return null!=e?t(e):void 0}(this.getHomeDashboardStoreModuleState(),(e=>e.collapsed))
Ys.LW(Qs.ZP.MODULES.SEQUENCE,!t)
const n=t?"expanded":"minimized"
m.j("onboarding_checklist",n,{checklist:"molecular_biology",checklistTitle:"Explore Molecular Biology to Earn Space",checklistReward:"1GB_earned",numberOfTasks:5,eventLastModified:"FY21_Q1a2"})}closePanel(){const e=this.$el.find(".panel-wrapper.active"),t=e.attr("id")
if(null!=t){const e=this.panelIdMap(t)
this[e].trigger("close")
this.toolbarState.get(`${e}State`).set({active:!1})}e.removeClass("active")
o()(window).off("mousedown",this._handleWindowClick)
return e.find(".js-toolbarBtn.button--circleIcon").removeClass("is-active")}resizePanel(){if(null==this.toolbarState)return
const e=this.toolbarState.get("active"),t=this.$el.find(`#${e}`).find(".panel .panel-content"),n=t.closest(".panel")
if(null!=e){t.css("max-height","none")
n.offset({left:n.offset().left,top:this.toolbarState.get("position")})
t.offset().top,t.outerHeight(!0)
let e=o()(window).height()-o()("#statusbar").height()-10
o()("#assembly-wizard-container").hasClass("hidden")||(e-=140)
const a=e-this.$el.offset().top-10,i=Math.min(a,380,t.height()),s=n.offset(),r=Math.min(s.top,e-i)
n.offset({left:s.left,top:r})
const l=e-r-n.find(".panel-title").height()
t.css("max-height",l)}}panelIdMap(e){return Object.entries(i4).find((([,t])=>t.id===e))[0]}openPanel(){this.closePanel()
const e=this.toolbarState.get("active")
o()(window).on("mousedown",this._handleWindowClick)
if(null!=e){m.j("editor","open_panel",{panel:e})
const t=this.$el.find(`#${e}`)
t.addClass("active")
t.find(".js-toolbarBtn.button--circleIcon").addClass("is-active")
const n=t.find(".panel"),{left:a}=n.offset(),i={left:a,top:this.toolbarState.get("position")}
n.offset(i)
const s=this.panelIdMap(e),r=this[s],o=this.toolbarState.get(`${s}State`)
r.update(o,null!=this.fileState?this.fileState.model():void 0,this.fileState)
r.trigger("open")
o.set({active:!0})
l.default.defer((()=>{this.resizePanel()}))}}updateSubtemplate(e){this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("subtemplate-history-panel")}))
this.listenTo(e,"openInformationPanel",(function(){return this.activateAndOpen("subtemplate-information-panel")}))}updateTemplate(e){this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("template-history-panel")}))
this.listenTo(e,"openInformationPanel",(function(){return this.activateAndOpen("template-information-panel")}))}updateEntry(e){this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("entry-history-panel")}))}updateBasicFolderItem(e){this.listenTo(e.get("basicFolderItemInformationPanelState"),"close",(function(){return this.closeAndDeactivate()}))}updateOligo(e){const t=this.fileState.model()
this.selection=t.get("selection")
this._sequence=t.get("_sequence")
this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("history-panel")}))
this.listenTo(this.selection,"annotation",(e=>{this.toolbarState.get("featurePanelState").createAnnotation(t.id,this.selection)
this.activateAndOpen("feature-panel")
return null!=e?e.select():void 0}))
const n=t.get("versions")
this.listenTo(n,"open",(e=>{if("history-panel"!==this.toolbarState.get("active")&&t.getActiveVersion()!==e){this.activateAndOpen("history-panel")
return n.trigger("open",e)}}))
"Untitled"!==t.name()||this.toolbarState.get("active")||this.activateAndOpen("information-panel")
const a=["feature","information","history"]
for(const e of a){this[`${e}-panel-ref`]&&this.stopListening(this[`${e}-panel-ref`])
const t=this.toolbarState.get(`${e}PanelState`)
this.listenTo(t,"resize",this.resizePanel)
this.listenTo(t,"close",this.closeAndDeactivate)
this[`${e}-panel-ref`]=t}}updateSequence(e){let t
const n=this.fileState.model()
this.analyses=n.get("analyses")
this.selection=n.get("selection")
this._sequence=n.get("_sequence")
this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("history-panel")}))
this.listenTo(this.selection,"annotation",(e=>{this.toolbarState.get("featurePanelState").createAnnotation(n.id,this.selection)
this.activateAndOpen("feature-panel")
return null!=e?e.select():void 0}))
this.listenTo(this.selection,"translation-panel",((e,t)=>{null!=e&&this.toolbarState.get("featurePanelState").createTranslation(n.id,e)
this.activateAndOpen("feature-panel")
return null==t?void 0:t.select()}))
this.listenTo(this.selection,"primer",(e=>{null!=e&&e.select()
t=this.toolbarState.get("primerPanelState")
t.set({activeSubPanel:"primers"})
return this.activateAndOpen("primer-panel")}))
this.listenTo(this.selection,"showLinks",(()=>{this.activateAndOpen("primer-panel")
this.primerPanel.showLinks()}))
this.listenTo(this.selection,"cutsite",(e=>{this.toolbarState.get("restrictionPanelState").set("activeSubPanel","new-digest")
this.activateAndOpen("restriction-panel")
if(null!=e){const t=e.get("enzyme")
t.trigger("zoomTo",{offset:0,enzyme:t})
return t.trigger("showDetail",t)}}))
this.listenTo(this.analyses,"add",(e=>{if(e.get("analysis_type")===Y3.Nu){this.toolbarState.get("restrictionPanelState").set("activeSubPanel","my-digests")
this.activateAndOpen("restriction-panel")}}))
const a=n.get("versions")
this.listenTo(a,"open",(e=>{if("history-panel"!==this.toolbarState.get("active")&&n.getActiveVersion()!==e){this.activateAndOpen("history-panel")
return a.trigger("open",e)}}))
"Untitled"===n.name()&&null==this.toolbarState.get("active")&&this.activateAndOpen("information-panel")
const i=["feature","restriction","primer","alignment","information","history","genomeEngineering"]
for(const e of Array.from(i)){null!=this[`${e}-panel-ref`]&&this.stopListening(this[`${e}-panel-ref`])
t=this.toolbarState.get(`${e}PanelState`)
this.listenTo(t,"resize",this.resizePanel)
this.listenTo(t,"close",this.closeAndDeactivate)
this[`${e}-panel-ref`]=t}const s=this.toolbarState.get("alignmentPanelState").get("alignmentsInProgress"),togglePulsing=()=>{this.$("#alignment-panel .js-toolbarBtn.btn").toggleClass("pulsing",s.length>0)
this.$("#alignment-panel .js-toolbarBtn.button--circleIcon").toggleClass("is-pulsing",s.length>0)}
this.listenTo(s,"add remove",togglePulsing)
return togglePulsing()}updateProtein(e){this.listenTo(e,"openProteinAnnotationsPanel",(function(){return this.activateAndOpen("protein-annotations-panel")}))
this.listenTo(e.get("proteinAlignmentPanelState"),"close",this.closeAndDeactivate)
this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("protein-history-panel")}))}updateMolecule(e){this.listenTo(e,"openHistoryPanel",(function(){return this.activateAndOpen("molecule-history-panel")}))
this.listenTo(e,"openInformationPanel",(function(){return this.activateAndOpen("molecule-information-panel")}))}closeAndDeactivate(){this.closePanel()
null!=this.toolbarState&&this.toolbarState.unset("active")}activateAndOpen(e){this.toolbarState.set("position",this.$el.find(`#${e}`).offset().top+6)
this.toolbarState.set("active",e)
this.openPanel()}toggleToolbar(e){this.$el.toggleClass("hidden",!e)
o()("#editor").toggleClass("has-hidden-toolbar",!e)}showToolbar(e){let t
if(null==e){this.toggleToolbar(!1)
return}t=e.fileType()===st.SEQUENCE?e.model().subtype():e.fileType()
const n=e.model?e.model().id:null,[a,i]=(0,Jt.uK)(Object.entries(i4),(([e,a])=>J5.bH[t]&&J5.bH[t].includes(e)&&(!a.isMolbioOnlyTool||(0,ln.cr)({feature:on.Ot.MOLBIO_EDIT}))&&("complexPolymerHistoryPanel"!==e||(0,LP.Wz)(n)))),s=a.length>0
for(const[e,t]of a)o()(`#${t.id}`).removeClass("hidden")
for(const[e,t]of i)o()(`#${t.id}`).addClass("hidden")
this.toggleToolbar(s)}getHomeDashboardStoreModuleState(){return bz.Z.getNUEModuleState(Qs.ZP.MODULES.SEQUENCE)}renderSequenceNUEModule(){null!=this.handleHomeDashboardStoreChangeListener&&bz.Z.removeChangeListener(this.handleHomeDashboardStoreChangeListener)
const e=this.$(".js-sequence-nue-mount")[0],t=this.getHomeDashboardStoreModuleState()
if(null==e)return
this.handleHomeDashboardStoreChangeListener=()=>{const e=this.getHomeDashboardStoreModuleState()
o()(".js-sequence-nue-button").toggleClass("hidden",!(null!=e&&e.collapsed))}
bz.Z.addChangeListener(this.handleHomeDashboardStoreChangeListener)
const n=d.createElement(Iz,null);(0,Me.A9)(n,e)
null!=t&&t.completed||this.$el.find(".sequence-nue-container").removeClass("hidden")
null!=t&&t.collapsed&&this.$el.find(".js-sequence-nue-button").removeClass("hidden")}update(e,t){o()(window).off(".toolbarview")
this.$el.off(".toolbarview")
this.closePanel()
this.toolbarState&&this.stopListening(this.toolbarState)
this.toolbarState=e
null!=this.selection&&this.stopListening(this.selection)
null!=this.analyses&&this.stopListening(this.analyses)
null!=this._sequence&&this.stopListening(this._sequence)
this.fileState=t
if(!this.fileState){this.showToolbar(null)
return}o()(window).on("resize.toolbarview",(0,It.D)(this.resizePanel,150))
o()(window).on("keyup.toolbarview",pn.onlyEscapeKey(this.closeAndDeactivate,this))
this.$el.on("update.toolbarview",this.resizePanel)
this.listenTo(this.toolbarState,"close",this.closeAndDeactivate)
const n=t.fileType()
this.showToolbar(t)
n!==st.SEQUENCE||t.model().isOligo()?n===st.SEQUENCE&&t.model().isOligo()?this.updateOligo(e):n===st.PROTEIN?this.updateProtein(e):n===st.ENTRY?this.updateEntry(e):n===st.SUBTEMPLATE?this.updateSubtemplate(e):n===st.TEMPLATE?this.updateTemplate(e):n===st.BASIC_FOLDER_ITEM?this.updateBasicFolderItem(e):n===st.MOLECULE&&this.updateMolecule(e):this.updateSequence(e)
this.openPanel()}}ToolbarView.initClass()
const s4=ToolbarView
var r4=n(161540),o4=n(902323),l4=n(333792)
var c4
!function(e){e.GENENTECH_PTD_MODAL_KEY="GENENTECH_PTD_MODAL"
e.GENENTECH_PTD_TRAINING_MODAL_KEY="GENENTECH_PTD_TRAINING_MODAL"}(c4||(c4={}))
function dismissModal(){We.Z.set(`TENANT_SCHEDULED_MODAL_LAST_DISMISSED_${c4.GENENTECH_PTD_MODAL_KEY}`,(new Date).toISOString())
Xe.xv(c4.GENENTECH_PTD_MODAL_KEY)}function GenentechPTDModalInfo({buttons:e,onClose:t}){return d.createElement(et.ZP,{enableRedesign:!0,title:"Legal Disclaimer",buttons:e,onRequestClose:t,closeable:!1,closeableOnBackgroundClick:!1,closeableOnEscapeKey:!1},d.createElement("div",null,d.createElement("p",null,"I acknowledge that I am bound by confidentiality obligations imposed through my employment or contractual agreement with Roche in connection with my access to confidential information, including PTD Benchling and its contents. By entering PTD Benchling, I confirm that I understand that my activities within PTD Benchling may be monitored consistent with local law, and all contents and passwords are confidential information, and that unauthorized disclosure or use of such confidential information may result in disciplinary action including termination of my employment or services and/or legal action based on local law.")))}function GenentechPTDTrainingModal_dismissModal(){We.Z.set(`TENANT_SCHEDULED_MODAL_LAST_DISMISSED_${c4.GENENTECH_PTD_TRAINING_MODAL_KEY}`,(new Date).toISOString())
Xe.xv(c4.GENENTECH_PTD_TRAINING_MODAL_KEY)}function GenentechPTDTrainingModalInfo({buttons:e,onClose:t}){return d.createElement(et.ZP,{enableRedesign:!0,title:"Notice of Training Environment",buttons:e,onRequestClose:t,closeable:!1,closeableOnBackgroundClick:!1,closeableOnEscapeKey:!1},d.createElement("div",null,d.createElement("p",null,"You are currently accessing the TRAINING ENVIRONMENT for PTD Benchling. The training environment shall only be used for training purposes. ",d.createElement("span",{className:(0,g.iv)(d4.emphasized)},"DO NOT")," ","document your work in this environment. ",d.createElement("span",{className:(0,g.iv)(d4.emphasized)},"DO NOT")," ","upload or capture experiment execution data or information to this environment."),d.createElement("p",null,"The TRAINING ENVIRONMENT is only for training purposes for PTD members. It is not intended for any other purpose or user group.")))}const d4=g.mM.create({emphasized:{fontWeight:"bold",textDecoration:"underline"}})
const u4={[o4.To.BROAD_GOOGLE_AUTH_MODAL_KEY]:r4.TY,[o4.To.BROAD_SET_INSTITUTION_MODAL_KEY]:r4.M1,[o4.To.LICENSED_INSTITUTION_MODAL_KEY]:l4.B,[c4.GENENTECH_PTD_MODAL_KEY]:function GenentechPTDModal(){return d.createElement(GenentechPTDModalInfo,{onClose:()=>{dismissModal()},buttons:[{text:"I Agree",style:"default",onClick:()=>{dismissModal()}}]})},[c4.GENENTECH_PTD_TRAINING_MODAL_KEY]:function GenentechPTDTrainingModal(){return d.createElement(GenentechPTDTrainingModalInfo,{onClose:()=>{GenentechPTDTrainingModal_dismissModal()},buttons:[{text:"I Agree",style:"default",onClick:()=>{GenentechPTDTrainingModal_dismissModal()}}]})}}
class Editor_Editor extends s().View{static initClass(){this.prototype.el="body"
this.prototype.events={"click .js-home-logo":"navigateHome"}}navigateHome(e){e.preventDefault();(0,ac.ZP)("/editor")}renderReact(e,t){this.fileBar.renderReact(e,t)}initialize(){({queryKey:this.queryKey}=de.he(window.location.href))
this.sequences=ve.ZP.get()
this.contextmenu=ta.e
this.toolbar=new s4
this.statusBar=new kz
this.assemblyWizardContainer=new ct
this.buffersView=new XG
this.searchDNAView=new hz({model:$a.C.get()})
this.fileBar=new rz({toolbar:this.toolbar,buffersView:this.buffersView,statusBar:this.statusBar,searchDNA:this.searchDNAView,assemblyWizardContainer:this.assemblyWizardContainer})
!function initWorkspaceContainer(){const e=document.getElementsByClassName("workspaceMount")[0];(0,Me.A9)(d.createElement(j3,null),e)}()
!function initNavBar(){const e=document.getElementsByClassName("navbar-mount")[0];(0,Me.A9)(d.createElement(jK,null),e)}()
Sidepanel_Sidepanel.init()
!function initFullScreen(){const e=o()(".full-screen-mount");(0,Me.A9)(d.createElement(jQ,null),e[0])}()
!function initHelpContainer(){if(!dt.ZP.ENABLE_IN_APP_SUPPORT){const e=o()(".helpContainer-mount");(0,Me.A9)(d.createElement(HelpContainer_HelpButton,null),e[0])
return}if(!dt.ZP.ENABLE_INTERCOM||dt.ZP.ENABLE_ZENDESK_MESSAGING)return
const e=o()(".helpContainer-mount");(0,Me.A9)(d.createElement(XQ,null),e[0])}()
!function init(){const e=window.bootstrap&&window.bootstrap.scheduledModalKey
if(!e)return
const t=u4[e];(0,S.Gp)(Boolean(t),`Unsupported scheduled modal ${e}`)
if(t){Xe.bA(e,d.createElement(t,null))
m.j(j.XC.NAVIGATION,"open_scheduled_modal",{modalKey:e})}}()
this.showSync()}showSync(){this.premature=!1
this.listenTo(s(),"long-sync",(function handleLongSync(e){this.$("#reconnecting").show()}))
this.listenTo(s(),"good-sync",(function handleGoodSync(e,t,n){sP.nJ()
if(0===t){this.$("#reconnecting").hide()
sP.v8("Saved.")
if(this.premature){v.ZP.error("Connectivity Error: Please retry your last action.")
this.premature=!1}}else n>0?this.$("#reconnecting").show():t>1?sP.qu(`Saving... (${t})`):sP.qu("Saving...")}))
this.listenTo(s(),"syncing",((e,t,n)=>{t>1?sP.qu(`Saving... (${t})`):sP.qu("Saving...")}))
this.listenTo(s(),"premature-sync",(function handlePrematureSync(){this.premature=!0
this.$("#reconnecting").show()}))
this.listenTo(s(),"fail-sync",(function handleFailSync(e,t,n){n>0?this.$("#reconnecting").show():this.$("#reconnecting").hide()
sP.v8("Error while saving.")
this.premature=!1}))
window.ENABLE_EDITOR_PENDING_REQUEST_CHECK&&o()(window).on("beforeunload.editor",(()=>{window.beforeUnloadType="editor"
return Cn.wt.getCount()>0||s().getXHRCount()>0?"There is currently a request to the server pending. You may lose recent changes by navigating away.":void 0}))}remove(){o()(window).off(".editor")
return super.remove()}render(){this.fileBar.render()
this.$el.append(this.contextmenu.render().el)
this.statusBar.assemblySwitcher.renderItems()
this.$(".js-userMenu-templateCollections").click((e=>{de.c4(e)}))
$e.S1()}}Editor_Editor.initClass()
const m4=Editor_Editor},592482:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>ColumnTypeValidationException})
var a=n(525098)
class ColumnTypeValidationException extends a.Z{}},143313:(e,t,n)=>{"use strict"
n.d(t,{$0:()=>createAccessor,CE:()=>r,ZJ:()=>createUnvalidatedAccessor,jv:()=>o,yL:()=>createAccessors})
var a=n(399658),i=n(14331),s=n(176667)
function createUnvalidatedAccessor(e){return t=>t[e.systemName]}const r=createUnvalidatedAccessor(a.en),o=createUnvalidatedAccessor(a.Dl),l={isExcluded:r,rowId:o},c={isExcluded:a.en.type.leafType,rowId:a.Dl.type.leafType}
a.Cb.IS_EXCLUDED,a.Cb.ROW_ID
function createAccessor(e,t,n){const a=(0,i.ZP)(e,t),r=null!=n?(0,s.ZP)(a.type,n):a.type.leafType
return{accessor:createUnvalidatedAccessor(a),validatedLeafType:r}}function createAccessors(e,t,n){let a={},i={}
Object.entries(t).forEach((([t,s])=>{const r=null==n?void 0:n[t],{accessor:o,validatedLeafType:l}=createAccessor(e,s,r)
a={...a,[t]:o}
i={...i,[t]:l}}))
a={...a,...l}
i={...i,...c}
return{accessors:a,validatedLeafTypes:i}}},14331:(e,t,n)=>{"use strict"
n.d(t,{ZP:()=>findAndAssertColumn,tV:()=>s})
var a=n(232606),i=n(600066)
const s="Expected column to exist with systemName in data frame."
function findAndAssertColumn(e,t){const n=(0,i.Z)(e,t);(0,a.hu)(null!=n,s,{columnSystemName:t,columns:e.columns})
return n}},600066:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>findColumn,s:()=>findColumnByDisplayName})
function findColumn(e,t){return e.columns.find((e=>e.systemName===t))}function findColumnByDisplayName(e,t){return e.columns.find((e=>e.displayName===t))}},683061:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>sortDataFrame,o:()=>sortDataFrameByAccessors})
var a=n(531041),i=n(399658),s=n(639943),r=n(264867),o=n(172627),l=n(567e3),c=n(960063),d=n(143313),u=n(600066),m=n(184955)
const p=[r.i0.DATE,r.i0.DATETIME,r.i0.BOOLEAN],h=[i.Cb.IS_EXCLUDED]
function sortDataFrameByAccessors(e,t,n=!0){return{...e,rows:(0,l.Z)(e.rows,t.map((e=>({accessor:e,reversed:!n}))))}}function sortDataFrame(e,t,n=s.c.TEXT){if(null==t)return e
const r=(0,u.Z)(e,t.columnKey)
if(null==r)return e
const g=(0,d.ZJ)(r),{rows:E}=e,{sortDirection:f}=t,S=function sortIsReversed(e,t){return(0,o.Z)(["arrow-up"===t,p.includes(e.type.leafType),h.includes(e.systemName)],!0)%2==1}(r,f),[y,b]=a.default.partition(E,(e=>null==g(e))),[T,v]=a.default.partition(b,(e=>{const t=g(e)
return(0,m.Z)(t,r)})),C={accessor:i.Cb.ROW_ID,naturalSort:!0,reversed:S},I=(0,l.Z)(T,[{accessor:e=>Number(g(e)),reversed:S},C]),w=(0,l.Z)(v,[{accessor:t=>(0,c.Z)(g(t),r,e.hydratedProperties,n),naturalSort:!0,reversed:S},C]),N=(0,l.Z)(y,[C]),A=S?[...w,...I,...N]:[...I,...w,...N]
return{...e,rows:A}}},176667:(e,t,n)=>{"use strict"
n.d(t,{FS:()=>a,Xh:()=>isValidColumnType,ZP:()=>validateColumnType})
var a,i=n(232606),s=n(264867),r=n(592482)
!function(e){e.ALLOWED="ALLOWED"
e.REQUIRED="REQUIRED"
e.NOT_ALLOWED="NOT_ALLOWED"}(a||(a={}))
const o={[s.i0.JSON]:[s.i0.BOOLEAN,s.i0.INTEGER,s.i0.TEXT],[s.i0.TEXT]:[s.i0.BENCHLING_OBJECT,s.i0.DATETIME,s.i0.DECIMAL],[s.i0.DATETIME]:[s.i0.DATE],[s.i0.BENCHLING_OBJECT]:[s.i0.BLOB,s.i0.BATCH,s.i0.BIOENTITY,s.i0.DROPDOWN_OPTION,s.i0.ENTRY,s.i0.PROTOCOL,s.i0.RESULT,s.i0.REQUEST,s.i0.RUN,s.i0.STORABLE,s.i0.PROCESS,s.i0.PROCESS_TASK,s.i0.PROCESS_OUTPUT,s.i0.TEAM,s.i0.USER],[s.i0.BIOENTITY]:[s.i0.BASIC_FOLDER_ITEM,s.i0.MIXTURE,s.i0.MOLECULE,s.i0.PROTEIN,s.i0.SEQUENCE],[s.i0.STORABLE]:[s.i0.BOX,s.i0.CONTAINER,s.i0.LOCATION,s.i0.PLATE]}
function findAllowedLeafType(e,t){var n
for(const n of t)if(n===e)return n
for(const a of t)if(null!=findAllowedLeafType(e,null!==(n=o[a])&&void 0!==n?n:[]))return a
return null}function validateLeafType(e,t){const n=findAllowedLeafType(e,t)
if(null==n)throw new r.Z(`Leaf type ${e} does not match expected leaf types: ${t.join(", ")}`)
return n}function validateFlag(e,t,n){(0,i.hu)(void 0===e||!0===e,"Unexpected validation flag value",{validationFlagValue:e})
if(t===a.REQUIRED&&!0!==e)throw new r.Z(`Expected column to have a ${n} type.`)
if(t===a.NOT_ALLOWED&&void 0!==e)throw new r.Z(`Expected column to not have a ${n} type.`)}function validateColumnType(e,t){validateFlag(e.isList,t.listType,"list")
validateFlag(e.isNullable,t.nullableType,"nullable")
validateFlag(e.maybeText,t.maybeTextType,"maybeText")
return t.allowedLeafTypes?validateLeafType(e.leafType,t.allowedLeafTypes):s.i0.JSON}function isValidColumnType(e,t){try{validateColumnType(e,t)
return!0}catch(e){if(e instanceof r.Z)return!1
throw e}}},700765:(e,t,n)=>{"use strict"
n.d(t,{j5:()=>deserializeDecimalToFloat,TX:()=>tryDeserializeDate,dR:()=>tryDeserializeDatetime,dx:()=>tryDeserializeDecimalToFloat})
var a=n(64558),i=n(525098)
class BenchlingTypeDeserializationException extends i.Z{}function deserializeOrThrow(e,t){const n=t(e)
if(n.deserialized)return n.value
throw new BenchlingTypeDeserializationException(`Could not deserialize ${e}`)}const tryDeserializeDatetime=e=>"string"!=typeof e||Number.isNaN(Date.parse(e))?{deserialized:!1,value:e}:{deserialized:!0,value:new Date(e)},tryDeserializeDate=e=>tryDeserializeDatetime(e),tryDeserializeDecimalToFloat=e=>{const t="string"==typeof e?(0,a.p3)(e):null
return null==t?{deserialized:!1,value:e}:{deserialized:!0,value:t}}
function deserializeDecimalToFloat(e){return deserializeOrThrow(e,tryDeserializeDecimalToFloat)}},306:(e,t,n)=>{"use strict"
n.d(t,{ZP:()=>DropdownSelector,qF:()=>StringValueDropdownSelector})
var a=n(989526),i=n(232606),s=n(868710),r=n(334148),o=n(954240),l=n(975819),c=n(865486),d=n(297020),u=n(924982),m=n(472347),p=n(623760)
function StringValueDropdownSelector({values:e,valueToReadable:t=(e=>e),onChange:n,...i}){const s=e.map((e=>({name:t(e),value:e,dataTestAttrs:{component:"DropdownSelector",element:"option",key:e}})))
return a.createElement(DropdownSelector,{...i,optionDatas:s,onChange:e=>{n(e)}})}function DropdownSelector({allowNull:e,buttonSize:t,errorMessage:n=null,onChange:h,selectedValue:g,searchable:E,optionDatas:f,nullOptionName:S=null,settingsIconProps:y}){(0,i.hu)(null==S||e,"Allow null must be set to true when nullOptionName is set")
const b=e?[{name:null!=S?S:p.P,value:null},...f]:f,T=b.find((e=>e.value===g)),v=null==T?null==g?p.P:g:T.name,C=E?a.createElement(m.Z,{height:d.Bl.MEDIUM,width:d.zL.FULL,selectedValue:null==T?void 0:T.value,onSelect:h,optionDatas:b}):a.createElement(c.ZP,{height:d.Bl.MEDIUM,width:d.zL.FULL},b.map(((e,t)=>a.createElement(u.Z,{key:t,onSelect:()=>{h(e.value)},value:e.value,dataTestAttrs:e.dataTestAttrs},e.name))))
return null==y?a.createElement(o.ZP,{menu:C,error:n,buttonSize:null!=t?t:r.qE.SMALL,errorStyle:o.ww.TOOLTIP,errorTooltipPlacement:s.TQ.LEFT,disabled:null!=n,displayName:v,dataTestAttrs:{component:"DropdownSelector",element:"button"}}):a.createElement(l.Z,{menu:C,error:n,buttonSize:null!=t?t:r.qE.SMALL,errorStyle:o.ww.TOOLTIP,errorTooltipPlacement:s.TQ.LEFT,disabled:null!=n,displayName:v,dataTestAttrs:{component:"DropdownSelector",element:"button"},settingsIconProps:y})}},369718:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>S})
var a=n(989526),i=n(531041),s=n(841996),r=n(468943),o=n(348920),l=n(634489),c=n(171471),d=n(459830),u=n(747286),m=n(126781),p=n(453580),h=n(204214),g=n(967911),E=n(680544),f=n(502633)
class EntryHistoryPanelConnector extends l.C{constructor(){super(...arguments)
this.shouldSubscribeToRedux=!1
this.stores=[g.Z]}enhanceProps(){return{versionState:this.entryStore().getVersionState(this.props.id)}}}class EntryHistoryPanel extends a.Component{constructor(){super(...arguments)
this.openVersion=e=>{r.L9(c.H4.OPENED_OLD_ENTRY_VERSION,{entry_id:this.props.id})
s.Z.loadVersion(this.props.id,e)}
this.resetToVersion=()=>{r.L9(c.H4.REVERTED_ENTRY_VERSION,{entry_id:this.props.id})
s.Z.resetToOpenVersion(this.props.id)}
this.cloneFromVersion=()=>{(0,f.Z)(u.ZP,{modelType:d.ENTRY,id:this.props.id,versionId:this.props.versionState.openVersionId,initialName:`${this.props.name} (new)`,initialFolderId:this.props.folderId})}}render(){return a.createElement(E.Z,{openVersion:this.openVersion,resetToVersion:o.ZP.ELN_DISABLE_ENTRY_REVERTS?void 0:this.resetToVersion,cloneFromVersion:this.cloneFromVersion,versions:this.props.versionState.versions,openVersionId:this.props.versionState.openVersionId,dirty:this.props.versionState.dirty,isLockedForReview:Array.from(m.ZP.LOCKED_STATUSES).includes((e=g.Z.getEntry(this.props.id).review,t=e=>e.status,null!=e?t(e):void 0)),disableHistoryChanges:containsProcessRelatedTables(g.Z.getEntry(this.props.id)),isLatest:this.props.versionState.isLatest,unsaved:this.props.versionState.unsaved,hasParent:this.props.versionState.hasParent,parent:this.props.versionState.parent,permissions:this.props.permissions})
var e,t}componentDidMount(){s.Z.fetchVersions(this.props.id)}componentDidUpdate(e,t){e.versionState.savedVersion===this.props.versionState.savedVersion&&e.id===this.props.id||i.default.defer((()=>{s.Z.fetchVersions(this.props.id)}))}}const S=EntryHistoryPanelConnector.connect(EntryHistoryPanel)
function containsProcessRelatedTables(e){if(null!=e.note){return(0,h.Z)(e.note).some((e=>e.kind===p.sl.PROCESS_TASK||e.kind===p.sl.PROCESS_OUTPUT))}return!1}},269623:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>c})
var a=n(468943),i=n(787004),s=n(947730),r=n(345619),o=n(974913),l=n(788836)
function commentHelper(e,{linkableID:t,linkType:n,onDescription:a,text:o}){s.Z.dispatch({actionType:i.rdo,protocolID:e,linkableID:t,linkType:n,onDescription:a,text:o})
return r.Z.comment(e,{text:o,linkableID:t,linkType:n,onDescription:a}).done((t=>{s.Z.dispatch({actionType:i.$IR,protocolID:e,comment:t})})).fail((t=>{s.Z.dispatch({actionType:i.x7,protocolID:e,error:t})}))}const c={delete(e,t){null==t&&(t={})
const{success:n}=t
s.Z.dispatch({actionType:i.Ruy,protocolID:e})
r.Z.delete(e).done((t=>{s.Z.dispatch({actionType:i.QzZ,protocolID:e})
"function"==typeof n&&n()})).fail((t=>{s.Z.dispatch({actionType:i.A7x,protocolID:e,error:t})}))},update(e,t,n){null==n&&(n={})
const{success:a}=n
s.Z.dispatch({actionType:i.i$m,protocolID:e,data:t})
r.Z.update(e,t).done((n=>{s.Z.dispatch({actionType:i.EZo,protocolID:e,data:t,serverData:{editURL:null==n?void 0:n.editURL,folder:null==n?void 0:n.folder}})
"function"==typeof a&&a()})).fail((t=>{const n=o.ZP.getFriendlyError(t)
null!=n&&o.ZP.error(n,{id:"protocol-save-fail",duration:0})
s.Z.dispatch({actionType:i.smd,protocolID:e,error:t})}))},open(e){a.j("protocols","open_protocol",{protocol_api_id:e})
s.Z.dispatch({actionType:i.E8k,protocolID:e})
r.Z.get(e).done((t=>{s.Z.dispatch({actionType:i.N8g,protocolID:e,protocol:t})})).fail((t=>{s.Z.dispatch({actionType:i.w6S,protocolID:e,error:t})}))},comment(e,t){commentHelper(e,t)},__dangerouslyCommentWithXHR:(e,t)=>commentHelper(e,t),deleteComment(e,t){s.Z.dispatch({actionType:i.p_P,protocolID:e,commentID:t})
r.Z.deleteComment(e,t).done((n=>{s.Z.dispatch({actionType:i.yoB,protocolID:e,commentID:t})})).fail((n=>{s.Z.dispatch({actionType:i.HBc,protocolID:e,commentID:t,error:n})}))},completeStep(e,t){const n=l.Z.currentUser()
s.Z.dispatch({actionType:i.Zyj,protocolID:e,stepID:t})
null!=n&&r.Z.completeStep(e,t).fail((()=>{s.Z.dispatch({actionType:i.aZ0,protocolID:e,stepID:t})}))},resetStep(e,t){const n=l.Z.currentUser()
s.Z.dispatch({actionType:i.Sn7,protocolID:e,stepID:t})
null!=n&&r.Z.resetStep(e,t).fail((()=>{s.Z.dispatch({actionType:i.D08,protocolID:e,stepID:t})}))},resetAllSteps(e){null!=l.Z.currentUser()?r.Z.resetAllSteps(e).done((()=>{s.Z.dispatch({actionType:i.YxH,protocolID:e})})).fail((()=>{s.Z.dispatch({actionType:i.P3q,protocolID:e})})):s.Z.dispatch({actionType:i.YxH,protocolID:e})}}},525258:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>c})
var a=n(764403),i=n.n(a),s=n(536105),r=n.n(s),o=n(989526),l=n(38317)
class ToolboxActiveTimer extends o.Component{constructor(){super(...arguments)
this.secondsLeft=()=>{if(!this.props.timer.startMoment)return 0
const e=r()().diff(this.props.timer.startMoment)
return Math.max(0,(this.props.timer.startMS-e)/1e3)}}componentDidMount(){this.interval=setInterval(this.forceUpdate.bind(this),30)}componentWillUnmount(){clearInterval(this.interval)
this.props.onRequestPauseAudio()}componentDidUpdate(){this.secondsLeft()>0||this.props.timer.inlineCopy?this.props.onRequestPauseAudio():this.props.onRequestPlayAudio()}render(){function pad(e){return e<10?`0${e}`:`${e}`}const e=this.secondsLeft()
let t=Math.floor(e/60)
const n=Math.floor(e%60),a=Math.floor(t/60)
t%=60
return o.createElement("div",{...(0,l.C)(this.props,"timer","onRequestPlayAudio","onRequestPauseAudio"),className:i()({"toolbox-timer-display":!0,ticking:0===e}),title:"Next timer sets off in..."},`${pad(a)}:${pad(t)}:${pad(n)}`)}}const c=ToolboxActiveTimer},680544:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>N})
var a=n(764403),i=n.n(a),s=n(250965),r=n.n(s),o=n(989526),l=n(573961),c=n(615439),d=n.n(c),u=n(531041),m=n(974913),p=n(443626),h=n(788836),g=n(263137),E=n(187322),f=n.n(E),S=n(679435),y=n.n(S),b=n(260929)
f().extend(y())
function getTestTimestampProps(e){let t=""
try{t=f()(e).toISOString()}catch(e){b.vU(`An error occurred while parsing a datestring with dayjs: ${e.message}`)}return{"data-test-timestamp":t}}var T=n(103593),v=n(59860),C=n(10584),I=n(970211)
const w=n(699418).ZP.get()
function versionToTime(e,t){const n={showYear:!0,showTime:!0,showSeconds:t},a=new Date(e.modified_at||e.modifiedAt)
return C.UT(a,n)}class HistoryPanelComponent extends o.Component{constructor(){super(...arguments)
this.state={showReverted:!1}
this.tbodyRef=o.createRef()
this.toggleShowReverted=e=>{this.setState({showReverted:e})}
this.openVersion=e=>{this.props.openVersionId!==e&&(this.props.unsaved||this.props.dirty?m.ZP.warn("Switching versions is disabled while a save is in progress.",{id:"HistoryPanelComponent.openVersion"}):this.props.openVersion(e))}
this.openParent=()=>{w.openFolderItem(this.props.parent.id,{open:!0,source:"history-panel-component",versionId:this.props.parent.versionId}).done((e=>{e.get("toolbar").trigger("openHistoryPanel")}))}}componentDidUpdate(e,t){if(this.props.openVersionId!==e.openVersionId||this.state.showReverted!==t.showReverted||!d()(this.props.versions,e.versions)){const e=u.default.findWhere(this.props.versions,{fetching:!0})||this.props.openVersionId,t=this.refs[`version-${e}`]
if(null!=t){const e=l.findDOMNode(t),n=r()(l.findDOMNode(this.tbodyRef.current)),a=n.height(),i=n.scrollTop(),s=i+a,o=r()(e).height(),c=e.offsetTop+o
i<e.offsetTop&&c<s||n.stop().animate({scrollTop:e.offsetTop-o/2-a/2},200)}}}render(){let e
const t=I.Hj(this.props.versions),n=u.default.any(u.default.values(t)),isFetching=e=>void 0!==e.fetching&&e.fetching,a=u.default.any(this.props.versions,isFetching),isActive=e=>{if(a)return isFetching(e)
const t=this.props.versions[this.props.versions.length-1]
return this.props.openVersionId===e.id||e===t&&this.props.isLatest},s=this.props.showNames?"third":"half"
return o.createElement(v.Z,{className:"u-tiny-spacing-top",dataTestAttrs:{component:"HistoryPanel",element:"root"}},o.createElement(T.Z,{md:12},n?o.createElement("div",{className:"checkbox u-no-spacing-bottom"},o.createElement("label",{className:i()({disabled:t[this.props.openVersionId]})},o.createElement("input",{type:"checkbox",checked:this.state.showReverted,disabled:t[this.props.openVersionId],onChange:this.toggleShowReverted.bind(null,!this.state.showReverted)}),"Show full history")):null,o.createElement(v.Z,null,o.createElement(T.Z,{md:12},o.createElement("table",{className:"historyVersionTable table table-hover table-condensed scrollable"},o.createElement("thead",null,o.createElement("tr",null,this.props.showNames?o.createElement("th",{className:i()("name",s)},o.createElement("div",{className:"text-left"},"Name")):void 0,o.createElement("th",{className:i()("user",s)},o.createElement("div",{className:"text-left"},"User")),o.createElement("th",{className:i()("time",s)},o.createElement("div",{className:"text-right"},"Timestamp")))),o.createElement("tbody",{ref:this.tbodyRef},0===this.props.versions.length?o.createElement("tr",{className:"version-row"},this.props.showNames?o.createElement("td",{className:i()("name",s)},o.createElement("div",null)):void 0,o.createElement("td",{className:i()("user",s)},o.createElement("div",{className:"text-left"},"Loading...")),o.createElement("td",{className:i()("time",s)},o.createElement("div",null))):(()=>{const n=[]
for(let a=this.props.versions.length-1;a>=0;a--){e=this.props.versions[a]
const r=t[e.id]
if(r&&!this.state.showReverted)continue
const l=this.props.isFirstTrackedVersion&&this.props.isFirstTrackedVersion(e)
n.push(o.createElement("tr",{key:`version-${e.id}`,ref:`version-${e.id}`,className:i()({"version-row":!0,active:isActive(e),"is-reverted":r,"is-fetching":isFetching(e),faded:r}),onClick:this.openVersion.bind(null,e.id),...(0,g.Z)({component:"HistoryPanel",element:"versionRow",index:String(a)})},this.props.showNames?o.createElement("td",{className:i()("name",s),title:e.name},o.createElement("div",{className:"text-left"},e.name)):void 0,o.createElement("td",{className:i()("user",s),title:(0,p.a)(e.creator)},o.createElement("div",{className:"text-left",...(0,g.Z)({component:"HistoryPanel",element:"creatorName"})},(0,p.a)(e.creator),l&&" • First tracked version")),o.createElement("td",{className:i()("time",s),title:versionToTime(e,this.props.showSeconds)},o.createElement("div",{className:"text-right",...(0,g.Z)({component:"HistoryPanel",element:"timestamp"}),...getTestTimestampProps(e.modified_at||e.modifiedAt)},versionToTime(e,this.props.showSeconds)))))}return n})())),this.props.hasParent?o.createElement("span",{className:"pull-right u-small-spacing-top"},"Cloned from ",null!=this.props.parent?o.createElement("a",{onClick:this.openParent},`${this.props.parent.name} (${C.UT(new Date(this.props.parent.modifiedAt))})`):o.createElement("strong",null,"(Deleted)")):null)),o.createElement(v.Z,{className:"u-small-spacing-top"},null!=this.props.resetToVersion?o.createElement(T.Z,{sm:6,className:i()({"col-sm-offset-3":null==this.props.cloneFromVersion})},o.createElement("button",{className:"btn btn-af-primary btn-block",onClick:this.props.resetToVersion,disabled:this.props.isLatest||this.props.unsaved||this.props.isLockedForReview||this.props.disableHistoryChanges||this.props.dirty||!this.props.permissions.writable,type:"button",...(0,g.Z)({component:"HistoryPanel",element:"resetVersionButton"})},"Reset to Version")):void 0,null!=this.props.cloneFromVersion?o.createElement(T.Z,{sm:6},o.createElement("button",{className:null!=this.props.resetToVersion?"btn btn-af-default btn-block":"btn btn-af-primary btn-block",onClick:this.props.cloneFromVersion,disabled:this.props.disableHistoryChanges||null==h.Z.currentUser(),type:"button"},"Clone from Version")):void 0)))}}HistoryPanelComponent.defaultProps={dirty:!1,showNames:!1,showSeconds:!1}
const N=HistoryPanelComponent},422665:(e,t,n)=>{"use strict"
n.d(t,{Z:()=>i})
var a=n(989526)
const i=function LegacyCircularThrobber(){return a.createElement("div",{className:"circular-throbber"},"Loading...")}},306924:(e,t,n)=>{"use strict"
n.d(t,{$N:()=>DnDDragHandleArea,MW:()=>DnDDragHandleIcon,re:()=>c})
var a=n(692013),i=n(764403),s=n.n(i),r=n(989526),o=n(36424)
const l=a.mM.create({dragHandle:{cursor:"grab"}}),c=(0,a.iv)(l.dragHandle)
function DnDDragHandleIcon(e){return r.createElement(o.Z,{icon:"drag-handle",...e})}function DnDDragHandleArea(e){const t={...e,className:s()(e.className,"u-height-full","u-flex-grow")}
return r.createElement("div",{...t})}},741431:(e,t,n)=>{"use strict"
n.d(t,{K9:()=>a,ZP:()=>Pane})
var a,i=n(692013),s=n(764403),r=n.n(s),o=n(989526),l=n(232606),c=n(537623),d=n(129270),u=n(634168),m=n(263137),p=n(868710),h=n(271359),g=n(306924),E=n(73374),f=n(36424),S=n(369706),y=n(884159)
!function(e){e.BOX_SHADOW="BOX_SHADOW"
e.SOLID="SOLID"}(a||(a={}))
function Pane({centerContent:e,children:t,description:n,dragHandleProps:s,fitContent:c=!1,paneBorder:d=a.BOX_SHADOW,sidebar:u,title:h,onChangeTitle:b,toolbar:v,warnings:C=[],banner:I,dataTestAttrs:w}){(0,l.Gp)(null==b||"string"==typeof h,"onChangeTitle cannot be specified if title is not a string")
return o.createElement("div",{className:r()("u-flex-full-height",(0,i.iv)(T.pane),d===a.SOLID?(0,i.iv)(T.solidBorder):(0,i.iv)(T.boxShadowBorder),!c&&(0,i.iv)(T.fitHeightPane)),...(0,m.Z)(w)},o.createElement("div",{className:(0,i.iv)(T.header)},o.createElement("div",{className:r()("u-lr-split","u-vertical-center-items")},o.createElement("div",{className:(0,i.iv)(T.headerTitle)},o.createElement(E.zV,{className:(0,i.iv)(T.headerText)},null!=b&&"string"==typeof h?o.createElement(S.Z,{value:h,requestChange:b}):h),o.createElement("span",{className:"u-mini-spacing-right"}),n&&o.createElement(p.ZP,{placement:p.TQ.BOTTOM,title:n},o.createElement(f.Z,{icon:"info-circle",className:r()("u-mini-spacing-left u-mini-spacing-top",(0,i.iv)(T.descriptionIcon))}))),s&&o.createElement(g.$N,{...s}),o.createElement("div",{className:r()("u-vertical-center-items",(0,i.iv)(T.headerToolbar))},o.createElement("div",null,o.createElement(y.Z,{messages:C}),v),s&&o.createElement("div",{className:"u-mini-spacing-left"},o.createElement(g.MW,{...s})))),I&&o.createElement("div",{className:(0,i.iv)(T.headerBanner)},I)),o.createElement("div",{className:(0,i.iv)(T.contentContainer)},o.createElement("div",{className:r()((0,i.iv)(T.content,e&&T.centeredContent),"scrollbar-override"),...(0,m.Z)({component:"Pane",element:"content"})},t),null!=u&&o.createElement(o.Fragment,null,o.createElement("div",{className:(0,i.iv)(T.sidebarSeparator)}),o.createElement("div",{className:(0,i.iv)(T.sidebarContainer),...(0,m.Z)({component:"Pane",element:"sidebar"})},u))))}Pane.defaultProps={dataTestAttrs:{component:"Pane",element:"root"},isExpanded:!1}
const b=`1px solid ${h.tN}`,T=i.mM.create({solidBorder:{border:b},boxShadowBorder:{boxShadow:"0px 0px 4px rgb(92, 124, 131, 20%)"},contentContainer:{width:"100%",height:"100%",display:"flex",overflow:"hidden"},centeredContent:{alignItems:"center",justifyContent:"center"},content:{display:"flex",flexGrow:1,overflowX:"auto",overflowY:"auto",flexDirection:"column"},fitHeightPane:{height:"100%"},header:{borderBottom:b,paddingTop:c.mR,paddingRight:c.mR,paddingBottom:8,paddingLeft:c.mR},headerBanner:{paddingTop:8},headerText:{...u.wj,minHeight:d.Nk.lineHeight},headerTitle:{display:"flex",overflow:"hidden",whiteSpace:"nowrap"},headerToolbar:{flexShrink:0,flexWrap:"nowrap"},pane:{backgroundColor:h.Cj,borderRadius:4,overflow:"hidden"},sidebarContainer:{flexBasis:232,flexGrow:0,flexShrink:0,height:"100%",overflowY:"auto"},sidebarSeparator:{borderLeft:b},descriptionIcon:{flexShrink:0,transform:"translateY(1px)",width:"14px",height:"14px",marginBottom:"0px"}})},69862:()=>{},140964:()=>{}}])

//# sourceMappingURL=editor.cbe8d02d09da1af1e1ff261257786e03.js.map